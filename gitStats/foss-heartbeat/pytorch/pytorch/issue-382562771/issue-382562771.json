{"url": "https://api.github.com/repos/pytorch/pytorch/issues/14222", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/14222/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/14222/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/14222/events", "html_url": "https://github.com/pytorch/pytorch/issues/14222", "id": 382562771, "node_id": "MDU6SXNzdWUzODI1NjI3NzE=", "number": 14222, "title": "Caffe2->ONNX conversion issue due to spatial-bn", "user": {"login": "parth1595", "id": 21214965, "node_id": "MDQ6VXNlcjIxMjE0OTY1", "avatar_url": "https://avatars1.githubusercontent.com/u/21214965?v=4", "gravatar_id": "", "url": "https://api.github.com/users/parth1595", "html_url": "https://github.com/parth1595", "followers_url": "https://api.github.com/users/parth1595/followers", "following_url": "https://api.github.com/users/parth1595/following{/other_user}", "gists_url": "https://api.github.com/users/parth1595/gists{/gist_id}", "starred_url": "https://api.github.com/users/parth1595/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/parth1595/subscriptions", "organizations_url": "https://api.github.com/users/parth1595/orgs", "repos_url": "https://api.github.com/users/parth1595/repos", "events_url": "https://api.github.com/users/parth1595/events{/privacy}", "received_events_url": "https://api.github.com/users/parth1595/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-11-20T09:04:27Z", "updated_at": "2018-11-20T09:04:27Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>I have used this reference <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"232596763\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/caffe2/caffe2/issues/703\" data-hovercard-type=\"issue\" data-hovercard-url=\"/caffe2/caffe2/issues/703/hovercard\" href=\"https://github.com/caffe2/caffe2/issues/703\">caffe2/caffe2#703</a> to implement resnet model in caffe2 because of mobile export api issues in caffe2. But after applying this changes I am not been able to convert the resnet caffe2 model into onnx model due to unordered sequence of batch-normalization params(running-mean, scale, offset, running-variance).</p>\n<p><strong>Following is error which is caused:</strong></p>\n<pre><code>WARNING:caffe2.python.workspace:Original python traceback for operator `1` in network `deploy_net` in exception above (most recent call last):\nTraceback (most recent call last):\n  File \"temp_model_sqeezenet.py\", line 33, in \u2329module\u232a\n    value_info,\n  File \"/home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/onnx/frontend.py\", line 331, in caffe2_net_to_onnx_model\n    model = make_model(cls.caffe2_net_to_onnx_graph(*args, **kwargs),\n  File \"/home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/onnx/frontend.py\", line 221, in caffe2_net_to_onnx_graph\n    inputs)\n  File \"/home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/onnx/helper.py\", line 62, in c2_native_run_net\n    ws.RunNetOnce(predict_net)\n  File \"/home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/onnx/workspace.py\", line 63, in f\n    return getattr(workspace, attr)(*args, **kwargs)\n  File \"/home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/workspace.py\", line 201, in RunNetOnce\n    StringifyProto(net),\n  File \"/home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/workspace.py\", line 180, in CallWithExceptionIntercept\n    return func(*args, **kwargs)\nRuntimeError: [enforce fail at operator.cc:138] schema-\u232aVerify(operator_def). Operator def did not pass schema checking: input: \"conv1_1\" input: \"bn1_s_0\" input: \"bn1_b_0\" input: \"bn1_rm_0\" input: \"bn1_riv_0\" output: \"bn1_1\" output: \"bn1_rm_1\" output: \"bn1_riv_1\" output: \"bn1_sm_1\" output: \"bn1_siv_1\" name: \"\" type: \"SpatialBN\" arg { name: \"is_test\" i: 0 } arg { name: \"use_cudnn\" i: 1 } arg { name: \"cudnn_exhaustive_search\" i: 0 } arg { name: \"order\" s: \"NCHW\" }\nframe #0: c10::ThrowEnforceNotMet(char const*, int, char const*, std::__cxx11::basic_string\u2329char, std::char_traits\u2329char\u232a, std::allocator\u2329char\u232a \u232a const&amp;, void const*) + 0x68 (0x7fdac2551778 in /home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/../../../../libc10.so)\nframe #1: \u2329unknown function\u232a + 0x1273197 (0x7fdac3\n```9c9\n</code></pre>", "body_text": "I have used this reference caffe2/caffe2#703 to implement resnet model in caffe2 because of mobile export api issues in caffe2. But after applying this changes I am not been able to convert the resnet caffe2 model into onnx model due to unordered sequence of batch-normalization params(running-mean, scale, offset, running-variance).\nFollowing is error which is caused:\nWARNING:caffe2.python.workspace:Original python traceback for operator `1` in network `deploy_net` in exception above (most recent call last):\nTraceback (most recent call last):\n  File \"temp_model_sqeezenet.py\", line 33, in \u2329module\u232a\n    value_info,\n  File \"/home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/onnx/frontend.py\", line 331, in caffe2_net_to_onnx_model\n    model = make_model(cls.caffe2_net_to_onnx_graph(*args, **kwargs),\n  File \"/home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/onnx/frontend.py\", line 221, in caffe2_net_to_onnx_graph\n    inputs)\n  File \"/home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/onnx/helper.py\", line 62, in c2_native_run_net\n    ws.RunNetOnce(predict_net)\n  File \"/home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/onnx/workspace.py\", line 63, in f\n    return getattr(workspace, attr)(*args, **kwargs)\n  File \"/home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/workspace.py\", line 201, in RunNetOnce\n    StringifyProto(net),\n  File \"/home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/workspace.py\", line 180, in CallWithExceptionIntercept\n    return func(*args, **kwargs)\nRuntimeError: [enforce fail at operator.cc:138] schema-\u232aVerify(operator_def). Operator def did not pass schema checking: input: \"conv1_1\" input: \"bn1_s_0\" input: \"bn1_b_0\" input: \"bn1_rm_0\" input: \"bn1_riv_0\" output: \"bn1_1\" output: \"bn1_rm_1\" output: \"bn1_riv_1\" output: \"bn1_sm_1\" output: \"bn1_siv_1\" name: \"\" type: \"SpatialBN\" arg { name: \"is_test\" i: 0 } arg { name: \"use_cudnn\" i: 1 } arg { name: \"cudnn_exhaustive_search\" i: 0 } arg { name: \"order\" s: \"NCHW\" }\nframe #0: c10::ThrowEnforceNotMet(char const*, int, char const*, std::__cxx11::basic_string\u2329char, std::char_traits\u2329char\u232a, std::allocator\u2329char\u232a \u232a const&, void const*) + 0x68 (0x7fdac2551778 in /home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/../../../../libc10.so)\nframe #1: \u2329unknown function\u232a + 0x1273197 (0x7fdac3\n```9c9", "body": "I have used this reference https://github.com/caffe2/caffe2/issues/703 to implement resnet model in caffe2 because of mobile export api issues in caffe2. But after applying this changes I am not been able to convert the resnet caffe2 model into onnx model due to unordered sequence of batch-normalization params(running-mean, scale, offset, running-variance).\r\n\r\n**Following is error which is caused:**\r\n\r\n```\r\nWARNING:caffe2.python.workspace:Original python traceback for operator `1` in network `deploy_net` in exception above (most recent call last):\r\nTraceback (most recent call last):\r\n  File \"temp_model_sqeezenet.py\", line 33, in \u2329module\u232a\r\n    value_info,\r\n  File \"/home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/onnx/frontend.py\", line 331, in caffe2_net_to_onnx_model\r\n    model = make_model(cls.caffe2_net_to_onnx_graph(*args, **kwargs),\r\n  File \"/home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/onnx/frontend.py\", line 221, in caffe2_net_to_onnx_graph\r\n    inputs)\r\n  File \"/home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/onnx/helper.py\", line 62, in c2_native_run_net\r\n    ws.RunNetOnce(predict_net)\r\n  File \"/home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/onnx/workspace.py\", line 63, in f\r\n    return getattr(workspace, attr)(*args, **kwargs)\r\n  File \"/home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/workspace.py\", line 201, in RunNetOnce\r\n    StringifyProto(net),\r\n  File \"/home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/workspace.py\", line 180, in CallWithExceptionIntercept\r\n    return func(*args, **kwargs)\r\nRuntimeError: [enforce fail at operator.cc:138] schema-\u232aVerify(operator_def). Operator def did not pass schema checking: input: \"conv1_1\" input: \"bn1_s_0\" input: \"bn1_b_0\" input: \"bn1_rm_0\" input: \"bn1_riv_0\" output: \"bn1_1\" output: \"bn1_rm_1\" output: \"bn1_riv_1\" output: \"bn1_sm_1\" output: \"bn1_siv_1\" name: \"\" type: \"SpatialBN\" arg { name: \"is_test\" i: 0 } arg { name: \"use_cudnn\" i: 1 } arg { name: \"cudnn_exhaustive_search\" i: 0 } arg { name: \"order\" s: \"NCHW\" }\r\nframe #0: c10::ThrowEnforceNotMet(char const*, int, char const*, std::__cxx11::basic_string\u2329char, std::char_traits\u2329char\u232a, std::allocator\u2329char\u232a \u232a const&, void const*) + 0x68 (0x7fdac2551778 in /home/parthr/anaconda2/lib/python2.7/site-packages/caffe2/python/../../../../libc10.so)\r\nframe #1: \u2329unknown function\u232a + 0x1273197 (0x7fdac3\r\n```9c9\r\n"}