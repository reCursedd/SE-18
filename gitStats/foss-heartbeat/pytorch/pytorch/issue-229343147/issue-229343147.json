{"url": "https://api.github.com/repos/pytorch/pytorch/issues/1579", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/1579/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/1579/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/1579/events", "html_url": "https://github.com/pytorch/pytorch/issues/1579", "id": 229343147, "node_id": "MDU6SXNzdWUyMjkzNDMxNDc=", "number": 1579, "title": "DataLoader hangs with num_workers > 0", "user": {"login": "greaber", "id": 8763901, "node_id": "MDQ6VXNlcjg3NjM5MDE=", "avatar_url": "https://avatars1.githubusercontent.com/u/8763901?v=4", "gravatar_id": "", "url": "https://api.github.com/users/greaber", "html_url": "https://github.com/greaber", "followers_url": "https://api.github.com/users/greaber/followers", "following_url": "https://api.github.com/users/greaber/following{/other_user}", "gists_url": "https://api.github.com/users/greaber/gists{/gist_id}", "starred_url": "https://api.github.com/users/greaber/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/greaber/subscriptions", "organizations_url": "https://api.github.com/users/greaber/orgs", "repos_url": "https://api.github.com/users/greaber/repos", "events_url": "https://api.github.com/users/greaber/events{/privacy}", "received_events_url": "https://api.github.com/users/greaber/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-05-17T12:57:32Z", "updated_at": "2017-05-24T09:13:49Z", "closed_at": "2017-05-24T09:13:49Z", "author_association": "CONTRIBUTOR", "body_html": "<p>The following script reliably causes a deadlock (or perhaps hanging for some other reason) on my machine.  Not sure if it is a pytorch bug or a librosa bug.</p>\n<pre><code>import sys\nfrom urllib.request import urlopen\nfrom urllib.error import URLError\nfrom torchvision.datasets import ImageFolder\nfrom torch.utils.data import DataLoader\nimport librosa\n\n# I am using the ImageFolder dataset to load audio data.\n# To do this, I rename all my WAV files to end in .jpg\n# so ImageFolder will think they are images and then\n# load them with librosa.  Note: it is important that there\n# are no actual image files under ./data!\n\n# The program hangs after printing \n#\n#    trying to load ./data/foo/file.jpg\n#\n# However, if bug_condition is set to False, or if either\n# fixes_bug1 or fixes_bug2 is set to True, then it does\n# not hang.\n\nbug_condition = True\nfixes_bug1 = False\nfixes_bug2 = False\n\nif bug_condition:\n    try:\n        urlopen('http://localhost:8097')\n    except URLError:\n        pass\n    else:\n        sys.exit('please retry without a server running on port 8097')\n\nif fixes_bug1:\n    # Note: ./data/foo/file.jpg must be a valid WAV file.\n    librosa.load('./data/foo/file.jpg')\n\ndef audio_loader(filename):\n    print('trying to load', filename)\n    audio = librosa.load(filename, sr=16000)[0]\n    print('loaded', filename)\n    return audio\n\ndata = ImageFolder(root='./data', loader=audio_loader)\nloader = DataLoader(data, num_workers=(0 if fixes_bug2 else 1))\n\nfor x, y in loader:\n    print('OK')\n</code></pre>", "body_text": "The following script reliably causes a deadlock (or perhaps hanging for some other reason) on my machine.  Not sure if it is a pytorch bug or a librosa bug.\nimport sys\nfrom urllib.request import urlopen\nfrom urllib.error import URLError\nfrom torchvision.datasets import ImageFolder\nfrom torch.utils.data import DataLoader\nimport librosa\n\n# I am using the ImageFolder dataset to load audio data.\n# To do this, I rename all my WAV files to end in .jpg\n# so ImageFolder will think they are images and then\n# load them with librosa.  Note: it is important that there\n# are no actual image files under ./data!\n\n# The program hangs after printing \n#\n#    trying to load ./data/foo/file.jpg\n#\n# However, if bug_condition is set to False, or if either\n# fixes_bug1 or fixes_bug2 is set to True, then it does\n# not hang.\n\nbug_condition = True\nfixes_bug1 = False\nfixes_bug2 = False\n\nif bug_condition:\n    try:\n        urlopen('http://localhost:8097')\n    except URLError:\n        pass\n    else:\n        sys.exit('please retry without a server running on port 8097')\n\nif fixes_bug1:\n    # Note: ./data/foo/file.jpg must be a valid WAV file.\n    librosa.load('./data/foo/file.jpg')\n\ndef audio_loader(filename):\n    print('trying to load', filename)\n    audio = librosa.load(filename, sr=16000)[0]\n    print('loaded', filename)\n    return audio\n\ndata = ImageFolder(root='./data', loader=audio_loader)\nloader = DataLoader(data, num_workers=(0 if fixes_bug2 else 1))\n\nfor x, y in loader:\n    print('OK')", "body": "The following script reliably causes a deadlock (or perhaps hanging for some other reason) on my machine.  Not sure if it is a pytorch bug or a librosa bug.\r\n\r\n```\r\nimport sys\r\nfrom urllib.request import urlopen\r\nfrom urllib.error import URLError\r\nfrom torchvision.datasets import ImageFolder\r\nfrom torch.utils.data import DataLoader\r\nimport librosa\r\n\r\n# I am using the ImageFolder dataset to load audio data.\r\n# To do this, I rename all my WAV files to end in .jpg\r\n# so ImageFolder will think they are images and then\r\n# load them with librosa.  Note: it is important that there\r\n# are no actual image files under ./data!\r\n\r\n# The program hangs after printing \r\n#\r\n#    trying to load ./data/foo/file.jpg\r\n#\r\n# However, if bug_condition is set to False, or if either\r\n# fixes_bug1 or fixes_bug2 is set to True, then it does\r\n# not hang.\r\n\r\nbug_condition = True\r\nfixes_bug1 = False\r\nfixes_bug2 = False\r\n\r\nif bug_condition:\r\n    try:\r\n        urlopen('http://localhost:8097')\r\n    except URLError:\r\n        pass\r\n    else:\r\n        sys.exit('please retry without a server running on port 8097')\r\n\r\nif fixes_bug1:\r\n    # Note: ./data/foo/file.jpg must be a valid WAV file.\r\n    librosa.load('./data/foo/file.jpg')\r\n\r\ndef audio_loader(filename):\r\n    print('trying to load', filename)\r\n    audio = librosa.load(filename, sr=16000)[0]\r\n    print('loaded', filename)\r\n    return audio\r\n\r\ndata = ImageFolder(root='./data', loader=audio_loader)\r\nloader = DataLoader(data, num_workers=(0 if fixes_bug2 else 1))\r\n\r\nfor x, y in loader:\r\n    print('OK')\r\n```"}