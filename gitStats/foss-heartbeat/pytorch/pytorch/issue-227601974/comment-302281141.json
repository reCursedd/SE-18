{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/302281141", "html_url": "https://github.com/pytorch/pytorch/issues/1526#issuecomment-302281141", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/1526", "id": 302281141, "node_id": "MDEyOklzc3VlQ29tbWVudDMwMjI4MTE0MQ==", "user": {"login": "xuancong84", "id": 10172392, "node_id": "MDQ6VXNlcjEwMTcyMzky", "avatar_url": "https://avatars0.githubusercontent.com/u/10172392?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xuancong84", "html_url": "https://github.com/xuancong84", "followers_url": "https://api.github.com/users/xuancong84/followers", "following_url": "https://api.github.com/users/xuancong84/following{/other_user}", "gists_url": "https://api.github.com/users/xuancong84/gists{/gist_id}", "starred_url": "https://api.github.com/users/xuancong84/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xuancong84/subscriptions", "organizations_url": "https://api.github.com/users/xuancong84/orgs", "repos_url": "https://api.github.com/users/xuancong84/repos", "events_url": "https://api.github.com/users/xuancong84/events{/privacy}", "received_events_url": "https://api.github.com/users/xuancong84/received_events", "type": "User", "site_admin": false}, "created_at": "2017-05-18T02:11:31Z", "updated_at": "2017-05-18T02:11:31Z", "author_association": "NONE", "body_html": "<p>Thanks to <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=7438704\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/alcinos\">@alcinos</a> , I also encounter the same problem. Upon examining into the problem, I found that the following operations in torch.save have actually succeeded:</p>\n<pre><code>    pickle_module.dump(MAGIC_NUMBER, f, protocol=pickle_protocol)\n    pickle_module.dump(PROTOCOL_VERSION, f, protocol=pickle_protocol)\n    pickle_module.dump(sys_info, f, protocol=pickle_protocol)\n    pickler = pickle_module.Pickler(f, protocol=pickle_protocol)\n    pickler.persistent_id = persistent_id\n    pickler.dump(obj)\n</code></pre>\n<p>What fails is the last operation:</p>\n<pre><code>    for key in serialized_storage_keys:\n        serialized_storages[key]._write_file(f)\n</code></pre>\n<p>This calls the native serialized storage writer which is implemented in C, it writes to the file directly using fileno, thus, it has bypassed the gzip wrapper. Thus, the resultant GZIP file is corrupted.</p>", "body_text": "Thanks to @alcinos , I also encounter the same problem. Upon examining into the problem, I found that the following operations in torch.save have actually succeeded:\n    pickle_module.dump(MAGIC_NUMBER, f, protocol=pickle_protocol)\n    pickle_module.dump(PROTOCOL_VERSION, f, protocol=pickle_protocol)\n    pickle_module.dump(sys_info, f, protocol=pickle_protocol)\n    pickler = pickle_module.Pickler(f, protocol=pickle_protocol)\n    pickler.persistent_id = persistent_id\n    pickler.dump(obj)\n\nWhat fails is the last operation:\n    for key in serialized_storage_keys:\n        serialized_storages[key]._write_file(f)\n\nThis calls the native serialized storage writer which is implemented in C, it writes to the file directly using fileno, thus, it has bypassed the gzip wrapper. Thus, the resultant GZIP file is corrupted.", "body": "Thanks to @alcinos , I also encounter the same problem. Upon examining into the problem, I found that the following operations in torch.save have actually succeeded:\r\n```\r\n    pickle_module.dump(MAGIC_NUMBER, f, protocol=pickle_protocol)\r\n    pickle_module.dump(PROTOCOL_VERSION, f, protocol=pickle_protocol)\r\n    pickle_module.dump(sys_info, f, protocol=pickle_protocol)\r\n    pickler = pickle_module.Pickler(f, protocol=pickle_protocol)\r\n    pickler.persistent_id = persistent_id\r\n    pickler.dump(obj)\r\n```\r\n\r\nWhat fails is the last operation:\r\n```\r\n    for key in serialized_storage_keys:\r\n        serialized_storages[key]._write_file(f)\r\n```\r\nThis calls the native serialized storage writer which is implemented in C, it writes to the file directly using fileno, thus, it has bypassed the gzip wrapper. Thus, the resultant GZIP file is corrupted."}