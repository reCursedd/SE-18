{"url": "https://api.github.com/repos/pytorch/pytorch/issues/13197", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/13197/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/13197/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/13197/events", "html_url": "https://github.com/pytorch/pytorch/issues/13197", "id": 374582807, "node_id": "MDU6SXNzdWUzNzQ1ODI4MDc=", "number": 13197, "title": "Non-deterministic behavior in pytorch even with seeds set", "user": {"login": "altosaar", "id": 5317244, "node_id": "MDQ6VXNlcjUzMTcyNDQ=", "avatar_url": "https://avatars3.githubusercontent.com/u/5317244?v=4", "gravatar_id": "", "url": "https://api.github.com/users/altosaar", "html_url": "https://github.com/altosaar", "followers_url": "https://api.github.com/users/altosaar/followers", "following_url": "https://api.github.com/users/altosaar/following{/other_user}", "gists_url": "https://api.github.com/users/altosaar/gists{/gist_id}", "starred_url": "https://api.github.com/users/altosaar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/altosaar/subscriptions", "organizations_url": "https://api.github.com/users/altosaar/orgs", "repos_url": "https://api.github.com/users/altosaar/repos", "events_url": "https://api.github.com/users/altosaar/events{/privacy}", "received_events_url": "https://api.github.com/users/altosaar/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": {"login": "soumith", "id": 1310570, "node_id": "MDQ6VXNlcjEzMTA1NzA=", "avatar_url": "https://avatars0.githubusercontent.com/u/1310570?v=4", "gravatar_id": "", "url": "https://api.github.com/users/soumith", "html_url": "https://github.com/soumith", "followers_url": "https://api.github.com/users/soumith/followers", "following_url": "https://api.github.com/users/soumith/following{/other_user}", "gists_url": "https://api.github.com/users/soumith/gists{/gist_id}", "starred_url": "https://api.github.com/users/soumith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/soumith/subscriptions", "organizations_url": "https://api.github.com/users/soumith/orgs", "repos_url": "https://api.github.com/users/soumith/repos", "events_url": "https://api.github.com/users/soumith/events{/privacy}", "received_events_url": "https://api.github.com/users/soumith/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "soumith", "id": 1310570, "node_id": "MDQ6VXNlcjEzMTA1NzA=", "avatar_url": "https://avatars0.githubusercontent.com/u/1310570?v=4", "gravatar_id": "", "url": "https://api.github.com/users/soumith", "html_url": "https://github.com/soumith", "followers_url": "https://api.github.com/users/soumith/followers", "following_url": "https://api.github.com/users/soumith/following{/other_user}", "gists_url": "https://api.github.com/users/soumith/gists{/gist_id}", "starred_url": "https://api.github.com/users/soumith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/soumith/subscriptions", "organizations_url": "https://api.github.com/users/soumith/orgs", "repos_url": "https://api.github.com/users/soumith/repos", "events_url": "https://api.github.com/users/soumith/events{/privacy}", "received_events_url": "https://api.github.com/users/soumith/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2018-10-26T23:56:19Z", "updated_at": "2018-11-19T00:35:03Z", "closed_at": null, "author_association": "NONE", "body_html": "<h2><g-emoji class=\"g-emoji\" alias=\"bug\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f41b.png\">\ud83d\udc1b</g-emoji> Bug</h2>\n<h2>To Reproduce</h2>\n<p>Steps to reproduce the behavior:</p>\n<ol>\n<li><code>git clone https://github.com/altosaar/pytorch-non-determinism</code></li>\n<li><code>cd pytorch-non-determinisim</code></li>\n<li><code>python test_moons.py</code></li>\n</ol>\n<p>I get similar non-deterministic output on cpu (mac, linux) and gpu (tesla p100, linux):</p>\n<pre><code>$ python test_moons.py \nstep: 0\tloss: inf\n\tvalid_loss: nan\nTraceback ...\n\n$ python test_moons.py \nstep: 0\tloss: 2.04\n\tvalid_loss: 2.0884687901\nTraceback (most recent call last):\n</code></pre>\n<h2>Expected behavior</h2>\n<p>Deterministic behavior. I set numpy and torch seeds, and the cudnn options mentioned at <a href=\"https://pytorch.org/docs/master/notes/randomness.html\" rel=\"nofollow\">https://pytorch.org/docs/master/notes/randomness.html</a></p>\n<h2>Environment</h2>\n<pre><code>$ python collect_env.py\nCollecting environment information...\nPyTorch version: 0.4.1\nIs debug build: No\nCUDA used to build PyTorch: 9.2.148\n\nOS: Springdale Linux release 7.5 (Verona)\nGCC version: (GCC) 4.8.5 20150623 (Red Hat 4.8.5-28)\nCMake version: Could not collect\n\nPython version: 3.6\nIs CUDA available: Yes\nCUDA runtime version: 9.2.88\nGPU models and configuration: GPU 0: Tesla P100-PCIE-16GB\nNvidia driver version: 410.48\ncuDNN version: Probably one of the following:\n/usr/local/cudnn/cuda-9.2/7.1.4/lib64/libcudnn.so.7.1.4\n\nVersions of relevant libraries:\n[pip] numpy (1.14.6)\n[pip] torch (0.4.1)\n[pip] torchvision (0.2.1)\n[conda] cuda92                    1.0                           0    pytorch\n[conda] pytorch                   0.4.1           py36_cuda9.2.148_cudnn7.1.4_1  [cuda92]  pytorch\n[conda] torchvision               0.2.1                    py36_1    pytorch\n</code></pre>", "body_text": "\ud83d\udc1b Bug\nTo Reproduce\nSteps to reproduce the behavior:\n\ngit clone https://github.com/altosaar/pytorch-non-determinism\ncd pytorch-non-determinisim\npython test_moons.py\n\nI get similar non-deterministic output on cpu (mac, linux) and gpu (tesla p100, linux):\n$ python test_moons.py \nstep: 0\tloss: inf\n\tvalid_loss: nan\nTraceback ...\n\n$ python test_moons.py \nstep: 0\tloss: 2.04\n\tvalid_loss: 2.0884687901\nTraceback (most recent call last):\n\nExpected behavior\nDeterministic behavior. I set numpy and torch seeds, and the cudnn options mentioned at https://pytorch.org/docs/master/notes/randomness.html\nEnvironment\n$ python collect_env.py\nCollecting environment information...\nPyTorch version: 0.4.1\nIs debug build: No\nCUDA used to build PyTorch: 9.2.148\n\nOS: Springdale Linux release 7.5 (Verona)\nGCC version: (GCC) 4.8.5 20150623 (Red Hat 4.8.5-28)\nCMake version: Could not collect\n\nPython version: 3.6\nIs CUDA available: Yes\nCUDA runtime version: 9.2.88\nGPU models and configuration: GPU 0: Tesla P100-PCIE-16GB\nNvidia driver version: 410.48\ncuDNN version: Probably one of the following:\n/usr/local/cudnn/cuda-9.2/7.1.4/lib64/libcudnn.so.7.1.4\n\nVersions of relevant libraries:\n[pip] numpy (1.14.6)\n[pip] torch (0.4.1)\n[pip] torchvision (0.2.1)\n[conda] cuda92                    1.0                           0    pytorch\n[conda] pytorch                   0.4.1           py36_cuda9.2.148_cudnn7.1.4_1  [cuda92]  pytorch\n[conda] torchvision               0.2.1                    py36_1    pytorch", "body": "## \ud83d\udc1b Bug\r\n\r\n\r\n## To Reproduce\r\n\r\nSteps to reproduce the behavior:\r\n\r\n1. `git clone https://github.com/altosaar/pytorch-non-determinism`\r\n2. `cd pytorch-non-determinisim`\r\n3. `python test_moons.py`\r\n\r\nI get similar non-deterministic output on cpu (mac, linux) and gpu (tesla p100, linux):\r\n\r\n```\r\n$ python test_moons.py \r\nstep: 0\tloss: inf\r\n\tvalid_loss: nan\r\nTraceback ...\r\n\r\n$ python test_moons.py \r\nstep: 0\tloss: 2.04\r\n\tvalid_loss: 2.0884687901\r\nTraceback (most recent call last):\r\n```\r\n\r\n## Expected behavior\r\n\r\nDeterministic behavior. I set numpy and torch seeds, and the cudnn options mentioned at https://pytorch.org/docs/master/notes/randomness.html\r\n\r\n## Environment\r\n\r\n```\r\n$ python collect_env.py\r\nCollecting environment information...\r\nPyTorch version: 0.4.1\r\nIs debug build: No\r\nCUDA used to build PyTorch: 9.2.148\r\n\r\nOS: Springdale Linux release 7.5 (Verona)\r\nGCC version: (GCC) 4.8.5 20150623 (Red Hat 4.8.5-28)\r\nCMake version: Could not collect\r\n\r\nPython version: 3.6\r\nIs CUDA available: Yes\r\nCUDA runtime version: 9.2.88\r\nGPU models and configuration: GPU 0: Tesla P100-PCIE-16GB\r\nNvidia driver version: 410.48\r\ncuDNN version: Probably one of the following:\r\n/usr/local/cudnn/cuda-9.2/7.1.4/lib64/libcudnn.so.7.1.4\r\n\r\nVersions of relevant libraries:\r\n[pip] numpy (1.14.6)\r\n[pip] torch (0.4.1)\r\n[pip] torchvision (0.2.1)\r\n[conda] cuda92                    1.0                           0    pytorch\r\n[conda] pytorch                   0.4.1           py36_cuda9.2.148_cudnn7.1.4_1  [cuda92]  pytorch\r\n[conda] torchvision               0.2.1                    py36_1    pytorch\r\n```"}