{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/427622008", "html_url": "https://github.com/pytorch/pytorch/issues/4375#issuecomment-427622008", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/4375", "id": 427622008, "node_id": "MDEyOklzc3VlQ29tbWVudDQyNzYyMjAwOA==", "user": {"login": "mlinxiang", "id": 6283983, "node_id": "MDQ6VXNlcjYyODM5ODM=", "avatar_url": "https://avatars0.githubusercontent.com/u/6283983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mlinxiang", "html_url": "https://github.com/mlinxiang", "followers_url": "https://api.github.com/users/mlinxiang/followers", "following_url": "https://api.github.com/users/mlinxiang/following{/other_user}", "gists_url": "https://api.github.com/users/mlinxiang/gists{/gist_id}", "starred_url": "https://api.github.com/users/mlinxiang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mlinxiang/subscriptions", "organizations_url": "https://api.github.com/users/mlinxiang/orgs", "repos_url": "https://api.github.com/users/mlinxiang/repos", "events_url": "https://api.github.com/users/mlinxiang/events{/privacy}", "received_events_url": "https://api.github.com/users/mlinxiang/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-07T03:06:05Z", "updated_at": "2018-10-07T03:06:05Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=25361013\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/uhvardhan\">@uhvardhan</a> #<br>\ncan use follow code, and must use the newest pytorch code, to fix some other onnx bug<br>\noriginal saved file with DataParallel<br>\nstate_dict = torch.load('myfile.pth.tar')</p>\n<h1>create new OrderedDict that does not contain <code>module.</code></h1>\n<p>from collections import OrderedDict<br>\nnew_state_dict = OrderedDict()<br>\nfor k, v in state_dict.items():<br>\nname = k[7:] # remove <code>module.</code><br>\nnew_state_dict[name] = v</p>\n<h1>load params</h1>\n<p>model.load_state_dict(new_state_dict)</p>\n<p>Reference: <a href=\"https://discuss.pytorch.org/t/solved-keyerror-unexpected-key-module-encoder-embedding-weight-in-state-dict/1686\" rel=\"nofollow\">https://discuss.pytorch.org/t/solved-keyerror-unexpected-key-module-encoder-embedding-weight-in-state-dict/1686</a></p>", "body_text": "@uhvardhan #\ncan use follow code, and must use the newest pytorch code, to fix some other onnx bug\noriginal saved file with DataParallel\nstate_dict = torch.load('myfile.pth.tar')\ncreate new OrderedDict that does not contain module.\nfrom collections import OrderedDict\nnew_state_dict = OrderedDict()\nfor k, v in state_dict.items():\nname = k[7:] # remove module.\nnew_state_dict[name] = v\nload params\nmodel.load_state_dict(new_state_dict)\nReference: https://discuss.pytorch.org/t/solved-keyerror-unexpected-key-module-encoder-embedding-weight-in-state-dict/1686", "body": "@uhvardhan #\r\ncan use follow code, and must use the newest pytorch code, to fix some other onnx bug\r\n original saved file with DataParallel\r\nstate_dict = torch.load('myfile.pth.tar')\r\n# create new OrderedDict that does not contain `module.`\r\nfrom collections import OrderedDict\r\nnew_state_dict = OrderedDict()\r\nfor k, v in state_dict.items():\r\n    name = k[7:] # remove `module.`\r\n    new_state_dict[name] = v\r\n# load params\r\nmodel.load_state_dict(new_state_dict)\r\n\r\nReference: https://discuss.pytorch.org/t/solved-keyerror-unexpected-key-module-encoder-embedding-weight-in-state-dict/1686"}