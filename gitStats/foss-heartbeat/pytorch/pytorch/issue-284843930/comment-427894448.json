{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/427894448", "html_url": "https://github.com/pytorch/pytorch/issues/4375#issuecomment-427894448", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/4375", "id": 427894448, "node_id": "MDEyOklzc3VlQ29tbWVudDQyNzg5NDQ0OA==", "user": {"login": "uhvardhan", "id": 25361013, "node_id": "MDQ6VXNlcjI1MzYxMDEz", "avatar_url": "https://avatars3.githubusercontent.com/u/25361013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/uhvardhan", "html_url": "https://github.com/uhvardhan", "followers_url": "https://api.github.com/users/uhvardhan/followers", "following_url": "https://api.github.com/users/uhvardhan/following{/other_user}", "gists_url": "https://api.github.com/users/uhvardhan/gists{/gist_id}", "starred_url": "https://api.github.com/users/uhvardhan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/uhvardhan/subscriptions", "organizations_url": "https://api.github.com/users/uhvardhan/orgs", "repos_url": "https://api.github.com/users/uhvardhan/repos", "events_url": "https://api.github.com/users/uhvardhan/events{/privacy}", "received_events_url": "https://api.github.com/users/uhvardhan/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-08T16:16:15Z", "updated_at": "2018-10-08T16:16:15Z", "author_association": "NONE", "body_html": "<blockquote>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=25361013\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/uhvardhan\">@uhvardhan</a> #<br>\ncan use follow code, and must use the newest pytorch code, to fix some other onnx bug<br>\noriginal saved file with DataParallel<br>\nstate_dict = torch.load('myfile.pth.tar')</p>\n<h1>create new OrderedDict that does not contain <code>module.</code></h1>\n<p>from collections import OrderedDict<br>\nnew_state_dict = OrderedDict()<br>\nfor k, v in state_dict.items():<br>\nname = k[7:] # remove <code>module.</code><br>\nnew_state_dict[name] = v</p>\n<h1>load params</h1>\n<p>model.load_state_dict(new_state_dict)</p>\n<p>Reference: <a href=\"https://discuss.pytorch.org/t/solved-keyerror-unexpected-key-module-encoder-embedding-weight-in-state-dict/1686\" rel=\"nofollow\">https://discuss.pytorch.org/t/solved-keyerror-unexpected-key-module-encoder-embedding-weight-in-state-dict/1686</a></p>\n</blockquote>\n<p>I get a new Attribute error if I follow as you said.<br>\nAttributeError: 'DataParallel' object has no attribute 'items'</p>\n<p>Also, I used this state_dict = torch.load(path) where path corresponds to just the pth file.</p>\n<p>Is there something I am doing wrong?</p>", "body_text": "@uhvardhan #\ncan use follow code, and must use the newest pytorch code, to fix some other onnx bug\noriginal saved file with DataParallel\nstate_dict = torch.load('myfile.pth.tar')\ncreate new OrderedDict that does not contain module.\nfrom collections import OrderedDict\nnew_state_dict = OrderedDict()\nfor k, v in state_dict.items():\nname = k[7:] # remove module.\nnew_state_dict[name] = v\nload params\nmodel.load_state_dict(new_state_dict)\nReference: https://discuss.pytorch.org/t/solved-keyerror-unexpected-key-module-encoder-embedding-weight-in-state-dict/1686\n\nI get a new Attribute error if I follow as you said.\nAttributeError: 'DataParallel' object has no attribute 'items'\nAlso, I used this state_dict = torch.load(path) where path corresponds to just the pth file.\nIs there something I am doing wrong?", "body": "> @uhvardhan #\r\n> can use follow code, and must use the newest pytorch code, to fix some other onnx bug\r\n> original saved file with DataParallel\r\n> state_dict = torch.load('myfile.pth.tar')\r\n> \r\n> # create new OrderedDict that does not contain `module.`\r\n> from collections import OrderedDict\r\n> new_state_dict = OrderedDict()\r\n> for k, v in state_dict.items():\r\n> name = k[7:] # remove `module.`\r\n> new_state_dict[name] = v\r\n> \r\n> # load params\r\n> model.load_state_dict(new_state_dict)\r\n> \r\n> Reference: https://discuss.pytorch.org/t/solved-keyerror-unexpected-key-module-encoder-embedding-weight-in-state-dict/1686\r\n\r\nI get a new Attribute error if I follow as you said. \r\nAttributeError: 'DataParallel' object has no attribute 'items'\r\n\r\nAlso, I used this state_dict = torch.load(path) where path corresponds to just the pth file. \r\n\r\nIs there something I am doing wrong? "}