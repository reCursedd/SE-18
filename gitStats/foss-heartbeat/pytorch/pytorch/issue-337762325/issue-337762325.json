{"url": "https://api.github.com/repos/pytorch/pytorch/issues/9127", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/9127/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/9127/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/9127/events", "html_url": "https://github.com/pytorch/pytorch/issues/9127", "id": 337762325, "node_id": "MDU6SXNzdWUzMzc3NjIzMjU=", "number": 9127, "title": "Always get error \"ConnectionResetError: [Errno 104] Connection reset by peer\"", "user": {"login": "Mabinogiysk", "id": 12441989, "node_id": "MDQ6VXNlcjEyNDQxOTg5", "avatar_url": "https://avatars1.githubusercontent.com/u/12441989?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mabinogiysk", "html_url": "https://github.com/Mabinogiysk", "followers_url": "https://api.github.com/users/Mabinogiysk/followers", "following_url": "https://api.github.com/users/Mabinogiysk/following{/other_user}", "gists_url": "https://api.github.com/users/Mabinogiysk/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mabinogiysk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mabinogiysk/subscriptions", "organizations_url": "https://api.github.com/users/Mabinogiysk/orgs", "repos_url": "https://api.github.com/users/Mabinogiysk/repos", "events_url": "https://api.github.com/users/Mabinogiysk/events{/privacy}", "received_events_url": "https://api.github.com/users/Mabinogiysk/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 18, "created_at": "2018-07-03T06:32:33Z", "updated_at": "2018-11-19T11:57:16Z", "closed_at": "2018-08-13T17:34:06Z", "author_association": "NONE", "body_html": "<h2>Issue description</h2>\n<p>I found someone had reported this error and could not reproduce it. However I always get this error during my training. When I get this error, the code is still running, so I  continue  to get this problem. It seems that it has no effect on training.</p>\n<h2>Code example</h2>\n<pre><code>train_dataset = lmdbDataset(root=opt.trainroot, transform=resizeNormalize(size=(592, 32)))\ntrain_loader = torch.utils.data.DataLoader(\n    train_dataset, batch_size=opt.batchSize,\n    shuffle=True, sampler=None,\n    num_workers=int(opt.workers),\n    collate_fn=alignCollate())\ntrain_iter = iter(train_loader)\ncpu_images, cpu_texts, cpu_lengths = next(train_iter)\n</code></pre>\n<p>ERROR message:</p>\n<pre><code>ConnectionResetError: [Errno 104] Connection reset by peer\nException ignored in: &lt;bound method _DataLoaderIter.__del__ of &lt;torch.utils.data.dataloader._DataLoaderIter object at 0x7fec6928a9b0&gt;&gt;\nTraceback (most recent call last):\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 349, in __del__\n                         self._shutdown_workers()\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 328, in _shutdown_workers\n                         self.worker_result_queue.get()\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/queues.py\", line 337, in get\n  turn _ForkingPickler.loads(res)\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/multiprocessing/reductions.py\", line 70, in rebuild_storage_fd\n                         fd = df.detach()\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/resource_sharer.py\", line 58, in detach\n  turn reduction.recv_handle(conn)\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 182, in recv_handle\n  turn recvfds(s, 1)[0]\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 155, in recvfds\nraise EOFError\nEOFError:\nTraceback (most recent call last):\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 349, in __del__\n    self._shutdown_workers()\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 328, in _shutdown_workers\n    self.worker_result_queue.get()\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/queues.py\", line 337, in get  \n    return _ForkingPickler.loads(res)\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/multiprocessing/reductions.py\", line 70, in rebuild_storage_fd\n    fd = df.detach()\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/resource_sharer.py\", line 58, in detach\n    return reduction.recv_handle(conn)\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 182, in recv_handle\n    return recvfds(s, 1)[0]\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 155, in recvfds\n    raise EOFError\nEOFError:\n    chunk = read(handle, remaining)\nConnectionResetError: [Errno 104] Connection reset by peer\nException ignored in: &lt;bound method _DataLoaderIter.__del__ of &lt;torch.utils.data.dataloader._DataLoaderIter object at 0x7fec6928a9b0&gt;&gt;\nTraceback (most recent call last):\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 349, in __del__\n    self._shutdown_workers()\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 328, in _shutdown_workers\n    self.worker_result_queue.get()\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/queues.py\", line 337, in get\n    return _ForkingPickler.loads(res)\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/multiprocessing/reductions.py\", line 70, in rebuild_storage_fd\n    fd = df.detach()\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/resource_sharer.py\", line 58, in detach\n    return reduction.recv_handle(conn)\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 182, in recv_handle\n    return recvfds(s, 1)[0]\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 155, in recvfds\n    raise EOFError\nEOFError:\n    chunk = read(handle, remaining)\nConnectionResetError: [Errno 104] Connection reset by peer\nException ignored in: &lt;bound method _DataLoaderIter.__del__ of &lt;torch.utils.data.dataloader._DataLoaderIter object at 0x7fec6928a9b0&gt;&gt;\nTraceback (most recent call last):\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 349, in __del__\n                         self._shutdown_workers()\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 328, in _shutdown_workers\n                         self.worker_result_queue.get()\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/queues.py\", line 337, in get\n  turn _ForkingPickler.loads(res)\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/multiprocessing/reductions.py\", line 70, in rebuild_storage_fd\n                         fd = df.detach()\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/resource_sharer.py\", line 58, in detach\n  turn reduction.recv_handle(conn)\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 182, in recv_handle\n  turn recvfds(s, 1)[0]\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 155, in recvfds\nraise EOFError\nEOFError:\n</code></pre>\n<h2>System Info</h2>\n<ul>\n<li>PyTorch or Caffe2: Pytorch</li>\n<li>How you installed PyTorch (conda, pip, source): pip</li>\n<li>Build command you used (if compiling from source):</li>\n<li>OS: centos 7</li>\n<li>PyTorch version: 0.4.0</li>\n<li>Python version: 3.6</li>\n<li>CUDA/cuDNN version: cuda9.0/cudnn7.0</li>\n</ul>", "body_text": "Issue description\nI found someone had reported this error and could not reproduce it. However I always get this error during my training. When I get this error, the code is still running, so I  continue  to get this problem. It seems that it has no effect on training.\nCode example\ntrain_dataset = lmdbDataset(root=opt.trainroot, transform=resizeNormalize(size=(592, 32)))\ntrain_loader = torch.utils.data.DataLoader(\n    train_dataset, batch_size=opt.batchSize,\n    shuffle=True, sampler=None,\n    num_workers=int(opt.workers),\n    collate_fn=alignCollate())\ntrain_iter = iter(train_loader)\ncpu_images, cpu_texts, cpu_lengths = next(train_iter)\n\nERROR message:\nConnectionResetError: [Errno 104] Connection reset by peer\nException ignored in: <bound method _DataLoaderIter.__del__ of <torch.utils.data.dataloader._DataLoaderIter object at 0x7fec6928a9b0>>\nTraceback (most recent call last):\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 349, in __del__\n                         self._shutdown_workers()\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 328, in _shutdown_workers\n                         self.worker_result_queue.get()\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/queues.py\", line 337, in get\n  turn _ForkingPickler.loads(res)\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/multiprocessing/reductions.py\", line 70, in rebuild_storage_fd\n                         fd = df.detach()\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/resource_sharer.py\", line 58, in detach\n  turn reduction.recv_handle(conn)\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 182, in recv_handle\n  turn recvfds(s, 1)[0]\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 155, in recvfds\nraise EOFError\nEOFError:\nTraceback (most recent call last):\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 349, in __del__\n    self._shutdown_workers()\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 328, in _shutdown_workers\n    self.worker_result_queue.get()\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/queues.py\", line 337, in get  \n    return _ForkingPickler.loads(res)\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/multiprocessing/reductions.py\", line 70, in rebuild_storage_fd\n    fd = df.detach()\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/resource_sharer.py\", line 58, in detach\n    return reduction.recv_handle(conn)\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 182, in recv_handle\n    return recvfds(s, 1)[0]\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 155, in recvfds\n    raise EOFError\nEOFError:\n    chunk = read(handle, remaining)\nConnectionResetError: [Errno 104] Connection reset by peer\nException ignored in: <bound method _DataLoaderIter.__del__ of <torch.utils.data.dataloader._DataLoaderIter object at 0x7fec6928a9b0>>\nTraceback (most recent call last):\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 349, in __del__\n    self._shutdown_workers()\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 328, in _shutdown_workers\n    self.worker_result_queue.get()\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/queues.py\", line 337, in get\n    return _ForkingPickler.loads(res)\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/multiprocessing/reductions.py\", line 70, in rebuild_storage_fd\n    fd = df.detach()\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/resource_sharer.py\", line 58, in detach\n    return reduction.recv_handle(conn)\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 182, in recv_handle\n    return recvfds(s, 1)[0]\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 155, in recvfds\n    raise EOFError\nEOFError:\n    chunk = read(handle, remaining)\nConnectionResetError: [Errno 104] Connection reset by peer\nException ignored in: <bound method _DataLoaderIter.__del__ of <torch.utils.data.dataloader._DataLoaderIter object at 0x7fec6928a9b0>>\nTraceback (most recent call last):\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 349, in __del__\n                         self._shutdown_workers()\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 328, in _shutdown_workers\n                         self.worker_result_queue.get()\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/queues.py\", line 337, in get\n  turn _ForkingPickler.loads(res)\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/multiprocessing/reductions.py\", line 70, in rebuild_storage_fd\n                         fd = df.detach()\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/resource_sharer.py\", line 58, in detach\n  turn reduction.recv_handle(conn)\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 182, in recv_handle\n  turn recvfds(s, 1)[0]\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 155, in recvfds\nraise EOFError\nEOFError:\n\nSystem Info\n\nPyTorch or Caffe2: Pytorch\nHow you installed PyTorch (conda, pip, source): pip\nBuild command you used (if compiling from source):\nOS: centos 7\nPyTorch version: 0.4.0\nPython version: 3.6\nCUDA/cuDNN version: cuda9.0/cudnn7.0", "body": "## Issue description\r\nI found someone had reported this error and could not reproduce it. However I always get this error during my training. When I get this error, the code is still running, so I  continue  to get this problem. It seems that it has no effect on training.\r\n\r\n\r\n## Code example\r\n```\r\ntrain_dataset = lmdbDataset(root=opt.trainroot, transform=resizeNormalize(size=(592, 32)))\r\ntrain_loader = torch.utils.data.DataLoader(\r\n    train_dataset, batch_size=opt.batchSize,\r\n    shuffle=True, sampler=None,\r\n    num_workers=int(opt.workers),\r\n    collate_fn=alignCollate())\r\ntrain_iter = iter(train_loader)\r\ncpu_images, cpu_texts, cpu_lengths = next(train_iter)\r\n```\r\nERROR message:\r\n```\r\nConnectionResetError: [Errno 104] Connection reset by peer\r\nException ignored in: <bound method _DataLoaderIter.__del__ of <torch.utils.data.dataloader._DataLoaderIter object at 0x7fec6928a9b0>>\r\nTraceback (most recent call last):\r\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 349, in __del__\r\n                         self._shutdown_workers()\r\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 328, in _shutdown_workers\r\n                         self.worker_result_queue.get()\r\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/queues.py\", line 337, in get\r\n  turn _ForkingPickler.loads(res)\r\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/multiprocessing/reductions.py\", line 70, in rebuild_storage_fd\r\n                         fd = df.detach()\r\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/resource_sharer.py\", line 58, in detach\r\n  turn reduction.recv_handle(conn)\r\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 182, in recv_handle\r\n  turn recvfds(s, 1)[0]\r\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 155, in recvfds\r\nraise EOFError\r\nEOFError:\r\nTraceback (most recent call last):\r\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 349, in __del__\r\n    self._shutdown_workers()\r\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 328, in _shutdown_workers\r\n    self.worker_result_queue.get()\r\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/queues.py\", line 337, in get  \r\n    return _ForkingPickler.loads(res)\r\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/multiprocessing/reductions.py\", line 70, in rebuild_storage_fd\r\n    fd = df.detach()\r\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/resource_sharer.py\", line 58, in detach\r\n    return reduction.recv_handle(conn)\r\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 182, in recv_handle\r\n    return recvfds(s, 1)[0]\r\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 155, in recvfds\r\n    raise EOFError\r\nEOFError:\r\n    chunk = read(handle, remaining)\r\nConnectionResetError: [Errno 104] Connection reset by peer\r\nException ignored in: <bound method _DataLoaderIter.__del__ of <torch.utils.data.dataloader._DataLoaderIter object at 0x7fec6928a9b0>>\r\nTraceback (most recent call last):\r\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 349, in __del__\r\n    self._shutdown_workers()\r\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 328, in _shutdown_workers\r\n    self.worker_result_queue.get()\r\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/queues.py\", line 337, in get\r\n    return _ForkingPickler.loads(res)\r\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/multiprocessing/reductions.py\", line 70, in rebuild_storage_fd\r\n    fd = df.detach()\r\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/resource_sharer.py\", line 58, in detach\r\n    return reduction.recv_handle(conn)\r\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 182, in recv_handle\r\n    return recvfds(s, 1)[0]\r\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 155, in recvfds\r\n    raise EOFError\r\nEOFError:\r\n    chunk = read(handle, remaining)\r\nConnectionResetError: [Errno 104] Connection reset by peer\r\nException ignored in: <bound method _DataLoaderIter.__del__ of <torch.utils.data.dataloader._DataLoaderIter object at 0x7fec6928a9b0>>\r\nTraceback (most recent call last):\r\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 349, in __del__\r\n                         self._shutdown_workers()\r\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 328, in _shutdown_workers\r\n                         self.worker_result_queue.get()\r\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/queues.py\", line 337, in get\r\n  turn _ForkingPickler.loads(res)\r\n  File \"/root/anaconda3/lib/python3.6/site-packages/torch/multiprocessing/reductions.py\", line 70, in rebuild_storage_fd\r\n                         fd = df.detach()\r\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/resource_sharer.py\", line 58, in detach\r\n  turn reduction.recv_handle(conn)\r\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 182, in recv_handle\r\n  turn recvfds(s, 1)[0]\r\n  File \"/root/anaconda3/lib/python3.6/multiprocessing/reduction.py\", line 155, in recvfds\r\nraise EOFError\r\nEOFError:\r\n```\r\n\r\n## System Info\r\n- PyTorch or Caffe2: Pytorch\r\n- How you installed PyTorch (conda, pip, source): pip\r\n- Build command you used (if compiling from source):\r\n- OS: centos 7\r\n- PyTorch version: 0.4.0\r\n- Python version: 3.6\r\n- CUDA/cuDNN version: cuda9.0/cudnn7.0\r\n"}