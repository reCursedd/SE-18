{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/235213699", "pull_request_review_id": 177029018, "id": 235213699, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNTIxMzY5OQ==", "diff_hunk": "@@ -2280,12 +2280,12 @@ def remap_input(op, blob_name_remapping):\n \n def copy_func_between_devices(src, dst):\n     CPU = caffe2_pb2.CPU\n-    CUDA = caffe2_pb2.CUDA\n+    GPU = workspace.GpuDeviceType\n \n     if src.device_type == CPU and dst.device_type == CPU:\n         return None\n \n-    if src.device_type == CUDA and dst.device_type == CUDA:", "path": "caffe2/python/core.py", "position": 31, "original_position": 19, "commit_id": "48f6e87dff2a7c386fbb8b99f9ae313aa4822717", "original_commit_id": "a5aad5bdc5a895bd89bbe6494a2bd837d2ae1780", "user": {"login": "bddppq", "id": 9300575, "node_id": "MDQ6VXNlcjkzMDA1NzU=", "avatar_url": "https://avatars2.githubusercontent.com/u/9300575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bddppq", "html_url": "https://github.com/bddppq", "followers_url": "https://api.github.com/users/bddppq/followers", "following_url": "https://api.github.com/users/bddppq/following{/other_user}", "gists_url": "https://api.github.com/users/bddppq/gists{/gist_id}", "starred_url": "https://api.github.com/users/bddppq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bddppq/subscriptions", "organizations_url": "https://api.github.com/users/bddppq/orgs", "repos_url": "https://api.github.com/users/bddppq/repos", "events_url": "https://api.github.com/users/bddppq/events{/privacy}", "received_events_url": "https://api.github.com/users/bddppq/received_events", "type": "User", "site_admin": false}, "body": "I think here we should not compare to GpuDeviceType, because the logic of adding a Copy operator here is applicable as long as the src and dst are of the same gpu device type. I suggest let's add an util function IsGPUDeviceType:\r\n```\r\ndef IsGPUDeviceType(device_type):\r\n  return device_type in {caffe2_pb2.CUDA, caffe2_pb2.HIP}\r\n```\r\n\r\nand then change here to:\r\n```\r\nis_src_gpu = IsGPUDeviceType(src.device_type)\r\nis_dst_gpu = IsGPUDeviceType(dst.device_type)\r\nif is_src_gpu and is_dst_gpu:\r\n  ...\r\n```\r\n\r\n", "created_at": "2018-11-21T00:03:37Z", "updated_at": "2018-11-23T15:55:18Z", "html_url": "https://github.com/pytorch/pytorch/pull/14221#discussion_r235213699", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/14221", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/235213699"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/14221#discussion_r235213699"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/14221"}}, "body_html": "<p>I think here we should not compare to GpuDeviceType, because the logic of adding a Copy operator here is applicable as long as the src and dst are of the same gpu device type. I suggest let's add an util function IsGPUDeviceType:</p>\n<pre><code>def IsGPUDeviceType(device_type):\n  return device_type in {caffe2_pb2.CUDA, caffe2_pb2.HIP}\n</code></pre>\n<p>and then change here to:</p>\n<pre><code>is_src_gpu = IsGPUDeviceType(src.device_type)\nis_dst_gpu = IsGPUDeviceType(dst.device_type)\nif is_src_gpu and is_dst_gpu:\n  ...\n</code></pre>", "body_text": "I think here we should not compare to GpuDeviceType, because the logic of adding a Copy operator here is applicable as long as the src and dst are of the same gpu device type. I suggest let's add an util function IsGPUDeviceType:\ndef IsGPUDeviceType(device_type):\n  return device_type in {caffe2_pb2.CUDA, caffe2_pb2.HIP}\n\nand then change here to:\nis_src_gpu = IsGPUDeviceType(src.device_type)\nis_dst_gpu = IsGPUDeviceType(dst.device_type)\nif is_src_gpu and is_dst_gpu:\n  ..."}