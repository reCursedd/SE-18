{"url": "https://api.github.com/repos/pytorch/pytorch/issues/4374", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/4374/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/4374/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/4374/events", "html_url": "https://github.com/pytorch/pytorch/issues/4374", "id": 284841587, "node_id": "MDU6SXNzdWUyODQ4NDE1ODc=", "number": 4374, "title": "torch.matmul() wrong", "user": {"login": "leftthomas", "id": 9991443, "node_id": "MDQ6VXNlcjk5OTE0NDM=", "avatar_url": "https://avatars0.githubusercontent.com/u/9991443?v=4", "gravatar_id": "", "url": "https://api.github.com/users/leftthomas", "html_url": "https://github.com/leftthomas", "followers_url": "https://api.github.com/users/leftthomas/followers", "following_url": "https://api.github.com/users/leftthomas/following{/other_user}", "gists_url": "https://api.github.com/users/leftthomas/gists{/gist_id}", "starred_url": "https://api.github.com/users/leftthomas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/leftthomas/subscriptions", "organizations_url": "https://api.github.com/users/leftthomas/orgs", "repos_url": "https://api.github.com/users/leftthomas/repos", "events_url": "https://api.github.com/users/leftthomas/events{/privacy}", "received_events_url": "https://api.github.com/users/leftthomas/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-12-28T04:54:04Z", "updated_at": "2017-12-29T03:45:06Z", "closed_at": "2017-12-28T16:07:01Z", "author_association": "NONE", "body_html": "<p><code>a = torch.arange(1, 200*6*3+1).resize_(200, 6, 3)</code><br>\n<code>w = torch.arange(1, 4*6*10*3+1).resize_(4, 6, 10, 3)</code><br>\n<code>result = ((w.unsqueeze(dim=0)).matmul(a.unsqueeze(dim=-1).unsqueeze(dim=1))).squeeze(dim=-1)</code><br>\n<code>w2 = w.transpose(-1, -2)</code><br>\n<code>result2 =((a.unsqueeze(dim=-2).unsqueeze(dim=0)).matmul(w2.unsqueeze(dim=1))).squeeze(dim=-2).transpose(0, 1)</code><br>\n<code>print(torch.equal(result, result2))</code></p>\n<p>I have this code, it return \"True\", but if I change<br>\n<code>a = torch.arange(1, 200*6*3+1).resize_(200, 6, 3)</code><br>\n<code>w = torch.arange(1, 4*6*10*3+1).resize_(4, 6, 10, 3)</code><br>\nto<br>\n<code>a = torch.arange(1, 2000*6*3+1).resize_(2000, 6, 3)</code><br>\n<code>w = torch.arange(1, 4*6*10*3+1).resize_(4, 6, 10, 3)</code>,<br>\nit return \"False\". Why this happen?</p>", "body_text": "a = torch.arange(1, 200*6*3+1).resize_(200, 6, 3)\nw = torch.arange(1, 4*6*10*3+1).resize_(4, 6, 10, 3)\nresult = ((w.unsqueeze(dim=0)).matmul(a.unsqueeze(dim=-1).unsqueeze(dim=1))).squeeze(dim=-1)\nw2 = w.transpose(-1, -2)\nresult2 =((a.unsqueeze(dim=-2).unsqueeze(dim=0)).matmul(w2.unsqueeze(dim=1))).squeeze(dim=-2).transpose(0, 1)\nprint(torch.equal(result, result2))\nI have this code, it return \"True\", but if I change\na = torch.arange(1, 200*6*3+1).resize_(200, 6, 3)\nw = torch.arange(1, 4*6*10*3+1).resize_(4, 6, 10, 3)\nto\na = torch.arange(1, 2000*6*3+1).resize_(2000, 6, 3)\nw = torch.arange(1, 4*6*10*3+1).resize_(4, 6, 10, 3),\nit return \"False\". Why this happen?", "body": "`a = torch.arange(1, 200*6*3+1).resize_(200, 6, 3)`\r\n`w = torch.arange(1, 4*6*10*3+1).resize_(4, 6, 10, 3)`\r\n`result = ((w.unsqueeze(dim=0)).matmul(a.unsqueeze(dim=-1).unsqueeze(dim=1))).squeeze(dim=-1)`\r\n`w2 = w.transpose(-1, -2)`\r\n`result2 =((a.unsqueeze(dim=-2).unsqueeze(dim=0)).matmul(w2.unsqueeze(dim=1))).squeeze(dim=-2).transpose(0, 1)`\r\n`print(torch.equal(result, result2))`\r\n\r\nI have this code, it return \"True\", but if I change \r\n`a = torch.arange(1, 200*6*3+1).resize_(200, 6, 3)`\r\n`w = torch.arange(1, 4*6*10*3+1).resize_(4, 6, 10, 3)` \r\nto \r\n`a = torch.arange(1, 2000*6*3+1).resize_(2000, 6, 3)`\r\n`w = torch.arange(1, 4*6*10*3+1).resize_(4, 6, 10, 3)`, \r\nit return \"False\". Why this happen?"}