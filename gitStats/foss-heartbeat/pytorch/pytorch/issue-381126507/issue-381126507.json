{"url": "https://api.github.com/repos/pytorch/pytorch/issues/14027", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/14027/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/14027/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/14027/events", "html_url": "https://github.com/pytorch/pytorch/issues/14027", "id": 381126507, "node_id": "MDU6SXNzdWUzODExMjY1MDc=", "number": 14027, "title": "using batchnorm2d, torchscript network output differently with original network when change to eval mode", "user": {"login": "liuhuaiyu", "id": 17059613, "node_id": "MDQ6VXNlcjE3MDU5NjEz", "avatar_url": "https://avatars3.githubusercontent.com/u/17059613?v=4", "gravatar_id": "", "url": "https://api.github.com/users/liuhuaiyu", "html_url": "https://github.com/liuhuaiyu", "followers_url": "https://api.github.com/users/liuhuaiyu/followers", "following_url": "https://api.github.com/users/liuhuaiyu/following{/other_user}", "gists_url": "https://api.github.com/users/liuhuaiyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/liuhuaiyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/liuhuaiyu/subscriptions", "organizations_url": "https://api.github.com/users/liuhuaiyu/orgs", "repos_url": "https://api.github.com/users/liuhuaiyu/repos", "events_url": "https://api.github.com/users/liuhuaiyu/events{/privacy}", "received_events_url": "https://api.github.com/users/liuhuaiyu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 679953983, "node_id": "MDU6TGFiZWw2Nzk5NTM5ODM=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/jit", "name": "jit", "color": "c5def5", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-11-15T11:50:37Z", "updated_at": "2018-11-19T18:47:22Z", "closed_at": null, "author_association": "NONE", "body_html": "<h2><g-emoji class=\"g-emoji\" alias=\"bug\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f41b.png\">\ud83d\udc1b</g-emoji> Bug</h2>\n\n<h2>To Reproduce</h2>\n<p>I used <code>BatchNorm2d()</code> in the network (<strong>repo is below</strong>), and converted it to TorchScript version.<br>\nWhen give the same input, the output is different when changed original network to eval mode. (there's no <code>dropout</code>)<br>\nExample results are bellow (compare MSE between 2 output):</p>\n<p><code>default train vs torch_script train:</code><br>\n<code>tensor(0., grad_fn=&lt;PowBackward0&gt;)</code><br>\n<code>default eval vs torch_script eval:</code><br>\n<code>tensor(56.4769, grad_fn=&lt;PowBackward0&gt;)</code><br>\n<code>default train vs torch_script eval:</code><br>\n<code>tensor(0., grad_fn=&lt;PowBackward0&gt;)</code><br>\n<code>default eval vs torch_script train:</code><br>\n<code>tensor(56.4769, grad_fn=&lt;PowBackward0&gt;)</code></p>\n\n<h2>Expected behavior</h2>\n\n<h2>Environment</h2>\n<p>You can get the script and run it with:</p>\n<pre><code>https://github.com/liuhuaiyu/PyTorch-Issue\npython why_bn.py\n</code></pre>\n<ul>\n<li>PyTorch Version (preview):</li>\n<li>OS (Ubuntu 16.04):</li>\n<li>How you installed PyTorch ( <code>pip</code>):</li>\n<li>Python version: 2.7</li>\n</ul>\n<h2>Additional context</h2>\n", "body_text": "\ud83d\udc1b Bug\n\nTo Reproduce\nI used BatchNorm2d() in the network (repo is below), and converted it to TorchScript version.\nWhen give the same input, the output is different when changed original network to eval mode. (there's no dropout)\nExample results are bellow (compare MSE between 2 output):\ndefault train vs torch_script train:\ntensor(0., grad_fn=<PowBackward0>)\ndefault eval vs torch_script eval:\ntensor(56.4769, grad_fn=<PowBackward0>)\ndefault train vs torch_script eval:\ntensor(0., grad_fn=<PowBackward0>)\ndefault eval vs torch_script train:\ntensor(56.4769, grad_fn=<PowBackward0>)\n\nExpected behavior\n\nEnvironment\nYou can get the script and run it with:\nhttps://github.com/liuhuaiyu/PyTorch-Issue\npython why_bn.py\n\n\nPyTorch Version (preview):\nOS (Ubuntu 16.04):\nHow you installed PyTorch ( pip):\nPython version: 2.7\n\nAdditional context", "body": "## \ud83d\udc1b Bug\r\n\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\n## To Reproduce\r\n\r\nI used `BatchNorm2d()` in the network (**repo is below**), and converted it to TorchScript version.\r\nWhen give the same input, the output is different when changed original network to eval mode. (there's no `dropout`)\r\nExample results are bellow (compare MSE between 2 output):\r\n\r\n`default train vs torch_script train:`\r\n`tensor(0., grad_fn=<PowBackward0>)`\r\n`default eval vs torch_script eval:`\r\n`tensor(56.4769, grad_fn=<PowBackward0>)`\r\n`default train vs torch_script eval:`\r\n`tensor(0., grad_fn=<PowBackward0>)`\r\n`default eval vs torch_script train:`\r\n`tensor(56.4769, grad_fn=<PowBackward0>)`\r\n\r\n\r\n<!-- If you have a code sample, error messages, stack traces, please provide it here as well -->\r\n\r\n## Expected behavior\r\n\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\n## Environment\r\nYou can get the script and run it with:\r\n```\r\nhttps://github.com/liuhuaiyu/PyTorch-Issue\r\npython why_bn.py\r\n```\r\n\r\n - PyTorch Version (preview):\r\n - OS (Ubuntu 16.04):\r\n - How you installed PyTorch ( `pip`):\r\n - Python version: 2.7\r\n\r\n## Additional context\r\n\r\n<!-- Add any other context about the problem here. -->\r\n"}