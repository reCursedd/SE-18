{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/208400973", "pull_request_review_id": 144201841, "id": 208400973, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwODQwMDk3Mw==", "diff_hunk": "@@ -72,6 +78,107 @@ static void applyGesv(Tensor& b, Tensor& A, std::vector<int64_t> infos) {\n   }\n }\n \n+std::tuple<Tensor&,Tensor&> _gesv_single_out_cpu(\n+    Tensor& sol, Tensor& lu,\n+    const Tensor& self, const Tensor& A) {\n+#ifndef USE_LAPACK\n+  AT_ERROR(\"gesv: LAPACK library not found in compilation\");\n+#endif\n+  int64_t bx = self.size(0);\n+  int64_t by = (self.dim() == 1) ? 1 : self.size(1);\n+  int64_t ax = A.size(0);\n+  int64_t ay = A.size(1);\n+  int info = 0;\n+  Tensor temp_sol;\n+  Tensor temp_lu;\n+\n+  /* Init to column major format. `sol` and `lu` need to be contiguous\n+   * since we pass sol.data() and lu.data() to Lapack */\n+  bool tc_sol = isTransposeContiguous(sol);\n+  auto self_t = self.view({bx, by}).t();\n+  if (!tc_sol &&\n+      !sol.is_contiguous() &&\n+      sol.dim() == 2 &&\n+      sol.size(0) == bx &&\n+      sol.size(1) == by) {\n+    // eg. torch.gesv(.., out=(n[::2], ...))\n+    temp_sol = self_t.clone();\n+  }\n+\n+  if (!temp_sol.defined()) {\n+    if (tc_sol) {\n+      sol.t().resize_({by, bx});\n+    } else {\n+      sol.resize_({by, bx});\n+    }\n+    if (&self == &sol) {\n+      // note: not a comprehensive check. Will fail for views\n+      if (!tc_sol) {\n+        sol.copy_(self_t.clone());\n+      }\n+    } else {\n+      if (tc_sol) {\n+        sol.t().copy_(self_t);\n+      } else {\n+        sol.copy_(self_t);\n+      }\n+    }\n+  }", "path": "aten/src/ATen/native/Gesv.cpp", "position": null, "original_position": 71, "commit_id": "6c573ec2fe05deacdb8541c2229f21fa51d96e30", "original_commit_id": "2a3644b8476df19d674a3982c37e918cdc61c89a", "user": {"login": "SsnL", "id": 5674597, "node_id": "MDQ6VXNlcjU2NzQ1OTc=", "avatar_url": "https://avatars2.githubusercontent.com/u/5674597?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SsnL", "html_url": "https://github.com/SsnL", "followers_url": "https://api.github.com/users/SsnL/followers", "following_url": "https://api.github.com/users/SsnL/following{/other_user}", "gists_url": "https://api.github.com/users/SsnL/gists{/gist_id}", "starred_url": "https://api.github.com/users/SsnL/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SsnL/subscriptions", "organizations_url": "https://api.github.com/users/SsnL/orgs", "repos_url": "https://api.github.com/users/SsnL/repos", "events_url": "https://api.github.com/users/SsnL/events{/privacy}", "received_events_url": "https://api.github.com/users/SsnL/received_events", "type": "User", "site_admin": false}, "body": "I'm very confused. At this point, should `sol` be transposed or not? They kind of make sense to me but I am still not sure if they are correct, because so many things are controlled by `tc_sol` being `true` or `false` that it is difficult to keep track.\r\n\r\nI think it would be better to make the code clearer. It would be better for future maintenance too. Can you write these if statements so that they are\r\n```\r\nif (tc_sol) {\r\n  // everything up till here...\r\n} else {\r\n  // everything up till here...\r\n}\r\n```\r\nor write out your strategy clearly in a comment block. Thanks.", "created_at": "2018-08-07T22:07:51Z", "updated_at": "2018-11-23T15:48:58Z", "html_url": "https://github.com/pytorch/pytorch/pull/9742#discussion_r208400973", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/9742", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/208400973"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/9742#discussion_r208400973"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/9742"}}, "body_html": "<p>I'm very confused. At this point, should <code>sol</code> be transposed or not? They kind of make sense to me but I am still not sure if they are correct, because so many things are controlled by <code>tc_sol</code> being <code>true</code> or <code>false</code> that it is difficult to keep track.</p>\n<p>I think it would be better to make the code clearer. It would be better for future maintenance too. Can you write these if statements so that they are</p>\n<pre><code>if (tc_sol) {\n  // everything up till here...\n} else {\n  // everything up till here...\n}\n</code></pre>\n<p>or write out your strategy clearly in a comment block. Thanks.</p>", "body_text": "I'm very confused. At this point, should sol be transposed or not? They kind of make sense to me but I am still not sure if they are correct, because so many things are controlled by tc_sol being true or false that it is difficult to keep track.\nI think it would be better to make the code clearer. It would be better for future maintenance too. Can you write these if statements so that they are\nif (tc_sol) {\n  // everything up till here...\n} else {\n  // everything up till here...\n}\n\nor write out your strategy clearly in a comment block. Thanks."}