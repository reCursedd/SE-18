{"url": "https://api.github.com/repos/pytorch/pytorch/issues/8874", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/8874/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/8874/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/8874/events", "html_url": "https://github.com/pytorch/pytorch/issues/8874", "id": 335589118, "node_id": "MDU6SXNzdWUzMzU1ODkxMTg=", "number": 8874, "title": "Issues with dynamically created grad_fn for views", "user": {"login": "SsnL", "id": 5674597, "node_id": "MDQ6VXNlcjU2NzQ1OTc=", "avatar_url": "https://avatars2.githubusercontent.com/u/5674597?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SsnL", "html_url": "https://github.com/SsnL", "followers_url": "https://api.github.com/users/SsnL/followers", "following_url": "https://api.github.com/users/SsnL/following{/other_user}", "gists_url": "https://api.github.com/users/SsnL/gists{/gist_id}", "starred_url": "https://api.github.com/users/SsnL/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SsnL/subscriptions", "organizations_url": "https://api.github.com/users/SsnL/orgs", "repos_url": "https://api.github.com/users/SsnL/repos", "events_url": "https://api.github.com/users/SsnL/events{/privacy}", "received_events_url": "https://api.github.com/users/SsnL/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-06-25T22:22:41Z", "updated_at": "2018-06-25T22:22:41Z", "closed_at": null, "author_association": "CONTRIBUTOR", "body_html": "<p>Currently the dynamically created <code>grad_fn</code> to point to <code>base</code>. When a view is created via</p>\n<div class=\"highlight highlight-source-python\"><pre>base <span class=\"pl-k\">=</span> torch.randn(<span class=\"pl-c1\">3</span>, <span class=\"pl-v\">requires_grad</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>)\nview1 <span class=\"pl-k\">=</span> base[:<span class=\"pl-c1\">2</span>]\nmy_view <span class=\"pl-k\">=</span> view1[:]</pre></div>\n<p>Then, if <code>base</code> is modified in-place, the <code>grad_fn</code> of <code>my_view</code> will be created to just point to <code>base</code>. Then the <code>retain_grad</code> and backward hooks on <code>view1</code> will be wrong.</p>\n<p>E.g.,</p>\n<div class=\"highlight highlight-source-python\"><pre>x <span class=\"pl-k\">=</span> torch.ones(<span class=\"pl-c1\">4</span>, <span class=\"pl-v\">requires_grad</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>).clone()\nxx <span class=\"pl-k\">=</span> x[<span class=\"pl-c1\">2</span>:]\ny <span class=\"pl-k\">=</span> xx[<span class=\"pl-c1\">1</span>]\nxx.retain_grad()\n<span class=\"pl-c\"><span class=\"pl-c\">#</span>x[0] += 0</span>\ny.backward()\nxx.grad</pre></div>\n<p>(Un)comment the line <code>x[0] += 0</code> changes the grad of <code>xx</code>.</p>\n<p>This was previously reported at <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"333444200\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/8626\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/8626/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/8626\">#8626</a> , but that also describes another unrelated (now solved) issue. So I'm opening a new one to track this.</p>", "body_text": "Currently the dynamically created grad_fn to point to base. When a view is created via\nbase = torch.randn(3, requires_grad=True)\nview1 = base[:2]\nmy_view = view1[:]\nThen, if base is modified in-place, the grad_fn of my_view will be created to just point to base. Then the retain_grad and backward hooks on view1 will be wrong.\nE.g.,\nx = torch.ones(4, requires_grad=True).clone()\nxx = x[2:]\ny = xx[1]\nxx.retain_grad()\n#x[0] += 0\ny.backward()\nxx.grad\n(Un)comment the line x[0] += 0 changes the grad of xx.\nThis was previously reported at #8626 , but that also describes another unrelated (now solved) issue. So I'm opening a new one to track this.", "body": "Currently the dynamically created `grad_fn` to point to `base`. When a view is created via \r\n```py\r\nbase = torch.randn(3, requires_grad=True)\r\nview1 = base[:2]\r\nmy_view = view1[:]\r\n```\r\nThen, if `base` is modified in-place, the `grad_fn` of `my_view` will be created to just point to `base`. Then the `retain_grad` and backward hooks on `view1` will be wrong.\r\n\r\nE.g.,\r\n```py\r\nx = torch.ones(4, requires_grad=True).clone()\r\nxx = x[2:]\r\ny = xx[1]\r\nxx.retain_grad()\r\n#x[0] += 0\r\ny.backward()\r\nxx.grad\r\n```\r\n\r\n(Un)comment the line `x[0] += 0` changes the grad of `xx`.\r\n\r\nThis was previously reported at #8626 , but that also describes another unrelated (now solved) issue. So I'm opening a new one to track this."}