{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/384793235", "html_url": "https://github.com/pytorch/pytorch/pull/6554#issuecomment-384793235", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/6554", "id": 384793235, "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDc5MzIzNQ==", "user": {"login": "anderspapitto", "id": 1388690, "node_id": "MDQ6VXNlcjEzODg2OTA=", "avatar_url": "https://avatars3.githubusercontent.com/u/1388690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anderspapitto", "html_url": "https://github.com/anderspapitto", "followers_url": "https://api.github.com/users/anderspapitto/followers", "following_url": "https://api.github.com/users/anderspapitto/following{/other_user}", "gists_url": "https://api.github.com/users/anderspapitto/gists{/gist_id}", "starred_url": "https://api.github.com/users/anderspapitto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anderspapitto/subscriptions", "organizations_url": "https://api.github.com/users/anderspapitto/orgs", "repos_url": "https://api.github.com/users/anderspapitto/repos", "events_url": "https://api.github.com/users/anderspapitto/events{/privacy}", "received_events_url": "https://api.github.com/users/anderspapitto/received_events", "type": "User", "site_admin": false}, "created_at": "2018-04-26T21:23:11Z", "updated_at": "2018-04-26T21:23:11Z", "author_association": "MEMBER", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4583066\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/apaszke\">@apaszke</a> so, I have no idea why that crazy error shows up, but I can reproduce this locally, and it looks like a legit issue with a much clearer message.</p>\n<pre><code>(venv)[andersj@devgpu201.prn2 ~/local/onnx-fb-universe] python test/test_caffe2 TestCaffe2BackendEmbed.test_alexnet\npython: can't open file 'test/test_caffe2': [Errno 2] No such file or directory\n(venv)[andersj@devgpu201.prn2 ~/local/onnx-fb-universe] python test/test_caffe2.py TestCaffe2BackendEmbed.test_alexnet\n/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/utils.py:401: UserWarning: ONNX export failed on ATen operator size because torch.onnx.symbolic.size does not exist\n  .format(op_name, op_name))\n/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/utils.py:401: UserWarning: ONNX export failed on ATen operator stack because torch.onnx.symbolic.stack does not exi\nst\n  .format(op_name, op_name))\nE\n======================================================================\nERROR: test_alexnet (__main__.TestCaffe2BackendEmbed)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"test/test_caffe2.py\", line 340, in test_alexnet\n    state_dict=state_dict, atol=1e-3)\n  File \"test/test_caffe2.py\", line 181, in run_model_test\n    use_gpu=use_gpu_, rtol=rtol, atol=atol)\n  File \"test/test_caffe2.py\", line 174, in run_actual_test\n    verify.verify(model, input, c2, rtol=rtol, atol=atol)\n  File \"/data/users/andersj/onnx-fb-universe/test/verify.py\", line 355, in verify\n    torch_out = torch.onnx._export(model, args, proto_bytes, verbose=verbose)\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/__init__.py\", line 20, in _export\n    return utils._export(*args, **kwargs)\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/utils.py\", line 184, in _export\n    output_names, aten)\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/utils.py\", line 157, in _model_to_graph\n    graph = _optimize_graph(graph, aten)\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/utils.py\", line 95, in _optimize_graph\n    graph = torch._C._jit_pass_onnx(graph, aten)\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/__init__.py\", line 45, in _run_symbolic_function\n    return utils._run_symbolic_function(*args, **kwargs)\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/utils.py\", line 404, in _run_symbolic_function\n    return fn(g, *inputs, **attrs)\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/symbolic.py\", line 281, in view\n    if self_sizes and len(size) == 2 and self_sizes[0] == size[0]:\nTypeError: object of type 'torch._C.Value' has no len() (occurred when translating view)\n\n----------------------------------------------------------------------\nRan 1 test in 3.894s\n\nFAILED (errors=1)\n</code></pre>\n<p>so it's a failure in the symbolic_override for view(), which wants to inspect the actual dimensions in order to optimize the Reshape to a Flatten if possible - but this probably needs to be expressed differently or even doesn't make sense at all in light of all-sizes-are-tensors-under-tracing.</p>\n<p>Do you have a local setup with onnx installed? If so it should be straightforward to reproduce locally.</p>", "body_text": "@apaszke so, I have no idea why that crazy error shows up, but I can reproduce this locally, and it looks like a legit issue with a much clearer message.\n(venv)[andersj@devgpu201.prn2 ~/local/onnx-fb-universe] python test/test_caffe2 TestCaffe2BackendEmbed.test_alexnet\npython: can't open file 'test/test_caffe2': [Errno 2] No such file or directory\n(venv)[andersj@devgpu201.prn2 ~/local/onnx-fb-universe] python test/test_caffe2.py TestCaffe2BackendEmbed.test_alexnet\n/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/utils.py:401: UserWarning: ONNX export failed on ATen operator size because torch.onnx.symbolic.size does not exist\n  .format(op_name, op_name))\n/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/utils.py:401: UserWarning: ONNX export failed on ATen operator stack because torch.onnx.symbolic.stack does not exi\nst\n  .format(op_name, op_name))\nE\n======================================================================\nERROR: test_alexnet (__main__.TestCaffe2BackendEmbed)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"test/test_caffe2.py\", line 340, in test_alexnet\n    state_dict=state_dict, atol=1e-3)\n  File \"test/test_caffe2.py\", line 181, in run_model_test\n    use_gpu=use_gpu_, rtol=rtol, atol=atol)\n  File \"test/test_caffe2.py\", line 174, in run_actual_test\n    verify.verify(model, input, c2, rtol=rtol, atol=atol)\n  File \"/data/users/andersj/onnx-fb-universe/test/verify.py\", line 355, in verify\n    torch_out = torch.onnx._export(model, args, proto_bytes, verbose=verbose)\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/__init__.py\", line 20, in _export\n    return utils._export(*args, **kwargs)\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/utils.py\", line 184, in _export\n    output_names, aten)\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/utils.py\", line 157, in _model_to_graph\n    graph = _optimize_graph(graph, aten)\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/utils.py\", line 95, in _optimize_graph\n    graph = torch._C._jit_pass_onnx(graph, aten)\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/__init__.py\", line 45, in _run_symbolic_function\n    return utils._run_symbolic_function(*args, **kwargs)\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/utils.py\", line 404, in _run_symbolic_function\n    return fn(g, *inputs, **attrs)\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/symbolic.py\", line 281, in view\n    if self_sizes and len(size) == 2 and self_sizes[0] == size[0]:\nTypeError: object of type 'torch._C.Value' has no len() (occurred when translating view)\n\n----------------------------------------------------------------------\nRan 1 test in 3.894s\n\nFAILED (errors=1)\n\nso it's a failure in the symbolic_override for view(), which wants to inspect the actual dimensions in order to optimize the Reshape to a Flatten if possible - but this probably needs to be expressed differently or even doesn't make sense at all in light of all-sizes-are-tensors-under-tracing.\nDo you have a local setup with onnx installed? If so it should be straightforward to reproduce locally.", "body": "@apaszke so, I have no idea why that crazy error shows up, but I can reproduce this locally, and it looks like a legit issue with a much clearer message.\r\n\r\n```\r\n(venv)[andersj@devgpu201.prn2 ~/local/onnx-fb-universe] python test/test_caffe2 TestCaffe2BackendEmbed.test_alexnet\r\npython: can't open file 'test/test_caffe2': [Errno 2] No such file or directory\r\n(venv)[andersj@devgpu201.prn2 ~/local/onnx-fb-universe] python test/test_caffe2.py TestCaffe2BackendEmbed.test_alexnet\r\n/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/utils.py:401: UserWarning: ONNX export failed on ATen operator size because torch.onnx.symbolic.size does not exist\r\n  .format(op_name, op_name))\r\n/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/utils.py:401: UserWarning: ONNX export failed on ATen operator stack because torch.onnx.symbolic.stack does not exi\r\nst\r\n  .format(op_name, op_name))\r\nE\r\n======================================================================\r\nERROR: test_alexnet (__main__.TestCaffe2BackendEmbed)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"test/test_caffe2.py\", line 340, in test_alexnet\r\n    state_dict=state_dict, atol=1e-3)\r\n  File \"test/test_caffe2.py\", line 181, in run_model_test\r\n    use_gpu=use_gpu_, rtol=rtol, atol=atol)\r\n  File \"test/test_caffe2.py\", line 174, in run_actual_test\r\n    verify.verify(model, input, c2, rtol=rtol, atol=atol)\r\n  File \"/data/users/andersj/onnx-fb-universe/test/verify.py\", line 355, in verify\r\n    torch_out = torch.onnx._export(model, args, proto_bytes, verbose=verbose)\r\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/__init__.py\", line 20, in _export\r\n    return utils._export(*args, **kwargs)\r\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/utils.py\", line 184, in _export\r\n    output_names, aten)\r\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/utils.py\", line 157, in _model_to_graph\r\n    graph = _optimize_graph(graph, aten)\r\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/utils.py\", line 95, in _optimize_graph\r\n    graph = torch._C._jit_pass_onnx(graph, aten)\r\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/__init__.py\", line 45, in _run_symbolic_function\r\n    return utils._run_symbolic_function(*args, **kwargs)\r\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/utils.py\", line 404, in _run_symbolic_function\r\n    return fn(g, *inputs, **attrs)\r\n  File \"/data/users/andersj/onnx-fb-universe/repos/pytorch/torch/onnx/symbolic.py\", line 281, in view\r\n    if self_sizes and len(size) == 2 and self_sizes[0] == size[0]:\r\nTypeError: object of type 'torch._C.Value' has no len() (occurred when translating view)\r\n\r\n----------------------------------------------------------------------\r\nRan 1 test in 3.894s\r\n\r\nFAILED (errors=1)\r\n```\r\n\r\nso it's a failure in the symbolic_override for view(), which wants to inspect the actual dimensions in order to optimize the Reshape to a Flatten if possible - but this probably needs to be expressed differently or even doesn't make sense at all in light of all-sizes-are-tensors-under-tracing.\r\n\r\nDo you have a local setup with onnx installed? If so it should be straightforward to reproduce locally."}