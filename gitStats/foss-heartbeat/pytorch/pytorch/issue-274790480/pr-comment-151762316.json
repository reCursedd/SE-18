{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/151762316", "pull_request_review_id": 77528326, "id": 151762316, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1MTc2MjMxNg==", "diff_hunk": "@@ -397,16 +403,23 @@ def __missing__(self, key):\n def parse_cpu_trace(thread_records):\n     next_id = 0\n     start_record = None\n+    cuda_records = {}\n     functions = []\n     record_stack = []\n     string_table = StringTable()\n     # '__start_profile' is not guarenteed to be first, so we must find it here\n     for record in itertools.chain(*thread_records):\n         if record.name() == '__start_profile':\n             start_record = record\n-            break\n+        elif record.name() == '__cuda_start':\n+            cuda_records[record.device()] = record\n     assert start_record is not None\n \n+    # we don't know the correlation between CUDA/CPU time,\n+    # instead, we just make sure the corresponding cuda kernels are shifted\n+    # in time so they happen _after_ their CPU time, which is not\n+    # alway show they get recorded.\n+    max_shift = 0", "path": "torch/autograd/profiler.py", "position": null, "original_position": 97, "commit_id": "84c2e653ce154ea5b01797bed9dc4612266a6672", "original_commit_id": "ebf3f9336465b145e167dbf8419e5abe00583e64", "user": {"login": "zdevito", "id": 370202, "node_id": "MDQ6VXNlcjM3MDIwMg==", "avatar_url": "https://avatars0.githubusercontent.com/u/370202?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zdevito", "html_url": "https://github.com/zdevito", "followers_url": "https://api.github.com/users/zdevito/followers", "following_url": "https://api.github.com/users/zdevito/following{/other_user}", "gists_url": "https://api.github.com/users/zdevito/gists{/gist_id}", "starred_url": "https://api.github.com/users/zdevito/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zdevito/subscriptions", "organizations_url": "https://api.github.com/users/zdevito/orgs", "repos_url": "https://api.github.com/users/zdevito/repos", "events_url": "https://api.github.com/users/zdevito/events{/privacy}", "received_events_url": "https://api.github.com/users/zdevito/received_events", "type": "User", "site_admin": false}, "body": "Well I am already using it, and I think it is helpful. Not being able to align the timeline is annoying but I still get nice traces per-GPU. \r\n\r\nThis code simply provides  a global shift to all the cuda events so that they don't violate causality.\r\n\r\nThere is another clock sync problem where cuda events appear much later than they should due to some initialization problems I haven't been able to track down yet. As long as you make sure the device is already been used before profiling this part doesn't happen.", "created_at": "2017-11-17T18:53:48Z", "updated_at": "2018-11-23T15:36:39Z", "html_url": "https://github.com/pytorch/pytorch/pull/3754#discussion_r151762316", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/3754", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/151762316"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/3754#discussion_r151762316"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/3754"}}, "body_html": "<p>Well I am already using it, and I think it is helpful. Not being able to align the timeline is annoying but I still get nice traces per-GPU.</p>\n<p>This code simply provides  a global shift to all the cuda events so that they don't violate causality.</p>\n<p>There is another clock sync problem where cuda events appear much later than they should due to some initialization problems I haven't been able to track down yet. As long as you make sure the device is already been used before profiling this part doesn't happen.</p>", "body_text": "Well I am already using it, and I think it is helpful. Not being able to align the timeline is annoying but I still get nice traces per-GPU.\nThis code simply provides  a global shift to all the cuda events so that they don't violate causality.\nThere is another clock sync problem where cuda events appear much later than they should due to some initialization problems I haven't been able to track down yet. As long as you make sure the device is already been used before profiling this part doesn't happen.", "in_reply_to_id": 151659740}