{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/227647656", "pull_request_review_id": 167736189, "id": 227647656, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNzY0NzY1Ng==", "diff_hunk": "@@ -0,0 +1,318 @@\n+#pragma once\n+\n+#include <unordered_map>\n+\n+#include <ATen/core/Allocator.h>\n+\n+#include \"caffe2/proto/caffe2_pb.h\"\n+#include \"caffe2/proto/torch_pb.h\"\n+#include \"caffe2/serialize/inline_container.h\"\n+\n+namespace at {\n+\n+struct IntermediateDeviceOption {", "path": "caffe2/serialize/intermediate_model.h", "position": 59, "original_position": 13, "commit_id": "53180b449481169c2c2ff9e23ac18289412c62b3", "original_commit_id": "2c3ab75ce5e562993df90bc4b94a6d37d1b7f219", "user": {"login": "dzhulgakov", "id": 17890620, "node_id": "MDQ6VXNlcjE3ODkwNjIw", "avatar_url": "https://avatars2.githubusercontent.com/u/17890620?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dzhulgakov", "html_url": "https://github.com/dzhulgakov", "followers_url": "https://api.github.com/users/dzhulgakov/followers", "following_url": "https://api.github.com/users/dzhulgakov/following{/other_user}", "gists_url": "https://api.github.com/users/dzhulgakov/gists{/gist_id}", "starred_url": "https://api.github.com/users/dzhulgakov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dzhulgakov/subscriptions", "organizations_url": "https://api.github.com/users/dzhulgakov/orgs", "repos_url": "https://api.github.com/users/dzhulgakov/repos", "events_url": "https://api.github.com/users/dzhulgakov/events{/privacy}", "received_events_url": "https://api.github.com/users/dzhulgakov/received_events", "type": "User", "site_admin": false}, "body": "first.. you use it only in Tensor. If you actually check which fields would be later used it's actually only deviceType + deviceId - the rest are the artifact of reusing DeviceOption (what does random seed for tensor mean?). So we can probably nuke them from this struct.\r\n\r\nsecond.. it's less clear whether persisting the device info in the model is preferred or not. C2 right now has option keep_device (https://github.com/pytorch/pytorch/blob/master/caffe2/operators/load_save_op.h#L84) which is default false but sometime is true. PyTorch has the default of preserving the device and allowing to turn it off (https://discuss.pytorch.org/t/on-a-cpu-device-how-to-load-checkpoint-saved-on-gpu-device/349). But I guess that storing this info is useful", "created_at": "2018-10-24T05:41:10Z", "updated_at": "2018-11-23T15:53:30Z", "html_url": "https://github.com/pytorch/pytorch/pull/13020#discussion_r227647656", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/13020", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/227647656"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/13020#discussion_r227647656"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/13020"}}, "body_html": "<p>first.. you use it only in Tensor. If you actually check which fields would be later used it's actually only deviceType + deviceId - the rest are the artifact of reusing DeviceOption (what does random seed for tensor mean?). So we can probably nuke them from this struct.</p>\n<p>second.. it's less clear whether persisting the device info in the model is preferred or not. C2 right now has option keep_device (<a href=\"https://github.com/pytorch/pytorch/blob/master/caffe2/operators/load_save_op.h#L84\">https://github.com/pytorch/pytorch/blob/master/caffe2/operators/load_save_op.h#L84</a>) which is default false but sometime is true. PyTorch has the default of preserving the device and allowing to turn it off (<a href=\"https://discuss.pytorch.org/t/on-a-cpu-device-how-to-load-checkpoint-saved-on-gpu-device/349\" rel=\"nofollow\">https://discuss.pytorch.org/t/on-a-cpu-device-how-to-load-checkpoint-saved-on-gpu-device/349</a>). But I guess that storing this info is useful</p>", "body_text": "first.. you use it only in Tensor. If you actually check which fields would be later used it's actually only deviceType + deviceId - the rest are the artifact of reusing DeviceOption (what does random seed for tensor mean?). So we can probably nuke them from this struct.\nsecond.. it's less clear whether persisting the device info in the model is preferred or not. C2 right now has option keep_device (https://github.com/pytorch/pytorch/blob/master/caffe2/operators/load_save_op.h#L84) which is default false but sometime is true. PyTorch has the default of preserving the device and allowing to turn it off (https://discuss.pytorch.org/t/on-a-cpu-device-how-to-load-checkpoint-saved-on-gpu-device/349). But I guess that storing this info is useful"}