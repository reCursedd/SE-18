{"url": "https://api.github.com/repos/pytorch/pytorch/issues/9540", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/9540/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/9540/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/9540/events", "html_url": "https://github.com/pytorch/pytorch/issues/9540", "id": 342407915, "node_id": "MDU6SXNzdWUzNDI0MDc5MTU=", "number": 9540, "title": "if system NCCL2 and anaconda NCCL1 are both present, c10d linking fails", "user": {"login": "soumith", "id": 1310570, "node_id": "MDQ6VXNlcjEzMTA1NzA=", "avatar_url": "https://avatars0.githubusercontent.com/u/1310570?v=4", "gravatar_id": "", "url": "https://api.github.com/users/soumith", "html_url": "https://github.com/soumith", "followers_url": "https://api.github.com/users/soumith/followers", "following_url": "https://api.github.com/users/soumith/following{/other_user}", "gists_url": "https://api.github.com/users/soumith/gists{/gist_id}", "starred_url": "https://api.github.com/users/soumith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/soumith/subscriptions", "organizations_url": "https://api.github.com/users/soumith/orgs", "repos_url": "https://api.github.com/users/soumith/repos", "events_url": "https://api.github.com/users/soumith/events{/privacy}", "received_events_url": "https://api.github.com/users/soumith/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 778855555, "node_id": "MDU6TGFiZWw3Nzg4NTU1NTU=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/build", "name": "build", "color": "bfdadc", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-07-18T16:43:17Z", "updated_at": "2018-07-18T16:43:26Z", "closed_at": null, "author_association": "MEMBER", "body_html": "<p>Repro steps:</p>\n<ul>\n<li>System NCCL2 is given via env variable <code>NCCL_ROOT_DIR</code></li>\n<li>in the conda env, <code>conda install nccl</code> (it comes with installing <code>cupy</code>, for example)</li>\n<li><code>python setup.py install</code></li>\n</ul>\n<p>Will fail with:</p>\n<pre><code>[ 95%] Linking CXX executable ProcessGroupGlooTest\n../libc10d.a(ProcessGroupNCCL.cpp.o): In function `c10d::ProcessGroupNCCL::getNCCLComm(std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const&amp;, std::vector&lt;at::Device, std::allocator&lt;at::Device&gt; &gt; const&amp;)':\nProcessGroupNCCL.cpp:(.text+0x4374): undefined reference to `ncclGroupStart'\nProcessGroupNCCL.cpp:(.text+0x47c1): undefined reference to `ncclGroupEnd'\n</code></pre>\n<p>Also, related warnings that appear are:</p>\n<pre><code>CMake Warning at test/CMakeLists.txt:6 (add_executable):\n  Cannot generate a safe linker search path for target ProcessGroupNCCLTest\n  because files in some directories may conflict with libraries in implicit\n  directories:\n\n    link library [libnccl.so] in /public/apps/NCCL/2.2.12-1/lib may be hidden by files in:\n      /private/home/soumith/anaconda3/lib\n\n  Some of these libraries may not be found correctly.\nCall Stack (most recent call first):\n  test/CMakeLists.txt:21 (c10d_add_test)\n</code></pre>\n<p>Fix is to link to the full library path, not just the library-name.</p>", "body_text": "Repro steps:\n\nSystem NCCL2 is given via env variable NCCL_ROOT_DIR\nin the conda env, conda install nccl (it comes with installing cupy, for example)\npython setup.py install\n\nWill fail with:\n[ 95%] Linking CXX executable ProcessGroupGlooTest\n../libc10d.a(ProcessGroupNCCL.cpp.o): In function `c10d::ProcessGroupNCCL::getNCCLComm(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, std::vector<at::Device, std::allocator<at::Device> > const&)':\nProcessGroupNCCL.cpp:(.text+0x4374): undefined reference to `ncclGroupStart'\nProcessGroupNCCL.cpp:(.text+0x47c1): undefined reference to `ncclGroupEnd'\n\nAlso, related warnings that appear are:\nCMake Warning at test/CMakeLists.txt:6 (add_executable):\n  Cannot generate a safe linker search path for target ProcessGroupNCCLTest\n  because files in some directories may conflict with libraries in implicit\n  directories:\n\n    link library [libnccl.so] in /public/apps/NCCL/2.2.12-1/lib may be hidden by files in:\n      /private/home/soumith/anaconda3/lib\n\n  Some of these libraries may not be found correctly.\nCall Stack (most recent call first):\n  test/CMakeLists.txt:21 (c10d_add_test)\n\nFix is to link to the full library path, not just the library-name.", "body": "Repro steps:\r\n- System NCCL2 is given via env variable `NCCL_ROOT_DIR`\r\n- in the conda env, `conda install nccl` (it comes with installing `cupy`, for example)\r\n- `python setup.py install`\r\n\r\nWill fail with:\r\n\r\n```\r\n[ 95%] Linking CXX executable ProcessGroupGlooTest\r\n../libc10d.a(ProcessGroupNCCL.cpp.o): In function `c10d::ProcessGroupNCCL::getNCCLComm(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, std::vector<at::Device, std::allocator<at::Device> > const&)':\r\nProcessGroupNCCL.cpp:(.text+0x4374): undefined reference to `ncclGroupStart'\r\nProcessGroupNCCL.cpp:(.text+0x47c1): undefined reference to `ncclGroupEnd'\r\n```\r\n\r\nAlso, related warnings that appear are:\r\n\r\n```\r\nCMake Warning at test/CMakeLists.txt:6 (add_executable):\r\n  Cannot generate a safe linker search path for target ProcessGroupNCCLTest\r\n  because files in some directories may conflict with libraries in implicit\r\n  directories:\r\n\r\n    link library [libnccl.so] in /public/apps/NCCL/2.2.12-1/lib may be hidden by files in:\r\n      /private/home/soumith/anaconda3/lib\r\n\r\n  Some of these libraries may not be found correctly.\r\nCall Stack (most recent call first):\r\n  test/CMakeLists.txt:21 (c10d_add_test)\r\n```\r\n\r\nFix is to link to the full library path, not just the library-name."}