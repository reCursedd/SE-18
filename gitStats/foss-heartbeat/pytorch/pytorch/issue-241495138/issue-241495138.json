{"url": "https://api.github.com/repos/pytorch/pytorch/issues/2022", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/2022/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/2022/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/2022/events", "html_url": "https://github.com/pytorch/pytorch/issues/2022", "id": 241495138, "node_id": "MDU6SXNzdWUyNDE0OTUxMzg=", "number": 2022, "title": "cublas runtime error when both bmm's arguments have been expanded", "user": {"login": "UltimateBeaver", "id": 2908155, "node_id": "MDQ6VXNlcjI5MDgxNTU=", "avatar_url": "https://avatars2.githubusercontent.com/u/2908155?v=4", "gravatar_id": "", "url": "https://api.github.com/users/UltimateBeaver", "html_url": "https://github.com/UltimateBeaver", "followers_url": "https://api.github.com/users/UltimateBeaver/followers", "following_url": "https://api.github.com/users/UltimateBeaver/following{/other_user}", "gists_url": "https://api.github.com/users/UltimateBeaver/gists{/gist_id}", "starred_url": "https://api.github.com/users/UltimateBeaver/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/UltimateBeaver/subscriptions", "organizations_url": "https://api.github.com/users/UltimateBeaver/orgs", "repos_url": "https://api.github.com/users/UltimateBeaver/repos", "events_url": "https://api.github.com/users/UltimateBeaver/events{/privacy}", "received_events_url": "https://api.github.com/users/UltimateBeaver/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 424131847, "node_id": "MDU6TGFiZWw0MjQxMzE4NDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/bug", "name": "bug", "color": "b60205", "default": true}, {"id": 443484135, "node_id": "MDU6TGFiZWw0NDM0ODQxMzU=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/high%20priority", "name": "high priority", "color": "F22613", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-07-09T02:36:48Z", "updated_at": "2017-07-18T05:35:26Z", "closed_at": "2017-07-18T05:35:26Z", "author_association": "NONE", "body_html": "<p>The <code>torch.bmm</code> function would raise a runtime error when both of its arguments have been expanded. The following code snippet can reproduce the error:</p>\n<pre><code>import torch\n\na = torch.randn(256, 256).cuda()\nb = torch.randn(32, 256).cuda()\n\nc = a.unsqueeze(0).expand(32, 256, 256)\nd = b.unsqueeze(2).expand(32, 256, 20)\ntorch.bmm(c, d)\n</code></pre>\n<p>Error message:</p>\n<pre><code>RuntimeError: cublas runtime error : an invalid numeric value was used as an argument at /b/wheel/pytorch-src/torch/lib/THC/THCBlas.cu:344\n</code></pre>\n<p>I was able to get rid of the error by replacing <code>expand</code> with <code>repeat</code>, the following code would be fine:</p>\n<pre><code>import torch\n\na = torch.randn(256, 256).cuda()\nb = torch.randn(32, 256).cuda()\n\nc = a.unsqueeze(0).expand(32, 256, 256)\nd = b.unsqueeze(2).repeat(1, 1, 20)\ntorch.bmm(c, d)\n</code></pre>\n<p>My environment:  python 3.6 (anaconda), CUDA 8.0, pytorch 0.1.12_2</p>", "body_text": "The torch.bmm function would raise a runtime error when both of its arguments have been expanded. The following code snippet can reproduce the error:\nimport torch\n\na = torch.randn(256, 256).cuda()\nb = torch.randn(32, 256).cuda()\n\nc = a.unsqueeze(0).expand(32, 256, 256)\nd = b.unsqueeze(2).expand(32, 256, 20)\ntorch.bmm(c, d)\n\nError message:\nRuntimeError: cublas runtime error : an invalid numeric value was used as an argument at /b/wheel/pytorch-src/torch/lib/THC/THCBlas.cu:344\n\nI was able to get rid of the error by replacing expand with repeat, the following code would be fine:\nimport torch\n\na = torch.randn(256, 256).cuda()\nb = torch.randn(32, 256).cuda()\n\nc = a.unsqueeze(0).expand(32, 256, 256)\nd = b.unsqueeze(2).repeat(1, 1, 20)\ntorch.bmm(c, d)\n\nMy environment:  python 3.6 (anaconda), CUDA 8.0, pytorch 0.1.12_2", "body": "The `torch.bmm` function would raise a runtime error when both of its arguments have been expanded. The following code snippet can reproduce the error: \r\n```\r\nimport torch\r\n\r\na = torch.randn(256, 256).cuda()\r\nb = torch.randn(32, 256).cuda()\r\n\r\nc = a.unsqueeze(0).expand(32, 256, 256)\r\nd = b.unsqueeze(2).expand(32, 256, 20)\r\ntorch.bmm(c, d)\r\n```\r\n\r\nError message: \r\n```\r\nRuntimeError: cublas runtime error : an invalid numeric value was used as an argument at /b/wheel/pytorch-src/torch/lib/THC/THCBlas.cu:344\r\n```\r\n\r\nI was able to get rid of the error by replacing `expand` with `repeat`, the following code would be fine:\r\n```\r\nimport torch\r\n\r\na = torch.randn(256, 256).cuda()\r\nb = torch.randn(32, 256).cuda()\r\n\r\nc = a.unsqueeze(0).expand(32, 256, 256)\r\nd = b.unsqueeze(2).repeat(1, 1, 20)\r\ntorch.bmm(c, d)\r\n```\r\n\r\nMy environment:  python 3.6 (anaconda), CUDA 8.0, pytorch 0.1.12_2\r\n"}