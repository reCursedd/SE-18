{"url": "https://api.github.com/repos/pytorch/pytorch/issues/323", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/323/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/323/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/323/events", "html_url": "https://github.com/pytorch/pytorch/issues/323", "id": 196182491, "node_id": "MDU6SXNzdWUxOTYxODI0OTE=", "number": 323, "title": "Problem with Multinomial (Stochastic Nodes)", "user": {"login": "ludc", "id": 5995229, "node_id": "MDQ6VXNlcjU5OTUyMjk=", "avatar_url": "https://avatars3.githubusercontent.com/u/5995229?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ludc", "html_url": "https://github.com/ludc", "followers_url": "https://api.github.com/users/ludc/followers", "following_url": "https://api.github.com/users/ludc/following{/other_user}", "gists_url": "https://api.github.com/users/ludc/gists{/gist_id}", "starred_url": "https://api.github.com/users/ludc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ludc/subscriptions", "organizations_url": "https://api.github.com/users/ludc/orgs", "repos_url": "https://api.github.com/users/ludc/repos", "events_url": "https://api.github.com/users/ludc/events{/privacy}", "received_events_url": "https://api.github.com/users/ludc/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 424131847, "node_id": "MDU6TGFiZWw0MjQxMzE4NDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/bug", "name": "bug", "color": "b60205", "default": true}, {"id": 443484135, "node_id": "MDU6TGFiZWw0NDM0ODQxMzU=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/high%20priority", "name": "high priority", "color": "F22613", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2016-12-17T00:23:29Z", "updated_at": "2016-12-17T20:40:13Z", "closed_at": "2016-12-17T20:40:13Z", "author_association": "NONE", "body_html": "<p>The following code makes an error:</p>\n<pre><code>=== CODE\nimport torch\nimport torch.nn as nn\nfrom torch.autograd import Variable\nfrom torch.autograd.functions import Multinomial\nfrom torch.autograd.functions import Bernoulli\n\nl=nn.Linear(5,2)\ns=nn.Softmax()\nm=Multinomial(1)\n\nx=Variable(torch.randn(1,5),requires_grad=True)\nprobabilities=s(l(x))\ny=m(probabilities)\nprint(y)\ny.reinforce(torch.randn(1,1))\ny.backward()\n\n==== ERROR\nTraceback (most recent call last):\n  File \"rl/tutorials/tmp.py\", line 16, in &lt;module&gt;\n    y.backward()\n  File \"/home/denoyer/anaconda3/lib/python3.5/site-packages/torch/autograd/variable.py\", line 90, in backward\n    self._execution_engine.run_backward(self, gradient, retain_variables)\n  File \"/home/denoyer/anaconda3/lib/python3.5/site-packages/torch/autograd/stochastic_function.py\", line 14, in _do_backward\n    result = super(StochasticFunction, self)._do_backward((self.reward,), retain_variables)\n  File \"/home/denoyer/anaconda3/lib/python3.5/site-packages/torch/autograd/functions/stochastic.py\", line 23, in backward\n    output_probs = probs.index_select(0, samples)\nRuntimeError: Index is supposed to be a vector at /tmp/pip-jim5mxb2-build/torch/lib/TH/generic/THTensorMath.c:136 \n</code></pre>\n<p>It is also true with y.reinforce(torch.randn(1))</p>", "body_text": "The following code makes an error:\n=== CODE\nimport torch\nimport torch.nn as nn\nfrom torch.autograd import Variable\nfrom torch.autograd.functions import Multinomial\nfrom torch.autograd.functions import Bernoulli\n\nl=nn.Linear(5,2)\ns=nn.Softmax()\nm=Multinomial(1)\n\nx=Variable(torch.randn(1,5),requires_grad=True)\nprobabilities=s(l(x))\ny=m(probabilities)\nprint(y)\ny.reinforce(torch.randn(1,1))\ny.backward()\n\n==== ERROR\nTraceback (most recent call last):\n  File \"rl/tutorials/tmp.py\", line 16, in <module>\n    y.backward()\n  File \"/home/denoyer/anaconda3/lib/python3.5/site-packages/torch/autograd/variable.py\", line 90, in backward\n    self._execution_engine.run_backward(self, gradient, retain_variables)\n  File \"/home/denoyer/anaconda3/lib/python3.5/site-packages/torch/autograd/stochastic_function.py\", line 14, in _do_backward\n    result = super(StochasticFunction, self)._do_backward((self.reward,), retain_variables)\n  File \"/home/denoyer/anaconda3/lib/python3.5/site-packages/torch/autograd/functions/stochastic.py\", line 23, in backward\n    output_probs = probs.index_select(0, samples)\nRuntimeError: Index is supposed to be a vector at /tmp/pip-jim5mxb2-build/torch/lib/TH/generic/THTensorMath.c:136 \n\nIt is also true with y.reinforce(torch.randn(1))", "body": "The following code makes an error:\r\n\r\n```\r\n=== CODE\r\nimport torch\r\nimport torch.nn as nn\r\nfrom torch.autograd import Variable\r\nfrom torch.autograd.functions import Multinomial\r\nfrom torch.autograd.functions import Bernoulli\r\n\r\nl=nn.Linear(5,2)\r\ns=nn.Softmax()\r\nm=Multinomial(1)\r\n\r\nx=Variable(torch.randn(1,5),requires_grad=True)\r\nprobabilities=s(l(x))\r\ny=m(probabilities)\r\nprint(y)\r\ny.reinforce(torch.randn(1,1))\r\ny.backward()\r\n\r\n==== ERROR\r\nTraceback (most recent call last):\r\n  File \"rl/tutorials/tmp.py\", line 16, in <module>\r\n    y.backward()\r\n  File \"/home/denoyer/anaconda3/lib/python3.5/site-packages/torch/autograd/variable.py\", line 90, in backward\r\n    self._execution_engine.run_backward(self, gradient, retain_variables)\r\n  File \"/home/denoyer/anaconda3/lib/python3.5/site-packages/torch/autograd/stochastic_function.py\", line 14, in _do_backward\r\n    result = super(StochasticFunction, self)._do_backward((self.reward,), retain_variables)\r\n  File \"/home/denoyer/anaconda3/lib/python3.5/site-packages/torch/autograd/functions/stochastic.py\", line 23, in backward\r\n    output_probs = probs.index_select(0, samples)\r\nRuntimeError: Index is supposed to be a vector at /tmp/pip-jim5mxb2-build/torch/lib/TH/generic/THTensorMath.c:136 \r\n````\r\n\r\nIt is also true with y.reinforce(torch.randn(1))"}