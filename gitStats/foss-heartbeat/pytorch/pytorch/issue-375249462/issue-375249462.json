{"url": "https://api.github.com/repos/pytorch/pytorch/issues/13277", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/13277/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/13277/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/13277/events", "html_url": "https://github.com/pytorch/pytorch/pull/13277", "id": 375249462, "node_id": "MDExOlB1bGxSZXF1ZXN0MjI2NzM5Mjkz", "number": 13277, "title": "Explicit caffe2 caffe2_gpu to fix CMake 3.12 issue", "user": {"login": "goldsborough", "id": 6429851, "node_id": "MDQ6VXNlcjY0Mjk4NTE=", "avatar_url": "https://avatars3.githubusercontent.com/u/6429851?v=4", "gravatar_id": "", "url": "https://api.github.com/users/goldsborough", "html_url": "https://github.com/goldsborough", "followers_url": "https://api.github.com/users/goldsborough/followers", "following_url": "https://api.github.com/users/goldsborough/following{/other_user}", "gists_url": "https://api.github.com/users/goldsborough/gists{/gist_id}", "starred_url": "https://api.github.com/users/goldsborough/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/goldsborough/subscriptions", "organizations_url": "https://api.github.com/users/goldsborough/orgs", "repos_url": "https://api.github.com/users/goldsborough/repos", "events_url": "https://api.github.com/users/goldsborough/events{/privacy}", "received_events_url": "https://api.github.com/users/goldsborough/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-10-29T22:51:44Z", "updated_at": "2018-11-15T23:18:55Z", "closed_at": "2018-11-15T23:18:55Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/13277", "html_url": "https://github.com/pytorch/pytorch/pull/13277", "diff_url": "https://github.com/pytorch/pytorch/pull/13277.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/13277.patch"}, "body_html": "<p>In our cmake, ${Caffe2_MAIN_LIBS} is defined as <code>caffe2_library;caffe2_gpu_library</code>. These two libraries have a lot of interface dependencies and such set up, which interestingly interfere with newer CMake (3.12 and up) versions that add native support for CUDA (see note at the top of <a href=\"https://cmake.org/cmake/help/v3.12/module/FindCUDA.html\" rel=\"nofollow\">https://cmake.org/cmake/help/v3.12/module/FindCUDA.html</a>). Specifically, the native CUDA support from CMake seems to pass <code>Wl,--no-as-needed,/home/xxx/library/libtorch/lib/libcaffe2.so</code> to the NVCC device compiler, which then dies. By explicitly linking against the <code>caffe2</code> and <code>caffe2_gpu</code> targets, these issues are fixed.</p>\n<p><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #12911.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"372292475\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/12911\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/12911/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/12911\">#12911</a></p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1310570\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/soumith\">@soumith</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=79994\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/orionr\">@orionr</a></p>", "body_text": "In our cmake, ${Caffe2_MAIN_LIBS} is defined as caffe2_library;caffe2_gpu_library. These two libraries have a lot of interface dependencies and such set up, which interestingly interfere with newer CMake (3.12 and up) versions that add native support for CUDA (see note at the top of https://cmake.org/cmake/help/v3.12/module/FindCUDA.html). Specifically, the native CUDA support from CMake seems to pass Wl,--no-as-needed,/home/xxx/library/libtorch/lib/libcaffe2.so to the NVCC device compiler, which then dies. By explicitly linking against the caffe2 and caffe2_gpu targets, these issues are fixed.\nFixes #12911\n@soumith @orionr", "body": "In our cmake, ${Caffe2_MAIN_LIBS} is defined as `caffe2_library;caffe2_gpu_library`. These two libraries have a lot of interface dependencies and such set up, which interestingly interfere with newer CMake (3.12 and up) versions that add native support for CUDA (see note at the top of https://cmake.org/cmake/help/v3.12/module/FindCUDA.html). Specifically, the native CUDA support from CMake seems to pass `Wl,--no-as-needed,/home/xxx/library/libtorch/lib/libcaffe2.so` to the NVCC device compiler, which then dies. By explicitly linking against the `caffe2` and `caffe2_gpu` targets, these issues are fixed.\r\n\r\nFixes https://github.com/pytorch/pytorch/issues/12911\r\n\r\n@soumith @orionr "}