{"url": "https://api.github.com/repos/pytorch/pytorch/issues/13385", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/13385/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/13385/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/13385/events", "html_url": "https://github.com/pytorch/pytorch/issues/13385", "id": 375916019, "node_id": "MDU6SXNzdWUzNzU5MTYwMTk=", "number": 13385, "title": "Unable to build from latest master - nccl.h not found", "user": {"login": "mfuntowicz", "id": 2241520, "node_id": "MDQ6VXNlcjIyNDE1MjA=", "avatar_url": "https://avatars1.githubusercontent.com/u/2241520?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mfuntowicz", "html_url": "https://github.com/mfuntowicz", "followers_url": "https://api.github.com/users/mfuntowicz/followers", "following_url": "https://api.github.com/users/mfuntowicz/following{/other_user}", "gists_url": "https://api.github.com/users/mfuntowicz/gists{/gist_id}", "starred_url": "https://api.github.com/users/mfuntowicz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mfuntowicz/subscriptions", "organizations_url": "https://api.github.com/users/mfuntowicz/orgs", "repos_url": "https://api.github.com/users/mfuntowicz/repos", "events_url": "https://api.github.com/users/mfuntowicz/events{/privacy}", "received_events_url": "https://api.github.com/users/mfuntowicz/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": {"login": "anderspapitto", "id": 1388690, "node_id": "MDQ6VXNlcjEzODg2OTA=", "avatar_url": "https://avatars3.githubusercontent.com/u/1388690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anderspapitto", "html_url": "https://github.com/anderspapitto", "followers_url": "https://api.github.com/users/anderspapitto/followers", "following_url": "https://api.github.com/users/anderspapitto/following{/other_user}", "gists_url": "https://api.github.com/users/anderspapitto/gists{/gist_id}", "starred_url": "https://api.github.com/users/anderspapitto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anderspapitto/subscriptions", "organizations_url": "https://api.github.com/users/anderspapitto/orgs", "repos_url": "https://api.github.com/users/anderspapitto/repos", "events_url": "https://api.github.com/users/anderspapitto/events{/privacy}", "received_events_url": "https://api.github.com/users/anderspapitto/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "anderspapitto", "id": 1388690, "node_id": "MDQ6VXNlcjEzODg2OTA=", "avatar_url": "https://avatars3.githubusercontent.com/u/1388690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anderspapitto", "html_url": "https://github.com/anderspapitto", "followers_url": "https://api.github.com/users/anderspapitto/followers", "following_url": "https://api.github.com/users/anderspapitto/following{/other_user}", "gists_url": "https://api.github.com/users/anderspapitto/gists{/gist_id}", "starred_url": "https://api.github.com/users/anderspapitto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anderspapitto/subscriptions", "organizations_url": "https://api.github.com/users/anderspapitto/orgs", "repos_url": "https://api.github.com/users/anderspapitto/repos", "events_url": "https://api.github.com/users/anderspapitto/events{/privacy}", "received_events_url": "https://api.github.com/users/anderspapitto/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 9, "created_at": "2018-10-31T11:25:21Z", "updated_at": "2018-11-21T18:52:17Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>Hi,</p>\n<p>The cluster I'm running experiments on just updated CUDA &amp; co so I wanted to recompile Pytorch to match the new dependencies. I'm building with nccl support for c10d, everything goes fine until I reach:</p>\n<p>torch/csrc/cuda/nccl.cpp, torch/csrc/cuda/comm.cpp with the following error :</p>\n<pre><code>gcc -pthread -B /home/mfuntowi/miniconda3/compiler_compat -Wl,--sysroot=/ -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/mfuntowi/Workspace/cudnn/7.3.1.20_92/cuda/include -I/home/mfuntowi/Workspace/pytorch -I/home/mfuntowi/Workspace/pytorch/torch/lib/tmp_install/include -I/home/mfuntowi/Workspace/pytorch/torch/lib/tmp_install/include/TH -I/home/mfuntowi/Workspace/pytorch/torch/lib/tmp_install/include/THNN -I/home/mfuntowi/Workspace/pytorch/torch/lib/tmp_install/include/ATen -I/home/mfuntowi/Workspace/pytorch/third_party/pybind11/include -I/home/mfuntowi/Workspace/pytorch/torch/csrc -Ibuild/third_party -I/home/mfuntowi/miniconda3/lib/python3.6/site-packages/numpy/core/include -I/home/mfuntowi/Workspace/pytorch/torch/lib/tmp_install/include/THD -I/usr/local/cuda/include -I/home/mfuntowi/Workspace/pytorch/torch/lib/tmp_install/include/THCUNN -Ibuild/nccl/include -I/home/mfuntowi/miniconda3/include/python3.6m -c torch/csrc/cuda/nccl.cpp -o build/temp.linux-x86_64-3.6/torch/csrc/cuda/nccl.o -D_THP_CORE -DONNX_NAMESPACE=onnx_torch -std=c++11 -Wall -Wextra -Wno-strict-overflow -Wno-unused-parameter -Wno-missing-field-initializers -Wno-write-strings -Wno-zero-length-array -Wno-unknown-pragmas -Wno-deprecated-declarations -fno-strict-aliasing -Wno-missing-braces -Wno-stringop-overflow -DUSE_NUMPY -DUSE_DISTRIBUTED -DUSE_C10D -DUSE_CUDA -DCUDA_LIB_PATH=/usr/local/cuda/lib64 -DUSE_NCCL -DUSE_CUDNN\nIn file included from torch/csrc/cuda/nccl.cpp:1:0:\ntorch/csrc/cuda/nccl.h:8:18: fatal error: nccl.h: No such file or directory\n #include &lt;nccl.h&gt;\n                  ^\ncompilation terminated.\n</code></pre>\n<p>It appears even more strange that I ask to not take into account the system nccl and thus, it should build the one from third_party dependencies ...</p>\n<p>I'm building with the following command :</p>\n<p>CUDNN_LIB=/home/mfuntowi/Workspace/cudnn/7.3.1.20_92/cuda/lib64/libcudnn.so CUDNN_INCLUDE_DIR=/home/mfuntowi/Workspace/cudnn/7.3.1.20_92/cuda/include NO_SYSTEM_NCCL=1 TORCH_CUDA_ARCH_LIST=\"6.0;7.0\" python setup.py clean install</p>\n<p>Do you have any clue about what might be missing ?</p>", "body_text": "Hi,\nThe cluster I'm running experiments on just updated CUDA & co so I wanted to recompile Pytorch to match the new dependencies. I'm building with nccl support for c10d, everything goes fine until I reach:\ntorch/csrc/cuda/nccl.cpp, torch/csrc/cuda/comm.cpp with the following error :\ngcc -pthread -B /home/mfuntowi/miniconda3/compiler_compat -Wl,--sysroot=/ -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/mfuntowi/Workspace/cudnn/7.3.1.20_92/cuda/include -I/home/mfuntowi/Workspace/pytorch -I/home/mfuntowi/Workspace/pytorch/torch/lib/tmp_install/include -I/home/mfuntowi/Workspace/pytorch/torch/lib/tmp_install/include/TH -I/home/mfuntowi/Workspace/pytorch/torch/lib/tmp_install/include/THNN -I/home/mfuntowi/Workspace/pytorch/torch/lib/tmp_install/include/ATen -I/home/mfuntowi/Workspace/pytorch/third_party/pybind11/include -I/home/mfuntowi/Workspace/pytorch/torch/csrc -Ibuild/third_party -I/home/mfuntowi/miniconda3/lib/python3.6/site-packages/numpy/core/include -I/home/mfuntowi/Workspace/pytorch/torch/lib/tmp_install/include/THD -I/usr/local/cuda/include -I/home/mfuntowi/Workspace/pytorch/torch/lib/tmp_install/include/THCUNN -Ibuild/nccl/include -I/home/mfuntowi/miniconda3/include/python3.6m -c torch/csrc/cuda/nccl.cpp -o build/temp.linux-x86_64-3.6/torch/csrc/cuda/nccl.o -D_THP_CORE -DONNX_NAMESPACE=onnx_torch -std=c++11 -Wall -Wextra -Wno-strict-overflow -Wno-unused-parameter -Wno-missing-field-initializers -Wno-write-strings -Wno-zero-length-array -Wno-unknown-pragmas -Wno-deprecated-declarations -fno-strict-aliasing -Wno-missing-braces -Wno-stringop-overflow -DUSE_NUMPY -DUSE_DISTRIBUTED -DUSE_C10D -DUSE_CUDA -DCUDA_LIB_PATH=/usr/local/cuda/lib64 -DUSE_NCCL -DUSE_CUDNN\nIn file included from torch/csrc/cuda/nccl.cpp:1:0:\ntorch/csrc/cuda/nccl.h:8:18: fatal error: nccl.h: No such file or directory\n #include <nccl.h>\n                  ^\ncompilation terminated.\n\nIt appears even more strange that I ask to not take into account the system nccl and thus, it should build the one from third_party dependencies ...\nI'm building with the following command :\nCUDNN_LIB=/home/mfuntowi/Workspace/cudnn/7.3.1.20_92/cuda/lib64/libcudnn.so CUDNN_INCLUDE_DIR=/home/mfuntowi/Workspace/cudnn/7.3.1.20_92/cuda/include NO_SYSTEM_NCCL=1 TORCH_CUDA_ARCH_LIST=\"6.0;7.0\" python setup.py clean install\nDo you have any clue about what might be missing ?", "body": "Hi, \r\n\r\nThe cluster I'm running experiments on just updated CUDA & co so I wanted to recompile Pytorch to match the new dependencies. I'm building with nccl support for c10d, everything goes fine until I reach:\r\n\r\ntorch/csrc/cuda/nccl.cpp, torch/csrc/cuda/comm.cpp with the following error : \r\n\r\n```\r\ngcc -pthread -B /home/mfuntowi/miniconda3/compiler_compat -Wl,--sysroot=/ -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/mfuntowi/Workspace/cudnn/7.3.1.20_92/cuda/include -I/home/mfuntowi/Workspace/pytorch -I/home/mfuntowi/Workspace/pytorch/torch/lib/tmp_install/include -I/home/mfuntowi/Workspace/pytorch/torch/lib/tmp_install/include/TH -I/home/mfuntowi/Workspace/pytorch/torch/lib/tmp_install/include/THNN -I/home/mfuntowi/Workspace/pytorch/torch/lib/tmp_install/include/ATen -I/home/mfuntowi/Workspace/pytorch/third_party/pybind11/include -I/home/mfuntowi/Workspace/pytorch/torch/csrc -Ibuild/third_party -I/home/mfuntowi/miniconda3/lib/python3.6/site-packages/numpy/core/include -I/home/mfuntowi/Workspace/pytorch/torch/lib/tmp_install/include/THD -I/usr/local/cuda/include -I/home/mfuntowi/Workspace/pytorch/torch/lib/tmp_install/include/THCUNN -Ibuild/nccl/include -I/home/mfuntowi/miniconda3/include/python3.6m -c torch/csrc/cuda/nccl.cpp -o build/temp.linux-x86_64-3.6/torch/csrc/cuda/nccl.o -D_THP_CORE -DONNX_NAMESPACE=onnx_torch -std=c++11 -Wall -Wextra -Wno-strict-overflow -Wno-unused-parameter -Wno-missing-field-initializers -Wno-write-strings -Wno-zero-length-array -Wno-unknown-pragmas -Wno-deprecated-declarations -fno-strict-aliasing -Wno-missing-braces -Wno-stringop-overflow -DUSE_NUMPY -DUSE_DISTRIBUTED -DUSE_C10D -DUSE_CUDA -DCUDA_LIB_PATH=/usr/local/cuda/lib64 -DUSE_NCCL -DUSE_CUDNN\r\nIn file included from torch/csrc/cuda/nccl.cpp:1:0:\r\ntorch/csrc/cuda/nccl.h:8:18: fatal error: nccl.h: No such file or directory\r\n #include <nccl.h>\r\n                  ^\r\ncompilation terminated.\r\n```\r\n\r\nIt appears even more strange that I ask to not take into account the system nccl and thus, it should build the one from third_party dependencies ...\r\n\r\n\r\nI'm building with the following command : \r\n\r\nCUDNN_LIB=/home/mfuntowi/Workspace/cudnn/7.3.1.20_92/cuda/lib64/libcudnn.so CUDNN_INCLUDE_DIR=/home/mfuntowi/Workspace/cudnn/7.3.1.20_92/cuda/include NO_SYSTEM_NCCL=1 TORCH_CUDA_ARCH_LIST=\"6.0;7.0\" python setup.py clean install\r\n\r\nDo you have any clue about what might be missing ?"}