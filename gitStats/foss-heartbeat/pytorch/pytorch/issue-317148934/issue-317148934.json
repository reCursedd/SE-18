{"url": "https://api.github.com/repos/pytorch/pytorch/issues/6897", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/6897/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/6897/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/6897/events", "html_url": "https://github.com/pytorch/pytorch/issues/6897", "id": 317148934, "node_id": "MDU6SXNzdWUzMTcxNDg5MzQ=", "number": 6897, "title": "Guard against hard crash with wrong parameters in nn.PReLU", "user": {"login": "daniel-j-h", "id": 527241, "node_id": "MDQ6VXNlcjUyNzI0MQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/527241?v=4", "gravatar_id": "", "url": "https://api.github.com/users/daniel-j-h", "html_url": "https://github.com/daniel-j-h", "followers_url": "https://api.github.com/users/daniel-j-h/followers", "following_url": "https://api.github.com/users/daniel-j-h/following{/other_user}", "gists_url": "https://api.github.com/users/daniel-j-h/gists{/gist_id}", "starred_url": "https://api.github.com/users/daniel-j-h/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/daniel-j-h/subscriptions", "organizations_url": "https://api.github.com/users/daniel-j-h/orgs", "repos_url": "https://api.github.com/users/daniel-j-h/repos", "events_url": "https://api.github.com/users/daniel-j-h/events{/privacy}", "received_events_url": "https://api.github.com/users/daniel-j-h/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-04-24T09:43:38Z", "updated_at": "2018-04-25T20:29:25Z", "closed_at": "2018-04-25T20:29:25Z", "author_association": "NONE", "body_html": "<p>Per <a href=\"https://arxiv.org/abs/1502.01852\" rel=\"nofollow\">https://arxiv.org/abs/1502.01852</a> I'm giving the channel-wise <a href=\"http://pytorch.org/docs/stable/nn.html#torch.nn.PReLU\" rel=\"nofollow\">PReLUs</a> a try, as in:</p>\n<pre><code>nn.PReLU(num_parameters=num_channels)\n</code></pre>\n<p>When accidentally getting the <code>num_parameters</code> argument wrong it seems like we crash hard with an invalid <code>free</code> somewhere in native code.</p>\n<p>Can we put some guards in place to not hard-crash here and maybe even show the user a useful error message?</p>\n<p>Here is the crash log, hope that helps:</p>\n<details>\n<summary>Backtrace</summary>\n<pre><code>*** Error in `python3': free(): invalid pointer: 0x00007fb5ee875d40 ***                                                                                                                                   [179/1882]\n======= Backtrace: =========\n/lib/x86_64-linux-gnu/libc.so.6(+0x777e5)[0x7fb5ff54f7e5]\n/lib/x86_64-linux-gnu/libc.so.6(+0x8037a)[0x7fb5ff55837a]\n/lib/x86_64-linux-gnu/libc.so.6(cfree+0x4c)[0x7fb5ff55c53c]\n/usr/local/lib/python3.6/dist-packages/torch/_thnn/_THCUNN.cpython-36m-x86_64-linux-gnu.so(+0x2b492)[0x7fb5a6d96492]\npython3(_PyCFunction_FastCallKeywords+0x9e)[0x51e55e]\npython3[0x5789e9]\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\npython3(PyEval_EvalCodeEx+0x28c)[0x578f4c]\npython3[0x4f6b73]\npython3(PyObject_Call+0x3a)[0x4e2f0a]\n/usr/local/lib/python3.6/dist-packages/torch/_C.cpython-36m-x86_64-linux-gnu.so(_Z17THPFunction_applyP7_objectS0_+0x271)[0x7fb5ed37dac1]\npython3(_PyCFunction_FastCallKeywords+0x9e)[0x51e55e]\npython3[0x5789e9]\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\npython3[0x5799fd]\npython3[0x578acc]\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\npython3(_PyFunction_FastCallDict+0x133)[0x57a3e3]\npython3(_PyObject_Call_Prepend+0x24c)[0x4e383c]\npython3(PyObject_Call+0x3a)[0x4e2f0a]\npython3(_PyEval_EvalFrameDefault+0x1ab5)[0x5729e5]\npython3[0x57047f]\npython3(_PyFunction_FastCallDict+0x1da)[0x57a48a]\npython3(_PyObject_Call_Prepend+0x24c)[0x4e383c]\npython3(PyObject_Call+0x3a)[0x4e2f0a]\npython3[0x5333ee]\npython3(_PyObject_FastCallKeywords+0x10b)[0x4e2a2b]\npython3[0x578b75]\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\npython3(_PyFunction_FastCallDict+0x133)[0x57a3e3]\npython3(_PyObject_Call_Prepend+0x24c)[0x4e383c]\npython3(PyObject_Call+0x3a)[0x4e2f0a]\npython3(_PyEval_EvalFrameDefault+0x1ab5)[0x5729e5]\npython3[0x57047f]\npython3(_PyFunction_FastCallDict+0x1da)[0x57a48a]\npython3(_PyObject_Call_Prepend+0x24c)[0x4e383c]\npython3(PyObject_Call+0x3a)[0x4e2f0a]\npython3[0x5333ee]\npython3(_PyObject_FastCallKeywords+0x10b)[0x4e2a2b]\npython3[0x578b75]\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\npython3(_PyFunction_FastCallDict+0x133)[0x57a3e3]\npython3(_PyObject_Call_Prepend+0x24c)[0x4e383c]\npython3(PyObject_Call+0x3a)[0x4e2f0a]\npython3(_PyEval_EvalFrameDefault+0x1ab5)[0x5729e5]\npython3[0x57047f]\npython3(_PyFunction_FastCallDict+0x1da)[0x57a48a]\npython3(_PyObject_Call_Prepend+0x24c)[0x4e383c]\npython3(PyObject_Call+0x3a)[0x4e2f0a]\npython3[0x5333ee]\npython3(_PyObject_FastCallKeywords+0x10b)[0x4e2a2b]\npython3[0x578b75]\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\npython3[0x5799fd]\npython3[0x578acc]\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\npython3[0x5707ae]\npython3[0x579abb]\npython3[0x578acc]\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\npython3[0x57047f]\npython3(PyEval_EvalCode+0x23)[0x5701f3]\npython3[0x56e0ee]\n</code></pre>\n</details>\n<h2>System Info</h2>\n<pre><code>PyTorch version: 0.3.1\nIs debug build: No\nCUDA used to build PyTorch: 8.0.61\n\nOS: Ubuntu 16.04.4 LTS\nGCC version: (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609\nCMake version: version 3.5.1\n\nPython version: 3.6\nIs CUDA available: Yes\nCUDA runtime version: 8.0.61\nGPU models and configuration: GPU 0: Tesla K80\nNvidia driver version: 384.66\ncuDNN version: Probably one of the following:\n/usr/lib/x86_64-linux-gnu/libcudnn.so.6.0.21\n/usr/lib/x86_64-linux-gnu/libcudnn_static_v6.a\n/usr/local/lib/python3.6/dist-packages/torch/lib/libcudnn-900fef33.so.7.0.5\n\nVersions of relevant libraries:\n[pip3] numpy (1.14.2)\n[pip3] torch (0.3.1)\n[pip3] torchvision (0.2.0)\n[conda] Could not collect\n</code></pre>", "body_text": "Per https://arxiv.org/abs/1502.01852 I'm giving the channel-wise PReLUs a try, as in:\nnn.PReLU(num_parameters=num_channels)\n\nWhen accidentally getting the num_parameters argument wrong it seems like we crash hard with an invalid free somewhere in native code.\nCan we put some guards in place to not hard-crash here and maybe even show the user a useful error message?\nHere is the crash log, hope that helps:\n\nBacktrace\n*** Error in `python3': free(): invalid pointer: 0x00007fb5ee875d40 ***                                                                                                                                   [179/1882]\n======= Backtrace: =========\n/lib/x86_64-linux-gnu/libc.so.6(+0x777e5)[0x7fb5ff54f7e5]\n/lib/x86_64-linux-gnu/libc.so.6(+0x8037a)[0x7fb5ff55837a]\n/lib/x86_64-linux-gnu/libc.so.6(cfree+0x4c)[0x7fb5ff55c53c]\n/usr/local/lib/python3.6/dist-packages/torch/_thnn/_THCUNN.cpython-36m-x86_64-linux-gnu.so(+0x2b492)[0x7fb5a6d96492]\npython3(_PyCFunction_FastCallKeywords+0x9e)[0x51e55e]\npython3[0x5789e9]\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\npython3(PyEval_EvalCodeEx+0x28c)[0x578f4c]\npython3[0x4f6b73]\npython3(PyObject_Call+0x3a)[0x4e2f0a]\n/usr/local/lib/python3.6/dist-packages/torch/_C.cpython-36m-x86_64-linux-gnu.so(_Z17THPFunction_applyP7_objectS0_+0x271)[0x7fb5ed37dac1]\npython3(_PyCFunction_FastCallKeywords+0x9e)[0x51e55e]\npython3[0x5789e9]\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\npython3[0x5799fd]\npython3[0x578acc]\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\npython3(_PyFunction_FastCallDict+0x133)[0x57a3e3]\npython3(_PyObject_Call_Prepend+0x24c)[0x4e383c]\npython3(PyObject_Call+0x3a)[0x4e2f0a]\npython3(_PyEval_EvalFrameDefault+0x1ab5)[0x5729e5]\npython3[0x57047f]\npython3(_PyFunction_FastCallDict+0x1da)[0x57a48a]\npython3(_PyObject_Call_Prepend+0x24c)[0x4e383c]\npython3(PyObject_Call+0x3a)[0x4e2f0a]\npython3[0x5333ee]\npython3(_PyObject_FastCallKeywords+0x10b)[0x4e2a2b]\npython3[0x578b75]\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\npython3(_PyFunction_FastCallDict+0x133)[0x57a3e3]\npython3(_PyObject_Call_Prepend+0x24c)[0x4e383c]\npython3(PyObject_Call+0x3a)[0x4e2f0a]\npython3(_PyEval_EvalFrameDefault+0x1ab5)[0x5729e5]\npython3[0x57047f]\npython3(_PyFunction_FastCallDict+0x1da)[0x57a48a]\npython3(_PyObject_Call_Prepend+0x24c)[0x4e383c]\npython3(PyObject_Call+0x3a)[0x4e2f0a]\npython3[0x5333ee]\npython3(_PyObject_FastCallKeywords+0x10b)[0x4e2a2b]\npython3[0x578b75]\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\npython3(_PyFunction_FastCallDict+0x133)[0x57a3e3]\npython3(_PyObject_Call_Prepend+0x24c)[0x4e383c]\npython3(PyObject_Call+0x3a)[0x4e2f0a]\npython3(_PyEval_EvalFrameDefault+0x1ab5)[0x5729e5]\npython3[0x57047f]\npython3(_PyFunction_FastCallDict+0x1da)[0x57a48a]\npython3(_PyObject_Call_Prepend+0x24c)[0x4e383c]\npython3(PyObject_Call+0x3a)[0x4e2f0a]\npython3[0x5333ee]\npython3(_PyObject_FastCallKeywords+0x10b)[0x4e2a2b]\npython3[0x578b75]\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\npython3[0x5799fd]\npython3[0x578acc]\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\npython3[0x5707ae]\npython3[0x579abb]\npython3[0x578acc]\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\npython3[0x57047f]\npython3(PyEval_EvalCode+0x23)[0x5701f3]\npython3[0x56e0ee]\n\n\nSystem Info\nPyTorch version: 0.3.1\nIs debug build: No\nCUDA used to build PyTorch: 8.0.61\n\nOS: Ubuntu 16.04.4 LTS\nGCC version: (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609\nCMake version: version 3.5.1\n\nPython version: 3.6\nIs CUDA available: Yes\nCUDA runtime version: 8.0.61\nGPU models and configuration: GPU 0: Tesla K80\nNvidia driver version: 384.66\ncuDNN version: Probably one of the following:\n/usr/lib/x86_64-linux-gnu/libcudnn.so.6.0.21\n/usr/lib/x86_64-linux-gnu/libcudnn_static_v6.a\n/usr/local/lib/python3.6/dist-packages/torch/lib/libcudnn-900fef33.so.7.0.5\n\nVersions of relevant libraries:\n[pip3] numpy (1.14.2)\n[pip3] torch (0.3.1)\n[pip3] torchvision (0.2.0)\n[conda] Could not collect", "body": "Per https://arxiv.org/abs/1502.01852 I'm giving the channel-wise [PReLUs](http://pytorch.org/docs/stable/nn.html#torch.nn.PReLU) a try, as in:\r\n\r\n    nn.PReLU(num_parameters=num_channels)\r\n\r\nWhen accidentally getting the `num_parameters` argument wrong it seems like we crash hard with an invalid `free` somewhere in native code.\r\n\r\nCan we put some guards in place to not hard-crash here and maybe even show the user a useful error message?\r\n\r\nHere is the crash log, hope that helps:\r\n\r\n<details>\r\n<summary>Backtrace</summary>\r\n\r\n```\r\n*** Error in `python3': free(): invalid pointer: 0x00007fb5ee875d40 ***                                                                                                                                   [179/1882]\r\n======= Backtrace: =========\r\n/lib/x86_64-linux-gnu/libc.so.6(+0x777e5)[0x7fb5ff54f7e5]\r\n/lib/x86_64-linux-gnu/libc.so.6(+0x8037a)[0x7fb5ff55837a]\r\n/lib/x86_64-linux-gnu/libc.so.6(cfree+0x4c)[0x7fb5ff55c53c]\r\n/usr/local/lib/python3.6/dist-packages/torch/_thnn/_THCUNN.cpython-36m-x86_64-linux-gnu.so(+0x2b492)[0x7fb5a6d96492]\r\npython3(_PyCFunction_FastCallKeywords+0x9e)[0x51e55e]\r\npython3[0x5789e9]\r\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\r\npython3(PyEval_EvalCodeEx+0x28c)[0x578f4c]\r\npython3[0x4f6b73]\r\npython3(PyObject_Call+0x3a)[0x4e2f0a]\r\n/usr/local/lib/python3.6/dist-packages/torch/_C.cpython-36m-x86_64-linux-gnu.so(_Z17THPFunction_applyP7_objectS0_+0x271)[0x7fb5ed37dac1]\r\npython3(_PyCFunction_FastCallKeywords+0x9e)[0x51e55e]\r\npython3[0x5789e9]\r\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\r\npython3[0x5799fd]\r\npython3[0x578acc]\r\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\r\npython3(_PyFunction_FastCallDict+0x133)[0x57a3e3]\r\npython3(_PyObject_Call_Prepend+0x24c)[0x4e383c]\r\npython3(PyObject_Call+0x3a)[0x4e2f0a]\r\npython3(_PyEval_EvalFrameDefault+0x1ab5)[0x5729e5]\r\npython3[0x57047f]\r\npython3(_PyFunction_FastCallDict+0x1da)[0x57a48a]\r\npython3(_PyObject_Call_Prepend+0x24c)[0x4e383c]\r\npython3(PyObject_Call+0x3a)[0x4e2f0a]\r\npython3[0x5333ee]\r\npython3(_PyObject_FastCallKeywords+0x10b)[0x4e2a2b]\r\npython3[0x578b75]\r\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\r\npython3(_PyFunction_FastCallDict+0x133)[0x57a3e3]\r\npython3(_PyObject_Call_Prepend+0x24c)[0x4e383c]\r\npython3(PyObject_Call+0x3a)[0x4e2f0a]\r\npython3(_PyEval_EvalFrameDefault+0x1ab5)[0x5729e5]\r\npython3[0x57047f]\r\npython3(_PyFunction_FastCallDict+0x1da)[0x57a48a]\r\npython3(_PyObject_Call_Prepend+0x24c)[0x4e383c]\r\npython3(PyObject_Call+0x3a)[0x4e2f0a]\r\npython3[0x5333ee]\r\npython3(_PyObject_FastCallKeywords+0x10b)[0x4e2a2b]\r\npython3[0x578b75]\r\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\r\npython3(_PyFunction_FastCallDict+0x133)[0x57a3e3]\r\npython3(_PyObject_Call_Prepend+0x24c)[0x4e383c]\r\npython3(PyObject_Call+0x3a)[0x4e2f0a]\r\npython3(_PyEval_EvalFrameDefault+0x1ab5)[0x5729e5]\r\npython3[0x57047f]\r\npython3(_PyFunction_FastCallDict+0x1da)[0x57a48a]\r\npython3(_PyObject_Call_Prepend+0x24c)[0x4e383c]\r\npython3(PyObject_Call+0x3a)[0x4e2f0a]\r\npython3[0x5333ee]\r\npython3(_PyObject_FastCallKeywords+0x10b)[0x4e2a2b]\r\npython3[0x578b75]\r\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\r\npython3[0x5799fd]\r\npython3[0x578acc]\r\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\r\npython3[0x5707ae]\r\npython3[0x579abb]\r\npython3[0x578acc]\r\npython3(_PyEval_EvalFrameDefault+0x3da)[0x57130a]\r\npython3[0x57047f]\r\npython3(PyEval_EvalCode+0x23)[0x5701f3]\r\npython3[0x56e0ee]\r\n```\r\n\r\n</details>\r\n\r\n## System Info\r\n\r\n```\r\nPyTorch version: 0.3.1\r\nIs debug build: No\r\nCUDA used to build PyTorch: 8.0.61\r\n\r\nOS: Ubuntu 16.04.4 LTS\r\nGCC version: (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609\r\nCMake version: version 3.5.1\r\n\r\nPython version: 3.6\r\nIs CUDA available: Yes\r\nCUDA runtime version: 8.0.61\r\nGPU models and configuration: GPU 0: Tesla K80\r\nNvidia driver version: 384.66\r\ncuDNN version: Probably one of the following:\r\n/usr/lib/x86_64-linux-gnu/libcudnn.so.6.0.21\r\n/usr/lib/x86_64-linux-gnu/libcudnn_static_v6.a\r\n/usr/local/lib/python3.6/dist-packages/torch/lib/libcudnn-900fef33.so.7.0.5\r\n\r\nVersions of relevant libraries:\r\n[pip3] numpy (1.14.2)\r\n[pip3] torch (0.3.1)\r\n[pip3] torchvision (0.2.0)\r\n[conda] Could not collect\r\n```"}