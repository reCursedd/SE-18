{"url": "https://api.github.com/repos/pytorch/pytorch/issues/6868", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/6868/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/6868/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/6868/events", "html_url": "https://github.com/pytorch/pytorch/issues/6868", "id": 316908914, "node_id": "MDU6SXNzdWUzMTY5MDg5MTQ=", "number": 6868, "title": "[Caffe2] Android NNApi integration bugs.", "user": {"login": "shashishekhar", "id": 1162712, "node_id": "MDQ6VXNlcjExNjI3MTI=", "avatar_url": "https://avatars1.githubusercontent.com/u/1162712?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shashishekhar", "html_url": "https://github.com/shashishekhar", "followers_url": "https://api.github.com/users/shashishekhar/followers", "following_url": "https://api.github.com/users/shashishekhar/following{/other_user}", "gists_url": "https://api.github.com/users/shashishekhar/gists{/gist_id}", "starred_url": "https://api.github.com/users/shashishekhar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shashishekhar/subscriptions", "organizations_url": "https://api.github.com/users/shashishekhar/orgs", "repos_url": "https://api.github.com/users/shashishekhar/repos", "events_url": "https://api.github.com/users/shashishekhar/events{/privacy}", "received_events_url": "https://api.github.com/users/shashishekhar/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 890282107, "node_id": "MDU6TGFiZWw4OTAyODIxMDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/caffe2", "name": "caffe2", "color": "210aa8", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-04-23T17:30:04Z", "updated_at": "2018-04-25T19:47:11Z", "closed_at": null, "author_association": "NONE", "body_html": "<h2>Issue description</h2>\n<p>I found a few bugs in NNApi integration while running benchmarks.</p>\n<h2>Code example</h2>\n<p>Bug 1:  Invalid size is passed for tensors.<br>\nCaffe2 seems to be passing invalid size for tensors in setInput and setOutput.<br>\nIf I am not wrong, they should be passing tensor-&gt;nbytes() instead of tensor-&gt;bytes()<br>\n<a href=\"https://github.com/caffe2/caffe2/blob/master/caffe2/mobile/contrib/nnapi/nnapi.cc#L659\">https://github.com/caffe2/caffe2/blob/master/caffe2/mobile/contrib/nnapi/nnapi.cc#L659</a><br>\nIn ANeuralNetworksExecution_setInput the length parameter is number of bytes, not number of elements in the tensor.<br>\n<a href=\"https://developer.android.com/ndk/reference/group___neural_networks.html#gaf5540f8785a31b550ba7e7a78eed6a85\" rel=\"nofollow\">https://developer.android.com/ndk/reference/group___neural_networks.html#gaf5540f8785a31b550ba7e7a78eed6a85</a></p>\n<p>Bug 2: The scale is only supported for Quantized int8 tensors and should be 0 otherwise.<br>\n<a href=\"https://github.com/caffe2/caffe2/blob/master/caffe2/mobile/contrib/nnapi/nnapi.cc#L517\">https://github.com/caffe2/caffe2/blob/master/caffe2/mobile/contrib/nnapi/nnapi.cc#L517</a><br>\nNNApi::addTensorOperand should assign scale conditionally.</p>", "body_text": "Issue description\nI found a few bugs in NNApi integration while running benchmarks.\nCode example\nBug 1:  Invalid size is passed for tensors.\nCaffe2 seems to be passing invalid size for tensors in setInput and setOutput.\nIf I am not wrong, they should be passing tensor->nbytes() instead of tensor->bytes()\nhttps://github.com/caffe2/caffe2/blob/master/caffe2/mobile/contrib/nnapi/nnapi.cc#L659\nIn ANeuralNetworksExecution_setInput the length parameter is number of bytes, not number of elements in the tensor.\nhttps://developer.android.com/ndk/reference/group___neural_networks.html#gaf5540f8785a31b550ba7e7a78eed6a85\nBug 2: The scale is only supported for Quantized int8 tensors and should be 0 otherwise.\nhttps://github.com/caffe2/caffe2/blob/master/caffe2/mobile/contrib/nnapi/nnapi.cc#L517\nNNApi::addTensorOperand should assign scale conditionally.", "body": "## Issue description\r\nI found a few bugs in NNApi integration while running benchmarks.\r\n## Code example\r\nBug 1:  Invalid size is passed for tensors.\r\nCaffe2 seems to be passing invalid size for tensors in setInput and setOutput.\r\nIf I am not wrong, they should be passing tensor->nbytes() instead of tensor->bytes()\r\nhttps://github.com/caffe2/caffe2/blob/master/caffe2/mobile/contrib/nnapi/nnapi.cc#L659\r\nIn ANeuralNetworksExecution_setInput the length parameter is number of bytes, not number of elements in the tensor.\r\nhttps://developer.android.com/ndk/reference/group___neural_networks.html#gaf5540f8785a31b550ba7e7a78eed6a85\r\n\r\nBug 2: The scale is only supported for Quantized int8 tensors and should be 0 otherwise.\r\nhttps://github.com/caffe2/caffe2/blob/master/caffe2/mobile/contrib/nnapi/nnapi.cc#L517\r\nNNApi::addTensorOperand should assign scale conditionally.\r\n\r\n"}