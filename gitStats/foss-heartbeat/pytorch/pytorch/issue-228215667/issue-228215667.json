{"url": "https://api.github.com/repos/pytorch/pytorch/issues/1543", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/1543/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/1543/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/1543/events", "html_url": "https://github.com/pytorch/pytorch/issues/1543", "id": 228215667, "node_id": "MDU6SXNzdWUyMjgyMTU2Njc=", "number": 1543, "title": "Problem with BCELoss with weight", "user": {"login": "nian-liu", "id": 5463229, "node_id": "MDQ6VXNlcjU0NjMyMjk=", "avatar_url": "https://avatars1.githubusercontent.com/u/5463229?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nian-liu", "html_url": "https://github.com/nian-liu", "followers_url": "https://api.github.com/users/nian-liu/followers", "following_url": "https://api.github.com/users/nian-liu/following{/other_user}", "gists_url": "https://api.github.com/users/nian-liu/gists{/gist_id}", "starred_url": "https://api.github.com/users/nian-liu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nian-liu/subscriptions", "organizations_url": "https://api.github.com/users/nian-liu/orgs", "repos_url": "https://api.github.com/users/nian-liu/repos", "events_url": "https://api.github.com/users/nian-liu/events{/privacy}", "received_events_url": "https://api.github.com/users/nian-liu/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2017-05-12T07:58:23Z", "updated_at": "2017-10-30T11:39:52Z", "closed_at": "2017-05-13T10:55:10Z", "author_association": "NONE", "body_html": "<p>I am using the BCELoss for input and target with size of batchsize * channel * height * width, I also want to weight the loss using a weight matrix of the same size, then I get the below error:</p>\n<p>File \"/home/nianliu/anaconda3/lib/python3.6/site-packages/torch/nn/_functions/thnn/loss.py\", line 15, in _resize_weight<br>\nself.weight = self.weight.view(1, target.size(1)).expand_as(target)<br>\nRuntimeError: size '[1 x 1]' is invalid for input of with 320 elements at /py/conda-bld/pytorch_1493680494901/work/torch/lib/TH/THStorage.c:59</p>\n<p>Apparently, on this line, it's incorrect to reshape the weight matrix to the size of 1*target.size(1), unless only the channel-wise weights are allowed.</p>\n<p>Since one may want to use sample-wise weights, channel-wise weights, pixel-wise weights, element-wise weights (jusk like my case), or other forms, I think we may remove the expanding operation and let users do it by themselves to ensure the flexibility.</p>", "body_text": "I am using the BCELoss for input and target with size of batchsize * channel * height * width, I also want to weight the loss using a weight matrix of the same size, then I get the below error:\nFile \"/home/nianliu/anaconda3/lib/python3.6/site-packages/torch/nn/_functions/thnn/loss.py\", line 15, in _resize_weight\nself.weight = self.weight.view(1, target.size(1)).expand_as(target)\nRuntimeError: size '[1 x 1]' is invalid for input of with 320 elements at /py/conda-bld/pytorch_1493680494901/work/torch/lib/TH/THStorage.c:59\nApparently, on this line, it's incorrect to reshape the weight matrix to the size of 1*target.size(1), unless only the channel-wise weights are allowed.\nSince one may want to use sample-wise weights, channel-wise weights, pixel-wise weights, element-wise weights (jusk like my case), or other forms, I think we may remove the expanding operation and let users do it by themselves to ensure the flexibility.", "body": "I am using the BCELoss for input and target with size of batchsize * channel * height * width, I also want to weight the loss using a weight matrix of the same size, then I get the below error:\r\n\r\nFile \"/home/nianliu/anaconda3/lib/python3.6/site-packages/torch/nn/_functions/thnn/loss.py\", line 15, in _resize_weight\r\n    self.weight = self.weight.view(1, target.size(1)).expand_as(target)\r\nRuntimeError: size '[1 x 1]' is invalid for input of with 320 elements at /py/conda-bld/pytorch_1493680494901/work/torch/lib/TH/THStorage.c:59\r\n\r\nApparently, on this line, it's incorrect to reshape the weight matrix to the size of 1*target.size(1), unless only the channel-wise weights are allowed. \r\n\r\nSince one may want to use sample-wise weights, channel-wise weights, pixel-wise weights, element-wise weights (jusk like my case), or other forms, I think we may remove the expanding operation and let users do it by themselves to ensure the flexibility."}