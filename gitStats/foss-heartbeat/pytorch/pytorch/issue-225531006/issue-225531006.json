{"url": "https://api.github.com/repos/pytorch/pytorch/issues/1421", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/1421/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/1421/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/1421/events", "html_url": "https://github.com/pytorch/pytorch/pull/1421", "id": 225531006, "node_id": "MDExOlB1bGxSZXF1ZXN0MTE4NDQ0MTIy", "number": 1421, "title": "Refactor test_sparse to reduce boilerplate.", "user": {"login": "ezyang", "id": 13564, "node_id": "MDQ6VXNlcjEzNTY0", "avatar_url": "https://avatars0.githubusercontent.com/u/13564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ezyang", "html_url": "https://github.com/ezyang", "followers_url": "https://api.github.com/users/ezyang/followers", "following_url": "https://api.github.com/users/ezyang/following{/other_user}", "gists_url": "https://api.github.com/users/ezyang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ezyang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ezyang/subscriptions", "organizations_url": "https://api.github.com/users/ezyang/orgs", "repos_url": "https://api.github.com/users/ezyang/repos", "events_url": "https://api.github.com/users/ezyang/events{/privacy}", "received_events_url": "https://api.github.com/users/ezyang/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-05-01T21:23:09Z", "updated_at": "2018-11-23T15:33:18Z", "closed_at": "2017-05-02T01:52:59Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/1421", "html_url": "https://github.com/pytorch/pytorch/pull/1421", "diff_url": "https://github.com/pytorch/pytorch/pull/1421.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/1421.patch"}, "body_html": "<p>Instead of manually creating a helper function, threading an is_cuda<br>\nparameter around, and creating a test method for CUDA and non-CUDA<br>\nvariants, we take a different approach:</p>\n<ul>\n<li>\n<p>There is now some new member variables initialized in setUp which<br>\ncontrol the aspects of how we carry out the test; at the moment,<br>\nit's just whether or not we are using CUDA or not.  This means<br>\nyou don't have to pass is_cuda around, or do a conditional to<br>\nget the triplet of constructors you need.</p>\n<p>I'll note that I am not a big fan of member variables in test<br>\nobjects, but these are (intended to be) immutable so I think<br>\nit should be OK.</p>\n</li>\n<li>\n<p>Instead of manually defining test_foo and test_foo_cuda, we now<br>\nhave a new TestCudaSparse class which overrides setUp (from above)<br>\nto swap in the CUDA implementation.  Way less boilerplate, and NO<br>\nmetaprogramming needed.</p>\n<p>If you need to opt out of CUDA testing, there is a new cpu_only<br>\ndecorator you can use.</p>\n</li>\n</ul>\n<p>BUYER BEWARE: I haven't actually tested this on GPU yet.</p>\n<p>Signed-off-by: Edward Z. Yang <a href=\"mailto:ezyang@fb.com\">ezyang@fb.com</a></p>", "body_text": "Instead of manually creating a helper function, threading an is_cuda\nparameter around, and creating a test method for CUDA and non-CUDA\nvariants, we take a different approach:\n\n\nThere is now some new member variables initialized in setUp which\ncontrol the aspects of how we carry out the test; at the moment,\nit's just whether or not we are using CUDA or not.  This means\nyou don't have to pass is_cuda around, or do a conditional to\nget the triplet of constructors you need.\nI'll note that I am not a big fan of member variables in test\nobjects, but these are (intended to be) immutable so I think\nit should be OK.\n\n\nInstead of manually defining test_foo and test_foo_cuda, we now\nhave a new TestCudaSparse class which overrides setUp (from above)\nto swap in the CUDA implementation.  Way less boilerplate, and NO\nmetaprogramming needed.\nIf you need to opt out of CUDA testing, there is a new cpu_only\ndecorator you can use.\n\n\nBUYER BEWARE: I haven't actually tested this on GPU yet.\nSigned-off-by: Edward Z. Yang ezyang@fb.com", "body": "Instead of manually creating a helper function, threading an is_cuda\r\nparameter around, and creating a test method for CUDA and non-CUDA\r\nvariants, we take a different approach:\r\n\r\n- There is now some new member variables initialized in setUp which\r\n  control the aspects of how we carry out the test; at the moment,\r\n  it's just whether or not we are using CUDA or not.  This means\r\n  you don't have to pass is_cuda around, or do a conditional to\r\n  get the triplet of constructors you need.\r\n\r\n  I'll note that I am not a big fan of member variables in test\r\n  objects, but these are (intended to be) immutable so I think\r\n  it should be OK.\r\n\r\n- Instead of manually defining test_foo and test_foo_cuda, we now\r\n  have a new TestCudaSparse class which overrides setUp (from above)\r\n  to swap in the CUDA implementation.  Way less boilerplate, and NO\r\n  metaprogramming needed.\r\n\r\n  If you need to opt out of CUDA testing, there is a new cpu_only\r\n  decorator you can use.\r\n\r\nBUYER BEWARE: I haven't actually tested this on GPU yet.\r\n\r\nSigned-off-by: Edward Z. Yang <ezyang@fb.com>"}