{"url": "https://api.github.com/repos/pytorch/pytorch/issues/9587", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/9587/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/9587/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/9587/events", "html_url": "https://github.com/pytorch/pytorch/issues/9587", "id": 342748640, "node_id": "MDU6SXNzdWUzNDI3NDg2NDA=", "number": 9587, "title": "Unable to convert models to ONNX with Sequential of Sequential in single Module", "user": {"login": "ksemianov", "id": 18328341, "node_id": "MDQ6VXNlcjE4MzI4MzQx", "avatar_url": "https://avatars1.githubusercontent.com/u/18328341?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ksemianov", "html_url": "https://github.com/ksemianov", "followers_url": "https://api.github.com/users/ksemianov/followers", "following_url": "https://api.github.com/users/ksemianov/following{/other_user}", "gists_url": "https://api.github.com/users/ksemianov/gists{/gist_id}", "starred_url": "https://api.github.com/users/ksemianov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ksemianov/subscriptions", "organizations_url": "https://api.github.com/users/ksemianov/orgs", "repos_url": "https://api.github.com/users/ksemianov/repos", "events_url": "https://api.github.com/users/ksemianov/events{/privacy}", "received_events_url": "https://api.github.com/users/ksemianov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 693805995, "node_id": "MDU6TGFiZWw2OTM4MDU5OTU=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/onnx", "name": "onnx", "color": "e99695", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-07-19T14:19:11Z", "updated_at": "2018-07-27T04:13:40Z", "closed_at": null, "author_association": "CONTRIBUTOR", "body_html": "<h2>Issue description</h2>\n<p>Unable to convert models to ONNX  with Sequential of Sequential in single Module. Code example is self explanatory.</p>\n<h2>Code example</h2>\n<pre><code>import torch\nfrom torch import nn\n\nclass Net1(nn.Module):\n    def __init__(self):\n        super().__init__()\n        self.net = nn.Sequential(nn.Conv2d(4, 4, 1))\n\n    def forward(self, x):\n        return self.net(x)\n\nclass Net2(nn.Module):\n    def __init__(self):\n        super().__init__()\n        self.subnet = nn.Sequential(nn.Conv2d(4, 4, 1))\n        self.net = nn.Sequential(self.subnet)\n\n    def forward(self, x):\n        return self.net(x)\n\ndummy_input = torch.Tensor(1, 4, 256, 256)\n\nprint('Started conversion of Net1')\ntorch.onnx.export(Net1(), dummy_input, 'net1.proto')\nprint('Finished conversion of Net1')\n\nprint('Started conversion of Net2')\ntorch.onnx.export(Net2(), dummy_input, 'net2.proto')\nprint('Finished conversion of Net2')\n</code></pre>\n<p>Output</p>\n<pre><code>Started conversion of Net1\nFinished conversion of Net1\nStarted conversion of Net2\nTraceback (most recent call last):\n  File \"export2ONNX.py\", line 28, in &lt;module&gt;\n    torch.onnx.export(Net2(), dummy_input, 'net2.proto')\n  File \"/anaconda3/lib/python3.6/site-packages/torch/onnx/__init__.py\", line 26, in export\n    return utils.export(*args, **kwargs)\n  File \"/anaconda3/lib/python3.6/site-packages/torch/onnx/utils.py\", line 94, in export\n    operator_export_type=operator_export_type)\n  File \"/anaconda3/lib/python3.6/site-packages/torch/onnx/utils.py\", line 232, in _export\n    proto, export_map = graph.export(params, _onnx_opset_version, defer_weight_export, operator_export_type)\nRuntimeError: /home/pytorch/torch/csrc/jit/export.cpp:296: encodeBlock: Assertion `b-&gt;inputs().size() &gt;= num_initializers` failed.\n</code></pre>\n<h2>System Info</h2>\n<p>PyTorch version: 0.5.0a0+54db14e<br>\nIs debug build: No<br>\nCUDA used to build PyTorch: None</p>\n<p>OS: Mac OSX 10.13.5<br>\nGCC version: Could not collect<br>\nCMake version: version 3.11.1</p>\n<p>Python version: 3.6<br>\nIs CUDA available: No<br>\nCUDA runtime version: No CUDA<br>\nGPU models and configuration: No CUDA<br>\nNvidia driver version: No CUDA<br>\ncuDNN version: No CUDA</p>\n<p>Versions of relevant libraries:<br>\n[pip] numpy (1.14.1)<br>\n[pip] torch (0.5.0a0+54db14e)<br>\n[conda] torch                     0.5.0a0+54db14e           </p>\n<p>PyTorch build command: <code>MACOSX_DEPLOYMENT_TARGET=10.13 CC=clang CXX=clang++ python setup.py install</code><br>\nClang version: Apple LLVM version 9.1.0 (clang-902.0.39.2)</p>", "body_text": "Issue description\nUnable to convert models to ONNX  with Sequential of Sequential in single Module. Code example is self explanatory.\nCode example\nimport torch\nfrom torch import nn\n\nclass Net1(nn.Module):\n    def __init__(self):\n        super().__init__()\n        self.net = nn.Sequential(nn.Conv2d(4, 4, 1))\n\n    def forward(self, x):\n        return self.net(x)\n\nclass Net2(nn.Module):\n    def __init__(self):\n        super().__init__()\n        self.subnet = nn.Sequential(nn.Conv2d(4, 4, 1))\n        self.net = nn.Sequential(self.subnet)\n\n    def forward(self, x):\n        return self.net(x)\n\ndummy_input = torch.Tensor(1, 4, 256, 256)\n\nprint('Started conversion of Net1')\ntorch.onnx.export(Net1(), dummy_input, 'net1.proto')\nprint('Finished conversion of Net1')\n\nprint('Started conversion of Net2')\ntorch.onnx.export(Net2(), dummy_input, 'net2.proto')\nprint('Finished conversion of Net2')\n\nOutput\nStarted conversion of Net1\nFinished conversion of Net1\nStarted conversion of Net2\nTraceback (most recent call last):\n  File \"export2ONNX.py\", line 28, in <module>\n    torch.onnx.export(Net2(), dummy_input, 'net2.proto')\n  File \"/anaconda3/lib/python3.6/site-packages/torch/onnx/__init__.py\", line 26, in export\n    return utils.export(*args, **kwargs)\n  File \"/anaconda3/lib/python3.6/site-packages/torch/onnx/utils.py\", line 94, in export\n    operator_export_type=operator_export_type)\n  File \"/anaconda3/lib/python3.6/site-packages/torch/onnx/utils.py\", line 232, in _export\n    proto, export_map = graph.export(params, _onnx_opset_version, defer_weight_export, operator_export_type)\nRuntimeError: /home/pytorch/torch/csrc/jit/export.cpp:296: encodeBlock: Assertion `b->inputs().size() >= num_initializers` failed.\n\nSystem Info\nPyTorch version: 0.5.0a0+54db14e\nIs debug build: No\nCUDA used to build PyTorch: None\nOS: Mac OSX 10.13.5\nGCC version: Could not collect\nCMake version: version 3.11.1\nPython version: 3.6\nIs CUDA available: No\nCUDA runtime version: No CUDA\nGPU models and configuration: No CUDA\nNvidia driver version: No CUDA\ncuDNN version: No CUDA\nVersions of relevant libraries:\n[pip] numpy (1.14.1)\n[pip] torch (0.5.0a0+54db14e)\n[conda] torch                     0.5.0a0+54db14e           \nPyTorch build command: MACOSX_DEPLOYMENT_TARGET=10.13 CC=clang CXX=clang++ python setup.py install\nClang version: Apple LLVM version 9.1.0 (clang-902.0.39.2)", "body": "## Issue description\r\n\r\nUnable to convert models to ONNX  with Sequential of Sequential in single Module. Code example is self explanatory. \r\n\r\n## Code example\r\n\r\n```\r\nimport torch\r\nfrom torch import nn\r\n\r\nclass Net1(nn.Module):\r\n    def __init__(self):\r\n        super().__init__()\r\n        self.net = nn.Sequential(nn.Conv2d(4, 4, 1))\r\n\r\n    def forward(self, x):\r\n        return self.net(x)\r\n\r\nclass Net2(nn.Module):\r\n    def __init__(self):\r\n        super().__init__()\r\n        self.subnet = nn.Sequential(nn.Conv2d(4, 4, 1))\r\n        self.net = nn.Sequential(self.subnet)\r\n\r\n    def forward(self, x):\r\n        return self.net(x)\r\n\r\ndummy_input = torch.Tensor(1, 4, 256, 256)\r\n\r\nprint('Started conversion of Net1')\r\ntorch.onnx.export(Net1(), dummy_input, 'net1.proto')\r\nprint('Finished conversion of Net1')\r\n\r\nprint('Started conversion of Net2')\r\ntorch.onnx.export(Net2(), dummy_input, 'net2.proto')\r\nprint('Finished conversion of Net2')\r\n```\r\n\r\nOutput\r\n```\r\nStarted conversion of Net1\r\nFinished conversion of Net1\r\nStarted conversion of Net2\r\nTraceback (most recent call last):\r\n  File \"export2ONNX.py\", line 28, in <module>\r\n    torch.onnx.export(Net2(), dummy_input, 'net2.proto')\r\n  File \"/anaconda3/lib/python3.6/site-packages/torch/onnx/__init__.py\", line 26, in export\r\n    return utils.export(*args, **kwargs)\r\n  File \"/anaconda3/lib/python3.6/site-packages/torch/onnx/utils.py\", line 94, in export\r\n    operator_export_type=operator_export_type)\r\n  File \"/anaconda3/lib/python3.6/site-packages/torch/onnx/utils.py\", line 232, in _export\r\n    proto, export_map = graph.export(params, _onnx_opset_version, defer_weight_export, operator_export_type)\r\nRuntimeError: /home/pytorch/torch/csrc/jit/export.cpp:296: encodeBlock: Assertion `b->inputs().size() >= num_initializers` failed.\r\n```\r\n\r\n## System Info\r\nPyTorch version: 0.5.0a0+54db14e\r\nIs debug build: No\r\nCUDA used to build PyTorch: None\r\n\r\nOS: Mac OSX 10.13.5\r\nGCC version: Could not collect\r\nCMake version: version 3.11.1\r\n\r\nPython version: 3.6\r\nIs CUDA available: No\r\nCUDA runtime version: No CUDA\r\nGPU models and configuration: No CUDA\r\nNvidia driver version: No CUDA\r\ncuDNN version: No CUDA\r\n\r\nVersions of relevant libraries:\r\n[pip] numpy (1.14.1)\r\n[pip] torch (0.5.0a0+54db14e)\r\n[conda] torch                     0.5.0a0+54db14e           <pip>\r\n\r\nPyTorch build command: ```MACOSX_DEPLOYMENT_TARGET=10.13 CC=clang CXX=clang++ python setup.py install```\r\nClang version: Apple LLVM version 9.1.0 (clang-902.0.39.2)\r\n"}