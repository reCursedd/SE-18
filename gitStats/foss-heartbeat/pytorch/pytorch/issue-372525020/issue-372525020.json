{"url": "https://api.github.com/repos/pytorch/pytorch/issues/12930", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/12930/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/12930/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/12930/events", "html_url": "https://github.com/pytorch/pytorch/issues/12930", "id": 372525020, "node_id": "MDU6SXNzdWUzNzI1MjUwMjA=", "number": 12930, "title": "USE_OPENMP=OFF is ignored [Caffe2]", "user": {"login": "Palmitoxico", "id": 8903198, "node_id": "MDQ6VXNlcjg5MDMxOTg=", "avatar_url": "https://avatars2.githubusercontent.com/u/8903198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Palmitoxico", "html_url": "https://github.com/Palmitoxico", "followers_url": "https://api.github.com/users/Palmitoxico/followers", "following_url": "https://api.github.com/users/Palmitoxico/following{/other_user}", "gists_url": "https://api.github.com/users/Palmitoxico/gists{/gist_id}", "starred_url": "https://api.github.com/users/Palmitoxico/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Palmitoxico/subscriptions", "organizations_url": "https://api.github.com/users/Palmitoxico/orgs", "repos_url": "https://api.github.com/users/Palmitoxico/repos", "events_url": "https://api.github.com/users/Palmitoxico/events{/privacy}", "received_events_url": "https://api.github.com/users/Palmitoxico/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 890282107, "node_id": "MDU6TGFiZWw4OTAyODIxMDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/caffe2", "name": "caffe2", "color": "210aa8", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-10-22T13:38:03Z", "updated_at": "2018-10-22T17:22:37Z", "closed_at": "2018-10-22T17:22:37Z", "author_association": "NONE", "body_html": "<p>Since <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/pytorch/pytorch/commit/f0d8a36e709dbf6a4c3aed7faf0da2b113668fe7/hovercard\" href=\"https://github.com/pytorch/pytorch/commit/f0d8a36e709dbf6a4c3aed7faf0da2b113668fe7\"><tt>f0d8a36</tt></a> the USE_OPENMP cmake flag is ignored and caffe2 is always linked against libgomp.so.</p>\n<h2>To Reproduce</h2>\n<p>Build current Caffe2 with <code>-DUSE_OPENMP=OFF</code>, inspect the libcaffe2.so file:</p>\n<pre><code>\n$  ldd libcaffe2.so\n        linux-vdso.so.1 =&gt;  (0x00007ffe90ac2000)\n        librt.so.1 =&gt; /lib64/librt.so.1 (0x00007fdeb32f2000)\n        libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007fdeb30dc000)\n        libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007fdeb2ed8000)\n        libm.so.6 =&gt; /lib64/libm.so.6 (0x00007fdeb2c54000)\n        libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007fdeb2a37000)\n        libstdc++.so.6 =&gt; /usr/lib64/libstdc++.so.6 (0x00007fdeb2731000)\n        <b>libgomp.so.1 =&gt; /usr/lib64/libgomp.so.1 (0x00007fdeb251c000)</b>\n        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fdeb2188000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007fdeb56b5000)\n</code></pre>\n<h2>Expected behavior</h2>\n<p>The libcaffe2.so should not depend on libgomp when building with <code>-DUSE_OPENMP=OFF</code></p>\n<h2>Environment</h2>\n<ul>\n<li>PyTorch/Caffe2 Version: <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/pytorch/pytorch/commit/6dd71947ea39b321dbc7c357122c2d685e973e7d/hovercard\" href=\"https://github.com/pytorch/pytorch/commit/6dd71947ea39b321dbc7c357122c2d685e973e7d\"><tt>6dd7194</tt></a></li>\n<li>OS: Centos 6 x86_64</li>\n<li>Build command used: <code>cmake ../.. -DCMAKE_INSTALL_PREFIX=\"$install_prefix\" -DBUILD_PYTHON=OFF -DUSE_CUDA=OFF -DUSE_NATIVE_ARCH=OFF -DUSE_GFLAGS=OFF -DUSE_GLOG=OFF -DUSE_GLOO=OFF -DBUILD_SHARED_LIBS=ON -DBUILD_TEST=OFF -DBUILD_BINARY=OFF -DUSE_LMDB=OFF -DUSE_LEVELDB=OFF -DUSE_MPI=OFF -DUSE_OPENMP=OFF -DUSE_OPENCV=OFF -DBUILD_ATEN=OFF -DUSE_NNPACK=OFF -DCAFFE2_DISABLE_NUMA=1 -DUSE_MKLDNN=OFF -DUSE_IDEEP=OFF -DUSE_MKLML=OFF -DUSE_DISTRIBUTED=OFF</code></li>\n<li>Python version: 2.7</li>\n</ul>", "body_text": "Since f0d8a36 the USE_OPENMP cmake flag is ignored and caffe2 is always linked against libgomp.so.\nTo Reproduce\nBuild current Caffe2 with -DUSE_OPENMP=OFF, inspect the libcaffe2.so file:\n\n$  ldd libcaffe2.so\n        linux-vdso.so.1 =>  (0x00007ffe90ac2000)\n        librt.so.1 => /lib64/librt.so.1 (0x00007fdeb32f2000)\n        libgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00007fdeb30dc000)\n        libdl.so.2 => /lib64/libdl.so.2 (0x00007fdeb2ed8000)\n        libm.so.6 => /lib64/libm.so.6 (0x00007fdeb2c54000)\n        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007fdeb2a37000)\n        libstdc++.so.6 => /usr/lib64/libstdc++.so.6 (0x00007fdeb2731000)\n        libgomp.so.1 => /usr/lib64/libgomp.so.1 (0x00007fdeb251c000)\n        libc.so.6 => /lib64/libc.so.6 (0x00007fdeb2188000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007fdeb56b5000)\n\nExpected behavior\nThe libcaffe2.so should not depend on libgomp when building with -DUSE_OPENMP=OFF\nEnvironment\n\nPyTorch/Caffe2 Version: 6dd7194\nOS: Centos 6 x86_64\nBuild command used: cmake ../.. -DCMAKE_INSTALL_PREFIX=\"$install_prefix\" -DBUILD_PYTHON=OFF -DUSE_CUDA=OFF -DUSE_NATIVE_ARCH=OFF -DUSE_GFLAGS=OFF -DUSE_GLOG=OFF -DUSE_GLOO=OFF -DBUILD_SHARED_LIBS=ON -DBUILD_TEST=OFF -DBUILD_BINARY=OFF -DUSE_LMDB=OFF -DUSE_LEVELDB=OFF -DUSE_MPI=OFF -DUSE_OPENMP=OFF -DUSE_OPENCV=OFF -DBUILD_ATEN=OFF -DUSE_NNPACK=OFF -DCAFFE2_DISABLE_NUMA=1 -DUSE_MKLDNN=OFF -DUSE_IDEEP=OFF -DUSE_MKLML=OFF -DUSE_DISTRIBUTED=OFF\nPython version: 2.7", "body": "Since f0d8a36e709dbf6a4c3aed7faf0da2b113668fe7 the USE_OPENMP cmake flag is ignored and caffe2 is always linked against libgomp.so.\r\n\r\n## To Reproduce\r\n\r\nBuild current Caffe2 with ```-DUSE_OPENMP=OFF```, inspect the libcaffe2.so file:\r\n\r\n<pre><code>\r\n$  ldd libcaffe2.so\r\n        linux-vdso.so.1 =>  (0x00007ffe90ac2000)\r\n        librt.so.1 => /lib64/librt.so.1 (0x00007fdeb32f2000)\r\n        libgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00007fdeb30dc000)\r\n        libdl.so.2 => /lib64/libdl.so.2 (0x00007fdeb2ed8000)\r\n        libm.so.6 => /lib64/libm.so.6 (0x00007fdeb2c54000)\r\n        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007fdeb2a37000)\r\n        libstdc++.so.6 => /usr/lib64/libstdc++.so.6 (0x00007fdeb2731000)\r\n        <b>libgomp.so.1 => /usr/lib64/libgomp.so.1 (0x00007fdeb251c000)</b>\r\n        libc.so.6 => /lib64/libc.so.6 (0x00007fdeb2188000)\r\n        /lib64/ld-linux-x86-64.so.2 (0x00007fdeb56b5000)\r\n</code></pre>\r\n\r\n## Expected behavior\r\n\r\nThe libcaffe2.so should not depend on libgomp when building with ```-DUSE_OPENMP=OFF```\r\n\r\n## Environment\r\n\r\n - PyTorch/Caffe2 Version: 6dd71947ea39b321dbc7c357122c2d685e973e7d\r\n - OS: Centos 6 x86_64\r\n - Build command used: ```cmake ../.. -DCMAKE_INSTALL_PREFIX=\"$install_prefix\" -DBUILD_PYTHON=OFF -DUSE_CUDA=OFF -DUSE_NATIVE_ARCH=OFF -DUSE_GFLAGS=OFF -DUSE_GLOG=OFF -DUSE_GLOO=OFF -DBUILD_SHARED_LIBS=ON -DBUILD_TEST=OFF -DBUILD_BINARY=OFF -DUSE_LMDB=OFF -DUSE_LEVELDB=OFF -DUSE_MPI=OFF -DUSE_OPENMP=OFF -DUSE_OPENCV=OFF -DBUILD_ATEN=OFF -DUSE_NNPACK=OFF -DCAFFE2_DISABLE_NUMA=1 -DUSE_MKLDNN=OFF -DUSE_IDEEP=OFF -DUSE_MKLML=OFF -DUSE_DISTRIBUTED=OFF```\r\n - Python version: 2.7\r\n\r\n"}