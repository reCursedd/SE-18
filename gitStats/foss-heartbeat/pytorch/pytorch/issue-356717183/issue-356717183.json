{"url": "https://api.github.com/repos/pytorch/pytorch/issues/11211", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/11211/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/11211/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/11211/events", "html_url": "https://github.com/pytorch/pytorch/issues/11211", "id": 356717183, "node_id": "MDU6SXNzdWUzNTY3MTcxODM=", "number": 11211, "title": "Importing torch breaks skimage.io.imload", "user": {"login": "FlashTek", "id": 5895436, "node_id": "MDQ6VXNlcjU4OTU0MzY=", "avatar_url": "https://avatars3.githubusercontent.com/u/5895436?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FlashTek", "html_url": "https://github.com/FlashTek", "followers_url": "https://api.github.com/users/FlashTek/followers", "following_url": "https://api.github.com/users/FlashTek/following{/other_user}", "gists_url": "https://api.github.com/users/FlashTek/gists{/gist_id}", "starred_url": "https://api.github.com/users/FlashTek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FlashTek/subscriptions", "organizations_url": "https://api.github.com/users/FlashTek/orgs", "repos_url": "https://api.github.com/users/FlashTek/repos", "events_url": "https://api.github.com/users/FlashTek/events{/privacy}", "received_events_url": "https://api.github.com/users/FlashTek/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-09-04T09:04:49Z", "updated_at": "2018-09-05T02:27:12Z", "closed_at": null, "author_association": "NONE", "body_html": "<h2>Issue description</h2>\n<p>Importing <code>torch</code> before importing <code>PIL</code> or <code>skimage</code> breaks these two libraries in some ways: loading some images is not possible as an exception is caused. This can be solved by executing this <em>after</em> the imports</p>\n<pre><code> from PIL import Image, ImageFile\n ImageFile.LOAD_TRUNCATED_IMAGES = True\n</code></pre>\n<p>but this does not seem as the intended behavior.</p>\n<h2>Code example</h2>\n<pre><code> # executing the code in this order is not working\n import torch\n from skimage import io\n\n io.imread('image.jpg')\n\n # executing in this order, it is\n from skimage import io\n import torch\n\n io.imread('image.jpg')\n</code></pre>\n<p><a href=\"https://user-images.githubusercontent.com/5895436/45022095-eb42a900-b065-11e8-98b0-37c29ee94bcd.jpg\" rel=\"nofollow\">This</a> is the image I used to get the error.</p>\n<h2>Stacktrace</h2>\n<pre><code>---------------------------------------------------------------------------\nOSError                                   Traceback (most recent call last)\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/skimage/io/_plugins/pil_plugin.py in pil_to_ndarray(image, dtype, img_num)\n     52         # this will raise an IOError if the file is not readable\n---&gt; 53         image.getdata()[0]\n     54     except IOError as e:\n\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/PIL/Image.py in getdata(self, band)\n   1233 \n-&gt; 1234         self.load()\n   1235         if band is not None:\n\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/PIL/ImageFile.py in load(self)\n    253             # still raised if decoder fails to return anything\n--&gt; 254             raise_ioerror(err_code)\n    255 \n\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/PIL/ImageFile.py in raise_ioerror(error)\n     58         message = \"decoder error %d\" % error\n---&gt; 59     raise IOError(message + \" when reading image file\")\n     60 \n\nOSError: broken data stream when reading image file\n\nDuring handling of the above exception, another exception occurred:\n\nValueError                                Traceback (most recent call last)\n&lt;ipython-input-1-3a91e073ace8&gt; in &lt;module&gt;()\n      2 from skimage import io\n      3 \n----&gt; 4 io.imread('image.jpg')\n\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/skimage/io/_io.py in imread(fname, as_gray, plugin, flatten, **plugin_args)\n     60 \n     61     with file_or_url_context(fname) as fname:\n---&gt; 62         img = call_plugin('imread', fname, plugin=plugin, **plugin_args)\n     63 \n     64     if not hasattr(img, 'ndim'):\n\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/skimage/io/manage_plugins.py in call_plugin(kind, *args, **kwargs)\n    212                                (plugin, kind))\n    213 \n--&gt; 214     return func(*args, **kwargs)\n    215 \n    216 \n\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/skimage/io/_plugins/pil_plugin.py in imread(fname, dtype, img_num, **kwargs)\n     35         with open(fname, 'rb') as f:\n     36             im = Image.open(f)\n---&gt; 37             return pil_to_ndarray(im, dtype=dtype, img_num=img_num)\n     38     else:\n     39         im = Image.open(fname)\n\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/skimage/io/_plugins/pil_plugin.py in pil_to_ndarray(image, dtype, img_num)\n     59                          'Please see documentation at: %s'\n     60                          % (image.filename, pillow_error_message, site))\n---&gt; 61         raise ValueError(error_message)\n     62     frames = []\n     63     grayscale = None\n\nValueError: Could not load \"\" \nReason: \"broken data stream when reading image file\"\nPlease see documentation at: http://pillow.readthedocs.org/en/latest/installation.html#external-libraries\n</code></pre>\n<h2>System Info</h2>\n<pre><code>Collecting environment information...\nPyTorch version: 0.5.0a0+0d5e4a2\nIs debug build: No\nCUDA used to build PyTorch: 8.0.61\n\nOS: Ubuntu 14.04.4 LTS\nGCC version: (Ubuntu 4.8.4-2ubuntu1~14.04.4) 4.8.4\nCMake version: version 3.12.0\n\nPython version: 3.6\nIs CUDA available: Yes\nCUDA runtime version: 8.0.61\nGPU models and configuration:\nGPU 0: Tesla K40c\nGPU 1: GeForce GTX 650\n\nNvidia driver version: 375.26\ncuDNN version: Probably one of the following:\n/usr/local/cuda-8.0/lib64/libcudnn.so.6.0.21\n/usr/local/cuda-8.0/lib64/libcudnn_static.a\n\nVersions of relevant libraries:\n[pip] numpy (1.15.1)\n[pip] torch (0.5.0a0+0d5e4a2)\n[pip] torchsummary (1.4)\n[pip] torchvision (0.2.1)\n[conda] cuda80                    1.0                  h205658b_0    pytorch\n[conda] magma-cuda80              2.3.0                         1    pytorch\n[conda] pytorch                   0.4.1           py36_cuda8.0.61_cudnn7.1.2_1  [cuda80]  pytorch\n[conda] torch                     0.5.0a0+0d5e4a2           &lt;pip&gt;\n[conda] torchsummary              1.4                       &lt;pip&gt;\n[conda] torchvision               0.2.1                    py36_1    pytorch\n\n</code></pre>", "body_text": "Issue description\nImporting torch before importing PIL or skimage breaks these two libraries in some ways: loading some images is not possible as an exception is caused. This can be solved by executing this after the imports\n from PIL import Image, ImageFile\n ImageFile.LOAD_TRUNCATED_IMAGES = True\n\nbut this does not seem as the intended behavior.\nCode example\n # executing the code in this order is not working\n import torch\n from skimage import io\n\n io.imread('image.jpg')\n\n # executing in this order, it is\n from skimage import io\n import torch\n\n io.imread('image.jpg')\n\nThis is the image I used to get the error.\nStacktrace\n---------------------------------------------------------------------------\nOSError                                   Traceback (most recent call last)\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/skimage/io/_plugins/pil_plugin.py in pil_to_ndarray(image, dtype, img_num)\n     52         # this will raise an IOError if the file is not readable\n---> 53         image.getdata()[0]\n     54     except IOError as e:\n\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/PIL/Image.py in getdata(self, band)\n   1233 \n-> 1234         self.load()\n   1235         if band is not None:\n\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/PIL/ImageFile.py in load(self)\n    253             # still raised if decoder fails to return anything\n--> 254             raise_ioerror(err_code)\n    255 \n\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/PIL/ImageFile.py in raise_ioerror(error)\n     58         message = \"decoder error %d\" % error\n---> 59     raise IOError(message + \" when reading image file\")\n     60 \n\nOSError: broken data stream when reading image file\n\nDuring handling of the above exception, another exception occurred:\n\nValueError                                Traceback (most recent call last)\n<ipython-input-1-3a91e073ace8> in <module>()\n      2 from skimage import io\n      3 \n----> 4 io.imread('image.jpg')\n\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/skimage/io/_io.py in imread(fname, as_gray, plugin, flatten, **plugin_args)\n     60 \n     61     with file_or_url_context(fname) as fname:\n---> 62         img = call_plugin('imread', fname, plugin=plugin, **plugin_args)\n     63 \n     64     if not hasattr(img, 'ndim'):\n\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/skimage/io/manage_plugins.py in call_plugin(kind, *args, **kwargs)\n    212                                (plugin, kind))\n    213 \n--> 214     return func(*args, **kwargs)\n    215 \n    216 \n\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/skimage/io/_plugins/pil_plugin.py in imread(fname, dtype, img_num, **kwargs)\n     35         with open(fname, 'rb') as f:\n     36             im = Image.open(f)\n---> 37             return pil_to_ndarray(im, dtype=dtype, img_num=img_num)\n     38     else:\n     39         im = Image.open(fname)\n\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/skimage/io/_plugins/pil_plugin.py in pil_to_ndarray(image, dtype, img_num)\n     59                          'Please see documentation at: %s'\n     60                          % (image.filename, pillow_error_message, site))\n---> 61         raise ValueError(error_message)\n     62     frames = []\n     63     grayscale = None\n\nValueError: Could not load \"\" \nReason: \"broken data stream when reading image file\"\nPlease see documentation at: http://pillow.readthedocs.org/en/latest/installation.html#external-libraries\n\nSystem Info\nCollecting environment information...\nPyTorch version: 0.5.0a0+0d5e4a2\nIs debug build: No\nCUDA used to build PyTorch: 8.0.61\n\nOS: Ubuntu 14.04.4 LTS\nGCC version: (Ubuntu 4.8.4-2ubuntu1~14.04.4) 4.8.4\nCMake version: version 3.12.0\n\nPython version: 3.6\nIs CUDA available: Yes\nCUDA runtime version: 8.0.61\nGPU models and configuration:\nGPU 0: Tesla K40c\nGPU 1: GeForce GTX 650\n\nNvidia driver version: 375.26\ncuDNN version: Probably one of the following:\n/usr/local/cuda-8.0/lib64/libcudnn.so.6.0.21\n/usr/local/cuda-8.0/lib64/libcudnn_static.a\n\nVersions of relevant libraries:\n[pip] numpy (1.15.1)\n[pip] torch (0.5.0a0+0d5e4a2)\n[pip] torchsummary (1.4)\n[pip] torchvision (0.2.1)\n[conda] cuda80                    1.0                  h205658b_0    pytorch\n[conda] magma-cuda80              2.3.0                         1    pytorch\n[conda] pytorch                   0.4.1           py36_cuda8.0.61_cudnn7.1.2_1  [cuda80]  pytorch\n[conda] torch                     0.5.0a0+0d5e4a2           <pip>\n[conda] torchsummary              1.4                       <pip>\n[conda] torchvision               0.2.1                    py36_1    pytorch", "body": "## Issue description\r\n\r\nImporting `torch` before importing `PIL` or `skimage` breaks these two libraries in some ways: loading some images is not possible as an exception is caused. This can be solved by executing this *after* the imports\r\n\r\n     from PIL import Image, ImageFile\r\n     ImageFile.LOAD_TRUNCATED_IMAGES = True\r\n\r\nbut this does not seem as the intended behavior.\r\n\r\n## Code example\r\n\r\n\r\n     # executing the code in this order is not working\r\n     import torch\r\n     from skimage import io\r\n\r\n     io.imread('image.jpg')\r\n\r\n     # executing in this order, it is\r\n     from skimage import io\r\n     import torch\r\n\r\n     io.imread('image.jpg')\r\n\r\n[This](https://user-images.githubusercontent.com/5895436/45022095-eb42a900-b065-11e8-98b0-37c29ee94bcd.jpg) is the image I used to get the error.\r\n\r\n## Stacktrace\r\n\r\n```\r\n---------------------------------------------------------------------------\r\nOSError                                   Traceback (most recent call last)\r\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/skimage/io/_plugins/pil_plugin.py in pil_to_ndarray(image, dtype, img_num)\r\n     52         # this will raise an IOError if the file is not readable\r\n---> 53         image.getdata()[0]\r\n     54     except IOError as e:\r\n\r\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/PIL/Image.py in getdata(self, band)\r\n   1233 \r\n-> 1234         self.load()\r\n   1235         if band is not None:\r\n\r\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/PIL/ImageFile.py in load(self)\r\n    253             # still raised if decoder fails to return anything\r\n--> 254             raise_ioerror(err_code)\r\n    255 \r\n\r\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/PIL/ImageFile.py in raise_ioerror(error)\r\n     58         message = \"decoder error %d\" % error\r\n---> 59     raise IOError(message + \" when reading image file\")\r\n     60 \r\n\r\nOSError: broken data stream when reading image file\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-1-3a91e073ace8> in <module>()\r\n      2 from skimage import io\r\n      3 \r\n----> 4 io.imread('image.jpg')\r\n\r\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/skimage/io/_io.py in imread(fname, as_gray, plugin, flatten, **plugin_args)\r\n     60 \r\n     61     with file_or_url_context(fname) as fname:\r\n---> 62         img = call_plugin('imread', fname, plugin=plugin, **plugin_args)\r\n     63 \r\n     64     if not hasattr(img, 'ndim'):\r\n\r\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/skimage/io/manage_plugins.py in call_plugin(kind, *args, **kwargs)\r\n    212                                (plugin, kind))\r\n    213 \r\n--> 214     return func(*args, **kwargs)\r\n    215 \r\n    216 \r\n\r\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/skimage/io/_plugins/pil_plugin.py in imread(fname, dtype, img_num, **kwargs)\r\n     35         with open(fname, 'rb') as f:\r\n     36             im = Image.open(f)\r\n---> 37             return pil_to_ndarray(im, dtype=dtype, img_num=img_num)\r\n     38     else:\r\n     39         im = Image.open(fname)\r\n\r\n~/anaconda2/envs/pytorch04/lib/python3.6/site-packages/skimage/io/_plugins/pil_plugin.py in pil_to_ndarray(image, dtype, img_num)\r\n     59                          'Please see documentation at: %s'\r\n     60                          % (image.filename, pillow_error_message, site))\r\n---> 61         raise ValueError(error_message)\r\n     62     frames = []\r\n     63     grayscale = None\r\n\r\nValueError: Could not load \"\" \r\nReason: \"broken data stream when reading image file\"\r\nPlease see documentation at: http://pillow.readthedocs.org/en/latest/installation.html#external-libraries\r\n```\r\n\r\n## System Info\r\n```\r\nCollecting environment information...\r\nPyTorch version: 0.5.0a0+0d5e4a2\r\nIs debug build: No\r\nCUDA used to build PyTorch: 8.0.61\r\n\r\nOS: Ubuntu 14.04.4 LTS\r\nGCC version: (Ubuntu 4.8.4-2ubuntu1~14.04.4) 4.8.4\r\nCMake version: version 3.12.0\r\n\r\nPython version: 3.6\r\nIs CUDA available: Yes\r\nCUDA runtime version: 8.0.61\r\nGPU models and configuration:\r\nGPU 0: Tesla K40c\r\nGPU 1: GeForce GTX 650\r\n\r\nNvidia driver version: 375.26\r\ncuDNN version: Probably one of the following:\r\n/usr/local/cuda-8.0/lib64/libcudnn.so.6.0.21\r\n/usr/local/cuda-8.0/lib64/libcudnn_static.a\r\n\r\nVersions of relevant libraries:\r\n[pip] numpy (1.15.1)\r\n[pip] torch (0.5.0a0+0d5e4a2)\r\n[pip] torchsummary (1.4)\r\n[pip] torchvision (0.2.1)\r\n[conda] cuda80                    1.0                  h205658b_0    pytorch\r\n[conda] magma-cuda80              2.3.0                         1    pytorch\r\n[conda] pytorch                   0.4.1           py36_cuda8.0.61_cudnn7.1.2_1  [cuda80]  pytorch\r\n[conda] torch                     0.5.0a0+0d5e4a2           <pip>\r\n[conda] torchsummary              1.4                       <pip>\r\n[conda] torchvision               0.2.1                    py36_1    pytorch\r\n\r\n```\r\n"}