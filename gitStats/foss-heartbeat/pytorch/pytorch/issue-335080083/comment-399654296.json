{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/399654296", "html_url": "https://github.com/pytorch/pytorch/issues/8820#issuecomment-399654296", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/8820", "id": 399654296, "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTY1NDI5Ng==", "user": {"login": "saturdays", "id": 5194117, "node_id": "MDQ6VXNlcjUxOTQxMTc=", "avatar_url": "https://avatars3.githubusercontent.com/u/5194117?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saturdays", "html_url": "https://github.com/saturdays", "followers_url": "https://api.github.com/users/saturdays/followers", "following_url": "https://api.github.com/users/saturdays/following{/other_user}", "gists_url": "https://api.github.com/users/saturdays/gists{/gist_id}", "starred_url": "https://api.github.com/users/saturdays/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saturdays/subscriptions", "organizations_url": "https://api.github.com/users/saturdays/orgs", "repos_url": "https://api.github.com/users/saturdays/repos", "events_url": "https://api.github.com/users/saturdays/events{/privacy}", "received_events_url": "https://api.github.com/users/saturdays/received_events", "type": "User", "site_admin": false}, "created_at": "2018-06-23T08:54:15Z", "updated_at": "2018-06-23T15:16:13Z", "author_association": "NONE", "body_html": "<p>Here is another test:<br>\n(1) I save and load the weights every epoch, the model works fine and converges during training:</p>\n<pre><code>epoch=1\nwhile acc &lt; 0.97:\n     epoch += 1\n     acc1 = train(args, model, device, train_loader, optimizer, epoch)\n     torch.save(model.state_dict(), 'checkpoints/mnist_gpu_%d.pkl'%epoch)\n     model.load_state_dict(torch.load('checkpoints/mnist_gpu_%d.pkl'%epoch), strict=True)\\\n     acc2 = test(args, model, device, test_loader)\n     acc = (acc1+acc2)*0.5\n</code></pre>\n<p>(2) But, If a comment train and only do inference. Model changed. Acc goes to 1%</p>\n<pre><code>   epoch = 69\n    while acc &lt; 0.97:\n        epoch += 1\n        adjust_learning_rate(optimizer, epoch)\n        #acc1 = train(args, model, device, train_loader, optimizer, epoch)\n        #torch.save(model.state_dict(), 'checkpoints/mnist_gpu_%d.pkl'%epoch)\n        model.load_state_dict(torch.load('checkpoints/mnist_gpu_%d.pkl'%epoch), strict=True)\n        acc2 = test(args, model, device, test_loader)\n        print(acc2)\n        break\n</code></pre>", "body_text": "Here is another test:\n(1) I save and load the weights every epoch, the model works fine and converges during training:\nepoch=1\nwhile acc < 0.97:\n     epoch += 1\n     acc1 = train(args, model, device, train_loader, optimizer, epoch)\n     torch.save(model.state_dict(), 'checkpoints/mnist_gpu_%d.pkl'%epoch)\n     model.load_state_dict(torch.load('checkpoints/mnist_gpu_%d.pkl'%epoch), strict=True)\\\n     acc2 = test(args, model, device, test_loader)\n     acc = (acc1+acc2)*0.5\n\n(2) But, If a comment train and only do inference. Model changed. Acc goes to 1%\n   epoch = 69\n    while acc < 0.97:\n        epoch += 1\n        adjust_learning_rate(optimizer, epoch)\n        #acc1 = train(args, model, device, train_loader, optimizer, epoch)\n        #torch.save(model.state_dict(), 'checkpoints/mnist_gpu_%d.pkl'%epoch)\n        model.load_state_dict(torch.load('checkpoints/mnist_gpu_%d.pkl'%epoch), strict=True)\n        acc2 = test(args, model, device, test_loader)\n        print(acc2)\n        break", "body": "Here is another test:\r\n(1) I save and load the weights every epoch, the model works fine and converges during training:\r\n\r\n```\r\nepoch=1\r\nwhile acc < 0.97:\r\n     epoch += 1\r\n     acc1 = train(args, model, device, train_loader, optimizer, epoch)\r\n     torch.save(model.state_dict(), 'checkpoints/mnist_gpu_%d.pkl'%epoch)\r\n     model.load_state_dict(torch.load('checkpoints/mnist_gpu_%d.pkl'%epoch), strict=True)\\\r\n     acc2 = test(args, model, device, test_loader)\r\n     acc = (acc1+acc2)*0.5\r\n```\r\n\r\n(2) But, If a comment train and only do inference. Model changed. Acc goes to 1%\r\n\r\n```\r\n   epoch = 69\r\n    while acc < 0.97:\r\n        epoch += 1\r\n        adjust_learning_rate(optimizer, epoch)\r\n        #acc1 = train(args, model, device, train_loader, optimizer, epoch)\r\n        #torch.save(model.state_dict(), 'checkpoints/mnist_gpu_%d.pkl'%epoch)\r\n        model.load_state_dict(torch.load('checkpoints/mnist_gpu_%d.pkl'%epoch), strict=True)\r\n        acc2 = test(args, model, device, test_loader)\r\n        print(acc2)\r\n        break\r\n```"}