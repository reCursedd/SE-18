{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/155662423", "pull_request_review_id": 82019277, "id": 155662423, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NTY2MjQyMw==", "diff_hunk": "@@ -136,13 +135,14 @@ def __init__(self, module, device_ids=None, output_device=None, dim=0):\n             bucket_bytes_cap = 1 * MB\n         bucket_bytes = bucket_bytes_cap  # to init the first bucket immediately\n         for param_tuple in zip(*map(lambda m: m.parameters(), self._module_copies)):\n-            if bucket_bytes >= bucket_bytes_cap:\n-                self.bucket_sizes.append(0)\n-                bucket_bytes = 0\n-            self.bucket_sizes[-1] += 1\n-            for p in param_tuple:\n-                self.bucket_map[p] = len(self.bucket_sizes) - 1\n-            bucket_bytes += p.numel() * p.element_size()\n+            if param_tuple[0].requires_grad:", "path": "torch/nn/parallel/distributed.py", "position": 19, "original_position": 19, "commit_id": "843bd58691b0e9c39b82038287d070aec6586707", "original_commit_id": "843bd58691b0e9c39b82038287d070aec6586707", "user": {"login": "ngimel", "id": 15841449, "node_id": "MDQ6VXNlcjE1ODQxNDQ5", "avatar_url": "https://avatars3.githubusercontent.com/u/15841449?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ngimel", "html_url": "https://github.com/ngimel", "followers_url": "https://api.github.com/users/ngimel/followers", "following_url": "https://api.github.com/users/ngimel/following{/other_user}", "gists_url": "https://api.github.com/users/ngimel/gists{/gist_id}", "starred_url": "https://api.github.com/users/ngimel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ngimel/subscriptions", "organizations_url": "https://api.github.com/users/ngimel/orgs", "repos_url": "https://api.github.com/users/ngimel/repos", "events_url": "https://api.github.com/users/ngimel/events{/privacy}", "received_events_url": "https://api.github.com/users/ngimel/received_events", "type": "User", "site_admin": false}, "body": "What is happening now is also really bad (as detailed in #2533), and it is fundamental deficiency of how distributed data parallel is written now. Now, if you have some parameters that don't require grad, you still include them in the buckets, so all the buckets won't be filled per iteration, and reductions are happening at unpredictable moments in time. ", "created_at": "2017-12-07T22:42:55Z", "updated_at": "2018-11-23T15:37:09Z", "html_url": "https://github.com/pytorch/pytorch/pull/4044#discussion_r155662423", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/4044", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/155662423"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/4044#discussion_r155662423"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/4044"}}, "body_html": "<p>What is happening now is also really bad (as detailed in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"252738046\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/2533\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/2533/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/2533\">#2533</a>), and it is fundamental deficiency of how distributed data parallel is written now. Now, if you have some parameters that don't require grad, you still include them in the buckets, so all the buckets won't be filled per iteration, and reductions are happening at unpredictable moments in time.</p>", "body_text": "What is happening now is also really bad (as detailed in #2533), and it is fundamental deficiency of how distributed data parallel is written now. Now, if you have some parameters that don't require grad, you still include them in the buckets, so all the buckets won't be filled per iteration, and reductions are happening at unpredictable moments in time.", "in_reply_to_id": 155660851}