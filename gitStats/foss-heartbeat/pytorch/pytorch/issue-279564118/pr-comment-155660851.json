{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/155660851", "pull_request_review_id": 82017488, "id": 155660851, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NTY2MDg1MQ==", "diff_hunk": "@@ -136,13 +135,14 @@ def __init__(self, module, device_ids=None, output_device=None, dim=0):\n             bucket_bytes_cap = 1 * MB\n         bucket_bytes = bucket_bytes_cap  # to init the first bucket immediately\n         for param_tuple in zip(*map(lambda m: m.parameters(), self._module_copies)):\n-            if bucket_bytes >= bucket_bytes_cap:\n-                self.bucket_sizes.append(0)\n-                bucket_bytes = 0\n-            self.bucket_sizes[-1] += 1\n-            for p in param_tuple:\n-                self.bucket_map[p] = len(self.bucket_sizes) - 1\n-            bucket_bytes += p.numel() * p.element_size()\n+            if param_tuple[0].requires_grad:", "path": "torch/nn/parallel/distributed.py", "position": 19, "original_position": 19, "commit_id": "843bd58691b0e9c39b82038287d070aec6586707", "original_commit_id": "843bd58691b0e9c39b82038287d070aec6586707", "user": {"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}, "body": "The code could still be simplified and the whole diff could be two lines (I'd rather not move the logic around like you did below):\r\n```python\r\nif not param_tuple[0].requires_grad:\r\n    continue\r\n```\r\nWe should also give it some more thought. We will never check these flags again right now, and we should either make sure that they are never changed, or we will be missing gradient reductions for a subset of parameters which is really bad.", "created_at": "2017-12-07T22:35:03Z", "updated_at": "2018-11-23T15:37:09Z", "html_url": "https://github.com/pytorch/pytorch/pull/4044#discussion_r155660851", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/4044", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/155660851"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/4044#discussion_r155660851"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/4044"}}, "body_html": "<p>The code could still be simplified and the whole diff could be two lines (I'd rather not move the logic around like you did below):</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">if</span> <span class=\"pl-k\">not</span> param_tuple[<span class=\"pl-c1\">0</span>].requires_grad:\n    <span class=\"pl-k\">continue</span></pre></div>\n<p>We should also give it some more thought. We will never check these flags again right now, and we should either make sure that they are never changed, or we will be missing gradient reductions for a subset of parameters which is really bad.</p>", "body_text": "The code could still be simplified and the whole diff could be two lines (I'd rather not move the logic around like you did below):\nif not param_tuple[0].requires_grad:\n    continue\nWe should also give it some more thought. We will never check these flags again right now, and we should either make sure that they are never changed, or we will be missing gradient reductions for a subset of parameters which is really bad."}