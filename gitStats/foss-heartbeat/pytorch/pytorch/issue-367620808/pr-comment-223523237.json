{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/223523237", "pull_request_review_id": 162671405, "id": 223523237, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMzUyMzIzNw==", "diff_hunk": "@@ -225,19 +225,30 @@ struct NormReduction {\n   }\n \n   static scalar_t reduce_all(const scalar_t* data_, int64_t size,  float pval) {\n-    scalar_t sum = parallel_reduce(\n-      0,\n-      size,\n-      internal::GRAIN_SIZE,\n-      (scalar_t)0,\n-      [=](int64_t begin, int64_t end, scalar_t init) {\n-        const scalar_t* data = &data_[begin];\n-        int64_t n = end - begin;\n-        scalar_t result = norm_reduce(data, n, 1, pval);\n-        return result;\n-      },\n-      std::plus<scalar_t>());\n-    return sum;\n+    scalar_t result = 0;\n+    if (std::isinf(pval)){\n+      result = norm_reduce_sequential(data_, size, 1, pval);\n+    } else {\n+      result = parallel_reduce(\n+        0,\n+        size,\n+        internal::GRAIN_SIZE,\n+        (scalar_t)0,\n+        [=](int64_t begin, int64_t end, scalar_t init) {\n+          const scalar_t* data = &data_[begin];\n+          int64_t n = end - begin;\n+          scalar_t result_local = norm_reduce(data, n, 1, pval);\n+          if (pval != 0) {\n+            result_local = std::pow(result_local, pval);", "path": "aten/src/ATen/native/cpu/ReduceOpsKernel.cpp", "position": null, "original_position": 31, "commit_id": "59069619c1d58c564ea885b86b518bc27893cd45", "original_commit_id": "c72eea411fe22c46c73d59d9efe8dfeaf5c29cba", "user": {"login": "colesbury", "id": 655866, "node_id": "MDQ6VXNlcjY1NTg2Ng==", "avatar_url": "https://avatars1.githubusercontent.com/u/655866?v=4", "gravatar_id": "", "url": "https://api.github.com/users/colesbury", "html_url": "https://github.com/colesbury", "followers_url": "https://api.github.com/users/colesbury/followers", "following_url": "https://api.github.com/users/colesbury/following{/other_user}", "gists_url": "https://api.github.com/users/colesbury/gists{/gist_id}", "starred_url": "https://api.github.com/users/colesbury/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/colesbury/subscriptions", "organizations_url": "https://api.github.com/users/colesbury/orgs", "repos_url": "https://api.github.com/users/colesbury/repos", "events_url": "https://api.github.com/users/colesbury/events{/privacy}", "received_events_url": "https://api.github.com/users/colesbury/received_events", "type": "User", "site_admin": false}, "body": "Yes, we should fix that. I'm going to merge this as-is because it fixes the most important issue.", "created_at": "2018-10-08T23:22:03Z", "updated_at": "2018-11-23T15:52:38Z", "html_url": "https://github.com/pytorch/pytorch/pull/12444#discussion_r223523237", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/12444", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/223523237"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/12444#discussion_r223523237"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/12444"}}, "body_html": "<p>Yes, we should fix that. I'm going to merge this as-is because it fixes the most important issue.</p>", "body_text": "Yes, we should fix that. I'm going to merge this as-is because it fixes the most important issue.", "in_reply_to_id": 223295612}