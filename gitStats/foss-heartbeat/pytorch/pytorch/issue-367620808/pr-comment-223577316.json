{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/223577316", "pull_request_review_id": 162736317, "id": 223577316, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMzU3NzMxNg==", "diff_hunk": "@@ -225,19 +225,30 @@ struct NormReduction {\n   }\n \n   static scalar_t reduce_all(const scalar_t* data_, int64_t size,  float pval) {\n-    scalar_t sum = parallel_reduce(\n-      0,\n-      size,\n-      internal::GRAIN_SIZE,\n-      (scalar_t)0,\n-      [=](int64_t begin, int64_t end, scalar_t init) {\n-        const scalar_t* data = &data_[begin];\n-        int64_t n = end - begin;\n-        scalar_t result = norm_reduce(data, n, 1, pval);\n-        return result;\n-      },\n-      std::plus<scalar_t>());\n-    return sum;\n+    scalar_t result = 0;\n+    if (std::isinf(pval)){\n+      result = norm_reduce_sequential(data_, size, 1, pval);\n+    } else {\n+      result = parallel_reduce(\n+        0,\n+        size,\n+        internal::GRAIN_SIZE,\n+        (scalar_t)0,\n+        [=](int64_t begin, int64_t end, scalar_t init) {\n+          const scalar_t* data = &data_[begin];\n+          int64_t n = end - begin;\n+          scalar_t result_local = norm_reduce(data, n, 1, pval);\n+          if (pval != 0) {\n+            result_local = std::pow(result_local, pval);", "path": "aten/src/ATen/native/cpu/ReduceOpsKernel.cpp", "position": null, "original_position": 31, "commit_id": "59069619c1d58c564ea885b86b518bc27893cd45", "original_commit_id": "c72eea411fe22c46c73d59d9efe8dfeaf5c29cba", "user": {"login": "xhzhao", "id": 17486215, "node_id": "MDQ6VXNlcjE3NDg2MjE1", "avatar_url": "https://avatars1.githubusercontent.com/u/17486215?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xhzhao", "html_url": "https://github.com/xhzhao", "followers_url": "https://api.github.com/users/xhzhao/followers", "following_url": "https://api.github.com/users/xhzhao/following{/other_user}", "gists_url": "https://api.github.com/users/xhzhao/gists{/gist_id}", "starred_url": "https://api.github.com/users/xhzhao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xhzhao/subscriptions", "organizations_url": "https://api.github.com/users/xhzhao/orgs", "repos_url": "https://api.github.com/users/xhzhao/repos", "events_url": "https://api.github.com/users/xhzhao/events{/privacy}", "received_events_url": "https://api.github.com/users/xhzhao/received_events", "type": "User", "site_admin": false}, "body": "Yes, the precision issue fixed in the second commit, thanks for your comments.", "created_at": "2018-10-09T06:48:48Z", "updated_at": "2018-11-23T15:52:39Z", "html_url": "https://github.com/pytorch/pytorch/pull/12444#discussion_r223577316", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/12444", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/223577316"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/12444#discussion_r223577316"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/12444"}}, "body_html": "<p>Yes, the precision issue fixed in the second commit, thanks for your comments.</p>", "body_text": "Yes, the precision issue fixed in the second commit, thanks for your comments.", "in_reply_to_id": 223295612}