{"url": "https://api.github.com/repos/pytorch/pytorch/issues/11108", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/11108/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/11108/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/11108/events", "html_url": "https://github.com/pytorch/pytorch/issues/11108", "id": 355752587, "node_id": "MDU6SXNzdWUzNTU3NTI1ODc=", "number": 11108, "title": "[Caffe2] DLL Interface Errors from nomnigraph.", "user": {"login": "xkszltl", "id": 5203025, "node_id": "MDQ6VXNlcjUyMDMwMjU=", "avatar_url": "https://avatars0.githubusercontent.com/u/5203025?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xkszltl", "html_url": "https://github.com/xkszltl", "followers_url": "https://api.github.com/users/xkszltl/followers", "following_url": "https://api.github.com/users/xkszltl/following{/other_user}", "gists_url": "https://api.github.com/users/xkszltl/gists{/gist_id}", "starred_url": "https://api.github.com/users/xkszltl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xkszltl/subscriptions", "organizations_url": "https://api.github.com/users/xkszltl/orgs", "repos_url": "https://api.github.com/users/xkszltl/repos", "events_url": "https://api.github.com/users/xkszltl/events{/privacy}", "received_events_url": "https://api.github.com/users/xkszltl/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-08-30T21:01:29Z", "updated_at": "2018-09-02T21:40:52Z", "closed_at": "2018-09-02T21:40:52Z", "author_association": "CONTRIBUTOR", "body_html": "<h2>Issue description</h2>\n<p>Getting compile error from nomnigraph about DLL interfaces.</p>\n<pre><code>\"build\\ALL_BUILD.vcxproj\" (default target) (1) -&gt;\n\"build\\caffe2\\apply_utils_test.vcxproj\" (default target) (4) -&gt;\n\"build\\caffe2\\caffe2.vcxproj\" (default target) (5) -&gt;\n\"build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj\" (default target) (12) -&gt;\n(ClCompile target) -&gt;\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\compiler.h(28): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\compiler.h(57): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\compiler.h(28): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\compiler.h(57): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\controlflow.h(147): error C2491: 'nom::repr::addSSA': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\controlflow.h(147): error C2491: 'nom::repr::addSSA': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(171): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(171): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(213): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(220): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(213): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(229): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(220): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(229): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(354): error C2491: 'nom::repr::nn::nodeIterator': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(354): error C2491: 'nom::repr::nn::nodeIterator': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(367): error C2491: 'nom::repr::nn::dataIterator': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(367): error C2491: 'nom::repr::nn::dataIterator': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(397): error C2491: 'nom::repr::nn::insertOp': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(397): error C2491: 'nom::repr::nn::insertOp': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(413): error C2491: 'nom::repr::nn::convertNode': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(413): error C2491: 'nom::repr::nn::convertNode': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(470): error C2491: 'nom::repr::nn::matchOp': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(470): error C2491: 'nom::repr::nn::matchOp': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(485): error C2491: 'nom::repr::nn::matchOp': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(485): error C2491: 'nom::repr::nn::matchOp': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(490): error C2487: 'isMatch': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(490): error C2487: 'isMatch': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n\n    570 Warning(s)\n    28 Error(s)\n</code></pre>\n<p>Seems that VS is no happy with nested dll interface.</p>\n<pre><code>class CAFFE2_API Data : public Value {\n public:\n  Data() : Value(ValueKind::Data) {}\n  CAFFE2_API static bool classof(const Value* V) {\n    return V-&gt;getKind() == ValueKind::Data;\n  }\n  virtual ~Data() = default;\n  size_t getVersion() const {\n    return version_;\n  }\n\n  void setVersion(size_t version) {\n    version_ = version;\n  }\n\n private:\n  size_t version_ = 0;\n};\n</code></pre>\n<h2>System Info</h2>\n<ul>\n<li>PyTorch or Caffe2: Caffe2</li>\n<li>How you installed PyTorch (conda, pip, source): source</li>\n<li>Build command you used (if compiling from source): cmake</li>\n<li>OS: Win10</li>\n<li>PyTorch version: master</li>\n<li>VS version (if compiling from source): 2017</li>\n<li>CMake version: 3.11.4</li>\n</ul>", "body_text": "Issue description\nGetting compile error from nomnigraph about DLL interfaces.\n\"build\\ALL_BUILD.vcxproj\" (default target) (1) ->\n\"build\\caffe2\\apply_utils_test.vcxproj\" (default target) (4) ->\n\"build\\caffe2\\caffe2.vcxproj\" (default target) (5) ->\n\"build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj\" (default target) (12) ->\n(ClCompile target) ->\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\compiler.h(28): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\compiler.h(57): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\compiler.h(28): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\compiler.h(57): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\controlflow.h(147): error C2491: 'nom::repr::addSSA': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\controlflow.h(147): error C2491: 'nom::repr::addSSA': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(171): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(171): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(213): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(220): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(213): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(229): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(220): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(229): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(354): error C2491: 'nom::repr::nn::nodeIterator': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(354): error C2491: 'nom::repr::nn::nodeIterator': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(367): error C2491: 'nom::repr::nn::dataIterator': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(367): error C2491: 'nom::repr::nn::dataIterator': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(397): error C2491: 'nom::repr::nn::insertOp': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(397): error C2491: 'nom::repr::nn::insertOp': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(413): error C2491: 'nom::repr::nn::convertNode': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(413): error C2491: 'nom::repr::nn::convertNode': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(470): error C2491: 'nom::repr::nn::matchOp': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(470): error C2491: 'nom::repr::nn::matchOp': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(485): error C2491: 'nom::repr::nn::matchOp': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(485): error C2491: 'nom::repr::nn::matchOp': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(490): error C2487: 'isMatch': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(490): error C2487: 'isMatch': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\n\n    570 Warning(s)\n    28 Error(s)\n\nSeems that VS is no happy with nested dll interface.\nclass CAFFE2_API Data : public Value {\n public:\n  Data() : Value(ValueKind::Data) {}\n  CAFFE2_API static bool classof(const Value* V) {\n    return V->getKind() == ValueKind::Data;\n  }\n  virtual ~Data() = default;\n  size_t getVersion() const {\n    return version_;\n  }\n\n  void setVersion(size_t version) {\n    version_ = version;\n  }\n\n private:\n  size_t version_ = 0;\n};\n\nSystem Info\n\nPyTorch or Caffe2: Caffe2\nHow you installed PyTorch (conda, pip, source): source\nBuild command you used (if compiling from source): cmake\nOS: Win10\nPyTorch version: master\nVS version (if compiling from source): 2017\nCMake version: 3.11.4", "body": "## Issue description\r\n\r\nGetting compile error from nomnigraph about DLL interfaces.\r\n\r\n```\r\n\"build\\ALL_BUILD.vcxproj\" (default target) (1) ->\r\n\"build\\caffe2\\apply_utils_test.vcxproj\" (default target) (4) ->\r\n\"build\\caffe2\\caffe2.vcxproj\" (default target) (5) ->\r\n\"build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj\" (default target) (12) ->\r\n(ClCompile target) ->\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\compiler.h(28): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\compiler.h(57): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\compiler.h(28): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\compiler.h(57): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\controlflow.h(147): error C2491: 'nom::repr::addSSA': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\controlflow.h(147): error C2491: 'nom::repr::addSSA': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(171): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(171): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(213): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(220): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(213): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(229): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(220): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(229): error C2487: 'classof': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(354): error C2491: 'nom::repr::nn::nodeIterator': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(354): error C2491: 'nom::repr::nn::nodeIterator': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(367): error C2491: 'nom::repr::nn::dataIterator': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(367): error C2491: 'nom::repr::nn::dataIterator': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(397): error C2491: 'nom::repr::nn::insertOp': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(397): error C2491: 'nom::repr::nn::insertOp': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(413): error C2491: 'nom::repr::nn::convertNode': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(413): error C2491: 'nom::repr::nn::convertNode': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(470): error C2491: 'nom::repr::nn::matchOp': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(470): error C2491: 'nom::repr::nn::matchOp': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(485): error C2491: 'nom::repr::nn::matchOp': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(485): error C2491: 'nom::repr::nn::matchOp': definition of dllimport function not allowed (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(490): error C2487: 'isMatch': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\Representations\\NeuralNet.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n  caffe2\\core\\nomnigraph\\include\\nomnigraph\\representations\\neuralnet.h(490): error C2487: 'isMatch': member of dll interface class may not be declared with dll interface (compiling source file caffe2\\core\\nomnigraph\\tests\\test_util.cc) [build\\caffe2\\core\\nomnigraph\\nomnigraph.vcxproj]\r\n\r\n    570 Warning(s)\r\n    28 Error(s)\r\n```\r\n\r\nSeems that VS is no happy with nested dll interface.\r\n```\r\nclass CAFFE2_API Data : public Value {\r\n public:\r\n  Data() : Value(ValueKind::Data) {}\r\n  CAFFE2_API static bool classof(const Value* V) {\r\n    return V->getKind() == ValueKind::Data;\r\n  }\r\n  virtual ~Data() = default;\r\n  size_t getVersion() const {\r\n    return version_;\r\n  }\r\n\r\n  void setVersion(size_t version) {\r\n    version_ = version;\r\n  }\r\n\r\n private:\r\n  size_t version_ = 0;\r\n};\r\n```\r\n\r\n## System Info\r\n\r\n- PyTorch or Caffe2: Caffe2\r\n- How you installed PyTorch (conda, pip, source): source\r\n- Build command you used (if compiling from source): cmake\r\n- OS: Win10\r\n- PyTorch version: master\r\n- VS version (if compiling from source): 2017\r\n- CMake version: 3.11.4\r\n"}