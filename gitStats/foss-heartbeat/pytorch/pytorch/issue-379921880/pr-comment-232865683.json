{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/232865683", "pull_request_review_id": 174154719, "id": 232865683, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMjg2NTY4Mw==", "diff_hunk": "@@ -90,35 +90,21 @@ class SpatialBNOp : public Operator<Context> {\n           alpha_data,\n           beta_data);\n     } else {\n-      auto* saved_mean = Output(SAVED_MEAN);\n-      auto* saved_rstd = Output(SAVED_INV_STD);\n-      if (num_batches_ == 1) {\n-        saved_mean->Resize(C);\n-        saved_rstd->Resize(C);\n-      } else {\n-        const auto& batch_mean_sum = Input(BATCH_MEAN_SUM);\n-        const auto& batch_var_sum = Input(BATCH_VAR_SUM);\n-        if (saved_mean != &batch_mean_sum) {\n-          saved_mean->Resize(C);\n-        }\n-        if (saved_rstd != &batch_var_sum) {\n-          saved_rstd->Resize(C);\n-        }\n-      }\n+      auto* saved_mean = Output(SAVED_MEAN, {C}, at::dtype<T>());\n+      auto* saved_rstd = Output(SAVED_INV_STD, {C}, at::dtype<T>());\n       T* saved_mean_data = saved_mean->template mutable_data<T>();\n       T* saved_rstd_data = saved_rstd->template mutable_data<T>();\n-      auto* running_mean = Output(RUNNING_MEAN);\n-      auto* running_var = Output(RUNNING_VAR);\n-      if (running_mean->numel() != C) {\n-        running_mean->Resize(C);\n-        math::Set<T, Context>(\n-            C, T(0), running_mean->template mutable_data<T>(), &context_);\n-      }\n-      if (running_var->numel() != C) {\n-        running_var->Resize(C);\n-        math::Set<T, Context>(\n-            C, T(0), running_var->template mutable_data<T>(), &context_);\n-      }\n+\n+      // Enforce Alias\n+      CAFFE_ENFORCE(", "path": "caffe2/operators/spatial_batch_norm_op.h", "position": 31, "original_position": 37, "commit_id": "44a39b74ed6b9315a66f440e45176b3ec7767ab9", "original_commit_id": "cb3dc3e5064f10a0e9e0f3929908d372b3eb929c", "user": {"login": "smessmer", "id": 2373925, "node_id": "MDQ6VXNlcjIzNzM5MjU=", "avatar_url": "https://avatars3.githubusercontent.com/u/2373925?v=4", "gravatar_id": "", "url": "https://api.github.com/users/smessmer", "html_url": "https://github.com/smessmer", "followers_url": "https://api.github.com/users/smessmer/followers", "following_url": "https://api.github.com/users/smessmer/following{/other_user}", "gists_url": "https://api.github.com/users/smessmer/gists{/gist_id}", "starred_url": "https://api.github.com/users/smessmer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/smessmer/subscriptions", "organizations_url": "https://api.github.com/users/smessmer/orgs", "repos_url": "https://api.github.com/users/smessmer/repos", "events_url": "https://api.github.com/users/smessmer/events{/privacy}", "received_events_url": "https://api.github.com/users/smessmer/received_events", "type": "User", "site_admin": false}, "body": "I don't really understand the code transformation here. Please double check this enforces the right thing.\r\nThis assertion ensure that you're in the branch that would **not** have called the resize in line 102 and 105. Is this what you meant? Because your `Output` is doing a resize.", "created_at": "2018-11-13T01:12:47Z", "updated_at": "2018-11-23T15:54:42Z", "html_url": "https://github.com/pytorch/pytorch/pull/13856#discussion_r232865683", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/13856", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/232865683"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/13856#discussion_r232865683"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/13856"}}, "body_html": "<p>I don't really understand the code transformation here. Please double check this enforces the right thing.<br>\nThis assertion ensure that you're in the branch that would <strong>not</strong> have called the resize in line 102 and 105. Is this what you meant? Because your <code>Output</code> is doing a resize.</p>", "body_text": "I don't really understand the code transformation here. Please double check this enforces the right thing.\nThis assertion ensure that you're in the branch that would not have called the resize in line 102 and 105. Is this what you meant? Because your Output is doing a resize."}