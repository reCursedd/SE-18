{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/172460931", "pull_request_review_id": 101475892, "id": 172460931, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MjQ2MDkzMQ==", "diff_hunk": "@@ -45,7 +45,49 @@ IF(NOT MSVC AND NOT \"${CMAKE_C_COMPILER_ID}\" MATCHES \"Clang\")\n   SET_SOURCE_FILES_PROPERTIES(${PROJECT_SOURCE_DIR}/src/TH/THAtomic.c PROPERTIES COMPILE_FLAGS \"-fno-openmp\")\n   SET_SOURCE_FILES_PROPERTIES(${PROJECT_SOURCE_DIR}/src/TH/THAllocator.c PROPERTIES COMPILE_FLAGS \"-fno-openmp\")\n ENDIF()\n-########################\n+\n+FILE(GLOB cpu_kernel_h RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} \"native/cpu/*.h\")\n+FILE(GLOB cpu_kernel_cpp_in RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} \"native/cpu/*.cpp\")\n+\n+FOREACH(IMPL ${cpu_kernel_cpp_in})\n+  SET(CPU_CAPABILITY NONE)\n+  configure_file(${IMPL} ${IMPL}.none.cpp COPYONLY)\n+  SET(NEW_IMPL ${CMAKE_CURRENT_BINARY_DIR}/${IMPL}.none.cpp)\n+  SET(cpu_kernel_cpp ${NEW_IMPL} ${cpu_kernel_cpp})\n+  IF(MSVC)\n+    SET_SOURCE_FILES_PROPERTIES(${NEW_IMPL} PROPERTIES COMPILE_FLAGS \"${C_AVX_FLAGS} -DCPU_KERNEL_NONE\")\n+  ELSE(MSVC)\n+    SET_SOURCE_FILES_PROPERTIES(${NEW_IMPL} PROPERTIES COMPILE_FLAGS \"-O3 -DCPU_KERNEL_NONE\" )\n+  ENDIF(MSVC)\n+ENDFOREACH()\n+\n+IF(C_AVX_FOUND)\n+  FOREACH(IMPL ${cpu_kernel_cpp_in})\n+    SET(CPU_CAPABILITY AVX)\n+    configure_file(${IMPL} ${IMPL}.avx.cpp COPYONLY)\n+    SET(NEW_IMPL ${CMAKE_CURRENT_BINARY_DIR}/${IMPL}.avx.cpp)\n+    SET(cpu_kernel_cpp ${NEW_IMPL} ${cpu_kernel_cpp})\n+    IF(MSVC)\n+      SET_SOURCE_FILES_PROPERTIES(${NEW_IMPL} PROPERTIES COMPILE_FLAGS \"${MSVC_OPT_FLAG}/arch:AVX ${C_AVX_FLAGS} -DCPU_KERNEL_AVX\")\n+    ELSE(MSVC)\n+      SET_SOURCE_FILES_PROPERTIES(${NEW_IMPL} PROPERTIES COMPILE_FLAGS  \"-O3 ${C_AVX_FLAGS} -DCPU_KERNEL_AVX\" )\n+    ENDIF(MSVC)\n+  ENDFOREACH()\n+ENDIF(C_AVX_FOUND)\n+\n+IF(C_AVX2_FOUND)\n+  FOREACH(IMPL ${cpu_kernel_cpp_in})\n+    SET(CPU_CAPABILITY AVX2)\n+    configure_file(${IMPL} ${IMPL}.avx2.cpp COPYONLY)\n+    SET(NEW_IMPL ${CMAKE_CURRENT_BINARY_DIR}/${IMPL}.avx2.cpp)\n+    SET(cpu_kernel_cpp ${NEW_IMPL} ${cpu_kernel_cpp})\n+    IF(MSVC)\n+      SET_SOURCE_FILES_PROPERTIES(${NEW_IMPL} PROPERTIES COMPILE_FLAGS \"${MSVC_OPT_FLAG}/arch:AVX2 ${C_AVX2_FLAGS} -DCPU_KERNEL_AVX2\")\n+    ELSE(MSVC)\n+      SET_SOURCE_FILES_PROPERTIES(${NEW_IMPL} PROPERTIES COMPILE_FLAGS  \"-O3 ${C_AVX2_FLAGS} -DCPU_KERNEL_AVX2\")", "path": "aten/src/ATen/CMakeLists.txt", "position": null, "original_position": 57, "commit_id": "92e4e0671ee0326a1744e3b3b2c3c57694eae39d", "original_commit_id": "cc65e71c0b223ad75cf0d077d825e33ddd4c1cc6", "user": {"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}, "body": "Don't we need some `-march` switches here?", "created_at": "2018-03-06T09:48:57Z", "updated_at": "2018-11-23T15:40:23Z", "html_url": "https://github.com/pytorch/pytorch/pull/5481#discussion_r172460931", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/5481", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/172460931"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/5481#discussion_r172460931"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/5481"}}, "body_html": "<p>Don't we need some <code>-march</code> switches here?</p>", "body_text": "Don't we need some -march switches here?"}