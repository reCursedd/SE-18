{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/409535835", "html_url": "https://github.com/pytorch/pytorch/issues/8392#issuecomment-409535835", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/8392", "id": 409535835, "node_id": "MDEyOklzc3VlQ29tbWVudDQwOTUzNTgzNQ==", "user": {"login": "daniel-j-h", "id": 527241, "node_id": "MDQ6VXNlcjUyNzI0MQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/527241?v=4", "gravatar_id": "", "url": "https://api.github.com/users/daniel-j-h", "html_url": "https://github.com/daniel-j-h", "followers_url": "https://api.github.com/users/daniel-j-h/followers", "following_url": "https://api.github.com/users/daniel-j-h/following{/other_user}", "gists_url": "https://api.github.com/users/daniel-j-h/gists{/gist_id}", "starred_url": "https://api.github.com/users/daniel-j-h/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/daniel-j-h/subscriptions", "organizations_url": "https://api.github.com/users/daniel-j-h/orgs", "repos_url": "https://api.github.com/users/daniel-j-h/repos", "events_url": "https://api.github.com/users/daniel-j-h/events{/privacy}", "received_events_url": "https://api.github.com/users/daniel-j-h/received_events", "type": "User", "site_admin": false}, "created_at": "2018-08-01T10:56:17Z", "updated_at": "2018-08-01T10:56:17Z", "author_association": "NONE", "body_html": "<p>Hey <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4685384\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jamesr66a\">@jamesr66a</a> I'm running into the exact same issue with PyTorch 0.4.1 hitting the assertion at:</p>\n<p><a href=\"https://github.com/pytorch/pytorch/blob/v0.4.1/torch/csrc/jit/export.cpp#L296\">https://github.com/pytorch/pytorch/blob/v0.4.1/torch/csrc/jit/export.cpp#L296</a></p>\n<p>I don't think it is strictly related to the <code>ModuleList</code> though. There is a similar report <a href=\"https://github.com/pytorch/pytorch/issues/9587\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/9587/hovercard\">here</a>.</p>\n<p>And in my case I'm trying to export an encoder-decoder model with skip-connections where the encoder is a pre-trained resnet50 here:</p>\n<ul>\n<li><a href=\"https://github.com/mapbox/robosat/blob/f67f3a7b0875e30c971d99bfe51f92f25cd835da/robosat/unet.py#L76\">https://github.com/mapbox/robosat/blob/f67f3a7b0875e30c971d99bfe51f92f25cd835da/robosat/unet.py#L76</a></li>\n<li><a href=\"https://github.com/mapbox/robosat/blob/da30c57b13f9df9e1d0f329eff415a75c2451433/robosat/tools/export.py#L40\">https://github.com/mapbox/robosat/blob/da30c57b13f9df9e1d0f329eff415a75c2451433/robosat/tools/export.py#L40</a></li>\n</ul>\n<p>If it helps I initially ran into what looks like an integer overflow with PyTorch 0.4.0. The Python trace ends at <a href=\"https://github.com/pytorch/pytorch/blob/v0.4.0/torch/onnx/utils.py#L153-L154\">https://github.com/pytorch/pytorch/blob/v0.4.0/torch/onnx/utils.py#L153-L154</a> and then I can only see the <code>std::vector</code> throwing an exception (probably from the <code>vector</code>'s <code>.at</code> function):</p>\n<pre><code>IndexError: vector::_M_range_check: __n (which is 18446744073709551458) &gt;= this-&gt;size() (which is 277)\n</code></pre>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4685384\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jamesr66a\">@jamesr66a</a> let me know if I can provide more details to get this fixed.</p>\n<hr>\n<p>Quick side note, the exported version is still at 0.3</p>\n<p><a href=\"https://github.com/pytorch/pytorch/blob/v0.4.1/torch/csrc/jit/export.cpp#L383-L384\">https://github.com/pytorch/pytorch/blob/v0.4.1/torch/csrc/jit/export.cpp#L383-L384</a></p>", "body_text": "Hey @jamesr66a I'm running into the exact same issue with PyTorch 0.4.1 hitting the assertion at:\nhttps://github.com/pytorch/pytorch/blob/v0.4.1/torch/csrc/jit/export.cpp#L296\nI don't think it is strictly related to the ModuleList though. There is a similar report here.\nAnd in my case I'm trying to export an encoder-decoder model with skip-connections where the encoder is a pre-trained resnet50 here:\n\nhttps://github.com/mapbox/robosat/blob/f67f3a7b0875e30c971d99bfe51f92f25cd835da/robosat/unet.py#L76\nhttps://github.com/mapbox/robosat/blob/da30c57b13f9df9e1d0f329eff415a75c2451433/robosat/tools/export.py#L40\n\nIf it helps I initially ran into what looks like an integer overflow with PyTorch 0.4.0. The Python trace ends at https://github.com/pytorch/pytorch/blob/v0.4.0/torch/onnx/utils.py#L153-L154 and then I can only see the std::vector throwing an exception (probably from the vector's .at function):\nIndexError: vector::_M_range_check: __n (which is 18446744073709551458) >= this->size() (which is 277)\n\n@jamesr66a let me know if I can provide more details to get this fixed.\n\nQuick side note, the exported version is still at 0.3\nhttps://github.com/pytorch/pytorch/blob/v0.4.1/torch/csrc/jit/export.cpp#L383-L384", "body": "Hey @jamesr66a I'm running into the exact same issue with PyTorch 0.4.1 hitting the assertion at:\r\n\r\nhttps://github.com/pytorch/pytorch/blob/v0.4.1/torch/csrc/jit/export.cpp#L296\r\n\r\nI don't think it is strictly related to the `ModuleList` though. There is a similar report [here](https://github.com/pytorch/pytorch/issues/9587).\r\n\r\nAnd in my case I'm trying to export an encoder-decoder model with skip-connections where the encoder is a pre-trained resnet50 here:\r\n- https://github.com/mapbox/robosat/blob/f67f3a7b0875e30c971d99bfe51f92f25cd835da/robosat/unet.py#L76\r\n- https://github.com/mapbox/robosat/blob/da30c57b13f9df9e1d0f329eff415a75c2451433/robosat/tools/export.py#L40\r\n\r\nIf it helps I initially ran into what looks like an integer overflow with PyTorch 0.4.0. The Python trace ends at https://github.com/pytorch/pytorch/blob/v0.4.0/torch/onnx/utils.py#L153-L154 and then I can only see the `std::vector` throwing an exception (probably from the `vector`'s `.at` function):\r\n\r\n```\r\nIndexError: vector::_M_range_check: __n (which is 18446744073709551458) >= this->size() (which is 277)\r\n```\r\n\r\n@jamesr66a let me know if I can provide more details to get this fixed.\r\n\r\n---\r\n\r\nQuick side note, the exported version is still at 0.3\r\n\r\nhttps://github.com/pytorch/pytorch/blob/v0.4.1/torch/csrc/jit/export.cpp#L383-L384"}