{"url": "https://api.github.com/repos/pytorch/pytorch/issues/7673", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/7673/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/7673/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/7673/events", "html_url": "https://github.com/pytorch/pytorch/pull/7673", "id": 324392847, "node_id": "MDExOlB1bGxSZXF1ZXN0MTg5MDEyMjcz", "number": 7673, "title": "use matching tp_name for torch.device", "user": {"login": "kmike", "id": 107893, "node_id": "MDQ6VXNlcjEwNzg5Mw==", "avatar_url": "https://avatars3.githubusercontent.com/u/107893?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kmike", "html_url": "https://github.com/kmike", "followers_url": "https://api.github.com/users/kmike/followers", "following_url": "https://api.github.com/users/kmike/following{/other_user}", "gists_url": "https://api.github.com/users/kmike/gists{/gist_id}", "starred_url": "https://api.github.com/users/kmike/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kmike/subscriptions", "organizations_url": "https://api.github.com/users/kmike/orgs", "repos_url": "https://api.github.com/users/kmike/repos", "events_url": "https://api.github.com/users/kmike/events{/privacy}", "received_events_url": "https://api.github.com/users/kmike/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-05-18T12:33:40Z", "updated_at": "2018-05-18T22:17:43Z", "closed_at": "2018-05-18T14:24:21Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/7673", "html_url": "https://github.com/pytorch/pytorch/pull/7673", "diff_url": "https://github.com/pytorch/pytorch/pull/7673.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/7673.patch"}, "body_html": "<p>I've noticed that when you create a <code>torch.device</code> instance, a class of the variable is named <code>torch.Device</code>:</p>\n<div class=\"highlight highlight-source-python\"><pre>In [<span class=\"pl-c1\">1</span>]: <span class=\"pl-k\">import</span> torch\n\nIn [<span class=\"pl-c1\">2</span>]: d <span class=\"pl-k\">=</span> torch.device(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>cpu<span class=\"pl-pds\">'</span></span>)\n\nIn [<span class=\"pl-c1\">3</span>]: d\nOut[<span class=\"pl-c1\">3</span>]: device(<span class=\"pl-v\">type</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>cpu<span class=\"pl-pds\">'</span></span>)\n\nIn [<span class=\"pl-c1\">4</span>]: d.<span class=\"pl-c1\">__class__</span>\nOut[<span class=\"pl-c1\">4</span>]: torch.Device</pre></div>\n<p>This is confusing, because there is no <code>torch.Device</code> available to import. According to Python docs, tp_name should be <code>the full module name, followed by a dot, followed by the type name</code> (see <a href=\"https://docs.python.org/3/c-api/typeobj.html#c.PyTypeObject.tp_name\" rel=\"nofollow\">https://docs.python.org/3/c-api/typeobj.html#c.PyTypeObject.tp_name</a>). Also,</p>\n<blockquote>\n<p>For statically allocated type objects, the tp_name field should contain a dot. Everything before the last dot is made accessible as the <code>__module__</code> attribute, and everything after the last dot is made accessible as the <code>__name__</code> attribute.</p>\n</blockquote>\n<p>I think setting these values incorrectly may also affect pickling (see <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"322667115\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/7545\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/7545/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/7545\">#7545</a> - I haven't checked if it is fixed by this PR or not though):</p>\n<blockquote>\n<p>If no dot is present, the entire tp_name field is made accessible as the <code>__name__</code> attribute, and the <code>__module__</code> attribute is undefined (unless explicitly set in the dictionary, as explained above). This means your type will be impossible to pickle.</p>\n</blockquote>\n<p>So, as this class is exposed as torch.device, in this PR tp_name is changed to <code>torch.device</code>.</p>", "body_text": "I've noticed that when you create a torch.device instance, a class of the variable is named torch.Device:\nIn [1]: import torch\n\nIn [2]: d = torch.device('cpu')\n\nIn [3]: d\nOut[3]: device(type='cpu')\n\nIn [4]: d.__class__\nOut[4]: torch.Device\nThis is confusing, because there is no torch.Device available to import. According to Python docs, tp_name should be the full module name, followed by a dot, followed by the type name (see https://docs.python.org/3/c-api/typeobj.html#c.PyTypeObject.tp_name). Also,\n\nFor statically allocated type objects, the tp_name field should contain a dot. Everything before the last dot is made accessible as the __module__ attribute, and everything after the last dot is made accessible as the __name__ attribute.\n\nI think setting these values incorrectly may also affect pickling (see #7545 - I haven't checked if it is fixed by this PR or not though):\n\nIf no dot is present, the entire tp_name field is made accessible as the __name__ attribute, and the __module__ attribute is undefined (unless explicitly set in the dictionary, as explained above). This means your type will be impossible to pickle.\n\nSo, as this class is exposed as torch.device, in this PR tp_name is changed to torch.device.", "body": "I've noticed that when you create a `torch.device` instance, a class of the variable is named `torch.Device`:\r\n\r\n```py\r\nIn [1]: import torch\r\n\r\nIn [2]: d = torch.device('cpu')\r\n\r\nIn [3]: d\r\nOut[3]: device(type='cpu')\r\n\r\nIn [4]: d.__class__\r\nOut[4]: torch.Device\r\n```\r\n\r\nThis is confusing, because there is no `torch.Device` available to import. According to Python docs, tp_name should be `the full module name, followed by a dot, followed by the type name` (see https://docs.python.org/3/c-api/typeobj.html#c.PyTypeObject.tp_name). Also, \r\n\r\n> For statically allocated type objects, the tp_name field should contain a dot. Everything before the last dot is made accessible as the `__module__` attribute, and everything after the last dot is made accessible as the `__name__` attribute.\r\n\r\nI think setting these values incorrectly may also affect pickling (see https://github.com/pytorch/pytorch/issues/7545 - I haven't checked if it is fixed by this PR or not though):\r\n\r\n> If no dot is present, the entire tp_name field is made accessible as the `__name__` attribute, and the `__module__` attribute is undefined (unless explicitly set in the dictionary, as explained above). This means your type will be impossible to pickle.\r\n\r\nSo, as this class is exposed as torch.device, in this PR tp_name is changed to `torch.device`."}