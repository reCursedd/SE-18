{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/269541653", "html_url": "https://github.com/pytorch/pytorch/pull/344#issuecomment-269541653", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/344", "id": 269541653, "node_id": "MDEyOklzc3VlQ29tbWVudDI2OTU0MTY1Mw==", "user": {"login": "colesbury", "id": 655866, "node_id": "MDQ6VXNlcjY1NTg2Ng==", "avatar_url": "https://avatars1.githubusercontent.com/u/655866?v=4", "gravatar_id": "", "url": "https://api.github.com/users/colesbury", "html_url": "https://github.com/colesbury", "followers_url": "https://api.github.com/users/colesbury/followers", "following_url": "https://api.github.com/users/colesbury/following{/other_user}", "gists_url": "https://api.github.com/users/colesbury/gists{/gist_id}", "starred_url": "https://api.github.com/users/colesbury/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/colesbury/subscriptions", "organizations_url": "https://api.github.com/users/colesbury/orgs", "repos_url": "https://api.github.com/users/colesbury/repos", "events_url": "https://api.github.com/users/colesbury/events{/privacy}", "received_events_url": "https://api.github.com/users/colesbury/received_events", "type": "User", "site_admin": false}, "created_at": "2016-12-28T21:13:12Z", "updated_at": "2016-12-28T21:14:34Z", "author_association": "MEMBER", "body_html": "<p>Fixed the fd leak and changed the way the leak checker works:</p>\n<ul>\n<li>We now run non-CUDA tests 20 times (the CUDA test is slow so we only run it once)</li>\n<li>We check the 10th-next file descriptor at the beginning and end of the test. We can still have leaks but have the first allocated fd properly opened and closed. Checking the 10th next is a lot more likely to catch leaks.</li>\n<li>We allow a leeway of 4 unclosed fds. This accounts for sockets and files that might be initialized within the test, like the multiprocessing manager or Python's resource sharer</li>\n</ul>\n<p>I also verified that this would catch the leak <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4583066\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/apaszke\">@apaszke</a> found.</p>", "body_text": "Fixed the fd leak and changed the way the leak checker works:\n\nWe now run non-CUDA tests 20 times (the CUDA test is slow so we only run it once)\nWe check the 10th-next file descriptor at the beginning and end of the test. We can still have leaks but have the first allocated fd properly opened and closed. Checking the 10th next is a lot more likely to catch leaks.\nWe allow a leeway of 4 unclosed fds. This accounts for sockets and files that might be initialized within the test, like the multiprocessing manager or Python's resource sharer\n\nI also verified that this would catch the leak @apaszke found.", "body": "Fixed the fd leak and changed the way the leak checker works:\r\n\r\n- We now run non-CUDA tests 20 times (the CUDA test is slow so we only run it once)\r\n- We check the 10th-next file descriptor at the beginning and end of the test. We can still have leaks but have the first allocated fd properly opened and closed. Checking the 10th next is a lot more likely to catch leaks.\r\n- We allow a leeway of 4 unclosed fds. This accounts for sockets and files that might be initialized within the test, like the multiprocessing manager or Python's resource sharer\r\n\r\nI also verified that this would catch the leak @apaszke found."}