{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/368961561", "html_url": "https://github.com/pytorch/pytorch/issues/5426#issuecomment-368961561", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/5426", "id": 368961561, "node_id": "MDEyOklzc3VlQ29tbWVudDM2ODk2MTU2MQ==", "user": {"login": "yaroslavvb", "id": 23068, "node_id": "MDQ6VXNlcjIzMDY4", "avatar_url": "https://avatars3.githubusercontent.com/u/23068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yaroslavvb", "html_url": "https://github.com/yaroslavvb", "followers_url": "https://api.github.com/users/yaroslavvb/followers", "following_url": "https://api.github.com/users/yaroslavvb/following{/other_user}", "gists_url": "https://api.github.com/users/yaroslavvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/yaroslavvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yaroslavvb/subscriptions", "organizations_url": "https://api.github.com/users/yaroslavvb/orgs", "repos_url": "https://api.github.com/users/yaroslavvb/repos", "events_url": "https://api.github.com/users/yaroslavvb/events{/privacy}", "received_events_url": "https://api.github.com/users/yaroslavvb/received_events", "type": "User", "site_admin": false}, "created_at": "2018-02-27T17:36:49Z", "updated_at": "2018-02-27T17:36:49Z", "author_association": "NONE", "body_html": "<p>I'm not measuring the time it takes to do <code>f.remote</code>, the slowness is in <code>torch.from_numpy</code> call</p>\n<pre><code>arr = ray.get(f.remote())\nstart_time = time.time()\ntorch.from_numpy(arr)\nprint(\"%.1f ms \"%((time.time()-start_time)*1000,)) # =&gt; 462ms\n</code></pre>\n<p>This takes 462 milliseconds on a 1GB numpy array.</p>\n<p>Here's the full <a href=\"https://raw.githubusercontent.com/diux-dev/cluster/master/yuxin_numpy/pytorch_slow_numpy_bug.py\" rel=\"nofollow\">benchmark</a>.</p>\n<pre><code>pip install ray\nwget https://raw.githubusercontent.com/diux-dev/cluster/master/yuxin_numpy/pytorch_slow_numpy_bug.py\npython pytorch_slow_numpy_bug.py\n\n...\n462.9 ms \n</code></pre>\n<p>Here's <a href=\"https://www.dropbox.com/s/5zk9qn6oasfkzve/pytorch.svg?dl=1\" rel=\"nofollow\">cpu profile</a> of the benchmark (from google-perf-tool)</p>\n<p>Not sure how accurate it is, but it shows 15% of the time in <code>__nss_passwd_lookup</code> which usually means memcpy</p>", "body_text": "I'm not measuring the time it takes to do f.remote, the slowness is in torch.from_numpy call\narr = ray.get(f.remote())\nstart_time = time.time()\ntorch.from_numpy(arr)\nprint(\"%.1f ms \"%((time.time()-start_time)*1000,)) # => 462ms\n\nThis takes 462 milliseconds on a 1GB numpy array.\nHere's the full benchmark.\npip install ray\nwget https://raw.githubusercontent.com/diux-dev/cluster/master/yuxin_numpy/pytorch_slow_numpy_bug.py\npython pytorch_slow_numpy_bug.py\n\n...\n462.9 ms \n\nHere's cpu profile of the benchmark (from google-perf-tool)\nNot sure how accurate it is, but it shows 15% of the time in __nss_passwd_lookup which usually means memcpy", "body": "I'm not measuring the time it takes to do `f.remote`, the slowness is in `torch.from_numpy` call\r\n\r\n```\r\narr = ray.get(f.remote())\r\nstart_time = time.time()\r\ntorch.from_numpy(arr)\r\nprint(\"%.1f ms \"%((time.time()-start_time)*1000,)) # => 462ms\r\n```\r\nThis takes 462 milliseconds on a 1GB numpy array.\r\n\r\nHere's the full [benchmark](https://raw.githubusercontent.com/diux-dev/cluster/master/yuxin_numpy/pytorch_slow_numpy_bug.py). \r\n\r\n```\r\npip install ray\r\nwget https://raw.githubusercontent.com/diux-dev/cluster/master/yuxin_numpy/pytorch_slow_numpy_bug.py\r\npython pytorch_slow_numpy_bug.py\r\n\r\n...\r\n462.9 ms \r\n```\r\n\r\nHere's [cpu profile](https://www.dropbox.com/s/5zk9qn6oasfkzve/pytorch.svg?dl=1) of the benchmark (from google-perf-tool)\r\n\r\nNot sure how accurate it is, but it shows 15% of the time in `__nss_passwd_lookup` which usually means memcpy\r\n"}