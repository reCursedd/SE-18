{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/431413920", "html_url": "https://github.com/pytorch/pytorch/pull/12011#issuecomment-431413920", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/12011", "id": 431413920, "node_id": "MDEyOklzc3VlQ29tbWVudDQzMTQxMzkyMA==", "user": {"login": "JackWindows", "id": 1560135, "node_id": "MDQ6VXNlcjE1NjAxMzU=", "avatar_url": "https://avatars3.githubusercontent.com/u/1560135?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JackWindows", "html_url": "https://github.com/JackWindows", "followers_url": "https://api.github.com/users/JackWindows/followers", "following_url": "https://api.github.com/users/JackWindows/following{/other_user}", "gists_url": "https://api.github.com/users/JackWindows/gists{/gist_id}", "starred_url": "https://api.github.com/users/JackWindows/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JackWindows/subscriptions", "organizations_url": "https://api.github.com/users/JackWindows/orgs", "repos_url": "https://api.github.com/users/JackWindows/repos", "events_url": "https://api.github.com/users/JackWindows/events{/privacy}", "received_events_url": "https://api.github.com/users/JackWindows/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-19T16:04:31Z", "updated_at": "2018-10-19T16:04:31Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=5674597\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/SsnL\">@SsnL</a> The newly designed dataloader still has issues and our training is still stalling.<br>\nThe is from the stalled training process:</p>\n<ol>\n<li>From main thread:</li>\n</ol>\n<pre><code>Thread 1 (Thread 0x7f384e2dc740 (LWP 237)):\n 353                            break\n 354                        remaining = endtime - _time()\n 355                        if remaining &lt;= 0:\n 356                            break\n 357                        delay = min(delay * 2, remaining, .05)\n&gt;358                        _sleep(delay)\n 359                    if not gotit:\n 360                        if __debug__:\n 361                            self._note(\"%s.wait(%s): timed out\", self, timeout)\n 362                        try:\n 363                            self.__waiters.remove(waiter)\n(gdb) py-bt\n#4 Frame 0x7f3484000910, for file /av/lib/third_party/python2.7/threading.py, line 358, in wait (self=&lt;_Condition(_Verbose__verbose=False, _Condition__lock=&lt;thread.lock at remote 0x7f37257518f0&gt;, acquire=&lt;built-in method acquire of thread.lock object at remote 0x7f37257518f0&gt;, _Condition__waiters=[&lt;thread.lock at remote 0x7f3725721e70&gt;], release=&lt;built-in method release of thread.lock object at remote 0x7f37257518f0&gt;) at remote 0x7f36be885f50&gt;, timeout=&lt;float at remote 0x811eca8&gt;, waiter=&lt;thread.lock at remote 0x7f3725721e70&gt;, saved_state=None, endtime=&lt;float at remote 0x811ed38&gt;, delay=&lt;float at remote 0x27e2118&gt;, gotit=False, remaining=&lt;float at remote 0x811ecf0&gt;)\n    _sleep(delay)\n#8 Frame 0x7f36b8cc5240, for file /av/lib/third_party/python2.7/Queue.py, line 177, in get (self=&lt;Queue(unfinished_tasks=0, queue=&lt;collections.deque at remote 0x7f36be882050&gt;, maxsize=0, all_tasks_done=&lt;_Condition(_Verbose__verbose=False, _Condition__lock=&lt;thread.lock at remote 0x7f37257518f0&gt;, acquire=&lt;built-in method acquire of thread.lock object at remote 0x7f37257518f0&gt;, _Condition__waiters=[], release=&lt;built-in method release of thread.lock object at remote 0x7f37257518f0&gt;) at remote 0x7f36ce120b50&gt;, mutex=&lt;thread.lock at remote 0x7f37257518f0&gt;, not_full=&lt;_Condition(_Verbose__verbose=False, _Condition__lock=&lt;thread.lock at remote 0x7f37257518f0&gt;, acquire=&lt;built-in method acquire of thread.lock object at remote 0x7f37257518f0&gt;, _Condition__waiters=[], release=&lt;built-in method release of thread.lock object at remote 0x7f37257518f0&gt;) at remote 0x7f36ce120b10&gt;, not_empty=&lt;_Condition(_Verbose__verbose=False, _Condition__lock=&lt;thread.lock at remote 0x7f37257518f0&gt;, acquire=&lt;built-in method acquire of thread.lock ...(truncated)\n    self.not_empty.wait(remaining)\n#12 Frame 0x7f372461b410, for file /av/lib/python/torch/utils/data/dataloader.py, line 568, in _get_batch (self=&lt;_DataLoaderIterM3(rcvd_idx=0, dataset=&lt;TurnSignalsDataset(avg_length=&lt;numpy.float64 at remote 0x7f36ce114c48&gt;, _dataset=[{'images': [900434, 900435, 900436, 900437, 900438, 900439, 900440, 900441, 900442, 900443, 900444, 900445, 900446, 900447, 900448, 900449, 900450, 900451, 900452, 900453, 900454, 900455, 900456, 900457, 900458, 900459, 900460, 900461, 900462, 900463, 900464, 900465, 900466, 900467, 900468, 900469, 900470, 900471, 900472, 900473, 900474, 900475, 900476, 900477, 900478, 900479, 900480, 900481, 900482, 900483, 900484, 900485, 900486, 900487, 900488], 'view_states': &lt;Tensor at remote 0x7f36e7d9e6e0&gt;, 'right_states': &lt;Tensor at remote 0x7f36e7d9e730&gt;, 'dual_states': &lt;Tensor at remote 0x7f36e7d9e7d0&gt;, 'left_states': &lt;Tensor at remote 0x7f36e7d9e550&gt;}, {'images': [1162459, 1162460, 1162461, 1162462, 1162463, 1162464, 1162465, 1162466, 1162467, 1162468, 1162469, 1162470, 1162471, 1162472, 1...(truncated)\n    return self.data_queue.get(timeout=MP_STATUS_CHECK_INTERVAL)\n#15 Frame 0x7f36ce0bd620, for file /av/lib/python/torch/utils/data/dataloader.py, line 598, in __next__ (self=&lt;_DataLoaderIterM3(rcvd_idx=0, dataset=&lt;TurnSignalsDataset(avg_length=&lt;numpy.float64 at remote 0x7f36ce114c48&gt;, _dataset=[{'images': [900434, 900435, 900436, 900437, 900438, 900439, 900440, 900441, 900442, 900443, 900444, 900445, 900446, 900447, 900448, 900449, 900450, 900451, 900452, 900453, 900454, 900455, 900456, 900457, 900458, 900459, 900460, 900461, 900462, 900463, 900464, 900465, 900466, 900467, 900468, 900469, 900470, 900471, 900472, 900473, 900474, 900475, 900476, 900477, 900478, 900479, 900480, 900481, 900482, 900483, 900484, 900485, 900486, 900487, 900488], 'view_states': &lt;Tensor at remote 0x7f36e7d9e6e0&gt;, 'right_states': &lt;Tensor at remote 0x7f36e7d9e730&gt;, 'dual_states': &lt;Tensor at remote 0x7f36e7d9e7d0&gt;, 'left_states': &lt;Tensor at remote 0x7f36e7d9e550&gt;}, {'images': [1162459, 1162460, 1162461, 1162462, 1162463, 1162464, 1162465, 1162466, 1162467, 1162468, 1162469, 1162470, 1162471, 1162472, 116...(truncated)\n    idx, batch = self._get_batch()\n#18 Frame 0x7f36be898050, for file /av/python/av/experimental/toronto/data_reader/data_loader.py, line 31, in next (self=&lt;_DataLoaderIterM3(rcvd_idx=0, dataset=&lt;TurnSignalsDataset(avg_length=&lt;numpy.float64 at remote 0x7f36ce114c48&gt;, _dataset=[{'images': [900434, 900435, 900436, 900437, 900438, 900439, 900440, 900441, 900442, 900443, 900444, 900445, 900446, 900447, 900448, 900449, 900450, 900451, 900452, 900453, 900454, 900455, 900456, 900457, 900458, 900459, 900460, 900461, 900462, 900463, 900464, 900465, 900466, 900467, 900468, 900469, 900470, 900471, 900472, 900473, 900474, 900475, 900476, 900477, 900478, 900479, 900480, 900481, 900482, 900483, 900484, 900485, 900486, 900487, 900488], 'view_states': &lt;Tensor at remote 0x7f36e7d9e6e0&gt;, 'right_states': &lt;Tensor at remote 0x7f36e7d9e730&gt;, 'dual_states': &lt;Tensor at remote 0x7f36e7d9e7d0&gt;, 'left_states': &lt;Tensor at remote 0x7f36e7d9e550&gt;}, {'images': [1162459, 1162460, 1\n</code></pre>\n<ol start=\"2\">\n<li>From a background thread:</li>\n</ol>\n<pre><code>(gdb) thread 13\n[Switching to thread 13 (Thread 0x7f36b64a2700 (LWP 68162))]\n#0  0x00007f384d9e7fdd in poll () at ../sysdeps/unix/syscall-template.S:81\n81      ../sysdeps/unix/syscall-template.S: No such file or directory.\n(gdb) py-list\n 126                if not self._rlock.acquire(block, timeout):\n 127                    raise Empty\n 128                try:\n 129                    if block:\n 130                        timeout = deadline - time.time()\n&gt;131                        if timeout &lt; 0 or not self._poll(timeout):\n 132                            raise Empty\n 133                    elif not self._poll():\n 134                        raise Empty\n 135                    res = self._recv()\n 136                    self._sem.release()\n(gdb) py-bt\n#3 Frame 0x7f3484001040, for file /av/lib/third_party/python2.7/multiprocessing/queues.py, line 131, in get (self=&lt;Queue(_writer=&lt;ConnectionWrapper(conn=&lt;_multiprocessing.Connection at remote 0x642b1a20&gt;) at remote 0x7f36be885850&gt;, _recv=&lt;instancemethod at remote 0x7f36e7f4cb40&gt;, _thread=None, _sem=&lt;BoundedSemaphore(release=&lt;built-in method release of _multiprocessing.SemLock object at remote 0x7f372689d3c0&gt;, acquire=&lt;built-in method acquire of _multiprocessing.SemLock object at remote 0x7f372689d3c0&gt;, _semlock=&lt;_multiprocessing.SemLock at remote 0x7f372689d3c0&gt;) at remote 0x7f36be885110&gt;, _buffer=&lt;collections.deque at remote 0x7f36be8820c0&gt;, _closed=False, _send=&lt;instancemethod at remote 0x7f36b8cc9550&gt;, _jointhread=None, _reader=&lt;ConnectionWrapper(conn=&lt;_multiprocessing.Connection at remote 0xb992630&gt;) at remote 0x7f36be8853d0&gt;, _opid=237, _rlock=&lt;Lock(release=&lt;built-in method release of _multiprocessing.SemLock object at remote 0x7f372689ef60&gt;, acquire=&lt;built-in method acquire of _multiprocessing.SemLock obje...(truncated)\n    if timeout &lt; 0 or not self._poll(timeout):\n#7 Frame 0x7f36d4001cf0, for file /av/lib/python/torch/utils/data/dataloader.py, line 157, in _pin_memory_loop (in_queue=&lt;Queue(_writer=&lt;ConnectionWrapper(conn=&lt;_multiprocessing.Connection at remote 0x642b1a20&gt;) at remote 0x7f36be885850&gt;, _recv=&lt;instancemethod at remote 0x7f36e7f4cb40&gt;, _thread=None, _sem=&lt;BoundedSemaphore(release=&lt;built-in method release of _multiprocessing.SemLock object at remote 0x7f372689d3c0&gt;, acquire=&lt;built-in method acquire of _multiprocessing.SemLock object at remote 0x7f372689d3c0&gt;, _semlock=&lt;_multiprocessing.SemLock at remote 0x7f372689d3c0&gt;) at remote 0x7f36be885110&gt;, _buffer=&lt;collections.deque at remote 0x7f36be8820c0&gt;, _closed=False, _send=&lt;instancemethod at remote 0x7f36b8cc9550&gt;, _jointhread=None, _reader=&lt;ConnectionWrapper(conn=&lt;_multiprocessing.Connection at remote 0xb992630&gt;) at remote 0x7f36be8853d0&gt;, _opid=237, _rlock=&lt;Lock(release=&lt;built-in method release of _multiprocessing.SemLock object at remote 0x7f372689ef60&gt;, acquire=&lt;built-in method acquire of _multiprocessing.SemLo...(truncated)\n    r = in_queue.get(timeout=MP_STATUS_CHECK_INTERVAL)\n#12 Frame 0x7f346c000da0, for file /av/lib/third_party/python2.7/threading.py, line 763, in run (self=&lt;Thread(_Thread__ident=139872963274496, _Thread__block=&lt;_Condition(_Verbose__verbose=False, _Condition__lock=&lt;thread.lock at remote 0x7f3725751db0&gt;, acquire=&lt;built-in method acquire of thread.lock object at remote 0x7f3725751db0&gt;, _Condition__waiters=[], release=&lt;built-in method release of thread.lock object at remote 0x7f3725751db0&gt;) at remote 0x7f36ce120c90&gt;, _Thread__name='Thread-9', _Thread__daemonic=True, _Thread__started=&lt;_Event(_Verbose__verbose=False, _Event__flag=True, _Event__cond=&lt;_Condition(_Verbose__verbose=False, _Condition__lock=&lt;thread.lock at remote 0x7f37257510b0&gt;, acquire=&lt;built-in method acquire of thread.lock object at remote 0x7f37257510b0&gt;, _Condition__waiters=[], release=&lt;built-in method release of thread.lock object at remote 0x7f37257510b0&gt;) at remote 0x7f36ce120c10&gt;) at remote 0x7f36ce120b90&gt;, _Thread__stderr=&lt;file at remote 0x7f384e2be1e0&gt;, _Thread__target=&lt;function at remote 0x7f38215...(truncated)\n    self.__target(*self.__args, **self.__kwargs)\n#15 Frame 0x7f3484000b50, for file /av/lib/third_party/python2.7/threading.py, line 810, in __bootstrap_inner (self=&lt;Thread(_Thread__ident=139872963274496, _Thread__block=&lt;_Condition(_Verbose__verbose=False, _Condition__lock=&lt;thread.lock at remote 0x7f3725751db0&gt;, acquire=&lt;built-in method acquire of thread.lock object at remote 0x7f3725751db0&gt;, _Condition__waiters=[], release=&lt;built-in method release of thread.lock object at remote 0x7f3725751db0&gt;) at remote 0x7f36ce120c90&gt;, _Thread__name='Thread-9', _Thread__daemonic=True, _Thread__started=&lt;_Event(_Verbose__verbose=False, _Event__flag=True, _Event__cond=&lt;_Condition(_Verbose__verbose=False, _Condition__lock=&lt;thread.lock at remote 0x7f37257510b0&gt;, acquire=&lt;built-in method acquire of thread.lock object at remote 0x7f37257510b0&gt;, _Condition__waiters=[], release=&lt;built-in method release of thread.lock object at remote 0x7f37257510b0&gt;) at remote 0x7f36ce120c10&gt;) at remote 0x7f36ce120b90&gt;, _Thread__stderr=&lt;file at remote 0x7f384e2be1e0&gt;, _Thread__target=&lt;function at re...(truncated)\n    self.run()\n#18 Frame 0x7f3464000b50, for file /av/lib/third_party/python2.7/threading.py, line 783, in __bootstrap (self=&lt;Thread(_Thread__ident=139872963274496, _Thread__block=&lt;_Condition(_Verbose__verbose=False, _Condition__lock=&lt;thread.lock at remote 0x7f3725751db0&gt;, acquire=&lt;built-in method acquire of thread.lock object at remote 0x7f3725751db0&gt;, _Condition__waiters=[], release=&lt;built-in method release of thread.lock object at remote 0x7f3725751db0&gt;) at remote 0x7f36ce120c90&gt;, _Thread__name='Thread-9', _Thread__daemonic=True, _Thread__started=&lt;_Event(_Verbose__verbose=False, _Event__flag=True, _Event__cond=&lt;_Condition(_Verbose__verbose=False, _Condition__lock=&lt;thread.lock at remote 0x7f37257510b0&gt;, acquire=&lt;built-in method acquire of thread.lock object at remote 0x7f37257510b0&gt;, _Condition__waiters=[], release=&lt;built-in method release of thread.lock object at remote 0x7f37257510b0&gt;) at remote 0x7f36ce120c10&gt;) at remote 0x7f36ce120b90&gt;, _Thread__stderr=&lt;file at remote 0x7f384e2be1e0&gt;, _Thread__target=&lt;function at remote 0...(truncated)\n    self.__bootstrap_inner()\n</code></pre>\n<p>Looks we still have a deadlock issue.</p>", "body_text": "@SsnL The newly designed dataloader still has issues and our training is still stalling.\nThe is from the stalled training process:\n\nFrom main thread:\n\nThread 1 (Thread 0x7f384e2dc740 (LWP 237)):\n 353                            break\n 354                        remaining = endtime - _time()\n 355                        if remaining <= 0:\n 356                            break\n 357                        delay = min(delay * 2, remaining, .05)\n>358                        _sleep(delay)\n 359                    if not gotit:\n 360                        if __debug__:\n 361                            self._note(\"%s.wait(%s): timed out\", self, timeout)\n 362                        try:\n 363                            self.__waiters.remove(waiter)\n(gdb) py-bt\n#4 Frame 0x7f3484000910, for file /av/lib/third_party/python2.7/threading.py, line 358, in wait (self=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f37257518f0>, acquire=<built-in method acquire of thread.lock object at remote 0x7f37257518f0>, _Condition__waiters=[<thread.lock at remote 0x7f3725721e70>], release=<built-in method release of thread.lock object at remote 0x7f37257518f0>) at remote 0x7f36be885f50>, timeout=<float at remote 0x811eca8>, waiter=<thread.lock at remote 0x7f3725721e70>, saved_state=None, endtime=<float at remote 0x811ed38>, delay=<float at remote 0x27e2118>, gotit=False, remaining=<float at remote 0x811ecf0>)\n    _sleep(delay)\n#8 Frame 0x7f36b8cc5240, for file /av/lib/third_party/python2.7/Queue.py, line 177, in get (self=<Queue(unfinished_tasks=0, queue=<collections.deque at remote 0x7f36be882050>, maxsize=0, all_tasks_done=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f37257518f0>, acquire=<built-in method acquire of thread.lock object at remote 0x7f37257518f0>, _Condition__waiters=[], release=<built-in method release of thread.lock object at remote 0x7f37257518f0>) at remote 0x7f36ce120b50>, mutex=<thread.lock at remote 0x7f37257518f0>, not_full=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f37257518f0>, acquire=<built-in method acquire of thread.lock object at remote 0x7f37257518f0>, _Condition__waiters=[], release=<built-in method release of thread.lock object at remote 0x7f37257518f0>) at remote 0x7f36ce120b10>, not_empty=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f37257518f0>, acquire=<built-in method acquire of thread.lock ...(truncated)\n    self.not_empty.wait(remaining)\n#12 Frame 0x7f372461b410, for file /av/lib/python/torch/utils/data/dataloader.py, line 568, in _get_batch (self=<_DataLoaderIterM3(rcvd_idx=0, dataset=<TurnSignalsDataset(avg_length=<numpy.float64 at remote 0x7f36ce114c48>, _dataset=[{'images': [900434, 900435, 900436, 900437, 900438, 900439, 900440, 900441, 900442, 900443, 900444, 900445, 900446, 900447, 900448, 900449, 900450, 900451, 900452, 900453, 900454, 900455, 900456, 900457, 900458, 900459, 900460, 900461, 900462, 900463, 900464, 900465, 900466, 900467, 900468, 900469, 900470, 900471, 900472, 900473, 900474, 900475, 900476, 900477, 900478, 900479, 900480, 900481, 900482, 900483, 900484, 900485, 900486, 900487, 900488], 'view_states': <Tensor at remote 0x7f36e7d9e6e0>, 'right_states': <Tensor at remote 0x7f36e7d9e730>, 'dual_states': <Tensor at remote 0x7f36e7d9e7d0>, 'left_states': <Tensor at remote 0x7f36e7d9e550>}, {'images': [1162459, 1162460, 1162461, 1162462, 1162463, 1162464, 1162465, 1162466, 1162467, 1162468, 1162469, 1162470, 1162471, 1162472, 1...(truncated)\n    return self.data_queue.get(timeout=MP_STATUS_CHECK_INTERVAL)\n#15 Frame 0x7f36ce0bd620, for file /av/lib/python/torch/utils/data/dataloader.py, line 598, in __next__ (self=<_DataLoaderIterM3(rcvd_idx=0, dataset=<TurnSignalsDataset(avg_length=<numpy.float64 at remote 0x7f36ce114c48>, _dataset=[{'images': [900434, 900435, 900436, 900437, 900438, 900439, 900440, 900441, 900442, 900443, 900444, 900445, 900446, 900447, 900448, 900449, 900450, 900451, 900452, 900453, 900454, 900455, 900456, 900457, 900458, 900459, 900460, 900461, 900462, 900463, 900464, 900465, 900466, 900467, 900468, 900469, 900470, 900471, 900472, 900473, 900474, 900475, 900476, 900477, 900478, 900479, 900480, 900481, 900482, 900483, 900484, 900485, 900486, 900487, 900488], 'view_states': <Tensor at remote 0x7f36e7d9e6e0>, 'right_states': <Tensor at remote 0x7f36e7d9e730>, 'dual_states': <Tensor at remote 0x7f36e7d9e7d0>, 'left_states': <Tensor at remote 0x7f36e7d9e550>}, {'images': [1162459, 1162460, 1162461, 1162462, 1162463, 1162464, 1162465, 1162466, 1162467, 1162468, 1162469, 1162470, 1162471, 1162472, 116...(truncated)\n    idx, batch = self._get_batch()\n#18 Frame 0x7f36be898050, for file /av/python/av/experimental/toronto/data_reader/data_loader.py, line 31, in next (self=<_DataLoaderIterM3(rcvd_idx=0, dataset=<TurnSignalsDataset(avg_length=<numpy.float64 at remote 0x7f36ce114c48>, _dataset=[{'images': [900434, 900435, 900436, 900437, 900438, 900439, 900440, 900441, 900442, 900443, 900444, 900445, 900446, 900447, 900448, 900449, 900450, 900451, 900452, 900453, 900454, 900455, 900456, 900457, 900458, 900459, 900460, 900461, 900462, 900463, 900464, 900465, 900466, 900467, 900468, 900469, 900470, 900471, 900472, 900473, 900474, 900475, 900476, 900477, 900478, 900479, 900480, 900481, 900482, 900483, 900484, 900485, 900486, 900487, 900488], 'view_states': <Tensor at remote 0x7f36e7d9e6e0>, 'right_states': <Tensor at remote 0x7f36e7d9e730>, 'dual_states': <Tensor at remote 0x7f36e7d9e7d0>, 'left_states': <Tensor at remote 0x7f36e7d9e550>}, {'images': [1162459, 1162460, 1\n\n\nFrom a background thread:\n\n(gdb) thread 13\n[Switching to thread 13 (Thread 0x7f36b64a2700 (LWP 68162))]\n#0  0x00007f384d9e7fdd in poll () at ../sysdeps/unix/syscall-template.S:81\n81      ../sysdeps/unix/syscall-template.S: No such file or directory.\n(gdb) py-list\n 126                if not self._rlock.acquire(block, timeout):\n 127                    raise Empty\n 128                try:\n 129                    if block:\n 130                        timeout = deadline - time.time()\n>131                        if timeout < 0 or not self._poll(timeout):\n 132                            raise Empty\n 133                    elif not self._poll():\n 134                        raise Empty\n 135                    res = self._recv()\n 136                    self._sem.release()\n(gdb) py-bt\n#3 Frame 0x7f3484001040, for file /av/lib/third_party/python2.7/multiprocessing/queues.py, line 131, in get (self=<Queue(_writer=<ConnectionWrapper(conn=<_multiprocessing.Connection at remote 0x642b1a20>) at remote 0x7f36be885850>, _recv=<instancemethod at remote 0x7f36e7f4cb40>, _thread=None, _sem=<BoundedSemaphore(release=<built-in method release of _multiprocessing.SemLock object at remote 0x7f372689d3c0>, acquire=<built-in method acquire of _multiprocessing.SemLock object at remote 0x7f372689d3c0>, _semlock=<_multiprocessing.SemLock at remote 0x7f372689d3c0>) at remote 0x7f36be885110>, _buffer=<collections.deque at remote 0x7f36be8820c0>, _closed=False, _send=<instancemethod at remote 0x7f36b8cc9550>, _jointhread=None, _reader=<ConnectionWrapper(conn=<_multiprocessing.Connection at remote 0xb992630>) at remote 0x7f36be8853d0>, _opid=237, _rlock=<Lock(release=<built-in method release of _multiprocessing.SemLock object at remote 0x7f372689ef60>, acquire=<built-in method acquire of _multiprocessing.SemLock obje...(truncated)\n    if timeout < 0 or not self._poll(timeout):\n#7 Frame 0x7f36d4001cf0, for file /av/lib/python/torch/utils/data/dataloader.py, line 157, in _pin_memory_loop (in_queue=<Queue(_writer=<ConnectionWrapper(conn=<_multiprocessing.Connection at remote 0x642b1a20>) at remote 0x7f36be885850>, _recv=<instancemethod at remote 0x7f36e7f4cb40>, _thread=None, _sem=<BoundedSemaphore(release=<built-in method release of _multiprocessing.SemLock object at remote 0x7f372689d3c0>, acquire=<built-in method acquire of _multiprocessing.SemLock object at remote 0x7f372689d3c0>, _semlock=<_multiprocessing.SemLock at remote 0x7f372689d3c0>) at remote 0x7f36be885110>, _buffer=<collections.deque at remote 0x7f36be8820c0>, _closed=False, _send=<instancemethod at remote 0x7f36b8cc9550>, _jointhread=None, _reader=<ConnectionWrapper(conn=<_multiprocessing.Connection at remote 0xb992630>) at remote 0x7f36be8853d0>, _opid=237, _rlock=<Lock(release=<built-in method release of _multiprocessing.SemLock object at remote 0x7f372689ef60>, acquire=<built-in method acquire of _multiprocessing.SemLo...(truncated)\n    r = in_queue.get(timeout=MP_STATUS_CHECK_INTERVAL)\n#12 Frame 0x7f346c000da0, for file /av/lib/third_party/python2.7/threading.py, line 763, in run (self=<Thread(_Thread__ident=139872963274496, _Thread__block=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f3725751db0>, acquire=<built-in method acquire of thread.lock object at remote 0x7f3725751db0>, _Condition__waiters=[], release=<built-in method release of thread.lock object at remote 0x7f3725751db0>) at remote 0x7f36ce120c90>, _Thread__name='Thread-9', _Thread__daemonic=True, _Thread__started=<_Event(_Verbose__verbose=False, _Event__flag=True, _Event__cond=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f37257510b0>, acquire=<built-in method acquire of thread.lock object at remote 0x7f37257510b0>, _Condition__waiters=[], release=<built-in method release of thread.lock object at remote 0x7f37257510b0>) at remote 0x7f36ce120c10>) at remote 0x7f36ce120b90>, _Thread__stderr=<file at remote 0x7f384e2be1e0>, _Thread__target=<function at remote 0x7f38215...(truncated)\n    self.__target(*self.__args, **self.__kwargs)\n#15 Frame 0x7f3484000b50, for file /av/lib/third_party/python2.7/threading.py, line 810, in __bootstrap_inner (self=<Thread(_Thread__ident=139872963274496, _Thread__block=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f3725751db0>, acquire=<built-in method acquire of thread.lock object at remote 0x7f3725751db0>, _Condition__waiters=[], release=<built-in method release of thread.lock object at remote 0x7f3725751db0>) at remote 0x7f36ce120c90>, _Thread__name='Thread-9', _Thread__daemonic=True, _Thread__started=<_Event(_Verbose__verbose=False, _Event__flag=True, _Event__cond=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f37257510b0>, acquire=<built-in method acquire of thread.lock object at remote 0x7f37257510b0>, _Condition__waiters=[], release=<built-in method release of thread.lock object at remote 0x7f37257510b0>) at remote 0x7f36ce120c10>) at remote 0x7f36ce120b90>, _Thread__stderr=<file at remote 0x7f384e2be1e0>, _Thread__target=<function at re...(truncated)\n    self.run()\n#18 Frame 0x7f3464000b50, for file /av/lib/third_party/python2.7/threading.py, line 783, in __bootstrap (self=<Thread(_Thread__ident=139872963274496, _Thread__block=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f3725751db0>, acquire=<built-in method acquire of thread.lock object at remote 0x7f3725751db0>, _Condition__waiters=[], release=<built-in method release of thread.lock object at remote 0x7f3725751db0>) at remote 0x7f36ce120c90>, _Thread__name='Thread-9', _Thread__daemonic=True, _Thread__started=<_Event(_Verbose__verbose=False, _Event__flag=True, _Event__cond=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f37257510b0>, acquire=<built-in method acquire of thread.lock object at remote 0x7f37257510b0>, _Condition__waiters=[], release=<built-in method release of thread.lock object at remote 0x7f37257510b0>) at remote 0x7f36ce120c10>) at remote 0x7f36ce120b90>, _Thread__stderr=<file at remote 0x7f384e2be1e0>, _Thread__target=<function at remote 0...(truncated)\n    self.__bootstrap_inner()\n\nLooks we still have a deadlock issue.", "body": "@SsnL The newly designed dataloader still has issues and our training is still stalling.\r\nThe is from the stalled training process:\r\n\r\n1. From main thread:\r\n```\r\nThread 1 (Thread 0x7f384e2dc740 (LWP 237)):\r\n 353                            break\r\n 354                        remaining = endtime - _time()\r\n 355                        if remaining <= 0:\r\n 356                            break\r\n 357                        delay = min(delay * 2, remaining, .05)\r\n>358                        _sleep(delay)\r\n 359                    if not gotit:\r\n 360                        if __debug__:\r\n 361                            self._note(\"%s.wait(%s): timed out\", self, timeout)\r\n 362                        try:\r\n 363                            self.__waiters.remove(waiter)\r\n(gdb) py-bt\r\n#4 Frame 0x7f3484000910, for file /av/lib/third_party/python2.7/threading.py, line 358, in wait (self=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f37257518f0>, acquire=<built-in method acquire of thread.lock object at remote 0x7f37257518f0>, _Condition__waiters=[<thread.lock at remote 0x7f3725721e70>], release=<built-in method release of thread.lock object at remote 0x7f37257518f0>) at remote 0x7f36be885f50>, timeout=<float at remote 0x811eca8>, waiter=<thread.lock at remote 0x7f3725721e70>, saved_state=None, endtime=<float at remote 0x811ed38>, delay=<float at remote 0x27e2118>, gotit=False, remaining=<float at remote 0x811ecf0>)\r\n    _sleep(delay)\r\n#8 Frame 0x7f36b8cc5240, for file /av/lib/third_party/python2.7/Queue.py, line 177, in get (self=<Queue(unfinished_tasks=0, queue=<collections.deque at remote 0x7f36be882050>, maxsize=0, all_tasks_done=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f37257518f0>, acquire=<built-in method acquire of thread.lock object at remote 0x7f37257518f0>, _Condition__waiters=[], release=<built-in method release of thread.lock object at remote 0x7f37257518f0>) at remote 0x7f36ce120b50>, mutex=<thread.lock at remote 0x7f37257518f0>, not_full=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f37257518f0>, acquire=<built-in method acquire of thread.lock object at remote 0x7f37257518f0>, _Condition__waiters=[], release=<built-in method release of thread.lock object at remote 0x7f37257518f0>) at remote 0x7f36ce120b10>, not_empty=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f37257518f0>, acquire=<built-in method acquire of thread.lock ...(truncated)\r\n    self.not_empty.wait(remaining)\r\n#12 Frame 0x7f372461b410, for file /av/lib/python/torch/utils/data/dataloader.py, line 568, in _get_batch (self=<_DataLoaderIterM3(rcvd_idx=0, dataset=<TurnSignalsDataset(avg_length=<numpy.float64 at remote 0x7f36ce114c48>, _dataset=[{'images': [900434, 900435, 900436, 900437, 900438, 900439, 900440, 900441, 900442, 900443, 900444, 900445, 900446, 900447, 900448, 900449, 900450, 900451, 900452, 900453, 900454, 900455, 900456, 900457, 900458, 900459, 900460, 900461, 900462, 900463, 900464, 900465, 900466, 900467, 900468, 900469, 900470, 900471, 900472, 900473, 900474, 900475, 900476, 900477, 900478, 900479, 900480, 900481, 900482, 900483, 900484, 900485, 900486, 900487, 900488], 'view_states': <Tensor at remote 0x7f36e7d9e6e0>, 'right_states': <Tensor at remote 0x7f36e7d9e730>, 'dual_states': <Tensor at remote 0x7f36e7d9e7d0>, 'left_states': <Tensor at remote 0x7f36e7d9e550>}, {'images': [1162459, 1162460, 1162461, 1162462, 1162463, 1162464, 1162465, 1162466, 1162467, 1162468, 1162469, 1162470, 1162471, 1162472, 1...(truncated)\r\n    return self.data_queue.get(timeout=MP_STATUS_CHECK_INTERVAL)\r\n#15 Frame 0x7f36ce0bd620, for file /av/lib/python/torch/utils/data/dataloader.py, line 598, in __next__ (self=<_DataLoaderIterM3(rcvd_idx=0, dataset=<TurnSignalsDataset(avg_length=<numpy.float64 at remote 0x7f36ce114c48>, _dataset=[{'images': [900434, 900435, 900436, 900437, 900438, 900439, 900440, 900441, 900442, 900443, 900444, 900445, 900446, 900447, 900448, 900449, 900450, 900451, 900452, 900453, 900454, 900455, 900456, 900457, 900458, 900459, 900460, 900461, 900462, 900463, 900464, 900465, 900466, 900467, 900468, 900469, 900470, 900471, 900472, 900473, 900474, 900475, 900476, 900477, 900478, 900479, 900480, 900481, 900482, 900483, 900484, 900485, 900486, 900487, 900488], 'view_states': <Tensor at remote 0x7f36e7d9e6e0>, 'right_states': <Tensor at remote 0x7f36e7d9e730>, 'dual_states': <Tensor at remote 0x7f36e7d9e7d0>, 'left_states': <Tensor at remote 0x7f36e7d9e550>}, {'images': [1162459, 1162460, 1162461, 1162462, 1162463, 1162464, 1162465, 1162466, 1162467, 1162468, 1162469, 1162470, 1162471, 1162472, 116...(truncated)\r\n    idx, batch = self._get_batch()\r\n#18 Frame 0x7f36be898050, for file /av/python/av/experimental/toronto/data_reader/data_loader.py, line 31, in next (self=<_DataLoaderIterM3(rcvd_idx=0, dataset=<TurnSignalsDataset(avg_length=<numpy.float64 at remote 0x7f36ce114c48>, _dataset=[{'images': [900434, 900435, 900436, 900437, 900438, 900439, 900440, 900441, 900442, 900443, 900444, 900445, 900446, 900447, 900448, 900449, 900450, 900451, 900452, 900453, 900454, 900455, 900456, 900457, 900458, 900459, 900460, 900461, 900462, 900463, 900464, 900465, 900466, 900467, 900468, 900469, 900470, 900471, 900472, 900473, 900474, 900475, 900476, 900477, 900478, 900479, 900480, 900481, 900482, 900483, 900484, 900485, 900486, 900487, 900488], 'view_states': <Tensor at remote 0x7f36e7d9e6e0>, 'right_states': <Tensor at remote 0x7f36e7d9e730>, 'dual_states': <Tensor at remote 0x7f36e7d9e7d0>, 'left_states': <Tensor at remote 0x7f36e7d9e550>}, {'images': [1162459, 1162460, 1\r\n```\r\n2. From a background thread:\r\n```\r\n(gdb) thread 13\r\n[Switching to thread 13 (Thread 0x7f36b64a2700 (LWP 68162))]\r\n#0  0x00007f384d9e7fdd in poll () at ../sysdeps/unix/syscall-template.S:81\r\n81      ../sysdeps/unix/syscall-template.S: No such file or directory.\r\n(gdb) py-list\r\n 126                if not self._rlock.acquire(block, timeout):\r\n 127                    raise Empty\r\n 128                try:\r\n 129                    if block:\r\n 130                        timeout = deadline - time.time()\r\n>131                        if timeout < 0 or not self._poll(timeout):\r\n 132                            raise Empty\r\n 133                    elif not self._poll():\r\n 134                        raise Empty\r\n 135                    res = self._recv()\r\n 136                    self._sem.release()\r\n(gdb) py-bt\r\n#3 Frame 0x7f3484001040, for file /av/lib/third_party/python2.7/multiprocessing/queues.py, line 131, in get (self=<Queue(_writer=<ConnectionWrapper(conn=<_multiprocessing.Connection at remote 0x642b1a20>) at remote 0x7f36be885850>, _recv=<instancemethod at remote 0x7f36e7f4cb40>, _thread=None, _sem=<BoundedSemaphore(release=<built-in method release of _multiprocessing.SemLock object at remote 0x7f372689d3c0>, acquire=<built-in method acquire of _multiprocessing.SemLock object at remote 0x7f372689d3c0>, _semlock=<_multiprocessing.SemLock at remote 0x7f372689d3c0>) at remote 0x7f36be885110>, _buffer=<collections.deque at remote 0x7f36be8820c0>, _closed=False, _send=<instancemethod at remote 0x7f36b8cc9550>, _jointhread=None, _reader=<ConnectionWrapper(conn=<_multiprocessing.Connection at remote 0xb992630>) at remote 0x7f36be8853d0>, _opid=237, _rlock=<Lock(release=<built-in method release of _multiprocessing.SemLock object at remote 0x7f372689ef60>, acquire=<built-in method acquire of _multiprocessing.SemLock obje...(truncated)\r\n    if timeout < 0 or not self._poll(timeout):\r\n#7 Frame 0x7f36d4001cf0, for file /av/lib/python/torch/utils/data/dataloader.py, line 157, in _pin_memory_loop (in_queue=<Queue(_writer=<ConnectionWrapper(conn=<_multiprocessing.Connection at remote 0x642b1a20>) at remote 0x7f36be885850>, _recv=<instancemethod at remote 0x7f36e7f4cb40>, _thread=None, _sem=<BoundedSemaphore(release=<built-in method release of _multiprocessing.SemLock object at remote 0x7f372689d3c0>, acquire=<built-in method acquire of _multiprocessing.SemLock object at remote 0x7f372689d3c0>, _semlock=<_multiprocessing.SemLock at remote 0x7f372689d3c0>) at remote 0x7f36be885110>, _buffer=<collections.deque at remote 0x7f36be8820c0>, _closed=False, _send=<instancemethod at remote 0x7f36b8cc9550>, _jointhread=None, _reader=<ConnectionWrapper(conn=<_multiprocessing.Connection at remote 0xb992630>) at remote 0x7f36be8853d0>, _opid=237, _rlock=<Lock(release=<built-in method release of _multiprocessing.SemLock object at remote 0x7f372689ef60>, acquire=<built-in method acquire of _multiprocessing.SemLo...(truncated)\r\n    r = in_queue.get(timeout=MP_STATUS_CHECK_INTERVAL)\r\n#12 Frame 0x7f346c000da0, for file /av/lib/third_party/python2.7/threading.py, line 763, in run (self=<Thread(_Thread__ident=139872963274496, _Thread__block=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f3725751db0>, acquire=<built-in method acquire of thread.lock object at remote 0x7f3725751db0>, _Condition__waiters=[], release=<built-in method release of thread.lock object at remote 0x7f3725751db0>) at remote 0x7f36ce120c90>, _Thread__name='Thread-9', _Thread__daemonic=True, _Thread__started=<_Event(_Verbose__verbose=False, _Event__flag=True, _Event__cond=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f37257510b0>, acquire=<built-in method acquire of thread.lock object at remote 0x7f37257510b0>, _Condition__waiters=[], release=<built-in method release of thread.lock object at remote 0x7f37257510b0>) at remote 0x7f36ce120c10>) at remote 0x7f36ce120b90>, _Thread__stderr=<file at remote 0x7f384e2be1e0>, _Thread__target=<function at remote 0x7f38215...(truncated)\r\n    self.__target(*self.__args, **self.__kwargs)\r\n#15 Frame 0x7f3484000b50, for file /av/lib/third_party/python2.7/threading.py, line 810, in __bootstrap_inner (self=<Thread(_Thread__ident=139872963274496, _Thread__block=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f3725751db0>, acquire=<built-in method acquire of thread.lock object at remote 0x7f3725751db0>, _Condition__waiters=[], release=<built-in method release of thread.lock object at remote 0x7f3725751db0>) at remote 0x7f36ce120c90>, _Thread__name='Thread-9', _Thread__daemonic=True, _Thread__started=<_Event(_Verbose__verbose=False, _Event__flag=True, _Event__cond=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f37257510b0>, acquire=<built-in method acquire of thread.lock object at remote 0x7f37257510b0>, _Condition__waiters=[], release=<built-in method release of thread.lock object at remote 0x7f37257510b0>) at remote 0x7f36ce120c10>) at remote 0x7f36ce120b90>, _Thread__stderr=<file at remote 0x7f384e2be1e0>, _Thread__target=<function at re...(truncated)\r\n    self.run()\r\n#18 Frame 0x7f3464000b50, for file /av/lib/third_party/python2.7/threading.py, line 783, in __bootstrap (self=<Thread(_Thread__ident=139872963274496, _Thread__block=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f3725751db0>, acquire=<built-in method acquire of thread.lock object at remote 0x7f3725751db0>, _Condition__waiters=[], release=<built-in method release of thread.lock object at remote 0x7f3725751db0>) at remote 0x7f36ce120c90>, _Thread__name='Thread-9', _Thread__daemonic=True, _Thread__started=<_Event(_Verbose__verbose=False, _Event__flag=True, _Event__cond=<_Condition(_Verbose__verbose=False, _Condition__lock=<thread.lock at remote 0x7f37257510b0>, acquire=<built-in method acquire of thread.lock object at remote 0x7f37257510b0>, _Condition__waiters=[], release=<built-in method release of thread.lock object at remote 0x7f37257510b0>) at remote 0x7f36ce120c10>) at remote 0x7f36ce120b90>, _Thread__stderr=<file at remote 0x7f384e2be1e0>, _Thread__target=<function at remote 0...(truncated)\r\n    self.__bootstrap_inner()\r\n```\r\nLooks we still have a deadlock issue."}