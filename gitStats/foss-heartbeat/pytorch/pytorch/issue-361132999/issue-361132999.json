{"url": "https://api.github.com/repos/pytorch/pytorch/issues/11786", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/11786/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/11786/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/11786/events", "html_url": "https://github.com/pytorch/pytorch/issues/11786", "id": 361132999, "node_id": "MDU6SXNzdWUzNjExMzI5OTk=", "number": 11786, "title": "Mysterious error due to num_workers: 1", "user": {"login": "sytelus", "id": 2096835, "node_id": "MDQ6VXNlcjIwOTY4MzU=", "avatar_url": "https://avatars3.githubusercontent.com/u/2096835?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sytelus", "html_url": "https://github.com/sytelus", "followers_url": "https://api.github.com/users/sytelus/followers", "following_url": "https://api.github.com/users/sytelus/following{/other_user}", "gists_url": "https://api.github.com/users/sytelus/gists{/gist_id}", "starred_url": "https://api.github.com/users/sytelus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sytelus/subscriptions", "organizations_url": "https://api.github.com/users/sytelus/orgs", "repos_url": "https://api.github.com/users/sytelus/repos", "events_url": "https://api.github.com/users/sytelus/events{/privacy}", "received_events_url": "https://api.github.com/users/sytelus/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2018-09-18T04:39:45Z", "updated_at": "2018-09-25T02:24:19Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>While I have found the workaround for below, I thought to log this anyway so others can use some insights. In one of my projects I started getting this error randomly after I did bunch of refactoring:</p>\n<pre><code>Exception ignored in: &lt;bound method StorageRef.__del__ of &lt;torch.multiprocessing.reductions.StorageRef object at 0x00000258213645C0&gt;&gt;\nTraceback (most recent call last):\n  File \"C:\\Program Files\\Anaconda3\\lib\\site-packages\\torch\\multiprocessing\\reductions.py\", line 26, in __del__\nAttributeError: 'NoneType' object has no attribute 'Storage'\n</code></pre>\n<p>One of the things I'm doing in my code that is not usual is to train the model on CPU and test on GPU, so I basically do <code>model.to(...)</code> to move the model back and forth in each epoch for train and test. Apart from that this is just simple MNIST official CNN code in nutshell.</p>\n<p><strong>Workaround Found</strong></p>\n<p>I haven't yet figured out why exactly this is happening but it turns out that test DataLoader (which I want to use on GPU), had following parameters being passed:</p>\n<p><code>'num_workers': 1, 'pin_memory': True</code></p>\n<p>After I removed <code>'num_workers': 1</code>, the error disappeared.</p>\n<p><strong>Repro Code</strong></p>\n<p>I haven't done the minimal version of code that reproduces this error but you can get this code from <a href=\"https://github.com/sytelus/NNExp/tree/f5d8cdfcde39d867cc090546a94051426d96acd8\">this repo and commit</a>. If you run <a href=\"https://github.com/sytelus/NNExp/blob/f5d8cdfcde39d867cc090546a94051426d96acd8/NNExp/pytorch/mnist/partial_data.py\">partial_data.py</a>, you will see above error shown in the console.</p>\n<p><strong>Other Info</strong><br>\nPyTorch version: 0.4.1<br>\nIs debug build: No<br>\nCUDA used to build PyTorch: 9.0</p>\n<p>OS: Microsoft Windows 10 Enterprise<br>\nCMake version: version 3.10.2</p>\n<p>Python version: 3.5<br>\nIs CUDA available: Yes<br>\nCUDA runtime version: 9.2.88<br>\nGPU models and configuration:<br>\nGPU 0: TITAN Xp<br>\nGPU 1: TITAN Xp</p>\n<p>Nvidia driver version: 397.44<br>\ncuDNN version: 7.2</p>\n<p>Versions of relevant libraries:<br>\n[pip] Could not collect<br>\n[conda] pytorch                   0.4.1           py35_cuda90_cudnn7he774522_1    pytorch<br>\n[conda] torch                     0.5.0a0+f45dfbc           <br>\n[conda] torchvision               0.2.1                     </p>", "body_text": "While I have found the workaround for below, I thought to log this anyway so others can use some insights. In one of my projects I started getting this error randomly after I did bunch of refactoring:\nException ignored in: <bound method StorageRef.__del__ of <torch.multiprocessing.reductions.StorageRef object at 0x00000258213645C0>>\nTraceback (most recent call last):\n  File \"C:\\Program Files\\Anaconda3\\lib\\site-packages\\torch\\multiprocessing\\reductions.py\", line 26, in __del__\nAttributeError: 'NoneType' object has no attribute 'Storage'\n\nOne of the things I'm doing in my code that is not usual is to train the model on CPU and test on GPU, so I basically do model.to(...) to move the model back and forth in each epoch for train and test. Apart from that this is just simple MNIST official CNN code in nutshell.\nWorkaround Found\nI haven't yet figured out why exactly this is happening but it turns out that test DataLoader (which I want to use on GPU), had following parameters being passed:\n'num_workers': 1, 'pin_memory': True\nAfter I removed 'num_workers': 1, the error disappeared.\nRepro Code\nI haven't done the minimal version of code that reproduces this error but you can get this code from this repo and commit. If you run partial_data.py, you will see above error shown in the console.\nOther Info\nPyTorch version: 0.4.1\nIs debug build: No\nCUDA used to build PyTorch: 9.0\nOS: Microsoft Windows 10 Enterprise\nCMake version: version 3.10.2\nPython version: 3.5\nIs CUDA available: Yes\nCUDA runtime version: 9.2.88\nGPU models and configuration:\nGPU 0: TITAN Xp\nGPU 1: TITAN Xp\nNvidia driver version: 397.44\ncuDNN version: 7.2\nVersions of relevant libraries:\n[pip] Could not collect\n[conda] pytorch                   0.4.1           py35_cuda90_cudnn7he774522_1    pytorch\n[conda] torch                     0.5.0a0+f45dfbc           \n[conda] torchvision               0.2.1", "body": "While I have found the workaround for below, I thought to log this anyway so others can use some insights. In one of my projects I started getting this error randomly after I did bunch of refactoring:\r\n\r\n```\r\nException ignored in: <bound method StorageRef.__del__ of <torch.multiprocessing.reductions.StorageRef object at 0x00000258213645C0>>\r\nTraceback (most recent call last):\r\n  File \"C:\\Program Files\\Anaconda3\\lib\\site-packages\\torch\\multiprocessing\\reductions.py\", line 26, in __del__\r\nAttributeError: 'NoneType' object has no attribute 'Storage'\r\n```\r\n\r\nOne of the things I'm doing in my code that is not usual is to train the model on CPU and test on GPU, so I basically do `model.to(...)` to move the model back and forth in each epoch for train and test. Apart from that this is just simple MNIST official CNN code in nutshell.\r\n\r\n**Workaround Found**\r\n\r\nI haven't yet figured out why exactly this is happening but it turns out that test DataLoader (which I want to use on GPU), had following parameters being passed:\r\n\r\n`'num_workers': 1, 'pin_memory': True`\r\n\r\nAfter I removed `'num_workers': 1`, the error disappeared.\r\n\r\n**Repro Code**\r\n\r\nI haven't done the minimal version of code that reproduces this error but you can get this code from [this repo and commit](https://github.com/sytelus/NNExp/tree/f5d8cdfcde39d867cc090546a94051426d96acd8). If you run [partial_data.py](https://github.com/sytelus/NNExp/blob/f5d8cdfcde39d867cc090546a94051426d96acd8/NNExp/pytorch/mnist/partial_data.py), you will see above error shown in the console.\r\n\r\n**Other Info**\r\nPyTorch version: 0.4.1\r\nIs debug build: No\r\nCUDA used to build PyTorch: 9.0\r\n\r\nOS: Microsoft Windows 10 Enterprise\r\nCMake version: version 3.10.2\r\n\r\nPython version: 3.5\r\nIs CUDA available: Yes\r\nCUDA runtime version: 9.2.88\r\nGPU models and configuration:\r\nGPU 0: TITAN Xp\r\nGPU 1: TITAN Xp\r\n\r\nNvidia driver version: 397.44\r\ncuDNN version: 7.2\r\n\r\nVersions of relevant libraries:\r\n[pip] Could not collect\r\n[conda] pytorch                   0.4.1           py35_cuda90_cudnn7he774522_1    pytorch\r\n[conda] torch                     0.5.0a0+f45dfbc           <pip>\r\n[conda] torchvision               0.2.1                     <pip>"}