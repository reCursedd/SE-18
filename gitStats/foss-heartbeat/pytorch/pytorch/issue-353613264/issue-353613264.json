{"url": "https://api.github.com/repos/pytorch/pytorch/issues/10844", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/10844/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/10844/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/10844/events", "html_url": "https://github.com/pytorch/pytorch/pull/10844", "id": 353613264, "node_id": "MDExOlB1bGxSZXF1ZXN0MjEwNjE4NTU4", "number": 10844, "title": "Prevent JIT from overspecializing to every single size configuration", "user": {"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-08-24T01:45:06Z", "updated_at": "2018-11-23T15:50:01Z", "closed_at": "2018-08-26T16:55:51Z", "author_association": "MEMBER", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/10844", "html_url": "https://github.com/pytorch/pytorch/pull/10844", "diff_url": "https://github.com/pytorch/pytorch/pull/10844.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/10844.patch"}, "body_html": "<p>Please review the expects carefully to make sure there are no regressions. I tried to go over them one by one when they changed, but it's sometimes easy to miss finer details.</p>\n<p>Summary of changes:</p>\n<ul>\n<li>Renamed <code>TensorType</code> to <code>CompleteTensorType</code>. Added a new <code>TensorType</code> which records only the scalar type, number of dimensions, and device of a value. The argument behind the rename is to encourage people to use <code>CompleteTensorType</code> less, as most passes will only have limited information available. To make transition easier <code>complete_type-&gt;cast&lt;TensorType&gt;()</code> works, and makes our passes work with both kinds of specialization if they don't need extra the extra detail.</li>\n<li>Renamed <code>ArgumentSpec</code> to <code>CompleteArgumentSpec</code>. Added a new <code>ArgumentSpec</code>, which matches argument only at the level of the new <code>TensorType</code>.</li>\n<li>Shape analysis can process graphs with both <code>CompleteTensorType</code> and <code>TensorType</code>.</li>\n<li>Fuser was a part that heavily relied on full shape information being available. Now, we simply try to fuse the largest possible graphs, and have to do run-time checks to make sure they match the code we generate. If they don't, we fall back to regular interpretation. The shape checks are implementing using an optimized method exploiting algebraic properties of shapes with broadcasting, and the relations of broadcasting with pointwise ops. A full written proof of correctness of the shape checking algorithm is included in a comment in <code>graph_fuser.cpp</code>.</li>\n</ul>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=370202\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/zdevito\">@zdevito</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=13564\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ezyang\">@ezyang</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=38511765\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/mruberry\">@mruberry</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=15841449\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ngimel\">@ngimel</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=22205833\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/csarofeen\">@csarofeen</a></p>", "body_text": "Please review the expects carefully to make sure there are no regressions. I tried to go over them one by one when they changed, but it's sometimes easy to miss finer details.\nSummary of changes:\n\nRenamed TensorType to CompleteTensorType. Added a new TensorType which records only the scalar type, number of dimensions, and device of a value. The argument behind the rename is to encourage people to use CompleteTensorType less, as most passes will only have limited information available. To make transition easier complete_type->cast<TensorType>() works, and makes our passes work with both kinds of specialization if they don't need extra the extra detail.\nRenamed ArgumentSpec to CompleteArgumentSpec. Added a new ArgumentSpec, which matches argument only at the level of the new TensorType.\nShape analysis can process graphs with both CompleteTensorType and TensorType.\nFuser was a part that heavily relied on full shape information being available. Now, we simply try to fuse the largest possible graphs, and have to do run-time checks to make sure they match the code we generate. If they don't, we fall back to regular interpretation. The shape checks are implementing using an optimized method exploiting algebraic properties of shapes with broadcasting, and the relations of broadcasting with pointwise ops. A full written proof of correctness of the shape checking algorithm is included in a comment in graph_fuser.cpp.\n\n@zdevito @ezyang @mruberry @ngimel @csarofeen", "body": "Please review the expects carefully to make sure there are no regressions. I tried to go over them one by one when they changed, but it's sometimes easy to miss finer details.\r\n\r\nSummary of changes:\r\n\r\n- Renamed `TensorType` to `CompleteTensorType`. Added a new `TensorType` which records only the scalar type, number of dimensions, and device of a value. The argument behind the rename is to encourage people to use `CompleteTensorType` less, as most passes will only have limited information available. To make transition easier `complete_type->cast<TensorType>()` works, and makes our passes work with both kinds of specialization if they don't need extra the extra detail.\r\n- Renamed `ArgumentSpec` to `CompleteArgumentSpec`. Added a new `ArgumentSpec`, which matches argument only at the level of the new `TensorType`.\r\n- Shape analysis can process graphs with both `CompleteTensorType` and `TensorType`.\r\n- Fuser was a part that heavily relied on full shape information being available. Now, we simply try to fuse the largest possible graphs, and have to do run-time checks to make sure they match the code we generate. If they don't, we fall back to regular interpretation. The shape checks are implementing using an optimized method exploiting algebraic properties of shapes with broadcasting, and the relations of broadcasting with pointwise ops. A full written proof of correctness of the shape checking algorithm is included in a comment in `graph_fuser.cpp`.\r\n\r\n@zdevito @ezyang @mruberry @ngimel @csarofeen"}