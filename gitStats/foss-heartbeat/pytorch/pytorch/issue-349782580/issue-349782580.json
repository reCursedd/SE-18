{"url": "https://api.github.com/repos/pytorch/pytorch/issues/10446", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/10446/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/10446/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/10446/events", "html_url": "https://github.com/pytorch/pytorch/issues/10446", "id": 349782580, "node_id": "MDU6SXNzdWUzNDk3ODI1ODA=", "number": 10446, "title": "using nn.functional.interpolation but fails on ONNX export", "user": {"login": "yancz1989", "id": 4943071, "node_id": "MDQ6VXNlcjQ5NDMwNzE=", "avatar_url": "https://avatars0.githubusercontent.com/u/4943071?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yancz1989", "html_url": "https://github.com/yancz1989", "followers_url": "https://api.github.com/users/yancz1989/followers", "following_url": "https://api.github.com/users/yancz1989/following{/other_user}", "gists_url": "https://api.github.com/users/yancz1989/gists{/gist_id}", "starred_url": "https://api.github.com/users/yancz1989/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yancz1989/subscriptions", "organizations_url": "https://api.github.com/users/yancz1989/orgs", "repos_url": "https://api.github.com/users/yancz1989/repos", "events_url": "https://api.github.com/users/yancz1989/events{/privacy}", "received_events_url": "https://api.github.com/users/yancz1989/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 693805995, "node_id": "MDU6TGFiZWw2OTM4MDU5OTU=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/onnx", "name": "onnx", "color": "e99695", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2018-08-12T03:59:18Z", "updated_at": "2018-10-12T16:49:19Z", "closed_at": "2018-09-10T19:20:55Z", "author_association": "NONE", "body_html": "<p>Hi, everyone,</p>\n<p>I'm implementing some segmentation model, and need to use ONNX to convert to caffe2 model. with following code, I have specified the align_corners variable to False, explicitly.</p>\n<pre><code>for encode, decoder in zip(encodes[::-1][1:], self.decode_layers[1:]):\n  x = decoder(torch.cat([F.interpolate(x, encode.size()[2:], mode = 'bilinear', align_corners = False), encode], 1))\nreturn self.segmentation(F.interpolate(x, input_shp, mode = 'bilinear', align_corners = False))\n</code></pre>\n<p>However, when I use ONNX to export this model to caffe2, following error occurs:</p>\n<p>/usr/local/lib/python3.5/dist-packages/torch/onnx/symbolic.py:69: UserWarning: ONNX export failed on upsample_bilinear2d because align_corners == True not supported<br>\nwarnings.warn(\"ONNX export failed on \" + op + \" because \" + msg + \" not supported\")<br>\nTraceback (most recent call last):<br>\nFile \"pytorch2caffe.py\", line 99, in <br>\nexport_params=True)      # store the trained parameter weights inside the model file<br>\nFile \"/usr/local/lib/python3.5/dist-packages/torch/onnx/<strong>init</strong>.py\", line 21, in _export<br>\nreturn utils._export(*args, **kwargs)<br>\nFile \"/usr/local/lib/python3.5/dist-packages/torch/onnx/utils.py\", line 232, in _export<br>\nproto, export_map = graph.export(params, _onnx_opset_version, defer_weight_export, operator_export_type)<br>\nRuntimeError: ONNX export failed: Couldn't export operator aten::upsample_bilinear2d</p>\n<p>This is strange, since I have explicitly set align_corners to False.</p>\n<p>Can anyone help me on this issue? Any kind of suggestion is welcomed. Thanks for your kindly information.</p>", "body_text": "Hi, everyone,\nI'm implementing some segmentation model, and need to use ONNX to convert to caffe2 model. with following code, I have specified the align_corners variable to False, explicitly.\nfor encode, decoder in zip(encodes[::-1][1:], self.decode_layers[1:]):\n  x = decoder(torch.cat([F.interpolate(x, encode.size()[2:], mode = 'bilinear', align_corners = False), encode], 1))\nreturn self.segmentation(F.interpolate(x, input_shp, mode = 'bilinear', align_corners = False))\n\nHowever, when I use ONNX to export this model to caffe2, following error occurs:\n/usr/local/lib/python3.5/dist-packages/torch/onnx/symbolic.py:69: UserWarning: ONNX export failed on upsample_bilinear2d because align_corners == True not supported\nwarnings.warn(\"ONNX export failed on \" + op + \" because \" + msg + \" not supported\")\nTraceback (most recent call last):\nFile \"pytorch2caffe.py\", line 99, in \nexport_params=True)      # store the trained parameter weights inside the model file\nFile \"/usr/local/lib/python3.5/dist-packages/torch/onnx/init.py\", line 21, in _export\nreturn utils._export(*args, **kwargs)\nFile \"/usr/local/lib/python3.5/dist-packages/torch/onnx/utils.py\", line 232, in _export\nproto, export_map = graph.export(params, _onnx_opset_version, defer_weight_export, operator_export_type)\nRuntimeError: ONNX export failed: Couldn't export operator aten::upsample_bilinear2d\nThis is strange, since I have explicitly set align_corners to False.\nCan anyone help me on this issue? Any kind of suggestion is welcomed. Thanks for your kindly information.", "body": "Hi, everyone,\r\n\r\nI'm implementing some segmentation model, and need to use ONNX to convert to caffe2 model. with following code, I have specified the align_corners variable to False, explicitly.\r\n\r\n    for encode, decoder in zip(encodes[::-1][1:], self.decode_layers[1:]):\r\n      x = decoder(torch.cat([F.interpolate(x, encode.size()[2:], mode = 'bilinear', align_corners = False), encode], 1))\r\n    return self.segmentation(F.interpolate(x, input_shp, mode = 'bilinear', align_corners = False))\r\n\r\nHowever, when I use ONNX to export this model to caffe2, following error occurs:\r\n\r\n/usr/local/lib/python3.5/dist-packages/torch/onnx/symbolic.py:69: UserWarning: ONNX export failed on upsample_bilinear2d because align_corners == True not supported\r\n  warnings.warn(\"ONNX export failed on \" + op + \" because \" + msg + \" not supported\")\r\nTraceback (most recent call last):\r\n  File \"pytorch2caffe.py\", line 99, in <module>\r\n    export_params=True)      # store the trained parameter weights inside the model file\r\n  File \"/usr/local/lib/python3.5/dist-packages/torch/onnx/__init__.py\", line 21, in _export\r\n    return utils._export(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.5/dist-packages/torch/onnx/utils.py\", line 232, in _export\r\n    proto, export_map = graph.export(params, _onnx_opset_version, defer_weight_export, operator_export_type)\r\nRuntimeError: ONNX export failed: Couldn't export operator aten::upsample_bilinear2d\r\n\r\nThis is strange, since I have explicitly set align_corners to False.\r\n\r\nCan anyone help me on this issue? Any kind of suggestion is welcomed. Thanks for your kindly information."}