{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/161879811", "pull_request_review_id": 89240609, "id": 161879811, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MTg3OTgxMQ==", "diff_hunk": "@@ -1732,5 +1732,47 @@ def test_multinomial_log_prob_with_logits(self):\n             self.assertEqual(log_pdf_prob_0.data[0], -float('inf'), allow_inf=True)\n \n \n+class TestLazyLogitsInitialization(TestCase):\n+    def setUp(self):\n+        self.examples = [e for e in EXAMPLES if e.Dist in\n+                         (Categorical, OneHotCategorical, Bernoulli, Multinomial)]\n+\n+    def test_lazy_logits_initialization(self):\n+        for Dist, params in self.examples:\n+            param = params[0]\n+            if 'probs' in param:\n+                probs = param.pop('probs')\n+                param['logits'] = probs_to_logits(probs)\n+                dist = Dist(**param)\n+                shape = (1,) if not dist.event_shape else dist.event_shape\n+                dist.log_prob(Variable(torch.ones(shape)))\n+                message = 'Failed for {} example 0/{}'.format(Dist.__name__, len(params))\n+                self.assertFalse('probs' in vars(dist), msg=message)\n+                try:\n+                    dist.enumerate_support()\n+                except NotImplementedError:\n+                    pass\n+                self.assertFalse('probs' in vars(dist), msg=message)\n+                batch_shape, event_shape = dist.batch_shape, dist.event_shape\n+                self.assertFalse('probs' in vars(dist), msg=message)\n+\n+    def test_lazy_probs_initialization(self):\n+        for Dist, params in self.examples:\n+            param = params[0]\n+            if 'probs' in param:\n+                dist = Dist(**param)\n+                dist.sample()\n+                message = 'Failed for {} example 0/{}'.format(Dist.__name__, len(params))\n+                self.assertFalse('logits' in vars(dist), msg=message)\n+                try:\n+                    dist.enumerate_support()\n+                except NotImplementedError:\n+                    pass\n+                self.assertFalse('logits' in vars(dist), msg=message)\n+                batch_shape, event_shape = dist.batch_shape, dist.event_shape\n+                print vars(dist)", "path": "test/test_distributions.py", "position": null, "original_position": 51, "commit_id": "e7b2bbb187b455c58029aa4ac87fd0b85f47989b", "original_commit_id": "fb9c36ac6facaeda7864131f68a9b86afb86db8b", "user": {"login": "neerajprad", "id": 1762463, "node_id": "MDQ6VXNlcjE3NjI0NjM=", "avatar_url": "https://avatars3.githubusercontent.com/u/1762463?v=4", "gravatar_id": "", "url": "https://api.github.com/users/neerajprad", "html_url": "https://github.com/neerajprad", "followers_url": "https://api.github.com/users/neerajprad/followers", "following_url": "https://api.github.com/users/neerajprad/following{/other_user}", "gists_url": "https://api.github.com/users/neerajprad/gists{/gist_id}", "starred_url": "https://api.github.com/users/neerajprad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/neerajprad/subscriptions", "organizations_url": "https://api.github.com/users/neerajprad/orgs", "repos_url": "https://api.github.com/users/neerajprad/repos", "events_url": "https://api.github.com/users/neerajprad/events{/privacy}", "received_events_url": "https://api.github.com/users/neerajprad/received_events", "type": "User", "site_admin": false}, "body": "My bad..missed removing this.", "created_at": "2018-01-16T20:40:05Z", "updated_at": "2018-11-23T15:38:14Z", "html_url": "https://github.com/pytorch/pytorch/pull/4691#discussion_r161879811", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/4691", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/161879811"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/4691#discussion_r161879811"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/4691"}}, "body_html": "<p>My bad..missed removing this.</p>", "body_text": "My bad..missed removing this.", "in_reply_to_id": 161879401}