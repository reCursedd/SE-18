{"url": "https://api.github.com/repos/pytorch/pytorch/issues/4716", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/4716/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/4716/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/4716/events", "html_url": "https://github.com/pytorch/pytorch/issues/4716", "id": 289465814, "node_id": "MDU6SXNzdWUyODk0NjU4MTQ=", "number": 4716, "title": "Compilation issue: problem with GPU capability check", "user": {"login": "vadimkantorov", "id": 1041752, "node_id": "MDQ6VXNlcjEwNDE3NTI=", "avatar_url": "https://avatars0.githubusercontent.com/u/1041752?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vadimkantorov", "html_url": "https://github.com/vadimkantorov", "followers_url": "https://api.github.com/users/vadimkantorov/followers", "following_url": "https://api.github.com/users/vadimkantorov/following{/other_user}", "gists_url": "https://api.github.com/users/vadimkantorov/gists{/gist_id}", "starred_url": "https://api.github.com/users/vadimkantorov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vadimkantorov/subscriptions", "organizations_url": "https://api.github.com/users/vadimkantorov/orgs", "repos_url": "https://api.github.com/users/vadimkantorov/repos", "events_url": "https://api.github.com/users/vadimkantorov/events{/privacy}", "received_events_url": "https://api.github.com/users/vadimkantorov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 778855555, "node_id": "MDU6TGFiZWw3Nzg4NTU1NTU=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/build", "name": "build", "color": "bfdadc", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-01-18T00:47:08Z", "updated_at": "2018-10-25T23:37:16Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>cudnn 7.0.3, cuda 8.0, gcc 5.4, ubuntu 16.04<br>\nThe machine has three GPUs: two Pascal ones, and one simple old one.</p>\n<p>When I don't set CUDA_VISIBLE_DEVICES prior to compilation, automatic GPU capability discovery picks on a wrong GPU and fails with <code>__shfl_xor</code> undefined.</p>\n<p>The pytorch repo README doesn't mention the need to set CUDA_VISIBLE_DEVICES to a target GPU before compilation.</p>\n<pre><code>.../pytorch/aten/src/THC/generated/../THCDeviceUtils.cuh(61): error: identifier \"__shfl_xor\" is undefined\n          detected during:\n            instantiation of \"T WARP_SHFL_XOR(T, int, int, unsigned int) [with T=float]\"\n.../pytorch/aten/src/THC/generated/../THCTensorMathReduce.cuh(445): here\n            instantiation of \"void THCTensor_kernel_varInnermostDim&lt;Real,Accreal,flag,apply_sqrt&gt;(Real *, Real *, unsigned int, unsigned int) [with Real=half, Accreal=float, flag=true, apply_sqrt=true]\"\n.../pytorch/aten/src/THC/generated/../THCTensorMathReduce.cuh(505): here\n            instantiation of \"void THCTensor_varInnermostDim&lt;TensorTypeK,Real,Accreal,apply_sqrt&gt;(THCState *, TensorTypeK *, TensorTypeK *, int) [with TensorTypeK=THCudaHalfTensor, Real=half, Accreal=float, apply_sqrt=true]\"\n...pytorch/aten/src/THC/generated/../generic/THCTensorMathReduce.cu(89): here\n\n...pytorch/aten/src/THC/generated/../THCDeviceUtils.cuh(91): error: identifier \"__shfl_down\" is undefined\n          detected during:\n            instantiation of \"T WARP_SHFL_DOWN(T, unsigned int, int, unsigned int) [with T=float]\"\n...pytorch/aten/src/THC/generated/../THCTensorMathReduce.cuh(471): here\n            instantiation of \"void THCTensor_kernel_varInnermostDim&lt;Real,Accreal,flag,apply_sqrt&gt;(Real *, Real *, unsigned int, unsigned int) [with Real=half, Accreal=float, flag=true, apply_sqrt=true]\"\n...pytorch/aten/src/THC/generated/../THCTensorMathReduce.cuh(505): here\n            instantiation of \"void THCTensor_varInnermostDim&lt;TensorTypeK,Real,Accreal,apply_sqrt&gt;(THCState *, TensorTypeK *, TensorTypeK *, int) [with TensorTypeK=THCudaHalfTensor, Real=half, Accreal=float, apply_sqrt=true]\"\n...pytorch/aten/src/THC/generated/../generic/THCTensorMathReduce.cu(89): here\n\n2 errors detected in the compilation of \"/tmp/tmpxft_00007616_00000000-9_THCTensorMathReduceHalf.compute_20.cpp1.ii\".\nCMake Error at ATen_generated_THCTensorMathReduceHalf.cu.o.cmake:267 (message):\n  Error generating file\n  .../pytorch/torch/lib/build/aten/src/ATen/CMakeFiles/ATen.dir/__/THC/generated/./ATen_generated_THCTensorMathReduceHalf.cu.o\n</code></pre>", "body_text": "cudnn 7.0.3, cuda 8.0, gcc 5.4, ubuntu 16.04\nThe machine has three GPUs: two Pascal ones, and one simple old one.\nWhen I don't set CUDA_VISIBLE_DEVICES prior to compilation, automatic GPU capability discovery picks on a wrong GPU and fails with __shfl_xor undefined.\nThe pytorch repo README doesn't mention the need to set CUDA_VISIBLE_DEVICES to a target GPU before compilation.\n.../pytorch/aten/src/THC/generated/../THCDeviceUtils.cuh(61): error: identifier \"__shfl_xor\" is undefined\n          detected during:\n            instantiation of \"T WARP_SHFL_XOR(T, int, int, unsigned int) [with T=float]\"\n.../pytorch/aten/src/THC/generated/../THCTensorMathReduce.cuh(445): here\n            instantiation of \"void THCTensor_kernel_varInnermostDim<Real,Accreal,flag,apply_sqrt>(Real *, Real *, unsigned int, unsigned int) [with Real=half, Accreal=float, flag=true, apply_sqrt=true]\"\n.../pytorch/aten/src/THC/generated/../THCTensorMathReduce.cuh(505): here\n            instantiation of \"void THCTensor_varInnermostDim<TensorTypeK,Real,Accreal,apply_sqrt>(THCState *, TensorTypeK *, TensorTypeK *, int) [with TensorTypeK=THCudaHalfTensor, Real=half, Accreal=float, apply_sqrt=true]\"\n...pytorch/aten/src/THC/generated/../generic/THCTensorMathReduce.cu(89): here\n\n...pytorch/aten/src/THC/generated/../THCDeviceUtils.cuh(91): error: identifier \"__shfl_down\" is undefined\n          detected during:\n            instantiation of \"T WARP_SHFL_DOWN(T, unsigned int, int, unsigned int) [with T=float]\"\n...pytorch/aten/src/THC/generated/../THCTensorMathReduce.cuh(471): here\n            instantiation of \"void THCTensor_kernel_varInnermostDim<Real,Accreal,flag,apply_sqrt>(Real *, Real *, unsigned int, unsigned int) [with Real=half, Accreal=float, flag=true, apply_sqrt=true]\"\n...pytorch/aten/src/THC/generated/../THCTensorMathReduce.cuh(505): here\n            instantiation of \"void THCTensor_varInnermostDim<TensorTypeK,Real,Accreal,apply_sqrt>(THCState *, TensorTypeK *, TensorTypeK *, int) [with TensorTypeK=THCudaHalfTensor, Real=half, Accreal=float, apply_sqrt=true]\"\n...pytorch/aten/src/THC/generated/../generic/THCTensorMathReduce.cu(89): here\n\n2 errors detected in the compilation of \"/tmp/tmpxft_00007616_00000000-9_THCTensorMathReduceHalf.compute_20.cpp1.ii\".\nCMake Error at ATen_generated_THCTensorMathReduceHalf.cu.o.cmake:267 (message):\n  Error generating file\n  .../pytorch/torch/lib/build/aten/src/ATen/CMakeFiles/ATen.dir/__/THC/generated/./ATen_generated_THCTensorMathReduceHalf.cu.o", "body": "cudnn 7.0.3, cuda 8.0, gcc 5.4, ubuntu 16.04\r\nThe machine has three GPUs: two Pascal ones, and one simple old one.\r\n\r\nWhen I don't set CUDA_VISIBLE_DEVICES prior to compilation, automatic GPU capability discovery picks on a wrong GPU and fails with `__shfl_xor` undefined.\r\n\r\nThe pytorch repo README doesn't mention the need to set CUDA_VISIBLE_DEVICES to a target GPU before compilation.\r\n\r\n```\r\n.../pytorch/aten/src/THC/generated/../THCDeviceUtils.cuh(61): error: identifier \"__shfl_xor\" is undefined\r\n          detected during:\r\n            instantiation of \"T WARP_SHFL_XOR(T, int, int, unsigned int) [with T=float]\"\r\n.../pytorch/aten/src/THC/generated/../THCTensorMathReduce.cuh(445): here\r\n            instantiation of \"void THCTensor_kernel_varInnermostDim<Real,Accreal,flag,apply_sqrt>(Real *, Real *, unsigned int, unsigned int) [with Real=half, Accreal=float, flag=true, apply_sqrt=true]\"\r\n.../pytorch/aten/src/THC/generated/../THCTensorMathReduce.cuh(505): here\r\n            instantiation of \"void THCTensor_varInnermostDim<TensorTypeK,Real,Accreal,apply_sqrt>(THCState *, TensorTypeK *, TensorTypeK *, int) [with TensorTypeK=THCudaHalfTensor, Real=half, Accreal=float, apply_sqrt=true]\"\r\n...pytorch/aten/src/THC/generated/../generic/THCTensorMathReduce.cu(89): here\r\n\r\n...pytorch/aten/src/THC/generated/../THCDeviceUtils.cuh(91): error: identifier \"__shfl_down\" is undefined\r\n          detected during:\r\n            instantiation of \"T WARP_SHFL_DOWN(T, unsigned int, int, unsigned int) [with T=float]\"\r\n...pytorch/aten/src/THC/generated/../THCTensorMathReduce.cuh(471): here\r\n            instantiation of \"void THCTensor_kernel_varInnermostDim<Real,Accreal,flag,apply_sqrt>(Real *, Real *, unsigned int, unsigned int) [with Real=half, Accreal=float, flag=true, apply_sqrt=true]\"\r\n...pytorch/aten/src/THC/generated/../THCTensorMathReduce.cuh(505): here\r\n            instantiation of \"void THCTensor_varInnermostDim<TensorTypeK,Real,Accreal,apply_sqrt>(THCState *, TensorTypeK *, TensorTypeK *, int) [with TensorTypeK=THCudaHalfTensor, Real=half, Accreal=float, apply_sqrt=true]\"\r\n...pytorch/aten/src/THC/generated/../generic/THCTensorMathReduce.cu(89): here\r\n\r\n2 errors detected in the compilation of \"/tmp/tmpxft_00007616_00000000-9_THCTensorMathReduceHalf.compute_20.cpp1.ii\".\r\nCMake Error at ATen_generated_THCTensorMathReduceHalf.cu.o.cmake:267 (message):\r\n  Error generating file\r\n  .../pytorch/torch/lib/build/aten/src/ATen/CMakeFiles/ATen.dir/__/THC/generated/./ATen_generated_THCTensorMathReduceHalf.cu.o\r\n```"}