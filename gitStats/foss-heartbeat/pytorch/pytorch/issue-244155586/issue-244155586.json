{"url": "https://api.github.com/repos/pytorch/pytorch/issues/2153", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/2153/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/2153/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/2153/events", "html_url": "https://github.com/pytorch/pytorch/issues/2153", "id": 244155586, "node_id": "MDU6SXNzdWUyNDQxNTU1ODY=", "number": 2153, "title": "Pytorch Multi-processing could not initialize CUDA object after initialize Network with Caffe", "user": {"login": "ywu36", "id": 16822689, "node_id": "MDQ6VXNlcjE2ODIyNjg5", "avatar_url": "https://avatars1.githubusercontent.com/u/16822689?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ywu36", "html_url": "https://github.com/ywu36", "followers_url": "https://api.github.com/users/ywu36/followers", "following_url": "https://api.github.com/users/ywu36/following{/other_user}", "gists_url": "https://api.github.com/users/ywu36/gists{/gist_id}", "starred_url": "https://api.github.com/users/ywu36/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ywu36/subscriptions", "organizations_url": "https://api.github.com/users/ywu36/orgs", "repos_url": "https://api.github.com/users/ywu36/repos", "events_url": "https://api.github.com/users/ywu36/events{/privacy}", "received_events_url": "https://api.github.com/users/ywu36/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-07-19T19:55:55Z", "updated_at": "2017-07-19T20:15:40Z", "closed_at": "2017-07-19T19:57:36Z", "author_association": "NONE", "body_html": "<p>Hi,<br>\nI met a strange error that after I initialize a Caffe network using:</p>\n<p><code>net = caffe.Net(CaffeModel, weights, caffe.TEST)</code></p>\n<p>Then, whenever I try to create a CUDA model in a subprocess using Pytorch:</p>\n<pre><code>def traina(model):\n    model2 = PytorchNetworkStructure().cuda()\n\nprocesses = []\nfor model_idx in range(3):\n    p = mp.Process(target=train, args=(PytorchModel,))\n    p.start()\n    processes.append(p)\nfor p in processes:\n    p.join()\n</code></pre>\n<p>The program will report the error:</p>\n<pre><code>&gt; THCudaCheck FAIL file=/home/yuhang/dependencies/pytorch-master/torch/lib/THC/THCGeneral.c line=74 error=3 : initialization error\nProcess Process-1:\n&gt; Traceback (most recent call last):\n&gt;   File \"/home/yuhang/anaconda2/lib/python2.7/multiprocessing/process.py\", line 258, in _bootstrap\n&gt;     self.run()\n&gt;   File \"/home/yuhang/anaconda2/lib/python2.7/multiprocessing/process.py\", line 114, in run\n&gt;     self._target(*self._args, **self._kwargs)\n&gt;   File \"....py\", line 43, in traina\n&gt;     model2 = PytorchNetworkStructure().cuda()\n&gt;   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/nn/modules/module.py\", line 148, in cuda\n&gt;     return self._apply(lambda t: t.cuda(device_id))\n&gt;   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/nn/modules/module.py\", line 119, in _apply\n&gt;     module._apply(fn)\n&gt;   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/nn/modules/module.py\", line 125, in _apply\n&gt;     param.data = fn(param.data)\n&gt;   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/nn/modules/module.py\", line 148, in &lt;lambda&gt;\n&gt;     return self._apply(lambda t: t.cuda(device_id))\n&gt;   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/_utils.py\", line 66, in _cuda\n&gt;     return new_type(self.size()).copy_(self, async)\n&gt;   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/cuda/__init__.py\", line 266, in _lazy_new\n&gt;     _lazy_init()\n&gt;   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/cuda/__init__.py\", line 85, in _lazy_init\n&gt;     torch._C._cuda_init()\n&gt; RuntimeError: cuda runtime error (3) : initialization error at /home/yuhang/dependencies/pytorch-master/torch/lib/THC/THCGeneral.c:74\n&gt; THCudaCheck FAIL file=/home/yuhang/dependencies/pytorch-master/torch/lib/THC/THCGeneral.c line=74 error=3 : initialization error\n&gt; Process Process-3:\n\n</code></pre>\n<p>Python version: 2.7.13</p>\n<p>Someone could help ?</p>", "body_text": "Hi,\nI met a strange error that after I initialize a Caffe network using:\nnet = caffe.Net(CaffeModel, weights, caffe.TEST)\nThen, whenever I try to create a CUDA model in a subprocess using Pytorch:\ndef traina(model):\n    model2 = PytorchNetworkStructure().cuda()\n\nprocesses = []\nfor model_idx in range(3):\n    p = mp.Process(target=train, args=(PytorchModel,))\n    p.start()\n    processes.append(p)\nfor p in processes:\n    p.join()\n\nThe program will report the error:\n> THCudaCheck FAIL file=/home/yuhang/dependencies/pytorch-master/torch/lib/THC/THCGeneral.c line=74 error=3 : initialization error\nProcess Process-1:\n> Traceback (most recent call last):\n>   File \"/home/yuhang/anaconda2/lib/python2.7/multiprocessing/process.py\", line 258, in _bootstrap\n>     self.run()\n>   File \"/home/yuhang/anaconda2/lib/python2.7/multiprocessing/process.py\", line 114, in run\n>     self._target(*self._args, **self._kwargs)\n>   File \"....py\", line 43, in traina\n>     model2 = PytorchNetworkStructure().cuda()\n>   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/nn/modules/module.py\", line 148, in cuda\n>     return self._apply(lambda t: t.cuda(device_id))\n>   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/nn/modules/module.py\", line 119, in _apply\n>     module._apply(fn)\n>   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/nn/modules/module.py\", line 125, in _apply\n>     param.data = fn(param.data)\n>   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/nn/modules/module.py\", line 148, in <lambda>\n>     return self._apply(lambda t: t.cuda(device_id))\n>   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/_utils.py\", line 66, in _cuda\n>     return new_type(self.size()).copy_(self, async)\n>   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/cuda/__init__.py\", line 266, in _lazy_new\n>     _lazy_init()\n>   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/cuda/__init__.py\", line 85, in _lazy_init\n>     torch._C._cuda_init()\n> RuntimeError: cuda runtime error (3) : initialization error at /home/yuhang/dependencies/pytorch-master/torch/lib/THC/THCGeneral.c:74\n> THCudaCheck FAIL file=/home/yuhang/dependencies/pytorch-master/torch/lib/THC/THCGeneral.c line=74 error=3 : initialization error\n> Process Process-3:\n\n\nPython version: 2.7.13\nSomeone could help ?", "body": "Hi,\r\nI met a strange error that after I initialize a Caffe network using: \r\n\r\n`net = caffe.Net(CaffeModel, weights, caffe.TEST)`\r\n\r\nThen, whenever I try to create a CUDA model in a subprocess using Pytorch: \r\n\r\n```\r\ndef traina(model):\r\n    model2 = PytorchNetworkStructure().cuda()\r\n\r\nprocesses = []\r\nfor model_idx in range(3):\r\n    p = mp.Process(target=train, args=(PytorchModel,))\r\n    p.start()\r\n    processes.append(p)\r\nfor p in processes:\r\n    p.join()\r\n```\r\n\r\nThe program will report the error:\r\n\r\n\r\n```\r\n> THCudaCheck FAIL file=/home/yuhang/dependencies/pytorch-master/torch/lib/THC/THCGeneral.c line=74 error=3 : initialization error\r\nProcess Process-1:\r\n> Traceback (most recent call last):\r\n>   File \"/home/yuhang/anaconda2/lib/python2.7/multiprocessing/process.py\", line 258, in _bootstrap\r\n>     self.run()\r\n>   File \"/home/yuhang/anaconda2/lib/python2.7/multiprocessing/process.py\", line 114, in run\r\n>     self._target(*self._args, **self._kwargs)\r\n>   File \"....py\", line 43, in traina\r\n>     model2 = PytorchNetworkStructure().cuda()\r\n>   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/nn/modules/module.py\", line 148, in cuda\r\n>     return self._apply(lambda t: t.cuda(device_id))\r\n>   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/nn/modules/module.py\", line 119, in _apply\r\n>     module._apply(fn)\r\n>   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/nn/modules/module.py\", line 125, in _apply\r\n>     param.data = fn(param.data)\r\n>   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/nn/modules/module.py\", line 148, in <lambda>\r\n>     return self._apply(lambda t: t.cuda(device_id))\r\n>   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/_utils.py\", line 66, in _cuda\r\n>     return new_type(self.size()).copy_(self, async)\r\n>   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/cuda/__init__.py\", line 266, in _lazy_new\r\n>     _lazy_init()\r\n>   File \"/home/yuhang/anaconda2/lib/python2.7/site-packages/torch/cuda/__init__.py\", line 85, in _lazy_init\r\n>     torch._C._cuda_init()\r\n> RuntimeError: cuda runtime error (3) : initialization error at /home/yuhang/dependencies/pytorch-master/torch/lib/THC/THCGeneral.c:74\r\n> THCudaCheck FAIL file=/home/yuhang/dependencies/pytorch-master/torch/lib/THC/THCGeneral.c line=74 error=3 : initialization error\r\n> Process Process-3:\r\n\r\n```\r\n\r\nPython version: 2.7.13\r\n\r\nSomeone could help ?\r\n"}