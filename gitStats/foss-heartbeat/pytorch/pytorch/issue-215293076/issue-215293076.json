{"url": "https://api.github.com/repos/pytorch/pytorch/issues/1039", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/1039/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/1039/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/1039/events", "html_url": "https://github.com/pytorch/pytorch/issues/1039", "id": 215293076, "node_id": "MDU6SXNzdWUyMTUyOTMwNzY=", "number": 1039, "title": "L-BFGS crashes when first step fails tolerance check", "user": {"login": "jcjohnson", "id": 2718714, "node_id": "MDQ6VXNlcjI3MTg3MTQ=", "avatar_url": "https://avatars2.githubusercontent.com/u/2718714?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jcjohnson", "html_url": "https://github.com/jcjohnson", "followers_url": "https://api.github.com/users/jcjohnson/followers", "following_url": "https://api.github.com/users/jcjohnson/following{/other_user}", "gists_url": "https://api.github.com/users/jcjohnson/gists{/gist_id}", "starred_url": "https://api.github.com/users/jcjohnson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jcjohnson/subscriptions", "organizations_url": "https://api.github.com/users/jcjohnson/orgs", "repos_url": "https://api.github.com/users/jcjohnson/repos", "events_url": "https://api.github.com/users/jcjohnson/events{/privacy}", "received_events_url": "https://api.github.com/users/jcjohnson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 424131847, "node_id": "MDU6TGFiZWw0MjQxMzE4NDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/bug", "name": "bug", "color": "b60205", "default": true}, {"id": 443484135, "node_id": "MDU6TGFiZWw0NDM0ODQxMzU=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/high%20priority", "name": "high priority", "color": "F22613", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2017-03-19T20:41:07Z", "updated_at": "2017-03-23T00:07:24Z", "closed_at": "2017-03-23T00:07:24Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Minimal test case:<br>\n<a href=\"https://gist.github.com/jcjohnson/7ee9124d45d09573b7e6282d5a8ba97a\">https://gist.github.com/jcjohnson/7ee9124d45d09573b7e6282d5a8ba97a</a></p>\n<p>Suppose that the first call to <code>step()</code> fails this tolerance check:</p>\n<p><a href=\"https://github.com/pytorch/pytorch/blob/master/torch/optim/lbfgs.py#L193\">https://github.com/pytorch/pytorch/blob/master/torch/optim/lbfgs.py#L193</a></p>\n<p>Then the next time <code>step()</code> is called, <code>state['n_iter']</code> will be 1 and <code>state['t']</code> will be <code>None</code>, so it will crash here:</p>\n<p><a href=\"https://github.com/pytorch/pytorch/blob/master/torch/optim/lbfgs.py#L138\">https://github.com/pytorch/pytorch/blob/master/torch/optim/lbfgs.py#L138</a></p>\n<p>I'm not 100% sure that this is the right thing to do, but I think that swapping these two blocks fixes the problem:</p>\n<p><a href=\"https://github.com/pytorch/pytorch/blob/master/torch/optim/lbfgs.py#L192\">https://github.com/pytorch/pytorch/blob/master/torch/optim/lbfgs.py#L192</a><br>\n<a href=\"https://github.com/pytorch/pytorch/blob/master/torch/optim/lbfgs.py#L196\">https://github.com/pytorch/pytorch/blob/master/torch/optim/lbfgs.py#L196</a></p>", "body_text": "Minimal test case:\nhttps://gist.github.com/jcjohnson/7ee9124d45d09573b7e6282d5a8ba97a\nSuppose that the first call to step() fails this tolerance check:\nhttps://github.com/pytorch/pytorch/blob/master/torch/optim/lbfgs.py#L193\nThen the next time step() is called, state['n_iter'] will be 1 and state['t'] will be None, so it will crash here:\nhttps://github.com/pytorch/pytorch/blob/master/torch/optim/lbfgs.py#L138\nI'm not 100% sure that this is the right thing to do, but I think that swapping these two blocks fixes the problem:\nhttps://github.com/pytorch/pytorch/blob/master/torch/optim/lbfgs.py#L192\nhttps://github.com/pytorch/pytorch/blob/master/torch/optim/lbfgs.py#L196", "body": "Minimal test case:\r\nhttps://gist.github.com/jcjohnson/7ee9124d45d09573b7e6282d5a8ba97a\r\n\r\nSuppose that the first call to `step()` fails this tolerance check:\r\n\r\nhttps://github.com/pytorch/pytorch/blob/master/torch/optim/lbfgs.py#L193\r\n\r\nThen the next time `step()` is called, `state['n_iter']` will be 1 and `state['t']` will be `None`, so it will crash here:\r\n\r\nhttps://github.com/pytorch/pytorch/blob/master/torch/optim/lbfgs.py#L138\r\n\r\nI'm not 100% sure that this is the right thing to do, but I think that swapping these two blocks fixes the problem:\r\n\r\nhttps://github.com/pytorch/pytorch/blob/master/torch/optim/lbfgs.py#L192\r\nhttps://github.com/pytorch/pytorch/blob/master/torch/optim/lbfgs.py#L196"}