{"url": "https://api.github.com/repos/pytorch/pytorch/issues/6750", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/6750/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/6750/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/6750/events", "html_url": "https://github.com/pytorch/pytorch/issues/6750", "id": 315760267, "node_id": "MDU6SXNzdWUzMTU3NjAyNjc=", "number": 6750, "title": "[checkpointing] Checkpointed model use more GPU memory than original model", "user": {"login": "ssidorenko", "id": 1010462, "node_id": "MDQ6VXNlcjEwMTA0NjI=", "avatar_url": "https://avatars2.githubusercontent.com/u/1010462?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ssidorenko", "html_url": "https://github.com/ssidorenko", "followers_url": "https://api.github.com/users/ssidorenko/followers", "following_url": "https://api.github.com/users/ssidorenko/following{/other_user}", "gists_url": "https://api.github.com/users/ssidorenko/gists{/gist_id}", "starred_url": "https://api.github.com/users/ssidorenko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ssidorenko/subscriptions", "organizations_url": "https://api.github.com/users/ssidorenko/orgs", "repos_url": "https://api.github.com/users/ssidorenko/repos", "events_url": "https://api.github.com/users/ssidorenko/events{/privacy}", "received_events_url": "https://api.github.com/users/ssidorenko/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 914008058, "node_id": "MDU6TGFiZWw5MTQwMDgwNTg=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/checkpoint", "name": "checkpoint", "color": "f7ec1d", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-04-19T07:36:32Z", "updated_at": "2018-04-26T16:25:44Z", "closed_at": null, "author_association": "CONTRIBUTOR", "body_html": "<p>While working with a model of mine, I've hit <code> cuda runtime error (2) : out of memory</code> when using checkpointing with a model. Using the same model without checkpointing did not trigger the error.</p>\n<p>I might have misunderstood something, but I expected that using checkpointing would use less GPU memory, not more?</p>\n<p>See in the attached notebook: running cell 1 then 2 do not trigger the error. Restarting the kernel, then running cell 1 then 3 trigger the error (happened with a 1080 GTX Ti, the input size might have to be adjusted to trigger the error depending on the GPU)</p>\n<p><a href=\"https://github.com/pytorch/pytorch/files/1927061/checkpoint.memory.usage.debug.ipynb.zip\">checkpoint memory usage debug.ipynb.zip</a></p>\n<p>OS: Ubuntu 18.04 x86_64<br>\nPyTorch version: <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/pytorch/pytorch/commit/2a628ba32f3e71f1fc6b31383e46e9b09db9abd6/hovercard\" href=\"https://github.com/pytorch/pytorch/commit/2a628ba32f3e71f1fc6b31383e46e9b09db9abd6\"><tt>2a628ba</tt></a> from source<br>\nCUDA: 9.1.85-3 from Ubuntu repository<br>\nPython: 3.6.4 :: Anaconda, Inc.<br>\nGPU: 1080 GTX Ti<br>\nGCC: version 5.5.0 20171010 (Ubuntu 5.5.0-11ubuntu1)<br>\nCMake: version 3.9.4<br>\nBuild command: python setup.py build &amp;&amp; python setup.py install</p>", "body_text": "While working with a model of mine, I've hit  cuda runtime error (2) : out of memory when using checkpointing with a model. Using the same model without checkpointing did not trigger the error.\nI might have misunderstood something, but I expected that using checkpointing would use less GPU memory, not more?\nSee in the attached notebook: running cell 1 then 2 do not trigger the error. Restarting the kernel, then running cell 1 then 3 trigger the error (happened with a 1080 GTX Ti, the input size might have to be adjusted to trigger the error depending on the GPU)\ncheckpoint memory usage debug.ipynb.zip\nOS: Ubuntu 18.04 x86_64\nPyTorch version: 2a628ba from source\nCUDA: 9.1.85-3 from Ubuntu repository\nPython: 3.6.4 :: Anaconda, Inc.\nGPU: 1080 GTX Ti\nGCC: version 5.5.0 20171010 (Ubuntu 5.5.0-11ubuntu1)\nCMake: version 3.9.4\nBuild command: python setup.py build && python setup.py install", "body": "While working with a model of mine, I've hit ` cuda runtime error (2) : out of memory` when using checkpointing with a model. Using the same model without checkpointing did not trigger the error.\r\n\r\nI might have misunderstood something, but I expected that using checkpointing would use less GPU memory, not more?\r\n\r\nSee in the attached notebook: running cell 1 then 2 do not trigger the error. Restarting the kernel, then running cell 1 then 3 trigger the error (happened with a 1080 GTX Ti, the input size might have to be adjusted to trigger the error depending on the GPU)\r\n\r\n[checkpoint memory usage debug.ipynb.zip](https://github.com/pytorch/pytorch/files/1927061/checkpoint.memory.usage.debug.ipynb.zip)\r\n\r\n\r\n\r\nOS: Ubuntu 18.04 x86_64\r\nPyTorch version: 2a628ba3 from source\r\nCUDA: 9.1.85-3 from Ubuntu repository\r\nPython: 3.6.4 :: Anaconda, Inc.\r\nGPU: 1080 GTX Ti\r\nGCC: version 5.5.0 20171010 (Ubuntu 5.5.0-11ubuntu1) \r\nCMake: version 3.9.4\r\nBuild command: python setup.py build && python setup.py install\r\n\r\n"}