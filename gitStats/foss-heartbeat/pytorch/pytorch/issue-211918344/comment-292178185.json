{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/292178185", "html_url": "https://github.com/pytorch/pytorch/issues/922#issuecomment-292178185", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/922", "id": 292178185, "node_id": "MDEyOklzc3VlQ29tbWVudDI5MjE3ODE4NQ==", "user": {"login": "gut", "id": 40444, "node_id": "MDQ6VXNlcjQwNDQ0", "avatar_url": "https://avatars3.githubusercontent.com/u/40444?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gut", "html_url": "https://github.com/gut", "followers_url": "https://api.github.com/users/gut/followers", "following_url": "https://api.github.com/users/gut/following{/other_user}", "gists_url": "https://api.github.com/users/gut/gists{/gist_id}", "starred_url": "https://api.github.com/users/gut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gut/subscriptions", "organizations_url": "https://api.github.com/users/gut/orgs", "repos_url": "https://api.github.com/users/gut/repos", "events_url": "https://api.github.com/users/gut/events{/privacy}", "received_events_url": "https://api.github.com/users/gut/received_events", "type": "User", "site_admin": false}, "created_at": "2017-04-06T13:42:21Z", "updated_at": "2017-04-06T13:42:21Z", "author_association": "NONE", "body_html": "<p>By applying <a href=\"https://gist.github.com/gut/0bac048d1539b26d326c7eb231e92df9\">this diff</a>, the VSX test looks ok on my machine:</p>\n<pre><code>standardDouble_fill() test took 3.52016 seconds\nTHDoubleVector_fill_VSX() test took 0.61788 seconds\nAll assertions PASSED for THDoubleVector_fill_VSX() test.\n\nstandardFloat_fill() test took 3.28862 seconds\nTHFloatVector_fill_VSX() test took 0.20691 seconds\nAll assertions PASSED for THFloatVector_fill_VSX() test.\n\nstandardDouble_adds() test took 3.23111 seconds\nTHDoubleVector_adds_VSX() test took 1.26806 seconds\nAll assertions PASSED for THDoubleVector_adds_VSX() test.\n\nstandardFloat_adds() test took 3.09554 seconds\nTHFloatVector_adds_VSX() test took 0.61319 seconds\nAll assertions PASSED for THFloatVector_adds_VSX() test.\n\nstandardDouble_diff() test took 3.48718 seconds\nTHDoubleVector_diff_VSX() test took 1.20493 seconds\nAll assertions PASSED for THDoubleVector_diff_VSX() test.\n\nstandardFloat_diff() test took 3.23055 seconds\nTHFloatVector_diff_VSX() test took 0.56289 seconds\nAll assertions PASSED for THFloatVector_diff_VSX() test.\n\nstandardDouble_scale() test took 3.15807 seconds\nTHDoubleVector_scale_VSX() test took 0.83008 seconds\nAll assertions PASSED for THDoubleVector_scale_VSX() test.\n\nstandardFloat_scale() test took 3.13747 seconds\nTHFloatVector_scale_VSX() test took 0.42771 seconds\nAll assertions PASSED for THFloatVector_scale_VSX() test.\n\nstandardDouble_muls() test took 3.22186 seconds\nTHDoubleVector_muls_VSX() test took 0.86646 seconds\nAll assertions PASSED for THDoubleVector_muls_VSX() test.\n\nstandardFloat_muls() test took 3.15087 seconds\nTHFloatVector_muls_VSX() test took 0.41949 seconds\nAll assertions PASSED for THFloatVector_muls_VSX() test.\n\nFinished runnning all tests. All tests PASSED.\n</code></pre>\n<p>However the test suite still doesn't work:</p>\n<pre><code>python test/test_torch.py\n...F..F..terminate called after throwing an instance of 'THException'\n  what():  given function should return a number at /home/gut/pytorch/torch/csrc/generic/TensorMethods.cpp:3888\nAborted\n</code></pre>\n<p>When debugging, I see that:</p>\n<pre><code>#8  0x00003fff8fdac2ac in _THError (file=0x3fff9067ee00 \"/home/gut/pytorch/torch/csrc/generic/TensorMethods.cpp\", line=3888,\n    fmt=0x3fff9067f520 \"given function should return a number\") at /home/gut/pytorch/torch/lib/TH/THGeneral.c:54\n54          (*defaultErrorHandler)(msg, defaultErrorHandlerData);\n(gdb) up\n#9  0x00003fff902c23c4 in THPDoubleTensor_apply (self=0x3fff8f23a7e8, arg=0x3fff8f1f08c0) at /home/gut/pytorch/torch/csrc/generic/TensorMethods.cpp:3877\n3877      TH_TENSOR_APPLY(real, tensor,\n(gdb ppc) l\n3872        THPUtils_setError(\"apply requires a callable as it's first argument\");\n3873        return NULL;\n3874      }\n3875\n3876      THTensor *tensor = self-&gt;cdata;\n3877      TH_TENSOR_APPLY(real, tensor,\n3878                      PyObject *ret =\n3879                          PyObject_CallFunction(arg, (char*)BUILD_REAL_FMT, *tensor_data);\n3880                      if (!ret)\n3881                        return NULL;\n(gdb)\n3882                      if (!THPUtils_(checkReal)(ret)) {\n3883                        Py_DECREF(ret);\n3884                        THError(\"given function should return a number\");\n3885                      }\n3886                      *tensor_data = THPUtils_(unpackReal)(ret);\n3887                      Py_DECREF(ret);\n3888                      );\n3889\n3890      Py_INCREF(self);\n3891      return (PyObject*)self;\n</code></pre>\n<p>Any hints? I'm analysing this but I'm quite new on torch.</p>", "body_text": "By applying this diff, the VSX test looks ok on my machine:\nstandardDouble_fill() test took 3.52016 seconds\nTHDoubleVector_fill_VSX() test took 0.61788 seconds\nAll assertions PASSED for THDoubleVector_fill_VSX() test.\n\nstandardFloat_fill() test took 3.28862 seconds\nTHFloatVector_fill_VSX() test took 0.20691 seconds\nAll assertions PASSED for THFloatVector_fill_VSX() test.\n\nstandardDouble_adds() test took 3.23111 seconds\nTHDoubleVector_adds_VSX() test took 1.26806 seconds\nAll assertions PASSED for THDoubleVector_adds_VSX() test.\n\nstandardFloat_adds() test took 3.09554 seconds\nTHFloatVector_adds_VSX() test took 0.61319 seconds\nAll assertions PASSED for THFloatVector_adds_VSX() test.\n\nstandardDouble_diff() test took 3.48718 seconds\nTHDoubleVector_diff_VSX() test took 1.20493 seconds\nAll assertions PASSED for THDoubleVector_diff_VSX() test.\n\nstandardFloat_diff() test took 3.23055 seconds\nTHFloatVector_diff_VSX() test took 0.56289 seconds\nAll assertions PASSED for THFloatVector_diff_VSX() test.\n\nstandardDouble_scale() test took 3.15807 seconds\nTHDoubleVector_scale_VSX() test took 0.83008 seconds\nAll assertions PASSED for THDoubleVector_scale_VSX() test.\n\nstandardFloat_scale() test took 3.13747 seconds\nTHFloatVector_scale_VSX() test took 0.42771 seconds\nAll assertions PASSED for THFloatVector_scale_VSX() test.\n\nstandardDouble_muls() test took 3.22186 seconds\nTHDoubleVector_muls_VSX() test took 0.86646 seconds\nAll assertions PASSED for THDoubleVector_muls_VSX() test.\n\nstandardFloat_muls() test took 3.15087 seconds\nTHFloatVector_muls_VSX() test took 0.41949 seconds\nAll assertions PASSED for THFloatVector_muls_VSX() test.\n\nFinished runnning all tests. All tests PASSED.\n\nHowever the test suite still doesn't work:\npython test/test_torch.py\n...F..F..terminate called after throwing an instance of 'THException'\n  what():  given function should return a number at /home/gut/pytorch/torch/csrc/generic/TensorMethods.cpp:3888\nAborted\n\nWhen debugging, I see that:\n#8  0x00003fff8fdac2ac in _THError (file=0x3fff9067ee00 \"/home/gut/pytorch/torch/csrc/generic/TensorMethods.cpp\", line=3888,\n    fmt=0x3fff9067f520 \"given function should return a number\") at /home/gut/pytorch/torch/lib/TH/THGeneral.c:54\n54          (*defaultErrorHandler)(msg, defaultErrorHandlerData);\n(gdb) up\n#9  0x00003fff902c23c4 in THPDoubleTensor_apply (self=0x3fff8f23a7e8, arg=0x3fff8f1f08c0) at /home/gut/pytorch/torch/csrc/generic/TensorMethods.cpp:3877\n3877      TH_TENSOR_APPLY(real, tensor,\n(gdb ppc) l\n3872        THPUtils_setError(\"apply requires a callable as it's first argument\");\n3873        return NULL;\n3874      }\n3875\n3876      THTensor *tensor = self->cdata;\n3877      TH_TENSOR_APPLY(real, tensor,\n3878                      PyObject *ret =\n3879                          PyObject_CallFunction(arg, (char*)BUILD_REAL_FMT, *tensor_data);\n3880                      if (!ret)\n3881                        return NULL;\n(gdb)\n3882                      if (!THPUtils_(checkReal)(ret)) {\n3883                        Py_DECREF(ret);\n3884                        THError(\"given function should return a number\");\n3885                      }\n3886                      *tensor_data = THPUtils_(unpackReal)(ret);\n3887                      Py_DECREF(ret);\n3888                      );\n3889\n3890      Py_INCREF(self);\n3891      return (PyObject*)self;\n\nAny hints? I'm analysing this but I'm quite new on torch.", "body": "By applying [this diff](https://gist.github.com/gut/0bac048d1539b26d326c7eb231e92df9), the VSX test looks ok on my machine:\r\n```\r\nstandardDouble_fill() test took 3.52016 seconds\r\nTHDoubleVector_fill_VSX() test took 0.61788 seconds\r\nAll assertions PASSED for THDoubleVector_fill_VSX() test.\r\n\r\nstandardFloat_fill() test took 3.28862 seconds\r\nTHFloatVector_fill_VSX() test took 0.20691 seconds\r\nAll assertions PASSED for THFloatVector_fill_VSX() test.\r\n\r\nstandardDouble_adds() test took 3.23111 seconds\r\nTHDoubleVector_adds_VSX() test took 1.26806 seconds\r\nAll assertions PASSED for THDoubleVector_adds_VSX() test.\r\n\r\nstandardFloat_adds() test took 3.09554 seconds\r\nTHFloatVector_adds_VSX() test took 0.61319 seconds\r\nAll assertions PASSED for THFloatVector_adds_VSX() test.\r\n\r\nstandardDouble_diff() test took 3.48718 seconds\r\nTHDoubleVector_diff_VSX() test took 1.20493 seconds\r\nAll assertions PASSED for THDoubleVector_diff_VSX() test.\r\n\r\nstandardFloat_diff() test took 3.23055 seconds\r\nTHFloatVector_diff_VSX() test took 0.56289 seconds\r\nAll assertions PASSED for THFloatVector_diff_VSX() test.\r\n\r\nstandardDouble_scale() test took 3.15807 seconds\r\nTHDoubleVector_scale_VSX() test took 0.83008 seconds\r\nAll assertions PASSED for THDoubleVector_scale_VSX() test.\r\n\r\nstandardFloat_scale() test took 3.13747 seconds\r\nTHFloatVector_scale_VSX() test took 0.42771 seconds\r\nAll assertions PASSED for THFloatVector_scale_VSX() test.\r\n\r\nstandardDouble_muls() test took 3.22186 seconds\r\nTHDoubleVector_muls_VSX() test took 0.86646 seconds\r\nAll assertions PASSED for THDoubleVector_muls_VSX() test.\r\n\r\nstandardFloat_muls() test took 3.15087 seconds\r\nTHFloatVector_muls_VSX() test took 0.41949 seconds\r\nAll assertions PASSED for THFloatVector_muls_VSX() test.\r\n\r\nFinished runnning all tests. All tests PASSED.\r\n```\r\n\r\nHowever the test suite still doesn't work:\r\n```\r\npython test/test_torch.py\r\n...F..F..terminate called after throwing an instance of 'THException'\r\n  what():  given function should return a number at /home/gut/pytorch/torch/csrc/generic/TensorMethods.cpp:3888\r\nAborted\r\n```\r\n\r\nWhen debugging, I see that:\r\n```\r\n#8  0x00003fff8fdac2ac in _THError (file=0x3fff9067ee00 \"/home/gut/pytorch/torch/csrc/generic/TensorMethods.cpp\", line=3888,\r\n    fmt=0x3fff9067f520 \"given function should return a number\") at /home/gut/pytorch/torch/lib/TH/THGeneral.c:54\r\n54          (*defaultErrorHandler)(msg, defaultErrorHandlerData);\r\n(gdb) up\r\n#9  0x00003fff902c23c4 in THPDoubleTensor_apply (self=0x3fff8f23a7e8, arg=0x3fff8f1f08c0) at /home/gut/pytorch/torch/csrc/generic/TensorMethods.cpp:3877\r\n3877      TH_TENSOR_APPLY(real, tensor,\r\n(gdb ppc) l\r\n3872        THPUtils_setError(\"apply requires a callable as it's first argument\");\r\n3873        return NULL;\r\n3874      }\r\n3875\r\n3876      THTensor *tensor = self->cdata;\r\n3877      TH_TENSOR_APPLY(real, tensor,\r\n3878                      PyObject *ret =\r\n3879                          PyObject_CallFunction(arg, (char*)BUILD_REAL_FMT, *tensor_data);\r\n3880                      if (!ret)\r\n3881                        return NULL;\r\n(gdb)\r\n3882                      if (!THPUtils_(checkReal)(ret)) {\r\n3883                        Py_DECREF(ret);\r\n3884                        THError(\"given function should return a number\");\r\n3885                      }\r\n3886                      *tensor_data = THPUtils_(unpackReal)(ret);\r\n3887                      Py_DECREF(ret);\r\n3888                      );\r\n3889\r\n3890      Py_INCREF(self);\r\n3891      return (PyObject*)self;\r\n```\r\n\r\nAny hints? I'm analysing this but I'm quite new on torch."}