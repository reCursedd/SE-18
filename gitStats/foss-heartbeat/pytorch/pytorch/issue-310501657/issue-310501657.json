{"url": "https://api.github.com/repos/pytorch/pytorch/issues/6188", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/6188/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/6188/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/6188/events", "html_url": "https://github.com/pytorch/pytorch/pull/6188", "id": 310501657, "node_id": "MDExOlB1bGxSZXF1ZXN0MTc4ODUxNTg5", "number": 6188, "title": "Modularize ATen cmake.", "user": {"login": "ezyang", "id": 13564, "node_id": "MDQ6VXNlcjEzNTY0", "avatar_url": "https://avatars0.githubusercontent.com/u/13564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ezyang", "html_url": "https://github.com/ezyang", "followers_url": "https://api.github.com/users/ezyang/followers", "following_url": "https://api.github.com/users/ezyang/following{/other_user}", "gists_url": "https://api.github.com/users/ezyang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ezyang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ezyang/subscriptions", "organizations_url": "https://api.github.com/users/ezyang/orgs", "repos_url": "https://api.github.com/users/ezyang/repos", "events_url": "https://api.github.com/users/ezyang/events{/privacy}", "received_events_url": "https://api.github.com/users/ezyang/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2018-04-02T14:35:50Z", "updated_at": "2018-11-23T15:41:45Z", "closed_at": "2018-04-24T17:31:11Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/6188", "html_url": "https://github.com/pytorch/pytorch/pull/6188", "diff_url": "https://github.com/pytorch/pytorch/pull/6188.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/6188.patch"}, "body_html": "<pre><code>commit 3ed781ebdca37cc3e2cf21389e0974827775ebb6\nAuthor: Edward Z. Yang &lt;ezyang@fb.com&gt;\nDate:   Mon Apr 2 07:32:13 2018 -0700\n\n    Towards modularizing ATen cmake.\n    \n    Right now, ATen is a big, monolithic cmake build system, which means that if\n    there are small pieces we want to reuse in other places, it is difficult to use\n    them (you essentially have to write a CMakeLists.txt for the relevant component\n    from scratch.)\n    \n    This commit takes a step towards modularizing the cmake.  Specifically, it\n    takes the following steps:\n    \n    - It extracts the common compile flag / feature testing preamble in\n      aten/CMakeLists.txt and aten/src/ATen/CMakeLists.txt into a common\n      header aten/cmake/Common.cmake.  This makes it easier to reuse this\n      header in case we want other entry points to the build system.\n    \n    - It extracts dependency finding and loading into aten/cmake/LoadFoo.cmake\n      files.  This is not the desired end-state (the modern Caffe2 style is\n      to make a new-style cmake target for each of our deps which we can\n      depend on directly) but it's a good start.\n    \n    - It splits out avx_mathfun.h and Intrinsics.h into a new package in src\n      avx_mathfun, because these headers are depended upon by both TH and\n      ATen directly.  I think this might be a temporary state of affairs\n      because we will move things out of TH eventually.\n    \n    - It turns TH into a static library, which will be linked into ATen.  This\n      library declares its headers as public interfaces, so they are automatically\n      picked up by libraries which depend on it, e.g., ATen proper (and more\n      specifically the THC source.)\n    \n    Testing strategy:\n    \n        cd aten/src/TH\n        mkdir build\n        cd build\n        cmake ..\n        make -j20\n    \n    TH can be built by itself now.\n    \n    Signed-off-by: Edward Z. Yang &lt;ezyang@fb.com&gt;\n\ncommit 4fc4c7d0cf899291bf3d72ad5fb5d14330ef147a\nAuthor: Edward Z. Yang &lt;ezyang@fb.com&gt;\nDate:   Tue Apr 3 08:20:38 2018 -0700\n\n    FindCUDA: Make nvcc configurable via CUDA_NVCC_EXECUTABLE env var\n    \n    Applies upstream cmake FindCUDA patch:\n    \n        commit 23119366e9d4e56e13c1fdec9dbff5e8f8c55ee5\n        Author: Edward Z. Yang &lt;ezyang@fb.com&gt;\n        Date:   Wed Mar 28 11:33:56 2018 -0400\n    \n            FindCUDA: Make nvcc configurable via CUDA_NVCC_EXECUTABLE env var\n    \n            This is useful if, for example, you want ccache to be used\n            for nvcc.  With the current behavior, cmake always picks up\n            /usr/local/cuda/bin/nvcc, even if there is a ccache nvcc\n            stub in the PATH.  Allowing for CUDA_NVCC_EXECUTABLE lets\n            us work around the problem.\n    \n            Signed-off-by: Edward Z. Yang &lt;ezyang@fb.com&gt;\n    \n    Signed-off-by: Edward Z. Yang &lt;ezyang@fb.com&gt;\n\ncommit 7e60e3b0e46e5437490dd99f74b77c0fe6f81840\nAuthor: Edward Z. Yang &lt;ezyang@fb.com&gt;\nDate:   Tue Apr 3 08:16:00 2018 -0700\n\n    Remove ATen's copy of FindCUDA\n    \n    Signed-off-by: Edward Z. Yang &lt;ezyang@fb.com&gt;\n</code></pre>", "body_text": "commit 3ed781ebdca37cc3e2cf21389e0974827775ebb6\nAuthor: Edward Z. Yang <ezyang@fb.com>\nDate:   Mon Apr 2 07:32:13 2018 -0700\n\n    Towards modularizing ATen cmake.\n    \n    Right now, ATen is a big, monolithic cmake build system, which means that if\n    there are small pieces we want to reuse in other places, it is difficult to use\n    them (you essentially have to write a CMakeLists.txt for the relevant component\n    from scratch.)\n    \n    This commit takes a step towards modularizing the cmake.  Specifically, it\n    takes the following steps:\n    \n    - It extracts the common compile flag / feature testing preamble in\n      aten/CMakeLists.txt and aten/src/ATen/CMakeLists.txt into a common\n      header aten/cmake/Common.cmake.  This makes it easier to reuse this\n      header in case we want other entry points to the build system.\n    \n    - It extracts dependency finding and loading into aten/cmake/LoadFoo.cmake\n      files.  This is not the desired end-state (the modern Caffe2 style is\n      to make a new-style cmake target for each of our deps which we can\n      depend on directly) but it's a good start.\n    \n    - It splits out avx_mathfun.h and Intrinsics.h into a new package in src\n      avx_mathfun, because these headers are depended upon by both TH and\n      ATen directly.  I think this might be a temporary state of affairs\n      because we will move things out of TH eventually.\n    \n    - It turns TH into a static library, which will be linked into ATen.  This\n      library declares its headers as public interfaces, so they are automatically\n      picked up by libraries which depend on it, e.g., ATen proper (and more\n      specifically the THC source.)\n    \n    Testing strategy:\n    \n        cd aten/src/TH\n        mkdir build\n        cd build\n        cmake ..\n        make -j20\n    \n    TH can be built by itself now.\n    \n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\n\ncommit 4fc4c7d0cf899291bf3d72ad5fb5d14330ef147a\nAuthor: Edward Z. Yang <ezyang@fb.com>\nDate:   Tue Apr 3 08:20:38 2018 -0700\n\n    FindCUDA: Make nvcc configurable via CUDA_NVCC_EXECUTABLE env var\n    \n    Applies upstream cmake FindCUDA patch:\n    \n        commit 23119366e9d4e56e13c1fdec9dbff5e8f8c55ee5\n        Author: Edward Z. Yang <ezyang@fb.com>\n        Date:   Wed Mar 28 11:33:56 2018 -0400\n    \n            FindCUDA: Make nvcc configurable via CUDA_NVCC_EXECUTABLE env var\n    \n            This is useful if, for example, you want ccache to be used\n            for nvcc.  With the current behavior, cmake always picks up\n            /usr/local/cuda/bin/nvcc, even if there is a ccache nvcc\n            stub in the PATH.  Allowing for CUDA_NVCC_EXECUTABLE lets\n            us work around the problem.\n    \n            Signed-off-by: Edward Z. Yang <ezyang@fb.com>\n    \n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\n\ncommit 7e60e3b0e46e5437490dd99f74b77c0fe6f81840\nAuthor: Edward Z. Yang <ezyang@fb.com>\nDate:   Tue Apr 3 08:16:00 2018 -0700\n\n    Remove ATen's copy of FindCUDA\n    \n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>", "body": "```\r\ncommit 3ed781ebdca37cc3e2cf21389e0974827775ebb6\r\nAuthor: Edward Z. Yang <ezyang@fb.com>\r\nDate:   Mon Apr 2 07:32:13 2018 -0700\r\n\r\n    Towards modularizing ATen cmake.\r\n    \r\n    Right now, ATen is a big, monolithic cmake build system, which means that if\r\n    there are small pieces we want to reuse in other places, it is difficult to use\r\n    them (you essentially have to write a CMakeLists.txt for the relevant component\r\n    from scratch.)\r\n    \r\n    This commit takes a step towards modularizing the cmake.  Specifically, it\r\n    takes the following steps:\r\n    \r\n    - It extracts the common compile flag / feature testing preamble in\r\n      aten/CMakeLists.txt and aten/src/ATen/CMakeLists.txt into a common\r\n      header aten/cmake/Common.cmake.  This makes it easier to reuse this\r\n      header in case we want other entry points to the build system.\r\n    \r\n    - It extracts dependency finding and loading into aten/cmake/LoadFoo.cmake\r\n      files.  This is not the desired end-state (the modern Caffe2 style is\r\n      to make a new-style cmake target for each of our deps which we can\r\n      depend on directly) but it's a good start.\r\n    \r\n    - It splits out avx_mathfun.h and Intrinsics.h into a new package in src\r\n      avx_mathfun, because these headers are depended upon by both TH and\r\n      ATen directly.  I think this might be a temporary state of affairs\r\n      because we will move things out of TH eventually.\r\n    \r\n    - It turns TH into a static library, which will be linked into ATen.  This\r\n      library declares its headers as public interfaces, so they are automatically\r\n      picked up by libraries which depend on it, e.g., ATen proper (and more\r\n      specifically the THC source.)\r\n    \r\n    Testing strategy:\r\n    \r\n        cd aten/src/TH\r\n        mkdir build\r\n        cd build\r\n        cmake ..\r\n        make -j20\r\n    \r\n    TH can be built by itself now.\r\n    \r\n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\r\n\r\ncommit 4fc4c7d0cf899291bf3d72ad5fb5d14330ef147a\r\nAuthor: Edward Z. Yang <ezyang@fb.com>\r\nDate:   Tue Apr 3 08:20:38 2018 -0700\r\n\r\n    FindCUDA: Make nvcc configurable via CUDA_NVCC_EXECUTABLE env var\r\n    \r\n    Applies upstream cmake FindCUDA patch:\r\n    \r\n        commit 23119366e9d4e56e13c1fdec9dbff5e8f8c55ee5\r\n        Author: Edward Z. Yang <ezyang@fb.com>\r\n        Date:   Wed Mar 28 11:33:56 2018 -0400\r\n    \r\n            FindCUDA: Make nvcc configurable via CUDA_NVCC_EXECUTABLE env var\r\n    \r\n            This is useful if, for example, you want ccache to be used\r\n            for nvcc.  With the current behavior, cmake always picks up\r\n            /usr/local/cuda/bin/nvcc, even if there is a ccache nvcc\r\n            stub in the PATH.  Allowing for CUDA_NVCC_EXECUTABLE lets\r\n            us work around the problem.\r\n    \r\n            Signed-off-by: Edward Z. Yang <ezyang@fb.com>\r\n    \r\n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\r\n\r\ncommit 7e60e3b0e46e5437490dd99f74b77c0fe6f81840\r\nAuthor: Edward Z. Yang <ezyang@fb.com>\r\nDate:   Tue Apr 3 08:16:00 2018 -0700\r\n\r\n    Remove ATen's copy of FindCUDA\r\n    \r\n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\r\n```"}