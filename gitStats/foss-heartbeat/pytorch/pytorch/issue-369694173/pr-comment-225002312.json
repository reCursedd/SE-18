{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/225002312", "pull_request_review_id": 164508207, "id": 225002312, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNTAwMjMxMg==", "diff_hunk": "@@ -274,16 +270,27 @@ def declkey(decl):\n                 ])\n                 decl['has_tensor_options'] = True\n \n-    jit_decls = sort_decls(jit_decls)\n-    for decl in jit_decls:\n-        ops.append(OPERATOR.substitute(signature=signature(decl),\n-                                       op=emit_decl_variant(decl)))\n-\n-    # Sort the generated snippets to ensure that the generation is deterministic\n-    env = {\n-        'constructors': ops,\n-    }\n-    write(out, 'register_aten_ops.cpp', REGISTER_ATEN_OPS_CPP, env)\n+    # Group and sort the generated snippets to ensure that the\n+    # generation is deterministic\n+    jit_decl_groups = sort_decls(jit_decls)\n+\n+    # NOTE: see the comment at the top of the register_aten_ops.cpp\n+    # template regarding sharding of the generated files.\n+    num_shards = 3\n+    shards = [[] for _ in range(num_shards)]\n+\n+    # ops are assigned arbitrarily but stably to a file based on hash\n+    for group in jit_decl_groups:\n+        x = sum(ord(c) for c in group[0]['name']) % num_shards", "path": "tools/jit/gen_jit_dispatch.py", "position": 42, "original_position": 38, "commit_id": "05b09de249370f8785d4623dfc27d5d16158467d", "original_commit_id": "db57af7bb99f7c96e39500e5857aab04310623ba", "user": {"login": "anderspapitto", "id": 1388690, "node_id": "MDQ6VXNlcjEzODg2OTA=", "avatar_url": "https://avatars3.githubusercontent.com/u/1388690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anderspapitto", "html_url": "https://github.com/anderspapitto", "followers_url": "https://api.github.com/users/anderspapitto/followers", "following_url": "https://api.github.com/users/anderspapitto/following{/other_user}", "gists_url": "https://api.github.com/users/anderspapitto/gists{/gist_id}", "starred_url": "https://api.github.com/users/anderspapitto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anderspapitto/subscriptions", "organizations_url": "https://api.github.com/users/anderspapitto/orgs", "repos_url": "https://api.github.com/users/anderspapitto/repos", "events_url": "https://api.github.com/users/anderspapitto/events{/privacy}", "received_events_url": "https://api.github.com/users/anderspapitto/received_events", "type": "User", "site_admin": false}, "body": "well this already is a copy-paste of the other site :)\r\n\r\nI could switch to just calling hash(). It looks like it's deterministic across interpreter startups (I wasn't sure about this, but I've just tested it). It may vary between python versions, or maybe even between machines or environments? Not sure about this, or if it matters even if true", "created_at": "2018-10-14T17:58:58Z", "updated_at": "2018-11-23T15:52:59Z", "html_url": "https://github.com/pytorch/pytorch/pull/12615#discussion_r225002312", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/12615", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/225002312"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/12615#discussion_r225002312"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/12615"}}, "body_html": "<p>well this already is a copy-paste of the other site :)</p>\n<p>I could switch to just calling hash(). It looks like it's deterministic across interpreter startups (I wasn't sure about this, but I've just tested it). It may vary between python versions, or maybe even between machines or environments? Not sure about this, or if it matters even if true</p>", "body_text": "well this already is a copy-paste of the other site :)\nI could switch to just calling hash(). It looks like it's deterministic across interpreter startups (I wasn't sure about this, but I've just tested it). It may vary between python versions, or maybe even between machines or environments? Not sure about this, or if it matters even if true", "in_reply_to_id": 224973807}