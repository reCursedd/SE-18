{"url": "https://api.github.com/repos/pytorch/pytorch/issues/6376", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/6376/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/6376/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/6376/events", "html_url": "https://github.com/pytorch/pytorch/issues/6376", "id": 312165062, "node_id": "MDU6SXNzdWUzMTIxNjUwNjI=", "number": 6376, "title": "[PyTorch] gloo and NCCL finds different CUDA", "user": {"login": "SsnL", "id": 5674597, "node_id": "MDQ6VXNlcjU2NzQ1OTc=", "avatar_url": "https://avatars2.githubusercontent.com/u/5674597?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SsnL", "html_url": "https://github.com/SsnL", "followers_url": "https://api.github.com/users/SsnL/followers", "following_url": "https://api.github.com/users/SsnL/following{/other_user}", "gists_url": "https://api.github.com/users/SsnL/gists{/gist_id}", "starred_url": "https://api.github.com/users/SsnL/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SsnL/subscriptions", "organizations_url": "https://api.github.com/users/SsnL/orgs", "repos_url": "https://api.github.com/users/SsnL/repos", "events_url": "https://api.github.com/users/SsnL/events{/privacy}", "received_events_url": "https://api.github.com/users/SsnL/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 443483881, "node_id": "MDU6TGFiZWw0NDM0ODM4ODE=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/todo", "name": "todo", "color": "c2e0c6", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2018-04-07T03:01:14Z", "updated_at": "2018-05-14T19:46:08Z", "closed_at": null, "author_association": "CONTRIBUTOR", "body_html": "<ul>\n<li>PyTorch or Caffe2: PyTorch</li>\n<li>OS: Ubuntu 16.04</li>\n<li>PyTorch version: 0.4.0a0+774601c</li>\n<li>How you installed PyTorch (conda, pip, source): source</li>\n<li>Python version: 3.6.5</li>\n<li>CUDA/cuDNN version: CUDA 9.1.85 @ <code>/usr/local/cuda</code></li>\n<li>GPU models and configuration: Titan Xp *2</li>\n<li>GCC version (if compiling from source): 5.4.0</li>\n<li>CMake version: 3.9.4</li>\n<li>Build command you used (if compiling from source): <code>python setup.py install</code></li>\n</ul>\n<p>GLOO cmake output:</p>\n<pre><code>-- CUDA detected: 9.0\n</code></pre>\n<p>I added some more prints from GLOO <code>Cuda.cmake</code> and got</p>\n<pre><code>CUDA_VERSION: 9.0\nCUDA_VERSION_STRING: 9.0\nCUDA_TOOLKIT_ROOT_DIR: /usr/local/cuda\nCUDA_SDK_ROOT_DIR: CUDA_SDK_ROOT_DIR-NOTFOUND\nCUDA_LIBRARIES: /usr/local/cuda/lib64/libcudart_static.a-lpthreaddl/usr/lib/x86_64-linux-gnu/librt.so\n</code></pre>\n<p>The following PyTorch cmake output:</p>\n<pre><code>-- Found CUDA: /usr/local/cuda (found suitable version \"9.1\", minimum required is \"7.5\") \n</code></pre>\n<p>Apparently NCCL also somehow finds CUDA 9.0 and it is the one that links to <code>libcudart.so.9.0</code>...</p>\n<pre><code>\u279c  torch ldd _C.cpython-36m-x86_64-linux-gnu.so\n\tlinux-vdso.so.1 =&gt;  (0x00007fff4dbf2000)\n\tlibshm.so =&gt; /home/ssnl/anaconda3/lib/python3.6/site-packages/torch/./lib/libshm.so (0x00007fd6f4f2e000)\n\tlibcudart.so.9.1 =&gt; /usr/local/cuda/lib64/libcudart.so.9.1 (0x00007fd6f4cc0000)\n\tlibnvToolsExt.so.1 =&gt; /usr/local/cuda/lib64/libnvToolsExt.so.1 (0x00007fd6f4ab7000)\n\tlibATen.so.1 =&gt; /home/ssnl/anaconda3/lib/python3.6/site-packages/torch/./lib/libATen.so.1 (0x00007fd6e33a1000)\n\tlibnccl.so.1 =&gt; /home/ssnl/anaconda3/lib/python3.6/site-packages/torch/./lib/libnccl.so.1 (0x00007fd6e27f3000)\n\tlibgcc_s.so.1 =&gt; /home/ssnl/anaconda3/lib/libgcc_s.so.1 (0x00007fd6e25e1000)\n\tlibpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007fd6e23c4000)\n\tlibc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fd6e1ffa000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007fd6f61fd000)\n\tlibstdc++.so.6 =&gt; /home/ssnl/anaconda3/lib/libstdc++.so.6 (0x00007fd6e1cc0000)\n\tlibdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007fd6e1abc000)\n\tlibrt.so.1 =&gt; /lib/x86_64-linux-gnu/librt.so.1 (0x00007fd6e18b4000)\n\tlibm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007fd6e15ab000)\n\tlibmkl_gf_lp64.so =&gt; /home/ssnl/anaconda3/lib/libmkl_gf_lp64.so (0x00007fd6e0ac3000)\n\tlibmkl_gnu_thread.so =&gt; /home/ssnl/anaconda3/lib/libmkl_gnu_thread.so (0x00007fd6df72e000)\n\tlibmkl_core.so =&gt; /home/ssnl/anaconda3/lib/libmkl_core.so (0x00007fd6dd9ea000)\n\tlibmkldnn.so.0 =&gt; /home/ssnl/anaconda3/lib/libmkldnn.so.0 (0x00007fd6dd263000)\n\tlibcusparse.so.9.1 =&gt; /usr/local/cuda/lib64/libcusparse.so.9.1 (0x00007fd6d9b8f000)\n\tlibcublas.so.9.1 =&gt; /usr/local/cuda/lib64/libcublas.so.9.1 (0x00007fd6d646b000)\n\tlibcufft.so.9.1 =&gt; /usr/local/cuda/lib64/libcufft.so.9.1 (0x00007fd6cef7e000)\n\tlibcudnn.so.7 =&gt; /usr/local/cuda/lib64/libcudnn.so.7 (0x00007fd6ba755000)\n\tlibgomp.so.1 =&gt; /home/ssnl/anaconda3/lib/libgomp.so.1 (0x00007fd6ba532000)\n\tlibcudart.so.9.0 =&gt; not found\n\tlibmklml_intel.so =&gt; /home/ssnl/anaconda3/lib/./libmklml_intel.so (0x00007fd6b1686000)\n\tlibiomp5.so =&gt; /home/ssnl/anaconda3/lib/./libiomp5.so (0x00007fd6b12e2000)\n\n</code></pre>", "body_text": "PyTorch or Caffe2: PyTorch\nOS: Ubuntu 16.04\nPyTorch version: 0.4.0a0+774601c\nHow you installed PyTorch (conda, pip, source): source\nPython version: 3.6.5\nCUDA/cuDNN version: CUDA 9.1.85 @ /usr/local/cuda\nGPU models and configuration: Titan Xp *2\nGCC version (if compiling from source): 5.4.0\nCMake version: 3.9.4\nBuild command you used (if compiling from source): python setup.py install\n\nGLOO cmake output:\n-- CUDA detected: 9.0\n\nI added some more prints from GLOO Cuda.cmake and got\nCUDA_VERSION: 9.0\nCUDA_VERSION_STRING: 9.0\nCUDA_TOOLKIT_ROOT_DIR: /usr/local/cuda\nCUDA_SDK_ROOT_DIR: CUDA_SDK_ROOT_DIR-NOTFOUND\nCUDA_LIBRARIES: /usr/local/cuda/lib64/libcudart_static.a-lpthreaddl/usr/lib/x86_64-linux-gnu/librt.so\n\nThe following PyTorch cmake output:\n-- Found CUDA: /usr/local/cuda (found suitable version \"9.1\", minimum required is \"7.5\") \n\nApparently NCCL also somehow finds CUDA 9.0 and it is the one that links to libcudart.so.9.0...\n\u279c  torch ldd _C.cpython-36m-x86_64-linux-gnu.so\n\tlinux-vdso.so.1 =>  (0x00007fff4dbf2000)\n\tlibshm.so => /home/ssnl/anaconda3/lib/python3.6/site-packages/torch/./lib/libshm.so (0x00007fd6f4f2e000)\n\tlibcudart.so.9.1 => /usr/local/cuda/lib64/libcudart.so.9.1 (0x00007fd6f4cc0000)\n\tlibnvToolsExt.so.1 => /usr/local/cuda/lib64/libnvToolsExt.so.1 (0x00007fd6f4ab7000)\n\tlibATen.so.1 => /home/ssnl/anaconda3/lib/python3.6/site-packages/torch/./lib/libATen.so.1 (0x00007fd6e33a1000)\n\tlibnccl.so.1 => /home/ssnl/anaconda3/lib/python3.6/site-packages/torch/./lib/libnccl.so.1 (0x00007fd6e27f3000)\n\tlibgcc_s.so.1 => /home/ssnl/anaconda3/lib/libgcc_s.so.1 (0x00007fd6e25e1000)\n\tlibpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007fd6e23c4000)\n\tlibc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007fd6e1ffa000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007fd6f61fd000)\n\tlibstdc++.so.6 => /home/ssnl/anaconda3/lib/libstdc++.so.6 (0x00007fd6e1cc0000)\n\tlibdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007fd6e1abc000)\n\tlibrt.so.1 => /lib/x86_64-linux-gnu/librt.so.1 (0x00007fd6e18b4000)\n\tlibm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007fd6e15ab000)\n\tlibmkl_gf_lp64.so => /home/ssnl/anaconda3/lib/libmkl_gf_lp64.so (0x00007fd6e0ac3000)\n\tlibmkl_gnu_thread.so => /home/ssnl/anaconda3/lib/libmkl_gnu_thread.so (0x00007fd6df72e000)\n\tlibmkl_core.so => /home/ssnl/anaconda3/lib/libmkl_core.so (0x00007fd6dd9ea000)\n\tlibmkldnn.so.0 => /home/ssnl/anaconda3/lib/libmkldnn.so.0 (0x00007fd6dd263000)\n\tlibcusparse.so.9.1 => /usr/local/cuda/lib64/libcusparse.so.9.1 (0x00007fd6d9b8f000)\n\tlibcublas.so.9.1 => /usr/local/cuda/lib64/libcublas.so.9.1 (0x00007fd6d646b000)\n\tlibcufft.so.9.1 => /usr/local/cuda/lib64/libcufft.so.9.1 (0x00007fd6cef7e000)\n\tlibcudnn.so.7 => /usr/local/cuda/lib64/libcudnn.so.7 (0x00007fd6ba755000)\n\tlibgomp.so.1 => /home/ssnl/anaconda3/lib/libgomp.so.1 (0x00007fd6ba532000)\n\tlibcudart.so.9.0 => not found\n\tlibmklml_intel.so => /home/ssnl/anaconda3/lib/./libmklml_intel.so (0x00007fd6b1686000)\n\tlibiomp5.so => /home/ssnl/anaconda3/lib/./libiomp5.so (0x00007fd6b12e2000)", "body": "- PyTorch or Caffe2: PyTorch\r\n- OS: Ubuntu 16.04\r\n- PyTorch version: 0.4.0a0+774601c\r\n- How you installed PyTorch (conda, pip, source): source\r\n- Python version: 3.6.5\r\n- CUDA/cuDNN version: CUDA 9.1.85 @ `/usr/local/cuda`\r\n- GPU models and configuration: Titan Xp *2\r\n- GCC version (if compiling from source): 5.4.0\r\n- CMake version: 3.9.4\r\n- Build command you used (if compiling from source): `python setup.py install`\r\n\r\nGLOO cmake output:\r\n```\r\n-- CUDA detected: 9.0\r\n```\r\n\r\nI added some more prints from GLOO `Cuda.cmake` and got\r\n```\r\nCUDA_VERSION: 9.0\r\nCUDA_VERSION_STRING: 9.0\r\nCUDA_TOOLKIT_ROOT_DIR: /usr/local/cuda\r\nCUDA_SDK_ROOT_DIR: CUDA_SDK_ROOT_DIR-NOTFOUND\r\nCUDA_LIBRARIES: /usr/local/cuda/lib64/libcudart_static.a-lpthreaddl/usr/lib/x86_64-linux-gnu/librt.so\r\n```\r\n\r\nThe following PyTorch cmake output:\r\n```\r\n-- Found CUDA: /usr/local/cuda (found suitable version \"9.1\", minimum required is \"7.5\") \r\n```\r\n\r\nApparently NCCL also somehow finds CUDA 9.0 and it is the one that links to `libcudart.so.9.0`...\r\n```\r\n\u279c  torch ldd _C.cpython-36m-x86_64-linux-gnu.so\r\n\tlinux-vdso.so.1 =>  (0x00007fff4dbf2000)\r\n\tlibshm.so => /home/ssnl/anaconda3/lib/python3.6/site-packages/torch/./lib/libshm.so (0x00007fd6f4f2e000)\r\n\tlibcudart.so.9.1 => /usr/local/cuda/lib64/libcudart.so.9.1 (0x00007fd6f4cc0000)\r\n\tlibnvToolsExt.so.1 => /usr/local/cuda/lib64/libnvToolsExt.so.1 (0x00007fd6f4ab7000)\r\n\tlibATen.so.1 => /home/ssnl/anaconda3/lib/python3.6/site-packages/torch/./lib/libATen.so.1 (0x00007fd6e33a1000)\r\n\tlibnccl.so.1 => /home/ssnl/anaconda3/lib/python3.6/site-packages/torch/./lib/libnccl.so.1 (0x00007fd6e27f3000)\r\n\tlibgcc_s.so.1 => /home/ssnl/anaconda3/lib/libgcc_s.so.1 (0x00007fd6e25e1000)\r\n\tlibpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007fd6e23c4000)\r\n\tlibc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007fd6e1ffa000)\r\n\t/lib64/ld-linux-x86-64.so.2 (0x00007fd6f61fd000)\r\n\tlibstdc++.so.6 => /home/ssnl/anaconda3/lib/libstdc++.so.6 (0x00007fd6e1cc0000)\r\n\tlibdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007fd6e1abc000)\r\n\tlibrt.so.1 => /lib/x86_64-linux-gnu/librt.so.1 (0x00007fd6e18b4000)\r\n\tlibm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007fd6e15ab000)\r\n\tlibmkl_gf_lp64.so => /home/ssnl/anaconda3/lib/libmkl_gf_lp64.so (0x00007fd6e0ac3000)\r\n\tlibmkl_gnu_thread.so => /home/ssnl/anaconda3/lib/libmkl_gnu_thread.so (0x00007fd6df72e000)\r\n\tlibmkl_core.so => /home/ssnl/anaconda3/lib/libmkl_core.so (0x00007fd6dd9ea000)\r\n\tlibmkldnn.so.0 => /home/ssnl/anaconda3/lib/libmkldnn.so.0 (0x00007fd6dd263000)\r\n\tlibcusparse.so.9.1 => /usr/local/cuda/lib64/libcusparse.so.9.1 (0x00007fd6d9b8f000)\r\n\tlibcublas.so.9.1 => /usr/local/cuda/lib64/libcublas.so.9.1 (0x00007fd6d646b000)\r\n\tlibcufft.so.9.1 => /usr/local/cuda/lib64/libcufft.so.9.1 (0x00007fd6cef7e000)\r\n\tlibcudnn.so.7 => /usr/local/cuda/lib64/libcudnn.so.7 (0x00007fd6ba755000)\r\n\tlibgomp.so.1 => /home/ssnl/anaconda3/lib/libgomp.so.1 (0x00007fd6ba532000)\r\n\tlibcudart.so.9.0 => not found\r\n\tlibmklml_intel.so => /home/ssnl/anaconda3/lib/./libmklml_intel.so (0x00007fd6b1686000)\r\n\tlibiomp5.so => /home/ssnl/anaconda3/lib/./libiomp5.so (0x00007fd6b12e2000)\r\n\r\n```"}