{"url": "https://api.github.com/repos/pytorch/pytorch/issues/8267", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/8267/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/8267/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/8267/events", "html_url": "https://github.com/pytorch/pytorch/issues/8267", "id": 330489509, "node_id": "MDU6SXNzdWUzMzA0ODk1MDk=", "number": 8267, "title": "Cannot find THCTensor.hpp (required indirectly by THCTensorMathReduce.hpp) when building extension", "user": {"login": "mcarilli", "id": 7799218, "node_id": "MDQ6VXNlcjc3OTkyMTg=", "avatar_url": "https://avatars0.githubusercontent.com/u/7799218?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarilli", "html_url": "https://github.com/mcarilli", "followers_url": "https://api.github.com/users/mcarilli/followers", "following_url": "https://api.github.com/users/mcarilli/following{/other_user}", "gists_url": "https://api.github.com/users/mcarilli/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarilli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarilli/subscriptions", "organizations_url": "https://api.github.com/users/mcarilli/orgs", "repos_url": "https://api.github.com/users/mcarilli/repos", "events_url": "https://api.github.com/users/mcarilli/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarilli/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2018-06-08T01:33:17Z", "updated_at": "2018-09-17T21:44:11Z", "closed_at": "2018-06-08T22:45:39Z", "author_association": "CONTRIBUTOR", "body_html": "<h2>Issue description</h2>\n<p>When building my extensions (and preparing to upstream eventually) I'd like to be able to use the functors present in THCTensorMathReduce.cuh.  Until recently (last week ish) it worked fine, but now #include THC/THCTensorMathReduce.cuh fails.  The include chain is<br>\nTHCTensorMathReduce.cuh -&gt; THCReduce.cuh -&gt; THCTensorTypeUtils.cuh -&gt; THCTensor.hpp -&gt; failure.</p>\n<p>I installed the latest Pytorch master via \"python setup.py install.\"  The resulting include directory on my system (in my case /home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include/THC) contains THCTensorMathReduce.cuh, THCReduce.cuh, and THCTensorTypeUtils.cuh, but not THCTensor.hpp.</p>\n<p>I believe the offending commit, after which compilation fails, is <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/pytorch/pytorch/commit/61fd99e1b313c0bdb607f31a443d2ce027aed582#diff-596ad5d24f67dca5412b805737911064/hovercard\" href=\"https://github.com/pytorch/pytorch/commit/61fd99e1b313c0bdb607f31a443d2ce027aed582#diff-596ad5d24f67dca5412b805737911064\"><tt>61fd99e</tt>#diff-596ad5d24f67dca5412b805737911064</a>.</p>\n<p>It may be worth adding a test for including this file (and any other headers we anticipate being useful to extension builders) in the cpp extension CI.  If you think so, I'm happy to flesh out my sample for the purpose.</p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=15841449\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ngimel\">@ngimel</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=22205833\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/csarofeen\">@csarofeen</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=38511765\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/mruberry\">@mruberry</a> for camaraderie, <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=6429851\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/goldsborough\">@goldsborough</a> because he seems to be the extension guy, <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=3768583\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/gchanan\">@gchanan</a> because he's the author of the commit I suspect is at fault, although I could be wrong.</p>\n<h2>Code example</h2>\n<p>I attached a minimal working repro:  <a href=\"https://github.com/pytorch/pytorch/files/2082590/tensormathreduce.tar.gz\">tensormathreduce.tar.gz</a>.  On a system with nvcc and the latest Pytorch master, try</p>\n<pre><code>tar -zxvf tensormathreduce.tar.gz\ncd tensormathreduce\npython setup.py install  \n</code></pre>\n<p>You should see something along the lines of<br>\n/usr/local/cuda/bin/nvcc -I/home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include -I/home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include/TH -I/home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include/THC -I/usr/local/cuda/include -I/home/mcarilli/anaconda3/include/python3.6m -c backend.cu -o build/temp.linux-x86_64-3.6/backend.o -O2 -DTORCH_EXTENSION_NAME=include_test_C --compiler-options '-fPIC' -std=c++11<br>\nIn file included from /home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include/THC/THCReduce.cuh:11:0,<br>\nfrom /home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include/THC/THCTensorMathReduce.cuh:7,<br>\nfrom backend.cu:5:<br>\n/home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include/THC/THCTensorTypeUtils.cuh:8:25: fatal error: THCTensor.hpp: No such file or directory<br>\ncompilation terminated.</p>\n<p>If you comment out the line \"#include &lt;THC/THCTensorMathReduce&gt;\" in backend.cu, compilation should succeed.</p>\n<h2>System Info</h2>\n<p>Collecting environment information...<br>\nPyTorch version: 0.5.0a0+0c9b5f0<br>\nIs debug build: No<br>\nCUDA used to build PyTorch: 9.1.85</p>\n<p>OS: Ubuntu 16.04.4 LTS<br>\nGCC version: (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609<br>\nCMake version: version 3.9.4</p>\n<p>Python version: 3.6<br>\nIs CUDA available: Yes<br>\nCUDA runtime version: 9.1.85<br>\nGPU models and configuration:<br>\nGPU 0: TITAN X (Pascal)<br>\nGPU 1: Graphics Device</p>\n<p>Nvidia driver version: 390.48<br>\ncuDNN version: Probably one of the following:<br>\n/usr/lib/x86_64-linux-gnu/libcudnn.so.7.0.5<br>\n/usr/lib/x86_64-linux-gnu/libcudnn.so.7.0.5.real<br>\n/usr/lib/x86_64-linux-gnu/libcudnn.so.7.1.1<br>\n/usr/lib/x86_64-linux-gnu/libcudnn_static_v7.a<br>\n/usr/local/cuda-9.1/targets/x86_64-linux/lib/libcudnn.so<br>\n/usr/local/cuda-9.1/targets/x86_64-linux/lib/libcudnn.so.7<br>\n/usr/local/cuda-9.1/targets/x86_64-linux/lib/libcudnn.so.7.1.4<br>\n/usr/local/cuda-9.1/targets/x86_64-linux/lib/libcudnn_static.a</p>\n<p>Versions of relevant libraries:<br>\n[pip3] numpy (1.13.3)<br>\n[pip3] numpydoc (0.7.0)<br>\n[pip3] torch (0.5.0a0+0c9b5f0)<br>\n[pip3] torch-test-cpp-extension (0.0.0)<br>\n[pip3] torchvision (0.2.0)<br>\n[conda] magma-cuda90              2.2.0                hae16b58_1    pytorch<br>\n[conda] torch                     0.5.0a0+0c9b5f0           <br>\n[conda] torch-test-cpp-extension  0.0.0                     <br>\n[conda] torchvision               0.2.0                     </p>", "body_text": "Issue description\nWhen building my extensions (and preparing to upstream eventually) I'd like to be able to use the functors present in THCTensorMathReduce.cuh.  Until recently (last week ish) it worked fine, but now #include THC/THCTensorMathReduce.cuh fails.  The include chain is\nTHCTensorMathReduce.cuh -> THCReduce.cuh -> THCTensorTypeUtils.cuh -> THCTensor.hpp -> failure.\nI installed the latest Pytorch master via \"python setup.py install.\"  The resulting include directory on my system (in my case /home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include/THC) contains THCTensorMathReduce.cuh, THCReduce.cuh, and THCTensorTypeUtils.cuh, but not THCTensor.hpp.\nI believe the offending commit, after which compilation fails, is 61fd99e#diff-596ad5d24f67dca5412b805737911064.\nIt may be worth adding a test for including this file (and any other headers we anticipate being useful to extension builders) in the cpp extension CI.  If you think so, I'm happy to flesh out my sample for the purpose.\n@ngimel @csarofeen @mruberry for camaraderie, @goldsborough because he seems to be the extension guy, @gchanan because he's the author of the commit I suspect is at fault, although I could be wrong.\nCode example\nI attached a minimal working repro:  tensormathreduce.tar.gz.  On a system with nvcc and the latest Pytorch master, try\ntar -zxvf tensormathreduce.tar.gz\ncd tensormathreduce\npython setup.py install  \n\nYou should see something along the lines of\n/usr/local/cuda/bin/nvcc -I/home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include -I/home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include/TH -I/home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include/THC -I/usr/local/cuda/include -I/home/mcarilli/anaconda3/include/python3.6m -c backend.cu -o build/temp.linux-x86_64-3.6/backend.o -O2 -DTORCH_EXTENSION_NAME=include_test_C --compiler-options '-fPIC' -std=c++11\nIn file included from /home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include/THC/THCReduce.cuh:11:0,\nfrom /home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include/THC/THCTensorMathReduce.cuh:7,\nfrom backend.cu:5:\n/home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include/THC/THCTensorTypeUtils.cuh:8:25: fatal error: THCTensor.hpp: No such file or directory\ncompilation terminated.\nIf you comment out the line \"#include <THC/THCTensorMathReduce>\" in backend.cu, compilation should succeed.\nSystem Info\nCollecting environment information...\nPyTorch version: 0.5.0a0+0c9b5f0\nIs debug build: No\nCUDA used to build PyTorch: 9.1.85\nOS: Ubuntu 16.04.4 LTS\nGCC version: (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609\nCMake version: version 3.9.4\nPython version: 3.6\nIs CUDA available: Yes\nCUDA runtime version: 9.1.85\nGPU models and configuration:\nGPU 0: TITAN X (Pascal)\nGPU 1: Graphics Device\nNvidia driver version: 390.48\ncuDNN version: Probably one of the following:\n/usr/lib/x86_64-linux-gnu/libcudnn.so.7.0.5\n/usr/lib/x86_64-linux-gnu/libcudnn.so.7.0.5.real\n/usr/lib/x86_64-linux-gnu/libcudnn.so.7.1.1\n/usr/lib/x86_64-linux-gnu/libcudnn_static_v7.a\n/usr/local/cuda-9.1/targets/x86_64-linux/lib/libcudnn.so\n/usr/local/cuda-9.1/targets/x86_64-linux/lib/libcudnn.so.7\n/usr/local/cuda-9.1/targets/x86_64-linux/lib/libcudnn.so.7.1.4\n/usr/local/cuda-9.1/targets/x86_64-linux/lib/libcudnn_static.a\nVersions of relevant libraries:\n[pip3] numpy (1.13.3)\n[pip3] numpydoc (0.7.0)\n[pip3] torch (0.5.0a0+0c9b5f0)\n[pip3] torch-test-cpp-extension (0.0.0)\n[pip3] torchvision (0.2.0)\n[conda] magma-cuda90              2.2.0                hae16b58_1    pytorch\n[conda] torch                     0.5.0a0+0c9b5f0           \n[conda] torch-test-cpp-extension  0.0.0                     \n[conda] torchvision               0.2.0", "body": "## Issue description\r\n\r\nWhen building my extensions (and preparing to upstream eventually) I'd like to be able to use the functors present in THCTensorMathReduce.cuh.  Until recently (last week ish) it worked fine, but now #include THC/THCTensorMathReduce.cuh fails.  The include chain is\r\nTHCTensorMathReduce.cuh -> THCReduce.cuh -> THCTensorTypeUtils.cuh -> THCTensor.hpp -> failure.\r\n\r\nI installed the latest Pytorch master via \"python setup.py install.\"  The resulting include directory on my system (in my case /home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include/THC) contains THCTensorMathReduce.cuh, THCReduce.cuh, and THCTensorTypeUtils.cuh, but not THCTensor.hpp.\r\n\r\nI believe the offending commit, after which compilation fails, is https://github.com/pytorch/pytorch/commit/61fd99e1b313c0bdb607f31a443d2ce027aed582#diff-596ad5d24f67dca5412b805737911064.\r\n\r\nIt may be worth adding a test for including this file (and any other headers we anticipate being useful to extension builders) in the cpp extension CI.  If you think so, I'm happy to flesh out my sample for the purpose.\r\n\r\n@ngimel @csarofeen @mruberry for camaraderie, @goldsborough because he seems to be the extension guy, @gchanan because he's the author of the commit I suspect is at fault, although I could be wrong.\r\n\r\n## Code example\r\n\r\nI attached a minimal working repro:  [tensormathreduce.tar.gz](https://github.com/pytorch/pytorch/files/2082590/tensormathreduce.tar.gz).  On a system with nvcc and the latest Pytorch master, try\r\n```\r\ntar -zxvf tensormathreduce.tar.gz\r\ncd tensormathreduce\r\npython setup.py install  \r\n```\r\nYou should see something along the lines of \r\n/usr/local/cuda/bin/nvcc -I/home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include -I/home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include/TH -I/home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include/THC -I/usr/local/cuda/include -I/home/mcarilli/anaconda3/include/python3.6m -c backend.cu -o build/temp.linux-x86_64-3.6/backend.o -O2 -DTORCH_EXTENSION_NAME=include_test_C --compiler-options '-fPIC' -std=c++11\r\nIn file included from /home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include/THC/THCReduce.cuh:11:0,\r\n                 from /home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include/THC/THCTensorMathReduce.cuh:7,\r\n                 from backend.cu:5:\r\n/home/mcarilli/anaconda3/lib/python3.6/site-packages/torch/lib/include/THC/THCTensorTypeUtils.cuh:8:25: fatal error: THCTensor.hpp: No such file or directory\r\ncompilation terminated.\r\n\r\nIf you comment out the line \"#include <THC/THCTensorMathReduce>\" in backend.cu, compilation should succeed.\r\n\r\n## System Info\r\nCollecting environment information...\r\nPyTorch version: 0.5.0a0+0c9b5f0\r\nIs debug build: No\r\nCUDA used to build PyTorch: 9.1.85\r\n\r\nOS: Ubuntu 16.04.4 LTS\r\nGCC version: (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609\r\nCMake version: version 3.9.4\r\n\r\nPython version: 3.6\r\nIs CUDA available: Yes\r\nCUDA runtime version: 9.1.85\r\nGPU models and configuration: \r\nGPU 0: TITAN X (Pascal)\r\nGPU 1: Graphics Device\r\n\r\nNvidia driver version: 390.48\r\ncuDNN version: Probably one of the following:\r\n/usr/lib/x86_64-linux-gnu/libcudnn.so.7.0.5\r\n/usr/lib/x86_64-linux-gnu/libcudnn.so.7.0.5.real\r\n/usr/lib/x86_64-linux-gnu/libcudnn.so.7.1.1\r\n/usr/lib/x86_64-linux-gnu/libcudnn_static_v7.a\r\n/usr/local/cuda-9.1/targets/x86_64-linux/lib/libcudnn.so\r\n/usr/local/cuda-9.1/targets/x86_64-linux/lib/libcudnn.so.7\r\n/usr/local/cuda-9.1/targets/x86_64-linux/lib/libcudnn.so.7.1.4\r\n/usr/local/cuda-9.1/targets/x86_64-linux/lib/libcudnn_static.a\r\n\r\nVersions of relevant libraries:\r\n[pip3] numpy (1.13.3)\r\n[pip3] numpydoc (0.7.0)\r\n[pip3] torch (0.5.0a0+0c9b5f0)\r\n[pip3] torch-test-cpp-extension (0.0.0)\r\n[pip3] torchvision (0.2.0)\r\n[conda] magma-cuda90              2.2.0                hae16b58_1    pytorch\r\n[conda] torch                     0.5.0a0+0c9b5f0           <pip>\r\n[conda] torch-test-cpp-extension  0.0.0                     <pip>\r\n[conda] torchvision               0.2.0                     <pip>"}