{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/202800740", "pull_request_review_id": 137568127, "id": 202800740, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjgwMDc0MA==", "diff_hunk": "@@ -7,21 +7,52 @@ namespace at {\n // base class for refcounted things, allows for collects of generic\n // refcounted objects that include tensors\n struct Retainable {\n-  Retainable(): refcount(1) {}\n+  Retainable(): refcount(1), weak_refcount(1) {}", "path": "aten/src/ATen/Retainable.h", "position": 5, "original_position": 5, "commit_id": "76be0f21821be91b7e717715314b4eba472d4c57", "original_commit_id": "76be0f21821be91b7e717715314b4eba472d4c57", "user": {"login": "ezyang", "id": 13564, "node_id": "MDQ6VXNlcjEzNTY0", "avatar_url": "https://avatars0.githubusercontent.com/u/13564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ezyang", "html_url": "https://github.com/ezyang", "followers_url": "https://api.github.com/users/ezyang/followers", "following_url": "https://api.github.com/users/ezyang/following{/other_user}", "gists_url": "https://api.github.com/users/ezyang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ezyang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ezyang/subscriptions", "organizations_url": "https://api.github.com/users/ezyang/orgs", "repos_url": "https://api.github.com/users/ezyang/repos", "events_url": "https://api.github.com/users/ezyang/events{/privacy}", "received_events_url": "https://api.github.com/users/ezyang/received_events", "type": "User", "site_admin": false}, "body": "The immediate motivation for weak references is for thread-local tracing (https://github.com/pytorch/pytorch/pull/9414). That in and of itself wouldn't be a good reason, but we had a previous case where we needed weak references for a weak mapping of storages to file descriptors in our multiprocessing implementation. And we think that weak references are generally useful enough to deserve the extra word in the tensor struct to hold them.", "created_at": "2018-07-16T19:43:33Z", "updated_at": "2018-11-23T15:47:29Z", "html_url": "https://github.com/pytorch/pytorch/pull/9363#discussion_r202800740", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/9363", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/202800740"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/9363#discussion_r202800740"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/9363"}}, "body_html": "<p>The immediate motivation for weak references is for thread-local tracing (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"340860917\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/9414\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/9414/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/9414\">#9414</a>). That in and of itself wouldn't be a good reason, but we had a previous case where we needed weak references for a weak mapping of storages to file descriptors in our multiprocessing implementation. And we think that weak references are generally useful enough to deserve the extra word in the tensor struct to hold them.</p>", "body_text": "The immediate motivation for weak references is for thread-local tracing (#9414). That in and of itself wouldn't be a good reason, but we had a previous case where we needed weak references for a weak mapping of storages to file descriptors in our multiprocessing implementation. And we think that weak references are generally useful enough to deserve the extra word in the tensor struct to hold them.", "in_reply_to_id": 202779678}