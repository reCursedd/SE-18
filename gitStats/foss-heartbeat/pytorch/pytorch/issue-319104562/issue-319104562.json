{"url": "https://api.github.com/repos/pytorch/pytorch/issues/7127", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/7127/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/7127/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/7127/events", "html_url": "https://github.com/pytorch/pytorch/issues/7127", "id": 319104562, "node_id": "MDU6SXNzdWUzMTkxMDQ1NjI=", "number": 7127, "title": "how can i use openMP for caffe2? why caffe2 not work in multi-threads mode?", "user": {"login": "china-cat", "id": 38872785, "node_id": "MDQ6VXNlcjM4ODcyNzg1", "avatar_url": "https://avatars2.githubusercontent.com/u/38872785?v=4", "gravatar_id": "", "url": "https://api.github.com/users/china-cat", "html_url": "https://github.com/china-cat", "followers_url": "https://api.github.com/users/china-cat/followers", "following_url": "https://api.github.com/users/china-cat/following{/other_user}", "gists_url": "https://api.github.com/users/china-cat/gists{/gist_id}", "starred_url": "https://api.github.com/users/china-cat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/china-cat/subscriptions", "organizations_url": "https://api.github.com/users/china-cat/orgs", "repos_url": "https://api.github.com/users/china-cat/repos", "events_url": "https://api.github.com/users/china-cat/events{/privacy}", "received_events_url": "https://api.github.com/users/china-cat/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 890282107, "node_id": "MDU6TGFiZWw4OTAyODIxMDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/caffe2", "name": "caffe2", "color": "210aa8", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-05-01T03:22:36Z", "updated_at": "2018-10-08T05:42:14Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>i had compile caffe2 with set openMP ON and use openblas, it compile correctly .<br>\nbut  problem is how to use it?<br>\n1)<br>\ni set openBLAS_NUM_THREADS=1 and OMP_NUM_THREADS=4<br>\nthen run command: python convnet_benchmarks.py --batch_size=16 iteration 1 --cpu  --mode AlexNet<br>\ni can see only one core is run, and the result is Milliseconds per iter:8499</p>\n<p>i change the OMP_NUM_THREADS value to 1,2,3,4<br>\nbut only core is running, the result is same</p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>i set openBLAS_NUM_THREADS=4 and OMP_NUM_THREADS=1<br>\nthen run python convnet_benchmarks.py --batch_size=16 iteration 1 --cpu  --mode AlexNet<br>\ni can see 4  core is running, and the result is Milliseconds per iter:3835<br>\nbut it is openBLAS work in multi-threads mode</p>\n<p>why caffe2 not work in multi-threads mode?</p>", "body_text": "i had compile caffe2 with set openMP ON and use openblas, it compile correctly .\nbut  problem is how to use it?\n1)\ni set openBLAS_NUM_THREADS=1 and OMP_NUM_THREADS=4\nthen run command: python convnet_benchmarks.py --batch_size=16 iteration 1 --cpu  --mode AlexNet\ni can see only one core is run, and the result is Milliseconds per iter:8499\ni change the OMP_NUM_THREADS value to 1,2,3,4\nbut only core is running, the result is same\n\n\n\ni set openBLAS_NUM_THREADS=4 and OMP_NUM_THREADS=1\nthen run python convnet_benchmarks.py --batch_size=16 iteration 1 --cpu  --mode AlexNet\ni can see 4  core is running, and the result is Milliseconds per iter:3835\nbut it is openBLAS work in multi-threads mode\nwhy caffe2 not work in multi-threads mode?", "body": "i had compile caffe2 with set openMP ON and use openblas, it compile correctly .\r\nbut  problem is how to use it?\r\n1)\r\ni set openBLAS_NUM_THREADS=1 and OMP_NUM_THREADS=4\r\nthen run command: python convnet_benchmarks.py --batch_size=16 iteration 1 --cpu  --mode AlexNet\r\ni can see only one core is run, and the result is Milliseconds per iter:8499\r\n\r\ni change the OMP_NUM_THREADS value to 1,2,3,4\r\nbut only core is running, the result is same\r\n\r\n2) \r\ni set openBLAS_NUM_THREADS=4 and OMP_NUM_THREADS=1\r\nthen run python convnet_benchmarks.py --batch_size=16 iteration 1 --cpu  --mode AlexNet\r\ni can see 4  core is running, and the result is Milliseconds per iter:3835\r\nbut it is openBLAS work in multi-threads mode\r\n\r\nwhy caffe2 not work in multi-threads mode?\r\n"}