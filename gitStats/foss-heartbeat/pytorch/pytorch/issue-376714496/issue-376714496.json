{"url": "https://api.github.com/repos/pytorch/pytorch/issues/13503", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/13503/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/13503/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/13503/events", "html_url": "https://github.com/pytorch/pytorch/issues/13503", "id": 376714496, "node_id": "MDU6SXNzdWUzNzY3MTQ0OTY=", "number": 13503, "title": "C++ API, IValue toTensor() didn't work", "user": {"login": "liuhuaiyu", "id": 17059613, "node_id": "MDQ6VXNlcjE3MDU5NjEz", "avatar_url": "https://avatars3.githubusercontent.com/u/17059613?v=4", "gravatar_id": "", "url": "https://api.github.com/users/liuhuaiyu", "html_url": "https://github.com/liuhuaiyu", "followers_url": "https://api.github.com/users/liuhuaiyu/followers", "following_url": "https://api.github.com/users/liuhuaiyu/following{/other_user}", "gists_url": "https://api.github.com/users/liuhuaiyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/liuhuaiyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/liuhuaiyu/subscriptions", "organizations_url": "https://api.github.com/users/liuhuaiyu/orgs", "repos_url": "https://api.github.com/users/liuhuaiyu/repos", "events_url": "https://api.github.com/users/liuhuaiyu/events{/privacy}", "received_events_url": "https://api.github.com/users/liuhuaiyu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 553773019, "node_id": "MDU6TGFiZWw1NTM3NzMwMTk=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/needs-reproduction", "name": "needs-reproduction", "color": "e99695", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-11-02T08:34:44Z", "updated_at": "2018-11-07T05:21:33Z", "closed_at": "2018-11-07T05:21:33Z", "author_association": "NONE", "body_html": "<h2><g-emoji class=\"g-emoji\" alias=\"bug\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f41b.png\">\ud83d\udc1b</g-emoji> Bug</h2>\n\n<h2>To Reproduce</h2>\n<p>Steps to reproduce the behavior:</p>\n<p>I loaded a torchscript module and tested it in C environment.</p>\n<p>`int main() {</p>\n<pre><code>std::shared_ptr&lt;torch::jit::script::Module&gt; module = \ntorch::jit::load(\"/home/liuhuaiyu/Downloads/torchscript_version.pt\");\nassert(module != nullptr);\nstd::cout &lt;&lt; \"model loaded ok\\n\";\n\n\nstd::vector&lt;torch::jit::IValue&gt; inputs;\n\ninputs.push_back(torch::ones({4, 9, 32, 32}));\n\nauto output = module-&gt;forward(inputs).toTensor();\n\nreturn 0;\n</code></pre>\n<p>}<br>\n`</p>\n<p>the error:</p>\n<p>liuhuaiyu@x4k-02:~/test_pytorch_to_c/build$ ./test<br>\nmodel loaded ok<br>\nterminate called after throwing an instance of 'c10::Error'<br>\nwhat():  isTensor() ASSERT FAILED at /home/liuhuaiyu/libtorch/include/ATen/core/ivalue.h:160, please report a bug to PyTorch. (toTensor at /home/liuhuaiyu/libtorch/include/ATen/core/ivalue.h:160)<br>\nframe #0: std::function&lt;std::string ()&gt;::operator()() const + 0x11 (0x7f20123e9cd1 in /home/liuhuaiyu/libtorch/lib/libc10.so)<br>\nframe <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"171281708\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/1\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/1/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/1\">#1</a>: c10::Error::Error(c10::SourceLocation, std::string const&amp;) + 0x2a (0x7f20123e959a in /home/liuhuaiyu/libtorch/lib/libc10.so)<br>\nframe <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"171402941\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/2\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/2/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/2\">#2</a>: c10::IValue::toTensor() &amp;&amp; + 0xa8 (0x424860 in ./test)<br>\nframe <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"171485123\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/3\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/3/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/3\">#3</a>: main + 0x18f (0x422bf2 in ./test)<br>\nframe <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"171522963\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/4\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/4/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/4\">#4</a>: __libc_start_main + 0xf0 (0x7f2011a94830 in /lib/x86_64-linux-gnu/libc.so.6)<br>\nframe <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"173498149\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/5\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/5/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/5\">#5</a>: _start + 0x29 (0x422319 in ./test)</p>\n<p>Aborted (core dumped)</p>\n<p>But if I delete toTensor() operation, it works with no error.</p>\n\n<h2>Expected behavior</h2>\n\n<h2>Environment</h2>\n<p>Please copy and paste the output from our<br>\n<a href=\"https://raw.githubusercontent.com/pytorch/pytorch/master/torch/utils/collect_env.py\" rel=\"nofollow\">environment collection script</a><br>\n(or fill out the checklist below manually).</p>\n<p>You can get the script and run it with:</p>\n<pre><code>wget https://raw.githubusercontent.com/pytorch/pytorch/master/torch/utils/collect_env.py\n# For security purposes, please check the contents of collect_env.py before running it.\npython collect_env.py\n</code></pre>\n<ul>\n<li>PyTorch Version (e.g., 1.0):</li>\n<li>OS (e.g., Linux):</li>\n<li>How you installed PyTorch (<code>conda</code>, <code>pip</code>, source):</li>\n<li>Build command you used (if compiling from source):</li>\n<li>Python version:</li>\n<li>CUDA/cuDNN version:</li>\n<li>GPU models and configuration:</li>\n<li>Any other relevant information:</li>\n</ul>\n<h2>Additional context</h2>\n", "body_text": "\ud83d\udc1b Bug\n\nTo Reproduce\nSteps to reproduce the behavior:\nI loaded a torchscript module and tested it in C environment.\n`int main() {\nstd::shared_ptr<torch::jit::script::Module> module = \ntorch::jit::load(\"/home/liuhuaiyu/Downloads/torchscript_version.pt\");\nassert(module != nullptr);\nstd::cout << \"model loaded ok\\n\";\n\n\nstd::vector<torch::jit::IValue> inputs;\n\ninputs.push_back(torch::ones({4, 9, 32, 32}));\n\nauto output = module->forward(inputs).toTensor();\n\nreturn 0;\n\n}\n`\nthe error:\nliuhuaiyu@x4k-02:~/test_pytorch_to_c/build$ ./test\nmodel loaded ok\nterminate called after throwing an instance of 'c10::Error'\nwhat():  isTensor() ASSERT FAILED at /home/liuhuaiyu/libtorch/include/ATen/core/ivalue.h:160, please report a bug to PyTorch. (toTensor at /home/liuhuaiyu/libtorch/include/ATen/core/ivalue.h:160)\nframe #0: std::function<std::string ()>::operator()() const + 0x11 (0x7f20123e9cd1 in /home/liuhuaiyu/libtorch/lib/libc10.so)\nframe #1: c10::Error::Error(c10::SourceLocation, std::string const&) + 0x2a (0x7f20123e959a in /home/liuhuaiyu/libtorch/lib/libc10.so)\nframe #2: c10::IValue::toTensor() && + 0xa8 (0x424860 in ./test)\nframe #3: main + 0x18f (0x422bf2 in ./test)\nframe #4: __libc_start_main + 0xf0 (0x7f2011a94830 in /lib/x86_64-linux-gnu/libc.so.6)\nframe #5: _start + 0x29 (0x422319 in ./test)\nAborted (core dumped)\nBut if I delete toTensor() operation, it works with no error.\n\nExpected behavior\n\nEnvironment\nPlease copy and paste the output from our\nenvironment collection script\n(or fill out the checklist below manually).\nYou can get the script and run it with:\nwget https://raw.githubusercontent.com/pytorch/pytorch/master/torch/utils/collect_env.py\n# For security purposes, please check the contents of collect_env.py before running it.\npython collect_env.py\n\n\nPyTorch Version (e.g., 1.0):\nOS (e.g., Linux):\nHow you installed PyTorch (conda, pip, source):\nBuild command you used (if compiling from source):\nPython version:\nCUDA/cuDNN version:\nGPU models and configuration:\nAny other relevant information:\n\nAdditional context", "body": "## \ud83d\udc1b Bug\r\n\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\n## To Reproduce\r\n\r\nSteps to reproduce the behavior:\r\n\r\nI loaded a torchscript module and tested it in C environment.\r\n\r\n`int main() {\r\n\r\n    std::shared_ptr<torch::jit::script::Module> module = \r\n    torch::jit::load(\"/home/liuhuaiyu/Downloads/torchscript_version.pt\");\r\n    assert(module != nullptr);\r\n    std::cout << \"model loaded ok\\n\";\r\n\r\n    \r\n    std::vector<torch::jit::IValue> inputs;\r\n\r\n    inputs.push_back(torch::ones({4, 9, 32, 32}));\r\n\r\n    auto output = module->forward(inputs).toTensor();\r\n\r\n    return 0;\r\n\r\n}\r\n`\r\n\r\nthe error:\r\n\r\nliuhuaiyu@x4k-02:~/test_pytorch_to_c/build$ ./test \r\nmodel loaded ok\r\nterminate called after throwing an instance of 'c10::Error'\r\n  what():  isTensor() ASSERT FAILED at /home/liuhuaiyu/libtorch/include/ATen/core/ivalue.h:160, please report a bug to PyTorch. (toTensor at /home/liuhuaiyu/libtorch/include/ATen/core/ivalue.h:160)\r\nframe #0: std::function<std::string ()>::operator()() const + 0x11 (0x7f20123e9cd1 in /home/liuhuaiyu/libtorch/lib/libc10.so)\r\nframe #1: c10::Error::Error(c10::SourceLocation, std::string const&) + 0x2a (0x7f20123e959a in /home/liuhuaiyu/libtorch/lib/libc10.so)\r\nframe #2: c10::IValue::toTensor() && + 0xa8 (0x424860 in ./test)\r\nframe #3: main + 0x18f (0x422bf2 in ./test)\r\nframe #4: __libc_start_main + 0xf0 (0x7f2011a94830 in /lib/x86_64-linux-gnu/libc.so.6)\r\nframe #5: _start + 0x29 (0x422319 in ./test)\r\n\r\nAborted (core dumped)\r\n\r\nBut if I delete toTensor() operation, it works with no error.\r\n\r\n\r\n<!-- If you have a code sample, error messages, stack traces, please provide it here as well -->\r\n\r\n## Expected behavior\r\n\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\n## Environment\r\n\r\nPlease copy and paste the output from our\r\n[environment collection script](https://raw.githubusercontent.com/pytorch/pytorch/master/torch/utils/collect_env.py)\r\n(or fill out the checklist below manually).\r\n\r\nYou can get the script and run it with:\r\n```\r\nwget https://raw.githubusercontent.com/pytorch/pytorch/master/torch/utils/collect_env.py\r\n# For security purposes, please check the contents of collect_env.py before running it.\r\npython collect_env.py\r\n```\r\n\r\n - PyTorch Version (e.g., 1.0):\r\n - OS (e.g., Linux):\r\n - How you installed PyTorch (`conda`, `pip`, source):\r\n - Build command you used (if compiling from source):\r\n - Python version:\r\n - CUDA/cuDNN version:\r\n - GPU models and configuration:\r\n - Any other relevant information:\r\n\r\n## Additional context\r\n\r\n<!-- Add any other context about the problem here. -->\r\n"}