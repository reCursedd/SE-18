{"url": "https://api.github.com/repos/pytorch/pytorch/issues/5277", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/5277/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/5277/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/5277/events", "html_url": "https://github.com/pytorch/pytorch/pull/5277", "id": 297917729, "node_id": "MDExOlB1bGxSZXF1ZXN0MTY5NzI0MDI0", "number": 5277, "title": "Use TORCH_EXTENSION_NAME macro to avoid mismatched module/extension name", "user": {"login": "goldsborough", "id": 6429851, "node_id": "MDQ6VXNlcjY0Mjk4NTE=", "avatar_url": "https://avatars3.githubusercontent.com/u/6429851?v=4", "gravatar_id": "", "url": "https://api.github.com/users/goldsborough", "html_url": "https://github.com/goldsborough", "followers_url": "https://api.github.com/users/goldsborough/followers", "following_url": "https://api.github.com/users/goldsborough/following{/other_user}", "gists_url": "https://api.github.com/users/goldsborough/gists{/gist_id}", "starred_url": "https://api.github.com/users/goldsborough/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/goldsborough/subscriptions", "organizations_url": "https://api.github.com/users/goldsborough/orgs", "repos_url": "https://api.github.com/users/goldsborough/repos", "events_url": "https://api.github.com/users/goldsborough/events{/privacy}", "received_events_url": "https://api.github.com/users/goldsborough/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-02-16T20:57:51Z", "updated_at": "2018-11-23T15:39:42Z", "closed_at": "2018-02-17T03:31:05Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/5277", "html_url": "https://github.com/pytorch/pytorch/pull/5277", "diff_url": "https://github.com/pytorch/pytorch/pull/5277.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/5277.patch"}, "body_html": "<p>For C++ extensions, currently, the module name (defined via  <code>PYBIND11_MODULE</code>) must match the extension name (defined in <code>setup.py</code> or <code>torch.utils.cpp_extension.load</code>). This can cause problems when users mistype one of them.</p>\n<p>To fix this, I first wrote a check that would look for the <code>PYBIND11_MODULE</code> declaration in any of the provided source files, and compare the module name declared there with the extension name. This scaled fine and would work. You can find this approach in the first commit of this PR.</p>\n<p>However, <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=370202\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/zdevito\">@zdevito</a> then had a better idea of just defining a macro via a compiler flag that would contain the extension name, that users could then use. I named this <code>TORCH_EXTENSION_NAME</code> and it works very nicely.</p>\n<p>The other changes are just fixes to the C++ extension tests.</p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=370202\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/zdevito\">@zdevito</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=9110200\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/fmassa\">@fmassa</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4583066\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/apaszke\">@apaszke</a></p>", "body_text": "For C++ extensions, currently, the module name (defined via  PYBIND11_MODULE) must match the extension name (defined in setup.py or torch.utils.cpp_extension.load). This can cause problems when users mistype one of them.\nTo fix this, I first wrote a check that would look for the PYBIND11_MODULE declaration in any of the provided source files, and compare the module name declared there with the extension name. This scaled fine and would work. You can find this approach in the first commit of this PR.\nHowever, @zdevito then had a better idea of just defining a macro via a compiler flag that would contain the extension name, that users could then use. I named this TORCH_EXTENSION_NAME and it works very nicely.\nThe other changes are just fixes to the C++ extension tests.\n@zdevito @fmassa @apaszke", "body": "For C++ extensions, currently, the module name (defined via  `PYBIND11_MODULE`) must match the extension name (defined in `setup.py` or `torch.utils.cpp_extension.load`). This can cause problems when users mistype one of them.\r\n\r\nTo fix this, I first wrote a check that would look for the `PYBIND11_MODULE` declaration in any of the provided source files, and compare the module name declared there with the extension name. This scaled fine and would work. You can find this approach in the first commit of this PR.\r\n\r\nHowever, @zdevito then had a better idea of just defining a macro via a compiler flag that would contain the extension name, that users could then use. I named this `TORCH_EXTENSION_NAME` and it works very nicely.\r\n\r\nThe other changes are just fixes to the C++ extension tests.\r\n\r\n@zdevito @fmassa @apaszke "}