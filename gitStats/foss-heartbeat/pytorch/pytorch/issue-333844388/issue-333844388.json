{"url": "https://api.github.com/repos/pytorch/pytorch/issues/8666", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/8666/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/8666/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/8666/events", "html_url": "https://github.com/pytorch/pytorch/pull/8666", "id": 333844388, "node_id": "MDExOlB1bGxSZXF1ZXN0MTk1OTYyMjc3", "number": 8666, "title": "Some 0-sized dimension support, port catArray away from resizeLegacy.", "user": {"login": "gchanan", "id": 3768583, "node_id": "MDQ6VXNlcjM3Njg1ODM=", "avatar_url": "https://avatars2.githubusercontent.com/u/3768583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gchanan", "html_url": "https://github.com/gchanan", "followers_url": "https://api.github.com/users/gchanan/followers", "following_url": "https://api.github.com/users/gchanan/following{/other_user}", "gists_url": "https://api.github.com/users/gchanan/gists{/gist_id}", "starred_url": "https://api.github.com/users/gchanan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gchanan/subscriptions", "organizations_url": "https://api.github.com/users/gchanan/orgs", "repos_url": "https://api.github.com/users/gchanan/repos", "events_url": "https://api.github.com/users/gchanan/events{/privacy}", "received_events_url": "https://api.github.com/users/gchanan/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-06-19T21:23:55Z", "updated_at": "2018-11-23T15:45:52Z", "closed_at": "2018-06-20T17:26:09Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/8666", "html_url": "https://github.com/pytorch/pytorch/pull/8666", "diff_url": "https://github.com/pytorch/pytorch/pull/8666.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/8666.patch"}, "body_html": "<p>The goal of this PR is to port catArray away from resizeLegacy (so we can delete the legacy resize calls), but since catArray has some weird behavior because we don't have arbitrary 0-sized dimension support, I made some effort to fix these both in one pass.</p>\n<p>The major changes here are:</p>\n<ol>\n<li>catArray uses the new resize API, no longer the old resizeLegacy API.</li>\n<li>As 1) is the last usage of resizeLegacy, it is deleted.</li>\n<li>If compiled with USE_TH_SIZE_ZERO_DIM, catArray will work and properly check shapes for n-dimensional empty tensors.</li>\n<li>However, we retain the old behavior of \"ignoring\" size [0] tensors in catArray.  We previously allowed this because we didn't have n-dimensional empty tensors.</li>\n<li>To get the above to work, we also add support for n-dimensional empty tensors for narrow and slice (ifdef USE_TH_SIZE_ZERO_DIM).</li>\n<li>We change the stride formula for empty tensors to match NumPy; basically, we never multiply by 0 as the size, always at least 1, so the strides are monotonically increasing in the empty tensor case.</li>\n<li>We print the size of empty tensors if size != [0]; this matches NumPy behavior (even in cases where the size could be inferred from the brackets.  Example:</li>\n</ol>\n<pre><code>&gt;&gt;&gt; torch.randn(2,0,3, dtype=torch.float64)\ntensor([], size=(2, 0, 3), dtype=torch.float64)\n</code></pre>\n<ol start=\"8\">\n<li>For test purposes, we add torch._C._use_zero_size_dim() to add tests for the above.</li>\n</ol>", "body_text": "The goal of this PR is to port catArray away from resizeLegacy (so we can delete the legacy resize calls), but since catArray has some weird behavior because we don't have arbitrary 0-sized dimension support, I made some effort to fix these both in one pass.\nThe major changes here are:\n\ncatArray uses the new resize API, no longer the old resizeLegacy API.\nAs 1) is the last usage of resizeLegacy, it is deleted.\nIf compiled with USE_TH_SIZE_ZERO_DIM, catArray will work and properly check shapes for n-dimensional empty tensors.\nHowever, we retain the old behavior of \"ignoring\" size [0] tensors in catArray.  We previously allowed this because we didn't have n-dimensional empty tensors.\nTo get the above to work, we also add support for n-dimensional empty tensors for narrow and slice (ifdef USE_TH_SIZE_ZERO_DIM).\nWe change the stride formula for empty tensors to match NumPy; basically, we never multiply by 0 as the size, always at least 1, so the strides are monotonically increasing in the empty tensor case.\nWe print the size of empty tensors if size != [0]; this matches NumPy behavior (even in cases where the size could be inferred from the brackets.  Example:\n\n>>> torch.randn(2,0,3, dtype=torch.float64)\ntensor([], size=(2, 0, 3), dtype=torch.float64)\n\n\nFor test purposes, we add torch._C._use_zero_size_dim() to add tests for the above.", "body": "The goal of this PR is to port catArray away from resizeLegacy (so we can delete the legacy resize calls), but since catArray has some weird behavior because we don't have arbitrary 0-sized dimension support, I made some effort to fix these both in one pass.\r\n\r\nThe major changes here are:\r\n1) catArray uses the new resize API, no longer the old resizeLegacy API.\r\n2) As 1) is the last usage of resizeLegacy, it is deleted.\r\n3) If compiled with USE_TH_SIZE_ZERO_DIM, catArray will work and properly check shapes for n-dimensional empty tensors.\r\n4) However, we retain the old behavior of \"ignoring\" size [0] tensors in catArray.  We previously allowed this because we didn't have n-dimensional empty tensors.\r\n5) To get the above to work, we also add support for n-dimensional empty tensors for narrow and slice (ifdef USE_TH_SIZE_ZERO_DIM).\r\n6) We change the stride formula for empty tensors to match NumPy; basically, we never multiply by 0 as the size, always at least 1, so the strides are monotonically increasing in the empty tensor case.\r\n7) We print the size of empty tensors if size != [0]; this matches NumPy behavior (even in cases where the size could be inferred from the brackets.  Example:\r\n```\r\n>>> torch.randn(2,0,3, dtype=torch.float64)\r\ntensor([], size=(2, 0, 3), dtype=torch.float64)\r\n```\r\n8) For test purposes, we add torch._C._use_zero_size_dim() to add tests for the above.\r\n\r\n"}