{"url": "https://api.github.com/repos/pytorch/pytorch/issues/4584", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/4584/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/4584/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/4584/events", "html_url": "https://github.com/pytorch/pytorch/issues/4584", "id": 287551398, "node_id": "MDU6SXNzdWUyODc1NTEzOTg=", "number": 4584, "title": "ONNX export doesn't support InstanceNorm (needed by CycleGAN)", "user": {"login": "linkerzhang", "id": 5194557, "node_id": "MDQ6VXNlcjUxOTQ1NTc=", "avatar_url": "https://avatars2.githubusercontent.com/u/5194557?v=4", "gravatar_id": "", "url": "https://api.github.com/users/linkerzhang", "html_url": "https://github.com/linkerzhang", "followers_url": "https://api.github.com/users/linkerzhang/followers", "following_url": "https://api.github.com/users/linkerzhang/following{/other_user}", "gists_url": "https://api.github.com/users/linkerzhang/gists{/gist_id}", "starred_url": "https://api.github.com/users/linkerzhang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/linkerzhang/subscriptions", "organizations_url": "https://api.github.com/users/linkerzhang/orgs", "repos_url": "https://api.github.com/users/linkerzhang/repos", "events_url": "https://api.github.com/users/linkerzhang/events{/privacy}", "received_events_url": "https://api.github.com/users/linkerzhang/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 693805995, "node_id": "MDU6TGFiZWw2OTM4MDU5OTU=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/onnx", "name": "onnx", "color": "e99695", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "houseroad", "id": 30275821, "node_id": "MDQ6VXNlcjMwMjc1ODIx", "avatar_url": "https://avatars0.githubusercontent.com/u/30275821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/houseroad", "html_url": "https://github.com/houseroad", "followers_url": "https://api.github.com/users/houseroad/followers", "following_url": "https://api.github.com/users/houseroad/following{/other_user}", "gists_url": "https://api.github.com/users/houseroad/gists{/gist_id}", "starred_url": "https://api.github.com/users/houseroad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/houseroad/subscriptions", "organizations_url": "https://api.github.com/users/houseroad/orgs", "repos_url": "https://api.github.com/users/houseroad/repos", "events_url": "https://api.github.com/users/houseroad/events{/privacy}", "received_events_url": "https://api.github.com/users/houseroad/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "houseroad", "id": 30275821, "node_id": "MDQ6VXNlcjMwMjc1ODIx", "avatar_url": "https://avatars0.githubusercontent.com/u/30275821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/houseroad", "html_url": "https://github.com/houseroad", "followers_url": "https://api.github.com/users/houseroad/followers", "following_url": "https://api.github.com/users/houseroad/following{/other_user}", "gists_url": "https://api.github.com/users/houseroad/gists{/gist_id}", "starred_url": "https://api.github.com/users/houseroad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/houseroad/subscriptions", "organizations_url": "https://api.github.com/users/houseroad/orgs", "repos_url": "https://api.github.com/users/houseroad/repos", "events_url": "https://api.github.com/users/houseroad/events{/privacy}", "received_events_url": "https://api.github.com/users/houseroad/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2018-01-10T19:33:37Z", "updated_at": "2018-04-09T02:30:26Z", "closed_at": "2018-04-09T02:30:26Z", "author_association": "NONE", "body_html": "<p>Hi <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=30275821\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/houseroad\">@houseroad</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=13564\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ezyang\">@ezyang</a><br>\nThe pytorch model is, <a href=\"https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix\">https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix</a>.</p>\n<p>PyTorch version: 0.4.0a0+040336f (HEAD)<br>\nThe repro steps are,</p>\n<ol>\n<li>clone this model into local disk,<br>\ngit clone <a href=\"https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix\">https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix</a></li>\n<li>download pre-trained model (horse2zebra)<br>\nbash pretrained_models/download_cyclegan_model.sh horse2zebra</li>\n<li>download dataset<br>\nbash ./datasets/download_cyclegan_dataset.sh horse2zebra</li>\n<li>add onnx export codes in the end of test.py<br>\ninputs = Variable(torch.randn(1,3,256,256))<br>\ntorch.onnx.export(model.netG, inputs, \"latest_net_G.onnx\")</li>\n<li>create a temp folder for test running output.</li>\n<li>run the test.py<br>\npython test.py --dataroot datasets/horse2zebra/testA --checkpoints_dir ./checkpoints/ --name horse2zebra_pretrained --no_dropout --model test --dataset_mode single --loadSize 256 --results_dir ./temp --how_many 1</li>\n</ol>\n<p>The error message is,<br>\n/home/kezhan/anaconda3/lib/python3.6/site-packages/torch/onnx/<strong>init</strong>.py:317: UserWarning: ONNX export failed on Constant because torch.onnx.symbolic.Constant does not exist<br>\n.format(op_name, op_name))<br>\n/home/kezhan/anaconda3/lib/python3.6/site-packages/torch/onnx/symbolic.py:53: UserWarning: ONNX export failed on _convolution because non-zero output_padding not supported<br>\nwarnings.warn(\"ONNX export failed on \" + op + \" because \" + msg + \" not supported\")<br>\nTraceback (most recent call last):<br>\nFile \"test.py\", line 42, in <br>\ntorch.onnx.export(model.netG, inputs, \"latest_net_G.onnx\")<br>\nFile \"/home/kezhan/anaconda3/lib/python3.6/site-packages/torch/onnx/<strong>init</strong>.py\", line 83, in export<br>\n_export(model, args, f, export_params, verbose, training, input_names, output_names)<br>\nFile \"/home/kezhan/anaconda3/lib/python3.6/site-packages/torch/onnx/<strong>init</strong>.py\", line 150, in _export<br>\nproto = trace.export(list(_unique_state_dict(model).values()), _onnx_opset_version)<br>\nRuntimeError: ONNX export failed: Couldn't export undefined constant tensor (please file an issue)</p>\n<p>Thank you very much!</p>", "body_text": "Hi @houseroad @ezyang\nThe pytorch model is, https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix.\nPyTorch version: 0.4.0a0+040336f (HEAD)\nThe repro steps are,\n\nclone this model into local disk,\ngit clone https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix\ndownload pre-trained model (horse2zebra)\nbash pretrained_models/download_cyclegan_model.sh horse2zebra\ndownload dataset\nbash ./datasets/download_cyclegan_dataset.sh horse2zebra\nadd onnx export codes in the end of test.py\ninputs = Variable(torch.randn(1,3,256,256))\ntorch.onnx.export(model.netG, inputs, \"latest_net_G.onnx\")\ncreate a temp folder for test running output.\nrun the test.py\npython test.py --dataroot datasets/horse2zebra/testA --checkpoints_dir ./checkpoints/ --name horse2zebra_pretrained --no_dropout --model test --dataset_mode single --loadSize 256 --results_dir ./temp --how_many 1\n\nThe error message is,\n/home/kezhan/anaconda3/lib/python3.6/site-packages/torch/onnx/init.py:317: UserWarning: ONNX export failed on Constant because torch.onnx.symbolic.Constant does not exist\n.format(op_name, op_name))\n/home/kezhan/anaconda3/lib/python3.6/site-packages/torch/onnx/symbolic.py:53: UserWarning: ONNX export failed on _convolution because non-zero output_padding not supported\nwarnings.warn(\"ONNX export failed on \" + op + \" because \" + msg + \" not supported\")\nTraceback (most recent call last):\nFile \"test.py\", line 42, in \ntorch.onnx.export(model.netG, inputs, \"latest_net_G.onnx\")\nFile \"/home/kezhan/anaconda3/lib/python3.6/site-packages/torch/onnx/init.py\", line 83, in export\n_export(model, args, f, export_params, verbose, training, input_names, output_names)\nFile \"/home/kezhan/anaconda3/lib/python3.6/site-packages/torch/onnx/init.py\", line 150, in _export\nproto = trace.export(list(_unique_state_dict(model).values()), _onnx_opset_version)\nRuntimeError: ONNX export failed: Couldn't export undefined constant tensor (please file an issue)\nThank you very much!", "body": "Hi @houseroad @ezyang \r\nThe pytorch model is, https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix.\r\n\r\nPyTorch version: 0.4.0a0+040336f (HEAD)\r\nThe repro steps are,\r\n1. clone this model into local disk, \r\ngit clone https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix\r\n2. download pre-trained model (horse2zebra) \r\nbash pretrained_models/download_cyclegan_model.sh horse2zebra\r\n3. download dataset\r\nbash ./datasets/download_cyclegan_dataset.sh horse2zebra\r\n4. add onnx export codes in the end of test.py\r\ninputs = Variable(torch.randn(1,3,256,256))\r\ntorch.onnx.export(model.netG, inputs, \"latest_net_G.onnx\")\r\n5. create a temp folder for test running output.\r\n6. run the test.py\r\npython test.py --dataroot datasets/horse2zebra/testA --checkpoints_dir ./checkpoints/ --name horse2zebra_pretrained --no_dropout --model test --dataset_mode single --loadSize 256 --results_dir ./temp --how_many 1\r\n\r\nThe error message is,\r\n/home/kezhan/anaconda3/lib/python3.6/site-packages/torch/onnx/__init__.py:317: UserWarning: ONNX export failed on Constant because torch.onnx.symbolic.Constant does not exist\r\n  .format(op_name, op_name))\r\n/home/kezhan/anaconda3/lib/python3.6/site-packages/torch/onnx/symbolic.py:53: UserWarning: ONNX export failed on _convolution because non-zero output_padding not supported\r\n  warnings.warn(\"ONNX export failed on \" + op + \" because \" + msg + \" not supported\")\r\nTraceback (most recent call last):\r\n  File \"test.py\", line 42, in <module>\r\n    torch.onnx.export(model.netG, inputs, \"latest_net_G.onnx\")\r\n  File \"/home/kezhan/anaconda3/lib/python3.6/site-packages/torch/onnx/__init__.py\", line 83, in export\r\n    _export(model, args, f, export_params, verbose, training, input_names, output_names)\r\n  File \"/home/kezhan/anaconda3/lib/python3.6/site-packages/torch/onnx/__init__.py\", line 150, in _export\r\n    proto = trace.export(list(_unique_state_dict(model).values()), _onnx_opset_version)\r\nRuntimeError: ONNX export failed: Couldn't export undefined constant tensor (please file an issue)\r\n\r\nThank you very much!"}