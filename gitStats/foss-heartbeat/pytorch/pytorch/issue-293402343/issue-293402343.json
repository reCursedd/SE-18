{"url": "https://api.github.com/repos/pytorch/pytorch/issues/4983", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/4983/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/4983/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/4983/events", "html_url": "https://github.com/pytorch/pytorch/issues/4983", "id": 293402343, "node_id": "MDU6SXNzdWUyOTM0MDIzNDM=", "number": 4983, "title": "Matmul and Size error on Windows", "user": {"login": "peterjc123", "id": 9998726, "node_id": "MDQ6VXNlcjk5OTg3MjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/9998726?v=4", "gravatar_id": "", "url": "https://api.github.com/users/peterjc123", "html_url": "https://github.com/peterjc123", "followers_url": "https://api.github.com/users/peterjc123/followers", "following_url": "https://api.github.com/users/peterjc123/following{/other_user}", "gists_url": "https://api.github.com/users/peterjc123/gists{/gist_id}", "starred_url": "https://api.github.com/users/peterjc123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/peterjc123/subscriptions", "organizations_url": "https://api.github.com/users/peterjc123/orgs", "repos_url": "https://api.github.com/users/peterjc123/repos", "events_url": "https://api.github.com/users/peterjc123/events{/privacy}", "received_events_url": "https://api.github.com/users/peterjc123/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-02-01T04:45:53Z", "updated_at": "2018-02-02T04:57:44Z", "closed_at": "2018-02-02T04:57:44Z", "author_association": "CONTRIBUTOR", "body_html": "<ul>\n<li>OS: Windows</li>\n<li>PyTorch version: master</li>\n<li>How you installed PyTorch (conda, pip, source): source</li>\n<li>Python version: 3.6</li>\n<li>CUDA/cuDNN version: 9.0</li>\n<li>GPU models and configuration: 1070</li>\n<li>GCC version (if compiling from source): MSVC 15.1</li>\n</ul>\n<p>It seems that <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"292915468\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/4943\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/4943/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/4943\">#4943</a> breaks Windows build with the following error:</p>\n<div class=\"highlight highlight-text-python-traceback\"><pre>======================================================================\n<span class=\"pl-en\">ERROR</span>: <span class=\"pl-s\">test_broadcast_batched_matmul (__main__.TestTorch)</span>\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File <span class=\"pl-s\">\"test_torch.py\"</span>, line <span class=\"pl-c1\">1625</span>, in <span class=\"pl-en\">test_broadcast_batched_matmul</span>\n    <span class=\"pl-c1\">self</span>._test_broadcast_batched_matmul(<span class=\"pl-c1\">self</span>, <span class=\"pl-k\">lambda</span> <span class=\"pl-smi\">t</span>: t)\n  File <span class=\"pl-s\">\"test_torch.py\"</span>, line <span class=\"pl-c1\">1622</span>, in <span class=\"pl-en\">_test_broadcast_batched_matmul</span>\n    verify_batched_matmul(<span class=\"pl-k\">*</span>indices)\n  File <span class=\"pl-s\">\"test_torch.py\"</span>, line <span class=\"pl-c1\">1606</span>, in <span class=\"pl-en\">verify_batched_matmul</span>\n    truth <span class=\"pl-k\">=</span> maybe_squeeze_result(lhs_expanded, rhs_expanded, lhs_expanded_matmul_fn(rhs_expanded))\n  File <span class=\"pl-s\">\"C:\\Jenkins\\workspace\\pytorch-builds\\pytorch-win-ws2016-cuda9-cudnn7-py3-test\\test\\torch\\tensor.py\"</span>, line <span class=\"pl-c1\">196</span>, in <span class=\"pl-en\">matmul</span>\n    <span class=\"pl-k\">return</span> torch.matmul(<span class=\"pl-c1\">self</span>, other)\n  File <span class=\"pl-s\">\"C:\\Jenkins\\workspace\\pytorch-builds\\pytorch-win-ws2016-cuda9-cudnn7-py3-test\\test\\torch\\functional.py\"</span>, line <span class=\"pl-c1\">264</span>, in <span class=\"pl-en\">matmul</span>\n    expand_batch_portion <span class=\"pl-k\">=</span> torch._C._infer_size(tensor1_exp_size[:<span class=\"pl-k\">-</span><span class=\"pl-c1\">2</span>], tensor2_exp_size[:<span class=\"pl-k\">-</span><span class=\"pl-c1\">2</span>])\n<span class=\"pl-en\">RuntimeError</span>: <span class=\"pl-s\">expected a torch.Size as argument 1</span>\n\n======================================================================\n<span class=\"pl-en\">ERROR</span>: <span class=\"pl-s\">test_matmul_out (__main__.TestTorch)</span>\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File <span class=\"pl-s\">\"test_torch.py\"</span>, line <span class=\"pl-c1\">1642</span>, in <span class=\"pl-en\">test_matmul_out</span>\n    check_matmul((<span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">4</span>), (<span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">4</span>, <span class=\"pl-c1\">5</span>))\n  File <span class=\"pl-s\">\"test_torch.py\"</span>, line <span class=\"pl-c1\">1632</span>, in <span class=\"pl-en\">check_matmul</span>\n    expected <span class=\"pl-k\">=</span> torch.matmul(a, b)\n  File <span class=\"pl-s\">\"C:\\Jenkins\\workspace\\pytorch-builds\\pytorch-win-ws2016-cuda9-cudnn7-py3-test\\test\\torch\\functional.py\"</span>, line <span class=\"pl-c1\">264</span>, in <span class=\"pl-en\">matmul</span>\n    expand_batch_portion <span class=\"pl-k\">=</span> torch._C._infer_size(tensor1_exp_size[:<span class=\"pl-k\">-</span><span class=\"pl-c1\">2</span>], tensor2_exp_size[:<span class=\"pl-k\">-</span><span class=\"pl-c1\">2</span>])\n<span class=\"pl-en\">RuntimeError</span>: <span class=\"pl-s\">expected a torch.Size as argument 1</span>\n\n======================================================================\n<span class=\"pl-en\">FAIL</span>: <span class=\"pl-s\">test_Size (__main__.TestTorch)</span>\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File <span class=\"pl-s\">\"test_torch.py\"</span>, line <span class=\"pl-c1\">5293</span>, in <span class=\"pl-en\">test_Size</span>\n    <span class=\"pl-c1\">self</span>.assertIsInstance(x <span class=\"pl-k\">*</span> <span class=\"pl-c1\">2</span>, torch.Size)\n<span class=\"pl-en\">AssertionError</span>: <span class=\"pl-s\">(1, 2, 3, 1, 2, 3) is not an instance of &lt;class 'torch.Size'&gt;</span></pre></div>\n<p>It seems that multipling <code>torch.Size</code> with sth make it a tuple, not <code>torch.Size</code>.</p>", "body_text": "OS: Windows\nPyTorch version: master\nHow you installed PyTorch (conda, pip, source): source\nPython version: 3.6\nCUDA/cuDNN version: 9.0\nGPU models and configuration: 1070\nGCC version (if compiling from source): MSVC 15.1\n\nIt seems that #4943 breaks Windows build with the following error:\n======================================================================\nERROR: test_broadcast_batched_matmul (__main__.TestTorch)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"test_torch.py\", line 1625, in test_broadcast_batched_matmul\n    self._test_broadcast_batched_matmul(self, lambda t: t)\n  File \"test_torch.py\", line 1622, in _test_broadcast_batched_matmul\n    verify_batched_matmul(*indices)\n  File \"test_torch.py\", line 1606, in verify_batched_matmul\n    truth = maybe_squeeze_result(lhs_expanded, rhs_expanded, lhs_expanded_matmul_fn(rhs_expanded))\n  File \"C:\\Jenkins\\workspace\\pytorch-builds\\pytorch-win-ws2016-cuda9-cudnn7-py3-test\\test\\torch\\tensor.py\", line 196, in matmul\n    return torch.matmul(self, other)\n  File \"C:\\Jenkins\\workspace\\pytorch-builds\\pytorch-win-ws2016-cuda9-cudnn7-py3-test\\test\\torch\\functional.py\", line 264, in matmul\n    expand_batch_portion = torch._C._infer_size(tensor1_exp_size[:-2], tensor2_exp_size[:-2])\nRuntimeError: expected a torch.Size as argument 1\n\n======================================================================\nERROR: test_matmul_out (__main__.TestTorch)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"test_torch.py\", line 1642, in test_matmul_out\n    check_matmul((2, 3, 4), (2, 4, 5))\n  File \"test_torch.py\", line 1632, in check_matmul\n    expected = torch.matmul(a, b)\n  File \"C:\\Jenkins\\workspace\\pytorch-builds\\pytorch-win-ws2016-cuda9-cudnn7-py3-test\\test\\torch\\functional.py\", line 264, in matmul\n    expand_batch_portion = torch._C._infer_size(tensor1_exp_size[:-2], tensor2_exp_size[:-2])\nRuntimeError: expected a torch.Size as argument 1\n\n======================================================================\nFAIL: test_Size (__main__.TestTorch)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"test_torch.py\", line 5293, in test_Size\n    self.assertIsInstance(x * 2, torch.Size)\nAssertionError: (1, 2, 3, 1, 2, 3) is not an instance of <class 'torch.Size'>\nIt seems that multipling torch.Size with sth make it a tuple, not torch.Size.", "body": "- OS: Windows\r\n- PyTorch version: master\r\n- How you installed PyTorch (conda, pip, source): source\r\n- Python version: 3.6\r\n- CUDA/cuDNN version: 9.0\r\n- GPU models and configuration: 1070\r\n- GCC version (if compiling from source): MSVC 15.1\r\n\r\nIt seems that #4943 breaks Windows build with the following error:\r\n```pytb\r\n======================================================================\r\nERROR: test_broadcast_batched_matmul (__main__.TestTorch)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"test_torch.py\", line 1625, in test_broadcast_batched_matmul\r\n    self._test_broadcast_batched_matmul(self, lambda t: t)\r\n  File \"test_torch.py\", line 1622, in _test_broadcast_batched_matmul\r\n    verify_batched_matmul(*indices)\r\n  File \"test_torch.py\", line 1606, in verify_batched_matmul\r\n    truth = maybe_squeeze_result(lhs_expanded, rhs_expanded, lhs_expanded_matmul_fn(rhs_expanded))\r\n  File \"C:\\Jenkins\\workspace\\pytorch-builds\\pytorch-win-ws2016-cuda9-cudnn7-py3-test\\test\\torch\\tensor.py\", line 196, in matmul\r\n    return torch.matmul(self, other)\r\n  File \"C:\\Jenkins\\workspace\\pytorch-builds\\pytorch-win-ws2016-cuda9-cudnn7-py3-test\\test\\torch\\functional.py\", line 264, in matmul\r\n    expand_batch_portion = torch._C._infer_size(tensor1_exp_size[:-2], tensor2_exp_size[:-2])\r\nRuntimeError: expected a torch.Size as argument 1\r\n\r\n======================================================================\r\nERROR: test_matmul_out (__main__.TestTorch)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"test_torch.py\", line 1642, in test_matmul_out\r\n    check_matmul((2, 3, 4), (2, 4, 5))\r\n  File \"test_torch.py\", line 1632, in check_matmul\r\n    expected = torch.matmul(a, b)\r\n  File \"C:\\Jenkins\\workspace\\pytorch-builds\\pytorch-win-ws2016-cuda9-cudnn7-py3-test\\test\\torch\\functional.py\", line 264, in matmul\r\n    expand_batch_portion = torch._C._infer_size(tensor1_exp_size[:-2], tensor2_exp_size[:-2])\r\nRuntimeError: expected a torch.Size as argument 1\r\n\r\n======================================================================\r\nFAIL: test_Size (__main__.TestTorch)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"test_torch.py\", line 5293, in test_Size\r\n    self.assertIsInstance(x * 2, torch.Size)\r\nAssertionError: (1, 2, 3, 1, 2, 3) is not an instance of <class 'torch.Size'>\r\n```\r\n\r\nIt seems that multipling `torch.Size` with sth make it a tuple, not `torch.Size`."}