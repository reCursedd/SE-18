{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/350467042", "html_url": "https://github.com/pytorch/pytorch/pull/4096#issuecomment-350467042", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/4096", "id": 350467042, "node_id": "MDEyOklzc3VlQ29tbWVudDM1MDQ2NzA0Mg==", "user": {"login": "lantiga", "id": 191033, "node_id": "MDQ6VXNlcjE5MTAzMw==", "avatar_url": "https://avatars2.githubusercontent.com/u/191033?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lantiga", "html_url": "https://github.com/lantiga", "followers_url": "https://api.github.com/users/lantiga/followers", "following_url": "https://api.github.com/users/lantiga/following{/other_user}", "gists_url": "https://api.github.com/users/lantiga/gists{/gist_id}", "starred_url": "https://api.github.com/users/lantiga/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lantiga/subscriptions", "organizations_url": "https://api.github.com/users/lantiga/orgs", "repos_url": "https://api.github.com/users/lantiga/repos", "events_url": "https://api.github.com/users/lantiga/events{/privacy}", "received_events_url": "https://api.github.com/users/lantiga/received_events", "type": "User", "site_admin": false}, "created_at": "2017-12-09T13:36:39Z", "updated_at": "2017-12-09T13:36:39Z", "author_association": "COLLABORATOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=13564\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ezyang\">@ezyang</a> I think I may need your help with the errors showing up on <code>grid_sample</code> and <code>affine_grid</code> tests with <code>cudnn</code>. The CPU part of the test works.</p>\n<p>I believe it's related to the way grid sampler is now managed in <code>aten/src/ATen/cudnn</code> (<a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/pytorch/pytorch/commit/1c0fbd27/hovercard\" href=\"https://github.com/pytorch/pytorch/commit/1c0fbd27\"><tt>1c0fbd2</tt></a>).</p>\n<p>Do the following errors point anything obvious for you?</p>\n<pre><code>======================================================================\n01:23:06 ERROR: test_affine_grid (__main__.TestNN)\n01:23:06 ----------------------------------------------------------------------\n01:23:06 Traceback (most recent call last):\n01:23:06   File \"test_nn.py\", line 3158, in test_affine_grid\n01:23:06     out_cuda.backward(gradients.cuda())\n01:23:06   File \"/opt/conda/lib/python3.6/site-packages/torch/autograd/variable.py\", line 110, in backward\n01:23:06     torch.autograd.backward(self, gradient, retain_graph, create_graph, retain_variables)\n01:23:06   File \"/opt/conda/lib/python3.6/site-packages/torch/autograd/__init__.py\", line 98, in backward\n01:23:06     variables, grad_variables, retain_graph)\n01:23:06 RuntimeError: element 0 of variables does not require grad and does not have a grad_fn\n01:23:06 \n01:23:06 ======================================================================\n01:23:06 ERROR: test_grid_sample (__main__.TestNN)\n01:23:06 ----------------------------------------------------------------------\n01:23:06 Traceback (most recent call last):\n01:23:06   File \"test_nn.py\", line 3131, in test_grid_sample\n01:23:06     test_cpu_against_cuda(N, C, H, W, padding_mode)\n01:23:06   File \"test_nn.py\", line 3076, in test_cpu_against_cuda\n01:23:06     test_shape(N, C, H, W, H, W, padding_mode)\n01:23:06   File \"test_nn.py\", line 3055, in test_shape\n01:23:06     out_cuda = F.grid_sample(input_cuda, grid_cuda, padding_mode=padding_mode)\n01:23:06   File \"/opt/conda/lib/python3.6/site-packages/torch/nn/functional.py\", line 1529, in grid_sample\n01:23:06     return vision.grid_sampler(input, grid, padding_mode)\n01:23:06   File \"/opt/conda/lib/python3.6/site-packages/torch/nn/_functions/vision.py\", line 14, in grid_sampler\n01:23:06     return torch._C._VariableBase.cudnn_grid_sampler(input, grid)\n01:23:06 RuntimeError: VariableType::ID() not implemented\n</code></pre>", "body_text": "@ezyang I think I may need your help with the errors showing up on grid_sample and affine_grid tests with cudnn. The CPU part of the test works.\nI believe it's related to the way grid sampler is now managed in aten/src/ATen/cudnn (1c0fbd2).\nDo the following errors point anything obvious for you?\n======================================================================\n01:23:06 ERROR: test_affine_grid (__main__.TestNN)\n01:23:06 ----------------------------------------------------------------------\n01:23:06 Traceback (most recent call last):\n01:23:06   File \"test_nn.py\", line 3158, in test_affine_grid\n01:23:06     out_cuda.backward(gradients.cuda())\n01:23:06   File \"/opt/conda/lib/python3.6/site-packages/torch/autograd/variable.py\", line 110, in backward\n01:23:06     torch.autograd.backward(self, gradient, retain_graph, create_graph, retain_variables)\n01:23:06   File \"/opt/conda/lib/python3.6/site-packages/torch/autograd/__init__.py\", line 98, in backward\n01:23:06     variables, grad_variables, retain_graph)\n01:23:06 RuntimeError: element 0 of variables does not require grad and does not have a grad_fn\n01:23:06 \n01:23:06 ======================================================================\n01:23:06 ERROR: test_grid_sample (__main__.TestNN)\n01:23:06 ----------------------------------------------------------------------\n01:23:06 Traceback (most recent call last):\n01:23:06   File \"test_nn.py\", line 3131, in test_grid_sample\n01:23:06     test_cpu_against_cuda(N, C, H, W, padding_mode)\n01:23:06   File \"test_nn.py\", line 3076, in test_cpu_against_cuda\n01:23:06     test_shape(N, C, H, W, H, W, padding_mode)\n01:23:06   File \"test_nn.py\", line 3055, in test_shape\n01:23:06     out_cuda = F.grid_sample(input_cuda, grid_cuda, padding_mode=padding_mode)\n01:23:06   File \"/opt/conda/lib/python3.6/site-packages/torch/nn/functional.py\", line 1529, in grid_sample\n01:23:06     return vision.grid_sampler(input, grid, padding_mode)\n01:23:06   File \"/opt/conda/lib/python3.6/site-packages/torch/nn/_functions/vision.py\", line 14, in grid_sampler\n01:23:06     return torch._C._VariableBase.cudnn_grid_sampler(input, grid)\n01:23:06 RuntimeError: VariableType::ID() not implemented", "body": "@ezyang I think I may need your help with the errors showing up on `grid_sample` and `affine_grid` tests with `cudnn`. The CPU part of the test works.\r\n\r\nI believe it's related to the way grid sampler is now managed in `aten/src/ATen/cudnn` (https://github.com/pytorch/pytorch/commit/1c0fbd27).\r\n\r\nDo the following errors point anything obvious for you?\r\n\r\n```\r\n======================================================================\r\n01:23:06 ERROR: test_affine_grid (__main__.TestNN)\r\n01:23:06 ----------------------------------------------------------------------\r\n01:23:06 Traceback (most recent call last):\r\n01:23:06   File \"test_nn.py\", line 3158, in test_affine_grid\r\n01:23:06     out_cuda.backward(gradients.cuda())\r\n01:23:06   File \"/opt/conda/lib/python3.6/site-packages/torch/autograd/variable.py\", line 110, in backward\r\n01:23:06     torch.autograd.backward(self, gradient, retain_graph, create_graph, retain_variables)\r\n01:23:06   File \"/opt/conda/lib/python3.6/site-packages/torch/autograd/__init__.py\", line 98, in backward\r\n01:23:06     variables, grad_variables, retain_graph)\r\n01:23:06 RuntimeError: element 0 of variables does not require grad and does not have a grad_fn\r\n01:23:06 \r\n01:23:06 ======================================================================\r\n01:23:06 ERROR: test_grid_sample (__main__.TestNN)\r\n01:23:06 ----------------------------------------------------------------------\r\n01:23:06 Traceback (most recent call last):\r\n01:23:06   File \"test_nn.py\", line 3131, in test_grid_sample\r\n01:23:06     test_cpu_against_cuda(N, C, H, W, padding_mode)\r\n01:23:06   File \"test_nn.py\", line 3076, in test_cpu_against_cuda\r\n01:23:06     test_shape(N, C, H, W, H, W, padding_mode)\r\n01:23:06   File \"test_nn.py\", line 3055, in test_shape\r\n01:23:06     out_cuda = F.grid_sample(input_cuda, grid_cuda, padding_mode=padding_mode)\r\n01:23:06   File \"/opt/conda/lib/python3.6/site-packages/torch/nn/functional.py\", line 1529, in grid_sample\r\n01:23:06     return vision.grid_sampler(input, grid, padding_mode)\r\n01:23:06   File \"/opt/conda/lib/python3.6/site-packages/torch/nn/_functions/vision.py\", line 14, in grid_sampler\r\n01:23:06     return torch._C._VariableBase.cudnn_grid_sampler(input, grid)\r\n01:23:06 RuntimeError: VariableType::ID() not implemented\r\n```"}