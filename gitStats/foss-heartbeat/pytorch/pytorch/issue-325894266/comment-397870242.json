{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/397870242", "html_url": "https://github.com/pytorch/pytorch/issues/7800#issuecomment-397870242", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/7800", "id": 397870242, "node_id": "MDEyOklzc3VlQ29tbWVudDM5Nzg3MDI0Mg==", "user": {"login": "c-hofer", "id": 28672615, "node_id": "MDQ6VXNlcjI4NjcyNjE1", "avatar_url": "https://avatars2.githubusercontent.com/u/28672615?v=4", "gravatar_id": "", "url": "https://api.github.com/users/c-hofer", "html_url": "https://github.com/c-hofer", "followers_url": "https://api.github.com/users/c-hofer/followers", "following_url": "https://api.github.com/users/c-hofer/following{/other_user}", "gists_url": "https://api.github.com/users/c-hofer/gists{/gist_id}", "starred_url": "https://api.github.com/users/c-hofer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/c-hofer/subscriptions", "organizations_url": "https://api.github.com/users/c-hofer/orgs", "repos_url": "https://api.github.com/users/c-hofer/repos", "events_url": "https://api.github.com/users/c-hofer/events{/privacy}", "received_events_url": "https://api.github.com/users/c-hofer/received_events", "type": "User", "site_admin": false}, "created_at": "2018-06-17T10:47:28Z", "updated_at": "2018-06-17T18:19:48Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=13564\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ezyang\">@ezyang</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=9845\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/pietern\">@pietern</a> ... i've studied the source now a little and as u pointed out messing around with THCState seems the solution. However, how do I get the right THCState in my hands?</p>\n<p>I think it should something like the following from what I learned so far :</p>\n<pre><code>#include &lt;torch/torch.h&gt;\n\nusing namespace at;\n\nTensor foo(Tensor t)\n{\n  auto state = globalContext().getTHCState();\n //do something like changing stream and manipulating t ...\n\n  return t\n}\n</code></pre>\n<p>Is this the right way to do this?<br>\nBy the way, if u have any hints to code parts where i can learn how to manage streams using<br>\nthe TH/ATen api this would be great and save me a lot of time ;)<br>\n(Basically i would like to do stuff like the pytorch.cuda.stream context managers but directly in my C++ code without using the low-level cuda api, since i'am afraid to mess with the ATen context)</p>\n<p>thanks so far :) cheers</p>", "body_text": "@ezyang @pietern ... i've studied the source now a little and as u pointed out messing around with THCState seems the solution. However, how do I get the right THCState in my hands?\nI think it should something like the following from what I learned so far :\n#include <torch/torch.h>\n\nusing namespace at;\n\nTensor foo(Tensor t)\n{\n  auto state = globalContext().getTHCState();\n //do something like changing stream and manipulating t ...\n\n  return t\n}\n\nIs this the right way to do this?\nBy the way, if u have any hints to code parts where i can learn how to manage streams using\nthe TH/ATen api this would be great and save me a lot of time ;)\n(Basically i would like to do stuff like the pytorch.cuda.stream context managers but directly in my C++ code without using the low-level cuda api, since i'am afraid to mess with the ATen context)\nthanks so far :) cheers", "body": "@ezyang @pietern ... i've studied the source now a little and as u pointed out messing around with THCState seems the solution. However, how do I get the right THCState in my hands? \r\n\r\nI think it should something like the following from what I learned so far :\r\n\r\n```\r\n#include <torch/torch.h>\r\n\r\nusing namespace at;\r\n\r\nTensor foo(Tensor t)\r\n{\r\n  auto state = globalContext().getTHCState();\r\n //do something like changing stream and manipulating t ...\r\n\r\n  return t\r\n}\r\n```\r\n\r\n\r\nIs this the right way to do this? \r\nBy the way, if u have any hints to code parts where i can learn how to manage streams using\r\nthe TH/ATen api this would be great and save me a lot of time ;) \r\n(Basically i would like to do stuff like the pytorch.cuda.stream context managers but directly in my C++ code without using the low-level cuda api, since i'am afraid to mess with the ATen context)\r\n\r\nthanks so far :) cheers  "}