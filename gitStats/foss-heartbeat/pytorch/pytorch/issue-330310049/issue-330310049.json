{"url": "https://api.github.com/repos/pytorch/pytorch/issues/8240", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/8240/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/8240/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/8240/events", "html_url": "https://github.com/pytorch/pytorch/issues/8240", "id": 330310049, "node_id": "MDU6SXNzdWUzMzAzMTAwNDk=", "number": 8240, "title": "cuda runtime error (77) : an illegal memory access at pytorch\\aten\\src\\thcunn\\generic/SpatialClassNLLCriterion.cu", "user": {"login": "adizhol", "id": 13086455, "node_id": "MDQ6VXNlcjEzMDg2NDU1", "avatar_url": "https://avatars1.githubusercontent.com/u/13086455?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adizhol", "html_url": "https://github.com/adizhol", "followers_url": "https://api.github.com/users/adizhol/followers", "following_url": "https://api.github.com/users/adizhol/following{/other_user}", "gists_url": "https://api.github.com/users/adizhol/gists{/gist_id}", "starred_url": "https://api.github.com/users/adizhol/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adizhol/subscriptions", "organizations_url": "https://api.github.com/users/adizhol/orgs", "repos_url": "https://api.github.com/users/adizhol/repos", "events_url": "https://api.github.com/users/adizhol/events{/privacy}", "received_events_url": "https://api.github.com/users/adizhol/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-06-07T14:54:59Z", "updated_at": "2018-06-07T15:09:41Z", "closed_at": "2018-06-07T15:09:29Z", "author_association": "NONE", "body_html": "<h2>Issue description</h2>\n<p>with CUDA_LAUNCH_BLOCKING=1<br>\nI get the following stack trace on the <strong>second</strong> iteration:</p>\n<blockquote>\n<p>File \"C:\\Users\\owner\\AppData\\Local\\Programs\\Python\\Python35\\lib\\site-packages\\torch\\nn\\functional.py\", line 1334, in nll_loss<br>\nreturn torch._C._nn.nll_loss2d(input, target, weight, size_average, ignore_index, reduce)<br>\nRuntimeError: cuda runtime error (77) : an illegal memory access was encountered at c:\\users\\administrator\\downloads\\new-builder\\win-wheel\\pytorch\\aten\\src\\thcunn\\generic/SpatialClassNLLCriterion.cu:131</p>\n</blockquote>\n<p>This code is using CrossEntropyLoss, but another code that uses BCEWithLogits doen't throw any exceptions.</p>\n<h2>Code example</h2>\n<pre><code>model = model.cuda(GPU_ID)\noptimizer = optim.Adam(model.parameters(), lr=config_segment.LEARN_RATE, weight_decay=config_segment.WEIGHT_DECAY)\nexp_lr_scheduler = lr_scheduler.StepLR(optimizer, step_size=config_segment.LEARN_RATE_STEP_PPERIOD, gamma=0.1)\ncriterion = torch.nn.CrossEntropyLoss(ignore_index=labels.IGNORE)\n\n for (images, masks) in (train_loader):\n        it += 1\n        model.train()  # train mode.\n        images = images.cuda(GPU_ID)\n        masks = masks.cuda(GPU_ID)\n        train_loss = 0\n        optimizer.zero_grad()\n        exp_lr_scheduler.step()\n        x = model(images)\n        # compute loss\n        loss = criterion(x, masks) # Exception thrown here\n        loss.backward()\n        optimizer.step()\n</code></pre>\n<h2>System Info</h2>\n<p>PyTorch version: 0.4.0<br>\nIs debug build: No<br>\nCUDA used to build PyTorch: 8.0</p>\n<p>OS: Microsoft Windows 10 Pro<br>\nGCC version: Could not collect<br>\nCMake version: version 3.10.0-rc4</p>\n<p>Python version: 3.5<br>\nIs CUDA available: Yes<br>\nCUDA runtime version: 8.0.60<br>\nGPU models and configuration: Could not collect # GTX 1080 Ti<br>\nNvidia driver version: Could not collect<br>\ncuDNN version: Could not collect # 6.0</p>\n<p>Versions of relevant libraries:<br>\n[pip] Could not collect<br>\n[conda] Could not collect</p>", "body_text": "Issue description\nwith CUDA_LAUNCH_BLOCKING=1\nI get the following stack trace on the second iteration:\n\nFile \"C:\\Users\\owner\\AppData\\Local\\Programs\\Python\\Python35\\lib\\site-packages\\torch\\nn\\functional.py\", line 1334, in nll_loss\nreturn torch._C._nn.nll_loss2d(input, target, weight, size_average, ignore_index, reduce)\nRuntimeError: cuda runtime error (77) : an illegal memory access was encountered at c:\\users\\administrator\\downloads\\new-builder\\win-wheel\\pytorch\\aten\\src\\thcunn\\generic/SpatialClassNLLCriterion.cu:131\n\nThis code is using CrossEntropyLoss, but another code that uses BCEWithLogits doen't throw any exceptions.\nCode example\nmodel = model.cuda(GPU_ID)\noptimizer = optim.Adam(model.parameters(), lr=config_segment.LEARN_RATE, weight_decay=config_segment.WEIGHT_DECAY)\nexp_lr_scheduler = lr_scheduler.StepLR(optimizer, step_size=config_segment.LEARN_RATE_STEP_PPERIOD, gamma=0.1)\ncriterion = torch.nn.CrossEntropyLoss(ignore_index=labels.IGNORE)\n\n for (images, masks) in (train_loader):\n        it += 1\n        model.train()  # train mode.\n        images = images.cuda(GPU_ID)\n        masks = masks.cuda(GPU_ID)\n        train_loss = 0\n        optimizer.zero_grad()\n        exp_lr_scheduler.step()\n        x = model(images)\n        # compute loss\n        loss = criterion(x, masks) # Exception thrown here\n        loss.backward()\n        optimizer.step()\n\nSystem Info\nPyTorch version: 0.4.0\nIs debug build: No\nCUDA used to build PyTorch: 8.0\nOS: Microsoft Windows 10 Pro\nGCC version: Could not collect\nCMake version: version 3.10.0-rc4\nPython version: 3.5\nIs CUDA available: Yes\nCUDA runtime version: 8.0.60\nGPU models and configuration: Could not collect # GTX 1080 Ti\nNvidia driver version: Could not collect\ncuDNN version: Could not collect # 6.0\nVersions of relevant libraries:\n[pip] Could not collect\n[conda] Could not collect", "body": "## Issue description\r\n\r\nwith CUDA_LAUNCH_BLOCKING=1\r\nI get the following stack trace on the **second** iteration:\r\n\r\n> File \"C:\\Users\\owner\\AppData\\Local\\Programs\\Python\\Python35\\lib\\site-packages\\torch\\nn\\functional.py\", line 1334, in nll_loss\r\n> return torch._C._nn.nll_loss2d(input, target, weight, size_average, ignore_index, reduce)\r\n> RuntimeError: cuda runtime error (77) : an illegal memory access was encountered at c:\\users\\administrator\\downloads\\new-builder\\win-wheel\\pytorch\\aten\\src\\thcunn\\generic/SpatialClassNLLCriterion.cu:131\r\n> \r\n\r\nThis code is using CrossEntropyLoss, but another code that uses BCEWithLogits doen't throw any exceptions.\r\n\r\n## Code example\r\n\r\n    model = model.cuda(GPU_ID)\r\n    optimizer = optim.Adam(model.parameters(), lr=config_segment.LEARN_RATE, weight_decay=config_segment.WEIGHT_DECAY)\r\n    exp_lr_scheduler = lr_scheduler.StepLR(optimizer, step_size=config_segment.LEARN_RATE_STEP_PPERIOD, gamma=0.1)\r\n    criterion = torch.nn.CrossEntropyLoss(ignore_index=labels.IGNORE)\r\n\r\n     for (images, masks) in (train_loader):\r\n            it += 1\r\n            model.train()  # train mode.\r\n            images = images.cuda(GPU_ID)\r\n            masks = masks.cuda(GPU_ID)\r\n            train_loss = 0\r\n            optimizer.zero_grad()\r\n            exp_lr_scheduler.step()\r\n            x = model(images)\r\n            # compute loss\r\n            loss = criterion(x, masks) # Exception thrown here\r\n            loss.backward()\r\n            optimizer.step()\r\n\r\n## System Info\r\nPyTorch version: 0.4.0\r\nIs debug build: No\r\nCUDA used to build PyTorch: 8.0\r\n\r\nOS: Microsoft Windows 10 Pro\r\nGCC version: Could not collect\r\nCMake version: version 3.10.0-rc4\r\n\r\nPython version: 3.5\r\nIs CUDA available: Yes\r\nCUDA runtime version: 8.0.60\r\nGPU models and configuration: Could not collect # GTX 1080 Ti\r\nNvidia driver version: Could not collect\r\ncuDNN version: Could not collect # 6.0\r\n\r\nVersions of relevant libraries:\r\n[pip] Could not collect\r\n[conda] Could not collect\r\n\r\n"}