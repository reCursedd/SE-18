{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/425446462", "html_url": "https://github.com/pytorch/pytorch/issues/12161#issuecomment-425446462", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/12161", "id": 425446462, "node_id": "MDEyOklzc3VlQ29tbWVudDQyNTQ0NjQ2Mg==", "user": {"login": "peterjc123", "id": 9998726, "node_id": "MDQ6VXNlcjk5OTg3MjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/9998726?v=4", "gravatar_id": "", "url": "https://api.github.com/users/peterjc123", "html_url": "https://github.com/peterjc123", "followers_url": "https://api.github.com/users/peterjc123/followers", "following_url": "https://api.github.com/users/peterjc123/following{/other_user}", "gists_url": "https://api.github.com/users/peterjc123/gists{/gist_id}", "starred_url": "https://api.github.com/users/peterjc123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/peterjc123/subscriptions", "organizations_url": "https://api.github.com/users/peterjc123/orgs", "repos_url": "https://api.github.com/users/peterjc123/repos", "events_url": "https://api.github.com/users/peterjc123/events{/privacy}", "received_events_url": "https://api.github.com/users/peterjc123/received_events", "type": "User", "site_admin": false}, "created_at": "2018-09-28T14:05:39Z", "updated_at": "2018-09-28T14:12:53Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=43432586\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ygwangmsra\">@ygwangmsra</a> Would you please try adding the following piece of code near line 616 in <code>aten\\src\\aten\\native\\cpu\\gridsamplerkernel.cpp</code>.</p>\n<div class=\"highlight highlight-source-c++\"><pre>    <span class=\"pl-k\">auto</span> x_nearest = x.round();\n    <span class=\"pl-k\">auto</span> y_nearest = y.round();\n\n<span class=\"pl-c\"><span class=\"pl-c\">//</span> CODE START</span>\n\n    <span class=\"pl-k\">static</span> <span class=\"pl-k\">constexpr</span> <span class=\"pl-k\">int</span> size = Vec256&lt;<span class=\"pl-c1\">scalar_t</span>&gt;::size;\n    <span class=\"pl-c1\">scalar_t</span> src_arr[size];\n    x_nearest.store(<span class=\"pl-k\">static_cast</span>&lt;<span class=\"pl-k\">void</span>*&gt;(src_arr));\n    <span class=\"pl-c1\">int_same_size_t</span>&lt;<span class=\"pl-c1\">scalar_t</span>&gt; buffer[size];\n    <span class=\"pl-k\">for</span> (<span class=\"pl-c1\">int64_t</span> i = <span class=\"pl-c1\">0</span>; i &lt; size; i++) {\n      buffer[i] = <span class=\"pl-k\">static_cast</span>&lt;<span class=\"pl-c1\">int_same_size_t</span>&lt;<span class=\"pl-c1\">scalar_t</span>&gt;&gt;(src_arr[i]);\n    }\n\n    <span class=\"pl-k\">auto</span> result = Vec256&lt;<span class=\"pl-c1\">int_same_size_t</span>&lt;<span class=\"pl-c1\">scalar_t</span>&gt;&gt;::loadu(<span class=\"pl-k\">static_cast</span>&lt;<span class=\"pl-k\">void</span>*&gt;(buffer));\n\n<span class=\"pl-c\"><span class=\"pl-c\">//</span> CODE END</span>\n\n    <span class=\"pl-k\">auto</span> i_x_nearest = convert_to_int_of_same_size(x_nearest);\n    <span class=\"pl-k\">auto</span> i_y_nearest = convert_to_int_of_same_size(y_nearest);</pre></div>", "body_text": "@ygwangmsra Would you please try adding the following piece of code near line 616 in aten\\src\\aten\\native\\cpu\\gridsamplerkernel.cpp.\n    auto x_nearest = x.round();\n    auto y_nearest = y.round();\n\n// CODE START\n\n    static constexpr int size = Vec256<scalar_t>::size;\n    scalar_t src_arr[size];\n    x_nearest.store(static_cast<void*>(src_arr));\n    int_same_size_t<scalar_t> buffer[size];\n    for (int64_t i = 0; i < size; i++) {\n      buffer[i] = static_cast<int_same_size_t<scalar_t>>(src_arr[i]);\n    }\n\n    auto result = Vec256<int_same_size_t<scalar_t>>::loadu(static_cast<void*>(buffer));\n\n// CODE END\n\n    auto i_x_nearest = convert_to_int_of_same_size(x_nearest);\n    auto i_y_nearest = convert_to_int_of_same_size(y_nearest);", "body": "@ygwangmsra Would you please try adding the following piece of code near line 616 in `aten\\src\\aten\\native\\cpu\\gridsamplerkernel.cpp`.\r\n```cpp\r\n    auto x_nearest = x.round();\r\n    auto y_nearest = y.round();\r\n\r\n// CODE START\r\n\r\n    static constexpr int size = Vec256<scalar_t>::size;\r\n    scalar_t src_arr[size];\r\n    x_nearest.store(static_cast<void*>(src_arr));\r\n    int_same_size_t<scalar_t> buffer[size];\r\n    for (int64_t i = 0; i < size; i++) {\r\n      buffer[i] = static_cast<int_same_size_t<scalar_t>>(src_arr[i]);\r\n    }\r\n\r\n    auto result = Vec256<int_same_size_t<scalar_t>>::loadu(static_cast<void*>(buffer));\r\n\r\n// CODE END\r\n\r\n    auto i_x_nearest = convert_to_int_of_same_size(x_nearest);\r\n    auto i_y_nearest = convert_to_int_of_same_size(y_nearest);\r\n```"}