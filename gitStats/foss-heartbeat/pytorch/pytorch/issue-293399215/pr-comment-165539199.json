{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/165539199", "pull_request_review_id": 93497562, "id": 165539199, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2NTUzOTE5OQ==", "diff_hunk": "@@ -184,6 +185,22 @@ Operation createEvalOperation(CppOp * op) {\n }\n \n using tensor_list = std::vector<at::Tensor>;\n+\n+tensor_list unsafeToTensorListShare(const list_of_retainable & inputs) {\n+  tensor_list tinputs;\n+  tinputs.reserve(inputs.size());\n+  for(auto & i : inputs) {\n+    tinputs.push_back(unsafeToTensorShare(i));\n+  }\n+  return tinputs;", "path": "torch/csrc/jit/interpreter.cpp", "position": 19, "original_position": 19, "commit_id": "50f1371ab9d4af3f9ffba960951d8178b326d11c", "original_commit_id": "b84e313451e285323db29add20e1602d1e51aab8", "user": {"login": "zdevito", "id": 370202, "node_id": "MDQ6VXNlcjM3MDIwMg==", "avatar_url": "https://avatars0.githubusercontent.com/u/370202?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zdevito", "html_url": "https://github.com/zdevito", "followers_url": "https://api.github.com/users/zdevito/followers", "following_url": "https://api.github.com/users/zdevito/following{/other_user}", "gists_url": "https://api.github.com/users/zdevito/gists{/gist_id}", "starred_url": "https://api.github.com/users/zdevito/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zdevito/subscriptions", "organizations_url": "https://api.github.com/users/zdevito/orgs", "repos_url": "https://api.github.com/users/zdevito/repos", "events_url": "https://api.github.com/users/zdevito/events{/privacy}", "received_events_url": "https://api.github.com/users/zdevito/received_events", "type": "User", "site_admin": false}, "body": "I very frequently get these errors trying to use `fmap`, like in this case for this particular line. I don't feel confortable forcing other to maintain this code if the error messages for modifying it wrong are this bad.\r\n\r\n```\r\ngcc -pthread -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/usr/local/cuda/include -I/data/users/zdevito/pytorch -I/data/users/zdevito/pytorch/torch/csrc -I/data/users/zdevito/pytorch/torch/lib/pybind11/include -I/data/users/zdevito/pytorch/torch/lib/tmp_install/include -I/data/users/zdevito/pytorch/torch/lib/tmp_install/include/TH -I/data/users/zdevito/pytorch/torch/lib/tmp_install/include/THNN -I/data/users/zdevito/pytorch/torch/lib/tmp_install/include/ATen -I/home/zdevito/local/anaconda2/lib/python2.7/site-packages/numpy/core/include -I/data/users/zdevito/pytorch/torch/lib/tmp_install/include/THD -I/usr/local/cuda/include -I/data/users/zdevito/pytorch/torch/lib/tmp_install/include/THCUNN -I/home/zdevito/local/anaconda2/include/python2.7 -c torch/csrc/jit/interpreter.cpp -o build/temp.linux-x86_64-2.7/torch/csrc/jit/interpreter.o -D_THP_CORE -std=c++11 -Wno-write-strings -fno-strict-aliasing -Wno-missing-braces -DWITH_NUMPY -DWITH_DISTRIBUTED -DWITH_CUDA -DCUDA_LIB_PATH=/usr/local/cuda/lib64 -DWITH_NCCL -DWITH_CUDNN -MMD -MF build/temp.linux-x86_64-2.7/torch/csrc/jit/interpreter.d\r\ntorch/csrc/jit/interpreter.cpp: In function \u2018torch::jit::tensor_list torch::jit::unsafeToTensorListShare(const list_of_retainable&)\u2019:\r\ntorch/csrc/jit/interpreter.cpp:196:42: error: no matching function for call to \u2018fmap(const list_of_retainable&, at::Tensor (&)(at::Retainable*))\u2019\r\n   return fmap(inputs, unsafeToTensorShare);\r\n                                          ^\r\ntorch/csrc/jit/interpreter.cpp:196:42: note: candidates are:\r\nIn file included from /data/users/zdevito/pytorch/torch/csrc/jit/tracer.h:6:0,\r\n                 from /data/users/zdevito/pytorch/torch/csrc/autograd/function.h:15,\r\n                 from /data/users/zdevito/pytorch/torch/csrc/jit/generated/aten_dispatch.h:2,\r\n                 from torch/csrc/jit/interpreter.cpp:5:\r\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:13:23: note: template<class F, class T, class R> std::vector<R> torch::fmap(at::ArrayRef<TBase>, const F&)\r\n inline std::vector<R> fmap(at::ArrayRef<T> inputs, const F& fn) {\r\n                       ^\r\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:13:23: note:   template argument deduction/substitution failed:\r\ntorch/csrc/jit/interpreter.cpp:196:42: note:   \u2018std::vector<at::Retainable*>\u2019 is not derived from \u2018at::ArrayRef<TBase>\u2019\r\n   return fmap(inputs, unsafeToTensorShare);\r\n                                          ^\r\nIn file included from /data/users/zdevito/pytorch/torch/csrc/jit/tracer.h:6:0,\r\n                 from /data/users/zdevito/pytorch/torch/csrc/autograd/function.h:15,\r\n                 from /data/users/zdevito/pytorch/torch/csrc/jit/generated/aten_dispatch.h:2,\r\n                 from torch/csrc/jit/interpreter.cpp:5:\r\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:22:23: note: template<class F, class T, class R> std::vector<R> torch::fmap(const std::vector<T>&, const F&)\r\n inline std::vector<R> fmap(const std::vector<T>& inputs, const F& fn) {\r\n                       ^\r\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:22:23: note:   template argument deduction/substitution failed:\r\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:21:34: error: function returning a function\r\n template<typename F, typename T, typename R = typename std::result_of<F(T)>::type>\r\n                                  ^\r\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:27:23: note: template<class R, class T> std::vector<_RealType> torch::fmap(at::ArrayRef<TBase>)\r\n inline std::vector<R> fmap(at::ArrayRef<T> inputs) {\r\n                       ^\r\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:27:23: note:   template argument deduction/substitution failed:\r\ntorch/csrc/jit/interpreter.cpp:196:42: note:   \u2018std::vector<at::Retainable*>\u2019 is not derived from \u2018at::ArrayRef<TBase>\u2019\r\n   return fmap(inputs, unsafeToTensorShare);\r\n                                          ^\r\nIn file included from /data/users/zdevito/pytorch/torch/csrc/jit/tracer.h:6:0,\r\n                 from /data/users/zdevito/pytorch/torch/csrc/autograd/function.h:15,\r\n                 from /data/users/zdevito/pytorch/torch/csrc/jit/generated/aten_dispatch.h:2,\r\n                 from torch/csrc/jit/interpreter.cpp:5:\r\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:37:23: note: template<class R, class T> std::vector<_RealType> torch::fmap(const std::vector<T>&)\r\n inline std::vector<R> fmap(const std::vector<T>& inputs) {\r\n                       ^\r\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:37:23: note:   template argument deduction/substitution failed:\r\ntorch/csrc/jit/interpreter.cpp:196:42: note:   candidate expects 1 argument, 2 provided\r\n   return fmap(inputs, unsafeToTensorShare);\r\n                                          ^\r\ntorch/csrc/jit/interpreter.cpp:197:1: warning: control reaches end of non-void function [-Wreturn-type]\r\n }\r\n ^\r\n[3/3] gcc -pthread -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/usr/local/cuda/include -I/data/users/zdevito/pytorch -I/data/users/zdevito...MPY -DWITH_DISTRIBUTED -DWITH_CUDA -DCUDA_LIB_PATH=/usr/local/cuda/lib64 -DWITH_NCCL -DWITH_CUDNN -MMD -MF build/temp.linux-x86_64-2.7/torch/csrc/jit/test_jit.d\r\nninja: build stopped: subcommand failed.\r\nCommand '['/home/zdevito/local/anaconda2/lib/python2.7/site-packages/ninja/data/bin/ninja', '-f', 'build/build.torch._C.ninja']' returned non-zero exit status 1\r\ntotal build time: 0:00:08.229944, total build time today: 0:03:03.907742\r\n```", "created_at": "2018-02-02T01:38:51Z", "updated_at": "2018-11-23T15:38:57Z", "html_url": "https://github.com/pytorch/pytorch/pull/4982#discussion_r165539199", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/4982", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/165539199"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/4982#discussion_r165539199"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/4982"}}, "body_html": "<p>I very frequently get these errors trying to use <code>fmap</code>, like in this case for this particular line. I don't feel confortable forcing other to maintain this code if the error messages for modifying it wrong are this bad.</p>\n<pre><code>gcc -pthread -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/usr/local/cuda/include -I/data/users/zdevito/pytorch -I/data/users/zdevito/pytorch/torch/csrc -I/data/users/zdevito/pytorch/torch/lib/pybind11/include -I/data/users/zdevito/pytorch/torch/lib/tmp_install/include -I/data/users/zdevito/pytorch/torch/lib/tmp_install/include/TH -I/data/users/zdevito/pytorch/torch/lib/tmp_install/include/THNN -I/data/users/zdevito/pytorch/torch/lib/tmp_install/include/ATen -I/home/zdevito/local/anaconda2/lib/python2.7/site-packages/numpy/core/include -I/data/users/zdevito/pytorch/torch/lib/tmp_install/include/THD -I/usr/local/cuda/include -I/data/users/zdevito/pytorch/torch/lib/tmp_install/include/THCUNN -I/home/zdevito/local/anaconda2/include/python2.7 -c torch/csrc/jit/interpreter.cpp -o build/temp.linux-x86_64-2.7/torch/csrc/jit/interpreter.o -D_THP_CORE -std=c++11 -Wno-write-strings -fno-strict-aliasing -Wno-missing-braces -DWITH_NUMPY -DWITH_DISTRIBUTED -DWITH_CUDA -DCUDA_LIB_PATH=/usr/local/cuda/lib64 -DWITH_NCCL -DWITH_CUDNN -MMD -MF build/temp.linux-x86_64-2.7/torch/csrc/jit/interpreter.d\ntorch/csrc/jit/interpreter.cpp: In function \u2018torch::jit::tensor_list torch::jit::unsafeToTensorListShare(const list_of_retainable&amp;)\u2019:\ntorch/csrc/jit/interpreter.cpp:196:42: error: no matching function for call to \u2018fmap(const list_of_retainable&amp;, at::Tensor (&amp;)(at::Retainable*))\u2019\n   return fmap(inputs, unsafeToTensorShare);\n                                          ^\ntorch/csrc/jit/interpreter.cpp:196:42: note: candidates are:\nIn file included from /data/users/zdevito/pytorch/torch/csrc/jit/tracer.h:6:0,\n                 from /data/users/zdevito/pytorch/torch/csrc/autograd/function.h:15,\n                 from /data/users/zdevito/pytorch/torch/csrc/jit/generated/aten_dispatch.h:2,\n                 from torch/csrc/jit/interpreter.cpp:5:\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:13:23: note: template&lt;class F, class T, class R&gt; std::vector&lt;R&gt; torch::fmap(at::ArrayRef&lt;TBase&gt;, const F&amp;)\n inline std::vector&lt;R&gt; fmap(at::ArrayRef&lt;T&gt; inputs, const F&amp; fn) {\n                       ^\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:13:23: note:   template argument deduction/substitution failed:\ntorch/csrc/jit/interpreter.cpp:196:42: note:   \u2018std::vector&lt;at::Retainable*&gt;\u2019 is not derived from \u2018at::ArrayRef&lt;TBase&gt;\u2019\n   return fmap(inputs, unsafeToTensorShare);\n                                          ^\nIn file included from /data/users/zdevito/pytorch/torch/csrc/jit/tracer.h:6:0,\n                 from /data/users/zdevito/pytorch/torch/csrc/autograd/function.h:15,\n                 from /data/users/zdevito/pytorch/torch/csrc/jit/generated/aten_dispatch.h:2,\n                 from torch/csrc/jit/interpreter.cpp:5:\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:22:23: note: template&lt;class F, class T, class R&gt; std::vector&lt;R&gt; torch::fmap(const std::vector&lt;T&gt;&amp;, const F&amp;)\n inline std::vector&lt;R&gt; fmap(const std::vector&lt;T&gt;&amp; inputs, const F&amp; fn) {\n                       ^\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:22:23: note:   template argument deduction/substitution failed:\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:21:34: error: function returning a function\n template&lt;typename F, typename T, typename R = typename std::result_of&lt;F(T)&gt;::type&gt;\n                                  ^\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:27:23: note: template&lt;class R, class T&gt; std::vector&lt;_RealType&gt; torch::fmap(at::ArrayRef&lt;TBase&gt;)\n inline std::vector&lt;R&gt; fmap(at::ArrayRef&lt;T&gt; inputs) {\n                       ^\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:27:23: note:   template argument deduction/substitution failed:\ntorch/csrc/jit/interpreter.cpp:196:42: note:   \u2018std::vector&lt;at::Retainable*&gt;\u2019 is not derived from \u2018at::ArrayRef&lt;TBase&gt;\u2019\n   return fmap(inputs, unsafeToTensorShare);\n                                          ^\nIn file included from /data/users/zdevito/pytorch/torch/csrc/jit/tracer.h:6:0,\n                 from /data/users/zdevito/pytorch/torch/csrc/autograd/function.h:15,\n                 from /data/users/zdevito/pytorch/torch/csrc/jit/generated/aten_dispatch.h:2,\n                 from torch/csrc/jit/interpreter.cpp:5:\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:37:23: note: template&lt;class R, class T&gt; std::vector&lt;_RealType&gt; torch::fmap(const std::vector&lt;T&gt;&amp;)\n inline std::vector&lt;R&gt; fmap(const std::vector&lt;T&gt;&amp; inputs) {\n                       ^\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:37:23: note:   template argument deduction/substitution failed:\ntorch/csrc/jit/interpreter.cpp:196:42: note:   candidate expects 1 argument, 2 provided\n   return fmap(inputs, unsafeToTensorShare);\n                                          ^\ntorch/csrc/jit/interpreter.cpp:197:1: warning: control reaches end of non-void function [-Wreturn-type]\n }\n ^\n[3/3] gcc -pthread -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/usr/local/cuda/include -I/data/users/zdevito/pytorch -I/data/users/zdevito...MPY -DWITH_DISTRIBUTED -DWITH_CUDA -DCUDA_LIB_PATH=/usr/local/cuda/lib64 -DWITH_NCCL -DWITH_CUDNN -MMD -MF build/temp.linux-x86_64-2.7/torch/csrc/jit/test_jit.d\nninja: build stopped: subcommand failed.\nCommand '['/home/zdevito/local/anaconda2/lib/python2.7/site-packages/ninja/data/bin/ninja', '-f', 'build/build.torch._C.ninja']' returned non-zero exit status 1\ntotal build time: 0:00:08.229944, total build time today: 0:03:03.907742\n</code></pre>", "body_text": "I very frequently get these errors trying to use fmap, like in this case for this particular line. I don't feel confortable forcing other to maintain this code if the error messages for modifying it wrong are this bad.\ngcc -pthread -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/usr/local/cuda/include -I/data/users/zdevito/pytorch -I/data/users/zdevito/pytorch/torch/csrc -I/data/users/zdevito/pytorch/torch/lib/pybind11/include -I/data/users/zdevito/pytorch/torch/lib/tmp_install/include -I/data/users/zdevito/pytorch/torch/lib/tmp_install/include/TH -I/data/users/zdevito/pytorch/torch/lib/tmp_install/include/THNN -I/data/users/zdevito/pytorch/torch/lib/tmp_install/include/ATen -I/home/zdevito/local/anaconda2/lib/python2.7/site-packages/numpy/core/include -I/data/users/zdevito/pytorch/torch/lib/tmp_install/include/THD -I/usr/local/cuda/include -I/data/users/zdevito/pytorch/torch/lib/tmp_install/include/THCUNN -I/home/zdevito/local/anaconda2/include/python2.7 -c torch/csrc/jit/interpreter.cpp -o build/temp.linux-x86_64-2.7/torch/csrc/jit/interpreter.o -D_THP_CORE -std=c++11 -Wno-write-strings -fno-strict-aliasing -Wno-missing-braces -DWITH_NUMPY -DWITH_DISTRIBUTED -DWITH_CUDA -DCUDA_LIB_PATH=/usr/local/cuda/lib64 -DWITH_NCCL -DWITH_CUDNN -MMD -MF build/temp.linux-x86_64-2.7/torch/csrc/jit/interpreter.d\ntorch/csrc/jit/interpreter.cpp: In function \u2018torch::jit::tensor_list torch::jit::unsafeToTensorListShare(const list_of_retainable&)\u2019:\ntorch/csrc/jit/interpreter.cpp:196:42: error: no matching function for call to \u2018fmap(const list_of_retainable&, at::Tensor (&)(at::Retainable*))\u2019\n   return fmap(inputs, unsafeToTensorShare);\n                                          ^\ntorch/csrc/jit/interpreter.cpp:196:42: note: candidates are:\nIn file included from /data/users/zdevito/pytorch/torch/csrc/jit/tracer.h:6:0,\n                 from /data/users/zdevito/pytorch/torch/csrc/autograd/function.h:15,\n                 from /data/users/zdevito/pytorch/torch/csrc/jit/generated/aten_dispatch.h:2,\n                 from torch/csrc/jit/interpreter.cpp:5:\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:13:23: note: template<class F, class T, class R> std::vector<R> torch::fmap(at::ArrayRef<TBase>, const F&)\n inline std::vector<R> fmap(at::ArrayRef<T> inputs, const F& fn) {\n                       ^\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:13:23: note:   template argument deduction/substitution failed:\ntorch/csrc/jit/interpreter.cpp:196:42: note:   \u2018std::vector<at::Retainable*>\u2019 is not derived from \u2018at::ArrayRef<TBase>\u2019\n   return fmap(inputs, unsafeToTensorShare);\n                                          ^\nIn file included from /data/users/zdevito/pytorch/torch/csrc/jit/tracer.h:6:0,\n                 from /data/users/zdevito/pytorch/torch/csrc/autograd/function.h:15,\n                 from /data/users/zdevito/pytorch/torch/csrc/jit/generated/aten_dispatch.h:2,\n                 from torch/csrc/jit/interpreter.cpp:5:\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:22:23: note: template<class F, class T, class R> std::vector<R> torch::fmap(const std::vector<T>&, const F&)\n inline std::vector<R> fmap(const std::vector<T>& inputs, const F& fn) {\n                       ^\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:22:23: note:   template argument deduction/substitution failed:\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:21:34: error: function returning a function\n template<typename F, typename T, typename R = typename std::result_of<F(T)>::type>\n                                  ^\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:27:23: note: template<class R, class T> std::vector<_RealType> torch::fmap(at::ArrayRef<TBase>)\n inline std::vector<R> fmap(at::ArrayRef<T> inputs) {\n                       ^\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:27:23: note:   template argument deduction/substitution failed:\ntorch/csrc/jit/interpreter.cpp:196:42: note:   \u2018std::vector<at::Retainable*>\u2019 is not derived from \u2018at::ArrayRef<TBase>\u2019\n   return fmap(inputs, unsafeToTensorShare);\n                                          ^\nIn file included from /data/users/zdevito/pytorch/torch/csrc/jit/tracer.h:6:0,\n                 from /data/users/zdevito/pytorch/torch/csrc/autograd/function.h:15,\n                 from /data/users/zdevito/pytorch/torch/csrc/jit/generated/aten_dispatch.h:2,\n                 from torch/csrc/jit/interpreter.cpp:5:\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:37:23: note: template<class R, class T> std::vector<_RealType> torch::fmap(const std::vector<T>&)\n inline std::vector<R> fmap(const std::vector<T>& inputs) {\n                       ^\n/data/users/zdevito/pytorch/torch/csrc/utils/functional.h:37:23: note:   template argument deduction/substitution failed:\ntorch/csrc/jit/interpreter.cpp:196:42: note:   candidate expects 1 argument, 2 provided\n   return fmap(inputs, unsafeToTensorShare);\n                                          ^\ntorch/csrc/jit/interpreter.cpp:197:1: warning: control reaches end of non-void function [-Wreturn-type]\n }\n ^\n[3/3] gcc -pthread -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/usr/local/cuda/include -I/data/users/zdevito/pytorch -I/data/users/zdevito...MPY -DWITH_DISTRIBUTED -DWITH_CUDA -DCUDA_LIB_PATH=/usr/local/cuda/lib64 -DWITH_NCCL -DWITH_CUDNN -MMD -MF build/temp.linux-x86_64-2.7/torch/csrc/jit/test_jit.d\nninja: build stopped: subcommand failed.\nCommand '['/home/zdevito/local/anaconda2/lib/python2.7/site-packages/ninja/data/bin/ninja', '-f', 'build/build.torch._C.ninja']' returned non-zero exit status 1\ntotal build time: 0:00:08.229944, total build time today: 0:03:03.907742", "in_reply_to_id": 165444769}