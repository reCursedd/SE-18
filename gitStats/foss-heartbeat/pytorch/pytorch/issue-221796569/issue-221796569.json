{"url": "https://api.github.com/repos/pytorch/pytorch/issues/1262", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/1262/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/1262/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/1262/events", "html_url": "https://github.com/pytorch/pytorch/issues/1262", "id": 221796569, "node_id": "MDU6SXNzdWUyMjE3OTY1Njk=", "number": 1262, "title": " Serialization error when loading pretrained network, \u201ctarfile.ReadError: invalid header\u201d", "user": {"login": "mmderakhshani", "id": 16706043, "node_id": "MDQ6VXNlcjE2NzA2MDQz", "avatar_url": "https://avatars0.githubusercontent.com/u/16706043?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mmderakhshani", "html_url": "https://github.com/mmderakhshani", "followers_url": "https://api.github.com/users/mmderakhshani/followers", "following_url": "https://api.github.com/users/mmderakhshani/following{/other_user}", "gists_url": "https://api.github.com/users/mmderakhshani/gists{/gist_id}", "starred_url": "https://api.github.com/users/mmderakhshani/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mmderakhshani/subscriptions", "organizations_url": "https://api.github.com/users/mmderakhshani/orgs", "repos_url": "https://api.github.com/users/mmderakhshani/repos", "events_url": "https://api.github.com/users/mmderakhshani/events{/privacy}", "received_events_url": "https://api.github.com/users/mmderakhshani/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-04-14T11:59:17Z", "updated_at": "2017-04-14T12:39:44Z", "closed_at": "2017-04-14T12:04:52Z", "author_association": "NONE", "body_html": "<p>Hi.<br>\nI have got a question. I have trained a deep neural network on GPU, and then finally moved my GPU mode deep network to the CPU mode. Further more, after saving CPU mode network with torch.save(net.state_dict(), 'final.pth') and moving to another system and loading with net.load_state_dict(torch.load('./final.pth')) and running it, I have encountered with below error. Could you please help me what is the problem of my code?</p>\n<blockquote>\n<pre><code>Traceback (most recent call last):\nFile \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 185, in nti\nn = int(s.strip() or \"0\", 8)\nValueError: invalid literal for int() with base 8: 'ons\\nOrde'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\nFile \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 2287, in next\ntarinfo = self.tarinfo.fromtarfile(self)\nFile \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 1086, in fromtarfile\nobj = cls.frombuf(buf, tarfile.encoding, tarfile.errors)\nFile \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 1028, in frombuf\nchksum = nti(buf[148:156])\nFile \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 187, in nti\nraise InvalidHeaderError(\"invalid header\")\ntarfile.InvalidHeaderError: invalid header\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\nFile \"TestCode.py\", line 357, in\nnet.load_state_dict(torch.load('./final.pth'))\nFile \"/home/mohammad/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 248, in load\nreturn load(f, maplocation, pickle_module)\nFile \"/home/mohammad/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 314, in _load\nwith closing(tarfile.open(fileobj=f, mode='r:', format=tarfile.PAX_FORMAT)) as tar, \\\nFile \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 1582, in open\nreturn func(name, filemode, fileobj, **kwargs)\nFile \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 1612, in taropen\nreturn cls(name, mode, fileobj, **kwargs)\nFile \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 1475, in init\nself.firstmember = self.next()\nFile \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 2299, in next\nraise ReadError(str(e))\ntarfile.ReadError: invalid header\n</code></pre>\n</blockquote>\n<p>I have to say that my server's pytorch version is <code>0.1.11</code> and my own system is <code>0.1.8</code>. Is this the source of error?<br>\n<strong>Issue 1:</strong><br>\nI have tried above code on our server. It is actually fine and without error. These errors were started to generate when I reinstalled pytorch.</p>\n<p><strong>Issue 2:</strong><br>\nThe saved format before reinstallation of pytorch on our server was <code>.tar</code> but after reinstallation it has changed to <code>Binary</code>. Moreover, I should say that all of the conversions are done on server!</p>", "body_text": "Hi.\nI have got a question. I have trained a deep neural network on GPU, and then finally moved my GPU mode deep network to the CPU mode. Further more, after saving CPU mode network with torch.save(net.state_dict(), 'final.pth') and moving to another system and loading with net.load_state_dict(torch.load('./final.pth')) and running it, I have encountered with below error. Could you please help me what is the problem of my code?\n\nTraceback (most recent call last):\nFile \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 185, in nti\nn = int(s.strip() or \"0\", 8)\nValueError: invalid literal for int() with base 8: 'ons\\nOrde'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\nFile \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 2287, in next\ntarinfo = self.tarinfo.fromtarfile(self)\nFile \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 1086, in fromtarfile\nobj = cls.frombuf(buf, tarfile.encoding, tarfile.errors)\nFile \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 1028, in frombuf\nchksum = nti(buf[148:156])\nFile \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 187, in nti\nraise InvalidHeaderError(\"invalid header\")\ntarfile.InvalidHeaderError: invalid header\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\nFile \"TestCode.py\", line 357, in\nnet.load_state_dict(torch.load('./final.pth'))\nFile \"/home/mohammad/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 248, in load\nreturn load(f, maplocation, pickle_module)\nFile \"/home/mohammad/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 314, in _load\nwith closing(tarfile.open(fileobj=f, mode='r:', format=tarfile.PAX_FORMAT)) as tar, \\\nFile \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 1582, in open\nreturn func(name, filemode, fileobj, **kwargs)\nFile \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 1612, in taropen\nreturn cls(name, mode, fileobj, **kwargs)\nFile \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 1475, in init\nself.firstmember = self.next()\nFile \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 2299, in next\nraise ReadError(str(e))\ntarfile.ReadError: invalid header\n\n\nI have to say that my server's pytorch version is 0.1.11 and my own system is 0.1.8. Is this the source of error?\nIssue 1:\nI have tried above code on our server. It is actually fine and without error. These errors were started to generate when I reinstalled pytorch.\nIssue 2:\nThe saved format before reinstallation of pytorch on our server was .tar but after reinstallation it has changed to Binary. Moreover, I should say that all of the conversions are done on server!", "body": "Hi.\r\nI have got a question. I have trained a deep neural network on GPU, and then finally moved my GPU mode deep network to the CPU mode. Further more, after saving CPU mode network with torch.save(net.state_dict(), 'final.pth') and moving to another system and loading with net.load_state_dict(torch.load('./final.pth')) and running it, I have encountered with below error. Could you please help me what is the problem of my code?\r\n\r\n\r\n\r\n>     Traceback (most recent call last):\r\n>     File \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 185, in nti\r\n>     n = int(s.strip() or \"0\", 8)\r\n>     ValueError: invalid literal for int() with base 8: 'ons\\nOrde'\r\n> \r\n>     During handling of the above exception, another exception occurred:\r\n> \r\n>     Traceback (most recent call last):\r\n>     File \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 2287, in next\r\n>     tarinfo = self.tarinfo.fromtarfile(self)\r\n>     File \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 1086, in fromtarfile\r\n>     obj = cls.frombuf(buf, tarfile.encoding, tarfile.errors)\r\n>     File \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 1028, in frombuf\r\n>     chksum = nti(buf[148:156])\r\n>     File \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 187, in nti\r\n>     raise InvalidHeaderError(\"invalid header\")\r\n>     tarfile.InvalidHeaderError: invalid header\r\n> \r\n>     During handling of the above exception, another exception occurred:\r\n> \r\n>     Traceback (most recent call last):\r\n>     File \"TestCode.py\", line 357, in\r\n>     net.load_state_dict(torch.load('./final.pth'))\r\n>     File \"/home/mohammad/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 248, in load\r\n>     return load(f, maplocation, pickle_module)\r\n>     File \"/home/mohammad/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 314, in _load\r\n>     with closing(tarfile.open(fileobj=f, mode='r:', format=tarfile.PAX_FORMAT)) as tar, \\\r\n>     File \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 1582, in open\r\n>     return func(name, filemode, fileobj, **kwargs)\r\n>     File \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 1612, in taropen\r\n>     return cls(name, mode, fileobj, **kwargs)\r\n>     File \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 1475, in init\r\n>     self.firstmember = self.next()\r\n>     File \"/home/mohammad/anaconda3/lib/python3.6/tarfile.py\", line 2299, in next\r\n>     raise ReadError(str(e))\r\n>     tarfile.ReadError: invalid header\r\nI have to say that my server's pytorch version is `0.1.11` and my own system is `0.1.8`. Is this the source of error?\r\n**Issue 1:**\r\nI have tried above code on our server. It is actually fine and without error. These errors were started to generate when I reinstalled pytorch.\r\n\r\n**Issue 2:**\r\nThe saved format before reinstallation of pytorch on our server was `.tar` but after reinstallation it has changed to `Binary`. Moreover, I should say that all of the conversions are done on server!"}