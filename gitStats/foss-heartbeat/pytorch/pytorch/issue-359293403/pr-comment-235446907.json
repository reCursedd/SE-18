{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/235446907", "pull_request_review_id": 177314553, "id": 235446907, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNTQ0NjkwNw==", "diff_hunk": "@@ -14,8 +14,18 @@ clang --version\n # symbolize=1: Gives us much better errors when things go wrong\n export ASAN_OPTIONS=detect_leaks=0:symbolize=1\n \n+# FIXME: Remove the hardcoded \"-pthread\" option.\n+# With asan build, the cmake thread CMAKE_HAVE_LIBC_CREATE[1] checking will\n+# succeed because \"pthread_create\" is in libasan.so. However, libasan doesn't\n+# have the full pthread implementation. Other advanced pthread functions doesn't\n+# exist in libasan.so[2]. If we need some pthread advanced functions, we still\n+# need to link the pthread library.\n+# [1] https://github.com/Kitware/CMake/blob/8cabaaf054a16ea9c8332ce8e9291bd026b38c62/Modules/FindThreads.cmake#L135\n+# [2] https://wiki.gentoo.org/wiki/AddressSanitizer/Problems\n+#\n # TODO: Make the ASAN flags a more unified env var\n CC=\"clang\" CXX=\"clang++\" LDSHARED=\"clang --shared\" \\\n-  CFLAGS=\"-fsanitize=address -fsanitize=undefined -fno-sanitize-recover=all -shared-libasan\" \\\n+  CFLAGS=\"-fsanitize=address -fsanitize=undefined -fno-sanitize-recover=all -shared-libasan -pthread\" \\\n+  CXX_FLAGS=\"-pthread\" \\", "path": ".jenkins/pytorch/build-asan.sh", "position": 17, "original_position": 17, "commit_id": "9a4d8be2a8cf801f0bd718de7d5fe516dc29f833", "original_commit_id": "9a4d8be2a8cf801f0bd718de7d5fe516dc29f833", "user": {"login": "orionr", "id": 79994, "node_id": "MDQ6VXNlcjc5OTk0", "avatar_url": "https://avatars3.githubusercontent.com/u/79994?v=4", "gravatar_id": "", "url": "https://api.github.com/users/orionr", "html_url": "https://github.com/orionr", "followers_url": "https://api.github.com/users/orionr/followers", "following_url": "https://api.github.com/users/orionr/following{/other_user}", "gists_url": "https://api.github.com/users/orionr/gists{/gist_id}", "starred_url": "https://api.github.com/users/orionr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/orionr/subscriptions", "organizations_url": "https://api.github.com/users/orionr/orgs", "repos_url": "https://api.github.com/users/orionr/repos", "events_url": "https://api.github.com/users/orionr/events{/privacy}", "received_events_url": "https://api.github.com/users/orionr/received_events", "type": "User", "site_admin": false}, "body": "If this is just an ASAN issue, I'm okay with this.", "created_at": "2018-11-21T16:02:53Z", "updated_at": "2018-11-23T15:55:19Z", "html_url": "https://github.com/pytorch/pytorch/pull/11563#discussion_r235446907", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/11563", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/235446907"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/11563#discussion_r235446907"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/11563"}}, "body_html": "<p>If this is just an ASAN issue, I'm okay with this.</p>", "body_text": "If this is just an ASAN issue, I'm okay with this."}