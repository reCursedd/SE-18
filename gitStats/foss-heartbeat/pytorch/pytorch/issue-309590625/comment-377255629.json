{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/377255629", "html_url": "https://github.com/pytorch/pytorch/pull/6096#issuecomment-377255629", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/6096", "id": 377255629, "node_id": "MDEyOklzc3VlQ29tbWVudDM3NzI1NTYyOQ==", "user": {"login": "peterjc123", "id": 9998726, "node_id": "MDQ6VXNlcjk5OTg3MjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/9998726?v=4", "gravatar_id": "", "url": "https://api.github.com/users/peterjc123", "html_url": "https://github.com/peterjc123", "followers_url": "https://api.github.com/users/peterjc123/followers", "following_url": "https://api.github.com/users/peterjc123/following{/other_user}", "gists_url": "https://api.github.com/users/peterjc123/gists{/gist_id}", "starred_url": "https://api.github.com/users/peterjc123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/peterjc123/subscriptions", "organizations_url": "https://api.github.com/users/peterjc123/orgs", "repos_url": "https://api.github.com/users/peterjc123/repos", "events_url": "https://api.github.com/users/peterjc123/events{/privacy}", "received_events_url": "https://api.github.com/users/peterjc123/received_events", "type": "User", "site_admin": false}, "created_at": "2018-03-29T14:36:32Z", "updated_at": "2018-03-29T14:50:55Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4063635\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/yf225\">@yf225</a> Now I suspect it's <code>spawn</code> that caused this. Because the import part of <code>test_dataloader.py</code> is not protected by <code>if __name__ == '__main__':</code>, the <code>TEST_CUDNN</code> or <code>THCMalloc</code> in <code>common_nn</code> will be executed multiple times at the same time, which may be the cause of this issue.<br>\nP.S. It seems the memory usage has extremely decreased when the protection is on. You can change it into the following style: <a href=\"https://gist.github.com/peterjc123/293cd4b699570f5f59860697f8b1fb19\">link</a>. And I suspect the bottleneck one is the same with this.</p>", "body_text": "@yf225 Now I suspect it's spawn that caused this. Because the import part of test_dataloader.py is not protected by if __name__ == '__main__':, the TEST_CUDNN or THCMalloc in common_nn will be executed multiple times at the same time, which may be the cause of this issue.\nP.S. It seems the memory usage has extremely decreased when the protection is on. You can change it into the following style: link. And I suspect the bottleneck one is the same with this.", "body": "@yf225 Now I suspect it's `spawn` that caused this. Because the import part of `test_dataloader.py` is not protected by `if __name__ == '__main__':`, the `TEST_CUDNN` or `THCMalloc` in `common_nn` will be executed multiple times at the same time, which may be the cause of this issue.\r\nP.S. It seems the memory usage has extremely decreased when the protection is on. You can change it into the following style: [link](https://gist.github.com/peterjc123/293cd4b699570f5f59860697f8b1fb19). And I suspect the bottleneck one is the same with this."}