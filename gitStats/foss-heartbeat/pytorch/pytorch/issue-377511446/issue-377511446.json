{"url": "https://api.github.com/repos/pytorch/pytorch/issues/13578", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/13578/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/13578/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/13578/events", "html_url": "https://github.com/pytorch/pytorch/issues/13578", "id": 377511446, "node_id": "MDU6SXNzdWUzNzc1MTE0NDY=", "number": 13578, "title": "NCCL Integretion: No NCCL is built in when USE_NCCL:ON", "user": {"login": "forhonourlx", "id": 16576219, "node_id": "MDQ6VXNlcjE2NTc2MjE5", "avatar_url": "https://avatars3.githubusercontent.com/u/16576219?v=4", "gravatar_id": "", "url": "https://api.github.com/users/forhonourlx", "html_url": "https://github.com/forhonourlx", "followers_url": "https://api.github.com/users/forhonourlx/followers", "following_url": "https://api.github.com/users/forhonourlx/following{/other_user}", "gists_url": "https://api.github.com/users/forhonourlx/gists{/gist_id}", "starred_url": "https://api.github.com/users/forhonourlx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/forhonourlx/subscriptions", "organizations_url": "https://api.github.com/users/forhonourlx/orgs", "repos_url": "https://api.github.com/users/forhonourlx/repos", "events_url": "https://api.github.com/users/forhonourlx/events{/privacy}", "received_events_url": "https://api.github.com/users/forhonourlx/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 553773019, "node_id": "MDU6TGFiZWw1NTM3NzMwMTk=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/needs-reproduction", "name": "needs-reproduction", "color": "e99695", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-11-05T17:48:45Z", "updated_at": "2018-11-07T23:44:56Z", "closed_at": "2018-11-07T23:44:56Z", "author_association": "NONE", "body_html": "<h2><g-emoji class=\"g-emoji\" alias=\"bug\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f41b.png\">\ud83d\udc1b</g-emoji> Bug</h2>\n<p>Last time when I am using \u2018python setup.py install\u2019, I was told that either NCCL 2+ is needed.<br>\nSo I git clone nccl with the branch v2.3.7-1, which says lacking CMakeLists.txt.<br>\nInstead I the following at last build, but still NCCL is built in.<br>\nCould somebody give a helping hand, thanks indeed.</p>\n<h2>Environment</h2>\n<ul>\n<li>PyTorch Version (e.g., 1.0): 1.0rc1</li>\n<li>OS (e.g., Linux): Ubuntu18.04.1</li>\n<li>How you installed PyTorch (<code>conda</code>, <code>pip</code>, source): source</li>\n<li>Build command you used (if compiling from source): python setup.py install</li>\n<li>Python version: 3.6.7</li>\n<li>CUDA/cuDNN version: CUDA10, Cudnn7.3.1</li>\n<li>GPU models and configuration: GTX1080</li>\n<li>Any other relevant information:</li>\n</ul>\n<h2>Additional context</h2>\n<p>##Old CMakeLists.txt:<br>\nCMAKE_MINIMUM_REQUIRED(VERSION 2.8 FATAL_ERROR)<br>\nCMAKE_POLICY(VERSION 2.8)</p>\n<p>IF(NOT CUDA_FOUND)<br>\nFIND_PACKAGE(CUDA 7.0 REQUIRED)<br>\nENDIF()</p>\n<p>include(\"${CMAKE_UTILS_PATH}\")<br>\ntorch_cuda_get_nvcc_gencode_flag(NVCC_GENCODE)<br>\nstring(REPLACE \u201c-gencode;\u201d \u201c-gencode=\u201d NVCC_GENCODE \u201c${NVCC_GENCODE}\u201d)<br>\nmessage(STATUS \u201cSet NVCC_GENCODE for building NCCL: ${NVCC_GENCODE}\u201d)</p>\n<p>ADD_CUSTOM_COMMAND(<br>\nWORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}<br>\nOUTPUT ${CMAKE_CURRENT_BINARY_DIR}/lib/libnccl.so<br>\nCOMMAND env CUDA_HOME=${CUDA_TOOLKIT_ROOT_DIR} NVCC=${CUDA_NVCC_EXECUTABLE} BUILDDIR=${CMAKE_CURRENT_BINARY_DIR} NVCC_GENCODE=\"${NVCC_GENCODE}\" make -j${NUM_JOBS}<br>\n)</p>\n<p>ADD_CUSTOM_TARGET(nccl ALL DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/lib/libnccl.so)</p>\n<p>INSTALL(FILES ${CMAKE_CURRENT_BINARY_DIR}/include/nccl.h DESTINATION \u201cinclude\u201d)</p>\n<p>##Following are the building outputs related to NCCL:</p>\n<p>Building wheel torch-1.0.0a0<br>\n\u2013 Set NVCC_GENCODE for building NCCL: -gencode=arch=compute_30,code=sm_30;-gencode=arch=compute_35,code=sm_35;-gencode=arch=compute_50,code=sm_50;-gencode=arch=compute_52,code=sm_52;-gencode=arch=compute_60,code=sm_60;-gencode=arch=compute_61,code=sm_61;-gencode=arch=compute_70,code=sm_70;-gencode=arch=compute_70,code=compute_70<br>\n\u2013 Build files have been written to: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/third_party/build/nccl<br>\n[100%] Built target nccl<br>\n\u2013 Found NCCL: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include<br>\n\u2013 Determining NCCL version from the header file: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include/nccl.h<br>\n\u2013 Found NCCL (include: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include, library: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/libnccl.so)<br>\n\u2013 Include NCCL operators<br>\n\u2013 USE_NCCL : ON<br>\n\u2013 USE_SYSTEM_NCCL : OFF<br>\n[ 77%] Building CXX object caffe2/CMakeFiles/caffe2_gpu.dir/contrib/nccl/cuda_nccl_gpu.cc.o<br>\n[ 77%] Building CXX object caffe2/CMakeFiles/caffe2_gpu.dir/contrib/nccl/cuda_nccl_op_gpu.cc.o<br>\n\u2013 Installing: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/python3.6/site-packages/caffe2/contrib/nccl/init.py<br>\n\u2013 Installing: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/python3.6/site-packages/caffe2/contrib/nccl/nccl_ops_test.py<br>\n\u2013 Determining NCCL version from the header file: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include/nccl.h<br>\n\u2013 Found NCCL (include: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include, library: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/libnccl.so)<br>\n\u2013 NCCL_LIBRARIES: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/libnccl.so<br>\n\u2013 NCCL_INCLUDE_DIRS: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include<br>\n\u2013 Found NCCL, but the NCCL version is either not 2+ or not determinable, will not compile with NCCL distributed backend<br>\n\u2013 Determining NCCL version from the header file: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include/nccl.h<br>\n\u2013 Found NCCL (include: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include, library: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/libnccl.so)<br>\n\u2013 NCCL_LIBRARIES: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/libnccl.so<br>\n\u2013 Found NCCL, but the NCCL version is either not 2+ or not determinable, will not compile with NCCL distributed backend<br>\ncopying torch/cuda/nccl.py -&gt; build/lib.linux-x86_64-3.6/torch/cuda<br>\ncopying torch/lib/libnccl.so.1 -&gt; build/lib.linux-x86_64-3.6/torch/lib<br>\ncopying torch/lib/libnccl.so.1.3.5 -&gt; build/lib.linux-x86_64-3.6/torch/lib<br>\ncopying torch/lib/libnccl.so -&gt; build/lib.linux-x86_64-3.6/torch/lib<br>\ncopying torch/lib/include/torch/csrc/cuda/python_nccl.h -&gt; build/lib.linux-x86_64-3.6/torch/lib/include/torch/csrc/cuda<br>\ncopying torch/lib/include/torch/csrc/cuda/nccl.h -&gt; build/lib.linux-x86_64-3.6/torch/lib/include/torch/csrc/cuda<br>\n\u2013 Building NCCL library</p>", "body_text": "\ud83d\udc1b Bug\nLast time when I am using \u2018python setup.py install\u2019, I was told that either NCCL 2+ is needed.\nSo I git clone nccl with the branch v2.3.7-1, which says lacking CMakeLists.txt.\nInstead I the following at last build, but still NCCL is built in.\nCould somebody give a helping hand, thanks indeed.\nEnvironment\n\nPyTorch Version (e.g., 1.0): 1.0rc1\nOS (e.g., Linux): Ubuntu18.04.1\nHow you installed PyTorch (conda, pip, source): source\nBuild command you used (if compiling from source): python setup.py install\nPython version: 3.6.7\nCUDA/cuDNN version: CUDA10, Cudnn7.3.1\nGPU models and configuration: GTX1080\nAny other relevant information:\n\nAdditional context\n##Old CMakeLists.txt:\nCMAKE_MINIMUM_REQUIRED(VERSION 2.8 FATAL_ERROR)\nCMAKE_POLICY(VERSION 2.8)\nIF(NOT CUDA_FOUND)\nFIND_PACKAGE(CUDA 7.0 REQUIRED)\nENDIF()\ninclude(\"${CMAKE_UTILS_PATH}\")\ntorch_cuda_get_nvcc_gencode_flag(NVCC_GENCODE)\nstring(REPLACE \u201c-gencode;\u201d \u201c-gencode=\u201d NVCC_GENCODE \u201c${NVCC_GENCODE}\u201d)\nmessage(STATUS \u201cSet NVCC_GENCODE for building NCCL: ${NVCC_GENCODE}\u201d)\nADD_CUSTOM_COMMAND(\nWORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}\nOUTPUT ${CMAKE_CURRENT_BINARY_DIR}/lib/libnccl.so\nCOMMAND env CUDA_HOME=${CUDA_TOOLKIT_ROOT_DIR} NVCC=${CUDA_NVCC_EXECUTABLE} BUILDDIR=${CMAKE_CURRENT_BINARY_DIR} NVCC_GENCODE=\"${NVCC_GENCODE}\" make -j${NUM_JOBS}\n)\nADD_CUSTOM_TARGET(nccl ALL DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/lib/libnccl.so)\nINSTALL(FILES ${CMAKE_CURRENT_BINARY_DIR}/include/nccl.h DESTINATION \u201cinclude\u201d)\n##Following are the building outputs related to NCCL:\nBuilding wheel torch-1.0.0a0\n\u2013 Set NVCC_GENCODE for building NCCL: -gencode=arch=compute_30,code=sm_30;-gencode=arch=compute_35,code=sm_35;-gencode=arch=compute_50,code=sm_50;-gencode=arch=compute_52,code=sm_52;-gencode=arch=compute_60,code=sm_60;-gencode=arch=compute_61,code=sm_61;-gencode=arch=compute_70,code=sm_70;-gencode=arch=compute_70,code=compute_70\n\u2013 Build files have been written to: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/third_party/build/nccl\n[100%] Built target nccl\n\u2013 Found NCCL: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include\n\u2013 Determining NCCL version from the header file: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include/nccl.h\n\u2013 Found NCCL (include: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include, library: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/libnccl.so)\n\u2013 Include NCCL operators\n\u2013 USE_NCCL : ON\n\u2013 USE_SYSTEM_NCCL : OFF\n[ 77%] Building CXX object caffe2/CMakeFiles/caffe2_gpu.dir/contrib/nccl/cuda_nccl_gpu.cc.o\n[ 77%] Building CXX object caffe2/CMakeFiles/caffe2_gpu.dir/contrib/nccl/cuda_nccl_op_gpu.cc.o\n\u2013 Installing: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/python3.6/site-packages/caffe2/contrib/nccl/init.py\n\u2013 Installing: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/python3.6/site-packages/caffe2/contrib/nccl/nccl_ops_test.py\n\u2013 Determining NCCL version from the header file: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include/nccl.h\n\u2013 Found NCCL (include: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include, library: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/libnccl.so)\n\u2013 NCCL_LIBRARIES: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/libnccl.so\n\u2013 NCCL_INCLUDE_DIRS: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include\n\u2013 Found NCCL, but the NCCL version is either not 2+ or not determinable, will not compile with NCCL distributed backend\n\u2013 Determining NCCL version from the header file: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include/nccl.h\n\u2013 Found NCCL (include: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include, library: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/libnccl.so)\n\u2013 NCCL_LIBRARIES: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/libnccl.so\n\u2013 Found NCCL, but the NCCL version is either not 2+ or not determinable, will not compile with NCCL distributed backend\ncopying torch/cuda/nccl.py -> build/lib.linux-x86_64-3.6/torch/cuda\ncopying torch/lib/libnccl.so.1 -> build/lib.linux-x86_64-3.6/torch/lib\ncopying torch/lib/libnccl.so.1.3.5 -> build/lib.linux-x86_64-3.6/torch/lib\ncopying torch/lib/libnccl.so -> build/lib.linux-x86_64-3.6/torch/lib\ncopying torch/lib/include/torch/csrc/cuda/python_nccl.h -> build/lib.linux-x86_64-3.6/torch/lib/include/torch/csrc/cuda\ncopying torch/lib/include/torch/csrc/cuda/nccl.h -> build/lib.linux-x86_64-3.6/torch/lib/include/torch/csrc/cuda\n\u2013 Building NCCL library", "body": "## \ud83d\udc1b Bug\r\n\r\nLast time when I am using \u2018python setup.py install\u2019, I was told that either NCCL 2+ is needed.\r\nSo I git clone nccl with the branch v2.3.7-1, which says lacking CMakeLists.txt.\r\nInstead I the following at last build, but still NCCL is built in.\r\nCould somebody give a helping hand, thanks indeed.\r\n\r\n## Environment\r\n - PyTorch Version (e.g., 1.0): 1.0rc1\r\n - OS (e.g., Linux): Ubuntu18.04.1\r\n - How you installed PyTorch (`conda`, `pip`, source): source\r\n - Build command you used (if compiling from source): python setup.py install\r\n - Python version: 3.6.7\r\n - CUDA/cuDNN version: CUDA10, Cudnn7.3.1\r\n - GPU models and configuration: GTX1080\r\n - Any other relevant information:\r\n\r\n## Additional context\r\n##Old CMakeLists.txt:\r\n    CMAKE_MINIMUM_REQUIRED(VERSION 2.8 FATAL_ERROR)\r\n    CMAKE_POLICY(VERSION 2.8)\r\n\r\nIF(NOT CUDA_FOUND)\r\nFIND_PACKAGE(CUDA 7.0 REQUIRED)\r\nENDIF()\r\n\r\ninclude(\"${CMAKE_UTILS_PATH}\")\r\ntorch_cuda_get_nvcc_gencode_flag(NVCC_GENCODE)\r\nstring(REPLACE \u201c-gencode;\u201d \u201c-gencode=\u201d NVCC_GENCODE \u201c${NVCC_GENCODE}\u201d)\r\nmessage(STATUS \u201cSet NVCC_GENCODE for building NCCL: ${NVCC_GENCODE}\u201d)\r\n\r\nADD_CUSTOM_COMMAND(\r\nWORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}\r\nOUTPUT ${CMAKE_CURRENT_BINARY_DIR}/lib/libnccl.so\r\nCOMMAND env CUDA_HOME=${CUDA_TOOLKIT_ROOT_DIR} NVCC=${CUDA_NVCC_EXECUTABLE} BUILDDIR=${CMAKE_CURRENT_BINARY_DIR} NVCC_GENCODE=\"${NVCC_GENCODE}\" make -j${NUM_JOBS}\r\n)\r\n\r\nADD_CUSTOM_TARGET(nccl ALL DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/lib/libnccl.so)\r\n\r\nINSTALL(FILES ${CMAKE_CURRENT_BINARY_DIR}/include/nccl.h DESTINATION \u201cinclude\u201d)\r\n\r\n##Following are the building outputs related to NCCL:\r\n\r\nBuilding wheel torch-1.0.0a0\r\n\u2013 Set NVCC_GENCODE for building NCCL: -gencode=arch=compute_30,code=sm_30;-gencode=arch=compute_35,code=sm_35;-gencode=arch=compute_50,code=sm_50;-gencode=arch=compute_52,code=sm_52;-gencode=arch=compute_60,code=sm_60;-gencode=arch=compute_61,code=sm_61;-gencode=arch=compute_70,code=sm_70;-gencode=arch=compute_70,code=compute_70\r\n\u2013 Build files have been written to: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/third_party/build/nccl\r\n[100%] Built target nccl\r\n\u2013 Found NCCL: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include\r\n\u2013 Determining NCCL version from the header file: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include/nccl.h\r\n\u2013 Found NCCL (include: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include, library: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/libnccl.so)\r\n\u2013 Include NCCL operators\r\n\u2013 USE_NCCL : ON\r\n\u2013 USE_SYSTEM_NCCL : OFF\r\n[ 77%] Building CXX object caffe2/CMakeFiles/caffe2_gpu.dir/contrib/nccl/cuda_nccl_gpu.cc.o\r\n[ 77%] Building CXX object caffe2/CMakeFiles/caffe2_gpu.dir/contrib/nccl/cuda_nccl_op_gpu.cc.o\r\n\u2013 Installing: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/python3.6/site-packages/caffe2/contrib/nccl/init.py\r\n\u2013 Installing: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/python3.6/site-packages/caffe2/contrib/nccl/nccl_ops_test.py\r\n\u2013 Determining NCCL version from the header file: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include/nccl.h\r\n\u2013 Found NCCL (include: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include, library: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/libnccl.so)\r\n\u2013 NCCL_LIBRARIES: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/libnccl.so\r\n\u2013 NCCL_INCLUDE_DIRS: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include\r\n\u2013 Found NCCL, but the NCCL version is either not 2+ or not determinable, will not compile with NCCL distributed backend\r\n\u2013 Determining NCCL version from the header file: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include/nccl.h\r\n\u2013 Found NCCL (include: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/include, library: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/libnccl.so)\r\n\u2013 NCCL_LIBRARIES: /home/simon/Desktop/pytorch-scripts-1.0rc1/pytorch/torch/lib/tmp_install/lib/libnccl.so\r\n\u2013 Found NCCL, but the NCCL version is either not 2+ or not determinable, will not compile with NCCL distributed backend\r\ncopying torch/cuda/nccl.py -> build/lib.linux-x86_64-3.6/torch/cuda\r\ncopying torch/lib/libnccl.so.1 -> build/lib.linux-x86_64-3.6/torch/lib\r\ncopying torch/lib/libnccl.so.1.3.5 -> build/lib.linux-x86_64-3.6/torch/lib\r\ncopying torch/lib/libnccl.so -> build/lib.linux-x86_64-3.6/torch/lib\r\ncopying torch/lib/include/torch/csrc/cuda/python_nccl.h -> build/lib.linux-x86_64-3.6/torch/lib/include/torch/csrc/cuda\r\ncopying torch/lib/include/torch/csrc/cuda/nccl.h -> build/lib.linux-x86_64-3.6/torch/lib/include/torch/csrc/cuda\r\n\u2013 Building NCCL library\r\n"}