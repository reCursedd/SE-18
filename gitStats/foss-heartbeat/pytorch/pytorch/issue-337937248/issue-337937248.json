{"url": "https://api.github.com/repos/pytorch/pytorch/issues/9139", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/9139/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/9139/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/9139/events", "html_url": "https://github.com/pytorch/pytorch/issues/9139", "id": 337937248, "node_id": "MDU6SXNzdWUzMzc5MzcyNDg=", "number": 9139, "title": "cannot reload on CPU model saved on GPU", "user": {"login": "glample", "id": 8885556, "node_id": "MDQ6VXNlcjg4ODU1NTY=", "avatar_url": "https://avatars2.githubusercontent.com/u/8885556?v=4", "gravatar_id": "", "url": "https://api.github.com/users/glample", "html_url": "https://github.com/glample", "followers_url": "https://api.github.com/users/glample/followers", "following_url": "https://api.github.com/users/glample/following{/other_user}", "gists_url": "https://api.github.com/users/glample/gists{/gist_id}", "starred_url": "https://api.github.com/users/glample/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/glample/subscriptions", "organizations_url": "https://api.github.com/users/glample/orgs", "repos_url": "https://api.github.com/users/glample/repos", "events_url": "https://api.github.com/users/glample/events{/privacy}", "received_events_url": "https://api.github.com/users/glample/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-07-03T14:58:34Z", "updated_at": "2018-07-04T01:57:04Z", "closed_at": "2018-07-04T01:57:04Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Here is the error I get when I try to reload on my laptop a model saved on a GPU server:</p>\n<div class=\"highlight highlight-source-python\"><pre>reloaded <span class=\"pl-k\">=</span> torch.load(params.reload_model)</pre></div>\n<pre><code>Traceback (most recent call last):\n  File \"main.py\", line 161, in &lt;module&gt;\n    reloaded = torch.load(params.reload_model)#, map_location=lambda storage, location: 'cpu')\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 303, in load\n    return _load(f, map_location, pickle_module)\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 469, in _load\n    result = unpickler.load()\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 437, in persistent_load\n    data_type(size), location)\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 88, in default_restore_location\n    result = fn(storage, location)\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 70, in _cuda_deserialize\n    return obj.cuda(device)\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/_utils.py\", line 68, in _cuda\n    with torch.cuda.device(device):\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/cuda/__init__.py\", line 225, in __enter__\n    self.prev_idx = torch._C._cuda_getDevice()\nAttributeError: module 'torch._C' has no attribute '_cuda_getDevice'\n</code></pre>\n<p>I modified it so that it loads the model on CPU directly:</p>\n<div class=\"highlight highlight-source-python\"><pre>reloaded <span class=\"pl-k\">=</span> torch.load(params.reload_model, <span class=\"pl-v\">map_location</span><span class=\"pl-k\">=</span><span class=\"pl-k\">lambda</span> <span class=\"pl-smi\">storage</span>, <span class=\"pl-smi\">location</span>: <span class=\"pl-s\"><span class=\"pl-pds\">'</span>cpu<span class=\"pl-pds\">'</span></span>)</pre></div>\n<p>But now I get this:</p>\n<pre><code>Traceback (most recent call last):\n  File \"main.py\", line 161, in &lt;module&gt;\n    reloaded = torch.load(params.reload_model, map_location=lambda storage, location: 'cpu')\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 303, in load\n    return _load(f, map_location, pickle_module)\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 469, in _load\n    result = unpickler.load()\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/_utils.py\", line 98, in _rebuild_tensor_v2\n    tensor = _rebuild_tensor(storage, storage_offset, size, stride)\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/_utils.py\", line 92, in _rebuild_tensor\n    module = importlib.import_module(storage.__module__)\nAttributeError: 'str' object has no attribute '__module__'\n</code></pre>\n<p>Note that I'm using pytorch 0.5 on my GPU server and pytorch 0.4 on my Mac (as I was not able to build pytorch from source on my mac).<br>\nAny ideas?</p>\n<p>Thank you</p>", "body_text": "Here is the error I get when I try to reload on my laptop a model saved on a GPU server:\nreloaded = torch.load(params.reload_model)\nTraceback (most recent call last):\n  File \"main.py\", line 161, in <module>\n    reloaded = torch.load(params.reload_model)#, map_location=lambda storage, location: 'cpu')\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 303, in load\n    return _load(f, map_location, pickle_module)\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 469, in _load\n    result = unpickler.load()\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 437, in persistent_load\n    data_type(size), location)\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 88, in default_restore_location\n    result = fn(storage, location)\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 70, in _cuda_deserialize\n    return obj.cuda(device)\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/_utils.py\", line 68, in _cuda\n    with torch.cuda.device(device):\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/cuda/__init__.py\", line 225, in __enter__\n    self.prev_idx = torch._C._cuda_getDevice()\nAttributeError: module 'torch._C' has no attribute '_cuda_getDevice'\n\nI modified it so that it loads the model on CPU directly:\nreloaded = torch.load(params.reload_model, map_location=lambda storage, location: 'cpu')\nBut now I get this:\nTraceback (most recent call last):\n  File \"main.py\", line 161, in <module>\n    reloaded = torch.load(params.reload_model, map_location=lambda storage, location: 'cpu')\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 303, in load\n    return _load(f, map_location, pickle_module)\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 469, in _load\n    result = unpickler.load()\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/_utils.py\", line 98, in _rebuild_tensor_v2\n    tensor = _rebuild_tensor(storage, storage_offset, size, stride)\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/_utils.py\", line 92, in _rebuild_tensor\n    module = importlib.import_module(storage.__module__)\nAttributeError: 'str' object has no attribute '__module__'\n\nNote that I'm using pytorch 0.5 on my GPU server and pytorch 0.4 on my Mac (as I was not able to build pytorch from source on my mac).\nAny ideas?\nThank you", "body": "Here is the error I get when I try to reload on my laptop a model saved on a GPU server:\r\n\r\n```python\r\nreloaded = torch.load(params.reload_model)\r\n```\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"main.py\", line 161, in <module>\r\n    reloaded = torch.load(params.reload_model)#, map_location=lambda storage, location: 'cpu')\r\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 303, in load\r\n    return _load(f, map_location, pickle_module)\r\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 469, in _load\r\n    result = unpickler.load()\r\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 437, in persistent_load\r\n    data_type(size), location)\r\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 88, in default_restore_location\r\n    result = fn(storage, location)\r\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 70, in _cuda_deserialize\r\n    return obj.cuda(device)\r\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/_utils.py\", line 68, in _cuda\r\n    with torch.cuda.device(device):\r\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/cuda/__init__.py\", line 225, in __enter__\r\n    self.prev_idx = torch._C._cuda_getDevice()\r\nAttributeError: module 'torch._C' has no attribute '_cuda_getDevice'\r\n```\r\n\r\nI modified it so that it loads the model on CPU directly:\r\n\r\n```python\r\nreloaded = torch.load(params.reload_model, map_location=lambda storage, location: 'cpu')\r\n```\r\n\r\nBut now I get this:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"main.py\", line 161, in <module>\r\n    reloaded = torch.load(params.reload_model, map_location=lambda storage, location: 'cpu')\r\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 303, in load\r\n    return _load(f, map_location, pickle_module)\r\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/serialization.py\", line 469, in _load\r\n    result = unpickler.load()\r\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/_utils.py\", line 98, in _rebuild_tensor_v2\r\n    tensor = _rebuild_tensor(storage, storage_offset, size, stride)\r\n  File \"/Users/guismay/anaconda3/lib/python3.6/site-packages/torch/_utils.py\", line 92, in _rebuild_tensor\r\n    module = importlib.import_module(storage.__module__)\r\nAttributeError: 'str' object has no attribute '__module__'\r\n```\r\n\r\nNote that I'm using pytorch 0.5 on my GPU server and pytorch 0.4 on my Mac (as I was not able to build pytorch from source on my mac).\r\nAny ideas?\r\n\r\nThank you"}