{"url": "https://api.github.com/repos/pytorch/pytorch/issues/827", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/827/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/827/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/827/events", "html_url": "https://github.com/pytorch/pytorch/issues/827", "id": 209558948, "node_id": "MDU6SXNzdWUyMDk1NTg5NDg=", "number": 827, "title": "HalfTensor Training Needs non-Stateless Method in F.Linear", "user": {"login": "ajbrock", "id": 7751273, "node_id": "MDQ6VXNlcjc3NTEyNzM=", "avatar_url": "https://avatars1.githubusercontent.com/u/7751273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ajbrock", "html_url": "https://github.com/ajbrock", "followers_url": "https://api.github.com/users/ajbrock/followers", "following_url": "https://api.github.com/users/ajbrock/following{/other_user}", "gists_url": "https://api.github.com/users/ajbrock/gists{/gist_id}", "starred_url": "https://api.github.com/users/ajbrock/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ajbrock/subscriptions", "organizations_url": "https://api.github.com/users/ajbrock/orgs", "repos_url": "https://api.github.com/users/ajbrock/repos", "events_url": "https://api.github.com/users/ajbrock/events{/privacy}", "received_events_url": "https://api.github.com/users/ajbrock/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 424131847, "node_id": "MDU6TGFiZWw0MjQxMzE4NDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/bug", "name": "bug", "color": "b60205", "default": true}, {"id": 443484135, "node_id": "MDU6TGFiZWw0NDM0ODQxMzU=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/high%20priority", "name": "high priority", "color": "F22613", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2017-02-22T19:41:18Z", "updated_at": "2017-02-26T19:36:36Z", "closed_at": "2017-02-26T19:36:35Z", "author_association": "NONE", "body_html": "<p>Hi Guys,</p>\n<p>Currently trying to call backward() on a network trained in FP16 with a linear output results in an error:</p>\n<pre><code>import torch\nimport torch.nn.functional as F\nfrom torch.autograd import Variable as V\nx = V(torch.randn(20,5).cuda().half(),requires_grad=True)\ninp = V(torch.randn(100,5).cuda().half())\nout = F.linear(inp,x)\nout2 = out.mean()\nout2\nVariable containing:\n1.00000e-02 *\n -4.1840\n[torch.cuda.HalfTensor of size 1 (GPU 0)]\n\n\nout2.backward()\n</code></pre>\n<pre><code>Traceback (most recent call last):\n  File \"&lt;stdin&gt;\", line 1, in &lt;module&gt;\n  File \"/home/visionlab/anaconda2/lib/python2.7/site-packages/torch/autograd/variable.py\", line 145, in backward\n    self._execution_engine.run_backward((self,), (gradient,), retain_variables)\n  File \"/home/visionlab/anaconda2/lib/python2.7/site-packages/torch/nn/_functions/linear.py\", line 25, in backward\n    grad_weight = torch.mm(grad_output.t(), input)\nRuntimeError: Type HalfTensor doesn't implement stateless methods\n</code></pre>\n<p>This is easily fixed by replacing these calls with the non-stateless versions, as I've done <a href=\"https://github.com/ajbrock/pytorch/blob/master/torch/nn/_functions/linear.py\">here</a>. I'm not sure if this replacement is in line with pytorch style (or if there are plans to implement stateless methods for HalfTensors which would render this irrelevant), but I can submit a PR if needbe.</p>\n<p>Best,</p>\n<p>Andy</p>", "body_text": "Hi Guys,\nCurrently trying to call backward() on a network trained in FP16 with a linear output results in an error:\nimport torch\nimport torch.nn.functional as F\nfrom torch.autograd import Variable as V\nx = V(torch.randn(20,5).cuda().half(),requires_grad=True)\ninp = V(torch.randn(100,5).cuda().half())\nout = F.linear(inp,x)\nout2 = out.mean()\nout2\nVariable containing:\n1.00000e-02 *\n -4.1840\n[torch.cuda.HalfTensor of size 1 (GPU 0)]\n\n\nout2.backward()\n\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/home/visionlab/anaconda2/lib/python2.7/site-packages/torch/autograd/variable.py\", line 145, in backward\n    self._execution_engine.run_backward((self,), (gradient,), retain_variables)\n  File \"/home/visionlab/anaconda2/lib/python2.7/site-packages/torch/nn/_functions/linear.py\", line 25, in backward\n    grad_weight = torch.mm(grad_output.t(), input)\nRuntimeError: Type HalfTensor doesn't implement stateless methods\n\nThis is easily fixed by replacing these calls with the non-stateless versions, as I've done here. I'm not sure if this replacement is in line with pytorch style (or if there are plans to implement stateless methods for HalfTensors which would render this irrelevant), but I can submit a PR if needbe.\nBest,\nAndy", "body": "Hi Guys,\r\n\r\nCurrently trying to call backward() on a network trained in FP16 with a linear output results in an error:\r\n\r\n```\r\nimport torch\r\nimport torch.nn.functional as F\r\nfrom torch.autograd import Variable as V\r\nx = V(torch.randn(20,5).cuda().half(),requires_grad=True)\r\ninp = V(torch.randn(100,5).cuda().half())\r\nout = F.linear(inp,x)\r\nout2 = out.mean()\r\nout2\r\nVariable containing:\r\n1.00000e-02 *\r\n -4.1840\r\n[torch.cuda.HalfTensor of size 1 (GPU 0)]\r\n\r\n\r\nout2.backward()\r\n```\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/home/visionlab/anaconda2/lib/python2.7/site-packages/torch/autograd/variable.py\", line 145, in backward\r\n    self._execution_engine.run_backward((self,), (gradient,), retain_variables)\r\n  File \"/home/visionlab/anaconda2/lib/python2.7/site-packages/torch/nn/_functions/linear.py\", line 25, in backward\r\n    grad_weight = torch.mm(grad_output.t(), input)\r\nRuntimeError: Type HalfTensor doesn't implement stateless methods\r\n```\r\n\r\n\r\n\r\nThis is easily fixed by replacing these calls with the non-stateless versions, as I've done [here](https://github.com/ajbrock/pytorch/blob/master/torch/nn/_functions/linear.py). I'm not sure if this replacement is in line with pytorch style (or if there are plans to implement stateless methods for HalfTensors which would render this irrelevant), but I can submit a PR if needbe.\r\n\r\nBest,\r\n\r\nAndy"}