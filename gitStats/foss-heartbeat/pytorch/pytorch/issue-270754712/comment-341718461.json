{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/341718461", "html_url": "https://github.com/pytorch/pytorch/pull/3447#issuecomment-341718461", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/3447", "id": 341718461, "node_id": "MDEyOklzc3VlQ29tbWVudDM0MTcxODQ2MQ==", "user": {"login": "peterjc123", "id": 9998726, "node_id": "MDQ6VXNlcjk5OTg3MjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/9998726?v=4", "gravatar_id": "", "url": "https://api.github.com/users/peterjc123", "html_url": "https://github.com/peterjc123", "followers_url": "https://api.github.com/users/peterjc123/followers", "following_url": "https://api.github.com/users/peterjc123/following{/other_user}", "gists_url": "https://api.github.com/users/peterjc123/gists{/gist_id}", "starred_url": "https://api.github.com/users/peterjc123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/peterjc123/subscriptions", "organizations_url": "https://api.github.com/users/peterjc123/orgs", "repos_url": "https://api.github.com/users/peterjc123/repos", "events_url": "https://api.github.com/users/peterjc123/events{/privacy}", "received_events_url": "https://api.github.com/users/peterjc123/received_events", "type": "User", "site_admin": false}, "created_at": "2017-11-03T14:26:45Z", "updated_at": "2017-11-03T14:26:45Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4583066\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/apaszke\">@apaszke</a> The test to fail was test_serialization. In that test, a temp file was used. After that, the serialization starts using <code>torch.save</code>. Finally, it loads with <code>torch.loads</code>. So the file will be opened three times in this test. I find out that when setting the <code>FILE_SHARE_DELETE</code> flags in <code>THAllocator.c</code>. The file can be opened twice using the open function with an <code>opener</code> arg (which is available for Python&gt;3.3). The third time will fail due to the <code>FILE_FLAG_DELETE_ON_CLOSE</code> flag set using the default <code>os.open</code>.<br>\nSo, I modified the original version of os.open to let the temp file open any times.</p>", "body_text": "@apaszke The test to fail was test_serialization. In that test, a temp file was used. After that, the serialization starts using torch.save. Finally, it loads with torch.loads. So the file will be opened three times in this test. I find out that when setting the FILE_SHARE_DELETE flags in THAllocator.c. The file can be opened twice using the open function with an opener arg (which is available for Python>3.3). The third time will fail due to the FILE_FLAG_DELETE_ON_CLOSE flag set using the default os.open.\nSo, I modified the original version of os.open to let the temp file open any times.", "body": "@apaszke The test to fail was test_serialization. In that test, a temp file was used. After that, the serialization starts using `torch.save`. Finally, it loads with `torch.loads`. So the file will be opened three times in this test. I find out that when setting the `FILE_SHARE_DELETE` flags in `THAllocator.c`. The file can be opened twice using the open function with an `opener` arg (which is available for Python>3.3). The third time will fail due to the `FILE_FLAG_DELETE_ON_CLOSE` flag set using the default `os.open`.\r\nSo, I modified the original version of os.open to let the temp file open any times."}