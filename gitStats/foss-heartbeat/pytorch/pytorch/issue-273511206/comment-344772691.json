{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/344772691", "html_url": "https://github.com/pytorch/pytorch/issues/3669#issuecomment-344772691", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/3669", "id": 344772691, "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDc3MjY5MQ==", "user": {"login": "vadimkantorov", "id": 1041752, "node_id": "MDQ6VXNlcjEwNDE3NTI=", "avatar_url": "https://avatars0.githubusercontent.com/u/1041752?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vadimkantorov", "html_url": "https://github.com/vadimkantorov", "followers_url": "https://api.github.com/users/vadimkantorov/followers", "following_url": "https://api.github.com/users/vadimkantorov/following{/other_user}", "gists_url": "https://api.github.com/users/vadimkantorov/gists{/gist_id}", "starred_url": "https://api.github.com/users/vadimkantorov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vadimkantorov/subscriptions", "organizations_url": "https://api.github.com/users/vadimkantorov/orgs", "repos_url": "https://api.github.com/users/vadimkantorov/repos", "events_url": "https://api.github.com/users/vadimkantorov/events{/privacy}", "received_events_url": "https://api.github.com/users/vadimkantorov/received_events", "type": "User", "site_admin": false}, "created_at": "2017-11-16T00:14:53Z", "updated_at": "2017-11-16T00:15:16Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1310570\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/soumith\">@soumith</a> Considering the error, the offending code <a href=\"https://github.com/pytorch/pytorch/blob/master/aten/src/THCS/generic/THCSTensor.cu#L108\">snippet</a> in <code>THCSTensor.cu</code> is:</p>\n<pre><code> THCSTensor_coalesceValuesKernel&lt;real, accreal&gt;&lt;&lt;&lt;grid, block, 0, stream&gt;&gt;&gt;(\n    THCIndexTensor_(data)(state, uniqueOffsets),\n    THCIndexTensor_(data)(state, origIndices),\n    THCTensor_(data)(state, values),\n    THCTensor_(data)(state, newValues),\n    nnz,\n    newNnz,\n    stride\n  );\n</code></pre>\n<p>my compiler deduces types as: <code>(long *, long *, char *, char *, ptrdiff_t, int64_t, int64_t)</code></p>\n<p>and the <a href=\"https://github.com/pytorch/pytorch/blob/master/aten/src/THCS/THCSTensor.cu#L270\">kernel</a> itself is declared as:</p>\n<pre><code>template &lt;typename Dtype, typename Acctype&gt;\n__global__ void THCSTensor_coalesceValuesKernel(\n  int64_t *segment_offsets, int64_t *value_indices,\n  Dtype *values, Dtype *newValues,\n  int64_t nnz, int64_t newNnz, int64_t stride)\n</code></pre>\n<p><a href=\"https://github.com/pytorch/pytorch/blob/master/aten/src/THCS/generic/THCSTensor.cu#L39\"><code>nnz</code></a> is indeed defined by caller as <code>ptrdiff_t</code></p>", "body_text": "@soumith Considering the error, the offending code snippet in THCSTensor.cu is:\n THCSTensor_coalesceValuesKernel<real, accreal><<<grid, block, 0, stream>>>(\n    THCIndexTensor_(data)(state, uniqueOffsets),\n    THCIndexTensor_(data)(state, origIndices),\n    THCTensor_(data)(state, values),\n    THCTensor_(data)(state, newValues),\n    nnz,\n    newNnz,\n    stride\n  );\n\nmy compiler deduces types as: (long *, long *, char *, char *, ptrdiff_t, int64_t, int64_t)\nand the kernel itself is declared as:\ntemplate <typename Dtype, typename Acctype>\n__global__ void THCSTensor_coalesceValuesKernel(\n  int64_t *segment_offsets, int64_t *value_indices,\n  Dtype *values, Dtype *newValues,\n  int64_t nnz, int64_t newNnz, int64_t stride)\n\nnnz is indeed defined by caller as ptrdiff_t", "body": "@soumith Considering the error, the offending code [snippet](https://github.com/pytorch/pytorch/blob/master/aten/src/THCS/generic/THCSTensor.cu#L108) in `THCSTensor.cu` is:\r\n```\r\n THCSTensor_coalesceValuesKernel<real, accreal><<<grid, block, 0, stream>>>(\r\n    THCIndexTensor_(data)(state, uniqueOffsets),\r\n    THCIndexTensor_(data)(state, origIndices),\r\n    THCTensor_(data)(state, values),\r\n    THCTensor_(data)(state, newValues),\r\n    nnz,\r\n    newNnz,\r\n    stride\r\n  );\r\n```\r\nmy compiler deduces types as: `(long *, long *, char *, char *, ptrdiff_t, int64_t, int64_t)`\r\n\r\nand the [kernel](https://github.com/pytorch/pytorch/blob/master/aten/src/THCS/THCSTensor.cu#L270) itself is declared as:\r\n```\r\ntemplate <typename Dtype, typename Acctype>\r\n__global__ void THCSTensor_coalesceValuesKernel(\r\n  int64_t *segment_offsets, int64_t *value_indices,\r\n  Dtype *values, Dtype *newValues,\r\n  int64_t nnz, int64_t newNnz, int64_t stride)\r\n```\r\n\r\n[`nnz`](https://github.com/pytorch/pytorch/blob/master/aten/src/THCS/generic/THCSTensor.cu#L39) is indeed defined by caller as `ptrdiff_t`"}