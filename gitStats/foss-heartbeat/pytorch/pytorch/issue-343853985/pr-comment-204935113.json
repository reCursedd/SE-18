{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/204935113", "pull_request_review_id": 140034348, "id": 204935113, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNDkzNTExMw==", "diff_hunk": "@@ -267,6 +267,27 @@ def _export(model, args, f, export_params=True, verbose=False, training=False,\n     return torch_out\n \n \n+def _export_module(module, f, operator_export_type=OperatorExportTypes.ONNX, export_type=ExportTypes.PROTOBUF_FILE):\n+    # TODO: Don't allocate a in-memory string for the protobuf\n+    from torch.onnx.symbolic import _onnx_opset_version\n+\n+    proto, storage_map = module.export(_onnx_opset_version, operator_export_type)\n+\n+    if export_type in [ExportTypes.ZIP_ARCHIVE, ExportTypes.COMPRESSED_ZIP_ARCHIVE]:\n+        import zipfile\n+        compression = zipfile.ZIP_DEFLATED \\\n+            if export_type == ExportTypes.COMPRESSED_ZIP_ARCHIVE \\\n+            else zipfile.ZIP_STORED\n+        with zipfile.ZipFile(f, 'w', compression=compression) as z:", "path": "torch/onnx/utils.py", "position": null, "original_position": 15, "commit_id": "f622bcc6b1e23e942cca8615b87321ebc91e4273", "original_commit_id": "dfe899efbacf40f945fd85e4d49e3d0748317f4d", "user": {"login": "zdevito", "id": 370202, "node_id": "MDQ6VXNlcjM3MDIwMg==", "avatar_url": "https://avatars0.githubusercontent.com/u/370202?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zdevito", "html_url": "https://github.com/zdevito", "followers_url": "https://api.github.com/users/zdevito/followers", "following_url": "https://api.github.com/users/zdevito/following{/other_user}", "gists_url": "https://api.github.com/users/zdevito/gists{/gist_id}", "starred_url": "https://api.github.com/users/zdevito/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zdevito/subscriptions", "organizations_url": "https://api.github.com/users/zdevito/orgs", "repos_url": "https://api.github.com/users/zdevito/repos", "events_url": "https://api.github.com/users/zdevito/events{/privacy}", "received_events_url": "https://api.github.com/users/zdevito/received_events", "type": "User", "site_admin": false}, "body": "Everything should move to C++, it would clean up the API a lot since the exporter could also handle writing entries into the zip file, making the function prototypes simpler (no more export maps, e.g.). This is for James' follow up PR.", "created_at": "2018-07-24T22:46:53Z", "updated_at": "2018-11-23T15:48:02Z", "html_url": "https://github.com/pytorch/pytorch/pull/9746#discussion_r204935113", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/9746", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/204935113"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/9746#discussion_r204935113"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/9746"}}, "body_html": "<p>Everything should move to C++, it would clean up the API a lot since the exporter could also handle writing entries into the zip file, making the function prototypes simpler (no more export maps, e.g.). This is for James' follow up PR.</p>", "body_text": "Everything should move to C++, it would clean up the API a lot since the exporter could also handle writing entries into the zip file, making the function prototypes simpler (no more export maps, e.g.). This is for James' follow up PR.", "in_reply_to_id": 204673422}