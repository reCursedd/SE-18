{"url": "https://api.github.com/repos/pytorch/pytorch/issues/7148", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/7148/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/7148/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/7148/events", "html_url": "https://github.com/pytorch/pytorch/pull/7148", "id": 319300436, "node_id": "MDExOlB1bGxSZXF1ZXN0MTg1MjU1NjQw", "number": 7148, "title": "CPUApplyUtils is faster if iterate is split into two steps", "user": {"login": "cpuhrsch", "id": 1716488, "node_id": "MDQ6VXNlcjE3MTY0ODg=", "avatar_url": "https://avatars1.githubusercontent.com/u/1716488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cpuhrsch", "html_url": "https://github.com/cpuhrsch", "followers_url": "https://api.github.com/users/cpuhrsch/followers", "following_url": "https://api.github.com/users/cpuhrsch/following{/other_user}", "gists_url": "https://api.github.com/users/cpuhrsch/gists{/gist_id}", "starred_url": "https://api.github.com/users/cpuhrsch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cpuhrsch/subscriptions", "organizations_url": "https://api.github.com/users/cpuhrsch/orgs", "repos_url": "https://api.github.com/users/cpuhrsch/repos", "events_url": "https://api.github.com/users/cpuhrsch/events{/privacy}", "received_events_url": "https://api.github.com/users/cpuhrsch/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-05-01T19:31:54Z", "updated_at": "2018-05-01T22:32:03Z", "closed_at": "2018-05-01T22:32:03Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/7148", "html_url": "https://github.com/pytorch/pytorch/pull/7148", "diff_url": "https://github.com/pytorch/pytorch/pull/7148.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/7148.patch"}, "body_html": "<pre><code>This branch\n\n$ taskset -c 0 perf stat /private/home/cpuhrsch/miniconda2/bin/python unary_comp.py\ncos_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   0.9693 type: torch.FloatTensor    dim: 3\nsin_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.0169 type: torch.FloatTensor    dim: 3\nexp_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.3606 type: torch.FloatTensor    dim: 3\nlog_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.6018 type: torch.FloatTensor    dim: 3\ncos        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.1427 type: torch.FloatTensor    dim: 3\nsin        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.1564 type: torch.FloatTensor    dim: 3\nexp        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.5020 type: torch.FloatTensor    dim: 3\nlog        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.7574 type: torch.FloatTensor    dim: 3\n\n Performance counter stats for '/private/home/cpuhrsch/miniconda2/bin/python unary_comp.py':\n\n      19103.693320      task-clock (msec)         #    0.984 CPUs utilized\n             1,788      context-switches          #    0.094 K/sec\n                 0      cpu-migrations            #    0.000 K/sec\n            49,591      page-faults               #    0.003 M/sec\n    41,991,975,465      cycles                    #    2.198 GHz\n   &lt;not supported&gt;      stalled-cycles-frontend\n   &lt;not supported&gt;      stalled-cycles-backend\n   101,283,285,376      instructions              #    2.41  insns per cycle\n    15,796,285,730      branches                  #  826.871 M/sec\n       185,694,137      branch-misses             #    1.18% of all branches\n\n      19.421447415 seconds time elapsed\n\nMaster\n\n$ taskset -c 0 perf stat /private/home/cpuhrsch/miniconda2/bin/python unary_comp.py\ncos_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.2987 type: torch.FloatTensor    dim: 3\nsin_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.3512 type: torch.FloatTensor    dim: 3\nexp_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.8056 type: torch.FloatTensor    dim: 3\nlog_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   2.0370 type: torch.FloatTensor    dim: 3\ncos        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.3124 type: torch.FloatTensor    dim: 3\nsin        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.3650 type: torch.FloatTensor    dim: 3\nexp        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.6162 type: torch.FloatTensor    dim: 3\nlog        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.8959 type: torch.FloatTensor    dim: 3\n\n Performance counter stats for '/private/home/cpuhrsch/miniconda2/bin/python unary_comp.py':\n\n      20911.049098      task-clock (msec)         #    0.983 CPUs utilized\n             1,813      context-switches          #    0.087 K/sec\n                 0      cpu-migrations            #    0.000 K/sec\n            54,294      page-faults               #    0.003 M/sec\n    45,991,258,873      cycles                    #    2.199 GHz\n   &lt;not supported&gt;      stalled-cycles-frontend\n   &lt;not supported&gt;      stalled-cycles-backend\n   105,307,888,871      instructions              #    2.29  insns per cycle\n    16,548,531,916      branches                  #  791.377 M/sec\n       185,389,984      branch-misses             #    1.12% of all branches\n\n      21.271205633 seconds time elapsed\n</code></pre>\n<p>This benchmark is using <a href=\"https://paste.fedoraproject.org/paste/W9RMiwYG33ps56xT9Tz8Gw\" rel=\"nofollow\">this script</a></p>", "body_text": "This branch\n\n$ taskset -c 0 perf stat /private/home/cpuhrsch/miniconda2/bin/python unary_comp.py\ncos_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   0.9693 type: torch.FloatTensor    dim: 3\nsin_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.0169 type: torch.FloatTensor    dim: 3\nexp_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.3606 type: torch.FloatTensor    dim: 3\nlog_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.6018 type: torch.FloatTensor    dim: 3\ncos        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.1427 type: torch.FloatTensor    dim: 3\nsin        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.1564 type: torch.FloatTensor    dim: 3\nexp        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.5020 type: torch.FloatTensor    dim: 3\nlog        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.7574 type: torch.FloatTensor    dim: 3\n\n Performance counter stats for '/private/home/cpuhrsch/miniconda2/bin/python unary_comp.py':\n\n      19103.693320      task-clock (msec)         #    0.984 CPUs utilized\n             1,788      context-switches          #    0.094 K/sec\n                 0      cpu-migrations            #    0.000 K/sec\n            49,591      page-faults               #    0.003 M/sec\n    41,991,975,465      cycles                    #    2.198 GHz\n   <not supported>      stalled-cycles-frontend\n   <not supported>      stalled-cycles-backend\n   101,283,285,376      instructions              #    2.41  insns per cycle\n    15,796,285,730      branches                  #  826.871 M/sec\n       185,694,137      branch-misses             #    1.18% of all branches\n\n      19.421447415 seconds time elapsed\n\nMaster\n\n$ taskset -c 0 perf stat /private/home/cpuhrsch/miniconda2/bin/python unary_comp.py\ncos_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.2987 type: torch.FloatTensor    dim: 3\nsin_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.3512 type: torch.FloatTensor    dim: 3\nexp_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.8056 type: torch.FloatTensor    dim: 3\nlog_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   2.0370 type: torch.FloatTensor    dim: 3\ncos        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.3124 type: torch.FloatTensor    dim: 3\nsin        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.3650 type: torch.FloatTensor    dim: 3\nexp        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.6162 type: torch.FloatTensor    dim: 3\nlog        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.8959 type: torch.FloatTensor    dim: 3\n\n Performance counter stats for '/private/home/cpuhrsch/miniconda2/bin/python unary_comp.py':\n\n      20911.049098      task-clock (msec)         #    0.983 CPUs utilized\n             1,813      context-switches          #    0.087 K/sec\n                 0      cpu-migrations            #    0.000 K/sec\n            54,294      page-faults               #    0.003 M/sec\n    45,991,258,873      cycles                    #    2.199 GHz\n   <not supported>      stalled-cycles-frontend\n   <not supported>      stalled-cycles-backend\n   105,307,888,871      instructions              #    2.29  insns per cycle\n    16,548,531,916      branches                  #  791.377 M/sec\n       185,389,984      branch-misses             #    1.12% of all branches\n\n      21.271205633 seconds time elapsed\n\nThis benchmark is using this script", "body": "```\r\nThis branch\r\n\r\n$ taskset -c 0 perf stat /private/home/cpuhrsch/miniconda2/bin/python unary_comp.py\r\ncos_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   0.9693 type: torch.FloatTensor    dim: 3\r\nsin_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.0169 type: torch.FloatTensor    dim: 3\r\nexp_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.3606 type: torch.FloatTensor    dim: 3\r\nlog_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.6018 type: torch.FloatTensor    dim: 3\r\ncos        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.1427 type: torch.FloatTensor    dim: 3\r\nsin        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.1564 type: torch.FloatTensor    dim: 3\r\nexp        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.5020 type: torch.FloatTensor    dim: 3\r\nlog        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.7574 type: torch.FloatTensor    dim: 3\r\n\r\n Performance counter stats for '/private/home/cpuhrsch/miniconda2/bin/python unary_comp.py':\r\n\r\n      19103.693320      task-clock (msec)         #    0.984 CPUs utilized\r\n             1,788      context-switches          #    0.094 K/sec\r\n                 0      cpu-migrations            #    0.000 K/sec\r\n            49,591      page-faults               #    0.003 M/sec\r\n    41,991,975,465      cycles                    #    2.198 GHz\r\n   <not supported>      stalled-cycles-frontend\r\n   <not supported>      stalled-cycles-backend\r\n   101,283,285,376      instructions              #    2.41  insns per cycle\r\n    15,796,285,730      branches                  #  826.871 M/sec\r\n       185,694,137      branch-misses             #    1.18% of all branches\r\n\r\n      19.421447415 seconds time elapsed\r\n\r\nMaster\r\n\r\n$ taskset -c 0 perf stat /private/home/cpuhrsch/miniconda2/bin/python unary_comp.py\r\ncos_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.2987 type: torch.FloatTensor    dim: 3\r\nsin_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.3512 type: torch.FloatTensor    dim: 3\r\nexp_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.8056 type: torch.FloatTensor    dim: 3\r\nlog_       size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   2.0370 type: torch.FloatTensor    dim: 3\r\ncos        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.3124 type: torch.FloatTensor    dim: 3\r\nsin        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.3650 type: torch.FloatTensor    dim: 3\r\nexp        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.6162 type: torch.FloatTensor    dim: 3\r\nlog        size: 10^5   count: 1      size: [464, 464, 464]      stride: [' 215296', '    464', '      1']                            numel: 99897344  elapsed:   1.8959 type: torch.FloatTensor    dim: 3\r\n\r\n Performance counter stats for '/private/home/cpuhrsch/miniconda2/bin/python unary_comp.py':\r\n\r\n      20911.049098      task-clock (msec)         #    0.983 CPUs utilized\r\n             1,813      context-switches          #    0.087 K/sec\r\n                 0      cpu-migrations            #    0.000 K/sec\r\n            54,294      page-faults               #    0.003 M/sec\r\n    45,991,258,873      cycles                    #    2.199 GHz\r\n   <not supported>      stalled-cycles-frontend\r\n   <not supported>      stalled-cycles-backend\r\n   105,307,888,871      instructions              #    2.29  insns per cycle\r\n    16,548,531,916      branches                  #  791.377 M/sec\r\n       185,389,984      branch-misses             #    1.12% of all branches\r\n\r\n      21.271205633 seconds time elapsed\r\n```\r\n\r\nThis benchmark is using [this script](https://paste.fedoraproject.org/paste/W9RMiwYG33ps56xT9Tz8Gw)"}