{"url": "https://api.github.com/repos/pytorch/pytorch/issues/13891", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/13891/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/13891/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/13891/events", "html_url": "https://github.com/pytorch/pytorch/issues/13891", "id": 380148568, "node_id": "MDU6SXNzdWUzODAxNDg1Njg=", "number": 13891, "title": "torch.sum closes pipe", "user": {"login": "F-Schlatt", "id": 23191892, "node_id": "MDQ6VXNlcjIzMTkxODky", "avatar_url": "https://avatars2.githubusercontent.com/u/23191892?v=4", "gravatar_id": "", "url": "https://api.github.com/users/F-Schlatt", "html_url": "https://github.com/F-Schlatt", "followers_url": "https://api.github.com/users/F-Schlatt/followers", "following_url": "https://api.github.com/users/F-Schlatt/following{/other_user}", "gists_url": "https://api.github.com/users/F-Schlatt/gists{/gist_id}", "starred_url": "https://api.github.com/users/F-Schlatt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/F-Schlatt/subscriptions", "organizations_url": "https://api.github.com/users/F-Schlatt/orgs", "repos_url": "https://api.github.com/users/F-Schlatt/repos", "events_url": "https://api.github.com/users/F-Schlatt/events{/privacy}", "received_events_url": "https://api.github.com/users/F-Schlatt/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-11-13T10:08:56Z", "updated_at": "2018-11-19T18:58:51Z", "closed_at": null, "author_association": "NONE", "body_html": "<h2><g-emoji class=\"g-emoji\" alias=\"bug\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f41b.png\">\ud83d\udc1b</g-emoji> Bug</h2>\n<p>torch.sum closes all pipes of processes which aren't even interacting with pytorch at all. Error appears on Windows 10 with pytorch version 0.4.1. Not reproducible on Linux.</p>\n<h2>To Reproduce</h2>\n<pre><code>import torch\nfrom torch.multiprocessing import Process, Queue, Lock, Pipe\n\ndef create_list(length, queue, lock, pipe):\n    out = []\n    while True:\n        pipe.recv()\n        for i in range(length):\n            out.append(i)\n        with lock:\n            queue.put(out)\n\ndef main():\n    queue = Queue()\n    lock = Lock()\n    pipe = Pipe()\n\n    process = Process(target=create_list, args=(10, queue, lock, pipe[1]), daemon=True)\n    process.start()\n\n    pipe = pipe[0]\n\n    pipe.send(True)\n    while queue.empty():\n        pass\n    while not queue.empty():\n        with lock:\n            out = queue.get()\n        tensor = torch.tensor(out)\n        tensor = torch.sum(tensor)\n        # tensor = torch.prod(tensor)\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>\n<h2>Expected behavior</h2>\n<p>In this case <code>tensor = torch.sum(tensor)</code> produces a <code>BrokenPipeError: [WinError 109] the pipe has been ended</code>. <code>tensor = torch.prod(tensor)</code> does not produce the error.</p>\n<h2>Environment</h2>\n<p>PyTorch version: 0.4.1<br>\nIs debug build: No<br>\nCUDA used to build PyTorch: 9.0</p>\n<p>OS: Microsoft Windows 10 Home<br>\nGCC version: Could not collect<br>\nCMake version: version 3.11.1</p>\n<p>Python version: 3.6<br>\nIs CUDA available: No<br>\nCUDA runtime version: No CUDA<br>\nGPU models and configuration: No CUDA<br>\nNvidia driver version: No CUDA<br>\ncuDNN version: No CUDA</p>\n<p>Versions of relevant libraries:<br>\n[pip] Could not collect<br>\n[conda] pytorch                   0.4.1 py36_cuda90_cudnn7he774522_1    pytorch<br>\n[conda] torchvision               0.2.1 </p>", "body_text": "\ud83d\udc1b Bug\ntorch.sum closes all pipes of processes which aren't even interacting with pytorch at all. Error appears on Windows 10 with pytorch version 0.4.1. Not reproducible on Linux.\nTo Reproduce\nimport torch\nfrom torch.multiprocessing import Process, Queue, Lock, Pipe\n\ndef create_list(length, queue, lock, pipe):\n    out = []\n    while True:\n        pipe.recv()\n        for i in range(length):\n            out.append(i)\n        with lock:\n            queue.put(out)\n\ndef main():\n    queue = Queue()\n    lock = Lock()\n    pipe = Pipe()\n\n    process = Process(target=create_list, args=(10, queue, lock, pipe[1]), daemon=True)\n    process.start()\n\n    pipe = pipe[0]\n\n    pipe.send(True)\n    while queue.empty():\n        pass\n    while not queue.empty():\n        with lock:\n            out = queue.get()\n        tensor = torch.tensor(out)\n        tensor = torch.sum(tensor)\n        # tensor = torch.prod(tensor)\n\nif __name__ == \"__main__\":\n    main()\n\nExpected behavior\nIn this case tensor = torch.sum(tensor) produces a BrokenPipeError: [WinError 109] the pipe has been ended. tensor = torch.prod(tensor) does not produce the error.\nEnvironment\nPyTorch version: 0.4.1\nIs debug build: No\nCUDA used to build PyTorch: 9.0\nOS: Microsoft Windows 10 Home\nGCC version: Could not collect\nCMake version: version 3.11.1\nPython version: 3.6\nIs CUDA available: No\nCUDA runtime version: No CUDA\nGPU models and configuration: No CUDA\nNvidia driver version: No CUDA\ncuDNN version: No CUDA\nVersions of relevant libraries:\n[pip] Could not collect\n[conda] pytorch                   0.4.1 py36_cuda90_cudnn7he774522_1    pytorch\n[conda] torchvision               0.2.1", "body": "## \ud83d\udc1b Bug\r\n\r\ntorch.sum closes all pipes of processes which aren't even interacting with pytorch at all. Error appears on Windows 10 with pytorch version 0.4.1. Not reproducible on Linux.\r\n\r\n## To Reproduce\r\n\r\n```\r\nimport torch\r\nfrom torch.multiprocessing import Process, Queue, Lock, Pipe\r\n\r\ndef create_list(length, queue, lock, pipe):\r\n    out = []\r\n    while True:\r\n        pipe.recv()\r\n        for i in range(length):\r\n            out.append(i)\r\n        with lock:\r\n            queue.put(out)\r\n\r\ndef main():\r\n    queue = Queue()\r\n    lock = Lock()\r\n    pipe = Pipe()\r\n\r\n    process = Process(target=create_list, args=(10, queue, lock, pipe[1]), daemon=True)\r\n    process.start()\r\n\r\n    pipe = pipe[0]\r\n\r\n    pipe.send(True)\r\n    while queue.empty():\r\n        pass\r\n    while not queue.empty():\r\n        with lock:\r\n            out = queue.get()\r\n        tensor = torch.tensor(out)\r\n        tensor = torch.sum(tensor)\r\n        # tensor = torch.prod(tensor)\r\n\r\nif __name__ == \"__main__\":\r\n    main()\r\n```\r\n\r\n## Expected behavior\r\n\r\nIn this case `tensor = torch.sum(tensor)` produces a `BrokenPipeError: [WinError 109] the pipe has been ended`. `tensor = torch.prod(tensor)` does not produce the error. \r\n\r\n## Environment\r\n\r\nPyTorch version: 0.4.1\r\nIs debug build: No\r\nCUDA used to build PyTorch: 9.0\r\n\r\nOS: Microsoft Windows 10 Home\r\nGCC version: Could not collect\r\nCMake version: version 3.11.1\r\n\r\nPython version: 3.6\r\nIs CUDA available: No\r\nCUDA runtime version: No CUDA\r\nGPU models and configuration: No CUDA\r\nNvidia driver version: No CUDA\r\ncuDNN version: No CUDA\r\n\r\nVersions of relevant libraries:\r\n[pip] Could not collect\r\n[conda] pytorch                   0.4.1 py36_cuda90_cudnn7he774522_1    pytorch\r\n[conda] torchvision               0.2.1 <pip> "}