{"url": "https://api.github.com/repos/pytorch/pytorch/issues/11746", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/11746/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/11746/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/11746/events", "html_url": "https://github.com/pytorch/pytorch/issues/11746", "id": 360731200, "node_id": "MDU6SXNzdWUzNjA3MzEyMDA=", "number": 11746, "title": "[Caffe2] Problem with copying CUDA tensor to CPU tensor", "user": {"login": "ShahriarSS", "id": 24262836, "node_id": "MDQ6VXNlcjI0MjYyODM2", "avatar_url": "https://avatars2.githubusercontent.com/u/24262836?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ShahriarSS", "html_url": "https://github.com/ShahriarSS", "followers_url": "https://api.github.com/users/ShahriarSS/followers", "following_url": "https://api.github.com/users/ShahriarSS/following{/other_user}", "gists_url": "https://api.github.com/users/ShahriarSS/gists{/gist_id}", "starred_url": "https://api.github.com/users/ShahriarSS/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ShahriarSS/subscriptions", "organizations_url": "https://api.github.com/users/ShahriarSS/orgs", "repos_url": "https://api.github.com/users/ShahriarSS/repos", "events_url": "https://api.github.com/users/ShahriarSS/events{/privacy}", "received_events_url": "https://api.github.com/users/ShahriarSS/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 890282107, "node_id": "MDU6TGFiZWw4OTAyODIxMDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/caffe2", "name": "caffe2", "color": "210aa8", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-09-17T05:58:49Z", "updated_at": "2018-09-18T00:01:36Z", "closed_at": "2018-09-17T18:55:28Z", "author_association": "NONE", "body_html": "<p>Hi. I was working on a previous Caffe2 C++ code that I wrote that worked before but now it just keeps crashing. I wrote a simple code to see if it works but it did not. The problem is copying CUDA tensor to CPU tensor I think. Here is the code:</p>\n<div class=\"highlight highlight-source-c++\"><pre>#<span class=\"pl-k\">include</span> <span class=\"pl-s\"><span class=\"pl-pds\">&lt;</span>caffe2/core/context_gpu.h<span class=\"pl-pds\">&gt;</span></span>\n#<span class=\"pl-k\">include</span> <span class=\"pl-s\"><span class=\"pl-pds\">&lt;</span>caffe2/core/init.h<span class=\"pl-pds\">&gt;</span></span>\n#<span class=\"pl-k\">include</span> <span class=\"pl-s\"><span class=\"pl-pds\">&lt;</span>caffe2/core/tensor.h<span class=\"pl-pds\">&gt;</span></span>\n#<span class=\"pl-k\">include</span> <span class=\"pl-s\"><span class=\"pl-pds\">&lt;</span>iostream<span class=\"pl-pds\">&gt;</span></span>\n\n<span class=\"pl-k\">using</span> <span class=\"pl-k\">namespace</span> <span class=\"pl-en\">std</span><span class=\"pl-k\">;</span>\n\n<span class=\"pl-k\">int</span> <span class=\"pl-en\">main</span>()\n{\n\t<span class=\"pl-c1\">caffe2::GlobalInit</span>();\n\t<span class=\"pl-k\">auto</span> C = <span class=\"pl-k\">new</span> <span class=\"pl-c1\">caffe2::CUDAContext</span>();\n\n\tcaffe2::TensorCUDA <span class=\"pl-smi\">T</span>({<span class=\"pl-c1\">100</span> * <span class=\"pl-c1\">100</span>}, std::vector&lt;<span class=\"pl-k\">float</span>&gt;(<span class=\"pl-c1\">100</span> * <span class=\"pl-c1\">100</span>, <span class=\"pl-c1\">1</span>), C);\n\tcaffe2::TensorCPU <span class=\"pl-smi\">T1</span>(T);\n\n\t<span class=\"pl-k\">const</span> <span class=\"pl-k\">auto</span> &amp;D = T1.<span class=\"pl-smi\">data</span>&lt;<span class=\"pl-k\">float</span>&gt;();\n\tstd::vector&lt;<span class=\"pl-k\">float</span>&gt; <span class=\"pl-c1\">data</span>(D, D + T1.<span class=\"pl-c1\">size</span>());\n\n\tcout &lt;&lt; data &lt;&lt; endl;\n\n\t<span class=\"pl-k\">return</span> <span class=\"pl-c1\">0</span>;\n}</pre></div>\n<p>There are not much examples for Caffe2 with C++ but from what I could gather I think this code should work.</p>\n<p>My operating system is fedora. My graphics card is GTX 1050 and the version of CUDA installed is 9.2. I compiled Caffe2 from source with GCC 7.3 and I set CUDA_HOST_COMPILER to GCC 6.4.</p>\n<p>I run the above code with:<br>\noptirun ./program</p>", "body_text": "Hi. I was working on a previous Caffe2 C++ code that I wrote that worked before but now it just keeps crashing. I wrote a simple code to see if it works but it did not. The problem is copying CUDA tensor to CPU tensor I think. Here is the code:\n#include <caffe2/core/context_gpu.h>\n#include <caffe2/core/init.h>\n#include <caffe2/core/tensor.h>\n#include <iostream>\n\nusing namespace std;\n\nint main()\n{\n\tcaffe2::GlobalInit();\n\tauto C = new caffe2::CUDAContext();\n\n\tcaffe2::TensorCUDA T({100 * 100}, std::vector<float>(100 * 100, 1), C);\n\tcaffe2::TensorCPU T1(T);\n\n\tconst auto &D = T1.data<float>();\n\tstd::vector<float> data(D, D + T1.size());\n\n\tcout << data << endl;\n\n\treturn 0;\n}\nThere are not much examples for Caffe2 with C++ but from what I could gather I think this code should work.\nMy operating system is fedora. My graphics card is GTX 1050 and the version of CUDA installed is 9.2. I compiled Caffe2 from source with GCC 7.3 and I set CUDA_HOST_COMPILER to GCC 6.4.\nI run the above code with:\noptirun ./program", "body": "Hi. I was working on a previous Caffe2 C++ code that I wrote that worked before but now it just keeps crashing. I wrote a simple code to see if it works but it did not. The problem is copying CUDA tensor to CPU tensor I think. Here is the code:\r\n\r\n```c++\r\n#include <caffe2/core/context_gpu.h>\r\n#include <caffe2/core/init.h>\r\n#include <caffe2/core/tensor.h>\r\n#include <iostream>\r\n\r\nusing namespace std;\r\n\r\nint main()\r\n{\r\n\tcaffe2::GlobalInit();\r\n\tauto C = new caffe2::CUDAContext();\r\n\r\n\tcaffe2::TensorCUDA T({100 * 100}, std::vector<float>(100 * 100, 1), C);\r\n\tcaffe2::TensorCPU T1(T);\r\n\r\n\tconst auto &D = T1.data<float>();\r\n\tstd::vector<float> data(D, D + T1.size());\r\n\r\n\tcout << data << endl;\r\n\r\n\treturn 0;\r\n}\r\n```\r\n\r\nThere are not much examples for Caffe2 with C++ but from what I could gather I think this code should work. \r\n\r\nMy operating system is fedora. My graphics card is GTX 1050 and the version of CUDA installed is 9.2. I compiled Caffe2 from source with GCC 7.3 and I set CUDA_HOST_COMPILER to GCC 6.4.\r\n\r\nI run the above code with:\r\noptirun ./program"}