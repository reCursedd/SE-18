{"url": "https://api.github.com/repos/pytorch/pytorch/issues/4831", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/4831/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/4831/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/4831/events", "html_url": "https://github.com/pytorch/pytorch/issues/4831", "id": 291247164, "node_id": "MDU6SXNzdWUyOTEyNDcxNjQ=", "number": 4831, "title": "CUDA error running benchmark script on multi-GPU", "user": {"login": "SeanNaren", "id": 6707363, "node_id": "MDQ6VXNlcjY3MDczNjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/6707363?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SeanNaren", "html_url": "https://github.com/SeanNaren", "followers_url": "https://api.github.com/users/SeanNaren/followers", "following_url": "https://api.github.com/users/SeanNaren/following{/other_user}", "gists_url": "https://api.github.com/users/SeanNaren/gists{/gist_id}", "starred_url": "https://api.github.com/users/SeanNaren/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SeanNaren/subscriptions", "organizations_url": "https://api.github.com/users/SeanNaren/orgs", "repos_url": "https://api.github.com/users/SeanNaren/repos", "events_url": "https://api.github.com/users/SeanNaren/events{/privacy}", "received_events_url": "https://api.github.com/users/SeanNaren/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-01-24T15:21:01Z", "updated_at": "2018-02-16T14:27:52Z", "closed_at": null, "author_association": "CONTRIBUTOR", "body_html": "<p>Running into an issue running a <a href=\"https://github.com/SeanNaren/deepspeech.pytorch/blob/distributed/benchmark.py\">benchmark</a> script available in the deepspeech.pytorch library (I can try to create a smaller reproducible script if this helps). The script runs fine for 1/2/4/8 GPUs with a batch size of 32 per GPU (1 GPU batch size is 32, 2 GPUs batch size is 64 etc), but for 3/5/6/7 GPUs I run into the below error:</p>\n<pre><code>CUDA_VISIBLE_DEVICES=\"0,1,2\" python benchmark.py --batch-size 96\nNumber of parameters: 38067968\nRunning dry runs...\n  0%|                                                                        | 0/2 [00:00&lt;?, ?it/sTHCudaCheck FAIL file=/opt/conda/conda-bld/pytorch_1512387374934/work/torch/lib/THC/generic/THCTensorMath.cu line=35 error=11 : invalid argument\n\nTraceback (most recent call last):\n  File \"benchmark.py\", line 116, in &lt;module&gt;\n    run_time = run_benchmark()\n  File \"benchmark.py\", line 102, in run_benchmark\n    iteration(data)\n  File \"benchmark.py\", line 92, in iteration\n    optimizer.step()\n  File \"/home/sean.narenthiran/anaconda3/lib/python3.6/site-packages/torch/optim/sgd.py\", line 90, in step\n    buf = param_state['momentum_buffer'] = torch.zeros_like(p.data)\nRuntimeError: cuda runtime error (11) : invalid argument at /opt/conda/conda-bld/pytorch_1512387374934/work/torch/lib/THC/generic/THCTensorMath.cu:35\n</code></pre>\n<ul>\n<li>OS: Ubuntu 16.04</li>\n<li>PyTorch version: 3.0</li>\n<li>How you installed PyTorch (conda, pip, source): conda</li>\n<li>Python version: 3.6</li>\n<li>CUDA/cuDNN version: cuda 9.0/ cuDNN 7</li>\n<li>GPU models and configuration: p2.x8 large instance (8 K80s)</li>\n</ul>", "body_text": "Running into an issue running a benchmark script available in the deepspeech.pytorch library (I can try to create a smaller reproducible script if this helps). The script runs fine for 1/2/4/8 GPUs with a batch size of 32 per GPU (1 GPU batch size is 32, 2 GPUs batch size is 64 etc), but for 3/5/6/7 GPUs I run into the below error:\nCUDA_VISIBLE_DEVICES=\"0,1,2\" python benchmark.py --batch-size 96\nNumber of parameters: 38067968\nRunning dry runs...\n  0%|                                                                        | 0/2 [00:00<?, ?it/sTHCudaCheck FAIL file=/opt/conda/conda-bld/pytorch_1512387374934/work/torch/lib/THC/generic/THCTensorMath.cu line=35 error=11 : invalid argument\n\nTraceback (most recent call last):\n  File \"benchmark.py\", line 116, in <module>\n    run_time = run_benchmark()\n  File \"benchmark.py\", line 102, in run_benchmark\n    iteration(data)\n  File \"benchmark.py\", line 92, in iteration\n    optimizer.step()\n  File \"/home/sean.narenthiran/anaconda3/lib/python3.6/site-packages/torch/optim/sgd.py\", line 90, in step\n    buf = param_state['momentum_buffer'] = torch.zeros_like(p.data)\nRuntimeError: cuda runtime error (11) : invalid argument at /opt/conda/conda-bld/pytorch_1512387374934/work/torch/lib/THC/generic/THCTensorMath.cu:35\n\n\nOS: Ubuntu 16.04\nPyTorch version: 3.0\nHow you installed PyTorch (conda, pip, source): conda\nPython version: 3.6\nCUDA/cuDNN version: cuda 9.0/ cuDNN 7\nGPU models and configuration: p2.x8 large instance (8 K80s)", "body": "Running into an issue running a [benchmark](https://github.com/SeanNaren/deepspeech.pytorch/blob/distributed/benchmark.py) script available in the deepspeech.pytorch library (I can try to create a smaller reproducible script if this helps). The script runs fine for 1/2/4/8 GPUs with a batch size of 32 per GPU (1 GPU batch size is 32, 2 GPUs batch size is 64 etc), but for 3/5/6/7 GPUs I run into the below error:\r\n\r\n```\r\nCUDA_VISIBLE_DEVICES=\"0,1,2\" python benchmark.py --batch-size 96\r\nNumber of parameters: 38067968\r\nRunning dry runs...\r\n  0%|                                                                        | 0/2 [00:00<?, ?it/sTHCudaCheck FAIL file=/opt/conda/conda-bld/pytorch_1512387374934/work/torch/lib/THC/generic/THCTensorMath.cu line=35 error=11 : invalid argument\r\n\r\nTraceback (most recent call last):\r\n  File \"benchmark.py\", line 116, in <module>\r\n    run_time = run_benchmark()\r\n  File \"benchmark.py\", line 102, in run_benchmark\r\n    iteration(data)\r\n  File \"benchmark.py\", line 92, in iteration\r\n    optimizer.step()\r\n  File \"/home/sean.narenthiran/anaconda3/lib/python3.6/site-packages/torch/optim/sgd.py\", line 90, in step\r\n    buf = param_state['momentum_buffer'] = torch.zeros_like(p.data)\r\nRuntimeError: cuda runtime error (11) : invalid argument at /opt/conda/conda-bld/pytorch_1512387374934/work/torch/lib/THC/generic/THCTensorMath.cu:35\r\n```\r\n\r\n- OS: Ubuntu 16.04\r\n- PyTorch version: 3.0\r\n- How you installed PyTorch (conda, pip, source): conda\r\n- Python version: 3.6\r\n- CUDA/cuDNN version: cuda 9.0/ cuDNN 7\r\n- GPU models and configuration: p2.x8 large instance (8 K80s)\r\n"}