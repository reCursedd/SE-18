{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/435472630", "html_url": "https://github.com/pytorch/pytorch/pull/13452#issuecomment-435472630", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/13452", "id": 435472630, "node_id": "MDEyOklzc3VlQ29tbWVudDQzNTQ3MjYzMA==", "user": {"login": "albanD", "id": 6359743, "node_id": "MDQ6VXNlcjYzNTk3NDM=", "avatar_url": "https://avatars3.githubusercontent.com/u/6359743?v=4", "gravatar_id": "", "url": "https://api.github.com/users/albanD", "html_url": "https://github.com/albanD", "followers_url": "https://api.github.com/users/albanD/followers", "following_url": "https://api.github.com/users/albanD/following{/other_user}", "gists_url": "https://api.github.com/users/albanD/gists{/gist_id}", "starred_url": "https://api.github.com/users/albanD/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/albanD/subscriptions", "organizations_url": "https://api.github.com/users/albanD/orgs", "repos_url": "https://api.github.com/users/albanD/repos", "events_url": "https://api.github.com/users/albanD/events{/privacy}", "received_events_url": "https://api.github.com/users/albanD/received_events", "type": "User", "site_admin": false}, "created_at": "2018-11-02T18:42:43Z", "updated_at": "2018-11-02T18:42:43Z", "author_association": "COLLABORATOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4583066\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/apaszke\">@apaszke</a><br>\nBasically if you have a Function that returns 2 outputs that are views of its inputs and it modified the first one inplace, You will call <code>set_history</code> for it. For which you will call <code>rebase_history</code>. Note that with the current code, at this point, you called <code>add_input_metadata</code> on cdata only once. So <code>cdata-&gt;num_inputs()</code> is 1 at the moment (while it should be 2 as the function returns 2 outputs). During the <code>rebase_history</code> call, none of <a href=\"https://github.com/pytorch/pytorch/blob/da029ca0422ca95c7489e15fdd9c1f9dc12459d5/torch/csrc/autograd/variable.cpp#L214-L218\">these checks</a> will be triggered while the last one should be.<br>\nIndeed, if the second output is the one modified inplace, it will trigger as expected.</p>\n<p>If the check is not triggered, this code will crash during the backward as your Function will get a single grad_output instead of two. Giving an unexpected and unrelated error message.</p>", "body_text": "@apaszke\nBasically if you have a Function that returns 2 outputs that are views of its inputs and it modified the first one inplace, You will call set_history for it. For which you will call rebase_history. Note that with the current code, at this point, you called add_input_metadata on cdata only once. So cdata->num_inputs() is 1 at the moment (while it should be 2 as the function returns 2 outputs). During the rebase_history call, none of these checks will be triggered while the last one should be.\nIndeed, if the second output is the one modified inplace, it will trigger as expected.\nIf the check is not triggered, this code will crash during the backward as your Function will get a single grad_output instead of two. Giving an unexpected and unrelated error message.", "body": "@apaszke \r\nBasically if you have a Function that returns 2 outputs that are views of its inputs and it modified the first one inplace, You will call `set_history` for it. For which you will call `rebase_history`. Note that with the current code, at this point, you called `add_input_metadata` on cdata only once. So `cdata->num_inputs()` is 1 at the moment (while it should be 2 as the function returns 2 outputs). During the `rebase_history` call, none of [these checks](https://github.com/pytorch/pytorch/blob/da029ca0422ca95c7489e15fdd9c1f9dc12459d5/torch/csrc/autograd/variable.cpp#L214-L218) will be triggered while the last one should be.\r\nIndeed, if the second output is the one modified inplace, it will trigger as expected. \r\n\r\nIf the check is not triggered, this code will crash during the backward as your Function will get a single grad_output instead of two. Giving an unexpected and unrelated error message."}