{"url": "https://api.github.com/repos/pytorch/pytorch/issues/5489", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/5489/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/5489/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/5489/events", "html_url": "https://github.com/pytorch/pytorch/issues/5489", "id": 301336021, "node_id": "MDU6SXNzdWUzMDEzMzYwMjE=", "number": 5489, "title": "torch.jit.trace(network, data) fails if data is an OrderedDict", "user": {"login": "bnsh", "id": 353681, "node_id": "MDQ6VXNlcjM1MzY4MQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/353681?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bnsh", "html_url": "https://github.com/bnsh", "followers_url": "https://api.github.com/users/bnsh/followers", "following_url": "https://api.github.com/users/bnsh/following{/other_user}", "gists_url": "https://api.github.com/users/bnsh/gists{/gist_id}", "starred_url": "https://api.github.com/users/bnsh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bnsh/subscriptions", "organizations_url": "https://api.github.com/users/bnsh/orgs", "repos_url": "https://api.github.com/users/bnsh/repos", "events_url": "https://api.github.com/users/bnsh/events{/privacy}", "received_events_url": "https://api.github.com/users/bnsh/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-03-01T09:37:39Z", "updated_at": "2018-03-01T09:38:01Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>My network takes a bunch of inputs, and I was keeping them in an ordereddict so that I could keep track of what they were. When I tried to run TensorboardX on my network, it fails with:</p>\n<pre lang=\"Traceback\" data-meta=\"(most recent call last):\"><code>  File \"tensorboard.py\", line 63, in &lt;module&gt;\n    main()\n  File \"tensorboard.py\", line 60, in main\n    writer.add_graph(network, data)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorboardX/writer.py\", line 400, in add_graph\n    self.file_writer.add_graph(graph(model, input_to_model, verbose))\n  File \"/usr/local/lib/python2.7/dist-packages/tensorboardX/graph.py\", line 52, in graph\n    trace, _ = torch.jit.trace(model, args)\n  File \"/usr/local/lib/python2.7/dist-packages/torch/jit/__init__.py\", line 241, in trace\n    return TracedModule(f, nderivs=nderivs)(*args, **kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/torch/nn/modules/module.py\", line 357, in __call__\n    result = self.forward(*input, **kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/torch/jit/__init__.py\", line 266, in forward\n    in_vars, in_struct = _flatten((args, tuple(kw_items)), self.state_dict(keep_vars=True).values())\n  File \"/usr/local/lib/python2.7/dist-packages/torch/jit/__init__.py\", line 568, in _flatten\n    obj_vars = tuple(itertools.chain(function._iter_variables(obj), params))\n  File \"/usr/local/lib/python2.7/dist-packages/torch/autograd/function.py\", line 277, in _iter\n    for var in _iter(o):\n  File \"/usr/local/lib/python2.7/dist-packages/torch/autograd/function.py\", line 277, in _iter\n    for var in _iter(o):\n  File \"/usr/local/lib/python2.7/dist-packages/torch/autograd/function.py\", line 281, in _iter\n    \"an input object of type \" + torch.typename(obj))\nValueError: NestedIOFunction doesn't know how to process an input object of type collections.OrderedDict\n</code></pre>\n<p>Digging through, I found that the problem was in torch.jit.trace, tho, I'm less confident about trying to fix it.</p>\n<p>I'm running Linux, 4.4.0-112-generic, pytorch 0.3.1 on python 2.7.12 and I installed it with pip. (I don't think the CUDA information is relevant, because this fails on my laptop which doesn't have a GPU.)</p>\n<p>I'm attaching two files: One called \"works.py\" which works, if instead of using an OrderedDict, I use a list.<br>\nand one called \"fails.py\" which fails, since it uses an OrderedDict.</p>\n<p>Thanks..<br>\n<a href=\"https://github.com/pytorch/pytorch/files/1770599/demo.zip\">demo.zip</a></p>", "body_text": "My network takes a bunch of inputs, and I was keeping them in an ordereddict so that I could keep track of what they were. When I tried to run TensorboardX on my network, it fails with:\n  File \"tensorboard.py\", line 63, in <module>\n    main()\n  File \"tensorboard.py\", line 60, in main\n    writer.add_graph(network, data)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorboardX/writer.py\", line 400, in add_graph\n    self.file_writer.add_graph(graph(model, input_to_model, verbose))\n  File \"/usr/local/lib/python2.7/dist-packages/tensorboardX/graph.py\", line 52, in graph\n    trace, _ = torch.jit.trace(model, args)\n  File \"/usr/local/lib/python2.7/dist-packages/torch/jit/__init__.py\", line 241, in trace\n    return TracedModule(f, nderivs=nderivs)(*args, **kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/torch/nn/modules/module.py\", line 357, in __call__\n    result = self.forward(*input, **kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/torch/jit/__init__.py\", line 266, in forward\n    in_vars, in_struct = _flatten((args, tuple(kw_items)), self.state_dict(keep_vars=True).values())\n  File \"/usr/local/lib/python2.7/dist-packages/torch/jit/__init__.py\", line 568, in _flatten\n    obj_vars = tuple(itertools.chain(function._iter_variables(obj), params))\n  File \"/usr/local/lib/python2.7/dist-packages/torch/autograd/function.py\", line 277, in _iter\n    for var in _iter(o):\n  File \"/usr/local/lib/python2.7/dist-packages/torch/autograd/function.py\", line 277, in _iter\n    for var in _iter(o):\n  File \"/usr/local/lib/python2.7/dist-packages/torch/autograd/function.py\", line 281, in _iter\n    \"an input object of type \" + torch.typename(obj))\nValueError: NestedIOFunction doesn't know how to process an input object of type collections.OrderedDict\n\nDigging through, I found that the problem was in torch.jit.trace, tho, I'm less confident about trying to fix it.\nI'm running Linux, 4.4.0-112-generic, pytorch 0.3.1 on python 2.7.12 and I installed it with pip. (I don't think the CUDA information is relevant, because this fails on my laptop which doesn't have a GPU.)\nI'm attaching two files: One called \"works.py\" which works, if instead of using an OrderedDict, I use a list.\nand one called \"fails.py\" which fails, since it uses an OrderedDict.\nThanks..\ndemo.zip", "body": "My network takes a bunch of inputs, and I was keeping them in an ordereddict so that I could keep track of what they were. When I tried to run TensorboardX on my network, it fails with:\r\n\r\n```Traceback (most recent call last):\r\n  File \"tensorboard.py\", line 63, in <module>\r\n    main()\r\n  File \"tensorboard.py\", line 60, in main\r\n    writer.add_graph(network, data)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorboardX/writer.py\", line 400, in add_graph\r\n    self.file_writer.add_graph(graph(model, input_to_model, verbose))\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorboardX/graph.py\", line 52, in graph\r\n    trace, _ = torch.jit.trace(model, args)\r\n  File \"/usr/local/lib/python2.7/dist-packages/torch/jit/__init__.py\", line 241, in trace\r\n    return TracedModule(f, nderivs=nderivs)(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/dist-packages/torch/nn/modules/module.py\", line 357, in __call__\r\n    result = self.forward(*input, **kwargs)\r\n  File \"/usr/local/lib/python2.7/dist-packages/torch/jit/__init__.py\", line 266, in forward\r\n    in_vars, in_struct = _flatten((args, tuple(kw_items)), self.state_dict(keep_vars=True).values())\r\n  File \"/usr/local/lib/python2.7/dist-packages/torch/jit/__init__.py\", line 568, in _flatten\r\n    obj_vars = tuple(itertools.chain(function._iter_variables(obj), params))\r\n  File \"/usr/local/lib/python2.7/dist-packages/torch/autograd/function.py\", line 277, in _iter\r\n    for var in _iter(o):\r\n  File \"/usr/local/lib/python2.7/dist-packages/torch/autograd/function.py\", line 277, in _iter\r\n    for var in _iter(o):\r\n  File \"/usr/local/lib/python2.7/dist-packages/torch/autograd/function.py\", line 281, in _iter\r\n    \"an input object of type \" + torch.typename(obj))\r\nValueError: NestedIOFunction doesn't know how to process an input object of type collections.OrderedDict\r\n```\r\n\r\nDigging through, I found that the problem was in torch.jit.trace, tho, I'm less confident about trying to fix it.\r\n\r\nI'm running Linux, 4.4.0-112-generic, pytorch 0.3.1 on python 2.7.12 and I installed it with pip. (I don't think the CUDA information is relevant, because this fails on my laptop which doesn't have a GPU.)\r\n\r\nI'm attaching two files: One called \"works.py\" which works, if instead of using an OrderedDict, I use a list.\r\nand one called \"fails.py\" which fails, since it uses an OrderedDict.\r\n\r\nThanks..\r\n[demo.zip](https://github.com/pytorch/pytorch/files/1770599/demo.zip)\r\n\r\n\r\n"}