{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/421086516", "html_url": "https://github.com/pytorch/pytorch/issues/11327#issuecomment-421086516", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/11327", "id": 421086516, "node_id": "MDEyOklzc3VlQ29tbWVudDQyMTA4NjUxNg==", "user": {"login": "mcarilli", "id": 7799218, "node_id": "MDQ6VXNlcjc3OTkyMTg=", "avatar_url": "https://avatars0.githubusercontent.com/u/7799218?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarilli", "html_url": "https://github.com/mcarilli", "followers_url": "https://api.github.com/users/mcarilli/followers", "following_url": "https://api.github.com/users/mcarilli/following{/other_user}", "gists_url": "https://api.github.com/users/mcarilli/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarilli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarilli/subscriptions", "organizations_url": "https://api.github.com/users/mcarilli/orgs", "repos_url": "https://api.github.com/users/mcarilli/repos", "events_url": "https://api.github.com/users/mcarilli/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarilli/received_events", "type": "User", "site_admin": false}, "created_at": "2018-09-13T17:24:58Z", "updated_at": "2018-09-13T17:25:23Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Interesting.   As I said before, if I run in the Dockerhub pytorch/pytorch container, I see the following.<br>\nCommand:</p>\n<pre><code>python -m torch.distributed.launch --nproc_per_node=2 main.py --fp16 --arch resnet18 --epochs 90 --workers 2 --batch-size=128 .\n</code></pre>\n<p>Result</p>\n<pre><code>Epoch: [0][4990/5005]\tTime 0.249 (0.247)\tSpeed 1026.899 (1037.399)\tData 0.041 (0.079)\tLoss 4.9688 (5.8149)\tPrec@1 10.547 (4.484)\tPrec@5 25.781 (12.641)\nProcess Process-1:\n...\nConnectionResetError: [Errno 104] Connection reset by peer\n</code></pre>\n<p>In other words, an error occurs at the end of the first epoch, just before validation.</p>\n<p>If I run in our 18.09 containers, which has a version of Pytorch forked from last month's master, I see that</p>\n<pre><code>python -m torch.distributed.launch --nproc_per_node=2 main.py --fp16 --arch resnet18 --epochs 90 --workers 2 --batch-size=128 \n</code></pre>\n<p>trains happily through multiple epochs of training and validation.</p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=19993503\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/yingjianling\">@yingjianling</a>  I realize this is \"black box\"/cargo cult debugging, but can you try running your case with top of tree Pytorch instead of 0.4.1?  I don't know what changes occurred in the dataloader in between, but if top of tree succeeds, at least we have additional information.</p>", "body_text": "Interesting.   As I said before, if I run in the Dockerhub pytorch/pytorch container, I see the following.\nCommand:\npython -m torch.distributed.launch --nproc_per_node=2 main.py --fp16 --arch resnet18 --epochs 90 --workers 2 --batch-size=128 .\n\nResult\nEpoch: [0][4990/5005]\tTime 0.249 (0.247)\tSpeed 1026.899 (1037.399)\tData 0.041 (0.079)\tLoss 4.9688 (5.8149)\tPrec@1 10.547 (4.484)\tPrec@5 25.781 (12.641)\nProcess Process-1:\n...\nConnectionResetError: [Errno 104] Connection reset by peer\n\nIn other words, an error occurs at the end of the first epoch, just before validation.\nIf I run in our 18.09 containers, which has a version of Pytorch forked from last month's master, I see that\npython -m torch.distributed.launch --nproc_per_node=2 main.py --fp16 --arch resnet18 --epochs 90 --workers 2 --batch-size=128 \n\ntrains happily through multiple epochs of training and validation.\n@yingjianling  I realize this is \"black box\"/cargo cult debugging, but can you try running your case with top of tree Pytorch instead of 0.4.1?  I don't know what changes occurred in the dataloader in between, but if top of tree succeeds, at least we have additional information.", "body": "Interesting.   As I said before, if I run in the Dockerhub pytorch/pytorch container, I see the following.\r\nCommand:\r\n```\r\npython -m torch.distributed.launch --nproc_per_node=2 main.py --fp16 --arch resnet18 --epochs 90 --workers 2 --batch-size=128 .\r\n```\r\nResult\r\n```\r\nEpoch: [0][4990/5005]\tTime 0.249 (0.247)\tSpeed 1026.899 (1037.399)\tData 0.041 (0.079)\tLoss 4.9688 (5.8149)\tPrec@1 10.547 (4.484)\tPrec@5 25.781 (12.641)\r\nProcess Process-1:\r\n...\r\nConnectionResetError: [Errno 104] Connection reset by peer\r\n```\r\nIn other words, an error occurs at the end of the first epoch, just before validation. \r\n\r\nIf I run in our 18.09 containers, which has a version of Pytorch forked from last month's master, I see that\r\n```\r\npython -m torch.distributed.launch --nproc_per_node=2 main.py --fp16 --arch resnet18 --epochs 90 --workers 2 --batch-size=128 \r\n```\r\ntrains happily through multiple epochs of training and validation.\r\n\r\n@yingjianling  I realize this is \"black box\"/cargo cult debugging, but can you try running your case with top of tree Pytorch instead of 0.4.1?  I don't know what changes occurred in the dataloader in between, but if top of tree succeeds, at least we have additional information.\r\n\r\n"}