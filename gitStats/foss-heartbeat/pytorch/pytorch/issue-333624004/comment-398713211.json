{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/398713211", "html_url": "https://github.com/pytorch/pytorch/issues/8650#issuecomment-398713211", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/8650", "id": 398713211, "node_id": "MDEyOklzc3VlQ29tbWVudDM5ODcxMzIxMQ==", "user": {"login": "Tezirg-Wrld3D", "id": 32835343, "node_id": "MDQ6VXNlcjMyODM1MzQz", "avatar_url": "https://avatars3.githubusercontent.com/u/32835343?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Tezirg-Wrld3D", "html_url": "https://github.com/Tezirg-Wrld3D", "followers_url": "https://api.github.com/users/Tezirg-Wrld3D/followers", "following_url": "https://api.github.com/users/Tezirg-Wrld3D/following{/other_user}", "gists_url": "https://api.github.com/users/Tezirg-Wrld3D/gists{/gist_id}", "starred_url": "https://api.github.com/users/Tezirg-Wrld3D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Tezirg-Wrld3D/subscriptions", "organizations_url": "https://api.github.com/users/Tezirg-Wrld3D/orgs", "repos_url": "https://api.github.com/users/Tezirg-Wrld3D/repos", "events_url": "https://api.github.com/users/Tezirg-Wrld3D/events{/privacy}", "received_events_url": "https://api.github.com/users/Tezirg-Wrld3D/received_events", "type": "User", "site_admin": false}, "created_at": "2018-06-20T11:13:07Z", "updated_at": "2018-06-20T11:16:10Z", "author_association": "NONE", "body_html": "<p>Actually found the problem:<br>\nI was using <code>set_type(\"IterOp\");</code> instead of <code>set_type(\"Iter\");</code></p>\n<p>Then I had to specify the CPU device for the ConstantFill operation of my Iter data blob</p>\n<div class=\"highlight highlight-source-c++\"><pre><span class=\"pl-k\">auto</span> op = init_model.add_op();\nop-&gt;<span class=\"pl-en\">set_type</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ConstantFill<span class=\"pl-pds\">\"</span></span>);\n<span class=\"pl-k\">auto</span> arg1 = op-&gt;<span class=\"pl-en\">add_arg</span>();\narg1-&gt;<span class=\"pl-en\">set_name</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>shape<span class=\"pl-pds\">\"</span></span>);\narg1-&gt;<span class=\"pl-en\">add_ints</span>(<span class=\"pl-c1\">1</span>);\n<span class=\"pl-k\">auto</span> arg2 = op-&gt;<span class=\"pl-en\">add_arg</span>();\narg2-&gt;<span class=\"pl-en\">set_name</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>value<span class=\"pl-pds\">\"</span></span>);\narg2-&gt;<span class=\"pl-en\">set_i</span>(<span class=\"pl-c1\">0</span>);\n<span class=\"pl-k\">auto</span> arg3 = op-&gt;<span class=\"pl-en\">add_arg</span>();\narg3-&gt;<span class=\"pl-en\">set_name</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>dtype<span class=\"pl-pds\">\"</span></span>);\narg3-&gt;<span class=\"pl-en\">set_i</span>(caffe2::TensorProto_DataType_INT32);\nop-&gt;<span class=\"pl-en\">add_output</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ITER<span class=\"pl-pds\">\"</span></span>);\nop-&gt;<span class=\"pl-en\">mutable_device_option</span>()-&gt;set_device_type(caffe2::CPU);</pre></div>", "body_text": "Actually found the problem:\nI was using set_type(\"IterOp\"); instead of set_type(\"Iter\");\nThen I had to specify the CPU device for the ConstantFill operation of my Iter data blob\nauto op = init_model.add_op();\nop->set_type(\"ConstantFill\");\nauto arg1 = op->add_arg();\narg1->set_name(\"shape\");\narg1->add_ints(1);\nauto arg2 = op->add_arg();\narg2->set_name(\"value\");\narg2->set_i(0);\nauto arg3 = op->add_arg();\narg3->set_name(\"dtype\");\narg3->set_i(caffe2::TensorProto_DataType_INT32);\nop->add_output(\"ITER\");\nop->mutable_device_option()->set_device_type(caffe2::CPU);", "body": "Actually found the problem: \r\nI was using `set_type(\"IterOp\");` instead of `set_type(\"Iter\");`\r\n\r\nThen I had to specify the CPU device for the ConstantFill operation of my Iter data blob \r\n```cpp\r\nauto op = init_model.add_op();\r\nop->set_type(\"ConstantFill\");\r\nauto arg1 = op->add_arg();\r\narg1->set_name(\"shape\");\r\narg1->add_ints(1);\r\nauto arg2 = op->add_arg();\r\narg2->set_name(\"value\");\r\narg2->set_i(0);\r\nauto arg3 = op->add_arg();\r\narg3->set_name(\"dtype\");\r\narg3->set_i(caffe2::TensorProto_DataType_INT32);\r\nop->add_output(\"ITER\");\r\nop->mutable_device_option()->set_device_type(caffe2::CPU);\r\n```"}