{"url": "https://api.github.com/repos/pytorch/pytorch/issues/3183", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/3183/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/3183/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/3183/events", "html_url": "https://github.com/pytorch/pytorch/issues/3183", "id": 266912777, "node_id": "MDU6SXNzdWUyNjY5MTI3Nzc=", "number": 3183, "title": "THDTensor build Fails with some gcc versions", "user": {"login": "davidmascharka", "id": 5611862, "node_id": "MDQ6VXNlcjU2MTE4NjI=", "avatar_url": "https://avatars1.githubusercontent.com/u/5611862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmascharka", "html_url": "https://github.com/davidmascharka", "followers_url": "https://api.github.com/users/davidmascharka/followers", "following_url": "https://api.github.com/users/davidmascharka/following{/other_user}", "gists_url": "https://api.github.com/users/davidmascharka/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmascharka/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmascharka/subscriptions", "organizations_url": "https://api.github.com/users/davidmascharka/orgs", "repos_url": "https://api.github.com/users/davidmascharka/repos", "events_url": "https://api.github.com/users/davidmascharka/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmascharka/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-10-19T16:47:00Z", "updated_at": "2017-10-20T14:32:48Z", "closed_at": "2017-10-20T14:32:48Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a href=\"https://github.com/pytorch/pytorch/blob/cb011410b8a39f7f4891b967bd3d2d40c31167e0/torch/lib/THD/master_worker/master/generic/THDTensor.cpp#L19\">This line</a> in THDTensor is problematic for some gcc versions. The <code>inttypes.h</code> include isn't enough for older compilers. It looks like you also need to <code>#define __STDC_FORMAT_MACROS</code> to build properly.</p>\n<p>Here's a minimal example:</p>\n<div class=\"highlight highlight-source-c++\"><pre>#<span class=\"pl-k\">define</span> <span class=\"pl-en\">__STDC_FORMAT_MACROS</span>\n\n#<span class=\"pl-k\">include</span> <span class=\"pl-s\"><span class=\"pl-pds\">&lt;</span>inttypes.h<span class=\"pl-pds\">&gt;</span></span>\n#<span class=\"pl-k\">include</span> <span class=\"pl-s\"><span class=\"pl-pds\">&lt;</span>stdio.h<span class=\"pl-pds\">&gt;</span></span>\n\n<span class=\"pl-k\">int</span> <span class=\"pl-en\">main</span>() {\n    <span class=\"pl-c1\">printf</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>%<span class=\"pl-pds\">\"</span></span> PRId64 <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-cce\">\\n</span><span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">10</span>);\n    <span class=\"pl-k\">return</span> <span class=\"pl-c1\">0</span>;\n}</pre></div>\n<p>commenting out the <code>#define</code> causes the following error with gcc 4.8.5:</p>\n<pre><code>test.cpp: In function \u2018int main()\u2019:\ntest.cpp:7:16: error: expected \u2018)\u2019 before \u2018PRId64\u2019\n     printf(\"%\" PRId64 \"\\n\", 10);\n</code></pre>\n<p>but does work with gcc 5.4.0. I haven't tested with any other compilers.</p>", "body_text": "This line in THDTensor is problematic for some gcc versions. The inttypes.h include isn't enough for older compilers. It looks like you also need to #define __STDC_FORMAT_MACROS to build properly.\nHere's a minimal example:\n#define __STDC_FORMAT_MACROS\n\n#include <inttypes.h>\n#include <stdio.h>\n\nint main() {\n    printf(\"%\" PRId64 \"\\n\", 10);\n    return 0;\n}\ncommenting out the #define causes the following error with gcc 4.8.5:\ntest.cpp: In function \u2018int main()\u2019:\ntest.cpp:7:16: error: expected \u2018)\u2019 before \u2018PRId64\u2019\n     printf(\"%\" PRId64 \"\\n\", 10);\n\nbut does work with gcc 5.4.0. I haven't tested with any other compilers.", "body": "[This line](https://github.com/pytorch/pytorch/blob/cb011410b8a39f7f4891b967bd3d2d40c31167e0/torch/lib/THD/master_worker/master/generic/THDTensor.cpp#L19) in THDTensor is problematic for some gcc versions. The `inttypes.h` include isn't enough for older compilers. It looks like you also need to `#define __STDC_FORMAT_MACROS` to build properly.\r\n\r\nHere's a minimal example:\r\n\r\n```c++\r\n#define __STDC_FORMAT_MACROS\r\n\r\n#include <inttypes.h>\r\n#include <stdio.h>\r\n\r\nint main() {\r\n    printf(\"%\" PRId64 \"\\n\", 10);\r\n    return 0;\r\n}\r\n```\r\n\r\ncommenting out the `#define` causes the following error with gcc 4.8.5:\r\n\r\n```\r\ntest.cpp: In function \u2018int main()\u2019:\r\ntest.cpp:7:16: error: expected \u2018)\u2019 before \u2018PRId64\u2019\r\n     printf(\"%\" PRId64 \"\\n\", 10);\r\n```\r\n\r\nbut does work with gcc 5.4.0. I haven't tested with any other compilers."}