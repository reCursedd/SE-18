{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/411189969", "html_url": "https://github.com/pytorch/pytorch/issues/10229#issuecomment-411189969", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/10229", "id": 411189969, "node_id": "MDEyOklzc3VlQ29tbWVudDQxMTE4OTk2OQ==", "user": {"login": "ailzhang", "id": 5248122, "node_id": "MDQ6VXNlcjUyNDgxMjI=", "avatar_url": "https://avatars2.githubusercontent.com/u/5248122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ailzhang", "html_url": "https://github.com/ailzhang", "followers_url": "https://api.github.com/users/ailzhang/followers", "following_url": "https://api.github.com/users/ailzhang/following{/other_user}", "gists_url": "https://api.github.com/users/ailzhang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ailzhang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ailzhang/subscriptions", "organizations_url": "https://api.github.com/users/ailzhang/orgs", "repos_url": "https://api.github.com/users/ailzhang/repos", "events_url": "https://api.github.com/users/ailzhang/events{/privacy}", "received_events_url": "https://api.github.com/users/ailzhang/received_events", "type": "User", "site_admin": false}, "created_at": "2018-08-07T20:24:24Z", "updated_at": "2018-08-07T20:24:24Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Found the right command to enforce kernel launch (export MXNET_ENGINE_TYPE=NaiveEngine) and here's the update perf. The numbers are close, especially the kernel time spent shown in nvprof, although it's still a bit slower in general. <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=15841449\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ngimel\">@ngimel</a>  any idea how this can be further improved? :)</p>\n<pre><code> \u03bb ~ python 10229.py\n/private/home/ailzhang/miniconda3/lib/python3.6/site-packages/urllib3/contrib/pyopenssl.py:46: DeprecationWarning: OpenSSL.rand is deprecated - you should use os.urandom instead\n  import OpenSSL.SSL\nPytorch testing:\nOutChannel:256, Group:1, Time:0.8669874668121338\nOutChannel:256, Group:2, Time:0.6110000610351562\nOutChannel:256, Group:4, Time:0.40593385696411133\nOutChannel:256, Group:8, Time:0.19748449325561523\nOutChannel:256, Group:16, Time:0.30086755752563477\nOutChannel:256, Group:32, Time:0.5136899948120117\nOutChannel:256, Group:64, Time:0.9273054599761963\nOutChannel:256, Group:128, Time:1.7813796997070312\nOutChannel:256, Group:256, Time:0.05748271942138672\nOutChannel:512, Group:1, Time:0.3776583671569824\nOutChannel:512, Group:2, Time:0.6384704113006592\nOutChannel:512, Group:4, Time:0.43076610565185547\nOutChannel:512, Group:8, Time:0.23347163200378418\nOutChannel:512, Group:16, Time:0.3054044246673584\nOutChannel:512, Group:32, Time:0.5156643390655518\nOutChannel:512, Group:64, Time:0.9284119606018066\nOutChannel:512, Group:128, Time:1.7722992897033691\nOutChannel:512, Group:256, Time:0.05848836898803711\nOutChannel:512, Group:512, Time:0.058203935623168945\nOutChannel:1024, Group:1, Time:0.7848114967346191\nOutChannel:1024, Group:2, Time:0.7653074264526367\nOutChannel:1024, Group:4, Time:0.5440354347229004\nOutChannel:1024, Group:8, Time:0.29901933670043945\nOutChannel:1024, Group:16, Time:0.30808281898498535\nOutChannel:1024, Group:32, Time:0.5171351432800293\nOutChannel:1024, Group:64, Time:0.9506747722625732\nOutChannel:1024, Group:128, Time:1.800419807434082\nOutChannel:1024, Group:256, Time:0.05892205238342285\nOutChannel:1024, Group:512, Time:0.05730032920837402\nOutChannel:1024, Group:1024, Time:0.031682729721069336\nOutChannel:2048, Group:1, Time:1.6538004875183105\nOutChannel:2048, Group:2, Time:1.499765157699585\nOutChannel:2048, Group:4, Time:0.8753867149353027\nOutChannel:2048, Group:8, Time:0.5235047340393066\nOutChannel:2048, Group:16, Time:0.36252284049987793\nOutChannel:2048, Group:32, Time:0.5182161331176758\nOutChannel:2048, Group:64, Time:0.9530549049377441\nOutChannel:2048, Group:128, Time:1.825690507888794\nOutChannel:2048, Group:256, Time:0.06976127624511719\nOutChannel:2048, Group:512, Time:0.06025123596191406\nOutChannel:2048, Group:1024, Time:0.03231954574584961\nMxnet testing:\n[13:16:18] src/engine/engine.cc:55: MXNet start using engine: NaiveEngine\n[13:16:20] src/operator/nn/./cudnn/./cudnn_algoreg-inl.h:107: Running performance tests to find the best convolution algorithm, this can take a while... (setting env variable MXNET_CUDNN_AUTOTUNE_DEFAULT to 0 to disable)\nOutChannel:256, Group:1, Time:0.6017172336578369\nOutChannel:256, Group:2, Time:0.414600133895874\nOutChannel:256, Group:4, Time:0.37932562828063965\nOutChannel:256, Group:8, Time:0.4258706569671631\nOutChannel:256, Group:16, Time:0.4455239772796631\nOutChannel:256, Group:32, Time:0.5849206447601318\nOutChannel:256, Group:64, Time:0.8991494178771973\nOutChannel:256, Group:128, Time:1.6287968158721924\nOutChannel:256, Group:256, Time:2.8902885913848877\nOutChannel:512, Group:1, Time:1.1513350009918213\nOutChannel:512, Group:2, Time:0.5768940448760986\nOutChannel:512, Group:4, Time:0.41323256492614746\nOutChannel:512, Group:8, Time:0.3937795162200928\nOutChannel:512, Group:16, Time:0.4500117301940918\nOutChannel:512, Group:32, Time:0.5608577728271484\nOutChannel:512, Group:64, Time:0.9582664966583252\nOutChannel:512, Group:128, Time:1.5262198448181152\nOutChannel:512, Group:256, Time:2.826936960220337\nOutChannel:512, Group:512, Time:5.390891075134277\nOutChannel:1024, Group:1, Time:2.3451201915740967\nOutChannel:1024, Group:2, Time:1.2541780471801758\nOutChannel:1024, Group:4, Time:0.5795691013336182\nOutChannel:1024, Group:8, Time:0.4481794834136963\nOutChannel:1024, Group:16, Time:0.46959853172302246\nOutChannel:1024, Group:32, Time:0.5889122486114502\nOutChannel:1024, Group:64, Time:0.9274506568908691\nOutChannel:1024, Group:128, Time:1.717729091644287\nOutChannel:1024, Group:256, Time:2.82771897315979\nOutChannel:1024, Group:512, Time:5.3689186573028564\nOutChannel:1024, Group:1024, Time:0.8016271591186523\nOutChannel:2048, Group:1, Time:2.6470489501953125\nOutChannel:2048, Group:2, Time:2.0326945781707764\nOutChannel:2048, Group:4, Time:0.8291740417480469\nOutChannel:2048, Group:8, Time:0.6124267578125\nOutChannel:2048, Group:16, Time:0.5176849365234375\nOutChannel:2048, Group:32, Time:0.6203253269195557\nOutChannel:2048, Group:64, Time:0.9143955707550049\nOutChannel:2048, Group:128, Time:1.616405963897705\nOutChannel:2048, Group:256, Time:2.9386751651763916\nOutChannel:2048, Group:512, Time:5.4872753620147705\nOutChannel:2048, Group:1024, Time:10.75217056274414\n[13:19:39] src/engine/naive_engine.cc:55: Engine shutdown\n</code></pre>", "body_text": "Found the right command to enforce kernel launch (export MXNET_ENGINE_TYPE=NaiveEngine) and here's the update perf. The numbers are close, especially the kernel time spent shown in nvprof, although it's still a bit slower in general. @ngimel  any idea how this can be further improved? :)\n \u03bb ~ python 10229.py\n/private/home/ailzhang/miniconda3/lib/python3.6/site-packages/urllib3/contrib/pyopenssl.py:46: DeprecationWarning: OpenSSL.rand is deprecated - you should use os.urandom instead\n  import OpenSSL.SSL\nPytorch testing:\nOutChannel:256, Group:1, Time:0.8669874668121338\nOutChannel:256, Group:2, Time:0.6110000610351562\nOutChannel:256, Group:4, Time:0.40593385696411133\nOutChannel:256, Group:8, Time:0.19748449325561523\nOutChannel:256, Group:16, Time:0.30086755752563477\nOutChannel:256, Group:32, Time:0.5136899948120117\nOutChannel:256, Group:64, Time:0.9273054599761963\nOutChannel:256, Group:128, Time:1.7813796997070312\nOutChannel:256, Group:256, Time:0.05748271942138672\nOutChannel:512, Group:1, Time:0.3776583671569824\nOutChannel:512, Group:2, Time:0.6384704113006592\nOutChannel:512, Group:4, Time:0.43076610565185547\nOutChannel:512, Group:8, Time:0.23347163200378418\nOutChannel:512, Group:16, Time:0.3054044246673584\nOutChannel:512, Group:32, Time:0.5156643390655518\nOutChannel:512, Group:64, Time:0.9284119606018066\nOutChannel:512, Group:128, Time:1.7722992897033691\nOutChannel:512, Group:256, Time:0.05848836898803711\nOutChannel:512, Group:512, Time:0.058203935623168945\nOutChannel:1024, Group:1, Time:0.7848114967346191\nOutChannel:1024, Group:2, Time:0.7653074264526367\nOutChannel:1024, Group:4, Time:0.5440354347229004\nOutChannel:1024, Group:8, Time:0.29901933670043945\nOutChannel:1024, Group:16, Time:0.30808281898498535\nOutChannel:1024, Group:32, Time:0.5171351432800293\nOutChannel:1024, Group:64, Time:0.9506747722625732\nOutChannel:1024, Group:128, Time:1.800419807434082\nOutChannel:1024, Group:256, Time:0.05892205238342285\nOutChannel:1024, Group:512, Time:0.05730032920837402\nOutChannel:1024, Group:1024, Time:0.031682729721069336\nOutChannel:2048, Group:1, Time:1.6538004875183105\nOutChannel:2048, Group:2, Time:1.499765157699585\nOutChannel:2048, Group:4, Time:0.8753867149353027\nOutChannel:2048, Group:8, Time:0.5235047340393066\nOutChannel:2048, Group:16, Time:0.36252284049987793\nOutChannel:2048, Group:32, Time:0.5182161331176758\nOutChannel:2048, Group:64, Time:0.9530549049377441\nOutChannel:2048, Group:128, Time:1.825690507888794\nOutChannel:2048, Group:256, Time:0.06976127624511719\nOutChannel:2048, Group:512, Time:0.06025123596191406\nOutChannel:2048, Group:1024, Time:0.03231954574584961\nMxnet testing:\n[13:16:18] src/engine/engine.cc:55: MXNet start using engine: NaiveEngine\n[13:16:20] src/operator/nn/./cudnn/./cudnn_algoreg-inl.h:107: Running performance tests to find the best convolution algorithm, this can take a while... (setting env variable MXNET_CUDNN_AUTOTUNE_DEFAULT to 0 to disable)\nOutChannel:256, Group:1, Time:0.6017172336578369\nOutChannel:256, Group:2, Time:0.414600133895874\nOutChannel:256, Group:4, Time:0.37932562828063965\nOutChannel:256, Group:8, Time:0.4258706569671631\nOutChannel:256, Group:16, Time:0.4455239772796631\nOutChannel:256, Group:32, Time:0.5849206447601318\nOutChannel:256, Group:64, Time:0.8991494178771973\nOutChannel:256, Group:128, Time:1.6287968158721924\nOutChannel:256, Group:256, Time:2.8902885913848877\nOutChannel:512, Group:1, Time:1.1513350009918213\nOutChannel:512, Group:2, Time:0.5768940448760986\nOutChannel:512, Group:4, Time:0.41323256492614746\nOutChannel:512, Group:8, Time:0.3937795162200928\nOutChannel:512, Group:16, Time:0.4500117301940918\nOutChannel:512, Group:32, Time:0.5608577728271484\nOutChannel:512, Group:64, Time:0.9582664966583252\nOutChannel:512, Group:128, Time:1.5262198448181152\nOutChannel:512, Group:256, Time:2.826936960220337\nOutChannel:512, Group:512, Time:5.390891075134277\nOutChannel:1024, Group:1, Time:2.3451201915740967\nOutChannel:1024, Group:2, Time:1.2541780471801758\nOutChannel:1024, Group:4, Time:0.5795691013336182\nOutChannel:1024, Group:8, Time:0.4481794834136963\nOutChannel:1024, Group:16, Time:0.46959853172302246\nOutChannel:1024, Group:32, Time:0.5889122486114502\nOutChannel:1024, Group:64, Time:0.9274506568908691\nOutChannel:1024, Group:128, Time:1.717729091644287\nOutChannel:1024, Group:256, Time:2.82771897315979\nOutChannel:1024, Group:512, Time:5.3689186573028564\nOutChannel:1024, Group:1024, Time:0.8016271591186523\nOutChannel:2048, Group:1, Time:2.6470489501953125\nOutChannel:2048, Group:2, Time:2.0326945781707764\nOutChannel:2048, Group:4, Time:0.8291740417480469\nOutChannel:2048, Group:8, Time:0.6124267578125\nOutChannel:2048, Group:16, Time:0.5176849365234375\nOutChannel:2048, Group:32, Time:0.6203253269195557\nOutChannel:2048, Group:64, Time:0.9143955707550049\nOutChannel:2048, Group:128, Time:1.616405963897705\nOutChannel:2048, Group:256, Time:2.9386751651763916\nOutChannel:2048, Group:512, Time:5.4872753620147705\nOutChannel:2048, Group:1024, Time:10.75217056274414\n[13:19:39] src/engine/naive_engine.cc:55: Engine shutdown", "body": "Found the right command to enforce kernel launch (export MXNET_ENGINE_TYPE=NaiveEngine) and here's the update perf. The numbers are close, especially the kernel time spent shown in nvprof, although it's still a bit slower in general. @ngimel  any idea how this can be further improved? :) \r\n\r\n```\r\n \u03bb ~ python 10229.py\r\n/private/home/ailzhang/miniconda3/lib/python3.6/site-packages/urllib3/contrib/pyopenssl.py:46: DeprecationWarning: OpenSSL.rand is deprecated - you should use os.urandom instead\r\n  import OpenSSL.SSL\r\nPytorch testing:\r\nOutChannel:256, Group:1, Time:0.8669874668121338\r\nOutChannel:256, Group:2, Time:0.6110000610351562\r\nOutChannel:256, Group:4, Time:0.40593385696411133\r\nOutChannel:256, Group:8, Time:0.19748449325561523\r\nOutChannel:256, Group:16, Time:0.30086755752563477\r\nOutChannel:256, Group:32, Time:0.5136899948120117\r\nOutChannel:256, Group:64, Time:0.9273054599761963\r\nOutChannel:256, Group:128, Time:1.7813796997070312\r\nOutChannel:256, Group:256, Time:0.05748271942138672\r\nOutChannel:512, Group:1, Time:0.3776583671569824\r\nOutChannel:512, Group:2, Time:0.6384704113006592\r\nOutChannel:512, Group:4, Time:0.43076610565185547\r\nOutChannel:512, Group:8, Time:0.23347163200378418\r\nOutChannel:512, Group:16, Time:0.3054044246673584\r\nOutChannel:512, Group:32, Time:0.5156643390655518\r\nOutChannel:512, Group:64, Time:0.9284119606018066\r\nOutChannel:512, Group:128, Time:1.7722992897033691\r\nOutChannel:512, Group:256, Time:0.05848836898803711\r\nOutChannel:512, Group:512, Time:0.058203935623168945\r\nOutChannel:1024, Group:1, Time:0.7848114967346191\r\nOutChannel:1024, Group:2, Time:0.7653074264526367\r\nOutChannel:1024, Group:4, Time:0.5440354347229004\r\nOutChannel:1024, Group:8, Time:0.29901933670043945\r\nOutChannel:1024, Group:16, Time:0.30808281898498535\r\nOutChannel:1024, Group:32, Time:0.5171351432800293\r\nOutChannel:1024, Group:64, Time:0.9506747722625732\r\nOutChannel:1024, Group:128, Time:1.800419807434082\r\nOutChannel:1024, Group:256, Time:0.05892205238342285\r\nOutChannel:1024, Group:512, Time:0.05730032920837402\r\nOutChannel:1024, Group:1024, Time:0.031682729721069336\r\nOutChannel:2048, Group:1, Time:1.6538004875183105\r\nOutChannel:2048, Group:2, Time:1.499765157699585\r\nOutChannel:2048, Group:4, Time:0.8753867149353027\r\nOutChannel:2048, Group:8, Time:0.5235047340393066\r\nOutChannel:2048, Group:16, Time:0.36252284049987793\r\nOutChannel:2048, Group:32, Time:0.5182161331176758\r\nOutChannel:2048, Group:64, Time:0.9530549049377441\r\nOutChannel:2048, Group:128, Time:1.825690507888794\r\nOutChannel:2048, Group:256, Time:0.06976127624511719\r\nOutChannel:2048, Group:512, Time:0.06025123596191406\r\nOutChannel:2048, Group:1024, Time:0.03231954574584961\r\nMxnet testing:\r\n[13:16:18] src/engine/engine.cc:55: MXNet start using engine: NaiveEngine\r\n[13:16:20] src/operator/nn/./cudnn/./cudnn_algoreg-inl.h:107: Running performance tests to find the best convolution algorithm, this can take a while... (setting env variable MXNET_CUDNN_AUTOTUNE_DEFAULT to 0 to disable)\r\nOutChannel:256, Group:1, Time:0.6017172336578369\r\nOutChannel:256, Group:2, Time:0.414600133895874\r\nOutChannel:256, Group:4, Time:0.37932562828063965\r\nOutChannel:256, Group:8, Time:0.4258706569671631\r\nOutChannel:256, Group:16, Time:0.4455239772796631\r\nOutChannel:256, Group:32, Time:0.5849206447601318\r\nOutChannel:256, Group:64, Time:0.8991494178771973\r\nOutChannel:256, Group:128, Time:1.6287968158721924\r\nOutChannel:256, Group:256, Time:2.8902885913848877\r\nOutChannel:512, Group:1, Time:1.1513350009918213\r\nOutChannel:512, Group:2, Time:0.5768940448760986\r\nOutChannel:512, Group:4, Time:0.41323256492614746\r\nOutChannel:512, Group:8, Time:0.3937795162200928\r\nOutChannel:512, Group:16, Time:0.4500117301940918\r\nOutChannel:512, Group:32, Time:0.5608577728271484\r\nOutChannel:512, Group:64, Time:0.9582664966583252\r\nOutChannel:512, Group:128, Time:1.5262198448181152\r\nOutChannel:512, Group:256, Time:2.826936960220337\r\nOutChannel:512, Group:512, Time:5.390891075134277\r\nOutChannel:1024, Group:1, Time:2.3451201915740967\r\nOutChannel:1024, Group:2, Time:1.2541780471801758\r\nOutChannel:1024, Group:4, Time:0.5795691013336182\r\nOutChannel:1024, Group:8, Time:0.4481794834136963\r\nOutChannel:1024, Group:16, Time:0.46959853172302246\r\nOutChannel:1024, Group:32, Time:0.5889122486114502\r\nOutChannel:1024, Group:64, Time:0.9274506568908691\r\nOutChannel:1024, Group:128, Time:1.717729091644287\r\nOutChannel:1024, Group:256, Time:2.82771897315979\r\nOutChannel:1024, Group:512, Time:5.3689186573028564\r\nOutChannel:1024, Group:1024, Time:0.8016271591186523\r\nOutChannel:2048, Group:1, Time:2.6470489501953125\r\nOutChannel:2048, Group:2, Time:2.0326945781707764\r\nOutChannel:2048, Group:4, Time:0.8291740417480469\r\nOutChannel:2048, Group:8, Time:0.6124267578125\r\nOutChannel:2048, Group:16, Time:0.5176849365234375\r\nOutChannel:2048, Group:32, Time:0.6203253269195557\r\nOutChannel:2048, Group:64, Time:0.9143955707550049\r\nOutChannel:2048, Group:128, Time:1.616405963897705\r\nOutChannel:2048, Group:256, Time:2.9386751651763916\r\nOutChannel:2048, Group:512, Time:5.4872753620147705\r\nOutChannel:2048, Group:1024, Time:10.75217056274414\r\n[13:19:39] src/engine/naive_engine.cc:55: Engine shutdown\r\n```"}