{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/418885424", "html_url": "https://github.com/pytorch/pytorch/pull/10842#issuecomment-418885424", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/10842", "id": 418885424, "node_id": "MDEyOklzc3VlQ29tbWVudDQxODg4NTQyNA==", "user": {"login": "mcarilli", "id": 7799218, "node_id": "MDQ6VXNlcjc3OTkyMTg=", "avatar_url": "https://avatars0.githubusercontent.com/u/7799218?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarilli", "html_url": "https://github.com/mcarilli", "followers_url": "https://api.github.com/users/mcarilli/followers", "following_url": "https://api.github.com/users/mcarilli/following{/other_user}", "gists_url": "https://api.github.com/users/mcarilli/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarilli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarilli/subscriptions", "organizations_url": "https://api.github.com/users/mcarilli/orgs", "repos_url": "https://api.github.com/users/mcarilli/repos", "events_url": "https://api.github.com/users/mcarilli/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarilli/received_events", "type": "User", "site_admin": false}, "created_at": "2018-09-05T21:20:39Z", "updated_at": "2018-09-05T21:20:39Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=13564\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ezyang\">@ezyang</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=5652049\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/zou3519\">@zou3519</a><br>\nI fixed most of the failing builds, which turned out to be user error.  I was mixing the CPU and GPU code paths in a way that caused CPU-only builds to fail (this was tricky to identify, because some of the build failures were nominally cuda builds).  Thanks to <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=15841449\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ngimel\">@ngimel</a> for proposing that I attempt a local build in a cuda-free container, which enabled me to reproduce and fix the compilation.</p>\n<p>I've reorganized my dispatch paths in a way that properly disentangles CPU-only builds from any GPU-specific function dependencies.</p>\n<p>Unfortunately, I still have two problems:</p>\n<ol>\n<li>Rocm builds are still failing, with the same error as before, variants of</li>\n</ol>\n<pre><code>22:04:03 /var/lib/jenkins/workspace/aten/src/ATen/native/cuda/WeightNorm.cu:353:9: error: no matching function for call to 'hipLaunchKernelGGL'\n...\n22:04:03 /opt/rocm/hip/include/hip/hcc_detail/functional_grid_launch.hpp:86:13: note: candidate function [with Args = &lt;float *, float *, float *, float *, int&gt;, F = void (*)(float *, float *, float *, float *, int)] not viable: no overload of 'weight_norm_fwd_first_dim_kernel' matching 'void (*)(float *, float *, float *, float *, int)' for 1st argument\n</code></pre>\n<ol start=\"2\">\n<li>Onnx tests are failing, with errors like</li>\n</ol>\n<pre><code>23:00:16 E           RuntimeError: ONNX export failed: Couldn't export operator aten::_weight_norm\n</code></pre>\n<p>Again, I'd appreciate any advice you can give, or at least a pointer to the right people to ask.</p>", "body_text": "@ezyang @zou3519\nI fixed most of the failing builds, which turned out to be user error.  I was mixing the CPU and GPU code paths in a way that caused CPU-only builds to fail (this was tricky to identify, because some of the build failures were nominally cuda builds).  Thanks to @ngimel for proposing that I attempt a local build in a cuda-free container, which enabled me to reproduce and fix the compilation.\nI've reorganized my dispatch paths in a way that properly disentangles CPU-only builds from any GPU-specific function dependencies.\nUnfortunately, I still have two problems:\n\nRocm builds are still failing, with the same error as before, variants of\n\n22:04:03 /var/lib/jenkins/workspace/aten/src/ATen/native/cuda/WeightNorm.cu:353:9: error: no matching function for call to 'hipLaunchKernelGGL'\n...\n22:04:03 /opt/rocm/hip/include/hip/hcc_detail/functional_grid_launch.hpp:86:13: note: candidate function [with Args = <float *, float *, float *, float *, int>, F = void (*)(float *, float *, float *, float *, int)] not viable: no overload of 'weight_norm_fwd_first_dim_kernel' matching 'void (*)(float *, float *, float *, float *, int)' for 1st argument\n\n\nOnnx tests are failing, with errors like\n\n23:00:16 E           RuntimeError: ONNX export failed: Couldn't export operator aten::_weight_norm\n\nAgain, I'd appreciate any advice you can give, or at least a pointer to the right people to ask.", "body": "@ezyang @zou3519\r\nI fixed most of the failing builds, which turned out to be user error.  I was mixing the CPU and GPU code paths in a way that caused CPU-only builds to fail (this was tricky to identify, because some of the build failures were nominally cuda builds).  Thanks to @ngimel for proposing that I attempt a local build in a cuda-free container, which enabled me to reproduce and fix the compilation.\r\n\r\nI've reorganized my dispatch paths in a way that properly disentangles CPU-only builds from any GPU-specific function dependencies.\r\n\r\nUnfortunately, I still have two problems:\r\n1.  Rocm builds are still failing, with the same error as before, variants of\r\n```\r\n22:04:03 /var/lib/jenkins/workspace/aten/src/ATen/native/cuda/WeightNorm.cu:353:9: error: no matching function for call to 'hipLaunchKernelGGL'\r\n...\r\n22:04:03 /opt/rocm/hip/include/hip/hcc_detail/functional_grid_launch.hpp:86:13: note: candidate function [with Args = <float *, float *, float *, float *, int>, F = void (*)(float *, float *, float *, float *, int)] not viable: no overload of 'weight_norm_fwd_first_dim_kernel' matching 'void (*)(float *, float *, float *, float *, int)' for 1st argument\r\n```\r\n\r\n2.  Onnx tests are failing, with errors like \r\n```\r\n23:00:16 E           RuntimeError: ONNX export failed: Couldn't export operator aten::_weight_norm\r\n```\r\n\r\nAgain, I'd appreciate any advice you can give, or at least a pointer to the right people to ask.\r\n\r\n"}