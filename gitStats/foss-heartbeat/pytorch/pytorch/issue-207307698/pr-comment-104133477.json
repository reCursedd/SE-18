{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/104133477", "pull_request_review_id": 24938958, "id": 104133477, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEwNDEzMzQ3Nw==", "diff_hunk": "@@ -329,20 +481,26 @@ void THSTensor_(reorder)(THSTensor *self) {\n   for (j = 1; j < self->nnz; j++) {\n     cmp = 1;\n     // TODO: pass eps in as a parameter\n-    if (values[j] == 0) continue;\n-    for (d = 0; d < ndim; d++)\n+    // if (values[j] == 0) continue;\n+    for (d = 0; d < nDimI; d++)\n       if (IND(i, d) != IND(j, d)) {\n         cmp = 0;\n         break;\n       }\n-    if (cmp) values[i] += values[j];\n+    if (cmp) {\n+      THSTensor_(addSlice)(dstBuffer, dstBuffer, srcBuffer, values_, values_, 1, values_, 0, i, i, j);", "path": "torch/lib/THS/generic/THSTensor.c", "position": 425, "original_position": 437, "commit_id": "d5a99574d20676583112f982ab429a1ea1ae1a5b", "original_commit_id": "27e053e0c70da19a221e7b9829edde4be2aa6a45", "user": {"login": "martinraison", "id": 2560662, "node_id": "MDQ6VXNlcjI1NjA2NjI=", "avatar_url": "https://avatars3.githubusercontent.com/u/2560662?v=4", "gravatar_id": "", "url": "https://api.github.com/users/martinraison", "html_url": "https://github.com/martinraison", "followers_url": "https://api.github.com/users/martinraison/followers", "following_url": "https://api.github.com/users/martinraison/following{/other_user}", "gists_url": "https://api.github.com/users/martinraison/gists{/gist_id}", "starred_url": "https://api.github.com/users/martinraison/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/martinraison/subscriptions", "organizations_url": "https://api.github.com/users/martinraison/orgs", "repos_url": "https://api.github.com/users/martinraison/repos", "events_url": "https://api.github.com/users/martinraison/events{/privacy}", "received_events_url": "https://api.github.com/users/martinraison/received_events", "type": "User", "site_admin": false}, "body": "The intent was to stay as close as possible to the semantics of `THTensor_(cadd)` (with the addition of buffers and slice indices). We could allow `src1Buffer` to be `NULL` and then just ignore `src1Idx1` but I'm not sure if that really makes it easier to understand.", "created_at": "2017-03-03T11:10:19Z", "updated_at": "2018-11-23T15:32:42Z", "html_url": "https://github.com/pytorch/pytorch/pull/735#discussion_r104133477", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/735", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/104133477"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/735#discussion_r104133477"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/735"}}, "body_html": "<p>The intent was to stay as close as possible to the semantics of <code>THTensor_(cadd)</code> (with the addition of buffers and slice indices). We could allow <code>src1Buffer</code> to be <code>NULL</code> and then just ignore <code>src1Idx1</code> but I'm not sure if that really makes it easier to understand.</p>", "body_text": "The intent was to stay as close as possible to the semantics of THTensor_(cadd) (with the addition of buffers and slice indices). We could allow src1Buffer to be NULL and then just ignore src1Idx1 but I'm not sure if that really makes it easier to understand.", "in_reply_to_id": 104006436}