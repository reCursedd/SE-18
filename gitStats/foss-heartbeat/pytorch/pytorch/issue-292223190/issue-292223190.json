{"url": "https://api.github.com/repos/pytorch/pytorch/issues/4900", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/4900/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/4900/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/4900/events", "html_url": "https://github.com/pytorch/pytorch/issues/4900", "id": 292223190, "node_id": "MDU6SXNzdWUyOTIyMjMxOTA=", "number": 4900, "title": "Sorting Variables is very slow", "user": {"login": "jojonki", "id": 166852, "node_id": "MDQ6VXNlcjE2Njg1Mg==", "avatar_url": "https://avatars0.githubusercontent.com/u/166852?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jojonki", "html_url": "https://github.com/jojonki", "followers_url": "https://api.github.com/users/jojonki/followers", "following_url": "https://api.github.com/users/jojonki/following{/other_user}", "gists_url": "https://api.github.com/users/jojonki/gists{/gist_id}", "starred_url": "https://api.github.com/users/jojonki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jojonki/subscriptions", "organizations_url": "https://api.github.com/users/jojonki/orgs", "repos_url": "https://api.github.com/users/jojonki/repos", "events_url": "https://api.github.com/users/jojonki/events{/privacy}", "received_events_url": "https://api.github.com/users/jojonki/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-01-28T17:44:17Z", "updated_at": "2018-01-28T18:06:38Z", "closed_at": "2018-01-28T18:06:38Z", "author_association": "NONE", "body_html": "<p>I noticed sorting <code>Variable</code> is much slower than other sortings. Please find a reproducing code.<br>\nAnd it may be related to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"248235571\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/2303\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/2303/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/2303\">#2303</a> that has been already resolved.</p>\n<ul>\n<li>OS:Ubuntu 16.04.5</li>\n<li>PyTorch version: '0.4.0a0+040336f' (from source)</li>\n<li>How you installed PyTorch (conda, pip, source):</li>\n<li>Python version:3.6.3 (Anaconda)</li>\n<li>GCC version (if compiling from source):gcc (Ubuntu 5.4.0-6ubuntu1~16.04.5) 5.4.0 20160609</li>\n</ul>\n<pre><code>import time\nimport torch\nfrom torch.autograd import Variable\n\nN = 10000\nd1 = Variable(torch.randn(10, N))\nd2 = torch.randn(10, N)\nd3 = d1.data.numpy()\n\nstart = time.time()\n_ = [sorted(range(N), key=lambda k: d[k]) for d in d1]\nelapsed_time = time.time() - start\nprint(\"elapsed_time:{0}\".format(elapsed_time) + \"[sec]\")\n\nstart = time.time()\n_ = [sorted(range(N), key=lambda k: d[k]) for d in d2]\nelapsed_time = time.time() - start\nprint(\"elapsed_time:{0}\".format(elapsed_time) + \"[sec]\")\n\nstart = time.time()\n_ = [sorted(range(N), key=lambda k: d[k]) for d in d3]\nelapsed_time = time.time() - start\nprint(\"elapsed_time:{0}\".format(elapsed_time) + \"[sec]\")\n</code></pre>\n<p>Then, the result is here.</p>\n<pre><code>$ python bench.py  \nelapsed_time:1.1007232666015625[sec]\nelapsed_time:0.04404330253601074[sec]\nelapsed_time:0.03660702705383301[sec]\n</code></pre>\n<p>And I tried this in pytorch 0.3 on MacBook, pytorch does not allow to sort Variables in this version.</p>\n<pre><code>$ python bench.py \nTraceback (most recent call last):\n  File \"bench.py\", line 11, in &lt;module&gt;\n    _ = [sorted(range(N), key=lambda k: d[k]) for d in d1]\n  File \"bench.py\", line 11, in &lt;listcomp&gt;\n    _ = [sorted(range(N), key=lambda k: d[k]) for d in d1]\n  File \"/Users/jonki/anaconda/lib/python3.6/site-packages/torch/autograd/variable.py\", line 125, in __bool__\n    torch.typename(self.data) + \" is ambiguous\")\nRuntimeError: bool value of Variable objects containing non-empty torch.ByteTensor is ambiguous\n</code></pre>", "body_text": "I noticed sorting Variable is much slower than other sortings. Please find a reproducing code.\nAnd it may be related to #2303 that has been already resolved.\n\nOS:Ubuntu 16.04.5\nPyTorch version: '0.4.0a0+040336f' (from source)\nHow you installed PyTorch (conda, pip, source):\nPython version:3.6.3 (Anaconda)\nGCC version (if compiling from source):gcc (Ubuntu 5.4.0-6ubuntu1~16.04.5) 5.4.0 20160609\n\nimport time\nimport torch\nfrom torch.autograd import Variable\n\nN = 10000\nd1 = Variable(torch.randn(10, N))\nd2 = torch.randn(10, N)\nd3 = d1.data.numpy()\n\nstart = time.time()\n_ = [sorted(range(N), key=lambda k: d[k]) for d in d1]\nelapsed_time = time.time() - start\nprint(\"elapsed_time:{0}\".format(elapsed_time) + \"[sec]\")\n\nstart = time.time()\n_ = [sorted(range(N), key=lambda k: d[k]) for d in d2]\nelapsed_time = time.time() - start\nprint(\"elapsed_time:{0}\".format(elapsed_time) + \"[sec]\")\n\nstart = time.time()\n_ = [sorted(range(N), key=lambda k: d[k]) for d in d3]\nelapsed_time = time.time() - start\nprint(\"elapsed_time:{0}\".format(elapsed_time) + \"[sec]\")\n\nThen, the result is here.\n$ python bench.py  \nelapsed_time:1.1007232666015625[sec]\nelapsed_time:0.04404330253601074[sec]\nelapsed_time:0.03660702705383301[sec]\n\nAnd I tried this in pytorch 0.3 on MacBook, pytorch does not allow to sort Variables in this version.\n$ python bench.py \nTraceback (most recent call last):\n  File \"bench.py\", line 11, in <module>\n    _ = [sorted(range(N), key=lambda k: d[k]) for d in d1]\n  File \"bench.py\", line 11, in <listcomp>\n    _ = [sorted(range(N), key=lambda k: d[k]) for d in d1]\n  File \"/Users/jonki/anaconda/lib/python3.6/site-packages/torch/autograd/variable.py\", line 125, in __bool__\n    torch.typename(self.data) + \" is ambiguous\")\nRuntimeError: bool value of Variable objects containing non-empty torch.ByteTensor is ambiguous", "body": "I noticed sorting `Variable` is much slower than other sortings. Please find a reproducing code.\r\nAnd it may be related to #2303 that has been already resolved.\r\n\r\n- OS:Ubuntu 16.04.5\r\n- PyTorch version: '0.4.0a0+040336f' (from source)\r\n- How you installed PyTorch (conda, pip, source):\r\n- Python version:3.6.3 (Anaconda)\r\n- GCC version (if compiling from source):gcc (Ubuntu 5.4.0-6ubuntu1~16.04.5) 5.4.0 20160609\r\n\r\n\r\n```\r\nimport time\r\nimport torch\r\nfrom torch.autograd import Variable\r\n\r\nN = 10000\r\nd1 = Variable(torch.randn(10, N))\r\nd2 = torch.randn(10, N)\r\nd3 = d1.data.numpy()\r\n\r\nstart = time.time()\r\n_ = [sorted(range(N), key=lambda k: d[k]) for d in d1]\r\nelapsed_time = time.time() - start\r\nprint(\"elapsed_time:{0}\".format(elapsed_time) + \"[sec]\")\r\n\r\nstart = time.time()\r\n_ = [sorted(range(N), key=lambda k: d[k]) for d in d2]\r\nelapsed_time = time.time() - start\r\nprint(\"elapsed_time:{0}\".format(elapsed_time) + \"[sec]\")\r\n\r\nstart = time.time()\r\n_ = [sorted(range(N), key=lambda k: d[k]) for d in d3]\r\nelapsed_time = time.time() - start\r\nprint(\"elapsed_time:{0}\".format(elapsed_time) + \"[sec]\")\r\n```\r\n\r\nThen, the result is here.\r\n```\r\n$ python bench.py  \r\nelapsed_time:1.1007232666015625[sec]\r\nelapsed_time:0.04404330253601074[sec]\r\nelapsed_time:0.03660702705383301[sec]\r\n```\r\n\r\nAnd I tried this in pytorch 0.3 on MacBook, pytorch does not allow to sort Variables in this version.\r\n```\r\n$ python bench.py \r\nTraceback (most recent call last):\r\n  File \"bench.py\", line 11, in <module>\r\n    _ = [sorted(range(N), key=lambda k: d[k]) for d in d1]\r\n  File \"bench.py\", line 11, in <listcomp>\r\n    _ = [sorted(range(N), key=lambda k: d[k]) for d in d1]\r\n  File \"/Users/jonki/anaconda/lib/python3.6/site-packages/torch/autograd/variable.py\", line 125, in __bool__\r\n    torch.typename(self.data) + \" is ambiguous\")\r\nRuntimeError: bool value of Variable objects containing non-empty torch.ByteTensor is ambiguous\r\n```"}