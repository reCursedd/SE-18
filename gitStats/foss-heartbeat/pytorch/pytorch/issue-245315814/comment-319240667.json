{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/319240667", "html_url": "https://github.com/pytorch/pytorch/issues/2198#issuecomment-319240667", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/2198", "id": 319240667, "node_id": "MDEyOklzc3VlQ29tbWVudDMxOTI0MDY2Nw==", "user": {"login": "Stonesjtu", "id": 4556044, "node_id": "MDQ6VXNlcjQ1NTYwNDQ=", "avatar_url": "https://avatars3.githubusercontent.com/u/4556044?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Stonesjtu", "html_url": "https://github.com/Stonesjtu", "followers_url": "https://api.github.com/users/Stonesjtu/followers", "following_url": "https://api.github.com/users/Stonesjtu/following{/other_user}", "gists_url": "https://api.github.com/users/Stonesjtu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Stonesjtu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Stonesjtu/subscriptions", "organizations_url": "https://api.github.com/users/Stonesjtu/orgs", "repos_url": "https://api.github.com/users/Stonesjtu/repos", "events_url": "https://api.github.com/users/Stonesjtu/events{/privacy}", "received_events_url": "https://api.github.com/users/Stonesjtu/received_events", "type": "User", "site_admin": false}, "created_at": "2017-08-01T01:21:07Z", "updated_at": "2017-08-01T01:22:52Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=11698385\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rasoolfa\">@rasoolfa</a></p>\n<p>I ran your code in my PC.</p>\n<blockquote>\n<p>GPU: 1070Ti<br>\nCUDA: 8<br>\nCUDNN: 6<br>\ntorch version: 0.20.0+bcea678</p>\n</blockquote>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">for</span> i <span class=\"pl-k\">in</span> <span class=\"pl-c1\">range</span>(<span class=\"pl-c1\">10000</span>):\n   data <span class=\"pl-k\">=</span> Variable(torch.rand(<span class=\"pl-c1\">16</span>,input_size).cuda())\n   out, hidden <span class=\"pl-k\">=</span> rnn(data, hidden) <span class=\"pl-c\"><span class=\"pl-c\">#</span> out and hidden will hold the whole history</span></pre></div>\n<p>If your code is like this, plz <code>detach</code> your results of RNN at a shorter length. Memory is exhausted by storing the backward information of this sequence of length <strong>10000</strong>.</p>\n<p>Here's the detailed log for the objects count and memory usage every <strong>1000</strong> iterations.<br>\nNote that the objects is the <strong>diff count</strong> between current and previous checkpoint.</p>\n<pre lang=\"log\"><code>current memory use: 1.37623977661\n                                              types |   # objects |   total size\n=================================================== | =========== | ============\n                                               dict |        2001 |    547.90 KB\n     &lt;class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\n      &lt;class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\n  &lt;class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\n                                               list |        1153 |    115.91 KB\n                                         torch.Size |        1000 |     70.31 KB\n                                                int |        2038 |     47.77 KB\n                                               long |        1000 |     27.34 KB\n                                                str |         163 |      9.79 KB\n                    &lt;class 'psutil._pslinux.Process |           1 |     80     B\n                                              float |           3 |     72     B\n                             &lt;class 'psutil.Process |           1 |     64     B\ncurrent memory use: 1.38377380371\n                                              types |   # objects |   total size\n=================================================== | =========== | ============\n                                               dict |        2000 |    546.88 KB\n     &lt;class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\n      &lt;class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\n  &lt;class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\n                                               list |        1002 |    101.75 KB\n                                         torch.Size |        1000 |     70.31 KB\n                                                int |        2007 |     47.04 KB\n                                               long |        1000 |     27.34 KB\n                                                str |           2 |    127     B\ncurrent memory use: 1.40835571289\n                                              types |   # objects |   total size\n=================================================== | =========== | ============\n                                               dict |        2000 |    546.88 KB\n     &lt;class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\n      &lt;class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\n  &lt;class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\n                                               list |        1000 |    101.56 KB\n                                         torch.Size |        1000 |     70.31 KB\n                                                int |        2000 |     46.88 KB\n                                               long |        1000 |     27.34 KB\ncurrent memory use: 1.41101074219\n                                              types |   # objects |   total size\n=================================================== | =========== | ============\n                                               dict |        2000 |    546.88 KB\n     &lt;class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\n      &lt;class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\n  &lt;class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\n                                               list |        1000 |    101.56 KB\n                                         torch.Size |        1000 |     70.31 KB\n                                                int |        2000 |     46.88 KB\n                                               long |        1000 |     27.34 KB\ncurrent memory use: 1.43473052979\n                                              types |   # objects |   total size\n=================================================== | =========== | ============\n                                               dict |        2000 |    546.88 KB\n     &lt;class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\n      &lt;class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\n  &lt;class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\n                                               list |        1000 |    101.56 KB\n                                         torch.Size |        1000 |     70.31 KB\n                                                int |        2000 |     46.88 KB\n                                               long |        1000 |     27.34 KB\ncurrent memory use: 1.43745422363\n                                              types |   # objects |   total size\n=================================================== | =========== | ============\n                                               dict |        2000 |    546.88 KB\n     &lt;class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\n      &lt;class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\n  &lt;class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\n                                               list |        1000 |    101.56 KB\n                                         torch.Size |        1000 |     70.31 KB\n                                                int |        2000 |     46.88 KB\n                                               long |        1000 |     27.34 KB\ncurrent memory use: 1.43940734863\n                                              types |   # objects |   total size\n=================================================== | =========== | ============\n                                               dict |        2000 |    546.88 KB\n     &lt;class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\n      &lt;class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\n  &lt;class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\n                                               list |        1000 |    101.56 KB\n                                         torch.Size |        1000 |     70.31 KB\n                                                int |        2000 |     46.88 KB\n                                               long |        1000 |     27.34 KB\ncurrent memory use: 1.44160461426\n                                              types |   # objects |   total size\n=================================================== | =========== | ============\n                                               dict |        2000 |    546.88 KB\n     &lt;class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\n      &lt;class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\n  &lt;class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\n                                               list |        1000 |    101.56 KB\n                                         torch.Size |        1000 |     70.31 KB\n                                                int |        2000 |     46.88 KB\n                                               long |        1000 |     27.34 KB\ncurrent memory use: 1.44356155396\n                                              types |   # objects |   total size\n=================================================== | =========== | ============\n                                               dict |        2000 |    546.88 KB\n     &lt;class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\n      &lt;class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\n  &lt;class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\n                                               list |        1000 |    101.56 KB\n                                         torch.Size |        1000 |     70.31 KB\n                                                int |        2000 |     46.88 KB\n                                               long |        1000 |     27.34 KB\ncurrent memory use: 1.44561767578\n</code></pre>", "body_text": "@rasoolfa\nI ran your code in my PC.\n\nGPU: 1070Ti\nCUDA: 8\nCUDNN: 6\ntorch version: 0.20.0+bcea678\n\nfor i in range(10000):\n   data = Variable(torch.rand(16,input_size).cuda())\n   out, hidden = rnn(data, hidden) # out and hidden will hold the whole history\nIf your code is like this, plz detach your results of RNN at a shorter length. Memory is exhausted by storing the backward information of this sequence of length 10000.\nHere's the detailed log for the objects count and memory usage every 1000 iterations.\nNote that the objects is the diff count between current and previous checkpoint.\ncurrent memory use: 1.37623977661\n                                              types |   # objects |   total size\n=================================================== | =========== | ============\n                                               dict |        2001 |    547.90 KB\n     <class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\n      <class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\n  <class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\n                                               list |        1153 |    115.91 KB\n                                         torch.Size |        1000 |     70.31 KB\n                                                int |        2038 |     47.77 KB\n                                               long |        1000 |     27.34 KB\n                                                str |         163 |      9.79 KB\n                    <class 'psutil._pslinux.Process |           1 |     80     B\n                                              float |           3 |     72     B\n                             <class 'psutil.Process |           1 |     64     B\ncurrent memory use: 1.38377380371\n                                              types |   # objects |   total size\n=================================================== | =========== | ============\n                                               dict |        2000 |    546.88 KB\n     <class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\n      <class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\n  <class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\n                                               list |        1002 |    101.75 KB\n                                         torch.Size |        1000 |     70.31 KB\n                                                int |        2007 |     47.04 KB\n                                               long |        1000 |     27.34 KB\n                                                str |           2 |    127     B\ncurrent memory use: 1.40835571289\n                                              types |   # objects |   total size\n=================================================== | =========== | ============\n                                               dict |        2000 |    546.88 KB\n     <class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\n      <class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\n  <class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\n                                               list |        1000 |    101.56 KB\n                                         torch.Size |        1000 |     70.31 KB\n                                                int |        2000 |     46.88 KB\n                                               long |        1000 |     27.34 KB\ncurrent memory use: 1.41101074219\n                                              types |   # objects |   total size\n=================================================== | =========== | ============\n                                               dict |        2000 |    546.88 KB\n     <class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\n      <class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\n  <class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\n                                               list |        1000 |    101.56 KB\n                                         torch.Size |        1000 |     70.31 KB\n                                                int |        2000 |     46.88 KB\n                                               long |        1000 |     27.34 KB\ncurrent memory use: 1.43473052979\n                                              types |   # objects |   total size\n=================================================== | =========== | ============\n                                               dict |        2000 |    546.88 KB\n     <class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\n      <class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\n  <class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\n                                               list |        1000 |    101.56 KB\n                                         torch.Size |        1000 |     70.31 KB\n                                                int |        2000 |     46.88 KB\n                                               long |        1000 |     27.34 KB\ncurrent memory use: 1.43745422363\n                                              types |   # objects |   total size\n=================================================== | =========== | ============\n                                               dict |        2000 |    546.88 KB\n     <class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\n      <class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\n  <class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\n                                               list |        1000 |    101.56 KB\n                                         torch.Size |        1000 |     70.31 KB\n                                                int |        2000 |     46.88 KB\n                                               long |        1000 |     27.34 KB\ncurrent memory use: 1.43940734863\n                                              types |   # objects |   total size\n=================================================== | =========== | ============\n                                               dict |        2000 |    546.88 KB\n     <class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\n      <class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\n  <class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\n                                               list |        1000 |    101.56 KB\n                                         torch.Size |        1000 |     70.31 KB\n                                                int |        2000 |     46.88 KB\n                                               long |        1000 |     27.34 KB\ncurrent memory use: 1.44160461426\n                                              types |   # objects |   total size\n=================================================== | =========== | ============\n                                               dict |        2000 |    546.88 KB\n     <class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\n      <class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\n  <class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\n                                               list |        1000 |    101.56 KB\n                                         torch.Size |        1000 |     70.31 KB\n                                                int |        2000 |     46.88 KB\n                                               long |        1000 |     27.34 KB\ncurrent memory use: 1.44356155396\n                                              types |   # objects |   total size\n=================================================== | =========== | ============\n                                               dict |        2000 |    546.88 KB\n     <class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\n      <class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\n  <class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\n                                               list |        1000 |    101.56 KB\n                                         torch.Size |        1000 |     70.31 KB\n                                                int |        2000 |     46.88 KB\n                                               long |        1000 |     27.34 KB\ncurrent memory use: 1.44561767578", "body": "@rasoolfa\r\n\r\nI ran your code in my PC.\r\n> GPU: 1070Ti\r\n> CUDA: 8\r\n> CUDNN: 6\r\n> torch version: 0.20.0+bcea678\r\n\r\n ```python\r\nfor i in range(10000):\r\n    data = Variable(torch.rand(16,input_size).cuda())\r\n    out, hidden = rnn(data, hidden) # out and hidden will hold the whole history\r\n```\r\nIf your code is like this, plz `detach` your results of RNN at a shorter length. Memory is exhausted by storing the backward information of this sequence of length **10000**.\r\n\r\nHere's the detailed log for the objects count and memory usage every **1000** iterations.\r\nNote that the objects is the **diff count** between current and previous checkpoint. \r\n```log\r\ncurrent memory use: 1.37623977661\r\n                                              types |   # objects |   total size\r\n=================================================== | =========== | ============\r\n                                               dict |        2001 |    547.90 KB\r\n     <class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\r\n      <class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\r\n  <class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\r\n                                               list |        1153 |    115.91 KB\r\n                                         torch.Size |        1000 |     70.31 KB\r\n                                                int |        2038 |     47.77 KB\r\n                                               long |        1000 |     27.34 KB\r\n                                                str |         163 |      9.79 KB\r\n                    <class 'psutil._pslinux.Process |           1 |     80     B\r\n                                              float |           3 |     72     B\r\n                             <class 'psutil.Process |           1 |     64     B\r\ncurrent memory use: 1.38377380371\r\n                                              types |   # objects |   total size\r\n=================================================== | =========== | ============\r\n                                               dict |        2000 |    546.88 KB\r\n     <class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\r\n      <class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\r\n  <class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\r\n                                               list |        1002 |    101.75 KB\r\n                                         torch.Size |        1000 |     70.31 KB\r\n                                                int |        2007 |     47.04 KB\r\n                                               long |        1000 |     27.34 KB\r\n                                                str |           2 |    127     B\r\ncurrent memory use: 1.40835571289\r\n                                              types |   # objects |   total size\r\n=================================================== | =========== | ============\r\n                                               dict |        2000 |    546.88 KB\r\n     <class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\r\n      <class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\r\n  <class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\r\n                                               list |        1000 |    101.56 KB\r\n                                         torch.Size |        1000 |     70.31 KB\r\n                                                int |        2000 |     46.88 KB\r\n                                               long |        1000 |     27.34 KB\r\ncurrent memory use: 1.41101074219\r\n                                              types |   # objects |   total size\r\n=================================================== | =========== | ============\r\n                                               dict |        2000 |    546.88 KB\r\n     <class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\r\n      <class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\r\n  <class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\r\n                                               list |        1000 |    101.56 KB\r\n                                         torch.Size |        1000 |     70.31 KB\r\n                                                int |        2000 |     46.88 KB\r\n                                               long |        1000 |     27.34 KB\r\ncurrent memory use: 1.43473052979\r\n                                              types |   # objects |   total size\r\n=================================================== | =========== | ============\r\n                                               dict |        2000 |    546.88 KB\r\n     <class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\r\n      <class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\r\n  <class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\r\n                                               list |        1000 |    101.56 KB\r\n                                         torch.Size |        1000 |     70.31 KB\r\n                                                int |        2000 |     46.88 KB\r\n                                               long |        1000 |     27.34 KB\r\ncurrent memory use: 1.43745422363\r\n                                              types |   # objects |   total size\r\n=================================================== | =========== | ============\r\n                                               dict |        2000 |    546.88 KB\r\n     <class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\r\n      <class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\r\n  <class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\r\n                                               list |        1000 |    101.56 KB\r\n                                         torch.Size |        1000 |     70.31 KB\r\n                                                int |        2000 |     46.88 KB\r\n                                               long |        1000 |     27.34 KB\r\ncurrent memory use: 1.43940734863\r\n                                              types |   # objects |   total size\r\n=================================================== | =========== | ============\r\n                                               dict |        2000 |    546.88 KB\r\n     <class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\r\n      <class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\r\n  <class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\r\n                                               list |        1000 |    101.56 KB\r\n                                         torch.Size |        1000 |     70.31 KB\r\n                                                int |        2000 |     46.88 KB\r\n                                               long |        1000 |     27.34 KB\r\ncurrent memory use: 1.44160461426\r\n                                              types |   # objects |   total size\r\n=================================================== | =========== | ============\r\n                                               dict |        2000 |    546.88 KB\r\n     <class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\r\n      <class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\r\n  <class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\r\n                                               list |        1000 |    101.56 KB\r\n                                         torch.Size |        1000 |     70.31 KB\r\n                                                int |        2000 |     46.88 KB\r\n                                               long |        1000 |     27.34 KB\r\ncurrent memory use: 1.44356155396\r\n                                              types |   # objects |   total size\r\n=================================================== | =========== | ============\r\n                                               dict |        2000 |    546.88 KB\r\n     <class 'torch.autograd.function.ConcatBackward |        1000 |    234.38 KB\r\n      <class 'torch.autograd.function.AddmmBackward |        1000 |    234.38 KB\r\n  <class 'torch.autograd.function.TransposeBackward |        1000 |    234.38 KB\r\n                                               list |        1000 |    101.56 KB\r\n                                         torch.Size |        1000 |     70.31 KB\r\n                                                int |        2000 |     46.88 KB\r\n                                               long |        1000 |     27.34 KB\r\ncurrent memory use: 1.44561767578\r\n```\r\n"}