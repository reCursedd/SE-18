{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/359992114", "html_url": "https://github.com/pytorch/pytorch/pull/4820#issuecomment-359992114", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/4820", "id": 359992114, "node_id": "MDEyOklzc3VlQ29tbWVudDM1OTk5MjExNA==", "user": {"login": "prigoyal", "id": 13488275, "node_id": "MDQ6VXNlcjEzNDg4Mjc1", "avatar_url": "https://avatars0.githubusercontent.com/u/13488275?v=4", "gravatar_id": "", "url": "https://api.github.com/users/prigoyal", "html_url": "https://github.com/prigoyal", "followers_url": "https://api.github.com/users/prigoyal/followers", "following_url": "https://api.github.com/users/prigoyal/following{/other_user}", "gists_url": "https://api.github.com/users/prigoyal/gists{/gist_id}", "starred_url": "https://api.github.com/users/prigoyal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/prigoyal/subscriptions", "organizations_url": "https://api.github.com/users/prigoyal/orgs", "repos_url": "https://api.github.com/users/prigoyal/repos", "events_url": "https://api.github.com/users/prigoyal/events{/privacy}", "received_events_url": "https://api.github.com/users/prigoyal/received_events", "type": "User", "site_admin": false}, "created_at": "2018-01-24T01:40:28Z", "updated_at": "2018-01-24T01:40:28Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=13564\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ezyang\">@ezyang</a> I tested your changes on <strong>master</strong> and they work fine. We are also doing similar thing for libnccl.so</p>\n<p>I also tested another solution which is to comment out this piece of code<br>\n<div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/pytorch/pytorch/blob/94f439c07c4f3e13fbd87016212b3534d31a7165/torch/lib/build_libs.sh#L113-L116\">pytorch/torch/lib/build_libs.sh</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n        Lines 113 to 116\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/pytorch/pytorch/commit/94f439c07c4f3e13fbd87016212b3534d31a7165\">94f439c</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L113\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"113\"></td>\n          <td id=\"LC113\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-k\">local</span> lib_prefix=<span class=\"pl-smi\">$INSTALL_DIR</span>/lib/lib<span class=\"pl-smi\">$1</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L114\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"114\"></td>\n          <td id=\"LC114\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-k\">if</span> [ <span class=\"pl-k\">-f</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-smi\">$lib_prefix$LD_POSTFIX</span><span class=\"pl-pds\">\"</span></span> ]<span class=\"pl-k\">;</span> <span class=\"pl-k\">then</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L115\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"115\"></td>\n          <td id=\"LC115\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">   rm -rf -- <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-smi\">$lib_prefix$LD_POSTFIX_UNVERSIONED</span><span class=\"pl-pds\">\"</span></span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L116\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"116\"></td>\n          <td id=\"LC116\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-k\">fi</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n which is removing .so libs. I am not sure why they are removed or why do we need to build .so.1 but it is valid concern to not increase the binary size by keeping .so and .so.1 both</p>\n<p>I also tested what <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1310570\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/soumith\">@soumith</a> suggested but it requires fixing at more places and I didn't go further with it</p>", "body_text": "@ezyang I tested your changes on master and they work fine. We are also doing similar thing for libnccl.so\nI also tested another solution which is to comment out this piece of code\n\n  \n    \n      pytorch/torch/lib/build_libs.sh\n    \n    \n        Lines 113 to 116\n      in\n      94f439c\n    \n    \n    \n    \n\n        \n          \n           local lib_prefix=$INSTALL_DIR/lib/lib$1 \n        \n\n        \n          \n           if [ -f \"$lib_prefix$LD_POSTFIX\" ]; then \n        \n\n        \n          \n             rm -rf -- \"$lib_prefix$LD_POSTFIX_UNVERSIONED\" \n        \n\n        \n          \n           fi \n        \n    \n  \n\n which is removing .so libs. I am not sure why they are removed or why do we need to build .so.1 but it is valid concern to not increase the binary size by keeping .so and .so.1 both\nI also tested what @soumith suggested but it requires fixing at more places and I didn't go further with it", "body": "@ezyang I tested your changes on **master** and they work fine. We are also doing similar thing for libnccl.so \r\n\r\nI also tested another solution which is to comment out this piece of code\r\nhttps://github.com/pytorch/pytorch/blob/94f439c07c4f3e13fbd87016212b3534d31a7165/torch/lib/build_libs.sh#L113-L116 which is removing .so libs. I am not sure why they are removed or why do we need to build .so.1 but it is valid concern to not increase the binary size by keeping .so and .so.1 both\r\n\r\nI also tested what @soumith suggested but it requires fixing at more places and I didn't go further with it\r\n"}