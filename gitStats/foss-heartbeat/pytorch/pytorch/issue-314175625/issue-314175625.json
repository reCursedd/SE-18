{"url": "https://api.github.com/repos/pytorch/pytorch/issues/6591", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/6591/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/6591/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/6591/events", "html_url": "https://github.com/pytorch/pytorch/issues/6591", "id": 314175625, "node_id": "MDU6SXNzdWUzMTQxNzU2MjU=", "number": 6591, "title": "Matrix Multiplication Segfault when called from MATLAB", "user": {"login": "aespielberg", "id": 3598964, "node_id": "MDQ6VXNlcjM1OTg5NjQ=", "avatar_url": "https://avatars2.githubusercontent.com/u/3598964?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aespielberg", "html_url": "https://github.com/aespielberg", "followers_url": "https://api.github.com/users/aespielberg/followers", "following_url": "https://api.github.com/users/aespielberg/following{/other_user}", "gists_url": "https://api.github.com/users/aespielberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/aespielberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aespielberg/subscriptions", "organizations_url": "https://api.github.com/users/aespielberg/orgs", "repos_url": "https://api.github.com/users/aespielberg/repos", "events_url": "https://api.github.com/users/aespielberg/events{/privacy}", "received_events_url": "https://api.github.com/users/aespielberg/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-04-13T16:39:19Z", "updated_at": "2018-04-13T18:05:20Z", "closed_at": "2018-04-13T18:05:20Z", "author_association": "NONE", "body_html": "<p>PyTorch, installed for python 3.6 using anaconda 3 -</p>\n<p>I'm trying to call a python script from MATLAB; that python script uses PyTorch.  Sadly, this always breaks on matrix multiplication.</p>\n<p>w1 and w2 are arrays below.  The offending code:</p>\n<pre><code>def compute(w1, w2):\n  D_in = 2\n  H = 10\n  D_out = 1\n  w1 = np.array(w1).reshape((D_in, H))\n  w2 = np.array(w2).reshape((H, D_out))\n\n  w1 = Variable(torch.from_numpy(w1).type(dtype), requires_grad=requires_grad)\n  w2 = Variable(torch.from_numpy(w2).type(dtype), requires_grad=requires_grad)\n\n  theta = Variable(torch.zeros(1,1).type(dtype), requires_grad=requires_grad)\n  dtheta = Variable(torch.zeros(1,1).type(dtype), requires_grad=requires_grad)\n\n  u = torch.cat((theta[i-1], dtheta[i-1]),1).mm(w1).sigmoid().mm(w2).sigmoid()\n</code></pre>\n<p>I've used a random array, 1 x 20 for w1, and a random array, 1 x 10 for w2</p>\n<p>The first mm breaks when compute is called from MATLAB using their python interface 9<a href=\"http://www.mathworks.com/help/matlab/matlab_external/call-user-defined-custom-module.html\" rel=\"nofollow\">http://www.mathworks.com/help/matlab/matlab_external/call-user-defined-custom-module.html</a>).  Here is the trace:</p>\n<pre><code>--------------------------------------------------------------------------------\n       Segmentation violation detected at Fri Apr 13 09:11:53 2018 -0700\n--------------------------------------------------------------------------------\n\nConfiguration:\n  Crash Decoding           : Disabled - No sandbox or build area path\n  Crash Mode               : continue (default)\n  Default Encoding         : UTF-8\n  Deployed                 : false\n  Desktop Environment      : Unity\n  GNU C Library            : 2.23 stable\n  Graphics Driver          : Unknown software \n  Java Version             : Java 1.8.0_144-b01 with Oracle Corporation Java HotSpot(TM) 64-Bit Server VM mixed mode\n  MATLAB Architecture      : glnxa64\n  MATLAB Entitlement ID    : 4172689\n  MATLAB Root              : /usr/local/MATLAB/R2018a\n  MATLAB Version           : 9.4.0.813654 (R2018a)\n  OpenGL                   : software\n  Operating System         : Ubuntu 16.04.3 LTS\n  Process ID               : 100261\n  Processor ID             : x86 Family 6 Model 94 Stepping 3, GenuineIntel\n  Session Key              : 3a5e4da0-177d-484c-9369-0874983c4d2b\n  Static TLS mitigation    : Disabled: Unnecessary 1\n  Window System            : The X.Org Foundation (11903000), display :0\n\nFault Count: 2\n\n\nAbnormal termination\n\nRegister State (from fault):\n  RAX = 00007fa1979a18d0  RBX = dc856200000000a0\n  RCX = ee4330a1979a1920  RDX = 0000000000000000\n  RSP = 00007f5167450be0  RBP = 00007f51674510b0\n  RSI = 0000000100000000  RDI = 0000000000000000\n\n   R8 = 0000000100000000   R9 = ee4330a1979a1920\n  R10 = 00007fa1979a18d0  R11 = 000000010000000a\n  R12 = 00007f415dc855d0  R13 = 0000001000000050\n  R14 = 00007fb15dd172c0  R15 = 000082815dc85670\n\n  RIP = 00007f511da28d1a  EFL = 0000000000010202\n\n   CS = 0033   FS = 0000   GS = 0000\n\nStack Trace (from fault):\n[  0] 0x00007f511da28d1a        /usr/local/MATLAB/R2018a/bin/glnxa64/mkl.so+21388570 mkl_blas_avx2_dgemm_pst+00025658\n[  1] 0x00007f511fb3d8ef        /usr/local/MATLAB/R2018a/bin/glnxa64/mkl.so+56076527 mkl_blas_avx2_d_pst_wrapper+00000623\n[  2] 0x00007f513483cedf /home/aespielberg/anaconda3/lib/python3.6/site-packages/torch/lib/../../../../libmkl_gnu_thread.so+02076383\n[  3] 0x00007f51348411b5 /home/aespielberg/anaconda3/lib/python3.6/site-packages/torch/lib/../../../../libmkl_gnu_thread.so+02093493\n[  4] 0x00007f521012bc53 /usr/local/MATLAB/R2018a/bin/glnxa64/../../sys/os/glnxa64/libiomp5.so+00740435 __kmp_invoke_microtask+00000147\n[  5] 0x00007f52100fb357 /usr/local/MATLAB/R2018a/bin/glnxa64/../../sys/os/glnxa64/libiomp5.so+00541527\n[  6] 0x00007f52100fa9d5 /usr/local/MATLAB/R2018a/bin/glnxa64/../../sys/os/glnxa64/libiomp5.so+00539093\n[  7] 0x00007f521012c133 /usr/local/MATLAB/R2018a/bin/glnxa64/../../sys/os/glnxa64/libiomp5.so+00741683\n[  8] 0x00007f522b62a6ba              /lib/x86_64-linux-gnu/libpthread.so.0+00030394\n[  9] 0x00007f522cef141d                    /lib/x86_64-linux-gnu/libc.so.6+01078301 clone+00000109\n[ 10] 0x0000000000000000                                   &lt;unknown-module&gt;+00000000\n\n\nAbnormal termination\n\nRegister State (from fault):\n  RAX = 00007f51979a18d0  RBX = dc856200000000a0\n  RCX = ee433051979a1920  RDX = 0000000000000000\n  RSP = 00007f520d948020  RBP = 00007f520d9484f0\n  RSI = 0000000100000000  RDI = 0000000000000000\n\n   R8 = 0000000100000000   R9 = ee433051979a1920\n  R10 = 00007f51979a18d0  R11 = 000000010000000a\n  R12 = 00007f415dc855d0  R13 = 0000001000000050\n  R14 = 00007fa15dd172c0  R15 = 000082815dc85670\n\n  RIP = 00007f511da28d1f  EFL = 0000000000010202\n\n   CS = 0033   FS = 0000   GS = 0000\n\n** This crash report has been saved to disk as /home/aespielberg/matlab_crash_dump.100261-1 **\n\n</code></pre>", "body_text": "PyTorch, installed for python 3.6 using anaconda 3 -\nI'm trying to call a python script from MATLAB; that python script uses PyTorch.  Sadly, this always breaks on matrix multiplication.\nw1 and w2 are arrays below.  The offending code:\ndef compute(w1, w2):\n  D_in = 2\n  H = 10\n  D_out = 1\n  w1 = np.array(w1).reshape((D_in, H))\n  w2 = np.array(w2).reshape((H, D_out))\n\n  w1 = Variable(torch.from_numpy(w1).type(dtype), requires_grad=requires_grad)\n  w2 = Variable(torch.from_numpy(w2).type(dtype), requires_grad=requires_grad)\n\n  theta = Variable(torch.zeros(1,1).type(dtype), requires_grad=requires_grad)\n  dtheta = Variable(torch.zeros(1,1).type(dtype), requires_grad=requires_grad)\n\n  u = torch.cat((theta[i-1], dtheta[i-1]),1).mm(w1).sigmoid().mm(w2).sigmoid()\n\nI've used a random array, 1 x 20 for w1, and a random array, 1 x 10 for w2\nThe first mm breaks when compute is called from MATLAB using their python interface 9http://www.mathworks.com/help/matlab/matlab_external/call-user-defined-custom-module.html).  Here is the trace:\n--------------------------------------------------------------------------------\n       Segmentation violation detected at Fri Apr 13 09:11:53 2018 -0700\n--------------------------------------------------------------------------------\n\nConfiguration:\n  Crash Decoding           : Disabled - No sandbox or build area path\n  Crash Mode               : continue (default)\n  Default Encoding         : UTF-8\n  Deployed                 : false\n  Desktop Environment      : Unity\n  GNU C Library            : 2.23 stable\n  Graphics Driver          : Unknown software \n  Java Version             : Java 1.8.0_144-b01 with Oracle Corporation Java HotSpot(TM) 64-Bit Server VM mixed mode\n  MATLAB Architecture      : glnxa64\n  MATLAB Entitlement ID    : 4172689\n  MATLAB Root              : /usr/local/MATLAB/R2018a\n  MATLAB Version           : 9.4.0.813654 (R2018a)\n  OpenGL                   : software\n  Operating System         : Ubuntu 16.04.3 LTS\n  Process ID               : 100261\n  Processor ID             : x86 Family 6 Model 94 Stepping 3, GenuineIntel\n  Session Key              : 3a5e4da0-177d-484c-9369-0874983c4d2b\n  Static TLS mitigation    : Disabled: Unnecessary 1\n  Window System            : The X.Org Foundation (11903000), display :0\n\nFault Count: 2\n\n\nAbnormal termination\n\nRegister State (from fault):\n  RAX = 00007fa1979a18d0  RBX = dc856200000000a0\n  RCX = ee4330a1979a1920  RDX = 0000000000000000\n  RSP = 00007f5167450be0  RBP = 00007f51674510b0\n  RSI = 0000000100000000  RDI = 0000000000000000\n\n   R8 = 0000000100000000   R9 = ee4330a1979a1920\n  R10 = 00007fa1979a18d0  R11 = 000000010000000a\n  R12 = 00007f415dc855d0  R13 = 0000001000000050\n  R14 = 00007fb15dd172c0  R15 = 000082815dc85670\n\n  RIP = 00007f511da28d1a  EFL = 0000000000010202\n\n   CS = 0033   FS = 0000   GS = 0000\n\nStack Trace (from fault):\n[  0] 0x00007f511da28d1a        /usr/local/MATLAB/R2018a/bin/glnxa64/mkl.so+21388570 mkl_blas_avx2_dgemm_pst+00025658\n[  1] 0x00007f511fb3d8ef        /usr/local/MATLAB/R2018a/bin/glnxa64/mkl.so+56076527 mkl_blas_avx2_d_pst_wrapper+00000623\n[  2] 0x00007f513483cedf /home/aespielberg/anaconda3/lib/python3.6/site-packages/torch/lib/../../../../libmkl_gnu_thread.so+02076383\n[  3] 0x00007f51348411b5 /home/aespielberg/anaconda3/lib/python3.6/site-packages/torch/lib/../../../../libmkl_gnu_thread.so+02093493\n[  4] 0x00007f521012bc53 /usr/local/MATLAB/R2018a/bin/glnxa64/../../sys/os/glnxa64/libiomp5.so+00740435 __kmp_invoke_microtask+00000147\n[  5] 0x00007f52100fb357 /usr/local/MATLAB/R2018a/bin/glnxa64/../../sys/os/glnxa64/libiomp5.so+00541527\n[  6] 0x00007f52100fa9d5 /usr/local/MATLAB/R2018a/bin/glnxa64/../../sys/os/glnxa64/libiomp5.so+00539093\n[  7] 0x00007f521012c133 /usr/local/MATLAB/R2018a/bin/glnxa64/../../sys/os/glnxa64/libiomp5.so+00741683\n[  8] 0x00007f522b62a6ba              /lib/x86_64-linux-gnu/libpthread.so.0+00030394\n[  9] 0x00007f522cef141d                    /lib/x86_64-linux-gnu/libc.so.6+01078301 clone+00000109\n[ 10] 0x0000000000000000                                   <unknown-module>+00000000\n\n\nAbnormal termination\n\nRegister State (from fault):\n  RAX = 00007f51979a18d0  RBX = dc856200000000a0\n  RCX = ee433051979a1920  RDX = 0000000000000000\n  RSP = 00007f520d948020  RBP = 00007f520d9484f0\n  RSI = 0000000100000000  RDI = 0000000000000000\n\n   R8 = 0000000100000000   R9 = ee433051979a1920\n  R10 = 00007f51979a18d0  R11 = 000000010000000a\n  R12 = 00007f415dc855d0  R13 = 0000001000000050\n  R14 = 00007fa15dd172c0  R15 = 000082815dc85670\n\n  RIP = 00007f511da28d1f  EFL = 0000000000010202\n\n   CS = 0033   FS = 0000   GS = 0000\n\n** This crash report has been saved to disk as /home/aespielberg/matlab_crash_dump.100261-1 **", "body": "PyTorch, installed for python 3.6 using anaconda 3 - \r\n\r\nI'm trying to call a python script from MATLAB; that python script uses PyTorch.  Sadly, this always breaks on matrix multiplication.\r\n\r\nw1 and w2 are arrays below.  The offending code:\r\n\r\n```\r\ndef compute(w1, w2):\r\n  D_in = 2\r\n  H = 10\r\n  D_out = 1\r\n  w1 = np.array(w1).reshape((D_in, H))\r\n  w2 = np.array(w2).reshape((H, D_out))\r\n\r\n  w1 = Variable(torch.from_numpy(w1).type(dtype), requires_grad=requires_grad)\r\n  w2 = Variable(torch.from_numpy(w2).type(dtype), requires_grad=requires_grad)\r\n\r\n  theta = Variable(torch.zeros(1,1).type(dtype), requires_grad=requires_grad)\r\n  dtheta = Variable(torch.zeros(1,1).type(dtype), requires_grad=requires_grad)\r\n\r\n  u = torch.cat((theta[i-1], dtheta[i-1]),1).mm(w1).sigmoid().mm(w2).sigmoid()\r\n```\r\n\r\nI've used a random array, 1 x 20 for w1, and a random array, 1 x 10 for w2\r\n\r\nThe first mm breaks when compute is called from MATLAB using their python interface 9http://www.mathworks.com/help/matlab/matlab_external/call-user-defined-custom-module.html).  Here is the trace:\r\n\r\n```\r\n--------------------------------------------------------------------------------\r\n       Segmentation violation detected at Fri Apr 13 09:11:53 2018 -0700\r\n--------------------------------------------------------------------------------\r\n\r\nConfiguration:\r\n  Crash Decoding           : Disabled - No sandbox or build area path\r\n  Crash Mode               : continue (default)\r\n  Default Encoding         : UTF-8\r\n  Deployed                 : false\r\n  Desktop Environment      : Unity\r\n  GNU C Library            : 2.23 stable\r\n  Graphics Driver          : Unknown software \r\n  Java Version             : Java 1.8.0_144-b01 with Oracle Corporation Java HotSpot(TM) 64-Bit Server VM mixed mode\r\n  MATLAB Architecture      : glnxa64\r\n  MATLAB Entitlement ID    : 4172689\r\n  MATLAB Root              : /usr/local/MATLAB/R2018a\r\n  MATLAB Version           : 9.4.0.813654 (R2018a)\r\n  OpenGL                   : software\r\n  Operating System         : Ubuntu 16.04.3 LTS\r\n  Process ID               : 100261\r\n  Processor ID             : x86 Family 6 Model 94 Stepping 3, GenuineIntel\r\n  Session Key              : 3a5e4da0-177d-484c-9369-0874983c4d2b\r\n  Static TLS mitigation    : Disabled: Unnecessary 1\r\n  Window System            : The X.Org Foundation (11903000), display :0\r\n\r\nFault Count: 2\r\n\r\n\r\nAbnormal termination\r\n\r\nRegister State (from fault):\r\n  RAX = 00007fa1979a18d0  RBX = dc856200000000a0\r\n  RCX = ee4330a1979a1920  RDX = 0000000000000000\r\n  RSP = 00007f5167450be0  RBP = 00007f51674510b0\r\n  RSI = 0000000100000000  RDI = 0000000000000000\r\n\r\n   R8 = 0000000100000000   R9 = ee4330a1979a1920\r\n  R10 = 00007fa1979a18d0  R11 = 000000010000000a\r\n  R12 = 00007f415dc855d0  R13 = 0000001000000050\r\n  R14 = 00007fb15dd172c0  R15 = 000082815dc85670\r\n\r\n  RIP = 00007f511da28d1a  EFL = 0000000000010202\r\n\r\n   CS = 0033   FS = 0000   GS = 0000\r\n\r\nStack Trace (from fault):\r\n[  0] 0x00007f511da28d1a        /usr/local/MATLAB/R2018a/bin/glnxa64/mkl.so+21388570 mkl_blas_avx2_dgemm_pst+00025658\r\n[  1] 0x00007f511fb3d8ef        /usr/local/MATLAB/R2018a/bin/glnxa64/mkl.so+56076527 mkl_blas_avx2_d_pst_wrapper+00000623\r\n[  2] 0x00007f513483cedf /home/aespielberg/anaconda3/lib/python3.6/site-packages/torch/lib/../../../../libmkl_gnu_thread.so+02076383\r\n[  3] 0x00007f51348411b5 /home/aespielberg/anaconda3/lib/python3.6/site-packages/torch/lib/../../../../libmkl_gnu_thread.so+02093493\r\n[  4] 0x00007f521012bc53 /usr/local/MATLAB/R2018a/bin/glnxa64/../../sys/os/glnxa64/libiomp5.so+00740435 __kmp_invoke_microtask+00000147\r\n[  5] 0x00007f52100fb357 /usr/local/MATLAB/R2018a/bin/glnxa64/../../sys/os/glnxa64/libiomp5.so+00541527\r\n[  6] 0x00007f52100fa9d5 /usr/local/MATLAB/R2018a/bin/glnxa64/../../sys/os/glnxa64/libiomp5.so+00539093\r\n[  7] 0x00007f521012c133 /usr/local/MATLAB/R2018a/bin/glnxa64/../../sys/os/glnxa64/libiomp5.so+00741683\r\n[  8] 0x00007f522b62a6ba              /lib/x86_64-linux-gnu/libpthread.so.0+00030394\r\n[  9] 0x00007f522cef141d                    /lib/x86_64-linux-gnu/libc.so.6+01078301 clone+00000109\r\n[ 10] 0x0000000000000000                                   <unknown-module>+00000000\r\n\r\n\r\nAbnormal termination\r\n\r\nRegister State (from fault):\r\n  RAX = 00007f51979a18d0  RBX = dc856200000000a0\r\n  RCX = ee433051979a1920  RDX = 0000000000000000\r\n  RSP = 00007f520d948020  RBP = 00007f520d9484f0\r\n  RSI = 0000000100000000  RDI = 0000000000000000\r\n\r\n   R8 = 0000000100000000   R9 = ee433051979a1920\r\n  R10 = 00007f51979a18d0  R11 = 000000010000000a\r\n  R12 = 00007f415dc855d0  R13 = 0000001000000050\r\n  R14 = 00007fa15dd172c0  R15 = 000082815dc85670\r\n\r\n  RIP = 00007f511da28d1f  EFL = 0000000000010202\r\n\r\n   CS = 0033   FS = 0000   GS = 0000\r\n\r\n** This crash report has been saved to disk as /home/aespielberg/matlab_crash_dump.100261-1 **\r\n\r\n```"}