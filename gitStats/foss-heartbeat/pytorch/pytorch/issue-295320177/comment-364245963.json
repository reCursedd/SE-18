{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/364245963", "html_url": "https://github.com/pytorch/pytorch/pull/5121#issuecomment-364245963", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/5121", "id": 364245963, "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDI0NTk2Mw==", "user": {"login": "fritzo", "id": 648532, "node_id": "MDQ6VXNlcjY0ODUzMg==", "avatar_url": "https://avatars0.githubusercontent.com/u/648532?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fritzo", "html_url": "https://github.com/fritzo", "followers_url": "https://api.github.com/users/fritzo/followers", "following_url": "https://api.github.com/users/fritzo/following{/other_user}", "gists_url": "https://api.github.com/users/fritzo/gists{/gist_id}", "starred_url": "https://api.github.com/users/fritzo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fritzo/subscriptions", "organizations_url": "https://api.github.com/users/fritzo/orgs", "repos_url": "https://api.github.com/users/fritzo/repos", "events_url": "https://api.github.com/users/fritzo/events{/privacy}", "received_events_url": "https://api.github.com/users/fritzo/received_events", "type": "User", "site_admin": false}, "created_at": "2018-02-08T20:57:36Z", "updated_at": "2018-02-08T20:57:36Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Here's a fix for <code>OneHotCategorical</code>:</p>\n<div class=\"highlight highlight-source-diff\"><pre><span class=\"pl-c1\">diff --git a/torch/distributions/relaxed_categorical.py b/torch/distributions/relaxed_categorical.py</span>\nindex 1961aeb0..54538f1d 100644\n<span class=\"pl-md\">--- a/torch/distributions/relaxed_categorical.py</span>\n<span class=\"pl-mi1\">+++ b/torch/distributions/relaxed_categorical.py</span>\n<span class=\"pl-mdr\">@@ -65,7 +65,7 @@</span> class ExpRelaxedCategorical(Distribution):\n     K = self._categorical._num_events\n     self._validate_log_prob_arg(value)\n     logits, value = broadcast_all(self.logits, value)\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>    log_scale = (self.logits.new(1).fill_(K).lgamma() -</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>    log_scale = (self.temperature.new(self.temperature.shape).fill_(K).lgamma() -</span>\n           self.temperature.log().mul(-(K - 1)))\n     score = logits - value.mul(self.temperature)\n     score = (score - log_sum_exp(score)).sum(-1)</pre></div>", "body_text": "Here's a fix for OneHotCategorical:\ndiff --git a/torch/distributions/relaxed_categorical.py b/torch/distributions/relaxed_categorical.py\nindex 1961aeb0..54538f1d 100644\n--- a/torch/distributions/relaxed_categorical.py\n+++ b/torch/distributions/relaxed_categorical.py\n@@ -65,7 +65,7 @@ class ExpRelaxedCategorical(Distribution):\n     K = self._categorical._num_events\n     self._validate_log_prob_arg(value)\n     logits, value = broadcast_all(self.logits, value)\n-    log_scale = (self.logits.new(1).fill_(K).lgamma() -\n+    log_scale = (self.temperature.new(self.temperature.shape).fill_(K).lgamma() -\n           self.temperature.log().mul(-(K - 1)))\n     score = logits - value.mul(self.temperature)\n     score = (score - log_sum_exp(score)).sum(-1)", "body": "Here's a fix for `OneHotCategorical`:\r\n```diff\r\ndiff --git a/torch/distributions/relaxed_categorical.py b/torch/distributions/relaxed_categorical.py\r\nindex 1961aeb0..54538f1d 100644\r\n--- a/torch/distributions/relaxed_categorical.py\r\n+++ b/torch/distributions/relaxed_categorical.py\r\n@@ -65,7 +65,7 @@ class ExpRelaxedCategorical(Distribution):\r\n     K = self._categorical._num_events\r\n     self._validate_log_prob_arg(value)\r\n     logits, value = broadcast_all(self.logits, value)\r\n-    log_scale = (self.logits.new(1).fill_(K).lgamma() -\r\n+    log_scale = (self.temperature.new(self.temperature.shape).fill_(K).lgamma() -\r\n           self.temperature.log().mul(-(K - 1)))\r\n     score = logits - value.mul(self.temperature)\r\n     score = (score - log_sum_exp(score)).sum(-1)\r\n```"}