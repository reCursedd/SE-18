{"url": "https://api.github.com/repos/pytorch/pytorch/issues/4848", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/4848/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/4848/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/4848/events", "html_url": "https://github.com/pytorch/pytorch/pull/4848", "id": 291620210, "node_id": "MDExOlB1bGxSZXF1ZXN0MTY1MTU2Nzc5", "number": 4848, "title": "Fix downcastOuter contiguity requirements", "user": {"login": "zou3519", "id": 5652049, "node_id": "MDQ6VXNlcjU2NTIwNDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/5652049?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zou3519", "html_url": "https://github.com/zou3519", "followers_url": "https://api.github.com/users/zou3519/followers", "following_url": "https://api.github.com/users/zou3519/following{/other_user}", "gists_url": "https://api.github.com/users/zou3519/gists{/gist_id}", "starred_url": "https://api.github.com/users/zou3519/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zou3519/subscriptions", "organizations_url": "https://api.github.com/users/zou3519/orgs", "repos_url": "https://api.github.com/users/zou3519/repos", "events_url": "https://api.github.com/users/zou3519/events{/privacy}", "received_events_url": "https://api.github.com/users/zou3519/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-01-25T15:57:26Z", "updated_at": "2018-02-05T17:27:17Z", "closed_at": "2018-02-05T17:27:17Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/4848", "html_url": "https://github.com/pytorch/pytorch/pull/4848", "diff_url": "https://github.com/pytorch/pytorch/pull/4848.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/4848.patch"}, "body_html": "<p><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #4835.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"291313210\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/4835\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/4835/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/4835\">#4835</a></p>\n<p>There's a bug in <code>THCDeviceTensor::downcastOuter</code> where it sometimes doesn't recognize a contiguous tensor as being contiguous. For example,</p>\n<pre><code>x = Variable(torch.randn(7, 1, 5, 3, 2).cuda())\nstrange_strides = [30, 1234, 6, 2, 1]\ny = x.as_strided(x.size(), strange_strides)\ny.strides()  # [30, 1234, 6, 2, 1]\n</code></pre>\n<p><code>y</code> has valid strides and is contiguous because we don't care about what the stride value is at dimensions that has size 1. This changes <code>downcastOuter</code> to take that into account, fixing behavior for <code>VolumetricAveragePooling</code>, <code>VolumetricMaxUnpooling</code>, and <code>VolumetricDilatedMaxPooling</code> and other things that depend on these.</p>\n<h3>Test Plan</h3>\n<p>New unit test for this behavior.<br>\nA lot of the Pooling layers also use <code>downcastOuter</code> so run <code>test_nn</code>.</p>", "body_text": "Fixes #4835\nThere's a bug in THCDeviceTensor::downcastOuter where it sometimes doesn't recognize a contiguous tensor as being contiguous. For example,\nx = Variable(torch.randn(7, 1, 5, 3, 2).cuda())\nstrange_strides = [30, 1234, 6, 2, 1]\ny = x.as_strided(x.size(), strange_strides)\ny.strides()  # [30, 1234, 6, 2, 1]\n\ny has valid strides and is contiguous because we don't care about what the stride value is at dimensions that has size 1. This changes downcastOuter to take that into account, fixing behavior for VolumetricAveragePooling, VolumetricMaxUnpooling, and VolumetricDilatedMaxPooling and other things that depend on these.\nTest Plan\nNew unit test for this behavior.\nA lot of the Pooling layers also use downcastOuter so run test_nn.", "body": "Fixes #4835 \r\n\r\nThere's a bug in `THCDeviceTensor::downcastOuter` where it sometimes doesn't recognize a contiguous tensor as being contiguous. For example, \r\n\r\n```\r\nx = Variable(torch.randn(7, 1, 5, 3, 2).cuda())\r\nstrange_strides = [30, 1234, 6, 2, 1]\r\ny = x.as_strided(x.size(), strange_strides)\r\ny.strides()  # [30, 1234, 6, 2, 1]\r\n```\r\n`y` has valid strides and is contiguous because we don't care about what the stride value is at dimensions that has size 1. This changes `downcastOuter` to take that into account, fixing behavior for `VolumetricAveragePooling`, `VolumetricMaxUnpooling`, and `VolumetricDilatedMaxPooling` and other things that depend on these.\r\n\r\n### Test Plan\r\nNew unit test for this behavior.\r\nA lot of the Pooling layers also use `downcastOuter` so run `test_nn`."}