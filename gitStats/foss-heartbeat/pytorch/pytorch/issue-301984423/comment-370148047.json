{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/370148047", "html_url": "https://github.com/pytorch/pytorch/issues/5542#issuecomment-370148047", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/5542", "id": 370148047, "node_id": "MDEyOklzc3VlQ29tbWVudDM3MDE0ODA0Nw==", "user": {"login": "Qinka", "id": 9249996, "node_id": "MDQ6VXNlcjkyNDk5OTY=", "avatar_url": "https://avatars3.githubusercontent.com/u/9249996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Qinka", "html_url": "https://github.com/Qinka", "followers_url": "https://api.github.com/users/Qinka/followers", "following_url": "https://api.github.com/users/Qinka/following{/other_user}", "gists_url": "https://api.github.com/users/Qinka/gists{/gist_id}", "starred_url": "https://api.github.com/users/Qinka/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Qinka/subscriptions", "organizations_url": "https://api.github.com/users/Qinka/orgs", "repos_url": "https://api.github.com/users/Qinka/repos", "events_url": "https://api.github.com/users/Qinka/events{/privacy}", "received_events_url": "https://api.github.com/users/Qinka/received_events", "type": "User", "site_admin": false}, "created_at": "2018-03-03T13:37:05Z", "updated_at": "2018-03-03T13:37:05Z", "author_association": "NONE", "body_html": "<p>In torch/utils/ffi/<strong>init</strong>.py <code>_build_extension()</code>,  <code>shutil.copy</code> copy the  linked file from <code>os.path.join(tmpdir,, libname)</code>, for example <code>C:\\Users\\qinka\\AppData\\Local\\Temp\\tmpwp84qchn\\dot_power._ext.dow_power._dow_power.pyd</code>, but<br>\nin my Windows, and a Linux work station, the linked one is in:</p>\n<div class=\"highlight highlight-source-python\"><pre>outprefix <span class=\"pl-k\">=</span> cffi_wrapper_name.split(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>.<span class=\"pl-pds\">'</span></span>)[<span class=\"pl-c1\">0</span>:<span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>] <span class=\"pl-c\"><span class=\"pl-c\">#</span></span>\nshutil.copy(os.path.join(tmpdir, <span class=\"pl-k\">*</span>outprefix, libname), <span class=\"pl-c\"><span class=\"pl-c\">#</span></span>\n                  os.path.join(target_dir, libname))</pre></div>\n<p>,for example <code>C:\\Users\\qinka\\AppData\\Local\\Temp\\tmpwp84qchn\\dot_power\\_ext\\dow_power\\dot_power._ext.dow_power._dow_power.pyd</code>.</p>\n<p>So, there must be a bug, or error in pytorch's ffi or python's ffi. (pyhton 3.6.4, cffi 1.11.4),</p>\n<p>If it broke down because of change in cffi, I think I can create a PR.<br>\nI do think this is because of the change of cffi api,</p>", "body_text": "In torch/utils/ffi/init.py _build_extension(),  shutil.copy copy the  linked file from os.path.join(tmpdir,, libname), for example C:\\Users\\qinka\\AppData\\Local\\Temp\\tmpwp84qchn\\dot_power._ext.dow_power._dow_power.pyd, but\nin my Windows, and a Linux work station, the linked one is in:\noutprefix = cffi_wrapper_name.split('.')[0:-1] #\nshutil.copy(os.path.join(tmpdir, *outprefix, libname), #\n                  os.path.join(target_dir, libname))\n,for example C:\\Users\\qinka\\AppData\\Local\\Temp\\tmpwp84qchn\\dot_power\\_ext\\dow_power\\dot_power._ext.dow_power._dow_power.pyd.\nSo, there must be a bug, or error in pytorch's ffi or python's ffi. (pyhton 3.6.4, cffi 1.11.4),\nIf it broke down because of change in cffi, I think I can create a PR.\nI do think this is because of the change of cffi api,", "body": "In torch/utils/ffi/__init__.py `_build_extension()`,  `shutil.copy` copy the  linked file from `os.path.join(tmpdir,, libname)`, for example `C:\\Users\\qinka\\AppData\\Local\\Temp\\tmpwp84qchn\\dot_power._ext.dow_power._dow_power.pyd`, but\r\nin my Windows, and a Linux work station, the linked one is in:\r\n```python\r\noutprefix = cffi_wrapper_name.split('.')[0:-1] #\r\nshutil.copy(os.path.join(tmpdir, *outprefix, libname), #\r\n                  os.path.join(target_dir, libname))\r\n```\r\n,for example `C:\\Users\\qinka\\AppData\\Local\\Temp\\tmpwp84qchn\\dot_power\\_ext\\dow_power\\dot_power._ext.dow_power._dow_power.pyd`.\r\n\r\nSo, there must be a bug, or error in pytorch's ffi or python's ffi. (pyhton 3.6.4, cffi 1.11.4),\r\n\r\n\r\nIf it broke down because of change in cffi, I think I can create a PR.\r\nI do think this is because of the change of cffi api,\r\n\r\n"}