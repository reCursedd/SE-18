{"url": "https://api.github.com/repos/pytorch/pytorch/issues/1912", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/1912/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/1912/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/1912/events", "html_url": "https://github.com/pytorch/pytorch/pull/1912", "id": 238586492, "node_id": "MDExOlB1bGxSZXF1ZXN0MTI3NTAxOTQz", "number": 1912, "title": "C function wrapper uniqueness", "user": {"login": "albanD", "id": 6359743, "node_id": "MDQ6VXNlcjYzNTk3NDM=", "avatar_url": "https://avatars3.githubusercontent.com/u/6359743?v=4", "gravatar_id": "", "url": "https://api.github.com/users/albanD", "html_url": "https://github.com/albanD", "followers_url": "https://api.github.com/users/albanD/followers", "following_url": "https://api.github.com/users/albanD/following{/other_user}", "gists_url": "https://api.github.com/users/albanD/gists{/gist_id}", "starred_url": "https://api.github.com/users/albanD/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/albanD/subscriptions", "organizations_url": "https://api.github.com/users/albanD/orgs", "repos_url": "https://api.github.com/users/albanD/repos", "events_url": "https://api.github.com/users/albanD/events{/privacy}", "received_events_url": "https://api.github.com/users/albanD/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2017-06-26T15:47:18Z", "updated_at": "2018-11-23T15:34:14Z", "closed_at": "2017-07-25T07:42:55Z", "author_association": "COLLABORATOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/1912", "html_url": "https://github.com/pytorch/pytorch/pull/1912", "diff_url": "https://github.com/pytorch/pytorch/pull/1912.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/1912.patch"}, "body_html": "<p>Ideas of this PR:</p>\n<ul>\n<li>If a THPCppFunction exists for a Function, it owns the function and is responsible to delete it.</li>\n<li>To make sure that a Function used in the autograd graph is not freed while still in use in the cpp side, the Function holds one reference to the THPCppFunction that wraps it. This reference is released when the shared_ptr used in the graph is freed (see FunctionDeleter).</li>\n<li>Every Function that will be used in the graph should be created with SharedFunctionMaker. Functions that are not used in the graph can be created regularly. In particular cpp functions that are used only for forward do not need associated shared pointers.</li>\n</ul>\n<p>cc: <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4583066\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/apaszke\">@apaszke</a></p>", "body_text": "Ideas of this PR:\n\nIf a THPCppFunction exists for a Function, it owns the function and is responsible to delete it.\nTo make sure that a Function used in the autograd graph is not freed while still in use in the cpp side, the Function holds one reference to the THPCppFunction that wraps it. This reference is released when the shared_ptr used in the graph is freed (see FunctionDeleter).\nEvery Function that will be used in the graph should be created with SharedFunctionMaker. Functions that are not used in the graph can be created regularly. In particular cpp functions that are used only for forward do not need associated shared pointers.\n\ncc: @apaszke", "body": "Ideas of this PR:\r\n* If a THPCppFunction exists for a Function, it owns the function and is responsible to delete it.\r\n* To make sure that a Function used in the autograd graph is not freed while still in use in the cpp side, the Function holds one reference to the THPCppFunction that wraps it. This reference is released when the shared_ptr used in the graph is freed (see FunctionDeleter).\r\n* Every Function that will be used in the graph should be created with SharedFunctionMaker. Functions that are not used in the graph can be created regularly. In particular cpp functions that are used only for forward do not need associated shared pointers.\r\n\r\ncc: @apaszke "}