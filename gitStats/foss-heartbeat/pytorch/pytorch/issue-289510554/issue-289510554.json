{"url": "https://api.github.com/repos/pytorch/pytorch/issues/4718", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/4718/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/4718/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/4718/events", "html_url": "https://github.com/pytorch/pytorch/issues/4718", "id": 289510554, "node_id": "MDU6SXNzdWUyODk1MTA1NTQ=", "number": 4718, "title": "Incorrect mul_() result with expanded tensor", "user": {"login": "qbx2", "id": 5977817, "node_id": "MDQ6VXNlcjU5Nzc4MTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/5977817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qbx2", "html_url": "https://github.com/qbx2", "followers_url": "https://api.github.com/users/qbx2/followers", "following_url": "https://api.github.com/users/qbx2/following{/other_user}", "gists_url": "https://api.github.com/users/qbx2/gists{/gist_id}", "starred_url": "https://api.github.com/users/qbx2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qbx2/subscriptions", "organizations_url": "https://api.github.com/users/qbx2/orgs", "repos_url": "https://api.github.com/users/qbx2/repos", "events_url": "https://api.github.com/users/qbx2/events{/privacy}", "received_events_url": "https://api.github.com/users/qbx2/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-01-18T05:38:46Z", "updated_at": "2018-01-18T05:47:22Z", "closed_at": "2018-01-18T05:45:36Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Pytorch version: 0.4.0a0+188ee3f <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/pytorch/pytorch/commit/188ee3ff0baf439453c5dd63e1a053ba03b472ad/hovercard\" href=\"https://github.com/pytorch/pytorch/commit/188ee3ff0baf439453c5dd63e1a053ba03b472ad\"><tt>188ee3f</tt></a></p>\n<div class=\"highlight highlight-source-python\"><pre>a_ <span class=\"pl-k\">=</span> torch.randn(<span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">2</span>)\nb <span class=\"pl-k\">=</span> torch.randn(<span class=\"pl-c1\">4</span>,<span class=\"pl-c1\">2</span>)\na <span class=\"pl-k\">=</span> a_.expand(<span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">4</span>, <span class=\"pl-c1\">2</span>)\na.mul(b)\na.mul_(b)</pre></div>\n<p>Result</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">&gt;&gt;</span><span class=\"pl-k\">&gt;</span> a_ <span class=\"pl-k\">=</span> torch.randn(<span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">2</span>)\n<span class=\"pl-k\">&gt;&gt;</span><span class=\"pl-k\">&gt;</span> b <span class=\"pl-k\">=</span> torch.randn(<span class=\"pl-c1\">4</span>,<span class=\"pl-c1\">2</span>)\n<span class=\"pl-k\">&gt;&gt;</span><span class=\"pl-k\">&gt;</span> a <span class=\"pl-k\">=</span> a_.expand(<span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">4</span>, <span class=\"pl-c1\">2</span>)\n<span class=\"pl-k\">&gt;&gt;</span><span class=\"pl-k\">&gt;</span> a.mul(b)\n\n(<span class=\"pl-c1\">0</span> ,.,.) <span class=\"pl-k\">=</span> \n  <span class=\"pl-c1\">0.7724</span> <span class=\"pl-k\">-</span><span class=\"pl-c1\">2.6582</span>\n <span class=\"pl-k\">-</span><span class=\"pl-c1\">0.7434</span>  <span class=\"pl-c1\">0.4124</span>\n  <span class=\"pl-c1\">0.5030</span>  <span class=\"pl-c1\">0.0272</span>\n  <span class=\"pl-c1\">2.0166</span>  <span class=\"pl-c1\">1.0523</span>\n\n(<span class=\"pl-c1\">1</span> ,.,.) <span class=\"pl-k\">=</span> \n  <span class=\"pl-c1\">0.1222</span>  <span class=\"pl-c1\">1.5042</span>\n <span class=\"pl-k\">-</span><span class=\"pl-c1\">0.1176</span> <span class=\"pl-k\">-</span><span class=\"pl-c1\">0.2334</span>\n  <span class=\"pl-c1\">0.0796</span> <span class=\"pl-k\">-</span><span class=\"pl-c1\">0.0154</span>\n  <span class=\"pl-c1\">0.3191</span> <span class=\"pl-k\">-</span><span class=\"pl-c1\">0.5955</span>\n[torch.FloatTensor of size <span class=\"pl-ii\">2x4x2</span>]\n\n<span class=\"pl-k\">&gt;&gt;</span><span class=\"pl-k\">&gt;</span> a.mul_(b)\n\n(<span class=\"pl-c1\">0</span> ,.,.) <span class=\"pl-k\">=</span> \n  <span class=\"pl-c1\">0.2917</span>  <span class=\"pl-c1\">0.0163</span>\n  <span class=\"pl-c1\">0.2917</span>  <span class=\"pl-c1\">0.0163</span>\n  <span class=\"pl-c1\">0.2917</span>  <span class=\"pl-c1\">0.0163</span>\n  <span class=\"pl-c1\">0.2917</span>  <span class=\"pl-c1\">0.0163</span>\n\n(<span class=\"pl-c1\">1</span> ,.,.) <span class=\"pl-k\">=</span> \n  <span class=\"pl-c1\">0.0462</span> <span class=\"pl-k\">-</span><span class=\"pl-c1\">0.0092</span>\n  <span class=\"pl-c1\">0.0462</span> <span class=\"pl-k\">-</span><span class=\"pl-c1\">0.0092</span>\n  <span class=\"pl-c1\">0.0462</span> <span class=\"pl-k\">-</span><span class=\"pl-c1\">0.0092</span>\n  <span class=\"pl-c1\">0.0462</span> <span class=\"pl-k\">-</span><span class=\"pl-c1\">0.0092</span>\n[torch.FloatTensor of size <span class=\"pl-ii\">2x4x2</span>]\n\n</pre></div>\n<p>I expected the result of mul_() to be same with that of mul(). I think it's a bug.<br>\nThanks.</p>\n<p>EDIT: I found it only expand() is required to trigger the bug at the minimum</p>", "body_text": "Pytorch version: 0.4.0a0+188ee3f 188ee3f\na_ = torch.randn(2, 1, 2)\nb = torch.randn(4,2)\na = a_.expand(2, 4, 2)\na.mul(b)\na.mul_(b)\nResult\n>>> a_ = torch.randn(2, 1, 2)\n>>> b = torch.randn(4,2)\n>>> a = a_.expand(2, 4, 2)\n>>> a.mul(b)\n\n(0 ,.,.) = \n  0.7724 -2.6582\n -0.7434  0.4124\n  0.5030  0.0272\n  2.0166  1.0523\n\n(1 ,.,.) = \n  0.1222  1.5042\n -0.1176 -0.2334\n  0.0796 -0.0154\n  0.3191 -0.5955\n[torch.FloatTensor of size 2x4x2]\n\n>>> a.mul_(b)\n\n(0 ,.,.) = \n  0.2917  0.0163\n  0.2917  0.0163\n  0.2917  0.0163\n  0.2917  0.0163\n\n(1 ,.,.) = \n  0.0462 -0.0092\n  0.0462 -0.0092\n  0.0462 -0.0092\n  0.0462 -0.0092\n[torch.FloatTensor of size 2x4x2]\n\n\nI expected the result of mul_() to be same with that of mul(). I think it's a bug.\nThanks.\nEDIT: I found it only expand() is required to trigger the bug at the minimum", "body": "Pytorch version: 0.4.0a0+188ee3f 188ee3ff0baf439453c5dd63e1a053ba03b472ad \r\n```python\r\na_ = torch.randn(2, 1, 2)\r\nb = torch.randn(4,2)\r\na = a_.expand(2, 4, 2)\r\na.mul(b)\r\na.mul_(b)\r\n```\r\n\r\nResult\r\n```python\r\n>>> a_ = torch.randn(2, 1, 2)\r\n>>> b = torch.randn(4,2)\r\n>>> a = a_.expand(2, 4, 2)\r\n>>> a.mul(b)\r\n\r\n(0 ,.,.) = \r\n  0.7724 -2.6582\r\n -0.7434  0.4124\r\n  0.5030  0.0272\r\n  2.0166  1.0523\r\n\r\n(1 ,.,.) = \r\n  0.1222  1.5042\r\n -0.1176 -0.2334\r\n  0.0796 -0.0154\r\n  0.3191 -0.5955\r\n[torch.FloatTensor of size 2x4x2]\r\n\r\n>>> a.mul_(b)\r\n\r\n(0 ,.,.) = \r\n  0.2917  0.0163\r\n  0.2917  0.0163\r\n  0.2917  0.0163\r\n  0.2917  0.0163\r\n\r\n(1 ,.,.) = \r\n  0.0462 -0.0092\r\n  0.0462 -0.0092\r\n  0.0462 -0.0092\r\n  0.0462 -0.0092\r\n[torch.FloatTensor of size 2x4x2]\r\n\r\n\r\n```\r\n\r\nI expected the result of mul_() to be same with that of mul(). I think it's a bug.\r\nThanks.\r\n\r\nEDIT: I found it only expand() is required to trigger the bug at the minimum"}