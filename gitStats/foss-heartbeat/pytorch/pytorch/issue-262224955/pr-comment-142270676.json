{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/142270676", "pull_request_review_id": 66608911, "id": 142270676, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MjI3MDY3Ng==", "diff_hunk": "@@ -258,9 +297,31 @@ def get_type(arg_name):\n                         sizes_name = arg['name'] + '_sizes'\n                         formula = formula.replace(size_str, sizes_name)\n \n+                    # If x is a TensorList, turn x.sizes(y) into x_argsizes_y\n+                    def argsizes_repl(matchobj):\n+                        if arg['type'] != 'TensorList':\n+                            raise RuntimeError(\"sizes(argument) only supported on TensorList\")\n+                        argsizes_name = arg['name'] + \"_argsizes_\" + matchobj.group(1)\n+                        arg_sizes_found.append(argsizes_name + \".size()\")\n+                        return argsizes_name\n+                    formula = re.sub(arg['name'] + r\".sizes\\((\\w+)\\)\", argsizes_repl, formula)\n+\n+                    # If x is a Tensor, turn x.size(y) into x_argsize_y\n+                    def argsize_repl(matchobj):\n+                        if arg['type'] != 'Tensor':\n+                            raise RuntimeError(\"size(argument) only supported on Tensor\")\n+                        argsize_name = arg['name'] + \"_argsize_\" + matchobj.group(1)\n+                        return argsize_name\n+                    formula = re.sub(arg['name'] + r\".size\\((\\w+)\\)\", argsize_repl, formula)\n+\n                 derivatives.append(formula)\n                 arg['derivative'] = formula\n-                option['num_inputs'] += 1\n+                if arg['type'] != \"TensorList\":\n+                    option['num_inputs'] += 1\n+\n+        if arg_sizes_found:\n+            option['num_inputs'] = (\"+\".join(arg_sizes_found) +\n+                                    \"\" if option['num_inputs'] == 0 else \" + \" + str(option['num_inputs']))", "path": "tools/autograd/gen_variable_type.py", "position": null, "original_position": 146, "commit_id": "73bdc946c7aafab133b3b7932e2687f502d1c579", "original_commit_id": "7ce054aea3dfcec98c6f2b8b79a50db9bf3a4bf3", "user": {"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}, "body": "I know. I just can imagine myself doing `if option['num_inputs'] == 5:` in the code and it will silently break because of this", "created_at": "2017-10-02T22:19:29Z", "updated_at": "2018-11-23T15:34:56Z", "html_url": "https://github.com/pytorch/pytorch/pull/2936#discussion_r142270676", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/2936", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/142270676"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/2936#discussion_r142270676"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/2936"}}, "body_html": "<p>I know. I just can imagine myself doing <code>if option['num_inputs'] == 5:</code> in the code and it will silently break because of this</p>", "body_text": "I know. I just can imagine myself doing if option['num_inputs'] == 5: in the code and it will silently break because of this", "in_reply_to_id": 142263272}