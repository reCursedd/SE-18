{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/373335159", "html_url": "https://github.com/pytorch/pytorch/issues/3718#issuecomment-373335159", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/3718", "id": 373335159, "node_id": "MDEyOklzc3VlQ29tbWVudDM3MzMzNTE1OQ==", "user": {"login": "magic282", "id": 2285145, "node_id": "MDQ6VXNlcjIyODUxNDU=", "avatar_url": "https://avatars1.githubusercontent.com/u/2285145?v=4", "gravatar_id": "", "url": "https://api.github.com/users/magic282", "html_url": "https://github.com/magic282", "followers_url": "https://api.github.com/users/magic282/followers", "following_url": "https://api.github.com/users/magic282/following{/other_user}", "gists_url": "https://api.github.com/users/magic282/gists{/gist_id}", "starred_url": "https://api.github.com/users/magic282/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/magic282/subscriptions", "organizations_url": "https://api.github.com/users/magic282/orgs", "repos_url": "https://api.github.com/users/magic282/repos", "events_url": "https://api.github.com/users/magic282/events{/privacy}", "received_events_url": "https://api.github.com/users/magic282/received_events", "type": "User", "site_admin": false}, "created_at": "2018-03-15T10:48:16Z", "updated_at": "2018-03-15T10:48:16Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=3637896\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rdspring1\">@rdspring1</a> I see. I just tried your SampledSoftmax class code with</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-c1\">self</span>.sampler <span class=\"pl-k\">=</span> SampledSoftmax(<span class=\"pl-c1\">self</span>.num_classes, <span class=\"pl-c1\">8000</span>, <span class=\"pl-c1\">1024</span>, <span class=\"pl-c1\">False</span>)</pre></div>\n<p>and</p>\n<div class=\"highlight highlight-source-python\"><pre>forward_logits, forward_new_targets <span class=\"pl-k\">=</span> <span class=\"pl-c1\">self</span>.sampler(forward_hidden, forward_output_tokens)</pre></div>\n<p><code>forward_hidden</code> is the hidden of RNN with shape <code>(batch, seq_len, dim)</code><br>\n<code>forward_output_tokens</code> is the target with shape (batch, seq_len)`<br>\nWhen executing this line</p>\n<div class=\"highlight highlight-source-python\"><pre>sample_values <span class=\"pl-k\">=</span> <span class=\"pl-c1\">self</span>.sampler.sample(<span class=\"pl-c1\">self</span>.nsampled, labels.data.cpu().numpy())</pre></div>\n<p>I got the following error:</p>\n<pre><code>  File \"/workspace/tmp/elmo/allennlp/allennlp/models/xelmo.py\", line 43, in forward\n    sample_values = self.sampler.sample(self.nsampled, labels.data.cpu().numpy())\n  File \"log_uniform.pyx\", line 32, in log_uniform.LogUniformSampler.sample\n  File \"stringsource\", line 48, in vector.from_py.__pyx_convert_vector_from_py_long\nTypeError: an integer is required\n</code></pre>\n<p>Could you please give some hints about this error? I tried to change it to <code>labels.data.int().cpu().numpy()</code> but the error is the same.<br>\nThanks.</p>", "body_text": "@rdspring1 I see. I just tried your SampledSoftmax class code with\nself.sampler = SampledSoftmax(self.num_classes, 8000, 1024, False)\nand\nforward_logits, forward_new_targets = self.sampler(forward_hidden, forward_output_tokens)\nforward_hidden is the hidden of RNN with shape (batch, seq_len, dim)\nforward_output_tokens is the target with shape (batch, seq_len)`\nWhen executing this line\nsample_values = self.sampler.sample(self.nsampled, labels.data.cpu().numpy())\nI got the following error:\n  File \"/workspace/tmp/elmo/allennlp/allennlp/models/xelmo.py\", line 43, in forward\n    sample_values = self.sampler.sample(self.nsampled, labels.data.cpu().numpy())\n  File \"log_uniform.pyx\", line 32, in log_uniform.LogUniformSampler.sample\n  File \"stringsource\", line 48, in vector.from_py.__pyx_convert_vector_from_py_long\nTypeError: an integer is required\n\nCould you please give some hints about this error? I tried to change it to labels.data.int().cpu().numpy() but the error is the same.\nThanks.", "body": "@rdspring1 I see. I just tried your SampledSoftmax class code with\r\n```python\r\nself.sampler = SampledSoftmax(self.num_classes, 8000, 1024, False)\r\n```\r\nand\r\n```python\r\nforward_logits, forward_new_targets = self.sampler(forward_hidden, forward_output_tokens)\r\n```\r\n`forward_hidden` is the hidden of RNN with shape `(batch, seq_len, dim)`\r\n`forward_output_tokens` is the target with shape (batch, seq_len)`\r\nWhen executing this line\r\n```python\r\nsample_values = self.sampler.sample(self.nsampled, labels.data.cpu().numpy())\r\n```\r\nI got the following error:\r\n```\r\n  File \"/workspace/tmp/elmo/allennlp/allennlp/models/xelmo.py\", line 43, in forward\r\n    sample_values = self.sampler.sample(self.nsampled, labels.data.cpu().numpy())\r\n  File \"log_uniform.pyx\", line 32, in log_uniform.LogUniformSampler.sample\r\n  File \"stringsource\", line 48, in vector.from_py.__pyx_convert_vector_from_py_long\r\nTypeError: an integer is required\r\n```\r\nCould you please give some hints about this error? I tried to change it to `labels.data.int().cpu().numpy()` but the error is the same.\r\nThanks."}