{"url": "https://api.github.com/repos/pytorch/pytorch/issues/3850", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/3850/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/3850/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/3850/events", "html_url": "https://github.com/pytorch/pytorch/issues/3850", "id": 276399600, "node_id": "MDU6SXNzdWUyNzYzOTk2MDA=", "number": 3850, "title": "Converting Caffe to PyTorch", "user": {"login": "ilichev-andrey", "id": 24242890, "node_id": "MDQ6VXNlcjI0MjQyODkw", "avatar_url": "https://avatars2.githubusercontent.com/u/24242890?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ilichev-andrey", "html_url": "https://github.com/ilichev-andrey", "followers_url": "https://api.github.com/users/ilichev-andrey/followers", "following_url": "https://api.github.com/users/ilichev-andrey/following{/other_user}", "gists_url": "https://api.github.com/users/ilichev-andrey/gists{/gist_id}", "starred_url": "https://api.github.com/users/ilichev-andrey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ilichev-andrey/subscriptions", "organizations_url": "https://api.github.com/users/ilichev-andrey/orgs", "repos_url": "https://api.github.com/users/ilichev-andrey/repos", "events_url": "https://api.github.com/users/ilichev-andrey/events{/privacy}", "received_events_url": "https://api.github.com/users/ilichev-andrey/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-11-23T14:45:39Z", "updated_at": "2017-11-23T20:08:23Z", "closed_at": "2017-11-23T20:08:23Z", "author_association": "NONE", "body_html": "<p>Hello. I want to convert the model from Caffe to PyTorch. Model is resnet50_1by2 custom dataset.</p>\n<p><strong>Variant 1</strong>. Using torch and loadcaffe converted model.<br>\n<strong>Result</strong>: not all layers were converted.<br>\n<strong>Example</strong>:</p>\n<blockquote>\n<p>-- warning: module 'bn_stage0_block0_branch2c [type BatchNorm]' not found<br>\n-- warning: module 'scale_stage0_block0_branch2c [type Scale]' not found<br>\n-- warning: module 'eltwise_stage0_block0 [type Eltwise]' not found</p>\n</blockquote>\n<p><strong>Variant 2</strong>. Install Caffe and convert params to numpy. Load numpy arrays to PyTorch.<br>\n<strong>Example</strong>:<br>\nCaffe -&gt; PyTorch</p>\n<blockquote>\n<p>conv_1_0 -&gt; conv_1.weight<br>\nconv_1_1 -&gt; conv_1.bias<br>\nbn_1_0 -&gt; bn_1.running_mean<br>\nbn_1_1 -&gt; bn_1.running_var<br>\nscale_1_0 -&gt; bn_1.weight<br>\nscale_1_1 -&gt; bn_1.bias</p>\n</blockquote>\n<p><strong>Result</strong>: All the sizes of layers coincide, architecture too. All weights correspond! PyTorch model working! But when I make the profiling, the result is different after each layer and as a result the values are completely wrong.</p>\n<p>What could be wrong with the <strong>Variant 2</strong>?</p>\n<p>P.S. Pictures for testing are the same, normalization too. 3x224x224 (0, 255).<br>\nCaffe input BGR image, and PyTorch input BGR image.</p>\n<p>Full profiling:</p>\n<ol>\n<li>\n<p>Export caffe params:<br>\nbriefly: <a href=\"https://drive.google.com/open?id=1O1Hdy0FYe0DE2taW2PWltmGun4XXYGxN\" rel=\"nofollow\">caffe_params</a> (split(' '))<br>\nfull: <a href=\"https://drive.google.com/open?id=1AYtmULE3mxP4FpujzRv7KgmtehJ_hzL5\" rel=\"nofollow\">caffe_params_ext</a></p>\n</li>\n<li>\n<p>Merge caffe and pytorch layers:<br>\n<a href=\"https://drive.google.com/open?id=1IRDrSml1urz2SH0uwoi2IYlECfq-yElY\" rel=\"nofollow\">merge</a> (split(' '))</p>\n</li>\n<li>\n<p>Initialization parameters in pytorch and export params to numpy:<br>\nbriefly: <a href=\"https://drive.google.com/open?id=1rysuSQUSt2ckWfezUgQQR3GptXFzZhCK\" rel=\"nofollow\">pytorch_params</a> (split(' '))<br>\nfull: <a href=\"https://drive.google.com/open?id=1aChkwGOmVs3WaI8Xu1XZOkketsR3XcaA\" rel=\"nofollow\">pytorch_params_ext</a></p>\n</li>\n<li>\n<p>Testing model:<br>\nThe initial and final layers recorded<br>\n<a href=\"https://drive.google.com/open?id=12HzBQO9r8qJRmZ7TjU5Msf-a8Ui3qxCL\" rel=\"nofollow\">caffe_outputs</a><br>\n<a href=\"https://drive.google.com/open?id=1sBYSRJqjD38fYRsjJ6YO5bv351uyJ_rb\" rel=\"nofollow\">pytorch_outputs</a></p>\n</li>\n</ol>", "body_text": "Hello. I want to convert the model from Caffe to PyTorch. Model is resnet50_1by2 custom dataset.\nVariant 1. Using torch and loadcaffe converted model.\nResult: not all layers were converted.\nExample:\n\n-- warning: module 'bn_stage0_block0_branch2c [type BatchNorm]' not found\n-- warning: module 'scale_stage0_block0_branch2c [type Scale]' not found\n-- warning: module 'eltwise_stage0_block0 [type Eltwise]' not found\n\nVariant 2. Install Caffe and convert params to numpy. Load numpy arrays to PyTorch.\nExample:\nCaffe -> PyTorch\n\nconv_1_0 -> conv_1.weight\nconv_1_1 -> conv_1.bias\nbn_1_0 -> bn_1.running_mean\nbn_1_1 -> bn_1.running_var\nscale_1_0 -> bn_1.weight\nscale_1_1 -> bn_1.bias\n\nResult: All the sizes of layers coincide, architecture too. All weights correspond! PyTorch model working! But when I make the profiling, the result is different after each layer and as a result the values are completely wrong.\nWhat could be wrong with the Variant 2?\nP.S. Pictures for testing are the same, normalization too. 3x224x224 (0, 255).\nCaffe input BGR image, and PyTorch input BGR image.\nFull profiling:\n\n\nExport caffe params:\nbriefly: caffe_params (split(' '))\nfull: caffe_params_ext\n\n\nMerge caffe and pytorch layers:\nmerge (split(' '))\n\n\nInitialization parameters in pytorch and export params to numpy:\nbriefly: pytorch_params (split(' '))\nfull: pytorch_params_ext\n\n\nTesting model:\nThe initial and final layers recorded\ncaffe_outputs\npytorch_outputs", "body": "Hello. I want to convert the model from Caffe to PyTorch. Model is resnet50_1by2 custom dataset.\r\n\r\n**Variant 1**. Using torch and loadcaffe converted model.\r\n**Result**: not all layers were converted.\r\n**Example**: \r\n> -- warning: module 'bn_stage0_block0_branch2c [type BatchNorm]' not found\r\n> -- warning: module 'scale_stage0_block0_branch2c [type Scale]' not found\r\n> -- warning: module 'eltwise_stage0_block0 [type Eltwise]' not found\r\n\r\n**Variant 2**. Install Caffe and convert params to numpy. Load numpy arrays to PyTorch.\r\n**Example**:\r\nCaffe -> PyTorch\r\n> conv_1_0 -> conv_1.weight\r\n> conv_1_1 -> conv_1.bias\r\n> bn_1_0 -> bn_1.running_mean\r\n> bn_1_1 -> bn_1.running_var\r\n> scale_1_0 -> bn_1.weight\r\n> scale_1_1 -> bn_1.bias\r\n\r\n**Result**: All the sizes of layers coincide, architecture too. All weights correspond! PyTorch model working! But when I make the profiling, the result is different after each layer and as a result the values are completely wrong.\r\n\r\nWhat could be wrong with the **Variant 2**?\r\n\r\nP.S. Pictures for testing are the same, normalization too. 3x224x224 (0, 255). \r\nCaffe input BGR image, and PyTorch input BGR image.\r\n\r\nFull profiling:\r\n\r\n1) Export caffe params:\r\nbriefly: [caffe_params](https://drive.google.com/open?id=1O1Hdy0FYe0DE2taW2PWltmGun4XXYGxN) (split(' '))\r\nfull: [caffe_params_ext](https://drive.google.com/open?id=1AYtmULE3mxP4FpujzRv7KgmtehJ_hzL5)\r\n\r\n2) Merge caffe and pytorch layers:\r\n[merge](https://drive.google.com/open?id=1IRDrSml1urz2SH0uwoi2IYlECfq-yElY) (split(' '))\r\n\r\n3) Initialization parameters in pytorch and export params to numpy:\r\nbriefly: [pytorch_params](https://drive.google.com/open?id=1rysuSQUSt2ckWfezUgQQR3GptXFzZhCK) (split(' '))\r\nfull: [pytorch_params_ext](https://drive.google.com/open?id=1aChkwGOmVs3WaI8Xu1XZOkketsR3XcaA)\r\n\r\n4) Testing model:\r\nThe initial and final layers recorded\r\n[caffe_outputs](https://drive.google.com/open?id=12HzBQO9r8qJRmZ7TjU5Msf-a8Ui3qxCL) \r\n[pytorch_outputs](https://drive.google.com/open?id=1sBYSRJqjD38fYRsjJ6YO5bv351uyJ_rb)"}