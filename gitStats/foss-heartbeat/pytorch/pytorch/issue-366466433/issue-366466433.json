{"url": "https://api.github.com/repos/pytorch/pytorch/issues/12290", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/12290/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/12290/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/12290/events", "html_url": "https://github.com/pytorch/pytorch/issues/12290", "id": 366466433, "node_id": "MDU6SXNzdWUzNjY0NjY0MzM=", "number": 12290, "title": "[jit] graph fuser doesn't look past broadcasts when fusing", "user": {"login": "zou3519", "id": 5652049, "node_id": "MDQ6VXNlcjU2NTIwNDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/5652049?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zou3519", "html_url": "https://github.com/zou3519", "followers_url": "https://api.github.com/users/zou3519/followers", "following_url": "https://api.github.com/users/zou3519/following{/other_user}", "gists_url": "https://api.github.com/users/zou3519/gists{/gist_id}", "starred_url": "https://api.github.com/users/zou3519/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zou3519/subscriptions", "organizations_url": "https://api.github.com/users/zou3519/orgs", "repos_url": "https://api.github.com/users/zou3519/repos", "events_url": "https://api.github.com/users/zou3519/events{/privacy}", "received_events_url": "https://api.github.com/users/zou3519/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 679953983, "node_id": "MDU6TGFiZWw2Nzk5NTM5ODM=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/jit", "name": "jit", "color": "c5def5", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-10-03T18:22:01Z", "updated_at": "2018-10-03T18:22:02Z", "closed_at": null, "author_association": "CONTRIBUTOR", "body_html": "<h2><g-emoji class=\"g-emoji\" alias=\"bug\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f41b.png\">\ud83d\udc1b</g-emoji> Bug</h2>\n<p>Let f, g, h be fusible ops.</p>\n<pre><code>x = f(w)\nz = g(x, y)\na, b = chunk(z)\nc = h(a, b)\n</code></pre>\n<p>becomes (with the current graph fuser pass):</p>\n<pre><code>x = f(w)\nx', y' = broadcast(x, y)\nax, bx = chunk(x')\nay, by = chunk(y')\na = g(ax, ay)\nb = g(bx, by)\nc = h(a, b)\n</code></pre>\n<p>The broadcast node prevents f from being fused into the bottom group.<br>\nIt would be great if we could move the broadcast node up as well to produce<br>\nsomething like:</p>\n<pre><code>w', y' = broadcast(w, y)\nx' = f(w')\nax, bx = chunk(x')\nay, by = chunk(y')\na = g(ax, ay)\nb = g(bx, by)\n</code></pre>\n<p>cc <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4583066\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/apaszke\">@apaszke</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=38511765\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/mruberry\">@mruberry</a></p>", "body_text": "\ud83d\udc1b Bug\nLet f, g, h be fusible ops.\nx = f(w)\nz = g(x, y)\na, b = chunk(z)\nc = h(a, b)\n\nbecomes (with the current graph fuser pass):\nx = f(w)\nx', y' = broadcast(x, y)\nax, bx = chunk(x')\nay, by = chunk(y')\na = g(ax, ay)\nb = g(bx, by)\nc = h(a, b)\n\nThe broadcast node prevents f from being fused into the bottom group.\nIt would be great if we could move the broadcast node up as well to produce\nsomething like:\nw', y' = broadcast(w, y)\nx' = f(w')\nax, bx = chunk(x')\nay, by = chunk(y')\na = g(ax, ay)\nb = g(bx, by)\n\ncc @apaszke @mruberry", "body": "## \ud83d\udc1b Bug\r\n\r\nLet f, g, h be fusible ops.\r\n\r\n```\r\nx = f(w)\r\nz = g(x, y)\r\na, b = chunk(z)\r\nc = h(a, b)\r\n```\r\n\r\nbecomes (with the current graph fuser pass):\r\n\r\n```\r\nx = f(w)\r\nx', y' = broadcast(x, y)\r\nax, bx = chunk(x')\r\nay, by = chunk(y')\r\na = g(ax, ay)\r\nb = g(bx, by)\r\nc = h(a, b)\r\n```\r\n\r\nThe broadcast node prevents f from being fused into the bottom group.\r\nIt would be great if we could move the broadcast node up as well to produce\r\nsomething like:\r\n\r\n```\r\nw', y' = broadcast(w, y)\r\nx' = f(w')\r\nax, bx = chunk(x')\r\nay, by = chunk(y')\r\na = g(ax, ay)\r\nb = g(bx, by)\r\n```\r\n\r\ncc @apaszke @mruberry "}