{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/204957721", "pull_request_review_id": 140133461, "id": 204957721, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNDk1NzcyMQ==", "diff_hunk": "@@ -31,7 +31,7 @@ struct Type;\n using TypePtr = std::shared_ptr<Type>;\n \n \n-struct TORCH_API Type {\n+struct TORCH_API Type : std::enable_shared_from_this<Type> {", "path": "torch/csrc/jit/type.h", "position": 5, "original_position": 5, "commit_id": "301cf0d6dafe548c80dae665b3f2bb1fd9ef77f4", "original_commit_id": "fa4343dacfc3d30194228ece6ca949887d51dca2", "user": {"login": "smessmer", "id": 2373925, "node_id": "MDQ6VXNlcjIzNzM5MjU=", "avatar_url": "https://avatars3.githubusercontent.com/u/2373925?v=4", "gravatar_id": "", "url": "https://api.github.com/users/smessmer", "html_url": "https://github.com/smessmer", "followers_url": "https://api.github.com/users/smessmer/followers", "following_url": "https://api.github.com/users/smessmer/following{/other_user}", "gists_url": "https://api.github.com/users/smessmer/gists{/gist_id}", "starred_url": "https://api.github.com/users/smessmer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/smessmer/subscriptions", "organizations_url": "https://api.github.com/users/smessmer/orgs", "repos_url": "https://api.github.com/users/smessmer/repos", "events_url": "https://api.github.com/users/smessmer/events{/privacy}", "received_events_url": "https://api.github.com/users/smessmer/received_events", "type": "User", "site_admin": false}, "body": "hm is there a way to do this without enable_shared_from_this? There's a lot of pitfalls using that and I'd rather avoid it. If you wanna go ahead with it, please add something that forbids creation of `Type` objects on the stack, i.e. make all constructors private and force people to use something like `make_shared` (or `make_type`). Otherwise people will create objects on the stack, try to get a `shared_ptr` from it, and bad things will happen.", "created_at": "2018-07-25T01:16:52Z", "updated_at": "2018-11-23T15:48:03Z", "html_url": "https://github.com/pytorch/pytorch/pull/9786#discussion_r204957721", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/9786", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/204957721"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/9786#discussion_r204957721"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/9786"}}, "body_html": "<p>hm is there a way to do this without enable_shared_from_this? There's a lot of pitfalls using that and I'd rather avoid it. If you wanna go ahead with it, please add something that forbids creation of <code>Type</code> objects on the stack, i.e. make all constructors private and force people to use something like <code>make_shared</code> (or <code>make_type</code>). Otherwise people will create objects on the stack, try to get a <code>shared_ptr</code> from it, and bad things will happen.</p>", "body_text": "hm is there a way to do this without enable_shared_from_this? There's a lot of pitfalls using that and I'd rather avoid it. If you wanna go ahead with it, please add something that forbids creation of Type objects on the stack, i.e. make all constructors private and force people to use something like make_shared (or make_type). Otherwise people will create objects on the stack, try to get a shared_ptr from it, and bad things will happen."}