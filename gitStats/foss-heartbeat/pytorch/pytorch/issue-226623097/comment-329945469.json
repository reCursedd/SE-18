{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/329945469", "html_url": "https://github.com/pytorch/pytorch/issues/1488#issuecomment-329945469", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/1488", "id": 329945469, "node_id": "MDEyOklzc3VlQ29tbWVudDMyOTk0NTQ2OQ==", "user": {"login": "randxie", "id": 10520307, "node_id": "MDQ6VXNlcjEwNTIwMzA3", "avatar_url": "https://avatars0.githubusercontent.com/u/10520307?v=4", "gravatar_id": "", "url": "https://api.github.com/users/randxie", "html_url": "https://github.com/randxie", "followers_url": "https://api.github.com/users/randxie/followers", "following_url": "https://api.github.com/users/randxie/following{/other_user}", "gists_url": "https://api.github.com/users/randxie/gists{/gist_id}", "starred_url": "https://api.github.com/users/randxie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/randxie/subscriptions", "organizations_url": "https://api.github.com/users/randxie/orgs", "repos_url": "https://api.github.com/users/randxie/repos", "events_url": "https://api.github.com/users/randxie/events{/privacy}", "received_events_url": "https://api.github.com/users/randxie/received_events", "type": "User", "site_admin": false}, "created_at": "2017-09-16T04:45:15Z", "updated_at": "2017-09-16T04:45:15Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Hi all, it is my first time trying to contribute to an open-source project. I took a look on the bug. It seems that it is related to the function \"state_dict()\" of class \"optimizer.py\". When the state is transformed to packed_state, it uses dict instead of defaultdict, which is inconsistent with the type of state.</p>\n<p>The solution I am proposing is to let the packed_state be defaultdict to maintain consistency with self.state. Here is my proposed change:</p>\n<p><strong>packed_state = defaultdict(dict, {(id(k) if isinstance(k, Variable) else k): v for k, v in self.state.items()})</strong></p>\n<p>Is there anything I am missing? Is \"run_test.sh\" in the pytorch/test enough to validate my change? Where could I add a test point to ensure the type of state remain the same after saving and loading? Thanks a lot for your patience.</p>", "body_text": "Hi all, it is my first time trying to contribute to an open-source project. I took a look on the bug. It seems that it is related to the function \"state_dict()\" of class \"optimizer.py\". When the state is transformed to packed_state, it uses dict instead of defaultdict, which is inconsistent with the type of state.\nThe solution I am proposing is to let the packed_state be defaultdict to maintain consistency with self.state. Here is my proposed change:\npacked_state = defaultdict(dict, {(id(k) if isinstance(k, Variable) else k): v for k, v in self.state.items()})\nIs there anything I am missing? Is \"run_test.sh\" in the pytorch/test enough to validate my change? Where could I add a test point to ensure the type of state remain the same after saving and loading? Thanks a lot for your patience.", "body": "Hi all, it is my first time trying to contribute to an open-source project. I took a look on the bug. It seems that it is related to the function \"state_dict()\" of class \"optimizer.py\". When the state is transformed to packed_state, it uses dict instead of defaultdict, which is inconsistent with the type of state.\r\n\r\nThe solution I am proposing is to let the packed_state be defaultdict to maintain consistency with self.state. Here is my proposed change:\r\n\r\n**packed_state = defaultdict(dict, {(id(k) if isinstance(k, Variable) else k): v for k, v in self.state.items()})**\r\n\r\nIs there anything I am missing? Is \"run_test.sh\" in the pytorch/test enough to validate my change? Where could I add a test point to ensure the type of state remain the same after saving and loading? Thanks a lot for your patience.\r\n\r\n"}