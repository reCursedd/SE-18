{"url": "https://api.github.com/repos/pytorch/pytorch/issues/8348", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/8348/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/8348/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/8348/events", "html_url": "https://github.com/pytorch/pytorch/issues/8348", "id": 331352067, "node_id": "MDU6SXNzdWUzMzEzNTIwNjc=", "number": 8348, "title": "Linux CentOS pytorch build from source ignores CC env variable", "user": {"login": "Fuchai", "id": 16367295, "node_id": "MDQ6VXNlcjE2MzY3Mjk1", "avatar_url": "https://avatars1.githubusercontent.com/u/16367295?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Fuchai", "html_url": "https://github.com/Fuchai", "followers_url": "https://api.github.com/users/Fuchai/followers", "following_url": "https://api.github.com/users/Fuchai/following{/other_user}", "gists_url": "https://api.github.com/users/Fuchai/gists{/gist_id}", "starred_url": "https://api.github.com/users/Fuchai/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Fuchai/subscriptions", "organizations_url": "https://api.github.com/users/Fuchai/orgs", "repos_url": "https://api.github.com/users/Fuchai/repos", "events_url": "https://api.github.com/users/Fuchai/events{/privacy}", "received_events_url": "https://api.github.com/users/Fuchai/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 679953983, "node_id": "MDU6TGFiZWw2Nzk5NTM5ODM=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/jit", "name": "jit", "color": "c5def5", "default": false}, {"id": 443484050, "node_id": "MDU6TGFiZWw0NDM0ODQwNTA=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/medium%20priority", "name": "medium priority", "color": "fbca04", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 24, "created_at": "2018-06-11T21:12:01Z", "updated_at": "2018-11-10T07:38:54Z", "closed_at": null, "author_association": "NONE", "body_html": "<h2>Issue description</h2>\n<p>Hello,</p>\n<p>I am trying to build PyTorch from source with a specific CC at path <code>/mypath/cc</code> (gcc 6.3.1), instead of <code>/usr/bin/c++</code>(gcc 4.4.7).<br>\nI ran the command <code>CC=/mypath/cc python setup.py install</code>, and the log shows that it's still using <code>/usr/bin/c++</code>, instead of <code>/mypath/cc</code><br>\nI switched to another server where the default cc is set to be the newer one through scl.</p>\n<pre><code>[username@infodev1 pytorch]$ which cc\n/mypath/cc\n[username@infodev1 pytorch]$ cc --version\ncc (GCC) 6.3.1 20170216 (Red Hat 6.3.1-3)\n</code></pre>\n<p>Then I ran 'python setup.py install', thinking that cc would be the newer one, but the script somehow still finds <code>/usr/bin/c++</code>. The error pertains. The log is exactly the same.</p>\n<p>What is the correct way to configure the setup script to use specified compiler on Linux? Please advise.<br>\nI am compiling on CentOS 6.9. I do not have sudo rights.</p>\n<p>Thank you!</p>\n<h2>Build log</h2>\n<pre><code>CC=/mypath/cc python setup.py install\nrunning install\nrunning build_deps\n+ WITH_CUDA=0\n+ [[ --with-cuda == \\-\\-\\w\\i\\t\\h\\-\\c\\u\\d\\a ]]\n+ WITH_CUDA=1\n+ shift\n+ WITH_NNPACK=0\n+ [[ --with-nnpack == \\-\\-\\w\\i\\t\\h\\-\\n\\n\\p\\a\\c\\k ]]\n+ WITH_NNPACK=1\n+ shift\n+ WITH_MKLDNN=0\n+ [[ --with-mkldnn == \\-\\-\\w\\i\\t\\h\\-\\m\\k\\l\\d\\n\\n ]]\n+ WITH_MKLDNN=1\n+ shift\n+ WITH_GLOO_IBVERBS=0\n+ [[ nccl == \\-\\-\\w\\i\\t\\h\\-\\g\\l\\o\\o\\-\\i\\b\\v\\e\\r\\b\\s ]]\n+ CMAKE_INSTALL='make install'\n+ USER_CFLAGS=\n+ USER_LDFLAGS=\n+ [[ -n -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now ]]\n+ USER_LDFLAGS=' -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now'\n+ [[ -n -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe ]]\n+ USER_CFLAGS=' -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe'\n+ USER_LDFLAGS=' -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe'\n+ [[ -n -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 ]]\n+ USER_C_CFLAGS=' -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe -DNDEBUG -D_FORTIFY_SOURCE=2 -O2'\n+ USER_LDFLAGS=' -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe -DNDEBUG -D_FORTIFY_SOURCE=2 -O2'\n++ dirname tools/build_pytorch_libs.sh\n+ cd tools/..\n+++ pwd\n++ printf '%q\\n' /home/username/git/pytorch\n+ PWD=/home/username/git/pytorch\n+ BASE_DIR=/home/username/git/pytorch\n+ TORCH_LIB_DIR=/home/username/git/pytorch/torch/lib\n+ INSTALL_DIR=/home/username/git/pytorch/torch/lib/tmp_install\n+ THIRD_PARTY_DIR=/home/username/git/pytorch/third_party\n+ CMAKE_VERSION=cmake\n+ C_FLAGS=' -DTH_INDEX_BASE=0 -I\"/home/username/git/pytorch/torch/lib/tmp_install/include\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCUNN\"'\n+ C_FLAGS=' -DTH_INDEX_BASE=0 -I\"/home/username/git/pytorch/torch/lib/tmp_install/include\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1'\n+ LDFLAGS='-L\"/home/username/git/pytorch/torch/lib/tmp_install/lib\" '\n+ LD_POSTFIX=.so.1\n+ LD_POSTFIX_UNVERSIONED=.so\n++ uname\n+ [[ Linux == \\D\\a\\r\\w\\i\\n ]]\n+ LDFLAGS='-L\"/home/username/git/pytorch/torch/lib/tmp_install/lib\"  -Wl,-rpath,$ORIGIN'\n+ CPP_FLAGS=' -std=c++11 '\n+ GLOO_FLAGS=\n+ THD_FLAGS=\n+ NCCL_ROOT_DIR=/home/username/git/pytorch/torch/lib/tmp_install\n+ [[ 1 -eq 1 ]]\n+ GLOO_FLAGS='-DUSE_CUDA=1 -DNCCL_ROOT_DIR=/home/username/git/pytorch/torch/lib/tmp_install'\n+ [[ 0 -eq 1 ]]\n+ CWRAP_FILES='/home/username/git/pytorch/torch/lib/ATen/Declarations.cwrap;/home/username/git/pytorch/torch/lib/THNN/generic/THNN.h;/home/username/git/pytorch/torch/lib/THCUNN/generic/THCUNN.h;/home/username/git/pytorch/torch/lib/ATen/nn.yaml'\n+ CUDA_NVCC_FLAGS=' -DTH_INDEX_BASE=0 -I\"/home/username/git/pytorch/torch/lib/tmp_install/include\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1'\n+ [[ '' -eq 1 ]]\n+ '[' -z 56 ']'\n+ BUILD_TYPE=Release\n+ [[ -n '' ]]\n+ [[ -n '' ]]\n+ echo 'Building in Release mode'\nBuilding in Release mode\n+ mkdir -p torch/lib/tmp_install\n+ for arg in '\"$@\"'\n+ [[ nccl == \\n\\c\\c\\l ]]\n+ pushd /home/username/git/pytorch/third_party\n~/git/pytorch/third_party ~/git/pytorch\n+ build_nccl\n+ mkdir -p build/nccl\n+ pushd build/nccl\n~/git/pytorch/third_party/build/nccl ~/git/pytorch/third_party ~/git/pytorch\n+ cmake ../../nccl -DCMAKE_MODULE_PATH=/home/username/git/pytorch/cmake/FindCUDA -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/home/username/git/pytorch/torch/lib/tmp_install '-DCMAKE_C_FLAGS= -DTH_INDEX_BASE=0 -I\"/home/username/git/pytorch/torch/lib/tmp_install/include\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1  -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe' '-DCMAKE_CXX_FLAGS= -DTH_INDEX_BASE=0 -I\"/home/username/git/pytorch/torch/lib/tmp_install/include\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1  -std=c++11   -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe' '-DCMAKE_SHARED_LINKER_FLAGS= -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe -DNDEBUG -D_FORTIFY_SOURCE=2 -O2'\n-- The CXX compiler identification is GNU 4.4.7\n-- Check for working CXX compiler: /usr/bin/c++\n-- Check for working CXX compiler: /usr/bin/c++ -- broken\nCMake Error at /home/username/.conda/envs/jason/share/cmake-3.11/Modules/CMakeTestCXXCompiler.cmake:45 (message):\n  The C++ compiler\n\n    \"/usr/bin/c++\"\n\n  is not able to compile a simple test program.\n\n  It fails with the following output:\n\n    Change Dir: /home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeTmp\n\n    Run Build Command:\"/usr/bin/gmake\" \"cmTC_98223/fast\"\n    /usr/bin/gmake -f CMakeFiles/cmTC_98223.dir/build.make CMakeFiles/cmTC_98223.dir/build\n    gmake[1]: Entering directory `/server/home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeTmp'\n    Building CXX object CMakeFiles/cmTC_98223.dir/testCXXCompiler.cxx.o\n    /usr/bin/c++    -DTH_INDEX_BASE=0 -I\"/home/username/git/pytorch/torch/lib/tmp_install/include\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1  -std=c++11   -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe    -o CMakeFiles/cmTC_98223.dir/testCXXCompiler.cxx.o -c /home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeTmp/testCXXCompiler.cxx\n    cc1plus: error: unrecognized command line option \"-std=c++11\"\n    cc1plus: error: unrecognized command line option \"-fstack-protector-strong\"\n    cc1plus: error: unrecognized command line option \"-fno-plt\"\n    /home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeTmp/testCXXCompiler.cxx:1: error: bad value (haswell) for -mtune= switch\n    gmake[1]: *** [CMakeFiles/cmTC_98223.dir/testCXXCompiler.cxx.o] Error 1\n    gmake[1]: Leaving directory `/server/home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeTmp'\n    gmake: *** [cmTC_98223/fast] Error 2\n\n\n\n\n  CMake will not be able to correctly generate this project.\nCall Stack (most recent call first):\n  CMakeLists.txt\n\n\n-- Configuring incomplete, errors occurred!\nSee also \"/home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeOutput.log\".\nSee also \"/home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeError.log\".\n</code></pre>\n<h2>System Info</h2>\n<ul>\n<li>PyTorch or Caffe2: PyTorch</li>\n<li>How you installed PyTorch (conda, pip, source): source</li>\n<li>Build command you used (if compiling from source): CC=/mypath/cc python setup.py install</li>\n<li>OS:  Linux xxxx.yy.edu 2.6.32-696.20.1.el6.x86_64 <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"171281708\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/1\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/1/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/1\">#1</a> SMP Fri Jan 26 17:51:45 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</li>\n<li>PyTorch version: 0.4</li>\n<li>Python version: 3.6.5</li>\n<li>CUDA/cuDNN version: 9.1</li>\n<li>GPU models and configuration: V100 server</li>\n<li>GCC version (if compiling from source): 6.3.1, but the one used at /usr/bin/cc is 4.4.7</li>\n<li>CMake version: 3.11.1</li>\n<li>Versions of any other relevant libraries:<br>\nglibc: 2.12<br>\nconda: 4.4.10</li>\n</ul>", "body_text": "Issue description\nHello,\nI am trying to build PyTorch from source with a specific CC at path /mypath/cc (gcc 6.3.1), instead of /usr/bin/c++(gcc 4.4.7).\nI ran the command CC=/mypath/cc python setup.py install, and the log shows that it's still using /usr/bin/c++, instead of /mypath/cc\nI switched to another server where the default cc is set to be the newer one through scl.\n[username@infodev1 pytorch]$ which cc\n/mypath/cc\n[username@infodev1 pytorch]$ cc --version\ncc (GCC) 6.3.1 20170216 (Red Hat 6.3.1-3)\n\nThen I ran 'python setup.py install', thinking that cc would be the newer one, but the script somehow still finds /usr/bin/c++. The error pertains. The log is exactly the same.\nWhat is the correct way to configure the setup script to use specified compiler on Linux? Please advise.\nI am compiling on CentOS 6.9. I do not have sudo rights.\nThank you!\nBuild log\nCC=/mypath/cc python setup.py install\nrunning install\nrunning build_deps\n+ WITH_CUDA=0\n+ [[ --with-cuda == \\-\\-\\w\\i\\t\\h\\-\\c\\u\\d\\a ]]\n+ WITH_CUDA=1\n+ shift\n+ WITH_NNPACK=0\n+ [[ --with-nnpack == \\-\\-\\w\\i\\t\\h\\-\\n\\n\\p\\a\\c\\k ]]\n+ WITH_NNPACK=1\n+ shift\n+ WITH_MKLDNN=0\n+ [[ --with-mkldnn == \\-\\-\\w\\i\\t\\h\\-\\m\\k\\l\\d\\n\\n ]]\n+ WITH_MKLDNN=1\n+ shift\n+ WITH_GLOO_IBVERBS=0\n+ [[ nccl == \\-\\-\\w\\i\\t\\h\\-\\g\\l\\o\\o\\-\\i\\b\\v\\e\\r\\b\\s ]]\n+ CMAKE_INSTALL='make install'\n+ USER_CFLAGS=\n+ USER_LDFLAGS=\n+ [[ -n -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now ]]\n+ USER_LDFLAGS=' -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now'\n+ [[ -n -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe ]]\n+ USER_CFLAGS=' -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe'\n+ USER_LDFLAGS=' -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe'\n+ [[ -n -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 ]]\n+ USER_C_CFLAGS=' -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe -DNDEBUG -D_FORTIFY_SOURCE=2 -O2'\n+ USER_LDFLAGS=' -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe -DNDEBUG -D_FORTIFY_SOURCE=2 -O2'\n++ dirname tools/build_pytorch_libs.sh\n+ cd tools/..\n+++ pwd\n++ printf '%q\\n' /home/username/git/pytorch\n+ PWD=/home/username/git/pytorch\n+ BASE_DIR=/home/username/git/pytorch\n+ TORCH_LIB_DIR=/home/username/git/pytorch/torch/lib\n+ INSTALL_DIR=/home/username/git/pytorch/torch/lib/tmp_install\n+ THIRD_PARTY_DIR=/home/username/git/pytorch/third_party\n+ CMAKE_VERSION=cmake\n+ C_FLAGS=' -DTH_INDEX_BASE=0 -I\"/home/username/git/pytorch/torch/lib/tmp_install/include\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCUNN\"'\n+ C_FLAGS=' -DTH_INDEX_BASE=0 -I\"/home/username/git/pytorch/torch/lib/tmp_install/include\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1'\n+ LDFLAGS='-L\"/home/username/git/pytorch/torch/lib/tmp_install/lib\" '\n+ LD_POSTFIX=.so.1\n+ LD_POSTFIX_UNVERSIONED=.so\n++ uname\n+ [[ Linux == \\D\\a\\r\\w\\i\\n ]]\n+ LDFLAGS='-L\"/home/username/git/pytorch/torch/lib/tmp_install/lib\"  -Wl,-rpath,$ORIGIN'\n+ CPP_FLAGS=' -std=c++11 '\n+ GLOO_FLAGS=\n+ THD_FLAGS=\n+ NCCL_ROOT_DIR=/home/username/git/pytorch/torch/lib/tmp_install\n+ [[ 1 -eq 1 ]]\n+ GLOO_FLAGS='-DUSE_CUDA=1 -DNCCL_ROOT_DIR=/home/username/git/pytorch/torch/lib/tmp_install'\n+ [[ 0 -eq 1 ]]\n+ CWRAP_FILES='/home/username/git/pytorch/torch/lib/ATen/Declarations.cwrap;/home/username/git/pytorch/torch/lib/THNN/generic/THNN.h;/home/username/git/pytorch/torch/lib/THCUNN/generic/THCUNN.h;/home/username/git/pytorch/torch/lib/ATen/nn.yaml'\n+ CUDA_NVCC_FLAGS=' -DTH_INDEX_BASE=0 -I\"/home/username/git/pytorch/torch/lib/tmp_install/include\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1'\n+ [[ '' -eq 1 ]]\n+ '[' -z 56 ']'\n+ BUILD_TYPE=Release\n+ [[ -n '' ]]\n+ [[ -n '' ]]\n+ echo 'Building in Release mode'\nBuilding in Release mode\n+ mkdir -p torch/lib/tmp_install\n+ for arg in '\"$@\"'\n+ [[ nccl == \\n\\c\\c\\l ]]\n+ pushd /home/username/git/pytorch/third_party\n~/git/pytorch/third_party ~/git/pytorch\n+ build_nccl\n+ mkdir -p build/nccl\n+ pushd build/nccl\n~/git/pytorch/third_party/build/nccl ~/git/pytorch/third_party ~/git/pytorch\n+ cmake ../../nccl -DCMAKE_MODULE_PATH=/home/username/git/pytorch/cmake/FindCUDA -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/home/username/git/pytorch/torch/lib/tmp_install '-DCMAKE_C_FLAGS= -DTH_INDEX_BASE=0 -I\"/home/username/git/pytorch/torch/lib/tmp_install/include\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1  -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe' '-DCMAKE_CXX_FLAGS= -DTH_INDEX_BASE=0 -I\"/home/username/git/pytorch/torch/lib/tmp_install/include\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1  -std=c++11   -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe' '-DCMAKE_SHARED_LINKER_FLAGS= -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe -DNDEBUG -D_FORTIFY_SOURCE=2 -O2'\n-- The CXX compiler identification is GNU 4.4.7\n-- Check for working CXX compiler: /usr/bin/c++\n-- Check for working CXX compiler: /usr/bin/c++ -- broken\nCMake Error at /home/username/.conda/envs/jason/share/cmake-3.11/Modules/CMakeTestCXXCompiler.cmake:45 (message):\n  The C++ compiler\n\n    \"/usr/bin/c++\"\n\n  is not able to compile a simple test program.\n\n  It fails with the following output:\n\n    Change Dir: /home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeTmp\n\n    Run Build Command:\"/usr/bin/gmake\" \"cmTC_98223/fast\"\n    /usr/bin/gmake -f CMakeFiles/cmTC_98223.dir/build.make CMakeFiles/cmTC_98223.dir/build\n    gmake[1]: Entering directory `/server/home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeTmp'\n    Building CXX object CMakeFiles/cmTC_98223.dir/testCXXCompiler.cxx.o\n    /usr/bin/c++    -DTH_INDEX_BASE=0 -I\"/home/username/git/pytorch/torch/lib/tmp_install/include\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1  -std=c++11   -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe    -o CMakeFiles/cmTC_98223.dir/testCXXCompiler.cxx.o -c /home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeTmp/testCXXCompiler.cxx\n    cc1plus: error: unrecognized command line option \"-std=c++11\"\n    cc1plus: error: unrecognized command line option \"-fstack-protector-strong\"\n    cc1plus: error: unrecognized command line option \"-fno-plt\"\n    /home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeTmp/testCXXCompiler.cxx:1: error: bad value (haswell) for -mtune= switch\n    gmake[1]: *** [CMakeFiles/cmTC_98223.dir/testCXXCompiler.cxx.o] Error 1\n    gmake[1]: Leaving directory `/server/home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeTmp'\n    gmake: *** [cmTC_98223/fast] Error 2\n\n\n\n\n  CMake will not be able to correctly generate this project.\nCall Stack (most recent call first):\n  CMakeLists.txt\n\n\n-- Configuring incomplete, errors occurred!\nSee also \"/home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeOutput.log\".\nSee also \"/home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeError.log\".\n\nSystem Info\n\nPyTorch or Caffe2: PyTorch\nHow you installed PyTorch (conda, pip, source): source\nBuild command you used (if compiling from source): CC=/mypath/cc python setup.py install\nOS:  Linux xxxx.yy.edu 2.6.32-696.20.1.el6.x86_64 #1 SMP Fri Jan 26 17:51:45 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\nPyTorch version: 0.4\nPython version: 3.6.5\nCUDA/cuDNN version: 9.1\nGPU models and configuration: V100 server\nGCC version (if compiling from source): 6.3.1, but the one used at /usr/bin/cc is 4.4.7\nCMake version: 3.11.1\nVersions of any other relevant libraries:\nglibc: 2.12\nconda: 4.4.10", "body": "## Issue description\r\n\r\nHello,\r\n\r\nI am trying to build PyTorch from source with a specific CC at path `/mypath/cc` (gcc 6.3.1), instead of `/usr/bin/c++`(gcc 4.4.7).\r\nI ran the command `CC=/mypath/cc python setup.py install`, and the log shows that it's still using `/usr/bin/c++`, instead of `/mypath/cc`\r\nI switched to another server where the default cc is set to be the newer one through scl.\r\n\r\n```\r\n[username@infodev1 pytorch]$ which cc\r\n/mypath/cc\r\n[username@infodev1 pytorch]$ cc --version\r\ncc (GCC) 6.3.1 20170216 (Red Hat 6.3.1-3)\r\n```\r\nThen I ran 'python setup.py install', thinking that cc would be the newer one, but the script somehow still finds `/usr/bin/c++`. The error pertains. The log is exactly the same.\r\n\r\nWhat is the correct way to configure the setup script to use specified compiler on Linux? Please advise.\r\nI am compiling on CentOS 6.9. I do not have sudo rights.\r\n\r\nThank you!\r\n\r\n## Build log\r\n```\r\nCC=/mypath/cc python setup.py install\r\nrunning install\r\nrunning build_deps\r\n+ WITH_CUDA=0\r\n+ [[ --with-cuda == \\-\\-\\w\\i\\t\\h\\-\\c\\u\\d\\a ]]\r\n+ WITH_CUDA=1\r\n+ shift\r\n+ WITH_NNPACK=0\r\n+ [[ --with-nnpack == \\-\\-\\w\\i\\t\\h\\-\\n\\n\\p\\a\\c\\k ]]\r\n+ WITH_NNPACK=1\r\n+ shift\r\n+ WITH_MKLDNN=0\r\n+ [[ --with-mkldnn == \\-\\-\\w\\i\\t\\h\\-\\m\\k\\l\\d\\n\\n ]]\r\n+ WITH_MKLDNN=1\r\n+ shift\r\n+ WITH_GLOO_IBVERBS=0\r\n+ [[ nccl == \\-\\-\\w\\i\\t\\h\\-\\g\\l\\o\\o\\-\\i\\b\\v\\e\\r\\b\\s ]]\r\n+ CMAKE_INSTALL='make install'\r\n+ USER_CFLAGS=\r\n+ USER_LDFLAGS=\r\n+ [[ -n -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now ]]\r\n+ USER_LDFLAGS=' -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now'\r\n+ [[ -n -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe ]]\r\n+ USER_CFLAGS=' -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe'\r\n+ USER_LDFLAGS=' -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe'\r\n+ [[ -n -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 ]]\r\n+ USER_C_CFLAGS=' -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe -DNDEBUG -D_FORTIFY_SOURCE=2 -O2'\r\n+ USER_LDFLAGS=' -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe -DNDEBUG -D_FORTIFY_SOURCE=2 -O2'\r\n++ dirname tools/build_pytorch_libs.sh\r\n+ cd tools/..\r\n+++ pwd\r\n++ printf '%q\\n' /home/username/git/pytorch\r\n+ PWD=/home/username/git/pytorch\r\n+ BASE_DIR=/home/username/git/pytorch\r\n+ TORCH_LIB_DIR=/home/username/git/pytorch/torch/lib\r\n+ INSTALL_DIR=/home/username/git/pytorch/torch/lib/tmp_install\r\n+ THIRD_PARTY_DIR=/home/username/git/pytorch/third_party\r\n+ CMAKE_VERSION=cmake\r\n+ C_FLAGS=' -DTH_INDEX_BASE=0 -I\"/home/username/git/pytorch/torch/lib/tmp_install/include\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCUNN\"'\r\n+ C_FLAGS=' -DTH_INDEX_BASE=0 -I\"/home/username/git/pytorch/torch/lib/tmp_install/include\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1'\r\n+ LDFLAGS='-L\"/home/username/git/pytorch/torch/lib/tmp_install/lib\" '\r\n+ LD_POSTFIX=.so.1\r\n+ LD_POSTFIX_UNVERSIONED=.so\r\n++ uname\r\n+ [[ Linux == \\D\\a\\r\\w\\i\\n ]]\r\n+ LDFLAGS='-L\"/home/username/git/pytorch/torch/lib/tmp_install/lib\"  -Wl,-rpath,$ORIGIN'\r\n+ CPP_FLAGS=' -std=c++11 '\r\n+ GLOO_FLAGS=\r\n+ THD_FLAGS=\r\n+ NCCL_ROOT_DIR=/home/username/git/pytorch/torch/lib/tmp_install\r\n+ [[ 1 -eq 1 ]]\r\n+ GLOO_FLAGS='-DUSE_CUDA=1 -DNCCL_ROOT_DIR=/home/username/git/pytorch/torch/lib/tmp_install'\r\n+ [[ 0 -eq 1 ]]\r\n+ CWRAP_FILES='/home/username/git/pytorch/torch/lib/ATen/Declarations.cwrap;/home/username/git/pytorch/torch/lib/THNN/generic/THNN.h;/home/username/git/pytorch/torch/lib/THCUNN/generic/THCUNN.h;/home/username/git/pytorch/torch/lib/ATen/nn.yaml'\r\n+ CUDA_NVCC_FLAGS=' -DTH_INDEX_BASE=0 -I\"/home/username/git/pytorch/torch/lib/tmp_install/include\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1'\r\n+ [[ '' -eq 1 ]]\r\n+ '[' -z 56 ']'\r\n+ BUILD_TYPE=Release\r\n+ [[ -n '' ]]\r\n+ [[ -n '' ]]\r\n+ echo 'Building in Release mode'\r\nBuilding in Release mode\r\n+ mkdir -p torch/lib/tmp_install\r\n+ for arg in '\"$@\"'\r\n+ [[ nccl == \\n\\c\\c\\l ]]\r\n+ pushd /home/username/git/pytorch/third_party\r\n~/git/pytorch/third_party ~/git/pytorch\r\n+ build_nccl\r\n+ mkdir -p build/nccl\r\n+ pushd build/nccl\r\n~/git/pytorch/third_party/build/nccl ~/git/pytorch/third_party ~/git/pytorch\r\n+ cmake ../../nccl -DCMAKE_MODULE_PATH=/home/username/git/pytorch/cmake/FindCUDA -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/home/username/git/pytorch/torch/lib/tmp_install '-DCMAKE_C_FLAGS= -DTH_INDEX_BASE=0 -I\"/home/username/git/pytorch/torch/lib/tmp_install/include\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1  -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe' '-DCMAKE_CXX_FLAGS= -DTH_INDEX_BASE=0 -I\"/home/username/git/pytorch/torch/lib/tmp_install/include\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1  -std=c++11   -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe' '-DCMAKE_SHARED_LINKER_FLAGS= -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe -DNDEBUG -D_FORTIFY_SOURCE=2 -O2'\r\n-- The CXX compiler identification is GNU 4.4.7\r\n-- Check for working CXX compiler: /usr/bin/c++\r\n-- Check for working CXX compiler: /usr/bin/c++ -- broken\r\nCMake Error at /home/username/.conda/envs/jason/share/cmake-3.11/Modules/CMakeTestCXXCompiler.cmake:45 (message):\r\n  The C++ compiler\r\n\r\n    \"/usr/bin/c++\"\r\n\r\n  is not able to compile a simple test program.\r\n\r\n  It fails with the following output:\r\n\r\n    Change Dir: /home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeTmp\r\n\r\n    Run Build Command:\"/usr/bin/gmake\" \"cmTC_98223/fast\"\r\n    /usr/bin/gmake -f CMakeFiles/cmTC_98223.dir/build.make CMakeFiles/cmTC_98223.dir/build\r\n    gmake[1]: Entering directory `/server/home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeTmp'\r\n    Building CXX object CMakeFiles/cmTC_98223.dir/testCXXCompiler.cxx.o\r\n    /usr/bin/c++    -DTH_INDEX_BASE=0 -I\"/home/username/git/pytorch/torch/lib/tmp_install/include\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/username/git/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1  -std=c++11   -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe    -o CMakeFiles/cmTC_98223.dir/testCXXCompiler.cxx.o -c /home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeTmp/testCXXCompiler.cxx\r\n    cc1plus: error: unrecognized command line option \"-std=c++11\"\r\n    cc1plus: error: unrecognized command line option \"-fstack-protector-strong\"\r\n    cc1plus: error: unrecognized command line option \"-fno-plt\"\r\n    /home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeTmp/testCXXCompiler.cxx:1: error: bad value (haswell) for -mtune= switch\r\n    gmake[1]: *** [CMakeFiles/cmTC_98223.dir/testCXXCompiler.cxx.o] Error 1\r\n    gmake[1]: Leaving directory `/server/home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeTmp'\r\n    gmake: *** [cmTC_98223/fast] Error 2\r\n\r\n\r\n\r\n\r\n  CMake will not be able to correctly generate this project.\r\nCall Stack (most recent call first):\r\n  CMakeLists.txt\r\n\r\n\r\n-- Configuring incomplete, errors occurred!\r\nSee also \"/home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeOutput.log\".\r\nSee also \"/home/username/git/pytorch/third_party/build/nccl/CMakeFiles/CMakeError.log\".\r\n```\r\n## System Info\r\n\r\n- PyTorch or Caffe2: PyTorch\r\n- How you installed PyTorch (conda, pip, source): source \r\n- Build command you used (if compiling from source): CC=/mypath/cc python setup.py install\r\n- OS:  Linux xxxx.yy.edu 2.6.32-696.20.1.el6.x86_64 #1 SMP Fri Jan 26 17:51:45 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n- PyTorch version: 0.4\r\n- Python version: 3.6.5\r\n- CUDA/cuDNN version: 9.1\r\n- GPU models and configuration: V100 server\r\n- GCC version (if compiling from source): 6.3.1, but the one used at /usr/bin/cc is 4.4.7\r\n- CMake version: 3.11.1\r\n- Versions of any other relevant libraries:\r\nglibc: 2.12\r\nconda: 4.4.10\r\n"}