{"url": "https://api.github.com/repos/pytorch/pytorch/issues/3797", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/3797/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/3797/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/3797/events", "html_url": "https://github.com/pytorch/pytorch/issues/3797", "id": 275519422, "node_id": "MDU6SXNzdWUyNzU1MTk0MjI=", "number": 3797, "title": "cosine_similarity should not call squeeze() twice", "user": {"login": "bheinzerling", "id": 4348795, "node_id": "MDQ6VXNlcjQzNDg3OTU=", "avatar_url": "https://avatars1.githubusercontent.com/u/4348795?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bheinzerling", "html_url": "https://github.com/bheinzerling", "followers_url": "https://api.github.com/users/bheinzerling/followers", "following_url": "https://api.github.com/users/bheinzerling/following{/other_user}", "gists_url": "https://api.github.com/users/bheinzerling/gists{/gist_id}", "starred_url": "https://api.github.com/users/bheinzerling/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bheinzerling/subscriptions", "organizations_url": "https://api.github.com/users/bheinzerling/orgs", "repos_url": "https://api.github.com/users/bheinzerling/repos", "events_url": "https://api.github.com/users/bheinzerling/events{/privacy}", "received_events_url": "https://api.github.com/users/bheinzerling/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-11-20T22:22:21Z", "updated_at": "2017-11-21T23:33:41Z", "closed_at": "2017-11-21T23:33:41Z", "author_association": "CONTRIBUTOR", "body_html": "<p><code>torch.nn.functional.cosine_similarity</code> calls <code>squeeze()</code> twice: once implicitly in <code>sum()</code> and once explicitly before the tensor is returned.</p>\n<p><a href=\"https://github.com/pytorch/pytorch/blob/master/torch/nn/functional.py#L1653\">https://github.com/pytorch/pytorch/blob/master/torch/nn/functional.py#L1653</a></p>\n<p>The second (explicit) call in line 1653 leads to problems if other dimensions than the one over which the cosine similarity is calculated have size 1, e.g. with batch size 1.</p>\n<p>This is probably a remnant from before the behavior of sum() was changed to squeeze by default (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"193133052\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/289\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/289/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/289\">#289</a> and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"228863821\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/1563\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/1563/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/1563\">#1563</a>), although even then it probably should have been <code>squeeze(dim)</code> in order to only squeeze the cosine dimension.</p>", "body_text": "torch.nn.functional.cosine_similarity calls squeeze() twice: once implicitly in sum() and once explicitly before the tensor is returned.\nhttps://github.com/pytorch/pytorch/blob/master/torch/nn/functional.py#L1653\nThe second (explicit) call in line 1653 leads to problems if other dimensions than the one over which the cosine similarity is calculated have size 1, e.g. with batch size 1.\nThis is probably a remnant from before the behavior of sum() was changed to squeeze by default (#289 and #1563), although even then it probably should have been squeeze(dim) in order to only squeeze the cosine dimension.", "body": "`torch.nn.functional.cosine_similarity` calls `squeeze()` twice: once implicitly in `sum()` and once explicitly before the tensor is returned. \r\n\r\nhttps://github.com/pytorch/pytorch/blob/master/torch/nn/functional.py#L1653\r\n\r\nThe second (explicit) call in line 1653 leads to problems if other dimensions than the one over which the cosine similarity is calculated have size 1, e.g. with batch size 1.\r\n\r\nThis is probably a remnant from before the behavior of sum() was changed to squeeze by default (https://github.com/pytorch/pytorch/issues/289 and https://github.com/pytorch/pytorch/pull/1563), although even then it probably should have been `squeeze(dim)` in order to only squeeze the cosine dimension."}