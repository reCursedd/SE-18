{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/197243221", "pull_request_review_id": 130950590, "id": 197243221, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NzI0MzIyMQ==", "diff_hunk": "@@ -421,6 +443,18 @@ auto Engine::evaluate_function(FunctionTask& task) -> void {\n           continue;\n         }\n       }\n+\n+      #ifdef USE_CUDA\n+        // Switches to and syncs with child's stream (if needed)\n+        const auto child_device = output.is_cuda() ? output.get_device() : -1;\n+        auto child_stream = next.function->input_metadata(next.input_nr).stream();\n+        auto_gpu_stream.set(child_device, child_stream);\n+        if (parent_device != -1 && child_device != -1 && parent_stream != child_stream) {\n+          cuda_event.record(parent_stream);", "path": "torch/csrc/autograd/engine.cpp", "position": null, "original_position": 54, "commit_id": "1b56a400c446aabd207a90585845ab81545bbcdd", "original_commit_id": "22005755d16488109039ddeff5a1dad5aeeb457a", "user": {"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}, "body": "Well `Sync` doesn't really imply \"record once\". \"an error or a silly thing to do\" is pretty much what I thought when I saw this code, which is where the comment is coming from haha. I'd really rather make this logic explicit, or move the `.record` to happen only once, to avoid confusion in the future.", "created_at": "2018-06-21T18:56:12Z", "updated_at": "2018-11-23T15:46:03Z", "html_url": "https://github.com/pytorch/pytorch/pull/8354#discussion_r197243221", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/8354", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/197243221"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/8354#discussion_r197243221"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/8354"}}, "body_html": "<p>Well <code>Sync</code> doesn't really imply \"record once\". \"an error or a silly thing to do\" is pretty much what I thought when I saw this code, which is where the comment is coming from haha. I'd really rather make this logic explicit, or move the <code>.record</code> to happen only once, to avoid confusion in the future.</p>", "body_text": "Well Sync doesn't really imply \"record once\". \"an error or a silly thing to do\" is pretty much what I thought when I saw this code, which is where the comment is coming from haha. I'd really rather make this logic explicit, or move the .record to happen only once, to avoid confusion in the future.", "in_reply_to_id": 197226770}