{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/196558132", "pull_request_review_id": 130129980, "id": 196558132, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NjU1ODEzMg==", "diff_hunk": "@@ -410,6 +441,22 @@ auto Engine::evaluate_function(FunctionTask& task) -> void {\n       is_ready = true;\n     }\n \n+    // Switches to and sync with child's stream (if needed)\n+    #ifdef USE_CUDA\n+      // Sets child's device and stream\n+      const int child_device = output.is_cuda() ? output.get_device() : - 1;\n+      auto child_stream = next.function->input_metadata(next.input_nr).stream();\n+      AutoGPUStream child_auto_gpu_stream{child_device, child_stream};", "path": "torch/csrc/autograd/engine.cpp", "position": null, "original_position": 108, "commit_id": "1b56a400c446aabd207a90585845ab81545bbcdd", "original_commit_id": "36598758d04d2104d5604f038ccd5a31b0377fe2", "user": {"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}, "body": "This always does a bunch of stream operations, even if they're completely unnecessary (e.g. because the stream is the same as the one used in the function call. It would be better to reuse `auto_gpu_stream` from above and do sth like `auto_gpu_stream.setStream(child_stream)`", "created_at": "2018-06-19T19:59:05Z", "updated_at": "2018-11-23T15:45:48Z", "html_url": "https://github.com/pytorch/pytorch/pull/8354#discussion_r196558132", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/8354", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/196558132"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/8354#discussion_r196558132"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/8354"}}, "body_html": "<p>This always does a bunch of stream operations, even if they're completely unnecessary (e.g. because the stream is the same as the one used in the function call. It would be better to reuse <code>auto_gpu_stream</code> from above and do sth like <code>auto_gpu_stream.setStream(child_stream)</code></p>", "body_text": "This always does a bunch of stream operations, even if they're completely unnecessary (e.g. because the stream is the same as the one used in the function call. It would be better to reuse auto_gpu_stream from above and do sth like auto_gpu_stream.setStream(child_stream)"}