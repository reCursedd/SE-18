{"url": "https://api.github.com/repos/pytorch/pytorch/issues/10099", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/10099/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/10099/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/10099/events", "html_url": "https://github.com/pytorch/pytorch/issues/10099", "id": 346381257, "node_id": "MDU6SXNzdWUzNDYzODEyNTc=", "number": 10099, "title": "Caffe2 Windows configuration cannot handle AT_API classes with static methods (but PyTorch's can)", "user": {"login": "ezyang", "id": 13564, "node_id": "MDQ6VXNlcjEzNTY0", "avatar_url": "https://avatars0.githubusercontent.com/u/13564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ezyang", "html_url": "https://github.com/ezyang", "followers_url": "https://api.github.com/users/ezyang/followers", "following_url": "https://api.github.com/users/ezyang/following{/other_user}", "gists_url": "https://api.github.com/users/ezyang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ezyang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ezyang/subscriptions", "organizations_url": "https://api.github.com/users/ezyang/orgs", "repos_url": "https://api.github.com/users/ezyang/repos", "events_url": "https://api.github.com/users/ezyang/events{/privacy}", "received_events_url": "https://api.github.com/users/ezyang/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 890282107, "node_id": "MDU6TGFiZWw4OTAyODIxMDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/caffe2", "name": "caffe2", "color": "210aa8", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-07-31T22:26:59Z", "updated_at": "2018-08-01T14:11:22Z", "closed_at": "2018-08-01T14:11:22Z", "author_association": "CONTRIBUTOR", "body_html": "<p>There is a weird inconsistency between how PyTorch Windows and Caffe2 Windows is configured. It might have to do with the fact that Caffe2 exports all symbols on Windows at the moment.</p>\n<p>Basically, the following compiles in PyTorch, but not in Caffe2:</p>\n<pre><code>class AT_CORE_API Warning {\n  using handler_t = void(*)(const SourceLocation&amp; source_location, const char* msg);\n\npublic:\n  /// Issue a warning with a given message. Dispatched to the current\n  /// warning handler.\n  static void warn(SourceLocation source_location, std::string msg);\n\n  /// Sets the global warning handler. This is not thread-safe, so it should\n  /// generally be called once during initialization.\n  static void set_warning_handler(handler_t handler);\n\n  /// The default warning handler. Prints the message to stderr.\n  static void print_warning(const SourceLocation&amp; source_location, const char* msg);\n\nprivate:\n  static handler_t warning_handler_;\n};\n</code></pre>\n<p>In Caffe2, it complains:</p>\n<pre><code>21:58:55          C:\\Jenkins\\workspace\\caffe2-builds\\py2-cuda9.0-cudnn7-windows-build\\aten\\src\\ATen\\core\\Error.cpp(30): error C2491: 'at::Warning::warning_handler_': definition of dllimport static data member not allowed [C:\\Jenkins\\workspace\\caffe2-builds\\py2-cuda9.0-cudnn7-windows-build\\build\\caffe2\\caffe2.vcxproj]\n</code></pre>", "body_text": "There is a weird inconsistency between how PyTorch Windows and Caffe2 Windows is configured. It might have to do with the fact that Caffe2 exports all symbols on Windows at the moment.\nBasically, the following compiles in PyTorch, but not in Caffe2:\nclass AT_CORE_API Warning {\n  using handler_t = void(*)(const SourceLocation& source_location, const char* msg);\n\npublic:\n  /// Issue a warning with a given message. Dispatched to the current\n  /// warning handler.\n  static void warn(SourceLocation source_location, std::string msg);\n\n  /// Sets the global warning handler. This is not thread-safe, so it should\n  /// generally be called once during initialization.\n  static void set_warning_handler(handler_t handler);\n\n  /// The default warning handler. Prints the message to stderr.\n  static void print_warning(const SourceLocation& source_location, const char* msg);\n\nprivate:\n  static handler_t warning_handler_;\n};\n\nIn Caffe2, it complains:\n21:58:55          C:\\Jenkins\\workspace\\caffe2-builds\\py2-cuda9.0-cudnn7-windows-build\\aten\\src\\ATen\\core\\Error.cpp(30): error C2491: 'at::Warning::warning_handler_': definition of dllimport static data member not allowed [C:\\Jenkins\\workspace\\caffe2-builds\\py2-cuda9.0-cudnn7-windows-build\\build\\caffe2\\caffe2.vcxproj]", "body": "There is a weird inconsistency between how PyTorch Windows and Caffe2 Windows is configured. It might have to do with the fact that Caffe2 exports all symbols on Windows at the moment.\r\n\r\nBasically, the following compiles in PyTorch, but not in Caffe2:\r\n\r\n```\r\nclass AT_CORE_API Warning {\r\n  using handler_t = void(*)(const SourceLocation& source_location, const char* msg);\r\n\r\npublic:\r\n  /// Issue a warning with a given message. Dispatched to the current\r\n  /// warning handler.\r\n  static void warn(SourceLocation source_location, std::string msg);\r\n\r\n  /// Sets the global warning handler. This is not thread-safe, so it should\r\n  /// generally be called once during initialization.\r\n  static void set_warning_handler(handler_t handler);\r\n\r\n  /// The default warning handler. Prints the message to stderr.\r\n  static void print_warning(const SourceLocation& source_location, const char* msg);\r\n\r\nprivate:\r\n  static handler_t warning_handler_;\r\n};\r\n```\r\n\r\nIn Caffe2, it complains:\r\n\r\n```\r\n21:58:55          C:\\Jenkins\\workspace\\caffe2-builds\\py2-cuda9.0-cudnn7-windows-build\\aten\\src\\ATen\\core\\Error.cpp(30): error C2491: 'at::Warning::warning_handler_': definition of dllimport static data member not allowed [C:\\Jenkins\\workspace\\caffe2-builds\\py2-cuda9.0-cudnn7-windows-build\\build\\caffe2\\caffe2.vcxproj]\r\n```"}