{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/13102", "id": 225612309, "node_id": "MDExOlB1bGxSZXF1ZXN0MjI1NjEyMzA5", "html_url": "https://github.com/pytorch/pytorch/pull/13102", "diff_url": "https://github.com/pytorch/pytorch/pull/13102.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/13102.patch", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/13102", "number": 13102, "state": "closed", "locked": false, "title": "Keep `ModuleList` consistent with python `list` in `__setitem__` function.", "user": {"login": "lyuwenyu", "id": 17582080, "node_id": "MDQ6VXNlcjE3NTgyMDgw", "avatar_url": "https://avatars0.githubusercontent.com/u/17582080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lyuwenyu", "html_url": "https://github.com/lyuwenyu", "followers_url": "https://api.github.com/users/lyuwenyu/followers", "following_url": "https://api.github.com/users/lyuwenyu/following{/other_user}", "gists_url": "https://api.github.com/users/lyuwenyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/lyuwenyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lyuwenyu/subscriptions", "organizations_url": "https://api.github.com/users/lyuwenyu/orgs", "repos_url": "https://api.github.com/users/lyuwenyu/repos", "events_url": "https://api.github.com/users/lyuwenyu/events{/privacy}", "received_events_url": "https://api.github.com/users/lyuwenyu/received_events", "type": "User", "site_admin": false}, "body": "`ModuleList` class function `__setitem__` has implicit rist\r\n```\r\nIn [26]: mlist = nn.ModuleList([nn.ReLU(), nn.Conv2d(10, 10, 3, 1)])\r\n\r\nIn [27]: mlist\r\nOut[27]: \r\nModuleList(\r\n  (0): ReLU()\r\n  (1): Conv2d(10, 10, kernel_size=(3, 3), stride=(1, 1))\r\n)\r\n\r\nIn [28]: mlist[-1] = nn.ReLU()\r\n\r\nIn [29]: mlist\r\nOut[29]: \r\nModuleList(\r\n  (0): ReLU()\r\n  (1): Conv2d(10, 10, kernel_size=(3, 3), stride=(1, 1))\r\n  (-1): ReLU()\r\n)\r\n\r\nIn [30]: mlist[-1]\r\n---------------------------------------------------------------------------\r\nKeyError                                  Traceback (most recent call last)\r\n<ipython-input-30-229d1b6823a0> in <module>()\r\n----> 1 mlist[-1]\r\n\r\n~/anaconda3/lib/python3.6/site-packages/torch/nn/modules/container.py in __getitem__(self, idx)\r\n    134             return ModuleList(list(self._modules.values())[idx])\r\n    135         else:\r\n--> 136             return self._modules[self._get_abs_string_index(idx)]\r\n    137 \r\n    138     def __setitem__(self, idx, module):\r\n\r\nKeyError: '2'\r\n\r\n```\r\n\r\nmodified as \r\n```\r\n    def __setitem__(self, idx, module):\r\n        idx = self._get_abs_string_index(idx)\r\n        return setattr(self, str(idx), module)\r\n```\r\nto fix it.\r\n\r\n```\r\nIn [31]: class NewModuleList(nn.ModuleList):\r\n    ...:     def __setitem__(self, idx, module):\r\n    ...:         idx = self._get_abs_string_index(idx)\r\n    ...:         return setattr(self, str(idx), module)\r\n    ...:     \r\n\r\nIn [32]: mlist = NewModuleList([nn.ReLU(), nn.Conv2d(10, 10, 2, 1)])\r\n\r\nIn [33]: mlist[-1] = nn.ReLU()\r\n\r\nIn [34]: mlist\r\nOut[34]: \r\nNewModuleList(\r\n  (0): ReLU()\r\n  (1): ReLU()\r\n)\r\n```\r\n\r\n", "created_at": "2018-10-25T03:24:14Z", "updated_at": "2018-11-16T15:40:57Z", "closed_at": "2018-11-16T15:40:57Z", "merged_at": null, "merge_commit_sha": "0b2d7b0aa535034d78df9ef9c5a42c74faee8af0", "assignee": null, "assignees": [], "requested_reviewers": [], "requested_teams": [], "labels": [], "milestone": null, "commits_url": "https://api.github.com/repos/pytorch/pytorch/pulls/13102/commits", "review_comments_url": "https://api.github.com/repos/pytorch/pytorch/pulls/13102/comments", "review_comment_url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments{/number}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/13102/comments", "statuses_url": "https://api.github.com/repos/pytorch/pytorch/statuses/238b4520d88e1980f8bd54a92ac4c5dd7936e4c4", "head": {"label": "lyuwenyu:lyuwenyu-dev", "ref": "lyuwenyu-dev", "sha": "238b4520d88e1980f8bd54a92ac4c5dd7936e4c4", "user": {"login": "lyuwenyu", "id": 17582080, "node_id": "MDQ6VXNlcjE3NTgyMDgw", "avatar_url": "https://avatars0.githubusercontent.com/u/17582080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lyuwenyu", "html_url": "https://github.com/lyuwenyu", "followers_url": "https://api.github.com/users/lyuwenyu/followers", "following_url": "https://api.github.com/users/lyuwenyu/following{/other_user}", "gists_url": "https://api.github.com/users/lyuwenyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/lyuwenyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lyuwenyu/subscriptions", "organizations_url": "https://api.github.com/users/lyuwenyu/orgs", "repos_url": "https://api.github.com/users/lyuwenyu/repos", "events_url": "https://api.github.com/users/lyuwenyu/events{/privacy}", "received_events_url": "https://api.github.com/users/lyuwenyu/received_events", "type": "User", "site_admin": false}, "repo": {"id": 149288042, "node_id": "MDEwOlJlcG9zaXRvcnkxNDkyODgwNDI=", "name": "pytorch", "full_name": "lyuwenyu/pytorch", "private": false, "owner": {"login": "lyuwenyu", "id": 17582080, "node_id": "MDQ6VXNlcjE3NTgyMDgw", "avatar_url": "https://avatars0.githubusercontent.com/u/17582080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lyuwenyu", "html_url": "https://github.com/lyuwenyu", "followers_url": "https://api.github.com/users/lyuwenyu/followers", "following_url": "https://api.github.com/users/lyuwenyu/following{/other_user}", "gists_url": "https://api.github.com/users/lyuwenyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/lyuwenyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lyuwenyu/subscriptions", "organizations_url": "https://api.github.com/users/lyuwenyu/orgs", "repos_url": "https://api.github.com/users/lyuwenyu/repos", "events_url": "https://api.github.com/users/lyuwenyu/events{/privacy}", "received_events_url": "https://api.github.com/users/lyuwenyu/received_events", "type": "User", "site_admin": false}, "html_url": "https://github.com/lyuwenyu/pytorch", "description": "Tensors and Dynamic neural networks in Python  with strong GPU acceleration", "fork": true, "url": "https://api.github.com/repos/lyuwenyu/pytorch", "forks_url": "https://api.github.com/repos/lyuwenyu/pytorch/forks", "keys_url": "https://api.github.com/repos/lyuwenyu/pytorch/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/lyuwenyu/pytorch/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/lyuwenyu/pytorch/teams", "hooks_url": "https://api.github.com/repos/lyuwenyu/pytorch/hooks", "issue_events_url": "https://api.github.com/repos/lyuwenyu/pytorch/issues/events{/number}", "events_url": "https://api.github.com/repos/lyuwenyu/pytorch/events", "assignees_url": "https://api.github.com/repos/lyuwenyu/pytorch/assignees{/user}", "branches_url": "https://api.github.com/repos/lyuwenyu/pytorch/branches{/branch}", "tags_url": "https://api.github.com/repos/lyuwenyu/pytorch/tags", "blobs_url": "https://api.github.com/repos/lyuwenyu/pytorch/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/lyuwenyu/pytorch/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/lyuwenyu/pytorch/git/refs{/sha}", "trees_url": "https://api.github.com/repos/lyuwenyu/pytorch/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/lyuwenyu/pytorch/statuses/{sha}", "languages_url": "https://api.github.com/repos/lyuwenyu/pytorch/languages", "stargazers_url": "https://api.github.com/repos/lyuwenyu/pytorch/stargazers", "contributors_url": "https://api.github.com/repos/lyuwenyu/pytorch/contributors", "subscribers_url": "https://api.github.com/repos/lyuwenyu/pytorch/subscribers", "subscription_url": "https://api.github.com/repos/lyuwenyu/pytorch/subscription", "commits_url": "https://api.github.com/repos/lyuwenyu/pytorch/commits{/sha}", "git_commits_url": "https://api.github.com/repos/lyuwenyu/pytorch/git/commits{/sha}", "comments_url": "https://api.github.com/repos/lyuwenyu/pytorch/comments{/number}", "issue_comment_url": "https://api.github.com/repos/lyuwenyu/pytorch/issues/comments{/number}", "contents_url": "https://api.github.com/repos/lyuwenyu/pytorch/contents/{+path}", "compare_url": "https://api.github.com/repos/lyuwenyu/pytorch/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/lyuwenyu/pytorch/merges", "archive_url": "https://api.github.com/repos/lyuwenyu/pytorch/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/lyuwenyu/pytorch/downloads", "issues_url": "https://api.github.com/repos/lyuwenyu/pytorch/issues{/number}", "pulls_url": "https://api.github.com/repos/lyuwenyu/pytorch/pulls{/number}", "milestones_url": "https://api.github.com/repos/lyuwenyu/pytorch/milestones{/number}", "notifications_url": "https://api.github.com/repos/lyuwenyu/pytorch/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/lyuwenyu/pytorch/labels{/name}", "releases_url": "https://api.github.com/repos/lyuwenyu/pytorch/releases{/id}", "deployments_url": "https://api.github.com/repos/lyuwenyu/pytorch/deployments", "created_at": "2018-09-18T12:54:36Z", "updated_at": "2018-10-25T03:38:48Z", "pushed_at": "2018-10-26T03:11:01Z", "git_url": "git://github.com/lyuwenyu/pytorch.git", "ssh_url": "git@github.com:lyuwenyu/pytorch.git", "clone_url": "https://github.com/lyuwenyu/pytorch.git", "svn_url": "https://github.com/lyuwenyu/pytorch", "homepage": "http://pytorch.org", "size": 80835, "stargazers_count": 0, "watchers_count": 0, "language": "C++", "has_issues": false, "has_projects": true, "has_downloads": true, "has_wiki": true, "has_pages": false, "forks_count": 0, "mirror_url": null, "archived": false, "open_issues_count": 0, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "forks": 0, "open_issues": 0, "watchers": 0, "default_branch": "master"}}, "base": {"label": "pytorch:master", "ref": "master", "sha": "b827a40880caeb79f59eaff8ac2cd9cb3bf103da", "user": {"login": "pytorch", "id": 21003710, "node_id": "MDEyOk9yZ2FuaXphdGlvbjIxMDAzNzEw", "avatar_url": "https://avatars3.githubusercontent.com/u/21003710?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pytorch", "html_url": "https://github.com/pytorch", "followers_url": "https://api.github.com/users/pytorch/followers", "following_url": "https://api.github.com/users/pytorch/following{/other_user}", "gists_url": "https://api.github.com/users/pytorch/gists{/gist_id}", "starred_url": "https://api.github.com/users/pytorch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pytorch/subscriptions", "organizations_url": "https://api.github.com/users/pytorch/orgs", "repos_url": "https://api.github.com/users/pytorch/repos", "events_url": "https://api.github.com/users/pytorch/events{/privacy}", "received_events_url": "https://api.github.com/users/pytorch/received_events", "type": "Organization", "site_admin": false}, "repo": {"id": 65600975, "node_id": "MDEwOlJlcG9zaXRvcnk2NTYwMDk3NQ==", "name": "pytorch", "full_name": "pytorch/pytorch", "private": false, "owner": {"login": "pytorch", "id": 21003710, "node_id": "MDEyOk9yZ2FuaXphdGlvbjIxMDAzNzEw", "avatar_url": "https://avatars3.githubusercontent.com/u/21003710?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pytorch", "html_url": "https://github.com/pytorch", "followers_url": "https://api.github.com/users/pytorch/followers", "following_url": "https://api.github.com/users/pytorch/following{/other_user}", "gists_url": "https://api.github.com/users/pytorch/gists{/gist_id}", "starred_url": "https://api.github.com/users/pytorch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pytorch/subscriptions", "organizations_url": "https://api.github.com/users/pytorch/orgs", "repos_url": "https://api.github.com/users/pytorch/repos", "events_url": "https://api.github.com/users/pytorch/events{/privacy}", "received_events_url": "https://api.github.com/users/pytorch/received_events", "type": "Organization", "site_admin": false}, "html_url": "https://github.com/pytorch/pytorch", "description": "Tensors and Dynamic neural networks in Python  with strong GPU acceleration", "fork": false, "url": "https://api.github.com/repos/pytorch/pytorch", "forks_url": "https://api.github.com/repos/pytorch/pytorch/forks", "keys_url": "https://api.github.com/repos/pytorch/pytorch/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/pytorch/pytorch/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/pytorch/pytorch/teams", "hooks_url": "https://api.github.com/repos/pytorch/pytorch/hooks", "issue_events_url": "https://api.github.com/repos/pytorch/pytorch/issues/events{/number}", "events_url": "https://api.github.com/repos/pytorch/pytorch/events", "assignees_url": "https://api.github.com/repos/pytorch/pytorch/assignees{/user}", "branches_url": "https://api.github.com/repos/pytorch/pytorch/branches{/branch}", "tags_url": "https://api.github.com/repos/pytorch/pytorch/tags", "blobs_url": "https://api.github.com/repos/pytorch/pytorch/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/pytorch/pytorch/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/pytorch/pytorch/git/refs{/sha}", "trees_url": "https://api.github.com/repos/pytorch/pytorch/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/pytorch/pytorch/statuses/{sha}", "languages_url": "https://api.github.com/repos/pytorch/pytorch/languages", "stargazers_url": "https://api.github.com/repos/pytorch/pytorch/stargazers", "contributors_url": "https://api.github.com/repos/pytorch/pytorch/contributors", "subscribers_url": "https://api.github.com/repos/pytorch/pytorch/subscribers", "subscription_url": "https://api.github.com/repos/pytorch/pytorch/subscription", "commits_url": "https://api.github.com/repos/pytorch/pytorch/commits{/sha}", "git_commits_url": "https://api.github.com/repos/pytorch/pytorch/git/commits{/sha}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/comments{/number}", "issue_comment_url": "https://api.github.com/repos/pytorch/pytorch/issues/comments{/number}", "contents_url": "https://api.github.com/repos/pytorch/pytorch/contents/{+path}", "compare_url": "https://api.github.com/repos/pytorch/pytorch/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/pytorch/pytorch/merges", "archive_url": "https://api.github.com/repos/pytorch/pytorch/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/pytorch/pytorch/downloads", "issues_url": "https://api.github.com/repos/pytorch/pytorch/issues{/number}", "pulls_url": "https://api.github.com/repos/pytorch/pytorch/pulls{/number}", "milestones_url": "https://api.github.com/repos/pytorch/pytorch/milestones{/number}", "notifications_url": "https://api.github.com/repos/pytorch/pytorch/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/pytorch/pytorch/labels{/name}", "releases_url": "https://api.github.com/repos/pytorch/pytorch/releases{/id}", "deployments_url": "https://api.github.com/repos/pytorch/pytorch/deployments", "created_at": "2016-08-13T05:26:41Z", "updated_at": "2018-11-24T12:35:43Z", "pushed_at": "2018-11-24T12:42:01Z", "git_url": "git://github.com/pytorch/pytorch.git", "ssh_url": "git@github.com:pytorch/pytorch.git", "clone_url": "https://github.com/pytorch/pytorch.git", "svn_url": "https://github.com/pytorch/pytorch", "homepage": "http://pytorch.org", "size": 89656, "stargazers_count": 21589, "watchers_count": 21589, "language": "C++", "has_issues": true, "has_projects": true, "has_downloads": true, "has_wiki": true, "has_pages": false, "forks_count": 5153, "mirror_url": null, "archived": false, "open_issues_count": 2196, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "forks": 5153, "open_issues": 2196, "watchers": 21589, "default_branch": "master"}}, "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/13102"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/13102"}, "issue": {"href": "https://api.github.com/repos/pytorch/pytorch/issues/13102"}, "comments": {"href": "https://api.github.com/repos/pytorch/pytorch/issues/13102/comments"}, "review_comments": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/13102/comments"}, "review_comment": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments{/number}"}, "commits": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/13102/commits"}, "statuses": {"href": "https://api.github.com/repos/pytorch/pytorch/statuses/238b4520d88e1980f8bd54a92ac4c5dd7936e4c4"}}, "author_association": "CONTRIBUTOR", "body_html": "<p><code>ModuleList</code> class function <code>__setitem__</code> has implicit rist</p>\n<pre><code>In [26]: mlist = nn.ModuleList([nn.ReLU(), nn.Conv2d(10, 10, 3, 1)])\n\nIn [27]: mlist\nOut[27]: \nModuleList(\n  (0): ReLU()\n  (1): Conv2d(10, 10, kernel_size=(3, 3), stride=(1, 1))\n)\n\nIn [28]: mlist[-1] = nn.ReLU()\n\nIn [29]: mlist\nOut[29]: \nModuleList(\n  (0): ReLU()\n  (1): Conv2d(10, 10, kernel_size=(3, 3), stride=(1, 1))\n  (-1): ReLU()\n)\n\nIn [30]: mlist[-1]\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\n&lt;ipython-input-30-229d1b6823a0&gt; in &lt;module&gt;()\n----&gt; 1 mlist[-1]\n\n~/anaconda3/lib/python3.6/site-packages/torch/nn/modules/container.py in __getitem__(self, idx)\n    134             return ModuleList(list(self._modules.values())[idx])\n    135         else:\n--&gt; 136             return self._modules[self._get_abs_string_index(idx)]\n    137 \n    138     def __setitem__(self, idx, module):\n\nKeyError: '2'\n\n</code></pre>\n<p>modified as</p>\n<pre><code>    def __setitem__(self, idx, module):\n        idx = self._get_abs_string_index(idx)\n        return setattr(self, str(idx), module)\n</code></pre>\n<p>to fix it.</p>\n<pre><code>In [31]: class NewModuleList(nn.ModuleList):\n    ...:     def __setitem__(self, idx, module):\n    ...:         idx = self._get_abs_string_index(idx)\n    ...:         return setattr(self, str(idx), module)\n    ...:     \n\nIn [32]: mlist = NewModuleList([nn.ReLU(), nn.Conv2d(10, 10, 2, 1)])\n\nIn [33]: mlist[-1] = nn.ReLU()\n\nIn [34]: mlist\nOut[34]: \nNewModuleList(\n  (0): ReLU()\n  (1): ReLU()\n)\n</code></pre>", "body_text": "ModuleList class function __setitem__ has implicit rist\nIn [26]: mlist = nn.ModuleList([nn.ReLU(), nn.Conv2d(10, 10, 3, 1)])\n\nIn [27]: mlist\nOut[27]: \nModuleList(\n  (0): ReLU()\n  (1): Conv2d(10, 10, kernel_size=(3, 3), stride=(1, 1))\n)\n\nIn [28]: mlist[-1] = nn.ReLU()\n\nIn [29]: mlist\nOut[29]: \nModuleList(\n  (0): ReLU()\n  (1): Conv2d(10, 10, kernel_size=(3, 3), stride=(1, 1))\n  (-1): ReLU()\n)\n\nIn [30]: mlist[-1]\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\n<ipython-input-30-229d1b6823a0> in <module>()\n----> 1 mlist[-1]\n\n~/anaconda3/lib/python3.6/site-packages/torch/nn/modules/container.py in __getitem__(self, idx)\n    134             return ModuleList(list(self._modules.values())[idx])\n    135         else:\n--> 136             return self._modules[self._get_abs_string_index(idx)]\n    137 \n    138     def __setitem__(self, idx, module):\n\nKeyError: '2'\n\n\nmodified as\n    def __setitem__(self, idx, module):\n        idx = self._get_abs_string_index(idx)\n        return setattr(self, str(idx), module)\n\nto fix it.\nIn [31]: class NewModuleList(nn.ModuleList):\n    ...:     def __setitem__(self, idx, module):\n    ...:         idx = self._get_abs_string_index(idx)\n    ...:         return setattr(self, str(idx), module)\n    ...:     \n\nIn [32]: mlist = NewModuleList([nn.ReLU(), nn.Conv2d(10, 10, 2, 1)])\n\nIn [33]: mlist[-1] = nn.ReLU()\n\nIn [34]: mlist\nOut[34]: \nNewModuleList(\n  (0): ReLU()\n  (1): ReLU()\n)", "merged": false, "mergeable": null, "rebaseable": null, "mergeable_state": "unknown", "merged_by": null, "comments": 1, "review_comments": 0, "maintainer_can_modify": false, "commits": 4, "additions": 18, "deletions": 7, "changed_files": 2}