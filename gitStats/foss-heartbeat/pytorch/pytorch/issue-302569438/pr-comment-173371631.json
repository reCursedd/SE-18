{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/173371631", "pull_request_review_id": 102551820, "id": 173371631, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MzM3MTYzMQ==", "diff_hunk": "@@ -478,6 +539,18 @@ static void * THRefcountedMapAllocator_alloc(void *_ctx, ptrdiff_t size) {\n   char *data = ((char*)ptr) + TH_ALLOC_ALIGNMENT;\n   THMapInfo *map_info = (THMapInfo*)ptr;\n \n+#ifdef _WIN32\n+  ReleaseContext* cxt = (ReleaseContext *) THAlloc(sizeof(ReleaseContext));\n+  cxt->handle = ctx->handle;\n+  cxt->event = ctx->event;\n+  cxt->data = (void*)data;\n+  HANDLE thread = CreateThread(NULL, 0, WaitForReleaseHandle, (LPVOID)cxt, 0, NULL);", "path": "aten/src/TH/THAllocator.c", "position": null, "original_position": 127, "commit_id": "1dfcd28a04e5a1db16da7894f2e2305a5bc41935", "original_commit_id": "5f6bd87d26b7649d7edd4e4e25d93201505d81d9", "user": {"login": "peterjc123", "id": 9998726, "node_id": "MDQ6VXNlcjk5OTg3MjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/9998726?v=4", "gravatar_id": "", "url": "https://api.github.com/users/peterjc123", "html_url": "https://github.com/peterjc123", "followers_url": "https://api.github.com/users/peterjc123/followers", "following_url": "https://api.github.com/users/peterjc123/following{/other_user}", "gists_url": "https://api.github.com/users/peterjc123/gists{/gist_id}", "starred_url": "https://api.github.com/users/peterjc123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/peterjc123/subscriptions", "organizations_url": "https://api.github.com/users/peterjc123/orgs", "repos_url": "https://api.github.com/users/peterjc123/repos", "events_url": "https://api.github.com/users/peterjc123/events{/privacy}", "received_events_url": "https://api.github.com/users/peterjc123/received_events", "type": "User", "site_admin": false}, "body": "Sorry, I've reconsidered this. It's extremely difficult to implement this. There're mainly two difficulties, synchronization and queue implementation.\r\n1. Because we have to send the handles to the queue but for both processes the handles are actually different. We'll need to link the `Event` with the `FileMapping`, but the `Event` may be blocked since the sequence of freeing is not strictly synchronized. How can we resolve this? \r\n2. It seems that we don't have an existing structure of `Queue` in `TH` or `c`. Shall we implement it?", "created_at": "2018-03-09T06:05:43Z", "updated_at": "2018-11-23T15:40:32Z", "html_url": "https://github.com/pytorch/pytorch/pull/5585#discussion_r173371631", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/5585", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/173371631"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/5585#discussion_r173371631"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/5585"}}, "body_html": "<p>Sorry, I've reconsidered this. It's extremely difficult to implement this. There're mainly two difficulties, synchronization and queue implementation.</p>\n<ol>\n<li>Because we have to send the handles to the queue but for both processes the handles are actually different. We'll need to link the <code>Event</code> with the <code>FileMapping</code>, but the <code>Event</code> may be blocked since the sequence of freeing is not strictly synchronized. How can we resolve this?</li>\n<li>It seems that we don't have an existing structure of <code>Queue</code> in <code>TH</code> or <code>c</code>. Shall we implement it?</li>\n</ol>", "body_text": "Sorry, I've reconsidered this. It's extremely difficult to implement this. There're mainly two difficulties, synchronization and queue implementation.\n\nBecause we have to send the handles to the queue but for both processes the handles are actually different. We'll need to link the Event with the FileMapping, but the Event may be blocked since the sequence of freeing is not strictly synchronized. How can we resolve this?\nIt seems that we don't have an existing structure of Queue in TH or c. Shall we implement it?", "in_reply_to_id": 173116369}