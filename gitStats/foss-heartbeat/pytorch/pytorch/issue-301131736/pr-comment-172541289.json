{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/172541289", "pull_request_review_id": 101574183, "id": 172541289, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MjU0MTI4OQ==", "diff_hunk": "@@ -88,23 +88,7 @@ static inline ssize_t doPythonIO(PyObject* fildes, void* buf, size_t nbytes, boo\n   THPObjectPtr memview(PyMemoryView_FromMemory(\n       reinterpret_cast<char*>(buf), nbytes, rw_flag));\n #else\n-  // PyMemoryView_FromMemory doesn't exist in Python 2.7, so we manually\n-  // create a Py_buffer that describes the memory and create a memoryview from it.\n-  auto readonly_flag = is_read ? 1 : 0;\n-  Py_buffer pyBuf;\n-  pyBuf.buf = buf;\n-  pyBuf.obj = nullptr;\n-  pyBuf.len = (Py_ssize_t)nbytes;\n-  pyBuf.itemsize = 1;\n-  pyBuf.readonly = readonly_flag;\n-  pyBuf.ndim = 0;\n-  pyBuf.format = nullptr;\n-  pyBuf.shape = nullptr;\n-  pyBuf.strides = nullptr;\n-  pyBuf.suboffsets = nullptr;\n-  pyBuf.internal = nullptr;\n-\n-  THPObjectPtr memview(PyMemoryView_FromBuffer(&pyBuf));\n+  THPObjectPtr memview(PyBuffer_FromReadWriteMemory(buf, nbytes));", "path": "torch/csrc/serialization.cpp", "position": null, "original_position": 21, "commit_id": "bdaf61fb52ecadc1e0f83be28ea738ad2635257d", "original_commit_id": "59a2286ba622312a400d42d3b2e39d394b180cf2", "user": {"login": "zou3519", "id": 5652049, "node_id": "MDQ6VXNlcjU2NTIwNDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/5652049?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zou3519", "html_url": "https://github.com/zou3519", "followers_url": "https://api.github.com/users/zou3519/followers", "following_url": "https://api.github.com/users/zou3519/following{/other_user}", "gists_url": "https://api.github.com/users/zou3519/gists{/gist_id}", "starred_url": "https://api.github.com/users/zou3519/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zou3519/subscriptions", "organizations_url": "https://api.github.com/users/zou3519/orgs", "repos_url": "https://api.github.com/users/zou3519/repos", "events_url": "https://api.github.com/users/zou3519/events{/privacy}", "received_events_url": "https://api.github.com/users/zou3519/received_events", "type": "User", "site_admin": false}, "body": "Python 3 doesn't have PyBuffer_FromReadWriteMemory.\r\n\r\nThe docs for `readinto` and `write` say they can only take bytesarray or memoryview objects, but nothing bad so far has happened when I pass a Py_buffer directly into `readinto`/`write`... I'll change it so that a memoryview wraps it so that it's safer.", "created_at": "2018-03-06T14:55:11Z", "updated_at": "2018-11-23T15:40:24Z", "html_url": "https://github.com/pytorch/pytorch/pull/5466#discussion_r172541289", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/5466", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/172541289"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/5466#discussion_r172541289"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/5466"}}, "body_html": "<p>Python 3 doesn't have PyBuffer_FromReadWriteMemory.</p>\n<p>The docs for <code>readinto</code> and <code>write</code> say they can only take bytesarray or memoryview objects, but nothing bad so far has happened when I pass a Py_buffer directly into <code>readinto</code>/<code>write</code>... I'll change it so that a memoryview wraps it so that it's safer.</p>", "body_text": "Python 3 doesn't have PyBuffer_FromReadWriteMemory.\nThe docs for readinto and write say they can only take bytesarray or memoryview objects, but nothing bad so far has happened when I pass a Py_buffer directly into readinto/write... I'll change it so that a memoryview wraps it so that it's safer.", "in_reply_to_id": 172533766}