{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/362711368", "html_url": "https://github.com/pytorch/pytorch/issues/5004#issuecomment-362711368", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/5004", "id": 362711368, "node_id": "MDEyOklzc3VlQ29tbWVudDM2MjcxMTM2OA==", "user": {"login": "elanmart", "id": 10772830, "node_id": "MDQ6VXNlcjEwNzcyODMw", "avatar_url": "https://avatars3.githubusercontent.com/u/10772830?v=4", "gravatar_id": "", "url": "https://api.github.com/users/elanmart", "html_url": "https://github.com/elanmart", "followers_url": "https://api.github.com/users/elanmart/followers", "following_url": "https://api.github.com/users/elanmart/following{/other_user}", "gists_url": "https://api.github.com/users/elanmart/gists{/gist_id}", "starred_url": "https://api.github.com/users/elanmart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/elanmart/subscriptions", "organizations_url": "https://api.github.com/users/elanmart/orgs", "repos_url": "https://api.github.com/users/elanmart/repos", "events_url": "https://api.github.com/users/elanmart/events{/privacy}", "received_events_url": "https://api.github.com/users/elanmart/received_events", "type": "User", "site_admin": false}, "created_at": "2018-02-02T21:22:02Z", "updated_at": "2018-02-02T22:13:55Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=9083577\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/Rhuax\">@Rhuax</a> you seem to be playing with types a little bit too much.</p>\n<p>Change <a href=\"https://github.com/Rhuax/text-summarization/blob/6c7ad229dc0cfdf27bfc192ef5434f4935ec28bf/util.py#L135\">https://github.com/Rhuax/text-summarization/blob/6c7ad229dc0cfdf27bfc192ef5434f4935ec28bf/util.py#L135</a><br>\nto <code>return torch.from_numpy(embeddings).float()</code> and remove all other <code>.float()</code> and <code>.double()</code> calls.</p>\n<hr>\n<p>Edit:<br>\nunfortunatelly I'm not able to provide a minimal example that would trigger this assert.</p>\n<p>In the posted code there is a lot of calls to <code>.double()</code> and <code>.float()</code>, and then at some point <code>cur_offset</code> gets two times bigger than <code>offset</code> at<br>\n<div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/pytorch/pytorch/blob/28890b20461453d21564142295e727dec58044c1/torch/backends/cudnn/rnn.py#L171\">pytorch/torch/backends/cudnn/rnn.py</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n         Line 171\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/pytorch/pytorch/commit/28890b20461453d21564142295e727dec58044c1\">28890b2</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L171\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"171\"></td>\n          <td id=\"LC171\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-k\">assert</span> cur_offset <span class=\"pl-k\">==</span> offset </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n .</p>\n<p>Removing these casts seems to \"solve\" the problem.</p>", "body_text": "@Rhuax you seem to be playing with types a little bit too much.\nChange https://github.com/Rhuax/text-summarization/blob/6c7ad229dc0cfdf27bfc192ef5434f4935ec28bf/util.py#L135\nto return torch.from_numpy(embeddings).float() and remove all other .float() and .double() calls.\n\nEdit:\nunfortunatelly I'm not able to provide a minimal example that would trigger this assert.\nIn the posted code there is a lot of calls to .double() and .float(), and then at some point cur_offset gets two times bigger than offset at\n\n  \n    \n      pytorch/torch/backends/cudnn/rnn.py\n    \n    \n         Line 171\n      in\n      28890b2\n    \n    \n    \n    \n\n        \n          \n           assert cur_offset == offset \n        \n    \n  \n\n .\nRemoving these casts seems to \"solve\" the problem.", "body": "@Rhuax you seem to be playing with types a little bit too much. \r\n\r\nChange https://github.com/Rhuax/text-summarization/blob/6c7ad229dc0cfdf27bfc192ef5434f4935ec28bf/util.py#L135\r\nto `return torch.from_numpy(embeddings).float()` and remove all other `.float()` and `.double()` calls.\r\n\r\n----\r\n\r\nEdit:\r\nunfortunatelly I'm not able to provide a minimal example that would trigger this assert. \r\n\r\nIn the posted code there is a lot of calls to `.double()` and `.float()`, and then at some point `cur_offset` gets two times bigger than `offset` at \r\nhttps://github.com/pytorch/pytorch/blob/28890b20461453d21564142295e727dec58044c1/torch/backends/cudnn/rnn.py#L171 .\r\n\r\nRemoving these casts seems to \"solve\" the problem."}