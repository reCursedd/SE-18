{"url": "https://api.github.com/repos/pytorch/pytorch/issues/1318", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/1318/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/1318/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/1318/events", "html_url": "https://github.com/pytorch/pytorch/issues/1318", "id": 223308953, "node_id": "MDU6SXNzdWUyMjMzMDg5NTM=", "number": 1318, "title": "Segmentation Fault during `.backward()`", "user": {"login": "pltrdy", "id": 6375843, "node_id": "MDQ6VXNlcjYzNzU4NDM=", "avatar_url": "https://avatars3.githubusercontent.com/u/6375843?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pltrdy", "html_url": "https://github.com/pltrdy", "followers_url": "https://api.github.com/users/pltrdy/followers", "following_url": "https://api.github.com/users/pltrdy/following{/other_user}", "gists_url": "https://api.github.com/users/pltrdy/gists{/gist_id}", "starred_url": "https://api.github.com/users/pltrdy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pltrdy/subscriptions", "organizations_url": "https://api.github.com/users/pltrdy/orgs", "repos_url": "https://api.github.com/users/pltrdy/repos", "events_url": "https://api.github.com/users/pltrdy/events{/privacy}", "received_events_url": "https://api.github.com/users/pltrdy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 424131847, "node_id": "MDU6TGFiZWw0MjQxMzE4NDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/bug", "name": "bug", "color": "b60205", "default": true}, {"id": 443484135, "node_id": "MDU6TGFiZWw0NDM0ODQxMzU=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/high%20priority", "name": "high priority", "color": "F22613", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pytorch/pytorch/milestones/2", "html_url": "https://github.com/pytorch/pytorch/milestone/2", "labels_url": "https://api.github.com/repos/pytorch/pytorch/milestones/2/labels", "id": 2536200, "node_id": "MDk6TWlsZXN0b25lMjUzNjIwMA==", "number": 2, "title": "v0.2", "description": "", "creator": {"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}, "open_issues": 2, "closed_issues": 34, "state": "closed", "created_at": "2017-05-22T18:19:28Z", "updated_at": "2018-08-06T21:16:06Z", "due_on": "2017-06-04T07:00:00Z", "closed_at": "2018-08-06T21:16:06Z"}, "comments": 17, "created_at": "2017-04-21T08:05:52Z", "updated_at": "2017-09-13T18:47:57Z", "closed_at": "2017-09-13T18:47:57Z", "author_association": "NONE", "body_html": "<p>I've been discussing - originally for a dummy question - on the forum about it: <a href=\"https://discuss.pytorch.org/t/some-variables-are-not-affected-by-cuda/2079\" rel=\"nofollow\">https://discuss.pytorch.org/t/some-variables-are-not-affected-by-cuda/2079</a></p>\n<p>I was originally working with Jupyter, the notebook is here: <a href=\"https://github.com/pltrdy/pytorchwork/blob/master/rnn_lm.ipynb\">https://github.com/pltrdy/pytorchwork/blob/master/rnn_lm.ipynb</a><br>\nFor convenience I also generated the corresponding <code>.py</code> script:<br>\n<a href=\"https://github.com/pltrdy/pytorchwork/blob/master/rnn_lm.py\">https://github.com/pltrdy/pytorchwork/blob/master/rnn_lm.py</a></p>\n<p>I have a simple model that, that work as expected when working with CPU, but raises Seg Fault when I work with <code>.cuda()</code>.</p>\n<p>From simple debugging I found that the segfault was fired at the line <code>loss.backward()</code>.<br>\nThen as suggested by <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=6359743\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/albanD\">@albanD</a> I ran <code>gdb --args python rnn_lm.py</code> giving the following output:</p>\n<pre><code>$ gdb --args python rnn_lm.py\nGNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1\nCopyright (C) 2014 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-linux-gnu\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n&lt;http://www.gnu.org/software/gdb/bugs/&gt;.\nFind the GDB manual and other documentation resources online at:\n&lt;http://www.gnu.org/software/gdb/documentation/&gt;.\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\"...\nReading symbols from python...done.\n(gdb) run\nStarting program: /home/moses/anaconda3/bin/python rnn_lm.py\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\nLoading data...\nLoaded\t929589 training words\n\t73760 validation words\n\t82430 test words\nVocabulary: 10000\nCreating model...\nUsing CUDA\n[New Thread 0x7fffb198e700 (LWP 17297)]\n[New Thread 0x7fffb118d700 (LWP 17298)]\n[New Thread 0x7fffb098c700 (LWP 17299)]\nDone.\nEpoch 1\n726.24140625\n36\n0.0.0\n[New Thread 0x7fffaff8a780 (LWP 17309)]\n[New Thread 0x7fffafb89800 (LWP 17310)]\n[New Thread 0x7fffaf788880 (LWP 17311)]\n[New Thread 0x7fffaf387900 (LWP 17312)]\n[New Thread 0x7fffaef86980 (LWP 17313)]\n[New Thread 0x7fffaeb85a00 (LWP 17314)]\n[New Thread 0x7fffae784a80 (LWP 17315)]\n\n[ ... irrelevant output initially in the script ...\u00a0]\n\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 0x7fffad893700 (LWP 17317)]\ntorch::autograd::GradBuffer::addGrad(unsigned long, std::shared_ptr&lt;torch::autograd::Variable&gt;&amp;&amp;) (\n    this=this@entry=0x7fffad892c40, pos=pos@entry=0, \n    var=var@entry=&lt;unknown type in /home/moses/anaconda3/lib/python3.6/site-packages/torch/_C.cpython-36m-x86_64-linux-gnu.so, CU 0x6e92e4, DIE 0x6fcb24&gt;) at torch/csrc/autograd/grad_buffer.cpp:17\n17\ttorch/csrc/autograd/grad_buffer.cpp: No such file or directory.\n(gdb) bt\n#0  torch::autograd::GradBuffer::addGrad(unsigned long, std::shared_ptr&lt;torch::autograd::Variable&gt;&amp;&amp;) (\n    this=this@entry=0x7fffad892c40, pos=pos@entry=0, \n    var=var@entry=&lt;unknown type in /home/moses/anaconda3/lib/python3.6/site-packages/torch/_C.cpython-36m-x86_64-linux-gnu.so, CU 0x6e92e4, DIE 0x6fcb24&gt;) at torch/csrc/autograd/grad_buffer.cpp:17\n#1  0x00007fffed45c9a1 in torch::autograd::Engine::evaluate_function (this=this@entry=0x7fffedcd7ce0 &lt;engine&gt;, \n    task=...) from /home/&lt;user&gt;/anaconda3/lib/python3.6/site-packages/torch/_C.cpython-36m-x86_64-linux-gnu.so\n#2  0x00007fffed45dd1a in torch::autograd::Engine::thread_main (this=this@entry=0x7fffedcd7ce0 &lt;engine&gt;, queue=...)\n   from /home/&lt;user&gt;/anaconda3/lib/python3.6/site-packages/torch/_C.cpython-36m-x86_64-linux-gnu.so\n#3  0x00007fffed46e87a in PythonEngine::thread_main (this=0x7fffedcd7ce0 &lt;engine&gt;, queue=...)\n   from /home/&lt;user&gt;/anaconda3/lib/python3.6/site-packages/torch/_C.cpython-36m-x86_64-linux-gnu.so\n#4  0x00007ffff652d870 in ?? () from /home/&lt;user&gt;/anaconda3/bin/../lib/libstdc++.so.6\n#5  0x00007ffff7474184 in start_thread (arg=0x7fffad893700) at pthread_create.c:312\n#6  0x00007ffff688cbed in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111\n(gdb)\n</code></pre>\n<h2>Config</h2>\n<ul>\n<li>Ubuntu 14.04.5 LTS</li>\n<li>Python Interpreter: <code>Python 3.6.0 |Anaconda custom (64-bit)| (default, Dec 23 2016, 12:22:00)</code></li>\n<li>GPU:  single Nvidia 1080, <code>nvidia-smi</code> says:</li>\n</ul>\n<pre><code>NVIDIA-SMI 375.39 ; Driver Version: 375.39\n</code></pre>\n<ul>\n<li><code>$nvcc --version</code>:</li>\n</ul>\n<pre><code>nvcc: NVIDIA (R) Cuda compiler driver\nCopyright (c) 2005-2016 NVIDIA Corporation\nBuilt on Tue_Jan_10_13:22:03_CST_2017\nCuda compilation tools, release 8.0, V8.0.61\n</code></pre>\n<p>Thanks for any help or suggestions about it.</p>\n<p><code>pltrdy</code></p>", "body_text": "I've been discussing - originally for a dummy question - on the forum about it: https://discuss.pytorch.org/t/some-variables-are-not-affected-by-cuda/2079\nI was originally working with Jupyter, the notebook is here: https://github.com/pltrdy/pytorchwork/blob/master/rnn_lm.ipynb\nFor convenience I also generated the corresponding .py script:\nhttps://github.com/pltrdy/pytorchwork/blob/master/rnn_lm.py\nI have a simple model that, that work as expected when working with CPU, but raises Seg Fault when I work with .cuda().\nFrom simple debugging I found that the segfault was fired at the line loss.backward().\nThen as suggested by @albanD I ran gdb --args python rnn_lm.py giving the following output:\n$ gdb --args python rnn_lm.py\nGNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1\nCopyright (C) 2014 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-linux-gnu\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n<http://www.gnu.org/software/gdb/bugs/>.\nFind the GDB manual and other documentation resources online at:\n<http://www.gnu.org/software/gdb/documentation/>.\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\"...\nReading symbols from python...done.\n(gdb) run\nStarting program: /home/moses/anaconda3/bin/python rnn_lm.py\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\nLoading data...\nLoaded\t929589 training words\n\t73760 validation words\n\t82430 test words\nVocabulary: 10000\nCreating model...\nUsing CUDA\n[New Thread 0x7fffb198e700 (LWP 17297)]\n[New Thread 0x7fffb118d700 (LWP 17298)]\n[New Thread 0x7fffb098c700 (LWP 17299)]\nDone.\nEpoch 1\n726.24140625\n36\n0.0.0\n[New Thread 0x7fffaff8a780 (LWP 17309)]\n[New Thread 0x7fffafb89800 (LWP 17310)]\n[New Thread 0x7fffaf788880 (LWP 17311)]\n[New Thread 0x7fffaf387900 (LWP 17312)]\n[New Thread 0x7fffaef86980 (LWP 17313)]\n[New Thread 0x7fffaeb85a00 (LWP 17314)]\n[New Thread 0x7fffae784a80 (LWP 17315)]\n\n[ ... irrelevant output initially in the script ...\u00a0]\n\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 0x7fffad893700 (LWP 17317)]\ntorch::autograd::GradBuffer::addGrad(unsigned long, std::shared_ptr<torch::autograd::Variable>&&) (\n    this=this@entry=0x7fffad892c40, pos=pos@entry=0, \n    var=var@entry=<unknown type in /home/moses/anaconda3/lib/python3.6/site-packages/torch/_C.cpython-36m-x86_64-linux-gnu.so, CU 0x6e92e4, DIE 0x6fcb24>) at torch/csrc/autograd/grad_buffer.cpp:17\n17\ttorch/csrc/autograd/grad_buffer.cpp: No such file or directory.\n(gdb) bt\n#0  torch::autograd::GradBuffer::addGrad(unsigned long, std::shared_ptr<torch::autograd::Variable>&&) (\n    this=this@entry=0x7fffad892c40, pos=pos@entry=0, \n    var=var@entry=<unknown type in /home/moses/anaconda3/lib/python3.6/site-packages/torch/_C.cpython-36m-x86_64-linux-gnu.so, CU 0x6e92e4, DIE 0x6fcb24>) at torch/csrc/autograd/grad_buffer.cpp:17\n#1  0x00007fffed45c9a1 in torch::autograd::Engine::evaluate_function (this=this@entry=0x7fffedcd7ce0 <engine>, \n    task=...) from /home/<user>/anaconda3/lib/python3.6/site-packages/torch/_C.cpython-36m-x86_64-linux-gnu.so\n#2  0x00007fffed45dd1a in torch::autograd::Engine::thread_main (this=this@entry=0x7fffedcd7ce0 <engine>, queue=...)\n   from /home/<user>/anaconda3/lib/python3.6/site-packages/torch/_C.cpython-36m-x86_64-linux-gnu.so\n#3  0x00007fffed46e87a in PythonEngine::thread_main (this=0x7fffedcd7ce0 <engine>, queue=...)\n   from /home/<user>/anaconda3/lib/python3.6/site-packages/torch/_C.cpython-36m-x86_64-linux-gnu.so\n#4  0x00007ffff652d870 in ?? () from /home/<user>/anaconda3/bin/../lib/libstdc++.so.6\n#5  0x00007ffff7474184 in start_thread (arg=0x7fffad893700) at pthread_create.c:312\n#6  0x00007ffff688cbed in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111\n(gdb)\n\nConfig\n\nUbuntu 14.04.5 LTS\nPython Interpreter: Python 3.6.0 |Anaconda custom (64-bit)| (default, Dec 23 2016, 12:22:00)\nGPU:  single Nvidia 1080, nvidia-smi says:\n\nNVIDIA-SMI 375.39 ; Driver Version: 375.39\n\n\n$nvcc --version:\n\nnvcc: NVIDIA (R) Cuda compiler driver\nCopyright (c) 2005-2016 NVIDIA Corporation\nBuilt on Tue_Jan_10_13:22:03_CST_2017\nCuda compilation tools, release 8.0, V8.0.61\n\nThanks for any help or suggestions about it.\npltrdy", "body": "I've been discussing - originally for a dummy question - on the forum about it: https://discuss.pytorch.org/t/some-variables-are-not-affected-by-cuda/2079 \r\n\r\nI was originally working with Jupyter, the notebook is here: https://github.com/pltrdy/pytorchwork/blob/master/rnn_lm.ipynb\r\nFor convenience I also generated the corresponding `.py` script:\r\nhttps://github.com/pltrdy/pytorchwork/blob/master/rnn_lm.py\r\n\r\nI have a simple model that, that work as expected when working with CPU, but raises Seg Fault when I work with `.cuda()`.\r\n\r\nFrom simple debugging I found that the segfault was fired at the line `loss.backward()`.\r\nThen as suggested by @albanD I ran `gdb --args python rnn_lm.py` giving the following output:\r\n\r\n```\r\n$ gdb --args python rnn_lm.py\r\nGNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1\r\nCopyright (C) 2014 Free Software Foundation, Inc.\r\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\r\nThis is free software: you are free to change and redistribute it.\r\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\r\nand \"show warranty\" for details.\r\nThis GDB was configured as \"x86_64-linux-gnu\".\r\nType \"show configuration\" for configuration details.\r\nFor bug reporting instructions, please see:\r\n<http://www.gnu.org/software/gdb/bugs/>.\r\nFind the GDB manual and other documentation resources online at:\r\n<http://www.gnu.org/software/gdb/documentation/>.\r\nFor help, type \"help\".\r\nType \"apropos word\" to search for commands related to \"word\"...\r\nReading symbols from python...done.\r\n(gdb) run\r\nStarting program: /home/moses/anaconda3/bin/python rnn_lm.py\r\n[Thread debugging using libthread_db enabled]\r\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\r\nLoading data...\r\nLoaded\t929589 training words\r\n\t73760 validation words\r\n\t82430 test words\r\nVocabulary: 10000\r\nCreating model...\r\nUsing CUDA\r\n[New Thread 0x7fffb198e700 (LWP 17297)]\r\n[New Thread 0x7fffb118d700 (LWP 17298)]\r\n[New Thread 0x7fffb098c700 (LWP 17299)]\r\nDone.\r\nEpoch 1\r\n726.24140625\r\n36\r\n0.0.0\r\n[New Thread 0x7fffaff8a780 (LWP 17309)]\r\n[New Thread 0x7fffafb89800 (LWP 17310)]\r\n[New Thread 0x7fffaf788880 (LWP 17311)]\r\n[New Thread 0x7fffaf387900 (LWP 17312)]\r\n[New Thread 0x7fffaef86980 (LWP 17313)]\r\n[New Thread 0x7fffaeb85a00 (LWP 17314)]\r\n[New Thread 0x7fffae784a80 (LWP 17315)]\r\n\r\n[ ... irrelevant output initially in the script ...\u00a0]\r\n\r\nProgram received signal SIGSEGV, Segmentation fault.\r\n[Switching to Thread 0x7fffad893700 (LWP 17317)]\r\ntorch::autograd::GradBuffer::addGrad(unsigned long, std::shared_ptr<torch::autograd::Variable>&&) (\r\n    this=this@entry=0x7fffad892c40, pos=pos@entry=0, \r\n    var=var@entry=<unknown type in /home/moses/anaconda3/lib/python3.6/site-packages/torch/_C.cpython-36m-x86_64-linux-gnu.so, CU 0x6e92e4, DIE 0x6fcb24>) at torch/csrc/autograd/grad_buffer.cpp:17\r\n17\ttorch/csrc/autograd/grad_buffer.cpp: No such file or directory.\r\n(gdb) bt\r\n#0  torch::autograd::GradBuffer::addGrad(unsigned long, std::shared_ptr<torch::autograd::Variable>&&) (\r\n    this=this@entry=0x7fffad892c40, pos=pos@entry=0, \r\n    var=var@entry=<unknown type in /home/moses/anaconda3/lib/python3.6/site-packages/torch/_C.cpython-36m-x86_64-linux-gnu.so, CU 0x6e92e4, DIE 0x6fcb24>) at torch/csrc/autograd/grad_buffer.cpp:17\r\n#1  0x00007fffed45c9a1 in torch::autograd::Engine::evaluate_function (this=this@entry=0x7fffedcd7ce0 <engine>, \r\n    task=...) from /home/<user>/anaconda3/lib/python3.6/site-packages/torch/_C.cpython-36m-x86_64-linux-gnu.so\r\n#2  0x00007fffed45dd1a in torch::autograd::Engine::thread_main (this=this@entry=0x7fffedcd7ce0 <engine>, queue=...)\r\n   from /home/<user>/anaconda3/lib/python3.6/site-packages/torch/_C.cpython-36m-x86_64-linux-gnu.so\r\n#3  0x00007fffed46e87a in PythonEngine::thread_main (this=0x7fffedcd7ce0 <engine>, queue=...)\r\n   from /home/<user>/anaconda3/lib/python3.6/site-packages/torch/_C.cpython-36m-x86_64-linux-gnu.so\r\n#4  0x00007ffff652d870 in ?? () from /home/<user>/anaconda3/bin/../lib/libstdc++.so.6\r\n#5  0x00007ffff7474184 in start_thread (arg=0x7fffad893700) at pthread_create.c:312\r\n#6  0x00007ffff688cbed in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111\r\n(gdb)\r\n```\r\n\r\n## Config \r\n* Ubuntu 14.04.5 LTS \r\n* Python Interpreter: `Python 3.6.0 |Anaconda custom (64-bit)| (default, Dec 23 2016, 12:22:00)` \r\n* GPU:  single Nvidia 1080, `nvidia-smi` says:\r\n```\r\nNVIDIA-SMI 375.39 ; Driver Version: 375.39\r\n```\r\n\r\n* `$nvcc --version`:\r\n```\r\nnvcc: NVIDIA (R) Cuda compiler driver\r\nCopyright (c) 2005-2016 NVIDIA Corporation\r\nBuilt on Tue_Jan_10_13:22:03_CST_2017\r\nCuda compilation tools, release 8.0, V8.0.61\r\n```\r\n\r\nThanks for any help or suggestions about it.\r\n\r\n`pltrdy`"}