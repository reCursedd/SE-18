{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/384483143", "html_url": "https://github.com/pytorch/pytorch/pull/6896#issuecomment-384483143", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/6896", "id": 384483143, "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDQ4MzE0Mw==", "user": {"login": "yuzcccc", "id": 9126588, "node_id": "MDQ6VXNlcjkxMjY1ODg=", "avatar_url": "https://avatars2.githubusercontent.com/u/9126588?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuzcccc", "html_url": "https://github.com/yuzcccc", "followers_url": "https://api.github.com/users/yuzcccc/followers", "following_url": "https://api.github.com/users/yuzcccc/following{/other_user}", "gists_url": "https://api.github.com/users/yuzcccc/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuzcccc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuzcccc/subscriptions", "organizations_url": "https://api.github.com/users/yuzcccc/orgs", "repos_url": "https://api.github.com/users/yuzcccc/repos", "events_url": "https://api.github.com/users/yuzcccc/events{/privacy}", "received_events_url": "https://api.github.com/users/yuzcccc/received_events", "type": "User", "site_admin": false}, "created_at": "2018-04-26T01:24:01Z", "updated_at": "2018-04-26T01:25:01Z", "author_association": "NONE", "body_html": "<p>I modified <code>NUM_GPUS=4</code> to 3 in the <code>tutorial_4gpu_e2e_faster_rcnn_R-50-FPN.yaml</code> script, and got the following errors, while  <code>NUM_GPUS=4</code> works well:</p>\n<p>E0426 09:19:35.706372 10555 operator_schema.cc:72] Input index 0 and output idx 0 (gpu_0/res3_0_branch2a_w_grad) are set to be in-place but this is actually not supported by op Copy<br>\nOriginal python traceback for operator 1464 in network <code>generalized_rcnn</code> in exception above (most recent call last):<br>\nFile \"tools/train_net.py\", line 281, in <br>\nFile \"tools/train_net.py\", line 119, in main<br>\nFile \"tools/train_net.py\", line 128, in train_model<br>\nFile \"tools/train_net.py\", line 206, in create_model<br>\nFile \"/home/yuz/work/detectron/lib/modeling/model_builder.py\", line 124, in create<br>\nFile \"/home/yuz/work/detectron/lib/modeling/model_builder.py\", line 89, in generalized_rcnn<br>\nFile \"/home/yuz/work/detectron/lib/modeling/model_builder.py\", line 229, in build_generic_detection_model<br>\nFile \"/home/yuz/work/detectron/lib/modeling/optimizer.py\", line 44, in build_data_parallel_model<br>\nFile \"/home/yuz/work/detectron/lib/modeling/optimizer.py\", line 87, in _add_allreduce_graph<br>\nFile \"/home/yuz/work/caffe2/build/caffe2/python/muji.py\", line 59, in Allreduce<br>\nFile \"/home/yuz/work/caffe2/build/caffe2/python/muji.py\", line 244, in AllreduceFallback<br>\nTraceback (most recent call last):<br>\nFile \"tools/train_net.py\", line 281, in <br>\nmain()<br>\nFile \"tools/train_net.py\", line 119, in main<br>\ncheckpoints = train_model()<br>\nFile \"tools/train_net.py\", line 133, in train_model<br>\nsetup_model_for_training(model, output_dir)<br>\nFile \"tools/train_net.py\", line 239, in setup_model_for_training<br>\nworkspace.CreateNet(model.net)<br>\nFile \"/home/yuz/work/caffe2/build/caffe2/python/workspace.py\", line 166, in CreateNet<br>\nStringifyProto(net), overwrite,<br>\nFile \"/home/yuz/work/caffe2/build/caffe2/python/workspace.py\", line 192, in CallWithExceptionIntercept<br>\nreturn func(*args, **kwargs)<br>\nRuntimeError: [enforce fail at operator.cc:125] schema-&gt;Verify(operator_def). Operator def did not pass schema checking: input: \"gpu_0/res3_0_branch2a_w_grad\" output: \"gpu_0/res3_0_branch2a_w_grad\" name: \"\" type: \"Copy\" device_option { device_type: 1 cuda_gpu_id: 0 }</p>", "body_text": "I modified NUM_GPUS=4 to 3 in the tutorial_4gpu_e2e_faster_rcnn_R-50-FPN.yaml script, and got the following errors, while  NUM_GPUS=4 works well:\nE0426 09:19:35.706372 10555 operator_schema.cc:72] Input index 0 and output idx 0 (gpu_0/res3_0_branch2a_w_grad) are set to be in-place but this is actually not supported by op Copy\nOriginal python traceback for operator 1464 in network generalized_rcnn in exception above (most recent call last):\nFile \"tools/train_net.py\", line 281, in \nFile \"tools/train_net.py\", line 119, in main\nFile \"tools/train_net.py\", line 128, in train_model\nFile \"tools/train_net.py\", line 206, in create_model\nFile \"/home/yuz/work/detectron/lib/modeling/model_builder.py\", line 124, in create\nFile \"/home/yuz/work/detectron/lib/modeling/model_builder.py\", line 89, in generalized_rcnn\nFile \"/home/yuz/work/detectron/lib/modeling/model_builder.py\", line 229, in build_generic_detection_model\nFile \"/home/yuz/work/detectron/lib/modeling/optimizer.py\", line 44, in build_data_parallel_model\nFile \"/home/yuz/work/detectron/lib/modeling/optimizer.py\", line 87, in _add_allreduce_graph\nFile \"/home/yuz/work/caffe2/build/caffe2/python/muji.py\", line 59, in Allreduce\nFile \"/home/yuz/work/caffe2/build/caffe2/python/muji.py\", line 244, in AllreduceFallback\nTraceback (most recent call last):\nFile \"tools/train_net.py\", line 281, in \nmain()\nFile \"tools/train_net.py\", line 119, in main\ncheckpoints = train_model()\nFile \"tools/train_net.py\", line 133, in train_model\nsetup_model_for_training(model, output_dir)\nFile \"tools/train_net.py\", line 239, in setup_model_for_training\nworkspace.CreateNet(model.net)\nFile \"/home/yuz/work/caffe2/build/caffe2/python/workspace.py\", line 166, in CreateNet\nStringifyProto(net), overwrite,\nFile \"/home/yuz/work/caffe2/build/caffe2/python/workspace.py\", line 192, in CallWithExceptionIntercept\nreturn func(*args, **kwargs)\nRuntimeError: [enforce fail at operator.cc:125] schema->Verify(operator_def). Operator def did not pass schema checking: input: \"gpu_0/res3_0_branch2a_w_grad\" output: \"gpu_0/res3_0_branch2a_w_grad\" name: \"\" type: \"Copy\" device_option { device_type: 1 cuda_gpu_id: 0 }", "body": "I modified `NUM_GPUS=4` to 3 in the `tutorial_4gpu_e2e_faster_rcnn_R-50-FPN.yaml` script, and got the following errors, while  `NUM_GPUS=4` works well:\r\n\r\nE0426 09:19:35.706372 10555 operator_schema.cc:72] Input index 0 and output idx 0 (gpu_0/res3_0_branch2a_w_grad) are set to be in-place but this is actually not supported by op Copy\r\nOriginal python traceback for operator 1464 in network `generalized_rcnn` in exception above (most recent call last):\r\n  File \"tools/train_net.py\", line 281, in <module>\r\n  File \"tools/train_net.py\", line 119, in main\r\n  File \"tools/train_net.py\", line 128, in train_model\r\n  File \"tools/train_net.py\", line 206, in create_model\r\n  File \"/home/yuz/work/detectron/lib/modeling/model_builder.py\", line 124, in create\r\n  File \"/home/yuz/work/detectron/lib/modeling/model_builder.py\", line 89, in generalized_rcnn\r\n  File \"/home/yuz/work/detectron/lib/modeling/model_builder.py\", line 229, in build_generic_detection_model\r\n  File \"/home/yuz/work/detectron/lib/modeling/optimizer.py\", line 44, in build_data_parallel_model\r\n  File \"/home/yuz/work/detectron/lib/modeling/optimizer.py\", line 87, in _add_allreduce_graph\r\n  File \"/home/yuz/work/caffe2/build/caffe2/python/muji.py\", line 59, in Allreduce\r\n  File \"/home/yuz/work/caffe2/build/caffe2/python/muji.py\", line 244, in AllreduceFallback\r\nTraceback (most recent call last):\r\n  File \"tools/train_net.py\", line 281, in <module>\r\n    main()\r\n  File \"tools/train_net.py\", line 119, in main\r\n    checkpoints = train_model()\r\n  File \"tools/train_net.py\", line 133, in train_model\r\n    setup_model_for_training(model, output_dir)\r\n  File \"tools/train_net.py\", line 239, in setup_model_for_training\r\n    workspace.CreateNet(model.net)\r\n  File \"/home/yuz/work/caffe2/build/caffe2/python/workspace.py\", line 166, in CreateNet\r\n    StringifyProto(net), overwrite,\r\n  File \"/home/yuz/work/caffe2/build/caffe2/python/workspace.py\", line 192, in CallWithExceptionIntercept\r\n    return func(*args, **kwargs)\r\nRuntimeError: [enforce fail at operator.cc:125] schema->Verify(operator_def). Operator def did not pass schema checking: input: \"gpu_0/res3_0_branch2a_w_grad\" output: \"gpu_0/res3_0_branch2a_w_grad\" name: \"\" type: \"Copy\" device_option { device_type: 1 cuda_gpu_id: 0 } \r\n"}