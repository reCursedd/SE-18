{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/425386205", "html_url": "https://github.com/pytorch/pytorch/issues/11988#issuecomment-425386205", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/11988", "id": 425386205, "node_id": "MDEyOklzc3VlQ29tbWVudDQyNTM4NjIwNQ==", "user": {"login": "akamaus", "id": 58955, "node_id": "MDQ6VXNlcjU4OTU1", "avatar_url": "https://avatars0.githubusercontent.com/u/58955?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akamaus", "html_url": "https://github.com/akamaus", "followers_url": "https://api.github.com/users/akamaus/followers", "following_url": "https://api.github.com/users/akamaus/following{/other_user}", "gists_url": "https://api.github.com/users/akamaus/gists{/gist_id}", "starred_url": "https://api.github.com/users/akamaus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akamaus/subscriptions", "organizations_url": "https://api.github.com/users/akamaus/orgs", "repos_url": "https://api.github.com/users/akamaus/repos", "events_url": "https://api.github.com/users/akamaus/events{/privacy}", "received_events_url": "https://api.github.com/users/akamaus/received_events", "type": "User", "site_admin": false}, "created_at": "2018-09-28T09:57:04Z", "updated_at": "2018-09-28T09:57:04Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=655866\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/colesbury\">@colesbury</a><br>\nThat were just my guesses. All I wanted is to emphasize is that I saw highly suspicious lines both during cmake run and in resulting <code>compile_commands.json.</code></p>\n<p>Just a random sample from the latter file I posted:</p>\n<pre><code> \"directory\": \"/home/dvyal/src/pytorch/build/caffe2\",\n  \"command\": \"/nix/store/iw94llkj05wgaz268mlzvgx8jkbi1ss0-gcc-wrapper-7.3.0/bin/g++  -DCPUINFO_SUPPORTED_PLATFORM=1 -DHAVE_MALLOC_USABLE_SIZE=1 -DHAVE_MMAP=1 -DHAVE_SHM_OPEN=1 -DHAVE_SHM_UNLINK=1 -DNNP_CONVOLUTION_ONLY=0 -DNNP_INFERENCE_ONLY=0 -DONNX_NAMESPACE=onnx_torch -DUSE_C11_ATOMICS=1 -D_FILE_OFFSET_BITS=64 -Dcaffe2_EXPORTS -I/home/dvyal/src/pytorch/aten/src -I/home/dvyal/src/pytorch/build -I/home/dvyal/src/pytorch -I/home/dvyal/src/pytorch/third_party/protobuf/src -isystem /home/dvyal/src/pytorch/cmake/../third_party/googletest/googletest/include -I/home/dvyal/src/pytorch/cmake/../third_party/benchmark/include -isystem /home/dvyal/src/pytorch/cmake/../third_party/eigen -isystem /nix/store/hy65mn4wjswqih75gfr6g4q3xgqdm325-python3-3.6.6/include/python3.6m -isystem /nix/store/06y86bpj7w97fnvgxrwm1231rq2bsfga-python3.6-numpy-1.15.1/lib/python3.6/site-packages/numpy/core/include -isystem /home/dvyal/src/pytorch/cmake/../third_party/pybind11/include -isystem /home/dvyal/src/pytorch/torch/lib/tmp_install/include -I/home/dvyal/src/pytorch/build/caffe2/contrib/aten -I/home/dvyal/src/pytorch/third_party/onnx -I/home/dvyal/src/pytorch/build/third_party/onnx -I/home/dvyal/src/pytorch/build/caffe2/aten/src/TH -I/home/dvyal/src/pytorch/aten/src/TH -I/home/dvyal/src/pytorch/build/caffe2/aten/src -I/home/dvyal/src/pytorch/build/aten/src -I/home/dvyal/src/pytorch/aten/src/THNN -I/home/dvyal/src/pytorch/aten/src/THCUNN -I/home/dvyal/src/pytorch/aten/../third_party/catch/single_include -I/home/dvyal/src/pytorch/build/caffe2/aten/src/ATen -I/home/dvyal/src/pytorch/aten/src/ATen/.. -I/home/dvyal/src/pytorch/caffe2/core/nomnigraph/include -isystem /home/dvyal/src/pytorch/build/include -I/home/dvyal/src/pytorch/c10/.. -I/home/dvyal/src/pytorch/third_party/NNPACK/include -I/home/dvyal/src/pytorch/third_party/pthreadpool/include -I/home/dvyal/src/pytorch/third_party/cpuinfo/include  --std=c++11  -Wno-deprecated -fvisibility-inlines-hidden -D_FORCE_INLINES -D_MWAITXINTRIN_H_INCLUDED -D__STRICT_ANSI__ -fopenmp -O2 -fPIC -Wno-narrowing -Wall -Wextra -Wno-missing-field-initializers -Wno-type-limits -Wno-array-bounds -Wno-unknown-pragmas -Wno-sign-compare -Wno-unused-parameter -Wno-unused-variable -Wno-unused-function -Wno-unused-result -Wno-strict-overflow -Wno-strict-aliasing -Wno-error=deprecated-declarations -Wno-stringop-overflow -Wno-error=pedantic -Wno-error=redundant-decls -Wno-error=old-style-cast -faligned-new -Wno-unused-but-set-variable -Wno-maybe-uninitialized -Wno-stringop-overflow -DHAVE_AVX_CPU_DEFINITION -DHAVE_AVX2_CPU_DEFINITION -O3  -fPIC   -DHAVE_GCC_GET_CPUID -DUSE_AVX -DUSE_AVX2 -DTH_HAVE_THREAD -fvisibility=hidden -DCAFFE2_BUILD_MAIN_LIB -O2 -std=gnu++11 -o CMakeFiles/caffe2.dir/operators/elementwise_logical_ops.cc.o -c /home/dvyal/src/pytorch/caffe2/operators/elementwise_logical_ops.cc\",\n  \"file\": \"/home/dvyal/src/pytorch/caffe2/operators/elementwise_logical_ops.cc\"\n</code></pre>\n<p>We see following flags among others: <code>-O3  -fPIC   -DHAVE_GCC_GET_CPUID -DUSE_AVX -DUSE_AVX2</code><br>\nI didn't analyze further, but seems like AVX was (mistakenly) detected.  No SSE4 related flags, btw. Maybe issue topic shifted a bit, though, because that logs are from PR <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1716488\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/cpuhrsch\">@cpuhrsch</a> asked me to try.</p>", "body_text": "@colesbury\nThat were just my guesses. All I wanted is to emphasize is that I saw highly suspicious lines both during cmake run and in resulting compile_commands.json.\nJust a random sample from the latter file I posted:\n \"directory\": \"/home/dvyal/src/pytorch/build/caffe2\",\n  \"command\": \"/nix/store/iw94llkj05wgaz268mlzvgx8jkbi1ss0-gcc-wrapper-7.3.0/bin/g++  -DCPUINFO_SUPPORTED_PLATFORM=1 -DHAVE_MALLOC_USABLE_SIZE=1 -DHAVE_MMAP=1 -DHAVE_SHM_OPEN=1 -DHAVE_SHM_UNLINK=1 -DNNP_CONVOLUTION_ONLY=0 -DNNP_INFERENCE_ONLY=0 -DONNX_NAMESPACE=onnx_torch -DUSE_C11_ATOMICS=1 -D_FILE_OFFSET_BITS=64 -Dcaffe2_EXPORTS -I/home/dvyal/src/pytorch/aten/src -I/home/dvyal/src/pytorch/build -I/home/dvyal/src/pytorch -I/home/dvyal/src/pytorch/third_party/protobuf/src -isystem /home/dvyal/src/pytorch/cmake/../third_party/googletest/googletest/include -I/home/dvyal/src/pytorch/cmake/../third_party/benchmark/include -isystem /home/dvyal/src/pytorch/cmake/../third_party/eigen -isystem /nix/store/hy65mn4wjswqih75gfr6g4q3xgqdm325-python3-3.6.6/include/python3.6m -isystem /nix/store/06y86bpj7w97fnvgxrwm1231rq2bsfga-python3.6-numpy-1.15.1/lib/python3.6/site-packages/numpy/core/include -isystem /home/dvyal/src/pytorch/cmake/../third_party/pybind11/include -isystem /home/dvyal/src/pytorch/torch/lib/tmp_install/include -I/home/dvyal/src/pytorch/build/caffe2/contrib/aten -I/home/dvyal/src/pytorch/third_party/onnx -I/home/dvyal/src/pytorch/build/third_party/onnx -I/home/dvyal/src/pytorch/build/caffe2/aten/src/TH -I/home/dvyal/src/pytorch/aten/src/TH -I/home/dvyal/src/pytorch/build/caffe2/aten/src -I/home/dvyal/src/pytorch/build/aten/src -I/home/dvyal/src/pytorch/aten/src/THNN -I/home/dvyal/src/pytorch/aten/src/THCUNN -I/home/dvyal/src/pytorch/aten/../third_party/catch/single_include -I/home/dvyal/src/pytorch/build/caffe2/aten/src/ATen -I/home/dvyal/src/pytorch/aten/src/ATen/.. -I/home/dvyal/src/pytorch/caffe2/core/nomnigraph/include -isystem /home/dvyal/src/pytorch/build/include -I/home/dvyal/src/pytorch/c10/.. -I/home/dvyal/src/pytorch/third_party/NNPACK/include -I/home/dvyal/src/pytorch/third_party/pthreadpool/include -I/home/dvyal/src/pytorch/third_party/cpuinfo/include  --std=c++11  -Wno-deprecated -fvisibility-inlines-hidden -D_FORCE_INLINES -D_MWAITXINTRIN_H_INCLUDED -D__STRICT_ANSI__ -fopenmp -O2 -fPIC -Wno-narrowing -Wall -Wextra -Wno-missing-field-initializers -Wno-type-limits -Wno-array-bounds -Wno-unknown-pragmas -Wno-sign-compare -Wno-unused-parameter -Wno-unused-variable -Wno-unused-function -Wno-unused-result -Wno-strict-overflow -Wno-strict-aliasing -Wno-error=deprecated-declarations -Wno-stringop-overflow -Wno-error=pedantic -Wno-error=redundant-decls -Wno-error=old-style-cast -faligned-new -Wno-unused-but-set-variable -Wno-maybe-uninitialized -Wno-stringop-overflow -DHAVE_AVX_CPU_DEFINITION -DHAVE_AVX2_CPU_DEFINITION -O3  -fPIC   -DHAVE_GCC_GET_CPUID -DUSE_AVX -DUSE_AVX2 -DTH_HAVE_THREAD -fvisibility=hidden -DCAFFE2_BUILD_MAIN_LIB -O2 -std=gnu++11 -o CMakeFiles/caffe2.dir/operators/elementwise_logical_ops.cc.o -c /home/dvyal/src/pytorch/caffe2/operators/elementwise_logical_ops.cc\",\n  \"file\": \"/home/dvyal/src/pytorch/caffe2/operators/elementwise_logical_ops.cc\"\n\nWe see following flags among others: -O3  -fPIC   -DHAVE_GCC_GET_CPUID -DUSE_AVX -DUSE_AVX2\nI didn't analyze further, but seems like AVX was (mistakenly) detected.  No SSE4 related flags, btw. Maybe issue topic shifted a bit, though, because that logs are from PR @cpuhrsch asked me to try.", "body": "@colesbury \r\nThat were just my guesses. All I wanted is to emphasize is that I saw highly suspicious lines both during cmake run and in resulting `compile_commands.json.`\r\n\r\nJust a random sample from the latter file I posted:\r\n```\r\n \"directory\": \"/home/dvyal/src/pytorch/build/caffe2\",\r\n  \"command\": \"/nix/store/iw94llkj05wgaz268mlzvgx8jkbi1ss0-gcc-wrapper-7.3.0/bin/g++  -DCPUINFO_SUPPORTED_PLATFORM=1 -DHAVE_MALLOC_USABLE_SIZE=1 -DHAVE_MMAP=1 -DHAVE_SHM_OPEN=1 -DHAVE_SHM_UNLINK=1 -DNNP_CONVOLUTION_ONLY=0 -DNNP_INFERENCE_ONLY=0 -DONNX_NAMESPACE=onnx_torch -DUSE_C11_ATOMICS=1 -D_FILE_OFFSET_BITS=64 -Dcaffe2_EXPORTS -I/home/dvyal/src/pytorch/aten/src -I/home/dvyal/src/pytorch/build -I/home/dvyal/src/pytorch -I/home/dvyal/src/pytorch/third_party/protobuf/src -isystem /home/dvyal/src/pytorch/cmake/../third_party/googletest/googletest/include -I/home/dvyal/src/pytorch/cmake/../third_party/benchmark/include -isystem /home/dvyal/src/pytorch/cmake/../third_party/eigen -isystem /nix/store/hy65mn4wjswqih75gfr6g4q3xgqdm325-python3-3.6.6/include/python3.6m -isystem /nix/store/06y86bpj7w97fnvgxrwm1231rq2bsfga-python3.6-numpy-1.15.1/lib/python3.6/site-packages/numpy/core/include -isystem /home/dvyal/src/pytorch/cmake/../third_party/pybind11/include -isystem /home/dvyal/src/pytorch/torch/lib/tmp_install/include -I/home/dvyal/src/pytorch/build/caffe2/contrib/aten -I/home/dvyal/src/pytorch/third_party/onnx -I/home/dvyal/src/pytorch/build/third_party/onnx -I/home/dvyal/src/pytorch/build/caffe2/aten/src/TH -I/home/dvyal/src/pytorch/aten/src/TH -I/home/dvyal/src/pytorch/build/caffe2/aten/src -I/home/dvyal/src/pytorch/build/aten/src -I/home/dvyal/src/pytorch/aten/src/THNN -I/home/dvyal/src/pytorch/aten/src/THCUNN -I/home/dvyal/src/pytorch/aten/../third_party/catch/single_include -I/home/dvyal/src/pytorch/build/caffe2/aten/src/ATen -I/home/dvyal/src/pytorch/aten/src/ATen/.. -I/home/dvyal/src/pytorch/caffe2/core/nomnigraph/include -isystem /home/dvyal/src/pytorch/build/include -I/home/dvyal/src/pytorch/c10/.. -I/home/dvyal/src/pytorch/third_party/NNPACK/include -I/home/dvyal/src/pytorch/third_party/pthreadpool/include -I/home/dvyal/src/pytorch/third_party/cpuinfo/include  --std=c++11  -Wno-deprecated -fvisibility-inlines-hidden -D_FORCE_INLINES -D_MWAITXINTRIN_H_INCLUDED -D__STRICT_ANSI__ -fopenmp -O2 -fPIC -Wno-narrowing -Wall -Wextra -Wno-missing-field-initializers -Wno-type-limits -Wno-array-bounds -Wno-unknown-pragmas -Wno-sign-compare -Wno-unused-parameter -Wno-unused-variable -Wno-unused-function -Wno-unused-result -Wno-strict-overflow -Wno-strict-aliasing -Wno-error=deprecated-declarations -Wno-stringop-overflow -Wno-error=pedantic -Wno-error=redundant-decls -Wno-error=old-style-cast -faligned-new -Wno-unused-but-set-variable -Wno-maybe-uninitialized -Wno-stringop-overflow -DHAVE_AVX_CPU_DEFINITION -DHAVE_AVX2_CPU_DEFINITION -O3  -fPIC   -DHAVE_GCC_GET_CPUID -DUSE_AVX -DUSE_AVX2 -DTH_HAVE_THREAD -fvisibility=hidden -DCAFFE2_BUILD_MAIN_LIB -O2 -std=gnu++11 -o CMakeFiles/caffe2.dir/operators/elementwise_logical_ops.cc.o -c /home/dvyal/src/pytorch/caffe2/operators/elementwise_logical_ops.cc\",\r\n  \"file\": \"/home/dvyal/src/pytorch/caffe2/operators/elementwise_logical_ops.cc\"\r\n```\r\nWe see following flags among others: `-O3  -fPIC   -DHAVE_GCC_GET_CPUID -DUSE_AVX -DUSE_AVX2`\r\nI didn't analyze further, but seems like AVX was (mistakenly) detected.  No SSE4 related flags, btw. Maybe issue topic shifted a bit, though, because that logs are from PR @cpuhrsch asked me to try.\r\n"}