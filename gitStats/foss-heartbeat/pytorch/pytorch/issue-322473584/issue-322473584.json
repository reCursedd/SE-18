{"url": "https://api.github.com/repos/pytorch/pytorch/issues/7517", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/7517/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/7517/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/7517/events", "html_url": "https://github.com/pytorch/pytorch/pull/7517", "id": 322473584, "node_id": "MDExOlB1bGxSZXF1ZXN0MTg3NTk5MTAw", "number": 7517, "title": "[C++ API] Remove initialize_* functions", "user": {"login": "goldsborough", "id": 6429851, "node_id": "MDQ6VXNlcjY0Mjk4NTE=", "avatar_url": "https://avatars3.githubusercontent.com/u/6429851?v=4", "gravatar_id": "", "url": "https://api.github.com/users/goldsborough", "html_url": "https://github.com/goldsborough", "followers_url": "https://api.github.com/users/goldsborough/followers", "following_url": "https://api.github.com/users/goldsborough/following{/other_user}", "gists_url": "https://api.github.com/users/goldsborough/gists{/gist_id}", "starred_url": "https://api.github.com/users/goldsborough/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/goldsborough/subscriptions", "organizations_url": "https://api.github.com/users/goldsborough/orgs", "repos_url": "https://api.github.com/users/goldsborough/repos", "events_url": "https://api.github.com/users/goldsborough/events{/privacy}", "received_events_url": "https://api.github.com/users/goldsborough/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-05-12T01:52:27Z", "updated_at": "2018-05-15T01:25:02Z", "closed_at": "2018-05-15T01:24:59Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/7517", "html_url": "https://github.com/pytorch/pytorch/pull/7517", "diff_url": "https://github.com/pytorch/pytorch/pull/7517.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/7517.patch"}, "body_html": "<p>After <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"321427397\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/7408\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/7408/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/7408\">#7408</a> made in-place device conversions of C++ modules possible, autogradpp's mechanism of <code>initialize_containers()</code>, <code>initialize_parameters()</code>, <code>reset_parameters()</code> methods became redundant beyond their late-initialization mechanism required by the fact that autogradpp modules are themselves builders (via <code>KWARGS</code>).</p>\n<p>This PR moves the code from <code>initialize_*</code> functions into constructors. For this, I have <strong>temporarily</strong> (!) removed the <code>KWARGS</code>-style builder mechanism in favor of LLVM-style <code>/*comments=*/</code>. This is only until we settle on a preferred construction mechanism. For example, if we choose to stick with <code>KWARGS</code>, we could move the code inside constructors into a single <code>initialize()</code> method.</p>\n<p>The crucial fact is that the code from the <code>initialize_*</code> functions now has the invariant that it is called only once (during construction), which is important irrespective of the construction mechanism we end up using. It allowed me to remove code that was used to keep the functions reentrant (which was required before <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"321427397\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/7408\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/7408/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/7408\">#7408</a>).</p>\n<p>Note that at this point <code>make()</code> has become redundant (it's equivalent to <code>make_shared</code>). I have kept it to keep this PR small. Another PR can in fact remove all uses of <code>make()</code> and instead use value types instead of <code>shared_ptr</code>s to everything.</p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=3605224\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ebetica\">@ebetica</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4583066\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/apaszke\">@apaszke</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=13564\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ezyang\">@ezyang</a></p>", "body_text": "After #7408 made in-place device conversions of C++ modules possible, autogradpp's mechanism of initialize_containers(), initialize_parameters(), reset_parameters() methods became redundant beyond their late-initialization mechanism required by the fact that autogradpp modules are themselves builders (via KWARGS).\nThis PR moves the code from initialize_* functions into constructors. For this, I have temporarily (!) removed the KWARGS-style builder mechanism in favor of LLVM-style /*comments=*/. This is only until we settle on a preferred construction mechanism. For example, if we choose to stick with KWARGS, we could move the code inside constructors into a single initialize() method.\nThe crucial fact is that the code from the initialize_* functions now has the invariant that it is called only once (during construction), which is important irrespective of the construction mechanism we end up using. It allowed me to remove code that was used to keep the functions reentrant (which was required before #7408).\nNote that at this point make() has become redundant (it's equivalent to make_shared). I have kept it to keep this PR small. Another PR can in fact remove all uses of make() and instead use value types instead of shared_ptrs to everything.\n@ebetica @apaszke @ezyang", "body": "After #7408 made in-place device conversions of C++ modules possible, autogradpp's mechanism of `initialize_containers()`, `initialize_parameters()`, `reset_parameters()` methods became redundant beyond their late-initialization mechanism required by the fact that autogradpp modules are themselves builders (via `KWARGS`).\r\n\r\nThis PR moves the code from `initialize_*` functions into constructors. For this, I have __temporarily__ (!) removed the `KWARGS`-style builder mechanism in favor of LLVM-style `/*comments=*/`. This is only until we settle on a preferred construction mechanism. For example, if we choose to stick with `KWARGS`, we could move the code inside constructors into a single `initialize()` method.\r\n\r\nThe crucial fact is that the code from the `initialize_*` functions now has the invariant that it is called only once (during construction), which is important irrespective of the construction mechanism we end up using. It allowed me to remove code that was used to keep the functions reentrant (which was required before #7408).\r\n\r\nNote that at this point `make()` has become redundant (it's equivalent to `make_shared`). I have kept it to keep this PR small. Another PR can in fact remove all uses of `make()` and instead use value types instead of `shared_ptr`s to everything.\r\n\r\n@ebetica @apaszke @ezyang "}