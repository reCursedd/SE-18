{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/4695", "id": 163302607, "node_id": "MDExOlB1bGxSZXF1ZXN0MTYzMzAyNjA3", "html_url": "https://github.com/pytorch/pytorch/pull/4695", "diff_url": "https://github.com/pytorch/pytorch/pull/4695.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/4695.patch", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/4695", "number": 4695, "state": "closed", "locked": false, "title": "Handle sequence lengths correctly when exporting RNNs to ONNX", "user": {"login": "anderspapitto", "id": 1388690, "node_id": "MDQ6VXNlcjEzODg2OTA=", "avatar_url": "https://avatars3.githubusercontent.com/u/1388690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anderspapitto", "html_url": "https://github.com/anderspapitto", "followers_url": "https://api.github.com/users/anderspapitto/followers", "following_url": "https://api.github.com/users/anderspapitto/following{/other_user}", "gists_url": "https://api.github.com/users/anderspapitto/gists{/gist_id}", "starred_url": "https://api.github.com/users/anderspapitto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anderspapitto/subscriptions", "organizations_url": "https://api.github.com/users/anderspapitto/orgs", "repos_url": "https://api.github.com/users/anderspapitto/repos", "events_url": "https://api.github.com/users/anderspapitto/events{/privacy}", "received_events_url": "https://api.github.com/users/anderspapitto/received_events", "type": "User", "site_admin": false}, "body": "PackedSequence: store batch_sizes as tensor rather \r\nthan converting to a list of python integers. This maintains\r\nthe invariant that module's inputs/outputs are collections of\r\nVariables.\r\n\r\nIn particular, this causes the JIT to no longer choke when flattening\r\nand unflattening arguments.\r\n\r\n--------------\r\n\r\n- when uniform sequence lengths are provided, correctly omit the\r\n  argument when constructing the ONNX graph, so as to not fix the\r\n  graph to the batch size.\r\n\r\n- handle PackedSequences by floating them through the graph and\r\n  eliminating them in an optimization pass. ONNX does not have packed\r\n  sequences, but operates on a representation equivalent to\r\n  PaddedSequence, so we hide the representation-switching from ONNX\r\n\r\n- as a preliminary step towards handling PackedSequences, not directly\r\n  tied to ONNX export, change batch_sizes from being an argument to\r\n  the RNN operators into being an argument to the forward() function\r\n  of those RNN operators. This more closely models the reality that\r\n  batch_sizes are effectively part of the input sequences.", "created_at": "2018-01-16T22:22:13Z", "updated_at": "2018-11-23T15:39:16Z", "closed_at": "2018-02-07T02:40:28Z", "merged_at": "2018-02-07T02:40:28Z", "merge_commit_sha": "b2cfd961d3ef63f5dc02e1e0b66756a6297d6f3a", "assignee": null, "assignees": [], "requested_reviewers": [], "requested_teams": [], "labels": [], "milestone": null, "commits_url": "https://api.github.com/repos/pytorch/pytorch/pulls/4695/commits", "review_comments_url": "https://api.github.com/repos/pytorch/pytorch/pulls/4695/comments", "review_comment_url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments{/number}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/4695/comments", "statuses_url": "https://api.github.com/repos/pytorch/pytorch/statuses/c9c0a5924fdbb682f43d1e499db132b5babdba72", "head": {"label": "anderspapitto:no-batch-size", "ref": "no-batch-size", "sha": "c9c0a5924fdbb682f43d1e499db132b5babdba72", "user": {"login": "anderspapitto", "id": 1388690, "node_id": "MDQ6VXNlcjEzODg2OTA=", "avatar_url": "https://avatars3.githubusercontent.com/u/1388690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anderspapitto", "html_url": "https://github.com/anderspapitto", "followers_url": "https://api.github.com/users/anderspapitto/followers", "following_url": "https://api.github.com/users/anderspapitto/following{/other_user}", "gists_url": "https://api.github.com/users/anderspapitto/gists{/gist_id}", "starred_url": "https://api.github.com/users/anderspapitto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anderspapitto/subscriptions", "organizations_url": "https://api.github.com/users/anderspapitto/orgs", "repos_url": "https://api.github.com/users/anderspapitto/repos", "events_url": "https://api.github.com/users/anderspapitto/events{/privacy}", "received_events_url": "https://api.github.com/users/anderspapitto/received_events", "type": "User", "site_admin": false}, "repo": {"id": 108888522, "node_id": "MDEwOlJlcG9zaXRvcnkxMDg4ODg1MjI=", "name": "pytorch", "full_name": "anderspapitto/pytorch", "private": false, "owner": {"login": "anderspapitto", "id": 1388690, "node_id": "MDQ6VXNlcjEzODg2OTA=", "avatar_url": "https://avatars3.githubusercontent.com/u/1388690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anderspapitto", "html_url": "https://github.com/anderspapitto", "followers_url": "https://api.github.com/users/anderspapitto/followers", "following_url": "https://api.github.com/users/anderspapitto/following{/other_user}", "gists_url": "https://api.github.com/users/anderspapitto/gists{/gist_id}", "starred_url": "https://api.github.com/users/anderspapitto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anderspapitto/subscriptions", "organizations_url": "https://api.github.com/users/anderspapitto/orgs", "repos_url": "https://api.github.com/users/anderspapitto/repos", "events_url": "https://api.github.com/users/anderspapitto/events{/privacy}", "received_events_url": "https://api.github.com/users/anderspapitto/received_events", "type": "User", "site_admin": false}, "html_url": "https://github.com/anderspapitto/pytorch", "description": "Tensors and Dynamic neural networks in Python  with strong GPU acceleration", "fork": true, "url": "https://api.github.com/repos/anderspapitto/pytorch", "forks_url": "https://api.github.com/repos/anderspapitto/pytorch/forks", "keys_url": "https://api.github.com/repos/anderspapitto/pytorch/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/anderspapitto/pytorch/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/anderspapitto/pytorch/teams", "hooks_url": "https://api.github.com/repos/anderspapitto/pytorch/hooks", "issue_events_url": "https://api.github.com/repos/anderspapitto/pytorch/issues/events{/number}", "events_url": "https://api.github.com/repos/anderspapitto/pytorch/events", "assignees_url": "https://api.github.com/repos/anderspapitto/pytorch/assignees{/user}", "branches_url": "https://api.github.com/repos/anderspapitto/pytorch/branches{/branch}", "tags_url": "https://api.github.com/repos/anderspapitto/pytorch/tags", "blobs_url": "https://api.github.com/repos/anderspapitto/pytorch/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/anderspapitto/pytorch/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/anderspapitto/pytorch/git/refs{/sha}", "trees_url": "https://api.github.com/repos/anderspapitto/pytorch/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/anderspapitto/pytorch/statuses/{sha}", "languages_url": "https://api.github.com/repos/anderspapitto/pytorch/languages", "stargazers_url": "https://api.github.com/repos/anderspapitto/pytorch/stargazers", "contributors_url": "https://api.github.com/repos/anderspapitto/pytorch/contributors", "subscribers_url": "https://api.github.com/repos/anderspapitto/pytorch/subscribers", "subscription_url": "https://api.github.com/repos/anderspapitto/pytorch/subscription", "commits_url": "https://api.github.com/repos/anderspapitto/pytorch/commits{/sha}", "git_commits_url": "https://api.github.com/repos/anderspapitto/pytorch/git/commits{/sha}", "comments_url": "https://api.github.com/repos/anderspapitto/pytorch/comments{/number}", "issue_comment_url": "https://api.github.com/repos/anderspapitto/pytorch/issues/comments{/number}", "contents_url": "https://api.github.com/repos/anderspapitto/pytorch/contents/{+path}", "compare_url": "https://api.github.com/repos/anderspapitto/pytorch/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/anderspapitto/pytorch/merges", "archive_url": "https://api.github.com/repos/anderspapitto/pytorch/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/anderspapitto/pytorch/downloads", "issues_url": "https://api.github.com/repos/anderspapitto/pytorch/issues{/number}", "pulls_url": "https://api.github.com/repos/anderspapitto/pytorch/pulls{/number}", "milestones_url": "https://api.github.com/repos/anderspapitto/pytorch/milestones{/number}", "notifications_url": "https://api.github.com/repos/anderspapitto/pytorch/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/anderspapitto/pytorch/labels{/name}", "releases_url": "https://api.github.com/repos/anderspapitto/pytorch/releases{/id}", "deployments_url": "https://api.github.com/repos/anderspapitto/pytorch/deployments", "created_at": "2017-10-30T18:01:07Z", "updated_at": "2018-11-02T18:38:40Z", "pushed_at": "2018-11-20T19:32:13Z", "git_url": "git://github.com/anderspapitto/pytorch.git", "ssh_url": "git@github.com:anderspapitto/pytorch.git", "clone_url": "https://github.com/anderspapitto/pytorch.git", "svn_url": "https://github.com/anderspapitto/pytorch", "homepage": "http://pytorch.org", "size": 85653, "stargazers_count": 0, "watchers_count": 0, "language": "C++", "has_issues": false, "has_projects": true, "has_downloads": true, "has_wiki": true, "has_pages": false, "forks_count": 0, "mirror_url": null, "archived": false, "open_issues_count": 0, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "forks": 0, "open_issues": 0, "watchers": 0, "default_branch": "master"}}, "base": {"label": "pytorch:master", "ref": "master", "sha": "895aebac089c2faa438db24e9db27ddacfb08198", "user": {"login": "pytorch", "id": 21003710, "node_id": "MDEyOk9yZ2FuaXphdGlvbjIxMDAzNzEw", "avatar_url": "https://avatars3.githubusercontent.com/u/21003710?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pytorch", "html_url": "https://github.com/pytorch", "followers_url": "https://api.github.com/users/pytorch/followers", "following_url": "https://api.github.com/users/pytorch/following{/other_user}", "gists_url": "https://api.github.com/users/pytorch/gists{/gist_id}", "starred_url": "https://api.github.com/users/pytorch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pytorch/subscriptions", "organizations_url": "https://api.github.com/users/pytorch/orgs", "repos_url": "https://api.github.com/users/pytorch/repos", "events_url": "https://api.github.com/users/pytorch/events{/privacy}", "received_events_url": "https://api.github.com/users/pytorch/received_events", "type": "Organization", "site_admin": false}, "repo": {"id": 65600975, "node_id": "MDEwOlJlcG9zaXRvcnk2NTYwMDk3NQ==", "name": "pytorch", "full_name": "pytorch/pytorch", "private": false, "owner": {"login": "pytorch", "id": 21003710, "node_id": "MDEyOk9yZ2FuaXphdGlvbjIxMDAzNzEw", "avatar_url": "https://avatars3.githubusercontent.com/u/21003710?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pytorch", "html_url": "https://github.com/pytorch", "followers_url": "https://api.github.com/users/pytorch/followers", "following_url": "https://api.github.com/users/pytorch/following{/other_user}", "gists_url": "https://api.github.com/users/pytorch/gists{/gist_id}", "starred_url": "https://api.github.com/users/pytorch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pytorch/subscriptions", "organizations_url": "https://api.github.com/users/pytorch/orgs", "repos_url": "https://api.github.com/users/pytorch/repos", "events_url": "https://api.github.com/users/pytorch/events{/privacy}", "received_events_url": "https://api.github.com/users/pytorch/received_events", "type": "Organization", "site_admin": false}, "html_url": "https://github.com/pytorch/pytorch", "description": "Tensors and Dynamic neural networks in Python  with strong GPU acceleration", "fork": false, "url": "https://api.github.com/repos/pytorch/pytorch", "forks_url": "https://api.github.com/repos/pytorch/pytorch/forks", "keys_url": "https://api.github.com/repos/pytorch/pytorch/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/pytorch/pytorch/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/pytorch/pytorch/teams", "hooks_url": "https://api.github.com/repos/pytorch/pytorch/hooks", "issue_events_url": "https://api.github.com/repos/pytorch/pytorch/issues/events{/number}", "events_url": "https://api.github.com/repos/pytorch/pytorch/events", "assignees_url": "https://api.github.com/repos/pytorch/pytorch/assignees{/user}", "branches_url": "https://api.github.com/repos/pytorch/pytorch/branches{/branch}", "tags_url": "https://api.github.com/repos/pytorch/pytorch/tags", "blobs_url": "https://api.github.com/repos/pytorch/pytorch/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/pytorch/pytorch/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/pytorch/pytorch/git/refs{/sha}", "trees_url": "https://api.github.com/repos/pytorch/pytorch/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/pytorch/pytorch/statuses/{sha}", "languages_url": "https://api.github.com/repos/pytorch/pytorch/languages", "stargazers_url": "https://api.github.com/repos/pytorch/pytorch/stargazers", "contributors_url": "https://api.github.com/repos/pytorch/pytorch/contributors", "subscribers_url": "https://api.github.com/repos/pytorch/pytorch/subscribers", "subscription_url": "https://api.github.com/repos/pytorch/pytorch/subscription", "commits_url": "https://api.github.com/repos/pytorch/pytorch/commits{/sha}", "git_commits_url": "https://api.github.com/repos/pytorch/pytorch/git/commits{/sha}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/comments{/number}", "issue_comment_url": "https://api.github.com/repos/pytorch/pytorch/issues/comments{/number}", "contents_url": "https://api.github.com/repos/pytorch/pytorch/contents/{+path}", "compare_url": "https://api.github.com/repos/pytorch/pytorch/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/pytorch/pytorch/merges", "archive_url": "https://api.github.com/repos/pytorch/pytorch/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/pytorch/pytorch/downloads", "issues_url": "https://api.github.com/repos/pytorch/pytorch/issues{/number}", "pulls_url": "https://api.github.com/repos/pytorch/pytorch/pulls{/number}", "milestones_url": "https://api.github.com/repos/pytorch/pytorch/milestones{/number}", "notifications_url": "https://api.github.com/repos/pytorch/pytorch/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/pytorch/pytorch/labels{/name}", "releases_url": "https://api.github.com/repos/pytorch/pytorch/releases{/id}", "deployments_url": "https://api.github.com/repos/pytorch/pytorch/deployments", "created_at": "2016-08-13T05:26:41Z", "updated_at": "2018-11-24T05:35:41Z", "pushed_at": "2018-11-24T05:34:07Z", "git_url": "git://github.com/pytorch/pytorch.git", "ssh_url": "git@github.com:pytorch/pytorch.git", "clone_url": "https://github.com/pytorch/pytorch.git", "svn_url": "https://github.com/pytorch/pytorch", "homepage": "http://pytorch.org", "size": 89651, "stargazers_count": 21577, "watchers_count": 21577, "language": "C++", "has_issues": true, "has_projects": true, "has_downloads": true, "has_wiki": true, "has_pages": false, "forks_count": 5149, "mirror_url": null, "archived": false, "open_issues_count": 2193, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "forks": 5149, "open_issues": 2193, "watchers": 21577, "default_branch": "master"}}, "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/4695"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/4695"}, "issue": {"href": "https://api.github.com/repos/pytorch/pytorch/issues/4695"}, "comments": {"href": "https://api.github.com/repos/pytorch/pytorch/issues/4695/comments"}, "review_comments": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/4695/comments"}, "review_comment": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments{/number}"}, "commits": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/4695/commits"}, "statuses": {"href": "https://api.github.com/repos/pytorch/pytorch/statuses/c9c0a5924fdbb682f43d1e499db132b5babdba72"}}, "author_association": "MEMBER", "body_html": "<p>PackedSequence: store batch_sizes as tensor rather<br>\nthan converting to a list of python integers. This maintains<br>\nthe invariant that module's inputs/outputs are collections of<br>\nVariables.</p>\n<p>In particular, this causes the JIT to no longer choke when flattening<br>\nand unflattening arguments.</p>\n<hr>\n<ul>\n<li>\n<p>when uniform sequence lengths are provided, correctly omit the<br>\nargument when constructing the ONNX graph, so as to not fix the<br>\ngraph to the batch size.</p>\n</li>\n<li>\n<p>handle PackedSequences by floating them through the graph and<br>\neliminating them in an optimization pass. ONNX does not have packed<br>\nsequences, but operates on a representation equivalent to<br>\nPaddedSequence, so we hide the representation-switching from ONNX</p>\n</li>\n<li>\n<p>as a preliminary step towards handling PackedSequences, not directly<br>\ntied to ONNX export, change batch_sizes from being an argument to<br>\nthe RNN operators into being an argument to the forward() function<br>\nof those RNN operators. This more closely models the reality that<br>\nbatch_sizes are effectively part of the input sequences.</p>\n</li>\n</ul>", "body_text": "PackedSequence: store batch_sizes as tensor rather\nthan converting to a list of python integers. This maintains\nthe invariant that module's inputs/outputs are collections of\nVariables.\nIn particular, this causes the JIT to no longer choke when flattening\nand unflattening arguments.\n\n\n\nwhen uniform sequence lengths are provided, correctly omit the\nargument when constructing the ONNX graph, so as to not fix the\ngraph to the batch size.\n\n\nhandle PackedSequences by floating them through the graph and\neliminating them in an optimization pass. ONNX does not have packed\nsequences, but operates on a representation equivalent to\nPaddedSequence, so we hide the representation-switching from ONNX\n\n\nas a preliminary step towards handling PackedSequences, not directly\ntied to ONNX export, change batch_sizes from being an argument to\nthe RNN operators into being an argument to the forward() function\nof those RNN operators. This more closely models the reality that\nbatch_sizes are effectively part of the input sequences.", "merged": true, "mergeable": null, "rebaseable": null, "mergeable_state": "unknown", "merged_by": {"login": "soumith", "id": 1310570, "node_id": "MDQ6VXNlcjEzMTA1NzA=", "avatar_url": "https://avatars0.githubusercontent.com/u/1310570?v=4", "gravatar_id": "", "url": "https://api.github.com/users/soumith", "html_url": "https://github.com/soumith", "followers_url": "https://api.github.com/users/soumith/followers", "following_url": "https://api.github.com/users/soumith/following{/other_user}", "gists_url": "https://api.github.com/users/soumith/gists{/gist_id}", "starred_url": "https://api.github.com/users/soumith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/soumith/subscriptions", "organizations_url": "https://api.github.com/users/soumith/orgs", "repos_url": "https://api.github.com/users/soumith/repos", "events_url": "https://api.github.com/users/soumith/events{/privacy}", "received_events_url": "https://api.github.com/users/soumith/received_events", "type": "User", "site_admin": false}, "comments": 13, "review_comments": 91, "maintainer_can_modify": false, "commits": 2, "additions": 259, "deletions": 113, "changed_files": 11}