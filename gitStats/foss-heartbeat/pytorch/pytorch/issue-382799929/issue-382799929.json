{"url": "https://api.github.com/repos/pytorch/pytorch/issues/14234", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/14234/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/14234/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/14234/events", "html_url": "https://github.com/pytorch/pytorch/issues/14234", "id": 382799929, "node_id": "MDU6SXNzdWUzODI3OTk5Mjk=", "number": 14234, "title": "Consider not generating DeviceGuard wrappers automatically", "user": {"login": "ezyang", "id": 13564, "node_id": "MDQ6VXNlcjEzNTY0", "avatar_url": "https://avatars0.githubusercontent.com/u/13564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ezyang", "html_url": "https://github.com/ezyang", "followers_url": "https://api.github.com/users/ezyang/followers", "following_url": "https://api.github.com/users/ezyang/following{/other_user}", "gists_url": "https://api.github.com/users/ezyang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ezyang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ezyang/subscriptions", "organizations_url": "https://api.github.com/users/ezyang/orgs", "repos_url": "https://api.github.com/users/ezyang/repos", "events_url": "https://api.github.com/users/ezyang/events{/privacy}", "received_events_url": "https://api.github.com/users/ezyang/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-11-20T18:45:46Z", "updated_at": "2018-11-20T19:11:03Z", "closed_at": null, "author_association": "CONTRIBUTOR", "body_html": "<p>By default, ATen code generation will generate a DeviceGuard invocation,<br>\nwhich will ensure that kernel code will run with the current device set<br>\nto match the device of the first Tensor argument (or first tensor of<br>\nthe first TensorList argument, if the function takes a list of tensors).<br>\nFor the most part, this means kernel authors do not have to worry about<br>\nsetting devices.</p>\n<p>However, this means that sometimes we spend a lot of time uselessly setting device guards when it's unnecessary, as <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=5652049\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/zou3519\">@zou3519</a> discovered while doing performance optimizations in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"373523929\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/13049\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/13049/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/13049\">#13049</a>. So maybe it is better to NOT do device guards by default, and force kernel writers to only set it when necessary. We will have to be careful about this because it is very easy to forget to set device guards, and you won't notice unless you run the kernel on not device 0.</p>", "body_text": "By default, ATen code generation will generate a DeviceGuard invocation,\nwhich will ensure that kernel code will run with the current device set\nto match the device of the first Tensor argument (or first tensor of\nthe first TensorList argument, if the function takes a list of tensors).\nFor the most part, this means kernel authors do not have to worry about\nsetting devices.\nHowever, this means that sometimes we spend a lot of time uselessly setting device guards when it's unnecessary, as @zou3519 discovered while doing performance optimizations in #13049. So maybe it is better to NOT do device guards by default, and force kernel writers to only set it when necessary. We will have to be careful about this because it is very easy to forget to set device guards, and you won't notice unless you run the kernel on not device 0.", "body": "By default, ATen code generation will generate a DeviceGuard invocation,\r\nwhich will ensure that kernel code will run with the current device set\r\nto match the device of the first Tensor argument (or first tensor of\r\nthe first TensorList argument, if the function takes a list of tensors).\r\nFor the most part, this means kernel authors do not have to worry about\r\nsetting devices.\r\n\r\nHowever, this means that sometimes we spend a lot of time uselessly setting device guards when it's unnecessary, as @zou3519 discovered while doing performance optimizations in #13049. So maybe it is better to NOT do device guards by default, and force kernel writers to only set it when necessary. We will have to be careful about this because it is very easy to forget to set device guards, and you won't notice unless you run the kernel on not device 0."}