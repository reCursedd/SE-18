{"url": "https://api.github.com/repos/pytorch/pytorch/issues/4035", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/4035/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/4035/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/4035/events", "html_url": "https://github.com/pytorch/pytorch/pull/4035", "id": 279463442, "node_id": "MDExOlB1bGxSZXF1ZXN0MTU2NTI2NzYy", "number": 4035, "title": "Implement NLLLossNd", "user": {"login": "zou3519", "id": 5652049, "node_id": "MDQ6VXNlcjU2NTIwNDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/5652049?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zou3519", "html_url": "https://github.com/zou3519", "followers_url": "https://api.github.com/users/zou3519/followers", "following_url": "https://api.github.com/users/zou3519/following{/other_user}", "gists_url": "https://api.github.com/users/zou3519/gists{/gist_id}", "starred_url": "https://api.github.com/users/zou3519/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zou3519/subscriptions", "organizations_url": "https://api.github.com/users/zou3519/orgs", "repos_url": "https://api.github.com/users/zou3519/repos", "events_url": "https://api.github.com/users/zou3519/events{/privacy}", "received_events_url": "https://api.github.com/users/zou3519/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 825466279, "node_id": "MDU6TGFiZWw4MjU0NjYyNzk=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/0.3.1", "name": "0.3.1", "color": "aefcae", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-12-05T17:31:50Z", "updated_at": "2018-11-23T15:37:07Z", "closed_at": "2017-12-18T07:16:17Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/4035", "html_url": "https://github.com/pytorch/pytorch/pull/4035", "diff_url": "https://github.com/pytorch/pytorch/pull/4035.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/4035.patch"}, "body_html": "<p>Needed for <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"272024539\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/3556\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/3556/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/3556\">#3556</a></p>\n<p>I'm not sure this is the best way to implement because the <code>.contiguous()</code> calls might be slow.</p>\n<p>One alternative way to implement this is to copy and modify gather. Without any of the extra keyword modifiers, with <code>reduce=False</code>, the following is equivalent to NLLLossNd:</p>\n<pre><code>def nlllossNd(input, target):\n    target = target.unsqueeze(1)\n    out = torch.gather(input, 1, target)\n    return out.squeeze(1)\n</code></pre>\n<p>I tried benchmarking this against what I have right now (this diff that uses <code>.contiguous()</code> calls and NLLLoss2d) and using gather is around 2x slower, even for non-contiguous inputs, so I went with this approach.</p>\n<h3>Test Plan</h3>\n<p>Unit tests for NLLLossNd with a NLLLossNd reference function</p>", "body_text": "Needed for #3556\nI'm not sure this is the best way to implement because the .contiguous() calls might be slow.\nOne alternative way to implement this is to copy and modify gather. Without any of the extra keyword modifiers, with reduce=False, the following is equivalent to NLLLossNd:\ndef nlllossNd(input, target):\n    target = target.unsqueeze(1)\n    out = torch.gather(input, 1, target)\n    return out.squeeze(1)\n\nI tried benchmarking this against what I have right now (this diff that uses .contiguous() calls and NLLLoss2d) and using gather is around 2x slower, even for non-contiguous inputs, so I went with this approach.\nTest Plan\nUnit tests for NLLLossNd with a NLLLossNd reference function", "body": "Needed for #3556\r\n\r\nI'm not sure this is the best way to implement because the `.contiguous()` calls might be slow. \r\n\r\nOne alternative way to implement this is to copy and modify gather. Without any of the extra keyword modifiers, with `reduce=False`, the following is equivalent to NLLLossNd:\r\n```\r\ndef nlllossNd(input, target):\r\n    target = target.unsqueeze(1)\r\n    out = torch.gather(input, 1, target)\r\n    return out.squeeze(1)\r\n```\r\nI tried benchmarking this against what I have right now (this diff that uses `.contiguous()` calls and NLLLoss2d) and using gather is around 2x slower, even for non-contiguous inputs, so I went with this approach.\r\n\r\n### Test Plan\r\nUnit tests for NLLLossNd with a NLLLossNd reference function"}