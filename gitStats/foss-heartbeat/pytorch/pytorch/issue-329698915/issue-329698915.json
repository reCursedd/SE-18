{"url": "https://api.github.com/repos/pytorch/pytorch/issues/8184", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/8184/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/8184/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/8184/events", "html_url": "https://github.com/pytorch/pytorch/pull/8184", "id": 329698915, "node_id": "MDExOlB1bGxSZXF1ZXN0MTkyODkxNDM3", "number": 8184, "title": "Fix protobuf options", "user": {"login": "bstriner", "id": 12462956, "node_id": "MDQ6VXNlcjEyNDYyOTU2", "avatar_url": "https://avatars3.githubusercontent.com/u/12462956?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bstriner", "html_url": "https://github.com/bstriner", "followers_url": "https://api.github.com/users/bstriner/followers", "following_url": "https://api.github.com/users/bstriner/following{/other_user}", "gists_url": "https://api.github.com/users/bstriner/gists{/gist_id}", "starred_url": "https://api.github.com/users/bstriner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bstriner/subscriptions", "organizations_url": "https://api.github.com/users/bstriner/orgs", "repos_url": "https://api.github.com/users/bstriner/repos", "events_url": "https://api.github.com/users/bstriner/events{/privacy}", "received_events_url": "https://api.github.com/users/bstriner/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-06-06T03:37:11Z", "updated_at": "2018-06-06T21:09:12Z", "closed_at": "2018-06-06T05:43:06Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/8184", "html_url": "https://github.com/pytorch/pytorch/pull/8184", "diff_url": "https://github.com/pytorch/pytorch/pull/8184.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/8184.patch"}, "body_html": "<p><code>protobuf_BUILD_SHARED_LIBS</code> and <code>protobuf_MSVC_STATIC_RUNTIME</code> are set in <code>ProtoBuf.cmake</code> as regular variables which are wiped out when the library itself declares them as options. This means these values don't propagate to protobuf, so protobuf is building me a static runtime, which then fails when caffe2 tries to link:</p>\n<p>libprotobuf.lib(io_win32.obj) : error LNK2038: mismatch detected for 'RuntimeLibrary': value 'MT_StaticRelease' doesn't match value 'MD_DynamicRelease' in Backtrace.obj [D:\\Projects\\pytorchtest\\pytorch\\build\\caffe2\\caffe2.vcxproj]</p>\n<p>This PR passes them as options, just like <code>protobuf_BUILD_TESTS</code> and <code>protobuf_BUILD_EXAMPLES</code> earlier in that file.</p>\n<p>No idea why this isn't failing on CI, but maybe only specific versions of cmake have this issue. I'm seeing this on 3.8 (I know I should update).</p>\n<p>Cheers</p>", "body_text": "protobuf_BUILD_SHARED_LIBS and protobuf_MSVC_STATIC_RUNTIME are set in ProtoBuf.cmake as regular variables which are wiped out when the library itself declares them as options. This means these values don't propagate to protobuf, so protobuf is building me a static runtime, which then fails when caffe2 tries to link:\nlibprotobuf.lib(io_win32.obj) : error LNK2038: mismatch detected for 'RuntimeLibrary': value 'MT_StaticRelease' doesn't match value 'MD_DynamicRelease' in Backtrace.obj [D:\\Projects\\pytorchtest\\pytorch\\build\\caffe2\\caffe2.vcxproj]\nThis PR passes them as options, just like protobuf_BUILD_TESTS and protobuf_BUILD_EXAMPLES earlier in that file.\nNo idea why this isn't failing on CI, but maybe only specific versions of cmake have this issue. I'm seeing this on 3.8 (I know I should update).\nCheers", "body": "`protobuf_BUILD_SHARED_LIBS` and `protobuf_MSVC_STATIC_RUNTIME` are set in `ProtoBuf.cmake` as regular variables which are wiped out when the library itself declares them as options. This means these values don't propagate to protobuf, so protobuf is building me a static runtime, which then fails when caffe2 tries to link:\r\n\r\nlibprotobuf.lib(io_win32.obj) : error LNK2038: mismatch detected for 'RuntimeLibrary': value 'MT_StaticRelease' doesn't match value 'MD_DynamicRelease' in Backtrace.obj [D:\\Projects\\pytorchtest\\pytorch\\build\\caffe2\\caffe2.vcxproj]\r\n\r\nThis PR passes them as options, just like `protobuf_BUILD_TESTS` and `protobuf_BUILD_EXAMPLES` earlier in that file.\r\n\r\nNo idea why this isn't failing on CI, but maybe only specific versions of cmake have this issue. I'm seeing this on 3.8 (I know I should update).\r\n\r\nCheers"}