{"url": "https://api.github.com/repos/pytorch/pytorch/issues/11048", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/11048/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/11048/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/11048/events", "html_url": "https://github.com/pytorch/pytorch/pull/11048", "id": 355378406, "node_id": "MDExOlB1bGxSZXF1ZXN0MjExOTIyNDI5", "number": 11048, "title": "Kill the dummy TaskOutput when task.get_step() (#10739)", "user": {"login": "xsh6528", "id": 7608630, "node_id": "MDQ6VXNlcjc2MDg2MzA=", "avatar_url": "https://avatars2.githubusercontent.com/u/7608630?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xsh6528", "html_url": "https://github.com/xsh6528", "followers_url": "https://api.github.com/users/xsh6528/followers", "following_url": "https://api.github.com/users/xsh6528/following{/other_user}", "gists_url": "https://api.github.com/users/xsh6528/gists{/gist_id}", "starred_url": "https://api.github.com/users/xsh6528/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xsh6528/subscriptions", "organizations_url": "https://api.github.com/users/xsh6528/orgs", "repos_url": "https://api.github.com/users/xsh6528/repos", "events_url": "https://api.github.com/users/xsh6528/events{/privacy}", "received_events_url": "https://api.github.com/users/xsh6528/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-08-30T00:17:09Z", "updated_at": "2018-08-30T03:12:20Z", "closed_at": "2018-08-30T03:12:20Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/11048", "html_url": "https://github.com/pytorch/pytorch/pull/11048", "diff_url": "https://github.com/pytorch/pytorch/pull/11048.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/11048.patch"}, "body_html": "<p>Summary:<br>\nPull Request <span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes pull request #10739.\">resolved</span>: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"352640066\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/10739\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/10739/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/10739\">#10739</a></p>\n<p>I wanted to assert that the blobs in the workspace of the new session after loading checkpoint are exactly the same as the blobs in the workspace of the old session before saving to a checkpoint.</p>\n<p>But I found that when calling <code>task.get_step()</code>, a dummy task output blob, <code>task:output/ConstIntFill:0</code>, is added. Also a dummy net <code>task:output</code> was also added along with it. See <a href=\"https://fburl.com/937lf2yk\" rel=\"nofollow\">https://fburl.com/937lf2yk</a></p>\n<p>This makes it hard to assert \"Equal\", forcing me to assert \"LessThan\" or \"GreaterThan\".</p>\n<p>This adding a dummy TaskOutput when user specifies no TaskOutput is a hack.<br>\nThe reason for this is that ZMQ socket can't send empty blob list.<br>\nAs a result, if the Task on the Worker had no output,<br>\nThe master would never stop waiting and hang forever. See <a href=\"https://fburl.com/rd7fhy6p\" rel=\"nofollow\">https://fburl.com/rd7fhy6p</a> and imagine <code>socket.recv(net, 0)</code>.</p>\n<p>TaskOuput is at user layer. The hack shouldn't be exposed to user layer, polluting user workspaces.</p>\n<p>Instead, we should move the creating of the dummy blob to some deeper layer,<br>\nand remove the dummy blob in the workspace afterwards to avoid polluting user workspaces.<br>\nAfter this change, the workaround becomes totally transparent and no side-effect to users.</p>\n<p>Differential Revision: D9566744</p>", "body_text": "Summary:\nPull Request resolved: #10739\nI wanted to assert that the blobs in the workspace of the new session after loading checkpoint are exactly the same as the blobs in the workspace of the old session before saving to a checkpoint.\nBut I found that when calling task.get_step(), a dummy task output blob, task:output/ConstIntFill:0, is added. Also a dummy net task:output was also added along with it. See https://fburl.com/937lf2yk\nThis makes it hard to assert \"Equal\", forcing me to assert \"LessThan\" or \"GreaterThan\".\nThis adding a dummy TaskOutput when user specifies no TaskOutput is a hack.\nThe reason for this is that ZMQ socket can't send empty blob list.\nAs a result, if the Task on the Worker had no output,\nThe master would never stop waiting and hang forever. See https://fburl.com/rd7fhy6p and imagine socket.recv(net, 0).\nTaskOuput is at user layer. The hack shouldn't be exposed to user layer, polluting user workspaces.\nInstead, we should move the creating of the dummy blob to some deeper layer,\nand remove the dummy blob in the workspace afterwards to avoid polluting user workspaces.\nAfter this change, the workaround becomes totally transparent and no side-effect to users.\nDifferential Revision: D9566744", "body": "Summary:\nPull Request resolved: https://github.com/pytorch/pytorch/pull/10739\n\nI wanted to assert that the blobs in the workspace of the new session after loading checkpoint are exactly the same as the blobs in the workspace of the old session before saving to a checkpoint.\n\nBut I found that when calling `task.get_step()`, a dummy task output blob, `task:output/ConstIntFill:0`, is added. Also a dummy net `task:output` was also added along with it. See https://fburl.com/937lf2yk\n\nThis makes it hard to assert \"Equal\", forcing me to assert \"LessThan\" or \"GreaterThan\".\n\nThis adding a dummy TaskOutput when user specifies no TaskOutput is a hack.\nThe reason for this is that ZMQ socket can't send empty blob list.\nAs a result, if the Task on the Worker had no output,\nThe master would never stop waiting and hang forever. See https://fburl.com/rd7fhy6p and imagine `socket.recv(net, 0)`.\n\nTaskOuput is at user layer. The hack shouldn't be exposed to user layer, polluting user workspaces.\n\nInstead, we should move the creating of the dummy blob to some deeper layer,\nand remove the dummy blob in the workspace afterwards to avoid polluting user workspaces.\nAfter this change, the workaround becomes totally transparent and no side-effect to users.\n\nDifferential Revision: D9566744\n"}