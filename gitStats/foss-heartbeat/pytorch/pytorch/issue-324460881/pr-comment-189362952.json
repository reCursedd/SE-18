{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/189362952", "pull_request_review_id": 121534124, "id": 189362952, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4OTM2Mjk1Mg==", "diff_hunk": "@@ -2266,6 +2266,30 @@ def test_set_requires_grad_only_for_floats_cuda(self):\n     def test_set_requires_grad_only_for_floats(self):\n         self._test_set_requires_grad_only_for_floats(self, False)\n \n+    def test_anomaly_detect_nan(self):\n+\n+        class MyFunc(Function):\n+            @staticmethod\n+            def forward(ctx, inp):\n+                return inp.sum(0, keepdim=True)\n+\n+            @staticmethod\n+            def backward(ctx, gO):\n+                gI = gO.clone()\n+                gI[0] = 0\n+                gI[0] /= 0  # Generate a nan\n+                return gI.expand_as(gO)\n+\n+        inp = torch.rand(10, requires_grad=True)\n+        out = MyFunc.apply(inp)\n+        out.backward()  # Should not fail\n+\n+        inp = torch.rand(10, requires_grad=True)\n+        out = MyFunc.apply(inp)\n+        with self.assertRaises(RuntimeError):\n+            with detect_anomaly():\n+                out.backward()", "path": "test/test_autograd.py", "position": null, "original_position": 35, "commit_id": "ff608fec1da7f98b52ff290917865e6fd6fa8ec0", "original_commit_id": "312e4ab87895811bdef0eb71cc9dfdaa9df71e9c", "user": {"login": "gchanan", "id": 3768583, "node_id": "MDQ6VXNlcjM3Njg1ODM=", "avatar_url": "https://avatars2.githubusercontent.com/u/3768583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gchanan", "html_url": "https://github.com/gchanan", "followers_url": "https://api.github.com/users/gchanan/followers", "following_url": "https://api.github.com/users/gchanan/following{/other_user}", "gists_url": "https://api.github.com/users/gchanan/gists{/gist_id}", "starred_url": "https://api.github.com/users/gchanan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gchanan/subscriptions", "organizations_url": "https://api.github.com/users/gchanan/orgs", "repos_url": "https://api.github.com/users/gchanan/repos", "events_url": "https://api.github.com/users/gchanan/events{/privacy}", "received_events_url": "https://api.github.com/users/gchanan/received_events", "type": "User", "site_admin": false}, "body": "nit: maybe check something about the error message?", "created_at": "2018-05-18T18:54:00Z", "updated_at": "2018-11-23T15:44:16Z", "html_url": "https://github.com/pytorch/pytorch/pull/7677#discussion_r189362952", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/7677", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/189362952"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/7677#discussion_r189362952"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/7677"}}, "body_html": "<p>nit: maybe check something about the error message?</p>", "body_text": "nit: maybe check something about the error message?"}