{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/407179946", "html_url": "https://github.com/pytorch/pytorch/issues/9580#issuecomment-407179946", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/9580", "id": 407179946, "node_id": "MDEyOklzc3VlQ29tbWVudDQwNzE3OTk0Ng==", "user": {"login": "sadatnfs", "id": 19790145, "node_id": "MDQ6VXNlcjE5NzkwMTQ1", "avatar_url": "https://avatars2.githubusercontent.com/u/19790145?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sadatnfs", "html_url": "https://github.com/sadatnfs", "followers_url": "https://api.github.com/users/sadatnfs/followers", "following_url": "https://api.github.com/users/sadatnfs/following{/other_user}", "gists_url": "https://api.github.com/users/sadatnfs/gists{/gist_id}", "starred_url": "https://api.github.com/users/sadatnfs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sadatnfs/subscriptions", "organizations_url": "https://api.github.com/users/sadatnfs/orgs", "repos_url": "https://api.github.com/users/sadatnfs/repos", "events_url": "https://api.github.com/users/sadatnfs/events{/privacy}", "received_events_url": "https://api.github.com/users/sadatnfs/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-23T19:52:24Z", "updated_at": "2018-07-23T19:52:24Z", "author_association": "NONE", "body_html": "<p>Still breaking (trace below):</p>\n<p>This is how I built my MKL DNN btw in my Docker:</p>\n<pre><code>## Build MKL-DNN\nRUN cd /opt &amp;&amp; \\\n    git clone https://github.com/intel/mkl-dnn.git &amp;&amp; \\\n    cd /opt/mkl-dnn &amp;&amp; \\\n    mkdir -p build &amp;&amp; cd build &amp;&amp; \\\n    cmake  .. &amp;&amp; make &amp;&amp; make install &amp;&amp; \\\n    cd .. &amp;&amp; rm -rf build \n\n## Nuke repo, set ENV and redo ldconfig\nRUN sudo update-alternatives --install /usr/lib/libmkldnn.so libmkldnn.so /usr/local/lib/libmkldnn.so 40 &amp;&amp; \\\n    sudo ldconfig\n</code></pre>\n<p>error trace for Caffe2:</p>\n<pre><code>\n[ 84%] Linking CXX shared library ../lib/libcaffe2.so\n[ 85%] Built target caffe2\nScanning dependencies of target verify_api_visibility\nScanning dependencies of target tbb_init_test\nScanning dependencies of target weakref_test\nScanning dependencies of target native_test\nScanning dependencies of target dlconvertor_test\nScanning dependencies of target wrapdim_test\nScanning dependencies of target scalar_tensor_test\nScanning dependencies of target undefined_tensor_test\n[ 85%] Building CXX object caffe2/CMakeFiles/dlconvertor_test.dir/__/aten/src/ATen/test/dlconvertor_test.cpp.o\n[ 85%] Building CXX object caffe2/CMakeFiles/verify_api_visibility.dir/__/aten/src/ATen/test/verify_api_visibility.cpp.o\n[ 85%] Building CXX object caffe2/CMakeFiles/weakref_test.dir/__/aten/src/ATen/test/weakref_test.cpp.o\n[ 85%] Building CXX object caffe2/CMakeFiles/native_test.dir/__/aten/src/ATen/test/native_test.cpp.o\n[ 85%] Building CXX object caffe2/CMakeFiles/tbb_init_test.dir/__/aten/src/ATen/test/tbb_init_test.cpp.o\n[ 85%] Building CXX object caffe2/CMakeFiles/wrapdim_test.dir/__/aten/src/ATen/test/wrapdim_test.cpp.o\n[ 85%] Building CXX object caffe2/CMakeFiles/scalar_tensor_test.dir/__/aten/src/ATen/test/scalar_tensor_test.cpp.o\n[ 85%] Building CXX object caffe2/CMakeFiles/undefined_tensor_test.dir/__/aten/src/ATen/test/undefined_tensor_test.cpp.o\n[ 85%] Linking CXX executable ../bin/verify_api_visibility\n[ 85%] Linking CXX executable ../bin/tbb_init_test\n[91m/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\ncollect2: error: ld returned 1 exit status\nmake[2]: *** [bin/verify_api_visibility] Error 1\n[0mcaffe2/CMakeFiles/verify_api_visibility.dir/build.make:102: recipe for target 'bin/verify_api_visibility' failed\nCMakeFiles/Makefile2:1308: recipe for target 'caffe2/CMakeFiles/verify_api_visibility.dir/all' failed\n[91mmake[1]: *** [caffe2/CMakeFiles/verify_api_visibility.dir/all] Error 2\nmake[1]: *** Waiting for unfinished jobs....\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\ncollect2: error: ld returned 1 exit status\nmake[2]: *** [bin/tbb_init_test] Error 1\n[0mcaffe2/CMakeFiles/tbb_init_test.dir/build.make:102: recipe for target 'bin/tbb_init_test' failed\nCMakeFiles/Makefile2:1269: recipe for target 'caffe2/CMakeFiles/tbb_init_test.dir/all' failed\n[91mmake[1]: *** [caffe2/CMakeFiles/tbb_init_test.dir/all] Error 2\n[0m[ 85%] Linking CXX executable ../bin/dlconvertor_test\n[ 86%] Linking CXX executable ../bin/wrapdim_test\n[ 86%] Linking CXX executable ../bin/weakref_test\n[91m/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\ncollect2: error: ld returned 1 exit status\n[0mcaffe2/CMakeFiles/dlconvertor_test.dir/build.make:102: recipe for target 'bin/dlconvertor_test' failed\n[91mmake[2]: *** [bin/dlconvertor_test] Error 1\n[0mCMakeFiles/Makefile2:1606: recipe for target 'caffe2/CMakeFiles/dlconvertor_test.dir/all' failed\n[91mmake[1]: *** [caffe2/CMakeFiles/dlconvertor_test.dir/all] Error 2\n[0m[ 86%] Linking CXX executable ../bin/undefined_tensor_test\n[91m/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\ncollect2: error: ld returned 1 exit status\n[0mcaffe2/CMakeFiles/wrapdim_test.dir/build.make:102: recipe for target 'bin/wrapdim_test' failed\n[91mmake[2]: *** [bin/wrapdim_test] Error 1\n[0mCMakeFiles/Makefile2:1464: recipe for target 'caffe2/CMakeFiles/wrapdim_test.dir/all' failed\n[91mmake[1]: *** [caffe2/CMakeFiles/wrapdim_test.dir/all] Error 2\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\ncollect2: error: ld returned 1 exit status\n[0mcaffe2/CMakeFiles/weakref_test.dir/build.make:102: recipe for target 'bin/weakref_test' failed\n[91mmake[2]: *** [bin/weakref_test] Error 1\nmake[1]: *** [caffe2/CMakeFiles/weakref_test.dir/all] Error 2\n[0mCMakeFiles/Makefile2:1230: recipe for target 'caffe2/CMakeFiles/weakref_test.dir/all' failed\n[91m/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\ncollect2: error: ld returned 1 exit status\n[0mcaffe2/CMakeFiles/undefined_tensor_test.dir/build.make:102: recipe for target 'bin/undefined_tensor_test' failed\n[91mmake[2]: *** [bin/undefined_tensor_test] Error 1\nmake[1]: *** [caffe2/CMakeFiles/undefined_tensor_test.dir/all] Error 2\n[0mCMakeFiles/Makefile2:1347: recipe for target 'caffe2/CMakeFiles/undefined_tensor_test.dir/all' failed\n[ 87%] Linking CXX executable ../bin/scalar_tensor_test\n[91m/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\ncollect2: error: ld returned 1 exit status\nmake[2]: *** [bin/scalar_tensor_test] Error 1\n[0mcaffe2/CMakeFiles/scalar_tensor_test.dir/build.make:102: recipe for target 'bin/scalar_tensor_test' failed\nCMakeFiles/Makefile2:1386: recipe for target 'caffe2/CMakeFiles/scalar_tensor_test.dir/all' failed\n[91mmake[1]: *** [caffe2/CMakeFiles/scalar_tensor_test.dir/all] Error 2\n[0m[ 87%] Linking CXX executable ../bin/native_test\n[91m/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\ncollect2: error: ld returned 1 exit status\n[0mcaffe2/CMakeFiles/native_test.dir/build.make:102: recipe for target 'bin/native_test' failed\n[91mmake[2]: *** [bin/native_test] Error 1\nmake[1]: *** [caffe2/CMakeFiles/native_test.dir/all] Error 2\n[0mCMakeFiles/Makefile2:1425: recipe for target 'caffe2/CMakeFiles/native_test.dir/all' failed\n[91mmake: *** [all] Error 2\n[0mMakefile:138: recipe for target 'all' failed\n</code></pre>", "body_text": "Still breaking (trace below):\nThis is how I built my MKL DNN btw in my Docker:\n## Build MKL-DNN\nRUN cd /opt && \\\n    git clone https://github.com/intel/mkl-dnn.git && \\\n    cd /opt/mkl-dnn && \\\n    mkdir -p build && cd build && \\\n    cmake  .. && make && make install && \\\n    cd .. && rm -rf build \n\n## Nuke repo, set ENV and redo ldconfig\nRUN sudo update-alternatives --install /usr/lib/libmkldnn.so libmkldnn.so /usr/local/lib/libmkldnn.so 40 && \\\n    sudo ldconfig\n\nerror trace for Caffe2:\n\n[ 84%] Linking CXX shared library ../lib/libcaffe2.so\n[ 85%] Built target caffe2\nScanning dependencies of target verify_api_visibility\nScanning dependencies of target tbb_init_test\nScanning dependencies of target weakref_test\nScanning dependencies of target native_test\nScanning dependencies of target dlconvertor_test\nScanning dependencies of target wrapdim_test\nScanning dependencies of target scalar_tensor_test\nScanning dependencies of target undefined_tensor_test\n[ 85%] Building CXX object caffe2/CMakeFiles/dlconvertor_test.dir/__/aten/src/ATen/test/dlconvertor_test.cpp.o\n[ 85%] Building CXX object caffe2/CMakeFiles/verify_api_visibility.dir/__/aten/src/ATen/test/verify_api_visibility.cpp.o\n[ 85%] Building CXX object caffe2/CMakeFiles/weakref_test.dir/__/aten/src/ATen/test/weakref_test.cpp.o\n[ 85%] Building CXX object caffe2/CMakeFiles/native_test.dir/__/aten/src/ATen/test/native_test.cpp.o\n[ 85%] Building CXX object caffe2/CMakeFiles/tbb_init_test.dir/__/aten/src/ATen/test/tbb_init_test.cpp.o\n[ 85%] Building CXX object caffe2/CMakeFiles/wrapdim_test.dir/__/aten/src/ATen/test/wrapdim_test.cpp.o\n[ 85%] Building CXX object caffe2/CMakeFiles/scalar_tensor_test.dir/__/aten/src/ATen/test/scalar_tensor_test.cpp.o\n[ 85%] Building CXX object caffe2/CMakeFiles/undefined_tensor_test.dir/__/aten/src/ATen/test/undefined_tensor_test.cpp.o\n[ 85%] Linking CXX executable ../bin/verify_api_visibility\n[ 85%] Linking CXX executable ../bin/tbb_init_test\n[91m/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\ncollect2: error: ld returned 1 exit status\nmake[2]: *** [bin/verify_api_visibility] Error 1\n[0mcaffe2/CMakeFiles/verify_api_visibility.dir/build.make:102: recipe for target 'bin/verify_api_visibility' failed\nCMakeFiles/Makefile2:1308: recipe for target 'caffe2/CMakeFiles/verify_api_visibility.dir/all' failed\n[91mmake[1]: *** [caffe2/CMakeFiles/verify_api_visibility.dir/all] Error 2\nmake[1]: *** Waiting for unfinished jobs....\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\ncollect2: error: ld returned 1 exit status\nmake[2]: *** [bin/tbb_init_test] Error 1\n[0mcaffe2/CMakeFiles/tbb_init_test.dir/build.make:102: recipe for target 'bin/tbb_init_test' failed\nCMakeFiles/Makefile2:1269: recipe for target 'caffe2/CMakeFiles/tbb_init_test.dir/all' failed\n[91mmake[1]: *** [caffe2/CMakeFiles/tbb_init_test.dir/all] Error 2\n[0m[ 85%] Linking CXX executable ../bin/dlconvertor_test\n[ 86%] Linking CXX executable ../bin/wrapdim_test\n[ 86%] Linking CXX executable ../bin/weakref_test\n[91m/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\ncollect2: error: ld returned 1 exit status\n[0mcaffe2/CMakeFiles/dlconvertor_test.dir/build.make:102: recipe for target 'bin/dlconvertor_test' failed\n[91mmake[2]: *** [bin/dlconvertor_test] Error 1\n[0mCMakeFiles/Makefile2:1606: recipe for target 'caffe2/CMakeFiles/dlconvertor_test.dir/all' failed\n[91mmake[1]: *** [caffe2/CMakeFiles/dlconvertor_test.dir/all] Error 2\n[0m[ 86%] Linking CXX executable ../bin/undefined_tensor_test\n[91m/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\ncollect2: error: ld returned 1 exit status\n[0mcaffe2/CMakeFiles/wrapdim_test.dir/build.make:102: recipe for target 'bin/wrapdim_test' failed\n[91mmake[2]: *** [bin/wrapdim_test] Error 1\n[0mCMakeFiles/Makefile2:1464: recipe for target 'caffe2/CMakeFiles/wrapdim_test.dir/all' failed\n[91mmake[1]: *** [caffe2/CMakeFiles/wrapdim_test.dir/all] Error 2\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\ncollect2: error: ld returned 1 exit status\n[0mcaffe2/CMakeFiles/weakref_test.dir/build.make:102: recipe for target 'bin/weakref_test' failed\n[91mmake[2]: *** [bin/weakref_test] Error 1\nmake[1]: *** [caffe2/CMakeFiles/weakref_test.dir/all] Error 2\n[0mCMakeFiles/Makefile2:1230: recipe for target 'caffe2/CMakeFiles/weakref_test.dir/all' failed\n[91m/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\ncollect2: error: ld returned 1 exit status\n[0mcaffe2/CMakeFiles/undefined_tensor_test.dir/build.make:102: recipe for target 'bin/undefined_tensor_test' failed\n[91mmake[2]: *** [bin/undefined_tensor_test] Error 1\nmake[1]: *** [caffe2/CMakeFiles/undefined_tensor_test.dir/all] Error 2\n[0mCMakeFiles/Makefile2:1347: recipe for target 'caffe2/CMakeFiles/undefined_tensor_test.dir/all' failed\n[ 87%] Linking CXX executable ../bin/scalar_tensor_test\n[91m/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\ncollect2: error: ld returned 1 exit status\nmake[2]: *** [bin/scalar_tensor_test] Error 1\n[0mcaffe2/CMakeFiles/scalar_tensor_test.dir/build.make:102: recipe for target 'bin/scalar_tensor_test' failed\nCMakeFiles/Makefile2:1386: recipe for target 'caffe2/CMakeFiles/scalar_tensor_test.dir/all' failed\n[91mmake[1]: *** [caffe2/CMakeFiles/scalar_tensor_test.dir/all] Error 2\n[0m[ 87%] Linking CXX executable ../bin/native_test\n[91m/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\ncollect2: error: ld returned 1 exit status\n[0mcaffe2/CMakeFiles/native_test.dir/build.make:102: recipe for target 'bin/native_test' failed\n[91mmake[2]: *** [bin/native_test] Error 1\nmake[1]: *** [caffe2/CMakeFiles/native_test.dir/all] Error 2\n[0mCMakeFiles/Makefile2:1425: recipe for target 'caffe2/CMakeFiles/native_test.dir/all' failed\n[91mmake: *** [all] Error 2\n[0mMakefile:138: recipe for target 'all' failed", "body": "Still breaking (trace below): \r\n\r\nThis is how I built my MKL DNN btw in my Docker:\r\n\r\n```\r\n## Build MKL-DNN\r\nRUN cd /opt && \\\r\n    git clone https://github.com/intel/mkl-dnn.git && \\\r\n    cd /opt/mkl-dnn && \\\r\n    mkdir -p build && cd build && \\\r\n    cmake  .. && make && make install && \\\r\n    cd .. && rm -rf build \r\n\r\n## Nuke repo, set ENV and redo ldconfig\r\nRUN sudo update-alternatives --install /usr/lib/libmkldnn.so libmkldnn.so /usr/local/lib/libmkldnn.so 40 && \\\r\n    sudo ldconfig\r\n```\r\nerror trace for Caffe2:\r\n\r\n```\r\n\r\n[ 84%] Linking CXX shared library ../lib/libcaffe2.so\r\n[ 85%] Built target caffe2\r\nScanning dependencies of target verify_api_visibility\r\nScanning dependencies of target tbb_init_test\r\nScanning dependencies of target weakref_test\r\nScanning dependencies of target native_test\r\nScanning dependencies of target dlconvertor_test\r\nScanning dependencies of target wrapdim_test\r\nScanning dependencies of target scalar_tensor_test\r\nScanning dependencies of target undefined_tensor_test\r\n[ 85%] Building CXX object caffe2/CMakeFiles/dlconvertor_test.dir/__/aten/src/ATen/test/dlconvertor_test.cpp.o\r\n[ 85%] Building CXX object caffe2/CMakeFiles/verify_api_visibility.dir/__/aten/src/ATen/test/verify_api_visibility.cpp.o\r\n[ 85%] Building CXX object caffe2/CMakeFiles/weakref_test.dir/__/aten/src/ATen/test/weakref_test.cpp.o\r\n[ 85%] Building CXX object caffe2/CMakeFiles/native_test.dir/__/aten/src/ATen/test/native_test.cpp.o\r\n[ 85%] Building CXX object caffe2/CMakeFiles/tbb_init_test.dir/__/aten/src/ATen/test/tbb_init_test.cpp.o\r\n[ 85%] Building CXX object caffe2/CMakeFiles/wrapdim_test.dir/__/aten/src/ATen/test/wrapdim_test.cpp.o\r\n[ 85%] Building CXX object caffe2/CMakeFiles/scalar_tensor_test.dir/__/aten/src/ATen/test/scalar_tensor_test.cpp.o\r\n[ 85%] Building CXX object caffe2/CMakeFiles/undefined_tensor_test.dir/__/aten/src/ATen/test/undefined_tensor_test.cpp.o\r\n[ 85%] Linking CXX executable ../bin/verify_api_visibility\r\n[ 85%] Linking CXX executable ../bin/tbb_init_test\r\n[91m/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\r\ncollect2: error: ld returned 1 exit status\r\nmake[2]: *** [bin/verify_api_visibility] Error 1\r\n[0mcaffe2/CMakeFiles/verify_api_visibility.dir/build.make:102: recipe for target 'bin/verify_api_visibility' failed\r\nCMakeFiles/Makefile2:1308: recipe for target 'caffe2/CMakeFiles/verify_api_visibility.dir/all' failed\r\n[91mmake[1]: *** [caffe2/CMakeFiles/verify_api_visibility.dir/all] Error 2\r\nmake[1]: *** Waiting for unfinished jobs....\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\r\ncollect2: error: ld returned 1 exit status\r\nmake[2]: *** [bin/tbb_init_test] Error 1\r\n[0mcaffe2/CMakeFiles/tbb_init_test.dir/build.make:102: recipe for target 'bin/tbb_init_test' failed\r\nCMakeFiles/Makefile2:1269: recipe for target 'caffe2/CMakeFiles/tbb_init_test.dir/all' failed\r\n[91mmake[1]: *** [caffe2/CMakeFiles/tbb_init_test.dir/all] Error 2\r\n[0m[ 85%] Linking CXX executable ../bin/dlconvertor_test\r\n[ 86%] Linking CXX executable ../bin/wrapdim_test\r\n[ 86%] Linking CXX executable ../bin/weakref_test\r\n[91m/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\r\ncollect2: error: ld returned 1 exit status\r\n[0mcaffe2/CMakeFiles/dlconvertor_test.dir/build.make:102: recipe for target 'bin/dlconvertor_test' failed\r\n[91mmake[2]: *** [bin/dlconvertor_test] Error 1\r\n[0mCMakeFiles/Makefile2:1606: recipe for target 'caffe2/CMakeFiles/dlconvertor_test.dir/all' failed\r\n[91mmake[1]: *** [caffe2/CMakeFiles/dlconvertor_test.dir/all] Error 2\r\n[0m[ 86%] Linking CXX executable ../bin/undefined_tensor_test\r\n[91m/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\r\ncollect2: error: ld returned 1 exit status\r\n[0mcaffe2/CMakeFiles/wrapdim_test.dir/build.make:102: recipe for target 'bin/wrapdim_test' failed\r\n[91mmake[2]: *** [bin/wrapdim_test] Error 1\r\n[0mCMakeFiles/Makefile2:1464: recipe for target 'caffe2/CMakeFiles/wrapdim_test.dir/all' failed\r\n[91mmake[1]: *** [caffe2/CMakeFiles/wrapdim_test.dir/all] Error 2\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\r\ncollect2: error: ld returned 1 exit status\r\n[0mcaffe2/CMakeFiles/weakref_test.dir/build.make:102: recipe for target 'bin/weakref_test' failed\r\n[91mmake[2]: *** [bin/weakref_test] Error 1\r\nmake[1]: *** [caffe2/CMakeFiles/weakref_test.dir/all] Error 2\r\n[0mCMakeFiles/Makefile2:1230: recipe for target 'caffe2/CMakeFiles/weakref_test.dir/all' failed\r\n[91m/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\r\ncollect2: error: ld returned 1 exit status\r\n[0mcaffe2/CMakeFiles/undefined_tensor_test.dir/build.make:102: recipe for target 'bin/undefined_tensor_test' failed\r\n[91mmake[2]: *** [bin/undefined_tensor_test] Error 1\r\nmake[1]: *** [caffe2/CMakeFiles/undefined_tensor_test.dir/all] Error 2\r\n[0mCMakeFiles/Makefile2:1347: recipe for target 'caffe2/CMakeFiles/undefined_tensor_test.dir/all' failed\r\n[ 87%] Linking CXX executable ../bin/scalar_tensor_test\r\n[91m/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\r\ncollect2: error: ld returned 1 exit status\r\nmake[2]: *** [bin/scalar_tensor_test] Error 1\r\n[0mcaffe2/CMakeFiles/scalar_tensor_test.dir/build.make:102: recipe for target 'bin/scalar_tensor_test' failed\r\nCMakeFiles/Makefile2:1386: recipe for target 'caffe2/CMakeFiles/scalar_tensor_test.dir/all' failed\r\n[91mmake[1]: *** [caffe2/CMakeFiles/scalar_tensor_test.dir/all] Error 2\r\n[0m[ 87%] Linking CXX executable ../bin/native_test\r\n[91m/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_pd'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_primitive_desc'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_weights_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_submit'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_get_size'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_query_s32'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_backward_data_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_reorder_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_set_data_handle'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_engine_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_convolution_forward_desc_init'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_at'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_destroy'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_get_output'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_primitive_desc_clone'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_stream_create'\r\n/opt/pytorch/build/lib/libcaffe2.so: undefined reference to `mkldnn_memory_primitive_desc_equal'\r\ncollect2: error: ld returned 1 exit status\r\n[0mcaffe2/CMakeFiles/native_test.dir/build.make:102: recipe for target 'bin/native_test' failed\r\n[91mmake[2]: *** [bin/native_test] Error 1\r\nmake[1]: *** [caffe2/CMakeFiles/native_test.dir/all] Error 2\r\n[0mCMakeFiles/Makefile2:1425: recipe for target 'caffe2/CMakeFiles/native_test.dir/all' failed\r\n[91mmake: *** [all] Error 2\r\n[0mMakefile:138: recipe for target 'all' failed\r\n```"}