{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/415589408", "html_url": "https://github.com/pytorch/pytorch/issues/9580#issuecomment-415589408", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/9580", "id": 415589408, "node_id": "MDEyOklzc3VlQ29tbWVudDQxNTU4OTQwOA==", "user": {"login": "yarrseni", "id": 1142991, "node_id": "MDQ6VXNlcjExNDI5OTE=", "avatar_url": "https://avatars3.githubusercontent.com/u/1142991?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarrseni", "html_url": "https://github.com/yarrseni", "followers_url": "https://api.github.com/users/yarrseni/followers", "following_url": "https://api.github.com/users/yarrseni/following{/other_user}", "gists_url": "https://api.github.com/users/yarrseni/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarrseni/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarrseni/subscriptions", "organizations_url": "https://api.github.com/users/yarrseni/orgs", "repos_url": "https://api.github.com/users/yarrseni/repos", "events_url": "https://api.github.com/users/yarrseni/events{/privacy}", "received_events_url": "https://api.github.com/users/yarrseni/received_events", "type": "User", "site_admin": false}, "created_at": "2018-08-23T22:19:54Z", "updated_at": "2018-08-23T22:23:45Z", "author_association": "NONE", "body_html": "<p>I am having similar issue.</p>\n<p><strong>System Info</strong><br>\nPyTorch or Caffe2: PyTorch<br>\nHow you installed PyTorch (conda, pip, source): source<br>\nBuild command you used (if compiling from source):</p>\n<p><code>MACOSX_DEPLOYMENT_TARGET=10.9 CC=clang CXX=clang++ NOCUDA=1 USE_OPENCV=1 USE_MKL=1 python setup.py bdist_wheel</code></p>\n<p><strong>Summary of configuration is:</strong></p>\n<p><code>-- General: --   CMake version         : 3.12.1 --   CMake command         : /usr/local/Cellar/cmake/3.12.1/bin/cmake --   Git version           : --   System                : Darwin --   C++ compiler          : /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang++ --   C++ compiler version  : 9.1.0.9020039 --   BLAS                  : MKL --   CXX flags             :   -msse4.1 -msse4.2   --std=c++11  -Wno-deprecated -fvisibility-inlines-hidden -rdynamic -Wno-deprecated-declarations -DONNX_NAMESPACE=onnx_torch -O2 -fPIC -Wno-narrowing -Wall -Wextra -Wno-missing-field-initializers -Wno-type-limits -Wno-array-bounds -Wno-unknown-pragmas -Wno-sign-compare -Wno-unused-parameter -Wno-unused-variable -Wno-unused-function -Wno-unused-result -Wno-strict-overflow -Wno-strict-aliasing -Wno-error=deprecated-declarations -Wno-stringop-overflow -Wno-invalid-partial-specialization -Wno-typedef-redefinition -Wno-unknown-warning-option -Wno-unused-private-field -Wno-inconsistent-missing-override -Wno-aligned-allocation-unavailable -Wno-c++14-extensions -Wno-constexpr-not-const -Wno-missing-braces -Qunused-arguments -faligned-new --   Build type            : Release --   Compile definitions   : USE_GCC_ATOMICS=1;TH_BLAS_MKL;HAVE_MMAP=1;_FILE_OFFSET_BITS=64;HAVE_SHM_OPEN=1;HAVE_SHM_UNLINK=1 --   CMAKE_PREFIX_PATH     : /Users/arseni/.pyenv/versions/3.6.6/lib/python3.6/site-packages --   CMAKE_INSTALL_PREFIX  : /Users/arseni/projects/frameworks/pytorch/torch/lib/tmp_install --   BUILD_CAFFE2          : 0 --   BUILD_ATEN_MOBILE     : OFF --   BUILD_BINARY          : OFF --   BUILD_CUSTOM_PROTOBUF : ON --   Link local protobuf : ON --   BUILD_PYTHON          : 0 --   BUILD_SHARED_LIBS     : ON --   BUILD_TEST            : OFF --   USE_ASAN              : OFF --   USE_CUDA              : 0 --   USE_ROCM              : OFF --   USE_EIGEN_FOR_BLAS    : --   USE_FFMPEG            : OFF --   USE_GFLAGS            : OFF --   USE_GLOG              : OFF --   USE_GLOO              : OFF --   USE_LEVELDB           : OFF --   USE_LITE_PROTO        : OFF --   USE_LMDB              : OFF --   USE_METAL             : OFF --   USE_MKL               : --   USE_MOBILE_OPENGL     : OFF --   USE_MPI               : OFF --   USE_NCCL              : OFF --   USE_NERVANA_GPU       : OFF --   USE_NNPACK            : 1 --   USE_OBSERVERS         : OFF --   USE_OPENCL            : OFF --   USE_OPENCV            : OFF --   USE_OPENMP            : OFF --   USE_PROF              : OFF --   USE_REDIS             : OFF --   USE_ROCKSDB           : OFF --   USE_ZMQ               : OFF --   USE_DISTRIBUTED       : OFF --   Public Dependencies  : /opt/intel/compilers_and_libraries_2018.3.185/mac/mkl/lib/libmkl_intel_lp64.dylib;/opt/intel/compilers_and_libraries_2018.3.185/mac/mkl/lib/libmkl_intel_thread.dylib;/opt/intel/compilers_and_libraries_2018.3.185/mac/mkl/lib/libmkl_core.dylib;/opt/intel/compilers_and_libraries_2018.3.185/mac/mkl/lib/libiomp5.dylib;/usr/lib/libpthread.dylib;/usr/lib/libm.dylib --   Private Dependencies : nnpack;cpuinfo;onnxifi_loader -- Configuring done</code></p>\n<p>The error trace I get is:<br>\n<code>[ 81%] Linking CXX shared library ../lib/libcaffe2.dylib ld: warning: directory not found for option '-L/Users/arseni/projects/frameworks/pytorch/torch/lib/tmp_install/lib' Undefined symbols for architecture x86_64: \"_mkldnn_convolution_backward_data_desc_init\", referenced from: mkldnn::convolution_backward_data::desc::desc(mkldnn::algorithm, mkldnn::memory::desc const&amp;, mkldnn::memory::desc const&amp;, mkldnn::memory::desc const&amp;, std::__1::vector&lt;int, std::__1::allocator&lt;int&gt; &gt;, std::__1::vector&lt;int, std::__1::allocator&lt;int&gt; &gt;, std::__1::vector&lt;int, std::__1::allocator&lt;int&gt; &gt;, mkldnn::padding_kind) in Conv.cpp.o \"_mkldnn_convolution_backward_weights_desc_init\", referenced from: mkldnn::convolution_backward_weights::desc::desc(mkldnn::algorithm, mkldnn::memory::desc const&amp;, mkldnn::memory::desc const&amp;, mkldnn::memory::desc const&amp;, mkldnn::memory::desc const&amp;, std::__1::vector&lt;int, std::__1::allocator&lt;int&gt; &gt;, std::__1::vector&lt;int, std::__1::allocator&lt;int&gt; &gt;, std::__1::vector&lt;int, std::__1::allocator&lt;int&gt; &gt;, mkldnn::padding_kind) in Conv.cpp.o mkldnn::convolution_backward_weights::desc::desc(mkldnn::algorithm, mkldnn::memory::desc const&amp;, mkldnn::memory::desc const&amp;, mkldnn::memory::desc const&amp;, std::__1::vector&lt;int, std::__1::allocator&lt;int&gt; &gt;, std::__1::vector&lt;int, std::__1::allocator&lt;int&gt; &gt;, std::__1::vector&lt;int, std::__1::allocator&lt;int&gt; &gt;, mkldnn::padding_kind) in Conv.cpp.o \"_mkldnn_convolution_forward_desc_init\", referenced from: mkldnn::convolution_forward::desc::desc(mkldnn::prop_kind, mkldnn::algorithm, mkldnn::memory::desc const&amp;, mkldnn::memory::desc const&amp;, mkldnn::memory::desc const&amp;, mkldnn::memory::desc const&amp;, std::__1::vector&lt;int, std::__1::allocator&lt;int&gt; &gt;, std::__1::vector&lt;int, std::__1::allocator&lt;int&gt; &gt;, std::__1::vector&lt;int, std::__1::allocator&lt;int&gt; &gt;, mkldnn::padding_kind) in Conv.cpp.o mkldnn::convolution_forward::desc::desc(mkldnn::prop_kind, mkldnn::algorithm, mkldnn::memory::desc const&amp;, mkldnn::memory::desc const&amp;, mkldnn::memory::desc const&amp;, std::__1::vector&lt;int, std::__1::allocator&lt;int&gt; &gt;, std::__1::vector&lt;int, std::__1::allocator&lt;int&gt; &gt;, std::__1::vector&lt;int, std::__1::allocator&lt;int&gt; &gt;, mkldnn::padding_kind) in Conv.cpp.o \"_mkldnn_engine_create\", referenced from: mkldnn::engine::engine(mkldnn::engine::kind, unsigned long) in Conv.cpp.o \"_mkldnn_engine_destroy\", referenced from: mkldnn::engine::engine(mkldnn::engine::kind, unsigned long) in Conv.cpp.o \"_mkldnn_memory_desc_init\", referenced from: mkldnn::memory::desc::desc(std::__1::vector&lt;int, std::__1::allocator&lt;int&gt; &gt;, mkldnn::memory::data_type, mkldnn::memory::format) in Conv.cpp.o \"_mkldnn_memory_primitive_desc_create\", referenced from: mkldnn::memory::primitive_desc::primitive_desc(mkldnn::memory::desc const&amp;, mkldnn::engine const&amp;) in Conv.cpp.o \"_mkldnn_memory_primitive_desc_equal\", referenced from: at::native::mkldnn_convolution(at::Tensor const&amp;, at::Tensor const&amp;, at::Tensor const&amp;, at::ArrayRef&lt;long long&gt;, at::ArrayRef&lt;long long&gt;, at::ArrayRef&lt;long long&gt;, long long) in Conv.cpp.o at::native::mkldnn_convolution_backward_input(at::ArrayRef&lt;long long&gt;, at::Tensor const&amp;, at::Tensor const&amp;, at::ArrayRef&lt;long long&gt;, at::ArrayRef&lt;long long&gt;, at::ArrayRef&lt;long long&gt;, long long, bool) in Conv.cpp.o at::native::mkldnn_convolution_backward_weights(at::ArrayRef&lt;long long&gt;, at::Tensor const&amp;, at::Tensor const&amp;, at::ArrayRef&lt;long long&gt;, at::ArrayRef&lt;long long&gt;, at::ArrayRef&lt;long long&gt;, long long, bool) in Conv.cpp.o \"_mkldnn_memory_primitive_desc_get_size\", referenced from: mkldnn::memory::memory(mkldnn::memory::primitive_desc const&amp;) in Conv.cpp.o \"_mkldnn_memory_set_data_handle\", referenced from: mkldnn::memory::memory(mkldnn::memory::primitive_desc const&amp;, void*) in Conv.cpp.o mkldnn::memory::memory(mkldnn::memory::primitive_desc const&amp;) in Conv.cpp.o \"_mkldnn_primitive_at\", referenced from: at::native::mkldnn_convolution(at::Tensor const&amp;, at::Tensor const&amp;, at::Tensor const&amp;, at::ArrayRef&lt;long long&gt;, at::ArrayRef&lt;long long&gt;, at::ArrayRef&lt;long long&gt;, long long) in Conv.cpp.o at::native::mkldnn_convolution_backward_input(at::ArrayRef&lt;long long&gt;, at::Tensor const&amp;, at::Tensor const&amp;, at::ArrayRef&lt;long long&gt;, at::ArrayRef&lt;long long&gt;, at::ArrayRef&lt;long long&gt;, long long, bool) in Conv.cpp.o at::native::mkldnn_convolution_backward_weights(at::ArrayRef&lt;long long&gt;, at::Tensor const&amp;, at::Tensor const&amp;, at::ArrayRef&lt;long long&gt;, at::ArrayRef&lt;long long&gt;, at::ArrayRef&lt;long long&gt;, long long, bool) in Conv.cpp.o \"_mkldnn_primitive_create\", referenced from: mkldnn::memory::memory(mkldnn::memory::primitive_desc const&amp;, void*) in Conv.cpp.o mkldnn::memory::memory(mkldnn::memory::primitive_desc const&amp;) in Conv.cpp.o mkldnn::reorder::reorder(mkldnn::primitive::at const&amp;, mkldnn::memory const&amp;) in Conv.cpp.o mkldnn::convolution_forward::convolution_forward(mkldnn::convolution_forward::primitive_desc const&amp;, mkldnn::primitive::at const&amp;, mkldnn::primitive::at const&amp;, mkldnn::primitive::at const&amp;, mkldnn::memory const&amp;) in Conv.cpp.o mkldnn::convolution_forward::convolution_forward(mkldnn::convolution_forward::primitive_desc const&amp;, mkldnn::primitive::at const&amp;, mkldnn::primitive::at const&amp;, mkldnn::memory const&amp;) in Conv.cpp.o mkldnn::convolution_backward_data::convolution_backward_data(mkldnn::convolution_backward_data::primitive_desc const&amp;, mkldnn::primitive::at const&amp;, mkldnn::primitive::at const&amp;, mkldnn::memory const&amp;) in Conv.cpp.o mkldnn::convolution_backward_weights::convolution_backward_weights(mkldnn::convolution_backward_weights::primitive_desc const&amp;, mkldnn::primitive::at const&amp;, mkldnn::primitive::at const&amp;, mkldnn::memory const&amp;, mkldnn::memory const&amp;) in Conv.cpp.o ... \"_mkldnn_primitive_desc_clone\", referenced from: mkldnn::convolution_forward::primitive_desc::src_primitive_desc() const in Conv.cpp.o mkldnn::convolution_forward::primitive_desc::weights_primitive_desc() const in Conv.cpp.o mkldnn::convolution_forward::primitive_desc::dst_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::diff_dst_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::weights_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::diff_src_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_weights::primitive_desc::src_primitive_desc() const in Conv.cpp.o ... \"_mkldnn_primitive_desc_create\", referenced from: mkldnn::convolution_forward::primitive_desc::primitive_desc(mkldnn::convolution_forward::desc const&amp;, mkldnn::engine const&amp;) in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::primitive_desc(mkldnn::convolution_backward_data::desc const&amp;, mkldnn::engine const&amp;, mkldnn::convolution_forward::primitive_desc const&amp;) in Conv.cpp.o mkldnn::convolution_backward_weights::primitive_desc::primitive_desc(mkldnn::convolution_backward_weights::desc const&amp;, mkldnn::engine const&amp;, mkldnn::convolution_forward::primitive_desc const&amp;) in Conv.cpp.o \"_mkldnn_primitive_desc_destroy\", referenced from: mkldnn::convolution_forward::primitive_desc::src_primitive_desc() const in Conv.cpp.o mkldnn::convolution_forward::primitive_desc::weights_primitive_desc() const in Conv.cpp.o mkldnn::convolution_forward::primitive_desc::dst_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::diff_dst_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::weights_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::diff_src_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_weights::primitive_desc::src_primitive_desc() const in Conv.cpp.o ... \"_mkldnn_primitive_desc_query_pd\", referenced from: mkldnn::convolution_forward::primitive_desc::src_primitive_desc() const in Conv.cpp.o mkldnn::convolution_forward::primitive_desc::weights_primitive_desc() const in Conv.cpp.o mkldnn::convolution_forward::primitive_desc::dst_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::diff_dst_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::weights_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::diff_src_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_weights::primitive_desc::src_primitive_desc() const in Conv.cpp.o ... \"_mkldnn_primitive_desc_query_s32\", referenced from: mkldnn::check_num_parameters(mkldnn_primitive_desc const* const&amp;, int, int, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;) in Conv.cpp.o \"_mkldnn_primitive_destroy\", referenced from: mkldnn::handle&lt;mkldnn_primitive*, mkldnn::handle_traits&lt;mkldnn_primitive*&gt; &gt;::handle(mkldnn_primitive*, bool) in Conv.cpp.o mkldnn::memory::memory(mkldnn::memory::primitive_desc const&amp;, void*) in Conv.cpp.o mkldnn::memory::memory(mkldnn::memory::primitive_desc const&amp;) in Conv.cpp.o mkldnn::reorder::reorder(mkldnn::primitive::at const&amp;, mkldnn::memory const&amp;) in Conv.cpp.o mkldnn::convolution_forward::convolution_forward(mkldnn::convolution_forward::primitive_desc const&amp;, mkldnn::primitive::at const&amp;, mkldnn::primitive::at const&amp;, mkldnn::primitive::at const&amp;, mkldnn::memory const&amp;) in Conv.cpp.o mkldnn::convolution_forward::convolution_forward(mkldnn::convolution_forward::primitive_desc const&amp;, mkldnn::primitive::at const&amp;, mkldnn::primitive::at const&amp;, mkldnn::memory const&amp;) in Conv.cpp.o mkldnn::convolution_backward_data::convolution_backward_data(mkldnn::convolution_backward_data::primitive_desc const&amp;, mkldnn::primitive::at const&amp;, mkldnn::primitive::at const&amp;, mkldnn::memory const&amp;) in Conv.cpp.o ... \"_mkldnn_primitive_get_output\", referenced from: mkldnn::reorder::reorder(mkldnn::primitive::at const&amp;, mkldnn::memory const&amp;) in Conv.cpp.o \"_mkldnn_primitive_get_primitive_desc\", referenced from: mkldnn::memory::get_primitive_desc() const in Conv.cpp.o \"_mkldnn_reorder_primitive_desc_create\", referenced from: mkldnn::reorder::primitive_desc::primitive_desc(mkldnn::memory::primitive_desc const&amp;, mkldnn::memory::primitive_desc const&amp;) in Conv.cpp.o \"_mkldnn_stream_create\", referenced from: mkldnn::stream::stream(mkldnn::stream::kind) in Conv.cpp.o \"_mkldnn_stream_destroy\", referenced from: mkldnn::stream::stream(mkldnn::stream::kind) in Conv.cpp.o \"_mkldnn_stream_submit\", referenced from: mkldnn::stream::submit(std::__1::vector&lt;mkldnn::primitive, std::__1::allocator&lt;mkldnn::primitive&gt; &gt;) in Conv.cpp.o ld: symbol(s) not found for architecture x86_64 clang: error: linker command failed with exit code 1 (use -v to see invocation) make[2]: *** [lib/libcaffe2.dylib] Error 1 make[1]: *** [caffe2/CMakeFiles/caffe2.dir/all] Error 2 make: *** [all] Error 2 Failed to run 'bash ../tools/build_pytorch_libs.sh --use-nnpack --use-mkldnn caffe2 nanopb libshm THD'</code></p>\n<p>Tried applying patch from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"341686150\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/9474\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/9474/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/9474\">#9474</a> but the outcome is the same.</p>\n<p>My mkl-dnn is v0.16 (<a href=\"https://github.com/intel/mkl-dnn/releases/tag/v0.16\">https://github.com/intel/mkl-dnn/releases/tag/v0.16</a>) and is located with same /lib and /include directory as mkl itself.</p>", "body_text": "I am having similar issue.\nSystem Info\nPyTorch or Caffe2: PyTorch\nHow you installed PyTorch (conda, pip, source): source\nBuild command you used (if compiling from source):\nMACOSX_DEPLOYMENT_TARGET=10.9 CC=clang CXX=clang++ NOCUDA=1 USE_OPENCV=1 USE_MKL=1 python setup.py bdist_wheel\nSummary of configuration is:\n-- General: --   CMake version         : 3.12.1 --   CMake command         : /usr/local/Cellar/cmake/3.12.1/bin/cmake --   Git version           : --   System                : Darwin --   C++ compiler          : /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang++ --   C++ compiler version  : 9.1.0.9020039 --   BLAS                  : MKL --   CXX flags             :   -msse4.1 -msse4.2   --std=c++11  -Wno-deprecated -fvisibility-inlines-hidden -rdynamic -Wno-deprecated-declarations -DONNX_NAMESPACE=onnx_torch -O2 -fPIC -Wno-narrowing -Wall -Wextra -Wno-missing-field-initializers -Wno-type-limits -Wno-array-bounds -Wno-unknown-pragmas -Wno-sign-compare -Wno-unused-parameter -Wno-unused-variable -Wno-unused-function -Wno-unused-result -Wno-strict-overflow -Wno-strict-aliasing -Wno-error=deprecated-declarations -Wno-stringop-overflow -Wno-invalid-partial-specialization -Wno-typedef-redefinition -Wno-unknown-warning-option -Wno-unused-private-field -Wno-inconsistent-missing-override -Wno-aligned-allocation-unavailable -Wno-c++14-extensions -Wno-constexpr-not-const -Wno-missing-braces -Qunused-arguments -faligned-new --   Build type            : Release --   Compile definitions   : USE_GCC_ATOMICS=1;TH_BLAS_MKL;HAVE_MMAP=1;_FILE_OFFSET_BITS=64;HAVE_SHM_OPEN=1;HAVE_SHM_UNLINK=1 --   CMAKE_PREFIX_PATH     : /Users/arseni/.pyenv/versions/3.6.6/lib/python3.6/site-packages --   CMAKE_INSTALL_PREFIX  : /Users/arseni/projects/frameworks/pytorch/torch/lib/tmp_install --   BUILD_CAFFE2          : 0 --   BUILD_ATEN_MOBILE     : OFF --   BUILD_BINARY          : OFF --   BUILD_CUSTOM_PROTOBUF : ON --   Link local protobuf : ON --   BUILD_PYTHON          : 0 --   BUILD_SHARED_LIBS     : ON --   BUILD_TEST            : OFF --   USE_ASAN              : OFF --   USE_CUDA              : 0 --   USE_ROCM              : OFF --   USE_EIGEN_FOR_BLAS    : --   USE_FFMPEG            : OFF --   USE_GFLAGS            : OFF --   USE_GLOG              : OFF --   USE_GLOO              : OFF --   USE_LEVELDB           : OFF --   USE_LITE_PROTO        : OFF --   USE_LMDB              : OFF --   USE_METAL             : OFF --   USE_MKL               : --   USE_MOBILE_OPENGL     : OFF --   USE_MPI               : OFF --   USE_NCCL              : OFF --   USE_NERVANA_GPU       : OFF --   USE_NNPACK            : 1 --   USE_OBSERVERS         : OFF --   USE_OPENCL            : OFF --   USE_OPENCV            : OFF --   USE_OPENMP            : OFF --   USE_PROF              : OFF --   USE_REDIS             : OFF --   USE_ROCKSDB           : OFF --   USE_ZMQ               : OFF --   USE_DISTRIBUTED       : OFF --   Public Dependencies  : /opt/intel/compilers_and_libraries_2018.3.185/mac/mkl/lib/libmkl_intel_lp64.dylib;/opt/intel/compilers_and_libraries_2018.3.185/mac/mkl/lib/libmkl_intel_thread.dylib;/opt/intel/compilers_and_libraries_2018.3.185/mac/mkl/lib/libmkl_core.dylib;/opt/intel/compilers_and_libraries_2018.3.185/mac/mkl/lib/libiomp5.dylib;/usr/lib/libpthread.dylib;/usr/lib/libm.dylib --   Private Dependencies : nnpack;cpuinfo;onnxifi_loader -- Configuring done\nThe error trace I get is:\n[ 81%] Linking CXX shared library ../lib/libcaffe2.dylib ld: warning: directory not found for option '-L/Users/arseni/projects/frameworks/pytorch/torch/lib/tmp_install/lib' Undefined symbols for architecture x86_64: \"_mkldnn_convolution_backward_data_desc_init\", referenced from: mkldnn::convolution_backward_data::desc::desc(mkldnn::algorithm, mkldnn::memory::desc const&, mkldnn::memory::desc const&, mkldnn::memory::desc const&, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, mkldnn::padding_kind) in Conv.cpp.o \"_mkldnn_convolution_backward_weights_desc_init\", referenced from: mkldnn::convolution_backward_weights::desc::desc(mkldnn::algorithm, mkldnn::memory::desc const&, mkldnn::memory::desc const&, mkldnn::memory::desc const&, mkldnn::memory::desc const&, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, mkldnn::padding_kind) in Conv.cpp.o mkldnn::convolution_backward_weights::desc::desc(mkldnn::algorithm, mkldnn::memory::desc const&, mkldnn::memory::desc const&, mkldnn::memory::desc const&, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, mkldnn::padding_kind) in Conv.cpp.o \"_mkldnn_convolution_forward_desc_init\", referenced from: mkldnn::convolution_forward::desc::desc(mkldnn::prop_kind, mkldnn::algorithm, mkldnn::memory::desc const&, mkldnn::memory::desc const&, mkldnn::memory::desc const&, mkldnn::memory::desc const&, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, mkldnn::padding_kind) in Conv.cpp.o mkldnn::convolution_forward::desc::desc(mkldnn::prop_kind, mkldnn::algorithm, mkldnn::memory::desc const&, mkldnn::memory::desc const&, mkldnn::memory::desc const&, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, mkldnn::padding_kind) in Conv.cpp.o \"_mkldnn_engine_create\", referenced from: mkldnn::engine::engine(mkldnn::engine::kind, unsigned long) in Conv.cpp.o \"_mkldnn_engine_destroy\", referenced from: mkldnn::engine::engine(mkldnn::engine::kind, unsigned long) in Conv.cpp.o \"_mkldnn_memory_desc_init\", referenced from: mkldnn::memory::desc::desc(std::__1::vector<int, std::__1::allocator<int> >, mkldnn::memory::data_type, mkldnn::memory::format) in Conv.cpp.o \"_mkldnn_memory_primitive_desc_create\", referenced from: mkldnn::memory::primitive_desc::primitive_desc(mkldnn::memory::desc const&, mkldnn::engine const&) in Conv.cpp.o \"_mkldnn_memory_primitive_desc_equal\", referenced from: at::native::mkldnn_convolution(at::Tensor const&, at::Tensor const&, at::Tensor const&, at::ArrayRef<long long>, at::ArrayRef<long long>, at::ArrayRef<long long>, long long) in Conv.cpp.o at::native::mkldnn_convolution_backward_input(at::ArrayRef<long long>, at::Tensor const&, at::Tensor const&, at::ArrayRef<long long>, at::ArrayRef<long long>, at::ArrayRef<long long>, long long, bool) in Conv.cpp.o at::native::mkldnn_convolution_backward_weights(at::ArrayRef<long long>, at::Tensor const&, at::Tensor const&, at::ArrayRef<long long>, at::ArrayRef<long long>, at::ArrayRef<long long>, long long, bool) in Conv.cpp.o \"_mkldnn_memory_primitive_desc_get_size\", referenced from: mkldnn::memory::memory(mkldnn::memory::primitive_desc const&) in Conv.cpp.o \"_mkldnn_memory_set_data_handle\", referenced from: mkldnn::memory::memory(mkldnn::memory::primitive_desc const&, void*) in Conv.cpp.o mkldnn::memory::memory(mkldnn::memory::primitive_desc const&) in Conv.cpp.o \"_mkldnn_primitive_at\", referenced from: at::native::mkldnn_convolution(at::Tensor const&, at::Tensor const&, at::Tensor const&, at::ArrayRef<long long>, at::ArrayRef<long long>, at::ArrayRef<long long>, long long) in Conv.cpp.o at::native::mkldnn_convolution_backward_input(at::ArrayRef<long long>, at::Tensor const&, at::Tensor const&, at::ArrayRef<long long>, at::ArrayRef<long long>, at::ArrayRef<long long>, long long, bool) in Conv.cpp.o at::native::mkldnn_convolution_backward_weights(at::ArrayRef<long long>, at::Tensor const&, at::Tensor const&, at::ArrayRef<long long>, at::ArrayRef<long long>, at::ArrayRef<long long>, long long, bool) in Conv.cpp.o \"_mkldnn_primitive_create\", referenced from: mkldnn::memory::memory(mkldnn::memory::primitive_desc const&, void*) in Conv.cpp.o mkldnn::memory::memory(mkldnn::memory::primitive_desc const&) in Conv.cpp.o mkldnn::reorder::reorder(mkldnn::primitive::at const&, mkldnn::memory const&) in Conv.cpp.o mkldnn::convolution_forward::convolution_forward(mkldnn::convolution_forward::primitive_desc const&, mkldnn::primitive::at const&, mkldnn::primitive::at const&, mkldnn::primitive::at const&, mkldnn::memory const&) in Conv.cpp.o mkldnn::convolution_forward::convolution_forward(mkldnn::convolution_forward::primitive_desc const&, mkldnn::primitive::at const&, mkldnn::primitive::at const&, mkldnn::memory const&) in Conv.cpp.o mkldnn::convolution_backward_data::convolution_backward_data(mkldnn::convolution_backward_data::primitive_desc const&, mkldnn::primitive::at const&, mkldnn::primitive::at const&, mkldnn::memory const&) in Conv.cpp.o mkldnn::convolution_backward_weights::convolution_backward_weights(mkldnn::convolution_backward_weights::primitive_desc const&, mkldnn::primitive::at const&, mkldnn::primitive::at const&, mkldnn::memory const&, mkldnn::memory const&) in Conv.cpp.o ... \"_mkldnn_primitive_desc_clone\", referenced from: mkldnn::convolution_forward::primitive_desc::src_primitive_desc() const in Conv.cpp.o mkldnn::convolution_forward::primitive_desc::weights_primitive_desc() const in Conv.cpp.o mkldnn::convolution_forward::primitive_desc::dst_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::diff_dst_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::weights_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::diff_src_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_weights::primitive_desc::src_primitive_desc() const in Conv.cpp.o ... \"_mkldnn_primitive_desc_create\", referenced from: mkldnn::convolution_forward::primitive_desc::primitive_desc(mkldnn::convolution_forward::desc const&, mkldnn::engine const&) in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::primitive_desc(mkldnn::convolution_backward_data::desc const&, mkldnn::engine const&, mkldnn::convolution_forward::primitive_desc const&) in Conv.cpp.o mkldnn::convolution_backward_weights::primitive_desc::primitive_desc(mkldnn::convolution_backward_weights::desc const&, mkldnn::engine const&, mkldnn::convolution_forward::primitive_desc const&) in Conv.cpp.o \"_mkldnn_primitive_desc_destroy\", referenced from: mkldnn::convolution_forward::primitive_desc::src_primitive_desc() const in Conv.cpp.o mkldnn::convolution_forward::primitive_desc::weights_primitive_desc() const in Conv.cpp.o mkldnn::convolution_forward::primitive_desc::dst_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::diff_dst_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::weights_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::diff_src_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_weights::primitive_desc::src_primitive_desc() const in Conv.cpp.o ... \"_mkldnn_primitive_desc_query_pd\", referenced from: mkldnn::convolution_forward::primitive_desc::src_primitive_desc() const in Conv.cpp.o mkldnn::convolution_forward::primitive_desc::weights_primitive_desc() const in Conv.cpp.o mkldnn::convolution_forward::primitive_desc::dst_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::diff_dst_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::weights_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_data::primitive_desc::diff_src_primitive_desc() const in Conv.cpp.o mkldnn::convolution_backward_weights::primitive_desc::src_primitive_desc() const in Conv.cpp.o ... \"_mkldnn_primitive_desc_query_s32\", referenced from: mkldnn::check_num_parameters(mkldnn_primitive_desc const* const&, int, int, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&) in Conv.cpp.o \"_mkldnn_primitive_destroy\", referenced from: mkldnn::handle<mkldnn_primitive*, mkldnn::handle_traits<mkldnn_primitive*> >::handle(mkldnn_primitive*, bool) in Conv.cpp.o mkldnn::memory::memory(mkldnn::memory::primitive_desc const&, void*) in Conv.cpp.o mkldnn::memory::memory(mkldnn::memory::primitive_desc const&) in Conv.cpp.o mkldnn::reorder::reorder(mkldnn::primitive::at const&, mkldnn::memory const&) in Conv.cpp.o mkldnn::convolution_forward::convolution_forward(mkldnn::convolution_forward::primitive_desc const&, mkldnn::primitive::at const&, mkldnn::primitive::at const&, mkldnn::primitive::at const&, mkldnn::memory const&) in Conv.cpp.o mkldnn::convolution_forward::convolution_forward(mkldnn::convolution_forward::primitive_desc const&, mkldnn::primitive::at const&, mkldnn::primitive::at const&, mkldnn::memory const&) in Conv.cpp.o mkldnn::convolution_backward_data::convolution_backward_data(mkldnn::convolution_backward_data::primitive_desc const&, mkldnn::primitive::at const&, mkldnn::primitive::at const&, mkldnn::memory const&) in Conv.cpp.o ... \"_mkldnn_primitive_get_output\", referenced from: mkldnn::reorder::reorder(mkldnn::primitive::at const&, mkldnn::memory const&) in Conv.cpp.o \"_mkldnn_primitive_get_primitive_desc\", referenced from: mkldnn::memory::get_primitive_desc() const in Conv.cpp.o \"_mkldnn_reorder_primitive_desc_create\", referenced from: mkldnn::reorder::primitive_desc::primitive_desc(mkldnn::memory::primitive_desc const&, mkldnn::memory::primitive_desc const&) in Conv.cpp.o \"_mkldnn_stream_create\", referenced from: mkldnn::stream::stream(mkldnn::stream::kind) in Conv.cpp.o \"_mkldnn_stream_destroy\", referenced from: mkldnn::stream::stream(mkldnn::stream::kind) in Conv.cpp.o \"_mkldnn_stream_submit\", referenced from: mkldnn::stream::submit(std::__1::vector<mkldnn::primitive, std::__1::allocator<mkldnn::primitive> >) in Conv.cpp.o ld: symbol(s) not found for architecture x86_64 clang: error: linker command failed with exit code 1 (use -v to see invocation) make[2]: *** [lib/libcaffe2.dylib] Error 1 make[1]: *** [caffe2/CMakeFiles/caffe2.dir/all] Error 2 make: *** [all] Error 2 Failed to run 'bash ../tools/build_pytorch_libs.sh --use-nnpack --use-mkldnn caffe2 nanopb libshm THD'\nTried applying patch from #9474 but the outcome is the same.\nMy mkl-dnn is v0.16 (https://github.com/intel/mkl-dnn/releases/tag/v0.16) and is located with same /lib and /include directory as mkl itself.", "body": "I am having similar issue.\r\n\r\n**System Info**\r\nPyTorch or Caffe2: PyTorch\r\nHow you installed PyTorch (conda, pip, source): source\r\nBuild command you used (if compiling from source):\r\n\r\n`MACOSX_DEPLOYMENT_TARGET=10.9 CC=clang CXX=clang++ NOCUDA=1 USE_OPENCV=1 USE_MKL=1 python setup.py bdist_wheel`\r\n\r\n**Summary of configuration is:**\r\n\r\n`-- General:\r\n--   CMake version         : 3.12.1\r\n--   CMake command         : /usr/local/Cellar/cmake/3.12.1/bin/cmake\r\n--   Git version           :\r\n--   System                : Darwin\r\n--   C++ compiler          : /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang++\r\n--   C++ compiler version  : 9.1.0.9020039\r\n--   BLAS                  : MKL\r\n--   CXX flags             :   -msse4.1 -msse4.2   --std=c++11  -Wno-deprecated -fvisibility-inlines-hidden -rdynamic -Wno-deprecated-declarations -DONNX_NAMESPACE=onnx_torch -O2 -fPIC -Wno-narrowing -Wall -Wextra -Wno-missing-field-initializers -Wno-type-limits -Wno-array-bounds -Wno-unknown-pragmas -Wno-sign-compare -Wno-unused-parameter -Wno-unused-variable -Wno-unused-function -Wno-unused-result -Wno-strict-overflow -Wno-strict-aliasing -Wno-error=deprecated-declarations -Wno-stringop-overflow -Wno-invalid-partial-specialization -Wno-typedef-redefinition -Wno-unknown-warning-option -Wno-unused-private-field -Wno-inconsistent-missing-override -Wno-aligned-allocation-unavailable -Wno-c++14-extensions -Wno-constexpr-not-const -Wno-missing-braces -Qunused-arguments -faligned-new\r\n--   Build type            : Release\r\n--   Compile definitions   : USE_GCC_ATOMICS=1;TH_BLAS_MKL;HAVE_MMAP=1;_FILE_OFFSET_BITS=64;HAVE_SHM_OPEN=1;HAVE_SHM_UNLINK=1\r\n--   CMAKE_PREFIX_PATH     : /Users/arseni/.pyenv/versions/3.6.6/lib/python3.6/site-packages\r\n--   CMAKE_INSTALL_PREFIX  : /Users/arseni/projects/frameworks/pytorch/torch/lib/tmp_install\r\n--   BUILD_CAFFE2          : 0\r\n--   BUILD_ATEN_MOBILE     : OFF\r\n--   BUILD_BINARY          : OFF\r\n--   BUILD_CUSTOM_PROTOBUF : ON\r\n--   Link local protobuf : ON\r\n--   BUILD_PYTHON          : 0\r\n--   BUILD_SHARED_LIBS     : ON\r\n--   BUILD_TEST            : OFF\r\n--   USE_ASAN              : OFF\r\n--   USE_CUDA              : 0\r\n--   USE_ROCM              : OFF\r\n--   USE_EIGEN_FOR_BLAS    :\r\n--   USE_FFMPEG            : OFF\r\n--   USE_GFLAGS            : OFF\r\n--   USE_GLOG              : OFF\r\n--   USE_GLOO              : OFF\r\n--   USE_LEVELDB           : OFF\r\n--   USE_LITE_PROTO        : OFF\r\n--   USE_LMDB              : OFF\r\n--   USE_METAL             : OFF\r\n--   USE_MKL               :\r\n--   USE_MOBILE_OPENGL     : OFF\r\n--   USE_MPI               : OFF\r\n--   USE_NCCL              : OFF\r\n--   USE_NERVANA_GPU       : OFF\r\n--   USE_NNPACK            : 1\r\n--   USE_OBSERVERS         : OFF\r\n--   USE_OPENCL            : OFF\r\n--   USE_OPENCV            : OFF\r\n--   USE_OPENMP            : OFF\r\n--   USE_PROF              : OFF\r\n--   USE_REDIS             : OFF\r\n--   USE_ROCKSDB           : OFF\r\n--   USE_ZMQ               : OFF\r\n--   USE_DISTRIBUTED       : OFF\r\n--   Public Dependencies  : /opt/intel/compilers_and_libraries_2018.3.185/mac/mkl/lib/libmkl_intel_lp64.dylib;/opt/intel/compilers_and_libraries_2018.3.185/mac/mkl/lib/libmkl_intel_thread.dylib;/opt/intel/compilers_and_libraries_2018.3.185/mac/mkl/lib/libmkl_core.dylib;/opt/intel/compilers_and_libraries_2018.3.185/mac/mkl/lib/libiomp5.dylib;/usr/lib/libpthread.dylib;/usr/lib/libm.dylib\r\n--   Private Dependencies : nnpack;cpuinfo;onnxifi_loader\r\n-- Configuring done`\r\n\r\nThe error trace I get is:\r\n`[ 81%] Linking CXX shared library ../lib/libcaffe2.dylib\r\nld: warning: directory not found for option '-L/Users/arseni/projects/frameworks/pytorch/torch/lib/tmp_install/lib'\r\nUndefined symbols for architecture x86_64:\r\n  \"_mkldnn_convolution_backward_data_desc_init\", referenced from:\r\n      mkldnn::convolution_backward_data::desc::desc(mkldnn::algorithm, mkldnn::memory::desc const&, mkldnn::memory::desc const&, mkldnn::memory::desc const&, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, mkldnn::padding_kind) in Conv.cpp.o\r\n  \"_mkldnn_convolution_backward_weights_desc_init\", referenced from:\r\n      mkldnn::convolution_backward_weights::desc::desc(mkldnn::algorithm, mkldnn::memory::desc const&, mkldnn::memory::desc const&, mkldnn::memory::desc const&, mkldnn::memory::desc const&, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, mkldnn::padding_kind) in Conv.cpp.o\r\n      mkldnn::convolution_backward_weights::desc::desc(mkldnn::algorithm, mkldnn::memory::desc const&, mkldnn::memory::desc const&, mkldnn::memory::desc const&, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, mkldnn::padding_kind) in Conv.cpp.o\r\n  \"_mkldnn_convolution_forward_desc_init\", referenced from:\r\n      mkldnn::convolution_forward::desc::desc(mkldnn::prop_kind, mkldnn::algorithm, mkldnn::memory::desc const&, mkldnn::memory::desc const&, mkldnn::memory::desc const&, mkldnn::memory::desc const&, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, mkldnn::padding_kind) in Conv.cpp.o\r\n      mkldnn::convolution_forward::desc::desc(mkldnn::prop_kind, mkldnn::algorithm, mkldnn::memory::desc const&, mkldnn::memory::desc const&, mkldnn::memory::desc const&, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, std::__1::vector<int, std::__1::allocator<int> >, mkldnn::padding_kind) in Conv.cpp.o\r\n  \"_mkldnn_engine_create\", referenced from:\r\n      mkldnn::engine::engine(mkldnn::engine::kind, unsigned long) in Conv.cpp.o\r\n  \"_mkldnn_engine_destroy\", referenced from:\r\n      mkldnn::engine::engine(mkldnn::engine::kind, unsigned long) in Conv.cpp.o\r\n  \"_mkldnn_memory_desc_init\", referenced from:\r\n      mkldnn::memory::desc::desc(std::__1::vector<int, std::__1::allocator<int> >, mkldnn::memory::data_type, mkldnn::memory::format) in Conv.cpp.o\r\n  \"_mkldnn_memory_primitive_desc_create\", referenced from:\r\n      mkldnn::memory::primitive_desc::primitive_desc(mkldnn::memory::desc const&, mkldnn::engine const&) in Conv.cpp.o\r\n  \"_mkldnn_memory_primitive_desc_equal\", referenced from:\r\n      at::native::mkldnn_convolution(at::Tensor const&, at::Tensor const&, at::Tensor const&, at::ArrayRef<long long>, at::ArrayRef<long long>, at::ArrayRef<long long>, long long) in Conv.cpp.o\r\n      at::native::mkldnn_convolution_backward_input(at::ArrayRef<long long>, at::Tensor const&, at::Tensor const&, at::ArrayRef<long long>, at::ArrayRef<long long>, at::ArrayRef<long long>, long long, bool) in Conv.cpp.o\r\n      at::native::mkldnn_convolution_backward_weights(at::ArrayRef<long long>, at::Tensor const&, at::Tensor const&, at::ArrayRef<long long>, at::ArrayRef<long long>, at::ArrayRef<long long>, long long, bool) in Conv.cpp.o\r\n  \"_mkldnn_memory_primitive_desc_get_size\", referenced from:\r\n      mkldnn::memory::memory(mkldnn::memory::primitive_desc const&) in Conv.cpp.o\r\n  \"_mkldnn_memory_set_data_handle\", referenced from:\r\n      mkldnn::memory::memory(mkldnn::memory::primitive_desc const&, void*) in Conv.cpp.o\r\n      mkldnn::memory::memory(mkldnn::memory::primitive_desc const&) in Conv.cpp.o\r\n  \"_mkldnn_primitive_at\", referenced from:\r\n      at::native::mkldnn_convolution(at::Tensor const&, at::Tensor const&, at::Tensor const&, at::ArrayRef<long long>, at::ArrayRef<long long>, at::ArrayRef<long long>, long long) in Conv.cpp.o\r\n      at::native::mkldnn_convolution_backward_input(at::ArrayRef<long long>, at::Tensor const&, at::Tensor const&, at::ArrayRef<long long>, at::ArrayRef<long long>, at::ArrayRef<long long>, long long, bool) in Conv.cpp.o\r\n      at::native::mkldnn_convolution_backward_weights(at::ArrayRef<long long>, at::Tensor const&, at::Tensor const&, at::ArrayRef<long long>, at::ArrayRef<long long>, at::ArrayRef<long long>, long long, bool) in Conv.cpp.o\r\n  \"_mkldnn_primitive_create\", referenced from:\r\n      mkldnn::memory::memory(mkldnn::memory::primitive_desc const&, void*) in Conv.cpp.o\r\n      mkldnn::memory::memory(mkldnn::memory::primitive_desc const&) in Conv.cpp.o\r\n      mkldnn::reorder::reorder(mkldnn::primitive::at const&, mkldnn::memory const&) in Conv.cpp.o\r\n      mkldnn::convolution_forward::convolution_forward(mkldnn::convolution_forward::primitive_desc const&, mkldnn::primitive::at const&, mkldnn::primitive::at const&, mkldnn::primitive::at const&, mkldnn::memory const&) in Conv.cpp.o\r\n      mkldnn::convolution_forward::convolution_forward(mkldnn::convolution_forward::primitive_desc const&, mkldnn::primitive::at const&, mkldnn::primitive::at const&, mkldnn::memory const&) in Conv.cpp.o\r\n      mkldnn::convolution_backward_data::convolution_backward_data(mkldnn::convolution_backward_data::primitive_desc const&, mkldnn::primitive::at const&, mkldnn::primitive::at const&, mkldnn::memory const&) in Conv.cpp.o\r\n      mkldnn::convolution_backward_weights::convolution_backward_weights(mkldnn::convolution_backward_weights::primitive_desc const&, mkldnn::primitive::at const&, mkldnn::primitive::at const&, mkldnn::memory const&, mkldnn::memory const&) in Conv.cpp.o\r\n      ...\r\n  \"_mkldnn_primitive_desc_clone\", referenced from:\r\n      mkldnn::convolution_forward::primitive_desc::src_primitive_desc() const in Conv.cpp.o\r\n      mkldnn::convolution_forward::primitive_desc::weights_primitive_desc() const in Conv.cpp.o\r\n      mkldnn::convolution_forward::primitive_desc::dst_primitive_desc() const in Conv.cpp.o\r\n      mkldnn::convolution_backward_data::primitive_desc::diff_dst_primitive_desc() const in Conv.cpp.o\r\n      mkldnn::convolution_backward_data::primitive_desc::weights_primitive_desc() const in Conv.cpp.o\r\n      mkldnn::convolution_backward_data::primitive_desc::diff_src_primitive_desc() const in Conv.cpp.o\r\n      mkldnn::convolution_backward_weights::primitive_desc::src_primitive_desc() const in Conv.cpp.o\r\n      ...\r\n  \"_mkldnn_primitive_desc_create\", referenced from:\r\n      mkldnn::convolution_forward::primitive_desc::primitive_desc(mkldnn::convolution_forward::desc const&, mkldnn::engine const&) in Conv.cpp.o\r\n      mkldnn::convolution_backward_data::primitive_desc::primitive_desc(mkldnn::convolution_backward_data::desc const&, mkldnn::engine const&, mkldnn::convolution_forward::primitive_desc const&) in Conv.cpp.o\r\n      mkldnn::convolution_backward_weights::primitive_desc::primitive_desc(mkldnn::convolution_backward_weights::desc const&, mkldnn::engine const&, mkldnn::convolution_forward::primitive_desc const&) in Conv.cpp.o\r\n  \"_mkldnn_primitive_desc_destroy\", referenced from:\r\n      mkldnn::convolution_forward::primitive_desc::src_primitive_desc() const in Conv.cpp.o\r\n      mkldnn::convolution_forward::primitive_desc::weights_primitive_desc() const in Conv.cpp.o\r\n      mkldnn::convolution_forward::primitive_desc::dst_primitive_desc() const in Conv.cpp.o\r\n      mkldnn::convolution_backward_data::primitive_desc::diff_dst_primitive_desc() const in Conv.cpp.o\r\n      mkldnn::convolution_backward_data::primitive_desc::weights_primitive_desc() const in Conv.cpp.o\r\n      mkldnn::convolution_backward_data::primitive_desc::diff_src_primitive_desc() const in Conv.cpp.o\r\n      mkldnn::convolution_backward_weights::primitive_desc::src_primitive_desc() const in Conv.cpp.o\r\n      ...\r\n  \"_mkldnn_primitive_desc_query_pd\", referenced from:\r\n      mkldnn::convolution_forward::primitive_desc::src_primitive_desc() const in Conv.cpp.o\r\n      mkldnn::convolution_forward::primitive_desc::weights_primitive_desc() const in Conv.cpp.o\r\n      mkldnn::convolution_forward::primitive_desc::dst_primitive_desc() const in Conv.cpp.o\r\n      mkldnn::convolution_backward_data::primitive_desc::diff_dst_primitive_desc() const in Conv.cpp.o\r\n      mkldnn::convolution_backward_data::primitive_desc::weights_primitive_desc() const in Conv.cpp.o\r\n      mkldnn::convolution_backward_data::primitive_desc::diff_src_primitive_desc() const in Conv.cpp.o\r\n      mkldnn::convolution_backward_weights::primitive_desc::src_primitive_desc() const in Conv.cpp.o\r\n      ...\r\n  \"_mkldnn_primitive_desc_query_s32\", referenced from:\r\n      mkldnn::check_num_parameters(mkldnn_primitive_desc const* const&, int, int, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&) in Conv.cpp.o\r\n  \"_mkldnn_primitive_destroy\", referenced from:\r\n      mkldnn::handle<mkldnn_primitive*, mkldnn::handle_traits<mkldnn_primitive*> >::handle(mkldnn_primitive*, bool) in Conv.cpp.o\r\n      mkldnn::memory::memory(mkldnn::memory::primitive_desc const&, void*) in Conv.cpp.o\r\n      mkldnn::memory::memory(mkldnn::memory::primitive_desc const&) in Conv.cpp.o\r\n      mkldnn::reorder::reorder(mkldnn::primitive::at const&, mkldnn::memory const&) in Conv.cpp.o\r\n      mkldnn::convolution_forward::convolution_forward(mkldnn::convolution_forward::primitive_desc const&, mkldnn::primitive::at const&, mkldnn::primitive::at const&, mkldnn::primitive::at const&, mkldnn::memory const&) in Conv.cpp.o\r\n      mkldnn::convolution_forward::convolution_forward(mkldnn::convolution_forward::primitive_desc const&, mkldnn::primitive::at const&, mkldnn::primitive::at const&, mkldnn::memory const&) in Conv.cpp.o\r\n      mkldnn::convolution_backward_data::convolution_backward_data(mkldnn::convolution_backward_data::primitive_desc const&, mkldnn::primitive::at const&, mkldnn::primitive::at const&, mkldnn::memory const&) in Conv.cpp.o\r\n      ...\r\n  \"_mkldnn_primitive_get_output\", referenced from:\r\n      mkldnn::reorder::reorder(mkldnn::primitive::at const&, mkldnn::memory const&) in Conv.cpp.o\r\n  \"_mkldnn_primitive_get_primitive_desc\", referenced from:\r\n      mkldnn::memory::get_primitive_desc() const in Conv.cpp.o\r\n  \"_mkldnn_reorder_primitive_desc_create\", referenced from:\r\n      mkldnn::reorder::primitive_desc::primitive_desc(mkldnn::memory::primitive_desc const&, mkldnn::memory::primitive_desc const&) in Conv.cpp.o\r\n  \"_mkldnn_stream_create\", referenced from:\r\n      mkldnn::stream::stream(mkldnn::stream::kind) in Conv.cpp.o\r\n  \"_mkldnn_stream_destroy\", referenced from:\r\n      mkldnn::stream::stream(mkldnn::stream::kind) in Conv.cpp.o\r\n  \"_mkldnn_stream_submit\", referenced from:\r\n      mkldnn::stream::submit(std::__1::vector<mkldnn::primitive, std::__1::allocator<mkldnn::primitive> >) in Conv.cpp.o\r\nld: symbol(s) not found for architecture x86_64\r\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\r\nmake[2]: *** [lib/libcaffe2.dylib] Error 1\r\nmake[1]: *** [caffe2/CMakeFiles/caffe2.dir/all] Error 2\r\nmake: *** [all] Error 2\r\nFailed to run 'bash ../tools/build_pytorch_libs.sh --use-nnpack --use-mkldnn caffe2 nanopb libshm THD'`\r\n\r\nTried applying patch from https://github.com/pytorch/pytorch/pull/9474 but the outcome is the same.\r\n\r\nMy mkl-dnn is v0.16 (https://github.com/intel/mkl-dnn/releases/tag/v0.16) and is located with same /lib and /include directory as mkl itself."}