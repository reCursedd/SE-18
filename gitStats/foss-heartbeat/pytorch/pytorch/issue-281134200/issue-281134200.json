{"url": "https://api.github.com/repos/pytorch/pytorch/issues/4120", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/4120/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/4120/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/4120/events", "html_url": "https://github.com/pytorch/pytorch/issues/4120", "id": 281134200, "node_id": "MDU6SXNzdWUyODExMzQyMDA=", "number": 4120, "title": "Kill NN buffers harder", "user": {"login": "ezyang", "id": 13564, "node_id": "MDQ6VXNlcjEzNTY0", "avatar_url": "https://avatars0.githubusercontent.com/u/13564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ezyang", "html_url": "https://github.com/ezyang", "followers_url": "https://api.github.com/users/ezyang/followers", "following_url": "https://api.github.com/users/ezyang/following{/other_user}", "gists_url": "https://api.github.com/users/ezyang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ezyang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ezyang/subscriptions", "organizations_url": "https://api.github.com/users/ezyang/orgs", "repos_url": "https://api.github.com/users/ezyang/repos", "events_url": "https://api.github.com/users/ezyang/events{/privacy}", "received_events_url": "https://api.github.com/users/ezyang/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2017-12-11T19:12:49Z", "updated_at": "2017-12-11T20:41:00Z", "closed_at": null, "author_association": "CONTRIBUTOR", "body_html": "<p>In <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"280661552\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/4096\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/4096/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/4096\">#4096</a>, we are unable to delete all of the special-casing for NN because of buffers. <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=655866\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/colesbury\">@colesbury</a> has an idea for how to get rid of buffer parameters from NN entirely. The design:</p>\n<ul>\n<li>Intuitively, buffers should be returned from forwards, and taken as arguments to backwards</li>\n<li>Since you don't want to actually see the buffers if you're an ordinary user, there should be a NATIVE function <code>foo</code>, which invokes <code>foo_forward</code> that actually implements a derivative</li>\n</ul>\n<p>Now we no longer need to know about the correspondence between <code>foo_forward</code> and <code>foo</code> because the implementation of <code>foo</code> is acceptable for both Tensor and Variable.</p>\n<p>This will require reworking how NN codegen in ATen works, because you need to actually generate <code>foo</code> as a native function now (and not the way it is right now.) We recommend merging <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"280661552\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/4096\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/4096/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/4096\">#4096</a> before working on this. CC <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=191033\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/lantiga\">@lantiga</a></p>", "body_text": "In #4096, we are unable to delete all of the special-casing for NN because of buffers. @colesbury has an idea for how to get rid of buffer parameters from NN entirely. The design:\n\nIntuitively, buffers should be returned from forwards, and taken as arguments to backwards\nSince you don't want to actually see the buffers if you're an ordinary user, there should be a NATIVE function foo, which invokes foo_forward that actually implements a derivative\n\nNow we no longer need to know about the correspondence between foo_forward and foo because the implementation of foo is acceptable for both Tensor and Variable.\nThis will require reworking how NN codegen in ATen works, because you need to actually generate foo as a native function now (and not the way it is right now.) We recommend merging #4096 before working on this. CC @lantiga", "body": "In #4096, we are unable to delete all of the special-casing for NN because of buffers. @colesbury has an idea for how to get rid of buffer parameters from NN entirely. The design:\r\n\r\n* Intuitively, buffers should be returned from forwards, and taken as arguments to backwards\r\n* Since you don't want to actually see the buffers if you're an ordinary user, there should be a NATIVE function `foo`, which invokes `foo_forward` that actually implements a derivative\r\n\r\nNow we no longer need to know about the correspondence between `foo_forward` and `foo` because the implementation of `foo` is acceptable for both Tensor and Variable.\r\n\r\nThis will require reworking how NN codegen in ATen works, because you need to actually generate `foo` as a native function now (and not the way it is right now.) We recommend merging #4096 before working on this. CC @lantiga "}