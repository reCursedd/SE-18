{"url": "https://api.github.com/repos/pytorch/pytorch/issues/4674", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/4674/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/4674/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/4674/events", "html_url": "https://github.com/pytorch/pytorch/issues/4674", "id": 288624934, "node_id": "MDU6SXNzdWUyODg2MjQ5MzQ=", "number": 4674, "title": "How to load net structure of the model and its parameters from the pretrained  *.pth with Pytrch?", "user": {"login": "TaihuLight", "id": 19910729, "node_id": "MDQ6VXNlcjE5OTEwNzI5", "avatar_url": "https://avatars3.githubusercontent.com/u/19910729?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TaihuLight", "html_url": "https://github.com/TaihuLight", "followers_url": "https://api.github.com/users/TaihuLight/followers", "following_url": "https://api.github.com/users/TaihuLight/following{/other_user}", "gists_url": "https://api.github.com/users/TaihuLight/gists{/gist_id}", "starred_url": "https://api.github.com/users/TaihuLight/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TaihuLight/subscriptions", "organizations_url": "https://api.github.com/users/TaihuLight/orgs", "repos_url": "https://api.github.com/users/TaihuLight/repos", "events_url": "https://api.github.com/users/TaihuLight/events{/privacy}", "received_events_url": "https://api.github.com/users/TaihuLight/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-01-15T15:07:55Z", "updated_at": "2018-05-29T14:54:25Z", "closed_at": "2018-01-15T20:30:22Z", "author_association": "NONE", "body_html": "<p>I trained the model with matconvnet code, and convert the model  to PyTorch from MatConvNet model with the tool <a href=\"url\">https://github.com/albanie/pytorch-mcn</a>, and the converted models can be download from <a href=\"http://www.robots.ox.ac.uk/%7Ealbanie/pytorch-models.html#pedestrian-alginment\" rel=\"nofollow\">http://www.robots.ox.ac.uk/%7Ealbanie/pytorch-models.html#pedestrian-alginment</a><br>\n<a href=\"url\">https://github.com/albanie/pytorch-mcn/issues/1</a></p>\n<p>I hope to load the net structure and modify parts of layers, and use the parameters of other layers in the converted model. How can I load the net structure of the model and its parameters with Pytorch  from the pretrained  pedestrian-alginment.pth?</p>\n<p>I write the follow code, but it get the errors: I think the error arises from the wrong defined model variable? I should define a empty net object or how to correct it?<br>\nimport torchvision.models as models<br>\nimport torch<br>\nimport torch.nn as nn</p>\n<p>pretrained=False<br>\nmodel = models.resnet50(pretrained)<br>\nmodelpath=\"/home/chengzi/Downloads/netvlad_v103/pre-trained-models/pedestrian_alignment.pth\"<br>\ncheckpoint = torch.load(modelpath)<br>\nnet=model.load_state_dict(checkpoint)<br>\nprint(net)`</p>\n<p>Traceback (most recent call last):<br>\nFile \"/home/chengzi/workspace/demo/model_s.py\", line 13, in<br>\nnet=model.load_state_dict(checkpoint)<br>\nFile \"/usr/local/lib/python3.5/dist-packages/torch/nn/modules/module.py\", line 490, in load_state_dict<br>\n.format(name))<br>\nKeyError: 'unexpected key \"conv1.bias\" in state_dict'</p>", "body_text": "I trained the model with matconvnet code, and convert the model  to PyTorch from MatConvNet model with the tool https://github.com/albanie/pytorch-mcn, and the converted models can be download from http://www.robots.ox.ac.uk/%7Ealbanie/pytorch-models.html#pedestrian-alginment\nhttps://github.com/albanie/pytorch-mcn/issues/1\nI hope to load the net structure and modify parts of layers, and use the parameters of other layers in the converted model. How can I load the net structure of the model and its parameters with Pytorch  from the pretrained  pedestrian-alginment.pth?\nI write the follow code, but it get the errors: I think the error arises from the wrong defined model variable? I should define a empty net object or how to correct it?\nimport torchvision.models as models\nimport torch\nimport torch.nn as nn\npretrained=False\nmodel = models.resnet50(pretrained)\nmodelpath=\"/home/chengzi/Downloads/netvlad_v103/pre-trained-models/pedestrian_alignment.pth\"\ncheckpoint = torch.load(modelpath)\nnet=model.load_state_dict(checkpoint)\nprint(net)`\nTraceback (most recent call last):\nFile \"/home/chengzi/workspace/demo/model_s.py\", line 13, in\nnet=model.load_state_dict(checkpoint)\nFile \"/usr/local/lib/python3.5/dist-packages/torch/nn/modules/module.py\", line 490, in load_state_dict\n.format(name))\nKeyError: 'unexpected key \"conv1.bias\" in state_dict'", "body": "I trained the model with matconvnet code, and convert the model  to PyTorch from MatConvNet model with the tool [https://github.com/albanie/pytorch-mcn](url), and the converted models can be download from http://www.robots.ox.ac.uk/%7Ealbanie/pytorch-models.html#pedestrian-alginment\r\n[https://github.com/albanie/pytorch-mcn/issues/1](url)\r\n\r\nI hope to load the net structure and modify parts of layers, and use the parameters of other layers in the converted model. How can I load the net structure of the model and its parameters with Pytorch  from the pretrained  pedestrian-alginment.pth?\r\n\r\nI write the follow code, but it get the errors: I think the error arises from the wrong defined model variable? I should define a empty net object or how to correct it?\r\nimport torchvision.models as models\r\nimport torch\r\nimport torch.nn as nn\r\n\r\npretrained=False\r\nmodel = models.resnet50(pretrained)\r\nmodelpath=\"/home/chengzi/Downloads/netvlad_v103/pre-trained-models/pedestrian_alignment.pth\"\r\ncheckpoint = torch.load(modelpath)\r\nnet=model.load_state_dict(checkpoint)\r\nprint(net)`\r\n\r\nTraceback (most recent call last):\r\nFile \"/home/chengzi/workspace/demo/model_s.py\", line 13, in\r\nnet=model.load_state_dict(checkpoint)\r\nFile \"/usr/local/lib/python3.5/dist-packages/torch/nn/modules/module.py\", line 490, in load_state_dict\r\n.format(name))\r\nKeyError: 'unexpected key \"conv1.bias\" in state_dict'\r\n"}