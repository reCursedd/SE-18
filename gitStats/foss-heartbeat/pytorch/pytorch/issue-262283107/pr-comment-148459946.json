{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/148459946", "pull_request_review_id": 73703779, "id": 148459946, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0ODQ1OTk0Ng==", "diff_hunk": "@@ -4005,11 +4005,16 @@ def test_serialization(self):\n         b += [(t1.storage(), t1.storage(), t2.storage())]\n         b += [a[0].storage()[0:2]]\n         for use_name in (False, True):\n-            with tempfile.NamedTemporaryFile() as f:\n+            delete = sys.platform != 'win32' or not use_name\n+            with tempfile.NamedTemporaryFile(delete=delete) as f:\n                 handle = f if not use_name else f.name\n                 torch.save(b, handle)\n                 f.seek(0)\n                 c = torch.load(handle)\n+                if not delete:\n+                    del handle\n+                    f.close()\n+                    os.remove(f.name)", "path": "test/test_torch.py", "position": null, "original_position": 14, "commit_id": "bb39f23252a1ccd7465eb20a76c4de3d4ea80f52", "original_commit_id": "ee3f275a11ec4b4728255e7d9d4728072d8cb76f", "user": {"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}, "body": "So I still don't understand why is this necessary. The Python issue you linked mentions that if you want to re-open the same file for reading, then you have to close it first. However in here, none of these two things happen, and you do `os.remove()` at the end anyway (which seems like exactly what `delete=True` would do)", "created_at": "2017-11-02T07:46:18Z", "updated_at": "2018-11-23T15:35:52Z", "html_url": "https://github.com/pytorch/pytorch/pull/2941#discussion_r148459946", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/2941", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/148459946"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/2941#discussion_r148459946"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/2941"}}, "body_html": "<p>So I still don't understand why is this necessary. The Python issue you linked mentions that if you want to re-open the same file for reading, then you have to close it first. However in here, none of these two things happen, and you do <code>os.remove()</code> at the end anyway (which seems like exactly what <code>delete=True</code> would do)</p>", "body_text": "So I still don't understand why is this necessary. The Python issue you linked mentions that if you want to re-open the same file for reading, then you have to close it first. However in here, none of these two things happen, and you do os.remove() at the end anyway (which seems like exactly what delete=True would do)"}