{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/308172909", "html_url": "https://github.com/pytorch/pytorch/issues/1791#issuecomment-308172909", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/1791", "id": 308172909, "node_id": "MDEyOklzc3VlQ29tbWVudDMwODE3MjkwOQ==", "user": {"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}, "created_at": "2017-06-13T16:27:24Z", "updated_at": "2017-06-13T16:27:24Z", "author_association": "MEMBER", "body_html": "<p>So it seems to me that a simple way to improve the perf is to:</p>\n<ol>\n<li>get rid of all masks<br>\n1a. do batched <code>triu</code>, <code>tril</code> (should be fairly simple to add)<br>\n1b. do <code>L[::L.size(1) + 1] = 1</code> to fill the diagonal (zero memory copy)</li>\n<li>use <code>scatter_</code> (perhaps it's possible to batch the ops using some tricks)</li>\n</ol>", "body_text": "So it seems to me that a simple way to improve the perf is to:\n\nget rid of all masks\n1a. do batched triu, tril (should be fairly simple to add)\n1b. do L[::L.size(1) + 1] = 1 to fill the diagonal (zero memory copy)\nuse scatter_ (perhaps it's possible to batch the ops using some tricks)", "body": "So it seems to me that a simple way to improve the perf is to:\r\n1. get rid of all masks\r\n  1a. do batched `triu`, `tril` (should be fairly simple to add)\r\n  1b. do `L[::L.size(1) + 1] = 1` to fill the diagonal (zero memory copy)\r\n2. use `scatter_` (perhaps it's possible to batch the ops using some tricks)\r\n"}