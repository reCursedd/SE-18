{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/395130027", "html_url": "https://github.com/pytorch/pytorch/pull/8171#issuecomment-395130027", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/8171", "id": 395130027, "node_id": "MDEyOklzc3VlQ29tbWVudDM5NTEzMDAyNw==", "user": {"login": "cpuhrsch", "id": 1716488, "node_id": "MDQ6VXNlcjE3MTY0ODg=", "avatar_url": "https://avatars1.githubusercontent.com/u/1716488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cpuhrsch", "html_url": "https://github.com/cpuhrsch", "followers_url": "https://api.github.com/users/cpuhrsch/followers", "following_url": "https://api.github.com/users/cpuhrsch/following{/other_user}", "gists_url": "https://api.github.com/users/cpuhrsch/gists{/gist_id}", "starred_url": "https://api.github.com/users/cpuhrsch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cpuhrsch/subscriptions", "organizations_url": "https://api.github.com/users/cpuhrsch/orgs", "repos_url": "https://api.github.com/users/cpuhrsch/repos", "events_url": "https://api.github.com/users/cpuhrsch/events{/privacy}", "received_events_url": "https://api.github.com/users/cpuhrsch/received_events", "type": "User", "site_admin": false}, "created_at": "2018-06-06T16:24:59Z", "updated_at": "2018-06-06T16:24:59Z", "author_association": "CONTRIBUTOR", "body_html": "<p>I just ran the ASAN CI job locally again and got the previous ASAN bug. So we shouldn't merge this.</p>\n<p>It'd be good if someone could try reproducing this locally as well. It's important to set OMP_NUM_THREADS and MKL_NUM_THREADS to a higher value than 4 to get this error. I got the image <a href=\"https://ci.pytorch.org/jenkins/job/pytorch-builds/job/pytorch-linux-xenial-py3-clang5-asan-trigger/6176/\" rel=\"nofollow\">from the ASAN CI job</a>.</p>\n<p>To run</p>\n<pre><code>sudo docker run --rm --cap-add=SYS_PTRACE --cpuset-cpus=20-39 --security-opt seccomp=unconfined -t -u jenkins -i --runtime=nvidia -e CUDA_VERSION=8 -e NVIDIA_VISIBLE_DEVICES=all 308535385114.dkr.ecr.us-east-1.amazonaws.com/pytorch/pytorch-linux-xenial-py3-clang5-asan:206-6176 /bin/bash\n</code></pre>\n<pre><code>enkins@4cdabd09ff5e:~/workspace$ python test/test_torch.py TestTorch.test_cpu_parallel\n.\n----------------------------------------------------------------------\nRan 1 test in 0.640s\n\nOK\n=================================================================\n==315==ERROR: AddressSanitizer: heap-use-after-free on address 0x61600064ff4a at pc 0x7f03c734f573 bp 0x7f032c1add60 sp 0x7f032c1add58\nREAD of size 1 at 0x61600064ff4a thread T39\n==315==AddressSanitizer: while reporting a bug found another one. Ignoring.\n==315==AddressSanitizer: while reporting a bug found another one. Ignoring.\n==315==AddressSanitizer: while reporting a bug found another one. Ignoring.\n    #0 0x7f03c734f572 in tbb::internal::generic_scheduler::is_worker() const /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.h:571:26\n    #1 0x7f03c7362528 in tbb::internal::generic_scheduler::master_outermost_level() const /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.h:551:13\n    #2 0x7f03c7362057 in tbb::task_scheduler_init::internal_terminate(bool) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/governor.cpp:349:13\n    #3 0x7f03c7362176 in tbb::task_scheduler_init::terminate() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/governor.cpp:359:5\n    #4 0x7f03c578e720 in tbb::task_scheduler_init::~task_scheduler_init() /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/task_scheduler_init.h:132:13\n    #5 0x7f03db581cce in (anonymous namespace)::run(void*) /opt/conda/conda-bld/compilers_linux-64_1520532893746/work/.build/src/gcc-7.2.0/libstdc++-v3/libsupc++/atexit_thread.cc:75\n    #6 0x7f03dc511438 in __nptl_deallocate_tsd.part.4 (/lib/x86_64-linux-gnu/libpthread.so.0+0x6438)\n    #7 0x7f03dc51286f in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x786f)\n    #8 0x7f03dc24841c in clone /build/glibc-Cl5G7W/glibc-2.23/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:109\n\n0x61600064ff4a is located 202 bytes inside of 520-byte region [0x61600064fe80,0x616000650088)\nfreed by thread T39 here:\n    #0 0x7f03dc82fcc0 in __interceptor_cfree (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x107cc0)\n    #1 0x7f03c735be13 in tbb::internal::padded_free(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/cache_aligned_allocator.cpp:226:9\n    #2 0x7f03c735c043 in tbb::internal::NFS_Free(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/cache_aligned_allocator.cpp:205:5\n    #3 0x7f03c7380c45 in tbb::internal::generic_scheduler::free_scheduler() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:295:9\n    #4 0x7f03c738491e in tbb::internal::generic_scheduler::cleanup_worker(void*, bool) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:1208:7\n    #5 0x7f03c7374540 in tbb::internal::market::cleanup(rml::job&amp;) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/market.cpp:734:9\n    #6 0x7f03c737b558 in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:285:15\n    #7 0x7f03c737b0b9 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\n    #8 0x7f03dc5126b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\n\npreviously allocated by thread T39 here:\n    #0 0x7f03dc82fe88 in malloc (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x107e88)\n    #1 0x7f03c735bd47 in tbb::internal::padded_allocate(unsigned long, unsigned long) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/cache_aligned_allocator.cpp:210:43\n    #2 0x7f03c735bff9 in tbb::internal::NFS_Allocate(unsigned long, unsigned long, void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/cache_aligned_allocator.cpp:196:20\n    #3 0x7f03c7385315 in tbb::internal::custom_scheduler&lt;tbb::internal::IntelSchedulerTraits&gt;::allocate_scheduler(tbb::internal::market&amp;) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/custom_scheduler.h:118:19\n    #4 0x7f03c73892ef in tbb::internal::allocate_scheduler(tbb::internal::market&amp;) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:42:12\n    #5 0x7f03c7384278 in tbb::internal::generic_scheduler::create_worker(tbb::internal::market&amp;, unsigned long) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:1147:28\n    #6 0x7f03c7374611 in tbb::internal::market::create_one_job() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/market.cpp:747:28\n    #7 0x7f03c737b2b3 in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:267:32\n    #8 0x7f03c737b0b9 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\n    #9 0x7f03dc5126b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\n\nThread T39 created by T31 here:\n    #0 0x7f03dc7873cd in pthread_create (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x5f3cd)\n    #1 0x7f03c737e6e4 in rml::internal::thread_monitor::launch(void* (*)(void*), void*, unsigned long) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/src/rml/include/../server/thread_monitor.h:221:12\n    #2 0x7f03c737d7da in tbb::internal::rml::private_worker::wake_or_launch() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:300:21\n    #3 0x7f03c737c68d in tbb::internal::rml::private_server::wake_some(int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:394:17\n    #4 0x7f03c737cef7 in tbb::internal::rml::private_server::propagate_chain_reaction() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:161:13\n    #5 0x7f03c737b20a in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:261:15\n    #6 0x7f03c737b0b9 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\n    #7 0x7f03dc5126b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\n\nThread T31 created by T25 here:\n    #0 0x7f03dc7873cd in pthread_create (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x5f3cd)\n    #1 0x7f03c737e6e4 in rml::internal::thread_monitor::launch(void* (*)(void*), void*, unsigned long) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/src/rml/include/../server/thread_monitor.h:221:12\n    #2 0x7f03c737d7da in tbb::internal::rml::private_worker::wake_or_launch() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:300:21\n    #3 0x7f03c737c68d in tbb::internal::rml::private_server::wake_some(int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:394:17\n    #4 0x7f03c737cef7 in tbb::internal::rml::private_server::propagate_chain_reaction() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:161:13\n    #5 0x7f03c737b20a in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:261:15\n    #6 0x7f03c737b0b9 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\n    #7 0x7f03dc5126b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\n\nThread T25 created by T0 here:\n    #0 0x7f03dc7873cd in pthread_create (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x5f3cd)\n    #1 0x7f03c737e6e4 in rml::internal::thread_monitor::launch(void* (*)(void*), void*, unsigned long) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/src/rml/include/../server/thread_monitor.h:221:12\n    #2 0x7f03c737d7da in tbb::internal::rml::private_worker::wake_or_launch() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:300:21\n    #3 0x7f03c737c68d in tbb::internal::rml::private_server::wake_some(int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:394:17\n    #4 0x7f03c737c7f1 in tbb::internal::rml::private_server::adjust_job_count_estimate(int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:404:9\n    #5 0x7f03c737439b in tbb::internal::market::adjust_demand(tbb::internal::arena&amp;, int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/market.cpp:678:16\n    #6 0x7f03c738744c in void tbb::internal::arena::advertise_new_work&lt;(tbb::internal::arena::new_work_type)0&gt;() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/arena.h:451:24\n    #7 0x7f03c7381596 in tbb::internal::generic_scheduler::local_spawn(tbb::task*, tbb::task*&amp;) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:648:15\n    #8 0x7f03c7381be8 in tbb::internal::generic_scheduler::spawn(tbb::task&amp;, tbb::task*&amp;) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:674:34\n    #9 0x7f03c7002853 in tbb::interface5::internal::task_base::spawn(tbb::task&amp;) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/internal/../task.h:995:23\n    #10 0x7f03c7002853 in tbb::interface9::internal::start_for&lt;tbb::blocked_range&lt;long&gt;, void at::parallel_for&lt;void at::native::(anonymous namespace)::_parallel_for&lt;at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}&gt;(long, long, bool, at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}&gt;(long, long, long, at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(tbb::blocked_range&lt;long&gt; const&amp;)#1}, tbb::affinity_partitioner&gt;::offer_work(tbb::proportional_split&amp;) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:122\n    #11 0x7f03c7002853 in void tbb::interface9::internal::partition_type_base&lt;tbb::interface9::internal::affinity_partition_type&gt;::execute&lt;tbb::interface9::internal::start_for&lt;tbb::blocked_range&lt;long&gt;, void at::parallel_for&lt;void at::native::(anonymous namespace)::_parallel_for&lt;at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}&gt;(long, long, bool, at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}&gt;(long, long, long, at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(tbb::blocked_range&lt;long&gt; const&amp;)#1}, tbb::affinity_partitioner&gt;, tbb::blocked_range&lt;long&gt; &gt;(at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}&amp;, tbb::blocked_range&lt;long&gt;&amp;) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/partitioner.h:253\n    #12 0x7f03c7002853 in tbb::interface9::internal::start_for&lt;tbb::blocked_range&lt;long&gt;, void at::parallel_for&lt;void at::native::(anonymous namespace)::_parallel_for&lt;at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}&gt;(long, long, bool, at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}&gt;(long, long, long, at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(tbb::blocked_range&lt;long&gt; const&amp;)#1}, tbb::affinity_partitioner&gt;::execute() /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:143\n    #13 0x7f03c7393455 in tbb::internal::custom_scheduler&lt;tbb::internal::IntelSchedulerTraits&gt;::local_wait_for_all(tbb::task&amp;, tbb::task*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/custom_scheduler.h:509:33\n    #14 0x7f03c7381ab8 in tbb::internal::generic_scheduler::local_spawn_root_and_wait(tbb::task*, tbb::task*&amp;) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:670:5\n    #15 0x7f03c7381c18 in tbb::internal::generic_scheduler::spawn_root_and_wait(tbb::task&amp;, tbb::task*&amp;) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:678:34\n    #16 0x7f03c6ffee71 in tbb::task::spawn_root_and_wait(tbb::task&amp;) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/internal/../task.h:752:30\n    #17 0x7f03c6ffee71 in tbb::interface9::internal::start_for&lt;tbb::blocked_range&lt;long&gt;, void at::parallel_for&lt;void at::native::(anonymous namespace)::_parallel_for&lt;at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}&gt;(long, long, bool, at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}&gt;(long, long, long, at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(tbb::blocked_range&lt;long&gt; const&amp;)#1}, tbb::affinity_partitioner&gt;::run(void at::native::(anonymous namespace)::_parallel_for&lt;at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}&gt;(long, long, bool, at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}, tbb::blocked_range&lt;long&gt; const&amp;, tbb::blocked_range&lt;long&gt; const&amp;) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:96\n    #18 0x7f03c6ffee71 in void tbb::parallel_for&lt;tbb::blocked_range&lt;long&gt;, void at::parallel_for&lt;void at::native::(anonymous namespace)::_parallel_for&lt;at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}&gt;(long, long, bool, at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}&gt;(long, long, long, at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(tbb::blocked_range&lt;long&gt; const&amp;)#1}&gt;(at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1} const&amp;, void at::parallel_for&lt;void at::native::(anonymous namespace)::_parallel_for&lt;at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}&gt;(long, long, bool, at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}&gt;(long, long, long, at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(tbb::blocked_range&lt;long&gt; const&amp;)#1} const&amp;, tbb::affinity_partitioner&amp;) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:230\n    #19 0x7f03c6ffee71 in void at::parallel_for&lt;void at::native::(anonymous namespace)::_parallel_for&lt;at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}&gt;(long, long, bool, at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}&gt;(long, long, long, at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}) /var/lib/jenkins/workspace/aten/src/ATen/Parallel.h:47\n    #20 0x7f03c6ffee71 in void at::native::(anonymous namespace)::_parallel_for&lt;at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}&gt;(long, long, bool, at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:23\n    #21 0x7f03c6ffee71 in at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::reduce2d(double const*, double*, long, long, long) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:120\n    #22 0x7f03c6ffee71 in at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::apply(at::Tensor&amp;, at::Tensor const&amp;, at::optional&lt;long&gt;)::{lambda(long)#1}::operator()(long) const /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:74\n    #23 0x7f03c6fe793a in void at::native::(anonymous namespace)::_parallel_for&lt;at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::apply(at::Tensor&amp;, at::Tensor const&amp;, at::optional&lt;long&gt;)::{lambda(long)#1}&gt;(long, long, bool, at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::apply(at::Tensor&amp;, at::Tensor const&amp;, at::optional&lt;long&gt;)::{lambda(long)#1}) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:31:7\n    #24 0x7f03c6fe793a in at::native::(anonymous namespace)::Reduction&lt;double, std::plus, 0&gt;::apply(at::Tensor&amp;, at::Tensor const&amp;, at::optional&lt;long&gt;) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:70\n    #25 0x7f03c6fe793a in at::native::(anonymous namespace)::sum_kernel_impl(at::Tensor&amp;, at::Tensor const&amp;, at::optional&lt;long&gt;)::$_0::operator()() const::{lambda()#3}::operator()() const /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:147\n    #26 0x7f03c6fe793a in at::native::(anonymous namespace)::sum_kernel_impl(at::Tensor&amp;, at::Tensor const&amp;, at::optional&lt;long&gt;)::$_0::operator()() const /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:147\n    #27 0x7f03c6fe793a in at::native::(anonymous namespace)::sum_kernel_impl(at::Tensor&amp;, at::Tensor const&amp;, at::optional&lt;long&gt;) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:147\n    #28 0x7f03c5897010 in void at::native::DispatchStub&lt;void (*)(at::Tensor&amp;, at::Tensor const&amp;, at::optional&lt;long&gt;)&gt;::operator()&lt;at::Tensor, at::Tensor, long&gt;(at::Tensor, at::Tensor, long) /var/lib/jenkins/workspace/aten/src/ATen/native/cpu/CapabilityDispatch.h:43:5\n    #29 0x7f03c5897010 in at::native::_sum_out_cpu(at::Tensor&amp;, at::Tensor const&amp;, long, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:182\n    #30 0x7f03c58a002e in at::native::_sum_out(at::Tensor&amp;, at::Tensor const&amp;, long, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:336:12\n    #31 0x7f03c58a002e in at::Tensor&amp; at::native::reduce_multi_associative_out&lt;&amp;at::native::_sum, &amp;at::native::_sum_out&gt;(at::Tensor&amp;, at::Tensor const&amp;, at::ArrayRef&lt;long&gt;, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:310\n    #32 0x7f03c589e38c in at::native::_sum_out(at::Tensor&amp;, at::Tensor const&amp;, at::ArrayRef&lt;long&gt;, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:346:10\n    #33 0x7f03c5f50d4b in at::Type::_sum_out(at::Tensor&amp;, at::Tensor const&amp;, at::ArrayRef&lt;long&gt;, bool) const /var/lib/jenkins/workspace/build/aten/src/ATen/Type.cpp:3976:13\n    #34 0x7f03c589abd2 in at::_sum_out(at::Tensor&amp;, at::Tensor const&amp;, at::ArrayRef&lt;long&gt;, bool) /var/lib/jenkins/workspace/build/aten/src/ATen/Functions.h:3732:29\n    #35 0x7f03c589abd2 in at::native::_sum(at::Tensor const&amp;, long, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:242\n    #36 0x7f03c589f5bd in at::Tensor at::native::reduce_multi_associative&lt;&amp;at::native::_sum&gt;(at::Tensor const&amp;, at::ArrayRef&lt;long&gt;, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:291:12\n    #37 0x7f03c589e371 in at::native::_sum(at::Tensor const&amp;, at::ArrayRef&lt;long&gt;, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:341:10\n    #38 0x7f03c5f50cad in at::Type::_sum(at::Tensor const&amp;, at::ArrayRef&lt;long&gt;, bool) const /var/lib/jenkins/workspace/build/aten/src/ATen/Type.cpp:3960:13\n    #39 0x7f03caa3afaa in torch::autograd::VariableType::_sum(at::Tensor const&amp;, at::ArrayRef&lt;long&gt;, bool) const /var/lib/jenkins/workspace/torch/csrc/autograd/generated/VariableType.cpp:27312:39\n    #40 0x7f03c589a704 in at::_sum(at::Tensor const&amp;, at::ArrayRef&lt;long&gt;, bool) /var/lib/jenkins/workspace/build/aten/src/ATen/Functions.h:3720:29\n    #41 0x7f03c589a704 in at::native::sum(at::Tensor const&amp;, at::ArrayRef&lt;long&gt;, bool, at::optional&lt;at::ScalarType&gt;) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:224\n    #42 0x7f03c589a704 in at::native::sum(at::Tensor const&amp;, at::ArrayRef&lt;long&gt;, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:232\n    #43 0x7f03c5f50c4d in at::Type::sum(at::Tensor const&amp;, at::ArrayRef&lt;long&gt;, bool) const /var/lib/jenkins/workspace/build/aten/src/ATen/Type.cpp:3952:13\n    #44 0x7f03caa39609 in torch::autograd::VariableType::sum(at::Tensor const&amp;, at::ArrayRef&lt;long&gt;, bool) const /var/lib/jenkins/workspace/torch/csrc/autograd/generated/VariableType.cpp:27278:23\n    #45 0x7f03cadc469f in at::Tensor::sum(at::ArrayRef&lt;long&gt;, bool) const /var/lib/jenkins/workspace/torch/lib/tmp_install/include/ATen/TensorMethods.h:1230:19\n    #46 0x7f03cb1e186b in torch::autograd::dispatch_sum(at::Tensor&amp;, at::ArrayRef&lt;long&gt;, bool) /var/lib/jenkins/workspace/torch/csrc/autograd/generated/python_variable_methods_dispatch.h:2354:15\n    #47 0x7f03cb175c02 in torch::autograd::THPVariable_sum(_object*, _object*, _object*) /var/lib/jenkins/workspace/torch/csrc/autograd/generated/python_variable_methods.cpp:4397:17\n    #48 0x558f904cf753 in _PyCFunction_FastCallDict (/opt/conda/bin/python3.6+0x10f753)\n\nSUMMARY: AddressSanitizer: heap-use-after-free /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.h:571:26 in tbb::internal::generic_scheduler::is_worker() const\nShadow bytes around the buggy address:\n  0x0c2c800c1f90: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c2c800c1fa0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c2c800c1fb0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c2c800c1fc0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c2c800c1fd0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n=&gt;0x0c2c800c1fe0: fd fd fd fd fd fd fd fd fd[fd]fd fd fd fd fd fd\n  0x0c2c800c1ff0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n  0x0c2c800c2000: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n  0x0c2c800c2010: fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c2c800c2020: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c2c800c2030: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\nShadow byte legend (one shadow byte represents 8 application bytes):\n  Addressable:           00\n  Partially addressable: 01 02 03 04 05 06 07\n  Heap left redzone:       fa\n  Freed heap region:       fd\n  Stack left redzone:      f1\n  Stack mid redzone:       f2\n  Stack right redzone:     f3\n  Stack after return:      f5\n  Stack use after scope:   f8\n  Global redzone:          f9\n  Global init order:       f6\n  Poisoned by user:        f7\n  Container overflow:      fc\n  Array cookie:            ac\n  Intra object redzone:    bb\n  ASan internal:           fe\n  Left alloca redzone:     ca\n  Right alloca redzone:    cb\n==315==ABORTING\n</code></pre>", "body_text": "I just ran the ASAN CI job locally again and got the previous ASAN bug. So we shouldn't merge this.\nIt'd be good if someone could try reproducing this locally as well. It's important to set OMP_NUM_THREADS and MKL_NUM_THREADS to a higher value than 4 to get this error. I got the image from the ASAN CI job.\nTo run\nsudo docker run --rm --cap-add=SYS_PTRACE --cpuset-cpus=20-39 --security-opt seccomp=unconfined -t -u jenkins -i --runtime=nvidia -e CUDA_VERSION=8 -e NVIDIA_VISIBLE_DEVICES=all 308535385114.dkr.ecr.us-east-1.amazonaws.com/pytorch/pytorch-linux-xenial-py3-clang5-asan:206-6176 /bin/bash\n\nenkins@4cdabd09ff5e:~/workspace$ python test/test_torch.py TestTorch.test_cpu_parallel\n.\n----------------------------------------------------------------------\nRan 1 test in 0.640s\n\nOK\n=================================================================\n==315==ERROR: AddressSanitizer: heap-use-after-free on address 0x61600064ff4a at pc 0x7f03c734f573 bp 0x7f032c1add60 sp 0x7f032c1add58\nREAD of size 1 at 0x61600064ff4a thread T39\n==315==AddressSanitizer: while reporting a bug found another one. Ignoring.\n==315==AddressSanitizer: while reporting a bug found another one. Ignoring.\n==315==AddressSanitizer: while reporting a bug found another one. Ignoring.\n    #0 0x7f03c734f572 in tbb::internal::generic_scheduler::is_worker() const /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.h:571:26\n    #1 0x7f03c7362528 in tbb::internal::generic_scheduler::master_outermost_level() const /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.h:551:13\n    #2 0x7f03c7362057 in tbb::task_scheduler_init::internal_terminate(bool) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/governor.cpp:349:13\n    #3 0x7f03c7362176 in tbb::task_scheduler_init::terminate() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/governor.cpp:359:5\n    #4 0x7f03c578e720 in tbb::task_scheduler_init::~task_scheduler_init() /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/task_scheduler_init.h:132:13\n    #5 0x7f03db581cce in (anonymous namespace)::run(void*) /opt/conda/conda-bld/compilers_linux-64_1520532893746/work/.build/src/gcc-7.2.0/libstdc++-v3/libsupc++/atexit_thread.cc:75\n    #6 0x7f03dc511438 in __nptl_deallocate_tsd.part.4 (/lib/x86_64-linux-gnu/libpthread.so.0+0x6438)\n    #7 0x7f03dc51286f in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x786f)\n    #8 0x7f03dc24841c in clone /build/glibc-Cl5G7W/glibc-2.23/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:109\n\n0x61600064ff4a is located 202 bytes inside of 520-byte region [0x61600064fe80,0x616000650088)\nfreed by thread T39 here:\n    #0 0x7f03dc82fcc0 in __interceptor_cfree (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x107cc0)\n    #1 0x7f03c735be13 in tbb::internal::padded_free(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/cache_aligned_allocator.cpp:226:9\n    #2 0x7f03c735c043 in tbb::internal::NFS_Free(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/cache_aligned_allocator.cpp:205:5\n    #3 0x7f03c7380c45 in tbb::internal::generic_scheduler::free_scheduler() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:295:9\n    #4 0x7f03c738491e in tbb::internal::generic_scheduler::cleanup_worker(void*, bool) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:1208:7\n    #5 0x7f03c7374540 in tbb::internal::market::cleanup(rml::job&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/market.cpp:734:9\n    #6 0x7f03c737b558 in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:285:15\n    #7 0x7f03c737b0b9 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\n    #8 0x7f03dc5126b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\n\npreviously allocated by thread T39 here:\n    #0 0x7f03dc82fe88 in malloc (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x107e88)\n    #1 0x7f03c735bd47 in tbb::internal::padded_allocate(unsigned long, unsigned long) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/cache_aligned_allocator.cpp:210:43\n    #2 0x7f03c735bff9 in tbb::internal::NFS_Allocate(unsigned long, unsigned long, void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/cache_aligned_allocator.cpp:196:20\n    #3 0x7f03c7385315 in tbb::internal::custom_scheduler<tbb::internal::IntelSchedulerTraits>::allocate_scheduler(tbb::internal::market&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/custom_scheduler.h:118:19\n    #4 0x7f03c73892ef in tbb::internal::allocate_scheduler(tbb::internal::market&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:42:12\n    #5 0x7f03c7384278 in tbb::internal::generic_scheduler::create_worker(tbb::internal::market&, unsigned long) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:1147:28\n    #6 0x7f03c7374611 in tbb::internal::market::create_one_job() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/market.cpp:747:28\n    #7 0x7f03c737b2b3 in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:267:32\n    #8 0x7f03c737b0b9 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\n    #9 0x7f03dc5126b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\n\nThread T39 created by T31 here:\n    #0 0x7f03dc7873cd in pthread_create (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x5f3cd)\n    #1 0x7f03c737e6e4 in rml::internal::thread_monitor::launch(void* (*)(void*), void*, unsigned long) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/src/rml/include/../server/thread_monitor.h:221:12\n    #2 0x7f03c737d7da in tbb::internal::rml::private_worker::wake_or_launch() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:300:21\n    #3 0x7f03c737c68d in tbb::internal::rml::private_server::wake_some(int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:394:17\n    #4 0x7f03c737cef7 in tbb::internal::rml::private_server::propagate_chain_reaction() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:161:13\n    #5 0x7f03c737b20a in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:261:15\n    #6 0x7f03c737b0b9 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\n    #7 0x7f03dc5126b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\n\nThread T31 created by T25 here:\n    #0 0x7f03dc7873cd in pthread_create (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x5f3cd)\n    #1 0x7f03c737e6e4 in rml::internal::thread_monitor::launch(void* (*)(void*), void*, unsigned long) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/src/rml/include/../server/thread_monitor.h:221:12\n    #2 0x7f03c737d7da in tbb::internal::rml::private_worker::wake_or_launch() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:300:21\n    #3 0x7f03c737c68d in tbb::internal::rml::private_server::wake_some(int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:394:17\n    #4 0x7f03c737cef7 in tbb::internal::rml::private_server::propagate_chain_reaction() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:161:13\n    #5 0x7f03c737b20a in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:261:15\n    #6 0x7f03c737b0b9 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\n    #7 0x7f03dc5126b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\n\nThread T25 created by T0 here:\n    #0 0x7f03dc7873cd in pthread_create (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x5f3cd)\n    #1 0x7f03c737e6e4 in rml::internal::thread_monitor::launch(void* (*)(void*), void*, unsigned long) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/src/rml/include/../server/thread_monitor.h:221:12\n    #2 0x7f03c737d7da in tbb::internal::rml::private_worker::wake_or_launch() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:300:21\n    #3 0x7f03c737c68d in tbb::internal::rml::private_server::wake_some(int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:394:17\n    #4 0x7f03c737c7f1 in tbb::internal::rml::private_server::adjust_job_count_estimate(int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:404:9\n    #5 0x7f03c737439b in tbb::internal::market::adjust_demand(tbb::internal::arena&, int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/market.cpp:678:16\n    #6 0x7f03c738744c in void tbb::internal::arena::advertise_new_work<(tbb::internal::arena::new_work_type)0>() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/arena.h:451:24\n    #7 0x7f03c7381596 in tbb::internal::generic_scheduler::local_spawn(tbb::task*, tbb::task*&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:648:15\n    #8 0x7f03c7381be8 in tbb::internal::generic_scheduler::spawn(tbb::task&, tbb::task*&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:674:34\n    #9 0x7f03c7002853 in tbb::interface5::internal::task_base::spawn(tbb::task&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/internal/../task.h:995:23\n    #10 0x7f03c7002853 in tbb::interface9::internal::start_for<tbb::blocked_range<long>, void at::parallel_for<void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}>(long, long, long, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(tbb::blocked_range<long> const&)#1}, tbb::affinity_partitioner>::offer_work(tbb::proportional_split&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:122\n    #11 0x7f03c7002853 in void tbb::interface9::internal::partition_type_base<tbb::interface9::internal::affinity_partition_type>::execute<tbb::interface9::internal::start_for<tbb::blocked_range<long>, void at::parallel_for<void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}>(long, long, long, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(tbb::blocked_range<long> const&)#1}, tbb::affinity_partitioner>, tbb::blocked_range<long> >(at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}&, tbb::blocked_range<long>&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/partitioner.h:253\n    #12 0x7f03c7002853 in tbb::interface9::internal::start_for<tbb::blocked_range<long>, void at::parallel_for<void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}>(long, long, long, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(tbb::blocked_range<long> const&)#1}, tbb::affinity_partitioner>::execute() /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:143\n    #13 0x7f03c7393455 in tbb::internal::custom_scheduler<tbb::internal::IntelSchedulerTraits>::local_wait_for_all(tbb::task&, tbb::task*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/custom_scheduler.h:509:33\n    #14 0x7f03c7381ab8 in tbb::internal::generic_scheduler::local_spawn_root_and_wait(tbb::task*, tbb::task*&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:670:5\n    #15 0x7f03c7381c18 in tbb::internal::generic_scheduler::spawn_root_and_wait(tbb::task&, tbb::task*&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:678:34\n    #16 0x7f03c6ffee71 in tbb::task::spawn_root_and_wait(tbb::task&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/internal/../task.h:752:30\n    #17 0x7f03c6ffee71 in tbb::interface9::internal::start_for<tbb::blocked_range<long>, void at::parallel_for<void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}>(long, long, long, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(tbb::blocked_range<long> const&)#1}, tbb::affinity_partitioner>::run(void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}, tbb::blocked_range<long> const&, tbb::blocked_range<long> const&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:96\n    #18 0x7f03c6ffee71 in void tbb::parallel_for<tbb::blocked_range<long>, void at::parallel_for<void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}>(long, long, long, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(tbb::blocked_range<long> const&)#1}>(at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1} const&, void at::parallel_for<void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}>(long, long, long, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(tbb::blocked_range<long> const&)#1} const&, tbb::affinity_partitioner&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:230\n    #19 0x7f03c6ffee71 in void at::parallel_for<void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}>(long, long, long, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}) /var/lib/jenkins/workspace/aten/src/ATen/Parallel.h:47\n    #20 0x7f03c6ffee71 in void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:23\n    #21 0x7f03c6ffee71 in at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:120\n    #22 0x7f03c6ffee71 in at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::apply(at::Tensor&, at::Tensor const&, at::optional<long>)::{lambda(long)#1}::operator()(long) const /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:74\n    #23 0x7f03c6fe793a in void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::apply(at::Tensor&, at::Tensor const&, at::optional<long>)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::apply(at::Tensor&, at::Tensor const&, at::optional<long>)::{lambda(long)#1}) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:31:7\n    #24 0x7f03c6fe793a in at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::apply(at::Tensor&, at::Tensor const&, at::optional<long>) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:70\n    #25 0x7f03c6fe793a in at::native::(anonymous namespace)::sum_kernel_impl(at::Tensor&, at::Tensor const&, at::optional<long>)::$_0::operator()() const::{lambda()#3}::operator()() const /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:147\n    #26 0x7f03c6fe793a in at::native::(anonymous namespace)::sum_kernel_impl(at::Tensor&, at::Tensor const&, at::optional<long>)::$_0::operator()() const /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:147\n    #27 0x7f03c6fe793a in at::native::(anonymous namespace)::sum_kernel_impl(at::Tensor&, at::Tensor const&, at::optional<long>) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:147\n    #28 0x7f03c5897010 in void at::native::DispatchStub<void (*)(at::Tensor&, at::Tensor const&, at::optional<long>)>::operator()<at::Tensor, at::Tensor, long>(at::Tensor, at::Tensor, long) /var/lib/jenkins/workspace/aten/src/ATen/native/cpu/CapabilityDispatch.h:43:5\n    #29 0x7f03c5897010 in at::native::_sum_out_cpu(at::Tensor&, at::Tensor const&, long, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:182\n    #30 0x7f03c58a002e in at::native::_sum_out(at::Tensor&, at::Tensor const&, long, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:336:12\n    #31 0x7f03c58a002e in at::Tensor& at::native::reduce_multi_associative_out<&at::native::_sum, &at::native::_sum_out>(at::Tensor&, at::Tensor const&, at::ArrayRef<long>, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:310\n    #32 0x7f03c589e38c in at::native::_sum_out(at::Tensor&, at::Tensor const&, at::ArrayRef<long>, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:346:10\n    #33 0x7f03c5f50d4b in at::Type::_sum_out(at::Tensor&, at::Tensor const&, at::ArrayRef<long>, bool) const /var/lib/jenkins/workspace/build/aten/src/ATen/Type.cpp:3976:13\n    #34 0x7f03c589abd2 in at::_sum_out(at::Tensor&, at::Tensor const&, at::ArrayRef<long>, bool) /var/lib/jenkins/workspace/build/aten/src/ATen/Functions.h:3732:29\n    #35 0x7f03c589abd2 in at::native::_sum(at::Tensor const&, long, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:242\n    #36 0x7f03c589f5bd in at::Tensor at::native::reduce_multi_associative<&at::native::_sum>(at::Tensor const&, at::ArrayRef<long>, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:291:12\n    #37 0x7f03c589e371 in at::native::_sum(at::Tensor const&, at::ArrayRef<long>, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:341:10\n    #38 0x7f03c5f50cad in at::Type::_sum(at::Tensor const&, at::ArrayRef<long>, bool) const /var/lib/jenkins/workspace/build/aten/src/ATen/Type.cpp:3960:13\n    #39 0x7f03caa3afaa in torch::autograd::VariableType::_sum(at::Tensor const&, at::ArrayRef<long>, bool) const /var/lib/jenkins/workspace/torch/csrc/autograd/generated/VariableType.cpp:27312:39\n    #40 0x7f03c589a704 in at::_sum(at::Tensor const&, at::ArrayRef<long>, bool) /var/lib/jenkins/workspace/build/aten/src/ATen/Functions.h:3720:29\n    #41 0x7f03c589a704 in at::native::sum(at::Tensor const&, at::ArrayRef<long>, bool, at::optional<at::ScalarType>) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:224\n    #42 0x7f03c589a704 in at::native::sum(at::Tensor const&, at::ArrayRef<long>, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:232\n    #43 0x7f03c5f50c4d in at::Type::sum(at::Tensor const&, at::ArrayRef<long>, bool) const /var/lib/jenkins/workspace/build/aten/src/ATen/Type.cpp:3952:13\n    #44 0x7f03caa39609 in torch::autograd::VariableType::sum(at::Tensor const&, at::ArrayRef<long>, bool) const /var/lib/jenkins/workspace/torch/csrc/autograd/generated/VariableType.cpp:27278:23\n    #45 0x7f03cadc469f in at::Tensor::sum(at::ArrayRef<long>, bool) const /var/lib/jenkins/workspace/torch/lib/tmp_install/include/ATen/TensorMethods.h:1230:19\n    #46 0x7f03cb1e186b in torch::autograd::dispatch_sum(at::Tensor&, at::ArrayRef<long>, bool) /var/lib/jenkins/workspace/torch/csrc/autograd/generated/python_variable_methods_dispatch.h:2354:15\n    #47 0x7f03cb175c02 in torch::autograd::THPVariable_sum(_object*, _object*, _object*) /var/lib/jenkins/workspace/torch/csrc/autograd/generated/python_variable_methods.cpp:4397:17\n    #48 0x558f904cf753 in _PyCFunction_FastCallDict (/opt/conda/bin/python3.6+0x10f753)\n\nSUMMARY: AddressSanitizer: heap-use-after-free /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.h:571:26 in tbb::internal::generic_scheduler::is_worker() const\nShadow bytes around the buggy address:\n  0x0c2c800c1f90: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c2c800c1fa0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c2c800c1fb0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c2c800c1fc0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c2c800c1fd0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n=>0x0c2c800c1fe0: fd fd fd fd fd fd fd fd fd[fd]fd fd fd fd fd fd\n  0x0c2c800c1ff0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n  0x0c2c800c2000: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n  0x0c2c800c2010: fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c2c800c2020: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c2c800c2030: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\nShadow byte legend (one shadow byte represents 8 application bytes):\n  Addressable:           00\n  Partially addressable: 01 02 03 04 05 06 07\n  Heap left redzone:       fa\n  Freed heap region:       fd\n  Stack left redzone:      f1\n  Stack mid redzone:       f2\n  Stack right redzone:     f3\n  Stack after return:      f5\n  Stack use after scope:   f8\n  Global redzone:          f9\n  Global init order:       f6\n  Poisoned by user:        f7\n  Container overflow:      fc\n  Array cookie:            ac\n  Intra object redzone:    bb\n  ASan internal:           fe\n  Left alloca redzone:     ca\n  Right alloca redzone:    cb\n==315==ABORTING", "body": "I just ran the ASAN CI job locally again and got the previous ASAN bug. So we shouldn't merge this.\r\n\r\nIt'd be good if someone could try reproducing this locally as well. It's important to set OMP_NUM_THREADS and MKL_NUM_THREADS to a higher value than 4 to get this error. I got the image [from the ASAN CI job](https://ci.pytorch.org/jenkins/job/pytorch-builds/job/pytorch-linux-xenial-py3-clang5-asan-trigger/6176/).\r\n\r\nTo run\r\n```\r\nsudo docker run --rm --cap-add=SYS_PTRACE --cpuset-cpus=20-39 --security-opt seccomp=unconfined -t -u jenkins -i --runtime=nvidia -e CUDA_VERSION=8 -e NVIDIA_VISIBLE_DEVICES=all 308535385114.dkr.ecr.us-east-1.amazonaws.com/pytorch/pytorch-linux-xenial-py3-clang5-asan:206-6176 /bin/bash\r\n```\r\n\r\n```\r\nenkins@4cdabd09ff5e:~/workspace$ python test/test_torch.py TestTorch.test_cpu_parallel\r\n.\r\n----------------------------------------------------------------------\r\nRan 1 test in 0.640s\r\n\r\nOK\r\n=================================================================\r\n==315==ERROR: AddressSanitizer: heap-use-after-free on address 0x61600064ff4a at pc 0x7f03c734f573 bp 0x7f032c1add60 sp 0x7f032c1add58\r\nREAD of size 1 at 0x61600064ff4a thread T39\r\n==315==AddressSanitizer: while reporting a bug found another one. Ignoring.\r\n==315==AddressSanitizer: while reporting a bug found another one. Ignoring.\r\n==315==AddressSanitizer: while reporting a bug found another one. Ignoring.\r\n    #0 0x7f03c734f572 in tbb::internal::generic_scheduler::is_worker() const /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.h:571:26\r\n    #1 0x7f03c7362528 in tbb::internal::generic_scheduler::master_outermost_level() const /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.h:551:13\r\n    #2 0x7f03c7362057 in tbb::task_scheduler_init::internal_terminate(bool) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/governor.cpp:349:13\r\n    #3 0x7f03c7362176 in tbb::task_scheduler_init::terminate() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/governor.cpp:359:5\r\n    #4 0x7f03c578e720 in tbb::task_scheduler_init::~task_scheduler_init() /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/task_scheduler_init.h:132:13\r\n    #5 0x7f03db581cce in (anonymous namespace)::run(void*) /opt/conda/conda-bld/compilers_linux-64_1520532893746/work/.build/src/gcc-7.2.0/libstdc++-v3/libsupc++/atexit_thread.cc:75\r\n    #6 0x7f03dc511438 in __nptl_deallocate_tsd.part.4 (/lib/x86_64-linux-gnu/libpthread.so.0+0x6438)\r\n    #7 0x7f03dc51286f in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x786f)\r\n    #8 0x7f03dc24841c in clone /build/glibc-Cl5G7W/glibc-2.23/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:109\r\n\r\n0x61600064ff4a is located 202 bytes inside of 520-byte region [0x61600064fe80,0x616000650088)\r\nfreed by thread T39 here:\r\n    #0 0x7f03dc82fcc0 in __interceptor_cfree (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x107cc0)\r\n    #1 0x7f03c735be13 in tbb::internal::padded_free(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/cache_aligned_allocator.cpp:226:9\r\n    #2 0x7f03c735c043 in tbb::internal::NFS_Free(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/cache_aligned_allocator.cpp:205:5\r\n    #3 0x7f03c7380c45 in tbb::internal::generic_scheduler::free_scheduler() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:295:9\r\n    #4 0x7f03c738491e in tbb::internal::generic_scheduler::cleanup_worker(void*, bool) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:1208:7\r\n    #5 0x7f03c7374540 in tbb::internal::market::cleanup(rml::job&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/market.cpp:734:9\r\n    #6 0x7f03c737b558 in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:285:15\r\n    #7 0x7f03c737b0b9 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\r\n    #8 0x7f03dc5126b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\r\n\r\npreviously allocated by thread T39 here:\r\n    #0 0x7f03dc82fe88 in malloc (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x107e88)\r\n    #1 0x7f03c735bd47 in tbb::internal::padded_allocate(unsigned long, unsigned long) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/cache_aligned_allocator.cpp:210:43\r\n    #2 0x7f03c735bff9 in tbb::internal::NFS_Allocate(unsigned long, unsigned long, void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/cache_aligned_allocator.cpp:196:20\r\n    #3 0x7f03c7385315 in tbb::internal::custom_scheduler<tbb::internal::IntelSchedulerTraits>::allocate_scheduler(tbb::internal::market&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/custom_scheduler.h:118:19\r\n    #4 0x7f03c73892ef in tbb::internal::allocate_scheduler(tbb::internal::market&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:42:12\r\n    #5 0x7f03c7384278 in tbb::internal::generic_scheduler::create_worker(tbb::internal::market&, unsigned long) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:1147:28\r\n    #6 0x7f03c7374611 in tbb::internal::market::create_one_job() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/market.cpp:747:28\r\n    #7 0x7f03c737b2b3 in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:267:32\r\n    #8 0x7f03c737b0b9 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\r\n    #9 0x7f03dc5126b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\r\n\r\nThread T39 created by T31 here:\r\n    #0 0x7f03dc7873cd in pthread_create (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x5f3cd)\r\n    #1 0x7f03c737e6e4 in rml::internal::thread_monitor::launch(void* (*)(void*), void*, unsigned long) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/src/rml/include/../server/thread_monitor.h:221:12\r\n    #2 0x7f03c737d7da in tbb::internal::rml::private_worker::wake_or_launch() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:300:21\r\n    #3 0x7f03c737c68d in tbb::internal::rml::private_server::wake_some(int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:394:17\r\n    #4 0x7f03c737cef7 in tbb::internal::rml::private_server::propagate_chain_reaction() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:161:13\r\n    #5 0x7f03c737b20a in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:261:15\r\n    #6 0x7f03c737b0b9 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\r\n    #7 0x7f03dc5126b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\r\n\r\nThread T31 created by T25 here:\r\n    #0 0x7f03dc7873cd in pthread_create (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x5f3cd)\r\n    #1 0x7f03c737e6e4 in rml::internal::thread_monitor::launch(void* (*)(void*), void*, unsigned long) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/src/rml/include/../server/thread_monitor.h:221:12\r\n    #2 0x7f03c737d7da in tbb::internal::rml::private_worker::wake_or_launch() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:300:21\r\n    #3 0x7f03c737c68d in tbb::internal::rml::private_server::wake_some(int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:394:17\r\n    #4 0x7f03c737cef7 in tbb::internal::rml::private_server::propagate_chain_reaction() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:161:13\r\n    #5 0x7f03c737b20a in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:261:15\r\n    #6 0x7f03c737b0b9 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\r\n    #7 0x7f03dc5126b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\r\n\r\nThread T25 created by T0 here:\r\n    #0 0x7f03dc7873cd in pthread_create (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x5f3cd)\r\n    #1 0x7f03c737e6e4 in rml::internal::thread_monitor::launch(void* (*)(void*), void*, unsigned long) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/src/rml/include/../server/thread_monitor.h:221:12\r\n    #2 0x7f03c737d7da in tbb::internal::rml::private_worker::wake_or_launch() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:300:21\r\n    #3 0x7f03c737c68d in tbb::internal::rml::private_server::wake_some(int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:394:17\r\n    #4 0x7f03c737c7f1 in tbb::internal::rml::private_server::adjust_job_count_estimate(int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:404:9\r\n    #5 0x7f03c737439b in tbb::internal::market::adjust_demand(tbb::internal::arena&, int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/market.cpp:678:16\r\n    #6 0x7f03c738744c in void tbb::internal::arena::advertise_new_work<(tbb::internal::arena::new_work_type)0>() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/arena.h:451:24\r\n    #7 0x7f03c7381596 in tbb::internal::generic_scheduler::local_spawn(tbb::task*, tbb::task*&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:648:15\r\n    #8 0x7f03c7381be8 in tbb::internal::generic_scheduler::spawn(tbb::task&, tbb::task*&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:674:34\r\n    #9 0x7f03c7002853 in tbb::interface5::internal::task_base::spawn(tbb::task&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/internal/../task.h:995:23\r\n    #10 0x7f03c7002853 in tbb::interface9::internal::start_for<tbb::blocked_range<long>, void at::parallel_for<void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}>(long, long, long, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(tbb::blocked_range<long> const&)#1}, tbb::affinity_partitioner>::offer_work(tbb::proportional_split&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:122\r\n    #11 0x7f03c7002853 in void tbb::interface9::internal::partition_type_base<tbb::interface9::internal::affinity_partition_type>::execute<tbb::interface9::internal::start_for<tbb::blocked_range<long>, void at::parallel_for<void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}>(long, long, long, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(tbb::blocked_range<long> const&)#1}, tbb::affinity_partitioner>, tbb::blocked_range<long> >(at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}&, tbb::blocked_range<long>&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/partitioner.h:253\r\n    #12 0x7f03c7002853 in tbb::interface9::internal::start_for<tbb::blocked_range<long>, void at::parallel_for<void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}>(long, long, long, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(tbb::blocked_range<long> const&)#1}, tbb::affinity_partitioner>::execute() /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:143\r\n    #13 0x7f03c7393455 in tbb::internal::custom_scheduler<tbb::internal::IntelSchedulerTraits>::local_wait_for_all(tbb::task&, tbb::task*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/custom_scheduler.h:509:33\r\n    #14 0x7f03c7381ab8 in tbb::internal::generic_scheduler::local_spawn_root_and_wait(tbb::task*, tbb::task*&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:670:5\r\n    #15 0x7f03c7381c18 in tbb::internal::generic_scheduler::spawn_root_and_wait(tbb::task&, tbb::task*&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:678:34\r\n    #16 0x7f03c6ffee71 in tbb::task::spawn_root_and_wait(tbb::task&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/internal/../task.h:752:30\r\n    #17 0x7f03c6ffee71 in tbb::interface9::internal::start_for<tbb::blocked_range<long>, void at::parallel_for<void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}>(long, long, long, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(tbb::blocked_range<long> const&)#1}, tbb::affinity_partitioner>::run(void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}, tbb::blocked_range<long> const&, tbb::blocked_range<long> const&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:96\r\n    #18 0x7f03c6ffee71 in void tbb::parallel_for<tbb::blocked_range<long>, void at::parallel_for<void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}>(long, long, long, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(tbb::blocked_range<long> const&)#1}>(at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1} const&, void at::parallel_for<void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}>(long, long, long, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(tbb::blocked_range<long> const&)#1} const&, tbb::affinity_partitioner&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:230\r\n    #19 0x7f03c6ffee71 in void at::parallel_for<void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1})::{lambda(long, long)#1}>(long, long, long, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}) /var/lib/jenkins/workspace/aten/src/ATen/Parallel.h:47\r\n    #20 0x7f03c6ffee71 in void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long)::{lambda(long)#1}) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:23\r\n    #21 0x7f03c6ffee71 in at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::reduce2d(double const*, double*, long, long, long) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:120\r\n    #22 0x7f03c6ffee71 in at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::apply(at::Tensor&, at::Tensor const&, at::optional<long>)::{lambda(long)#1}::operator()(long) const /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:74\r\n    #23 0x7f03c6fe793a in void at::native::(anonymous namespace)::_parallel_for<at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::apply(at::Tensor&, at::Tensor const&, at::optional<long>)::{lambda(long)#1}>(long, long, bool, at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::apply(at::Tensor&, at::Tensor const&, at::optional<long>)::{lambda(long)#1}) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:31:7\r\n    #24 0x7f03c6fe793a in at::native::(anonymous namespace)::Reduction<double, std::plus, 0>::apply(at::Tensor&, at::Tensor const&, at::optional<long>) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:70\r\n    #25 0x7f03c6fe793a in at::native::(anonymous namespace)::sum_kernel_impl(at::Tensor&, at::Tensor const&, at::optional<long>)::$_0::operator()() const::{lambda()#3}::operator()() const /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:147\r\n    #26 0x7f03c6fe793a in at::native::(anonymous namespace)::sum_kernel_impl(at::Tensor&, at::Tensor const&, at::optional<long>)::$_0::operator()() const /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:147\r\n    #27 0x7f03c6fe793a in at::native::(anonymous namespace)::sum_kernel_impl(at::Tensor&, at::Tensor const&, at::optional<long>) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/ReduceOpsKernel.cpp.AVX2.cpp:147\r\n    #28 0x7f03c5897010 in void at::native::DispatchStub<void (*)(at::Tensor&, at::Tensor const&, at::optional<long>)>::operator()<at::Tensor, at::Tensor, long>(at::Tensor, at::Tensor, long) /var/lib/jenkins/workspace/aten/src/ATen/native/cpu/CapabilityDispatch.h:43:5\r\n    #29 0x7f03c5897010 in at::native::_sum_out_cpu(at::Tensor&, at::Tensor const&, long, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:182\r\n    #30 0x7f03c58a002e in at::native::_sum_out(at::Tensor&, at::Tensor const&, long, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:336:12\r\n    #31 0x7f03c58a002e in at::Tensor& at::native::reduce_multi_associative_out<&at::native::_sum, &at::native::_sum_out>(at::Tensor&, at::Tensor const&, at::ArrayRef<long>, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:310\r\n    #32 0x7f03c589e38c in at::native::_sum_out(at::Tensor&, at::Tensor const&, at::ArrayRef<long>, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:346:10\r\n    #33 0x7f03c5f50d4b in at::Type::_sum_out(at::Tensor&, at::Tensor const&, at::ArrayRef<long>, bool) const /var/lib/jenkins/workspace/build/aten/src/ATen/Type.cpp:3976:13\r\n    #34 0x7f03c589abd2 in at::_sum_out(at::Tensor&, at::Tensor const&, at::ArrayRef<long>, bool) /var/lib/jenkins/workspace/build/aten/src/ATen/Functions.h:3732:29\r\n    #35 0x7f03c589abd2 in at::native::_sum(at::Tensor const&, long, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:242\r\n    #36 0x7f03c589f5bd in at::Tensor at::native::reduce_multi_associative<&at::native::_sum>(at::Tensor const&, at::ArrayRef<long>, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:291:12\r\n    #37 0x7f03c589e371 in at::native::_sum(at::Tensor const&, at::ArrayRef<long>, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:341:10\r\n    #38 0x7f03c5f50cad in at::Type::_sum(at::Tensor const&, at::ArrayRef<long>, bool) const /var/lib/jenkins/workspace/build/aten/src/ATen/Type.cpp:3960:13\r\n    #39 0x7f03caa3afaa in torch::autograd::VariableType::_sum(at::Tensor const&, at::ArrayRef<long>, bool) const /var/lib/jenkins/workspace/torch/csrc/autograd/generated/VariableType.cpp:27312:39\r\n    #40 0x7f03c589a704 in at::_sum(at::Tensor const&, at::ArrayRef<long>, bool) /var/lib/jenkins/workspace/build/aten/src/ATen/Functions.h:3720:29\r\n    #41 0x7f03c589a704 in at::native::sum(at::Tensor const&, at::ArrayRef<long>, bool, at::optional<at::ScalarType>) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:224\r\n    #42 0x7f03c589a704 in at::native::sum(at::Tensor const&, at::ArrayRef<long>, bool) /var/lib/jenkins/workspace/aten/src/ATen/native/ReduceOps.cpp:232\r\n    #43 0x7f03c5f50c4d in at::Type::sum(at::Tensor const&, at::ArrayRef<long>, bool) const /var/lib/jenkins/workspace/build/aten/src/ATen/Type.cpp:3952:13\r\n    #44 0x7f03caa39609 in torch::autograd::VariableType::sum(at::Tensor const&, at::ArrayRef<long>, bool) const /var/lib/jenkins/workspace/torch/csrc/autograd/generated/VariableType.cpp:27278:23\r\n    #45 0x7f03cadc469f in at::Tensor::sum(at::ArrayRef<long>, bool) const /var/lib/jenkins/workspace/torch/lib/tmp_install/include/ATen/TensorMethods.h:1230:19\r\n    #46 0x7f03cb1e186b in torch::autograd::dispatch_sum(at::Tensor&, at::ArrayRef<long>, bool) /var/lib/jenkins/workspace/torch/csrc/autograd/generated/python_variable_methods_dispatch.h:2354:15\r\n    #47 0x7f03cb175c02 in torch::autograd::THPVariable_sum(_object*, _object*, _object*) /var/lib/jenkins/workspace/torch/csrc/autograd/generated/python_variable_methods.cpp:4397:17\r\n    #48 0x558f904cf753 in _PyCFunction_FastCallDict (/opt/conda/bin/python3.6+0x10f753)\r\n\r\nSUMMARY: AddressSanitizer: heap-use-after-free /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.h:571:26 in tbb::internal::generic_scheduler::is_worker() const\r\nShadow bytes around the buggy address:\r\n  0x0c2c800c1f90: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x0c2c800c1fa0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x0c2c800c1fb0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x0c2c800c1fc0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x0c2c800c1fd0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n=>0x0c2c800c1fe0: fd fd fd fd fd fd fd fd fd[fd]fd fd fd fd fd fd\r\n  0x0c2c800c1ff0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n  0x0c2c800c2000: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n  0x0c2c800c2010: fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x0c2c800c2020: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x0c2c800c2030: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\nShadow byte legend (one shadow byte represents 8 application bytes):\r\n  Addressable:           00\r\n  Partially addressable: 01 02 03 04 05 06 07\r\n  Heap left redzone:       fa\r\n  Freed heap region:       fd\r\n  Stack left redzone:      f1\r\n  Stack mid redzone:       f2\r\n  Stack right redzone:     f3\r\n  Stack after return:      f5\r\n  Stack use after scope:   f8\r\n  Global redzone:          f9\r\n  Global init order:       f6\r\n  Poisoned by user:        f7\r\n  Container overflow:      fc\r\n  Array cookie:            ac\r\n  Intra object redzone:    bb\r\n  ASan internal:           fe\r\n  Left alloca redzone:     ca\r\n  Right alloca redzone:    cb\r\n==315==ABORTING\r\n```"}