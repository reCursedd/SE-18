{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/182310673", "pull_request_review_id": 113078633, "id": 182310673, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4MjMxMDY3Mw==", "diff_hunk": "@@ -137,23 +132,45 @@ def _export(model, args, f, export_params=True, verbose=False, training=False,\n         raise RuntimeError(\"state_dict changed after running the tracer; \"\n                            \"something weird is happening in your model!\")\n \n-    trace.set_graph(_optimize_graph(trace.graph(), aten))\n+    return trace.graph(), torch_out\n+\n+\n+# NOTE: the output `torch_out` will contain the output tensors resulting from\n+# the trace of a Module. In the case that a torch.nn.ScriptModule is passed in,\n+# this output will be None, since we are not doing any tracing but rather\n+# directly extracting the graph.\n+def _export(model, args, f, export_params=True, verbose=False, training=False,\n+            input_names=None, output_names=None, aten=False, export_type=ExportTypes.PROTOBUF_FILE):\n+    # Special case for common case of passing a single Variable\n+    if isinstance(args, torch.autograd.Variable):\n+        args = (args, )\n+\n+    if isinstance(model, torch.jit.ScriptModule):\n+        torch_out = None\n+        try:\n+            graph = model.__getattr__('forward').graph()\n+            graph.propagate_shapes(args, False)", "path": "torch/onnx/utils.py", "position": 36, "original_position": 36, "commit_id": "b7a83c278c7b21d96e24e4e19308c2eb942ccab2", "original_commit_id": "b7a83c278c7b21d96e24e4e19308c2eb942ccab2", "user": {"login": "zdevito", "id": 370202, "node_id": "MDQ6VXNlcjM3MDIwMg==", "avatar_url": "https://avatars0.githubusercontent.com/u/370202?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zdevito", "html_url": "https://github.com/zdevito", "followers_url": "https://api.github.com/users/zdevito/followers", "following_url": "https://api.github.com/users/zdevito/following{/other_user}", "gists_url": "https://api.github.com/users/zdevito/gists{/gist_id}", "starred_url": "https://api.github.com/users/zdevito/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zdevito/subscriptions", "organizations_url": "https://api.github.com/users/zdevito/orgs", "repos_url": "https://api.github.com/users/zdevito/repos", "events_url": "https://api.github.com/users/zdevito/events{/privacy}", "received_events_url": "https://api.github.com/users/zdevito/received_events", "type": "User", "site_admin": false}, "body": "I am pretty sure that `graph` is a graph of a script method, meaning it has extra inputs for all of the parameters it uses. So simply passing `args` here is not correct, it also needs to gather the parameters from the model.", "created_at": "2018-04-18T05:12:23Z", "updated_at": "2018-11-23T15:42:40Z", "html_url": "https://github.com/pytorch/pytorch/pull/6600#discussion_r182310673", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/6600", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/182310673"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/6600#discussion_r182310673"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/6600"}}, "body_html": "<p>I am pretty sure that <code>graph</code> is a graph of a script method, meaning it has extra inputs for all of the parameters it uses. So simply passing <code>args</code> here is not correct, it also needs to gather the parameters from the model.</p>", "body_text": "I am pretty sure that graph is a graph of a script method, meaning it has extra inputs for all of the parameters it uses. So simply passing args here is not correct, it also needs to gather the parameters from the model."}