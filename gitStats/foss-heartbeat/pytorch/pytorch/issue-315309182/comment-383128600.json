{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/383128600", "html_url": "https://github.com/pytorch/pytorch/issues/6694#issuecomment-383128600", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/6694", "id": 383128600, "node_id": "MDEyOklzc3VlQ29tbWVudDM4MzEyODYwMA==", "user": {"login": "fmassa", "id": 9110200, "node_id": "MDQ6VXNlcjkxMTAyMDA=", "avatar_url": "https://avatars2.githubusercontent.com/u/9110200?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fmassa", "html_url": "https://github.com/fmassa", "followers_url": "https://api.github.com/users/fmassa/followers", "following_url": "https://api.github.com/users/fmassa/following{/other_user}", "gists_url": "https://api.github.com/users/fmassa/gists{/gist_id}", "starred_url": "https://api.github.com/users/fmassa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fmassa/subscriptions", "organizations_url": "https://api.github.com/users/fmassa/orgs", "repos_url": "https://api.github.com/users/fmassa/repos", "events_url": "https://api.github.com/users/fmassa/events{/privacy}", "received_events_url": "https://api.github.com/users/fmassa/received_events", "type": "User", "site_admin": false}, "created_at": "2018-04-20T15:13:50Z", "updated_at": "2018-04-20T15:13:50Z", "author_association": "MEMBER", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=19693633\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/HMEIatJHU\">@HMEIatJHU</a> after the <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"316101459\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/6793\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/6793/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/6793\">#6793</a>, there is no more need to try to use <code>masked_fill</code> etc, and you can directly use indexing, as before.</p>\n<p>The only case where you could see some speedup by using those legacy functions is the case of <code>index_copy_</code> and <code>masked_scatter_</code>. So for example, in your case 2:</p>\n<div class=\"highlight highlight-source-python\"><pre>ind <span class=\"pl-k\">=</span> ind0 <span class=\"pl-k\">&amp;</span> ind1\na[ind] <span class=\"pl-k\">=</span> b[ind] <span class=\"pl-k\">+</span> c[ind]</pre></div>\n<p>You could have eventually better performances if you did</p>\n<div class=\"highlight highlight-source-python\"><pre>ind <span class=\"pl-k\">=</span> ind0 <span class=\"pl-k\">&amp;</span> ind1\nvalues <span class=\"pl-k\">=</span> b[ind] <span class=\"pl-k\">+</span> c[ind]\na.masked_scatter_(ind, values)</pre></div>\n<p>Could you have a look and verify if that changes a lot the runtime?</p>", "body_text": "@HMEIatJHU after the #6793, there is no more need to try to use masked_fill etc, and you can directly use indexing, as before.\nThe only case where you could see some speedup by using those legacy functions is the case of index_copy_ and masked_scatter_. So for example, in your case 2:\nind = ind0 & ind1\na[ind] = b[ind] + c[ind]\nYou could have eventually better performances if you did\nind = ind0 & ind1\nvalues = b[ind] + c[ind]\na.masked_scatter_(ind, values)\nCould you have a look and verify if that changes a lot the runtime?", "body": "@HMEIatJHU after the #6793, there is no more need to try to use `masked_fill` etc, and you can directly use indexing, as before.\r\n\r\nThe only case where you could see some speedup by using those legacy functions is the case of `index_copy_` and `masked_scatter_`. So for example, in your case 2:\r\n```python\r\nind = ind0 & ind1\r\na[ind] = b[ind] + c[ind]\r\n```\r\nYou could have eventually better performances if you did\r\n```python\r\nind = ind0 & ind1\r\nvalues = b[ind] + c[ind]\r\na.masked_scatter_(ind, values)\r\n```\r\n\r\nCould you have a look and verify if that changes a lot the runtime?"}