{"url": "https://api.github.com/repos/pytorch/pytorch/issues/5700", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/5700/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/5700/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/5700/events", "html_url": "https://github.com/pytorch/pytorch/issues/5700", "id": 304233149, "node_id": "MDU6SXNzdWUzMDQyMzMxNDk=", "number": 5700, "title": "nn.LSTM.cuda() leads to CuDNNError", "user": {"login": "jiacheng-xu", "id": 11880376, "node_id": "MDQ6VXNlcjExODgwMzc2", "avatar_url": "https://avatars2.githubusercontent.com/u/11880376?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jiacheng-xu", "html_url": "https://github.com/jiacheng-xu", "followers_url": "https://api.github.com/users/jiacheng-xu/followers", "following_url": "https://api.github.com/users/jiacheng-xu/following{/other_user}", "gists_url": "https://api.github.com/users/jiacheng-xu/gists{/gist_id}", "starred_url": "https://api.github.com/users/jiacheng-xu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jiacheng-xu/subscriptions", "organizations_url": "https://api.github.com/users/jiacheng-xu/orgs", "repos_url": "https://api.github.com/users/jiacheng-xu/repos", "events_url": "https://api.github.com/users/jiacheng-xu/events{/privacy}", "received_events_url": "https://api.github.com/users/jiacheng-xu/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-03-12T03:49:50Z", "updated_at": "2018-03-13T02:17:55Z", "closed_at": "2018-03-13T02:17:55Z", "author_association": "NONE", "body_html": "<ul>\n<li>\n<p>OS:<br>\nuname -a<br>\nLinux everest 4.4.0-104-generic <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"183170768\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/127\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/127/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/127\">#127</a>-Ubuntu SMP Mon Dec 11 12:16:42 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</p>\n</li>\n<li>\n<p>PyTorch version: 0.3.1.post2</p>\n</li>\n<li>\n<p>How you installed PyTorch (conda, pip, source): conda</p>\n</li>\n<li>\n<p>Python version: Python 3.6.4 |Anaconda, Inc.| (default, Jan 16 2018, 18:10:19)</p>\n</li>\n<li>\n<p>CUDA/cuDNN version:<br>\nnvcc --version<br>\nnvcc: NVIDIA (R) Cuda compiler driver<br>\nCopyright (c) 2005-2017 NVIDIA Corporation<br>\nBuilt on Fri_Sep__1_21:08:03_CDT_2017<br>\nCuda compilation tools, release 9.0, V9.0.176<br>\n--and--<br>\ncat /usr/local/cuda/include/cudnn.h | grep CUDNN_MAJOR -A 2<br>\n#define CUDNN_MAJOR 7<br>\n#define CUDNN_MINOR 0<br>\n#define CUDNN_PATCHLEVEL 5<br>\n#define CUDNN_VERSION    (CUDNN_MAJOR * 1000 + CUDNN_MINOR * 100 + CUDNN_PATCHLEVEL)</p>\n</li>\n<li>\n<p>GPU models and configuration: NVIDIA-SMI 384.111                Driver Version: 384.111<br>\ngpu is 1080ti and titan xp</p>\n</li>\n<li>\n<p>GCC version (if compiling from source): [GCC 7.2.0] on linux</p>\n</li>\n</ul>\n<hr>\n<p>Code:<br>\n<code>torch.backends.cudnn.enabled = False //&lt;--</code><br>\n<code>rnn = torch.nn.LSTM(5, 10, num_layers=1, batch_first=True)</code><br>\n<code>rnn.cuda()</code><br>\nResult: pass!</p>\n<hr>\n<p>Code:<br>\n<code>torch.backends.cudnn.enabled = True//&lt;--</code><br>\n<code>rnn = torch.nn.LSTM(5, 10, num_layers=1, batch_first=True)</code><br>\n<code>rnn.cuda()</code><br>\nResult:</p>\n<blockquote>\n<p>Traceback (most recent call last):<br>\nFile \"/home/user/main.py\", line 16, in <br>\nrnn.cuda()<br>\nFile \"/home/user/anaconda3/lib/python3.6/site-packages/torch/nn/modules/module.py\", line 216, in cuda<br>\nreturn self._apply(lambda t: t.cuda(device))<br>\nFile \"/home/user/anaconda3/lib/python3.6/site-packages/torch/nn/modules/rnn.py\", line 123, in _apply<br>\nself.flatten_parameters()<br>\nFile \"/home/user/anaconda3/lib/python3.6/site-packages/torch/nn/modules/rnn.py\", line 85, in flatten_parameters<br>\nhandle = cudnn.get_handle()<br>\nFile \"/home/user/anaconda3/lib/python3.6/site-packages/torch/backends/cudnn/<strong>init</strong>.py\", line 296, in get_handle<br>\nhandle = CuDNNHandle()<br>\nFile \"/home/user/anaconda3/lib/python3.6/site-packages/torch/backends/cudnn/<strong>init</strong>.py\", line 110, in <strong>init</strong><br>\ncheck_error(lib.cudnnCreate(ctypes.byref(ptr)))<br>\nFile \"/home/user/anaconda3/lib/python3.6/site-packages/torch/backends/cudnn/<strong>init</strong>.py\", line 283, in check_error<br>\nraise CuDNNError(status)<br>\ntorch.backends.cudnn.CuDNNError: 4: b'CUDNN_STATUS_INTERNAL_ERROR'<br>\nException ignored in: &lt;bound method CuDNNHandle.<strong>del</strong> of &lt;torch.backends.cudnn.CuDNNHandle object at 0x7f5f02e5a2b0&gt;&gt;<br>\nTraceback (most recent call last):<br>\nFile \"/home/user/anaconda3/lib/python3.6/site-packages/torch/backends/cudnn/<strong>init</strong>.py\", line 114, in <strong>del</strong><br>\ncheck_error(lib.cudnnDestroy(self))<br>\nctypes.ArgumentError: argument 1: &lt;class 'TypeError'&gt;: Don't know how to convert parameter 1</p>\n</blockquote>", "body_text": "OS:\nuname -a\nLinux everest 4.4.0-104-generic #127-Ubuntu SMP Mon Dec 11 12:16:42 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\n\n\nPyTorch version: 0.3.1.post2\n\n\nHow you installed PyTorch (conda, pip, source): conda\n\n\nPython version: Python 3.6.4 |Anaconda, Inc.| (default, Jan 16 2018, 18:10:19)\n\n\nCUDA/cuDNN version:\nnvcc --version\nnvcc: NVIDIA (R) Cuda compiler driver\nCopyright (c) 2005-2017 NVIDIA Corporation\nBuilt on Fri_Sep__1_21:08:03_CDT_2017\nCuda compilation tools, release 9.0, V9.0.176\n--and--\ncat /usr/local/cuda/include/cudnn.h | grep CUDNN_MAJOR -A 2\n#define CUDNN_MAJOR 7\n#define CUDNN_MINOR 0\n#define CUDNN_PATCHLEVEL 5\n#define CUDNN_VERSION    (CUDNN_MAJOR * 1000 + CUDNN_MINOR * 100 + CUDNN_PATCHLEVEL)\n\n\nGPU models and configuration: NVIDIA-SMI 384.111                Driver Version: 384.111\ngpu is 1080ti and titan xp\n\n\nGCC version (if compiling from source): [GCC 7.2.0] on linux\n\n\n\nCode:\ntorch.backends.cudnn.enabled = False //<--\nrnn = torch.nn.LSTM(5, 10, num_layers=1, batch_first=True)\nrnn.cuda()\nResult: pass!\n\nCode:\ntorch.backends.cudnn.enabled = True//<--\nrnn = torch.nn.LSTM(5, 10, num_layers=1, batch_first=True)\nrnn.cuda()\nResult:\n\nTraceback (most recent call last):\nFile \"/home/user/main.py\", line 16, in \nrnn.cuda()\nFile \"/home/user/anaconda3/lib/python3.6/site-packages/torch/nn/modules/module.py\", line 216, in cuda\nreturn self._apply(lambda t: t.cuda(device))\nFile \"/home/user/anaconda3/lib/python3.6/site-packages/torch/nn/modules/rnn.py\", line 123, in _apply\nself.flatten_parameters()\nFile \"/home/user/anaconda3/lib/python3.6/site-packages/torch/nn/modules/rnn.py\", line 85, in flatten_parameters\nhandle = cudnn.get_handle()\nFile \"/home/user/anaconda3/lib/python3.6/site-packages/torch/backends/cudnn/init.py\", line 296, in get_handle\nhandle = CuDNNHandle()\nFile \"/home/user/anaconda3/lib/python3.6/site-packages/torch/backends/cudnn/init.py\", line 110, in init\ncheck_error(lib.cudnnCreate(ctypes.byref(ptr)))\nFile \"/home/user/anaconda3/lib/python3.6/site-packages/torch/backends/cudnn/init.py\", line 283, in check_error\nraise CuDNNError(status)\ntorch.backends.cudnn.CuDNNError: 4: b'CUDNN_STATUS_INTERNAL_ERROR'\nException ignored in: <bound method CuDNNHandle.del of <torch.backends.cudnn.CuDNNHandle object at 0x7f5f02e5a2b0>>\nTraceback (most recent call last):\nFile \"/home/user/anaconda3/lib/python3.6/site-packages/torch/backends/cudnn/init.py\", line 114, in del\ncheck_error(lib.cudnnDestroy(self))\nctypes.ArgumentError: argument 1: <class 'TypeError'>: Don't know how to convert parameter 1", "body": "- OS:   \r\nuname -a\r\nLinux everest 4.4.0-104-generic #127-Ubuntu SMP Mon Dec 11 12:16:42 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n- PyTorch version: 0.3.1.post2\r\n- How you installed PyTorch (conda, pip, source): conda\r\n- Python version: Python 3.6.4 |Anaconda, Inc.| (default, Jan 16 2018, 18:10:19)\r\n- CUDA/cuDNN version:\r\nnvcc --version\r\nnvcc: NVIDIA (R) Cuda compiler driver\r\nCopyright (c) 2005-2017 NVIDIA Corporation\r\nBuilt on Fri_Sep__1_21:08:03_CDT_2017\r\nCuda compilation tools, release 9.0, V9.0.176\r\n--and--\r\ncat /usr/local/cuda/include/cudnn.h | grep CUDNN_MAJOR -A 2\r\n#define CUDNN_MAJOR 7\r\n#define CUDNN_MINOR 0\r\n#define CUDNN_PATCHLEVEL 5\r\n#define CUDNN_VERSION    (CUDNN_MAJOR * 1000 + CUDNN_MINOR * 100 + CUDNN_PATCHLEVEL)\r\n\r\n- GPU models and configuration: NVIDIA-SMI 384.111                Driver Version: 384.111\r\ngpu is 1080ti and titan xp\r\n- GCC version (if compiling from source): [GCC 7.2.0] on linux\r\n--------------------------------\r\nCode:\r\n`torch.backends.cudnn.enabled = False //<--`\r\n`rnn = torch.nn.LSTM(5, 10, num_layers=1, batch_first=True)`\r\n`rnn.cuda()`\r\nResult: pass!\r\n\r\n--------------------------------\r\nCode:\r\n`torch.backends.cudnn.enabled = True//<--`\r\n`rnn = torch.nn.LSTM(5, 10, num_layers=1, batch_first=True)`\r\n`rnn.cuda()`\r\nResult:\r\n> Traceback (most recent call last):\r\n  File \"/home/user/main.py\", line 16, in <module>\r\n    rnn.cuda()\r\n  File \"/home/user/anaconda3/lib/python3.6/site-packages/torch/nn/modules/module.py\", line 216, in cuda\r\n    return self._apply(lambda t: t.cuda(device))\r\n  File \"/home/user/anaconda3/lib/python3.6/site-packages/torch/nn/modules/rnn.py\", line 123, in _apply\r\n    self.flatten_parameters()\r\n  File \"/home/user/anaconda3/lib/python3.6/site-packages/torch/nn/modules/rnn.py\", line 85, in flatten_parameters\r\n    handle = cudnn.get_handle()\r\n  File \"/home/user/anaconda3/lib/python3.6/site-packages/torch/backends/cudnn/__init__.py\", line 296, in get_handle\r\n    handle = CuDNNHandle()\r\n  File \"/home/user/anaconda3/lib/python3.6/site-packages/torch/backends/cudnn/__init__.py\", line 110, in __init__\r\n    check_error(lib.cudnnCreate(ctypes.byref(ptr)))\r\n  File \"/home/user/anaconda3/lib/python3.6/site-packages/torch/backends/cudnn/__init__.py\", line 283, in check_error\r\n    raise CuDNNError(status)\r\ntorch.backends.cudnn.CuDNNError: 4: b'CUDNN_STATUS_INTERNAL_ERROR'\r\nException ignored in: <bound method CuDNNHandle.__del__ of <torch.backends.cudnn.CuDNNHandle object at 0x7f5f02e5a2b0>>\r\nTraceback (most recent call last):\r\n  File \"/home/user/anaconda3/lib/python3.6/site-packages/torch/backends/cudnn/__init__.py\", line 114, in __del__\r\n    check_error(lib.cudnnDestroy(self))\r\nctypes.ArgumentError: argument 1: <class 'TypeError'>: Don't know how to convert parameter 1\r\n"}