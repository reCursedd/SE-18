{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/388174130", "html_url": "https://github.com/pytorch/pytorch/pull/7437#issuecomment-388174130", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/7437", "id": 388174130, "node_id": "MDEyOklzc3VlQ29tbWVudDM4ODE3NDEzMA==", "user": {"login": "bwasti", "id": 4842908, "node_id": "MDQ6VXNlcjQ4NDI5MDg=", "avatar_url": "https://avatars2.githubusercontent.com/u/4842908?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bwasti", "html_url": "https://github.com/bwasti", "followers_url": "https://api.github.com/users/bwasti/followers", "following_url": "https://api.github.com/users/bwasti/following{/other_user}", "gists_url": "https://api.github.com/users/bwasti/gists{/gist_id}", "starred_url": "https://api.github.com/users/bwasti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bwasti/subscriptions", "organizations_url": "https://api.github.com/users/bwasti/orgs", "repos_url": "https://api.github.com/users/bwasti/repos", "events_url": "https://api.github.com/users/bwasti/events{/privacy}", "received_events_url": "https://api.github.com/users/bwasti/received_events", "type": "User", "site_admin": false}, "created_at": "2018-05-10T20:23:04Z", "updated_at": "2018-05-10T20:23:04Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4958441\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jerryzh168\">@jerryzh168</a></p>\n<pre><code>diff --git a/caffe2/opt/fusion.cc b/caffe2/opt/fusion.cc\nindex e5c856cfa..b43264df2 100644\n--- a/caffe2/opt/fusion.cc\n+++ b/caffe2/opt/fusion.cc\n@@ -82,5 +82,16 @@ void fuseConvBN(nom::repr::NNModule* nn, caffe2::Workspace* ws) {\n   while (fuseConvBNHelper(nn, ws)) {\n   }\n }\n+\n+void fuseConvRelu(nom::repr::NNModule* nn) {\n+  fuseActivation&lt;repr::Conv, repr::Relu&gt;(nn, [](const repr::Conv&amp; conv) {\n+    return true;\n+  }, [&amp;nn](repr::NNGraph::NodeRef convNode) {\n+    auto* convOp = repr::nn::get&lt;repr::Conv&gt;(convNode);\n+    auto* fusedNode = nn-&gt;dataFlow.createNode(util::make_unique&lt;repr::ConvRelu&gt;(*convOp));\n+    nn-&gt;dataFlow.replaceNode(convNode, fusedNode);\n+  });\n+}\n+\n } // namespace opt\n } // namespace caffe2\n</code></pre>", "body_text": "@jerryzh168\ndiff --git a/caffe2/opt/fusion.cc b/caffe2/opt/fusion.cc\nindex e5c856cfa..b43264df2 100644\n--- a/caffe2/opt/fusion.cc\n+++ b/caffe2/opt/fusion.cc\n@@ -82,5 +82,16 @@ void fuseConvBN(nom::repr::NNModule* nn, caffe2::Workspace* ws) {\n   while (fuseConvBNHelper(nn, ws)) {\n   }\n }\n+\n+void fuseConvRelu(nom::repr::NNModule* nn) {\n+  fuseActivation<repr::Conv, repr::Relu>(nn, [](const repr::Conv& conv) {\n+    return true;\n+  }, [&nn](repr::NNGraph::NodeRef convNode) {\n+    auto* convOp = repr::nn::get<repr::Conv>(convNode);\n+    auto* fusedNode = nn->dataFlow.createNode(util::make_unique<repr::ConvRelu>(*convOp));\n+    nn->dataFlow.replaceNode(convNode, fusedNode);\n+  });\n+}\n+\n } // namespace opt\n } // namespace caffe2", "body": "@jerryzh168 \r\n```\r\ndiff --git a/caffe2/opt/fusion.cc b/caffe2/opt/fusion.cc\r\nindex e5c856cfa..b43264df2 100644\r\n--- a/caffe2/opt/fusion.cc\r\n+++ b/caffe2/opt/fusion.cc\r\n@@ -82,5 +82,16 @@ void fuseConvBN(nom::repr::NNModule* nn, caffe2::Workspace* ws) {\r\n   while (fuseConvBNHelper(nn, ws)) {\r\n   }\r\n }\r\n+\r\n+void fuseConvRelu(nom::repr::NNModule* nn) {\r\n+  fuseActivation<repr::Conv, repr::Relu>(nn, [](const repr::Conv& conv) {\r\n+    return true;\r\n+  }, [&nn](repr::NNGraph::NodeRef convNode) {\r\n+    auto* convOp = repr::nn::get<repr::Conv>(convNode);\r\n+    auto* fusedNode = nn->dataFlow.createNode(util::make_unique<repr::ConvRelu>(*convOp));\r\n+    nn->dataFlow.replaceNode(convNode, fusedNode);\r\n+  });\r\n+}\r\n+\r\n } // namespace opt\r\n } // namespace caffe2\r\n```"}