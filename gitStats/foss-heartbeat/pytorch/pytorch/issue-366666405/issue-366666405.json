{"url": "https://api.github.com/repos/pytorch/pytorch/issues/12318", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/12318/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/12318/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/12318/events", "html_url": "https://github.com/pytorch/pytorch/issues/12318", "id": 366666405, "node_id": "MDU6SXNzdWUzNjY2NjY0MDU=", "number": 12318, "title": "warpctc_pytorch with cpp_extension", "user": {"login": "dattx0", "id": 40701401, "node_id": "MDQ6VXNlcjQwNzAxNDAx", "avatar_url": "https://avatars3.githubusercontent.com/u/40701401?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dattx0", "html_url": "https://github.com/dattx0", "followers_url": "https://api.github.com/users/dattx0/followers", "following_url": "https://api.github.com/users/dattx0/following{/other_user}", "gists_url": "https://api.github.com/users/dattx0/gists{/gist_id}", "starred_url": "https://api.github.com/users/dattx0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dattx0/subscriptions", "organizations_url": "https://api.github.com/users/dattx0/orgs", "repos_url": "https://api.github.com/users/dattx0/repos", "events_url": "https://api.github.com/users/dattx0/events{/privacy}", "received_events_url": "https://api.github.com/users/dattx0/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1076921751, "node_id": "MDU6TGFiZWwxMDc2OTIxNzUx", "url": "https://api.github.com/repos/pytorch/pytorch/labels/torch", "name": "torch", "color": "4fdddd", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2018-10-04T07:58:22Z", "updated_at": "2018-11-11T19:43:28Z", "closed_at": "2018-10-09T10:31:41Z", "author_association": "NONE", "body_html": "<p>i tried to build <a href=\"https://github.com/SeanNaren/warp-ctc\">warpctc_pytorch</a> with pytorch 1.0 (python3.5, ubuntu 16.04.5), i changed<br>\ncreate_extension to cpp_extension and build successfully. But when import, an error occured</p>\n<p>setup.py</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-c\"><span class=\"pl-c\">#</span> from torch.utils.ffi import create_extension</span>\n<span class=\"pl-k\">from</span> torch.utils.cpp_extension <span class=\"pl-k\">import</span> CppExtension, CUDAExtension, BuildExtension\n<span class=\"pl-c1\">...</span>\n\ncreate_extension <span class=\"pl-k\">=</span> CUDAExtension <span class=\"pl-k\">if</span> enable_gpu <span class=\"pl-k\">else</span> CppExtension\n\nffi <span class=\"pl-k\">=</span> create_extension(\n    <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>warpctc_pytorch._warp_ctc<span class=\"pl-pds\">'</span></span>,\n    <span class=\"pl-v\">package</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>,\n    <span class=\"pl-v\">language</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>c++<span class=\"pl-pds\">'</span></span>,\n    <span class=\"pl-v\">headers</span><span class=\"pl-k\">=</span>headers,\n    <span class=\"pl-v\">sources</span><span class=\"pl-k\">=</span>[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>src/binding.cpp<span class=\"pl-pds\">'</span></span>],\n    <span class=\"pl-c\"><span class=\"pl-c\">#</span> with_cuda=enable_gpu,</span>\n    <span class=\"pl-v\">include_dirs</span><span class=\"pl-k\">=</span>include_dirs,\n    <span class=\"pl-v\">library_dirs</span><span class=\"pl-k\">=</span>[os.path.realpath(warp_ctc_path)],\n    <span class=\"pl-v\">libraries</span><span class=\"pl-k\">=</span>[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>warpctc<span class=\"pl-pds\">'</span></span>],\n    <span class=\"pl-v\">extra_link_args</span><span class=\"pl-k\">=</span>[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>-Wl,-rpath,<span class=\"pl-pds\">'</span></span> <span class=\"pl-k\">+</span> os.path.realpath(warp_ctc_path)],\n    <span class=\"pl-v\">extra_compile_args</span><span class=\"pl-k\">=</span>extra_compile_args)\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> ffi = ffi.distutils_extension()</span>\nsetup(\n    <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>warpctc_pytorch<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-v\">version</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>0.1<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-v\">description</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>PyTorch wrapper for warp-ctc<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-v\">url</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>https://github.com/baidu-research/warp-ctc<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-v\">author</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Jared Casper, Sean Naren<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-v\">author_email</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>jared.casper@baidu.com, sean.narenthiran@digitalreasoning.com<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-v\">license</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Apache<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-v\">packages</span><span class=\"pl-k\">=</span>find_packages(),\n    <span class=\"pl-v\">ext_modules</span><span class=\"pl-k\">=</span>[ffi],\n    <span class=\"pl-v\">cmdclass</span><span class=\"pl-k\">=</span>{<span class=\"pl-s\"><span class=\"pl-pds\">'</span>build_ext<span class=\"pl-pds\">'</span></span>: BuildExtension}\n)\n</pre></div>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">&gt;&gt;</span><span class=\"pl-k\">&gt;</span> <span class=\"pl-k\">from</span> warpctc_pytorch <span class=\"pl-k\">import</span> CTCLoss\nTraceback (most recent call last):\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>&lt;stdin&gt;<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">1</span>, <span class=\"pl-k\">in</span> <span class=\"pl-k\">&lt;</span>module<span class=\"pl-k\">&gt;</span>\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/usr/local/lib/python3.5/dist-packages/warpctc_pytorch-0.1-py3.5-linux-x86_64.egg/warpctc_pytorch/__init__.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">6</span>, <span class=\"pl-k\">in</span> <span class=\"pl-k\">&lt;</span>module<span class=\"pl-k\">&gt;</span>\n    <span class=\"pl-k\">from</span> ._warp_ctc <span class=\"pl-k\">import</span> <span class=\"pl-k\">*</span>\n<span class=\"pl-c1\">ImportError</span>: dynamic module does <span class=\"pl-k\">not</span> define module export function (PyInit__warp_ctc)\n<span class=\"pl-k\">&gt;&gt;</span><span class=\"pl-k\">&gt;</span> \n</pre></div>\n<p>how can i fix this error? thanks!</p>", "body_text": "i tried to build warpctc_pytorch with pytorch 1.0 (python3.5, ubuntu 16.04.5), i changed\ncreate_extension to cpp_extension and build successfully. But when import, an error occured\nsetup.py\n# from torch.utils.ffi import create_extension\nfrom torch.utils.cpp_extension import CppExtension, CUDAExtension, BuildExtension\n...\n\ncreate_extension = CUDAExtension if enable_gpu else CppExtension\n\nffi = create_extension(\n    name='warpctc_pytorch._warp_ctc',\n    package=True,\n    language='c++',\n    headers=headers,\n    sources=['src/binding.cpp'],\n    # with_cuda=enable_gpu,\n    include_dirs=include_dirs,\n    library_dirs=[os.path.realpath(warp_ctc_path)],\n    libraries=['warpctc'],\n    extra_link_args=['-Wl,-rpath,' + os.path.realpath(warp_ctc_path)],\n    extra_compile_args=extra_compile_args)\n# ffi = ffi.distutils_extension()\nsetup(\n    name=\"warpctc_pytorch\",\n    version=\"0.1\",\n    description=\"PyTorch wrapper for warp-ctc\",\n    url=\"https://github.com/baidu-research/warp-ctc\",\n    author=\"Jared Casper, Sean Naren\",\n    author_email=\"jared.casper@baidu.com, sean.narenthiran@digitalreasoning.com\",\n    license=\"Apache\",\n    packages=find_packages(),\n    ext_modules=[ffi],\n    cmdclass={'build_ext': BuildExtension}\n)\n\n>>> from warpctc_pytorch import CTCLoss\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/usr/local/lib/python3.5/dist-packages/warpctc_pytorch-0.1-py3.5-linux-x86_64.egg/warpctc_pytorch/__init__.py\", line 6, in <module>\n    from ._warp_ctc import *\nImportError: dynamic module does not define module export function (PyInit__warp_ctc)\n>>> \n\nhow can i fix this error? thanks!", "body": "i tried to build [warpctc_pytorch](https://github.com/SeanNaren/warp-ctc) with pytorch 1.0 (python3.5, ubuntu 16.04.5), i changed \r\ncreate_extension to cpp_extension and build successfully. But when import, an error occured\r\n\r\nsetup.py\r\n```python\r\n# from torch.utils.ffi import create_extension\r\nfrom torch.utils.cpp_extension import CppExtension, CUDAExtension, BuildExtension\r\n...\r\n\r\ncreate_extension = CUDAExtension if enable_gpu else CppExtension\r\n\r\nffi = create_extension(\r\n    name='warpctc_pytorch._warp_ctc',\r\n    package=True,\r\n    language='c++',\r\n    headers=headers,\r\n    sources=['src/binding.cpp'],\r\n    # with_cuda=enable_gpu,\r\n    include_dirs=include_dirs,\r\n    library_dirs=[os.path.realpath(warp_ctc_path)],\r\n    libraries=['warpctc'],\r\n    extra_link_args=['-Wl,-rpath,' + os.path.realpath(warp_ctc_path)],\r\n    extra_compile_args=extra_compile_args)\r\n# ffi = ffi.distutils_extension()\r\nsetup(\r\n    name=\"warpctc_pytorch\",\r\n    version=\"0.1\",\r\n    description=\"PyTorch wrapper for warp-ctc\",\r\n    url=\"https://github.com/baidu-research/warp-ctc\",\r\n    author=\"Jared Casper, Sean Naren\",\r\n    author_email=\"jared.casper@baidu.com, sean.narenthiran@digitalreasoning.com\",\r\n    license=\"Apache\",\r\n    packages=find_packages(),\r\n    ext_modules=[ffi],\r\n    cmdclass={'build_ext': BuildExtension}\r\n)\r\n\r\n```\r\n\r\n```python\r\n>>> from warpctc_pytorch import CTCLoss\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/usr/local/lib/python3.5/dist-packages/warpctc_pytorch-0.1-py3.5-linux-x86_64.egg/warpctc_pytorch/__init__.py\", line 6, in <module>\r\n    from ._warp_ctc import *\r\nImportError: dynamic module does not define module export function (PyInit__warp_ctc)\r\n>>> \r\n\r\n```\r\n\r\nhow can i fix this error? thanks!"}