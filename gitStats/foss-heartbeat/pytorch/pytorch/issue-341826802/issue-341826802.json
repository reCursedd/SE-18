{"url": "https://api.github.com/repos/pytorch/pytorch/issues/9490", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/9490/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/9490/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/9490/events", "html_url": "https://github.com/pytorch/pytorch/issues/9490", "id": 341826802, "node_id": "MDU6SXNzdWUzNDE4MjY4MDI=", "number": 9490, "title": "Compile PyTorch/Caffe2 with /MD runtime library", "user": {"login": "iamhatesz", "id": 615769, "node_id": "MDQ6VXNlcjYxNTc2OQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/615769?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iamhatesz", "html_url": "https://github.com/iamhatesz", "followers_url": "https://api.github.com/users/iamhatesz/followers", "following_url": "https://api.github.com/users/iamhatesz/following{/other_user}", "gists_url": "https://api.github.com/users/iamhatesz/gists{/gist_id}", "starred_url": "https://api.github.com/users/iamhatesz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iamhatesz/subscriptions", "organizations_url": "https://api.github.com/users/iamhatesz/orgs", "repos_url": "https://api.github.com/users/iamhatesz/repos", "events_url": "https://api.github.com/users/iamhatesz/events{/privacy}", "received_events_url": "https://api.github.com/users/iamhatesz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 790080431, "node_id": "MDU6TGFiZWw3OTAwODA0MzE=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/windows", "name": "windows", "color": "fcff6b", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-07-17T08:58:25Z", "updated_at": "2018-07-18T12:53:37Z", "closed_at": null, "author_association": "NONE", "body_html": "<h2>Issue description</h2>\n<p>I have a VS project with a lot of dependencies compiled for /MD runtime. By default, Caffe2 compiles into /MT runtime, so it's not working together. I read somewhere that setting BUILD_SHARED_LIBS to ON sets runtime to /MD, but for me it results with the following linker error:</p>\n<p><code>      \"C:\\Users\\XXX\\Libs\\pytorch\\build\\ALL_BUILD.vcxproj\" (default target) (1) -&gt; \"C:\\Users\\XXX\\Libs\\pytorch\\build\\caffe2\\caffe2_pybind11_state.vcxproj\" (default target) (22) -&gt; (Link target) -&gt; pybind_state.obj : error LNK2019: unresolved external symbol \"public: __cdecl onnx_c2::TensorProto::TensorProt o(void)\" (??0TensorProto@onnx_c2@@QEAA@XZ) referenced in function \"public: class pybind11::bytes __cdecl &lt;lambda _ec355006db76b188803f2103fd5aad3c&gt;::operator()(class caffe2::onnx::Caffe2Backend &amp;,class pybind11::bytes const &amp; ,class std::basic_string&lt;char,struct std::char_traits&lt;char&gt;,class std::allocator&lt;char&gt; &gt; const &amp;)const \" (??R&lt;la mbda_ec355006db76b188803f2103fd5aad3c&gt;@@QEBA?AVbytes@pybind11@@AEAVCaffe2Backend@onnx@caffe2@@AEBV12@AEBV?$basic _string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@@Z) [C:\\Users\\XXX\\Libs\\pytorch\\build\\caffe2\\caffe2_pybi nd11_state.vcxproj] pybind_state.obj : error LNK2019: unresolved external symbol \"public: virtual __cdecl onnx_c2::TensorProto::~T ensorProto(void)\" (??1TensorProto@onnx_c2@@UEAA@XZ) referenced in function \"public: class pybind11::bytes __cdec l &lt;lambda_ec355006db76b188803f2103fd5aad3c&gt;::operator()(class caffe2::onnx::Caffe2Backend &amp;,class pybind11::byte s const &amp;,class std::basic_string&lt;char,struct std::char_traits&lt;char&gt;,class std::allocator&lt;char&gt; &gt; const &amp;)const \" (??R&lt;lambda_ec355006db76b188803f2103fd5aad3c&gt;@@QEBA?AVbytes@pybind11@@AEAVCaffe2Backend@onnx@caffe2@@AEBV12@AE BV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@@Z) [C:\\Users\\XXX\\Libs\\pytorch\\build\\caffe2\\ca ffe2_pybind11_state.vcxproj] C:\\Users\\XXX\\Libs\\pytorch\\build\\caffe2\\python\\Release\\caffe2_pybind11_state.cp37-win_amd64.pyd : fatal erro r LNK1120: 2 unresolved externals [C:\\Users\\XXX\\Libs\\pytorch\\build\\caffe2\\caffe2_pybind11_state.vcxproj]</code></p>\n<p>I am building using vs141 toolchain in Release mode.</p>\n<h2>System Info</h2>\n<ul>\n<li>PyTorch or Caffe2: PyTorch</li>\n<li>How you installed PyTorch (conda, pip, source): source</li>\n<li>Build command you used (if compiling from source): build_windows.bat</li>\n<li>OS: Windows 10</li>\n<li>PyTorch version: latest master</li>\n<li>Python version: 3.7.0</li>\n<li>CUDA/cuDNN version: none</li>\n<li>GPU models and configuration: none</li>\n<li>GCC version (if compiling from source): vs141 toolchain (Visual Studio 2017)</li>\n<li>CMake version: 3.12.0</li>\n<li>Versions of any other relevant libraries: -</li>\n</ul>", "body_text": "Issue description\nI have a VS project with a lot of dependencies compiled for /MD runtime. By default, Caffe2 compiles into /MT runtime, so it's not working together. I read somewhere that setting BUILD_SHARED_LIBS to ON sets runtime to /MD, but for me it results with the following linker error:\n      \"C:\\Users\\XXX\\Libs\\pytorch\\build\\ALL_BUILD.vcxproj\" (default target) (1) -> \"C:\\Users\\XXX\\Libs\\pytorch\\build\\caffe2\\caffe2_pybind11_state.vcxproj\" (default target) (22) -> (Link target) -> pybind_state.obj : error LNK2019: unresolved external symbol \"public: __cdecl onnx_c2::TensorProto::TensorProt o(void)\" (??0TensorProto@onnx_c2@@QEAA@XZ) referenced in function \"public: class pybind11::bytes __cdecl <lambda _ec355006db76b188803f2103fd5aad3c>::operator()(class caffe2::onnx::Caffe2Backend &,class pybind11::bytes const & ,class std::basic_string<char,struct std::char_traits<char>,class std::allocator<char> > const &)const \" (??R<la mbda_ec355006db76b188803f2103fd5aad3c>@@QEBA?AVbytes@pybind11@@AEAVCaffe2Backend@onnx@caffe2@@AEBV12@AEBV?$basic _string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@@Z) [C:\\Users\\XXX\\Libs\\pytorch\\build\\caffe2\\caffe2_pybi nd11_state.vcxproj] pybind_state.obj : error LNK2019: unresolved external symbol \"public: virtual __cdecl onnx_c2::TensorProto::~T ensorProto(void)\" (??1TensorProto@onnx_c2@@UEAA@XZ) referenced in function \"public: class pybind11::bytes __cdec l <lambda_ec355006db76b188803f2103fd5aad3c>::operator()(class caffe2::onnx::Caffe2Backend &,class pybind11::byte s const &,class std::basic_string<char,struct std::char_traits<char>,class std::allocator<char> > const &)const \" (??R<lambda_ec355006db76b188803f2103fd5aad3c>@@QEBA?AVbytes@pybind11@@AEAVCaffe2Backend@onnx@caffe2@@AEBV12@AE BV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@@Z) [C:\\Users\\XXX\\Libs\\pytorch\\build\\caffe2\\ca ffe2_pybind11_state.vcxproj] C:\\Users\\XXX\\Libs\\pytorch\\build\\caffe2\\python\\Release\\caffe2_pybind11_state.cp37-win_amd64.pyd : fatal erro r LNK1120: 2 unresolved externals [C:\\Users\\XXX\\Libs\\pytorch\\build\\caffe2\\caffe2_pybind11_state.vcxproj]\nI am building using vs141 toolchain in Release mode.\nSystem Info\n\nPyTorch or Caffe2: PyTorch\nHow you installed PyTorch (conda, pip, source): source\nBuild command you used (if compiling from source): build_windows.bat\nOS: Windows 10\nPyTorch version: latest master\nPython version: 3.7.0\nCUDA/cuDNN version: none\nGPU models and configuration: none\nGCC version (if compiling from source): vs141 toolchain (Visual Studio 2017)\nCMake version: 3.12.0\nVersions of any other relevant libraries: -", "body": "## Issue description\r\n\r\nI have a VS project with a lot of dependencies compiled for /MD runtime. By default, Caffe2 compiles into /MT runtime, so it's not working together. I read somewhere that setting BUILD_SHARED_LIBS to ON sets runtime to /MD, but for me it results with the following linker error:\r\n\r\n`       \"C:\\Users\\XXX\\Libs\\pytorch\\build\\ALL_BUILD.vcxproj\" (default target) (1) ->\r\n       \"C:\\Users\\XXX\\Libs\\pytorch\\build\\caffe2\\caffe2_pybind11_state.vcxproj\" (default target) (22) ->\r\n       (Link target) ->\r\n         pybind_state.obj : error LNK2019: unresolved external symbol \"public: __cdecl onnx_c2::TensorProto::TensorProt\r\n       o(void)\" (??0TensorProto@onnx_c2@@QEAA@XZ) referenced in function \"public: class pybind11::bytes __cdecl <lambda\r\n       _ec355006db76b188803f2103fd5aad3c>::operator()(class caffe2::onnx::Caffe2Backend &,class pybind11::bytes const &\r\n       ,class std::basic_string<char,struct std::char_traits<char>,class std::allocator<char> > const &)const \" (??R<la\r\n       mbda_ec355006db76b188803f2103fd5aad3c>@@QEBA?AVbytes@pybind11@@AEAVCaffe2Backend@onnx@caffe2@@AEBV12@AEBV?$basic\r\n       _string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@@Z) [C:\\Users\\XXX\\Libs\\pytorch\\build\\caffe2\\caffe2_pybi\r\n       nd11_state.vcxproj]\r\n         pybind_state.obj : error LNK2019: unresolved external symbol \"public: virtual __cdecl onnx_c2::TensorProto::~T\r\n       ensorProto(void)\" (??1TensorProto@onnx_c2@@UEAA@XZ) referenced in function \"public: class pybind11::bytes __cdec\r\n       l <lambda_ec355006db76b188803f2103fd5aad3c>::operator()(class caffe2::onnx::Caffe2Backend &,class pybind11::byte\r\n       s const &,class std::basic_string<char,struct std::char_traits<char>,class std::allocator<char> > const &)const\r\n       \" (??R<lambda_ec355006db76b188803f2103fd5aad3c>@@QEBA?AVbytes@pybind11@@AEAVCaffe2Backend@onnx@caffe2@@AEBV12@AE\r\n       BV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@@Z) [C:\\Users\\XXX\\Libs\\pytorch\\build\\caffe2\\ca\r\n       ffe2_pybind11_state.vcxproj]\r\n         C:\\Users\\XXX\\Libs\\pytorch\\build\\caffe2\\python\\Release\\caffe2_pybind11_state.cp37-win_amd64.pyd : fatal erro\r\n       r LNK1120: 2 unresolved externals [C:\\Users\\XXX\\Libs\\pytorch\\build\\caffe2\\caffe2_pybind11_state.vcxproj]\r\n`\r\n\r\nI am building using vs141 toolchain in Release mode.\r\n\r\n## System Info\r\n\r\n- PyTorch or Caffe2: PyTorch\r\n- How you installed PyTorch (conda, pip, source): source\r\n- Build command you used (if compiling from source): build_windows.bat\r\n- OS: Windows 10\r\n- PyTorch version: latest master\r\n- Python version: 3.7.0\r\n- CUDA/cuDNN version: none\r\n- GPU models and configuration: none\r\n- GCC version (if compiling from source): vs141 toolchain (Visual Studio 2017)\r\n- CMake version: 3.12.0\r\n- Versions of any other relevant libraries: -\r\n"}