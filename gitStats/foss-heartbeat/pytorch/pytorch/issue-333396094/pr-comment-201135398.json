{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/201135398", "pull_request_review_id": 135578397, "id": 201135398, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMTEzNTM5OA==", "diff_hunk": "@@ -51,70 +85,82 @@ inline void vrsqrt(scalar_t* out, scalar_t* in, int64_t size) {\n     });                                                                 \\\n   }\n \n-#define IMPLEMENT_FLOAT_MKL_VML(op, mklop)                                    \\\n-  template <typename scalar_t>                                                \\\n-  inline void v##op(scalar_t* out, scalar_t* in, int64_t size);               \\\n+#define IMPLEMENT_VML(op)                                              \\\n+  template <typename scalar_t>                                          \\\n+  inline void v##op(scalar_t* out, const scalar_t* in, int64_t size) {  \\\n+    parallel_for(0, size, 2048, [out, in](int64_t begin, int64_t end) { \\\n+      map([](const Vec256<scalar_t>& x) { return x.op(); },             \\\n+          out + begin,                                                  \\\n+          in + begin,                                                   \\\n+          end - begin);                                                 \\\n+    });                                                                 \\\n+  }\n+\n+IMPLEMENT_VML_BUG(abs)\n+IMPLEMENT_VML_BUG(acos)\n+IMPLEMENT_VML_BUG(asin)\n+IMPLEMENT_VML_BUG(atan)\n+IMPLEMENT_VML_BUG(ceil)\n+IMPLEMENT_VML_BUG(cos)\n+// IMPLEMENT_VML_BUG(cosh)\n+IMPLEMENT_VML_BUG(erf)\n+IMPLEMENT_VML_BUG(exp)\n+IMPLEMENT_VML_BUG(expm1)\n+IMPLEMENT_VML_BUG(floor)\n+IMPLEMENT_VML(reciprocal)\n+IMPLEMENT_VML_BUG(log)\n+IMPLEMENT_VML_BUG(log10)\n+IMPLEMENT_VML_BUG(log1p)\n+IMPLEMENT_VML_BUG(log2)\n+IMPLEMENT_VML(neg)\n+IMPLEMENT_VML_BUG(sin)\n+// IMPLEMENT_VML_BUG(sinh)\n+IMPLEMENT_VML_BUG(sqrt)\n+IMPLEMENT_VML_BUG(round)\n+IMPLEMENT_VML(rsqrt)\n+IMPLEMENT_VML_BUG(tan)\n+IMPLEMENT_VML_BUG(tanh)\n+IMPLEMENT_VML_BUG(trunc)\n+\n+#if AT_MKL_ENABLED() && !defined(__APPLE__)\n+\n+#define IMPLEMENT_VML_MKL(op, mklop)                                         \\\n   template <>                                                                 \\\n-  inline void v##op(float* out, float* in, int64_t size) {                    \\\n-    vms##mklop(size, in, out, VML_HA | VML_FTZDAZ_OFF | VML_ERRMODE_IGNORE); \\\n+  inline void v##op(float* out, const float* in, int64_t size) {              \\\n+    vms##mklop(size, in, out, VML_HA | VML_FTZDAZ_OFF | VML_ERRMODE_DEFAULT); \\", "path": "aten/src/ATen/cpu/vml.h", "position": null, "original_position": 113, "commit_id": "7776fbb29c7f71f3fdee6c02788529f4d60e63df", "original_commit_id": "0ac6d73c926fa7862b607a40c06848845a188e09", "user": {"login": "cpuhrsch", "id": 1716488, "node_id": "MDQ6VXNlcjE3MTY0ODg=", "avatar_url": "https://avatars1.githubusercontent.com/u/1716488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cpuhrsch", "html_url": "https://github.com/cpuhrsch", "followers_url": "https://api.github.com/users/cpuhrsch/followers", "following_url": "https://api.github.com/users/cpuhrsch/following{/other_user}", "gists_url": "https://api.github.com/users/cpuhrsch/gists{/gist_id}", "starred_url": "https://api.github.com/users/cpuhrsch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cpuhrsch/subscriptions", "organizations_url": "https://api.github.com/users/cpuhrsch/orgs", "repos_url": "https://api.github.com/users/cpuhrsch/repos", "events_url": "https://api.github.com/users/cpuhrsch/events{/privacy}", "received_events_url": "https://api.github.com/users/cpuhrsch/received_events", "type": "User", "site_admin": false}, "body": "Good catch.", "created_at": "2018-07-09T20:25:30Z", "updated_at": "2018-11-23T15:47:00Z", "html_url": "https://github.com/pytorch/pytorch/pull/8612#discussion_r201135398", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/8612", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/201135398"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/8612#discussion_r201135398"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/8612"}}, "body_html": "<p>Good catch.</p>", "body_text": "Good catch.", "in_reply_to_id": 201114680}