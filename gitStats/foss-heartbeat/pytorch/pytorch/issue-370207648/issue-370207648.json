{"url": "https://api.github.com/repos/pytorch/pytorch/issues/12654", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/12654/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/12654/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/12654/events", "html_url": "https://github.com/pytorch/pytorch/pull/12654", "id": 370207648, "node_id": "MDExOlB1bGxSZXF1ZXN0MjIyOTQwMTc1", "number": 12654, "title": "Simplify typeid macros", "user": {"login": "smessmer", "id": 2373925, "node_id": "MDQ6VXNlcjIzNzM5MjU=", "avatar_url": "https://avatars3.githubusercontent.com/u/2373925?v=4", "gravatar_id": "", "url": "https://api.github.com/users/smessmer", "html_url": "https://github.com/smessmer", "followers_url": "https://api.github.com/users/smessmer/followers", "following_url": "https://api.github.com/users/smessmer/following{/other_user}", "gists_url": "https://api.github.com/users/smessmer/gists{/gist_id}", "starred_url": "https://api.github.com/users/smessmer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/smessmer/subscriptions", "organizations_url": "https://api.github.com/users/smessmer/orgs", "repos_url": "https://api.github.com/users/smessmer/repos", "events_url": "https://api.github.com/users/smessmer/events{/privacy}", "received_events_url": "https://api.github.com/users/smessmer/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-10-15T15:05:09Z", "updated_at": "2018-10-15T22:43:19Z", "closed_at": "2018-10-15T22:43:19Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/12654", "html_url": "https://github.com/pytorch/pytorch/pull/12654", "diff_url": "https://github.com/pytorch/pytorch/pull/12654.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/12654.patch"}, "body_html": "<p>Stack:<br>\n\u00a0\u00a0\u00a0\u00a0<g-emoji class=\"g-emoji\" alias=\"black_circle\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/26ab.png\">\u26ab\ufe0f</g-emoji>\u00a0 <strong><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"370207648\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/12654\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/12654/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/12654\">#12654</a> Simplify typeid macros</strong>\u00a0\u00a0<a href=\"https://our.internmc.facebook.com/intern/diff/D10379903/\" rel=\"nofollow\"><g-emoji class=\"g-emoji\" alias=\"green_heart\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f49a.png\">\ud83d\udc9a</g-emoji></a></p>\n<p>The previous diff managed to get the macros working, but they've been quite unmaintainable.<br>\nThis diff improves the situation a bit.</p>\n<ul>\n<li>Before, there were three global variables for each registered type: type id, type name and a global type meta instance. Now, it's only type id and type meta, type name is gone. I also wanted to get rid of type id, but that doesn't work due to issues with static initialization ordering (type ids for types are requested during static initialization time, meh)</li>\n<li>Instead of repeating the whole CAFFE_KNOWN_TYPE macro for GCC and non-GCC because they need different export flags, define it only once and use a EXPORT_IF_NOT_GCC macro.</li>\n<li>The CAFFE_KNOWN_TYPE macro has to delegate to a _CAFFE_KNOWN_TYPE_DEFINE_TYPEMETADATA_INSTANCE macro, because of the counter. The pattern was copied for the macros for preallocated types. However, there we don't use a counter but use the preallocated id, so there's no need to delegate to a separate macro.</li>\n</ul>\n<p>Differential Revision: <a href=\"https://our.internmc.facebook.com/intern/diff/D10379903/\" rel=\"nofollow\">D10379903</a></p>", "body_text": "Stack:\n\u00a0\u00a0\u00a0\u00a0\u26ab\ufe0f\u00a0 #12654 Simplify typeid macros\u00a0\u00a0\ud83d\udc9a\nThe previous diff managed to get the macros working, but they've been quite unmaintainable.\nThis diff improves the situation a bit.\n\nBefore, there were three global variables for each registered type: type id, type name and a global type meta instance. Now, it's only type id and type meta, type name is gone. I also wanted to get rid of type id, but that doesn't work due to issues with static initialization ordering (type ids for types are requested during static initialization time, meh)\nInstead of repeating the whole CAFFE_KNOWN_TYPE macro for GCC and non-GCC because they need different export flags, define it only once and use a EXPORT_IF_NOT_GCC macro.\nThe CAFFE_KNOWN_TYPE macro has to delegate to a _CAFFE_KNOWN_TYPE_DEFINE_TYPEMETADATA_INSTANCE macro, because of the counter. The pattern was copied for the macros for preallocated types. However, there we don't use a counter but use the preallocated id, so there's no need to delegate to a separate macro.\n\nDifferential Revision: D10379903", "body": "Stack:\n&nbsp;&nbsp;&nbsp;&nbsp;:black_circle:&nbsp; **#12654 Simplify typeid macros**&nbsp;&nbsp;[:green_heart:](https://our.internmc.facebook.com/intern/diff/D10379903/)\n\nThe previous diff managed to get the macros working, but they've been quite unmaintainable.\nThis diff improves the situation a bit.\n\n- Before, there were three global variables for each registered type: type id, type name and a global type meta instance. Now, it's only type id and type meta, type name is gone. I also wanted to get rid of type id, but that doesn't work due to issues with static initialization ordering (type ids for types are requested during static initialization time, meh)\n- Instead of repeating the whole CAFFE_KNOWN_TYPE macro for GCC and non-GCC because they need different export flags, define it only once and use a EXPORT_IF_NOT_GCC macro.\n- The CAFFE_KNOWN_TYPE macro has to delegate to a _CAFFE_KNOWN_TYPE_DEFINE_TYPEMETADATA_INSTANCE macro, because of the counter. The pattern was copied for the macros for preallocated types. However, there we don't use a counter but use the preallocated id, so there's no need to delegate to a separate macro.\n\nDifferential Revision: [D10379903](https://our.internmc.facebook.com/intern/diff/D10379903/)"}