{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/200142702", "pull_request_review_id": 134398671, "id": 200142702, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMDE0MjcwMg==", "diff_hunk": "@@ -366,87 +372,102 @@ def declkey(decl):\n     write(out, 'aten_interned_strings.h', ATEN_INTERNED_STRINGS_H, strings_env)\n \n \n-def emit_schema(jit_decls, out, template_path):\n-    ATEN_SCHEMA_CPP = CodeTemplate.from_file(template_path + '/aten_schema.cpp')\n+# JIT has a type system of\n+# Scalar = int | float | bool # int is the largest int (int64_t),\n+# float is the largest float (double) we don't have the others because they are never held in tensors\n+# Type = Scalar # primitive numbers\n+#      | Tensor # any tensor, as defined by at::Tensor\n+#      | Type[] # a dynamically sizes list of a type\n+#      | Scalar[N] # a homogenous fixed size scalar list, single scalars can expand to this list\n+#      | (Type1, Type2, ...) # a heterogenous tuple\n+#      | Layout | ScalarType | Device | Generator # special singleton types for built-in concepts in tensor lib\n+\n+# clean up the variety of C++ types in the ATen declarations\n+# to be in the restricted set of types that the IR represents\n+# note: no default values for this map, to make it clear what types\n+# can be passedthrough\n+\n+TYPE_MAP = {\n+    'std::array<bool,2>': 'bool[2]',\n+    'std::array<bool,3>': 'bool[3]',\n+    'std::array<bool,4>': 'bool[4]',\n+    'Scalar': 'Scalar',\n+    'Tensor': 'Tensor',\n+    'TensorList': 'Tensor[]',\n+    # this appears in return values instead of TensorList\n+    # since TensorList is a ArrayRef in arguments but a vector\n+    # in returns\n+    'std::vector<Tensor>': 'Tensor[]',\n+    'IntList': 'int[]',\n+    'Layout': 'Layout',\n+    'Device': 'Device',\n+    'ScalarType': 'ScalarType',\n+    'int64_t': 'int',\n+    'double': 'float',\n+    'bool': 'bool',\n+    'Generator': 'Generator',\n+}\n \n-    # see [aten_schema encoding] for how this gets translated to C++ object\n+default_map = {'{}': 'None', 'nullptr': 'None'}\n+\n+\n+def signature(decl):\n+    def format_arg(arg):\n+        name = arg['name']\n+        typ = format_type(arg)\n+        decl = '{} {}'.format(typ, name)\n+        if 'default' in arg:\n+            # clean up initializer lists {{true, true}} -> [true, true]\n+            default = str(arg['default']) \\\n+                .replace('{{', '[') \\\n+                .replace('}}', ']') \\", "path": "tools/jit/gen_jit_dispatch.py", "position": 444, "original_position": 168, "commit_id": "1efd5a0aff5427596ececb2c851b1ef6291a707b", "original_commit_id": "717abe9074bdb912aef72a8e19122fa4a6c3d89d", "user": {"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}, "body": "This makes me a bit worried. Which types have `{{true, true}}` as initializer lists, and why does it result in a singly nested list instead of having 2 levels?", "created_at": "2018-07-04T14:23:40Z", "updated_at": "2018-11-23T15:46:46Z", "html_url": "https://github.com/pytorch/pytorch/pull/8885#discussion_r200142702", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/8885", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/200142702"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/8885#discussion_r200142702"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/8885"}}, "body_html": "<p>This makes me a bit worried. Which types have <code>{{true, true}}</code> as initializer lists, and why does it result in a singly nested list instead of having 2 levels?</p>", "body_text": "This makes me a bit worried. Which types have {{true, true}} as initializer lists, and why does it result in a singly nested list instead of having 2 levels?"}