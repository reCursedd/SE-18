{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/393669099", "html_url": "https://github.com/pytorch/pytorch/issues/7903#issuecomment-393669099", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/7903", "id": 393669099, "node_id": "MDEyOklzc3VlQ29tbWVudDM5MzY2OTA5OQ==", "user": {"login": "cpuhrsch", "id": 1716488, "node_id": "MDQ6VXNlcjE3MTY0ODg=", "avatar_url": "https://avatars1.githubusercontent.com/u/1716488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cpuhrsch", "html_url": "https://github.com/cpuhrsch", "followers_url": "https://api.github.com/users/cpuhrsch/followers", "following_url": "https://api.github.com/users/cpuhrsch/following{/other_user}", "gists_url": "https://api.github.com/users/cpuhrsch/gists{/gist_id}", "starred_url": "https://api.github.com/users/cpuhrsch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cpuhrsch/subscriptions", "organizations_url": "https://api.github.com/users/cpuhrsch/orgs", "repos_url": "https://api.github.com/users/cpuhrsch/repos", "events_url": "https://api.github.com/users/cpuhrsch/events{/privacy}", "received_events_url": "https://api.github.com/users/cpuhrsch/received_events", "type": "User", "site_admin": false}, "created_at": "2018-05-31T20:28:33Z", "updated_at": "2018-05-31T20:28:33Z", "author_association": "CONTRIBUTOR", "body_html": "<p>I've rerun the LSTM example with the following modifications on top of <a href=\"https://github.com/pytorch/pytorch/pull/8003\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/8003/hovercard\">this PR</a>.</p>\n<pre><code>--- a/rnn_benchmark/LSTM.py\n+++ b/rnn_benchmark/LSTM.py\n@@ -20,7 +20,7 @@ if 'daily' in sys.argv:\n\n if daily:\n     sizes = [[64,50,500,500],\n-         #[128,25,4096,4096]\n+         [128,25,4096,4096]\n         ]\n     print(\"daily test\")\n else:\n</code></pre>\n<p>It looks like the PR together with the small change largely resolves the perf issues.</p>\n<p><code>c9fc7b5</code> is the commit of the PR and <code>4d26939</code> the ID of the last commit without perf regression mentioned by <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=20226293\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/MlWoo\">@MlWoo</a>.</p>\n<p>I'm controlling the number of threads via <code>OMP_NUM_THREADS</code> and <code>MKL_NUM_THREADS</code>.</p>\n<pre><code>Using 16 threads\n\nCommit: c9fc7b5\ndaily test\nsize = [64, 50, 500, 500], duration = 0.0637, gflops = 12.8000, GFLOPS = 200.8536, SPS = 1004.2682\nsize = [128, 25, 4096, 4096], duration = 1.7347, gflops = 858.9935, GFLOPS = 495.1874, SPS = 73.7887\n\nCommit: 4d26939\ndaily test\nsize = [64, 50, 500, 500], duration = 0.0497, gflops = 12.8000, GFLOPS = 257.3203, SPS = 1286.6016\nsize = [128, 25, 4096, 4096], duration = 1.7258, gflops = 858.9935, GFLOPS = 497.7455, SPS = 74.1699\n\n\nUsing 8\n\nFurther benchmarks\nCommit: c9fc7b5\ndaily test\nsize = [64, 50, 500, 500], duration = 0.0889, gflops = 12.8000, GFLOPS = 144.0471, SPS = 720.2356\nsize = [128, 25, 4096, 4096], duration = 2.5287, gflops = 858.9935, GFLOPS = 339.7022, SPS = 50.6196\n\nCommit: 4d26939\ndaily test\nsize = [64, 50, 500, 500], duration = 0.0822, gflops = 12.8000, GFLOPS = 155.6714, SPS = 778.3568\nsize = [128, 25, 4096, 4096], duration = 2.4360, gflops = 858.9935, GFLOPS = 352.6199, SPS = 52.5445\n\n\nUsing 4\n\nCommit: c9fc7b5\ndaily test\nsize = [64, 50, 500, 500], duration = 0.1511, gflops = 12.8000, GFLOPS = 84.6913, SPS = 423.4566\nsize = [128, 25, 4096, 4096], duration = 4.8528, gflops = 858.9935, GFLOPS = 177.0087, SPS = 26.3764\n\nCommit: 4d26939\ndaily test\nsize = [64, 50, 500, 500], duration = 0.1495, gflops = 12.8000, GFLOPS = 85.6460, SPS = 428.2300\nsize = [128, 25, 4096, 4096], duration = 4.8822, gflops = 858.9935, GFLOPS = 175.9422, SPS = 26.2174\n</code></pre>", "body_text": "I've rerun the LSTM example with the following modifications on top of this PR.\n--- a/rnn_benchmark/LSTM.py\n+++ b/rnn_benchmark/LSTM.py\n@@ -20,7 +20,7 @@ if 'daily' in sys.argv:\n\n if daily:\n     sizes = [[64,50,500,500],\n-         #[128,25,4096,4096]\n+         [128,25,4096,4096]\n         ]\n     print(\"daily test\")\n else:\n\nIt looks like the PR together with the small change largely resolves the perf issues.\nc9fc7b5 is the commit of the PR and 4d26939 the ID of the last commit without perf regression mentioned by @MlWoo.\nI'm controlling the number of threads via OMP_NUM_THREADS and MKL_NUM_THREADS.\nUsing 16 threads\n\nCommit: c9fc7b5\ndaily test\nsize = [64, 50, 500, 500], duration = 0.0637, gflops = 12.8000, GFLOPS = 200.8536, SPS = 1004.2682\nsize = [128, 25, 4096, 4096], duration = 1.7347, gflops = 858.9935, GFLOPS = 495.1874, SPS = 73.7887\n\nCommit: 4d26939\ndaily test\nsize = [64, 50, 500, 500], duration = 0.0497, gflops = 12.8000, GFLOPS = 257.3203, SPS = 1286.6016\nsize = [128, 25, 4096, 4096], duration = 1.7258, gflops = 858.9935, GFLOPS = 497.7455, SPS = 74.1699\n\n\nUsing 8\n\nFurther benchmarks\nCommit: c9fc7b5\ndaily test\nsize = [64, 50, 500, 500], duration = 0.0889, gflops = 12.8000, GFLOPS = 144.0471, SPS = 720.2356\nsize = [128, 25, 4096, 4096], duration = 2.5287, gflops = 858.9935, GFLOPS = 339.7022, SPS = 50.6196\n\nCommit: 4d26939\ndaily test\nsize = [64, 50, 500, 500], duration = 0.0822, gflops = 12.8000, GFLOPS = 155.6714, SPS = 778.3568\nsize = [128, 25, 4096, 4096], duration = 2.4360, gflops = 858.9935, GFLOPS = 352.6199, SPS = 52.5445\n\n\nUsing 4\n\nCommit: c9fc7b5\ndaily test\nsize = [64, 50, 500, 500], duration = 0.1511, gflops = 12.8000, GFLOPS = 84.6913, SPS = 423.4566\nsize = [128, 25, 4096, 4096], duration = 4.8528, gflops = 858.9935, GFLOPS = 177.0087, SPS = 26.3764\n\nCommit: 4d26939\ndaily test\nsize = [64, 50, 500, 500], duration = 0.1495, gflops = 12.8000, GFLOPS = 85.6460, SPS = 428.2300\nsize = [128, 25, 4096, 4096], duration = 4.8822, gflops = 858.9935, GFLOPS = 175.9422, SPS = 26.2174", "body": "I've rerun the LSTM example with the following modifications on top of [this PR](https://github.com/pytorch/pytorch/pull/8003).\r\n\r\n```\r\n--- a/rnn_benchmark/LSTM.py\r\n+++ b/rnn_benchmark/LSTM.py\r\n@@ -20,7 +20,7 @@ if 'daily' in sys.argv:\r\n\r\n if daily:\r\n     sizes = [[64,50,500,500],\r\n-         #[128,25,4096,4096]\r\n+         [128,25,4096,4096]\r\n         ]\r\n     print(\"daily test\")\r\n else:\r\n```\r\n\r\nIt looks like the PR together with the small change largely resolves the perf issues.\r\n\r\n`c9fc7b5` is the commit of the PR and `4d26939` the ID of the last commit without perf regression mentioned by @MlWoo.\r\n\r\nI'm controlling the number of threads via `OMP_NUM_THREADS` and `MKL_NUM_THREADS`.\r\n\r\n```\r\nUsing 16 threads\r\n\r\nCommit: c9fc7b5\r\ndaily test\r\nsize = [64, 50, 500, 500], duration = 0.0637, gflops = 12.8000, GFLOPS = 200.8536, SPS = 1004.2682\r\nsize = [128, 25, 4096, 4096], duration = 1.7347, gflops = 858.9935, GFLOPS = 495.1874, SPS = 73.7887\r\n\r\nCommit: 4d26939\r\ndaily test\r\nsize = [64, 50, 500, 500], duration = 0.0497, gflops = 12.8000, GFLOPS = 257.3203, SPS = 1286.6016\r\nsize = [128, 25, 4096, 4096], duration = 1.7258, gflops = 858.9935, GFLOPS = 497.7455, SPS = 74.1699\r\n\r\n\r\nUsing 8\r\n\r\nFurther benchmarks\r\nCommit: c9fc7b5\r\ndaily test\r\nsize = [64, 50, 500, 500], duration = 0.0889, gflops = 12.8000, GFLOPS = 144.0471, SPS = 720.2356\r\nsize = [128, 25, 4096, 4096], duration = 2.5287, gflops = 858.9935, GFLOPS = 339.7022, SPS = 50.6196\r\n\r\nCommit: 4d26939\r\ndaily test\r\nsize = [64, 50, 500, 500], duration = 0.0822, gflops = 12.8000, GFLOPS = 155.6714, SPS = 778.3568\r\nsize = [128, 25, 4096, 4096], duration = 2.4360, gflops = 858.9935, GFLOPS = 352.6199, SPS = 52.5445\r\n\r\n\r\nUsing 4\r\n\r\nCommit: c9fc7b5\r\ndaily test\r\nsize = [64, 50, 500, 500], duration = 0.1511, gflops = 12.8000, GFLOPS = 84.6913, SPS = 423.4566\r\nsize = [128, 25, 4096, 4096], duration = 4.8528, gflops = 858.9935, GFLOPS = 177.0087, SPS = 26.3764\r\n\r\nCommit: 4d26939\r\ndaily test\r\nsize = [64, 50, 500, 500], duration = 0.1495, gflops = 12.8000, GFLOPS = 85.6460, SPS = 428.2300\r\nsize = [128, 25, 4096, 4096], duration = 4.8822, gflops = 858.9935, GFLOPS = 175.9422, SPS = 26.2174\r\n```\r\n\r\n"}