{"url": "https://api.github.com/repos/pytorch/pytorch/issues/12705", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/12705/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/12705/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/12705/events", "html_url": "https://github.com/pytorch/pytorch/issues/12705", "id": 370523350, "node_id": "MDU6SXNzdWUzNzA1MjMzNTA=", "number": 12705, "title": "(libtorch) segmentation fault on CentOS", "user": {"login": "Yuyiqi1992", "id": 39398977, "node_id": "MDQ6VXNlcjM5Mzk4OTc3", "avatar_url": "https://avatars3.githubusercontent.com/u/39398977?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Yuyiqi1992", "html_url": "https://github.com/Yuyiqi1992", "followers_url": "https://api.github.com/users/Yuyiqi1992/followers", "following_url": "https://api.github.com/users/Yuyiqi1992/following{/other_user}", "gists_url": "https://api.github.com/users/Yuyiqi1992/gists{/gist_id}", "starred_url": "https://api.github.com/users/Yuyiqi1992/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Yuyiqi1992/subscriptions", "organizations_url": "https://api.github.com/users/Yuyiqi1992/orgs", "repos_url": "https://api.github.com/users/Yuyiqi1992/repos", "events_url": "https://api.github.com/users/Yuyiqi1992/events{/privacy}", "received_events_url": "https://api.github.com/users/Yuyiqi1992/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-10-16T09:36:44Z", "updated_at": "2018-10-25T10:43:35Z", "closed_at": "2018-10-19T03:37:21Z", "author_association": "NONE", "body_html": "<h2><g-emoji class=\"g-emoji\" alias=\"bug\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f41b.png\">\ud83d\udc1b</g-emoji> Bug</h2>\n<p>I followed the  instructions at <a href=\"https://pytorch.org/tutorials/advanced/cpp_export.html\" rel=\"nofollow\">https://pytorch.org/tutorials/advanced/cpp_export.html</a> to use libtorch on CentOS, and an exception (segmentation fault) is thrown out when I'm trying to run, but there is no problem on Ubuntu. Then I used valgrind to check the memory on CentOS, the results as follows:</p>\n<p><code>==434== Command: ./example-app ../model.pt</code><br>\n<code>==434== ok</code><br>\n<code>==434== Invalid read of size 8</code><br>\n<code>==434==    at 0x434A6A: std::_Hashtable&lt;std::string, std::pair&lt;std::string const, unsigned long&gt;, std::allocator&lt;std::pair&lt;std::string const, unsigned long&gt; &gt;, std::__detail::_Select1st, std::equal_to&lt;std::string&gt;, std::hash&lt;std::string&gt;, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits&lt;true, false, true&gt; &gt;::_M_find_before_node(unsigned long, std::string const&amp;, unsigned long) const (in /icooper/dev/playphone_c/build/example-app)</code></p>\n<p><code>==434==    by 0x4339D9: std::_Hashtable&lt;std::string, std::pair&lt;std::string const, unsigned long&gt;, std::allocator&lt;std::pair&lt;std::string const, unsigned long&gt; &gt;, std::__detail::_Select1st, std::equal_to&lt;std::string&gt;, std::hash&lt;std::string&gt;, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits&lt;true, false, true&gt; &gt;::_M_find_node(unsigned long, std::string const&amp;, unsigned long) const (in /icooper/dev/playphone_c/build/example-app)</code></p>\n<p><code>==434==    by 0x433A4F: std::_Hashtable&lt;std::string, std::pair&lt;std::string const, unsigned long&gt;, std::allocator&lt;std::pair&lt;std::string const, unsigned long&gt; &gt;, std::__detail::_Select1st, std::equal_to&lt;std::string&gt;, std::hash&lt;std::string&gt;, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits&lt;true, false, true&gt; &gt;::find(std::string const&amp;) const (in /icooper/dev/playphone_c/build/example-app)</code></p>\n<p><code>==434==    by 0x4320D2: std::unordered_map&lt;std::string, unsigned long, std::hash&lt;std::string&gt;, std::equal_to&lt;std::string&gt;, std::allocator&lt;std::pair&lt;std::string const, unsigned long&gt; &gt; &gt;::find(std::string const&amp;) const (in /icooper/dev/playphone_c/build/example-app)</code></p>\n<p><code>==434==    by 0x42FBA8: torch::detail::OrderedDict&lt;std::string, std::unique_ptr&lt;torch::jit::script::Method, std::default_delete&lt;torch::jit::script::Method&gt; &gt; &gt;::find(std::string const&amp;) const (in /icooper/dev/playphone_c/build/example-app)</code></p>\n<p><code>==434==    by 0x42D575: torch::detail::OrderedDict&lt;std::string, std::unique_ptr&lt;torch::jit::script::Method, std::default_delete&lt;torch::jit::script::Method&gt; &gt; &gt;::get(std::string const&amp;) const (in /icooper/dev/playphone_c/build/example-app)</code></p>\n<p><code>==434==    by 0x42B117: torch::jit::script::Module::get_method(std::string const&amp;) const (in /icooper/dev/playphone_c/build/example-app)</code></p>\n<p><code>==434==    by 0x42B035: torch::jit::script::Module::forward(std::vector&lt;torch::jit::IValue, std::allocator&lt;torch::jit::IValue&gt; &gt;) (in /icooper/dev/playphone_c/build/example-app)</code></p>\n<p><code>==434==    by 0x426BBC: main (in /icooper/dev/playphone_c/build/example-app)</code><br>\n<code>==434==  Address 0x56feade8 is not stack'd, malloc'd or (recently) free'd</code><br>\n<code>==434== Process terminating with default action of signal 11 (SIGSEGV): dumping core</code><br>\n<code>==434==  Access not within mapped region at address 0x56FEADE8</code></p>\n<h2>To Reproduce</h2>\n<p>Steps to reproduce the behavior:</p>\n<ol>\n<li>Follow the instructions at <a href=\"https://pytorch.org/tutorials/advanced/cpp_export.html\" rel=\"nofollow\">https://pytorch.org/tutorials/advanced/cpp_export.html</a></li>\n<li>Run the compiled program on the traced torchvision resnet18</li>\n</ol>\n\n<h2>Expected behavior</h2>\n<p>The program doesn't throw any exceptions</p>\n\n<h2>Environment</h2>\n<ul>\n<li>PyTorch Version (e.g., 1.0): 1.0.0.dev20181007</li>\n<li>OS (e.g., Linux): CentOS 7.5.1804</li>\n<li>How you installed PyTorch (<code>conda</code>, <code>pip</code>, source): conda / downloaded and extracted libtorch zip</li>\n<li>Python version: 3.6</li>\n<li>CUDA/cuDNN version: None</li>\n<li>GPU models and configuration: None</li>\n<li>Any other relevant information: cmake 3.11.1,  GNU 4.8.5,  glibc 2.20</li>\n</ul>", "body_text": "\ud83d\udc1b Bug\nI followed the  instructions at https://pytorch.org/tutorials/advanced/cpp_export.html to use libtorch on CentOS, and an exception (segmentation fault) is thrown out when I'm trying to run, but there is no problem on Ubuntu. Then I used valgrind to check the memory on CentOS, the results as follows:\n==434== Command: ./example-app ../model.pt\n==434== ok\n==434== Invalid read of size 8\n==434==    at 0x434A6A: std::_Hashtable<std::string, std::pair<std::string const, unsigned long>, std::allocator<std::pair<std::string const, unsigned long> >, std::__detail::_Select1st, std::equal_to<std::string>, std::hash<std::string>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_M_find_before_node(unsigned long, std::string const&, unsigned long) const (in /icooper/dev/playphone_c/build/example-app)\n==434==    by 0x4339D9: std::_Hashtable<std::string, std::pair<std::string const, unsigned long>, std::allocator<std::pair<std::string const, unsigned long> >, std::__detail::_Select1st, std::equal_to<std::string>, std::hash<std::string>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_M_find_node(unsigned long, std::string const&, unsigned long) const (in /icooper/dev/playphone_c/build/example-app)\n==434==    by 0x433A4F: std::_Hashtable<std::string, std::pair<std::string const, unsigned long>, std::allocator<std::pair<std::string const, unsigned long> >, std::__detail::_Select1st, std::equal_to<std::string>, std::hash<std::string>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::find(std::string const&) const (in /icooper/dev/playphone_c/build/example-app)\n==434==    by 0x4320D2: std::unordered_map<std::string, unsigned long, std::hash<std::string>, std::equal_to<std::string>, std::allocator<std::pair<std::string const, unsigned long> > >::find(std::string const&) const (in /icooper/dev/playphone_c/build/example-app)\n==434==    by 0x42FBA8: torch::detail::OrderedDict<std::string, std::unique_ptr<torch::jit::script::Method, std::default_delete<torch::jit::script::Method> > >::find(std::string const&) const (in /icooper/dev/playphone_c/build/example-app)\n==434==    by 0x42D575: torch::detail::OrderedDict<std::string, std::unique_ptr<torch::jit::script::Method, std::default_delete<torch::jit::script::Method> > >::get(std::string const&) const (in /icooper/dev/playphone_c/build/example-app)\n==434==    by 0x42B117: torch::jit::script::Module::get_method(std::string const&) const (in /icooper/dev/playphone_c/build/example-app)\n==434==    by 0x42B035: torch::jit::script::Module::forward(std::vector<torch::jit::IValue, std::allocator<torch::jit::IValue> >) (in /icooper/dev/playphone_c/build/example-app)\n==434==    by 0x426BBC: main (in /icooper/dev/playphone_c/build/example-app)\n==434==  Address 0x56feade8 is not stack'd, malloc'd or (recently) free'd\n==434== Process terminating with default action of signal 11 (SIGSEGV): dumping core\n==434==  Access not within mapped region at address 0x56FEADE8\nTo Reproduce\nSteps to reproduce the behavior:\n\nFollow the instructions at https://pytorch.org/tutorials/advanced/cpp_export.html\nRun the compiled program on the traced torchvision resnet18\n\n\nExpected behavior\nThe program doesn't throw any exceptions\n\nEnvironment\n\nPyTorch Version (e.g., 1.0): 1.0.0.dev20181007\nOS (e.g., Linux): CentOS 7.5.1804\nHow you installed PyTorch (conda, pip, source): conda / downloaded and extracted libtorch zip\nPython version: 3.6\nCUDA/cuDNN version: None\nGPU models and configuration: None\nAny other relevant information: cmake 3.11.1,  GNU 4.8.5,  glibc 2.20", "body": "## \ud83d\udc1b Bug\r\n\r\nI followed the  instructions at https://pytorch.org/tutorials/advanced/cpp_export.html to use libtorch on CentOS, and an exception (segmentation fault) is thrown out when I'm trying to run, but there is no problem on Ubuntu. Then I used valgrind to check the memory on CentOS, the results as follows:\r\n\r\n`==434== Command: ./example-app ../model.pt`\r\n`==434== ok`\r\n`==434== Invalid read of size 8`\r\n`==434==    at 0x434A6A: std::_Hashtable<std::string, std::pair<std::string const, unsigned long>, std::allocator<std::pair<std::string const, unsigned long> >, std::__detail::_Select1st, std::equal_to<std::string>, std::hash<std::string>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_M_find_before_node(unsigned long, std::string const&, unsigned long) const (in /icooper/dev/playphone_c/build/example-app)`\r\n\r\n`==434==    by 0x4339D9: std::_Hashtable<std::string, std::pair<std::string const, unsigned long>, std::allocator<std::pair<std::string const, unsigned long> >, std::__detail::_Select1st, std::equal_to<std::string>, std::hash<std::string>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_M_find_node(unsigned long, std::string const&, unsigned long) const (in /icooper/dev/playphone_c/build/example-app)`\r\n\r\n`==434==    by 0x433A4F: std::_Hashtable<std::string, std::pair<std::string const, unsigned long>, std::allocator<std::pair<std::string const, unsigned long> >, std::__detail::_Select1st, std::equal_to<std::string>, std::hash<std::string>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::find(std::string const&) const (in /icooper/dev/playphone_c/build/example-app)`\r\n\r\n`==434==    by 0x4320D2: std::unordered_map<std::string, unsigned long, std::hash<std::string>, std::equal_to<std::string>, std::allocator<std::pair<std::string const, unsigned long> > >::find(std::string const&) const (in /icooper/dev/playphone_c/build/example-app)`\r\n\r\n`==434==    by 0x42FBA8: torch::detail::OrderedDict<std::string, std::unique_ptr<torch::jit::script::Method, std::default_delete<torch::jit::script::Method> > >::find(std::string const&) const (in /icooper/dev/playphone_c/build/example-app)`\r\n\r\n`==434==    by 0x42D575: torch::detail::OrderedDict<std::string, std::unique_ptr<torch::jit::script::Method, std::default_delete<torch::jit::script::Method> > >::get(std::string const&) const (in /icooper/dev/playphone_c/build/example-app)`\r\n\r\n`==434==    by 0x42B117: torch::jit::script::Module::get_method(std::string const&) const (in /icooper/dev/playphone_c/build/example-app)`\r\n\r\n`==434==    by 0x42B035: torch::jit::script::Module::forward(std::vector<torch::jit::IValue, std::allocator<torch::jit::IValue> >) (in /icooper/dev/playphone_c/build/example-app)`\r\n\r\n`==434==    by 0x426BBC: main (in /icooper/dev/playphone_c/build/example-app)`\r\n`==434==  Address 0x56feade8 is not stack'd, malloc'd or (recently) free'd`\r\n`==434== Process terminating with default action of signal 11 (SIGSEGV): dumping core`\r\n`==434==  Access not within mapped region at address 0x56FEADE8`\r\n\r\n## To Reproduce\r\n\r\nSteps to reproduce the behavior:\r\n\r\n1. Follow the instructions at https://pytorch.org/tutorials/advanced/cpp_export.html\r\n2. Run the compiled program on the traced torchvision resnet18\r\n\r\n<!-- If you have a code sample, error messages, stack traces, please provide it here as well -->\r\n\r\n## Expected behavior\r\nThe program doesn't throw any exceptions\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\n## Environment\r\n\r\n\r\n\r\n\r\n - PyTorch Version (e.g., 1.0): 1.0.0.dev20181007\r\n - OS (e.g., Linux): CentOS 7.5.1804\r\n - How you installed PyTorch (`conda`, `pip`, source): conda / downloaded and extracted libtorch zip\r\n - Python version: 3.6\r\n - CUDA/cuDNN version: None\r\n - GPU models and configuration: None\r\n - Any other relevant information: cmake 3.11.1,  GNU 4.8.5,  glibc 2.20\r\n\r\n\r\n"}