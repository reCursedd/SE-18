{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/410342731", "html_url": "https://github.com/pytorch/pytorch/issues/10032#issuecomment-410342731", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/10032", "id": 410342731, "node_id": "MDEyOklzc3VlQ29tbWVudDQxMDM0MjczMQ==", "user": {"login": "zou3519", "id": 5652049, "node_id": "MDQ6VXNlcjU2NTIwNDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/5652049?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zou3519", "html_url": "https://github.com/zou3519", "followers_url": "https://api.github.com/users/zou3519/followers", "following_url": "https://api.github.com/users/zou3519/following{/other_user}", "gists_url": "https://api.github.com/users/zou3519/gists{/gist_id}", "starred_url": "https://api.github.com/users/zou3519/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zou3519/subscriptions", "organizations_url": "https://api.github.com/users/zou3519/orgs", "repos_url": "https://api.github.com/users/zou3519/repos", "events_url": "https://api.github.com/users/zou3519/events{/privacy}", "received_events_url": "https://api.github.com/users/zou3519/received_events", "type": "User", "site_admin": false}, "created_at": "2018-08-03T18:45:08Z", "updated_at": "2018-08-03T18:45:08Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Repro script, for reference:</p>\n<pre><code>import sys\nimport torch\n\n@torch.jit.script\ndef fn(x, w_ih):\n    return x * w_ih.t()\n\ndef foo():\n    x = torch.randn(1, 1, device='cuda')\n    wih = torch.randn(1, 1, device='cuda', requires_grad=True)\n\n    fn(x, wih)\n    return\n\n# Initialize cuda things...\na = torch.randn(3, 3, device='cuda')\n\nallocated = torch.cuda.memory_allocated()\n\nfoo()\n\nnow_allocated = torch.cuda.memory_allocated()\nif allocated &lt; now_allocated:\n    print(\"leaked: {} bytes\".format(now_allocated - allocated))\n    exit(1)\n</code></pre>", "body_text": "Repro script, for reference:\nimport sys\nimport torch\n\n@torch.jit.script\ndef fn(x, w_ih):\n    return x * w_ih.t()\n\ndef foo():\n    x = torch.randn(1, 1, device='cuda')\n    wih = torch.randn(1, 1, device='cuda', requires_grad=True)\n\n    fn(x, wih)\n    return\n\n# Initialize cuda things...\na = torch.randn(3, 3, device='cuda')\n\nallocated = torch.cuda.memory_allocated()\n\nfoo()\n\nnow_allocated = torch.cuda.memory_allocated()\nif allocated < now_allocated:\n    print(\"leaked: {} bytes\".format(now_allocated - allocated))\n    exit(1)", "body": "Repro script, for reference:\r\n```\r\nimport sys\r\nimport torch\r\n\r\n@torch.jit.script\r\ndef fn(x, w_ih):\r\n    return x * w_ih.t()\r\n\r\ndef foo():\r\n    x = torch.randn(1, 1, device='cuda')\r\n    wih = torch.randn(1, 1, device='cuda', requires_grad=True)\r\n\r\n    fn(x, wih)\r\n    return\r\n\r\n# Initialize cuda things...\r\na = torch.randn(3, 3, device='cuda')\r\n\r\nallocated = torch.cuda.memory_allocated()\r\n\r\nfoo()\r\n\r\nnow_allocated = torch.cuda.memory_allocated()\r\nif allocated < now_allocated:\r\n    print(\"leaked: {} bytes\".format(now_allocated - allocated))\r\n    exit(1)\r\n```"}