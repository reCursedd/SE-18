{"url": "https://api.github.com/repos/pytorch/pytorch/issues/5093", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/5093/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/5093/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/5093/events", "html_url": "https://github.com/pytorch/pytorch/pull/5093", "id": 294941683, "node_id": "MDExOlB1bGxSZXF1ZXN0MTY3NTUxNTk4", "number": 5093, "title": "Fix CPU torch.multinomial with noncontiguous prob tensor", "user": {"login": "SsnL", "id": 5674597, "node_id": "MDQ6VXNlcjU2NzQ1OTc=", "avatar_url": "https://avatars2.githubusercontent.com/u/5674597?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SsnL", "html_url": "https://github.com/SsnL", "followers_url": "https://api.github.com/users/SsnL/followers", "following_url": "https://api.github.com/users/SsnL/following{/other_user}", "gists_url": "https://api.github.com/users/SsnL/gists{/gist_id}", "starred_url": "https://api.github.com/users/SsnL/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SsnL/subscriptions", "organizations_url": "https://api.github.com/users/SsnL/orgs", "repos_url": "https://api.github.com/users/SsnL/repos", "events_url": "https://api.github.com/users/SsnL/events{/privacy}", "received_events_url": "https://api.github.com/users/SsnL/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-02-06T22:49:05Z", "updated_at": "2018-11-23T15:39:16Z", "closed_at": "2018-02-07T03:11:44Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/5093", "html_url": "https://github.com/pytorch/pytorch/pull/5093", "diff_url": "https://github.com/pytorch/pytorch/pull/5093.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/5093.patch"}, "body_html": "<p>The CPU code previously uses <code>resize2d</code> which does not safely preserve data when input is not contiguous. This PR changes it to <code>unsqueeze1d</code> in both CPU and GPU functions, and add strided support for the two functions. As a result, <code>distributions.Categorical</code> now doesn't need to call <code>contiguous()</code> when the probabilities are not batched.</p>\n<p>Also in this PR are</p>\n<ol>\n<li>updated tests for <code>torch.multinomial</code>,</li>\n<li>updated doc for <code>distrbutions.OneHotCategorical</code> and <code>distrbutions.Categorical</code>, and</li>\n<li>shape tests for <code>distrbutions.OneHotCategorical</code> and <code>distrbutions.Categorical</code> in unbatched mode.</li>\n</ol>\n<p><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #5062.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"294545715\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/5062\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/5062/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/5062\">#5062</a></p>\n<p>cc <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1762463\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/neerajprad\">@neerajprad</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1093846\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/alicanb\">@alicanb</a> for <code>distributions.*</code> changes review.</p>", "body_text": "The CPU code previously uses resize2d which does not safely preserve data when input is not contiguous. This PR changes it to unsqueeze1d in both CPU and GPU functions, and add strided support for the two functions. As a result, distributions.Categorical now doesn't need to call contiguous() when the probabilities are not batched.\nAlso in this PR are\n\nupdated tests for torch.multinomial,\nupdated doc for distrbutions.OneHotCategorical and distrbutions.Categorical, and\nshape tests for distrbutions.OneHotCategorical and distrbutions.Categorical in unbatched mode.\n\nFixes #5062\ncc @neerajprad @alicanb for distributions.* changes review.", "body": "The CPU code previously uses `resize2d` which does not safely preserve data when input is not contiguous. This PR changes it to `unsqueeze1d` in both CPU and GPU functions, and add strided support for the two functions. As a result, `distributions.Categorical` now doesn't need to call `contiguous()` when the probabilities are not batched.\r\n\r\nAlso in this PR are \r\n1. updated tests for `torch.multinomial`,\r\n2. updated doc for `distrbutions.OneHotCategorical` and `distrbutions.Categorical`, and\r\n3. shape tests for `distrbutions.OneHotCategorical` and `distrbutions.Categorical` in unbatched mode.\r\n\r\nFixes #5062 \r\n\r\ncc @neerajprad @alicanb for `distributions.*` changes review."}