{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/169859473", "pull_request_review_id": 98453150, "id": 169859473, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2OTg1OTQ3Mw==", "diff_hunk": "@@ -390,6 +390,38 @@ def softmarginloss_reference(input, target, size_average=True, reduce=True):\n     return output\n \n \n+def _multimarginloss_reference(input, target_idx, p, margin, weight):\n+    if weight is None:\n+        weight = input.new(len(input)).fill_(1)\n+\n+    output = 0\n+    for i in range(0, len(input)):\n+        if i != target_idx:\n+            output += max(0, weight[target_idx] * (margin - input[target_idx] + input[i]) ** p)\n+    return output\n+\n+\n+def multimarginloss_reference(input, target, p=1, margin=1, weight=None, size_average=True,\n+                              reduce=True):\n+    if input.dim() == 1:\n+        n = 1\n+        dim = input.size(0)\n+        output = 0\n+        return _multimarginloss_reference(input, target[0], p, margin, weight) / dim\n+    else:\n+        n = input.size(0)\n+        dim = input.size(1)\n+        output = input.new(n).zero_()\n+        for x in range(0, n):\n+            output[x] = _multimarginloss_reference(input[x], target[x], p, margin, weight)\n+\n+    if reduce and size_average:\n+        return output.mean() / dim\n+    elif reduce:\n+        return output.sum() / dim\n+    return output / dim", "path": "test/common_nn.py", "position": null, "original_position": 33, "commit_id": "c6b323d2569e8b07f62a3aced32881c4c636d42f", "original_commit_id": "a83021661289221b832a6e19ba377d52e8264045", "user": {"login": "SsnL", "id": 5674597, "node_id": "MDQ6VXNlcjU2NzQ1OTc=", "avatar_url": "https://avatars2.githubusercontent.com/u/5674597?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SsnL", "html_url": "https://github.com/SsnL", "followers_url": "https://api.github.com/users/SsnL/followers", "following_url": "https://api.github.com/users/SsnL/following{/other_user}", "gists_url": "https://api.github.com/users/SsnL/gists{/gist_id}", "starred_url": "https://api.github.com/users/SsnL/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SsnL/subscriptions", "organizations_url": "https://api.github.com/users/SsnL/orgs", "repos_url": "https://api.github.com/users/SsnL/repos", "events_url": "https://api.github.com/users/SsnL/events{/privacy}", "received_events_url": "https://api.github.com/users/SsnL/received_events", "type": "User", "site_admin": false}, "body": "Assuming this is correct, it seems that the equation in doc below is wrong. Should it divide by `x.size(1)` instead of `x.size(0)` in the equation.\r\n\r\nAlso, could you indent this block into the `else` branch. It makes it clearer.", "created_at": "2018-02-22T05:41:44Z", "updated_at": "2018-11-23T15:39:48Z", "html_url": "https://github.com/pytorch/pytorch/pull/5150#discussion_r169859473", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/5150", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/169859473"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/5150#discussion_r169859473"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/5150"}}, "body_html": "<p>Assuming this is correct, it seems that the equation in doc below is wrong. Should it divide by <code>x.size(1)</code> instead of <code>x.size(0)</code> in the equation.</p>\n<p>Also, could you indent this block into the <code>else</code> branch. It makes it clearer.</p>", "body_text": "Assuming this is correct, it seems that the equation in doc below is wrong. Should it divide by x.size(1) instead of x.size(0) in the equation.\nAlso, could you indent this block into the else branch. It makes it clearer."}