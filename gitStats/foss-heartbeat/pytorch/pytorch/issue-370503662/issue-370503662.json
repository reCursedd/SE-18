{"url": "https://api.github.com/repos/pytorch/pytorch/issues/12704", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/12704/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/12704/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/12704/events", "html_url": "https://github.com/pytorch/pytorch/issues/12704", "id": 370503662, "node_id": "MDU6SXNzdWUzNzA1MDM2NjI=", "number": 12704, "title": "Error occuring while converting mnist or cifar model from caffe2 to onnx", "user": {"login": "parth1595", "id": 21214965, "node_id": "MDQ6VXNlcjIxMjE0OTY1", "avatar_url": "https://avatars1.githubusercontent.com/u/21214965?v=4", "gravatar_id": "", "url": "https://api.github.com/users/parth1595", "html_url": "https://github.com/parth1595", "followers_url": "https://api.github.com/users/parth1595/followers", "following_url": "https://api.github.com/users/parth1595/following{/other_user}", "gists_url": "https://api.github.com/users/parth1595/gists{/gist_id}", "starred_url": "https://api.github.com/users/parth1595/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/parth1595/subscriptions", "organizations_url": "https://api.github.com/users/parth1595/orgs", "repos_url": "https://api.github.com/users/parth1595/repos", "events_url": "https://api.github.com/users/parth1595/events{/privacy}", "received_events_url": "https://api.github.com/users/parth1595/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 890282107, "node_id": "MDU6TGFiZWw4OTAyODIxMDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/caffe2", "name": "caffe2", "color": "210aa8", "default": false}, {"id": 693805995, "node_id": "MDU6TGFiZWw2OTM4MDU5OTU=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/onnx", "name": "onnx", "color": "e99695", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-10-16T08:49:35Z", "updated_at": "2018-10-16T19:09:44Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>I am trying to convert caffe2 models(cifar and mnist) to onnx model using the following script.</p>\n<p><strong>#Code:</strong></p>\n<pre><code>import onnx\nimport caffe2.python\nimport caffe2.python.onnx.frontend\nfrom caffe2.proto import caffe2_pb2\n\ndata_type = onnx.TensorProto.FLOAT\ndata_shape = (1, 1, 28, 28)\nvalue_info = {\n    'data': (data_type, data_shape)\n}\n\npredict_net = caffe2_pb2.NetDef()\nwith open('mnist_predict_net.pb', 'rb') as f:\n    predict_net.ParseFromString(f.read())\n\ninit_net = caffe2_pb2.NetDef()\nwith open('mnist_init_net.pb', 'rb') as f:\n    init_net.ParseFromString(f.read())\n\nif predict_net.name == \"\":\n    predict_net.name = \"ModelNameHere\"\n\nonnx_model = caffe2.python.onnx.frontend.caffe2_net_to_onnx_model(\n    predict_net,\n    init_net,\n    value_info,\n)\n\nprint onnx_model\nf = open(\"mnist.onnx\", \"wb\")\nf.write(onnx_model.SerializeToString())\nonnx.checker.check_model(onnx_model)\n</code></pre>\n<p><strong>Error Log:</strong></p>\n<pre><code>WARNING:root:This caffe2 python run does not have GPU support. Will run in CPU only mode.\nWARNING: Logging before InitGoogleLogging() is written to STDERR\nW1016 13:48:03.556512 30062 init.h:99] Caffe2 GlobalInit should be run before any other API calls.\nW1016 13:48:03.556784 30062 init.h:99] Caffe2 GlobalInit should be run before any other API calls.\nI1016 13:48:03.649180 30062 operator.cc:195] Engine CUDNN is not available for operator Conv.\nI1016 13:48:03.649320 30062 operator.cc:195] Engine CUDNN is not available for operator MaxPool.\nI1016 13:48:03.649395 30062 operator.cc:195] Engine CUDNN is not available for operator Conv.\nI1016 13:48:03.649458 30062 operator.cc:195] Engine CUDNN is not available for operator MaxPool.\nI1016 13:48:03.649547 30062 operator.cc:195] Engine CUDNN is not available for operator Rel\nI1016 13:48:03.649595 30062 operator.cc:195] Engine CUDNN is not available for operator Softmax.\nTraceback (most recent call last):\n  File \"temp_model_sqeezenet.py\", line 33, in &lt;module&gt;\n    value_info,\n  File \"/home/anaconda2/lib/python2.7/site-packages/caffe2/python/onnx/frontend.py\", line 335, in caffe2_net_to_onnx_model\n    checker.check_model(model)\n  File \"/home/anaconda2/lib/python2.7/site-packages/onnx/checker.py\", line 82, in check_model\n    C.check_model(model.SerializeToString())\nonnx.onnx_cpp2py_export.checker.ValidationError: Graph must be in single static assignment (SSA) form, however 'data_0' has been used as graph input names multiple times.\n</code></pre>\n<p>Attaching the model files here.<br>\n<a href=\"https://github.com/pytorch/pytorch/files/2482198/mnist_caffe2_modes.zip\">mnist_caffe2_modes.zip</a></p>", "body_text": "I am trying to convert caffe2 models(cifar and mnist) to onnx model using the following script.\n#Code:\nimport onnx\nimport caffe2.python\nimport caffe2.python.onnx.frontend\nfrom caffe2.proto import caffe2_pb2\n\ndata_type = onnx.TensorProto.FLOAT\ndata_shape = (1, 1, 28, 28)\nvalue_info = {\n    'data': (data_type, data_shape)\n}\n\npredict_net = caffe2_pb2.NetDef()\nwith open('mnist_predict_net.pb', 'rb') as f:\n    predict_net.ParseFromString(f.read())\n\ninit_net = caffe2_pb2.NetDef()\nwith open('mnist_init_net.pb', 'rb') as f:\n    init_net.ParseFromString(f.read())\n\nif predict_net.name == \"\":\n    predict_net.name = \"ModelNameHere\"\n\nonnx_model = caffe2.python.onnx.frontend.caffe2_net_to_onnx_model(\n    predict_net,\n    init_net,\n    value_info,\n)\n\nprint onnx_model\nf = open(\"mnist.onnx\", \"wb\")\nf.write(onnx_model.SerializeToString())\nonnx.checker.check_model(onnx_model)\n\nError Log:\nWARNING:root:This caffe2 python run does not have GPU support. Will run in CPU only mode.\nWARNING: Logging before InitGoogleLogging() is written to STDERR\nW1016 13:48:03.556512 30062 init.h:99] Caffe2 GlobalInit should be run before any other API calls.\nW1016 13:48:03.556784 30062 init.h:99] Caffe2 GlobalInit should be run before any other API calls.\nI1016 13:48:03.649180 30062 operator.cc:195] Engine CUDNN is not available for operator Conv.\nI1016 13:48:03.649320 30062 operator.cc:195] Engine CUDNN is not available for operator MaxPool.\nI1016 13:48:03.649395 30062 operator.cc:195] Engine CUDNN is not available for operator Conv.\nI1016 13:48:03.649458 30062 operator.cc:195] Engine CUDNN is not available for operator MaxPool.\nI1016 13:48:03.649547 30062 operator.cc:195] Engine CUDNN is not available for operator Rel\nI1016 13:48:03.649595 30062 operator.cc:195] Engine CUDNN is not available for operator Softmax.\nTraceback (most recent call last):\n  File \"temp_model_sqeezenet.py\", line 33, in <module>\n    value_info,\n  File \"/home/anaconda2/lib/python2.7/site-packages/caffe2/python/onnx/frontend.py\", line 335, in caffe2_net_to_onnx_model\n    checker.check_model(model)\n  File \"/home/anaconda2/lib/python2.7/site-packages/onnx/checker.py\", line 82, in check_model\n    C.check_model(model.SerializeToString())\nonnx.onnx_cpp2py_export.checker.ValidationError: Graph must be in single static assignment (SSA) form, however 'data_0' has been used as graph input names multiple times.\n\nAttaching the model files here.\nmnist_caffe2_modes.zip", "body": "I am trying to convert caffe2 models(cifar and mnist) to onnx model using the following script.\r\n\r\n**#Code:**\r\n```\r\nimport onnx\r\nimport caffe2.python\r\nimport caffe2.python.onnx.frontend\r\nfrom caffe2.proto import caffe2_pb2\r\n\r\ndata_type = onnx.TensorProto.FLOAT\r\ndata_shape = (1, 1, 28, 28)\r\nvalue_info = {\r\n    'data': (data_type, data_shape)\r\n}\r\n\r\npredict_net = caffe2_pb2.NetDef()\r\nwith open('mnist_predict_net.pb', 'rb') as f:\r\n    predict_net.ParseFromString(f.read())\r\n\r\ninit_net = caffe2_pb2.NetDef()\r\nwith open('mnist_init_net.pb', 'rb') as f:\r\n    init_net.ParseFromString(f.read())\r\n\r\nif predict_net.name == \"\":\r\n    predict_net.name = \"ModelNameHere\"\r\n\r\nonnx_model = caffe2.python.onnx.frontend.caffe2_net_to_onnx_model(\r\n    predict_net,\r\n    init_net,\r\n    value_info,\r\n)\r\n\r\nprint onnx_model\r\nf = open(\"mnist.onnx\", \"wb\")\r\nf.write(onnx_model.SerializeToString())\r\nonnx.checker.check_model(onnx_model)\r\n```\r\n\r\n**Error Log:**\r\n```\r\nWARNING:root:This caffe2 python run does not have GPU support. Will run in CPU only mode.\r\nWARNING: Logging before InitGoogleLogging() is written to STDERR\r\nW1016 13:48:03.556512 30062 init.h:99] Caffe2 GlobalInit should be run before any other API calls.\r\nW1016 13:48:03.556784 30062 init.h:99] Caffe2 GlobalInit should be run before any other API calls.\r\nI1016 13:48:03.649180 30062 operator.cc:195] Engine CUDNN is not available for operator Conv.\r\nI1016 13:48:03.649320 30062 operator.cc:195] Engine CUDNN is not available for operator MaxPool.\r\nI1016 13:48:03.649395 30062 operator.cc:195] Engine CUDNN is not available for operator Conv.\r\nI1016 13:48:03.649458 30062 operator.cc:195] Engine CUDNN is not available for operator MaxPool.\r\nI1016 13:48:03.649547 30062 operator.cc:195] Engine CUDNN is not available for operator Rel\r\nI1016 13:48:03.649595 30062 operator.cc:195] Engine CUDNN is not available for operator Softmax.\r\nTraceback (most recent call last):\r\n  File \"temp_model_sqeezenet.py\", line 33, in <module>\r\n    value_info,\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/caffe2/python/onnx/frontend.py\", line 335, in caffe2_net_to_onnx_model\r\n    checker.check_model(model)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/onnx/checker.py\", line 82, in check_model\r\n    C.check_model(model.SerializeToString())\r\nonnx.onnx_cpp2py_export.checker.ValidationError: Graph must be in single static assignment (SSA) form, however 'data_0' has been used as graph input names multiple times.\r\n```\r\n\r\n Attaching the model files here.\r\n[mnist_caffe2_modes.zip](https://github.com/pytorch/pytorch/files/2482198/mnist_caffe2_modes.zip)\r\n"}