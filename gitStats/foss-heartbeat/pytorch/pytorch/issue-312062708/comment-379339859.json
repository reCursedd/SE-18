{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/379339859", "html_url": "https://github.com/pytorch/pytorch/issues/6356#issuecomment-379339859", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/6356", "id": 379339859, "node_id": "MDEyOklzc3VlQ29tbWVudDM3OTMzOTg1OQ==", "user": {"login": "BinhangYuan", "id": 6721177, "node_id": "MDQ6VXNlcjY3MjExNzc=", "avatar_url": "https://avatars1.githubusercontent.com/u/6721177?v=4", "gravatar_id": "", "url": "https://api.github.com/users/BinhangYuan", "html_url": "https://github.com/BinhangYuan", "followers_url": "https://api.github.com/users/BinhangYuan/followers", "following_url": "https://api.github.com/users/BinhangYuan/following{/other_user}", "gists_url": "https://api.github.com/users/BinhangYuan/gists{/gist_id}", "starred_url": "https://api.github.com/users/BinhangYuan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/BinhangYuan/subscriptions", "organizations_url": "https://api.github.com/users/BinhangYuan/orgs", "repos_url": "https://api.github.com/users/BinhangYuan/repos", "events_url": "https://api.github.com/users/BinhangYuan/events{/privacy}", "received_events_url": "https://api.github.com/users/BinhangYuan/received_events", "type": "User", "site_admin": false}, "created_at": "2018-04-06T18:35:51Z", "updated_at": "2018-04-06T18:35:51Z", "author_association": "NONE", "body_html": "<p>Hi <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1100089\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/yinghai\">@yinghai</a><br>\nThe PB for the second way is here:</p>\n<pre><code>name: \"dnn_wikipedia_init\"\nop {\n  output: \"z2_w\"\n  name: \"\"\n  type: \"XavierFill\"\n  arg {\n    name: \"shape\"\n    ints: 40\n    ints: 60\n  }\n}\nop {\n  output: \"z2_b\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 40\n  }\n}\nop {\n  output: \"z3_w\"\n  name: \"\"\n  type: \"XavierFill\"\n  arg {\n    name: \"shape\"\n    ints: 40\n    ints: 40\n  }\n}\nop {\n  output: \"z3_b\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 40\n  }\n}\nop {\n  output: \"z4_w\"\n  name: \"\"\n  type: \"XavierFill\"\n  arg {\n    name: \"shape\"\n    ints: 17\n    ints: 40\n  }\n}\nop {\n  output: \"z4_b\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 17\n  }\n}\n\nname: \"dnn_wikipedia\"\nop {\n  input: \"X\"\n  input: \"z2_w\"\n  input: \"z2_b\"\n  output: \"z2\"\n  name: \"\"\n  type: \"FC\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n}\nop {\n  input: \"z2\"\n  output: \"a2\"\n  name: \"\"\n  type: \"Relu\"\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  engine: \"CUDNN\"\n}\nop {\n  input: \"a2\"\n  input: \"z3_w\"\n  input: \"z3_b\"\n  output: \"z3\"\n  name: \"\"\n  type: \"FC\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n}\nop {\n  input: \"z3\"\n  output: \"a3\"\n  name: \"\"\n  type: \"Relu\"\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  engine: \"CUDNN\"\n}\nop {\n  input: \"a3\"\n  input: \"z4_w\"\n  input: \"z4_b\"\n  output: \"z4\"\n  name: \"\"\n  type: \"FC\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n}\nop {\n  input: \"z4\"\n  input: \"Y\"\n  output: \"softmax\"\n  output: \"loss\"\n  name: \"\"\n  type: \"SoftmaxWithLoss\"\n}\nop {\n  input: \"loss\"\n  output: \"loss_autogen_grad\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"value\"\n    f: 1.0\n  }\n}\nop {\n  input: \"z4\"\n  input: \"Y\"\n  input: \"softmax\"\n  input: \"loss_autogen_grad\"\n  output: \"z4_grad\"\n  name: \"\"\n  type: \"SoftmaxWithLossGradient\"\n  is_gradient_op: true\n}\nop {\n  input: \"a3\"\n  input: \"z4_w\"\n  input: \"z4_grad\"\n  output: \"z4_w_grad\"\n  output: \"z4_b_grad\"\n  output: \"a3_grad\"\n  name: \"\"\n  type: \"FCGradient\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  is_gradient_op: true\n}\nop {\n  input: \"a3\"\n  input: \"a3_grad\"\n  output: \"z3_grad\"\n  name: \"\"\n  type: \"ReluGradient\"\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  engine: \"CUDNN\"\n  is_gradient_op: true\n}\nop {\n  input: \"a2\"\n  input: \"z3_w\"\n  input: \"z3_grad\"\n  output: \"z3_w_grad\"\n  output: \"z3_b_grad\"\n  output: \"a2_grad\"\n  name: \"\"\n  type: \"FCGradient\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  is_gradient_op: true\n}\nop {\n  input: \"a2\"\n  input: \"a2_grad\"\n  output: \"z2_grad\"\n  name: \"\"\n  type: \"ReluGradient\"\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  engine: \"CUDNN\"\n  is_gradient_op: true\n}\nop {\n  input: \"X\"\n  input: \"z2_w\"\n  input: \"z2_grad\"\n  output: \"z2_w_grad\"\n  output: \"z2_b_grad\"\n  output: \"X_grad\"\n  name: \"\"\n  type: \"FCGradient\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  is_gradient_op: true\n}\nexternal_input: \"X\"\nexternal_input: \"z2_w\"\nexternal_input: \"z2_b\"\nexternal_input: \"z3_w\"\nexternal_input: \"z3_b\"\nexternal_input: \"z4_w\"\nexternal_input: \"z4_b\"\nexternal_input: \"Y\"\n\nname: \"dnn_wikipedia_init\"\nop {\n  output: \"z2_w\"\n  name: \"\"\n  type: \"XavierFill\"\n  arg {\n    name: \"shape\"\n    ints: 40\n    ints: 60\n  }\n}\nop {\n  output: \"z2_b\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 40\n  }\n}\nop {\n  output: \"z3_w\"\n  name: \"\"\n  type: \"XavierFill\"\n  arg {\n    name: \"shape\"\n    ints: 40\n    ints: 40\n  }\n}\nop {\n  output: \"z3_b\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 40\n  }\n}\nop {\n  output: \"z4_w\"\n  name: \"\"\n  type: \"XavierFill\"\n  arg {\n    name: \"shape\"\n    ints: 17\n    ints: 40\n  }\n}\nop {\n  output: \"z4_b\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 17\n  }\n}\nop {\n  output: \"optimizer_iteration\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"dtype\"\n    i: 10\n  }\n  arg {\n    name: \"shape\"\n    ints: 1\n  }\n  arg {\n    name: \"value\"\n    i: 0\n  }\n  device_option {\n    device_type: 0\n    cuda_gpu_id: 0\n  }\n}\nop {\n  output: \"iteration_mutex\"\n  name: \"\"\n  type: \"CreateMutex\"\n  device_option {\n    device_type: 0\n    cuda_gpu_id: 0\n  }\n}\nop {\n  output: \"ONE_0_0\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 1\n  }\n  arg {\n    name: \"value\"\n    f: 1.0\n  }\n  device_option {\n  }\n}\nop {\n  output: \"ONE_0_0\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 1\n  }\n  arg {\n    name: \"value\"\n    f: 1.0\n  }\n  device_option {\n  }\n}\nop {\n  output: \"ONE_0_0\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 1\n  }\n  arg {\n    name: \"value\"\n    f: 1.0\n  }\n  device_option {\n  }\n}\nop {\n  output: \"ONE_0_0\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 1\n  }\n  arg {\n    name: \"value\"\n    f: 1.0\n  }\n  device_option {\n  }\n}\nop {\n  output: \"ONE_0_0\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 1\n  }\n  arg {\n    name: \"value\"\n    f: 1.0\n  }\n  device_option {\n  }\n}\nop {\n  output: \"ONE_0_0\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 1\n  }\n  arg {\n    name: \"value\"\n    f: 1.0\n  }\n  device_option {\n  }\n}\n\nname: \"dnn_wikipedia\"\nop {\n  input: \"X\"\n  input: \"z2_w\"\n  input: \"z2_b\"\n  output: \"z2\"\n  name: \"\"\n  type: \"FC\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n}\nop {\n  input: \"z2\"\n  output: \"a2\"\n  name: \"\"\n  type: \"Relu\"\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  engine: \"CUDNN\"\n}\nop {\n  input: \"a2\"\n  input: \"z3_w\"\n  input: \"z3_b\"\n  output: \"z3\"\n  name: \"\"\n  type: \"FC\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n}\nop {\n  input: \"z3\"\n  output: \"a3\"\n  name: \"\"\n  type: \"Relu\"\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  engine: \"CUDNN\"\n}\nop {\n  input: \"a3\"\n  input: \"z4_w\"\n  input: \"z4_b\"\n  output: \"z4\"\n  name: \"\"\n  type: \"FC\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n}\nop {\n  input: \"z4\"\n  input: \"Y\"\n  output: \"softmax\"\n  output: \"loss\"\n  name: \"\"\n  type: \"SoftmaxWithLoss\"\n}\nop {\n  input: \"loss\"\n  output: \"loss_autogen_grad\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"value\"\n    f: 1.0\n  }\n}\nop {\n  input: \"z4\"\n  input: \"Y\"\n  input: \"softmax\"\n  input: \"loss_autogen_grad\"\n  output: \"z4_grad\"\n  name: \"\"\n  type: \"SoftmaxWithLossGradient\"\n  is_gradient_op: true\n}\nop {\n  input: \"a3\"\n  input: \"z4_w\"\n  input: \"z4_grad\"\n  output: \"z4_w_grad\"\n  output: \"z4_b_grad\"\n  output: \"a3_grad\"\n  name: \"\"\n  type: \"FCGradient\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  is_gradient_op: true\n}\nop {\n  input: \"a3\"\n  input: \"a3_grad\"\n  output: \"z3_grad\"\n  name: \"\"\n  type: \"ReluGradient\"\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  engine: \"CUDNN\"\n  is_gradient_op: true\n}\nop {\n  input: \"a2\"\n  input: \"z3_w\"\n  input: \"z3_grad\"\n  output: \"z3_w_grad\"\n  output: \"z3_b_grad\"\n  output: \"a2_grad\"\n  name: \"\"\n  type: \"FCGradient\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  is_gradient_op: true\n}\nop {\n  input: \"a2\"\n  input: \"a2_grad\"\n  output: \"z2_grad\"\n  name: \"\"\n  type: \"ReluGradient\"\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  engine: \"CUDNN\"\n  is_gradient_op: true\n}\nop {\n  input: \"X\"\n  input: \"z2_w\"\n  input: \"z2_grad\"\n  output: \"z2_w_grad\"\n  output: \"z2_b_grad\"\n  output: \"X_grad\"\n  name: \"\"\n  type: \"FCGradient\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  is_gradient_op: true\n}\nop {\n  input: \"iteration_mutex\"\n  input: \"optimizer_iteration\"\n  output: \"optimizer_iteration\"\n  name: \"\"\n  type: \"AtomicIter\"\n  device_option {\n    device_type: 0\n    cuda_gpu_id: 0\n  }\n}\nop {\n  input: \"optimizer_iteration\"\n  output: \"SgdOptimizer_0_lr_cpu\"\n  name: \"\"\n  type: \"LearningRate\"\n  arg {\n    name: \"policy\"\n    s: \"fixed\"\n  }\n  arg {\n    name: \"base_lr\"\n    f: -0.0500000007451\n  }\n  device_option {\n  }\n}\nop {\n  input: \"z4_w\"\n  input: \"ONE_0_0\"\n  input: \"z4_w_grad\"\n  input: \"SgdOptimizer_0_lr_cpu\"\n  output: \"z4_w\"\n  name: \"\"\n  type: \"WeightedSum\"\n  device_option {\n  }\n}\nop {\n  input: \"z2_b\"\n  input: \"ONE_0_0\"\n  input: \"z2_b_grad\"\n  input: \"SgdOptimizer_0_lr_cpu\"\n  output: \"z2_b\"\n  name: \"\"\n  type: \"WeightedSum\"\n  device_option {\n  }\n}\nop {\n  input: \"z3_w\"\n  input: \"ONE_0_0\"\n  input: \"z3_w_grad\"\n  input: \"SgdOptimizer_0_lr_cpu\"\n  output: \"z3_w\"\n  name: \"\"\n  type: \"WeightedSum\"\n  device_option {\n  }\n}\nop {\n  input: \"z2_w\"\n  input: \"ONE_0_0\"\n  input: \"z2_w_grad\"\n  input: \"SgdOptimizer_0_lr_cpu\"\n  output: \"z2_w\"\n  name: \"\"\n  type: \"WeightedSum\"\n  device_option {\n  }\n}\nop {\n  input: \"z4_b\"\n  input: \"ONE_0_0\"\n  input: \"z4_b_grad\"\n  input: \"SgdOptimizer_0_lr_cpu\"\n  output: \"z4_b\"\n  name: \"\"\n  type: \"WeightedSum\"\n  device_option {\n  }\n}\nop {\n  input: \"z3_b\"\n  input: \"ONE_0_0\"\n  input: \"z3_b_grad\"\n  input: \"SgdOptimizer_0_lr_cpu\"\n  output: \"z3_b\"\n  name: \"\"\n  type: \"WeightedSum\"\n  device_option {\n  }\n}\nexternal_input: \"X\"\nexternal_input: \"z2_w\"\nexternal_input: \"z2_b\"\nexternal_input: \"z3_w\"\nexternal_input: \"z3_b\"\nexternal_input: \"z4_w\"\nexternal_input: \"z4_b\"\nexternal_input: \"Y\"\nexternal_input: \"iteration_mutex\"\nexternal_input: \"optimizer_iteration\"\nexternal_input: \"ONE_0_0\"\n</code></pre>\n<p>I think the operators related to gradient update is missing in the first way.</p>\n<p>Best wishes,<br>\nBinhang</p>", "body_text": "Hi @yinghai\nThe PB for the second way is here:\nname: \"dnn_wikipedia_init\"\nop {\n  output: \"z2_w\"\n  name: \"\"\n  type: \"XavierFill\"\n  arg {\n    name: \"shape\"\n    ints: 40\n    ints: 60\n  }\n}\nop {\n  output: \"z2_b\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 40\n  }\n}\nop {\n  output: \"z3_w\"\n  name: \"\"\n  type: \"XavierFill\"\n  arg {\n    name: \"shape\"\n    ints: 40\n    ints: 40\n  }\n}\nop {\n  output: \"z3_b\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 40\n  }\n}\nop {\n  output: \"z4_w\"\n  name: \"\"\n  type: \"XavierFill\"\n  arg {\n    name: \"shape\"\n    ints: 17\n    ints: 40\n  }\n}\nop {\n  output: \"z4_b\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 17\n  }\n}\n\nname: \"dnn_wikipedia\"\nop {\n  input: \"X\"\n  input: \"z2_w\"\n  input: \"z2_b\"\n  output: \"z2\"\n  name: \"\"\n  type: \"FC\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n}\nop {\n  input: \"z2\"\n  output: \"a2\"\n  name: \"\"\n  type: \"Relu\"\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  engine: \"CUDNN\"\n}\nop {\n  input: \"a2\"\n  input: \"z3_w\"\n  input: \"z3_b\"\n  output: \"z3\"\n  name: \"\"\n  type: \"FC\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n}\nop {\n  input: \"z3\"\n  output: \"a3\"\n  name: \"\"\n  type: \"Relu\"\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  engine: \"CUDNN\"\n}\nop {\n  input: \"a3\"\n  input: \"z4_w\"\n  input: \"z4_b\"\n  output: \"z4\"\n  name: \"\"\n  type: \"FC\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n}\nop {\n  input: \"z4\"\n  input: \"Y\"\n  output: \"softmax\"\n  output: \"loss\"\n  name: \"\"\n  type: \"SoftmaxWithLoss\"\n}\nop {\n  input: \"loss\"\n  output: \"loss_autogen_grad\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"value\"\n    f: 1.0\n  }\n}\nop {\n  input: \"z4\"\n  input: \"Y\"\n  input: \"softmax\"\n  input: \"loss_autogen_grad\"\n  output: \"z4_grad\"\n  name: \"\"\n  type: \"SoftmaxWithLossGradient\"\n  is_gradient_op: true\n}\nop {\n  input: \"a3\"\n  input: \"z4_w\"\n  input: \"z4_grad\"\n  output: \"z4_w_grad\"\n  output: \"z4_b_grad\"\n  output: \"a3_grad\"\n  name: \"\"\n  type: \"FCGradient\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  is_gradient_op: true\n}\nop {\n  input: \"a3\"\n  input: \"a3_grad\"\n  output: \"z3_grad\"\n  name: \"\"\n  type: \"ReluGradient\"\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  engine: \"CUDNN\"\n  is_gradient_op: true\n}\nop {\n  input: \"a2\"\n  input: \"z3_w\"\n  input: \"z3_grad\"\n  output: \"z3_w_grad\"\n  output: \"z3_b_grad\"\n  output: \"a2_grad\"\n  name: \"\"\n  type: \"FCGradient\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  is_gradient_op: true\n}\nop {\n  input: \"a2\"\n  input: \"a2_grad\"\n  output: \"z2_grad\"\n  name: \"\"\n  type: \"ReluGradient\"\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  engine: \"CUDNN\"\n  is_gradient_op: true\n}\nop {\n  input: \"X\"\n  input: \"z2_w\"\n  input: \"z2_grad\"\n  output: \"z2_w_grad\"\n  output: \"z2_b_grad\"\n  output: \"X_grad\"\n  name: \"\"\n  type: \"FCGradient\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  is_gradient_op: true\n}\nexternal_input: \"X\"\nexternal_input: \"z2_w\"\nexternal_input: \"z2_b\"\nexternal_input: \"z3_w\"\nexternal_input: \"z3_b\"\nexternal_input: \"z4_w\"\nexternal_input: \"z4_b\"\nexternal_input: \"Y\"\n\nname: \"dnn_wikipedia_init\"\nop {\n  output: \"z2_w\"\n  name: \"\"\n  type: \"XavierFill\"\n  arg {\n    name: \"shape\"\n    ints: 40\n    ints: 60\n  }\n}\nop {\n  output: \"z2_b\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 40\n  }\n}\nop {\n  output: \"z3_w\"\n  name: \"\"\n  type: \"XavierFill\"\n  arg {\n    name: \"shape\"\n    ints: 40\n    ints: 40\n  }\n}\nop {\n  output: \"z3_b\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 40\n  }\n}\nop {\n  output: \"z4_w\"\n  name: \"\"\n  type: \"XavierFill\"\n  arg {\n    name: \"shape\"\n    ints: 17\n    ints: 40\n  }\n}\nop {\n  output: \"z4_b\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 17\n  }\n}\nop {\n  output: \"optimizer_iteration\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"dtype\"\n    i: 10\n  }\n  arg {\n    name: \"shape\"\n    ints: 1\n  }\n  arg {\n    name: \"value\"\n    i: 0\n  }\n  device_option {\n    device_type: 0\n    cuda_gpu_id: 0\n  }\n}\nop {\n  output: \"iteration_mutex\"\n  name: \"\"\n  type: \"CreateMutex\"\n  device_option {\n    device_type: 0\n    cuda_gpu_id: 0\n  }\n}\nop {\n  output: \"ONE_0_0\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 1\n  }\n  arg {\n    name: \"value\"\n    f: 1.0\n  }\n  device_option {\n  }\n}\nop {\n  output: \"ONE_0_0\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 1\n  }\n  arg {\n    name: \"value\"\n    f: 1.0\n  }\n  device_option {\n  }\n}\nop {\n  output: \"ONE_0_0\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 1\n  }\n  arg {\n    name: \"value\"\n    f: 1.0\n  }\n  device_option {\n  }\n}\nop {\n  output: \"ONE_0_0\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 1\n  }\n  arg {\n    name: \"value\"\n    f: 1.0\n  }\n  device_option {\n  }\n}\nop {\n  output: \"ONE_0_0\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 1\n  }\n  arg {\n    name: \"value\"\n    f: 1.0\n  }\n  device_option {\n  }\n}\nop {\n  output: \"ONE_0_0\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"shape\"\n    ints: 1\n  }\n  arg {\n    name: \"value\"\n    f: 1.0\n  }\n  device_option {\n  }\n}\n\nname: \"dnn_wikipedia\"\nop {\n  input: \"X\"\n  input: \"z2_w\"\n  input: \"z2_b\"\n  output: \"z2\"\n  name: \"\"\n  type: \"FC\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n}\nop {\n  input: \"z2\"\n  output: \"a2\"\n  name: \"\"\n  type: \"Relu\"\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  engine: \"CUDNN\"\n}\nop {\n  input: \"a2\"\n  input: \"z3_w\"\n  input: \"z3_b\"\n  output: \"z3\"\n  name: \"\"\n  type: \"FC\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n}\nop {\n  input: \"z3\"\n  output: \"a3\"\n  name: \"\"\n  type: \"Relu\"\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  engine: \"CUDNN\"\n}\nop {\n  input: \"a3\"\n  input: \"z4_w\"\n  input: \"z4_b\"\n  output: \"z4\"\n  name: \"\"\n  type: \"FC\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n}\nop {\n  input: \"z4\"\n  input: \"Y\"\n  output: \"softmax\"\n  output: \"loss\"\n  name: \"\"\n  type: \"SoftmaxWithLoss\"\n}\nop {\n  input: \"loss\"\n  output: \"loss_autogen_grad\"\n  name: \"\"\n  type: \"ConstantFill\"\n  arg {\n    name: \"value\"\n    f: 1.0\n  }\n}\nop {\n  input: \"z4\"\n  input: \"Y\"\n  input: \"softmax\"\n  input: \"loss_autogen_grad\"\n  output: \"z4_grad\"\n  name: \"\"\n  type: \"SoftmaxWithLossGradient\"\n  is_gradient_op: true\n}\nop {\n  input: \"a3\"\n  input: \"z4_w\"\n  input: \"z4_grad\"\n  output: \"z4_w_grad\"\n  output: \"z4_b_grad\"\n  output: \"a3_grad\"\n  name: \"\"\n  type: \"FCGradient\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  is_gradient_op: true\n}\nop {\n  input: \"a3\"\n  input: \"a3_grad\"\n  output: \"z3_grad\"\n  name: \"\"\n  type: \"ReluGradient\"\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  engine: \"CUDNN\"\n  is_gradient_op: true\n}\nop {\n  input: \"a2\"\n  input: \"z3_w\"\n  input: \"z3_grad\"\n  output: \"z3_w_grad\"\n  output: \"z3_b_grad\"\n  output: \"a2_grad\"\n  name: \"\"\n  type: \"FCGradient\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  is_gradient_op: true\n}\nop {\n  input: \"a2\"\n  input: \"a2_grad\"\n  output: \"z2_grad\"\n  name: \"\"\n  type: \"ReluGradient\"\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  engine: \"CUDNN\"\n  is_gradient_op: true\n}\nop {\n  input: \"X\"\n  input: \"z2_w\"\n  input: \"z2_grad\"\n  output: \"z2_w_grad\"\n  output: \"z2_b_grad\"\n  output: \"X_grad\"\n  name: \"\"\n  type: \"FCGradient\"\n  arg {\n    name: \"use_cudnn\"\n    i: 1\n  }\n  arg {\n    name: \"order\"\n    s: \"NCHW\"\n  }\n  arg {\n    name: \"cudnn_exhaustive_search\"\n    i: 0\n  }\n  is_gradient_op: true\n}\nop {\n  input: \"iteration_mutex\"\n  input: \"optimizer_iteration\"\n  output: \"optimizer_iteration\"\n  name: \"\"\n  type: \"AtomicIter\"\n  device_option {\n    device_type: 0\n    cuda_gpu_id: 0\n  }\n}\nop {\n  input: \"optimizer_iteration\"\n  output: \"SgdOptimizer_0_lr_cpu\"\n  name: \"\"\n  type: \"LearningRate\"\n  arg {\n    name: \"policy\"\n    s: \"fixed\"\n  }\n  arg {\n    name: \"base_lr\"\n    f: -0.0500000007451\n  }\n  device_option {\n  }\n}\nop {\n  input: \"z4_w\"\n  input: \"ONE_0_0\"\n  input: \"z4_w_grad\"\n  input: \"SgdOptimizer_0_lr_cpu\"\n  output: \"z4_w\"\n  name: \"\"\n  type: \"WeightedSum\"\n  device_option {\n  }\n}\nop {\n  input: \"z2_b\"\n  input: \"ONE_0_0\"\n  input: \"z2_b_grad\"\n  input: \"SgdOptimizer_0_lr_cpu\"\n  output: \"z2_b\"\n  name: \"\"\n  type: \"WeightedSum\"\n  device_option {\n  }\n}\nop {\n  input: \"z3_w\"\n  input: \"ONE_0_0\"\n  input: \"z3_w_grad\"\n  input: \"SgdOptimizer_0_lr_cpu\"\n  output: \"z3_w\"\n  name: \"\"\n  type: \"WeightedSum\"\n  device_option {\n  }\n}\nop {\n  input: \"z2_w\"\n  input: \"ONE_0_0\"\n  input: \"z2_w_grad\"\n  input: \"SgdOptimizer_0_lr_cpu\"\n  output: \"z2_w\"\n  name: \"\"\n  type: \"WeightedSum\"\n  device_option {\n  }\n}\nop {\n  input: \"z4_b\"\n  input: \"ONE_0_0\"\n  input: \"z4_b_grad\"\n  input: \"SgdOptimizer_0_lr_cpu\"\n  output: \"z4_b\"\n  name: \"\"\n  type: \"WeightedSum\"\n  device_option {\n  }\n}\nop {\n  input: \"z3_b\"\n  input: \"ONE_0_0\"\n  input: \"z3_b_grad\"\n  input: \"SgdOptimizer_0_lr_cpu\"\n  output: \"z3_b\"\n  name: \"\"\n  type: \"WeightedSum\"\n  device_option {\n  }\n}\nexternal_input: \"X\"\nexternal_input: \"z2_w\"\nexternal_input: \"z2_b\"\nexternal_input: \"z3_w\"\nexternal_input: \"z3_b\"\nexternal_input: \"z4_w\"\nexternal_input: \"z4_b\"\nexternal_input: \"Y\"\nexternal_input: \"iteration_mutex\"\nexternal_input: \"optimizer_iteration\"\nexternal_input: \"ONE_0_0\"\n\nI think the operators related to gradient update is missing in the first way.\nBest wishes,\nBinhang", "body": "Hi @yinghai \r\nThe PB for the second way is here:\r\n\r\n```\r\nname: \"dnn_wikipedia_init\"\r\nop {\r\n  output: \"z2_w\"\r\n  name: \"\"\r\n  type: \"XavierFill\"\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 40\r\n    ints: 60\r\n  }\r\n}\r\nop {\r\n  output: \"z2_b\"\r\n  name: \"\"\r\n  type: \"ConstantFill\"\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 40\r\n  }\r\n}\r\nop {\r\n  output: \"z3_w\"\r\n  name: \"\"\r\n  type: \"XavierFill\"\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 40\r\n    ints: 40\r\n  }\r\n}\r\nop {\r\n  output: \"z3_b\"\r\n  name: \"\"\r\n  type: \"ConstantFill\"\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 40\r\n  }\r\n}\r\nop {\r\n  output: \"z4_w\"\r\n  name: \"\"\r\n  type: \"XavierFill\"\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 17\r\n    ints: 40\r\n  }\r\n}\r\nop {\r\n  output: \"z4_b\"\r\n  name: \"\"\r\n  type: \"ConstantFill\"\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 17\r\n  }\r\n}\r\n\r\nname: \"dnn_wikipedia\"\r\nop {\r\n  input: \"X\"\r\n  input: \"z2_w\"\r\n  input: \"z2_b\"\r\n  output: \"z2\"\r\n  name: \"\"\r\n  type: \"FC\"\r\n  arg {\r\n    name: \"use_cudnn\"\r\n    i: 1\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n}\r\nop {\r\n  input: \"z2\"\r\n  output: \"a2\"\r\n  name: \"\"\r\n  type: \"Relu\"\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  engine: \"CUDNN\"\r\n}\r\nop {\r\n  input: \"a2\"\r\n  input: \"z3_w\"\r\n  input: \"z3_b\"\r\n  output: \"z3\"\r\n  name: \"\"\r\n  type: \"FC\"\r\n  arg {\r\n    name: \"use_cudnn\"\r\n    i: 1\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n}\r\nop {\r\n  input: \"z3\"\r\n  output: \"a3\"\r\n  name: \"\"\r\n  type: \"Relu\"\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  engine: \"CUDNN\"\r\n}\r\nop {\r\n  input: \"a3\"\r\n  input: \"z4_w\"\r\n  input: \"z4_b\"\r\n  output: \"z4\"\r\n  name: \"\"\r\n  type: \"FC\"\r\n  arg {\r\n    name: \"use_cudnn\"\r\n    i: 1\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n}\r\nop {\r\n  input: \"z4\"\r\n  input: \"Y\"\r\n  output: \"softmax\"\r\n  output: \"loss\"\r\n  name: \"\"\r\n  type: \"SoftmaxWithLoss\"\r\n}\r\nop {\r\n  input: \"loss\"\r\n  output: \"loss_autogen_grad\"\r\n  name: \"\"\r\n  type: \"ConstantFill\"\r\n  arg {\r\n    name: \"value\"\r\n    f: 1.0\r\n  }\r\n}\r\nop {\r\n  input: \"z4\"\r\n  input: \"Y\"\r\n  input: \"softmax\"\r\n  input: \"loss_autogen_grad\"\r\n  output: \"z4_grad\"\r\n  name: \"\"\r\n  type: \"SoftmaxWithLossGradient\"\r\n  is_gradient_op: true\r\n}\r\nop {\r\n  input: \"a3\"\r\n  input: \"z4_w\"\r\n  input: \"z4_grad\"\r\n  output: \"z4_w_grad\"\r\n  output: \"z4_b_grad\"\r\n  output: \"a3_grad\"\r\n  name: \"\"\r\n  type: \"FCGradient\"\r\n  arg {\r\n    name: \"use_cudnn\"\r\n    i: 1\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n  is_gradient_op: true\r\n}\r\nop {\r\n  input: \"a3\"\r\n  input: \"a3_grad\"\r\n  output: \"z3_grad\"\r\n  name: \"\"\r\n  type: \"ReluGradient\"\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  engine: \"CUDNN\"\r\n  is_gradient_op: true\r\n}\r\nop {\r\n  input: \"a2\"\r\n  input: \"z3_w\"\r\n  input: \"z3_grad\"\r\n  output: \"z3_w_grad\"\r\n  output: \"z3_b_grad\"\r\n  output: \"a2_grad\"\r\n  name: \"\"\r\n  type: \"FCGradient\"\r\n  arg {\r\n    name: \"use_cudnn\"\r\n    i: 1\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n  is_gradient_op: true\r\n}\r\nop {\r\n  input: \"a2\"\r\n  input: \"a2_grad\"\r\n  output: \"z2_grad\"\r\n  name: \"\"\r\n  type: \"ReluGradient\"\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  engine: \"CUDNN\"\r\n  is_gradient_op: true\r\n}\r\nop {\r\n  input: \"X\"\r\n  input: \"z2_w\"\r\n  input: \"z2_grad\"\r\n  output: \"z2_w_grad\"\r\n  output: \"z2_b_grad\"\r\n  output: \"X_grad\"\r\n  name: \"\"\r\n  type: \"FCGradient\"\r\n  arg {\r\n    name: \"use_cudnn\"\r\n    i: 1\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n  is_gradient_op: true\r\n}\r\nexternal_input: \"X\"\r\nexternal_input: \"z2_w\"\r\nexternal_input: \"z2_b\"\r\nexternal_input: \"z3_w\"\r\nexternal_input: \"z3_b\"\r\nexternal_input: \"z4_w\"\r\nexternal_input: \"z4_b\"\r\nexternal_input: \"Y\"\r\n\r\nname: \"dnn_wikipedia_init\"\r\nop {\r\n  output: \"z2_w\"\r\n  name: \"\"\r\n  type: \"XavierFill\"\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 40\r\n    ints: 60\r\n  }\r\n}\r\nop {\r\n  output: \"z2_b\"\r\n  name: \"\"\r\n  type: \"ConstantFill\"\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 40\r\n  }\r\n}\r\nop {\r\n  output: \"z3_w\"\r\n  name: \"\"\r\n  type: \"XavierFill\"\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 40\r\n    ints: 40\r\n  }\r\n}\r\nop {\r\n  output: \"z3_b\"\r\n  name: \"\"\r\n  type: \"ConstantFill\"\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 40\r\n  }\r\n}\r\nop {\r\n  output: \"z4_w\"\r\n  name: \"\"\r\n  type: \"XavierFill\"\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 17\r\n    ints: 40\r\n  }\r\n}\r\nop {\r\n  output: \"z4_b\"\r\n  name: \"\"\r\n  type: \"ConstantFill\"\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 17\r\n  }\r\n}\r\nop {\r\n  output: \"optimizer_iteration\"\r\n  name: \"\"\r\n  type: \"ConstantFill\"\r\n  arg {\r\n    name: \"dtype\"\r\n    i: 10\r\n  }\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 1\r\n  }\r\n  arg {\r\n    name: \"value\"\r\n    i: 0\r\n  }\r\n  device_option {\r\n    device_type: 0\r\n    cuda_gpu_id: 0\r\n  }\r\n}\r\nop {\r\n  output: \"iteration_mutex\"\r\n  name: \"\"\r\n  type: \"CreateMutex\"\r\n  device_option {\r\n    device_type: 0\r\n    cuda_gpu_id: 0\r\n  }\r\n}\r\nop {\r\n  output: \"ONE_0_0\"\r\n  name: \"\"\r\n  type: \"ConstantFill\"\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 1\r\n  }\r\n  arg {\r\n    name: \"value\"\r\n    f: 1.0\r\n  }\r\n  device_option {\r\n  }\r\n}\r\nop {\r\n  output: \"ONE_0_0\"\r\n  name: \"\"\r\n  type: \"ConstantFill\"\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 1\r\n  }\r\n  arg {\r\n    name: \"value\"\r\n    f: 1.0\r\n  }\r\n  device_option {\r\n  }\r\n}\r\nop {\r\n  output: \"ONE_0_0\"\r\n  name: \"\"\r\n  type: \"ConstantFill\"\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 1\r\n  }\r\n  arg {\r\n    name: \"value\"\r\n    f: 1.0\r\n  }\r\n  device_option {\r\n  }\r\n}\r\nop {\r\n  output: \"ONE_0_0\"\r\n  name: \"\"\r\n  type: \"ConstantFill\"\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 1\r\n  }\r\n  arg {\r\n    name: \"value\"\r\n    f: 1.0\r\n  }\r\n  device_option {\r\n  }\r\n}\r\nop {\r\n  output: \"ONE_0_0\"\r\n  name: \"\"\r\n  type: \"ConstantFill\"\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 1\r\n  }\r\n  arg {\r\n    name: \"value\"\r\n    f: 1.0\r\n  }\r\n  device_option {\r\n  }\r\n}\r\nop {\r\n  output: \"ONE_0_0\"\r\n  name: \"\"\r\n  type: \"ConstantFill\"\r\n  arg {\r\n    name: \"shape\"\r\n    ints: 1\r\n  }\r\n  arg {\r\n    name: \"value\"\r\n    f: 1.0\r\n  }\r\n  device_option {\r\n  }\r\n}\r\n\r\nname: \"dnn_wikipedia\"\r\nop {\r\n  input: \"X\"\r\n  input: \"z2_w\"\r\n  input: \"z2_b\"\r\n  output: \"z2\"\r\n  name: \"\"\r\n  type: \"FC\"\r\n  arg {\r\n    name: \"use_cudnn\"\r\n    i: 1\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n}\r\nop {\r\n  input: \"z2\"\r\n  output: \"a2\"\r\n  name: \"\"\r\n  type: \"Relu\"\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  engine: \"CUDNN\"\r\n}\r\nop {\r\n  input: \"a2\"\r\n  input: \"z3_w\"\r\n  input: \"z3_b\"\r\n  output: \"z3\"\r\n  name: \"\"\r\n  type: \"FC\"\r\n  arg {\r\n    name: \"use_cudnn\"\r\n    i: 1\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n}\r\nop {\r\n  input: \"z3\"\r\n  output: \"a3\"\r\n  name: \"\"\r\n  type: \"Relu\"\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  engine: \"CUDNN\"\r\n}\r\nop {\r\n  input: \"a3\"\r\n  input: \"z4_w\"\r\n  input: \"z4_b\"\r\n  output: \"z4\"\r\n  name: \"\"\r\n  type: \"FC\"\r\n  arg {\r\n    name: \"use_cudnn\"\r\n    i: 1\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n}\r\nop {\r\n  input: \"z4\"\r\n  input: \"Y\"\r\n  output: \"softmax\"\r\n  output: \"loss\"\r\n  name: \"\"\r\n  type: \"SoftmaxWithLoss\"\r\n}\r\nop {\r\n  input: \"loss\"\r\n  output: \"loss_autogen_grad\"\r\n  name: \"\"\r\n  type: \"ConstantFill\"\r\n  arg {\r\n    name: \"value\"\r\n    f: 1.0\r\n  }\r\n}\r\nop {\r\n  input: \"z4\"\r\n  input: \"Y\"\r\n  input: \"softmax\"\r\n  input: \"loss_autogen_grad\"\r\n  output: \"z4_grad\"\r\n  name: \"\"\r\n  type: \"SoftmaxWithLossGradient\"\r\n  is_gradient_op: true\r\n}\r\nop {\r\n  input: \"a3\"\r\n  input: \"z4_w\"\r\n  input: \"z4_grad\"\r\n  output: \"z4_w_grad\"\r\n  output: \"z4_b_grad\"\r\n  output: \"a3_grad\"\r\n  name: \"\"\r\n  type: \"FCGradient\"\r\n  arg {\r\n    name: \"use_cudnn\"\r\n    i: 1\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n  is_gradient_op: true\r\n}\r\nop {\r\n  input: \"a3\"\r\n  input: \"a3_grad\"\r\n  output: \"z3_grad\"\r\n  name: \"\"\r\n  type: \"ReluGradient\"\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  engine: \"CUDNN\"\r\n  is_gradient_op: true\r\n}\r\nop {\r\n  input: \"a2\"\r\n  input: \"z3_w\"\r\n  input: \"z3_grad\"\r\n  output: \"z3_w_grad\"\r\n  output: \"z3_b_grad\"\r\n  output: \"a2_grad\"\r\n  name: \"\"\r\n  type: \"FCGradient\"\r\n  arg {\r\n    name: \"use_cudnn\"\r\n    i: 1\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n  is_gradient_op: true\r\n}\r\nop {\r\n  input: \"a2\"\r\n  input: \"a2_grad\"\r\n  output: \"z2_grad\"\r\n  name: \"\"\r\n  type: \"ReluGradient\"\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  engine: \"CUDNN\"\r\n  is_gradient_op: true\r\n}\r\nop {\r\n  input: \"X\"\r\n  input: \"z2_w\"\r\n  input: \"z2_grad\"\r\n  output: \"z2_w_grad\"\r\n  output: \"z2_b_grad\"\r\n  output: \"X_grad\"\r\n  name: \"\"\r\n  type: \"FCGradient\"\r\n  arg {\r\n    name: \"use_cudnn\"\r\n    i: 1\r\n  }\r\n  arg {\r\n    name: \"order\"\r\n    s: \"NCHW\"\r\n  }\r\n  arg {\r\n    name: \"cudnn_exhaustive_search\"\r\n    i: 0\r\n  }\r\n  is_gradient_op: true\r\n}\r\nop {\r\n  input: \"iteration_mutex\"\r\n  input: \"optimizer_iteration\"\r\n  output: \"optimizer_iteration\"\r\n  name: \"\"\r\n  type: \"AtomicIter\"\r\n  device_option {\r\n    device_type: 0\r\n    cuda_gpu_id: 0\r\n  }\r\n}\r\nop {\r\n  input: \"optimizer_iteration\"\r\n  output: \"SgdOptimizer_0_lr_cpu\"\r\n  name: \"\"\r\n  type: \"LearningRate\"\r\n  arg {\r\n    name: \"policy\"\r\n    s: \"fixed\"\r\n  }\r\n  arg {\r\n    name: \"base_lr\"\r\n    f: -0.0500000007451\r\n  }\r\n  device_option {\r\n  }\r\n}\r\nop {\r\n  input: \"z4_w\"\r\n  input: \"ONE_0_0\"\r\n  input: \"z4_w_grad\"\r\n  input: \"SgdOptimizer_0_lr_cpu\"\r\n  output: \"z4_w\"\r\n  name: \"\"\r\n  type: \"WeightedSum\"\r\n  device_option {\r\n  }\r\n}\r\nop {\r\n  input: \"z2_b\"\r\n  input: \"ONE_0_0\"\r\n  input: \"z2_b_grad\"\r\n  input: \"SgdOptimizer_0_lr_cpu\"\r\n  output: \"z2_b\"\r\n  name: \"\"\r\n  type: \"WeightedSum\"\r\n  device_option {\r\n  }\r\n}\r\nop {\r\n  input: \"z3_w\"\r\n  input: \"ONE_0_0\"\r\n  input: \"z3_w_grad\"\r\n  input: \"SgdOptimizer_0_lr_cpu\"\r\n  output: \"z3_w\"\r\n  name: \"\"\r\n  type: \"WeightedSum\"\r\n  device_option {\r\n  }\r\n}\r\nop {\r\n  input: \"z2_w\"\r\n  input: \"ONE_0_0\"\r\n  input: \"z2_w_grad\"\r\n  input: \"SgdOptimizer_0_lr_cpu\"\r\n  output: \"z2_w\"\r\n  name: \"\"\r\n  type: \"WeightedSum\"\r\n  device_option {\r\n  }\r\n}\r\nop {\r\n  input: \"z4_b\"\r\n  input: \"ONE_0_0\"\r\n  input: \"z4_b_grad\"\r\n  input: \"SgdOptimizer_0_lr_cpu\"\r\n  output: \"z4_b\"\r\n  name: \"\"\r\n  type: \"WeightedSum\"\r\n  device_option {\r\n  }\r\n}\r\nop {\r\n  input: \"z3_b\"\r\n  input: \"ONE_0_0\"\r\n  input: \"z3_b_grad\"\r\n  input: \"SgdOptimizer_0_lr_cpu\"\r\n  output: \"z3_b\"\r\n  name: \"\"\r\n  type: \"WeightedSum\"\r\n  device_option {\r\n  }\r\n}\r\nexternal_input: \"X\"\r\nexternal_input: \"z2_w\"\r\nexternal_input: \"z2_b\"\r\nexternal_input: \"z3_w\"\r\nexternal_input: \"z3_b\"\r\nexternal_input: \"z4_w\"\r\nexternal_input: \"z4_b\"\r\nexternal_input: \"Y\"\r\nexternal_input: \"iteration_mutex\"\r\nexternal_input: \"optimizer_iteration\"\r\nexternal_input: \"ONE_0_0\"\r\n```\r\nI think the operators related to gradient update is missing in the first way.\r\n\r\n\r\nBest wishes,\r\nBinhang\r\n\r\n"}