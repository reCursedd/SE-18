{"url": "https://api.github.com/repos/pytorch/pytorch/issues/12050", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/12050/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/12050/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/12050/events", "html_url": "https://github.com/pytorch/pytorch/pull/12050", "id": 363633809, "node_id": "MDExOlB1bGxSZXF1ZXN0MjE4MDIxODYx", "number": 12050, "title": "Require C10_DEFINE_REGISTRY and C10_DECLARE_REGISTRY to be done in top-level namespace", "user": {"login": "ezyang", "id": 13564, "node_id": "MDQ6VXNlcjEzNTY0", "avatar_url": "https://avatars0.githubusercontent.com/u/13564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ezyang", "html_url": "https://github.com/ezyang", "followers_url": "https://api.github.com/users/ezyang/followers", "following_url": "https://api.github.com/users/ezyang/following{/other_user}", "gists_url": "https://api.github.com/users/ezyang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ezyang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ezyang/subscriptions", "organizations_url": "https://api.github.com/users/ezyang/orgs", "repos_url": "https://api.github.com/users/ezyang/repos", "events_url": "https://api.github.com/users/ezyang/events{/privacy}", "received_events_url": "https://api.github.com/users/ezyang/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-09-25T15:22:03Z", "updated_at": "2018-09-26T13:54:22Z", "closed_at": "2018-09-26T13:54:22Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/12050", "html_url": "https://github.com/pytorch/pytorch/pull/12050", "diff_url": "https://github.com/pytorch/pytorch/pull/12050.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/12050.patch"}, "body_html": "<p>Stack:<br>\n\u00a0\u00a0\u00a0\u00a0<g-emoji class=\"g-emoji\" alias=\"white_circle\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/26aa.png\">\u26aa\ufe0f</g-emoji>\u00a0 <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"363614774\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/12047\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/12047/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/12047\">#12047</a> Rename AT_ registry macros to C10_\u00a0\u00a0<a href=\"https://our.internmc.facebook.com/intern/diff/D10030819/\" rel=\"nofollow\"><g-emoji class=\"g-emoji\" alias=\"green_heart\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f49a.png\">\ud83d\udc9a</g-emoji></a><br>\n\u00a0\u00a0\u00a0\u00a0<g-emoji class=\"g-emoji\" alias=\"black_circle\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/26ab.png\">\u26ab\ufe0f</g-emoji>\u00a0 <strong><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"363633809\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/12050\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/12050/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/12050\">#12050</a> Require C10_DEFINE_REGISTRY and C10_DECLARE_REGISTRY to be done in top-level namespace</strong>\u00a0\u00a0<a href=\"https://our.internmc.facebook.com/intern/diff/D10031072/\" rel=\"nofollow\"><g-emoji class=\"g-emoji\" alias=\"green_heart\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f49a.png\">\ud83d\udc9a</g-emoji></a><br>\n\u00a0\u00a0\u00a0\u00a0<g-emoji class=\"g-emoji\" alias=\"white_circle\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/26aa.png\">\u26aa\ufe0f</g-emoji>\u00a0 <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"363678942\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/12054\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/12054/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/12054\">#12054</a> Merge Registry.\u00a0\u00a0<a href=\"https://our.internmc.facebook.com/intern/diff/D10032707/\" rel=\"nofollow\"><g-emoji class=\"g-emoji\" alias=\"yellow_heart\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f49b.png\">\ud83d\udc9b</g-emoji></a></p>\n<p>OK, here's the deal.  C10 registry definitions are done by declaring<br>\ntemplate specializations of a Registerer class, which is actually responsible<br>\nfor managing everything.  But here's the problem: you can only declare<br>\na template specialization <em>in the same namespace</em> as the template<br>\nyou are specializing.  And this is a huge problem if you want a shared<br>\nregistry between ATen and Caffe2, which have most of their code live<br>\nin different namespaces.  The fix?  Just force the definition to be<br>\ndone at the TOP LEVEL, so we can put the specialization in the<br>\ncorrect namespace ourselves.</p>\n<p>Perhaps there's another way to implement the registry that doesn't<br>\ninvolve defining a template specialization, but I didn't look too<br>\ndeeply into it.</p>\n<p>Differential Revision: <a href=\"https://our.internmc.facebook.com/intern/diff/D10031072/\" rel=\"nofollow\">D10031072</a></p>", "body_text": "Stack:\n\u00a0\u00a0\u00a0\u00a0\u26aa\ufe0f\u00a0 #12047 Rename AT_ registry macros to C10_\u00a0\u00a0\ud83d\udc9a\n\u00a0\u00a0\u00a0\u00a0\u26ab\ufe0f\u00a0 #12050 Require C10_DEFINE_REGISTRY and C10_DECLARE_REGISTRY to be done in top-level namespace\u00a0\u00a0\ud83d\udc9a\n\u00a0\u00a0\u00a0\u00a0\u26aa\ufe0f\u00a0 #12054 Merge Registry.\u00a0\u00a0\ud83d\udc9b\nOK, here's the deal.  C10 registry definitions are done by declaring\ntemplate specializations of a Registerer class, which is actually responsible\nfor managing everything.  But here's the problem: you can only declare\na template specialization in the same namespace as the template\nyou are specializing.  And this is a huge problem if you want a shared\nregistry between ATen and Caffe2, which have most of their code live\nin different namespaces.  The fix?  Just force the definition to be\ndone at the TOP LEVEL, so we can put the specialization in the\ncorrect namespace ourselves.\nPerhaps there's another way to implement the registry that doesn't\ninvolve defining a template specialization, but I didn't look too\ndeeply into it.\nDifferential Revision: D10031072", "body": "Stack:\n&nbsp;&nbsp;&nbsp;&nbsp;:white_circle:&nbsp; #12047 Rename AT_ registry macros to C10_&nbsp;&nbsp;[:green_heart:](https://our.internmc.facebook.com/intern/diff/D10030819/)\n&nbsp;&nbsp;&nbsp;&nbsp;:black_circle:&nbsp; **#12050 Require C10_DEFINE_REGISTRY and C10_DECLARE_REGISTRY to be done in top-level namespace**&nbsp;&nbsp;[:green_heart:](https://our.internmc.facebook.com/intern/diff/D10031072/)\n&nbsp;&nbsp;&nbsp;&nbsp;:white_circle:&nbsp; #12054 Merge Registry.&nbsp;&nbsp;[:yellow_heart:](https://our.internmc.facebook.com/intern/diff/D10032707/)\n\nOK, here's the deal.  C10 registry definitions are done by declaring\ntemplate specializations of a Registerer class, which is actually responsible\nfor managing everything.  But here's the problem: you can only declare\na template specialization *in the same namespace* as the template\nyou are specializing.  And this is a huge problem if you want a shared\nregistry between ATen and Caffe2, which have most of their code live\nin different namespaces.  The fix?  Just force the definition to be\ndone at the TOP LEVEL, so we can put the specialization in the\ncorrect namespace ourselves.\n\nPerhaps there's another way to implement the registry that doesn't\ninvolve defining a template specialization, but I didn't look too\ndeeply into it.\n\nDifferential Revision: [D10031072](https://our.internmc.facebook.com/intern/diff/D10031072/)"}