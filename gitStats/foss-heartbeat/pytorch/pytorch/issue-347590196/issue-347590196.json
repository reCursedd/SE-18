{"url": "https://api.github.com/repos/pytorch/pytorch/issues/10232", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/10232/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/10232/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/10232/events", "html_url": "https://github.com/pytorch/pytorch/issues/10232", "id": 347590196, "node_id": "MDU6SXNzdWUzNDc1OTAxOTY=", "number": 10232, "title": "[Caffe2] AVX not enabled for pytorch/caffe2", "user": {"login": "llv22", "id": 679518, "node_id": "MDQ6VXNlcjY3OTUxOA==", "avatar_url": "https://avatars1.githubusercontent.com/u/679518?v=4", "gravatar_id": "", "url": "https://api.github.com/users/llv22", "html_url": "https://github.com/llv22", "followers_url": "https://api.github.com/users/llv22/followers", "following_url": "https://api.github.com/users/llv22/following{/other_user}", "gists_url": "https://api.github.com/users/llv22/gists{/gist_id}", "starred_url": "https://api.github.com/users/llv22/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/llv22/subscriptions", "organizations_url": "https://api.github.com/users/llv22/orgs", "repos_url": "https://api.github.com/users/llv22/repos", "events_url": "https://api.github.com/users/llv22/events{/privacy}", "received_events_url": "https://api.github.com/users/llv22/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 890282107, "node_id": "MDU6TGFiZWw4OTAyODIxMDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/caffe2", "name": "caffe2", "color": "210aa8", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-08-04T05:39:36Z", "updated_at": "2018-10-11T17:16:11Z", "closed_at": null, "author_association": "NONE", "body_html": "<h2>Issue description</h2>\n<ol>\n<li>\n<p>pytorch's CMakeLists.txt and change Line 113<br>\noption(USE_NATIVE_ARCH \"Use -march=native\" ON)</p>\n</li>\n<li>\n<p>Source code compilation of pytorch</p>\n</li>\n</ol>\n<p>export CMAKE_PREFIX_PATH=/Users/llv23/miniconda3<br>\nMACOSX_DEPLOYMENT_TARGET=10.13 CC=clang CXX=clang++ python setup.py install</p>\n<p>also try with<br>\ncmake -DUSE_NATIVE_ARCH=ON ..<br>\nmake install</p>\n<ol start=\"3\">\n<li>run</li>\n</ol>\n<p>python caffe2/python/examples/char_rnn.py --train_data shakespeare.txt</p>\n<p>Orlando:examples llv23$ python char_rnn.py --train_data shakespeare.txt<br>\nIf you are using homebrew leveldb on a Mac OS, you might see an error warning you that malloc_zone_unregister() failed. This is not a caffe2 issue but is due to the homebrew leveldb having an incompatible memory allocator. It does not affect usage.<br>\nE0804 13:32:58.712774 2730062720 init_intrinsics_check.cc:43] CPU feature avx is present on your machine, but the Caffe2 binary is not compiled with it. It means you may not get the full speed of your CPU.<br>\nE0804 13:32:58.713579 2730062720 init_intrinsics_check.cc:43] CPU feature avx2 is present on your machine, but the Caffe2 binary is not compiled with it. It means you may not get the full speed of your CPU.<br>\nE0804 13:32:58.713604 2730062720 init_intrinsics_check.cc:43] CPU feature fma is present on your machine, but the Caffe2 binary is not compiled with it. It means you may not get the full speed of your CPU.<br>\nInput has 62 characters. Total input size: 99993<br>\nDEBUG:char_rnn:Start training<br>\nDEBUG:char_rnn:Training model<br>\nCharacters Per Second: 3381<br>\nIterations Per Second: 135<br>\n---------- Iteration 500 ----------</p>\n<p>Both 2 cases, I meet with warning:</p>\n<p>0804 13:32:58.712774 2730062720 init_intrinsics_check.cc:43] <strong>CPU feature avx is present on your machine, but the Caffe2 binary is not compiled with it</strong>. It means you may not get the full speed of your CPU.</p>\n<h2>System Info</h2>\n<p>Orlando:utils llv23$ python collect_env.py<br>\nCollecting environment information...<br>\nPyTorch version: 0.5.0a0+ed86405<br>\nIs debug build: No<br>\nCUDA used to build PyTorch: 9.2</p>\n<p>OS: Mac OSX 10.13.6<br>\nGCC version: Could not collect<br>\nCMake version: version 3.11.3</p>\n<p>Python version: 3.6<br>\nIs CUDA available: Yes<br>\nCUDA runtime version: 9.2.148<br>\nGPU models and configuration: Could not collect<br>\nNvidia driver version: Could not collect<br>\ncuDNN version: Probably one of the following:<br>\n/usr/local/cuda/lib/libcudnn.7.dylib<br>\n/usr/local/cuda/lib/libcudnn.dylib<br>\n/usr/local/cuda/lib/libcudnn_static.a</p>\n<p>Versions of relevant libraries:<br>\n[pip] Could not collect<br>\n[conda] pytorch                   0.4.0           py36_cuda0.0_cudnn0.0_1    pytorch<br>\n[conda] torch                     0.5.0a0+ed86405           <br>\n[conda] torch                     0.5.0a0+1b9d599           <br>\n[conda] torchvision               0.2.1                    py36_1    pytorch</p>", "body_text": "Issue description\n\n\npytorch's CMakeLists.txt and change Line 113\noption(USE_NATIVE_ARCH \"Use -march=native\" ON)\n\n\nSource code compilation of pytorch\n\n\nexport CMAKE_PREFIX_PATH=/Users/llv23/miniconda3\nMACOSX_DEPLOYMENT_TARGET=10.13 CC=clang CXX=clang++ python setup.py install\nalso try with\ncmake -DUSE_NATIVE_ARCH=ON ..\nmake install\n\nrun\n\npython caffe2/python/examples/char_rnn.py --train_data shakespeare.txt\nOrlando:examples llv23$ python char_rnn.py --train_data shakespeare.txt\nIf you are using homebrew leveldb on a Mac OS, you might see an error warning you that malloc_zone_unregister() failed. This is not a caffe2 issue but is due to the homebrew leveldb having an incompatible memory allocator. It does not affect usage.\nE0804 13:32:58.712774 2730062720 init_intrinsics_check.cc:43] CPU feature avx is present on your machine, but the Caffe2 binary is not compiled with it. It means you may not get the full speed of your CPU.\nE0804 13:32:58.713579 2730062720 init_intrinsics_check.cc:43] CPU feature avx2 is present on your machine, but the Caffe2 binary is not compiled with it. It means you may not get the full speed of your CPU.\nE0804 13:32:58.713604 2730062720 init_intrinsics_check.cc:43] CPU feature fma is present on your machine, but the Caffe2 binary is not compiled with it. It means you may not get the full speed of your CPU.\nInput has 62 characters. Total input size: 99993\nDEBUG:char_rnn:Start training\nDEBUG:char_rnn:Training model\nCharacters Per Second: 3381\nIterations Per Second: 135\n---------- Iteration 500 ----------\nBoth 2 cases, I meet with warning:\n0804 13:32:58.712774 2730062720 init_intrinsics_check.cc:43] CPU feature avx is present on your machine, but the Caffe2 binary is not compiled with it. It means you may not get the full speed of your CPU.\nSystem Info\nOrlando:utils llv23$ python collect_env.py\nCollecting environment information...\nPyTorch version: 0.5.0a0+ed86405\nIs debug build: No\nCUDA used to build PyTorch: 9.2\nOS: Mac OSX 10.13.6\nGCC version: Could not collect\nCMake version: version 3.11.3\nPython version: 3.6\nIs CUDA available: Yes\nCUDA runtime version: 9.2.148\nGPU models and configuration: Could not collect\nNvidia driver version: Could not collect\ncuDNN version: Probably one of the following:\n/usr/local/cuda/lib/libcudnn.7.dylib\n/usr/local/cuda/lib/libcudnn.dylib\n/usr/local/cuda/lib/libcudnn_static.a\nVersions of relevant libraries:\n[pip] Could not collect\n[conda] pytorch                   0.4.0           py36_cuda0.0_cudnn0.0_1    pytorch\n[conda] torch                     0.5.0a0+ed86405           \n[conda] torch                     0.5.0a0+1b9d599           \n[conda] torchvision               0.2.1                    py36_1    pytorch", "body": "## Issue description\r\n\r\n1. pytorch's CMakeLists.txt and change Line 113\r\noption(USE_NATIVE_ARCH \"Use -march=native\" ON)\r\n\r\n2. Source code compilation of pytorch\r\n\r\nexport CMAKE_PREFIX_PATH=/Users/llv23/miniconda3\r\nMACOSX_DEPLOYMENT_TARGET=10.13 CC=clang CXX=clang++ python setup.py install\r\n\r\nalso try with\r\ncmake -DUSE_NATIVE_ARCH=ON ..\r\nmake install\r\n\r\n3. run\r\n\r\npython caffe2/python/examples/char_rnn.py --train_data shakespeare.txt\r\n\r\nOrlando:examples llv23$ python char_rnn.py --train_data shakespeare.txt\r\nIf you are using homebrew leveldb on a Mac OS, you might see an error warning you that malloc_zone_unregister() failed. This is not a caffe2 issue but is due to the homebrew leveldb having an incompatible memory allocator. It does not affect usage.\r\nE0804 13:32:58.712774 2730062720 init_intrinsics_check.cc:43] CPU feature avx is present on your machine, but the Caffe2 binary is not compiled with it. It means you may not get the full speed of your CPU.\r\nE0804 13:32:58.713579 2730062720 init_intrinsics_check.cc:43] CPU feature avx2 is present on your machine, but the Caffe2 binary is not compiled with it. It means you may not get the full speed of your CPU.\r\nE0804 13:32:58.713604 2730062720 init_intrinsics_check.cc:43] CPU feature fma is present on your machine, but the Caffe2 binary is not compiled with it. It means you may not get the full speed of your CPU.\r\nInput has 62 characters. Total input size: 99993\r\nDEBUG:char_rnn:Start training\r\nDEBUG:char_rnn:Training model\r\nCharacters Per Second: 3381\r\nIterations Per Second: 135\r\n---------- Iteration 500 ----------\r\n\r\nBoth 2 cases, I meet with warning:\r\n\r\n0804 13:32:58.712774 2730062720 init_intrinsics_check.cc:43] **CPU feature avx is present on your machine, but the Caffe2 binary is not compiled with it**. It means you may not get the full speed of your CPU.\r\n\r\n## System Info\r\n\r\nOrlando:utils llv23$ python collect_env.py \r\nCollecting environment information...\r\nPyTorch version: 0.5.0a0+ed86405\r\nIs debug build: No\r\nCUDA used to build PyTorch: 9.2\r\n\r\nOS: Mac OSX 10.13.6\r\nGCC version: Could not collect\r\nCMake version: version 3.11.3\r\n\r\nPython version: 3.6\r\nIs CUDA available: Yes\r\nCUDA runtime version: 9.2.148\r\nGPU models and configuration: Could not collect\r\nNvidia driver version: Could not collect\r\ncuDNN version: Probably one of the following:\r\n/usr/local/cuda/lib/libcudnn.7.dylib\r\n/usr/local/cuda/lib/libcudnn.dylib\r\n/usr/local/cuda/lib/libcudnn_static.a\r\n\r\nVersions of relevant libraries:\r\n[pip] Could not collect\r\n[conda] pytorch                   0.4.0           py36_cuda0.0_cudnn0.0_1    pytorch\r\n[conda] torch                     0.5.0a0+ed86405           <pip>\r\n[conda] torch                     0.5.0a0+1b9d599           <pip>\r\n[conda] torchvision               0.2.1                    py36_1    pytorch\r\n"}