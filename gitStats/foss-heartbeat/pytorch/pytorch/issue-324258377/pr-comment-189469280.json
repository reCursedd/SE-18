{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/189469280", "pull_request_review_id": 121653752, "id": 189469280, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4OTQ2OTI4MA==", "diff_hunk": "@@ -0,0 +1,68 @@\n+#include <torch/parameter_list.h>\n+\n+#include <torch/csrc/autograd/variable.h>\n+\n+#include <functional>\n+#include <type_traits>\n+\n+namespace torch { namespace detail {\n+\n+/// A class that stores const-correct getters to a member variable, accessible\n+/// through a pointer to an object.\n+template <typename T>\n+class MemberRef {\n+ public:\n+  // TODO: Replace with (std/boost/our)::any.\n+  using This = void*;\n+  using ConstThis = const void*;\n+  using Getter = std::function<T&(This)>;\n+  using ConstGetter = std::function<const T&(ConstThis)>;\n+\n+  template <typename Class>\n+  /* implicit */ MemberRef(T Class::*member)\n+      : getter_([member](This self) -> T& {\n+          return static_cast<Class*>(self)->*member;\n+        }),\n+        const_getter_([member](ConstThis self) -> const T& {\n+          return static_cast<const Class*>(self)->*member;\n+        }) {}", "path": "torch/csrc/api/include/torch/detail/member_ref.h", "position": 31, "original_position": 28, "commit_id": "f82bd37e337af4d606efb5adfd6e3a85453f83d5", "original_commit_id": "a478435beb5f154bd8c984a9e6a3611bc1f4b107", "user": {"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}, "body": "I'm slightly concerned about the cost of keeping those lambdas around and calling them so much. Wouldn't it be simpler to keep an `offsetof` value, and then adjust the pointer value of `self` in the getters?", "created_at": "2018-05-20T20:16:11Z", "updated_at": "2018-11-23T15:44:23Z", "html_url": "https://github.com/pytorch/pytorch/pull/7663#discussion_r189469280", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/7663", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/189469280"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/7663#discussion_r189469280"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/7663"}}, "body_html": "<p>I'm slightly concerned about the cost of keeping those lambdas around and calling them so much. Wouldn't it be simpler to keep an <code>offsetof</code> value, and then adjust the pointer value of <code>self</code> in the getters?</p>", "body_text": "I'm slightly concerned about the cost of keeping those lambdas around and calling them so much. Wouldn't it be simpler to keep an offsetof value, and then adjust the pointer value of self in the getters?"}