{"url": "https://api.github.com/repos/pytorch/pytorch/issues/3111", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/3111/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/3111/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/3111/events", "html_url": "https://github.com/pytorch/pytorch/issues/3111", "id": 265369249, "node_id": "MDU6SXNzdWUyNjUzNjkyNDk=", "number": 3111, "title": "segfault free () from /usr/lib/x86_64-linux-gnu/libjemalloc.s", "user": {"login": "acrosson", "id": 4795661, "node_id": "MDQ6VXNlcjQ3OTU2NjE=", "avatar_url": "https://avatars0.githubusercontent.com/u/4795661?v=4", "gravatar_id": "", "url": "https://api.github.com/users/acrosson", "html_url": "https://github.com/acrosson", "followers_url": "https://api.github.com/users/acrosson/followers", "following_url": "https://api.github.com/users/acrosson/following{/other_user}", "gists_url": "https://api.github.com/users/acrosson/gists{/gist_id}", "starred_url": "https://api.github.com/users/acrosson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/acrosson/subscriptions", "organizations_url": "https://api.github.com/users/acrosson/orgs", "repos_url": "https://api.github.com/users/acrosson/repos", "events_url": "https://api.github.com/users/acrosson/events{/privacy}", "received_events_url": "https://api.github.com/users/acrosson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 424131847, "node_id": "MDU6TGFiZWw0MjQxMzE4NDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/bug", "name": "bug", "color": "b60205", "default": true}, {"id": 679955625, "node_id": "MDU6TGFiZWw2Nzk5NTU2MjU=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/crash", "name": "crash", "color": "d93f0b", "default": false}, {"id": 443484135, "node_id": "MDU6TGFiZWw0NDM0ODQxMzU=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/high%20priority", "name": "high priority", "color": "F22613", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2017-10-13T17:52:31Z", "updated_at": "2017-10-24T18:35:24Z", "closed_at": "2017-10-24T18:35:24Z", "author_association": "NONE", "body_html": "<p>I'm getting a segfault a few thousand iterations into using a model for inference. I'm serving the model in a simple flask app. How should I resolve?</p>\n<p>Specs</p>\n<pre><code>Ubuntu 16.04 on AWS g3.8xlarge\nPytorch (latest) installed through conda\npython 3.5\ncuda 8.0\n</code></pre>\n<p>The original error was <code>Error in `python': double free or corruption (!prev)</code><br>\nI've tried resolving it by changing LD_PRELOAD as outlined <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"217508719\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/google/seq2seq/issues/119\" data-hovercard-type=\"issue\" data-hovercard-url=\"/google/seq2seq/issues/119/hovercard\" href=\"https://github.com/google/seq2seq/issues/119\">google/seq2seq#119</a></p>\n<pre><code>export LD_PRELOAD=\"/usr/lib/x86_64-linux-gnu/libjemalloc.so.1\"\n</code></pre>\n<p>and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"202030379\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/6968\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/6968/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/6968\">tensorflow/tensorflow#6968</a></p>\n<pre><code>export LD_PRELOAD=\"/usr/lib/libtcmalloc_minimal.so.4\"\n</code></pre>\n<p>But these haven't helped. Currently getting<br>\nError</p>\n<pre><code>Thread 22951 \"python\" received signal SIGSEGV, Segmentation fault.\n0x00007ffff7ba42d7 in free () from /usr/lib/x86_64-linux-gnu/libjemalloc.s\n</code></pre>\n<p>Backtrace from gdb (few hundred lines)</p>\n<pre><code>#0  0x00007ffff7ba42d7 in free ()\n   from /usr/lib/x86_64-linux-gnu/libjemalloc.so.1\n#1  0x00007fff8ec55c73 in torch::autograd::VariableVersion::cleanup (\n    this=&lt;optimized out&gt;, this=&lt;optimized out&gt;)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#2  torch::autograd::VariableVersion::~VariableVersion (\n    this=0x7fff036fd530, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:47\n#3  std::default_delete&lt;torch::autograd::VariableVersion&gt;::operator() (\n    this=&lt;optimized out&gt;, __ptr=0x7fff036fd530)\n    at torch/csrc/autograd/python_function.cpp:67\n#4  std::unique_ptr&lt;torch::autograd::VariableVersion, std::default_delete&lt;torch::autograd::VariableVersion&gt; &gt;::~unique_ptr (this=0x7fff0bf5af60, \n    __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:184\n#5  torch::autograd::Variable::SavedVariable::~SavedVariable (\n    this=0x7fff0bf5af30, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:19\n#6  0x00007fff8ec74a65 in torch::autograd::ConvBackward::~ConvBackward (\n    this=0x7fff0bf5ae18, __in_chrg=&lt;optimized out&gt;)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#7  0x00007fff8ec68b78 in std::_Sp_counted_base&lt;(__gnu_cxx::_Lock_policy)2&gt;::_M_release (this=0x7fff0bf5ae00)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#8  std::__shared_count&lt;(__gnu_cxx::_Lock_policy)2&gt;::~__shared_count (\n    this=0x7fff02fdf108, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:546\n#9  std::__shared_ptr&lt;torch::autograd::Function, (__gnu_cxx::_Lock_policy)2&gt;::~__shared_ptr (this=0x7fff02fdf100, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:781\n#10 std::shared_ptr&lt;torch::autograd::Function&gt;::~shared_ptr (\n    this=0x7fff02fdf100, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:93\n#11 std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;::~pair (\n    this=0x7fff02fdf100, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:96\n#12 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; (__pointer=0x7fff02fdf100)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:93\n#13 std::_Destroy_aux&lt;false&gt;::__destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;*&gt; (__last=&lt;optimized out&gt;, \n    __first=0x7fff02fdf100)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:103\n#14 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;*&gt; (__last=&lt;optimized out&gt;, __first=&lt;optimized out&gt;)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:126\n#15 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;*, std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; (\n    __last=0x7fff02fdf148, __first=0x7fff02fdf100)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:151\n#16 std::vector&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;, std::allocator&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; &gt;::~vector (this=0x7fff0369dea8, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:415\n#17 torch::autograd::Function::~Function (this=0x7fff0369de98, \n    __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:63\n#18 torch::autograd::BatchNormBackward::~BatchNormBackward (\n    this=0x7fff0369de98, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:28\n#19 0x00007fff8ec4f870 in std::_Sp_counted_base&lt;(__gnu_cxx::_Lock_policy)2&gt;::_M_release (this=0x7fff0369de80)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#20 std::__shared_count&lt;(__gnu_cxx::_Lock_policy)2&gt;::~__shared_count (\n    this=0x7fff02dffb28, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:546\n#21 std::__shared_ptr&lt;torch::autograd::Function, (__gnu_cxx::_Lock_policy)2&gt;::~__shared_ptr (this=0x7fff02dffb20, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:781\n#22 std::shared_ptr&lt;torch::autograd::Function&gt;::~shared_ptr (\n    this=0x7fff02dffb20, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:93\n#23 std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;::~pair (\n    this=0x7fff02dffb20, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:96\n#24 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; (__pointer=0x7fff02dffb20)\n    at torch/csrc/autograd/python_function.cpp:93\n#25 std::_Destroy_aux&lt;false&gt;::__destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;*&gt; (__last=&lt;optimized out&gt;, \n    __first=0x7fff02dffb20)\n    at torch/csrc/autograd/python_function.cpp:103\n#26 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;*&gt; (__last=&lt;optimized out&gt;, __first=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:126\n#27 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;*, std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; (\n    __last=0x7fff02dffb38, __first=0x7fff02dffb20)\n    at torch/csrc/autograd/python_function.cpp:151\n#28 std::vector&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;, std::allocator&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; &gt;::~vector (this=0x7fffe78b0bf0, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:415\n#29 torch::autograd::Function::~Function (this=0x7fffe78b0be0, \n    __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:63\n#30 torch::autograd::PyFunction::~PyFunction (this=0x7fffe78b0be0, \n    __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:19\n#31 THPFunction_dealloc (self=0x7fffe78b0b88)\n    at torch/csrc/autograd/python_function.cpp:287\n#32 0x00007ffff777af89 in subtype_dealloc (self=0x7fffe78b0b88)\n    at Objects/typeobject.c:1209\n#33 0x00007fff8ec555cb in Decref::operator() (this=&lt;optimized out&gt;, \n    p=0x7fffe78b0be0)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#34 std::_Sp_counted_deleter&lt;torch::autograd::PyFunction*, Decref, std::allocator&lt;int&gt;, (__gnu_cxx::_Lock_policy)2&gt;::_M_dispose (\n    this=&lt;optimized out&gt;) at torch/csrc/autograd/python_function.cpp:347\n#35 0x00007fff8ec4f870 in std::_Sp_counted_base&lt;(__gnu_cxx::_Lock_policy)2&gt;::_M_release (this=0x7fff02dffe20)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#36 std::__shared_count&lt;(__gnu_cxx::_Lock_policy)2&gt;::~__shared_count (\n    this=0x7fff02dffe08, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:546\n#37 std::__shared_ptr&lt;torch::autograd::Function, (__gnu_cxx::_Lock_policy)2&gt;::~__shared_ptr (this=0x7fff02dffe00, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:781\n#38 std::shared_ptr&lt;torch::autograd::Function&gt;::~shared_ptr (\n    this=0x7fff02dffe00, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:93\n#39 std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;::~pair (\n    this=0x7fff02dffe00, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:96\n#40 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; (__pointer=0x7fff02dffe00)\n    at torch/csrc/autograd/python_function.cpp:93\n#41 std::_Destroy_aux&lt;false&gt;::__destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;*&gt; (__last=&lt;optimized out&gt;, \n    __first=0x7fff02dffe00)\n    at torch/csrc/autograd/python_function.cpp:103\n#42 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;*&gt; (__last=&lt;optimized out&gt;, __first=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:126\n#43 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;*, std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; (\n    __last=0x7fff02dffe18, __first=0x7fff02dffe00)\n    at torch/csrc/autograd/python_function.cpp:151\n#44 std::vector&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;, std::allocator&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; &gt;::~vector (this=0x7fffe78b0650, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:415\n#45 torch::autograd::Function::~Function (this=0x7fffe78b0640, \n    __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:63\n#46 torch::autograd::PyFunction::~PyFunction (this=0x7fffe78b0640, \n    __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:19\n#47 THPFunction_dealloc (self=0x7fffe78b05e8)\n    at torch/csrc/autograd/python_function.cpp:287\n#48 0x00007ffff777af89 in subtype_dealloc (self=0x7fffe78b05e8)\n    at Objects/typeobject.c:1209\n#49 0x00007fff8ec555cb in Decref::operator() (this=&lt;optimized out&gt;, \n    p=0x7fffe78b0640)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#50 std::_Sp_counted_deleter&lt;torch::autograd::PyFunction*, Decref, std::allocator&lt;int&gt;, (__gnu_cxx::_Lock_policy)2&gt;::_M_dispose (\n    this=&lt;optimized out&gt;) at torch/csrc/autograd/python_function.cpp:347\n#51 0x00007fff8ec4f870 in std::_Sp_counted_base&lt;(__gnu_cxx::_Lock_policy)2&gt;::_M_release (this=0x7fff02e00040)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#52 std::__shared_count&lt;(__gnu_cxx::_Lock_policy)2&gt;::~__shared_count (\n    this=0x7fff036e9e70, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:546\n#53 std::__shared_ptr&lt;torch::autograd::Function, (__gnu_cxx::_Lock_policy)2&gt;::~__shared_ptr (this=0x7fff036e9e68, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:781\n#54 std::shared_ptr&lt;torch::autograd::Function&gt;::~shared_ptr (\n    this=0x7fff036e9e68, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:93\n#55 std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;::~pair (\n    this=0x7fff036e9e68, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:96\n#56 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; (__pointer=0x7fff036e9e68)\n    at torch/csrc/autograd/python_function.cpp:93\n#57 std::_Destroy_aux&lt;false&gt;::__destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;*&gt; (__last=&lt;optimized out&gt;, \n    __first=0x7fff036e9e68)\n    at torch/csrc/autograd/python_function.cpp:103\n#58 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;*&gt; (__last=&lt;optimized out&gt;, __first=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:126\n#59 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;*, std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; (\n    __last=0x7fff036e9e80, __first=0x7fff036e9e50)\n    at torch/csrc/autograd/python_function.cpp:151\n#60 std::vector&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;, std::allocator&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; &gt;::~vector (this=0x7fffef683830, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:415\n#61 torch::autograd::Function::~Function (this=0x7fffef683820, \n    __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:63\n#62 torch::autograd::PyFunction::~PyFunction (this=0x7fffef683820, \n    __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:19\n#63 THPFunction_dealloc (self=0x7fffef6837c8)\n    at torch/csrc/autograd/python_function.cpp:287\n#64 0x00007ffff777af89 in subtype_dealloc (self=0x7fffef6837c8)\n    at Objects/typeobject.c:1209\n#65 0x00007fff8ec555cb in Decref::operator() (this=&lt;optimized out&gt;, \n    p=0x7fffef683820)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#66 std::_Sp_counted_deleter&lt;torch::autograd::PyFunction*, Decref, std::allocator&lt;int&gt;, (__gnu_cxx::_Lock_policy)2&gt;::_M_dispose (\n    this=&lt;optimized out&gt;) at torch/csrc/autograd/python_function.cpp:347\n#67 0x00007fff8ec4f870 in std::_Sp_counted_base&lt;(__gnu_cxx::_Lock_policy)2&gt;::_M_release (this=0x7fff02e00720)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#68 std::__shared_count&lt;(__gnu_cxx::_Lock_policy)2&gt;::~__shared_count (\n    this=0x7fff02e004c8, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:546\n#69 std::__shared_ptr&lt;torch::autograd::Function, (__gnu_cxx::_Lock_policy)2&gt;::~__shared_ptr (this=0x7fff02e004c0, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:781\n#70 std::shared_ptr&lt;torch::autograd::Function&gt;::~shared_ptr (\n    this=0x7fff02e004c0, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:93\n#71 std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;::~pair (\n    this=0x7fff02e004c0, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:96\n#72 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; (__pointer=0x7fff02e004c0)\n    at torch/csrc/autograd/python_function.cpp:93\n#73 std::_Destroy_aux&lt;false&gt;::__destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;*&gt; (__last=&lt;optimized out&gt;, \n    __first=0x7fff02e004c0)\n    at torch/csrc/autograd/python_function.cpp:103\n#74 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;*&gt; (__last=&lt;optimized out&gt;, __first=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:126\n#75 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;*, std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; (\n    __last=0x7fff02e004d8, __first=0x7fff02e004c0)\n    at torch/csrc/autograd/python_function.cpp:151\n#76 std::vector&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;, std::allocator&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; &gt;::~vector (this=0x7fffef683bf0, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:415\n#77 torch::autograd::Function::~Function (this=0x7fffef683be0, \n    __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:63\n#78 torch::autograd::PyFunction::~PyFunction (this=0x7fffef683be0, \n    __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:19\n#79 THPFunction_dealloc (self=0x7fffef683b88)\n    at torch/csrc/autograd/python_function.cpp:287\n#80 0x00007ffff777af89 in subtype_dealloc (self=0x7fffef683b88)\n    at Objects/typeobject.c:1209\n#81 0x00007fff8ec555cb in Decref::operator() (this=&lt;optimized out&gt;, \n    p=0x7fffef683be0)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#82 std::_Sp_counted_deleter&lt;torch::autograd::PyFunction*, Decref, std::allocator&lt;int&gt;, (__gnu_cxx::_Lock_policy)2&gt;::_M_dispose (\n    this=&lt;optimized out&gt;) at torch/csrc/autograd/python_function.cpp:347\n#83 0x00007fff8ec4f870 in std::_Sp_counted_base&lt;(__gnu_cxx::_Lock_policy)2&gt;::_M_release (this=0x7fff02e007c0)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#84 std::__shared_count&lt;(__gnu_cxx::_Lock_policy)2&gt;::~__shared_count (\n    this=0x7fff037070f0, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:546\n#85 std::__shared_ptr&lt;torch::autograd::Function, (__gnu_cxx::_Lock_policy)2&gt;::~__shared_ptr (this=0x7fff037070e8, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:781\n#86 std::shared_ptr&lt;torch::autograd::Function&gt;::~shared_ptr (\n    this=0x7fff037070e8, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:93\n#87 std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;::~pair (\n    this=0x7fff037070e8, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:96\n#88 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; (__pointer=0x7fff037070e8)\n    at torch/csrc/autograd/python_function.cpp:93\n#89 std::_Destroy_aux&lt;false&gt;::__destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;*&gt; (__last=&lt;optimized out&gt;, \n    __first=0x7fff037070e8)\n    at torch/csrc/autograd/python_function.cpp:103\n#90 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;*&gt; (__last=&lt;optimized out&gt;, __first=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:126\n#91 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;*, std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; (\n    __last=0x7fff03707100, __first=0x7fff037070d0)\n    at torch/csrc/autograd/python_function.cpp:151\n#92 std::vector&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;, std::allocator&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; &gt;::~vector (this=0x7fffef683dd0, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:415\n#93 torch::autograd::Function::~Function (this=0x7fffef683dc0, \n    __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:63\n#94 torch::autograd::PyFunction::~PyFunction (this=0x7fffef683dc0, \n    __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:19\n#95 THPFunction_dealloc (self=0x7fffef683d68)\n    at torch/csrc/autograd/python_function.cpp:287\n#96 0x00007ffff777af89 in subtype_dealloc (self=0x7fffef683d68)\n    at Objects/typeobject.c:1209\n#97 0x00007fff8ec555cb in Decref::operator() (this=&lt;optimized out&gt;, \n    p=0x7fffef683dc0)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#98 std::_Sp_counted_deleter&lt;torch::autograd::PyFunction*, Decref, std::allocator&lt;int&gt;, (__gnu_cxx::_Lock_policy)2&gt;::_M_dispose (\n    this=&lt;optimized out&gt;) at torch/csrc/autograd/python_function.cpp:347\n#99 0x00007fff8ec4f870 in std::_Sp_counted_base&lt;(__gnu_cxx::_Lock_policy)2&gt;::_M_release (this=0x7fff02e00ec0)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#100 std::__shared_count&lt;(__gnu_cxx::_Lock_policy)2&gt;::~__shared_count (\n    this=0x7fff02e00c68, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:546\n#101 std::__shared_ptr&lt;torch::autograd::Function, (__gnu_cxx::_Lock_policy)2&gt;::~__shared_ptr (this=0x7fff02e00c60, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:781\n#102 std::shared_ptr&lt;torch::autograd::Function&gt;::~shared_ptr (\n    this=0x7fff02e00c60, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:93\n#103 std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt;::~pair (\n    this=0x7fff02e00c60, __in_chrg=&lt;optimized out&gt;)\n    at torch/csrc/autograd/python_function.cpp:96\n#104 std::_Destroy&lt;std::pair&lt;std::shared_ptr&lt;torch::autograd::Function&gt;, int&gt; &gt; (__pointer=0x7fff02e00c60)\n    at torch/csrc/autograd/python_function.cpp:93\n#105\n</code></pre>\n<p>I have observed the memory via htop and nvidia-smi manually every few hundred iterations and didn't notice any significant uptick in memory growth over time.</p>", "body_text": "I'm getting a segfault a few thousand iterations into using a model for inference. I'm serving the model in a simple flask app. How should I resolve?\nSpecs\nUbuntu 16.04 on AWS g3.8xlarge\nPytorch (latest) installed through conda\npython 3.5\ncuda 8.0\n\nThe original error was Error in `python': double free or corruption (!prev)\nI've tried resolving it by changing LD_PRELOAD as outlined google/seq2seq#119\nexport LD_PRELOAD=\"/usr/lib/x86_64-linux-gnu/libjemalloc.so.1\"\n\nand tensorflow/tensorflow#6968\nexport LD_PRELOAD=\"/usr/lib/libtcmalloc_minimal.so.4\"\n\nBut these haven't helped. Currently getting\nError\nThread 22951 \"python\" received signal SIGSEGV, Segmentation fault.\n0x00007ffff7ba42d7 in free () from /usr/lib/x86_64-linux-gnu/libjemalloc.s\n\nBacktrace from gdb (few hundred lines)\n#0  0x00007ffff7ba42d7 in free ()\n   from /usr/lib/x86_64-linux-gnu/libjemalloc.so.1\n#1  0x00007fff8ec55c73 in torch::autograd::VariableVersion::cleanup (\n    this=<optimized out>, this=<optimized out>)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#2  torch::autograd::VariableVersion::~VariableVersion (\n    this=0x7fff036fd530, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:47\n#3  std::default_delete<torch::autograd::VariableVersion>::operator() (\n    this=<optimized out>, __ptr=0x7fff036fd530)\n    at torch/csrc/autograd/python_function.cpp:67\n#4  std::unique_ptr<torch::autograd::VariableVersion, std::default_delete<torch::autograd::VariableVersion> >::~unique_ptr (this=0x7fff0bf5af60, \n    __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:184\n#5  torch::autograd::Variable::SavedVariable::~SavedVariable (\n    this=0x7fff0bf5af30, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:19\n#6  0x00007fff8ec74a65 in torch::autograd::ConvBackward::~ConvBackward (\n    this=0x7fff0bf5ae18, __in_chrg=<optimized out>)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#7  0x00007fff8ec68b78 in std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release (this=0x7fff0bf5ae00)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#8  std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count (\n    this=0x7fff02fdf108, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:546\n#9  std::__shared_ptr<torch::autograd::Function, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr (this=0x7fff02fdf100, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:781\n#10 std::shared_ptr<torch::autograd::Function>::~shared_ptr (\n    this=0x7fff02fdf100, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:93\n#11 std::pair<std::shared_ptr<torch::autograd::Function>, int>::~pair (\n    this=0x7fff02fdf100, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:96\n#12 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int> > (__pointer=0x7fff02fdf100)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:93\n#13 std::_Destroy_aux<false>::__destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, \n    __first=0x7fff02fdf100)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:103\n#14 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, __first=<optimized out>)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:126\n#15 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*, std::pair<std::shared_ptr<torch::autograd::Function>, int> > (\n    __last=0x7fff02fdf148, __first=0x7fff02fdf100)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:151\n#16 std::vector<std::pair<std::shared_ptr<torch::autograd::Function>, int>, std::allocator<std::pair<std::shared_ptr<torch::autograd::Function>, int> > >::~vector (this=0x7fff0369dea8, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:415\n#17 torch::autograd::Function::~Function (this=0x7fff0369de98, \n    __in_chrg=<optimized out>)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:63\n#18 torch::autograd::BatchNormBackward::~BatchNormBackward (\n    this=0x7fff0369de98, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/functions/batch_normalization.cpp:28\n#19 0x00007fff8ec4f870 in std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release (this=0x7fff0369de80)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#20 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count (\n    this=0x7fff02dffb28, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:546\n#21 std::__shared_ptr<torch::autograd::Function, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr (this=0x7fff02dffb20, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:781\n#22 std::shared_ptr<torch::autograd::Function>::~shared_ptr (\n    this=0x7fff02dffb20, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:93\n#23 std::pair<std::shared_ptr<torch::autograd::Function>, int>::~pair (\n    this=0x7fff02dffb20, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:96\n#24 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int> > (__pointer=0x7fff02dffb20)\n    at torch/csrc/autograd/python_function.cpp:93\n#25 std::_Destroy_aux<false>::__destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, \n    __first=0x7fff02dffb20)\n    at torch/csrc/autograd/python_function.cpp:103\n#26 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, __first=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:126\n#27 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*, std::pair<std::shared_ptr<torch::autograd::Function>, int> > (\n    __last=0x7fff02dffb38, __first=0x7fff02dffb20)\n    at torch/csrc/autograd/python_function.cpp:151\n#28 std::vector<std::pair<std::shared_ptr<torch::autograd::Function>, int>, std::allocator<std::pair<std::shared_ptr<torch::autograd::Function>, int> > >::~vector (this=0x7fffe78b0bf0, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:415\n#29 torch::autograd::Function::~Function (this=0x7fffe78b0be0, \n    __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:63\n#30 torch::autograd::PyFunction::~PyFunction (this=0x7fffe78b0be0, \n    __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:19\n#31 THPFunction_dealloc (self=0x7fffe78b0b88)\n    at torch/csrc/autograd/python_function.cpp:287\n#32 0x00007ffff777af89 in subtype_dealloc (self=0x7fffe78b0b88)\n    at Objects/typeobject.c:1209\n#33 0x00007fff8ec555cb in Decref::operator() (this=<optimized out>, \n    p=0x7fffe78b0be0)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#34 std::_Sp_counted_deleter<torch::autograd::PyFunction*, Decref, std::allocator<int>, (__gnu_cxx::_Lock_policy)2>::_M_dispose (\n    this=<optimized out>) at torch/csrc/autograd/python_function.cpp:347\n#35 0x00007fff8ec4f870 in std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release (this=0x7fff02dffe20)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#36 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count (\n    this=0x7fff02dffe08, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:546\n#37 std::__shared_ptr<torch::autograd::Function, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr (this=0x7fff02dffe00, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:781\n#38 std::shared_ptr<torch::autograd::Function>::~shared_ptr (\n    this=0x7fff02dffe00, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:93\n#39 std::pair<std::shared_ptr<torch::autograd::Function>, int>::~pair (\n    this=0x7fff02dffe00, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:96\n#40 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int> > (__pointer=0x7fff02dffe00)\n    at torch/csrc/autograd/python_function.cpp:93\n#41 std::_Destroy_aux<false>::__destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, \n    __first=0x7fff02dffe00)\n    at torch/csrc/autograd/python_function.cpp:103\n#42 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, __first=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:126\n#43 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*, std::pair<std::shared_ptr<torch::autograd::Function>, int> > (\n    __last=0x7fff02dffe18, __first=0x7fff02dffe00)\n    at torch/csrc/autograd/python_function.cpp:151\n#44 std::vector<std::pair<std::shared_ptr<torch::autograd::Function>, int>, std::allocator<std::pair<std::shared_ptr<torch::autograd::Function>, int> > >::~vector (this=0x7fffe78b0650, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:415\n#45 torch::autograd::Function::~Function (this=0x7fffe78b0640, \n    __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:63\n#46 torch::autograd::PyFunction::~PyFunction (this=0x7fffe78b0640, \n    __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:19\n#47 THPFunction_dealloc (self=0x7fffe78b05e8)\n    at torch/csrc/autograd/python_function.cpp:287\n#48 0x00007ffff777af89 in subtype_dealloc (self=0x7fffe78b05e8)\n    at Objects/typeobject.c:1209\n#49 0x00007fff8ec555cb in Decref::operator() (this=<optimized out>, \n    p=0x7fffe78b0640)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#50 std::_Sp_counted_deleter<torch::autograd::PyFunction*, Decref, std::allocator<int>, (__gnu_cxx::_Lock_policy)2>::_M_dispose (\n    this=<optimized out>) at torch/csrc/autograd/python_function.cpp:347\n#51 0x00007fff8ec4f870 in std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release (this=0x7fff02e00040)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#52 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count (\n    this=0x7fff036e9e70, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:546\n#53 std::__shared_ptr<torch::autograd::Function, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr (this=0x7fff036e9e68, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:781\n#54 std::shared_ptr<torch::autograd::Function>::~shared_ptr (\n    this=0x7fff036e9e68, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:93\n#55 std::pair<std::shared_ptr<torch::autograd::Function>, int>::~pair (\n    this=0x7fff036e9e68, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:96\n#56 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int> > (__pointer=0x7fff036e9e68)\n    at torch/csrc/autograd/python_function.cpp:93\n#57 std::_Destroy_aux<false>::__destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, \n    __first=0x7fff036e9e68)\n    at torch/csrc/autograd/python_function.cpp:103\n#58 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, __first=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:126\n#59 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*, std::pair<std::shared_ptr<torch::autograd::Function>, int> > (\n    __last=0x7fff036e9e80, __first=0x7fff036e9e50)\n    at torch/csrc/autograd/python_function.cpp:151\n#60 std::vector<std::pair<std::shared_ptr<torch::autograd::Function>, int>, std::allocator<std::pair<std::shared_ptr<torch::autograd::Function>, int> > >::~vector (this=0x7fffef683830, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:415\n#61 torch::autograd::Function::~Function (this=0x7fffef683820, \n    __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:63\n#62 torch::autograd::PyFunction::~PyFunction (this=0x7fffef683820, \n    __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:19\n#63 THPFunction_dealloc (self=0x7fffef6837c8)\n    at torch/csrc/autograd/python_function.cpp:287\n#64 0x00007ffff777af89 in subtype_dealloc (self=0x7fffef6837c8)\n    at Objects/typeobject.c:1209\n#65 0x00007fff8ec555cb in Decref::operator() (this=<optimized out>, \n    p=0x7fffef683820)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#66 std::_Sp_counted_deleter<torch::autograd::PyFunction*, Decref, std::allocator<int>, (__gnu_cxx::_Lock_policy)2>::_M_dispose (\n    this=<optimized out>) at torch/csrc/autograd/python_function.cpp:347\n#67 0x00007fff8ec4f870 in std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release (this=0x7fff02e00720)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#68 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count (\n    this=0x7fff02e004c8, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:546\n#69 std::__shared_ptr<torch::autograd::Function, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr (this=0x7fff02e004c0, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:781\n#70 std::shared_ptr<torch::autograd::Function>::~shared_ptr (\n    this=0x7fff02e004c0, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:93\n#71 std::pair<std::shared_ptr<torch::autograd::Function>, int>::~pair (\n    this=0x7fff02e004c0, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:96\n#72 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int> > (__pointer=0x7fff02e004c0)\n    at torch/csrc/autograd/python_function.cpp:93\n#73 std::_Destroy_aux<false>::__destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, \n    __first=0x7fff02e004c0)\n    at torch/csrc/autograd/python_function.cpp:103\n#74 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, __first=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:126\n#75 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*, std::pair<std::shared_ptr<torch::autograd::Function>, int> > (\n    __last=0x7fff02e004d8, __first=0x7fff02e004c0)\n    at torch/csrc/autograd/python_function.cpp:151\n#76 std::vector<std::pair<std::shared_ptr<torch::autograd::Function>, int>, std::allocator<std::pair<std::shared_ptr<torch::autograd::Function>, int> > >::~vector (this=0x7fffef683bf0, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:415\n#77 torch::autograd::Function::~Function (this=0x7fffef683be0, \n    __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:63\n#78 torch::autograd::PyFunction::~PyFunction (this=0x7fffef683be0, \n    __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:19\n#79 THPFunction_dealloc (self=0x7fffef683b88)\n    at torch/csrc/autograd/python_function.cpp:287\n#80 0x00007ffff777af89 in subtype_dealloc (self=0x7fffef683b88)\n    at Objects/typeobject.c:1209\n#81 0x00007fff8ec555cb in Decref::operator() (this=<optimized out>, \n    p=0x7fffef683be0)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#82 std::_Sp_counted_deleter<torch::autograd::PyFunction*, Decref, std::allocator<int>, (__gnu_cxx::_Lock_policy)2>::_M_dispose (\n    this=<optimized out>) at torch/csrc/autograd/python_function.cpp:347\n#83 0x00007fff8ec4f870 in std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release (this=0x7fff02e007c0)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#84 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count (\n    this=0x7fff037070f0, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:546\n#85 std::__shared_ptr<torch::autograd::Function, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr (this=0x7fff037070e8, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:781\n#86 std::shared_ptr<torch::autograd::Function>::~shared_ptr (\n    this=0x7fff037070e8, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:93\n#87 std::pair<std::shared_ptr<torch::autograd::Function>, int>::~pair (\n    this=0x7fff037070e8, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:96\n#88 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int> > (__pointer=0x7fff037070e8)\n    at torch/csrc/autograd/python_function.cpp:93\n#89 std::_Destroy_aux<false>::__destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, \n    __first=0x7fff037070e8)\n    at torch/csrc/autograd/python_function.cpp:103\n#90 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, __first=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:126\n#91 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*, std::pair<std::shared_ptr<torch::autograd::Function>, int> > (\n    __last=0x7fff03707100, __first=0x7fff037070d0)\n    at torch/csrc/autograd/python_function.cpp:151\n#92 std::vector<std::pair<std::shared_ptr<torch::autograd::Function>, int>, std::allocator<std::pair<std::shared_ptr<torch::autograd::Function>, int> > >::~vector (this=0x7fffef683dd0, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:415\n#93 torch::autograd::Function::~Function (this=0x7fffef683dc0, \n    __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:63\n#94 torch::autograd::PyFunction::~PyFunction (this=0x7fffef683dc0, \n    __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:19\n#95 THPFunction_dealloc (self=0x7fffef683d68)\n    at torch/csrc/autograd/python_function.cpp:287\n#96 0x00007ffff777af89 in subtype_dealloc (self=0x7fffef683d68)\n    at Objects/typeobject.c:1209\n#97 0x00007fff8ec555cb in Decref::operator() (this=<optimized out>, \n    p=0x7fffef683dc0)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#98 std::_Sp_counted_deleter<torch::autograd::PyFunction*, Decref, std::allocator<int>, (__gnu_cxx::_Lock_policy)2>::_M_dispose (\n    this=<optimized out>) at torch/csrc/autograd/python_function.cpp:347\n#99 0x00007fff8ec4f870 in std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release (this=0x7fff02e00ec0)\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\n#100 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count (\n    this=0x7fff02e00c68, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:546\n#101 std::__shared_ptr<torch::autograd::Function, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr (this=0x7fff02e00c60, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:781\n#102 std::shared_ptr<torch::autograd::Function>::~shared_ptr (\n    this=0x7fff02e00c60, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:93\n#103 std::pair<std::shared_ptr<torch::autograd::Function>, int>::~pair (\n    this=0x7fff02e00c60, __in_chrg=<optimized out>)\n    at torch/csrc/autograd/python_function.cpp:96\n#104 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int> > (__pointer=0x7fff02e00c60)\n    at torch/csrc/autograd/python_function.cpp:93\n#105\n\nI have observed the memory via htop and nvidia-smi manually every few hundred iterations and didn't notice any significant uptick in memory growth over time.", "body": "I'm getting a segfault a few thousand iterations into using a model for inference. I'm serving the model in a simple flask app. How should I resolve?\r\n\r\nSpecs\r\n```\r\nUbuntu 16.04 on AWS g3.8xlarge\r\nPytorch (latest) installed through conda\r\npython 3.5\r\ncuda 8.0\r\n```\r\n\r\nThe original error was ```Error in `python': double free or corruption (!prev)```\r\nI've tried resolving it by changing LD_PRELOAD as outlined https://github.com/google/seq2seq/issues/119\r\n```\r\nexport LD_PRELOAD=\"/usr/lib/x86_64-linux-gnu/libjemalloc.so.1\"\r\n```\r\nand https://github.com/tensorflow/tensorflow/issues/6968\r\n```\r\nexport LD_PRELOAD=\"/usr/lib/libtcmalloc_minimal.so.4\"\r\n```\r\n\r\nBut these haven't helped. Currently getting\r\nError \r\n```\r\nThread 22951 \"python\" received signal SIGSEGV, Segmentation fault.\r\n0x00007ffff7ba42d7 in free () from /usr/lib/x86_64-linux-gnu/libjemalloc.s\r\n```\r\n\r\nBacktrace from gdb (few hundred lines)\r\n```\r\n#0  0x00007ffff7ba42d7 in free ()\r\n   from /usr/lib/x86_64-linux-gnu/libjemalloc.so.1\r\n#1  0x00007fff8ec55c73 in torch::autograd::VariableVersion::cleanup (\r\n    this=<optimized out>, this=<optimized out>)\r\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\r\n#2  torch::autograd::VariableVersion::~VariableVersion (\r\n    this=0x7fff036fd530, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:47\r\n#3  std::default_delete<torch::autograd::VariableVersion>::operator() (\r\n    this=<optimized out>, __ptr=0x7fff036fd530)\r\n    at torch/csrc/autograd/python_function.cpp:67\r\n#4  std::unique_ptr<torch::autograd::VariableVersion, std::default_delete<torch::autograd::VariableVersion> >::~unique_ptr (this=0x7fff0bf5af60, \r\n    __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:184\r\n#5  torch::autograd::Variable::SavedVariable::~SavedVariable (\r\n    this=0x7fff0bf5af30, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:19\r\n#6  0x00007fff8ec74a65 in torch::autograd::ConvBackward::~ConvBackward (\r\n    this=0x7fff0bf5ae18, __in_chrg=<optimized out>)\r\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\r\n#7  0x00007fff8ec68b78 in std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release (this=0x7fff0bf5ae00)\r\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\r\n#8  std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count (\r\n    this=0x7fff02fdf108, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/functions/batch_normalization.cpp:546\r\n#9  std::__shared_ptr<torch::autograd::Function, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr (this=0x7fff02fdf100, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/functions/batch_normalization.cpp:781\r\n#10 std::shared_ptr<torch::autograd::Function>::~shared_ptr (\r\n    this=0x7fff02fdf100, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/functions/batch_normalization.cpp:93\r\n#11 std::pair<std::shared_ptr<torch::autograd::Function>, int>::~pair (\r\n    this=0x7fff02fdf100, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/functions/batch_normalization.cpp:96\r\n#12 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int> > (__pointer=0x7fff02fdf100)\r\n    at torch/csrc/autograd/functions/batch_normalization.cpp:93\r\n#13 std::_Destroy_aux<false>::__destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, \r\n    __first=0x7fff02fdf100)\r\n    at torch/csrc/autograd/functions/batch_normalization.cpp:103\r\n#14 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, __first=<optimized out>)\r\n    at torch/csrc/autograd/functions/batch_normalization.cpp:126\r\n#15 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*, std::pair<std::shared_ptr<torch::autograd::Function>, int> > (\r\n    __last=0x7fff02fdf148, __first=0x7fff02fdf100)\r\n    at torch/csrc/autograd/functions/batch_normalization.cpp:151\r\n#16 std::vector<std::pair<std::shared_ptr<torch::autograd::Function>, int>, std::allocator<std::pair<std::shared_ptr<torch::autograd::Function>, int> > >::~vector (this=0x7fff0369dea8, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/functions/batch_normalization.cpp:415\r\n#17 torch::autograd::Function::~Function (this=0x7fff0369de98, \r\n    __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/functions/batch_normalization.cpp:63\r\n#18 torch::autograd::BatchNormBackward::~BatchNormBackward (\r\n    this=0x7fff0369de98, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/functions/batch_normalization.cpp:28\r\n#19 0x00007fff8ec4f870 in std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release (this=0x7fff0369de80)\r\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\r\n#20 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count (\r\n    this=0x7fff02dffb28, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:546\r\n#21 std::__shared_ptr<torch::autograd::Function, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr (this=0x7fff02dffb20, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:781\r\n#22 std::shared_ptr<torch::autograd::Function>::~shared_ptr (\r\n    this=0x7fff02dffb20, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:93\r\n#23 std::pair<std::shared_ptr<torch::autograd::Function>, int>::~pair (\r\n    this=0x7fff02dffb20, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:96\r\n#24 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int> > (__pointer=0x7fff02dffb20)\r\n    at torch/csrc/autograd/python_function.cpp:93\r\n#25 std::_Destroy_aux<false>::__destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, \r\n    __first=0x7fff02dffb20)\r\n    at torch/csrc/autograd/python_function.cpp:103\r\n#26 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, __first=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:126\r\n#27 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*, std::pair<std::shared_ptr<torch::autograd::Function>, int> > (\r\n    __last=0x7fff02dffb38, __first=0x7fff02dffb20)\r\n    at torch/csrc/autograd/python_function.cpp:151\r\n#28 std::vector<std::pair<std::shared_ptr<torch::autograd::Function>, int>, std::allocator<std::pair<std::shared_ptr<torch::autograd::Function>, int> > >::~vector (this=0x7fffe78b0bf0, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:415\r\n#29 torch::autograd::Function::~Function (this=0x7fffe78b0be0, \r\n    __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:63\r\n#30 torch::autograd::PyFunction::~PyFunction (this=0x7fffe78b0be0, \r\n    __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:19\r\n#31 THPFunction_dealloc (self=0x7fffe78b0b88)\r\n    at torch/csrc/autograd/python_function.cpp:287\r\n#32 0x00007ffff777af89 in subtype_dealloc (self=0x7fffe78b0b88)\r\n    at Objects/typeobject.c:1209\r\n#33 0x00007fff8ec555cb in Decref::operator() (this=<optimized out>, \r\n    p=0x7fffe78b0be0)\r\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\r\n#34 std::_Sp_counted_deleter<torch::autograd::PyFunction*, Decref, std::allocator<int>, (__gnu_cxx::_Lock_policy)2>::_M_dispose (\r\n    this=<optimized out>) at torch/csrc/autograd/python_function.cpp:347\r\n#35 0x00007fff8ec4f870 in std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release (this=0x7fff02dffe20)\r\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\r\n#36 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count (\r\n    this=0x7fff02dffe08, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:546\r\n#37 std::__shared_ptr<torch::autograd::Function, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr (this=0x7fff02dffe00, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:781\r\n#38 std::shared_ptr<torch::autograd::Function>::~shared_ptr (\r\n    this=0x7fff02dffe00, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:93\r\n#39 std::pair<std::shared_ptr<torch::autograd::Function>, int>::~pair (\r\n    this=0x7fff02dffe00, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:96\r\n#40 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int> > (__pointer=0x7fff02dffe00)\r\n    at torch/csrc/autograd/python_function.cpp:93\r\n#41 std::_Destroy_aux<false>::__destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, \r\n    __first=0x7fff02dffe00)\r\n    at torch/csrc/autograd/python_function.cpp:103\r\n#42 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, __first=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:126\r\n#43 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*, std::pair<std::shared_ptr<torch::autograd::Function>, int> > (\r\n    __last=0x7fff02dffe18, __first=0x7fff02dffe00)\r\n    at torch/csrc/autograd/python_function.cpp:151\r\n#44 std::vector<std::pair<std::shared_ptr<torch::autograd::Function>, int>, std::allocator<std::pair<std::shared_ptr<torch::autograd::Function>, int> > >::~vector (this=0x7fffe78b0650, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:415\r\n#45 torch::autograd::Function::~Function (this=0x7fffe78b0640, \r\n    __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:63\r\n#46 torch::autograd::PyFunction::~PyFunction (this=0x7fffe78b0640, \r\n    __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:19\r\n#47 THPFunction_dealloc (self=0x7fffe78b05e8)\r\n    at torch/csrc/autograd/python_function.cpp:287\r\n#48 0x00007ffff777af89 in subtype_dealloc (self=0x7fffe78b05e8)\r\n    at Objects/typeobject.c:1209\r\n#49 0x00007fff8ec555cb in Decref::operator() (this=<optimized out>, \r\n    p=0x7fffe78b0640)\r\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\r\n#50 std::_Sp_counted_deleter<torch::autograd::PyFunction*, Decref, std::allocator<int>, (__gnu_cxx::_Lock_policy)2>::_M_dispose (\r\n    this=<optimized out>) at torch/csrc/autograd/python_function.cpp:347\r\n#51 0x00007fff8ec4f870 in std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release (this=0x7fff02e00040)\r\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\r\n#52 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count (\r\n    this=0x7fff036e9e70, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:546\r\n#53 std::__shared_ptr<torch::autograd::Function, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr (this=0x7fff036e9e68, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:781\r\n#54 std::shared_ptr<torch::autograd::Function>::~shared_ptr (\r\n    this=0x7fff036e9e68, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:93\r\n#55 std::pair<std::shared_ptr<torch::autograd::Function>, int>::~pair (\r\n    this=0x7fff036e9e68, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:96\r\n#56 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int> > (__pointer=0x7fff036e9e68)\r\n    at torch/csrc/autograd/python_function.cpp:93\r\n#57 std::_Destroy_aux<false>::__destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, \r\n    __first=0x7fff036e9e68)\r\n    at torch/csrc/autograd/python_function.cpp:103\r\n#58 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, __first=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:126\r\n#59 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*, std::pair<std::shared_ptr<torch::autograd::Function>, int> > (\r\n    __last=0x7fff036e9e80, __first=0x7fff036e9e50)\r\n    at torch/csrc/autograd/python_function.cpp:151\r\n#60 std::vector<std::pair<std::shared_ptr<torch::autograd::Function>, int>, std::allocator<std::pair<std::shared_ptr<torch::autograd::Function>, int> > >::~vector (this=0x7fffef683830, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:415\r\n#61 torch::autograd::Function::~Function (this=0x7fffef683820, \r\n    __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:63\r\n#62 torch::autograd::PyFunction::~PyFunction (this=0x7fffef683820, \r\n    __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:19\r\n#63 THPFunction_dealloc (self=0x7fffef6837c8)\r\n    at torch/csrc/autograd/python_function.cpp:287\r\n#64 0x00007ffff777af89 in subtype_dealloc (self=0x7fffef6837c8)\r\n    at Objects/typeobject.c:1209\r\n#65 0x00007fff8ec555cb in Decref::operator() (this=<optimized out>, \r\n    p=0x7fffef683820)\r\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\r\n#66 std::_Sp_counted_deleter<torch::autograd::PyFunction*, Decref, std::allocator<int>, (__gnu_cxx::_Lock_policy)2>::_M_dispose (\r\n    this=<optimized out>) at torch/csrc/autograd/python_function.cpp:347\r\n#67 0x00007fff8ec4f870 in std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release (this=0x7fff02e00720)\r\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\r\n#68 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count (\r\n    this=0x7fff02e004c8, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:546\r\n#69 std::__shared_ptr<torch::autograd::Function, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr (this=0x7fff02e004c0, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:781\r\n#70 std::shared_ptr<torch::autograd::Function>::~shared_ptr (\r\n    this=0x7fff02e004c0, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:93\r\n#71 std::pair<std::shared_ptr<torch::autograd::Function>, int>::~pair (\r\n    this=0x7fff02e004c0, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:96\r\n#72 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int> > (__pointer=0x7fff02e004c0)\r\n    at torch/csrc/autograd/python_function.cpp:93\r\n#73 std::_Destroy_aux<false>::__destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, \r\n    __first=0x7fff02e004c0)\r\n    at torch/csrc/autograd/python_function.cpp:103\r\n#74 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, __first=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:126\r\n#75 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*, std::pair<std::shared_ptr<torch::autograd::Function>, int> > (\r\n    __last=0x7fff02e004d8, __first=0x7fff02e004c0)\r\n    at torch/csrc/autograd/python_function.cpp:151\r\n#76 std::vector<std::pair<std::shared_ptr<torch::autograd::Function>, int>, std::allocator<std::pair<std::shared_ptr<torch::autograd::Function>, int> > >::~vector (this=0x7fffef683bf0, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:415\r\n#77 torch::autograd::Function::~Function (this=0x7fffef683be0, \r\n    __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:63\r\n#78 torch::autograd::PyFunction::~PyFunction (this=0x7fffef683be0, \r\n    __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:19\r\n#79 THPFunction_dealloc (self=0x7fffef683b88)\r\n    at torch/csrc/autograd/python_function.cpp:287\r\n#80 0x00007ffff777af89 in subtype_dealloc (self=0x7fffef683b88)\r\n    at Objects/typeobject.c:1209\r\n#81 0x00007fff8ec555cb in Decref::operator() (this=<optimized out>, \r\n    p=0x7fffef683be0)\r\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\r\n#82 std::_Sp_counted_deleter<torch::autograd::PyFunction*, Decref, std::allocator<int>, (__gnu_cxx::_Lock_policy)2>::_M_dispose (\r\n    this=<optimized out>) at torch/csrc/autograd/python_function.cpp:347\r\n#83 0x00007fff8ec4f870 in std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release (this=0x7fff02e007c0)\r\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\r\n#84 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count (\r\n    this=0x7fff037070f0, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:546\r\n#85 std::__shared_ptr<torch::autograd::Function, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr (this=0x7fff037070e8, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:781\r\n#86 std::shared_ptr<torch::autograd::Function>::~shared_ptr (\r\n    this=0x7fff037070e8, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:93\r\n#87 std::pair<std::shared_ptr<torch::autograd::Function>, int>::~pair (\r\n    this=0x7fff037070e8, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:96\r\n#88 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int> > (__pointer=0x7fff037070e8)\r\n    at torch/csrc/autograd/python_function.cpp:93\r\n#89 std::_Destroy_aux<false>::__destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, \r\n    __first=0x7fff037070e8)\r\n    at torch/csrc/autograd/python_function.cpp:103\r\n#90 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*> (__last=<optimized out>, __first=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:126\r\n#91 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int>*, std::pair<std::shared_ptr<torch::autograd::Function>, int> > (\r\n    __last=0x7fff03707100, __first=0x7fff037070d0)\r\n    at torch/csrc/autograd/python_function.cpp:151\r\n#92 std::vector<std::pair<std::shared_ptr<torch::autograd::Function>, int>, std::allocator<std::pair<std::shared_ptr<torch::autograd::Function>, int> > >::~vector (this=0x7fffef683dd0, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:415\r\n#93 torch::autograd::Function::~Function (this=0x7fffef683dc0, \r\n    __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:63\r\n#94 torch::autograd::PyFunction::~PyFunction (this=0x7fffef683dc0, \r\n    __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:19\r\n#95 THPFunction_dealloc (self=0x7fffef683d68)\r\n    at torch/csrc/autograd/python_function.cpp:287\r\n#96 0x00007ffff777af89 in subtype_dealloc (self=0x7fffef683d68)\r\n    at Objects/typeobject.c:1209\r\n#97 0x00007fff8ec555cb in Decref::operator() (this=<optimized out>, \r\n    p=0x7fffef683dc0)\r\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\r\n#98 std::_Sp_counted_deleter<torch::autograd::PyFunction*, Decref, std::allocator<int>, (__gnu_cxx::_Lock_policy)2>::_M_dispose (\r\n    this=<optimized out>) at torch/csrc/autograd/python_function.cpp:347\r\n#99 0x00007fff8ec4f870 in std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release (this=0x7fff02e00ec0)\r\n   from /home/ubuntu/anaconda3/envs/py3/lib/python3.5/site-packages/torch/_C.cpython-35m-x86_64-linux-gnu.so\r\n#100 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count (\r\n    this=0x7fff02e00c68, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:546\r\n#101 std::__shared_ptr<torch::autograd::Function, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr (this=0x7fff02e00c60, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:781\r\n#102 std::shared_ptr<torch::autograd::Function>::~shared_ptr (\r\n    this=0x7fff02e00c60, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:93\r\n#103 std::pair<std::shared_ptr<torch::autograd::Function>, int>::~pair (\r\n    this=0x7fff02e00c60, __in_chrg=<optimized out>)\r\n    at torch/csrc/autograd/python_function.cpp:96\r\n#104 std::_Destroy<std::pair<std::shared_ptr<torch::autograd::Function>, int> > (__pointer=0x7fff02e00c60)\r\n    at torch/csrc/autograd/python_function.cpp:93\r\n#105\r\n```\r\nI have observed the memory via htop and nvidia-smi manually every few hundred iterations and didn't notice any significant uptick in memory growth over time."}