{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/391909274", "html_url": "https://github.com/pytorch/pytorch/issues/711#issuecomment-391909274", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/711", "id": 391909274, "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTkwOTI3NA==", "user": {"login": "icoxfog417", "id": 544269, "node_id": "MDQ6VXNlcjU0NDI2OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/544269?v=4", "gravatar_id": "", "url": "https://api.github.com/users/icoxfog417", "html_url": "https://github.com/icoxfog417", "followers_url": "https://api.github.com/users/icoxfog417/followers", "following_url": "https://api.github.com/users/icoxfog417/following{/other_user}", "gists_url": "https://api.github.com/users/icoxfog417/gists{/gist_id}", "starred_url": "https://api.github.com/users/icoxfog417/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/icoxfog417/subscriptions", "organizations_url": "https://api.github.com/users/icoxfog417/orgs", "repos_url": "https://api.github.com/users/icoxfog417/repos", "events_url": "https://api.github.com/users/icoxfog417/events{/privacy}", "received_events_url": "https://api.github.com/users/icoxfog417/received_events", "type": "User", "site_admin": false}, "created_at": "2018-05-25T00:54:25Z", "updated_at": "2018-05-25T01:04:18Z", "author_association": "NONE", "body_html": "<p>From the aspect of class design, the dependency from the parent class to child classes is not appropriate.<br>\nSpecifically, <a href=\"https://github.com/pytorch/pytorch/blob/master/torch/nn/modules/rnn.py#L40\">parent <code>RNNBase</code> class has the dependency on child classes <code>LSTM</code>, <code>GRU</code></a>.</p>\n<div class=\"highlight highlight-source-python\"><pre>        <span class=\"pl-k\">if</span> mode <span class=\"pl-k\">==</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>LSTM<span class=\"pl-pds\">'</span></span>:\n            gate_size <span class=\"pl-k\">=</span> <span class=\"pl-c1\">4</span> <span class=\"pl-k\">*</span> hidden_size\n        <span class=\"pl-k\">elif</span> mode <span class=\"pl-k\">==</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>GRU<span class=\"pl-pds\">'</span></span>:\n            gate_size <span class=\"pl-k\">=</span> <span class=\"pl-c1\">3</span> <span class=\"pl-k\">*</span> hidden_size\n        <span class=\"pl-k\">else</span>:\n            gate_size <span class=\"pl-k\">=</span> hidden_size</pre></div>\n<p>This architecture makes extending <code>RNNBase</code> difficult.</p>\n<ul>\n<li>When adding new <code>mode</code>: We have to modify parent class that will affect all the other child classes.</li>\n<li>When customizing existing cell (<code>LSTM</code>, <code>GRU</code>): We have to modify parent class because <a href=\"https://github.com/pytorch/pytorch/blob/master/torch/nn/modules/rnn.py#L424\">child class does not have a concrete implementation</a>.</li>\n<li>When extending <code>RNNBase</code>: We have to select the <code>mode</code> in spite of if it has no dependency on existing <code>mode</code>.</li>\n</ul>", "body_text": "From the aspect of class design, the dependency from the parent class to child classes is not appropriate.\nSpecifically, parent RNNBase class has the dependency on child classes LSTM, GRU.\n        if mode == 'LSTM':\n            gate_size = 4 * hidden_size\n        elif mode == 'GRU':\n            gate_size = 3 * hidden_size\n        else:\n            gate_size = hidden_size\nThis architecture makes extending RNNBase difficult.\n\nWhen adding new mode: We have to modify parent class that will affect all the other child classes.\nWhen customizing existing cell (LSTM, GRU): We have to modify parent class because child class does not have a concrete implementation.\nWhen extending RNNBase: We have to select the mode in spite of if it has no dependency on existing mode.", "body": "From the aspect of class design, the dependency from the parent class to child classes is not appropriate. \r\nSpecifically, [parent `RNNBase` class has the dependency on child classes `LSTM`, `GRU`](https://github.com/pytorch/pytorch/blob/master/torch/nn/modules/rnn.py#L40).\r\n\r\n```py\r\n        if mode == 'LSTM':\r\n            gate_size = 4 * hidden_size\r\n        elif mode == 'GRU':\r\n            gate_size = 3 * hidden_size\r\n        else:\r\n            gate_size = hidden_size\r\n```\r\n\r\nThis architecture makes extending `RNNBase` difficult.\r\n\r\n* When adding new `mode`: We have to modify parent class that will affect all the other child classes. \r\n* When customizing existing cell (`LSTM`, `GRU`): We have to modify parent class because [child class does not have a concrete implementation](https://github.com/pytorch/pytorch/blob/master/torch/nn/modules/rnn.py#L424).\r\n* When extending `RNNBase`: We have to select the `mode` in spite of if it has no dependency on existing `mode`.\r\n\r\n"}