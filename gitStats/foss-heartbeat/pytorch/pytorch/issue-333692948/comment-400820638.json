{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/400820638", "html_url": "https://github.com/pytorch/pytorch/issues/8651#issuecomment-400820638", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/8651", "id": 400820638, "node_id": "MDEyOklzc3VlQ29tbWVudDQwMDgyMDYzOA==", "user": {"login": "yf225", "id": 4063635, "node_id": "MDQ6VXNlcjQwNjM2MzU=", "avatar_url": "https://avatars0.githubusercontent.com/u/4063635?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yf225", "html_url": "https://github.com/yf225", "followers_url": "https://api.github.com/users/yf225/followers", "following_url": "https://api.github.com/users/yf225/following{/other_user}", "gists_url": "https://api.github.com/users/yf225/gists{/gist_id}", "starred_url": "https://api.github.com/users/yf225/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yf225/subscriptions", "organizations_url": "https://api.github.com/users/yf225/orgs", "repos_url": "https://api.github.com/users/yf225/repos", "events_url": "https://api.github.com/users/yf225/events{/privacy}", "received_events_url": "https://api.github.com/users/yf225/received_events", "type": "User", "site_admin": false}, "created_at": "2018-06-27T20:36:44Z", "updated_at": "2018-06-27T20:36:44Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=7427306\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/timmeinhardt\">@timmeinhardt</a> It seems that the pickling of a <code>torch.Tensor</code> by <code>Connection.send()</code> would somehow alter the RNG state. We are working on better support of Pipe in <code>torch.multiprocessing</code> (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"331585994\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/8374\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/8374/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/8374\">#8374</a>) which will address this issue. For now, one workaround is to do the following:</p>\n<pre><code>import io\n\n...\nif return_torch:\n    buf = io.BytesIO()\n    torch.save(tensor, buf)\n    buf.seek(0)\n    ret = buf\n...\n</code></pre>\n<p>Then, we can retrieve the tensor by <code>tensor = torch.load(remote.recv())</code>.</p>", "body_text": "@timmeinhardt It seems that the pickling of a torch.Tensor by Connection.send() would somehow alter the RNG state. We are working on better support of Pipe in torch.multiprocessing (#8374) which will address this issue. For now, one workaround is to do the following:\nimport io\n\n...\nif return_torch:\n    buf = io.BytesIO()\n    torch.save(tensor, buf)\n    buf.seek(0)\n    ret = buf\n...\n\nThen, we can retrieve the tensor by tensor = torch.load(remote.recv()).", "body": "@timmeinhardt It seems that the pickling of a `torch.Tensor` by `Connection.send()` would somehow alter the RNG state. We are working on better support of Pipe in `torch.multiprocessing` (https://github.com/pytorch/pytorch/issues/8374) which will address this issue. For now, one workaround is to do the following:\r\n```\r\nimport io\r\n\r\n...\r\nif return_torch:\r\n    buf = io.BytesIO()\r\n    torch.save(tensor, buf)\r\n    buf.seek(0)\r\n    ret = buf\r\n...\r\n```\r\n\r\nThen, we can retrieve the tensor by `tensor = torch.load(remote.recv())`."}