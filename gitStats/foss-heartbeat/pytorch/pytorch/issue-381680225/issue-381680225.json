{"url": "https://api.github.com/repos/pytorch/pytorch/issues/14102", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/14102/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/14102/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/14102/events", "html_url": "https://github.com/pytorch/pytorch/issues/14102", "id": 381680225, "node_id": "MDU6SXNzdWUzODE2ODAyMjU=", "number": 14102, "title": "Caffe2: ONNX building with lite proto failure", "user": {"login": "h6197627", "id": 44726212, "node_id": "MDQ6VXNlcjQ0NzI2MjEy", "avatar_url": "https://avatars1.githubusercontent.com/u/44726212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/h6197627", "html_url": "https://github.com/h6197627", "followers_url": "https://api.github.com/users/h6197627/followers", "following_url": "https://api.github.com/users/h6197627/following{/other_user}", "gists_url": "https://api.github.com/users/h6197627/gists{/gist_id}", "starred_url": "https://api.github.com/users/h6197627/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/h6197627/subscriptions", "organizations_url": "https://api.github.com/users/h6197627/orgs", "repos_url": "https://api.github.com/users/h6197627/repos", "events_url": "https://api.github.com/users/h6197627/events{/privacy}", "received_events_url": "https://api.github.com/users/h6197627/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-11-16T16:53:08Z", "updated_at": "2018-11-17T17:53:38Z", "closed_at": "2018-11-17T17:53:38Z", "author_association": "NONE", "body_html": "<h2><g-emoji class=\"g-emoji\" alias=\"bug\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f41b.png\">\ud83d\udc1b</g-emoji> Bug</h2>\n<p>I am trying to build Caffe2 for Android and to reduce final size I want to use protobuf-lite. To archive it I added two flags to build_android.sh script: USE_LITE_PROTO and ONNX_USE_LITE_PROTO. However in such case it fails twice.<br>\n1)</p>\n<pre><code>Building CXX object caffe2/CMakeFiles/caffe2.dir/onnx/backend.cc.o\nIn file included from /home/user/caffe2/src/caffe2/core/logging.h:2:0,\n                 from /home/user/caffe2/src/caffe2/onnx/backend.cc:1:\n/home/user/caffe2/src/caffe2/onnx/backend.cc: In member function \u2018void caffe2::onnx::Caffe2Backend::BuildTensorFillingOp(caffe2::OperatorDef*, const onnx_c2::TensorProto&amp;, const string&amp;)\u2019:\n/home/user/caffe2/src/caffe2/onnx/backend.cc:1726:9: error: \u2018DataType_Name\u2019 is not a member of \u2018onnx_c2::TensorProto\u2019\n         TensorProto::DataType_Name(onnx_tensor.data_type()));\n</code></pre>\n<p>This part is quite easy to temporary resolve. DataType_Name is used only for producing better exception description and can be removed without any impact.<br>\nHowever, after resolving the first issue next one occurs:<br>\n2)</p>\n<pre><code>Building CXX object caffe2/CMakeFiles/caffe2.dir/opt/onnxifi_transformer.cc.o\n/home/user/caffe2/src/caffe2/opt/onnxifi_transformer.cc: In function \u2018void caffe2::{anonymous}::DumpModel(const onnx_c2::ModelProto&amp;, const string&amp;)\u2019:\n/home/user/caffe2/src/caffe2/opt/onnxifi_transformer.cc:94:69: error: no matching function for call to \u2018google::protobuf::TextFormat::PrintToString(const onnx_c2::GraphProto&amp;, std::__cxx11::string*)\u2019\n   ::google::protobuf::TextFormat::PrintToString(model.graph(), &amp;body);\n                                                                     ^\nIn file included from /home/user/caffe2/src/caffe2/opt/onnxifi_transformer.cc:6:0:\n/home/user/caffe2/src/third_party/protobuf/src/google/protobuf/text_format.h:81:15: note: candidate: static bool google::protobuf::TextFormat::PrintToString(const google::protobuf::Message&amp;, std::__cxx11::string*)\n   static bool PrintToString(const Message&amp; message, string* output);\n               ^\n/home/user/caffe2/src/third_party/protobuf/src/google/protobuf/text_format.h:81:15: note:   no known conversion for argument 1 from \u2018const onnx_c2::GraphProto\u2019 to \u2018const google::protobuf::Message&amp;\u2019\ncaffe2/CMakeFiles/caffe2.dir/build.make:7169: recipe for target 'caffe2/CMakeFiles/caffe2.dir/opt/onnxifi_transformer.cc.o' failed\n</code></pre>\n<p>I do not know how fix the second failure. This behavior was reproduced and  by building Linux x86_64 version with same USE_LITE_PROTO, ONNX_USE_LITE_PROTO cmake flags.</p>\n<h2>To Reproduce</h2>\n<p>Steps to reproduce the behavior:</p>\n<blockquote>\n<p>mkdir build &amp;&amp; cd build<br>\ncmake -D USE_LITE_PROTO=ON -D ONNX_USE_LITE_PROTO=ON ..<br>\nmake -j12</p>\n</blockquote>\n<h2>Expected behavior</h2>\n<p>Caffe2 built with protobuf-lite</p>\n<h2>Environment</h2>\n<ul>\n<li>Caffe2 Version (e.g., 1.0): master</li>\n<li>OS (e.g., Linux): Android/Ubuntu</li>\n<li>How you installed Caffe: source</li>\n</ul>", "body_text": "\ud83d\udc1b Bug\nI am trying to build Caffe2 for Android and to reduce final size I want to use protobuf-lite. To archive it I added two flags to build_android.sh script: USE_LITE_PROTO and ONNX_USE_LITE_PROTO. However in such case it fails twice.\n1)\nBuilding CXX object caffe2/CMakeFiles/caffe2.dir/onnx/backend.cc.o\nIn file included from /home/user/caffe2/src/caffe2/core/logging.h:2:0,\n                 from /home/user/caffe2/src/caffe2/onnx/backend.cc:1:\n/home/user/caffe2/src/caffe2/onnx/backend.cc: In member function \u2018void caffe2::onnx::Caffe2Backend::BuildTensorFillingOp(caffe2::OperatorDef*, const onnx_c2::TensorProto&, const string&)\u2019:\n/home/user/caffe2/src/caffe2/onnx/backend.cc:1726:9: error: \u2018DataType_Name\u2019 is not a member of \u2018onnx_c2::TensorProto\u2019\n         TensorProto::DataType_Name(onnx_tensor.data_type()));\n\nThis part is quite easy to temporary resolve. DataType_Name is used only for producing better exception description and can be removed without any impact.\nHowever, after resolving the first issue next one occurs:\n2)\nBuilding CXX object caffe2/CMakeFiles/caffe2.dir/opt/onnxifi_transformer.cc.o\n/home/user/caffe2/src/caffe2/opt/onnxifi_transformer.cc: In function \u2018void caffe2::{anonymous}::DumpModel(const onnx_c2::ModelProto&, const string&)\u2019:\n/home/user/caffe2/src/caffe2/opt/onnxifi_transformer.cc:94:69: error: no matching function for call to \u2018google::protobuf::TextFormat::PrintToString(const onnx_c2::GraphProto&, std::__cxx11::string*)\u2019\n   ::google::protobuf::TextFormat::PrintToString(model.graph(), &body);\n                                                                     ^\nIn file included from /home/user/caffe2/src/caffe2/opt/onnxifi_transformer.cc:6:0:\n/home/user/caffe2/src/third_party/protobuf/src/google/protobuf/text_format.h:81:15: note: candidate: static bool google::protobuf::TextFormat::PrintToString(const google::protobuf::Message&, std::__cxx11::string*)\n   static bool PrintToString(const Message& message, string* output);\n               ^\n/home/user/caffe2/src/third_party/protobuf/src/google/protobuf/text_format.h:81:15: note:   no known conversion for argument 1 from \u2018const onnx_c2::GraphProto\u2019 to \u2018const google::protobuf::Message&\u2019\ncaffe2/CMakeFiles/caffe2.dir/build.make:7169: recipe for target 'caffe2/CMakeFiles/caffe2.dir/opt/onnxifi_transformer.cc.o' failed\n\nI do not know how fix the second failure. This behavior was reproduced and  by building Linux x86_64 version with same USE_LITE_PROTO, ONNX_USE_LITE_PROTO cmake flags.\nTo Reproduce\nSteps to reproduce the behavior:\n\nmkdir build && cd build\ncmake -D USE_LITE_PROTO=ON -D ONNX_USE_LITE_PROTO=ON ..\nmake -j12\n\nExpected behavior\nCaffe2 built with protobuf-lite\nEnvironment\n\nCaffe2 Version (e.g., 1.0): master\nOS (e.g., Linux): Android/Ubuntu\nHow you installed Caffe: source", "body": "## \ud83d\udc1b Bug\r\n\r\nI am trying to build Caffe2 for Android and to reduce final size I want to use protobuf-lite. To archive it I added two flags to build_android.sh script: USE_LITE_PROTO and ONNX_USE_LITE_PROTO. However in such case it fails twice.\r\n1)\r\n```\r\nBuilding CXX object caffe2/CMakeFiles/caffe2.dir/onnx/backend.cc.o\r\nIn file included from /home/user/caffe2/src/caffe2/core/logging.h:2:0,\r\n                 from /home/user/caffe2/src/caffe2/onnx/backend.cc:1:\r\n/home/user/caffe2/src/caffe2/onnx/backend.cc: In member function \u2018void caffe2::onnx::Caffe2Backend::BuildTensorFillingOp(caffe2::OperatorDef*, const onnx_c2::TensorProto&, const string&)\u2019:\r\n/home/user/caffe2/src/caffe2/onnx/backend.cc:1726:9: error: \u2018DataType_Name\u2019 is not a member of \u2018onnx_c2::TensorProto\u2019\r\n         TensorProto::DataType_Name(onnx_tensor.data_type()));\r\n```\r\nThis part is quite easy to temporary resolve. DataType_Name is used only for producing better exception description and can be removed without any impact.\r\nHowever, after resolving the first issue next one occurs:\r\n2)\r\n```\r\nBuilding CXX object caffe2/CMakeFiles/caffe2.dir/opt/onnxifi_transformer.cc.o\r\n/home/user/caffe2/src/caffe2/opt/onnxifi_transformer.cc: In function \u2018void caffe2::{anonymous}::DumpModel(const onnx_c2::ModelProto&, const string&)\u2019:\r\n/home/user/caffe2/src/caffe2/opt/onnxifi_transformer.cc:94:69: error: no matching function for call to \u2018google::protobuf::TextFormat::PrintToString(const onnx_c2::GraphProto&, std::__cxx11::string*)\u2019\r\n   ::google::protobuf::TextFormat::PrintToString(model.graph(), &body);\r\n                                                                     ^\r\nIn file included from /home/user/caffe2/src/caffe2/opt/onnxifi_transformer.cc:6:0:\r\n/home/user/caffe2/src/third_party/protobuf/src/google/protobuf/text_format.h:81:15: note: candidate: static bool google::protobuf::TextFormat::PrintToString(const google::protobuf::Message&, std::__cxx11::string*)\r\n   static bool PrintToString(const Message& message, string* output);\r\n               ^\r\n/home/user/caffe2/src/third_party/protobuf/src/google/protobuf/text_format.h:81:15: note:   no known conversion for argument 1 from \u2018const onnx_c2::GraphProto\u2019 to \u2018const google::protobuf::Message&\u2019\r\ncaffe2/CMakeFiles/caffe2.dir/build.make:7169: recipe for target 'caffe2/CMakeFiles/caffe2.dir/opt/onnxifi_transformer.cc.o' failed\r\n```\r\nI do not know how fix the second failure. This behavior was reproduced and  by building Linux x86_64 version with same USE_LITE_PROTO, ONNX_USE_LITE_PROTO cmake flags.\r\n\r\n## To Reproduce\r\n\r\nSteps to reproduce the behavior:\r\n\r\n> mkdir build && cd build\r\n> cmake -D USE_LITE_PROTO=ON -D ONNX_USE_LITE_PROTO=ON ..\r\n> make -j12\r\n\r\n## Expected behavior\r\n\r\nCaffe2 built with protobuf-lite\r\n\r\n## Environment\r\n\r\n - Caffe2 Version (e.g., 1.0): master\r\n - OS (e.g., Linux): Android/Ubuntu\r\n - How you installed Caffe: source"}