{"url": "https://api.github.com/repos/pytorch/pytorch/issues/5355", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/5355/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/5355/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/5355/events", "html_url": "https://github.com/pytorch/pytorch/issues/5355", "id": 299502226, "node_id": "MDU6SXNzdWUyOTk1MDIyMjY=", "number": 5355, "title": "DataLoader.__del__ bug with mpi4py", "user": {"login": "stsievert", "id": 1320475, "node_id": "MDQ6VXNlcjEzMjA0NzU=", "avatar_url": "https://avatars1.githubusercontent.com/u/1320475?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stsievert", "html_url": "https://github.com/stsievert", "followers_url": "https://api.github.com/users/stsievert/followers", "following_url": "https://api.github.com/users/stsievert/following{/other_user}", "gists_url": "https://api.github.com/users/stsievert/gists{/gist_id}", "starred_url": "https://api.github.com/users/stsievert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stsievert/subscriptions", "organizations_url": "https://api.github.com/users/stsievert/orgs", "repos_url": "https://api.github.com/users/stsievert/repos", "events_url": "https://api.github.com/users/stsievert/events{/privacy}", "received_events_url": "https://api.github.com/users/stsievert/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-02-22T20:46:52Z", "updated_at": "2018-02-24T18:32:13Z", "closed_at": "2018-02-24T18:32:13Z", "author_association": "CONTRIBUTOR", "body_html": "<p>I'm creating a <code>torch.utils.data.DataLoader</code> in my script (<a href=\"https://github.com/stsievert/LeanSGD/blob/async-comms/train.py\">train.py</a>), and I get an error when this script is close to ending. I am using MPI through mpi4py, not the MPI PyTorch distributed backend. This error only happens when under <code>mpirun python train.py</code>, not under <code>python train.py</code> (which completes successfully).</p>\n<p>Nothing in the traceback reveals this is an issue with my code, and I haven't touched the DataLoader at all. I've been running this code for a couple months in the same environment, and I haven't seen this bug pop before.</p>\n<p>That is, this command does not raise an error:</p>\n<div class=\"highlight highlight-source-shell\"><pre>$ python train.py --epochs=0\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> works fine; no error</span></pre></div>\n<p>However, this command does raise an error:</p>\n<div class=\"highlight highlight-source-shell\"><pre>$ mpirun python train.py --epochs=0\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> normal output, almost finished running script</span>\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> produces traceback below</span></pre></div>\n<p>Traceback:</p>\n<pre lang=\"traceback\"><code>Exception ignored in: &lt;bound method DataLoaderIter.__del__ of &lt;torch.utils.data.dataloader.DataLoaderIter object at 0x7fd7da6d1668&gt;&gt;\nTraceback (most recent call last):\n  File \"/home/ec2-user/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 333, in __del__\n    self._shutdown_workers()\n  File \"/home/ec2-user/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 319, in _shutdown_workers\n    self.data_queue.get()\n  File \"/home/ec2-user/anaconda3/lib/python3.6/multiprocessing/queues.py\", line 345, in get\n    return _ForkingPickler.loads(res)\n  File \"/home/ec2-user/anaconda3/lib/python3.6/site-packages/torch/multiprocessing/reductions.py\", line 70, in rebuild_storage_fd\n    fd = df.detach()\n  File \"/home/ec2-user/anaconda3/lib/python3.6/multiprocessing/resource_sharer.py\", line 57, in detach\n    with _resource_sharer.get_connection(self._id) as conn:\n  File \"/home/ec2-user/anaconda3/lib/python3.6/multiprocessing/resource_sharer.py\", line 87, in get_connection\n    c = Client(address, authkey=process.current_process().authkey)\n  File \"/home/ec2-user/anaconda3/lib/python3.6/multiprocessing/connection.py\", line 487, in Client\n    c = SocketClient(address)\n  File \"/home/ec2-user/anaconda3/lib/python3.6/multiprocessing/connection.py\", line 614, in SocketClient\n    s.connect(address)\nFileNotFoundError: [Errno 2] No such file or directory\n</code></pre>\n<ul>\n<li>PyTorch version: 0.3.1.post2</li>\n<li>How you installed PyTorch (conda, pip, source): conda</li>\n<li>Python version: 3.6.1</li>\n<li>OS/CUDA/cuDNN version: A modification of the Deep Learning AMI</li>\n<li>GPU models and configuration: Amazon p2.xlarge instance</li>\n</ul>", "body_text": "I'm creating a torch.utils.data.DataLoader in my script (train.py), and I get an error when this script is close to ending. I am using MPI through mpi4py, not the MPI PyTorch distributed backend. This error only happens when under mpirun python train.py, not under python train.py (which completes successfully).\nNothing in the traceback reveals this is an issue with my code, and I haven't touched the DataLoader at all. I've been running this code for a couple months in the same environment, and I haven't seen this bug pop before.\nThat is, this command does not raise an error:\n$ python train.py --epochs=0\n# works fine; no error\nHowever, this command does raise an error:\n$ mpirun python train.py --epochs=0\n# normal output, almost finished running script\n# produces traceback below\nTraceback:\nException ignored in: <bound method DataLoaderIter.__del__ of <torch.utils.data.dataloader.DataLoaderIter object at 0x7fd7da6d1668>>\nTraceback (most recent call last):\n  File \"/home/ec2-user/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 333, in __del__\n    self._shutdown_workers()\n  File \"/home/ec2-user/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 319, in _shutdown_workers\n    self.data_queue.get()\n  File \"/home/ec2-user/anaconda3/lib/python3.6/multiprocessing/queues.py\", line 345, in get\n    return _ForkingPickler.loads(res)\n  File \"/home/ec2-user/anaconda3/lib/python3.6/site-packages/torch/multiprocessing/reductions.py\", line 70, in rebuild_storage_fd\n    fd = df.detach()\n  File \"/home/ec2-user/anaconda3/lib/python3.6/multiprocessing/resource_sharer.py\", line 57, in detach\n    with _resource_sharer.get_connection(self._id) as conn:\n  File \"/home/ec2-user/anaconda3/lib/python3.6/multiprocessing/resource_sharer.py\", line 87, in get_connection\n    c = Client(address, authkey=process.current_process().authkey)\n  File \"/home/ec2-user/anaconda3/lib/python3.6/multiprocessing/connection.py\", line 487, in Client\n    c = SocketClient(address)\n  File \"/home/ec2-user/anaconda3/lib/python3.6/multiprocessing/connection.py\", line 614, in SocketClient\n    s.connect(address)\nFileNotFoundError: [Errno 2] No such file or directory\n\n\nPyTorch version: 0.3.1.post2\nHow you installed PyTorch (conda, pip, source): conda\nPython version: 3.6.1\nOS/CUDA/cuDNN version: A modification of the Deep Learning AMI\nGPU models and configuration: Amazon p2.xlarge instance", "body": "I'm creating a `torch.utils.data.DataLoader` in my script ([train.py]), and I get an error when this script is close to ending. I am using MPI through mpi4py, not the MPI PyTorch distributed backend. This error only happens when under `mpirun python train.py`, not under `python train.py` (which completes successfully).\r\n\r\nNothing in the traceback reveals this is an issue with my code, and I haven't touched the DataLoader at all. I've been running this code for a couple months in the same environment, and I haven't seen this bug pop before.\r\n\r\nThat is, this command does not raise an error:\r\n\r\n\r\n\r\n``` shell\r\n$ python train.py --epochs=0\r\n# works fine; no error\r\n``` \r\n\r\nHowever, this command does raise an error:\r\n\r\n``` shell\r\n$ mpirun python train.py --epochs=0\r\n# normal output, almost finished running script\r\n# produces traceback below\r\n```\r\n\r\nTraceback:\r\n\r\n``` traceback\r\nException ignored in: <bound method DataLoaderIter.__del__ of <torch.utils.data.dataloader.DataLoaderIter object at 0x7fd7da6d1668>>\r\nTraceback (most recent call last):\r\n  File \"/home/ec2-user/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 333, in __del__\r\n    self._shutdown_workers()\r\n  File \"/home/ec2-user/anaconda3/lib/python3.6/site-packages/torch/utils/data/dataloader.py\", line 319, in _shutdown_workers\r\n    self.data_queue.get()\r\n  File \"/home/ec2-user/anaconda3/lib/python3.6/multiprocessing/queues.py\", line 345, in get\r\n    return _ForkingPickler.loads(res)\r\n  File \"/home/ec2-user/anaconda3/lib/python3.6/site-packages/torch/multiprocessing/reductions.py\", line 70, in rebuild_storage_fd\r\n    fd = df.detach()\r\n  File \"/home/ec2-user/anaconda3/lib/python3.6/multiprocessing/resource_sharer.py\", line 57, in detach\r\n    with _resource_sharer.get_connection(self._id) as conn:\r\n  File \"/home/ec2-user/anaconda3/lib/python3.6/multiprocessing/resource_sharer.py\", line 87, in get_connection\r\n    c = Client(address, authkey=process.current_process().authkey)\r\n  File \"/home/ec2-user/anaconda3/lib/python3.6/multiprocessing/connection.py\", line 487, in Client\r\n    c = SocketClient(address)\r\n  File \"/home/ec2-user/anaconda3/lib/python3.6/multiprocessing/connection.py\", line 614, in SocketClient\r\n    s.connect(address)\r\nFileNotFoundError: [Errno 2] No such file or directory\r\n```\r\n\r\n- PyTorch version: 0.3.1.post2\r\n- How you installed PyTorch (conda, pip, source): conda\r\n- Python version: 3.6.1\r\n- OS/CUDA/cuDNN version: A modification of the Deep Learning AMI\r\n- GPU models and configuration: Amazon p2.xlarge instance\r\n\r\n[train.py]:https://github.com/stsievert/LeanSGD/blob/async-comms/train.py\r\n"}