{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/412924139", "html_url": "https://github.com/pytorch/pytorch/pull/10500#issuecomment-412924139", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/10500", "id": 412924139, "node_id": "MDEyOklzc3VlQ29tbWVudDQxMjkyNDEzOQ==", "user": {"login": "suo", "id": 1617424, "node_id": "MDQ6VXNlcjE2MTc0MjQ=", "avatar_url": "https://avatars2.githubusercontent.com/u/1617424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/suo", "html_url": "https://github.com/suo", "followers_url": "https://api.github.com/users/suo/followers", "following_url": "https://api.github.com/users/suo/following{/other_user}", "gists_url": "https://api.github.com/users/suo/gists{/gist_id}", "starred_url": "https://api.github.com/users/suo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/suo/subscriptions", "organizations_url": "https://api.github.com/users/suo/orgs", "repos_url": "https://api.github.com/users/suo/repos", "events_url": "https://api.github.com/users/suo/events{/privacy}", "received_events_url": "https://api.github.com/users/suo/received_events", "type": "User", "site_admin": false}, "created_at": "2018-08-14T16:00:55Z", "updated_at": "2018-08-14T16:00:55Z", "author_association": "MEMBER", "body_html": "<p>Thanks for the review!</p>\n<p>At a high level, a lot of your comments are due to the fact that we're using a \"fence\" rather than altering the mutating op in some way. The tradeoff here is that it makes certain passes (DCE, constant prop) more complicated, because the pass needs to know about the fence and can't use the regular function input/output rules to \"do the right thing\".</p>\n<p>The alternative would be to write the token passing directly into the input/output of affected nodes. This makes DCE/constant prop simpler, but makes another kind of pass (all passes that want to emit or restructure ops on mutable values) more complex, since we'd need to special-case the schema matching logic to ignore the world token IO and figure out how to emit new world tokens in the middle of another pass.</p>\n<p>I'm not sure what the right balance to strike here would be. My initial thought was that DCE/constant prop are the simplest passes, so maybe it's a good idea to place \"cost\" of mutation on those passes?</p>", "body_text": "Thanks for the review!\nAt a high level, a lot of your comments are due to the fact that we're using a \"fence\" rather than altering the mutating op in some way. The tradeoff here is that it makes certain passes (DCE, constant prop) more complicated, because the pass needs to know about the fence and can't use the regular function input/output rules to \"do the right thing\".\nThe alternative would be to write the token passing directly into the input/output of affected nodes. This makes DCE/constant prop simpler, but makes another kind of pass (all passes that want to emit or restructure ops on mutable values) more complex, since we'd need to special-case the schema matching logic to ignore the world token IO and figure out how to emit new world tokens in the middle of another pass.\nI'm not sure what the right balance to strike here would be. My initial thought was that DCE/constant prop are the simplest passes, so maybe it's a good idea to place \"cost\" of mutation on those passes?", "body": "Thanks for the review! \r\n\r\nAt a high level, a lot of your comments are due to the fact that we're using a \"fence\" rather than altering the mutating op in some way. The tradeoff here is that it makes certain passes (DCE, constant prop) more complicated, because the pass needs to know about the fence and can't use the regular function input/output rules to \"do the right thing\".\r\n\r\nThe alternative would be to write the token passing directly into the input/output of affected nodes. This makes DCE/constant prop simpler, but makes another kind of pass (all passes that want to emit or restructure ops on mutable values) more complex, since we'd need to special-case the schema matching logic to ignore the world token IO and figure out how to emit new world tokens in the middle of another pass.\r\n\r\nI'm not sure what the right balance to strike here would be. My initial thought was that DCE/constant prop are the simplest passes, so maybe it's a good idea to place \"cost\" of mutation on those passes?"}