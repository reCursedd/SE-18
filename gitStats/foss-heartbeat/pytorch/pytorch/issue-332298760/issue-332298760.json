{"url": "https://api.github.com/repos/pytorch/pytorch/issues/8477", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/8477/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/8477/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/8477/events", "html_url": "https://github.com/pytorch/pytorch/issues/8477", "id": 332298760, "node_id": "MDU6SXNzdWUzMzIyOTg3NjA=", "number": 8477, "title": "exception during torch.save caused by EINTR", "user": {"login": "drlr1115", "id": 4352595, "node_id": "MDQ6VXNlcjQzNTI1OTU=", "avatar_url": "https://avatars3.githubusercontent.com/u/4352595?v=4", "gravatar_id": "", "url": "https://api.github.com/users/drlr1115", "html_url": "https://github.com/drlr1115", "followers_url": "https://api.github.com/users/drlr1115/followers", "following_url": "https://api.github.com/users/drlr1115/following{/other_user}", "gists_url": "https://api.github.com/users/drlr1115/gists{/gist_id}", "starred_url": "https://api.github.com/users/drlr1115/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/drlr1115/subscriptions", "organizations_url": "https://api.github.com/users/drlr1115/orgs", "repos_url": "https://api.github.com/users/drlr1115/repos", "events_url": "https://api.github.com/users/drlr1115/events{/privacy}", "received_events_url": "https://api.github.com/users/drlr1115/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 443483881, "node_id": "MDU6TGFiZWw0NDM0ODM4ODE=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/todo", "name": "todo", "color": "c2e0c6", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-06-14T08:23:05Z", "updated_at": "2018-06-18T17:41:01Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>I was trying below example<br>\n<a href=\"https://github.com/pytorch/examples/tree/master/imagenet\">https://github.com/pytorch/examples/tree/master/imagenet</a><br>\nand made few changes in the code to get data and save checkpoints from/to cephfs.</p>\n<p>command and arguments:<br>\npython main.py --data-dir=/mnt/data --output-dir=/mnt/output/ --epochs=1</p>\n<p>There was a big chance that I got below error:<br>\n<strong>doWrite rc: -1 err: 4 errstr: Interrupted system call<br>\nSignal 17</strong><br>\nTraceback (most recent call last):<br>\nFile \"main.py\", line 375, in <br>\nmain()<br>\nFile \"main.py\", line 223, in main<br>\n}, is_best)<br>\nFile \"main.py\", line 326, in save_checkpoint<br>\ntorch.save(state, filename)<br>\nFile \"/usr/local/lib/python3.5/dist-packages/torch/serialization.py\", line 161, in save<br>\nreturn _with_file_like(f, \"wb\", lambda f: _save(obj, f, pickle_module, pickle_protocol))<br>\nFile \"/usr/local/lib/python3.5/dist-packages/torch/serialization.py\", line 118, in _with_file_like<br>\nreturn body(f)<br>\nFile \"/usr/local/lib/python3.5/dist-packages/torch/serialization.py\", line 161, in <br>\nreturn _with_file_like(f, \"wb\", lambda f: _save(obj, f, pickle_module, pickle_protocol))<br>\nFile \"/usr/local/lib/python3.5/dist-packages/torch/serialization.py\", line 238, in _save<br>\nserialized_storages[key]._write_file(f, _is_real_file(f))<br>\nRuntimeError: Unknown error -1</p>\n<p>I added some code in the source code to print the error and signal, then reproduced and got the bold lines.<br>\nSeems like save operation happened right after validation finished, exit of worker subprocesses caused the SIGCHLD, then interrupted \"write\" system call.</p>\n<p>I already add some sleep time before save as a workaround, but should some retry mechanism been added into the save code or provide more specific error msg?</p>\n<ul>\n<li>PyTorch v0.4.0</li>\n<li>How you installed PyTorch (conda, pip, source): pip</li>\n<li>Build command you used (if compiling from source):</li>\n<li>OS: Ubuntu16.04</li>\n<li>PyTorch version: 0.4.0</li>\n<li>Python version: 3.5.2</li>\n<li>CUDA/cuDNN version: 9.0/7.1.2</li>\n<li>GPU models and configuration: P40/K40</li>\n<li>GCC version (if compiling from source):</li>\n<li>CMake version:</li>\n<li>Versions of any other relevant libraries:</li>\n</ul>", "body_text": "I was trying below example\nhttps://github.com/pytorch/examples/tree/master/imagenet\nand made few changes in the code to get data and save checkpoints from/to cephfs.\ncommand and arguments:\npython main.py --data-dir=/mnt/data --output-dir=/mnt/output/ --epochs=1\nThere was a big chance that I got below error:\ndoWrite rc: -1 err: 4 errstr: Interrupted system call\nSignal 17\nTraceback (most recent call last):\nFile \"main.py\", line 375, in \nmain()\nFile \"main.py\", line 223, in main\n}, is_best)\nFile \"main.py\", line 326, in save_checkpoint\ntorch.save(state, filename)\nFile \"/usr/local/lib/python3.5/dist-packages/torch/serialization.py\", line 161, in save\nreturn _with_file_like(f, \"wb\", lambda f: _save(obj, f, pickle_module, pickle_protocol))\nFile \"/usr/local/lib/python3.5/dist-packages/torch/serialization.py\", line 118, in _with_file_like\nreturn body(f)\nFile \"/usr/local/lib/python3.5/dist-packages/torch/serialization.py\", line 161, in \nreturn _with_file_like(f, \"wb\", lambda f: _save(obj, f, pickle_module, pickle_protocol))\nFile \"/usr/local/lib/python3.5/dist-packages/torch/serialization.py\", line 238, in _save\nserialized_storages[key]._write_file(f, _is_real_file(f))\nRuntimeError: Unknown error -1\nI added some code in the source code to print the error and signal, then reproduced and got the bold lines.\nSeems like save operation happened right after validation finished, exit of worker subprocesses caused the SIGCHLD, then interrupted \"write\" system call.\nI already add some sleep time before save as a workaround, but should some retry mechanism been added into the save code or provide more specific error msg?\n\nPyTorch v0.4.0\nHow you installed PyTorch (conda, pip, source): pip\nBuild command you used (if compiling from source):\nOS: Ubuntu16.04\nPyTorch version: 0.4.0\nPython version: 3.5.2\nCUDA/cuDNN version: 9.0/7.1.2\nGPU models and configuration: P40/K40\nGCC version (if compiling from source):\nCMake version:\nVersions of any other relevant libraries:", "body": "I was trying below example\r\nhttps://github.com/pytorch/examples/tree/master/imagenet\r\nand made few changes in the code to get data and save checkpoints from/to cephfs.\r\n\r\ncommand and arguments:\r\npython main.py --data-dir=/mnt/data --output-dir=/mnt/output/ --epochs=1\r\n\r\nThere was a big chance that I got below error:\r\n**doWrite<int> rc: -1 err: 4 errstr: Interrupted system call\r\nSignal 17**\r\nTraceback (most recent call last):\r\n  File \"main.py\", line 375, in <module>\r\n    main()\r\n  File \"main.py\", line 223, in main\r\n    }, is_best)\r\n  File \"main.py\", line 326, in save_checkpoint\r\n    torch.save(state, filename)\r\n  File \"/usr/local/lib/python3.5/dist-packages/torch/serialization.py\", line 161, in save\r\n    return _with_file_like(f, \"wb\", lambda f: _save(obj, f, pickle_module, pickle_protocol))\r\n  File \"/usr/local/lib/python3.5/dist-packages/torch/serialization.py\", line 118, in _with_file_like\r\n    return body(f)\r\n  File \"/usr/local/lib/python3.5/dist-packages/torch/serialization.py\", line 161, in <lambda>\r\n    return _with_file_like(f, \"wb\", lambda f: _save(obj, f, pickle_module, pickle_protocol))\r\n  File \"/usr/local/lib/python3.5/dist-packages/torch/serialization.py\", line 238, in _save\r\n    serialized_storages[key]._write_file(f, _is_real_file(f))\r\nRuntimeError: Unknown error -1\r\n\r\nI added some code in the source code to print the error and signal, then reproduced and got the bold lines.\r\nSeems like save operation happened right after validation finished, exit of worker subprocesses caused the SIGCHLD, then interrupted \"write\" system call.\r\n\r\nI already add some sleep time before save as a workaround, but should some retry mechanism been added into the save code or provide more specific error msg?\r\n\r\n- PyTorch v0.4.0\r\n- How you installed PyTorch (conda, pip, source): pip\r\n- Build command you used (if compiling from source):\r\n- OS: Ubuntu16.04\r\n- PyTorch version: 0.4.0\r\n- Python version: 3.5.2\r\n- CUDA/cuDNN version: 9.0/7.1.2\r\n- GPU models and configuration: P40/K40\r\n- GCC version (if compiling from source):\r\n- CMake version:\r\n- Versions of any other relevant libraries:\r\n"}