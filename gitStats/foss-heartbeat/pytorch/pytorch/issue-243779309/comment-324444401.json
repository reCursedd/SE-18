{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/324444401", "html_url": "https://github.com/pytorch/pytorch/issues/2143#issuecomment-324444401", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/2143", "id": 324444401, "node_id": "MDEyOklzc3VlQ29tbWVudDMyNDQ0NDQwMQ==", "user": {"login": "iammarvelous", "id": 14206232, "node_id": "MDQ6VXNlcjE0MjA2MjMy", "avatar_url": "https://avatars0.githubusercontent.com/u/14206232?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iammarvelous", "html_url": "https://github.com/iammarvelous", "followers_url": "https://api.github.com/users/iammarvelous/followers", "following_url": "https://api.github.com/users/iammarvelous/following{/other_user}", "gists_url": "https://api.github.com/users/iammarvelous/gists{/gist_id}", "starred_url": "https://api.github.com/users/iammarvelous/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iammarvelous/subscriptions", "organizations_url": "https://api.github.com/users/iammarvelous/orgs", "repos_url": "https://api.github.com/users/iammarvelous/repos", "events_url": "https://api.github.com/users/iammarvelous/events{/privacy}", "received_events_url": "https://api.github.com/users/iammarvelous/received_events", "type": "User", "site_admin": false}, "created_at": "2017-08-23T19:54:22Z", "updated_at": "2017-08-23T19:54:22Z", "author_association": "NONE", "body_html": "<p>I found that in the 0.2.0 pytorch, you actually need to <code>import torch</code> first to avoid carsh.<br>\nSome packages that will leads to crash:</p>\n<pre><code>root@9ffc5c1ee745:~# python\nPython 2.7.12 (default, Nov 19 2016, 06:48:10) \n[GCC 5.4.0 20160609] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n&gt;&gt;&gt; import cv2\n&gt;&gt;&gt; import torch\n*** Error in `python': free(): invalid pointer: 0x00007f4edfe92b80 ***\n======= Backtrace: =========\n/lib/x86_64-linux-gnu/libc.so.6(+0x777e5)[0x7f4f0923a7e5]\n/lib/x86_64-linux-gnu/libc.so.6(+0x8037a)[0x7f4f0924337a]\n/lib/x86_64-linux-gnu/libc.so.6(cfree+0x4c)[0x7f4f0924753c]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale5_Impl16_M_install_facetEPKNS_2idEPKNS_5facetE+0x142)[0x7f4edfc2c802]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale5_ImplC2Em+0x1e3)[0x7f4edfc2e953]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale18_S_initialize_onceEv+0x15)[0x7f4edfc2f8c5]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0xea99)[0x7f4f0959ba99]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale13_S_initializeEv+0x21)[0x7f4edfc2f911]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6localeC1Ev+0x13)[0x7f4edfc2f953]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt8ios_base4InitC1Ev+0xb4)[0x7f4edfc011b4]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libcusparse-652fe42d.so.7.5.18(+0x2a5a14)[0x7f4ebc7dca14]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libcusparse-652fe42d.so.7.5.18(+0x2a6aa3)[0x7f4ebc7ddaa3]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libcusparse-652fe42d.so.7.5.18(+0x335026)[0x7f4ebc86c026]\n======= Memory map: ========\n00400000-006ea000 r-xp 00000000 00:30 74                                 /usr/bin/python2.7\n008e9000-008eb000 r--p 002e9000 00:30 74                                 /usr/bin/python2.7\n008eb000-00962000 rw-p 002eb000 00:30 74                                 /usr/bin/python2.7\n00962000-00985000 rw-p 00000000 00:00 0 \n02891000-02e63000 rw-p 00000000 00:00 0                                  [heap]\n7f4eb8000000-7f4eb8021000 rw-p 00000000 00:00 0 \n7f4eb8021000-7f4ebc000000 ---p 00000000 00:00 0 \n</code></pre>\n<pre><code>root@9ffc5c1ee745:~# python\nPython 2.7.12 (default, Nov 19 2016, 06:48:10) \n[GCC 5.4.0 20160609] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n&gt;&gt;&gt; import scipy.misc\n&gt;&gt;&gt; import torch\n*** Error in `python': free(): invalid pointer: 0x00007fd73de24b80 ***\n======= Backtrace: =========\n/lib/x86_64-linux-gnu/libc.so.6(+0x777e5)[0x7fd7559147e5]\n/lib/x86_64-linux-gnu/libc.so.6(+0x8037a)[0x7fd75591d37a]\n/lib/x86_64-linux-gnu/libc.so.6(cfree+0x4c)[0x7fd75592153c]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale5_Impl16_M_install_facetEPKNS_2idEPKNS_5facetE+0x142)[0x7fd73dbbe802]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale5_ImplC2Em+0x1e3)[0x7fd73dbc0953]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale18_S_initialize_onceEv+0x15)[0x7fd73dbc18c5]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0xea99)[0x7fd755c75a99]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale13_S_initializeEv+0x21)[0x7fd73dbc1911]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6localeC1Ev+0x13)[0x7fd73dbc1953]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt8ios_base4InitC1Ev+0xb4)[0x7fd73db931b4]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libcusparse-652fe42d.so.7.5.18(+0x2a5a14)[0x7fd71a76ea14]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libcusparse-652fe42d.so.7.5.18(+0x2a6aa3)[0x7fd71a76faa3]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libcusparse-652fe42d.so.7.5.18(+0x335026)[0x7fd71a7fe026]\n======= Memory map: ========\n00400000-006ea000 r-xp 00000000 00:30 74                                 /usr/bin/python2.7\n008e9000-008eb000 r--p 002e9000 00:30 74                                 /usr/bin/python2.7\n008eb000-00962000 rw-p 002eb000 00:30 74                                 /usr/bin/python2.7\n00962000-00985000 rw-p 00000000 00:00 0 \n01da7000-02623000 rw-p 00000000 00:00 0                                  [heap]\n7fd714000000-7fd714021000 rw-p 00000000 00:00 0 \n</code></pre>\n<p>Reversed import would fix this. But the problem is still annoying since for pytorch 0.12, pytorch won't crash if it is imported at last.</p>\n<p>Ubuntu 16.04.2 LTS, Python version 2.7.12, PyTorch version 0.2.0.post1 (cpu)</p>", "body_text": "I found that in the 0.2.0 pytorch, you actually need to import torch first to avoid carsh.\nSome packages that will leads to crash:\nroot@9ffc5c1ee745:~# python\nPython 2.7.12 (default, Nov 19 2016, 06:48:10) \n[GCC 5.4.0 20160609] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import cv2\n>>> import torch\n*** Error in `python': free(): invalid pointer: 0x00007f4edfe92b80 ***\n======= Backtrace: =========\n/lib/x86_64-linux-gnu/libc.so.6(+0x777e5)[0x7f4f0923a7e5]\n/lib/x86_64-linux-gnu/libc.so.6(+0x8037a)[0x7f4f0924337a]\n/lib/x86_64-linux-gnu/libc.so.6(cfree+0x4c)[0x7f4f0924753c]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale5_Impl16_M_install_facetEPKNS_2idEPKNS_5facetE+0x142)[0x7f4edfc2c802]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale5_ImplC2Em+0x1e3)[0x7f4edfc2e953]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale18_S_initialize_onceEv+0x15)[0x7f4edfc2f8c5]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0xea99)[0x7f4f0959ba99]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale13_S_initializeEv+0x21)[0x7f4edfc2f911]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6localeC1Ev+0x13)[0x7f4edfc2f953]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt8ios_base4InitC1Ev+0xb4)[0x7f4edfc011b4]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libcusparse-652fe42d.so.7.5.18(+0x2a5a14)[0x7f4ebc7dca14]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libcusparse-652fe42d.so.7.5.18(+0x2a6aa3)[0x7f4ebc7ddaa3]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libcusparse-652fe42d.so.7.5.18(+0x335026)[0x7f4ebc86c026]\n======= Memory map: ========\n00400000-006ea000 r-xp 00000000 00:30 74                                 /usr/bin/python2.7\n008e9000-008eb000 r--p 002e9000 00:30 74                                 /usr/bin/python2.7\n008eb000-00962000 rw-p 002eb000 00:30 74                                 /usr/bin/python2.7\n00962000-00985000 rw-p 00000000 00:00 0 \n02891000-02e63000 rw-p 00000000 00:00 0                                  [heap]\n7f4eb8000000-7f4eb8021000 rw-p 00000000 00:00 0 \n7f4eb8021000-7f4ebc000000 ---p 00000000 00:00 0 \n\nroot@9ffc5c1ee745:~# python\nPython 2.7.12 (default, Nov 19 2016, 06:48:10) \n[GCC 5.4.0 20160609] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import scipy.misc\n>>> import torch\n*** Error in `python': free(): invalid pointer: 0x00007fd73de24b80 ***\n======= Backtrace: =========\n/lib/x86_64-linux-gnu/libc.so.6(+0x777e5)[0x7fd7559147e5]\n/lib/x86_64-linux-gnu/libc.so.6(+0x8037a)[0x7fd75591d37a]\n/lib/x86_64-linux-gnu/libc.so.6(cfree+0x4c)[0x7fd75592153c]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale5_Impl16_M_install_facetEPKNS_2idEPKNS_5facetE+0x142)[0x7fd73dbbe802]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale5_ImplC2Em+0x1e3)[0x7fd73dbc0953]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale18_S_initialize_onceEv+0x15)[0x7fd73dbc18c5]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0xea99)[0x7fd755c75a99]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale13_S_initializeEv+0x21)[0x7fd73dbc1911]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6localeC1Ev+0x13)[0x7fd73dbc1953]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt8ios_base4InitC1Ev+0xb4)[0x7fd73db931b4]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libcusparse-652fe42d.so.7.5.18(+0x2a5a14)[0x7fd71a76ea14]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libcusparse-652fe42d.so.7.5.18(+0x2a6aa3)[0x7fd71a76faa3]\n/usr/local/lib/python2.7/dist-packages/torch/lib/libcusparse-652fe42d.so.7.5.18(+0x335026)[0x7fd71a7fe026]\n======= Memory map: ========\n00400000-006ea000 r-xp 00000000 00:30 74                                 /usr/bin/python2.7\n008e9000-008eb000 r--p 002e9000 00:30 74                                 /usr/bin/python2.7\n008eb000-00962000 rw-p 002eb000 00:30 74                                 /usr/bin/python2.7\n00962000-00985000 rw-p 00000000 00:00 0 \n01da7000-02623000 rw-p 00000000 00:00 0                                  [heap]\n7fd714000000-7fd714021000 rw-p 00000000 00:00 0 \n\nReversed import would fix this. But the problem is still annoying since for pytorch 0.12, pytorch won't crash if it is imported at last.\nUbuntu 16.04.2 LTS, Python version 2.7.12, PyTorch version 0.2.0.post1 (cpu)", "body": "I found that in the 0.2.0 pytorch, you actually need to `import torch` first to avoid carsh.\r\nSome packages that will leads to crash:\r\n```\r\nroot@9ffc5c1ee745:~# python\r\nPython 2.7.12 (default, Nov 19 2016, 06:48:10) \r\n[GCC 5.4.0 20160609] on linux2\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import cv2\r\n>>> import torch\r\n*** Error in `python': free(): invalid pointer: 0x00007f4edfe92b80 ***\r\n======= Backtrace: =========\r\n/lib/x86_64-linux-gnu/libc.so.6(+0x777e5)[0x7f4f0923a7e5]\r\n/lib/x86_64-linux-gnu/libc.so.6(+0x8037a)[0x7f4f0924337a]\r\n/lib/x86_64-linux-gnu/libc.so.6(cfree+0x4c)[0x7f4f0924753c]\r\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale5_Impl16_M_install_facetEPKNS_2idEPKNS_5facetE+0x142)[0x7f4edfc2c802]\r\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale5_ImplC2Em+0x1e3)[0x7f4edfc2e953]\r\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale18_S_initialize_onceEv+0x15)[0x7f4edfc2f8c5]\r\n/lib/x86_64-linux-gnu/libpthread.so.0(+0xea99)[0x7f4f0959ba99]\r\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale13_S_initializeEv+0x21)[0x7f4edfc2f911]\r\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6localeC1Ev+0x13)[0x7f4edfc2f953]\r\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt8ios_base4InitC1Ev+0xb4)[0x7f4edfc011b4]\r\n/usr/local/lib/python2.7/dist-packages/torch/lib/libcusparse-652fe42d.so.7.5.18(+0x2a5a14)[0x7f4ebc7dca14]\r\n/usr/local/lib/python2.7/dist-packages/torch/lib/libcusparse-652fe42d.so.7.5.18(+0x2a6aa3)[0x7f4ebc7ddaa3]\r\n/usr/local/lib/python2.7/dist-packages/torch/lib/libcusparse-652fe42d.so.7.5.18(+0x335026)[0x7f4ebc86c026]\r\n======= Memory map: ========\r\n00400000-006ea000 r-xp 00000000 00:30 74                                 /usr/bin/python2.7\r\n008e9000-008eb000 r--p 002e9000 00:30 74                                 /usr/bin/python2.7\r\n008eb000-00962000 rw-p 002eb000 00:30 74                                 /usr/bin/python2.7\r\n00962000-00985000 rw-p 00000000 00:00 0 \r\n02891000-02e63000 rw-p 00000000 00:00 0                                  [heap]\r\n7f4eb8000000-7f4eb8021000 rw-p 00000000 00:00 0 \r\n7f4eb8021000-7f4ebc000000 ---p 00000000 00:00 0 \r\n```\r\n```\r\nroot@9ffc5c1ee745:~# python\r\nPython 2.7.12 (default, Nov 19 2016, 06:48:10) \r\n[GCC 5.4.0 20160609] on linux2\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import scipy.misc\r\n>>> import torch\r\n*** Error in `python': free(): invalid pointer: 0x00007fd73de24b80 ***\r\n======= Backtrace: =========\r\n/lib/x86_64-linux-gnu/libc.so.6(+0x777e5)[0x7fd7559147e5]\r\n/lib/x86_64-linux-gnu/libc.so.6(+0x8037a)[0x7fd75591d37a]\r\n/lib/x86_64-linux-gnu/libc.so.6(cfree+0x4c)[0x7fd75592153c]\r\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale5_Impl16_M_install_facetEPKNS_2idEPKNS_5facetE+0x142)[0x7fd73dbbe802]\r\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale5_ImplC2Em+0x1e3)[0x7fd73dbc0953]\r\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale18_S_initialize_onceEv+0x15)[0x7fd73dbc18c5]\r\n/lib/x86_64-linux-gnu/libpthread.so.0(+0xea99)[0x7fd755c75a99]\r\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6locale13_S_initializeEv+0x21)[0x7fd73dbc1911]\r\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt6localeC1Ev+0x13)[0x7fd73dbc1953]\r\n/usr/local/lib/python2.7/dist-packages/torch/lib/libshm.so(_ZNSt8ios_base4InitC1Ev+0xb4)[0x7fd73db931b4]\r\n/usr/local/lib/python2.7/dist-packages/torch/lib/libcusparse-652fe42d.so.7.5.18(+0x2a5a14)[0x7fd71a76ea14]\r\n/usr/local/lib/python2.7/dist-packages/torch/lib/libcusparse-652fe42d.so.7.5.18(+0x2a6aa3)[0x7fd71a76faa3]\r\n/usr/local/lib/python2.7/dist-packages/torch/lib/libcusparse-652fe42d.so.7.5.18(+0x335026)[0x7fd71a7fe026]\r\n======= Memory map: ========\r\n00400000-006ea000 r-xp 00000000 00:30 74                                 /usr/bin/python2.7\r\n008e9000-008eb000 r--p 002e9000 00:30 74                                 /usr/bin/python2.7\r\n008eb000-00962000 rw-p 002eb000 00:30 74                                 /usr/bin/python2.7\r\n00962000-00985000 rw-p 00000000 00:00 0 \r\n01da7000-02623000 rw-p 00000000 00:00 0                                  [heap]\r\n7fd714000000-7fd714021000 rw-p 00000000 00:00 0 \r\n```\r\nReversed import would fix this. But the problem is still annoying since for pytorch 0.12, pytorch won't crash if it is imported at last.\r\n\r\nUbuntu 16.04.2 LTS, Python version 2.7.12, PyTorch version 0.2.0.post1 (cpu)"}