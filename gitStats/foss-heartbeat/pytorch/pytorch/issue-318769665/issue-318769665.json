{"url": "https://api.github.com/repos/pytorch/pytorch/issues/7083", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/7083/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/7083/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/7083/events", "html_url": "https://github.com/pytorch/pytorch/issues/7083", "id": 318769665, "node_id": "MDU6SXNzdWUzMTg3Njk2NjU=", "number": 7083, "title": "Pytorch build finds local mkl instead of conda version", "user": {"login": "meder411", "id": 6818607, "node_id": "MDQ6VXNlcjY4MTg2MDc=", "avatar_url": "https://avatars0.githubusercontent.com/u/6818607?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meder411", "html_url": "https://github.com/meder411", "followers_url": "https://api.github.com/users/meder411/followers", "following_url": "https://api.github.com/users/meder411/following{/other_user}", "gists_url": "https://api.github.com/users/meder411/gists{/gist_id}", "starred_url": "https://api.github.com/users/meder411/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meder411/subscriptions", "organizations_url": "https://api.github.com/users/meder411/orgs", "repos_url": "https://api.github.com/users/meder411/repos", "events_url": "https://api.github.com/users/meder411/events{/privacy}", "received_events_url": "https://api.github.com/users/meder411/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 443484050, "node_id": "MDU6TGFiZWw0NDM0ODQwNTA=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/medium%20priority", "name": "medium priority", "color": "fbca04", "default": false}], "state": "open", "locked": false, "assignee": {"login": "soumith", "id": 1310570, "node_id": "MDQ6VXNlcjEzMTA1NzA=", "avatar_url": "https://avatars0.githubusercontent.com/u/1310570?v=4", "gravatar_id": "", "url": "https://api.github.com/users/soumith", "html_url": "https://github.com/soumith", "followers_url": "https://api.github.com/users/soumith/followers", "following_url": "https://api.github.com/users/soumith/following{/other_user}", "gists_url": "https://api.github.com/users/soumith/gists{/gist_id}", "starred_url": "https://api.github.com/users/soumith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/soumith/subscriptions", "organizations_url": "https://api.github.com/users/soumith/orgs", "repos_url": "https://api.github.com/users/soumith/repos", "events_url": "https://api.github.com/users/soumith/events{/privacy}", "received_events_url": "https://api.github.com/users/soumith/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "soumith", "id": 1310570, "node_id": "MDQ6VXNlcjEzMTA1NzA=", "avatar_url": "https://avatars0.githubusercontent.com/u/1310570?v=4", "gravatar_id": "", "url": "https://api.github.com/users/soumith", "html_url": "https://github.com/soumith", "followers_url": "https://api.github.com/users/soumith/followers", "following_url": "https://api.github.com/users/soumith/following{/other_user}", "gists_url": "https://api.github.com/users/soumith/gists{/gist_id}", "starred_url": "https://api.github.com/users/soumith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/soumith/subscriptions", "organizations_url": "https://api.github.com/users/soumith/orgs", "repos_url": "https://api.github.com/users/soumith/repos", "events_url": "https://api.github.com/users/soumith/events{/privacy}", "received_events_url": "https://api.github.com/users/soumith/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 18, "created_at": "2018-04-30T01:47:33Z", "updated_at": "2018-10-29T23:56:37Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>I've followed the installation instructions for a Conda build on Linux:</p>\n<pre><code>export CMAKE_PREFIX_PATH=\"$(dirname $(which conda))/../\" # [anaconda root directory]\n\n# Install basic dependencies\nconda install numpy pyyaml mkl mkl-include setuptools cmake cffi typing\n\n# Add LAPACK support for the GPU\nconda install -c pytorch magma-cuda80 # or magma-cuda90 if CUDA 9\n\ngit clone --recursive https://github.com/pytorch/pytorch\ncd pytorch\n\npython setup.py install\n</code></pre>\n<p>but I get an import error for MKL:</p>\n<blockquote>\n<p>ImportError: /usr/local/lib/libmkl_gf_lp64.so: undefined symbol: mkl_lapack_ao_zgetrf</p>\n</blockquote>\n<p>when I try to import torch in Python.</p>\n<p>This seems to be because during the build it links to the /usr/local/lib version rather than the anaconda version. I've set the CMAKE_PREFIX_PATH env variable (as above) as well as set LD_LIBRARY_PATH to include the anaconda lib directory (<code>/usr/local/anaconda2/lib</code>). I've also added a conda.conf file to my <code>/etc/ld.so.conf.d/</code> directory and ran <code>sudo ldconfig</code> to source the changes.</p>\n<p>I tried setting the MKLROOT env variable as suggested in <a href=\"https://github.com/pytorch/pytorch/issues/6131\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/6131/hovercard\">this issue</a>, but that didn't work either. Additionally, I tried setting <code>MKLMLROOT=/usr/local/anaconda2</code> based on line 111 of <code>pytorch/cmake/Modules/FindMKL.cmake</code> where it looks like that's the env variable it looks for:</p>\n<pre><code>find_path(MKLML_ROOT include/mkl.h PATHS $ENV{MKLMLROOT} ${INTEL_ROOT}/mkl\n    DOC \"Folder contains MKLML\")\n</code></pre>\n<p>but that didn't work either.</p>\n<p>I'm not quite sure what else I can do to indicate to the install to find the libraries in anacadona.</p>\n<p>Is there a step I'm missing?</p>\n<ul>\n<li>PyTorch or Caffe2: PyTorch</li>\n<li>How you installed PyTorch (conda, pip, source): dependencies through conda, PyTorch from source</li>\n<li>Build command you used (if compiling from source): (above)</li>\n<li>OS: Ubuntu 16.04</li>\n<li>PyTorch version: source</li>\n<li>Python version: 2.7</li>\n<li>CUDA/cuDNN version: 9.0</li>\n<li>GPU models and configuration: Not relevant</li>\n<li>GCC version (if compiling from source): 5.4.0</li>\n<li>CMake version: 3.9.4</li>\n<li>Versions of any other relevant libraries: I ran <code>conda install mkl=2018</code> to make sure I had the most up to date</li>\n</ul>", "body_text": "I've followed the installation instructions for a Conda build on Linux:\nexport CMAKE_PREFIX_PATH=\"$(dirname $(which conda))/../\" # [anaconda root directory]\n\n# Install basic dependencies\nconda install numpy pyyaml mkl mkl-include setuptools cmake cffi typing\n\n# Add LAPACK support for the GPU\nconda install -c pytorch magma-cuda80 # or magma-cuda90 if CUDA 9\n\ngit clone --recursive https://github.com/pytorch/pytorch\ncd pytorch\n\npython setup.py install\n\nbut I get an import error for MKL:\n\nImportError: /usr/local/lib/libmkl_gf_lp64.so: undefined symbol: mkl_lapack_ao_zgetrf\n\nwhen I try to import torch in Python.\nThis seems to be because during the build it links to the /usr/local/lib version rather than the anaconda version. I've set the CMAKE_PREFIX_PATH env variable (as above) as well as set LD_LIBRARY_PATH to include the anaconda lib directory (/usr/local/anaconda2/lib). I've also added a conda.conf file to my /etc/ld.so.conf.d/ directory and ran sudo ldconfig to source the changes.\nI tried setting the MKLROOT env variable as suggested in this issue, but that didn't work either. Additionally, I tried setting MKLMLROOT=/usr/local/anaconda2 based on line 111 of pytorch/cmake/Modules/FindMKL.cmake where it looks like that's the env variable it looks for:\nfind_path(MKLML_ROOT include/mkl.h PATHS $ENV{MKLMLROOT} ${INTEL_ROOT}/mkl\n    DOC \"Folder contains MKLML\")\n\nbut that didn't work either.\nI'm not quite sure what else I can do to indicate to the install to find the libraries in anacadona.\nIs there a step I'm missing?\n\nPyTorch or Caffe2: PyTorch\nHow you installed PyTorch (conda, pip, source): dependencies through conda, PyTorch from source\nBuild command you used (if compiling from source): (above)\nOS: Ubuntu 16.04\nPyTorch version: source\nPython version: 2.7\nCUDA/cuDNN version: 9.0\nGPU models and configuration: Not relevant\nGCC version (if compiling from source): 5.4.0\nCMake version: 3.9.4\nVersions of any other relevant libraries: I ran conda install mkl=2018 to make sure I had the most up to date", "body": "I've followed the installation instructions for a Conda build on Linux:\r\n\r\n```\r\nexport CMAKE_PREFIX_PATH=\"$(dirname $(which conda))/../\" # [anaconda root directory]\r\n\r\n# Install basic dependencies\r\nconda install numpy pyyaml mkl mkl-include setuptools cmake cffi typing\r\n\r\n# Add LAPACK support for the GPU\r\nconda install -c pytorch magma-cuda80 # or magma-cuda90 if CUDA 9\r\n\r\ngit clone --recursive https://github.com/pytorch/pytorch\r\ncd pytorch\r\n\r\npython setup.py install\r\n```\r\n\r\nbut I get an import error for MKL:\r\n\r\n> ImportError: /usr/local/lib/libmkl_gf_lp64.so: undefined symbol: mkl_lapack_ao_zgetrf\r\n\r\nwhen I try to import torch in Python.\r\n\r\nThis seems to be because during the build it links to the /usr/local/lib version rather than the anaconda version. I've set the CMAKE_PREFIX_PATH env variable (as above) as well as set LD_LIBRARY_PATH to include the anaconda lib directory (`/usr/local/anaconda2/lib`). I've also added a conda.conf file to my `/etc/ld.so.conf.d/` directory and ran `sudo ldconfig` to source the changes.\r\n\r\nI tried setting the MKLROOT env variable as suggested in [this issue](https://github.com/pytorch/pytorch/issues/6131), but that didn't work either. Additionally, I tried setting `MKLMLROOT=/usr/local/anaconda2` based on line 111 of `pytorch/cmake/Modules/FindMKL.cmake` where it looks like that's the env variable it looks for:\r\n\r\n```\r\nfind_path(MKLML_ROOT include/mkl.h PATHS $ENV{MKLMLROOT} ${INTEL_ROOT}/mkl\r\n    DOC \"Folder contains MKLML\")\r\n```\r\nbut that didn't work either.\r\n\r\n\r\nI'm not quite sure what else I can do to indicate to the install to find the libraries in anacadona.\r\n\r\nIs there a step I'm missing?\r\n\r\n\r\n- PyTorch or Caffe2: PyTorch\r\n- How you installed PyTorch (conda, pip, source): dependencies through conda, PyTorch from source\r\n- Build command you used (if compiling from source): (above)\r\n- OS: Ubuntu 16.04\r\n- PyTorch version: source\r\n- Python version: 2.7\r\n- CUDA/cuDNN version: 9.0\r\n- GPU models and configuration: Not relevant\r\n- GCC version (if compiling from source): 5.4.0\r\n- CMake version: 3.9.4\r\n- Versions of any other relevant libraries: I ran `conda install mkl=2018` to make sure I had the most up to date\r\n"}