{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/216507430", "pull_request_review_id": 154004463, "id": 216507430, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNjUwNzQzMA==", "diff_hunk": "@@ -22,8 +22,11 @@ Tensor & TypeDefault::copy_(Tensor & self, const Tensor & src, bool non_blocking\n   return s_copy_(self, b_src, non_blocking);\n }\n \n-Tensor TypeDefault::copy(const Tensor & src, bool non_blocking) const {\n-  // TODO(psag): have a DeviceGuard here\n+Tensor TypeDefault::copy(const Tensor & src, bool non_blocking, optional<Device> to_device) const {\n+  DeviceGuard device_guard;\n+  if (to_device.has_value()) {\n+    device_guard.set_index(to_device.value().index());", "path": "aten/src/ATen/templates/TypeDefault.cpp", "position": 9, "original_position": 9, "commit_id": "ba2e7d1435b7b32b6c4e0fae1153e99aa5186df5", "original_commit_id": "ba2e7d1435b7b32b6c4e0fae1153e99aa5186df5", "user": {"login": "ezyang", "id": 13564, "node_id": "MDQ6VXNlcjEzNTY0", "avatar_url": "https://avatars0.githubusercontent.com/u/13564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ezyang", "html_url": "https://github.com/ezyang", "followers_url": "https://api.github.com/users/ezyang/followers", "following_url": "https://api.github.com/users/ezyang/following{/other_user}", "gists_url": "https://api.github.com/users/ezyang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ezyang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ezyang/subscriptions", "organizations_url": "https://api.github.com/users/ezyang/orgs", "repos_url": "https://api.github.com/users/ezyang/repos", "events_url": "https://api.github.com/users/ezyang/events{/privacy}", "received_events_url": "https://api.github.com/users/ezyang/received_events", "type": "User", "site_admin": false}, "body": "If you pass CPU device that somehow has index set to 1, you will then twiddle the current *CUDA* device to 1, even though there's no reason these should be related at all.\r\n\r\nBasically, there is something very smelly with the `DeviceGuard` interface. I don't think you should necessarily fix it this PR, but something has to be worked out...", "created_at": "2018-09-10T23:37:38Z", "updated_at": "2018-11-23T15:50:55Z", "html_url": "https://github.com/pytorch/pytorch/pull/11467#discussion_r216507430", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/11467", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/216507430"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/11467#discussion_r216507430"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/11467"}}, "body_html": "<p>If you pass CPU device that somehow has index set to 1, you will then twiddle the current <em>CUDA</em> device to 1, even though there's no reason these should be related at all.</p>\n<p>Basically, there is something very smelly with the <code>DeviceGuard</code> interface. I don't think you should necessarily fix it this PR, but something has to be worked out...</p>", "body_text": "If you pass CPU device that somehow has index set to 1, you will then twiddle the current CUDA device to 1, even though there's no reason these should be related at all.\nBasically, there is something very smelly with the DeviceGuard interface. I don't think you should necessarily fix it this PR, but something has to be worked out...", "in_reply_to_id": 216476964}