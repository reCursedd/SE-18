{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/185402967", "pull_request_review_id": 116781805, "id": 185402967, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NTQwMjk2Nw==", "diff_hunk": "@@ -371,19 +371,8 @@ def _shutdown_workers(self):\n                 self.done_event.set()\n                 for q in self.index_queues:\n                     q.put(None)\n-                # if some workers are waiting to put, make place for them\n-                try:\n-                    while not self.worker_result_queue.empty():\n-                        self.worker_result_queue.get()\n-                except (FileNotFoundError, ImportError):\n-                    # Many weird errors can happen here due to Python\n-                    # shutting down. These are more like obscure Python bugs.\n-                    # FileNotFoundError can happen when we rebuild the fd\n-                    # fetched from the queue but the socket is already closed\n-                    # from the worker side.\n-                    # ImportError can happen when the unpickler loads the\n-                    # resource from `get`.\n-                    pass\n+                # Workers can't be waiting to put because they each has only at\n+                # most 2 batches, which should be far below SimpleQueue's limit.", "path": "torch/utils/data/dataloader.py", "position": null, "original_position": 18, "commit_id": "61b82ad27c2bfe611c35b8672061a6a438920b48", "original_commit_id": "8592b7091073131a10a5e2386568f3c9b01d0ff8", "user": {"login": "SsnL", "id": 5674597, "node_id": "MDQ6VXNlcjU2NzQ1OTc=", "avatar_url": "https://avatars2.githubusercontent.com/u/5674597?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SsnL", "html_url": "https://github.com/SsnL", "followers_url": "https://api.github.com/users/SsnL/followers", "following_url": "https://api.github.com/users/SsnL/following{/other_user}", "gists_url": "https://api.github.com/users/SsnL/gists{/gist_id}", "starred_url": "https://api.github.com/users/SsnL/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SsnL/subscriptions", "organizations_url": "https://api.github.com/users/SsnL/orgs", "repos_url": "https://api.github.com/users/SsnL/repos", "events_url": "https://api.github.com/users/SsnL/events{/privacy}", "received_events_url": "https://api.github.com/users/SsnL/received_events", "type": "User", "site_admin": false}, "body": "No. The pipe has a certain size limit. Waiting to put means that the pipe already hit the limit but the work is still trying to put. But now each worker has its own queue, so the max number of batches in queue is 2, as long as each batch is less than half of the pipe capacity, it should be fine. Pipe capacity on mac & linux is typically 16KB or 64KB.", "created_at": "2018-05-02T06:27:27Z", "updated_at": "2018-11-23T15:43:30Z", "html_url": "https://github.com/pytorch/pytorch/pull/7140#discussion_r185402967", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/7140", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/185402967"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/7140#discussion_r185402967"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/7140"}}, "body_html": "<p>No. The pipe has a certain size limit. Waiting to put means that the pipe already hit the limit but the work is still trying to put. But now each worker has its own queue, so the max number of batches in queue is 2, as long as each batch is less than half of the pipe capacity, it should be fine. Pipe capacity on mac &amp; linux is typically 16KB or 64KB.</p>", "body_text": "No. The pipe has a certain size limit. Waiting to put means that the pipe already hit the limit but the work is still trying to put. But now each worker has its own queue, so the max number of batches in queue is 2, as long as each batch is less than half of the pipe capacity, it should be fine. Pipe capacity on mac & linux is typically 16KB or 64KB.", "in_reply_to_id": 185309955}