{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/5036", "id": 167000295, "node_id": "MDExOlB1bGxSZXF1ZXN0MTY3MDAwMjk1", "html_url": "https://github.com/pytorch/pytorch/pull/5036", "diff_url": "https://github.com/pytorch/pytorch/pull/5036.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/5036.patch", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/5036", "number": 5036, "state": "closed", "locked": false, "title": "Use blocks machinery to simplify bookkeeping in autodiff", "user": {"login": "zdevito", "id": 370202, "node_id": "MDQ6VXNlcjM3MDIwMg==", "avatar_url": "https://avatars0.githubusercontent.com/u/370202?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zdevito", "html_url": "https://github.com/zdevito", "followers_url": "https://api.github.com/users/zdevito/followers", "following_url": "https://api.github.com/users/zdevito/following{/other_user}", "gists_url": "https://api.github.com/users/zdevito/gists{/gist_id}", "starred_url": "https://api.github.com/users/zdevito/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zdevito/subscriptions", "organizations_url": "https://api.github.com/users/zdevito/orgs", "repos_url": "https://api.github.com/users/zdevito/repos", "events_url": "https://api.github.com/users/zdevito/events{/privacy}", "received_events_url": "https://api.github.com/users/zdevito/received_events", "type": "User", "site_admin": false}, "body": "Using @ezyang's suggestion, this change uses a block rather than\r\nstaging annotations to represent the reverse pass. This allows us to reuse the machinery to copy graphs/blocks to extract the reverse pass concisely, eliminating ~50 lines of code.\r\n\r\nThis also changes the input order of Gradients df to:\r\n   [output vjps][temporary vjps][captures]\r\n\r\nIn addition to being simpler to generate in this order, it also\r\nwill allow ExecutionPlan to append the captures onto the already-\r\nexisting input list of vjps that are given by the autograd,\r\nrather than have to prepend them, which should be slightly cheaper.\r\n\r\nThis also changes the Gradient struct to enforce that input\r\ncaptures appear before output captures in the capture list,\r\nwhich makes it easier to use in ExecutionPlan.", "created_at": "2018-02-04T08:24:54Z", "updated_at": "2018-11-23T15:39:07Z", "closed_at": "2018-02-05T15:43:50Z", "merged_at": "2018-02-05T15:43:50Z", "merge_commit_sha": "b044c95129ca32edee8a9de9e175290caf7343e0", "assignee": null, "assignees": [], "requested_reviewers": [], "requested_teams": [], "labels": [], "milestone": null, "commits_url": "https://api.github.com/repos/pytorch/pytorch/pulls/5036/commits", "review_comments_url": "https://api.github.com/repos/pytorch/pytorch/pulls/5036/comments", "review_comment_url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments{/number}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/5036/comments", "statuses_url": "https://api.github.com/repos/pytorch/pytorch/statuses/6f27a41a86b8da8934947f2ad37d0c8efff17d6d", "head": {"label": "zdevito:pr/use_blocks_autodiff", "ref": "pr/use_blocks_autodiff", "sha": "6f27a41a86b8da8934947f2ad37d0c8efff17d6d", "user": {"login": "zdevito", "id": 370202, "node_id": "MDQ6VXNlcjM3MDIwMg==", "avatar_url": "https://avatars0.githubusercontent.com/u/370202?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zdevito", "html_url": "https://github.com/zdevito", "followers_url": "https://api.github.com/users/zdevito/followers", "following_url": "https://api.github.com/users/zdevito/following{/other_user}", "gists_url": "https://api.github.com/users/zdevito/gists{/gist_id}", "starred_url": "https://api.github.com/users/zdevito/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zdevito/subscriptions", "organizations_url": "https://api.github.com/users/zdevito/orgs", "repos_url": "https://api.github.com/users/zdevito/repos", "events_url": "https://api.github.com/users/zdevito/events{/privacy}", "received_events_url": "https://api.github.com/users/zdevito/received_events", "type": "User", "site_admin": false}, "repo": {"id": 93195556, "node_id": "MDEwOlJlcG9zaXRvcnk5MzE5NTU1Ng==", "name": "pytorch", "full_name": "zdevito/pytorch", "private": false, "owner": {"login": "zdevito", "id": 370202, "node_id": "MDQ6VXNlcjM3MDIwMg==", "avatar_url": "https://avatars0.githubusercontent.com/u/370202?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zdevito", "html_url": "https://github.com/zdevito", "followers_url": "https://api.github.com/users/zdevito/followers", "following_url": "https://api.github.com/users/zdevito/following{/other_user}", "gists_url": "https://api.github.com/users/zdevito/gists{/gist_id}", "starred_url": "https://api.github.com/users/zdevito/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zdevito/subscriptions", "organizations_url": "https://api.github.com/users/zdevito/orgs", "repos_url": "https://api.github.com/users/zdevito/repos", "events_url": "https://api.github.com/users/zdevito/events{/privacy}", "received_events_url": "https://api.github.com/users/zdevito/received_events", "type": "User", "site_admin": false}, "html_url": "https://github.com/zdevito/pytorch", "description": "Tensors and Dynamic neural networks in Python  with strong GPU acceleration", "fork": true, "url": "https://api.github.com/repos/zdevito/pytorch", "forks_url": "https://api.github.com/repos/zdevito/pytorch/forks", "keys_url": "https://api.github.com/repos/zdevito/pytorch/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/zdevito/pytorch/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/zdevito/pytorch/teams", "hooks_url": "https://api.github.com/repos/zdevito/pytorch/hooks", "issue_events_url": "https://api.github.com/repos/zdevito/pytorch/issues/events{/number}", "events_url": "https://api.github.com/repos/zdevito/pytorch/events", "assignees_url": "https://api.github.com/repos/zdevito/pytorch/assignees{/user}", "branches_url": "https://api.github.com/repos/zdevito/pytorch/branches{/branch}", "tags_url": "https://api.github.com/repos/zdevito/pytorch/tags", "blobs_url": "https://api.github.com/repos/zdevito/pytorch/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/zdevito/pytorch/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/zdevito/pytorch/git/refs{/sha}", "trees_url": "https://api.github.com/repos/zdevito/pytorch/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/zdevito/pytorch/statuses/{sha}", "languages_url": "https://api.github.com/repos/zdevito/pytorch/languages", "stargazers_url": "https://api.github.com/repos/zdevito/pytorch/stargazers", "contributors_url": "https://api.github.com/repos/zdevito/pytorch/contributors", "subscribers_url": "https://api.github.com/repos/zdevito/pytorch/subscribers", "subscription_url": "https://api.github.com/repos/zdevito/pytorch/subscription", "commits_url": "https://api.github.com/repos/zdevito/pytorch/commits{/sha}", "git_commits_url": "https://api.github.com/repos/zdevito/pytorch/git/commits{/sha}", "comments_url": "https://api.github.com/repos/zdevito/pytorch/comments{/number}", "issue_comment_url": "https://api.github.com/repos/zdevito/pytorch/issues/comments{/number}", "contents_url": "https://api.github.com/repos/zdevito/pytorch/contents/{+path}", "compare_url": "https://api.github.com/repos/zdevito/pytorch/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/zdevito/pytorch/merges", "archive_url": "https://api.github.com/repos/zdevito/pytorch/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/zdevito/pytorch/downloads", "issues_url": "https://api.github.com/repos/zdevito/pytorch/issues{/number}", "pulls_url": "https://api.github.com/repos/zdevito/pytorch/pulls{/number}", "milestones_url": "https://api.github.com/repos/zdevito/pytorch/milestones{/number}", "notifications_url": "https://api.github.com/repos/zdevito/pytorch/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/zdevito/pytorch/labels{/name}", "releases_url": "https://api.github.com/repos/zdevito/pytorch/releases{/id}", "deployments_url": "https://api.github.com/repos/zdevito/pytorch/deployments", "created_at": "2017-06-02T19:00:07Z", "updated_at": "2018-11-13T19:07:38Z", "pushed_at": "2018-11-20T02:26:06Z", "git_url": "git://github.com/zdevito/pytorch.git", "ssh_url": "git@github.com:zdevito/pytorch.git", "clone_url": "https://github.com/zdevito/pytorch.git", "svn_url": "https://github.com/zdevito/pytorch", "homepage": "http://pytorch.org", "size": 87173, "stargazers_count": 0, "watchers_count": 0, "language": "C++", "has_issues": true, "has_projects": true, "has_downloads": true, "has_wiki": true, "has_pages": false, "forks_count": 0, "mirror_url": null, "archived": false, "open_issues_count": 7, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "forks": 0, "open_issues": 7, "watchers": 0, "default_branch": "master"}}, "base": {"label": "pytorch:master", "ref": "master", "sha": "9c7ac8505083a2aa32bb0ae930776aeef2d42f85", "user": {"login": "pytorch", "id": 21003710, "node_id": "MDEyOk9yZ2FuaXphdGlvbjIxMDAzNzEw", "avatar_url": "https://avatars3.githubusercontent.com/u/21003710?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pytorch", "html_url": "https://github.com/pytorch", "followers_url": "https://api.github.com/users/pytorch/followers", "following_url": "https://api.github.com/users/pytorch/following{/other_user}", "gists_url": "https://api.github.com/users/pytorch/gists{/gist_id}", "starred_url": "https://api.github.com/users/pytorch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pytorch/subscriptions", "organizations_url": "https://api.github.com/users/pytorch/orgs", "repos_url": "https://api.github.com/users/pytorch/repos", "events_url": "https://api.github.com/users/pytorch/events{/privacy}", "received_events_url": "https://api.github.com/users/pytorch/received_events", "type": "Organization", "site_admin": false}, "repo": {"id": 65600975, "node_id": "MDEwOlJlcG9zaXRvcnk2NTYwMDk3NQ==", "name": "pytorch", "full_name": "pytorch/pytorch", "private": false, "owner": {"login": "pytorch", "id": 21003710, "node_id": "MDEyOk9yZ2FuaXphdGlvbjIxMDAzNzEw", "avatar_url": "https://avatars3.githubusercontent.com/u/21003710?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pytorch", "html_url": "https://github.com/pytorch", "followers_url": "https://api.github.com/users/pytorch/followers", "following_url": "https://api.github.com/users/pytorch/following{/other_user}", "gists_url": "https://api.github.com/users/pytorch/gists{/gist_id}", "starred_url": "https://api.github.com/users/pytorch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pytorch/subscriptions", "organizations_url": "https://api.github.com/users/pytorch/orgs", "repos_url": "https://api.github.com/users/pytorch/repos", "events_url": "https://api.github.com/users/pytorch/events{/privacy}", "received_events_url": "https://api.github.com/users/pytorch/received_events", "type": "Organization", "site_admin": false}, "html_url": "https://github.com/pytorch/pytorch", "description": "Tensors and Dynamic neural networks in Python  with strong GPU acceleration", "fork": false, "url": "https://api.github.com/repos/pytorch/pytorch", "forks_url": "https://api.github.com/repos/pytorch/pytorch/forks", "keys_url": "https://api.github.com/repos/pytorch/pytorch/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/pytorch/pytorch/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/pytorch/pytorch/teams", "hooks_url": "https://api.github.com/repos/pytorch/pytorch/hooks", "issue_events_url": "https://api.github.com/repos/pytorch/pytorch/issues/events{/number}", "events_url": "https://api.github.com/repos/pytorch/pytorch/events", "assignees_url": "https://api.github.com/repos/pytorch/pytorch/assignees{/user}", "branches_url": "https://api.github.com/repos/pytorch/pytorch/branches{/branch}", "tags_url": "https://api.github.com/repos/pytorch/pytorch/tags", "blobs_url": "https://api.github.com/repos/pytorch/pytorch/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/pytorch/pytorch/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/pytorch/pytorch/git/refs{/sha}", "trees_url": "https://api.github.com/repos/pytorch/pytorch/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/pytorch/pytorch/statuses/{sha}", "languages_url": "https://api.github.com/repos/pytorch/pytorch/languages", "stargazers_url": "https://api.github.com/repos/pytorch/pytorch/stargazers", "contributors_url": "https://api.github.com/repos/pytorch/pytorch/contributors", "subscribers_url": "https://api.github.com/repos/pytorch/pytorch/subscribers", "subscription_url": "https://api.github.com/repos/pytorch/pytorch/subscription", "commits_url": "https://api.github.com/repos/pytorch/pytorch/commits{/sha}", "git_commits_url": "https://api.github.com/repos/pytorch/pytorch/git/commits{/sha}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/comments{/number}", "issue_comment_url": "https://api.github.com/repos/pytorch/pytorch/issues/comments{/number}", "contents_url": "https://api.github.com/repos/pytorch/pytorch/contents/{+path}", "compare_url": "https://api.github.com/repos/pytorch/pytorch/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/pytorch/pytorch/merges", "archive_url": "https://api.github.com/repos/pytorch/pytorch/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/pytorch/pytorch/downloads", "issues_url": "https://api.github.com/repos/pytorch/pytorch/issues{/number}", "pulls_url": "https://api.github.com/repos/pytorch/pytorch/pulls{/number}", "milestones_url": "https://api.github.com/repos/pytorch/pytorch/milestones{/number}", "notifications_url": "https://api.github.com/repos/pytorch/pytorch/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/pytorch/pytorch/labels{/name}", "releases_url": "https://api.github.com/repos/pytorch/pytorch/releases{/id}", "deployments_url": "https://api.github.com/repos/pytorch/pytorch/deployments", "created_at": "2016-08-13T05:26:41Z", "updated_at": "2018-11-24T14:27:35Z", "pushed_at": "2018-11-24T12:42:01Z", "git_url": "git://github.com/pytorch/pytorch.git", "ssh_url": "git@github.com:pytorch/pytorch.git", "clone_url": "https://github.com/pytorch/pytorch.git", "svn_url": "https://github.com/pytorch/pytorch", "homepage": "http://pytorch.org", "size": 89656, "stargazers_count": 21591, "watchers_count": 21591, "language": "C++", "has_issues": true, "has_projects": true, "has_downloads": true, "has_wiki": true, "has_pages": false, "forks_count": 5154, "mirror_url": null, "archived": false, "open_issues_count": 2196, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "forks": 5154, "open_issues": 2196, "watchers": 21591, "default_branch": "master"}}, "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/5036"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/5036"}, "issue": {"href": "https://api.github.com/repos/pytorch/pytorch/issues/5036"}, "comments": {"href": "https://api.github.com/repos/pytorch/pytorch/issues/5036/comments"}, "review_comments": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/5036/comments"}, "review_comment": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments{/number}"}, "commits": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/5036/commits"}, "statuses": {"href": "https://api.github.com/repos/pytorch/pytorch/statuses/6f27a41a86b8da8934947f2ad37d0c8efff17d6d"}}, "author_association": "CONTRIBUTOR", "body_html": "<p>Using <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=13564\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ezyang\">@ezyang</a>'s suggestion, this change uses a block rather than<br>\nstaging annotations to represent the reverse pass. This allows us to reuse the machinery to copy graphs/blocks to extract the reverse pass concisely, eliminating ~50 lines of code.</p>\n<p>This also changes the input order of Gradients df to:<br>\n[output vjps][temporary vjps][captures]</p>\n<p>In addition to being simpler to generate in this order, it also<br>\nwill allow ExecutionPlan to append the captures onto the already-<br>\nexisting input list of vjps that are given by the autograd,<br>\nrather than have to prepend them, which should be slightly cheaper.</p>\n<p>This also changes the Gradient struct to enforce that input<br>\ncaptures appear before output captures in the capture list,<br>\nwhich makes it easier to use in ExecutionPlan.</p>", "body_text": "Using @ezyang's suggestion, this change uses a block rather than\nstaging annotations to represent the reverse pass. This allows us to reuse the machinery to copy graphs/blocks to extract the reverse pass concisely, eliminating ~50 lines of code.\nThis also changes the input order of Gradients df to:\n[output vjps][temporary vjps][captures]\nIn addition to being simpler to generate in this order, it also\nwill allow ExecutionPlan to append the captures onto the already-\nexisting input list of vjps that are given by the autograd,\nrather than have to prepend them, which should be slightly cheaper.\nThis also changes the Gradient struct to enforce that input\ncaptures appear before output captures in the capture list,\nwhich makes it easier to use in ExecutionPlan.", "merged": true, "mergeable": null, "rebaseable": null, "mergeable_state": "unknown", "merged_by": {"login": "ezyang", "id": 13564, "node_id": "MDQ6VXNlcjEzNTY0", "avatar_url": "https://avatars0.githubusercontent.com/u/13564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ezyang", "html_url": "https://github.com/ezyang", "followers_url": "https://api.github.com/users/ezyang/followers", "following_url": "https://api.github.com/users/ezyang/following{/other_user}", "gists_url": "https://api.github.com/users/ezyang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ezyang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ezyang/subscriptions", "organizations_url": "https://api.github.com/users/ezyang/orgs", "repos_url": "https://api.github.com/users/ezyang/repos", "events_url": "https://api.github.com/users/ezyang/events{/privacy}", "received_events_url": "https://api.github.com/users/ezyang/received_events", "type": "User", "site_admin": false}, "comments": 2, "review_comments": 3, "maintainer_can_modify": false, "commits": 3, "additions": 153, "deletions": 211, "changed_files": 7}