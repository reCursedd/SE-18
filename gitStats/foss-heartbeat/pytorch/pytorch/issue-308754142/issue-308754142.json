{"url": "https://api.github.com/repos/pytorch/pytorch/issues/6027", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/6027/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/6027/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/6027/events", "html_url": "https://github.com/pytorch/pytorch/pull/6027", "id": 308754142, "node_id": "MDExOlB1bGxSZXF1ZXN0MTc3NTgyMzkw", "number": 6027, "title": "Use THC cached CUDA device property in certain torch.cuda.* methods", "user": {"login": "SsnL", "id": 5674597, "node_id": "MDQ6VXNlcjU2NzQ1OTc=", "avatar_url": "https://avatars2.githubusercontent.com/u/5674597?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SsnL", "html_url": "https://github.com/SsnL", "followers_url": "https://api.github.com/users/SsnL/followers", "following_url": "https://api.github.com/users/SsnL/following{/other_user}", "gists_url": "https://api.github.com/users/SsnL/gists{/gist_id}", "starred_url": "https://api.github.com/users/SsnL/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SsnL/subscriptions", "organizations_url": "https://api.github.com/users/SsnL/orgs", "repos_url": "https://api.github.com/users/SsnL/repos", "events_url": "https://api.github.com/users/SsnL/events{/privacy}", "received_events_url": "https://api.github.com/users/SsnL/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-03-26T22:13:48Z", "updated_at": "2018-03-30T20:40:19Z", "closed_at": "2018-03-30T20:39:23Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/6027", "html_url": "https://github.com/pytorch/pytorch/pull/6027", "diff_url": "https://github.com/pytorch/pytorch/pull/6027.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/6027.patch"}, "body_html": "<p>Getting CUDA device property struct with <code>cudaGetDeviceProperties</code> is expensive. THC caches CUDA device property, which is available via <code>THCState_getDeviceProperties</code>, which is available via <code>at::globalContext().getDeviceProperties(device)</code>, which is available via <code>torch.cuda.get_device_properties</code>. This PR changes the two methods that previously calls <code>cudaGetDeviceProperties</code> to directly using <code>torch.cuda.get_device_properties</code> in Python.</p>\n<p>Also fixes ATen compile error when it can't find CUDA.</p>\n<p><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #4908.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"292491892\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/4908\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/4908/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/4908\">#4908</a>. Using the script from that issue, we get roughly 18x speed-up.</p>\n<pre><code>[ssnl@ ~] python dev.py  # master\n0.2826697587966919\n0.00034999847412109375\n0.0003493785858154297\n0.000356292724609375\n0.00036025047302246094\n0.0003629922866821289\n0.00036084651947021484\n0.00035686492919921874\n0.00036056041717529296\n0.0003606319427490234\n[ssnl@ ~] python dev.py  # this PR\n0.27275662422180175\n2.1147727966308594e-05\n1.9598007202148438e-05\n1.94549560546875e-05\n1.9359588623046876e-05\n1.938343048095703e-05\n2.0074844360351563e-05\n1.952648162841797e-05\n1.9311904907226562e-05\n1.938343048095703e-05\n</code></pre>", "body_text": "Getting CUDA device property struct with cudaGetDeviceProperties is expensive. THC caches CUDA device property, which is available via THCState_getDeviceProperties, which is available via at::globalContext().getDeviceProperties(device), which is available via torch.cuda.get_device_properties. This PR changes the two methods that previously calls cudaGetDeviceProperties to directly using torch.cuda.get_device_properties in Python.\nAlso fixes ATen compile error when it can't find CUDA.\nFixes #4908. Using the script from that issue, we get roughly 18x speed-up.\n[ssnl@ ~] python dev.py  # master\n0.2826697587966919\n0.00034999847412109375\n0.0003493785858154297\n0.000356292724609375\n0.00036025047302246094\n0.0003629922866821289\n0.00036084651947021484\n0.00035686492919921874\n0.00036056041717529296\n0.0003606319427490234\n[ssnl@ ~] python dev.py  # this PR\n0.27275662422180175\n2.1147727966308594e-05\n1.9598007202148438e-05\n1.94549560546875e-05\n1.9359588623046876e-05\n1.938343048095703e-05\n2.0074844360351563e-05\n1.952648162841797e-05\n1.9311904907226562e-05\n1.938343048095703e-05", "body": "Getting CUDA device property struct with `cudaGetDeviceProperties` is expensive. THC caches CUDA device property, which is available via `THCState_getDeviceProperties`, which is available via `at::globalContext().getDeviceProperties(device)`, which is available via `torch.cuda.get_device_properties`. This PR changes the two methods that previously calls `cudaGetDeviceProperties` to directly using `torch.cuda.get_device_properties` in Python.\r\n\r\nAlso fixes ATen compile error when it can't find CUDA.\r\n\r\nFixes https://github.com/pytorch/pytorch/issues/4908. Using the script from that issue, we get roughly 18x speed-up.\r\n```\r\n[ssnl@ ~] python dev.py  # master\r\n0.2826697587966919\r\n0.00034999847412109375\r\n0.0003493785858154297\r\n0.000356292724609375\r\n0.00036025047302246094\r\n0.0003629922866821289\r\n0.00036084651947021484\r\n0.00035686492919921874\r\n0.00036056041717529296\r\n0.0003606319427490234\r\n[ssnl@ ~] python dev.py  # this PR\r\n0.27275662422180175\r\n2.1147727966308594e-05\r\n1.9598007202148438e-05\r\n1.94549560546875e-05\r\n1.9359588623046876e-05\r\n1.938343048095703e-05\r\n2.0074844360351563e-05\r\n1.952648162841797e-05\r\n1.9311904907226562e-05\r\n1.938343048095703e-05\r\n```"}