{"url": "https://api.github.com/repos/pytorch/pytorch/issues/5452", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/5452/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/5452/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/5452/events", "html_url": "https://github.com/pytorch/pytorch/issues/5452", "id": 300895199, "node_id": "MDU6SXNzdWUzMDA4OTUxOTk=", "number": 5452, "title": "Strange behavior in nn.NLLLoss2d() function", "user": {"login": "Mabinogiysk", "id": 12441989, "node_id": "MDQ6VXNlcjEyNDQxOTg5", "avatar_url": "https://avatars1.githubusercontent.com/u/12441989?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mabinogiysk", "html_url": "https://github.com/Mabinogiysk", "followers_url": "https://api.github.com/users/Mabinogiysk/followers", "following_url": "https://api.github.com/users/Mabinogiysk/following{/other_user}", "gists_url": "https://api.github.com/users/Mabinogiysk/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mabinogiysk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mabinogiysk/subscriptions", "organizations_url": "https://api.github.com/users/Mabinogiysk/orgs", "repos_url": "https://api.github.com/users/Mabinogiysk/repos", "events_url": "https://api.github.com/users/Mabinogiysk/events{/privacy}", "received_events_url": "https://api.github.com/users/Mabinogiysk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 443483881, "node_id": "MDU6TGFiZWw0NDM0ODM4ODE=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/todo", "name": "todo", "color": "c2e0c6", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "zou3519", "id": 5652049, "node_id": "MDQ6VXNlcjU2NTIwNDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/5652049?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zou3519", "html_url": "https://github.com/zou3519", "followers_url": "https://api.github.com/users/zou3519/followers", "following_url": "https://api.github.com/users/zou3519/following{/other_user}", "gists_url": "https://api.github.com/users/zou3519/gists{/gist_id}", "starred_url": "https://api.github.com/users/zou3519/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zou3519/subscriptions", "organizations_url": "https://api.github.com/users/zou3519/orgs", "repos_url": "https://api.github.com/users/zou3519/repos", "events_url": "https://api.github.com/users/zou3519/events{/privacy}", "received_events_url": "https://api.github.com/users/zou3519/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "zou3519", "id": 5652049, "node_id": "MDQ6VXNlcjU2NTIwNDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/5652049?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zou3519", "html_url": "https://github.com/zou3519", "followers_url": "https://api.github.com/users/zou3519/followers", "following_url": "https://api.github.com/users/zou3519/following{/other_user}", "gists_url": "https://api.github.com/users/zou3519/gists{/gist_id}", "starred_url": "https://api.github.com/users/zou3519/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zou3519/subscriptions", "organizations_url": "https://api.github.com/users/zou3519/orgs", "repos_url": "https://api.github.com/users/zou3519/repos", "events_url": "https://api.github.com/users/zou3519/events{/privacy}", "received_events_url": "https://api.github.com/users/zou3519/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 9, "created_at": "2018-02-28T05:20:21Z", "updated_at": "2018-08-28T20:11:42Z", "closed_at": "2018-08-28T20:11:42Z", "author_association": "NONE", "body_html": "<ul>\n<li>OS: win10</li>\n<li>PyTorch version: 0.3.0</li>\n<li>How you installed PyTorch (conda, pip, source): source</li>\n<li>Python version: 3.6</li>\n<li>CUDA/cuDNN version: 8.0</li>\n<li>GPU models and configuration: GTX1080</li>\n<li>GCC version (if compiling from source): VS2015</li>\n</ul>\n<p>I am doing some image classification and I have  a model which uses nn.NLLLoss2d as loss function.<br>\nThe size of images are 1024*512.<br>\n<strong>I can run this model</strong> on GPU when I use this kind of image. But when I resize images to 512*256, the model will fail in some images.<br>\nI have located the problem in nn.NLLLoss2d() function. The function can return loss without problems, but when I try to access the loss, such as loss.data[0] or loss.backward(), the program will break down:</p>\n<blockquote>\n<p>RuntimeError: cuda runtime error (77) : an illegal memory access was encountered at d:\\pytorch\\pytorch\\torch\\lib\\thc\\generic/THCStorage.cu:58</p>\n</blockquote>\n<p>And when I move the whole model to cpu and use images of 1024*512, the model also fails in some images:</p>\n<blockquote>\n<p>RuntimeError: Assertion `cur_target &gt;= 0 &amp;&amp; cur_target &lt; n_classes' failed.  at d:\\pytorch\\pytorch\\torch\\lib\\thnn\\generic/SpatialClassNLLCriterion.c:111</p>\n</blockquote>\n<p>The size of input tensor and target are [1, 9, 512, 1024] and [1, 512, 1024] and I am pretty sure that the value of target is 0&lt;=value&lt;9.<br>\nI tried it on my macbook pro and I have the same problem.</p>", "body_text": "OS: win10\nPyTorch version: 0.3.0\nHow you installed PyTorch (conda, pip, source): source\nPython version: 3.6\nCUDA/cuDNN version: 8.0\nGPU models and configuration: GTX1080\nGCC version (if compiling from source): VS2015\n\nI am doing some image classification and I have  a model which uses nn.NLLLoss2d as loss function.\nThe size of images are 1024*512.\nI can run this model on GPU when I use this kind of image. But when I resize images to 512*256, the model will fail in some images.\nI have located the problem in nn.NLLLoss2d() function. The function can return loss without problems, but when I try to access the loss, such as loss.data[0] or loss.backward(), the program will break down:\n\nRuntimeError: cuda runtime error (77) : an illegal memory access was encountered at d:\\pytorch\\pytorch\\torch\\lib\\thc\\generic/THCStorage.cu:58\n\nAnd when I move the whole model to cpu and use images of 1024*512, the model also fails in some images:\n\nRuntimeError: Assertion `cur_target >= 0 && cur_target < n_classes' failed.  at d:\\pytorch\\pytorch\\torch\\lib\\thnn\\generic/SpatialClassNLLCriterion.c:111\n\nThe size of input tensor and target are [1, 9, 512, 1024] and [1, 512, 1024] and I am pretty sure that the value of target is 0<=value<9.\nI tried it on my macbook pro and I have the same problem.", "body": "- OS: win10\r\n- PyTorch version: 0.3.0\r\n- How you installed PyTorch (conda, pip, source): source\r\n- Python version: 3.6\r\n- CUDA/cuDNN version: 8.0\r\n- GPU models and configuration: GTX1080\r\n- GCC version (if compiling from source): VS2015\r\n\r\nI am doing some image classification and I have  a model which uses nn.NLLLoss2d as loss function.\r\nThe size of images are 1024\\*512.  \r\n**I can run this model** on GPU when I use this kind of image. But when I resize images to 512\\*256, the model will fail in some images.\r\nI have located the problem in nn.NLLLoss2d() function. The function can return loss without problems, but when I try to access the loss, such as loss.data[0] or loss.backward(), the program will break down:\r\n\r\n> RuntimeError: cuda runtime error (77) : an illegal memory access was encountered at d:\\pytorch\\pytorch\\torch\\lib\\thc\\generic/THCStorage.cu:58\r\n\r\nAnd when I move the whole model to cpu and use images of 1024\\*512, the model also fails in some images:\r\n\r\n> RuntimeError: Assertion `cur_target >= 0 && cur_target < n_classes' failed.  at d:\\pytorch\\pytorch\\torch\\lib\\thnn\\generic/SpatialClassNLLCriterion.c:111\r\n\r\nThe size of input tensor and target are [1, 9, 512, 1024] and [1, 512, 1024] and I am pretty sure that the value of target is 0<=value<9.\r\nI tried it on my macbook pro and I have the same problem.\r\n"}