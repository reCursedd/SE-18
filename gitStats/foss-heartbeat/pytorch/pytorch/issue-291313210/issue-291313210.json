{"url": "https://api.github.com/repos/pytorch/pytorch/issues/4835", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/4835/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/4835/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/4835/events", "html_url": "https://github.com/pytorch/pytorch/issues/4835", "id": 291313210, "node_id": "MDU6SXNzdWUyOTEzMTMyMTA=", "number": 4835, "title": "MaxPool3d raises 'RuntimeError: Can only downcast contiguous tensors' After deconvolution and permute(.contiguous() applied)", "user": {"login": "lordwarlock", "id": 9794409, "node_id": "MDQ6VXNlcjk3OTQ0MDk=", "avatar_url": "https://avatars0.githubusercontent.com/u/9794409?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lordwarlock", "html_url": "https://github.com/lordwarlock", "followers_url": "https://api.github.com/users/lordwarlock/followers", "following_url": "https://api.github.com/users/lordwarlock/following{/other_user}", "gists_url": "https://api.github.com/users/lordwarlock/gists{/gist_id}", "starred_url": "https://api.github.com/users/lordwarlock/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lordwarlock/subscriptions", "organizations_url": "https://api.github.com/users/lordwarlock/orgs", "repos_url": "https://api.github.com/users/lordwarlock/repos", "events_url": "https://api.github.com/users/lordwarlock/events{/privacy}", "received_events_url": "https://api.github.com/users/lordwarlock/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-01-24T18:29:49Z", "updated_at": "2018-02-06T02:14:26Z", "closed_at": "2018-02-06T02:14:26Z", "author_association": "NONE", "body_html": "<p>Run the following code will raise \"RuntimeError: Can only downcast contiguous tensors\"<br>\nonly happens in cuda mode, works for conv2d, works for cpu mod.<br>\nTested on 0.2.0 and 0.3.0<br>\nPython 2.7,<br>\nLinux version 3.10.0-693.2.1.el7.x86_64 (<a href=\"mailto:mockbuild@x86-030.build.eng.bos.redhat.com\">mockbuild@x86-030.build.eng.bos.redhat.com</a>) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC) )</p>\n<pre><code>import torch\nimport torch.nn as nn\nimport torch.nn.functional as F\nimport torch.optim as optim\nfrom torch.autograd import Variable\nimport numpy as np\ncorr = Variable(torch.FloatTensor(np.ones((128,5,7,7))))\nf = Variable(torch.FloatTensor(np.ones((8,5,3,3))))\nout = F.conv2d(corr,f)\nprint('conv',out.size())\nout = out.view((128,8,1,5,5)).permute(0,2,1,3,4).contiguous()\nx,i = F.max_pool3d(out,(8,1,1),stride=(8,1,1),return_indices=True)\nprint('conv out',out.size())\ncorr = Variable(torch.FloatTensor(np.ones((128,5,3,3)))).cuda()\nf = Variable(torch.FloatTensor(np.ones((5,8,3,3)))).cuda()\nout = F.conv_transpose2d(corr,f)\nprint('deconv',out.size())\nout = out.view((128,8,1,5,5)).permute(0,2,1,3,4).contiguous()\nx,i = F.max_pool3d(out,(8,1,1),stride=(8,1,1),return_indices=True)\nprint('deconv out',out.size())\n</code></pre>\n<p>0.2</p>\n<blockquote>\n<p>Traceback (most recent call last):<br>\nFile \"cont_test.py\", line 26, in <br>\nx,i = F.max_pool3d(out,(8,1,1),stride=(8,1,1),return_indices=True)<br>\nFile \"/usr/lib64/python2.7/site-packages/torch/nn/functional.py\", line 293, in max_pool3d<br>\nceil_mode)<br>\nFile \"/usr/lib64/python2.7/site-packages/torch/nn/_functions/thnn/pooling.py\", line 163, in forward<br>\nctx.ceil_mode)<br>\nRuntimeError: Can only downcast contiguous tensors at /pytorch/torch/lib/tmp_install/include/THC/THCDeviceTensor-inl.cuh:295</p>\n</blockquote>\n<p>0.3</p>\n<blockquote>\n<p>*** Error in `python': free(): invalid pointer: 0x00007f871fc575a0 ***<br>\n======= Backtrace: =========<br>\n/lib64/libc.so.6(+0x7c619)[0x7f8756d04619]<br>\n/home/zhihaozh/torch_proj/polar/repo/polar_net/lib/python2.7/site-packages/torch/_thnn/_THCUNN.so(+0xca1f2)[0x7f866431e1f2]<br>\n/lib64/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6df0)[0x7f8757a54bb0]<br>\n/lib64/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7ed)[0x7f8757a56efd]<br>\n/lib64/libpython2.7.so.1.0(+0x70858)[0x7f87579e0858]<br>\n/lib64/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f87579bb9a3]<br>\n/lib64/libpython2.7.so.1.0(PyEval_CallObjectWithKeywords+0x47)[0x7f8757a4d7b7]</p>\n</blockquote>", "body_text": "Run the following code will raise \"RuntimeError: Can only downcast contiguous tensors\"\nonly happens in cuda mode, works for conv2d, works for cpu mod.\nTested on 0.2.0 and 0.3.0\nPython 2.7,\nLinux version 3.10.0-693.2.1.el7.x86_64 (mockbuild@x86-030.build.eng.bos.redhat.com) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC) )\nimport torch\nimport torch.nn as nn\nimport torch.nn.functional as F\nimport torch.optim as optim\nfrom torch.autograd import Variable\nimport numpy as np\ncorr = Variable(torch.FloatTensor(np.ones((128,5,7,7))))\nf = Variable(torch.FloatTensor(np.ones((8,5,3,3))))\nout = F.conv2d(corr,f)\nprint('conv',out.size())\nout = out.view((128,8,1,5,5)).permute(0,2,1,3,4).contiguous()\nx,i = F.max_pool3d(out,(8,1,1),stride=(8,1,1),return_indices=True)\nprint('conv out',out.size())\ncorr = Variable(torch.FloatTensor(np.ones((128,5,3,3)))).cuda()\nf = Variable(torch.FloatTensor(np.ones((5,8,3,3)))).cuda()\nout = F.conv_transpose2d(corr,f)\nprint('deconv',out.size())\nout = out.view((128,8,1,5,5)).permute(0,2,1,3,4).contiguous()\nx,i = F.max_pool3d(out,(8,1,1),stride=(8,1,1),return_indices=True)\nprint('deconv out',out.size())\n\n0.2\n\nTraceback (most recent call last):\nFile \"cont_test.py\", line 26, in \nx,i = F.max_pool3d(out,(8,1,1),stride=(8,1,1),return_indices=True)\nFile \"/usr/lib64/python2.7/site-packages/torch/nn/functional.py\", line 293, in max_pool3d\nceil_mode)\nFile \"/usr/lib64/python2.7/site-packages/torch/nn/_functions/thnn/pooling.py\", line 163, in forward\nctx.ceil_mode)\nRuntimeError: Can only downcast contiguous tensors at /pytorch/torch/lib/tmp_install/include/THC/THCDeviceTensor-inl.cuh:295\n\n0.3\n\n*** Error in `python': free(): invalid pointer: 0x00007f871fc575a0 ***\n======= Backtrace: =========\n/lib64/libc.so.6(+0x7c619)[0x7f8756d04619]\n/home/zhihaozh/torch_proj/polar/repo/polar_net/lib/python2.7/site-packages/torch/_thnn/_THCUNN.so(+0xca1f2)[0x7f866431e1f2]\n/lib64/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6df0)[0x7f8757a54bb0]\n/lib64/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7ed)[0x7f8757a56efd]\n/lib64/libpython2.7.so.1.0(+0x70858)[0x7f87579e0858]\n/lib64/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f87579bb9a3]\n/lib64/libpython2.7.so.1.0(PyEval_CallObjectWithKeywords+0x47)[0x7f8757a4d7b7]", "body": "Run the following code will raise \"RuntimeError: Can only downcast contiguous tensors\"\r\nonly happens in cuda mode, works for conv2d, works for cpu mod.\r\nTested on 0.2.0 and 0.3.0\r\nPython 2.7, \r\nLinux version 3.10.0-693.2.1.el7.x86_64 (mockbuild@x86-030.build.eng.bos.redhat.com) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC) )\r\n```\r\nimport torch\r\nimport torch.nn as nn\r\nimport torch.nn.functional as F\r\nimport torch.optim as optim\r\nfrom torch.autograd import Variable\r\nimport numpy as np\r\ncorr = Variable(torch.FloatTensor(np.ones((128,5,7,7))))\r\nf = Variable(torch.FloatTensor(np.ones((8,5,3,3))))\r\nout = F.conv2d(corr,f)\r\nprint('conv',out.size())\r\nout = out.view((128,8,1,5,5)).permute(0,2,1,3,4).contiguous()\r\nx,i = F.max_pool3d(out,(8,1,1),stride=(8,1,1),return_indices=True)\r\nprint('conv out',out.size())\r\ncorr = Variable(torch.FloatTensor(np.ones((128,5,3,3)))).cuda()\r\nf = Variable(torch.FloatTensor(np.ones((5,8,3,3)))).cuda()\r\nout = F.conv_transpose2d(corr,f)\r\nprint('deconv',out.size())\r\nout = out.view((128,8,1,5,5)).permute(0,2,1,3,4).contiguous()\r\nx,i = F.max_pool3d(out,(8,1,1),stride=(8,1,1),return_indices=True)\r\nprint('deconv out',out.size())\r\n```\r\n0.2\r\n> Traceback (most recent call last):\r\n  File \"cont_test.py\", line 26, in <module>\r\n    x,i = F.max_pool3d(out,(8,1,1),stride=(8,1,1),return_indices=True)\r\n  File \"/usr/lib64/python2.7/site-packages/torch/nn/functional.py\", line 293, in max_pool3d\r\n    ceil_mode)\r\n  File \"/usr/lib64/python2.7/site-packages/torch/nn/_functions/thnn/pooling.py\", line 163, in forward\r\n    ctx.ceil_mode)\r\nRuntimeError: Can only downcast contiguous tensors at /pytorch/torch/lib/tmp_install/include/THC/THCDeviceTensor-inl.cuh:295\r\n\r\n0.3\r\n> *** Error in `python': free(): invalid pointer: 0x00007f871fc575a0 ***\r\n======= Backtrace: =========\r\n/lib64/libc.so.6(+0x7c619)[0x7f8756d04619]\r\n/home/zhihaozh/torch_proj/polar/repo/polar_net/lib/python2.7/site-packages/torch/_thnn/_THCUNN.so(+0xca1f2)[0x7f866431e1f2]\r\n/lib64/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6df0)[0x7f8757a54bb0]\r\n/lib64/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7ed)[0x7f8757a56efd]\r\n/lib64/libpython2.7.so.1.0(+0x70858)[0x7f87579e0858]\r\n/lib64/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f87579bb9a3]\r\n/lib64/libpython2.7.so.1.0(PyEval_CallObjectWithKeywords+0x47)[0x7f8757a4d7b7]"}