{"url": "https://api.github.com/repos/pytorch/pytorch/issues/10401", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/10401/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/10401/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/10401/events", "html_url": "https://github.com/pytorch/pytorch/issues/10401", "id": 349527918, "node_id": "MDU6SXNzdWUzNDk1Mjc5MTg=", "number": 10401, "title": "[caffe2] namespace \"Eigen\" has no member \"CudaStreamDevice\"", "user": {"login": "linrio", "id": 16930748, "node_id": "MDQ6VXNlcjE2OTMwNzQ4", "avatar_url": "https://avatars2.githubusercontent.com/u/16930748?v=4", "gravatar_id": "", "url": "https://api.github.com/users/linrio", "html_url": "https://github.com/linrio", "followers_url": "https://api.github.com/users/linrio/followers", "following_url": "https://api.github.com/users/linrio/following{/other_user}", "gists_url": "https://api.github.com/users/linrio/gists{/gist_id}", "starred_url": "https://api.github.com/users/linrio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/linrio/subscriptions", "organizations_url": "https://api.github.com/users/linrio/orgs", "repos_url": "https://api.github.com/users/linrio/repos", "events_url": "https://api.github.com/users/linrio/events{/privacy}", "received_events_url": "https://api.github.com/users/linrio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 890282107, "node_id": "MDU6TGFiZWw4OTAyODIxMDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/caffe2", "name": "caffe2", "color": "210aa8", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-08-10T14:02:52Z", "updated_at": "2018-09-10T11:41:02Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>If you have a question or would like help and support, please ask at our<br>\n<a href=\"https://discuss.pytorch.org/\" rel=\"nofollow\">forums</a>.</p>\n<p>If you are submitting a feature request, please preface the title with [feature request].<br>\nIf you are submitting a bug report, please fill in the following details.</p>\n<h2>Issue description</h2>\n<p>I want to build caffe2 in docker container. The Dockerfile is:</p>\n<pre><code>FROM nvidia/cuda:9.1-cudnn7-devel-ubuntu16.04\n\n# Caffe2 depends\nRUN rm -rf /var/lib/apt/lists/*\nRUN apt-get update\nRUN apt clean\nRUN apt-get install -y --no-install-recommends \\\n      build-essential \\\n      cmake \\\n      git \\\n      libgoogle-glog-dev \\\n      libgtest-dev \\\n      libiomp-dev \\\n      libleveldb-dev \\\n      liblmdb-dev \\\n      libopencv-dev \\\n      libopenmpi-dev \\\n      libsnappy-dev \\\n      libprotobuf-dev \\\n      openmpi-bin \\\n      openmpi-doc \\\n      protobuf-compiler \\\n      python-dev \\\n      python-pip \\\n      cuda-nvprof-9-1\nRUN apt-get install -y --no-install-recommends libgflags-dev\nRUN pip install setuptools\nRUN pip install --upgrade pip\nRUN pip install \\\n      future \\\n      numpy \\\n      protobuf\n\n# Detectron depends\nRUN pip install \\\n     numpy pyyaml matplotlib opencv-python&gt;=3.2 setuptools Cython mock scipy\n\n# Hidden dependancies\nRUN pip install networkx enum\n\n# Build and install caffe2\nWORKDIR /packages\n#RUN git clone https://github.com/caffe2/caffe2.git\n#lingfeng change for eigen lib site\nRUN git clone -b linrio-patch-1 https://github.com/linrio/caffe2.git\nWORKDIR /packages/caffe2\n#RUN git checkout 3dd56c9580ad7ce6d20a4dd922aaac171acf582a\nRUN git submodule update --init --recursive ; exit 0\nWORKDIR /packages/caffe2/third_party/aten\nRUN git pull origin master\nRUN git checkout fd0020fff6e9a42de8efa7d94589a9168bf721a6\n#lingfeng\nWORKDIR /packages/caffe2/third_party/eigen\nRUN git pull origin master\nRUN git checkout master\nWORKDIR /packages/caffe2\nRUN mkdir build\nWORKDIR /packages/caffe2/build\nRUN cmake ..\nRUN make install -j16\n...\n</code></pre>\n<h2>Error emssage:</h2>\n<pre><code>Step 26/38 : RUN make install -j16\n ---&gt; Running in 0a88d2004d65\nScanning dependencies of target pthreadpool\nScanning dependencies of target gtest\n[  0%] Running C++/Python protocol buffer compiler on /packages/caffe2/caffe/proto/caffe.proto\nScanning dependencies of target cpuinfo\n[  0%] Running C++/Python protocol buffer compiler on /packages/caffe2/caffe2/proto/predictor_consts.proto\nScanning dependencies of target python_copy_files\n[  1%] Building C object confu-deps/pthreadpool/CMakeFiles/pthreadpool.dir/src/threadpool-pthreads.c.o\n......\n[ 64%] Building NVCC (Device) object caffe2/CMakeFiles/caffe2_gpu.dir/operators/caffe2_gpu_generated_lp_pool_op.cu.o\n[ 64%] Building NVCC (Device) object caffe2/CMakeFiles/caffe2_gpu.dir/operators/caffe2_gpu_generated_boolean_mask_ops.cu.o\n/packages/caffe2/caffe2/operators/arg_ops.cu(78): error: namespace \"Eigen\" has no member \"CudaStreamDevice\"\n\n/packages/caffe2/caffe2/operators/arg_ops.cu(137): error: namespace \"Eigen\" has no member \"CudaStreamDevice\"\n\n/packages/caffe2/caffe2/operators/arg_ops.cu(60): error: expected a \")\"\n          detected during instantiation of \"ObjectPtrType caffe2::Registerer&lt;SrcType, ObjectPtrType, Args...&gt;::DefaultCreator&lt;DerivedType&gt;(Args...) [with SrcType=std:\n:__cxx11::string, ObjectPtrType=std::unique_ptr&lt;caffe2::OperatorBase, std::default_delete&lt;caffe2::OperatorBase&gt;&gt;, Args=&lt;const caffe2::OperatorDef &amp;, caffe2::Workspace *&gt;, DerivedType=caffe2::ArgMaxOp&lt;float, caffe2::CUDAContext&gt;]\" (169): here\n\n/packages/caffe2/caffe2/operators/arg_ops.cu(119): error: expected a \")\"\n          detected during instantiation of \"ObjectPtrType caffe2::Registerer&lt;SrcType, ObjectPtrType, Args...&gt;::DefaultCreator&lt;DerivedType&gt;(Args...) [with SrcType=std:\n:__cxx11::string, ObjectPtrType=std::unique_ptr&lt;caffe2::OperatorBase, std::default_delete&lt;caffe2::OperatorBase&gt;&gt;, Args=&lt;const caffe2::OperatorDef &amp;, caffe2::Workspace *&gt;, DerivedType=caffe2::ArgMinOp&lt;float, caffe2::CUDAContext&gt;]\" (170): here\n\n4 errors detected in the compilation of \"/tmp/tmpxft_000024e5_00000000-12_arg_ops.compute_70.cpp1.ii\".\nCMake Error at caffe2_gpu_generated_arg_ops.cu.o.Release.cmake:275 (message):\n  Error generating file\n  /packages/caffe2/build/caffe2/CMakeFiles/caffe2_gpu.dir/operators/./caffe2_gpu_generated_arg_ops.cu.o\n\n\nmake[2]: *** [caffe2/CMakeFiles/caffe2_gpu.dir/operators/caffe2_gpu_generated_arg_ops.cu.o] Error 1\nmake[2]: *** Waiting for unfinished jobs....\ncaffe2/CMakeFiles/caffe2_gpu.dir/build.make:420: recipe for target 'caffe2/CMakeFiles/caffe2_gpu.dir/operators/caffe2_gpu_generated_arg_ops.cu.o' failed\n...\n</code></pre>\n<p>Actually, the eigen library has code like <a href=\"https://github.com/linrio/caffe2/blob/linrio-patch-1/caffe2/operators/arg_ops.cu#L78\">const Eigen::CudaStreamDevice stream_device_;</a> and <a href=\"https://github.com/linrio/caffe2/blob/linrio-patch-1/caffe2/operators/arg_ops.cu#L137\">const Eigen::CudaStreamDevice stream_device_;</a></p>\n<pre><code>const Eigen::CudaStreamDevice stream_device_;\n</code></pre>\n<ul>\n<li>PyTorch or Caffe2: caffe2</li>\n<li>How you installed PyTorch (conda, pip, source): source</li>\n<li>Build command you used (if compiling from source):</li>\n<li>OS:</li>\n<li>PyTorch version:</li>\n<li>Python version: 2.7</li>\n<li>CUDA/cuDNN version: 9.1</li>\n<li>GPU models and configuration: OK</li>\n<li>GCC version (if compiling from source):gcc (Ubuntu 5.4.0-6ubuntu1~16.04.10) 5.4.0 20160609</li>\n<li>CMake version: cmake version 3.5.1</li>\n<li>Versions of any other relevant libraries:</li>\n</ul>", "body_text": "If you have a question or would like help and support, please ask at our\nforums.\nIf you are submitting a feature request, please preface the title with [feature request].\nIf you are submitting a bug report, please fill in the following details.\nIssue description\nI want to build caffe2 in docker container. The Dockerfile is:\nFROM nvidia/cuda:9.1-cudnn7-devel-ubuntu16.04\n\n# Caffe2 depends\nRUN rm -rf /var/lib/apt/lists/*\nRUN apt-get update\nRUN apt clean\nRUN apt-get install -y --no-install-recommends \\\n      build-essential \\\n      cmake \\\n      git \\\n      libgoogle-glog-dev \\\n      libgtest-dev \\\n      libiomp-dev \\\n      libleveldb-dev \\\n      liblmdb-dev \\\n      libopencv-dev \\\n      libopenmpi-dev \\\n      libsnappy-dev \\\n      libprotobuf-dev \\\n      openmpi-bin \\\n      openmpi-doc \\\n      protobuf-compiler \\\n      python-dev \\\n      python-pip \\\n      cuda-nvprof-9-1\nRUN apt-get install -y --no-install-recommends libgflags-dev\nRUN pip install setuptools\nRUN pip install --upgrade pip\nRUN pip install \\\n      future \\\n      numpy \\\n      protobuf\n\n# Detectron depends\nRUN pip install \\\n     numpy pyyaml matplotlib opencv-python>=3.2 setuptools Cython mock scipy\n\n# Hidden dependancies\nRUN pip install networkx enum\n\n# Build and install caffe2\nWORKDIR /packages\n#RUN git clone https://github.com/caffe2/caffe2.git\n#lingfeng change for eigen lib site\nRUN git clone -b linrio-patch-1 https://github.com/linrio/caffe2.git\nWORKDIR /packages/caffe2\n#RUN git checkout 3dd56c9580ad7ce6d20a4dd922aaac171acf582a\nRUN git submodule update --init --recursive ; exit 0\nWORKDIR /packages/caffe2/third_party/aten\nRUN git pull origin master\nRUN git checkout fd0020fff6e9a42de8efa7d94589a9168bf721a6\n#lingfeng\nWORKDIR /packages/caffe2/third_party/eigen\nRUN git pull origin master\nRUN git checkout master\nWORKDIR /packages/caffe2\nRUN mkdir build\nWORKDIR /packages/caffe2/build\nRUN cmake ..\nRUN make install -j16\n...\n\nError emssage:\nStep 26/38 : RUN make install -j16\n ---> Running in 0a88d2004d65\nScanning dependencies of target pthreadpool\nScanning dependencies of target gtest\n[  0%] Running C++/Python protocol buffer compiler on /packages/caffe2/caffe/proto/caffe.proto\nScanning dependencies of target cpuinfo\n[  0%] Running C++/Python protocol buffer compiler on /packages/caffe2/caffe2/proto/predictor_consts.proto\nScanning dependencies of target python_copy_files\n[  1%] Building C object confu-deps/pthreadpool/CMakeFiles/pthreadpool.dir/src/threadpool-pthreads.c.o\n......\n[ 64%] Building NVCC (Device) object caffe2/CMakeFiles/caffe2_gpu.dir/operators/caffe2_gpu_generated_lp_pool_op.cu.o\n[ 64%] Building NVCC (Device) object caffe2/CMakeFiles/caffe2_gpu.dir/operators/caffe2_gpu_generated_boolean_mask_ops.cu.o\n/packages/caffe2/caffe2/operators/arg_ops.cu(78): error: namespace \"Eigen\" has no member \"CudaStreamDevice\"\n\n/packages/caffe2/caffe2/operators/arg_ops.cu(137): error: namespace \"Eigen\" has no member \"CudaStreamDevice\"\n\n/packages/caffe2/caffe2/operators/arg_ops.cu(60): error: expected a \")\"\n          detected during instantiation of \"ObjectPtrType caffe2::Registerer<SrcType, ObjectPtrType, Args...>::DefaultCreator<DerivedType>(Args...) [with SrcType=std:\n:__cxx11::string, ObjectPtrType=std::unique_ptr<caffe2::OperatorBase, std::default_delete<caffe2::OperatorBase>>, Args=<const caffe2::OperatorDef &, caffe2::Workspace *>, DerivedType=caffe2::ArgMaxOp<float, caffe2::CUDAContext>]\" (169): here\n\n/packages/caffe2/caffe2/operators/arg_ops.cu(119): error: expected a \")\"\n          detected during instantiation of \"ObjectPtrType caffe2::Registerer<SrcType, ObjectPtrType, Args...>::DefaultCreator<DerivedType>(Args...) [with SrcType=std:\n:__cxx11::string, ObjectPtrType=std::unique_ptr<caffe2::OperatorBase, std::default_delete<caffe2::OperatorBase>>, Args=<const caffe2::OperatorDef &, caffe2::Workspace *>, DerivedType=caffe2::ArgMinOp<float, caffe2::CUDAContext>]\" (170): here\n\n4 errors detected in the compilation of \"/tmp/tmpxft_000024e5_00000000-12_arg_ops.compute_70.cpp1.ii\".\nCMake Error at caffe2_gpu_generated_arg_ops.cu.o.Release.cmake:275 (message):\n  Error generating file\n  /packages/caffe2/build/caffe2/CMakeFiles/caffe2_gpu.dir/operators/./caffe2_gpu_generated_arg_ops.cu.o\n\n\nmake[2]: *** [caffe2/CMakeFiles/caffe2_gpu.dir/operators/caffe2_gpu_generated_arg_ops.cu.o] Error 1\nmake[2]: *** Waiting for unfinished jobs....\ncaffe2/CMakeFiles/caffe2_gpu.dir/build.make:420: recipe for target 'caffe2/CMakeFiles/caffe2_gpu.dir/operators/caffe2_gpu_generated_arg_ops.cu.o' failed\n...\n\nActually, the eigen library has code like const Eigen::CudaStreamDevice stream_device_; and const Eigen::CudaStreamDevice stream_device_;\nconst Eigen::CudaStreamDevice stream_device_;\n\n\nPyTorch or Caffe2: caffe2\nHow you installed PyTorch (conda, pip, source): source\nBuild command you used (if compiling from source):\nOS:\nPyTorch version:\nPython version: 2.7\nCUDA/cuDNN version: 9.1\nGPU models and configuration: OK\nGCC version (if compiling from source):gcc (Ubuntu 5.4.0-6ubuntu1~16.04.10) 5.4.0 20160609\nCMake version: cmake version 3.5.1\nVersions of any other relevant libraries:", "body": "If you have a question or would like help and support, please ask at our\r\n[forums](https://discuss.pytorch.org/).\r\n\r\nIf you are submitting a feature request, please preface the title with [feature request].\r\nIf you are submitting a bug report, please fill in the following details.\r\n\r\n## Issue description\r\n\r\nI want to build caffe2 in docker container. The Dockerfile is:\r\n```\r\nFROM nvidia/cuda:9.1-cudnn7-devel-ubuntu16.04\r\n\r\n# Caffe2 depends\r\nRUN rm -rf /var/lib/apt/lists/*\r\nRUN apt-get update\r\nRUN apt clean\r\nRUN apt-get install -y --no-install-recommends \\\r\n      build-essential \\\r\n      cmake \\\r\n      git \\\r\n      libgoogle-glog-dev \\\r\n      libgtest-dev \\\r\n      libiomp-dev \\\r\n      libleveldb-dev \\\r\n      liblmdb-dev \\\r\n      libopencv-dev \\\r\n      libopenmpi-dev \\\r\n      libsnappy-dev \\\r\n      libprotobuf-dev \\\r\n      openmpi-bin \\\r\n      openmpi-doc \\\r\n      protobuf-compiler \\\r\n      python-dev \\\r\n      python-pip \\\r\n      cuda-nvprof-9-1\r\nRUN apt-get install -y --no-install-recommends libgflags-dev\r\nRUN pip install setuptools\r\nRUN pip install --upgrade pip\r\nRUN pip install \\\r\n      future \\\r\n      numpy \\\r\n      protobuf\r\n\r\n# Detectron depends\r\nRUN pip install \\\r\n     numpy pyyaml matplotlib opencv-python>=3.2 setuptools Cython mock scipy\r\n\r\n# Hidden dependancies\r\nRUN pip install networkx enum\r\n\r\n# Build and install caffe2\r\nWORKDIR /packages\r\n#RUN git clone https://github.com/caffe2/caffe2.git\r\n#lingfeng change for eigen lib site\r\nRUN git clone -b linrio-patch-1 https://github.com/linrio/caffe2.git\r\nWORKDIR /packages/caffe2\r\n#RUN git checkout 3dd56c9580ad7ce6d20a4dd922aaac171acf582a\r\nRUN git submodule update --init --recursive ; exit 0\r\nWORKDIR /packages/caffe2/third_party/aten\r\nRUN git pull origin master\r\nRUN git checkout fd0020fff6e9a42de8efa7d94589a9168bf721a6\r\n#lingfeng\r\nWORKDIR /packages/caffe2/third_party/eigen\r\nRUN git pull origin master\r\nRUN git checkout master\r\nWORKDIR /packages/caffe2\r\nRUN mkdir build\r\nWORKDIR /packages/caffe2/build\r\nRUN cmake ..\r\nRUN make install -j16\r\n...\r\n```\r\n\r\n## Error emssage:\r\n```\r\nStep 26/38 : RUN make install -j16\r\n ---> Running in 0a88d2004d65\r\nScanning dependencies of target pthreadpool\r\nScanning dependencies of target gtest\r\n[  0%] Running C++/Python protocol buffer compiler on /packages/caffe2/caffe/proto/caffe.proto\r\nScanning dependencies of target cpuinfo\r\n[  0%] Running C++/Python protocol buffer compiler on /packages/caffe2/caffe2/proto/predictor_consts.proto\r\nScanning dependencies of target python_copy_files\r\n[  1%] Building C object confu-deps/pthreadpool/CMakeFiles/pthreadpool.dir/src/threadpool-pthreads.c.o\r\n......\r\n[ 64%] Building NVCC (Device) object caffe2/CMakeFiles/caffe2_gpu.dir/operators/caffe2_gpu_generated_lp_pool_op.cu.o\r\n[ 64%] Building NVCC (Device) object caffe2/CMakeFiles/caffe2_gpu.dir/operators/caffe2_gpu_generated_boolean_mask_ops.cu.o\r\n/packages/caffe2/caffe2/operators/arg_ops.cu(78): error: namespace \"Eigen\" has no member \"CudaStreamDevice\"\r\n\r\n/packages/caffe2/caffe2/operators/arg_ops.cu(137): error: namespace \"Eigen\" has no member \"CudaStreamDevice\"\r\n\r\n/packages/caffe2/caffe2/operators/arg_ops.cu(60): error: expected a \")\"\r\n          detected during instantiation of \"ObjectPtrType caffe2::Registerer<SrcType, ObjectPtrType, Args...>::DefaultCreator<DerivedType>(Args...) [with SrcType=std:\r\n:__cxx11::string, ObjectPtrType=std::unique_ptr<caffe2::OperatorBase, std::default_delete<caffe2::OperatorBase>>, Args=<const caffe2::OperatorDef &, caffe2::Workspace *>, DerivedType=caffe2::ArgMaxOp<float, caffe2::CUDAContext>]\" (169): here\r\n\r\n/packages/caffe2/caffe2/operators/arg_ops.cu(119): error: expected a \")\"\r\n          detected during instantiation of \"ObjectPtrType caffe2::Registerer<SrcType, ObjectPtrType, Args...>::DefaultCreator<DerivedType>(Args...) [with SrcType=std:\r\n:__cxx11::string, ObjectPtrType=std::unique_ptr<caffe2::OperatorBase, std::default_delete<caffe2::OperatorBase>>, Args=<const caffe2::OperatorDef &, caffe2::Workspace *>, DerivedType=caffe2::ArgMinOp<float, caffe2::CUDAContext>]\" (170): here\r\n\r\n4 errors detected in the compilation of \"/tmp/tmpxft_000024e5_00000000-12_arg_ops.compute_70.cpp1.ii\".\r\nCMake Error at caffe2_gpu_generated_arg_ops.cu.o.Release.cmake:275 (message):\r\n  Error generating file\r\n  /packages/caffe2/build/caffe2/CMakeFiles/caffe2_gpu.dir/operators/./caffe2_gpu_generated_arg_ops.cu.o\r\n\r\n\r\nmake[2]: *** [caffe2/CMakeFiles/caffe2_gpu.dir/operators/caffe2_gpu_generated_arg_ops.cu.o] Error 1\r\nmake[2]: *** Waiting for unfinished jobs....\r\ncaffe2/CMakeFiles/caffe2_gpu.dir/build.make:420: recipe for target 'caffe2/CMakeFiles/caffe2_gpu.dir/operators/caffe2_gpu_generated_arg_ops.cu.o' failed\r\n...\r\n```\r\n\r\nActually, the eigen library has code like [const Eigen::CudaStreamDevice stream_device_;](https://github.com/linrio/caffe2/blob/linrio-patch-1/caffe2/operators/arg_ops.cu#L78) and [const Eigen::CudaStreamDevice stream_device_;](https://github.com/linrio/caffe2/blob/linrio-patch-1/caffe2/operators/arg_ops.cu#L137)\r\n```\r\nconst Eigen::CudaStreamDevice stream_device_;\r\n```\r\n\r\n\r\n\r\n- PyTorch or Caffe2: caffe2\r\n- How you installed PyTorch (conda, pip, source): source\r\n- Build command you used (if compiling from source): \r\n- OS:\r\n- PyTorch version:\r\n- Python version: 2.7\r\n- CUDA/cuDNN version: 9.1\r\n- GPU models and configuration: OK\r\n- GCC version (if compiling from source):gcc (Ubuntu 5.4.0-6ubuntu1~16.04.10) 5.4.0 20160609\r\n- CMake version: cmake version 3.5.1\r\n- Versions of any other relevant libraries:\r\n"}