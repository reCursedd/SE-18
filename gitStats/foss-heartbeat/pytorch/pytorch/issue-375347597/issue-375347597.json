{"url": "https://api.github.com/repos/pytorch/pytorch/issues/13296", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/13296/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/13296/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/13296/events", "html_url": "https://github.com/pytorch/pytorch/issues/13296", "id": 375347597, "node_id": "MDU6SXNzdWUzNzUzNDc1OTc=", "number": 13296, "title": "Tensom.sum() is our of memory for unknown reason", "user": {"login": "vborees", "id": 2256788, "node_id": "MDQ6VXNlcjIyNTY3ODg=", "avatar_url": "https://avatars1.githubusercontent.com/u/2256788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vborees", "html_url": "https://github.com/vborees", "followers_url": "https://api.github.com/users/vborees/followers", "following_url": "https://api.github.com/users/vborees/following{/other_user}", "gists_url": "https://api.github.com/users/vborees/gists{/gist_id}", "starred_url": "https://api.github.com/users/vborees/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vborees/subscriptions", "organizations_url": "https://api.github.com/users/vborees/orgs", "repos_url": "https://api.github.com/users/vborees/repos", "events_url": "https://api.github.com/users/vborees/events{/privacy}", "received_events_url": "https://api.github.com/users/vborees/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-10-30T07:03:30Z", "updated_at": "2018-11-06T22:00:48Z", "closed_at": null, "author_association": "NONE", "body_html": "<h2><g-emoji class=\"g-emoji\" alias=\"bug\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f41b.png\">\ud83d\udc1b</g-emoji> Bug</h2>\n<p>In attempt to compute confusion matrix for my classifier, I ended up with code like this:<br>\na1 = (self.pred_class==x[:,None])<br>\nprint(a1.shape)<br>\na2 = (self.y_true==x[:,None,None])<br>\nprint(a2.shape)<br>\na3 = a1 &amp; a2<br>\nprint(a3.shape)<br>\ncm = a3.sum(2)</p>\n<p>print functions output:<br>\ntorch.Size([340, 74498])<br>\ntorch.Size([340, 1, 74498])<br>\ntorch.Size([340, 340, 74498])</p>\n<p>however .sum(2) causing error:<br>\nRuntimeError: $ Torch: not enough memory: you tried to allocate 64GB. Buy new RAM! at /opt/conda/conda-bld/pytorch-nightly_1540719301766/work/aten/src/TH/THGeneral.cpp:204</p>\n<h2>To Reproduce</h2>\n<p>Steps to reproduce the behavior:</p>\n<ol>\n<li>Create random tensors of size above</li>\n<li>run the code above to get an Error</li>\n</ol>\n<h2>Expected behavior</h2>\n\n<p>PyTorch version: 1.0.0.dev20181028<br>\nIs debug build: No<br>\nCUDA used to build PyTorch: 9.2.148</p>\n<p>OS: Amazon Linux AMI 2018.03<br>\nGCC version: (GCC) 7.2.1 20170915 (Red Hat 7.2.1-2)<br>\nCMake version: version 2.8.12.2</p>\n<p>Python version: 3.6<br>\nIs CUDA available: Yes<br>\nCUDA runtime version: 9.0.176<br>\nGPU models and configuration: GPU 0: Tesla K80<br>\nNvidia driver version: 396.44<br>\ncuDNN version: Probably one of the following:<br>\n/usr/local/cuda-8.0/lib64/libcudnn.so.6.0.21<br>\n/usr/local/cuda-8.0/lib64/libcudnn_static.a<br>\n/usr/local/cuda-9.0/lib64/libcudnn.so.7.1.4<br>\n/usr/local/cuda-9.0/lib64/libcudnn_static.a<br>\n/usr/local/cuda-9.1/lib64/libcudnn.so.7.0.5<br>\n/usr/local/cuda-9.1/lib64/libcudnn_static.a<br>\n/usr/local/cuda-9.2/lib64/libcudnn.so.7.1.4<br>\n/usr/local/cuda-9.2/lib64/libcudnn_static.a</p>\n<p>Versions of relevant libraries:<br>\n[pip] Could not collect<br>\n[conda] cuda92                    1.0                           0    pytorch<br>\n[conda] pytorch                   0.4.1           py36_cuda9.2.148_cudnn7.1.4_1  [cuda92]  pytorch<br>\n[conda] pytorch-nightly           1.0.0.dev20181028 py3.6_cuda9.2.148_cudnn7.1.4_0  [cuda92]  pytorch<br>\n[conda] torch                     0.3.1                     <br>\n[conda] torchtext                 0.2.3                     <br>\n[conda] torchvision               0.2.1                    py36_1    pytorch<br>\n[conda] torchvision               0.2.1                     <br>\n[conda] torchvision-nightly       0.2.1                      py_0    fastai</p>", "body_text": "\ud83d\udc1b Bug\nIn attempt to compute confusion matrix for my classifier, I ended up with code like this:\na1 = (self.pred_class==x[:,None])\nprint(a1.shape)\na2 = (self.y_true==x[:,None,None])\nprint(a2.shape)\na3 = a1 & a2\nprint(a3.shape)\ncm = a3.sum(2)\nprint functions output:\ntorch.Size([340, 74498])\ntorch.Size([340, 1, 74498])\ntorch.Size([340, 340, 74498])\nhowever .sum(2) causing error:\nRuntimeError: $ Torch: not enough memory: you tried to allocate 64GB. Buy new RAM! at /opt/conda/conda-bld/pytorch-nightly_1540719301766/work/aten/src/TH/THGeneral.cpp:204\nTo Reproduce\nSteps to reproduce the behavior:\n\nCreate random tensors of size above\nrun the code above to get an Error\n\nExpected behavior\n\nPyTorch version: 1.0.0.dev20181028\nIs debug build: No\nCUDA used to build PyTorch: 9.2.148\nOS: Amazon Linux AMI 2018.03\nGCC version: (GCC) 7.2.1 20170915 (Red Hat 7.2.1-2)\nCMake version: version 2.8.12.2\nPython version: 3.6\nIs CUDA available: Yes\nCUDA runtime version: 9.0.176\nGPU models and configuration: GPU 0: Tesla K80\nNvidia driver version: 396.44\ncuDNN version: Probably one of the following:\n/usr/local/cuda-8.0/lib64/libcudnn.so.6.0.21\n/usr/local/cuda-8.0/lib64/libcudnn_static.a\n/usr/local/cuda-9.0/lib64/libcudnn.so.7.1.4\n/usr/local/cuda-9.0/lib64/libcudnn_static.a\n/usr/local/cuda-9.1/lib64/libcudnn.so.7.0.5\n/usr/local/cuda-9.1/lib64/libcudnn_static.a\n/usr/local/cuda-9.2/lib64/libcudnn.so.7.1.4\n/usr/local/cuda-9.2/lib64/libcudnn_static.a\nVersions of relevant libraries:\n[pip] Could not collect\n[conda] cuda92                    1.0                           0    pytorch\n[conda] pytorch                   0.4.1           py36_cuda9.2.148_cudnn7.1.4_1  [cuda92]  pytorch\n[conda] pytorch-nightly           1.0.0.dev20181028 py3.6_cuda9.2.148_cudnn7.1.4_0  [cuda92]  pytorch\n[conda] torch                     0.3.1                     \n[conda] torchtext                 0.2.3                     \n[conda] torchvision               0.2.1                    py36_1    pytorch\n[conda] torchvision               0.2.1                     \n[conda] torchvision-nightly       0.2.1                      py_0    fastai", "body": "## \ud83d\udc1b Bug\r\n\r\nIn attempt to compute confusion matrix for my classifier, I ended up with code like this:\r\n        a1 = (self.pred_class==x[:,None])\r\n        print(a1.shape)\r\n        a2 = (self.y_true==x[:,None,None])\r\n        print(a2.shape)\r\n        a3 = a1 & a2\r\n        print(a3.shape)\r\n        cm = a3.sum(2)\r\n\r\nprint functions output:\r\n         torch.Size([340, 74498])\r\n         torch.Size([340, 1, 74498])\r\n         torch.Size([340, 340, 74498])\r\n\r\nhowever .sum(2) causing error:\r\n         RuntimeError: $ Torch: not enough memory: you tried to allocate 64GB. Buy new RAM! at /opt/conda/conda-bld/pytorch-nightly_1540719301766/work/aten/src/TH/THGeneral.cpp:204\r\n\r\n## To Reproduce\r\n\r\nSteps to reproduce the behavior:\r\n\r\n1. Create random tensors of size above\r\n1. run the code above to get an Error\r\n\r\n## Expected behavior\r\n\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nPyTorch version: 1.0.0.dev20181028\r\nIs debug build: No\r\nCUDA used to build PyTorch: 9.2.148\r\n\r\nOS: Amazon Linux AMI 2018.03\r\nGCC version: (GCC) 7.2.1 20170915 (Red Hat 7.2.1-2)\r\nCMake version: version 2.8.12.2\r\n\r\nPython version: 3.6\r\nIs CUDA available: Yes\r\nCUDA runtime version: 9.0.176\r\nGPU models and configuration: GPU 0: Tesla K80\r\nNvidia driver version: 396.44\r\ncuDNN version: Probably one of the following:\r\n/usr/local/cuda-8.0/lib64/libcudnn.so.6.0.21\r\n/usr/local/cuda-8.0/lib64/libcudnn_static.a\r\n/usr/local/cuda-9.0/lib64/libcudnn.so.7.1.4\r\n/usr/local/cuda-9.0/lib64/libcudnn_static.a\r\n/usr/local/cuda-9.1/lib64/libcudnn.so.7.0.5\r\n/usr/local/cuda-9.1/lib64/libcudnn_static.a\r\n/usr/local/cuda-9.2/lib64/libcudnn.so.7.1.4\r\n/usr/local/cuda-9.2/lib64/libcudnn_static.a\r\n\r\nVersions of relevant libraries:\r\n[pip] Could not collect\r\n[conda] cuda92                    1.0                           0    pytorch\r\n[conda] pytorch                   0.4.1           py36_cuda9.2.148_cudnn7.1.4_1  [cuda92]  pytorch\r\n[conda] pytorch-nightly           1.0.0.dev20181028 py3.6_cuda9.2.148_cudnn7.1.4_0  [cuda92]  pytorch\r\n[conda] torch                     0.3.1                     <pip>\r\n[conda] torchtext                 0.2.3                     <pip>\r\n[conda] torchvision               0.2.1                    py36_1    pytorch\r\n[conda] torchvision               0.2.1                     <pip>\r\n[conda] torchvision-nightly       0.2.1                      py_0    fastai\r\n\r\n"}