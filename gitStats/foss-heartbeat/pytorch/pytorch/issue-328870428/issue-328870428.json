{"url": "https://api.github.com/repos/pytorch/pytorch/issues/8091", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/8091/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/8091/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/8091/events", "html_url": "https://github.com/pytorch/pytorch/issues/8091", "id": 328870428, "node_id": "MDU6SXNzdWUzMjg4NzA0Mjg=", "number": 8091, "title": "pytorch/examples/imagenet/main.py hang when world_size value is greater than 1", "user": {"login": "cya410", "id": 5148937, "node_id": "MDQ6VXNlcjUxNDg5Mzc=", "avatar_url": "https://avatars3.githubusercontent.com/u/5148937?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cya410", "html_url": "https://github.com/cya410", "followers_url": "https://api.github.com/users/cya410/followers", "following_url": "https://api.github.com/users/cya410/following{/other_user}", "gists_url": "https://api.github.com/users/cya410/gists{/gist_id}", "starred_url": "https://api.github.com/users/cya410/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cya410/subscriptions", "organizations_url": "https://api.github.com/users/cya410/orgs", "repos_url": "https://api.github.com/users/cya410/repos", "events_url": "https://api.github.com/users/cya410/events{/privacy}", "received_events_url": "https://api.github.com/users/cya410/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-06-03T23:04:37Z", "updated_at": "2018-06-04T17:26:24Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>Hello I tried running resnet50 and imagenet using the following commands:</p>\n<pre><code>python ./scripts/imagenet.py \\\n--arch=resnet50 \\\n--epochs=1 \\\n--batch-size=64 \\ \n--lr=0.01 \\\n--workers=4 \\\n--world-size=2 \\ \n--dist-backend=gloo \\\n--dist-url=file:///workspace/sharedfile \\\n--rank=0 \\\n--print-freq 10 /workspace/imagenet\n</code></pre>\n<p>The program hangs without launching anything when --world-size value is greater than 1. The problem is that the init_process_group never return.</p>\n<pre><code>dist.init_process_group(backend=args.dist_backend, init_method=args.dist_url, \n                        world_size=args.world_size, rank=0)\n</code></pre>\n<p>It is actually calling a C++ function. I added a bunch of output to make sure that the parameters are all correct:</p>\n<pre><code>print(\"calling _dist_init_process_group with\")\nprint(\"backend \", backend)\nprint(\"init_method\", init_method)\nprint(\"world_size\", world_size)\nprint(\"group_name\", group_name)\nprint(\"rank\", rank)\ntorch._C._dist_init_process_group(backend, init_method, world_size,\n                                  group_name, rank)\nprint(\"_dist_init_process_group done\")\n</code></pre>\n<p>I also tried a bunch of combinations as follow and they all end up with hanging.</p>\n<pre><code>--dist-url=tcp://10.1.1.20:23456\n--dist-url=tcp://127.0.0.1:29500 \n--dist-url=file:///workspace/sharedfile \n\n--dist-backend=tcp\n--dist-backend=gloo\n--dist-backend=nccl\n</code></pre>\n<p>Any help would be appreciated, thanks.</p>\n<p>Update: even this simple python test ended up with hanging:</p>\n<pre><code>import torch.distributed as dist\n\ndist.init_process_group(backend='gloo', init_method='file:///workspace/sharedfile', world_size=4, rank=0)\n\nprint('Hello from process {} (out of {})!'.format(dist.get_rank(), dist.get_world_size()))\n</code></pre>", "body_text": "Hello I tried running resnet50 and imagenet using the following commands:\npython ./scripts/imagenet.py \\\n--arch=resnet50 \\\n--epochs=1 \\\n--batch-size=64 \\ \n--lr=0.01 \\\n--workers=4 \\\n--world-size=2 \\ \n--dist-backend=gloo \\\n--dist-url=file:///workspace/sharedfile \\\n--rank=0 \\\n--print-freq 10 /workspace/imagenet\n\nThe program hangs without launching anything when --world-size value is greater than 1. The problem is that the init_process_group never return.\ndist.init_process_group(backend=args.dist_backend, init_method=args.dist_url, \n                        world_size=args.world_size, rank=0)\n\nIt is actually calling a C++ function. I added a bunch of output to make sure that the parameters are all correct:\nprint(\"calling _dist_init_process_group with\")\nprint(\"backend \", backend)\nprint(\"init_method\", init_method)\nprint(\"world_size\", world_size)\nprint(\"group_name\", group_name)\nprint(\"rank\", rank)\ntorch._C._dist_init_process_group(backend, init_method, world_size,\n                                  group_name, rank)\nprint(\"_dist_init_process_group done\")\n\nI also tried a bunch of combinations as follow and they all end up with hanging.\n--dist-url=tcp://10.1.1.20:23456\n--dist-url=tcp://127.0.0.1:29500 \n--dist-url=file:///workspace/sharedfile \n\n--dist-backend=tcp\n--dist-backend=gloo\n--dist-backend=nccl\n\nAny help would be appreciated, thanks.\nUpdate: even this simple python test ended up with hanging:\nimport torch.distributed as dist\n\ndist.init_process_group(backend='gloo', init_method='file:///workspace/sharedfile', world_size=4, rank=0)\n\nprint('Hello from process {} (out of {})!'.format(dist.get_rank(), dist.get_world_size()))", "body": "Hello I tried running resnet50 and imagenet using the following commands:\r\n\r\n    python ./scripts/imagenet.py \\\r\n    --arch=resnet50 \\\r\n    --epochs=1 \\\r\n    --batch-size=64 \\ \r\n    --lr=0.01 \\\r\n    --workers=4 \\\r\n    --world-size=2 \\ \r\n    --dist-backend=gloo \\\r\n    --dist-url=file:///workspace/sharedfile \\\r\n    --rank=0 \\\r\n    --print-freq 10 /workspace/imagenet\r\n\r\nThe program hangs without launching anything when --world-size value is greater than 1. The problem is that the init_process_group never return.\r\n\r\n    dist.init_process_group(backend=args.dist_backend, init_method=args.dist_url, \r\n                            world_size=args.world_size, rank=0)\r\n\r\nIt is actually calling a C++ function. I added a bunch of output to make sure that the parameters are all correct:\r\n\r\n\r\n    print(\"calling _dist_init_process_group with\")\r\n    print(\"backend \", backend)\r\n    print(\"init_method\", init_method)\r\n    print(\"world_size\", world_size)\r\n    print(\"group_name\", group_name)\r\n    print(\"rank\", rank)\r\n    torch._C._dist_init_process_group(backend, init_method, world_size,\r\n                                      group_name, rank)\r\n    print(\"_dist_init_process_group done\")\r\n\r\nI also tried a bunch of combinations as follow and they all end up with hanging.\r\n\r\n    --dist-url=tcp://10.1.1.20:23456\r\n    --dist-url=tcp://127.0.0.1:29500 \r\n    --dist-url=file:///workspace/sharedfile \r\n    \r\n    --dist-backend=tcp\r\n    --dist-backend=gloo\r\n    --dist-backend=nccl\r\n\r\nAny help would be appreciated, thanks.\r\n\r\n\r\nUpdate: even this simple python test ended up with hanging:\r\n\r\n    import torch.distributed as dist\r\n\r\n    dist.init_process_group(backend='gloo', init_method='file:///workspace/sharedfile', world_size=4, rank=0)\r\n\r\n    print('Hello from process {} (out of {})!'.format(dist.get_rank(), dist.get_world_size()))\r\n"}