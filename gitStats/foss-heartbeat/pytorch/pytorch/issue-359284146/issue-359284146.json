{"url": "https://api.github.com/repos/pytorch/pytorch/issues/11560", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/11560/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/11560/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/11560/events", "html_url": "https://github.com/pytorch/pytorch/pull/11560", "id": 359284146, "node_id": "MDExOlB1bGxSZXF1ZXN0MjE0ODEyNzM1", "number": 11560, "title": "[jit] Ensure most Distribution methods are jittable", "user": {"login": "fritzo", "id": 648532, "node_id": "MDQ6VXNlcjY0ODUzMg==", "avatar_url": "https://avatars0.githubusercontent.com/u/648532?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fritzo", "html_url": "https://github.com/fritzo", "followers_url": "https://api.github.com/users/fritzo/followers", "following_url": "https://api.github.com/users/fritzo/following{/other_user}", "gists_url": "https://api.github.com/users/fritzo/gists{/gist_id}", "starred_url": "https://api.github.com/users/fritzo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fritzo/subscriptions", "organizations_url": "https://api.github.com/users/fritzo/orgs", "repos_url": "https://api.github.com/users/fritzo/repos", "events_url": "https://api.github.com/users/fritzo/events{/privacy}", "received_events_url": "https://api.github.com/users/fritzo/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-09-12T01:44:14Z", "updated_at": "2018-11-23T15:51:18Z", "closed_at": "2018-09-14T02:56:18Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/11560", "html_url": "https://github.com/pytorch/pytorch/pull/11560", "diff_url": "https://github.com/pytorch/pytorch/pull/11560.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/11560.patch"}, "body_html": "<p>This adds tests in tests/test_distributions.py to ensure that all methods of <code>Distribution</code> objects are jittable.</p>\n<p>I've replaced a few samplers with jittable versions:</p>\n<ul>\n<li><code>.uniform_()</code> -&gt; <code>torch.rand()</code></li>\n<li><code>.exponential_()</code> -&gt; <code>-(-torch.rand()).log1p()</code></li>\n<li><code>.normal_()</code> -&gt; <code>torch.normal(torch.zeros(...), torch.ones(...), ...)</code></li>\n</ul>\n<p>Some jit failures remain, and are marked in test_distributions.py</p>\n<ul>\n<li><code>Cauchy</code> and <code>HalfCauchy</code> do not support sampling due to missing <code>.cauchy_()</code></li>\n<li><code>Binomial</code> does not support <code>.enumerate_support()</code> due to <code>arange</code> ignoring its first arg.</li>\n<li><code>MultivariateNormal</code>, <code>LowRankMultivariateNormal</code> do not support <code>.mean</code>, <code>.entropy</code></li>\n</ul>\n<h2>Questions for reviewers</h2>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Currently some tests fail (I've skipped those) due to unavailability of <code>aten::uniform</code> and <code>aten::cauchy</code> in the jit. Can someone suggest how to add these? I tried to add declarations to <code>torch/csrc/ir.cpp</code> and <code>torch/csrc/passes/shape_analysis.cpp</code>, but that resulted in \"Couldn't find operator\" errors.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> There are still lots of <code>TracerWarning</code>s that something doesn't match something. I'm not sure whether these are real.</li>\n</ul>", "body_text": "This adds tests in tests/test_distributions.py to ensure that all methods of Distribution objects are jittable.\nI've replaced a few samplers with jittable versions:\n\n.uniform_() -> torch.rand()\n.exponential_() -> -(-torch.rand()).log1p()\n.normal_() -> torch.normal(torch.zeros(...), torch.ones(...), ...)\n\nSome jit failures remain, and are marked in test_distributions.py\n\nCauchy and HalfCauchy do not support sampling due to missing .cauchy_()\nBinomial does not support .enumerate_support() due to arange ignoring its first arg.\nMultivariateNormal, LowRankMultivariateNormal do not support .mean, .entropy\n\nQuestions for reviewers\n\n Currently some tests fail (I've skipped those) due to unavailability of aten::uniform and aten::cauchy in the jit. Can someone suggest how to add these? I tried to add declarations to torch/csrc/ir.cpp and torch/csrc/passes/shape_analysis.cpp, but that resulted in \"Couldn't find operator\" errors.\n There are still lots of TracerWarnings that something doesn't match something. I'm not sure whether these are real.", "body": "This adds tests in tests/test_distributions.py to ensure that all methods of `Distribution` objects are jittable.\r\n\r\nI've replaced a few samplers with jittable versions:\r\n- `.uniform_()` -> `torch.rand()`\r\n- `.exponential_()` -> `-(-torch.rand()).log1p()`\r\n- `.normal_()` -> `torch.normal(torch.zeros(...), torch.ones(...), ...)`\r\n\r\nSome jit failures remain, and are marked in test_distributions.py\r\n- `Cauchy` and `HalfCauchy` do not support sampling due to missing `.cauchy_()`\r\n- `Binomial` does not support `.enumerate_support()` due to `arange` ignoring its first arg.\r\n- `MultivariateNormal`, `LowRankMultivariateNormal` do not support `.mean`, `.entropy`\r\n\r\n## Questions for reviewers\r\n\r\n- [x] Currently some tests fail (I've skipped those) due to unavailability of `aten::uniform` and `aten::cauchy` in the jit. Can someone suggest how to add these? I tried to add declarations to `torch/csrc/ir.cpp` and `torch/csrc/passes/shape_analysis.cpp`, but that resulted in \"Couldn't find operator\" errors.\r\n- [x] There are still lots of `TracerWarning`s that something doesn't match something. I'm not sure whether these are real."}