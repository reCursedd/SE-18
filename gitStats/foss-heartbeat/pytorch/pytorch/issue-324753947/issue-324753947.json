{"url": "https://api.github.com/repos/pytorch/pytorch/issues/7718", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/7718/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/7718/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/7718/events", "html_url": "https://github.com/pytorch/pytorch/pull/7718", "id": 324753947, "node_id": "MDExOlB1bGxSZXF1ZXN0MTg5MjU5OTMy", "number": 7718, "title": "Fix win mkldnn", "user": {"login": "bstriner", "id": 12462956, "node_id": "MDQ6VXNlcjEyNDYyOTU2", "avatar_url": "https://avatars3.githubusercontent.com/u/12462956?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bstriner", "html_url": "https://github.com/bstriner", "followers_url": "https://api.github.com/users/bstriner/followers", "following_url": "https://api.github.com/users/bstriner/following{/other_user}", "gists_url": "https://api.github.com/users/bstriner/gists{/gist_id}", "starred_url": "https://api.github.com/users/bstriner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bstriner/subscriptions", "organizations_url": "https://api.github.com/users/bstriner/orgs", "repos_url": "https://api.github.com/users/bstriner/repos", "events_url": "https://api.github.com/users/bstriner/events{/privacy}", "received_events_url": "https://api.github.com/users/bstriner/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2018-05-20T23:59:24Z", "updated_at": "2018-06-07T02:59:39Z", "closed_at": "2018-06-07T02:59:39Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/7718", "html_url": "https://github.com/pytorch/pytorch/pull/7718", "diff_url": "https://github.com/pytorch/pytorch/pull/7718.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/7718.patch"}, "body_html": "<p>Hi Everybody!</p>\n<p>Error in windows build if mkldnn is enabled because <code>build_pytorch_libs.bat</code> doesn't understand the argument <code>--with-mkldnn</code>. This argument works on Linux but not Win. This PR fixes the windows build so it can use MKLDNN.</p>\n<p>I synced the command line parsing and the ATen cmake command between the batch script and the bash script. It looks like ATen is now correctly building with MKLDNN on Windows.</p>\n<ul>\n<li><a href=\"https://github.com/pytorch/pytorch/blob/master/tools/build_pytorch_libs.sh\">https://github.com/pytorch/pytorch/blob/master/tools/build_pytorch_libs.sh</a></li>\n<li><a href=\"https://github.com/pytorch/pytorch/blob/master/tools/build_pytorch_libs.bat\">https://github.com/pytorch/pytorch/blob/master/tools/build_pytorch_libs.bat</a></li>\n</ul>\n<p>Warning: I just brought in all of the options from Linux build that were missing in the Windows build, so I'm trusting that that code is correct. Would appreciate if anyone can give them a once-over.</p>\n<ul>\n<li>Not sure about whether <code>ATEN_NO_CONTRIB</code> and <code>CMAKE_EXPORT_COMPILE_COMMANDS</code> should be set or not. The latter shouldn't really matter but the former might make a difference.</li>\n<li>I added the command line parsing for gloo and distributed-mw while I was putting in mkldnn but these are not fully implemented. Maybe should print a warning or something.</li>\n<li>The other build commands in that script probably also need some work, the MKLDNN issue just happened to be causing a problem in my specific situation. Not sure if there is some good way to synchronize the two or figure out something more OS independent. Why do we need the two shell scripts at all instead of just python? A lot of overhead with environment variables and command line parsing that could be avoided.</li>\n</ul>\n<p>Cheers</p>", "body_text": "Hi Everybody!\nError in windows build if mkldnn is enabled because build_pytorch_libs.bat doesn't understand the argument --with-mkldnn. This argument works on Linux but not Win. This PR fixes the windows build so it can use MKLDNN.\nI synced the command line parsing and the ATen cmake command between the batch script and the bash script. It looks like ATen is now correctly building with MKLDNN on Windows.\n\nhttps://github.com/pytorch/pytorch/blob/master/tools/build_pytorch_libs.sh\nhttps://github.com/pytorch/pytorch/blob/master/tools/build_pytorch_libs.bat\n\nWarning: I just brought in all of the options from Linux build that were missing in the Windows build, so I'm trusting that that code is correct. Would appreciate if anyone can give them a once-over.\n\nNot sure about whether ATEN_NO_CONTRIB and CMAKE_EXPORT_COMPILE_COMMANDS should be set or not. The latter shouldn't really matter but the former might make a difference.\nI added the command line parsing for gloo and distributed-mw while I was putting in mkldnn but these are not fully implemented. Maybe should print a warning or something.\nThe other build commands in that script probably also need some work, the MKLDNN issue just happened to be causing a problem in my specific situation. Not sure if there is some good way to synchronize the two or figure out something more OS independent. Why do we need the two shell scripts at all instead of just python? A lot of overhead with environment variables and command line parsing that could be avoided.\n\nCheers", "body": "Hi Everybody!\r\n\r\nError in windows build if mkldnn is enabled because `build_pytorch_libs.bat` doesn't understand the argument `--with-mkldnn`. This argument works on Linux but not Win. This PR fixes the windows build so it can use MKLDNN.\r\n\r\nI synced the command line parsing and the ATen cmake command between the batch script and the bash script. It looks like ATen is now correctly building with MKLDNN on Windows.\r\n- https://github.com/pytorch/pytorch/blob/master/tools/build_pytorch_libs.sh\r\n- https://github.com/pytorch/pytorch/blob/master/tools/build_pytorch_libs.bat\r\n\r\nWarning: I just brought in all of the options from Linux build that were missing in the Windows build, so I'm trusting that that code is correct. Would appreciate if anyone can give them a once-over.\r\n- Not sure about whether `ATEN_NO_CONTRIB` and `CMAKE_EXPORT_COMPILE_COMMANDS` should be set or not. The latter shouldn't really matter but the former might make a difference.\r\n- I added the command line parsing for gloo and distributed-mw while I was putting in mkldnn but these are not fully implemented. Maybe should print a warning or something. \r\n- The other build commands in that script probably also need some work, the MKLDNN issue just happened to be causing a problem in my specific situation. Not sure if there is some good way to synchronize the two or figure out something more OS independent. Why do we need the two shell scripts at all instead of just python? A lot of overhead with environment variables and command line parsing that could be avoided.\r\n\r\nCheers"}