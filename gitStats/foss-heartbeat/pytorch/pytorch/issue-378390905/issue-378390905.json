{"url": "https://api.github.com/repos/pytorch/pytorch/issues/13672", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/13672/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/13672/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/13672/events", "html_url": "https://github.com/pytorch/pytorch/pull/13672", "id": 378390905, "node_id": "MDExOlB1bGxSZXF1ZXN0MjI5MTA3ODQ3", "number": 13672, "title": "Fix missing symbol linker error when using libtorch generated on windows :", "user": {"login": "lara-hdr", "id": 11823865, "node_id": "MDQ6VXNlcjExODIzODY1", "avatar_url": "https://avatars0.githubusercontent.com/u/11823865?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lara-hdr", "html_url": "https://github.com/lara-hdr", "followers_url": "https://api.github.com/users/lara-hdr/followers", "following_url": "https://api.github.com/users/lara-hdr/following{/other_user}", "gists_url": "https://api.github.com/users/lara-hdr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lara-hdr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lara-hdr/subscriptions", "organizations_url": "https://api.github.com/users/lara-hdr/orgs", "repos_url": "https://api.github.com/users/lara-hdr/repos", "events_url": "https://api.github.com/users/lara-hdr/events{/privacy}", "received_events_url": "https://api.github.com/users/lara-hdr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 679953983, "node_id": "MDU6TGFiZWw2Nzk5NTM5ODM=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/jit", "name": "jit", "color": "c5def5", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-11-07T17:25:43Z", "updated_at": "2018-11-14T20:04:15Z", "closed_at": "2018-11-14T20:04:15Z", "author_association": "NONE", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/13672", "html_url": "https://github.com/pytorch/pytorch/pull/13672", "diff_url": "https://github.com/pytorch/pytorch/pull/13672.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/13672.patch"}, "body_html": "<p>Libtorch is missing some symbols when generated on windows, causing linker errors when using it.</p>\n<p>It seems like there were some issues in the past with enabling   CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS to export all symbols during the build.<br>\n(See the link below :<br>\n- Enabling CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS :  <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"272788609\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/3617\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/3617/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/3617\">#3617</a><br>\n- Disabling CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS :  <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"337375967\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/9092\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/9092/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/9092\">#9092</a> and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"343419752\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/9693\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/9693/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/9693\">#9693</a> )</p>\n<p>So enabling CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS is not an option. But some symbols are still missing for Libtorch to be working.<br>\nWe added some functions to TORCH_API in this PR, but we might be missing some.<br>\n(We also tried adding the whole structure Method  (struct TORCH_API Method { ... }) instead of adding the functions separately, but the build fails with a \"one or more multiply defined symbols found\" error)</p>\n<p>Do you have any recommendations on how to detect functions that should/shouldn't be in TORCH_API, so the build is successful and the generated Libtorch has all the required exported symbols?</p>\n<p>I also attached toch_exports_missing.txt, which contains the symbols that are exported with the CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS flag enabled but not in the current Libtorch version.<br>\n( by generating the output for both torch.dll libraries with \"dumpbin /EXPORTS torch.dll\" and comparing both outputs and generating the difference)<br>\nSo any symbol that could be missing from Libtorch should be in this list, but the list has more than 8000 symbols, and I am not sure which ones require to be exported and added to TORCH_API.</p>\n<p>This PR currently exports the missing symbols for torch::jit::script::Method that appears in the attached list (in the exception of defaultSchemaFor, and emit_call_to that cause a \"multiply defined symbols\" error).</p>\n<p><a href=\"https://github.com/pytorch/pytorch/files/2558466/torch_exports_missing.txt\">torch_exports_missing.txt</a></p>", "body_text": "Libtorch is missing some symbols when generated on windows, causing linker errors when using it.\nIt seems like there were some issues in the past with enabling   CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS to export all symbols during the build.\n(See the link below :\n- Enabling CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS :  #3617\n- Disabling CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS :  #9092 and #9693 )\nSo enabling CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS is not an option. But some symbols are still missing for Libtorch to be working.\nWe added some functions to TORCH_API in this PR, but we might be missing some.\n(We also tried adding the whole structure Method  (struct TORCH_API Method { ... }) instead of adding the functions separately, but the build fails with a \"one or more multiply defined symbols found\" error)\nDo you have any recommendations on how to detect functions that should/shouldn't be in TORCH_API, so the build is successful and the generated Libtorch has all the required exported symbols?\nI also attached toch_exports_missing.txt, which contains the symbols that are exported with the CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS flag enabled but not in the current Libtorch version.\n( by generating the output for both torch.dll libraries with \"dumpbin /EXPORTS torch.dll\" and comparing both outputs and generating the difference)\nSo any symbol that could be missing from Libtorch should be in this list, but the list has more than 8000 symbols, and I am not sure which ones require to be exported and added to TORCH_API.\nThis PR currently exports the missing symbols for torch::jit::script::Method that appears in the attached list (in the exception of defaultSchemaFor, and emit_call_to that cause a \"multiply defined symbols\" error).\ntorch_exports_missing.txt", "body": "Libtorch is missing some symbols when generated on windows, causing linker errors when using it.\r\n\r\nIt seems like there were some issues in the past with enabling   CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS to export all symbols during the build.\r\n(See the link below :\r\n    - Enabling CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS :  https://github.com/pytorch/pytorch/pull/3617?fbclid=IwAR084kOPgLUvYjpJMvGG_Q22IPcvmzlywamytdhxd5U3hELkESO6yM8BGfo  \r\n    - Disabling CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS :  https://github.com/pytorch/pytorch/issues/9092?fbclid=IwAR0QSeEcXNh8A1zrgCQvsEq-0S0GJvHBywhZ6kDvoHe6TeRUsTNRzzgXea0 and https://github.com/pytorch/pytorch/pull/9693?fbclid=IwAR2cSya4fbeHvF-BYkXk2NesXjQ3ZWg9vHJ3ivrT9GDJYqHSpg518KAMzW8 )\r\n\t\r\nSo enabling CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS is not an option. But some symbols are still missing for Libtorch to be working.\r\nWe added some functions to TORCH_API in this PR, but we might be missing some.\r\n(We also tried adding the whole structure Method  (struct TORCH_API Method { ... }) instead of adding the functions separately, but the build fails with a \"one or more multiply defined symbols found\" error)\r\n\r\nDo you have any recommendations on how to detect functions that should/shouldn't be in TORCH_API, so the build is successful and the generated Libtorch has all the required exported symbols?\r\n\r\nI also attached toch_exports_missing.txt, which contains the symbols that are exported with the CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS flag enabled but not in the current Libtorch version.\r\n( by generating the output for both torch.dll libraries with \"dumpbin /EXPORTS torch.dll\" and comparing both outputs and generating the difference)\r\nSo any symbol that could be missing from Libtorch should be in this list, but the list has more than 8000 symbols, and I am not sure which ones require to be exported and added to TORCH_API.\r\n\r\nThis PR currently exports the missing symbols for torch::jit::script::Method that appears in the attached list (in the exception of defaultSchemaFor, and emit_call_to that cause a \"multiply defined symbols\" error).\r\n\r\n\r\n[torch_exports_missing.txt](https://github.com/pytorch/pytorch/files/2558466/torch_exports_missing.txt)\r\n"}