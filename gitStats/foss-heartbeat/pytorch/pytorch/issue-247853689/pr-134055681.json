{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/2288", "id": 134055681, "node_id": "MDExOlB1bGxSZXF1ZXN0MTM0MDU1Njgx", "html_url": "https://github.com/pytorch/pytorch/pull/2288", "diff_url": "https://github.com/pytorch/pytorch/pull/2288.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/2288.patch", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/2288", "number": 2288, "state": "closed", "locked": false, "title": "ATen in THD (Part I)", "user": {"login": "killeent", "id": 4529377, "node_id": "MDQ6VXNlcjQ1MjkzNzc=", "avatar_url": "https://avatars1.githubusercontent.com/u/4529377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/killeent", "html_url": "https://github.com/killeent", "followers_url": "https://api.github.com/users/killeent/followers", "following_url": "https://api.github.com/users/killeent/following{/other_user}", "gists_url": "https://api.github.com/users/killeent/gists{/gist_id}", "starred_url": "https://api.github.com/users/killeent/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/killeent/subscriptions", "organizations_url": "https://api.github.com/users/killeent/orgs", "repos_url": "https://api.github.com/users/killeent/repos", "events_url": "https://api.github.com/users/killeent/events{/privacy}", "received_events_url": "https://api.github.com/users/killeent/received_events", "type": "User", "site_admin": false}, "body": "First of two diffs to port `THD` from `THPP` to `ATen`. This pull request replaces all uses of `thpp::[Tensor|Storage|Generator]` with their ATen equivalents. Some important consequences of this change:\r\n\r\n- At the `module` level in `csrc/`, we are passing around ATen tensors so we no longer have to wrap them in smart pointers to manage the memory, instead we let the ATen Tensor refcounting do the work for us. Similarly, we are passing around ATen Tensors (usually by reference) in THD\r\n- I had to manually port over a bunch of functions to their ATen equivalents. This was pretty annoying as the THPP versions were not consistent with `TH` argument ordering. Additionally, there were a few functions without ATen implementations that I omitted\r\n- I sort of broke the whole C API thing by exposing at::Tensor as the `TensorDescriptor` outside of `_THD_CORE`. But we have a plan to get rid of this anyway.\r\n\r\nFUTURE STEPS:\r\n\r\n- This diff doesn't replace `thpp::Type` with an ATen equivalent for passing type messages around. This will come in the second diff, which will fully eliminate the use of THPP\r\n- Automatic generation of all of the methods from `cwrap` - this is way *way* better than handwriting these, and we will get them for free. These methods are (afaik) untested as well, so adding tests for them would be useful\r\n- As mentioned, moving to a cleaner, C++ only system", "created_at": "2017-08-03T22:29:36Z", "updated_at": "2017-11-01T13:59:02Z", "closed_at": "2017-11-01T13:59:02Z", "merged_at": "2017-11-01T13:59:02Z", "merge_commit_sha": "b544882335dc0410a5927071559aa8d9526bcf7d", "assignee": null, "assignees": [], "requested_reviewers": [], "requested_teams": [], "labels": [], "milestone": null, "commits_url": "https://api.github.com/repos/pytorch/pytorch/pulls/2288/commits", "review_comments_url": "https://api.github.com/repos/pytorch/pytorch/pulls/2288/comments", "review_comment_url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments{/number}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/2288/comments", "statuses_url": "https://api.github.com/repos/pytorch/pytorch/statuses/d68f40c25298812461136b41317d472ed2ff8928", "head": {"label": "killeent:aten-thd", "ref": "aten-thd", "sha": "d68f40c25298812461136b41317d472ed2ff8928", "user": {"login": "killeent", "id": 4529377, "node_id": "MDQ6VXNlcjQ1MjkzNzc=", "avatar_url": "https://avatars1.githubusercontent.com/u/4529377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/killeent", "html_url": "https://github.com/killeent", "followers_url": "https://api.github.com/users/killeent/followers", "following_url": "https://api.github.com/users/killeent/following{/other_user}", "gists_url": "https://api.github.com/users/killeent/gists{/gist_id}", "starred_url": "https://api.github.com/users/killeent/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/killeent/subscriptions", "organizations_url": "https://api.github.com/users/killeent/orgs", "repos_url": "https://api.github.com/users/killeent/repos", "events_url": "https://api.github.com/users/killeent/events{/privacy}", "received_events_url": "https://api.github.com/users/killeent/received_events", "type": "User", "site_admin": false}, "repo": {"id": 83581678, "node_id": "MDEwOlJlcG9zaXRvcnk4MzU4MTY3OA==", "name": "pytorch", "full_name": "killeent/pytorch", "private": false, "owner": {"login": "killeent", "id": 4529377, "node_id": "MDQ6VXNlcjQ1MjkzNzc=", "avatar_url": "https://avatars1.githubusercontent.com/u/4529377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/killeent", "html_url": "https://github.com/killeent", "followers_url": "https://api.github.com/users/killeent/followers", "following_url": "https://api.github.com/users/killeent/following{/other_user}", "gists_url": "https://api.github.com/users/killeent/gists{/gist_id}", "starred_url": "https://api.github.com/users/killeent/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/killeent/subscriptions", "organizations_url": "https://api.github.com/users/killeent/orgs", "repos_url": "https://api.github.com/users/killeent/repos", "events_url": "https://api.github.com/users/killeent/events{/privacy}", "received_events_url": "https://api.github.com/users/killeent/received_events", "type": "User", "site_admin": false}, "html_url": "https://github.com/killeent/pytorch", "description": "Tensors and Dynamic neural networks in Python  with strong GPU acceleration", "fork": true, "url": "https://api.github.com/repos/killeent/pytorch", "forks_url": "https://api.github.com/repos/killeent/pytorch/forks", "keys_url": "https://api.github.com/repos/killeent/pytorch/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/killeent/pytorch/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/killeent/pytorch/teams", "hooks_url": "https://api.github.com/repos/killeent/pytorch/hooks", "issue_events_url": "https://api.github.com/repos/killeent/pytorch/issues/events{/number}", "events_url": "https://api.github.com/repos/killeent/pytorch/events", "assignees_url": "https://api.github.com/repos/killeent/pytorch/assignees{/user}", "branches_url": "https://api.github.com/repos/killeent/pytorch/branches{/branch}", "tags_url": "https://api.github.com/repos/killeent/pytorch/tags", "blobs_url": "https://api.github.com/repos/killeent/pytorch/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/killeent/pytorch/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/killeent/pytorch/git/refs{/sha}", "trees_url": "https://api.github.com/repos/killeent/pytorch/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/killeent/pytorch/statuses/{sha}", "languages_url": "https://api.github.com/repos/killeent/pytorch/languages", "stargazers_url": "https://api.github.com/repos/killeent/pytorch/stargazers", "contributors_url": "https://api.github.com/repos/killeent/pytorch/contributors", "subscribers_url": "https://api.github.com/repos/killeent/pytorch/subscribers", "subscription_url": "https://api.github.com/repos/killeent/pytorch/subscription", "commits_url": "https://api.github.com/repos/killeent/pytorch/commits{/sha}", "git_commits_url": "https://api.github.com/repos/killeent/pytorch/git/commits{/sha}", "comments_url": "https://api.github.com/repos/killeent/pytorch/comments{/number}", "issue_comment_url": "https://api.github.com/repos/killeent/pytorch/issues/comments{/number}", "contents_url": "https://api.github.com/repos/killeent/pytorch/contents/{+path}", "compare_url": "https://api.github.com/repos/killeent/pytorch/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/killeent/pytorch/merges", "archive_url": "https://api.github.com/repos/killeent/pytorch/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/killeent/pytorch/downloads", "issues_url": "https://api.github.com/repos/killeent/pytorch/issues{/number}", "pulls_url": "https://api.github.com/repos/killeent/pytorch/pulls{/number}", "milestones_url": "https://api.github.com/repos/killeent/pytorch/milestones{/number}", "notifications_url": "https://api.github.com/repos/killeent/pytorch/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/killeent/pytorch/labels{/name}", "releases_url": "https://api.github.com/repos/killeent/pytorch/releases{/id}", "deployments_url": "https://api.github.com/repos/killeent/pytorch/deployments", "created_at": "2017-03-01T17:25:53Z", "updated_at": "2017-03-01T17:25:57Z", "pushed_at": "2017-11-06T17:02:28Z", "git_url": "git://github.com/killeent/pytorch.git", "ssh_url": "git@github.com:killeent/pytorch.git", "clone_url": "https://github.com/killeent/pytorch.git", "svn_url": "https://github.com/killeent/pytorch", "homepage": "http://pytorch.org", "size": 23249, "stargazers_count": 0, "watchers_count": 0, "language": "Python", "has_issues": false, "has_projects": true, "has_downloads": true, "has_wiki": true, "has_pages": false, "forks_count": 0, "mirror_url": null, "archived": false, "open_issues_count": 0, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "forks": 0, "open_issues": 0, "watchers": 0, "default_branch": "master"}}, "base": {"label": "pytorch:master", "ref": "master", "sha": "8cc30e489542ad053622f699d0010608d00f9c7f", "user": {"login": "pytorch", "id": 21003710, "node_id": "MDEyOk9yZ2FuaXphdGlvbjIxMDAzNzEw", "avatar_url": "https://avatars3.githubusercontent.com/u/21003710?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pytorch", "html_url": "https://github.com/pytorch", "followers_url": "https://api.github.com/users/pytorch/followers", "following_url": "https://api.github.com/users/pytorch/following{/other_user}", "gists_url": "https://api.github.com/users/pytorch/gists{/gist_id}", "starred_url": "https://api.github.com/users/pytorch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pytorch/subscriptions", "organizations_url": "https://api.github.com/users/pytorch/orgs", "repos_url": "https://api.github.com/users/pytorch/repos", "events_url": "https://api.github.com/users/pytorch/events{/privacy}", "received_events_url": "https://api.github.com/users/pytorch/received_events", "type": "Organization", "site_admin": false}, "repo": {"id": 65600975, "node_id": "MDEwOlJlcG9zaXRvcnk2NTYwMDk3NQ==", "name": "pytorch", "full_name": "pytorch/pytorch", "private": false, "owner": {"login": "pytorch", "id": 21003710, "node_id": "MDEyOk9yZ2FuaXphdGlvbjIxMDAzNzEw", "avatar_url": "https://avatars3.githubusercontent.com/u/21003710?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pytorch", "html_url": "https://github.com/pytorch", "followers_url": "https://api.github.com/users/pytorch/followers", "following_url": "https://api.github.com/users/pytorch/following{/other_user}", "gists_url": "https://api.github.com/users/pytorch/gists{/gist_id}", "starred_url": "https://api.github.com/users/pytorch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pytorch/subscriptions", "organizations_url": "https://api.github.com/users/pytorch/orgs", "repos_url": "https://api.github.com/users/pytorch/repos", "events_url": "https://api.github.com/users/pytorch/events{/privacy}", "received_events_url": "https://api.github.com/users/pytorch/received_events", "type": "Organization", "site_admin": false}, "html_url": "https://github.com/pytorch/pytorch", "description": "Tensors and Dynamic neural networks in Python  with strong GPU acceleration", "fork": false, "url": "https://api.github.com/repos/pytorch/pytorch", "forks_url": "https://api.github.com/repos/pytorch/pytorch/forks", "keys_url": "https://api.github.com/repos/pytorch/pytorch/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/pytorch/pytorch/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/pytorch/pytorch/teams", "hooks_url": "https://api.github.com/repos/pytorch/pytorch/hooks", "issue_events_url": "https://api.github.com/repos/pytorch/pytorch/issues/events{/number}", "events_url": "https://api.github.com/repos/pytorch/pytorch/events", "assignees_url": "https://api.github.com/repos/pytorch/pytorch/assignees{/user}", "branches_url": "https://api.github.com/repos/pytorch/pytorch/branches{/branch}", "tags_url": "https://api.github.com/repos/pytorch/pytorch/tags", "blobs_url": "https://api.github.com/repos/pytorch/pytorch/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/pytorch/pytorch/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/pytorch/pytorch/git/refs{/sha}", "trees_url": "https://api.github.com/repos/pytorch/pytorch/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/pytorch/pytorch/statuses/{sha}", "languages_url": "https://api.github.com/repos/pytorch/pytorch/languages", "stargazers_url": "https://api.github.com/repos/pytorch/pytorch/stargazers", "contributors_url": "https://api.github.com/repos/pytorch/pytorch/contributors", "subscribers_url": "https://api.github.com/repos/pytorch/pytorch/subscribers", "subscription_url": "https://api.github.com/repos/pytorch/pytorch/subscription", "commits_url": "https://api.github.com/repos/pytorch/pytorch/commits{/sha}", "git_commits_url": "https://api.github.com/repos/pytorch/pytorch/git/commits{/sha}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/comments{/number}", "issue_comment_url": "https://api.github.com/repos/pytorch/pytorch/issues/comments{/number}", "contents_url": "https://api.github.com/repos/pytorch/pytorch/contents/{+path}", "compare_url": "https://api.github.com/repos/pytorch/pytorch/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/pytorch/pytorch/merges", "archive_url": "https://api.github.com/repos/pytorch/pytorch/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/pytorch/pytorch/downloads", "issues_url": "https://api.github.com/repos/pytorch/pytorch/issues{/number}", "pulls_url": "https://api.github.com/repos/pytorch/pytorch/pulls{/number}", "milestones_url": "https://api.github.com/repos/pytorch/pytorch/milestones{/number}", "notifications_url": "https://api.github.com/repos/pytorch/pytorch/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/pytorch/pytorch/labels{/name}", "releases_url": "https://api.github.com/repos/pytorch/pytorch/releases{/id}", "deployments_url": "https://api.github.com/repos/pytorch/pytorch/deployments", "created_at": "2016-08-13T05:26:41Z", "updated_at": "2018-11-24T14:27:35Z", "pushed_at": "2018-11-24T12:42:01Z", "git_url": "git://github.com/pytorch/pytorch.git", "ssh_url": "git@github.com:pytorch/pytorch.git", "clone_url": "https://github.com/pytorch/pytorch.git", "svn_url": "https://github.com/pytorch/pytorch", "homepage": "http://pytorch.org", "size": 89656, "stargazers_count": 21591, "watchers_count": 21591, "language": "C++", "has_issues": true, "has_projects": true, "has_downloads": true, "has_wiki": true, "has_pages": false, "forks_count": 5154, "mirror_url": null, "archived": false, "open_issues_count": 2196, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "forks": 5154, "open_issues": 2196, "watchers": 21591, "default_branch": "master"}}, "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/2288"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/2288"}, "issue": {"href": "https://api.github.com/repos/pytorch/pytorch/issues/2288"}, "comments": {"href": "https://api.github.com/repos/pytorch/pytorch/issues/2288/comments"}, "review_comments": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/2288/comments"}, "review_comment": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments{/number}"}, "commits": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/2288/commits"}, "statuses": {"href": "https://api.github.com/repos/pytorch/pytorch/statuses/d68f40c25298812461136b41317d472ed2ff8928"}}, "author_association": "CONTRIBUTOR", "body_html": "<p>First of two diffs to port <code>THD</code> from <code>THPP</code> to <code>ATen</code>. This pull request replaces all uses of <code>thpp::[Tensor|Storage|Generator]</code> with their ATen equivalents. Some important consequences of this change:</p>\n<ul>\n<li>At the <code>module</code> level in <code>csrc/</code>, we are passing around ATen tensors so we no longer have to wrap them in smart pointers to manage the memory, instead we let the ATen Tensor refcounting do the work for us. Similarly, we are passing around ATen Tensors (usually by reference) in THD</li>\n<li>I had to manually port over a bunch of functions to their ATen equivalents. This was pretty annoying as the THPP versions were not consistent with <code>TH</code> argument ordering. Additionally, there were a few functions without ATen implementations that I omitted</li>\n<li>I sort of broke the whole C API thing by exposing at::Tensor as the <code>TensorDescriptor</code> outside of <code>_THD_CORE</code>. But we have a plan to get rid of this anyway.</li>\n</ul>\n<p>FUTURE STEPS:</p>\n<ul>\n<li>This diff doesn't replace <code>thpp::Type</code> with an ATen equivalent for passing type messages around. This will come in the second diff, which will fully eliminate the use of THPP</li>\n<li>Automatic generation of all of the methods from <code>cwrap</code> - this is way <em>way</em> better than handwriting these, and we will get them for free. These methods are (afaik) untested as well, so adding tests for them would be useful</li>\n<li>As mentioned, moving to a cleaner, C++ only system</li>\n</ul>", "body_text": "First of two diffs to port THD from THPP to ATen. This pull request replaces all uses of thpp::[Tensor|Storage|Generator] with their ATen equivalents. Some important consequences of this change:\n\nAt the module level in csrc/, we are passing around ATen tensors so we no longer have to wrap them in smart pointers to manage the memory, instead we let the ATen Tensor refcounting do the work for us. Similarly, we are passing around ATen Tensors (usually by reference) in THD\nI had to manually port over a bunch of functions to their ATen equivalents. This was pretty annoying as the THPP versions were not consistent with TH argument ordering. Additionally, there were a few functions without ATen implementations that I omitted\nI sort of broke the whole C API thing by exposing at::Tensor as the TensorDescriptor outside of _THD_CORE. But we have a plan to get rid of this anyway.\n\nFUTURE STEPS:\n\nThis diff doesn't replace thpp::Type with an ATen equivalent for passing type messages around. This will come in the second diff, which will fully eliminate the use of THPP\nAutomatic generation of all of the methods from cwrap - this is way way better than handwriting these, and we will get them for free. These methods are (afaik) untested as well, so adding tests for them would be useful\nAs mentioned, moving to a cleaner, C++ only system", "merged": true, "mergeable": null, "rebaseable": null, "mergeable_state": "unknown", "merged_by": {"login": "soumith", "id": 1310570, "node_id": "MDQ6VXNlcjEzMTA1NzA=", "avatar_url": "https://avatars0.githubusercontent.com/u/1310570?v=4", "gravatar_id": "", "url": "https://api.github.com/users/soumith", "html_url": "https://github.com/soumith", "followers_url": "https://api.github.com/users/soumith/followers", "following_url": "https://api.github.com/users/soumith/following{/other_user}", "gists_url": "https://api.github.com/users/soumith/gists{/gist_id}", "starred_url": "https://api.github.com/users/soumith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/soumith/subscriptions", "organizations_url": "https://api.github.com/users/soumith/orgs", "repos_url": "https://api.github.com/users/soumith/repos", "events_url": "https://api.github.com/users/soumith/events{/privacy}", "received_events_url": "https://api.github.com/users/soumith/received_events", "type": "User", "site_admin": false}, "comments": 0, "review_comments": 0, "maintainer_can_modify": false, "commits": 12, "additions": 1137, "deletions": 1138, "changed_files": 32}