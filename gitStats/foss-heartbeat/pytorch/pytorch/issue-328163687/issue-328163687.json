{"url": "https://api.github.com/repos/pytorch/pytorch/issues/7988", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/7988/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/7988/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/7988/events", "html_url": "https://github.com/pytorch/pytorch/pull/7988", "id": 328163687, "node_id": "MDExOlB1bGxSZXF1ZXN0MTkxNzczMjQ5", "number": 7988, "title": "Revert \"Set smaller grain size for some cases\"", "user": {"login": "ezyang", "id": 13564, "node_id": "MDQ6VXNlcjEzNTY0", "avatar_url": "https://avatars0.githubusercontent.com/u/13564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ezyang", "html_url": "https://github.com/ezyang", "followers_url": "https://api.github.com/users/ezyang/followers", "following_url": "https://api.github.com/users/ezyang/following{/other_user}", "gists_url": "https://api.github.com/users/ezyang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ezyang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ezyang/subscriptions", "organizations_url": "https://api.github.com/users/ezyang/orgs", "repos_url": "https://api.github.com/users/ezyang/repos", "events_url": "https://api.github.com/users/ezyang/events{/privacy}", "received_events_url": "https://api.github.com/users/ezyang/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-05-31T14:32:12Z", "updated_at": "2018-09-20T16:55:43Z", "closed_at": "2018-05-31T19:24:03Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/7988", "html_url": "https://github.com/pytorch/pytorch/pull/7988", "diff_url": "https://github.com/pytorch/pytorch/pull/7988.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/7988.patch"}, "body_html": "<p>Reverts <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"327561033\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/7941\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/7941/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/7941\">#7941</a></p>\n<p>I am guessing this PR is the cause of the sporadic ASAN failures in master, see <a href=\"https://ci.pytorch.org/jenkins/job/pytorch-builds/job/pytorch-linux-xenial-py3-clang5-asan-test/4957//console\" rel=\"nofollow\">https://ci.pytorch.org/jenkins/job/pytorch-builds/job/pytorch-linux-xenial-py3-clang5-asan-test/4957//console</a> <a href=\"https://ci.pytorch.org/jenkins/job/pytorch-builds/job/pytorch-linux-xenial-py3-clang5-asan-test/4960//console\" rel=\"nofollow\">https://ci.pytorch.org/jenkins/job/pytorch-builds/job/pytorch-linux-xenial-py3-clang5-asan-test/4960//console</a> <a href=\"https://ci.pytorch.org/jenkins/job/pytorch-builds/job/pytorch-linux-xenial-py3-clang5-asan-test/4994//console\" rel=\"nofollow\">https://ci.pytorch.org/jenkins/job/pytorch-builds/job/pytorch-linux-xenial-py3-clang5-asan-test/4994//console</a> <a href=\"https://ci.pytorch.org/jenkins/job/pytorch-builds/job/pytorch-linux-xenial-py3-clang5-asan-test/5004//console\" rel=\"nofollow\">https://ci.pytorch.org/jenkins/job/pytorch-builds/job/pytorch-linux-xenial-py3-clang5-asan-test/5004//console</a></p>\n<pre><code>22:57:04 =================================================================\n22:57:04 ==584==ERROR: AddressSanitizer: heap-use-after-free on address 0x61600058004a at pc 0x7fab807f0464 bp 0x7fab5a9cde30 sp 0x7fab5a9cde28\n22:57:04 READ of size 1 at 0x61600058004a thread T6\n22:57:05     #0 0x7fab807f0463 in tbb::internal::generic_scheduler::is_worker() const /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.h:571:26\n22:57:05     #1 0x7fab807f0463 in tbb::internal::generic_scheduler::master_outermost_level() const /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.h:551\n22:57:05     #2 0x7fab807f0463 in tbb::task_scheduler_init::internal_terminate(bool) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/governor.cpp:349\n22:57:05     #3 0x7fab807f0463 in tbb::task_scheduler_init::terminate() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/governor.cpp:359\n22:57:05     #4 0x7fab7eb9d0c0 in tbb::task_scheduler_init::~task_scheduler_init() /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/task_scheduler_init.h:132:13\n22:57:05     #5 0x7fab93ed7cce in (anonymous namespace)::run(void*) /opt/conda/conda-bld/compilers_linux-64_1520532893746/work/.build/src/gcc-7.2.0/libstdc++-v3/libsupc++/atexit_thread.cc:75\n22:57:05     #6 0x7fab94e67438 in __nptl_deallocate_tsd.part.4 (/lib/x86_64-linux-gnu/libpthread.so.0+0x6438)\n22:57:05     #7 0x7fab94e6886f in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x786f)\n22:57:05     #8 0x7fab94b9e41c in clone /build/glibc-Cl5G7W/glibc-2.23/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:109\n22:57:05 \n22:57:05 0x61600058004a is located 202 bytes inside of 520-byte region [0x61600057ff80,0x616000580188)\n22:57:05 freed by thread T6 here:\n22:57:05     #0 0x7fab95185cc0 in __interceptor_cfree (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x107cc0)\n22:57:05     #1 0x7fab807fd89d in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:285:15\n22:57:05     #2 0x7fab807fd258 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\n22:57:05     #3 0x7fab94e686b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\n22:57:05 \n22:57:05 previously allocated by thread T6 here:\n22:57:05     #0 0x7fab95185e88 in malloc (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x107e88)\n22:57:05     #1 0x7fab807ec580 in tbb::internal::padded_allocate(unsigned long, unsigned long) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/cache_aligned_allocator.cpp:210:43\n22:57:05     #2 0x7fab807ec758 in tbb::internal::NFS_Allocate(unsigned long, unsigned long, void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/cache_aligned_allocator.cpp:196:20\n22:57:05     #3 0x7fab8080612a in tbb::internal::custom_scheduler&lt;tbb::internal::IntelSchedulerTraits&gt;::allocate_scheduler(tbb::internal::market&amp;) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/custom_scheduler.h:118:19\n22:57:05     #4 0x7fab80804c03 in tbb::internal::allocate_scheduler(tbb::internal::market&amp;) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:42:12\n22:57:05     #5 0x7fab80804c03 in tbb::internal::generic_scheduler::create_worker(tbb::internal::market&amp;, unsigned long) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:1147\n22:57:05     #6 0x7fab807fb1ee in tbb::internal::market::create_one_job() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/market.cpp:747:28\n22:57:05     #7 0x7fab807fd355 in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:267:32\n22:57:05     #8 0x7fab807fd258 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\n22:57:05     #9 0x7fab94e686b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\n22:57:05 \n22:57:05 Thread T6 created by T4 here:\n22:57:05     #0 0x7fab950dd3cd in pthread_create (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x5f3cd)\n22:57:05     #1 0x7fab807feeaa in rml::internal::thread_monitor::launch(void* (*)(void*), void*, unsigned long) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/src/rml/include/../server/thread_monitor.h:221:12\n22:57:05     #2 0x7fab807fe9ef in tbb::internal::rml::private_worker::wake_or_launch() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:300:21\n22:57:05     #3 0x7fab807fe707 in tbb::internal::rml::private_server::wake_some(int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:394:17\n22:57:05     #4 0x7fab807fd2ff in tbb::internal::rml::private_server::propagate_chain_reaction() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:161:13\n22:57:05     #5 0x7fab807fd2ff in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:261\n22:57:05     #6 0x7fab807fd258 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\n22:57:05     #7 0x7fab94e686b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\n22:57:05 \n22:57:05 Thread T4 created by T0 here:\n22:57:05     #0 0x7fab950dd3cd in pthread_create (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x5f3cd)\n22:57:05     #1 0x7fab807feeaa in rml::internal::thread_monitor::launch(void* (*)(void*), void*, unsigned long) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/src/rml/include/../server/thread_monitor.h:221:12\n22:57:05     #2 0x7fab807fe9ef in tbb::internal::rml::private_worker::wake_or_launch() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:300:21\n22:57:05     #3 0x7fab807fe707 in tbb::internal::rml::private_server::wake_some(int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:394:17\n22:57:05     #4 0x7fab80801684 in tbb::internal::generic_scheduler::local_spawn(tbb::task*, tbb::task*&amp;) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:648:15\n22:57:05     #5 0x7fab803ceffc in tbb::interface5::internal::task_base::spawn(tbb::task&amp;) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/internal/../task.h:995:23\n22:57:05     #6 0x7fab803ceffc in tbb::interface9::internal::start_for&lt;tbb::blocked_range&lt;long&gt;, void at::parallel_for_1d&lt;void at::native::(anonymous namespace)::parallel_apply&lt;double, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1}&gt;(at::Tensor&amp;, at::Tensor const&amp;, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1})::{lambda(long, long)#1}&gt;(void at::native::(anonymous namespace)::parallel_apply&lt;double, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1}&gt;(at::Tensor&amp;, at::Tensor const&amp;, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1})::{lambda(long, long)#1}, long, long, long, bool)::{lambda(tbb::blocked_range&lt;long&gt; const&amp;)#1}, tbb::affinity_partitioner&gt;::offer_work(tbb::proportional_split&amp;) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:122\n22:57:05     #7 0x7fab803ceffc in void tbb::interface9::internal::partition_type_base&lt;tbb::interface9::internal::affinity_partition_type&gt;::execute&lt;tbb::interface9::internal::start_for&lt;tbb::blocked_range&lt;long&gt;, void at::parallel_for_1d&lt;void at::native::(anonymous namespace)::parallel_apply&lt;double, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1}&gt;(at::Tensor&amp;, at::Tensor const&amp;, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1})::{lambda(long, long)#1}&gt;(void at::native::(anonymous namespace)::parallel_apply&lt;double, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1}&gt;(at::Tensor&amp;, at::Tensor const&amp;, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1})::{lambda(long, long)#1}, long, long, long, bool)::{lambda(tbb::blocked_range&lt;long&gt; const&amp;)#1}, tbb::affinity_partitioner&gt;, tbb::blocked_range&lt;long&gt; &gt;(tbb::blocked_range&lt;long&gt;&amp;, {lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1}&amp;) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/partitioner.h:253\n22:57:05     #8 0x7fab803ceffc in tbb::interface9::internal::start_for&lt;tbb::blocked_range&lt;long&gt;, void at::parallel_for_1d&lt;void at::native::(anonymous namespace)::parallel_apply&lt;double, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1}&gt;(at::Tensor&amp;, at::Tensor const&amp;, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1})::{lambda(long, long)#1}&gt;(void at::native::(anonymous namespace)::parallel_apply&lt;double, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1}&gt;(at::Tensor&amp;, at::Tensor const&amp;, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1})::{lambda(long, long)#1}, long, long, long, bool)::{lambda(tbb::blocked_range&lt;long&gt; const&amp;)#1}, tbb::affinity_partitioner&gt;::execute() /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:143\n22:57:05     #9 0x7fab8080d375 in tbb::internal::custom_scheduler&lt;tbb::internal::IntelSchedulerTraits&gt;::local_wait_for_all(tbb::task&amp;, tbb::task*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/custom_scheduler.h:509:33\n22:57:05     #10 0x7fab80801ed0 in tbb::internal::generic_scheduler::local_spawn_root_and_wait(tbb::task*, tbb::task*&amp;) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:670:5\n22:57:05     #11 0x7fab803cdb63 in tbb::task::spawn_root_and_wait(tbb::task&amp;) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/internal/../task.h:752:30\n22:57:05     #12 0x7fab803cdb63 in _ZN3tbb10interface98internal9start_forINS_13blocked_rangeIlEEZN2at15parallel_for_1dIZNS5_6native12_GLOBAL__N_1L14parallel_applyIdZZZNS7_L11acos_kernelERNS5_6TensorERKSA_ENK3$_2clEvENKUlvE_clEvEUlRKNS5_6vec25612_GLOBAL__N_16Vec256IdEEE_EEvSB_SD_T0_EUlllE_EEvT_lllbEUlRKS4_E_NS_20affinity_partitionerEE3runESR_RKSS_RST_ /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:96\n22:57:05     #13 0x7fab803cdb63 in void tbb::parallel_for&lt;tbb::blocked_range&lt;long&gt;, void at::parallel_for_1d&lt;void at::native::(anonymous namespace)::parallel_apply&lt;double, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1}&gt;(at::Tensor&amp;, at::Tensor const&amp;, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1})::{lambda(long, long)#1}&gt;(void at::native::(anonymous namespace)::parallel_apply&lt;double, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1}&gt;(at::Tensor&amp;, at::Tensor const&amp;, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1})::{lambda(long, long)#1}, long, long, long, bool)::{lambda(tbb::blocked_range&lt;long&gt; const&amp;)#1}&gt;(void at::parallel_for_1d&lt;void at::native::(anonymous namespace)::parallel_apply&lt;double, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1}&gt;(at::Tensor&amp;, at::Tensor const&amp;, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1})::{lambda(long, long)#1}&gt;(void at::native::(anonymous namespace)::parallel_apply&lt;double, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1}&gt;(at::Tensor&amp;, at::Tensor const&amp;, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1})::{lambda(long, long)#1}, long, long, long, bool)::{lambda(tbb::blocked_range&lt;long&gt; const&amp;)#1} const&amp;, {lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1} const&amp;, tbb::affinity_partitioner&amp;) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:230\n22:57:05     #14 0x7fab803cdb63 in void at::parallel_for_1d&lt;void at::native::(anonymous namespace)::parallel_apply&lt;double, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1}&gt;(at::Tensor&amp;, at::Tensor const&amp;, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1})::{lambda(long, long)#1}&gt;(void at::native::(anonymous namespace)::parallel_apply&lt;double, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1}&gt;(at::Tensor&amp;, at::Tensor const&amp;, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1})::{lambda(long, long)#1}, long, long, long, bool) /var/lib/jenkins/workspace/aten/src/ATen/Parallel.h:49\n22:57:05     #15 0x7fab803cdb63 in void at::native::(anonymous namespace)::parallel_apply&lt;double, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1}&gt;(at::Tensor&amp;, at::Tensor const&amp;, at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256&lt;double&gt; const&amp;)#1}) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/UnaryOpsKernel.cpp.AVX2.cpp:21\n22:57:05     #16 0x7fab803cdb63 in at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const::{lambda()#1}::operator()() const /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/UnaryOpsKernel.cpp.AVX2.cpp:61\n22:57:05     #17 0x7fab803cdb63 in at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;)::$_2::operator()() const /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/UnaryOpsKernel.cpp.AVX2.cpp:61\n22:57:05     #18 0x7fab803cdb63 in at::native::acos_kernel(at::Tensor&amp;, at::Tensor const&amp;) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/UnaryOpsKernel.cpp.AVX2.cpp:61\n22:57:05     #19 0x7fab7ed661e4 in void at::native::DispatchStub&lt;void (*)(at::Tensor&amp;, at::Tensor const&amp;)&gt;::operator()&lt;at::Tensor, at::Tensor&gt;(at::Tensor, at::Tensor) /var/lib/jenkins/workspace/aten/src/ATen/native/cpu/CapabilityDispatch.h:43:5\n22:57:05     #20 0x7fab7ed661e4 in at::native::_acos_out_cpu(at::Tensor&amp;, at::Tensor const&amp;) /var/lib/jenkins/workspace/aten/src/ATen/native/UnaryOps.cpp:130\n22:57:05     #21 0x7fab7f17950e in at::CPUDoubleType::acos_out(at::Tensor&amp;, at::Tensor const&amp;) const /var/lib/jenkins/workspace/build/aten/src/ATen/CPUDoubleType.cpp:5652:13\n22:57:05     #22 0x7fab7ed4d8ce in at::acos_out(at::Tensor&amp;, at::Tensor const&amp;) /var/lib/jenkins/workspace/build/aten/src/ATen/Functions.h:2967:29\n22:57:05     #23 0x7fab7ed4d8ce in at::native::acos(at::Tensor const&amp;) /var/lib/jenkins/workspace/aten/src/ATen/native/UnaryOps.cpp:102\n22:57:05     #24 0x7fab7f3c9db0 in at::Type::acos(at::Tensor const&amp;) const /var/lib/jenkins/workspace/build/aten/src/ATen/Type.cpp:2980:13\n22:57:05     #25 0x7fab83478944 in torch::autograd::VariableType::acos(at::Tensor const&amp;) const /var/lib/jenkins/workspace/torch/csrc/autograd/generated/VariableType.cpp:21652:39\n22:57:05     #26 0x7fab83b0ac0f in at::Tensor::acos() const /var/lib/jenkins/workspace/torch/lib/tmp_install/include/ATen/TensorMethods.h:861:19\n22:57:05     #27 0x7fab83b0a80e in torch::autograd::dispatch_acos(at::Tensor const&amp;) /var/lib/jenkins/workspace/torch/csrc/autograd/generated/python_torch_functions_dispatch.h:725:15\n22:57:05     #28 0x7fab83994a02 in torch::autograd::THPVariable_acos(_object*, _object*, _object*) /var/lib/jenkins/workspace/torch/csrc/autograd/generated/python_torch_functions.cpp:1368:19\n22:57:05     #29 0x560b7cc57753 in _PyCFunction_FastCallDict (/opt/conda/bin/python3.6+0x10f753)\n22:57:05 \n22:57:05 SUMMARY: AddressSanitizer: heap-use-after-free /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.h:571:26 in tbb::internal::generic_scheduler::is_worker() const\n22:57:05 Shadow bytes around the buggy address:\n22:57:05   0x0c2c800a7fb0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n22:57:05   0x0c2c800a7fc0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n22:57:05   0x0c2c800a7fd0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n22:57:05   0x0c2c800a7fe0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n22:57:05   0x0c2c800a7ff0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n22:57:05 =&gt;0x0c2c800a8000: fd fd fd fd fd fd fd fd fd[fd]fd fd fd fd fd fd\n22:57:05   0x0c2c800a8010: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n22:57:05   0x0c2c800a8020: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n22:57:05   0x0c2c800a8030: fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n22:57:05   0x0c2c800a8040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n22:57:05   0x0c2c800a8050: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n22:57:05 Shadow byte legend (one shadow byte represents 8 application bytes):\n22:57:05   Addressable:           00\n22:57:05   Partially addressable: 01 02 03 04 05 06 07 \n22:57:05   Heap left redzone:       fa\n22:57:05   Freed heap region:       fd\n22:57:05   Stack left redzone:      f1\n22:57:05   Stack mid redzone:       f2\n22:57:05   Stack right redzone:     f3\n22:57:05   Stack after return:      f5\n22:57:05   Stack use after scope:   f8\n22:57:05   Global redzone:          f9\n22:57:05   Global init order:       f6\n22:57:05   Poisoned by user:        f7\n22:57:05   Container overflow:      fc\n22:57:05   Array cookie:            ac\n22:57:05   Intra object redzone:    bb\n22:57:05   ASan internal:           fe\n22:57:05   Left alloca redzone:     ca\n22:57:05   Right alloca redzone:    cb\n22:57:05 ==584==ABORTING\n22:57:05 Traceback (most recent call last):\n22:57:05   File \"test/run_test.py\", line 342, in &lt;module&gt;\n22:57:05     main()\n22:57:05   File \"test/run_test.py\", line 334, in main\n22:57:05     raise RuntimeError(message)\n22:57:05 RuntimeError: test_cuda failed!\n22:57:05 + cleanup\n</code></pre>\n<p>CC <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1716488\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/cpuhrsch\">@cpuhrsch</a></p>", "body_text": "Reverts #7941\nI am guessing this PR is the cause of the sporadic ASAN failures in master, see https://ci.pytorch.org/jenkins/job/pytorch-builds/job/pytorch-linux-xenial-py3-clang5-asan-test/4957//console https://ci.pytorch.org/jenkins/job/pytorch-builds/job/pytorch-linux-xenial-py3-clang5-asan-test/4960//console https://ci.pytorch.org/jenkins/job/pytorch-builds/job/pytorch-linux-xenial-py3-clang5-asan-test/4994//console https://ci.pytorch.org/jenkins/job/pytorch-builds/job/pytorch-linux-xenial-py3-clang5-asan-test/5004//console\n22:57:04 =================================================================\n22:57:04 ==584==ERROR: AddressSanitizer: heap-use-after-free on address 0x61600058004a at pc 0x7fab807f0464 bp 0x7fab5a9cde30 sp 0x7fab5a9cde28\n22:57:04 READ of size 1 at 0x61600058004a thread T6\n22:57:05     #0 0x7fab807f0463 in tbb::internal::generic_scheduler::is_worker() const /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.h:571:26\n22:57:05     #1 0x7fab807f0463 in tbb::internal::generic_scheduler::master_outermost_level() const /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.h:551\n22:57:05     #2 0x7fab807f0463 in tbb::task_scheduler_init::internal_terminate(bool) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/governor.cpp:349\n22:57:05     #3 0x7fab807f0463 in tbb::task_scheduler_init::terminate() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/governor.cpp:359\n22:57:05     #4 0x7fab7eb9d0c0 in tbb::task_scheduler_init::~task_scheduler_init() /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/task_scheduler_init.h:132:13\n22:57:05     #5 0x7fab93ed7cce in (anonymous namespace)::run(void*) /opt/conda/conda-bld/compilers_linux-64_1520532893746/work/.build/src/gcc-7.2.0/libstdc++-v3/libsupc++/atexit_thread.cc:75\n22:57:05     #6 0x7fab94e67438 in __nptl_deallocate_tsd.part.4 (/lib/x86_64-linux-gnu/libpthread.so.0+0x6438)\n22:57:05     #7 0x7fab94e6886f in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x786f)\n22:57:05     #8 0x7fab94b9e41c in clone /build/glibc-Cl5G7W/glibc-2.23/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:109\n22:57:05 \n22:57:05 0x61600058004a is located 202 bytes inside of 520-byte region [0x61600057ff80,0x616000580188)\n22:57:05 freed by thread T6 here:\n22:57:05     #0 0x7fab95185cc0 in __interceptor_cfree (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x107cc0)\n22:57:05     #1 0x7fab807fd89d in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:285:15\n22:57:05     #2 0x7fab807fd258 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\n22:57:05     #3 0x7fab94e686b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\n22:57:05 \n22:57:05 previously allocated by thread T6 here:\n22:57:05     #0 0x7fab95185e88 in malloc (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x107e88)\n22:57:05     #1 0x7fab807ec580 in tbb::internal::padded_allocate(unsigned long, unsigned long) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/cache_aligned_allocator.cpp:210:43\n22:57:05     #2 0x7fab807ec758 in tbb::internal::NFS_Allocate(unsigned long, unsigned long, void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/cache_aligned_allocator.cpp:196:20\n22:57:05     #3 0x7fab8080612a in tbb::internal::custom_scheduler<tbb::internal::IntelSchedulerTraits>::allocate_scheduler(tbb::internal::market&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/custom_scheduler.h:118:19\n22:57:05     #4 0x7fab80804c03 in tbb::internal::allocate_scheduler(tbb::internal::market&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:42:12\n22:57:05     #5 0x7fab80804c03 in tbb::internal::generic_scheduler::create_worker(tbb::internal::market&, unsigned long) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:1147\n22:57:05     #6 0x7fab807fb1ee in tbb::internal::market::create_one_job() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/market.cpp:747:28\n22:57:05     #7 0x7fab807fd355 in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:267:32\n22:57:05     #8 0x7fab807fd258 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\n22:57:05     #9 0x7fab94e686b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\n22:57:05 \n22:57:05 Thread T6 created by T4 here:\n22:57:05     #0 0x7fab950dd3cd in pthread_create (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x5f3cd)\n22:57:05     #1 0x7fab807feeaa in rml::internal::thread_monitor::launch(void* (*)(void*), void*, unsigned long) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/src/rml/include/../server/thread_monitor.h:221:12\n22:57:05     #2 0x7fab807fe9ef in tbb::internal::rml::private_worker::wake_or_launch() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:300:21\n22:57:05     #3 0x7fab807fe707 in tbb::internal::rml::private_server::wake_some(int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:394:17\n22:57:05     #4 0x7fab807fd2ff in tbb::internal::rml::private_server::propagate_chain_reaction() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:161:13\n22:57:05     #5 0x7fab807fd2ff in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:261\n22:57:05     #6 0x7fab807fd258 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\n22:57:05     #7 0x7fab94e686b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\n22:57:05 \n22:57:05 Thread T4 created by T0 here:\n22:57:05     #0 0x7fab950dd3cd in pthread_create (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x5f3cd)\n22:57:05     #1 0x7fab807feeaa in rml::internal::thread_monitor::launch(void* (*)(void*), void*, unsigned long) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/src/rml/include/../server/thread_monitor.h:221:12\n22:57:05     #2 0x7fab807fe9ef in tbb::internal::rml::private_worker::wake_or_launch() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:300:21\n22:57:05     #3 0x7fab807fe707 in tbb::internal::rml::private_server::wake_some(int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:394:17\n22:57:05     #4 0x7fab80801684 in tbb::internal::generic_scheduler::local_spawn(tbb::task*, tbb::task*&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:648:15\n22:57:05     #5 0x7fab803ceffc in tbb::interface5::internal::task_base::spawn(tbb::task&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/internal/../task.h:995:23\n22:57:05     #6 0x7fab803ceffc in tbb::interface9::internal::start_for<tbb::blocked_range<long>, void at::parallel_for_1d<void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}>(void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}, long, long, long, bool)::{lambda(tbb::blocked_range<long> const&)#1}, tbb::affinity_partitioner>::offer_work(tbb::proportional_split&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:122\n22:57:05     #7 0x7fab803ceffc in void tbb::interface9::internal::partition_type_base<tbb::interface9::internal::affinity_partition_type>::execute<tbb::interface9::internal::start_for<tbb::blocked_range<long>, void at::parallel_for_1d<void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}>(void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}, long, long, long, bool)::{lambda(tbb::blocked_range<long> const&)#1}, tbb::affinity_partitioner>, tbb::blocked_range<long> >(tbb::blocked_range<long>&, {lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/partitioner.h:253\n22:57:05     #8 0x7fab803ceffc in tbb::interface9::internal::start_for<tbb::blocked_range<long>, void at::parallel_for_1d<void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}>(void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}, long, long, long, bool)::{lambda(tbb::blocked_range<long> const&)#1}, tbb::affinity_partitioner>::execute() /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:143\n22:57:05     #9 0x7fab8080d375 in tbb::internal::custom_scheduler<tbb::internal::IntelSchedulerTraits>::local_wait_for_all(tbb::task&, tbb::task*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/custom_scheduler.h:509:33\n22:57:05     #10 0x7fab80801ed0 in tbb::internal::generic_scheduler::local_spawn_root_and_wait(tbb::task*, tbb::task*&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:670:5\n22:57:05     #11 0x7fab803cdb63 in tbb::task::spawn_root_and_wait(tbb::task&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/internal/../task.h:752:30\n22:57:05     #12 0x7fab803cdb63 in _ZN3tbb10interface98internal9start_forINS_13blocked_rangeIlEEZN2at15parallel_for_1dIZNS5_6native12_GLOBAL__N_1L14parallel_applyIdZZZNS7_L11acos_kernelERNS5_6TensorERKSA_ENK3$_2clEvENKUlvE_clEvEUlRKNS5_6vec25612_GLOBAL__N_16Vec256IdEEE_EEvSB_SD_T0_EUlllE_EEvT_lllbEUlRKS4_E_NS_20affinity_partitionerEE3runESR_RKSS_RST_ /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:96\n22:57:05     #13 0x7fab803cdb63 in void tbb::parallel_for<tbb::blocked_range<long>, void at::parallel_for_1d<void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}>(void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}, long, long, long, bool)::{lambda(tbb::blocked_range<long> const&)#1}>(void at::parallel_for_1d<void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}>(void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}, long, long, long, bool)::{lambda(tbb::blocked_range<long> const&)#1} const&, {lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1} const&, tbb::affinity_partitioner&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:230\n22:57:05     #14 0x7fab803cdb63 in void at::parallel_for_1d<void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}>(void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}, long, long, long, bool) /var/lib/jenkins/workspace/aten/src/ATen/Parallel.h:49\n22:57:05     #15 0x7fab803cdb63 in void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/UnaryOpsKernel.cpp.AVX2.cpp:21\n22:57:05     #16 0x7fab803cdb63 in at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/UnaryOpsKernel.cpp.AVX2.cpp:61\n22:57:05     #17 0x7fab803cdb63 in at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/UnaryOpsKernel.cpp.AVX2.cpp:61\n22:57:05     #18 0x7fab803cdb63 in at::native::acos_kernel(at::Tensor&, at::Tensor const&) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/UnaryOpsKernel.cpp.AVX2.cpp:61\n22:57:05     #19 0x7fab7ed661e4 in void at::native::DispatchStub<void (*)(at::Tensor&, at::Tensor const&)>::operator()<at::Tensor, at::Tensor>(at::Tensor, at::Tensor) /var/lib/jenkins/workspace/aten/src/ATen/native/cpu/CapabilityDispatch.h:43:5\n22:57:05     #20 0x7fab7ed661e4 in at::native::_acos_out_cpu(at::Tensor&, at::Tensor const&) /var/lib/jenkins/workspace/aten/src/ATen/native/UnaryOps.cpp:130\n22:57:05     #21 0x7fab7f17950e in at::CPUDoubleType::acos_out(at::Tensor&, at::Tensor const&) const /var/lib/jenkins/workspace/build/aten/src/ATen/CPUDoubleType.cpp:5652:13\n22:57:05     #22 0x7fab7ed4d8ce in at::acos_out(at::Tensor&, at::Tensor const&) /var/lib/jenkins/workspace/build/aten/src/ATen/Functions.h:2967:29\n22:57:05     #23 0x7fab7ed4d8ce in at::native::acos(at::Tensor const&) /var/lib/jenkins/workspace/aten/src/ATen/native/UnaryOps.cpp:102\n22:57:05     #24 0x7fab7f3c9db0 in at::Type::acos(at::Tensor const&) const /var/lib/jenkins/workspace/build/aten/src/ATen/Type.cpp:2980:13\n22:57:05     #25 0x7fab83478944 in torch::autograd::VariableType::acos(at::Tensor const&) const /var/lib/jenkins/workspace/torch/csrc/autograd/generated/VariableType.cpp:21652:39\n22:57:05     #26 0x7fab83b0ac0f in at::Tensor::acos() const /var/lib/jenkins/workspace/torch/lib/tmp_install/include/ATen/TensorMethods.h:861:19\n22:57:05     #27 0x7fab83b0a80e in torch::autograd::dispatch_acos(at::Tensor const&) /var/lib/jenkins/workspace/torch/csrc/autograd/generated/python_torch_functions_dispatch.h:725:15\n22:57:05     #28 0x7fab83994a02 in torch::autograd::THPVariable_acos(_object*, _object*, _object*) /var/lib/jenkins/workspace/torch/csrc/autograd/generated/python_torch_functions.cpp:1368:19\n22:57:05     #29 0x560b7cc57753 in _PyCFunction_FastCallDict (/opt/conda/bin/python3.6+0x10f753)\n22:57:05 \n22:57:05 SUMMARY: AddressSanitizer: heap-use-after-free /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.h:571:26 in tbb::internal::generic_scheduler::is_worker() const\n22:57:05 Shadow bytes around the buggy address:\n22:57:05   0x0c2c800a7fb0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n22:57:05   0x0c2c800a7fc0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n22:57:05   0x0c2c800a7fd0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n22:57:05   0x0c2c800a7fe0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n22:57:05   0x0c2c800a7ff0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n22:57:05 =>0x0c2c800a8000: fd fd fd fd fd fd fd fd fd[fd]fd fd fd fd fd fd\n22:57:05   0x0c2c800a8010: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n22:57:05   0x0c2c800a8020: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n22:57:05   0x0c2c800a8030: fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n22:57:05   0x0c2c800a8040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n22:57:05   0x0c2c800a8050: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n22:57:05 Shadow byte legend (one shadow byte represents 8 application bytes):\n22:57:05   Addressable:           00\n22:57:05   Partially addressable: 01 02 03 04 05 06 07 \n22:57:05   Heap left redzone:       fa\n22:57:05   Freed heap region:       fd\n22:57:05   Stack left redzone:      f1\n22:57:05   Stack mid redzone:       f2\n22:57:05   Stack right redzone:     f3\n22:57:05   Stack after return:      f5\n22:57:05   Stack use after scope:   f8\n22:57:05   Global redzone:          f9\n22:57:05   Global init order:       f6\n22:57:05   Poisoned by user:        f7\n22:57:05   Container overflow:      fc\n22:57:05   Array cookie:            ac\n22:57:05   Intra object redzone:    bb\n22:57:05   ASan internal:           fe\n22:57:05   Left alloca redzone:     ca\n22:57:05   Right alloca redzone:    cb\n22:57:05 ==584==ABORTING\n22:57:05 Traceback (most recent call last):\n22:57:05   File \"test/run_test.py\", line 342, in <module>\n22:57:05     main()\n22:57:05   File \"test/run_test.py\", line 334, in main\n22:57:05     raise RuntimeError(message)\n22:57:05 RuntimeError: test_cuda failed!\n22:57:05 + cleanup\n\nCC @cpuhrsch", "body": "Reverts pytorch/pytorch#7941\r\n\r\nI am guessing this PR is the cause of the sporadic ASAN failures in master, see https://ci.pytorch.org/jenkins/job/pytorch-builds/job/pytorch-linux-xenial-py3-clang5-asan-test/4957//console https://ci.pytorch.org/jenkins/job/pytorch-builds/job/pytorch-linux-xenial-py3-clang5-asan-test/4960//console https://ci.pytorch.org/jenkins/job/pytorch-builds/job/pytorch-linux-xenial-py3-clang5-asan-test/4994//console https://ci.pytorch.org/jenkins/job/pytorch-builds/job/pytorch-linux-xenial-py3-clang5-asan-test/5004//console\r\n\r\n```\r\n22:57:04 =================================================================\r\n22:57:04 ==584==ERROR: AddressSanitizer: heap-use-after-free on address 0x61600058004a at pc 0x7fab807f0464 bp 0x7fab5a9cde30 sp 0x7fab5a9cde28\r\n22:57:04 READ of size 1 at 0x61600058004a thread T6\r\n22:57:05     #0 0x7fab807f0463 in tbb::internal::generic_scheduler::is_worker() const /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.h:571:26\r\n22:57:05     #1 0x7fab807f0463 in tbb::internal::generic_scheduler::master_outermost_level() const /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.h:551\r\n22:57:05     #2 0x7fab807f0463 in tbb::task_scheduler_init::internal_terminate(bool) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/governor.cpp:349\r\n22:57:05     #3 0x7fab807f0463 in tbb::task_scheduler_init::terminate() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/governor.cpp:359\r\n22:57:05     #4 0x7fab7eb9d0c0 in tbb::task_scheduler_init::~task_scheduler_init() /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/task_scheduler_init.h:132:13\r\n22:57:05     #5 0x7fab93ed7cce in (anonymous namespace)::run(void*) /opt/conda/conda-bld/compilers_linux-64_1520532893746/work/.build/src/gcc-7.2.0/libstdc++-v3/libsupc++/atexit_thread.cc:75\r\n22:57:05     #6 0x7fab94e67438 in __nptl_deallocate_tsd.part.4 (/lib/x86_64-linux-gnu/libpthread.so.0+0x6438)\r\n22:57:05     #7 0x7fab94e6886f in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x786f)\r\n22:57:05     #8 0x7fab94b9e41c in clone /build/glibc-Cl5G7W/glibc-2.23/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:109\r\n22:57:05 \r\n22:57:05 0x61600058004a is located 202 bytes inside of 520-byte region [0x61600057ff80,0x616000580188)\r\n22:57:05 freed by thread T6 here:\r\n22:57:05     #0 0x7fab95185cc0 in __interceptor_cfree (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x107cc0)\r\n22:57:05     #1 0x7fab807fd89d in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:285:15\r\n22:57:05     #2 0x7fab807fd258 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\r\n22:57:05     #3 0x7fab94e686b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\r\n22:57:05 \r\n22:57:05 previously allocated by thread T6 here:\r\n22:57:05     #0 0x7fab95185e88 in malloc (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x107e88)\r\n22:57:05     #1 0x7fab807ec580 in tbb::internal::padded_allocate(unsigned long, unsigned long) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/cache_aligned_allocator.cpp:210:43\r\n22:57:05     #2 0x7fab807ec758 in tbb::internal::NFS_Allocate(unsigned long, unsigned long, void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/cache_aligned_allocator.cpp:196:20\r\n22:57:05     #3 0x7fab8080612a in tbb::internal::custom_scheduler<tbb::internal::IntelSchedulerTraits>::allocate_scheduler(tbb::internal::market&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/custom_scheduler.h:118:19\r\n22:57:05     #4 0x7fab80804c03 in tbb::internal::allocate_scheduler(tbb::internal::market&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:42:12\r\n22:57:05     #5 0x7fab80804c03 in tbb::internal::generic_scheduler::create_worker(tbb::internal::market&, unsigned long) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:1147\r\n22:57:05     #6 0x7fab807fb1ee in tbb::internal::market::create_one_job() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/market.cpp:747:28\r\n22:57:05     #7 0x7fab807fd355 in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:267:32\r\n22:57:05     #8 0x7fab807fd258 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\r\n22:57:05     #9 0x7fab94e686b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\r\n22:57:05 \r\n22:57:05 Thread T6 created by T4 here:\r\n22:57:05     #0 0x7fab950dd3cd in pthread_create (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x5f3cd)\r\n22:57:05     #1 0x7fab807feeaa in rml::internal::thread_monitor::launch(void* (*)(void*), void*, unsigned long) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/src/rml/include/../server/thread_monitor.h:221:12\r\n22:57:05     #2 0x7fab807fe9ef in tbb::internal::rml::private_worker::wake_or_launch() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:300:21\r\n22:57:05     #3 0x7fab807fe707 in tbb::internal::rml::private_server::wake_some(int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:394:17\r\n22:57:05     #4 0x7fab807fd2ff in tbb::internal::rml::private_server::propagate_chain_reaction() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:161:13\r\n22:57:05     #5 0x7fab807fd2ff in tbb::internal::rml::private_worker::run() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:261\r\n22:57:05     #6 0x7fab807fd258 in tbb::internal::rml::private_worker::thread_routine(void*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:223:11\r\n22:57:05     #7 0x7fab94e686b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\r\n22:57:05 \r\n22:57:05 Thread T4 created by T0 here:\r\n22:57:05     #0 0x7fab950dd3cd in pthread_create (/usr/lib/llvm-5.0/lib/clang/5.0.0/lib/linux/libclang_rt.asan-x86_64.so+0x5f3cd)\r\n22:57:05     #1 0x7fab807feeaa in rml::internal::thread_monitor::launch(void* (*)(void*), void*, unsigned long) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/src/rml/include/../server/thread_monitor.h:221:12\r\n22:57:05     #2 0x7fab807fe9ef in tbb::internal::rml::private_worker::wake_or_launch() /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:300:21\r\n22:57:05     #3 0x7fab807fe707 in tbb::internal::rml::private_server::wake_some(int) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/private_server.cpp:394:17\r\n22:57:05     #4 0x7fab80801684 in tbb::internal::generic_scheduler::local_spawn(tbb::task*, tbb::task*&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:648:15\r\n22:57:05     #5 0x7fab803ceffc in tbb::interface5::internal::task_base::spawn(tbb::task&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/internal/../task.h:995:23\r\n22:57:05     #6 0x7fab803ceffc in tbb::interface9::internal::start_for<tbb::blocked_range<long>, void at::parallel_for_1d<void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}>(void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}, long, long, long, bool)::{lambda(tbb::blocked_range<long> const&)#1}, tbb::affinity_partitioner>::offer_work(tbb::proportional_split&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:122\r\n22:57:05     #7 0x7fab803ceffc in void tbb::interface9::internal::partition_type_base<tbb::interface9::internal::affinity_partition_type>::execute<tbb::interface9::internal::start_for<tbb::blocked_range<long>, void at::parallel_for_1d<void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}>(void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}, long, long, long, bool)::{lambda(tbb::blocked_range<long> const&)#1}, tbb::affinity_partitioner>, tbb::blocked_range<long> >(tbb::blocked_range<long>&, {lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/partitioner.h:253\r\n22:57:05     #8 0x7fab803ceffc in tbb::interface9::internal::start_for<tbb::blocked_range<long>, void at::parallel_for_1d<void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}>(void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}, long, long, long, bool)::{lambda(tbb::blocked_range<long> const&)#1}, tbb::affinity_partitioner>::execute() /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:143\r\n22:57:05     #9 0x7fab8080d375 in tbb::internal::custom_scheduler<tbb::internal::IntelSchedulerTraits>::local_wait_for_all(tbb::task&, tbb::task*) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/custom_scheduler.h:509:33\r\n22:57:05     #10 0x7fab80801ed0 in tbb::internal::generic_scheduler::local_spawn_root_and_wait(tbb::task*, tbb::task*&) /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.cpp:670:5\r\n22:57:05     #11 0x7fab803cdb63 in tbb::task::spawn_root_and_wait(tbb::task&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/internal/../task.h:752:30\r\n22:57:05     #12 0x7fab803cdb63 in _ZN3tbb10interface98internal9start_forINS_13blocked_rangeIlEEZN2at15parallel_for_1dIZNS5_6native12_GLOBAL__N_1L14parallel_applyIdZZZNS7_L11acos_kernelERNS5_6TensorERKSA_ENK3$_2clEvENKUlvE_clEvEUlRKNS5_6vec25612_GLOBAL__N_16Vec256IdEEE_EEvSB_SD_T0_EUlllE_EEvT_lllbEUlRKS4_E_NS_20affinity_partitionerEE3runESR_RKSS_RST_ /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:96\r\n22:57:05     #13 0x7fab803cdb63 in void tbb::parallel_for<tbb::blocked_range<long>, void at::parallel_for_1d<void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}>(void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}, long, long, long, bool)::{lambda(tbb::blocked_range<long> const&)#1}>(void at::parallel_for_1d<void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}>(void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}, long, long, long, bool)::{lambda(tbb::blocked_range<long> const&)#1} const&, {lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1} const&, tbb::affinity_partitioner&) /var/lib/jenkins/workspace/aten/src/ATen/../../../third_party/tbb/include/tbb/parallel_for.h:230\r\n22:57:05     #14 0x7fab803cdb63 in void at::parallel_for_1d<void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}>(void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1})::{lambda(long, long)#1}, long, long, long, bool) /var/lib/jenkins/workspace/aten/src/ATen/Parallel.h:49\r\n22:57:05     #15 0x7fab803cdb63 in void at::native::(anonymous namespace)::parallel_apply<double, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}>(at::Tensor&, at::Tensor const&, at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const::{lambda(at::vec256::(anonymous namespace)::Vec256<double> const&)#1}) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/UnaryOpsKernel.cpp.AVX2.cpp:21\r\n22:57:05     #16 0x7fab803cdb63 in at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const::{lambda()#1}::operator()() const /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/UnaryOpsKernel.cpp.AVX2.cpp:61\r\n22:57:05     #17 0x7fab803cdb63 in at::native::acos_kernel(at::Tensor&, at::Tensor const&)::$_2::operator()() const /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/UnaryOpsKernel.cpp.AVX2.cpp:61\r\n22:57:05     #18 0x7fab803cdb63 in at::native::acos_kernel(at::Tensor&, at::Tensor const&) /var/lib/jenkins/workspace/build/aten/src/ATen/native/cpu/UnaryOpsKernel.cpp.AVX2.cpp:61\r\n22:57:05     #19 0x7fab7ed661e4 in void at::native::DispatchStub<void (*)(at::Tensor&, at::Tensor const&)>::operator()<at::Tensor, at::Tensor>(at::Tensor, at::Tensor) /var/lib/jenkins/workspace/aten/src/ATen/native/cpu/CapabilityDispatch.h:43:5\r\n22:57:05     #20 0x7fab7ed661e4 in at::native::_acos_out_cpu(at::Tensor&, at::Tensor const&) /var/lib/jenkins/workspace/aten/src/ATen/native/UnaryOps.cpp:130\r\n22:57:05     #21 0x7fab7f17950e in at::CPUDoubleType::acos_out(at::Tensor&, at::Tensor const&) const /var/lib/jenkins/workspace/build/aten/src/ATen/CPUDoubleType.cpp:5652:13\r\n22:57:05     #22 0x7fab7ed4d8ce in at::acos_out(at::Tensor&, at::Tensor const&) /var/lib/jenkins/workspace/build/aten/src/ATen/Functions.h:2967:29\r\n22:57:05     #23 0x7fab7ed4d8ce in at::native::acos(at::Tensor const&) /var/lib/jenkins/workspace/aten/src/ATen/native/UnaryOps.cpp:102\r\n22:57:05     #24 0x7fab7f3c9db0 in at::Type::acos(at::Tensor const&) const /var/lib/jenkins/workspace/build/aten/src/ATen/Type.cpp:2980:13\r\n22:57:05     #25 0x7fab83478944 in torch::autograd::VariableType::acos(at::Tensor const&) const /var/lib/jenkins/workspace/torch/csrc/autograd/generated/VariableType.cpp:21652:39\r\n22:57:05     #26 0x7fab83b0ac0f in at::Tensor::acos() const /var/lib/jenkins/workspace/torch/lib/tmp_install/include/ATen/TensorMethods.h:861:19\r\n22:57:05     #27 0x7fab83b0a80e in torch::autograd::dispatch_acos(at::Tensor const&) /var/lib/jenkins/workspace/torch/csrc/autograd/generated/python_torch_functions_dispatch.h:725:15\r\n22:57:05     #28 0x7fab83994a02 in torch::autograd::THPVariable_acos(_object*, _object*, _object*) /var/lib/jenkins/workspace/torch/csrc/autograd/generated/python_torch_functions.cpp:1368:19\r\n22:57:05     #29 0x560b7cc57753 in _PyCFunction_FastCallDict (/opt/conda/bin/python3.6+0x10f753)\r\n22:57:05 \r\n22:57:05 SUMMARY: AddressSanitizer: heap-use-after-free /var/lib/jenkins/workspace/third_party/tbb/src/tbb/scheduler.h:571:26 in tbb::internal::generic_scheduler::is_worker() const\r\n22:57:05 Shadow bytes around the buggy address:\r\n22:57:05   0x0c2c800a7fb0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n22:57:05   0x0c2c800a7fc0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n22:57:05   0x0c2c800a7fd0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n22:57:05   0x0c2c800a7fe0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n22:57:05   0x0c2c800a7ff0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n22:57:05 =>0x0c2c800a8000: fd fd fd fd fd fd fd fd fd[fd]fd fd fd fd fd fd\r\n22:57:05   0x0c2c800a8010: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n22:57:05   0x0c2c800a8020: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n22:57:05   0x0c2c800a8030: fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n22:57:05   0x0c2c800a8040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n22:57:05   0x0c2c800a8050: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\r\n22:57:05 Shadow byte legend (one shadow byte represents 8 application bytes):\r\n22:57:05   Addressable:           00\r\n22:57:05   Partially addressable: 01 02 03 04 05 06 07 \r\n22:57:05   Heap left redzone:       fa\r\n22:57:05   Freed heap region:       fd\r\n22:57:05   Stack left redzone:      f1\r\n22:57:05   Stack mid redzone:       f2\r\n22:57:05   Stack right redzone:     f3\r\n22:57:05   Stack after return:      f5\r\n22:57:05   Stack use after scope:   f8\r\n22:57:05   Global redzone:          f9\r\n22:57:05   Global init order:       f6\r\n22:57:05   Poisoned by user:        f7\r\n22:57:05   Container overflow:      fc\r\n22:57:05   Array cookie:            ac\r\n22:57:05   Intra object redzone:    bb\r\n22:57:05   ASan internal:           fe\r\n22:57:05   Left alloca redzone:     ca\r\n22:57:05   Right alloca redzone:    cb\r\n22:57:05 ==584==ABORTING\r\n22:57:05 Traceback (most recent call last):\r\n22:57:05   File \"test/run_test.py\", line 342, in <module>\r\n22:57:05     main()\r\n22:57:05   File \"test/run_test.py\", line 334, in main\r\n22:57:05     raise RuntimeError(message)\r\n22:57:05 RuntimeError: test_cuda failed!\r\n22:57:05 + cleanup\r\n```\r\n\r\nCC @cpuhrsch "}