{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/366288959", "html_url": "https://github.com/pytorch/pytorch/pull/5275#issuecomment-366288959", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/5275", "id": 366288959, "node_id": "MDEyOklzc3VlQ29tbWVudDM2NjI4ODk1OQ==", "user": {"login": "zou3519", "id": 5652049, "node_id": "MDQ6VXNlcjU2NTIwNDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/5652049?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zou3519", "html_url": "https://github.com/zou3519", "followers_url": "https://api.github.com/users/zou3519/followers", "following_url": "https://api.github.com/users/zou3519/following{/other_user}", "gists_url": "https://api.github.com/users/zou3519/gists{/gist_id}", "starred_url": "https://api.github.com/users/zou3519/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zou3519/subscriptions", "organizations_url": "https://api.github.com/users/zou3519/orgs", "repos_url": "https://api.github.com/users/zou3519/repos", "events_url": "https://api.github.com/users/zou3519/events{/privacy}", "received_events_url": "https://api.github.com/users/zou3519/received_events", "type": "User", "site_admin": false}, "created_at": "2018-02-16T16:41:41Z", "updated_at": "2018-02-16T16:46:24Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4583066\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/apaszke\">@apaszke</a> The problem is that <code>legacy_apply</code> calls <a href=\"https://github.com/pytorch/pytorch/blob/master/torch/csrc/autograd/python_function.cpp#L90\">wrap_outputs</a>, which looks at the C++ inputs (not the Python inputs) and checks the C++ inputs for requires_grad.</p>\n<p>The Python inputs are okay because there's some code later that zeros them out before calling the Python function on them (and we could simplify that logic by doing the change you suggested, moving that code block)</p>", "body_text": "@apaszke The problem is that legacy_apply calls wrap_outputs, which looks at the C++ inputs (not the Python inputs) and checks the C++ inputs for requires_grad.\nThe Python inputs are okay because there's some code later that zeros them out before calling the Python function on them (and we could simplify that logic by doing the change you suggested, moving that code block)", "body": "@apaszke The problem is that `legacy_apply` calls [wrap_outputs](https://github.com/pytorch/pytorch/blob/master/torch/csrc/autograd/python_function.cpp#L90), which looks at the C++ inputs (not the Python inputs) and checks the C++ inputs for requires_grad. \r\n\r\nThe Python inputs are okay because there's some code later that zeros them out before calling the Python function on them (and we could simplify that logic by doing the change you suggested, moving that code block)"}