{"url": "https://api.github.com/repos/pytorch/pytorch/issues/14211", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/14211/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/14211/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/14211/events", "html_url": "https://github.com/pytorch/pytorch/pull/14211", "id": 382462255, "node_id": "MDExOlB1bGxSZXF1ZXN0MjMyMTY1MzQy", "number": 14211, "title": "Add cost into profile observer", "user": {"login": "hx89", "id": 43588773, "node_id": "MDQ6VXNlcjQzNTg4Nzcz", "avatar_url": "https://avatars1.githubusercontent.com/u/43588773?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hx89", "html_url": "https://github.com/hx89", "followers_url": "https://api.github.com/users/hx89/followers", "following_url": "https://api.github.com/users/hx89/following{/other_user}", "gists_url": "https://api.github.com/users/hx89/gists{/gist_id}", "starred_url": "https://api.github.com/users/hx89/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hx89/subscriptions", "organizations_url": "https://api.github.com/users/hx89/orgs", "repos_url": "https://api.github.com/users/hx89/repos", "events_url": "https://api.github.com/users/hx89/events{/privacy}", "received_events_url": "https://api.github.com/users/hx89/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-11-20T01:35:57Z", "updated_at": "2018-11-20T01:35:58Z", "closed_at": null, "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/14211", "html_url": "https://github.com/pytorch/pytorch/pull/14211", "diff_url": "https://github.com/pytorch/pytorch/pull/14211.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/14211.patch"}, "body_html": "<p>Summary:<br>\n(This diff fixed the build issue in the reverted diff D10428917 by adding \"gpu\" into the test file name, other parts are the same as D10428917.)</p>\n<p>Add analytical cost into profile observer. It includes the op level cost information for each op run and net level aggregated cost information for each op type.</p>\n<p>It outputs the following information:</p>\n<ol>\n<li>analytical flops</li>\n<li>analytical bytes_read</li>\n<li>analytical bytes_written</li>\n</ol>\n<p>Example output at op level:</p>\n<pre><code>I1017 14:58:14.245978 3686541 profile_observer_gpu.cc:26] --------- Starting operator FC op#24 ---------\nI1017 14:58:14.246049 3686541 profile_observer_gpu.cc:33] Input 0: Tensor model1/embedded_encoder_inputs of type float. Dims: (17,1,256,):\nI1017 14:58:14.246109 3686541 profile_observer_gpu.cc:33] Input 1: Tensor model1/encoder/layer0/fw/milstm/i2h_w of type float. Dims: (2048,256,):\nI1017 14:58:14.246176 3686541 profile_observer_gpu.cc:33] Input 2: Tensor model1/encoder/layer0/fw/milstm/i2h_b of type float. Dims: (2048,):\nI1017 14:58:14.246217 3686541 profile_observer_gpu.cc:44] Argument 0: name: \"use_cudnn\" i: 1\nI1017 14:58:14.246271 3686541 profile_observer_gpu.cc:44] Argument 1: name: \"cudnn_exhaustive_search\" i: 0\nI1017 14:58:14.246338 3686541 profile_observer_gpu.cc:44] Argument 2: name: \"order\" s: \"NHWC\"\nI1017 14:58:14.246372 3686541 profile_observer_gpu.cc:44] Argument 3: name: \"axis\" i: 2\nI1017 14:58:14.246418 3686541 profile_observer_gpu.cc:44] Argument 4: name: \"quantization_scheme\" i: 1\nI1017 14:58:14.246470 3686541 profile_observer_gpu.cc:53] Output 0: Tensor model1/encoder/layer0/fw/milstm/i2h of type float. Dims: (17,1,2048,):\nI1017 14:58:14.246596 3686541 profile_observer_gpu.cc:61] Cost (flops, bytes_read, bytes_written):\nI1017 14:58:14.246649 3686541 profile_observer_gpu.cc:62]        17860608 2122752 139264\nI1017 14:58:14.246677 3686541 profile_observer_gpu.cc:64] --------- Finished operator FC in 0.764221 ms ---------\n</code></pre>\n<p>Example output at net level:</p>\n<pre><code>I1017 11:13:44.675585 3146691 profile_observer_gpu.cc:165] ================ Detailed stats for net model0/encoder/layer0/bw/milstm ================\nI1017 11:13:44.675662 3146691 profile_observer_gpu.cc:167] Cost (flops, bytes_read, bytes_written) per operator type:\nI1017 11:13:44.675706 3146691 profile_observer_gpu.cc:169]        20992000 42045440 81920 FC\nI1017 11:13:44.675745 3146691 profile_observer_gpu.cc:169]           20480 163840 81920 Mul\nI1017 11:13:44.675824 3146691 profile_observer_gpu.cc:169]           20480 163840 81920 Sum\nI1017 11:13:44.675878 3146691 profile_observer_gpu.cc:169]               0 0 0 ElementwiseLinear\nI1017 11:13:44.675909 3146691 profile_observer_gpu.cc:169]               0 0 0 LSTMUnit\nI1017 11:13:44.675958 3146691 profile_observer_gpu.cc:169]               0 0 0 rnn_internal_apply_link\n</code></pre>\n<p>Differential Revision: D13117066</p>", "body_text": "Summary:\n(This diff fixed the build issue in the reverted diff D10428917 by adding \"gpu\" into the test file name, other parts are the same as D10428917.)\nAdd analytical cost into profile observer. It includes the op level cost information for each op run and net level aggregated cost information for each op type.\nIt outputs the following information:\n\nanalytical flops\nanalytical bytes_read\nanalytical bytes_written\n\nExample output at op level:\nI1017 14:58:14.245978 3686541 profile_observer_gpu.cc:26] --------- Starting operator FC op#24 ---------\nI1017 14:58:14.246049 3686541 profile_observer_gpu.cc:33] Input 0: Tensor model1/embedded_encoder_inputs of type float. Dims: (17,1,256,):\nI1017 14:58:14.246109 3686541 profile_observer_gpu.cc:33] Input 1: Tensor model1/encoder/layer0/fw/milstm/i2h_w of type float. Dims: (2048,256,):\nI1017 14:58:14.246176 3686541 profile_observer_gpu.cc:33] Input 2: Tensor model1/encoder/layer0/fw/milstm/i2h_b of type float. Dims: (2048,):\nI1017 14:58:14.246217 3686541 profile_observer_gpu.cc:44] Argument 0: name: \"use_cudnn\" i: 1\nI1017 14:58:14.246271 3686541 profile_observer_gpu.cc:44] Argument 1: name: \"cudnn_exhaustive_search\" i: 0\nI1017 14:58:14.246338 3686541 profile_observer_gpu.cc:44] Argument 2: name: \"order\" s: \"NHWC\"\nI1017 14:58:14.246372 3686541 profile_observer_gpu.cc:44] Argument 3: name: \"axis\" i: 2\nI1017 14:58:14.246418 3686541 profile_observer_gpu.cc:44] Argument 4: name: \"quantization_scheme\" i: 1\nI1017 14:58:14.246470 3686541 profile_observer_gpu.cc:53] Output 0: Tensor model1/encoder/layer0/fw/milstm/i2h of type float. Dims: (17,1,2048,):\nI1017 14:58:14.246596 3686541 profile_observer_gpu.cc:61] Cost (flops, bytes_read, bytes_written):\nI1017 14:58:14.246649 3686541 profile_observer_gpu.cc:62]        17860608 2122752 139264\nI1017 14:58:14.246677 3686541 profile_observer_gpu.cc:64] --------- Finished operator FC in 0.764221 ms ---------\n\nExample output at net level:\nI1017 11:13:44.675585 3146691 profile_observer_gpu.cc:165] ================ Detailed stats for net model0/encoder/layer0/bw/milstm ================\nI1017 11:13:44.675662 3146691 profile_observer_gpu.cc:167] Cost (flops, bytes_read, bytes_written) per operator type:\nI1017 11:13:44.675706 3146691 profile_observer_gpu.cc:169]        20992000 42045440 81920 FC\nI1017 11:13:44.675745 3146691 profile_observer_gpu.cc:169]           20480 163840 81920 Mul\nI1017 11:13:44.675824 3146691 profile_observer_gpu.cc:169]           20480 163840 81920 Sum\nI1017 11:13:44.675878 3146691 profile_observer_gpu.cc:169]               0 0 0 ElementwiseLinear\nI1017 11:13:44.675909 3146691 profile_observer_gpu.cc:169]               0 0 0 LSTMUnit\nI1017 11:13:44.675958 3146691 profile_observer_gpu.cc:169]               0 0 0 rnn_internal_apply_link\n\nDifferential Revision: D13117066", "body": "Summary:\n(This diff fixed the build issue in the reverted diff D10428917 by adding \"gpu\" into the test file name, other parts are the same as D10428917.)\n\nAdd analytical cost into profile observer. It includes the op level cost information for each op run and net level aggregated cost information for each op type.\n\nIt outputs the following information:\n1. analytical flops\n2. analytical bytes_read\n3. analytical bytes_written\n\nExample output at op level:\n```\nI1017 14:58:14.245978 3686541 profile_observer_gpu.cc:26] --------- Starting operator FC op#24 ---------\nI1017 14:58:14.246049 3686541 profile_observer_gpu.cc:33] Input 0: Tensor model1/embedded_encoder_inputs of type float. Dims: (17,1,256,):\nI1017 14:58:14.246109 3686541 profile_observer_gpu.cc:33] Input 1: Tensor model1/encoder/layer0/fw/milstm/i2h_w of type float. Dims: (2048,256,):\nI1017 14:58:14.246176 3686541 profile_observer_gpu.cc:33] Input 2: Tensor model1/encoder/layer0/fw/milstm/i2h_b of type float. Dims: (2048,):\nI1017 14:58:14.246217 3686541 profile_observer_gpu.cc:44] Argument 0: name: \"use_cudnn\" i: 1\nI1017 14:58:14.246271 3686541 profile_observer_gpu.cc:44] Argument 1: name: \"cudnn_exhaustive_search\" i: 0\nI1017 14:58:14.246338 3686541 profile_observer_gpu.cc:44] Argument 2: name: \"order\" s: \"NHWC\"\nI1017 14:58:14.246372 3686541 profile_observer_gpu.cc:44] Argument 3: name: \"axis\" i: 2\nI1017 14:58:14.246418 3686541 profile_observer_gpu.cc:44] Argument 4: name: \"quantization_scheme\" i: 1\nI1017 14:58:14.246470 3686541 profile_observer_gpu.cc:53] Output 0: Tensor model1/encoder/layer0/fw/milstm/i2h of type float. Dims: (17,1,2048,):\nI1017 14:58:14.246596 3686541 profile_observer_gpu.cc:61] Cost (flops, bytes_read, bytes_written):\nI1017 14:58:14.246649 3686541 profile_observer_gpu.cc:62]        17860608 2122752 139264\nI1017 14:58:14.246677 3686541 profile_observer_gpu.cc:64] --------- Finished operator FC in 0.764221 ms ---------\n```\nExample output at net level:\n```\nI1017 11:13:44.675585 3146691 profile_observer_gpu.cc:165] ================ Detailed stats for net model0/encoder/layer0/bw/milstm ================\nI1017 11:13:44.675662 3146691 profile_observer_gpu.cc:167] Cost (flops, bytes_read, bytes_written) per operator type:\nI1017 11:13:44.675706 3146691 profile_observer_gpu.cc:169]        20992000 42045440 81920 FC\nI1017 11:13:44.675745 3146691 profile_observer_gpu.cc:169]           20480 163840 81920 Mul\nI1017 11:13:44.675824 3146691 profile_observer_gpu.cc:169]           20480 163840 81920 Sum\nI1017 11:13:44.675878 3146691 profile_observer_gpu.cc:169]               0 0 0 ElementwiseLinear\nI1017 11:13:44.675909 3146691 profile_observer_gpu.cc:169]               0 0 0 LSTMUnit\nI1017 11:13:44.675958 3146691 profile_observer_gpu.cc:169]               0 0 0 rnn_internal_apply_link\n```\n\nDifferential Revision: D13117066\n"}