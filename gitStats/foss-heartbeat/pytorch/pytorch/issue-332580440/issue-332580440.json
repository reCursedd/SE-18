{"url": "https://api.github.com/repos/pytorch/pytorch/issues/8533", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/8533/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/8533/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/8533/events", "html_url": "https://github.com/pytorch/pytorch/issues/8533", "id": 332580440, "node_id": "MDU6SXNzdWUzMzI1ODA0NDA=", "number": 8533, "title": "[Caffe2] Runtime error while using a pre-trained style_transfer model", "user": {"login": "gau27", "id": 9413228, "node_id": "MDQ6VXNlcjk0MTMyMjg=", "avatar_url": "https://avatars3.githubusercontent.com/u/9413228?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gau27", "html_url": "https://github.com/gau27", "followers_url": "https://api.github.com/users/gau27/followers", "following_url": "https://api.github.com/users/gau27/following{/other_user}", "gists_url": "https://api.github.com/users/gau27/gists{/gist_id}", "starred_url": "https://api.github.com/users/gau27/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gau27/subscriptions", "organizations_url": "https://api.github.com/users/gau27/orgs", "repos_url": "https://api.github.com/users/gau27/repos", "events_url": "https://api.github.com/users/gau27/events{/privacy}", "received_events_url": "https://api.github.com/users/gau27/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 890282107, "node_id": "MDU6TGFiZWw4OTAyODIxMDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/caffe2", "name": "caffe2", "color": "210aa8", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-06-14T22:04:26Z", "updated_at": "2018-06-18T17:35:56Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>Hello, I'm using Caffe2 on Conda / Mac OSX 10.13.1 and I was trying to replicate the model zoo tutorial on a style transfer model. I pretty much copied the same thing to see if it would work while replacing squeezenet with style_transfer/crayon.</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">from</span> caffe2.python.models.style_transfer <span class=\"pl-k\">import</span> crayon <span class=\"pl-k\">as</span> mynet\n<span class=\"pl-k\">from</span> caffe2.python <span class=\"pl-k\">import</span> workspace\n<span class=\"pl-k\">import</span> numpy <span class=\"pl-k\">as</span> np\n\ninit_net <span class=\"pl-k\">=</span> mynet.init_net\npredict_net <span class=\"pl-k\">=</span> mynet.predict_net\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> you must name it something</span>\npredict_net.name <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>stylize<span class=\"pl-pds\">\"</span></span>\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Dummy batch</span>\ndata <span class=\"pl-k\">=</span> np.random.rand(<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">227</span>, <span class=\"pl-c1\">227</span>).astype(np.float32)\nworkspace.FeedBlob(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>data<span class=\"pl-pds\">\"</span></span>, data)\n\nworkspace.RunNetOnce(init_net)\nworkspace.CreateNet(predict_net)\np <span class=\"pl-k\">=</span> workspace.Predictor(init_net.SerializeToString(), predict_net.SerializeToString())\np.run([data])</pre></div>\n<p>While instantiating the net the following warnings appeared</p>\n<pre><code>I0615 03:22:06.141191 2799588160 operator.cc:167] Engine MOBILE is not available for operator PackedInt8BGRANHWCToNCHWCStylizerPreprocess.\nI0615 03:22:06.141261 2799588160 operator.cc:167] Engine MOBILE is not available for operator AveragePool.\n\n... (About 20 such warnings in total, with some repetitions)\n</code></pre>\n<p>And finally while trying to run the forward pass the script threw an error with the message</p>\n<pre><code>    p.run([data])\nRuntimeError: [enforce fail at stylizer_ops.cc:101] C == kInputChannels.  Error from operator: \ninput: \"data_int8_bgra\" input: \"mean\" output: \"b0\" name: \"\" type: \"PackedInt8BGRANHWCToNCHWCStylizerPreprocess\" arg { name: \"noise_std\" f: 5 } device_option { device_type: 0 random_seed: 0 } engine: \"MOBILE\"\n\n</code></pre>\n<p>I'm not too sure how to interpret this error, all I could guess is that the shape of the input sample is wrong but I tried 224px to 270px (incase the image scale was off)</p>", "body_text": "Hello, I'm using Caffe2 on Conda / Mac OSX 10.13.1 and I was trying to replicate the model zoo tutorial on a style transfer model. I pretty much copied the same thing to see if it would work while replacing squeezenet with style_transfer/crayon.\nfrom caffe2.python.models.style_transfer import crayon as mynet\nfrom caffe2.python import workspace\nimport numpy as np\n\ninit_net = mynet.init_net\npredict_net = mynet.predict_net\n\n# you must name it something\npredict_net.name = \"stylize\"\n\n# Dummy batch\ndata = np.random.rand(1, 3, 227, 227).astype(np.float32)\nworkspace.FeedBlob(\"data\", data)\n\nworkspace.RunNetOnce(init_net)\nworkspace.CreateNet(predict_net)\np = workspace.Predictor(init_net.SerializeToString(), predict_net.SerializeToString())\np.run([data])\nWhile instantiating the net the following warnings appeared\nI0615 03:22:06.141191 2799588160 operator.cc:167] Engine MOBILE is not available for operator PackedInt8BGRANHWCToNCHWCStylizerPreprocess.\nI0615 03:22:06.141261 2799588160 operator.cc:167] Engine MOBILE is not available for operator AveragePool.\n\n... (About 20 such warnings in total, with some repetitions)\n\nAnd finally while trying to run the forward pass the script threw an error with the message\n    p.run([data])\nRuntimeError: [enforce fail at stylizer_ops.cc:101] C == kInputChannels.  Error from operator: \ninput: \"data_int8_bgra\" input: \"mean\" output: \"b0\" name: \"\" type: \"PackedInt8BGRANHWCToNCHWCStylizerPreprocess\" arg { name: \"noise_std\" f: 5 } device_option { device_type: 0 random_seed: 0 } engine: \"MOBILE\"\n\n\nI'm not too sure how to interpret this error, all I could guess is that the shape of the input sample is wrong but I tried 224px to 270px (incase the image scale was off)", "body": "Hello, I'm using Caffe2 on Conda / Mac OSX 10.13.1 and I was trying to replicate the model zoo tutorial on a style transfer model. I pretty much copied the same thing to see if it would work while replacing squeezenet with style_transfer/crayon.\r\n\r\n```python\r\nfrom caffe2.python.models.style_transfer import crayon as mynet\r\nfrom caffe2.python import workspace\r\nimport numpy as np\r\n\r\ninit_net = mynet.init_net\r\npredict_net = mynet.predict_net\r\n\r\n# you must name it something\r\npredict_net.name = \"stylize\"\r\n\r\n# Dummy batch\r\ndata = np.random.rand(1, 3, 227, 227).astype(np.float32)\r\nworkspace.FeedBlob(\"data\", data)\r\n\r\nworkspace.RunNetOnce(init_net)\r\nworkspace.CreateNet(predict_net)\r\np = workspace.Predictor(init_net.SerializeToString(), predict_net.SerializeToString())\r\np.run([data])\r\n```\r\n\r\nWhile instantiating the net the following warnings appeared\r\n\r\n```\r\nI0615 03:22:06.141191 2799588160 operator.cc:167] Engine MOBILE is not available for operator PackedInt8BGRANHWCToNCHWCStylizerPreprocess.\r\nI0615 03:22:06.141261 2799588160 operator.cc:167] Engine MOBILE is not available for operator AveragePool.\r\n\r\n... (About 20 such warnings in total, with some repetitions)\r\n```\r\n\r\nAnd finally while trying to run the forward pass the script threw an error with the message \r\n\r\n```\r\n    p.run([data])\r\nRuntimeError: [enforce fail at stylizer_ops.cc:101] C == kInputChannels.  Error from operator: \r\ninput: \"data_int8_bgra\" input: \"mean\" output: \"b0\" name: \"\" type: \"PackedInt8BGRANHWCToNCHWCStylizerPreprocess\" arg { name: \"noise_std\" f: 5 } device_option { device_type: 0 random_seed: 0 } engine: \"MOBILE\"\r\n\r\n```\r\nI'm not too sure how to interpret this error, all I could guess is that the shape of the input sample is wrong but I tried 224px to 270px (incase the image scale was off)"}