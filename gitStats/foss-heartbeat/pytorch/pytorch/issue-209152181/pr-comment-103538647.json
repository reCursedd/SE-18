{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/103538647", "pull_request_review_id": 24328462, "id": 103538647, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEwMzUzODY0Nw==", "diff_hunk": "@@ -49,7 +67,20 @@ def step(self, closure=None):\n                     grad = grad.add(group['weight_decay'], p.data)\n \n                 square_avg.mul_(alpha).addcmul_(1 - alpha, grad, grad)\n-                avg = square_avg.sqrt().add_(group['eps'])\n-                p.data.addcdiv_(-group['lr'], grad, avg)\n+\n+                avg = None\n+                if group['centered']:\n+                    grad_avg = state['grad_avg']\n+                    grad_avg.mul_(alpha).add_(1 - alpha, grad)\n+                    avg = square_avg.addcmul(-1, grad_avg, grad_avg).sqrt().add_(group['eps'])\n+                else:\n+                    avg = square_avg.sqrt().add_(group['eps'])\n+\n+                if group['momentum'] > 0:\n+                    mom = state['momentum']\n+                    mom.mul_(group['momentum']).addcdiv_(group['lr'], grad, avg)", "path": "torch/optim/rmsprop.py", "position": null, "original_position": 66, "commit_id": "42cf15229ebbbb2bce7104c6c280b4d83c852a4b", "original_commit_id": "88305e8ff41f3d5af665bfe35c8baf7bddbffbec", "user": {"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}, "body": "Yeah it's equivalent, but we decided that it's best to keep it consistent. The alternative formulation has the advantage that if you modify the LR, it is immediately reflected in the updates, instead of slowly making the buffer smaller.", "created_at": "2017-02-28T19:55:16Z", "updated_at": "2018-11-23T15:32:36Z", "html_url": "https://github.com/pytorch/pytorch/pull/810#discussion_r103538647", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/810", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/103538647"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/810#discussion_r103538647"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/810"}}, "body_html": "<p>Yeah it's equivalent, but we decided that it's best to keep it consistent. The alternative formulation has the advantage that if you modify the LR, it is immediately reflected in the updates, instead of slowly making the buffer smaller.</p>", "body_text": "Yeah it's equivalent, but we decided that it's best to keep it consistent. The alternative formulation has the advantage that if you modify the LR, it is immediately reflected in the updates, instead of slowly making the buffer smaller.", "in_reply_to_id": 103171697}