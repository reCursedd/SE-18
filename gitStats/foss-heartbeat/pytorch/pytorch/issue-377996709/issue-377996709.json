{"url": "https://api.github.com/repos/pytorch/pytorch/issues/13629", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/13629/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/13629/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/13629/events", "html_url": "https://github.com/pytorch/pytorch/pull/13629", "id": 377996709, "node_id": "MDExOlB1bGxSZXF1ZXN0MjI4ODA2MjAy", "number": 13629, "title": "[pt1][tensor][refactor] Remove partially initialized Tensor + CopyFrom", "user": {"login": "jerryzh168", "id": 4958441, "node_id": "MDQ6VXNlcjQ5NTg0NDE=", "avatar_url": "https://avatars0.githubusercontent.com/u/4958441?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jerryzh168", "html_url": "https://github.com/jerryzh168", "followers_url": "https://api.github.com/users/jerryzh168/followers", "following_url": "https://api.github.com/users/jerryzh168/following{/other_user}", "gists_url": "https://api.github.com/users/jerryzh168/gists{/gist_id}", "starred_url": "https://api.github.com/users/jerryzh168/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jerryzh168/subscriptions", "organizations_url": "https://api.github.com/users/jerryzh168/orgs", "repos_url": "https://api.github.com/users/jerryzh168/repos", "events_url": "https://api.github.com/users/jerryzh168/events{/privacy}", "received_events_url": "https://api.github.com/users/jerryzh168/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-11-06T19:22:00Z", "updated_at": "2018-11-07T19:32:30Z", "closed_at": "2018-11-07T19:32:30Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/13629", "html_url": "https://github.com/pytorch/pytorch/pull/13629", "diff_url": "https://github.com/pytorch/pytorch/pull/13629.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/13629.patch"}, "body_html": "<p>Stack:<br>\n\u00a0\u00a0\u00a0\u00a0<g-emoji class=\"g-emoji\" alias=\"black_circle\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/26ab.png\">\u26ab\ufe0f</g-emoji>\u00a0 <strong><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"377996709\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/13629\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/13629/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/13629\">#13629</a> [pt1][tensor][refactor] Remove partially initialized Tensor + CopyFrom</strong>\u00a0\u00a0<a href=\"https://our.internmc.facebook.com/intern/diff/D12848855/\" rel=\"nofollow\"><g-emoji class=\"g-emoji\" alias=\"yellow_heart\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f49b.png\">\ud83d\udc9b</g-emoji></a><br>\n\u00a0\u00a0\u00a0\u00a0<g-emoji class=\"g-emoji\" alias=\"white_circle\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/26aa.png\">\u26aa\ufe0f</g-emoji>\u00a0 <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"378054788\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/13642\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/13642/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/13642\">#13642</a> [pt1][tensor][refactor] Deserialize returns a Tensor\u00a0\u00a0<a href=\"https://our.internmc.facebook.com/intern/diff/D12874357/\" rel=\"nofollow\"><g-emoji class=\"g-emoji\" alias=\"yellow_heart\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f49b.png\">\ud83d\udc9b</g-emoji></a></p>\n<p>Previously we have a Tensor which has a initialized storage(therefore a known device_type) and<br>\nthen we'll call CopyFrom on it to initialize the sizes and data.</p>\n<p>We want to eliminate partially initialized Tensor by replacing the pattern of calling CopyFrom with a partially initialized Tensor with either splitting that to undefined Tensor + initialization API(1)(3) or combine all the initialization in the same step(2).</p>\n<ol>\n<li>\n<p>member variable initialization + CopyFrom<br>\nPreviously we have a tensor that is initialized with device_type, and then use CopyFrom to populate the content, now we remove the partial initialization by make the original member variable an undefined Tensor and use ReinitializeFrom to copy from another Tensor.</p>\n</li>\n<li>\n<p>Output + CopyFrom<br>\nPreviously, we first get a tensor with device_type, and then CopyFrom another Tensor,<br>\nWe changed it two combining these two operations into OperatorBase::OutputTensor.</p>\n</li>\n<li>\n<p>Output + custom functions<br>\nExample can be found in TransformGPU function.<br>\nIn this case we move the part that initializes the tensor outside of the function, and do that explicitly outside so that we could reuse the Output functions to make a fully initialized Tensor.</p>\n</li>\n</ol>\n<p>Note that to keep the original semantics, both of the APIs has a caching effect based on device_type, which means we only create a Tensor object when device_type does not match or the Tensor is undefined, otherwise, we will reuse the original Tensor object.</p>\n<p>Differential Revision: <a href=\"https://our.internmc.facebook.com/intern/diff/D12848855/\" rel=\"nofollow\">D12848855</a></p>", "body_text": "Stack:\n\u00a0\u00a0\u00a0\u00a0\u26ab\ufe0f\u00a0 #13629 [pt1][tensor][refactor] Remove partially initialized Tensor + CopyFrom\u00a0\u00a0\ud83d\udc9b\n\u00a0\u00a0\u00a0\u00a0\u26aa\ufe0f\u00a0 #13642 [pt1][tensor][refactor] Deserialize returns a Tensor\u00a0\u00a0\ud83d\udc9b\nPreviously we have a Tensor which has a initialized storage(therefore a known device_type) and\nthen we'll call CopyFrom on it to initialize the sizes and data.\nWe want to eliminate partially initialized Tensor by replacing the pattern of calling CopyFrom with a partially initialized Tensor with either splitting that to undefined Tensor + initialization API(1)(3) or combine all the initialization in the same step(2).\n\n\nmember variable initialization + CopyFrom\nPreviously we have a tensor that is initialized with device_type, and then use CopyFrom to populate the content, now we remove the partial initialization by make the original member variable an undefined Tensor and use ReinitializeFrom to copy from another Tensor.\n\n\nOutput + CopyFrom\nPreviously, we first get a tensor with device_type, and then CopyFrom another Tensor,\nWe changed it two combining these two operations into OperatorBase::OutputTensor.\n\n\nOutput + custom functions\nExample can be found in TransformGPU function.\nIn this case we move the part that initializes the tensor outside of the function, and do that explicitly outside so that we could reuse the Output functions to make a fully initialized Tensor.\n\n\nNote that to keep the original semantics, both of the APIs has a caching effect based on device_type, which means we only create a Tensor object when device_type does not match or the Tensor is undefined, otherwise, we will reuse the original Tensor object.\nDifferential Revision: D12848855", "body": "Stack:\n&nbsp;&nbsp;&nbsp;&nbsp;:black_circle:&nbsp; **#13629 [pt1][tensor][refactor] Remove partially initialized Tensor + CopyFrom**&nbsp;&nbsp;[:yellow_heart:](https://our.internmc.facebook.com/intern/diff/D12848855/)\n&nbsp;&nbsp;&nbsp;&nbsp;:white_circle:&nbsp; #13642 [pt1][tensor][refactor] Deserialize returns a Tensor&nbsp;&nbsp;[:yellow_heart:](https://our.internmc.facebook.com/intern/diff/D12874357/)\n\nPreviously we have a Tensor which has a initialized storage(therefore a known device_type) and\nthen we'll call CopyFrom on it to initialize the sizes and data.\n\nWe want to eliminate partially initialized Tensor by replacing the pattern of calling CopyFrom with a partially initialized Tensor with either splitting that to undefined Tensor + initialization API(1)(3) or combine all the initialization in the same step(2).\n\n1. member variable initialization + CopyFrom\nPreviously we have a tensor that is initialized with device_type, and then use CopyFrom to populate the content, now we remove the partial initialization by make the original member variable an undefined Tensor and use ReinitializeFrom to copy from another Tensor.\n\n2. Output + CopyFrom\nPreviously, we first get a tensor with device_type, and then CopyFrom another Tensor,\nWe changed it two combining these two operations into OperatorBase::OutputTensor.\n\n3. Output + custom functions\nExample can be found in TransformGPU function.\nIn this case we move the part that initializes the tensor outside of the function, and do that explicitly outside so that we could reuse the Output functions to make a fully initialized Tensor.\n\nNote that to keep the original semantics, both of the APIs has a caching effect based on device_type, which means we only create a Tensor object when device_type does not match or the Tensor is undefined, otherwise, we will reuse the original Tensor object.\n\nDifferential Revision: [D12848855](https://our.internmc.facebook.com/intern/diff/D12848855/)"}