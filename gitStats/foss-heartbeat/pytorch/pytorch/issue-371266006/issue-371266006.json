{"url": "https://api.github.com/repos/pytorch/pytorch/issues/12786", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/12786/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/12786/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/12786/events", "html_url": "https://github.com/pytorch/pytorch/issues/12786", "id": 371266006, "node_id": "MDU6SXNzdWUzNzEyNjYwMDY=", "number": 12786, "title": "[caffe2] nvlink fatal   : Input file '/home/gradescan/boa/pytorch/third_party/build/nccl/obj/collectives/device/all_reduce_sum.o' newer than toolkit", "user": {"login": "KevinLucidyne", "id": 19497849, "node_id": "MDQ6VXNlcjE5NDk3ODQ5", "avatar_url": "https://avatars2.githubusercontent.com/u/19497849?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KevinLucidyne", "html_url": "https://github.com/KevinLucidyne", "followers_url": "https://api.github.com/users/KevinLucidyne/followers", "following_url": "https://api.github.com/users/KevinLucidyne/following{/other_user}", "gists_url": "https://api.github.com/users/KevinLucidyne/gists{/gist_id}", "starred_url": "https://api.github.com/users/KevinLucidyne/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KevinLucidyne/subscriptions", "organizations_url": "https://api.github.com/users/KevinLucidyne/orgs", "repos_url": "https://api.github.com/users/KevinLucidyne/repos", "events_url": "https://api.github.com/users/KevinLucidyne/events{/privacy}", "received_events_url": "https://api.github.com/users/KevinLucidyne/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2018-10-17T21:03:32Z", "updated_at": "2018-10-22T17:53:39Z", "closed_at": null, "author_association": "NONE", "body_html": "<h2><g-emoji class=\"g-emoji\" alias=\"bug\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f41b.png\">\ud83d\udc1b</g-emoji> Bug</h2>\n<p>I have to compile caffe2 because it's being incorporated into a virtualenv rather than a conda env.<br>\nWhen I do so I get the error</p>\n<pre><code>nvlink fatal   : Input file '/home/gradescan/boa/pytorch/third_party/build/nccl/obj/collectives/device/all_reduce_sum.o' newer than toolkit\n</code></pre>\n<h2>To Reproduce</h2>\n<p>Steps to reproduce the behavior:</p>\n<ol>\n<li>Create a virtualenv using Python 2.7.12 on Ubuntu 16.04</li>\n<li>Follow the directions at<br>\n<a href=\"https://caffe2.ai/docs/getting-started.html?platform=ubuntu&amp;configuration=compile\" rel=\"nofollow\">https://caffe2.ai/docs/getting-started.html?platform=ubuntu&amp;configuration=compile</a></li>\n<li><code>python setup.py install</code></li>\n</ol>\n<pre><code>Building wheel torch-1.0.0a0+ab1a25a\nrunning install\nsetup.py::run()\nrunning build_deps\nsetup.py::build_deps::run()\n+ SYNC_COMMAND=cp\n++ command -v rsync\n+ '[' -x /usr/bin/rsync ']'\n+ SYNC_COMMAND='rsync -lptgoD'\n+ USE_CUDA=0\n+ USE_ROCM=0\n+ USE_NNPACK=0\n+ USE_MKLDNN=0\n+ USE_GLOO_IBVERBS=0\n+ CAFFE2_STATIC_LINK_CUDA=0\n+ RERUN_CMAKE=1\n+ [[ 8 -gt 0 ]]\n+ case \"$1\" in\n+ USE_CUDA=1\n+ shift\n+ [[ 7 -gt 0 ]]\n+ case \"$1\" in\n+ USE_NNPACK=1\n+ shift\n+ [[ 6 -gt 0 ]]\n+ case \"$1\" in\n+ break\n+ CMAKE_INSTALL='make install'\n+ BUILD_SHARED_LIBS=ON\n+ USER_CFLAGS=\n+ USER_LDFLAGS=\n+ [[ -n '' ]]\n+ [[ -n '' ]]\n+ [[ -n '' ]]\n++ uname\n+ '[' Linux == Darwin ']'\n+++ dirname ../tools/build_pytorch_libs.sh\n++ cd ../tools/..\n+++ pwd\n++ printf '%q\\n' /home/gradescan/boa/pytorch\n+ BASE_DIR=/home/gradescan/boa/pytorch\n+ TORCH_LIB_DIR=/home/gradescan/boa/pytorch/torch/lib\n+ INSTALL_DIR=/home/gradescan/boa/pytorch/torch/lib/tmp_install\n+ THIRD_PARTY_DIR=/home/gradescan/boa/pytorch/third_party\n+ CMAKE_VERSION=cmake\n+ C_FLAGS=' -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCUNN\"'\n+ C_FLAGS=' -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1'\n+ LDFLAGS='-L\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/lib\" '\n+ LD_POSTFIX=.so\n++ uname\n+ [[ Linux == \\D\\a\\r\\w\\i\\n ]]\n+ [[ 0 -eq 1 ]]\n+ LDFLAGS='-L\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/lib\"  -Wl,-rpath,$ORIGIN'\n+ CPP_FLAGS=' -std=c++11 '\n+ GLOO_FLAGS='-DBUILD_TEST=OFF '\n+ THD_FLAGS=\n+ NCCL_ROOT_DIR=/home/gradescan/boa/pytorch/torch/lib/tmp_install\n+ [[ 1 -eq 1 ]]\n+ GLOO_FLAGS+='-DUSE_CUDA=1 -DNCCL_ROOT_DIR=/home/gradescan/boa/pytorch/torch/lib/tmp_install'\n+ [[ 0 -eq 1 ]]\n+ CWRAP_FILES='/home/gradescan/boa/pytorch/torch/lib/ATen/Declarations.cwrap;/home/gradescan/boa/pytorch/torch/lib/THNN/generic/THNN.h;/home/gradescan/boa/pytorch/torch/lib/THCUNN/generic/THCUNN.h;/home/gradescan/boa/pytorch/torch/lib/ATen/nn.yaml'\n+ CUDA_NVCC_FLAGS=' -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1'\n+ [[ -z '' ]]\n+ CUDA_DEVICE_DEBUG=0\n+ '[' -z '' ']'\n++ getconf _NPROCESSORS_ONLN\n+ MAX_JOBS=16\n+ BUILD_TYPE=Release\n+ [[ -n '' ]]\n+ [[ -n '' ]]\n+ echo 'Building in Release mode'\nBuilding in Release mode\n+ mkdir -p /home/gradescan/boa/pytorch/torch/lib/tmp_install\n+ for arg in '\"$@\"'\n+ [[ nccl == \\n\\c\\c\\l ]]\n+ pushd /home/gradescan/boa/pytorch/third_party\n~/boa/pytorch/third_party ~/boa/pytorch/build\n+ build_nccl\n+ mkdir -p build/nccl\n+ pushd build/nccl\n~/boa/pytorch/third_party/build/nccl ~/boa/pytorch/third_party ~/boa/pytorch/build\n+ [[ 1 -eq 1 ]]\n+ cmake ../../nccl -DCMAKE_MODULE_PATH=/home/gradescan/boa/pytorch/cmake/Modules_CUDA_fix -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/home/gradescan/boa/pytorch/torch/lib/tmp_install '-DCMAKE_C_FLAGS= -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1 ' '-DCMAKE_CXX_FLAGS= -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1  -std=c++11  ' -DCMAKE_SHARED_LINKER_FLAGS= -DCMAKE_UTILS_PATH=/home/gradescan/boa/pytorch/cmake/public/utils.cmake -DNUM_JOBS=16\n-- Autodetected CUDA architecture(s): 6.1;6.1\n-- Set NVCC_GENCODE for building NCCL: -gencode=arch=compute_61,code=sm_61\n-- Configuring done\n-- Generating done\n-- Build files have been written to: /home/gradescan/boa/pytorch/third_party/build/nccl\n+ make install -j16\n[100%] Generating lib/libnccl.so\nmake[3]: warning: -jN forced in submake: disabling jobserver mode.\nnvlink fatal   : Input file '/home/gradescan/boa/pytorch/third_party/build/nccl/obj/collectives/device/all_reduce_sum.o' newer than toolkit\nMakefile:83: recipe for target '/home/gradescan/boa/pytorch/third_party/build/nccl/obj/collectives/device/devlink.o' failed\nmake[5]: *** [/home/gradescan/boa/pytorch/third_party/build/nccl/obj/collectives/device/devlink.o] Error 1\nMakefile:45: recipe for target 'devicelib' failed\nmake[4]: *** [devicelib] Error 2\nMakefile:24: recipe for target 'src.build' failed\nmake[3]: *** [src.build] Error 2\nCMakeFiles/nccl.dir/build.make:60: recipe for target 'lib/libnccl.so' failed\nmake[2]: *** [lib/libnccl.so] Error 2\nCMakeFiles/Makefile2:67: recipe for target 'CMakeFiles/nccl.dir/all' failed\nmake[1]: *** [CMakeFiles/nccl.dir/all] Error 2\nMakefile:127: recipe for target 'all' failed\nmake: *** [all] Error 2\nFailed to run 'bash ../tools/build_pytorch_libs.sh --use-cuda --use-nnpack nccl caffe2 libshm gloo c10d THD'\n</code></pre>\n<h2>Expected behavior</h2>\n<p>It compiles.</p>\n<h2>Environment</h2>\n<ul>\n<li>PyTorch Version (e.g., 1.0): 2018-10-16 following directions above</li>\n<li>OS (e.g., Linux): Ubuntu 16.04</li>\n<li>How you installed PyTorch (<code>conda</code>, <code>pip</code>, source): source</li>\n<li>Build command you used (if compiling from source): See Steps to Reproduce</li>\n<li>Python version: 2.7.12</li>\n<li>CUDA/cuDNN version: release 7.5, V7.5.17</li>\n<li>GPU models and configuration: 2 Tesla P40s.</li>\n<li>Any other relevant information:</li>\n</ul>\n<h2>Additional context</h2>", "body_text": "\ud83d\udc1b Bug\nI have to compile caffe2 because it's being incorporated into a virtualenv rather than a conda env.\nWhen I do so I get the error\nnvlink fatal   : Input file '/home/gradescan/boa/pytorch/third_party/build/nccl/obj/collectives/device/all_reduce_sum.o' newer than toolkit\n\nTo Reproduce\nSteps to reproduce the behavior:\n\nCreate a virtualenv using Python 2.7.12 on Ubuntu 16.04\nFollow the directions at\nhttps://caffe2.ai/docs/getting-started.html?platform=ubuntu&configuration=compile\npython setup.py install\n\nBuilding wheel torch-1.0.0a0+ab1a25a\nrunning install\nsetup.py::run()\nrunning build_deps\nsetup.py::build_deps::run()\n+ SYNC_COMMAND=cp\n++ command -v rsync\n+ '[' -x /usr/bin/rsync ']'\n+ SYNC_COMMAND='rsync -lptgoD'\n+ USE_CUDA=0\n+ USE_ROCM=0\n+ USE_NNPACK=0\n+ USE_MKLDNN=0\n+ USE_GLOO_IBVERBS=0\n+ CAFFE2_STATIC_LINK_CUDA=0\n+ RERUN_CMAKE=1\n+ [[ 8 -gt 0 ]]\n+ case \"$1\" in\n+ USE_CUDA=1\n+ shift\n+ [[ 7 -gt 0 ]]\n+ case \"$1\" in\n+ USE_NNPACK=1\n+ shift\n+ [[ 6 -gt 0 ]]\n+ case \"$1\" in\n+ break\n+ CMAKE_INSTALL='make install'\n+ BUILD_SHARED_LIBS=ON\n+ USER_CFLAGS=\n+ USER_LDFLAGS=\n+ [[ -n '' ]]\n+ [[ -n '' ]]\n+ [[ -n '' ]]\n++ uname\n+ '[' Linux == Darwin ']'\n+++ dirname ../tools/build_pytorch_libs.sh\n++ cd ../tools/..\n+++ pwd\n++ printf '%q\\n' /home/gradescan/boa/pytorch\n+ BASE_DIR=/home/gradescan/boa/pytorch\n+ TORCH_LIB_DIR=/home/gradescan/boa/pytorch/torch/lib\n+ INSTALL_DIR=/home/gradescan/boa/pytorch/torch/lib/tmp_install\n+ THIRD_PARTY_DIR=/home/gradescan/boa/pytorch/third_party\n+ CMAKE_VERSION=cmake\n+ C_FLAGS=' -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCUNN\"'\n+ C_FLAGS=' -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1'\n+ LDFLAGS='-L\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/lib\" '\n+ LD_POSTFIX=.so\n++ uname\n+ [[ Linux == \\D\\a\\r\\w\\i\\n ]]\n+ [[ 0 -eq 1 ]]\n+ LDFLAGS='-L\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/lib\"  -Wl,-rpath,$ORIGIN'\n+ CPP_FLAGS=' -std=c++11 '\n+ GLOO_FLAGS='-DBUILD_TEST=OFF '\n+ THD_FLAGS=\n+ NCCL_ROOT_DIR=/home/gradescan/boa/pytorch/torch/lib/tmp_install\n+ [[ 1 -eq 1 ]]\n+ GLOO_FLAGS+='-DUSE_CUDA=1 -DNCCL_ROOT_DIR=/home/gradescan/boa/pytorch/torch/lib/tmp_install'\n+ [[ 0 -eq 1 ]]\n+ CWRAP_FILES='/home/gradescan/boa/pytorch/torch/lib/ATen/Declarations.cwrap;/home/gradescan/boa/pytorch/torch/lib/THNN/generic/THNN.h;/home/gradescan/boa/pytorch/torch/lib/THCUNN/generic/THCUNN.h;/home/gradescan/boa/pytorch/torch/lib/ATen/nn.yaml'\n+ CUDA_NVCC_FLAGS=' -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1'\n+ [[ -z '' ]]\n+ CUDA_DEVICE_DEBUG=0\n+ '[' -z '' ']'\n++ getconf _NPROCESSORS_ONLN\n+ MAX_JOBS=16\n+ BUILD_TYPE=Release\n+ [[ -n '' ]]\n+ [[ -n '' ]]\n+ echo 'Building in Release mode'\nBuilding in Release mode\n+ mkdir -p /home/gradescan/boa/pytorch/torch/lib/tmp_install\n+ for arg in '\"$@\"'\n+ [[ nccl == \\n\\c\\c\\l ]]\n+ pushd /home/gradescan/boa/pytorch/third_party\n~/boa/pytorch/third_party ~/boa/pytorch/build\n+ build_nccl\n+ mkdir -p build/nccl\n+ pushd build/nccl\n~/boa/pytorch/third_party/build/nccl ~/boa/pytorch/third_party ~/boa/pytorch/build\n+ [[ 1 -eq 1 ]]\n+ cmake ../../nccl -DCMAKE_MODULE_PATH=/home/gradescan/boa/pytorch/cmake/Modules_CUDA_fix -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/home/gradescan/boa/pytorch/torch/lib/tmp_install '-DCMAKE_C_FLAGS= -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1 ' '-DCMAKE_CXX_FLAGS= -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1  -std=c++11  ' -DCMAKE_SHARED_LINKER_FLAGS= -DCMAKE_UTILS_PATH=/home/gradescan/boa/pytorch/cmake/public/utils.cmake -DNUM_JOBS=16\n-- Autodetected CUDA architecture(s): 6.1;6.1\n-- Set NVCC_GENCODE for building NCCL: -gencode=arch=compute_61,code=sm_61\n-- Configuring done\n-- Generating done\n-- Build files have been written to: /home/gradescan/boa/pytorch/third_party/build/nccl\n+ make install -j16\n[100%] Generating lib/libnccl.so\nmake[3]: warning: -jN forced in submake: disabling jobserver mode.\nnvlink fatal   : Input file '/home/gradescan/boa/pytorch/third_party/build/nccl/obj/collectives/device/all_reduce_sum.o' newer than toolkit\nMakefile:83: recipe for target '/home/gradescan/boa/pytorch/third_party/build/nccl/obj/collectives/device/devlink.o' failed\nmake[5]: *** [/home/gradescan/boa/pytorch/third_party/build/nccl/obj/collectives/device/devlink.o] Error 1\nMakefile:45: recipe for target 'devicelib' failed\nmake[4]: *** [devicelib] Error 2\nMakefile:24: recipe for target 'src.build' failed\nmake[3]: *** [src.build] Error 2\nCMakeFiles/nccl.dir/build.make:60: recipe for target 'lib/libnccl.so' failed\nmake[2]: *** [lib/libnccl.so] Error 2\nCMakeFiles/Makefile2:67: recipe for target 'CMakeFiles/nccl.dir/all' failed\nmake[1]: *** [CMakeFiles/nccl.dir/all] Error 2\nMakefile:127: recipe for target 'all' failed\nmake: *** [all] Error 2\nFailed to run 'bash ../tools/build_pytorch_libs.sh --use-cuda --use-nnpack nccl caffe2 libshm gloo c10d THD'\n\nExpected behavior\nIt compiles.\nEnvironment\n\nPyTorch Version (e.g., 1.0): 2018-10-16 following directions above\nOS (e.g., Linux): Ubuntu 16.04\nHow you installed PyTorch (conda, pip, source): source\nBuild command you used (if compiling from source): See Steps to Reproduce\nPython version: 2.7.12\nCUDA/cuDNN version: release 7.5, V7.5.17\nGPU models and configuration: 2 Tesla P40s.\nAny other relevant information:\n\nAdditional context", "body": "## \ud83d\udc1b Bug\r\n\r\nI have to compile caffe2 because it's being incorporated into a virtualenv rather than a conda env.  \r\nWhen I do so I get the error \r\n```\r\nnvlink fatal   : Input file '/home/gradescan/boa/pytorch/third_party/build/nccl/obj/collectives/device/all_reduce_sum.o' newer than toolkit\r\n```\r\n\r\n## To Reproduce\r\n\r\nSteps to reproduce the behavior:\r\n\r\n1. Create a virtualenv using Python 2.7.12 on Ubuntu 16.04\r\n1. Follow the directions at \r\nhttps://caffe2.ai/docs/getting-started.html?platform=ubuntu&configuration=compile\r\n1. `python setup.py install`\r\n\r\n```\r\nBuilding wheel torch-1.0.0a0+ab1a25a\r\nrunning install\r\nsetup.py::run()\r\nrunning build_deps\r\nsetup.py::build_deps::run()\r\n+ SYNC_COMMAND=cp\r\n++ command -v rsync\r\n+ '[' -x /usr/bin/rsync ']'\r\n+ SYNC_COMMAND='rsync -lptgoD'\r\n+ USE_CUDA=0\r\n+ USE_ROCM=0\r\n+ USE_NNPACK=0\r\n+ USE_MKLDNN=0\r\n+ USE_GLOO_IBVERBS=0\r\n+ CAFFE2_STATIC_LINK_CUDA=0\r\n+ RERUN_CMAKE=1\r\n+ [[ 8 -gt 0 ]]\r\n+ case \"$1\" in\r\n+ USE_CUDA=1\r\n+ shift\r\n+ [[ 7 -gt 0 ]]\r\n+ case \"$1\" in\r\n+ USE_NNPACK=1\r\n+ shift\r\n+ [[ 6 -gt 0 ]]\r\n+ case \"$1\" in\r\n+ break\r\n+ CMAKE_INSTALL='make install'\r\n+ BUILD_SHARED_LIBS=ON\r\n+ USER_CFLAGS=\r\n+ USER_LDFLAGS=\r\n+ [[ -n '' ]]\r\n+ [[ -n '' ]]\r\n+ [[ -n '' ]]\r\n++ uname\r\n+ '[' Linux == Darwin ']'\r\n+++ dirname ../tools/build_pytorch_libs.sh\r\n++ cd ../tools/..\r\n+++ pwd\r\n++ printf '%q\\n' /home/gradescan/boa/pytorch\r\n+ BASE_DIR=/home/gradescan/boa/pytorch\r\n+ TORCH_LIB_DIR=/home/gradescan/boa/pytorch/torch/lib\r\n+ INSTALL_DIR=/home/gradescan/boa/pytorch/torch/lib/tmp_install\r\n+ THIRD_PARTY_DIR=/home/gradescan/boa/pytorch/third_party\r\n+ CMAKE_VERSION=cmake\r\n+ C_FLAGS=' -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCUNN\"'\r\n+ C_FLAGS=' -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1'\r\n+ LDFLAGS='-L\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/lib\" '\r\n+ LD_POSTFIX=.so\r\n++ uname\r\n+ [[ Linux == \\D\\a\\r\\w\\i\\n ]]\r\n+ [[ 0 -eq 1 ]]\r\n+ LDFLAGS='-L\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/lib\"  -Wl,-rpath,$ORIGIN'\r\n+ CPP_FLAGS=' -std=c++11 '\r\n+ GLOO_FLAGS='-DBUILD_TEST=OFF '\r\n+ THD_FLAGS=\r\n+ NCCL_ROOT_DIR=/home/gradescan/boa/pytorch/torch/lib/tmp_install\r\n+ [[ 1 -eq 1 ]]\r\n+ GLOO_FLAGS+='-DUSE_CUDA=1 -DNCCL_ROOT_DIR=/home/gradescan/boa/pytorch/torch/lib/tmp_install'\r\n+ [[ 0 -eq 1 ]]\r\n+ CWRAP_FILES='/home/gradescan/boa/pytorch/torch/lib/ATen/Declarations.cwrap;/home/gradescan/boa/pytorch/torch/lib/THNN/generic/THNN.h;/home/gradescan/boa/pytorch/torch/lib/THCUNN/generic/THCUNN.h;/home/gradescan/boa/pytorch/torch/lib/ATen/nn.yaml'\r\n+ CUDA_NVCC_FLAGS=' -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1'\r\n+ [[ -z '' ]]\r\n+ CUDA_DEVICE_DEBUG=0\r\n+ '[' -z '' ']'\r\n++ getconf _NPROCESSORS_ONLN\r\n+ MAX_JOBS=16\r\n+ BUILD_TYPE=Release\r\n+ [[ -n '' ]]\r\n+ [[ -n '' ]]\r\n+ echo 'Building in Release mode'\r\nBuilding in Release mode\r\n+ mkdir -p /home/gradescan/boa/pytorch/torch/lib/tmp_install\r\n+ for arg in '\"$@\"'\r\n+ [[ nccl == \\n\\c\\c\\l ]]\r\n+ pushd /home/gradescan/boa/pytorch/third_party\r\n~/boa/pytorch/third_party ~/boa/pytorch/build\r\n+ build_nccl\r\n+ mkdir -p build/nccl\r\n+ pushd build/nccl\r\n~/boa/pytorch/third_party/build/nccl ~/boa/pytorch/third_party ~/boa/pytorch/build\r\n+ [[ 1 -eq 1 ]]\r\n+ cmake ../../nccl -DCMAKE_MODULE_PATH=/home/gradescan/boa/pytorch/cmake/Modules_CUDA_fix -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/home/gradescan/boa/pytorch/torch/lib/tmp_install '-DCMAKE_C_FLAGS= -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1 ' '-DCMAKE_CXX_FLAGS= -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/TH\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THC\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THS\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCS\"   -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THNN\" -I\"/home/gradescan/boa/pytorch/torch/lib/tmp_install/include/THCUNN\" -DOMPI_SKIP_MPICXX=1  -std=c++11  ' -DCMAKE_SHARED_LINKER_FLAGS= -DCMAKE_UTILS_PATH=/home/gradescan/boa/pytorch/cmake/public/utils.cmake -DNUM_JOBS=16\r\n-- Autodetected CUDA architecture(s): 6.1;6.1\r\n-- Set NVCC_GENCODE for building NCCL: -gencode=arch=compute_61,code=sm_61\r\n-- Configuring done\r\n-- Generating done\r\n-- Build files have been written to: /home/gradescan/boa/pytorch/third_party/build/nccl\r\n+ make install -j16\r\n[100%] Generating lib/libnccl.so\r\nmake[3]: warning: -jN forced in submake: disabling jobserver mode.\r\nnvlink fatal   : Input file '/home/gradescan/boa/pytorch/third_party/build/nccl/obj/collectives/device/all_reduce_sum.o' newer than toolkit\r\nMakefile:83: recipe for target '/home/gradescan/boa/pytorch/third_party/build/nccl/obj/collectives/device/devlink.o' failed\r\nmake[5]: *** [/home/gradescan/boa/pytorch/third_party/build/nccl/obj/collectives/device/devlink.o] Error 1\r\nMakefile:45: recipe for target 'devicelib' failed\r\nmake[4]: *** [devicelib] Error 2\r\nMakefile:24: recipe for target 'src.build' failed\r\nmake[3]: *** [src.build] Error 2\r\nCMakeFiles/nccl.dir/build.make:60: recipe for target 'lib/libnccl.so' failed\r\nmake[2]: *** [lib/libnccl.so] Error 2\r\nCMakeFiles/Makefile2:67: recipe for target 'CMakeFiles/nccl.dir/all' failed\r\nmake[1]: *** [CMakeFiles/nccl.dir/all] Error 2\r\nMakefile:127: recipe for target 'all' failed\r\nmake: *** [all] Error 2\r\nFailed to run 'bash ../tools/build_pytorch_libs.sh --use-cuda --use-nnpack nccl caffe2 libshm gloo c10d THD'\r\n```\r\n\r\n## Expected behavior\r\n\r\nIt compiles.\r\n\r\n## Environment\r\n\r\n - PyTorch Version (e.g., 1.0): 2018-10-16 following directions above\r\n - OS (e.g., Linux): Ubuntu 16.04\r\n - How you installed PyTorch (`conda`, `pip`, source): source\r\n - Build command you used (if compiling from source): See Steps to Reproduce\r\n - Python version: 2.7.12\r\n - CUDA/cuDNN version: release 7.5, V7.5.17\r\n - GPU models and configuration: 2 Tesla P40s.\r\n - Any other relevant information:\r\n\r\n## Additional context\r\n"}