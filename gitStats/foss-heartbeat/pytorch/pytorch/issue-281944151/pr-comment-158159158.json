{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/158159158", "pull_request_review_id": 84924610, "id": 158159158, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1ODE1OTE1OA==", "diff_hunk": "@@ -343,10 +343,29 @@ def backward_extended(self, grad_output, grad_hy):\n \n \n def RNN_symbolic_builder(*args, **kwargs):\n-    def symbolic(g, input, all_weights, hx, **kwargs):\n-        # Something can go here, e.g.\n-        # return g.op('LSTM', input, *all_weights[0], outputs=2)\n-        raise RuntimeError(\"RNN symbolic NYI\")\n+    assert args[0] == 'LSTM'\n+\n+    num_layers = kwargs['num_layers']\n+    hidden_size = args[2]\n+\n+    def symbolic(g, input, all_weights, h0_and_c0, **fkwargs):\n+        h0, c0 = h0_and_c0\n+        sequence_len = input.type().sizes()[0]\n+        batch_size = input.type().sizes()[1]\n+\n+        weight_ih = all_weights[0][0]\n+        weight_hh = all_weights[0][1]\n+        bias_concat = g.op('Concat', all_weights[0][2], all_weights[0][3], axis_i=0)\n+        sequence_lens = g.op('Constant', value_t=torch.IntTensor(batch_size).fill_(sequence_len))", "path": "torch/nn/_functions/rnn.py", "position": null, "original_position": 21, "commit_id": "4447b80b5ee66bf347af6ce8dcfb9d3b0683cf02", "original_commit_id": "e52f92b66661b3832c27d2e6729283478acad458", "user": {"login": "dzhulgakov", "id": 17890620, "node_id": "MDQ6VXNlcjE3ODkwNjIw", "avatar_url": "https://avatars2.githubusercontent.com/u/17890620?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dzhulgakov", "html_url": "https://github.com/dzhulgakov", "followers_url": "https://api.github.com/users/dzhulgakov/followers", "following_url": "https://api.github.com/users/dzhulgakov/following{/other_user}", "gists_url": "https://api.github.com/users/dzhulgakov/gists{/gist_id}", "starred_url": "https://api.github.com/users/dzhulgakov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dzhulgakov/subscriptions", "organizations_url": "https://api.github.com/users/dzhulgakov/orgs", "repos_url": "https://api.github.com/users/dzhulgakov/repos", "events_url": "https://api.github.com/users/dzhulgakov/events{/privacy}", "received_events_url": "https://api.github.com/users/dzhulgakov/received_events", "type": "User", "site_admin": false}, "body": "just skip providing this argument (it's denoted as optional). The problem with what you're doing right now is that the exported net won't work with different input sizes (i.e. different sequence lengths or batch size) while that's what people usually want", "created_at": "2017-12-20T23:04:12Z", "updated_at": "2018-11-23T15:37:35Z", "html_url": "https://github.com/pytorch/pytorch/pull/4163#discussion_r158159158", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/4163", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/158159158"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/4163#discussion_r158159158"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/4163"}}, "body_html": "<p>just skip providing this argument (it's denoted as optional). The problem with what you're doing right now is that the exported net won't work with different input sizes (i.e. different sequence lengths or batch size) while that's what people usually want</p>", "body_text": "just skip providing this argument (it's denoted as optional). The problem with what you're doing right now is that the exported net won't work with different input sizes (i.e. different sequence lengths or batch size) while that's what people usually want"}