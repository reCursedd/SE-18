{"url": "https://api.github.com/repos/pytorch/pytorch/issues/4869", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/4869/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/4869/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/4869/events", "html_url": "https://github.com/pytorch/pytorch/issues/4869", "id": 291841580, "node_id": "MDU6SXNzdWUyOTE4NDE1ODA=", "number": 4869, "title": "Compilation fails because CMake silently picks up cudnn from conda", "user": {"login": "DavidNemeskey", "id": 690386, "node_id": "MDQ6VXNlcjY5MDM4Ng==", "avatar_url": "https://avatars3.githubusercontent.com/u/690386?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DavidNemeskey", "html_url": "https://github.com/DavidNemeskey", "followers_url": "https://api.github.com/users/DavidNemeskey/followers", "following_url": "https://api.github.com/users/DavidNemeskey/following{/other_user}", "gists_url": "https://api.github.com/users/DavidNemeskey/gists{/gist_id}", "starred_url": "https://api.github.com/users/DavidNemeskey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DavidNemeskey/subscriptions", "organizations_url": "https://api.github.com/users/DavidNemeskey/orgs", "repos_url": "https://api.github.com/users/DavidNemeskey/repos", "events_url": "https://api.github.com/users/DavidNemeskey/events{/privacy}", "received_events_url": "https://api.github.com/users/DavidNemeskey/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 778855555, "node_id": "MDU6TGFiZWw3Nzg4NTU1NTU=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/build", "name": "build", "color": "bfdadc", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-01-26T09:22:47Z", "updated_at": "2018-02-05T10:09:25Z", "closed_at": "2018-02-04T15:36:23Z", "author_association": "NONE", "body_html": "<p>I was trying to compile master from source, but the test cases did not compile. It turns out I ran into the same problem as <a href=\"https://github.com/pytorch/pytorch/issues/3567#issuecomment-342895938\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/3567/hovercard\">VladislavZavadskyy did</a> in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"272274926\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/3567\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/3567/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/3567\">#3567</a>: CMake picked up the cuDNN package installed by conda instead of the one manually installed system-wide. That issue was closed as removing the conda version was deemed a \"solution\". However, I think this <strong>is</strong> a problem that should be reported as its own issue (and solved). As I see it, the main problems are:</p>\n<ol>\n<li>As seen in the logs below, CMake explicitly reports that it found the system-wide cuDNN version:\n<pre><code>-- Found cuDNN: v6.0.21  (include: /usr/local/cuda/include, library: /usr/local/cuda/lib64/libcudnn.so)\n</code></pre>\n; but then it goes on to use the library installed by conda <em>without any notice</em> (and the header in the system-wide version, hence the error). Note that for MKL, the logs clearly show that it was taken from the conda environent; not for cuDNN.</li>\n<li>The conda cudnn package is a dependency of tensorflow-gpu 1.4.1, so uninstalling it also removes tensorflow. Of course, I can re-install it via pip, but conda version has different package structures so this issue messes up the environment (as can be seen in the conda/pip lists).</li>\n</ol>\n<ul>\n<li>OS: Linux charlie 3.16.0-4-amd64 <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"171281708\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/1\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/1/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/1\">#1</a> SMP Debian 3.16.43-2+deb8u5 (2017-09-19) x86_64 GNU/Linux</li>\n<li>PyTorch version: master</li>\n<li>How you installed PyTorch (conda, pip, source): source</li>\n<li>Python version: 3.6</li>\n<li>CUDA/cuDNN version: now that's the problem (CUDA 8 / cuDNN 6 vs 7 in conda)</li>\n<li>GPU models and configuration: GeForce GTX 980</li>\n<li>GCC version (if compiling from source): 4.9.2</li>\n</ul>\n<p><a href=\"https://github.com/pytorch/pytorch/files/1667223/cmake_log.txt\">cmake_log.txt</a><br>\n<a href=\"https://github.com/pytorch/pytorch/files/1667227/conda_list.txt\">conda_list.txt</a><br>\n<a href=\"https://github.com/pytorch/pytorch/files/1667228/pip_list.txt\">pip_list.txt</a></p>", "body_text": "I was trying to compile master from source, but the test cases did not compile. It turns out I ran into the same problem as VladislavZavadskyy did in #3567: CMake picked up the cuDNN package installed by conda instead of the one manually installed system-wide. That issue was closed as removing the conda version was deemed a \"solution\". However, I think this is a problem that should be reported as its own issue (and solved). As I see it, the main problems are:\n\nAs seen in the logs below, CMake explicitly reports that it found the system-wide cuDNN version:\n-- Found cuDNN: v6.0.21  (include: /usr/local/cuda/include, library: /usr/local/cuda/lib64/libcudnn.so)\n\n; but then it goes on to use the library installed by conda without any notice (and the header in the system-wide version, hence the error). Note that for MKL, the logs clearly show that it was taken from the conda environent; not for cuDNN.\nThe conda cudnn package is a dependency of tensorflow-gpu 1.4.1, so uninstalling it also removes tensorflow. Of course, I can re-install it via pip, but conda version has different package structures so this issue messes up the environment (as can be seen in the conda/pip lists).\n\n\nOS: Linux charlie 3.16.0-4-amd64 #1 SMP Debian 3.16.43-2+deb8u5 (2017-09-19) x86_64 GNU/Linux\nPyTorch version: master\nHow you installed PyTorch (conda, pip, source): source\nPython version: 3.6\nCUDA/cuDNN version: now that's the problem (CUDA 8 / cuDNN 6 vs 7 in conda)\nGPU models and configuration: GeForce GTX 980\nGCC version (if compiling from source): 4.9.2\n\ncmake_log.txt\nconda_list.txt\npip_list.txt", "body": "I was trying to compile master from source, but the test cases did not compile. It turns out I ran into the same problem as [VladislavZavadskyy did](https://github.com/pytorch/pytorch/issues/3567#issuecomment-342895938) in #3567: CMake picked up the cuDNN package installed by conda instead of the one manually installed system-wide. That issue was closed as removing the conda version was deemed a \"solution\". However, I think this **is** a problem that should be reported as its own issue (and solved). As I see it, the main problems are:\r\n\r\n1. As seen in the logs below, CMake explicitly reports that it found the system-wide cuDNN version:\r\n    ```\r\n    -- Found cuDNN: v6.0.21  (include: /usr/local/cuda/include, library: /usr/local/cuda/lib64/libcudnn.so)\r\n    ```\r\n    ; but then it goes on to use the library installed by conda _without any notice_ (and the header in the system-wide version, hence the error). Note that for MKL, the logs clearly show that it was taken from the conda environent; not for cuDNN.\r\n1. The conda cudnn package is a dependency of tensorflow-gpu 1.4.1, so uninstalling it also removes tensorflow. Of course, I can re-install it via pip, but conda version has different package structures so this issue messes up the environment (as can be seen in the conda/pip lists).\r\n\r\n- OS: Linux charlie 3.16.0-4-amd64 #1 SMP Debian 3.16.43-2+deb8u5 (2017-09-19) x86_64 GNU/Linux\r\n- PyTorch version: master\r\n- How you installed PyTorch (conda, pip, source): source\r\n- Python version: 3.6\r\n- CUDA/cuDNN version: now that's the problem (CUDA 8 / cuDNN 6 vs 7 in conda)\r\n- GPU models and configuration: GeForce GTX 980\r\n- GCC version (if compiling from source): 4.9.2\r\n\r\n[cmake_log.txt](https://github.com/pytorch/pytorch/files/1667223/cmake_log.txt)\r\n[conda_list.txt](https://github.com/pytorch/pytorch/files/1667227/conda_list.txt)\r\n[pip_list.txt](https://github.com/pytorch/pytorch/files/1667228/pip_list.txt)\r\n"}