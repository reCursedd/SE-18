{"url": "https://api.github.com/repos/pytorch/pytorch/issues/8282", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/8282/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/8282/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/8282/events", "html_url": "https://github.com/pytorch/pytorch/issues/8282", "id": 330644264, "node_id": "MDU6SXNzdWUzMzA2NDQyNjQ=", "number": 8282, "title": "Loaded network with load_state_dict has different shape but works anyway", "user": {"login": "mario98", "id": 23034262, "node_id": "MDQ6VXNlcjIzMDM0MjYy", "avatar_url": "https://avatars1.githubusercontent.com/u/23034262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mario98", "html_url": "https://github.com/mario98", "followers_url": "https://api.github.com/users/mario98/followers", "following_url": "https://api.github.com/users/mario98/following{/other_user}", "gists_url": "https://api.github.com/users/mario98/gists{/gist_id}", "starred_url": "https://api.github.com/users/mario98/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mario98/subscriptions", "organizations_url": "https://api.github.com/users/mario98/orgs", "repos_url": "https://api.github.com/users/mario98/repos", "events_url": "https://api.github.com/users/mario98/events{/privacy}", "received_events_url": "https://api.github.com/users/mario98/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 424131847, "node_id": "MDU6TGFiZWw0MjQxMzE4NDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/bug", "name": "bug", "color": "b60205", "default": true}, {"id": 443483881, "node_id": "MDU6TGFiZWw0NDM0ODM4ODE=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/todo", "name": "todo", "color": "c2e0c6", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "ailzhang", "id": 5248122, "node_id": "MDQ6VXNlcjUyNDgxMjI=", "avatar_url": "https://avatars2.githubusercontent.com/u/5248122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ailzhang", "html_url": "https://github.com/ailzhang", "followers_url": "https://api.github.com/users/ailzhang/followers", "following_url": "https://api.github.com/users/ailzhang/following{/other_user}", "gists_url": "https://api.github.com/users/ailzhang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ailzhang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ailzhang/subscriptions", "organizations_url": "https://api.github.com/users/ailzhang/orgs", "repos_url": "https://api.github.com/users/ailzhang/repos", "events_url": "https://api.github.com/users/ailzhang/events{/privacy}", "received_events_url": "https://api.github.com/users/ailzhang/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ailzhang", "id": 5248122, "node_id": "MDQ6VXNlcjUyNDgxMjI=", "avatar_url": "https://avatars2.githubusercontent.com/u/5248122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ailzhang", "html_url": "https://github.com/ailzhang", "followers_url": "https://api.github.com/users/ailzhang/followers", "following_url": "https://api.github.com/users/ailzhang/following{/other_user}", "gists_url": "https://api.github.com/users/ailzhang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ailzhang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ailzhang/subscriptions", "organizations_url": "https://api.github.com/users/ailzhang/orgs", "repos_url": "https://api.github.com/users/ailzhang/repos", "events_url": "https://api.github.com/users/ailzhang/events{/privacy}", "received_events_url": "https://api.github.com/users/ailzhang/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2018-06-08T12:46:12Z", "updated_at": "2018-06-19T03:16:35Z", "closed_at": "2018-06-19T03:16:35Z", "author_association": "NONE", "body_html": "<p>After it was verified on <a href=\"https://discuss.pytorch.org/t/loaded-network-has-different-shape-but-works-anyway/19398\" rel=\"nofollow\">discuss.pytorch</a> that this is indeed unwanted behaviour, I am forwarding this to you:</p>\n<h2>Issue description</h2>\n<p>I trained a model with among others had the following layer:<br>\n<code>final_layer.append(nn.Conv2d(64, 1, kernel_size=1))</code><br>\nand then saved it to a file with state_dict and torch.save.</p>\n<p>Then, when I wanted to load that model using load_state_dict, by accident the same layer was setup as follows:<br>\n<code>final_layer.append(nn.Conv2d(64, 32, kernel_size=1))</code></p>\n<p>Nevertheless, the model was loaded without error. It seemed that the weights were just duplicated 32 times, but I have not verified. So the question is how this is consistent with API documentation. I have not found a statement that says load_state_dict would somehow fix shape inconsistencies automatically. It seems you have a documentation vs reality mismatch here. (Now you need to decide which one to fix)</p>\n<h2>Code example</h2>\n<pre><code>path = './test_model.pth'\n\nmodel = nn.Conv2d(64, 1, 3, 1, 1)\ntorch.save(model.state_dict(), path)\n\nmodel = nn.Conv2d(64, 32, 3, 1, 1)\nmodel.load_state_dict(torch.load(path))\n\nfor w in model.weight[:, :, 0, 0]:\n    print(w)\n</code></pre>\n<p>Provided by discuss .pytorch user ptrblck</p>\n<h2>System Info</h2>\n<p>pytorch 0.4 release</p>", "body_text": "After it was verified on discuss.pytorch that this is indeed unwanted behaviour, I am forwarding this to you:\nIssue description\nI trained a model with among others had the following layer:\nfinal_layer.append(nn.Conv2d(64, 1, kernel_size=1))\nand then saved it to a file with state_dict and torch.save.\nThen, when I wanted to load that model using load_state_dict, by accident the same layer was setup as follows:\nfinal_layer.append(nn.Conv2d(64, 32, kernel_size=1))\nNevertheless, the model was loaded without error. It seemed that the weights were just duplicated 32 times, but I have not verified. So the question is how this is consistent with API documentation. I have not found a statement that says load_state_dict would somehow fix shape inconsistencies automatically. It seems you have a documentation vs reality mismatch here. (Now you need to decide which one to fix)\nCode example\npath = './test_model.pth'\n\nmodel = nn.Conv2d(64, 1, 3, 1, 1)\ntorch.save(model.state_dict(), path)\n\nmodel = nn.Conv2d(64, 32, 3, 1, 1)\nmodel.load_state_dict(torch.load(path))\n\nfor w in model.weight[:, :, 0, 0]:\n    print(w)\n\nProvided by discuss .pytorch user ptrblck\nSystem Info\npytorch 0.4 release", "body": "After it was verified on [discuss.pytorch](https://discuss.pytorch.org/t/loaded-network-has-different-shape-but-works-anyway/19398) that this is indeed unwanted behaviour, I am forwarding this to you:\r\n\r\n## Issue description\r\n\r\nI trained a model with among others had the following layer:\r\n`final_layer.append(nn.Conv2d(64, 1, kernel_size=1))`\r\nand then saved it to a file with state_dict and torch.save.\r\n\r\nThen, when I wanted to load that model using load_state_dict, by accident the same layer was setup as follows:\r\n`final_layer.append(nn.Conv2d(64, 32, kernel_size=1))`\r\n\r\nNevertheless, the model was loaded without error. It seemed that the weights were just duplicated 32 times, but I have not verified. So the question is how this is consistent with API documentation. I have not found a statement that says load_state_dict would somehow fix shape inconsistencies automatically. It seems you have a documentation vs reality mismatch here. (Now you need to decide which one to fix)\r\n\r\n## Code example\r\n\r\n```\r\npath = './test_model.pth'\r\n\r\nmodel = nn.Conv2d(64, 1, 3, 1, 1)\r\ntorch.save(model.state_dict(), path)\r\n\r\nmodel = nn.Conv2d(64, 32, 3, 1, 1)\r\nmodel.load_state_dict(torch.load(path))\r\n\r\nfor w in model.weight[:, :, 0, 0]:\r\n    print(w)\r\n```\r\n\r\nProvided by discuss .pytorch user ptrblck\r\n\r\n## System Info\r\npytorch 0.4 release\r\n\r\n"}