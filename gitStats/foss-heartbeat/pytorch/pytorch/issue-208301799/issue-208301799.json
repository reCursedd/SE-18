{"url": "https://api.github.com/repos/pytorch/pytorch/issues/767", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/767/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/767/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/767/events", "html_url": "https://github.com/pytorch/pytorch/issues/767", "id": 208301799, "node_id": "MDU6SXNzdWUyMDgzMDE3OTk=", "number": 767, "title": "in DataParallel cudnn rnn dropout states are initialized on a single device", "user": {"login": "ngimel", "id": 15841449, "node_id": "MDQ6VXNlcjE1ODQxNDQ5", "avatar_url": "https://avatars3.githubusercontent.com/u/15841449?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ngimel", "html_url": "https://github.com/ngimel", "followers_url": "https://api.github.com/users/ngimel/followers", "following_url": "https://api.github.com/users/ngimel/following{/other_user}", "gists_url": "https://api.github.com/users/ngimel/gists{/gist_id}", "starred_url": "https://api.github.com/users/ngimel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ngimel/subscriptions", "organizations_url": "https://api.github.com/users/ngimel/orgs", "repos_url": "https://api.github.com/users/ngimel/repos", "events_url": "https://api.github.com/users/ngimel/events{/privacy}", "received_events_url": "https://api.github.com/users/ngimel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 424131847, "node_id": "MDU6TGFiZWw0MjQxMzE4NDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/bug", "name": "bug", "color": "b60205", "default": true}, {"id": 443484135, "node_id": "MDU6TGFiZWw0NDM0ODQxMzU=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/high%20priority", "name": "high priority", "color": "F22613", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-02-17T01:11:26Z", "updated_at": "2017-02-17T18:16:27Z", "closed_at": "2017-02-17T18:16:27Z", "author_association": "CONTRIBUTOR", "body_html": "<p>In multi-GPU runs with cudnn rnn, dropout states are initialized on a single device (non-deterministically, can be any device), and all devices access the states on that one (I suspect if P2P is disabled, it will break outright). That leads to</p>\n<ol>\n<li>non-deterministic correlated random numbers generated on the different devices</li>\n<li>performance implications: shown is the profile where dropout kernels accessing states remotely, take 50 times as long as the kernels where state is local (purple kernels barely visible on upper timeline, and fat purple kernels on the lower timeline)<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://cloud.githubusercontent.com/assets/15841449/23048437/a251c022-f46a-11e6-9073-536081197729.png\"><img src=\"https://cloud.githubusercontent.com/assets/15841449/23048437/a251c022-f46a-11e6-9073-536081197729.png\" alt=\"selection_008\" style=\"max-width:100%;\"></a><br>\n.</li>\n</ol>", "body_text": "In multi-GPU runs with cudnn rnn, dropout states are initialized on a single device (non-deterministically, can be any device), and all devices access the states on that one (I suspect if P2P is disabled, it will break outright). That leads to\n\nnon-deterministic correlated random numbers generated on the different devices\nperformance implications: shown is the profile where dropout kernels accessing states remotely, take 50 times as long as the kernels where state is local (purple kernels barely visible on upper timeline, and fat purple kernels on the lower timeline)\n\n.", "body": "In multi-GPU runs with cudnn rnn, dropout states are initialized on a single device (non-deterministically, can be any device), and all devices access the states on that one (I suspect if P2P is disabled, it will break outright). That leads to \r\n1) non-deterministic correlated random numbers generated on the different devices\r\n2) performance implications: shown is the profile where dropout kernels accessing states remotely, take 50 times as long as the kernels where state is local (purple kernels barely visible on upper timeline, and fat purple kernels on the lower timeline)\r\n![selection_008](https://cloud.githubusercontent.com/assets/15841449/23048437/a251c022-f46a-11e6-9073-536081197729.png)\r\n. "}