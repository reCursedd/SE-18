{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/392341351", "html_url": "https://github.com/pytorch/pytorch/issues/5219#issuecomment-392341351", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/5219", "id": 392341351, "node_id": "MDEyOklzc3VlQ29tbWVudDM5MjM0MTM1MQ==", "user": {"login": "ivankreso", "id": 2056432, "node_id": "MDQ6VXNlcjIwNTY0MzI=", "avatar_url": "https://avatars3.githubusercontent.com/u/2056432?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ivankreso", "html_url": "https://github.com/ivankreso", "followers_url": "https://api.github.com/users/ivankreso/followers", "following_url": "https://api.github.com/users/ivankreso/following{/other_user}", "gists_url": "https://api.github.com/users/ivankreso/gists{/gist_id}", "starred_url": "https://api.github.com/users/ivankreso/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ivankreso/subscriptions", "organizations_url": "https://api.github.com/users/ivankreso/orgs", "repos_url": "https://api.github.com/users/ivankreso/repos", "events_url": "https://api.github.com/users/ivankreso/events{/privacy}", "received_events_url": "https://api.github.com/users/ivankreso/received_events", "type": "User", "site_admin": false}, "created_at": "2018-05-27T15:46:57Z", "updated_at": "2018-05-27T16:12:28Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=13564\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ezyang\">@ezyang</a>  I got this segfault with the same stack trace:</p>\n<pre><code>#0  std::__push_heap&lt;__gnu_cxx::__normal_iterator&lt;torch::autograd::FunctionTask*, std::vector&lt;torch::autograd::FunctionTask&gt; &gt;, long, torch::autograd::FunctionTask, __gnu_cxx::__ops::_Iter_comp_val&lt;torch::autogr\nad::CompareFunctionTaskTime&gt; &gt; (__first=                                                                                                                                                                           \n            {base = 0x7fffffffcdd0, fn = std::shared_ptr&lt;torch::autograd::Function&gt; (use count 2, weak count 2) = {get() = 0x555558a923b0}, inputs = {buffer = std::vector of length 1, capacity 1 = {{&lt;at::Tensor&gt;\n = {&lt;at::detail::TensorBase&gt; = {pImpl = 0x7fff480a1050}, &lt;No data fields&gt;}, &lt;No data fields&gt;}}}}, __holeIndex=32, __topIndex=__topIndex@entry=0, __value=..., __comp=...)                                          \n    at /opt/rh/devtoolset-3/root/usr/include/c++/4.9.2/bits/stl_heap.h:129                                                                                                                                         \n#1  0x00007fffda8c7572 in std::push_heap&lt;__gnu_cxx::__normal_iterator&lt;torch::autograd::FunctionTask*, std::vector&lt;torch::autograd::FunctionTask&gt; &gt;, torch::autograd::CompareFunctionTaskTime&gt; (__comp=...,\n    __last=..., __first=...) at /opt/rh/devtoolset-3/root/usr/include/c++/4.9.2/bits/stl_heap.h:199\n#2  std::priority_queue&lt;torch::autograd::FunctionTask, std::vector&lt;torch::autograd::FunctionTask, std::allocator&lt;torch::autograd::FunctionTask&gt; &gt;, torch::autograd::CompareFunctionTaskTime&gt;::push (__x=...,\n    this=0x555556dc7bd0) at /opt/rh/devtoolset-3/root/usr/include/c++/4.9.2/bits/stl_queue.h:510\n#3  torch::autograd::ReadyQueue::push (this=0x555556dc7bd0, item=...) at torch/csrc/autograd/engine.cpp:185\n#4  0x00007fffda8cac88 in torch::autograd::Engine::thread_main (this=0x7fffe61c4a00 &lt;engine&gt;, graph_task=0x0) at torch/csrc/autograd/engine.cpp:261\n#5  0x00007fffda8c6fce in torch::autograd::Engine::thread_init (this=this@entry=0x7fffe61c4a00 &lt;engine&gt;, device=device@entry=-1) at torch/csrc/autograd/engine.cpp:207\n#6  0x00007fffda8f4a2a in torch::autograd::python::PythonEngine::thread_init (this=0x7fffe61c4a00 &lt;engine&gt;, device=-1) at torch/csrc/autograd/python_engine.cpp:40\n#7  0x00007fffaec8f0c0 in execute_native_thread_routine_compat () at /build/gcc/src/gcc/libstdc++-v3/src/c++11/thread.cc:94\n#8  0x00007ffff7bc1075 in start_thread () from /usr/lib/libpthread.so.0\n#9  0x00007ffff78f653f in clone () from /usr/lib/libc.so.6\n\n</code></pre>\n<p>I believe the problem is that this \"dummy function task\" gets nullptr as Function in constructor here:<br>\n<a href=\"https://github.com/pytorch/pytorch/blob/master/torch/csrc/autograd/engine.cpp#L262\">https://github.com/pytorch/pytorch/blob/master/torch/csrc/autograd/engine.cpp#L262</a></p>\n<p>Then later on after pushing it in the heap we get nullptr dereferencing segfault here:<br>\n<a href=\"https://github.com/pytorch/pytorch/blob/master/torch/csrc/autograd/engine.cpp#L70\">https://github.com/pytorch/pytorch/blob/master/torch/csrc/autograd/engine.cpp#L70</a></p>", "body_text": "@ezyang  I got this segfault with the same stack trace:\n#0  std::__push_heap<__gnu_cxx::__normal_iterator<torch::autograd::FunctionTask*, std::vector<torch::autograd::FunctionTask> >, long, torch::autograd::FunctionTask, __gnu_cxx::__ops::_Iter_comp_val<torch::autogr\nad::CompareFunctionTaskTime> > (__first=                                                                                                                                                                           \n            {base = 0x7fffffffcdd0, fn = std::shared_ptr<torch::autograd::Function> (use count 2, weak count 2) = {get() = 0x555558a923b0}, inputs = {buffer = std::vector of length 1, capacity 1 = {{<at::Tensor>\n = {<at::detail::TensorBase> = {pImpl = 0x7fff480a1050}, <No data fields>}, <No data fields>}}}}, __holeIndex=32, __topIndex=__topIndex@entry=0, __value=..., __comp=...)                                          \n    at /opt/rh/devtoolset-3/root/usr/include/c++/4.9.2/bits/stl_heap.h:129                                                                                                                                         \n#1  0x00007fffda8c7572 in std::push_heap<__gnu_cxx::__normal_iterator<torch::autograd::FunctionTask*, std::vector<torch::autograd::FunctionTask> >, torch::autograd::CompareFunctionTaskTime> (__comp=...,\n    __last=..., __first=...) at /opt/rh/devtoolset-3/root/usr/include/c++/4.9.2/bits/stl_heap.h:199\n#2  std::priority_queue<torch::autograd::FunctionTask, std::vector<torch::autograd::FunctionTask, std::allocator<torch::autograd::FunctionTask> >, torch::autograd::CompareFunctionTaskTime>::push (__x=...,\n    this=0x555556dc7bd0) at /opt/rh/devtoolset-3/root/usr/include/c++/4.9.2/bits/stl_queue.h:510\n#3  torch::autograd::ReadyQueue::push (this=0x555556dc7bd0, item=...) at torch/csrc/autograd/engine.cpp:185\n#4  0x00007fffda8cac88 in torch::autograd::Engine::thread_main (this=0x7fffe61c4a00 <engine>, graph_task=0x0) at torch/csrc/autograd/engine.cpp:261\n#5  0x00007fffda8c6fce in torch::autograd::Engine::thread_init (this=this@entry=0x7fffe61c4a00 <engine>, device=device@entry=-1) at torch/csrc/autograd/engine.cpp:207\n#6  0x00007fffda8f4a2a in torch::autograd::python::PythonEngine::thread_init (this=0x7fffe61c4a00 <engine>, device=-1) at torch/csrc/autograd/python_engine.cpp:40\n#7  0x00007fffaec8f0c0 in execute_native_thread_routine_compat () at /build/gcc/src/gcc/libstdc++-v3/src/c++11/thread.cc:94\n#8  0x00007ffff7bc1075 in start_thread () from /usr/lib/libpthread.so.0\n#9  0x00007ffff78f653f in clone () from /usr/lib/libc.so.6\n\n\nI believe the problem is that this \"dummy function task\" gets nullptr as Function in constructor here:\nhttps://github.com/pytorch/pytorch/blob/master/torch/csrc/autograd/engine.cpp#L262\nThen later on after pushing it in the heap we get nullptr dereferencing segfault here:\nhttps://github.com/pytorch/pytorch/blob/master/torch/csrc/autograd/engine.cpp#L70", "body": "@ezyang  I got this segfault with the same stack trace:\r\n\r\n```\r\n#0  std::__push_heap<__gnu_cxx::__normal_iterator<torch::autograd::FunctionTask*, std::vector<torch::autograd::FunctionTask> >, long, torch::autograd::FunctionTask, __gnu_cxx::__ops::_Iter_comp_val<torch::autogr\r\nad::CompareFunctionTaskTime> > (__first=                                                                                                                                                                           \r\n            {base = 0x7fffffffcdd0, fn = std::shared_ptr<torch::autograd::Function> (use count 2, weak count 2) = {get() = 0x555558a923b0}, inputs = {buffer = std::vector of length 1, capacity 1 = {{<at::Tensor>\r\n = {<at::detail::TensorBase> = {pImpl = 0x7fff480a1050}, <No data fields>}, <No data fields>}}}}, __holeIndex=32, __topIndex=__topIndex@entry=0, __value=..., __comp=...)                                          \r\n    at /opt/rh/devtoolset-3/root/usr/include/c++/4.9.2/bits/stl_heap.h:129                                                                                                                                         \r\n#1  0x00007fffda8c7572 in std::push_heap<__gnu_cxx::__normal_iterator<torch::autograd::FunctionTask*, std::vector<torch::autograd::FunctionTask> >, torch::autograd::CompareFunctionTaskTime> (__comp=...,\r\n    __last=..., __first=...) at /opt/rh/devtoolset-3/root/usr/include/c++/4.9.2/bits/stl_heap.h:199\r\n#2  std::priority_queue<torch::autograd::FunctionTask, std::vector<torch::autograd::FunctionTask, std::allocator<torch::autograd::FunctionTask> >, torch::autograd::CompareFunctionTaskTime>::push (__x=...,\r\n    this=0x555556dc7bd0) at /opt/rh/devtoolset-3/root/usr/include/c++/4.9.2/bits/stl_queue.h:510\r\n#3  torch::autograd::ReadyQueue::push (this=0x555556dc7bd0, item=...) at torch/csrc/autograd/engine.cpp:185\r\n#4  0x00007fffda8cac88 in torch::autograd::Engine::thread_main (this=0x7fffe61c4a00 <engine>, graph_task=0x0) at torch/csrc/autograd/engine.cpp:261\r\n#5  0x00007fffda8c6fce in torch::autograd::Engine::thread_init (this=this@entry=0x7fffe61c4a00 <engine>, device=device@entry=-1) at torch/csrc/autograd/engine.cpp:207\r\n#6  0x00007fffda8f4a2a in torch::autograd::python::PythonEngine::thread_init (this=0x7fffe61c4a00 <engine>, device=-1) at torch/csrc/autograd/python_engine.cpp:40\r\n#7  0x00007fffaec8f0c0 in execute_native_thread_routine_compat () at /build/gcc/src/gcc/libstdc++-v3/src/c++11/thread.cc:94\r\n#8  0x00007ffff7bc1075 in start_thread () from /usr/lib/libpthread.so.0\r\n#9  0x00007ffff78f653f in clone () from /usr/lib/libc.so.6\r\n\r\n```\r\n\r\nI believe the problem is that this \"dummy function task\" gets nullptr as Function in constructor here:\r\nhttps://github.com/pytorch/pytorch/blob/master/torch/csrc/autograd/engine.cpp#L262\r\n\r\nThen later on after pushing it in the heap we get nullptr dereferencing segfault here: \r\nhttps://github.com/pytorch/pytorch/blob/master/torch/csrc/autograd/engine.cpp#L70\r\n"}