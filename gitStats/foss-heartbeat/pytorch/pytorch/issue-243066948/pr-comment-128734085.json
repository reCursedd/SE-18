{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/128734085", "pull_request_review_id": 51441961, "id": 128734085, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyODczNDA4NQ==", "diff_hunk": "@@ -571,6 +571,37 @@ def batch_norm(input, running_mean, running_var, weight=None, bias=None,\n     return f(input, weight, bias)\n \n \n+def relation(input, g, f=None, embedding=None, max_pairwise=None):\n+    # Batch size, number of objects, feature size\n+    b, o, c = input.size()\n+    # Construct pairwise indices\n+    i = Variable(torch.arange(0, o).type_as(input.data).long().repeat(o))\n+    j = Variable(torch.arange(0, o).type_as(input.data).long().repeat(o, 1).t().contiguous().view(-1))\n+    # Create pairwise matrix\n+    pairs = torch.cat((torch.index_select(input, 1, i), torch.index_select(input, 1, j)), 2)", "path": "torch/nn/functional.py", "position": null, "original_position": 11, "commit_id": "7cf22b41375b4718d992162a54994fe7484e6889", "original_commit_id": "ced6a643f605e48eed60996fbe8bdbf7abeda017", "user": {"login": "Kaixhin", "id": 991891, "node_id": "MDQ6VXNlcjk5MTg5MQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/991891?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kaixhin", "html_url": "https://github.com/Kaixhin", "followers_url": "https://api.github.com/users/Kaixhin/followers", "following_url": "https://api.github.com/users/Kaixhin/following{/other_user}", "gists_url": "https://api.github.com/users/Kaixhin/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kaixhin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kaixhin/subscriptions", "organizations_url": "https://api.github.com/users/Kaixhin/orgs", "repos_url": "https://api.github.com/users/Kaixhin/repos", "events_url": "https://api.github.com/users/Kaixhin/events{/privacy}", "received_events_url": "https://api.github.com/users/Kaixhin/received_events", "type": "User", "site_admin": false}, "body": "I've added this, but it fails without `.contiguous()` before `.view()`, so new memory is being allocated here. Given this, are you really sure that this is better than creating indices (which shouldn't be very expensive) and using `index_select`?", "created_at": "2017-07-21T10:42:39Z", "updated_at": "2018-11-23T15:34:12Z", "html_url": "https://github.com/pytorch/pytorch/pull/2105#discussion_r128734085", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/2105", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/128734085"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/2105#discussion_r128734085"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/2105"}}, "body_html": "<p>I've added this, but it fails without <code>.contiguous()</code> before <code>.view()</code>, so new memory is being allocated here. Given this, are you really sure that this is better than creating indices (which shouldn't be very expensive) and using <code>index_select</code>?</p>", "body_text": "I've added this, but it fails without .contiguous() before .view(), so new memory is being allocated here. Given this, are you really sure that this is better than creating indices (which shouldn't be very expensive) and using index_select?", "in_reply_to_id": 128619273}