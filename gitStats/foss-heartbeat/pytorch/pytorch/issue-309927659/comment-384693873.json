{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/384693873", "html_url": "https://github.com/pytorch/pytorch/pull/6119#issuecomment-384693873", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/6119", "id": 384693873, "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDY5Mzg3Mw==", "user": {"login": "cpuhrsch", "id": 1716488, "node_id": "MDQ6VXNlcjE3MTY0ODg=", "avatar_url": "https://avatars1.githubusercontent.com/u/1716488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cpuhrsch", "html_url": "https://github.com/cpuhrsch", "followers_url": "https://api.github.com/users/cpuhrsch/followers", "following_url": "https://api.github.com/users/cpuhrsch/following{/other_user}", "gists_url": "https://api.github.com/users/cpuhrsch/gists{/gist_id}", "starred_url": "https://api.github.com/users/cpuhrsch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cpuhrsch/subscriptions", "organizations_url": "https://api.github.com/users/cpuhrsch/orgs", "repos_url": "https://api.github.com/users/cpuhrsch/repos", "events_url": "https://api.github.com/users/cpuhrsch/events{/privacy}", "received_events_url": "https://api.github.com/users/cpuhrsch/received_events", "type": "User", "site_admin": false}, "created_at": "2018-04-26T15:55:27Z", "updated_at": "2018-04-26T15:57:14Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=9998726\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/peterjc123\">@peterjc123</a></p>\n<p>Now if I also remove AT_API from <code>init_tbb_num_threads</code> I get</p>\n<pre><code>[116/136] Linking CXX executable src\\ATen\\test\\tbb_init_test.exe\nFAILED: src/ATen/test/tbb_init_test.exe\ncmd.exe /C \"cd . &amp;&amp; \"C:\\Program Files\\CMake\\bin\\cmake.exe\" -E vs_link_exe --intdir=src\\ATen\\test\\CMakeFiles\\tbb_init_test.dir --manifests  -- C:\\PROGRA~2\\MIB055~1\\2017\\COMMUN~1\\VC\\Tools\\MSVC\\1411~1.25\n5\\bin\\Hostx86\\x64\\link.exe /nologo src\\ATen\\test\\CMakeFiles\\tbb_init_test.dir\\tbb_init_test.cpp.obj  /out:src\\ATen\\test\\tbb_init_test.exe /implib:src\\ATen\\test\\tbb_init_test.lib /pdb:src\\ATen\\test\\tbb\n_init_test.pdb /version:0.0  /machine:x64 /LIBPATH:C:/Users/Administrator/cpuhrsch/pytorch/torch/lib/tmp_install/lib /INCREMENTAL:NO /subsystem:console  src\\ATen\\ATen.lib src\\ATen\\cpu\\tbb\\tbb_static.l\nib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_thread.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib\nC:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_thread.lib C\n:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib confu-deps\\cpuinfo\\cpuinfo.lib kernel32.lib user32.lib gdi32.lib winspool.lib\n shell32.lib ole32.lib oleaut32.lib uuid.lib comdlg32.lib advapi32.lib &amp;&amp; cd .\"\nLINK: command \"C:\\PROGRA~2\\MIB055~1\\2017\\COMMUN~1\\VC\\Tools\\MSVC\\1411~1.255\\bin\\Hostx86\\x64\\link.exe /nologo src\\ATen\\test\\CMakeFiles\\tbb_init_test.dir\\tbb_init_test.cpp.obj /out:src\\ATen\\test\\tbb_init\n_test.exe /implib:src\\ATen\\test\\tbb_init_test.lib /pdb:src\\ATen\\test\\tbb_init_test.pdb /version:0.0 /machine:x64 /LIBPATH:C:/Users/Administrator/cpuhrsch/pytorch/torch/lib/tmp_install/lib /INCREMENTAL\n:NO /subsystem:console src\\ATen\\ATen.lib src\\ATen\\cpu\\tbb\\tbb_static.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_th\nread.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib\nC:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_thread.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib confu-d\neps\\cpuinfo\\cpuinfo.lib kernel32.lib user32.lib gdi32.lib winspool.lib shell32.lib ole32.lib oleaut32.lib uuid.lib comdlg32.lib advapi32.lib /MANIFEST /MANIFESTFILE:src\\ATen\\test\\tbb_init_test.exe.man\nifest\" failed (exit code 1120) with the following output:\ntbb_init_test.cpp.obj : error LNK2019: unresolved external symbol \"void __cdecl at::set_num_threads(int)\" (?set_num_threads@at@@YAXH@Z) referenced in function main\ntbb_init_test.cpp.obj : error LNK2019: unresolved external symbol \"int __cdecl at::get_num_threads(void)\" (?get_num_threads@at@@YAHXZ) referenced in function \"void __cdecl test(int)\" (?test@@YAXH@Z)\nsrc\\ATen\\test\\tbb_init_test.exe : fatal error LNK1120: 2 unresolved externals\n[118/136] Linking CXX executable src\\ATen\\test\\test_parallel.exe\nFAILED: src/ATen/test/test_parallel.exe\ncmd.exe /C \"cd . &amp;&amp; \"C:\\Program Files\\CMake\\bin\\cmake.exe\" -E vs_link_exe --intdir=src\\ATen\\test\\CMakeFiles\\test_parallel.dir --manifests  -- C:\\PROGRA~2\\MIB055~1\\2017\\COMMUN~1\\VC\\Tools\\MSVC\\1411~1.25\n5\\bin\\Hostx86\\x64\\link.exe /nologo src\\ATen\\test\\CMakeFiles\\test_parallel.dir\\test_parallel.cpp.obj  /out:src\\ATen\\test\\test_parallel.exe /implib:src\\ATen\\test\\test_parallel.lib /pdb:src\\ATen\\test\\tes\nt_parallel.pdb /version:0.0  /machine:x64 /LIBPATH:C:/Users/Administrator/cpuhrsch/pytorch/torch/lib/tmp_install/lib /INCREMENTAL:NO /subsystem:console  src\\ATen\\ATen.lib src\\ATen\\cpu\\tbb\\tbb_static.l\nib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_thread.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib\nC:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_thread.lib C\n:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib confu-deps\\cpuinfo\\cpuinfo.lib kernel32.lib user32.lib gdi32.lib winspool.lib\n shell32.lib ole32.lib oleaut32.lib uuid.lib comdlg32.lib advapi32.lib &amp;&amp; cd .\"\nLINK: command \"C:\\PROGRA~2\\MIB055~1\\2017\\COMMUN~1\\VC\\Tools\\MSVC\\1411~1.255\\bin\\Hostx86\\x64\\link.exe /nologo src\\ATen\\test\\CMakeFiles\\test_parallel.dir\\test_parallel.cpp.obj /out:src\\ATen\\test\\test_par\nallel.exe /implib:src\\ATen\\test\\test_parallel.lib /pdb:src\\ATen\\test\\test_parallel.pdb /version:0.0 /machine:x64 /LIBPATH:C:/Users/Administrator/cpuhrsch/pytorch/torch/lib/tmp_install/lib /INCREMENTAL\n:NO /subsystem:console src\\ATen\\ATen.lib src\\ATen\\cpu\\tbb\\tbb_static.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_th\nread.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib\nC:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_thread.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib confu-d\neps\\cpuinfo\\cpuinfo.lib kernel32.lib user32.lib gdi32.lib winspool.lib shell32.lib ole32.lib oleaut32.lib uuid.lib comdlg32.lib advapi32.lib /MANIFEST /MANIFESTFILE:src\\ATen\\test\\test_parallel.exe.man\nifest\" failed (exit code 1120) with the following output:\ntest_parallel.cpp.obj : error LNK2019: unresolved external symbol \"void __cdecl at::set_num_threads(int)\" (?set_num_threads@at@@YAXH@Z) referenced in function \"void __cdecl ____C_A_T_C_H____T_E_S_T___\n_0(void)\" (?____C_A_T_C_H____T_E_S_T____0@@YAXXZ)\nsrc\\ATen\\test\\test_parallel.exe : fatal error LNK1120: 1 unresolved externals\n[129/136] Building CXX object src\\ATen\\test\\CMakeFiles\\basic.dir\\basic.cpp.obj\nninja: build stopped: subcommand failed.\n</code></pre>\n<p>which is why we added it there to begin with.</p>\n<p>However, it looks like it has maybe resolved the errors for the CPUApplyUtils.</p>\n<p>Maybe it's not possible to call a function with AT_API from a header function, because it's not coming from a .cpp file?</p>\n<p>EDIT: No it doesn't. I removed the calls from within tbb_init_test and now am getting the failures again within apply_utils_test</p>", "body_text": "@peterjc123\nNow if I also remove AT_API from init_tbb_num_threads I get\n[116/136] Linking CXX executable src\\ATen\\test\\tbb_init_test.exe\nFAILED: src/ATen/test/tbb_init_test.exe\ncmd.exe /C \"cd . && \"C:\\Program Files\\CMake\\bin\\cmake.exe\" -E vs_link_exe --intdir=src\\ATen\\test\\CMakeFiles\\tbb_init_test.dir --manifests  -- C:\\PROGRA~2\\MIB055~1\\2017\\COMMUN~1\\VC\\Tools\\MSVC\\1411~1.25\n5\\bin\\Hostx86\\x64\\link.exe /nologo src\\ATen\\test\\CMakeFiles\\tbb_init_test.dir\\tbb_init_test.cpp.obj  /out:src\\ATen\\test\\tbb_init_test.exe /implib:src\\ATen\\test\\tbb_init_test.lib /pdb:src\\ATen\\test\\tbb\n_init_test.pdb /version:0.0  /machine:x64 /LIBPATH:C:/Users/Administrator/cpuhrsch/pytorch/torch/lib/tmp_install/lib /INCREMENTAL:NO /subsystem:console  src\\ATen\\ATen.lib src\\ATen\\cpu\\tbb\\tbb_static.l\nib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_thread.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib\nC:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_thread.lib C\n:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib confu-deps\\cpuinfo\\cpuinfo.lib kernel32.lib user32.lib gdi32.lib winspool.lib\n shell32.lib ole32.lib oleaut32.lib uuid.lib comdlg32.lib advapi32.lib && cd .\"\nLINK: command \"C:\\PROGRA~2\\MIB055~1\\2017\\COMMUN~1\\VC\\Tools\\MSVC\\1411~1.255\\bin\\Hostx86\\x64\\link.exe /nologo src\\ATen\\test\\CMakeFiles\\tbb_init_test.dir\\tbb_init_test.cpp.obj /out:src\\ATen\\test\\tbb_init\n_test.exe /implib:src\\ATen\\test\\tbb_init_test.lib /pdb:src\\ATen\\test\\tbb_init_test.pdb /version:0.0 /machine:x64 /LIBPATH:C:/Users/Administrator/cpuhrsch/pytorch/torch/lib/tmp_install/lib /INCREMENTAL\n:NO /subsystem:console src\\ATen\\ATen.lib src\\ATen\\cpu\\tbb\\tbb_static.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_th\nread.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib\nC:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_thread.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib confu-d\neps\\cpuinfo\\cpuinfo.lib kernel32.lib user32.lib gdi32.lib winspool.lib shell32.lib ole32.lib oleaut32.lib uuid.lib comdlg32.lib advapi32.lib /MANIFEST /MANIFESTFILE:src\\ATen\\test\\tbb_init_test.exe.man\nifest\" failed (exit code 1120) with the following output:\ntbb_init_test.cpp.obj : error LNK2019: unresolved external symbol \"void __cdecl at::set_num_threads(int)\" (?set_num_threads@at@@YAXH@Z) referenced in function main\ntbb_init_test.cpp.obj : error LNK2019: unresolved external symbol \"int __cdecl at::get_num_threads(void)\" (?get_num_threads@at@@YAHXZ) referenced in function \"void __cdecl test(int)\" (?test@@YAXH@Z)\nsrc\\ATen\\test\\tbb_init_test.exe : fatal error LNK1120: 2 unresolved externals\n[118/136] Linking CXX executable src\\ATen\\test\\test_parallel.exe\nFAILED: src/ATen/test/test_parallel.exe\ncmd.exe /C \"cd . && \"C:\\Program Files\\CMake\\bin\\cmake.exe\" -E vs_link_exe --intdir=src\\ATen\\test\\CMakeFiles\\test_parallel.dir --manifests  -- C:\\PROGRA~2\\MIB055~1\\2017\\COMMUN~1\\VC\\Tools\\MSVC\\1411~1.25\n5\\bin\\Hostx86\\x64\\link.exe /nologo src\\ATen\\test\\CMakeFiles\\test_parallel.dir\\test_parallel.cpp.obj  /out:src\\ATen\\test\\test_parallel.exe /implib:src\\ATen\\test\\test_parallel.lib /pdb:src\\ATen\\test\\tes\nt_parallel.pdb /version:0.0  /machine:x64 /LIBPATH:C:/Users/Administrator/cpuhrsch/pytorch/torch/lib/tmp_install/lib /INCREMENTAL:NO /subsystem:console  src\\ATen\\ATen.lib src\\ATen\\cpu\\tbb\\tbb_static.l\nib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_thread.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib\nC:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_thread.lib C\n:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib confu-deps\\cpuinfo\\cpuinfo.lib kernel32.lib user32.lib gdi32.lib winspool.lib\n shell32.lib ole32.lib oleaut32.lib uuid.lib comdlg32.lib advapi32.lib && cd .\"\nLINK: command \"C:\\PROGRA~2\\MIB055~1\\2017\\COMMUN~1\\VC\\Tools\\MSVC\\1411~1.255\\bin\\Hostx86\\x64\\link.exe /nologo src\\ATen\\test\\CMakeFiles\\test_parallel.dir\\test_parallel.cpp.obj /out:src\\ATen\\test\\test_par\nallel.exe /implib:src\\ATen\\test\\test_parallel.lib /pdb:src\\ATen\\test\\test_parallel.pdb /version:0.0 /machine:x64 /LIBPATH:C:/Users/Administrator/cpuhrsch/pytorch/torch/lib/tmp_install/lib /INCREMENTAL\n:NO /subsystem:console src\\ATen\\ATen.lib src\\ATen\\cpu\\tbb\\tbb_static.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_th\nread.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib\nC:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_thread.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib confu-d\neps\\cpuinfo\\cpuinfo.lib kernel32.lib user32.lib gdi32.lib winspool.lib shell32.lib ole32.lib oleaut32.lib uuid.lib comdlg32.lib advapi32.lib /MANIFEST /MANIFESTFILE:src\\ATen\\test\\test_parallel.exe.man\nifest\" failed (exit code 1120) with the following output:\ntest_parallel.cpp.obj : error LNK2019: unresolved external symbol \"void __cdecl at::set_num_threads(int)\" (?set_num_threads@at@@YAXH@Z) referenced in function \"void __cdecl ____C_A_T_C_H____T_E_S_T___\n_0(void)\" (?____C_A_T_C_H____T_E_S_T____0@@YAXXZ)\nsrc\\ATen\\test\\test_parallel.exe : fatal error LNK1120: 1 unresolved externals\n[129/136] Building CXX object src\\ATen\\test\\CMakeFiles\\basic.dir\\basic.cpp.obj\nninja: build stopped: subcommand failed.\n\nwhich is why we added it there to begin with.\nHowever, it looks like it has maybe resolved the errors for the CPUApplyUtils.\nMaybe it's not possible to call a function with AT_API from a header function, because it's not coming from a .cpp file?\nEDIT: No it doesn't. I removed the calls from within tbb_init_test and now am getting the failures again within apply_utils_test", "body": "@peterjc123 \r\n\r\nNow if I also remove AT_API from ```init_tbb_num_threads``` I get\r\n\r\n```\r\n[116/136] Linking CXX executable src\\ATen\\test\\tbb_init_test.exe\r\nFAILED: src/ATen/test/tbb_init_test.exe\r\ncmd.exe /C \"cd . && \"C:\\Program Files\\CMake\\bin\\cmake.exe\" -E vs_link_exe --intdir=src\\ATen\\test\\CMakeFiles\\tbb_init_test.dir --manifests  -- C:\\PROGRA~2\\MIB055~1\\2017\\COMMUN~1\\VC\\Tools\\MSVC\\1411~1.25\r\n5\\bin\\Hostx86\\x64\\link.exe /nologo src\\ATen\\test\\CMakeFiles\\tbb_init_test.dir\\tbb_init_test.cpp.obj  /out:src\\ATen\\test\\tbb_init_test.exe /implib:src\\ATen\\test\\tbb_init_test.lib /pdb:src\\ATen\\test\\tbb\r\n_init_test.pdb /version:0.0  /machine:x64 /LIBPATH:C:/Users/Administrator/cpuhrsch/pytorch/torch/lib/tmp_install/lib /INCREMENTAL:NO /subsystem:console  src\\ATen\\ATen.lib src\\ATen\\cpu\\tbb\\tbb_static.l\r\nib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_thread.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib\r\nC:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_thread.lib C\r\n:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib confu-deps\\cpuinfo\\cpuinfo.lib kernel32.lib user32.lib gdi32.lib winspool.lib\r\n shell32.lib ole32.lib oleaut32.lib uuid.lib comdlg32.lib advapi32.lib && cd .\"\r\nLINK: command \"C:\\PROGRA~2\\MIB055~1\\2017\\COMMUN~1\\VC\\Tools\\MSVC\\1411~1.255\\bin\\Hostx86\\x64\\link.exe /nologo src\\ATen\\test\\CMakeFiles\\tbb_init_test.dir\\tbb_init_test.cpp.obj /out:src\\ATen\\test\\tbb_init\r\n_test.exe /implib:src\\ATen\\test\\tbb_init_test.lib /pdb:src\\ATen\\test\\tbb_init_test.pdb /version:0.0 /machine:x64 /LIBPATH:C:/Users/Administrator/cpuhrsch/pytorch/torch/lib/tmp_install/lib /INCREMENTAL\r\n:NO /subsystem:console src\\ATen\\ATen.lib src\\ATen\\cpu\\tbb\\tbb_static.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_th\r\nread.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib\r\nC:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_thread.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib confu-d\r\neps\\cpuinfo\\cpuinfo.lib kernel32.lib user32.lib gdi32.lib winspool.lib shell32.lib ole32.lib oleaut32.lib uuid.lib comdlg32.lib advapi32.lib /MANIFEST /MANIFESTFILE:src\\ATen\\test\\tbb_init_test.exe.man\r\nifest\" failed (exit code 1120) with the following output:\r\ntbb_init_test.cpp.obj : error LNK2019: unresolved external symbol \"void __cdecl at::set_num_threads(int)\" (?set_num_threads@at@@YAXH@Z) referenced in function main\r\ntbb_init_test.cpp.obj : error LNK2019: unresolved external symbol \"int __cdecl at::get_num_threads(void)\" (?get_num_threads@at@@YAHXZ) referenced in function \"void __cdecl test(int)\" (?test@@YAXH@Z)\r\nsrc\\ATen\\test\\tbb_init_test.exe : fatal error LNK1120: 2 unresolved externals\r\n[118/136] Linking CXX executable src\\ATen\\test\\test_parallel.exe\r\nFAILED: src/ATen/test/test_parallel.exe\r\ncmd.exe /C \"cd . && \"C:\\Program Files\\CMake\\bin\\cmake.exe\" -E vs_link_exe --intdir=src\\ATen\\test\\CMakeFiles\\test_parallel.dir --manifests  -- C:\\PROGRA~2\\MIB055~1\\2017\\COMMUN~1\\VC\\Tools\\MSVC\\1411~1.25\r\n5\\bin\\Hostx86\\x64\\link.exe /nologo src\\ATen\\test\\CMakeFiles\\test_parallel.dir\\test_parallel.cpp.obj  /out:src\\ATen\\test\\test_parallel.exe /implib:src\\ATen\\test\\test_parallel.lib /pdb:src\\ATen\\test\\tes\r\nt_parallel.pdb /version:0.0  /machine:x64 /LIBPATH:C:/Users/Administrator/cpuhrsch/pytorch/torch/lib/tmp_install/lib /INCREMENTAL:NO /subsystem:console  src\\ATen\\ATen.lib src\\ATen\\cpu\\tbb\\tbb_static.l\r\nib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_thread.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib\r\nC:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_thread.lib C\r\n:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib confu-deps\\cpuinfo\\cpuinfo.lib kernel32.lib user32.lib gdi32.lib winspool.lib\r\n shell32.lib ole32.lib oleaut32.lib uuid.lib comdlg32.lib advapi32.lib && cd .\"\r\nLINK: command \"C:\\PROGRA~2\\MIB055~1\\2017\\COMMUN~1\\VC\\Tools\\MSVC\\1411~1.255\\bin\\Hostx86\\x64\\link.exe /nologo src\\ATen\\test\\CMakeFiles\\test_parallel.dir\\test_parallel.cpp.obj /out:src\\ATen\\test\\test_par\r\nallel.exe /implib:src\\ATen\\test\\test_parallel.lib /pdb:src\\ATen\\test\\test_parallel.pdb /version:0.0 /machine:x64 /LIBPATH:C:/Users/Administrator/cpuhrsch/pytorch/torch/lib/tmp_install/lib /INCREMENTAL\r\n:NO /subsystem:console src\\ATen\\ATen.lib src\\ATen\\cpu\\tbb\\tbb_static.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_th\r\nread.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_lp64.lib\r\nC:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_intel_thread.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\mkl_core.lib C:\\Users\\Administrator\\cpuhrsch\\pytorch\\mkl\\lib\\libiomp5md.lib confu-d\r\neps\\cpuinfo\\cpuinfo.lib kernel32.lib user32.lib gdi32.lib winspool.lib shell32.lib ole32.lib oleaut32.lib uuid.lib comdlg32.lib advapi32.lib /MANIFEST /MANIFESTFILE:src\\ATen\\test\\test_parallel.exe.man\r\nifest\" failed (exit code 1120) with the following output:\r\ntest_parallel.cpp.obj : error LNK2019: unresolved external symbol \"void __cdecl at::set_num_threads(int)\" (?set_num_threads@at@@YAXH@Z) referenced in function \"void __cdecl ____C_A_T_C_H____T_E_S_T___\r\n_0(void)\" (?____C_A_T_C_H____T_E_S_T____0@@YAXXZ)\r\nsrc\\ATen\\test\\test_parallel.exe : fatal error LNK1120: 1 unresolved externals\r\n[129/136] Building CXX object src\\ATen\\test\\CMakeFiles\\basic.dir\\basic.cpp.obj\r\nninja: build stopped: subcommand failed.\r\n```\r\n\r\nwhich is why we added it there to begin with.\r\n\r\nHowever, it looks like it has maybe resolved the errors for the CPUApplyUtils.\r\n\r\nMaybe it's not possible to call a function with AT_API from a header function, because it's not coming from a .cpp file?\r\n\r\nEDIT: No it doesn't. I removed the calls from within tbb_init_test and now am getting the failures again within apply_utils_test"}