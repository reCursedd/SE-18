{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/323114807", "html_url": "https://github.com/pytorch/pytorch/issues/2230#issuecomment-323114807", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/2230", "id": 323114807, "node_id": "MDEyOklzc3VlQ29tbWVudDMyMzExNDgwNw==", "user": {"login": "colesbury", "id": 655866, "node_id": "MDQ6VXNlcjY1NTg2Ng==", "avatar_url": "https://avatars1.githubusercontent.com/u/655866?v=4", "gravatar_id": "", "url": "https://api.github.com/users/colesbury", "html_url": "https://github.com/colesbury", "followers_url": "https://api.github.com/users/colesbury/followers", "following_url": "https://api.github.com/users/colesbury/following{/other_user}", "gists_url": "https://api.github.com/users/colesbury/gists{/gist_id}", "starred_url": "https://api.github.com/users/colesbury/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/colesbury/subscriptions", "organizations_url": "https://api.github.com/users/colesbury/orgs", "repos_url": "https://api.github.com/users/colesbury/repos", "events_url": "https://api.github.com/users/colesbury/events{/privacy}", "received_events_url": "https://api.github.com/users/colesbury/received_events", "type": "User", "site_admin": false}, "created_at": "2017-08-17T15:51:59Z", "updated_at": "2017-08-17T15:51:59Z", "author_association": "MEMBER", "body_html": "<p>It's too bad that Tensorflow changes the current device, but this is the expected PyTorch behavior. The model must be on <code>device_ids[0]</code>. <code>device_ids</code> defaults to <code>0, 1, 2, ...</code>. If you're model is on device 7, you must manually specify <code>device_ids</code>.</p>\n<p>Or, just set the current device after the TensorFlow call:</p>\n<div class=\"highlight highlight-source-python\"><pre>config <span class=\"pl-k\">=</span> tf.ConfigProto()\nconfig.gpu_options.allow_growth <span class=\"pl-k\">=</span> <span class=\"pl-c1\">True</span>\n<span class=\"pl-k\">with</span> tf.Session(<span class=\"pl-v\">config</span><span class=\"pl-k\">=</span>config) <span class=\"pl-k\">as</span> sess:\n    sess.run(emb.initializer)\n\ntorch.cuda.set_device(<span class=\"pl-c1\">0</span>)  <span class=\"pl-c\"><span class=\"pl-c\">#</span> set the device back to 0</span>\n\nmodel <span class=\"pl-k\">=</span> torch.nn.Linear(<span class=\"pl-c1\">128</span>, <span class=\"pl-c1\">1</span>).cuda()\nmodel <span class=\"pl-k\">=</span> torch.nn.DataParallel(model).cuda()\n\ndata <span class=\"pl-k\">=</span> Variable(torch.Tensor(<span class=\"pl-c1\">8</span>,<span class=\"pl-c1\">128</span>)).cuda()\nx <span class=\"pl-k\">=</span> model(data)</pre></div>", "body_text": "It's too bad that Tensorflow changes the current device, but this is the expected PyTorch behavior. The model must be on device_ids[0]. device_ids defaults to 0, 1, 2, .... If you're model is on device 7, you must manually specify device_ids.\nOr, just set the current device after the TensorFlow call:\nconfig = tf.ConfigProto()\nconfig.gpu_options.allow_growth = True\nwith tf.Session(config=config) as sess:\n    sess.run(emb.initializer)\n\ntorch.cuda.set_device(0)  # set the device back to 0\n\nmodel = torch.nn.Linear(128, 1).cuda()\nmodel = torch.nn.DataParallel(model).cuda()\n\ndata = Variable(torch.Tensor(8,128)).cuda()\nx = model(data)", "body": "It's too bad that Tensorflow changes the current device, but this is the expected PyTorch behavior. The model must be on `device_ids[0]`. `device_ids` defaults to `0, 1, 2, ...`. If you're model is on device 7, you must manually specify `device_ids`.\r\n\r\nOr, just set the current device after the TensorFlow call:\r\n\r\n```python\r\nconfig = tf.ConfigProto()\r\nconfig.gpu_options.allow_growth = True\r\nwith tf.Session(config=config) as sess:\r\n    sess.run(emb.initializer)\r\n\r\ntorch.cuda.set_device(0)  # set the device back to 0\r\n\r\nmodel = torch.nn.Linear(128, 1).cuda()\r\nmodel = torch.nn.DataParallel(model).cuda()\r\n\r\ndata = Variable(torch.Tensor(8,128)).cuda()\r\nx = model(data)\r\n```"}