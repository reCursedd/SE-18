{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/399137101", "html_url": "https://github.com/pytorch/pytorch/pull/8687#issuecomment-399137101", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/8687", "id": 399137101, "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTEzNzEwMQ==", "user": {"login": "zou3519", "id": 5652049, "node_id": "MDQ6VXNlcjU2NTIwNDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/5652049?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zou3519", "html_url": "https://github.com/zou3519", "followers_url": "https://api.github.com/users/zou3519/followers", "following_url": "https://api.github.com/users/zou3519/following{/other_user}", "gists_url": "https://api.github.com/users/zou3519/gists{/gist_id}", "starred_url": "https://api.github.com/users/zou3519/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zou3519/subscriptions", "organizations_url": "https://api.github.com/users/zou3519/orgs", "repos_url": "https://api.github.com/users/zou3519/repos", "events_url": "https://api.github.com/users/zou3519/events{/privacy}", "received_events_url": "https://api.github.com/users/zou3519/received_events", "type": "User", "site_admin": false}, "created_at": "2018-06-21T15:06:50Z", "updated_at": "2018-06-21T15:13:09Z", "author_association": "CONTRIBUTOR", "body_html": "<p>I've addressed the two points that <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=370202\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/zdevito\">@zdevito</a> brought up:</p>\n<ol>\n<li>The code doesn't break ONNX export anymore: the EraseNumberTypes pass erases aten::type_as nodes that are added for math operations. I changed it so that EraseNumberTypes is only called in the ONNX export path; shape analysis and interpreter.cpp can handle the casting operations now.</li>\n<li>Moved the math handling code back to emitSimpleExpr</li>\n</ol>\n<p>In addition, I took a look at the tests we skipped. <a href=\"https://gist.github.com/zou3519/fdcaaa86eaad69f8b8a2e6a8d4ab9539\">Here is a list of the ones that are fixed by this PR</a> (I've renabled those tests.)</p>", "body_text": "I've addressed the two points that @zdevito brought up:\n\nThe code doesn't break ONNX export anymore: the EraseNumberTypes pass erases aten::type_as nodes that are added for math operations. I changed it so that EraseNumberTypes is only called in the ONNX export path; shape analysis and interpreter.cpp can handle the casting operations now.\nMoved the math handling code back to emitSimpleExpr\n\nIn addition, I took a look at the tests we skipped. Here is a list of the ones that are fixed by this PR (I've renabled those tests.)", "body": "I've addressed the two points that @zdevito brought up:\r\n\r\n1) The code doesn't break ONNX export anymore: the EraseNumberTypes pass erases aten::type_as nodes that are added for math operations. I changed it so that EraseNumberTypes is only called in the ONNX export path; shape analysis and interpreter.cpp can handle the casting operations now.\r\n2) Moved the math handling code back to emitSimpleExpr\r\n\r\nIn addition, I took a look at the tests we skipped. [Here is a list of the ones that are fixed by this PR]( https://gist.github.com/zou3519/fdcaaa86eaad69f8b8a2e6a8d4ab9539) (I've renabled those tests.)"}