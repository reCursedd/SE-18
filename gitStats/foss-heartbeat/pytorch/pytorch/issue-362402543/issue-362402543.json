{"url": "https://api.github.com/repos/pytorch/pytorch/issues/11913", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/11913/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/11913/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/11913/events", "html_url": "https://github.com/pytorch/pytorch/issues/11913", "id": 362402543, "node_id": "MDU6SXNzdWUzNjI0MDI1NDM=", "number": 11913, "title": "Saving loaded model leads to Bad address error", "user": {"login": "lantiga", "id": 191033, "node_id": "MDQ6VXNlcjE5MTAzMw==", "avatar_url": "https://avatars2.githubusercontent.com/u/191033?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lantiga", "html_url": "https://github.com/lantiga", "followers_url": "https://api.github.com/users/lantiga/followers", "following_url": "https://api.github.com/users/lantiga/following{/other_user}", "gists_url": "https://api.github.com/users/lantiga/gists{/gist_id}", "starred_url": "https://api.github.com/users/lantiga/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lantiga/subscriptions", "organizations_url": "https://api.github.com/users/lantiga/orgs", "repos_url": "https://api.github.com/users/lantiga/repos", "events_url": "https://api.github.com/users/lantiga/events{/privacy}", "received_events_url": "https://api.github.com/users/lantiga/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-09-20T23:21:51Z", "updated_at": "2018-09-21T13:59:38Z", "closed_at": "2018-09-21T13:59:38Z", "author_association": "COLLABORATOR", "body_html": "<h2>Issue description</h2>\n<p>When using the new script module serialization, saving a module that has been loaded from the serialized file produces <code>RuntimeError: Unable to write to file! : Bad address</code>.</p>\n<h2>Code example</h2>\n<pre><code>import torch\nfrom torchvision import models\n\nm1 = torch.jit.trace(models.resnet18(), torch.zeros(1, 3, 224, 224))\nm1.save('foo1.onnx')\n\nm2 = torch.jit.load('foo1.onnx')\nm2.save('foo2.onnx')\n</code></pre>\n<p>produces</p>\n<pre><code>Traceback (most recent call last):\n  File \"save_load_twice.py\", line 12, in &lt;module&gt;\n    m2.save('foo2.onnx')\nRuntimeError: Unable to write to file! : Bad address\n</code></pre>\n<p>The reason is a bug at <a href=\"https://github.com/pytorch/pytorch/blob/master/torch/csrc/jit/import.cpp#L322\">https://github.com/pytorch/pytorch/blob/master/torch/csrc/jit/import.cpp#L322</a> : <code>size</code> is expressed in bytes, while it is expected to passed to the constructor as the number of elements in the storage. This leads to <code>size</code> being \"number of bytes in type\"-times as large than it should be, which leads to the <code>Bad address</code> error.</p>\n<p>A PR with the fix is underway.</p>\n<h2>System Info</h2>\n<ul>\n<li>PyTorch or Caffe2: PyTorch</li>\n<li>How you installed PyTorch (conda, pip, source): source</li>\n<li>Build command you used (if compiling from source): <code>MACOSX_DEPLOYMENT_TARGET=10.9 CC=clang CXX=clang++ NO_CAFFE2_OPS=1 python setup.py install</code></li>\n<li>OS: MacOS</li>\n<li>PyTorch version: 1.0.0a</li>\n<li>Python version: 3.6.4</li>\n<li>CUDA/cuDNN version: NA</li>\n<li>GPU models and configuration: NA</li>\n<li>GCC version (if compiling from source): Apple LLVM version 9.1.0 (clang-902.0.39.2)</li>\n<li>CMake version: cmake version 3.9.4</li>\n<li>Versions of any other relevant libraries:</li>\n</ul>", "body_text": "Issue description\nWhen using the new script module serialization, saving a module that has been loaded from the serialized file produces RuntimeError: Unable to write to file! : Bad address.\nCode example\nimport torch\nfrom torchvision import models\n\nm1 = torch.jit.trace(models.resnet18(), torch.zeros(1, 3, 224, 224))\nm1.save('foo1.onnx')\n\nm2 = torch.jit.load('foo1.onnx')\nm2.save('foo2.onnx')\n\nproduces\nTraceback (most recent call last):\n  File \"save_load_twice.py\", line 12, in <module>\n    m2.save('foo2.onnx')\nRuntimeError: Unable to write to file! : Bad address\n\nThe reason is a bug at https://github.com/pytorch/pytorch/blob/master/torch/csrc/jit/import.cpp#L322 : size is expressed in bytes, while it is expected to passed to the constructor as the number of elements in the storage. This leads to size being \"number of bytes in type\"-times as large than it should be, which leads to the Bad address error.\nA PR with the fix is underway.\nSystem Info\n\nPyTorch or Caffe2: PyTorch\nHow you installed PyTorch (conda, pip, source): source\nBuild command you used (if compiling from source): MACOSX_DEPLOYMENT_TARGET=10.9 CC=clang CXX=clang++ NO_CAFFE2_OPS=1 python setup.py install\nOS: MacOS\nPyTorch version: 1.0.0a\nPython version: 3.6.4\nCUDA/cuDNN version: NA\nGPU models and configuration: NA\nGCC version (if compiling from source): Apple LLVM version 9.1.0 (clang-902.0.39.2)\nCMake version: cmake version 3.9.4\nVersions of any other relevant libraries:", "body": "## Issue description\r\n\r\nWhen using the new script module serialization, saving a module that has been loaded from the serialized file produces `RuntimeError: Unable to write to file! : Bad address`.\r\n\r\n## Code example\r\n\r\n```\r\nimport torch\r\nfrom torchvision import models\r\n\r\nm1 = torch.jit.trace(models.resnet18(), torch.zeros(1, 3, 224, 224))\r\nm1.save('foo1.onnx')\r\n\r\nm2 = torch.jit.load('foo1.onnx')\r\nm2.save('foo2.onnx')\r\n```\r\n\r\nproduces\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"save_load_twice.py\", line 12, in <module>\r\n    m2.save('foo2.onnx')\r\nRuntimeError: Unable to write to file! : Bad address\r\n```\r\n\r\nThe reason is a bug at https://github.com/pytorch/pytorch/blob/master/torch/csrc/jit/import.cpp#L322 : `size` is expressed in bytes, while it is expected to passed to the constructor as the number of elements in the storage. This leads to `size` being \"number of bytes in type\"-times as large than it should be, which leads to the `Bad address` error.\r\n\r\nA PR with the fix is underway.\r\n\r\n## System Info\r\n\r\n- PyTorch or Caffe2: PyTorch\r\n- How you installed PyTorch (conda, pip, source): source\r\n- Build command you used (if compiling from source): `MACOSX_DEPLOYMENT_TARGET=10.9 CC=clang CXX=clang++ NO_CAFFE2_OPS=1 python setup.py install`\r\n- OS: MacOS\r\n- PyTorch version: 1.0.0a\r\n- Python version: 3.6.4\r\n- CUDA/cuDNN version: NA\r\n- GPU models and configuration: NA\r\n- GCC version (if compiling from source): Apple LLVM version 9.1.0 (clang-902.0.39.2)\r\n- CMake version: cmake version 3.9.4\r\n- Versions of any other relevant libraries:\r\n"}