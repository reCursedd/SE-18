{"url": "https://api.github.com/repos/pytorch/pytorch/issues/11148", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/11148/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/11148/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/11148/events", "html_url": "https://github.com/pytorch/pytorch/issues/11148", "id": 356076057, "node_id": "MDU6SXNzdWUzNTYwNzYwNTc=", "number": 11148, "title": "PyTorch 0.4.1, CUDA 9.2 crashes with fp16 (works on 9.0 and with fp32)", "user": {"login": "ddkang", "id": 1894961, "node_id": "MDQ6VXNlcjE4OTQ5NjE=", "avatar_url": "https://avatars0.githubusercontent.com/u/1894961?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ddkang", "html_url": "https://github.com/ddkang", "followers_url": "https://api.github.com/users/ddkang/followers", "following_url": "https://api.github.com/users/ddkang/following{/other_user}", "gists_url": "https://api.github.com/users/ddkang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ddkang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ddkang/subscriptions", "organizations_url": "https://api.github.com/users/ddkang/orgs", "repos_url": "https://api.github.com/users/ddkang/repos", "events_url": "https://api.github.com/users/ddkang/events{/privacy}", "received_events_url": "https://api.github.com/users/ddkang/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-08-31T18:06:56Z", "updated_at": "2018-09-02T00:28:38Z", "closed_at": "2018-09-02T00:28:38Z", "author_association": "NONE", "body_html": "<h2>Issue description</h2>\n<p>ResNet-50 (resolution of 128, batch size 8) crashes on PyTorch 0.4.1, CUDA 9.2 with fp16. It works with CUDA 9.0 and fp32.</p>\n<h2>Code example</h2>\n<p><a href=\"https://github.com/ddkang/fai-imagenet/tree/imagenet/imagenet_nv\">https://github.com/ddkang/fai-imagenet/tree/imagenet/imagenet_nv</a></p>\n<pre lang=\"(gdb)\" data-meta=\"r main.py -a resnet50 --lr 0.40 --epochs 45 --small -j 8 --fp16 -b 8 --loss-scale 512 /mnt/disks/dawnbench/imagenet\"><code>Starting program: /home/daniel_d_kang/anaconda3/envs/dawnbench/bin/python main.py -a resnet50 --lr 0.40 --epochs 45 --small -j 8 --fp16 -b 8 --loss-scale 512 /mnt/disks/dawnbench/imagenet\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\n~~epoch hours   top1Accuracy\n\n[New Thread 0x7fffaf723700 (LWP 12826)]\n[New Thread 0x7fffaef22700 (LWP 12827)]\n0\n[New Thread 0x7fff44a3f700 (LWP 13143)]\n[New Thread 0x7fff426fe700 (LWP 13155)]\n[New Thread 0x7fff4173f700 (LWP 13156)]\n[New Thread 0x7fff40f3e700 (LWP 13157)]\n[New Thread 0x7fff4073d700 (LWP 13158)]\n[New Thread 0x7fff3ff3c700 (LWP 13159)]\n[New Thread 0x7fff3f73b700 (LWP 13162)]\n[New Thread 0x7fff3e77f700 (LWP 13164)]\n[New Thread 0x7fff3df7e700 (LWP 13165)]\nzero_grad\ntensor(3648., device='cuda:0', dtype=torch.float16, grad_fn=&lt;MulBackward&gt;)\ntorch.Size([])\ntorch.cuda.HalfTensor\n[New Thread 0x7fff3d77d700 (LWP 13216)]\n[New Thread 0x7fff3cf7c700 (LWP 13217)]\n\nThread 14 \"python\" received signal SIGFPE, Arithmetic exception.\n[Switching to Thread 0x7fff3cf7c700 (LWP 13217)]\n0x00007fffc3151984 in cudnn::gemm::conv2d(cudnnContext*, void const*, cudnnTensor4dStruct*, void const*, cudnnFilter4dStruct*, void const*, cudnnConvolutionStruct*, cudnnConvWorkingStruct const*, void*, unsigned long, void const*, cudnnTensor4dStruct*, void*, cudnn::gemm::Conv2dType_t, cudnn::gemm::Conv2dConfig&amp;, bool, void const*, cudnnActivationStruct*, void*) () from /home/daniel_d_kang/anaconda3/envs/dawnbench/lib/python3.6/site-packages/torch/lib/libcaffe2_gpu.so\n</code></pre>\n<h2>System Info</h2>\n<pre><code>Collecting environment information...\nPyTorch version: 0.4.1\nIs debug build: No\nCUDA used to build PyTorch: 9.2.148\n\nOS: Ubuntu 16.04.5 LTS\nGCC version: (Ubuntu 5.4.0-6ubuntu1~16.04.10) 5.4.0 20160609\nCMake version: Could not collect\n\nPython version: 3.6\nIs CUDA available: Yes\nCUDA runtime version: Could not collect\nGPU models and configuration: GPU 0: Tesla V100-SXM2-16GB\nNvidia driver version: 396.44\ncuDNN version: Probably one of the following:\n/usr/lib/x86_64-linux-gnu/libcudnn.so.7.2.1\n/usr/lib/x86_64-linux-gnu/libcudnn_static_v7.a\n\nVersions of relevant libraries:\n[pip] numpy (1.14.3)\n[pip] numpydoc (0.8.0)\n[pip] torch (0.4.1)\n[pip] torchvision (0.2.1)\n[conda] cuda92                    1.0                           0    pytorch\n[conda] pytorch                   0.4.1           py36_cuda9.2.148_cudnn7.1.4_1  [cuda92]  pytorch\n[conda] torchvision               0.2.1                    py36_1    pytorch\n</code></pre>", "body_text": "Issue description\nResNet-50 (resolution of 128, batch size 8) crashes on PyTorch 0.4.1, CUDA 9.2 with fp16. It works with CUDA 9.0 and fp32.\nCode example\nhttps://github.com/ddkang/fai-imagenet/tree/imagenet/imagenet_nv\nStarting program: /home/daniel_d_kang/anaconda3/envs/dawnbench/bin/python main.py -a resnet50 --lr 0.40 --epochs 45 --small -j 8 --fp16 -b 8 --loss-scale 512 /mnt/disks/dawnbench/imagenet\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\n~~epoch hours   top1Accuracy\n\n[New Thread 0x7fffaf723700 (LWP 12826)]\n[New Thread 0x7fffaef22700 (LWP 12827)]\n0\n[New Thread 0x7fff44a3f700 (LWP 13143)]\n[New Thread 0x7fff426fe700 (LWP 13155)]\n[New Thread 0x7fff4173f700 (LWP 13156)]\n[New Thread 0x7fff40f3e700 (LWP 13157)]\n[New Thread 0x7fff4073d700 (LWP 13158)]\n[New Thread 0x7fff3ff3c700 (LWP 13159)]\n[New Thread 0x7fff3f73b700 (LWP 13162)]\n[New Thread 0x7fff3e77f700 (LWP 13164)]\n[New Thread 0x7fff3df7e700 (LWP 13165)]\nzero_grad\ntensor(3648., device='cuda:0', dtype=torch.float16, grad_fn=<MulBackward>)\ntorch.Size([])\ntorch.cuda.HalfTensor\n[New Thread 0x7fff3d77d700 (LWP 13216)]\n[New Thread 0x7fff3cf7c700 (LWP 13217)]\n\nThread 14 \"python\" received signal SIGFPE, Arithmetic exception.\n[Switching to Thread 0x7fff3cf7c700 (LWP 13217)]\n0x00007fffc3151984 in cudnn::gemm::conv2d(cudnnContext*, void const*, cudnnTensor4dStruct*, void const*, cudnnFilter4dStruct*, void const*, cudnnConvolutionStruct*, cudnnConvWorkingStruct const*, void*, unsigned long, void const*, cudnnTensor4dStruct*, void*, cudnn::gemm::Conv2dType_t, cudnn::gemm::Conv2dConfig&, bool, void const*, cudnnActivationStruct*, void*) () from /home/daniel_d_kang/anaconda3/envs/dawnbench/lib/python3.6/site-packages/torch/lib/libcaffe2_gpu.so\n\nSystem Info\nCollecting environment information...\nPyTorch version: 0.4.1\nIs debug build: No\nCUDA used to build PyTorch: 9.2.148\n\nOS: Ubuntu 16.04.5 LTS\nGCC version: (Ubuntu 5.4.0-6ubuntu1~16.04.10) 5.4.0 20160609\nCMake version: Could not collect\n\nPython version: 3.6\nIs CUDA available: Yes\nCUDA runtime version: Could not collect\nGPU models and configuration: GPU 0: Tesla V100-SXM2-16GB\nNvidia driver version: 396.44\ncuDNN version: Probably one of the following:\n/usr/lib/x86_64-linux-gnu/libcudnn.so.7.2.1\n/usr/lib/x86_64-linux-gnu/libcudnn_static_v7.a\n\nVersions of relevant libraries:\n[pip] numpy (1.14.3)\n[pip] numpydoc (0.8.0)\n[pip] torch (0.4.1)\n[pip] torchvision (0.2.1)\n[conda] cuda92                    1.0                           0    pytorch\n[conda] pytorch                   0.4.1           py36_cuda9.2.148_cudnn7.1.4_1  [cuda92]  pytorch\n[conda] torchvision               0.2.1                    py36_1    pytorch", "body": "## Issue description\r\n\r\nResNet-50 (resolution of 128, batch size 8) crashes on PyTorch 0.4.1, CUDA 9.2 with fp16. It works with CUDA 9.0 and fp32.\r\n\r\n## Code example\r\n\r\nhttps://github.com/ddkang/fai-imagenet/tree/imagenet/imagenet_nv\r\n\r\n```(gdb) r main.py -a resnet50 --lr 0.40 --epochs 45 --small -j 8 --fp16 -b 8 --loss-scale 512 /mnt/disks/dawnbench/imagenet\r\nStarting program: /home/daniel_d_kang/anaconda3/envs/dawnbench/bin/python main.py -a resnet50 --lr 0.40 --epochs 45 --small -j 8 --fp16 -b 8 --loss-scale 512 /mnt/disks/dawnbench/imagenet\r\n[Thread debugging using libthread_db enabled]\r\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\r\n~~epoch hours   top1Accuracy\r\n\r\n[New Thread 0x7fffaf723700 (LWP 12826)]\r\n[New Thread 0x7fffaef22700 (LWP 12827)]\r\n0\r\n[New Thread 0x7fff44a3f700 (LWP 13143)]\r\n[New Thread 0x7fff426fe700 (LWP 13155)]\r\n[New Thread 0x7fff4173f700 (LWP 13156)]\r\n[New Thread 0x7fff40f3e700 (LWP 13157)]\r\n[New Thread 0x7fff4073d700 (LWP 13158)]\r\n[New Thread 0x7fff3ff3c700 (LWP 13159)]\r\n[New Thread 0x7fff3f73b700 (LWP 13162)]\r\n[New Thread 0x7fff3e77f700 (LWP 13164)]\r\n[New Thread 0x7fff3df7e700 (LWP 13165)]\r\nzero_grad\r\ntensor(3648., device='cuda:0', dtype=torch.float16, grad_fn=<MulBackward>)\r\ntorch.Size([])\r\ntorch.cuda.HalfTensor\r\n[New Thread 0x7fff3d77d700 (LWP 13216)]\r\n[New Thread 0x7fff3cf7c700 (LWP 13217)]\r\n\r\nThread 14 \"python\" received signal SIGFPE, Arithmetic exception.\r\n[Switching to Thread 0x7fff3cf7c700 (LWP 13217)]\r\n0x00007fffc3151984 in cudnn::gemm::conv2d(cudnnContext*, void const*, cudnnTensor4dStruct*, void const*, cudnnFilter4dStruct*, void const*, cudnnConvolutionStruct*, cudnnConvWorkingStruct const*, void*, unsigned long, void const*, cudnnTensor4dStruct*, void*, cudnn::gemm::Conv2dType_t, cudnn::gemm::Conv2dConfig&, bool, void const*, cudnnActivationStruct*, void*) () from /home/daniel_d_kang/anaconda3/envs/dawnbench/lib/python3.6/site-packages/torch/lib/libcaffe2_gpu.so\r\n```\r\n\r\n\r\n## System Info\r\n```\r\nCollecting environment information...\r\nPyTorch version: 0.4.1\r\nIs debug build: No\r\nCUDA used to build PyTorch: 9.2.148\r\n\r\nOS: Ubuntu 16.04.5 LTS\r\nGCC version: (Ubuntu 5.4.0-6ubuntu1~16.04.10) 5.4.0 20160609\r\nCMake version: Could not collect\r\n\r\nPython version: 3.6\r\nIs CUDA available: Yes\r\nCUDA runtime version: Could not collect\r\nGPU models and configuration: GPU 0: Tesla V100-SXM2-16GB\r\nNvidia driver version: 396.44\r\ncuDNN version: Probably one of the following:\r\n/usr/lib/x86_64-linux-gnu/libcudnn.so.7.2.1\r\n/usr/lib/x86_64-linux-gnu/libcudnn_static_v7.a\r\n\r\nVersions of relevant libraries:\r\n[pip] numpy (1.14.3)\r\n[pip] numpydoc (0.8.0)\r\n[pip] torch (0.4.1)\r\n[pip] torchvision (0.2.1)\r\n[conda] cuda92                    1.0                           0    pytorch\r\n[conda] pytorch                   0.4.1           py36_cuda9.2.148_cudnn7.1.4_1  [cuda92]  pytorch\r\n[conda] torchvision               0.2.1                    py36_1    pytorch\r\n```"}