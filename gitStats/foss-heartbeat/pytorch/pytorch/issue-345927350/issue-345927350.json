{"url": "https://api.github.com/repos/pytorch/pytorch/issues/10026", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/10026/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/10026/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/10026/events", "html_url": "https://github.com/pytorch/pytorch/pull/10026", "id": 345927350, "node_id": "MDExOlB1bGxSZXF1ZXN0MjA0OTI0Mzk4", "number": 10026, "title": "Move at::chunk into the graph fuser", "user": {"login": "zou3519", "id": 5652049, "node_id": "MDQ6VXNlcjU2NTIwNDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/5652049?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zou3519", "html_url": "https://github.com/zou3519", "followers_url": "https://api.github.com/users/zou3519/followers", "following_url": "https://api.github.com/users/zou3519/following{/other_user}", "gists_url": "https://api.github.com/users/zou3519/gists{/gist_id}", "starred_url": "https://api.github.com/users/zou3519/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zou3519/subscriptions", "organizations_url": "https://api.github.com/users/zou3519/orgs", "repos_url": "https://api.github.com/users/zou3519/repos", "events_url": "https://api.github.com/users/zou3519/events{/privacy}", "received_events_url": "https://api.github.com/users/zou3519/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 679953983, "node_id": "MDU6TGFiZWw2Nzk5NTM5ODM=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/jit", "name": "jit", "color": "c5def5", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-07-30T20:44:23Z", "updated_at": "2018-08-02T20:53:05Z", "closed_at": "2018-08-02T20:53:05Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/10026", "html_url": "https://github.com/pytorch/pytorch/pull/10026", "diff_url": "https://github.com/pytorch/pytorch/pull/10026.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/10026.patch"}, "body_html": "<p>The design can be found here:</p>\n<ul>\n<li>(quip)<br>\n<a href=\"https://fb.quip.com/JLkbAyYc2AFy#IZGACAsKsBe\" rel=\"nofollow\">https://fb.quip.com/JLkbAyYc2AFy#IZGACAsKsBe</a></li>\n<li>(gist) coming soon...</li>\n</ul>\n<p>Test Plan</p>\n<ul>\n<li>Expect test and correctness test to see if a single chunk is fused<br>\nby the graph fuser</li>\n<li>Correctness test for a variety of chunks (dimension = beginning,<br>\nmiddle, end) and tensors (contiguous, non-contiguous, edge case<br>\n(splitSize = 1) for both CPU/CUDA</li>\n<li>Expect test for multiple chunks fused into the same kernel and<br>\ncorrectness test.</li>\n</ul>\n<p>cc <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=370202\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/zdevito\">@zdevito</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4583066\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/apaszke\">@apaszke</a></p>\n<p>I benchmarked a LSTM with numLayers = 1, seq_length = 100, input_size = hidden_size = 512, with all requires_grad=False. Script here: <a href=\"https://gist.github.com/zou3519/f0840f773f8835ee834b748148042e22\">https://gist.github.com/zou3519/f0840f773f8835ee834b748148042e22</a>.</p>\n<p>Perf is very bad with requires_grad=True (both before &amp; after my changes), so I am investigating that (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"345935131\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/10032\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/10032/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/10032\">#10032</a>)</p>\n<p>Before numbers (ms):</p>\n<pre><code>thnn    cudnn   jit\n9.7147  6.6332  13.6807\n</code></pre>\n<p>After numbers (ms):</p>\n<pre><code>thnn    cudnn   jit\n9.6166  6.6871  9.4633\n</code></pre>", "body_text": "The design can be found here:\n\n(quip)\nhttps://fb.quip.com/JLkbAyYc2AFy#IZGACAsKsBe\n(gist) coming soon...\n\nTest Plan\n\nExpect test and correctness test to see if a single chunk is fused\nby the graph fuser\nCorrectness test for a variety of chunks (dimension = beginning,\nmiddle, end) and tensors (contiguous, non-contiguous, edge case\n(splitSize = 1) for both CPU/CUDA\nExpect test for multiple chunks fused into the same kernel and\ncorrectness test.\n\ncc @zdevito @apaszke\nI benchmarked a LSTM with numLayers = 1, seq_length = 100, input_size = hidden_size = 512, with all requires_grad=False. Script here: https://gist.github.com/zou3519/f0840f773f8835ee834b748148042e22.\nPerf is very bad with requires_grad=True (both before & after my changes), so I am investigating that (#10032)\nBefore numbers (ms):\nthnn    cudnn   jit\n9.7147  6.6332  13.6807\n\nAfter numbers (ms):\nthnn    cudnn   jit\n9.6166  6.6871  9.4633", "body": "The design can be found here:\r\n- (quip)\r\nhttps://fb.quip.com/JLkbAyYc2AFy#IZGACAsKsBe\r\n- (gist) coming soon...\r\n\r\nTest Plan\r\n\r\n- Expect test and correctness test to see if a single chunk is fused\r\n  by the graph fuser\r\n- Correctness test for a variety of chunks (dimension = beginning,\r\n  middle, end) and tensors (contiguous, non-contiguous, edge case\r\n  (splitSize = 1) for both CPU/CUDA\r\n- Expect test for multiple chunks fused into the same kernel and\r\n  correctness test.\r\n\r\ncc @zdevito @apaszke \r\n\r\n\r\nI benchmarked a LSTM with numLayers = 1, seq_length = 100, input_size = hidden_size = 512, with all requires_grad=False. Script here: https://gist.github.com/zou3519/f0840f773f8835ee834b748148042e22.\r\n\r\nPerf is very bad with requires_grad=True (both before & after my changes), so I am investigating that (#10032)\r\n\r\nBefore numbers (ms):\r\n```\r\nthnn    cudnn   jit\r\n9.7147  6.6332  13.6807\r\n```\r\n\r\nAfter numbers (ms):\r\n```\r\nthnn    cudnn   jit\r\n9.6166  6.6871  9.4633\r\n```"}