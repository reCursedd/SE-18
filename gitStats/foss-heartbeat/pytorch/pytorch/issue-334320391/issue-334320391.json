{"url": "https://api.github.com/repos/pytorch/pytorch/issues/8729", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/8729/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/8729/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/8729/events", "html_url": "https://github.com/pytorch/pytorch/issues/8729", "id": 334320391, "node_id": "MDU6SXNzdWUzMzQzMjAzOTE=", "number": 8729, "title": "nccl build: nvcc fatal   : redefinition of keyword 'code' ", "user": {"login": "ezyang", "id": 13564, "node_id": "MDQ6VXNlcjEzNTY0", "avatar_url": "https://avatars0.githubusercontent.com/u/13564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ezyang", "html_url": "https://github.com/ezyang", "followers_url": "https://api.github.com/users/ezyang/followers", "following_url": "https://api.github.com/users/ezyang/following{/other_user}", "gists_url": "https://api.github.com/users/ezyang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ezyang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ezyang/subscriptions", "organizations_url": "https://api.github.com/users/ezyang/orgs", "repos_url": "https://api.github.com/users/ezyang/repos", "events_url": "https://api.github.com/users/ezyang/events{/privacy}", "received_events_url": "https://api.github.com/users/ezyang/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2018-06-21T03:02:36Z", "updated_at": "2018-06-25T15:07:54Z", "closed_at": "2018-06-25T15:07:54Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Steps to reproduce:</p>\n<ol>\n<li>Get a CI CUDA docker image, e.g., <code>30853 5385114.dkr.ecr.us-east-1.amazonaws.com/pytorch/pytorch-linux-xenial-cuda9-cudnn7-py3:218</code></li>\n<li>Clone PyTorch, and run <code>python setup.py build_deps develop</code></li>\n</ol>\n<p>Expected result: It works</p>\n<p>Actual result:</p>\n<pre><code>CMake Warning at /var/lib/jenkins/pytorch-1/cmake/public/utils.cmake:148 (message):\n  In the future we will require one to explicitly pass TORCH_CUDA_ARCH_LIST\n  to cmake instead of implicitly setting it as an env variable.  This will\n  become a FATAL_ERROR in future version of pytorch.\nCall Stack (most recent call first):\n  CMakeLists.txt:9 (torch_cuda_get_nvcc_gencode_flag)\n\n\nINFOSet NVCC_GENCODE for building NCCL: -gencode=arch=compute_50,code=sm_50 -gencode=arch=compute_52,code=sm_52\n-- Configuring done\n-- Generating done\n-- Build files have been written to: /var/lib/jenkins/pytorch-1/third_party/build/nccl\n+ make install\nScanning dependencies of target nccl\n[100%] Generating lib/libnccl.so\nGrabbing  src/nccl.h                          &gt; /var/lib/jenkins/pytorch-1/third_party/build/nccl/include/nccl.h\nCompiling src/libwrap.cu                      &gt; /var/lib/jenkins/pytorch-1/third_party/build/nccl/obj/libwrap.o\nCompiling src/core.cu                         &gt; /var/lib/jenkins/pytorch-1/third_party/build/nccl/obj/core.o\nnvcc fatal   : redefinition of keyword 'code' \nMakefile:136: recipe for target '/var/lib/jenkins/pytorch-1/third_party/build/nccl/obj/libwrap.o' failed\nmake[3]: *** [/var/lib/jenkins/pytorch-1/third_party/build/nccl/obj/libwrap.o] Error 1\nmake[3]: *** Waiting for unfinished jobs....\n</code></pre>\n<p>Workaround: set <code>TORCH_CUDA_ARCH_LIST=5.2</code> forces only one <code>-gencode</code> to be passed.</p>", "body_text": "Steps to reproduce:\n\nGet a CI CUDA docker image, e.g., 30853 5385114.dkr.ecr.us-east-1.amazonaws.com/pytorch/pytorch-linux-xenial-cuda9-cudnn7-py3:218\nClone PyTorch, and run python setup.py build_deps develop\n\nExpected result: It works\nActual result:\nCMake Warning at /var/lib/jenkins/pytorch-1/cmake/public/utils.cmake:148 (message):\n  In the future we will require one to explicitly pass TORCH_CUDA_ARCH_LIST\n  to cmake instead of implicitly setting it as an env variable.  This will\n  become a FATAL_ERROR in future version of pytorch.\nCall Stack (most recent call first):\n  CMakeLists.txt:9 (torch_cuda_get_nvcc_gencode_flag)\n\n\nINFOSet NVCC_GENCODE for building NCCL: -gencode=arch=compute_50,code=sm_50 -gencode=arch=compute_52,code=sm_52\n-- Configuring done\n-- Generating done\n-- Build files have been written to: /var/lib/jenkins/pytorch-1/third_party/build/nccl\n+ make install\nScanning dependencies of target nccl\n[100%] Generating lib/libnccl.so\nGrabbing  src/nccl.h                          > /var/lib/jenkins/pytorch-1/third_party/build/nccl/include/nccl.h\nCompiling src/libwrap.cu                      > /var/lib/jenkins/pytorch-1/third_party/build/nccl/obj/libwrap.o\nCompiling src/core.cu                         > /var/lib/jenkins/pytorch-1/third_party/build/nccl/obj/core.o\nnvcc fatal   : redefinition of keyword 'code' \nMakefile:136: recipe for target '/var/lib/jenkins/pytorch-1/third_party/build/nccl/obj/libwrap.o' failed\nmake[3]: *** [/var/lib/jenkins/pytorch-1/third_party/build/nccl/obj/libwrap.o] Error 1\nmake[3]: *** Waiting for unfinished jobs....\n\nWorkaround: set TORCH_CUDA_ARCH_LIST=5.2 forces only one -gencode to be passed.", "body": "Steps to reproduce:\r\n1. Get a CI CUDA docker image, e.g., `30853\r\n5385114.dkr.ecr.us-east-1.amazonaws.com/pytorch/pytorch-linux-xenial-cuda9-cudnn7-py3:218`\r\n2. Clone PyTorch, and run `python setup.py build_deps develop`\r\n\r\nExpected result: It works\r\n\r\nActual result:\r\n```\r\nCMake Warning at /var/lib/jenkins/pytorch-1/cmake/public/utils.cmake:148 (message):\r\n  In the future we will require one to explicitly pass TORCH_CUDA_ARCH_LIST\r\n  to cmake instead of implicitly setting it as an env variable.  This will\r\n  become a FATAL_ERROR in future version of pytorch.\r\nCall Stack (most recent call first):\r\n  CMakeLists.txt:9 (torch_cuda_get_nvcc_gencode_flag)\r\n\r\n\r\nINFOSet NVCC_GENCODE for building NCCL: -gencode=arch=compute_50,code=sm_50 -gencode=arch=compute_52,code=sm_52\r\n-- Configuring done\r\n-- Generating done\r\n-- Build files have been written to: /var/lib/jenkins/pytorch-1/third_party/build/nccl\r\n+ make install\r\nScanning dependencies of target nccl\r\n[100%] Generating lib/libnccl.so\r\nGrabbing  src/nccl.h                          > /var/lib/jenkins/pytorch-1/third_party/build/nccl/include/nccl.h\r\nCompiling src/libwrap.cu                      > /var/lib/jenkins/pytorch-1/third_party/build/nccl/obj/libwrap.o\r\nCompiling src/core.cu                         > /var/lib/jenkins/pytorch-1/third_party/build/nccl/obj/core.o\r\nnvcc fatal   : redefinition of keyword 'code' \r\nMakefile:136: recipe for target '/var/lib/jenkins/pytorch-1/third_party/build/nccl/obj/libwrap.o' failed\r\nmake[3]: *** [/var/lib/jenkins/pytorch-1/third_party/build/nccl/obj/libwrap.o] Error 1\r\nmake[3]: *** Waiting for unfinished jobs....\r\n```\r\n\r\nWorkaround: set `TORCH_CUDA_ARCH_LIST=5.2` forces only one `-gencode` to be passed."}