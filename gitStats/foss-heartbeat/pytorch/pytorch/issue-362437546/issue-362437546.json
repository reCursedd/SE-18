{"url": "https://api.github.com/repos/pytorch/pytorch/issues/11923", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/11923/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/11923/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/11923/events", "html_url": "https://github.com/pytorch/pytorch/pull/11923", "id": 362437546, "node_id": "MDExOlB1bGxSZXF1ZXN0MjE3MTU4MTM3", "number": 11923, "title": "Removing some dependency edges from Blob to other caffe2", "user": {"login": "smessmer", "id": 2373925, "node_id": "MDQ6VXNlcjIzNzM5MjU=", "avatar_url": "https://avatars3.githubusercontent.com/u/2373925?v=4", "gravatar_id": "", "url": "https://api.github.com/users/smessmer", "html_url": "https://github.com/smessmer", "followers_url": "https://api.github.com/users/smessmer/followers", "following_url": "https://api.github.com/users/smessmer/following{/other_user}", "gists_url": "https://api.github.com/users/smessmer/gists{/gist_id}", "starred_url": "https://api.github.com/users/smessmer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/smessmer/subscriptions", "organizations_url": "https://api.github.com/users/smessmer/orgs", "repos_url": "https://api.github.com/users/smessmer/repos", "events_url": "https://api.github.com/users/smessmer/events{/privacy}", "received_events_url": "https://api.github.com/users/smessmer/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-09-21T02:54:43Z", "updated_at": "2018-09-25T05:58:26Z", "closed_at": "2018-09-25T05:58:26Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/11923", "html_url": "https://github.com/pytorch/pytorch/pull/11923", "diff_url": "https://github.com/pytorch/pytorch/pull/11923.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/11923.patch"}, "body_html": "<p>Stack:<br>\n\u00a0\u00a0\u00a0\u00a0<g-emoji class=\"g-emoji\" alias=\"black_circle\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/26ab.png\">\u26ab\ufe0f</g-emoji>\u00a0 <strong><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"362437546\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/11923\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/11923/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/11923\">#11923</a> Removing some dependency edges from Blob to other caffe2</strong>\u00a0\u00a0<a href=\"https://our.internmc.facebook.com/intern/diff/D9979976/\" rel=\"nofollow\"><g-emoji class=\"g-emoji\" alias=\"green_heart\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f49a.png\">\ud83d\udc9a</g-emoji></a><br>\n\u00a0\u00a0\u00a0\u00a0<g-emoji class=\"g-emoji\" alias=\"white_circle\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/26aa.png\">\u26aa\ufe0f</g-emoji>\u00a0 <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"362437574\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/11924\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/11924/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/11924\">#11924</a> Move Blob to ATen/core\u00a0\u00a0<a href=\"https://our.internmc.facebook.com/intern/diff/D9980641/\" rel=\"nofollow\"><g-emoji class=\"g-emoji\" alias=\"yellow_heart\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f49b.png\">\ud83d\udc9b</g-emoji></a><br>\n\u00a0\u00a0\u00a0\u00a0<g-emoji class=\"g-emoji\" alias=\"white_circle\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/26aa.png\">\u26aa\ufe0f</g-emoji>\u00a0 <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"358242512\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/11414\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/11414/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/11414\">#11414</a> IValue can store Blob\u00a0\u00a0<a href=\"https://our.internmc.facebook.com/intern/diff/D9731326/\" rel=\"nofollow\"><g-emoji class=\"g-emoji\" alias=\"green_heart\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f49a.png\">\ud83d\udc9a</g-emoji></a><br>\n\u00a0\u00a0\u00a0\u00a0<g-emoji class=\"g-emoji\" alias=\"white_circle\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/26aa.png\">\u26aa\ufe0f</g-emoji>\u00a0 <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"359220793\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/11548\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/11548/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/11548\">#11548</a> Blob doesn't allow access to destroyCall anymore\u00a0\u00a0<a href=\"https://our.internmc.facebook.com/intern/diff/D9775191/\" rel=\"nofollow\"><g-emoji class=\"g-emoji\" alias=\"green_heart\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f49a.png\">\ud83d\udc9a</g-emoji></a><br>\n\u00a0\u00a0\u00a0\u00a0<g-emoji class=\"g-emoji\" alias=\"white_circle\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/26aa.png\">\u26aa\ufe0f</g-emoji>\u00a0 <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"358851027\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/11500\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/11500/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/11500\">#11500</a> Use TypeMeta::dtor() instead of Blob::DestroyCall\u00a0\u00a0<a href=\"https://our.internmc.facebook.com/intern/diff/D9763423/\" rel=\"nofollow\"><g-emoji class=\"g-emoji\" alias=\"yellow_heart\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f49b.png\">\ud83d\udc9b</g-emoji></a><br>\n\u00a0\u00a0\u00a0\u00a0<g-emoji class=\"g-emoji\" alias=\"white_circle\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/26aa.png\">\u26aa\ufe0f</g-emoji>\u00a0 <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"362437595\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/11925\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/11925/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/11925\">#11925</a> Serialization takes pointers instead of Blob\u00a0\u00a0<a href=\"https://our.internmc.facebook.com/intern/diff/D9884177/\" rel=\"nofollow\"><g-emoji class=\"g-emoji\" alias=\"yellow_heart\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f49b.png\">\ud83d\udc9b</g-emoji></a><br>\n\u00a0\u00a0\u00a0\u00a0<g-emoji class=\"g-emoji\" alias=\"white_circle\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/26aa.png\">\u26aa\ufe0f</g-emoji>\u00a0 <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"362437628\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/11926\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/pytorch/pytorch/pull/11926/hovercard\" href=\"https://github.com/pytorch/pytorch/pull/11926\">#11926</a> Remove Blob::ShareExternal from serialization\u00a0\u00a0<a href=\"https://our.internmc.facebook.com/intern/diff/D9884563/\" rel=\"nofollow\"><g-emoji class=\"g-emoji\" alias=\"yellow_heart\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f49b.png\">\ud83d\udc9b</g-emoji></a></p>\n<p>This is pre-work to allow moving Blob to ATen/core, which cannot depend on caffe2 anymore.<br>\n(1) Removing the Blob -&gt; Tensor dependency allows us to move Blob to ATen/core and use it inside IValue without having to wait for the Tensor merge to be complete.<br>\n(2) In the final Blob design, we want it to be a very small class that doesn't have any special treatment for Tensor (or to be more correct, doesn't allow storing Tensor anymore), , so this is anyhow the direction we want to go.</p>\n<p>This changes call sites that will have to be moved to IValue later, but they cannot be moved to IValue directly, because for that, IValue first needs to be able to store Blob, which in turn first needs this diff and some other changes coming up in future diffs.</p>\n<p>Codemods:<br>\n$ codemod --extensions h,hpp,c,cpp,cc \"([a-zA-Z0-9_]+)\\.IsTensorType\\(\" \"BlobIsTensorType(\\1, \"<br>\n$ codemod --extensions h,hpp,c,cpp,cc \"([a-zA-Z0-9_]+)-&gt;IsTensorType\\(\" \"BlobIsTensorType(<em>\\1, \"<br>\n$ codemod --extensions h,hpp,c,cpp,cc \"([a-zA-Z0-9_]+)\\.GetMutableTensor\\(\" \"BlobGetMutableTensor(\\1, \"<br>\n$ codemod --extensions h,hpp,c,cpp,cc \"([a-zA-Z0-9_]+)-&gt;GetMutableTensor\\(\" \"BlobGetMutableTensor(</em>\\1, \"</p>\n<p>It is, however, not only these codemods because regex based refactoring was only able to match a small amount of the call sites. To catch more, I wouldn've needed a AST aware tool like clangr, which I didn't figure out how to use.</p>\n<p>Differential Revision: <a href=\"https://our.internmc.facebook.com/intern/diff/D9979976/\" rel=\"nofollow\">D9979976</a></p>", "body_text": "Stack:\n\u00a0\u00a0\u00a0\u00a0\u26ab\ufe0f\u00a0 #11923 Removing some dependency edges from Blob to other caffe2\u00a0\u00a0\ud83d\udc9a\n\u00a0\u00a0\u00a0\u00a0\u26aa\ufe0f\u00a0 #11924 Move Blob to ATen/core\u00a0\u00a0\ud83d\udc9b\n\u00a0\u00a0\u00a0\u00a0\u26aa\ufe0f\u00a0 #11414 IValue can store Blob\u00a0\u00a0\ud83d\udc9a\n\u00a0\u00a0\u00a0\u00a0\u26aa\ufe0f\u00a0 #11548 Blob doesn't allow access to destroyCall anymore\u00a0\u00a0\ud83d\udc9a\n\u00a0\u00a0\u00a0\u00a0\u26aa\ufe0f\u00a0 #11500 Use TypeMeta::dtor() instead of Blob::DestroyCall\u00a0\u00a0\ud83d\udc9b\n\u00a0\u00a0\u00a0\u00a0\u26aa\ufe0f\u00a0 #11925 Serialization takes pointers instead of Blob\u00a0\u00a0\ud83d\udc9b\n\u00a0\u00a0\u00a0\u00a0\u26aa\ufe0f\u00a0 #11926 Remove Blob::ShareExternal from serialization\u00a0\u00a0\ud83d\udc9b\nThis is pre-work to allow moving Blob to ATen/core, which cannot depend on caffe2 anymore.\n(1) Removing the Blob -> Tensor dependency allows us to move Blob to ATen/core and use it inside IValue without having to wait for the Tensor merge to be complete.\n(2) In the final Blob design, we want it to be a very small class that doesn't have any special treatment for Tensor (or to be more correct, doesn't allow storing Tensor anymore), , so this is anyhow the direction we want to go.\nThis changes call sites that will have to be moved to IValue later, but they cannot be moved to IValue directly, because for that, IValue first needs to be able to store Blob, which in turn first needs this diff and some other changes coming up in future diffs.\nCodemods:\n$ codemod --extensions h,hpp,c,cpp,cc \"([a-zA-Z0-9_]+)\\.IsTensorType\\(\" \"BlobIsTensorType(\\1, \"\n$ codemod --extensions h,hpp,c,cpp,cc \"([a-zA-Z0-9_]+)->IsTensorType\\(\" \"BlobIsTensorType(\\1, \"\n$ codemod --extensions h,hpp,c,cpp,cc \"([a-zA-Z0-9_]+)\\.GetMutableTensor\\(\" \"BlobGetMutableTensor(\\1, \"\n$ codemod --extensions h,hpp,c,cpp,cc \"([a-zA-Z0-9_]+)->GetMutableTensor\\(\" \"BlobGetMutableTensor(\\1, \"\nIt is, however, not only these codemods because regex based refactoring was only able to match a small amount of the call sites. To catch more, I wouldn've needed a AST aware tool like clangr, which I didn't figure out how to use.\nDifferential Revision: D9979976", "body": "Stack:\r\n&nbsp;&nbsp;&nbsp;&nbsp;:black_circle:&nbsp; **#11923 Removing some dependency edges from Blob to other caffe2**&nbsp;&nbsp;[:green_heart:](https://our.internmc.facebook.com/intern/diff/D9979976/)\r\n&nbsp;&nbsp;&nbsp;&nbsp;:white_circle:&nbsp; #11924 Move Blob to ATen/core&nbsp;&nbsp;[:yellow_heart:](https://our.internmc.facebook.com/intern/diff/D9980641/)\r\n&nbsp;&nbsp;&nbsp;&nbsp;:white_circle:&nbsp; #11414 IValue can store Blob&nbsp;&nbsp;[:green_heart:](https://our.internmc.facebook.com/intern/diff/D9731326/)\r\n&nbsp;&nbsp;&nbsp;&nbsp;:white_circle:&nbsp; #11548 Blob doesn't allow access to destroyCall anymore&nbsp;&nbsp;[:green_heart:](https://our.internmc.facebook.com/intern/diff/D9775191/)\r\n&nbsp;&nbsp;&nbsp;&nbsp;:white_circle:&nbsp; #11500 Use TypeMeta::dtor() instead of Blob::DestroyCall&nbsp;&nbsp;[:yellow_heart:](https://our.internmc.facebook.com/intern/diff/D9763423/)\r\n&nbsp;&nbsp;&nbsp;&nbsp;:white_circle:&nbsp; #11925 Serialization takes pointers instead of Blob&nbsp;&nbsp;[:yellow_heart:](https://our.internmc.facebook.com/intern/diff/D9884177/)\r\n&nbsp;&nbsp;&nbsp;&nbsp;:white_circle:&nbsp; #11926 Remove Blob::ShareExternal from serialization&nbsp;&nbsp;[:yellow_heart:](https://our.internmc.facebook.com/intern/diff/D9884563/)\r\n\r\nThis is pre-work to allow moving Blob to ATen/core, which cannot depend on caffe2 anymore.\r\n(1) Removing the Blob -> Tensor dependency allows us to move Blob to ATen/core and use it inside IValue without having to wait for the Tensor merge to be complete.\r\n(2) In the final Blob design, we want it to be a very small class that doesn't have any special treatment for Tensor (or to be more correct, doesn't allow storing Tensor anymore), , so this is anyhow the direction we want to go.\r\n\r\nThis changes call sites that will have to be moved to IValue later, but they cannot be moved to IValue directly, because for that, IValue first needs to be able to store Blob, which in turn first needs this diff and some other changes coming up in future diffs.\r\n\r\nCodemods:\r\n$ codemod --extensions h,hpp,c,cpp,cc \"([a-zA-Z0-9_]+)\\\\.IsTensorType\\\\(\" \"BlobIsTensorType(\\\\1, \"\r\n$ codemod --extensions h,hpp,c,cpp,cc \"([a-zA-Z0-9_]+)->IsTensorType\\\\(\" \"BlobIsTensorType(*\\\\1, \"\r\n$ codemod --extensions h,hpp,c,cpp,cc \"([a-zA-Z0-9_]+)\\\\.GetMutableTensor\\\\(\" \"BlobGetMutableTensor(\\\\1, \"\r\n$ codemod --extensions h,hpp,c,cpp,cc \"([a-zA-Z0-9_]+)->GetMutableTensor\\\\(\" \"BlobGetMutableTensor(*\\\\1, \"\r\n\r\nIt is, however, not only these codemods because regex based refactoring was only able to match a small amount of the call sites. To catch more, I wouldn've needed a AST aware tool like clangr, which I didn't figure out how to use.\r\n\r\nDifferential Revision: [D9979976](https://our.internmc.facebook.com/intern/diff/D9979976/)"}