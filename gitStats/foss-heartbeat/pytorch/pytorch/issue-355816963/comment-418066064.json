{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/418066064", "html_url": "https://github.com/pytorch/pytorch/issues/11130#issuecomment-418066064", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/11130", "id": 418066064, "node_id": "MDEyOklzc3VlQ29tbWVudDQxODA2NjA2NA==", "user": {"login": "ddeeppnneett", "id": 42013567, "node_id": "MDQ6VXNlcjQyMDEzNTY3", "avatar_url": "https://avatars0.githubusercontent.com/u/42013567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ddeeppnneett", "html_url": "https://github.com/ddeeppnneett", "followers_url": "https://api.github.com/users/ddeeppnneett/followers", "following_url": "https://api.github.com/users/ddeeppnneett/following{/other_user}", "gists_url": "https://api.github.com/users/ddeeppnneett/gists{/gist_id}", "starred_url": "https://api.github.com/users/ddeeppnneett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ddeeppnneett/subscriptions", "organizations_url": "https://api.github.com/users/ddeeppnneett/orgs", "repos_url": "https://api.github.com/users/ddeeppnneett/repos", "events_url": "https://api.github.com/users/ddeeppnneett/events{/privacy}", "received_events_url": "https://api.github.com/users/ddeeppnneett/received_events", "type": "User", "site_admin": false}, "created_at": "2018-09-03T10:01:34Z", "updated_at": "2018-09-03T10:15:05Z", "author_association": "NONE", "body_html": "<p>This Dockerfile (git clone <a href=\"https://github.com/pytorch/pytorch.git\">https://github.com/pytorch/pytorch.git</a>) ends at <code>RUN mv /usr/local/caffe2 /usr/local/caffe2_build </code></p>\n<p>The caffe2 folder,  in the pytorch version,  is not at the  location expected by Detectron.</p>\n<pre><code>\nFROM nvidia/cuda:8.0-cudnn6-devel-ubuntu16.04\nLABEL maintainer=\"aaronmarkham@fb.com\"\n\n# caffe2 install with gpu support\n\nRUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends \\\n    build-essential \\\n    cmake \\\n    git \\\n    libgflags-dev \\\n    libgoogle-glog-dev \\\n    libgtest-dev \\\n    libiomp-dev \\\n    libleveldb-dev \\\n    liblmdb-dev \\\n    libopencv-dev \\\n    libopenmpi-dev \\\n    libprotobuf-dev \\\n    libsnappy-dev \\\n    openmpi-bin \\\n    openmpi-doc \\\n    protobuf-compiler \\\n    python-dev \\\n    python-numpy \\\n    python-pip \\\n    python-pydot \\\n    python-setuptools \\\n    python-scipy \\\n    wget \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\n\nRUN pip install --no-cache-dir --upgrade pip==9.0.3 setuptools wheel &amp;&amp; \\\n    pip install --no-cache-dir \\\n    flask \\\n    future \\\n    graphviz \\\n    hypothesis \\\n    jupyter \\\n    matplotlib \\\n    numpy \\\n    protobuf \\\n    pydot \\\n    python-nvd3 \\\n    pyyaml \\\n    requests \\\n    scikit-image \\\n    scipy \\\n    setuptools \\\n    six \\\n    tornado\n\n########## INSTALLATION STEPS ###################\n##I replace the old version of caffe2 with the new one\n\nRUN git clone --branch master --recursive https://github.com/pytorch/pytorch.git\nRUN cd pytorch &amp;&amp; mkdir build &amp;&amp; cd build \\\n    &amp;&amp; cmake .. \\\n    -DCUDA_ARCH_NAME=Manual \\\n    -DCUDA_ARCH_BIN=\"35 52 60 61\" \\\n    -DCUDA_ARCH_PTX=\"61\" \\\n    -DUSE_NNPACK=OFF \\\n    -DUSE_ROCKSDB=OFF \\\n    &amp;&amp; make -j\"$(nproc)\" install \\\n    &amp;&amp; ldconfig \\\n    &amp;&amp; make clean \\\n    &amp;&amp; cd .. \\\n    &amp;&amp; rm -rf build\n\nENV PYTHONPATH /usr/local\n\n#######################################\n###detectron\n\nRUN mv /usr/local/caffe2 /usr/local/caffe2_build\nENV Caffe2_DIR /usr/local/caffe2_build\n\nENV PYTHONPATH /usr/local/caffe2_build:${PYTHONPATH}\nENV LD_LIBRARY_PATH /usr/local/caffe2_build/lib:${LD_LIBRARY_PATH}\n\n# Clone the Detectron repository\nRUN git clone https://github.com/facebookresearch/detectron /detectron\n\n# Install Python dependencies\nRUN pip install -r /detectron/requirements.txt\n\n# Install the COCO API\nRUN git clone https://github.com/cocodataset/cocoapi.git /cocoapi\nWORKDIR /cocoapi/PythonAPI\nRUN make install\n\n# Go to Detectron root\nWORKDIR /detectron\n\n# Set up Python modules\nRUN make\n\n# [Optional] Build custom ops\nRUN make ops\n\n</code></pre>", "body_text": "This Dockerfile (git clone https://github.com/pytorch/pytorch.git) ends at RUN mv /usr/local/caffe2 /usr/local/caffe2_build \nThe caffe2 folder,  in the pytorch version,  is not at the  location expected by Detectron.\n\nFROM nvidia/cuda:8.0-cudnn6-devel-ubuntu16.04\nLABEL maintainer=\"aaronmarkham@fb.com\"\n\n# caffe2 install with gpu support\n\nRUN apt-get update && apt-get install -y --no-install-recommends \\\n    build-essential \\\n    cmake \\\n    git \\\n    libgflags-dev \\\n    libgoogle-glog-dev \\\n    libgtest-dev \\\n    libiomp-dev \\\n    libleveldb-dev \\\n    liblmdb-dev \\\n    libopencv-dev \\\n    libopenmpi-dev \\\n    libprotobuf-dev \\\n    libsnappy-dev \\\n    openmpi-bin \\\n    openmpi-doc \\\n    protobuf-compiler \\\n    python-dev \\\n    python-numpy \\\n    python-pip \\\n    python-pydot \\\n    python-setuptools \\\n    python-scipy \\\n    wget \\\n    && rm -rf /var/lib/apt/lists/*\n\nRUN pip install --no-cache-dir --upgrade pip==9.0.3 setuptools wheel && \\\n    pip install --no-cache-dir \\\n    flask \\\n    future \\\n    graphviz \\\n    hypothesis \\\n    jupyter \\\n    matplotlib \\\n    numpy \\\n    protobuf \\\n    pydot \\\n    python-nvd3 \\\n    pyyaml \\\n    requests \\\n    scikit-image \\\n    scipy \\\n    setuptools \\\n    six \\\n    tornado\n\n########## INSTALLATION STEPS ###################\n##I replace the old version of caffe2 with the new one\n\nRUN git clone --branch master --recursive https://github.com/pytorch/pytorch.git\nRUN cd pytorch && mkdir build && cd build \\\n    && cmake .. \\\n    -DCUDA_ARCH_NAME=Manual \\\n    -DCUDA_ARCH_BIN=\"35 52 60 61\" \\\n    -DCUDA_ARCH_PTX=\"61\" \\\n    -DUSE_NNPACK=OFF \\\n    -DUSE_ROCKSDB=OFF \\\n    && make -j\"$(nproc)\" install \\\n    && ldconfig \\\n    && make clean \\\n    && cd .. \\\n    && rm -rf build\n\nENV PYTHONPATH /usr/local\n\n#######################################\n###detectron\n\nRUN mv /usr/local/caffe2 /usr/local/caffe2_build\nENV Caffe2_DIR /usr/local/caffe2_build\n\nENV PYTHONPATH /usr/local/caffe2_build:${PYTHONPATH}\nENV LD_LIBRARY_PATH /usr/local/caffe2_build/lib:${LD_LIBRARY_PATH}\n\n# Clone the Detectron repository\nRUN git clone https://github.com/facebookresearch/detectron /detectron\n\n# Install Python dependencies\nRUN pip install -r /detectron/requirements.txt\n\n# Install the COCO API\nRUN git clone https://github.com/cocodataset/cocoapi.git /cocoapi\nWORKDIR /cocoapi/PythonAPI\nRUN make install\n\n# Go to Detectron root\nWORKDIR /detectron\n\n# Set up Python modules\nRUN make\n\n# [Optional] Build custom ops\nRUN make ops", "body": "This Dockerfile (git clone https://github.com/pytorch/pytorch.git) ends at `RUN mv /usr/local/caffe2 /usr/local/caffe2_build `\r\n\r\nThe caffe2 folder,  in the pytorch version,  is not at the  location expected by Detectron. \r\n\r\n\r\n```\r\n\r\nFROM nvidia/cuda:8.0-cudnn6-devel-ubuntu16.04\r\nLABEL maintainer=\"aaronmarkham@fb.com\"\r\n\r\n# caffe2 install with gpu support\r\n\r\nRUN apt-get update && apt-get install -y --no-install-recommends \\\r\n    build-essential \\\r\n    cmake \\\r\n    git \\\r\n    libgflags-dev \\\r\n    libgoogle-glog-dev \\\r\n    libgtest-dev \\\r\n    libiomp-dev \\\r\n    libleveldb-dev \\\r\n    liblmdb-dev \\\r\n    libopencv-dev \\\r\n    libopenmpi-dev \\\r\n    libprotobuf-dev \\\r\n    libsnappy-dev \\\r\n    openmpi-bin \\\r\n    openmpi-doc \\\r\n    protobuf-compiler \\\r\n    python-dev \\\r\n    python-numpy \\\r\n    python-pip \\\r\n    python-pydot \\\r\n    python-setuptools \\\r\n    python-scipy \\\r\n    wget \\\r\n    && rm -rf /var/lib/apt/lists/*\r\n\r\nRUN pip install --no-cache-dir --upgrade pip==9.0.3 setuptools wheel && \\\r\n    pip install --no-cache-dir \\\r\n    flask \\\r\n    future \\\r\n    graphviz \\\r\n    hypothesis \\\r\n    jupyter \\\r\n    matplotlib \\\r\n    numpy \\\r\n    protobuf \\\r\n    pydot \\\r\n    python-nvd3 \\\r\n    pyyaml \\\r\n    requests \\\r\n    scikit-image \\\r\n    scipy \\\r\n    setuptools \\\r\n    six \\\r\n    tornado\r\n\r\n########## INSTALLATION STEPS ###################\r\n##I replace the old version of caffe2 with the new one\r\n\r\nRUN git clone --branch master --recursive https://github.com/pytorch/pytorch.git\r\nRUN cd pytorch && mkdir build && cd build \\\r\n    && cmake .. \\\r\n    -DCUDA_ARCH_NAME=Manual \\\r\n    -DCUDA_ARCH_BIN=\"35 52 60 61\" \\\r\n    -DCUDA_ARCH_PTX=\"61\" \\\r\n    -DUSE_NNPACK=OFF \\\r\n    -DUSE_ROCKSDB=OFF \\\r\n    && make -j\"$(nproc)\" install \\\r\n    && ldconfig \\\r\n    && make clean \\\r\n    && cd .. \\\r\n    && rm -rf build\r\n\r\nENV PYTHONPATH /usr/local\r\n\r\n#######################################\r\n###detectron\r\n\r\nRUN mv /usr/local/caffe2 /usr/local/caffe2_build\r\nENV Caffe2_DIR /usr/local/caffe2_build\r\n\r\nENV PYTHONPATH /usr/local/caffe2_build:${PYTHONPATH}\r\nENV LD_LIBRARY_PATH /usr/local/caffe2_build/lib:${LD_LIBRARY_PATH}\r\n\r\n# Clone the Detectron repository\r\nRUN git clone https://github.com/facebookresearch/detectron /detectron\r\n\r\n# Install Python dependencies\r\nRUN pip install -r /detectron/requirements.txt\r\n\r\n# Install the COCO API\r\nRUN git clone https://github.com/cocodataset/cocoapi.git /cocoapi\r\nWORKDIR /cocoapi/PythonAPI\r\nRUN make install\r\n\r\n# Go to Detectron root\r\nWORKDIR /detectron\r\n\r\n# Set up Python modules\r\nRUN make\r\n\r\n# [Optional] Build custom ops\r\nRUN make ops\r\n\r\n```"}