{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/162435770", "pull_request_review_id": 89893141, "id": 162435770, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MjQzNTc3MA==", "diff_hunk": "@@ -59,10 +59,32 @@ SIGNAL_HANDLER(SIGBUS, handler_SIGBUS, \"ERROR: Unexpected bus error encountered\n   \"This might be caused by insufficient shared memory (shm).\\n\");\n SIGNAL_HANDLER(SIGSEGV, handler_SIGSEGV, \"ERROR: Unexpected segmentation fault encountered in worker.\\n\");\n \n+// When an error happend in DataLoader methods and Python starts to  exit, the\n+// error trace will keep the loader alive, and Python may kill the children\n+// processes first before deleting the loader object. Then the cleaning up\n+// methods in DataLoader.__del__ are not yet called, and SIGCHILD will print an\n+// error saying a worker is killed by SIGTERM. So we suppress SIGTERM from main\n+// loader process here to avoid this.\n+static void handler_SIGTERM(int sig, siginfo_t *info, void *ctx)\n+{\n+  if (info->si_pid == getppid()) {\n+    _exit(EXIT_SUCCESS);", "path": "torch/csrc/DataLoader.cpp", "position": null, "original_position": 22, "commit_id": "d4882230052d14432fd34e0aa2f5fc0f73977352", "original_commit_id": "123156a896f1c974f2eb44efb09b330c44ff9704", "user": {"login": "SsnL", "id": 5674597, "node_id": "MDQ6VXNlcjU2NzQ1OTc=", "avatar_url": "https://avatars2.githubusercontent.com/u/5674597?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SsnL", "html_url": "https://github.com/SsnL", "followers_url": "https://api.github.com/users/SsnL/followers", "following_url": "https://api.github.com/users/SsnL/following{/other_user}", "gists_url": "https://api.github.com/users/SsnL/gists{/gist_id}", "starred_url": "https://api.github.com/users/SsnL/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SsnL/subscriptions", "organizations_url": "https://api.github.com/users/SsnL/orgs", "repos_url": "https://api.github.com/users/SsnL/repos", "events_url": "https://api.github.com/users/SsnL/events{/privacy}", "received_events_url": "https://api.github.com/users/SsnL/received_events", "type": "User", "site_admin": false}, "body": "But it only EXIT_SUCCESS when it got SIGTERM from the parent loader process. Since we don't expose these worker processes to users, this should really only happen when loader process is terminated. If we don't EXIT_SUCCESS, then the non-zero exit code may trigger `RuntimeError` in loader SIGCHLD handler.", "created_at": "2018-01-18T18:53:43Z", "updated_at": "2018-11-23T15:38:18Z", "html_url": "https://github.com/pytorch/pytorch/pull/4643#discussion_r162435770", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/4643", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/162435770"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/4643#discussion_r162435770"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/4643"}}, "body_html": "<p>But it only EXIT_SUCCESS when it got SIGTERM from the parent loader process. Since we don't expose these worker processes to users, this should really only happen when loader process is terminated. If we don't EXIT_SUCCESS, then the non-zero exit code may trigger <code>RuntimeError</code> in loader SIGCHLD handler.</p>", "body_text": "But it only EXIT_SUCCESS when it got SIGTERM from the parent loader process. Since we don't expose these worker processes to users, this should really only happen when loader process is terminated. If we don't EXIT_SUCCESS, then the non-zero exit code may trigger RuntimeError in loader SIGCHLD handler.", "in_reply_to_id": 162430389}