{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/199354255", "pull_request_review_id": 133458676, "id": 199354255, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5OTM1NDI1NQ==", "diff_hunk": "@@ -5,179 +5,107 @@\n #include \"../common.h\"\n \n static inline void THNN_(VolumetricUpSamplingNearest_shapeCheck)\n-                        (THCState *state,THCTensor *input, THCTensor *gradOutput,\n-                         int scale_factor) {\n-  THArgCheck(input != NULL, 2, \"4D input tensor expected but got NULL\");\n-  THArgCheck(scale_factor > 1, 4,\n-             \"scale_factor must be greater than 1, but got: %d\", scale_factor);\n-  THCUNN_argCheck(state, !input->is_empty() && (input->dim() == 4 || input->dim() == 5), 2, input,\n-                  \"non-empty 4D or 5D input tensor expected but got: %s\");\n-  if (input->dim() == 4) {\n-    int nChannels    = THCTensor_(size)(state, input, 0);\n-    int inputDepth   = THCTensor_(size)(state, input, 1);\n-    int inputHeight  = THCTensor_(size)(state, input, 2);\n-    int inputWidth   = THCTensor_(size)(state, input, 3);\n-    int outputDepth  = inputDepth * scale_factor;\n-    int outputHeight = inputHeight * scale_factor;\n-    int outputWidth  = inputWidth  * scale_factor;\n-    if (gradOutput != NULL) {\n-      THCUNN_check_dim_size(state, gradOutput, 4, 0, nChannels);\n-      THCUNN_check_dim_size(state, gradOutput, 4, 1, outputDepth);\n-      THCUNN_check_dim_size(state, gradOutput, 4, 2, outputHeight);\n-      THCUNN_check_dim_size(state, gradOutput, 4, 3, outputWidth);\n-    }\n-  } else {\n-    int nBatch       = THCTensor_(size)(state, input, 0);\n-    int nChannels    = THCTensor_(size)(state, input, 1);\n-    int inputDepth   = THCTensor_(size)(state, input, 2);\n-    int inputHeight  = THCTensor_(size)(state, input, 3);\n-    int inputWidth   = THCTensor_(size)(state, input, 4);\n-    int outputDepth  = inputDepth  * scale_factor;\n-    int outputHeight = inputHeight * scale_factor;\n-    int outputWidth  = inputWidth  * scale_factor;\n-    if (gradOutput != NULL) {\n-      THCUNN_check_dim_size(state, gradOutput, 5, 0, nBatch);\n-      THCUNN_check_dim_size(state, gradOutput, 5, 1, nChannels);\n-      THCUNN_check_dim_size(state, gradOutput, 5, 2, outputDepth);\n-      THCUNN_check_dim_size(state, gradOutput, 5, 3, outputHeight);\n-      THCUNN_check_dim_size(state, gradOutput, 5, 4, outputWidth);\n-    }\n+                        (THCState *state,\n+                         THCTensor *input, THCTensor *gradOutput,\n+                         int nBatch, int nChannels,\n+                         int inputDepth, int inputHeight, int inputWidth,\n+                         int outputDepth, int outputHeight, int outputWidth) {\n+  THArgCheck(inputDepth > 0 && inputHeight > 0 && inputWidth > 0\n+             && outputDepth && outputHeight > 0 && outputWidth > 0, 2,\n+             \"input and output sizes should be greater than 0,\"\n+             \" but got input (D: %d, H: %d, W: %d) output (D: %d, H: %d, W: %d)\",\n+             inputDepth, inputHeight, inputWidth, outputDepth, outputHeight, outputWidth);\n+  if (input != NULL) {\n+     THCUNN_argCheck(state, input->_dim() == 5, 2, input,\n+                     \"5D input tensor expected but got: %s\");\n+  }\n+\n+  if (gradOutput != NULL) {\n+    THCUNN_check_dim_size(state, gradOutput, 5, 0, nBatch);\n+    THCUNN_check_dim_size(state, gradOutput, 5, 1, nChannels);\n+    THCUNN_check_dim_size(state, gradOutput, 5, 2, outputDepth);\n+    THCUNN_check_dim_size(state, gradOutput, 5, 3, outputHeight);\n+    THCUNN_check_dim_size(state, gradOutput, 5, 4, outputWidth);\n   }\n }\n \n+\n void THNN_(VolumetricUpSamplingNearest_updateOutput)(\n            THCState *state,\n            THCTensor *input,\n            THCTensor *output,\n-           int scale_factor)\n+\t   int outputDepth,\n+\t   int outputHeight,\n+           int outputWidth)\n {\n-  THCTensor_(zero)(state, output);\n-\n   THCUNN_assertSameGPU(state, 2, input, output);\n-  THNN_(VolumetricUpSamplingNearest_shapeCheck)(state, input, NULL, scale_factor);\n-  int inputDepth = THCTensor_(size)(state, input, input->dim()-3);\n-  int inputHeight = THCTensor_(size)(state, input, input->dim()-2);\n-  int inputWidth  = THCTensor_(size)(state, input,  input->dim()-1);\n-  int outputDepth = inputDepth * scale_factor;\n-  int outputHeight = inputHeight * scale_factor;\n-  int outputWidth = inputWidth * scale_factor;\n-\n-   if (input->dim() == 4) {\n-     THCTensor_(resize4d)(state, output,\n-                          THCTensor_(size)(state, input, 0),\n-                          outputDepth, outputHeight, outputWidth);\n-   } else {\n-     THCTensor_(resize5d)(state, output,\n-                          THCTensor_(size)(state, input, 0),\n-                          THCTensor_(size)(state, input, 1),\n-                          outputDepth, outputHeight, outputWidth);\n-  }\n+  int nbatch = THCTensor_(size)(state, input, 0);\n+  int channels = THCTensor_(size)(state, input, 1);\n+  int inputDepth = THCTensor_(size)(state, input, 2);\n+  int inputHeight = THCTensor_(size)(state, input, 3);\n+  int inputWidth  = THCTensor_(size)(state, input, 4);\n+\n+  THNN_(VolumetricUpSamplingNearest_shapeCheck)(state, input, NULL, nbatch, channels,\n+\t\t  inputDepth, inputHeight, inputWidth,\n+\t\t  outputDepth, outputHeight, outputWidth);\n+  THAssert(inputDepth > 0 && inputHeight > 0 && inputWidth > 0 &&\n+\t\t  outputDepth > 0 && outputHeight > 0 && outputWidth > 0);\n+\n+  THCTensor_(resize5d)(state, output,\n+                       THCTensor_(size)(state, input, 0),\n+                       THCTensor_(size)(state, input, 1),\n+\t\t       outputDepth,", "path": "aten/src/THCUNN/generic/VolumetricUpSamplingNearest.cu", "position": null, "original_position": 111, "commit_id": "f99c543ab514043a5a842d80d166f4ef7e36d93b", "original_commit_id": "03cfb5387bfea8f995540b427c7e8a2855140963", "user": {"login": "fmassa", "id": 9110200, "node_id": "MDQ6VXNlcjkxMTAyMDA=", "avatar_url": "https://avatars2.githubusercontent.com/u/9110200?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fmassa", "html_url": "https://github.com/fmassa", "followers_url": "https://api.github.com/users/fmassa/followers", "following_url": "https://api.github.com/users/fmassa/following{/other_user}", "gists_url": "https://api.github.com/users/fmassa/gists{/gist_id}", "starred_url": "https://api.github.com/users/fmassa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fmassa/subscriptions", "organizations_url": "https://api.github.com/users/fmassa/orgs", "repos_url": "https://api.github.com/users/fmassa/repos", "events_url": "https://api.github.com/users/fmassa/events{/privacy}", "received_events_url": "https://api.github.com/users/fmassa/received_events", "type": "User", "site_admin": false}, "body": "nit: tabs in the next few lines", "created_at": "2018-07-01T16:22:38Z", "updated_at": "2018-11-23T15:46:38Z", "html_url": "https://github.com/pytorch/pytorch/pull/8591#discussion_r199354255", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/8591", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/199354255"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/8591#discussion_r199354255"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/8591"}}, "body_html": "<p>nit: tabs in the next few lines</p>", "body_text": "nit: tabs in the next few lines"}