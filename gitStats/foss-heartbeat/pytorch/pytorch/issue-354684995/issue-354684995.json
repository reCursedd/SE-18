{"url": "https://api.github.com/repos/pytorch/pytorch/issues/10942", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/10942/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/10942/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/10942/events", "html_url": "https://github.com/pytorch/pytorch/issues/10942", "id": 354684995, "node_id": "MDU6SXNzdWUzNTQ2ODQ5OTU=", "number": 10942, "title": "[ONNX] export error on onnx::Concat layer: RuntimeError: ONNX symbolic expected a constant value in the trace", "user": {"login": "pumpkin007", "id": 5400899, "node_id": "MDQ6VXNlcjU0MDA4OTk=", "avatar_url": "https://avatars1.githubusercontent.com/u/5400899?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pumpkin007", "html_url": "https://github.com/pumpkin007", "followers_url": "https://api.github.com/users/pumpkin007/followers", "following_url": "https://api.github.com/users/pumpkin007/following{/other_user}", "gists_url": "https://api.github.com/users/pumpkin007/gists{/gist_id}", "starred_url": "https://api.github.com/users/pumpkin007/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pumpkin007/subscriptions", "organizations_url": "https://api.github.com/users/pumpkin007/orgs", "repos_url": "https://api.github.com/users/pumpkin007/repos", "events_url": "https://api.github.com/users/pumpkin007/events{/privacy}", "received_events_url": "https://api.github.com/users/pumpkin007/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 693805995, "node_id": "MDU6TGFiZWw2OTM4MDU5OTU=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/onnx", "name": "onnx", "color": "e99695", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-08-28T11:18:53Z", "updated_at": "2018-10-24T16:35:53Z", "closed_at": null, "author_association": "NONE", "body_html": "<h2>Issue description</h2>\n<p>When try to convert a model that requires concat operation, onnx returns error.</p>\n<h2>Code example</h2>\n<p>from torch.autograd import Variable<br>\nimport torch.onnx<br>\nfrom model.model_noalign import RGMP</p>\n<p>input = Variable(torch.randn(1, 3, 352, 352))<br>\nmask = Variable(torch.randn(1, 352, 352))<br>\nmodel = ResnetRefine(resnet_size=18)<br>\ntorch.onnx.export(model, (input, mask), './model/model.onnx')</p>\n<h2>Error information</h2>\n<p>Traceback (most recent call last):<br>\nFile \"/home/zhouyiren/code/project/convert_to_onnx.py\", line 15, in <br>\ntorch.onnx.export(model, (input, mask), './model/model.onnx')<br>\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/<strong>init</strong>.py\", line 27, in export<br>\nreturn utils.export(*args, **kwargs)<br>\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/utils.py\", line 103, in export<br>\noperator_export_type=operator_export_type)<br>\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/utils.py\", line 257, in _export<br>\nexample_outputs, propagate)<br>\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/utils.py\", line 210, in _model_to_graph<br>\ngraph = _optimize_graph(graph, operator_export_type)<br>\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/utils.py\", line 138, in _optimize_graph<br>\ngraph = torch._C._jit_pass_onnx(graph, operator_export_type)<br>\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/<strong>init</strong>.py\", line 52, in _run_symbolic_function<br>\nreturn utils._run_symbolic_function(*args, **kwargs)<br>\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/utils.py\", line 480, in _run_symbolic_function<br>\nreturn fn(g, *inputs, **attrs)<br>\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/symbolic.py\", line 84, in wrapper<br>\nargs = [_parse_arg(arg, arg_desc) for arg, arg_desc in zip(args, arg_descriptors)]<br>\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/symbolic.py\", line 84, in <br>\nargs = [_parse_arg(arg, arg_desc) for arg, arg_desc in zip(args, arg_descriptors)]<br>\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/symbolic.py\", line 41, in _parse_arg<br>\nraise RuntimeError(\"ONNX symbolic expected a constant value in the trace\")<br>\nRuntimeError: ONNX symbolic expected a constant value in the trace</p>\n<p>When print in File \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/symbolic.py\", line 41, in _parse_arg:<br>\nThe layer information:<br>\n%706 : int[] = onnx::Concat[axis=0](%704, %705), scope: ResnetRefine/Decoder[Decoder]/Refine[RF4]</p>\n<p>Does ONNX support concat layer in \"symbolic.py\"?</p>", "body_text": "Issue description\nWhen try to convert a model that requires concat operation, onnx returns error.\nCode example\nfrom torch.autograd import Variable\nimport torch.onnx\nfrom model.model_noalign import RGMP\ninput = Variable(torch.randn(1, 3, 352, 352))\nmask = Variable(torch.randn(1, 352, 352))\nmodel = ResnetRefine(resnet_size=18)\ntorch.onnx.export(model, (input, mask), './model/model.onnx')\nError information\nTraceback (most recent call last):\nFile \"/home/zhouyiren/code/project/convert_to_onnx.py\", line 15, in \ntorch.onnx.export(model, (input, mask), './model/model.onnx')\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/init.py\", line 27, in export\nreturn utils.export(*args, **kwargs)\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/utils.py\", line 103, in export\noperator_export_type=operator_export_type)\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/utils.py\", line 257, in _export\nexample_outputs, propagate)\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/utils.py\", line 210, in _model_to_graph\ngraph = _optimize_graph(graph, operator_export_type)\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/utils.py\", line 138, in _optimize_graph\ngraph = torch._C._jit_pass_onnx(graph, operator_export_type)\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/init.py\", line 52, in _run_symbolic_function\nreturn utils._run_symbolic_function(*args, **kwargs)\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/utils.py\", line 480, in _run_symbolic_function\nreturn fn(g, *inputs, **attrs)\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/symbolic.py\", line 84, in wrapper\nargs = [_parse_arg(arg, arg_desc) for arg, arg_desc in zip(args, arg_descriptors)]\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/symbolic.py\", line 84, in \nargs = [_parse_arg(arg, arg_desc) for arg, arg_desc in zip(args, arg_descriptors)]\nFile \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/symbolic.py\", line 41, in _parse_arg\nraise RuntimeError(\"ONNX symbolic expected a constant value in the trace\")\nRuntimeError: ONNX symbolic expected a constant value in the trace\nWhen print in File \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/symbolic.py\", line 41, in _parse_arg:\nThe layer information:\n%706 : int[] = onnx::Concat[axis=0](%704, %705), scope: ResnetRefine/Decoder[Decoder]/Refine[RF4]\nDoes ONNX support concat layer in \"symbolic.py\"?", "body": "## Issue description\r\n\r\nWhen try to convert a model that requires concat operation, onnx returns error.\r\n\r\n## Code example\r\n\r\nfrom torch.autograd import Variable\r\nimport torch.onnx\r\nfrom model.model_noalign import RGMP\r\n\r\ninput = Variable(torch.randn(1, 3, 352, 352))\r\nmask = Variable(torch.randn(1, 352, 352))\r\nmodel = ResnetRefine(resnet_size=18)\r\ntorch.onnx.export(model, (input, mask), './model/model.onnx')\r\n\r\n## Error information\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/zhouyiren/code/project/convert_to_onnx.py\", line 15, in <module>\r\n    torch.onnx.export(model, (input, mask), './model/model.onnx')\r\n  File \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/__init__.py\", line 27, in export\r\n    return utils.export(*args, **kwargs)\r\n  File \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/utils.py\", line 103, in export\r\n    operator_export_type=operator_export_type)\r\n  File \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/utils.py\", line 257, in _export\r\n    example_outputs, propagate)\r\n  File \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/utils.py\", line 210, in _model_to_graph\r\n    graph = _optimize_graph(graph, operator_export_type)\r\n  File \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/utils.py\", line 138, in _optimize_graph\r\n    graph = torch._C._jit_pass_onnx(graph, operator_export_type)\r\n  File \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/__init__.py\", line 52, in _run_symbolic_function\r\n    return utils._run_symbolic_function(*args, **kwargs)\r\n  File \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/utils.py\", line 480, in _run_symbolic_function\r\n    return fn(g, *inputs, **attrs)\r\n  File \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/symbolic.py\", line 84, in wrapper\r\n    args = [_parse_arg(arg, arg_desc) for arg, arg_desc in zip(args, arg_descriptors)]\r\n  File \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/symbolic.py\", line 84, in <listcomp>\r\n    args = [_parse_arg(arg, arg_desc) for arg, arg_desc in zip(args, arg_descriptors)]\r\n  File \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/symbolic.py\", line 41, in _parse_arg\r\n    raise RuntimeError(\"ONNX symbolic expected a constant value in the trace\")\r\nRuntimeError: ONNX symbolic expected a constant value in the trace\r\n\r\n\r\nWhen print in File \"/home/zhouyiren/anaconda3/envs/onnx/lib/python3.6/site-packages/torch/onnx/symbolic.py\", line 41, in _parse_arg:\r\nThe layer information:\r\n%706 : int[] = onnx::Concat[axis=0](%704, %705), scope: ResnetRefine/Decoder[Decoder]/Refine[RF4]\r\n\r\nDoes ONNX support concat layer in \"symbolic.py\"?"}