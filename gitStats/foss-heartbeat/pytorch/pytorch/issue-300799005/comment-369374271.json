{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/369374271", "html_url": "https://github.com/pytorch/pytorch/issues/5442#issuecomment-369374271", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/5442", "id": 369374271, "node_id": "MDEyOklzc3VlQ29tbWVudDM2OTM3NDI3MQ==", "user": {"login": "ngimel", "id": 15841449, "node_id": "MDQ6VXNlcjE1ODQxNDQ5", "avatar_url": "https://avatars3.githubusercontent.com/u/15841449?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ngimel", "html_url": "https://github.com/ngimel", "followers_url": "https://api.github.com/users/ngimel/followers", "following_url": "https://api.github.com/users/ngimel/following{/other_user}", "gists_url": "https://api.github.com/users/ngimel/gists{/gist_id}", "starred_url": "https://api.github.com/users/ngimel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ngimel/subscriptions", "organizations_url": "https://api.github.com/users/ngimel/orgs", "repos_url": "https://api.github.com/users/ngimel/repos", "events_url": "https://api.github.com/users/ngimel/events{/privacy}", "received_events_url": "https://api.github.com/users/ngimel/received_events", "type": "User", "site_admin": false}, "created_at": "2018-02-28T20:36:58Z", "updated_at": "2018-02-28T20:36:58Z", "author_association": "CONTRIBUTOR", "body_html": "<p>FWIW, with a relatively recent pytorch build and numpy 1.14.1 I'm seeing no copy, and pytorch not respecting read only flag.</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> numpy <span class=\"pl-k\">as</span> np\n<span class=\"pl-k\">import</span> time\n<span class=\"pl-k\">import</span> torch\n\n<span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>numpy version<span class=\"pl-pds\">\"</span></span>, np.version.version)\nstart_time <span class=\"pl-k\">=</span> time.time()\narr <span class=\"pl-k\">=</span> np.zeros((<span class=\"pl-c1\">1000</span><span class=\"pl-k\">*</span><span class=\"pl-c1\">250</span><span class=\"pl-k\">*</span><span class=\"pl-c1\">1000</span>,))\narr.flags[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>WRITEABLE<span class=\"pl-pds\">'</span></span>] <span class=\"pl-k\">=</span> <span class=\"pl-c1\">False</span>\nstart_time <span class=\"pl-k\">=</span> time.time()\narr2 <span class=\"pl-k\">=</span> torch.from_numpy(arr)\n<span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>time<span class=\"pl-pds\">\"</span></span>, time.time()<span class=\"pl-k\">-</span>start_time)\narr2 <span class=\"pl-k\">+=</span> <span class=\"pl-c1\">1</span>\n<span class=\"pl-c1\">print</span>(arr[<span class=\"pl-c1\">0</span>], arr2[<span class=\"pl-c1\">0</span>])\narr <span class=\"pl-k\">+=</span> <span class=\"pl-c1\">1</span></pre></div>\n<pre><code>numpy version 1.14.1\ntime 0.00014472007751464844\n1.0 1.0\nTraceback (most recent call last):\n  File \"arraycopy.py\", line 14, in &lt;module&gt;\n    arr += 1\nValueError: output array is read-only\n</code></pre>", "body_text": "FWIW, with a relatively recent pytorch build and numpy 1.14.1 I'm seeing no copy, and pytorch not respecting read only flag.\nimport numpy as np\nimport time\nimport torch\n\nprint(\"numpy version\", np.version.version)\nstart_time = time.time()\narr = np.zeros((1000*250*1000,))\narr.flags['WRITEABLE'] = False\nstart_time = time.time()\narr2 = torch.from_numpy(arr)\nprint(\"time\", time.time()-start_time)\narr2 += 1\nprint(arr[0], arr2[0])\narr += 1\nnumpy version 1.14.1\ntime 0.00014472007751464844\n1.0 1.0\nTraceback (most recent call last):\n  File \"arraycopy.py\", line 14, in <module>\n    arr += 1\nValueError: output array is read-only", "body": "FWIW, with a relatively recent pytorch build and numpy 1.14.1 I'm seeing no copy, and pytorch not respecting read only flag. \r\n```.py\r\nimport numpy as np\r\nimport time\r\nimport torch\r\n\r\nprint(\"numpy version\", np.version.version)\r\nstart_time = time.time()\r\narr = np.zeros((1000*250*1000,))\r\narr.flags['WRITEABLE'] = False\r\nstart_time = time.time()\r\narr2 = torch.from_numpy(arr)\r\nprint(\"time\", time.time()-start_time)\r\narr2 += 1\r\nprint(arr[0], arr2[0])\r\narr += 1\r\n```\r\n\r\n\r\n```\r\nnumpy version 1.14.1\r\ntime 0.00014472007751464844\r\n1.0 1.0\r\nTraceback (most recent call last):\r\n  File \"arraycopy.py\", line 14, in <module>\r\n    arr += 1\r\nValueError: output array is read-only\r\n```"}