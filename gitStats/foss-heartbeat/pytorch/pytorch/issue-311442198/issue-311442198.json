{"url": "https://api.github.com/repos/pytorch/pytorch/issues/6295", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/6295/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/6295/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/6295/events", "html_url": "https://github.com/pytorch/pytorch/pull/6295", "id": 311442198, "node_id": "MDExOlB1bGxSZXF1ZXN0MTc5NTUxMDcw", "number": 6295, "title": "fix caffe translator problem when multiple caffe layers share the same output", "user": {"login": "harrysummer", "id": 1215413, "node_id": "MDQ6VXNlcjEyMTU0MTM=", "avatar_url": "https://avatars3.githubusercontent.com/u/1215413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harrysummer", "html_url": "https://github.com/harrysummer", "followers_url": "https://api.github.com/users/harrysummer/followers", "following_url": "https://api.github.com/users/harrysummer/following{/other_user}", "gists_url": "https://api.github.com/users/harrysummer/gists{/gist_id}", "starred_url": "https://api.github.com/users/harrysummer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harrysummer/subscriptions", "organizations_url": "https://api.github.com/users/harrysummer/orgs", "repos_url": "https://api.github.com/users/harrysummer/repos", "events_url": "https://api.github.com/users/harrysummer/events{/privacy}", "received_events_url": "https://api.github.com/users/harrysummer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 890282107, "node_id": "MDU6TGFiZWw4OTAyODIxMDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/caffe2", "name": "caffe2", "color": "210aa8", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-04-05T01:16:12Z", "updated_at": "2018-11-23T15:42:31Z", "closed_at": null, "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/6295", "html_url": "https://github.com/pytorch/pytorch/pull/6295", "diff_url": "https://github.com/pytorch/pytorch/pull/6295.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/6295.patch"}, "body_html": "<p>Originally, the <code>caffe_translator</code> creates additional blobs (such as convolution weight and bias) based on the output name of Caffe layers. This can be incorrect when in Caffe1, several layers shares the same output name. e.g. a snippet in Caffe prototxt can look like:</p>\n<pre lang=\"prototxt\"><code>layer {\n  name: \"conv1\"\n  type: \"Convolution\"\n  bottom: \"data\"\n  top: \"conv1\"\n  param {\n    lr_mult: 1\n    decay_mult: 1\n  }\n  convolution_param {\n    num_output: 32\n    bias_term: false\n    pad: 1\n    kernel_size: 3\n    stride: 2\n    weight_filler {\n      type: \"msra\"\n    }\n  }\n}\nlayer {\n  name: \"conv1/bn\"\n  type: \"BatchNorm\"\n  bottom: \"conv1\"\n  top: \"conv1\"\n  param {\n    lr_mult: 0\n    decay_mult: 0\n  }\n  param {\n    lr_mult: 0\n    decay_mult: 0\n  }\n  param {\n    lr_mult: 0\n    decay_mult: 0\n  }\n}\nlayer {\n  name: \"conv1/scale\"\n  type: \"Scale\"\n  bottom: \"conv1\"\n  top: \"conv1\"\n  scale_param {\n    filler {\n      value: 1\n    }\n    bias_term: true\n    bias_filler {\n      value: 0\n    }\n  }\n}\n</code></pre>\n<p>where <code>conv1</code>, <code>conv1/bn</code> and <code>conv1/scale</code> shares the same output blob. When converting to Caffe2, both <code>conv1</code> and <code>conv1/scale</code> would generate an additional input named <code>conv1_w</code>, based on the output blob name. This would cause problem in Caffe2, since in Caffe2, different <code>external_input</code> should have different names.</p>\n<p>The pull request changes the behavior of creating caffe2 operators for external inputs, to make them naming based on the Caffe1 layer name. This would make the <code>external_input</code> in Caffe2 unambiguous.</p>", "body_text": "Originally, the caffe_translator creates additional blobs (such as convolution weight and bias) based on the output name of Caffe layers. This can be incorrect when in Caffe1, several layers shares the same output name. e.g. a snippet in Caffe prototxt can look like:\nlayer {\n  name: \"conv1\"\n  type: \"Convolution\"\n  bottom: \"data\"\n  top: \"conv1\"\n  param {\n    lr_mult: 1\n    decay_mult: 1\n  }\n  convolution_param {\n    num_output: 32\n    bias_term: false\n    pad: 1\n    kernel_size: 3\n    stride: 2\n    weight_filler {\n      type: \"msra\"\n    }\n  }\n}\nlayer {\n  name: \"conv1/bn\"\n  type: \"BatchNorm\"\n  bottom: \"conv1\"\n  top: \"conv1\"\n  param {\n    lr_mult: 0\n    decay_mult: 0\n  }\n  param {\n    lr_mult: 0\n    decay_mult: 0\n  }\n  param {\n    lr_mult: 0\n    decay_mult: 0\n  }\n}\nlayer {\n  name: \"conv1/scale\"\n  type: \"Scale\"\n  bottom: \"conv1\"\n  top: \"conv1\"\n  scale_param {\n    filler {\n      value: 1\n    }\n    bias_term: true\n    bias_filler {\n      value: 0\n    }\n  }\n}\n\nwhere conv1, conv1/bn and conv1/scale shares the same output blob. When converting to Caffe2, both conv1 and conv1/scale would generate an additional input named conv1_w, based on the output blob name. This would cause problem in Caffe2, since in Caffe2, different external_input should have different names.\nThe pull request changes the behavior of creating caffe2 operators for external inputs, to make them naming based on the Caffe1 layer name. This would make the external_input in Caffe2 unambiguous.", "body": "Originally, the `caffe_translator` creates additional blobs (such as convolution weight and bias) based on the output name of Caffe layers. This can be incorrect when in Caffe1, several layers shares the same output name. e.g. a snippet in Caffe prototxt can look like:\r\n```prototxt\r\nlayer {\r\n  name: \"conv1\"\r\n  type: \"Convolution\"\r\n  bottom: \"data\"\r\n  top: \"conv1\"\r\n  param {\r\n    lr_mult: 1\r\n    decay_mult: 1\r\n  }\r\n  convolution_param {\r\n    num_output: 32\r\n    bias_term: false\r\n    pad: 1\r\n    kernel_size: 3\r\n    stride: 2\r\n    weight_filler {\r\n      type: \"msra\"\r\n    }\r\n  }\r\n}\r\nlayer {\r\n  name: \"conv1/bn\"\r\n  type: \"BatchNorm\"\r\n  bottom: \"conv1\"\r\n  top: \"conv1\"\r\n  param {\r\n    lr_mult: 0\r\n    decay_mult: 0\r\n  }\r\n  param {\r\n    lr_mult: 0\r\n    decay_mult: 0\r\n  }\r\n  param {\r\n    lr_mult: 0\r\n    decay_mult: 0\r\n  }\r\n}\r\nlayer {\r\n  name: \"conv1/scale\"\r\n  type: \"Scale\"\r\n  bottom: \"conv1\"\r\n  top: \"conv1\"\r\n  scale_param {\r\n    filler {\r\n      value: 1\r\n    }\r\n    bias_term: true\r\n    bias_filler {\r\n      value: 0\r\n    }\r\n  }\r\n}\r\n```\r\nwhere `conv1`, `conv1/bn` and `conv1/scale` shares the same output blob. When converting to Caffe2, both `conv1` and `conv1/scale` would generate an additional input named `conv1_w`, based on the output blob name. This would cause problem in Caffe2, since in Caffe2, different `external_input` should have different names.\r\n\r\nThe pull request changes the behavior of creating caffe2 operators for external inputs, to make them naming based on the Caffe1 layer name. This would make the `external_input` in Caffe2 unambiguous."}