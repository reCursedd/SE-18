{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/127594497", "pull_request_review_id": 50198913, "id": 127594497, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyNzU5NDQ5Nw==", "diff_hunk": "@@ -113,9 +110,10 @@ def remove_weight_norm(module, name='weight'):\n         >>> m = weight_norm(nn.Linear(20, 40))\n         >>> remove_weight_norm(m)\n     \"\"\"\n-    for hook in module._forward_pre_hooks.values():\n+    for k, hook in module._forward_pre_hooks.items():\n         if isinstance(hook, WeightNorm) and hook.name == name:\n             hook.remove(module)\n+            del module._forward_pre_hooks[k]", "path": "torch/nn/utils/weight_norm.py", "position": 27, "original_position": 27, "commit_id": "909e9cbd847ff462569e12f7df205fbb963a9ecf", "original_commit_id": "909e9cbd847ff462569e12f7df205fbb963a9ecf", "user": {"login": "colesbury", "id": 655866, "node_id": "MDQ6VXNlcjY1NTg2Ng==", "avatar_url": "https://avatars1.githubusercontent.com/u/655866?v=4", "gravatar_id": "", "url": "https://api.github.com/users/colesbury", "html_url": "https://github.com/colesbury", "followers_url": "https://api.github.com/users/colesbury/followers", "following_url": "https://api.github.com/users/colesbury/following{/other_user}", "gists_url": "https://api.github.com/users/colesbury/gists{/gist_id}", "starred_url": "https://api.github.com/users/colesbury/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/colesbury/subscriptions", "organizations_url": "https://api.github.com/users/colesbury/orgs", "repos_url": "https://api.github.com/users/colesbury/repos", "events_url": "https://api.github.com/users/colesbury/events{/privacy}", "received_events_url": "https://api.github.com/users/colesbury/received_events", "type": "User", "site_admin": false}, "body": "No, not anymore. Previously, `weight_norm` held on to the handle, so remove could just call `handle.remove()`. However, this broke pickling in some earlier versions of 2.7, so `WeightNorm.remove()` just unapplies the transformation and the hook is deleted here.", "created_at": "2017-07-15T22:34:25Z", "updated_at": "2018-11-23T15:34:08Z", "html_url": "https://github.com/pytorch/pytorch/pull/2066#discussion_r127594497", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/2066", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/127594497"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/2066#discussion_r127594497"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/2066"}}, "body_html": "<p>No, not anymore. Previously, <code>weight_norm</code> held on to the handle, so remove could just call <code>handle.remove()</code>. However, this broke pickling in some earlier versions of 2.7, so <code>WeightNorm.remove()</code> just unapplies the transformation and the hook is deleted here.</p>", "body_text": "No, not anymore. Previously, weight_norm held on to the handle, so remove could just call handle.remove(). However, this broke pickling in some earlier versions of 2.7, so WeightNorm.remove() just unapplies the transformation and the hook is deleted here.", "in_reply_to_id": 127118370}