{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/164015774", "pull_request_review_id": 91726443, "id": 164015774, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2NDAxNTc3NA==", "diff_hunk": "@@ -344,22 +344,21 @@ def backward_extended(self, grad_output, grad_hy):\n \n def RNN(*args, **kwargs):\n \n+    # Hack for the tracer that allows us to represent RNNs as single\n+    # nodes and export them to ONNX in this form\n+    # Check the first argument explicitly to reduce the overhead of creating\n+    # the lambda\n+    import torch.onnx.symbolic\n+\n+    @torch.onnx.symbolic_override_first_arg_based(\n+        torch.onnx.symbolic.RNN_symbolic_builder(*args, **kwargs)", "path": "torch/nn/_functions/rnn.py", "position": null, "original_position": 11, "commit_id": "2ab80513f174528b1ebad95bae38ebf3f9172666", "original_commit_id": "d6f719d9afb95f90052608022a3ad7002ab0748e", "user": {"login": "dzhulgakov", "id": 17890620, "node_id": "MDQ6VXNlcjE3ODkwNjIw", "avatar_url": "https://avatars2.githubusercontent.com/u/17890620?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dzhulgakov", "html_url": "https://github.com/dzhulgakov", "followers_url": "https://api.github.com/users/dzhulgakov/followers", "following_url": "https://api.github.com/users/dzhulgakov/following{/other_user}", "gists_url": "https://api.github.com/users/dzhulgakov/gists{/gist_id}", "starred_url": "https://api.github.com/users/dzhulgakov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dzhulgakov/subscriptions", "organizations_url": "https://api.github.com/users/dzhulgakov/orgs", "repos_url": "https://api.github.com/users/dzhulgakov/repos", "events_url": "https://api.github.com/users/dzhulgakov/events{/privacy}", "received_events_url": "https://api.github.com/users/dzhulgakov/received_events", "type": "User", "site_admin": false}, "body": "ok, you're right. I assumed RNN() is invoked only once during model construction (which would make more sense) but apparently we reconstruct it on each forward(): https://github.com/pytorch/pytorch/blob/27d7182d6c7e223e04166f33d5ec46ef8b510944/torch/nn/modules/rnn.py#L191 (btw, why?)", "created_at": "2018-01-26T01:29:06Z", "updated_at": "2018-11-23T15:38:36Z", "html_url": "https://github.com/pytorch/pytorch/pull/4799#discussion_r164015774", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/4799", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/164015774"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/4799#discussion_r164015774"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/4799"}}, "body_html": "<p>ok, you're right. I assumed RNN() is invoked only once during model construction (which would make more sense) but apparently we reconstruct it on each forward(): <div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/pytorch/pytorch/blob/27d7182d6c7e223e04166f33d5ec46ef8b510944/torch/nn/modules/rnn.py#L191\">pytorch/torch/nn/modules/rnn.py</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n         Line 191\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/pytorch/pytorch/commit/27d7182d6c7e223e04166f33d5ec46ef8b510944\">27d7182</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L191\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"191\"></td>\n          <td id=\"LC191\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> func <span class=\"pl-k\">=</span> <span class=\"pl-c1\">self</span>._backend.RNN( </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n (btw, why?)</p>", "body_text": "ok, you're right. I assumed RNN() is invoked only once during model construction (which would make more sense) but apparently we reconstruct it on each forward(): \n  \n    \n      pytorch/torch/nn/modules/rnn.py\n    \n    \n         Line 191\n      in\n      27d7182\n    \n    \n    \n    \n\n        \n          \n           func = self._backend.RNN( \n        \n    \n  \n\n (btw, why?)", "in_reply_to_id": 163184482}