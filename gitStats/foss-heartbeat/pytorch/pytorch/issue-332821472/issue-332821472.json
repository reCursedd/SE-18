{"url": "https://api.github.com/repos/pytorch/pytorch/issues/8556", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/8556/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/8556/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/8556/events", "html_url": "https://github.com/pytorch/pytorch/issues/8556", "id": 332821472, "node_id": "MDU6SXNzdWUzMzI4MjE0NzI=", "number": 8556, "title": "[JIT] Interleaved C++-Python execution loses inner Python stacks", "user": {"login": "ezyang", "id": 13564, "node_id": "MDQ6VXNlcjEzNTY0", "avatar_url": "https://avatars0.githubusercontent.com/u/13564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ezyang", "html_url": "https://github.com/ezyang", "followers_url": "https://api.github.com/users/ezyang/followers", "following_url": "https://api.github.com/users/ezyang/following{/other_user}", "gists_url": "https://api.github.com/users/ezyang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ezyang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ezyang/subscriptions", "organizations_url": "https://api.github.com/users/ezyang/orgs", "repos_url": "https://api.github.com/users/ezyang/repos", "events_url": "https://api.github.com/users/ezyang/events{/privacy}", "received_events_url": "https://api.github.com/users/ezyang/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 679953983, "node_id": "MDU6TGFiZWw2Nzk5NTM5ODM=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/jit", "name": "jit", "color": "c5def5", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-06-15T15:35:11Z", "updated_at": "2018-06-15T15:35:11Z", "closed_at": null, "author_association": "CONTRIBUTOR", "body_html": "<p>I triggered a recent shape propagation test failure:</p>\n<pre><code>14:56:59 ======================================================================\n14:56:59 ERROR: test_pow_scalar_constant (__main__.TestJitGenerated)\n14:56:59 ----------------------------------------------------------------------\n14:56:59 Traceback (most recent call last):\n14:56:59   File \"test_jit.py\", line 3940, in do_test\n14:56:59     check(name)\n14:56:59   File \"test_jit.py\", line 3921, in check\n14:56:59     fn, (self_variable,) + args_variable)\n14:56:59   File \"test_jit.py\", line 3831, in check_against_reference\n14:56:59     outputs_test = func(*nograd_inputs)\n14:56:59   File \"test_jit.py\", line 3807, in script_fn\n14:56:59     return output_process_fn(CU.the_method(*tensors))\n14:56:59 RuntimeError: \n14:56:59 Expected object of type CPUDoubleType but found type CPUFloatType for argument #2 'exponent' (checked_cast_tensor at /var/lib/jenkins/workspace/aten/src/ATen/Utils.h:32)\n14:56:59 frame #0: at::CPUDoubleType::s_pow(at::Tensor const&amp;, at::Tensor const&amp;) const + 0x6b (0x7fb4526c795b in /opt/python/2.7/lib/python2.7/site-packages/torch/lib/libcaffe2.so)\n14:56:59 frame #1: at::Type::pow(at::Tensor const&amp;, at::Tensor const&amp;) const + 0x161 (0x7fb4527d2931 in /opt/python/2.7/lib/python2.7/site-packages/torch/lib/libcaffe2.so)\n14:56:59 frame #2: &lt;unknown function&gt; + 0x497796 (0x7fb453c52796 in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\n14:56:59 frame #3: &lt;unknown function&gt; + 0x33735e (0x7fb453af235e in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\n14:56:59 frame #4: &lt;unknown function&gt; + 0x337ccf (0x7fb453af2ccf in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\n14:56:59 frame #5: &lt;unknown function&gt; + 0x339a6b (0x7fb453af4a6b in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\n14:56:59 frame #6: torch::jit::PropagateInputShapes(torch::jit::Graph&amp;, torch::jit::ArgumentSpec const&amp;) + 0x3b9 (0x7fb453af4f39 in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\n14:56:59 frame #7: torch::jit::GraphExecutorImpl::run(torch::jit::variable_tensor_list) + 0xd5c (0x7fb453aa0e3c in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\n14:56:59 frame #8: torch::jit::GraphExecutor::run(torch::jit::variable_tensor_list&amp;&amp;) + 0x47 (0x7fb453a9aa97 in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\n14:56:59 frame #9: &lt;unknown function&gt; + 0x54f249 (0x7fb453d0a249 in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\n14:56:59 frame #10: &lt;unknown function&gt; + 0x22db98 (0x7fb4539e8b98 in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\n14:56:59 frame #11: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #12: &lt;unknown function&gt; + 0x63095 (0x7fb4641ba095 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #13: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #14: &lt;unknown function&gt; + 0xc2a45 (0x7fb464219a45 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #15: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #16: PyEval_EvalFrameEx + 0x3077 (0x7fb464260f77 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #17: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #18: &lt;unknown function&gt; + 0x867e0 (0x7fb4641dd7e0 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #19: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #20: PyEval_EvalFrameEx + 0x3077 (0x7fb464260f77 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #21: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #22: PyEval_EvalFrameEx + 0x7ed2 (0x7fb464265dd2 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #23: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #24: PyEval_EvalFrameEx + 0x7ed2 (0x7fb464265dd2 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #25: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #26: PyEval_EvalFrameEx + 0x7ed2 (0x7fb464265dd2 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #27: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #28: &lt;unknown function&gt; + 0x868b5 (0x7fb4641dd8b5 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #29: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #30: PyEval_EvalFrameEx + 0x3077 (0x7fb464260f77 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #31: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #32: &lt;unknown function&gt; + 0x867e0 (0x7fb4641dd7e0 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #33: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #34: &lt;unknown function&gt; + 0x63095 (0x7fb4641ba095 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #35: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #36: &lt;unknown function&gt; + 0xc2a45 (0x7fb464219a45 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #37: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #38: PyEval_EvalFrameEx + 0x3b78 (0x7fb464261a78 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #39: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #40: &lt;unknown function&gt; + 0x868b5 (0x7fb4641dd8b5 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #41: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #42: PyEval_EvalFrameEx + 0x3077 (0x7fb464260f77 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #43: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #44: &lt;unknown function&gt; + 0x867e0 (0x7fb4641dd7e0 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #45: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #46: &lt;unknown function&gt; + 0x63095 (0x7fb4641ba095 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #47: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #48: &lt;unknown function&gt; + 0xc2a45 (0x7fb464219a45 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #49: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #50: PyEval_EvalFrameEx + 0x3b78 (0x7fb464261a78 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #51: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #52: &lt;unknown function&gt; + 0x868b5 (0x7fb4641dd8b5 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #53: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #54: PyEval_EvalFrameEx + 0x3077 (0x7fb464260f77 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #55: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #56: &lt;unknown function&gt; + 0x867e0 (0x7fb4641dd7e0 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #57: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #58: &lt;unknown function&gt; + 0x63095 (0x7fb4641ba095 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #59: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #60: &lt;unknown function&gt; + 0xc2a45 (0x7fb464219a45 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #61: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #62: PyEval_EvalFrameEx + 0x3b78 (0x7fb464261a78 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #63: PyEval_EvalFrameEx + 0x7f86 (0x7fb464265e86 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 :\n14:56:59 operation failed shape propagation:\n14:56:59 \n14:56:59 def the_method(i0):\n14:56:59     return i0.pow(3.14)\n14:56:59            ~~~~~~ &lt;--- HERE\n14:56:59 \n</code></pre>\n<p>You can see in the C++ backtrace that we go back into Python when shape propagation occurs. We should be able to extract a useful Python trace when this occurs; however, it seems to be lost.</p>", "body_text": "I triggered a recent shape propagation test failure:\n14:56:59 ======================================================================\n14:56:59 ERROR: test_pow_scalar_constant (__main__.TestJitGenerated)\n14:56:59 ----------------------------------------------------------------------\n14:56:59 Traceback (most recent call last):\n14:56:59   File \"test_jit.py\", line 3940, in do_test\n14:56:59     check(name)\n14:56:59   File \"test_jit.py\", line 3921, in check\n14:56:59     fn, (self_variable,) + args_variable)\n14:56:59   File \"test_jit.py\", line 3831, in check_against_reference\n14:56:59     outputs_test = func(*nograd_inputs)\n14:56:59   File \"test_jit.py\", line 3807, in script_fn\n14:56:59     return output_process_fn(CU.the_method(*tensors))\n14:56:59 RuntimeError: \n14:56:59 Expected object of type CPUDoubleType but found type CPUFloatType for argument #2 'exponent' (checked_cast_tensor at /var/lib/jenkins/workspace/aten/src/ATen/Utils.h:32)\n14:56:59 frame #0: at::CPUDoubleType::s_pow(at::Tensor const&, at::Tensor const&) const + 0x6b (0x7fb4526c795b in /opt/python/2.7/lib/python2.7/site-packages/torch/lib/libcaffe2.so)\n14:56:59 frame #1: at::Type::pow(at::Tensor const&, at::Tensor const&) const + 0x161 (0x7fb4527d2931 in /opt/python/2.7/lib/python2.7/site-packages/torch/lib/libcaffe2.so)\n14:56:59 frame #2: <unknown function> + 0x497796 (0x7fb453c52796 in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\n14:56:59 frame #3: <unknown function> + 0x33735e (0x7fb453af235e in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\n14:56:59 frame #4: <unknown function> + 0x337ccf (0x7fb453af2ccf in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\n14:56:59 frame #5: <unknown function> + 0x339a6b (0x7fb453af4a6b in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\n14:56:59 frame #6: torch::jit::PropagateInputShapes(torch::jit::Graph&, torch::jit::ArgumentSpec const&) + 0x3b9 (0x7fb453af4f39 in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\n14:56:59 frame #7: torch::jit::GraphExecutorImpl::run(torch::jit::variable_tensor_list) + 0xd5c (0x7fb453aa0e3c in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\n14:56:59 frame #8: torch::jit::GraphExecutor::run(torch::jit::variable_tensor_list&&) + 0x47 (0x7fb453a9aa97 in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\n14:56:59 frame #9: <unknown function> + 0x54f249 (0x7fb453d0a249 in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\n14:56:59 frame #10: <unknown function> + 0x22db98 (0x7fb4539e8b98 in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\n14:56:59 frame #11: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #12: <unknown function> + 0x63095 (0x7fb4641ba095 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #13: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #14: <unknown function> + 0xc2a45 (0x7fb464219a45 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #15: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #16: PyEval_EvalFrameEx + 0x3077 (0x7fb464260f77 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #17: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #18: <unknown function> + 0x867e0 (0x7fb4641dd7e0 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #19: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #20: PyEval_EvalFrameEx + 0x3077 (0x7fb464260f77 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #21: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #22: PyEval_EvalFrameEx + 0x7ed2 (0x7fb464265dd2 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #23: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #24: PyEval_EvalFrameEx + 0x7ed2 (0x7fb464265dd2 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #25: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #26: PyEval_EvalFrameEx + 0x7ed2 (0x7fb464265dd2 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #27: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #28: <unknown function> + 0x868b5 (0x7fb4641dd8b5 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #29: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #30: PyEval_EvalFrameEx + 0x3077 (0x7fb464260f77 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #31: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #32: <unknown function> + 0x867e0 (0x7fb4641dd7e0 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #33: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #34: <unknown function> + 0x63095 (0x7fb4641ba095 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #35: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #36: <unknown function> + 0xc2a45 (0x7fb464219a45 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #37: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #38: PyEval_EvalFrameEx + 0x3b78 (0x7fb464261a78 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #39: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #40: <unknown function> + 0x868b5 (0x7fb4641dd8b5 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #41: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #42: PyEval_EvalFrameEx + 0x3077 (0x7fb464260f77 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #43: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #44: <unknown function> + 0x867e0 (0x7fb4641dd7e0 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #45: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #46: <unknown function> + 0x63095 (0x7fb4641ba095 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #47: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #48: <unknown function> + 0xc2a45 (0x7fb464219a45 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #49: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #50: PyEval_EvalFrameEx + 0x3b78 (0x7fb464261a78 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #51: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #52: <unknown function> + 0x868b5 (0x7fb4641dd8b5 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #53: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #54: PyEval_EvalFrameEx + 0x3077 (0x7fb464260f77 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #55: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #56: <unknown function> + 0x867e0 (0x7fb4641dd7e0 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #57: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #58: <unknown function> + 0x63095 (0x7fb4641ba095 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #59: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #60: <unknown function> + 0xc2a45 (0x7fb464219a45 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #61: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #62: PyEval_EvalFrameEx + 0x3b78 (0x7fb464261a78 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 frame #63: PyEval_EvalFrameEx + 0x7f86 (0x7fb464265e86 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\n14:56:59 :\n14:56:59 operation failed shape propagation:\n14:56:59 \n14:56:59 def the_method(i0):\n14:56:59     return i0.pow(3.14)\n14:56:59            ~~~~~~ <--- HERE\n14:56:59 \n\nYou can see in the C++ backtrace that we go back into Python when shape propagation occurs. We should be able to extract a useful Python trace when this occurs; however, it seems to be lost.", "body": "I triggered a recent shape propagation test failure:\r\n\r\n```\r\n14:56:59 ======================================================================\r\n14:56:59 ERROR: test_pow_scalar_constant (__main__.TestJitGenerated)\r\n14:56:59 ----------------------------------------------------------------------\r\n14:56:59 Traceback (most recent call last):\r\n14:56:59   File \"test_jit.py\", line 3940, in do_test\r\n14:56:59     check(name)\r\n14:56:59   File \"test_jit.py\", line 3921, in check\r\n14:56:59     fn, (self_variable,) + args_variable)\r\n14:56:59   File \"test_jit.py\", line 3831, in check_against_reference\r\n14:56:59     outputs_test = func(*nograd_inputs)\r\n14:56:59   File \"test_jit.py\", line 3807, in script_fn\r\n14:56:59     return output_process_fn(CU.the_method(*tensors))\r\n14:56:59 RuntimeError: \r\n14:56:59 Expected object of type CPUDoubleType but found type CPUFloatType for argument #2 'exponent' (checked_cast_tensor at /var/lib/jenkins/workspace/aten/src/ATen/Utils.h:32)\r\n14:56:59 frame #0: at::CPUDoubleType::s_pow(at::Tensor const&, at::Tensor const&) const + 0x6b (0x7fb4526c795b in /opt/python/2.7/lib/python2.7/site-packages/torch/lib/libcaffe2.so)\r\n14:56:59 frame #1: at::Type::pow(at::Tensor const&, at::Tensor const&) const + 0x161 (0x7fb4527d2931 in /opt/python/2.7/lib/python2.7/site-packages/torch/lib/libcaffe2.so)\r\n14:56:59 frame #2: <unknown function> + 0x497796 (0x7fb453c52796 in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\r\n14:56:59 frame #3: <unknown function> + 0x33735e (0x7fb453af235e in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\r\n14:56:59 frame #4: <unknown function> + 0x337ccf (0x7fb453af2ccf in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\r\n14:56:59 frame #5: <unknown function> + 0x339a6b (0x7fb453af4a6b in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\r\n14:56:59 frame #6: torch::jit::PropagateInputShapes(torch::jit::Graph&, torch::jit::ArgumentSpec const&) + 0x3b9 (0x7fb453af4f39 in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\r\n14:56:59 frame #7: torch::jit::GraphExecutorImpl::run(torch::jit::variable_tensor_list) + 0xd5c (0x7fb453aa0e3c in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\r\n14:56:59 frame #8: torch::jit::GraphExecutor::run(torch::jit::variable_tensor_list&&) + 0x47 (0x7fb453a9aa97 in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\r\n14:56:59 frame #9: <unknown function> + 0x54f249 (0x7fb453d0a249 in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\r\n14:56:59 frame #10: <unknown function> + 0x22db98 (0x7fb4539e8b98 in /opt/python/2.7/lib/python2.7/site-packages/torch/_C.so)\r\n14:56:59 frame #11: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #12: <unknown function> + 0x63095 (0x7fb4641ba095 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #13: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #14: <unknown function> + 0xc2a45 (0x7fb464219a45 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #15: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #16: PyEval_EvalFrameEx + 0x3077 (0x7fb464260f77 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #17: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #18: <unknown function> + 0x867e0 (0x7fb4641dd7e0 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #19: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #20: PyEval_EvalFrameEx + 0x3077 (0x7fb464260f77 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #21: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #22: PyEval_EvalFrameEx + 0x7ed2 (0x7fb464265dd2 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #23: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #24: PyEval_EvalFrameEx + 0x7ed2 (0x7fb464265dd2 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #25: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #26: PyEval_EvalFrameEx + 0x7ed2 (0x7fb464265dd2 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #27: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #28: <unknown function> + 0x868b5 (0x7fb4641dd8b5 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #29: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #30: PyEval_EvalFrameEx + 0x3077 (0x7fb464260f77 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #31: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #32: <unknown function> + 0x867e0 (0x7fb4641dd7e0 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #33: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #34: <unknown function> + 0x63095 (0x7fb4641ba095 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #35: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #36: <unknown function> + 0xc2a45 (0x7fb464219a45 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #37: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #38: PyEval_EvalFrameEx + 0x3b78 (0x7fb464261a78 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #39: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #40: <unknown function> + 0x868b5 (0x7fb4641dd8b5 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #41: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #42: PyEval_EvalFrameEx + 0x3077 (0x7fb464260f77 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #43: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #44: <unknown function> + 0x867e0 (0x7fb4641dd7e0 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #45: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #46: <unknown function> + 0x63095 (0x7fb4641ba095 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #47: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #48: <unknown function> + 0xc2a45 (0x7fb464219a45 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #49: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #50: PyEval_EvalFrameEx + 0x3b78 (0x7fb464261a78 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #51: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #52: <unknown function> + 0x868b5 (0x7fb4641dd8b5 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #53: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #54: PyEval_EvalFrameEx + 0x3077 (0x7fb464260f77 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #55: PyEval_EvalCodeEx + 0x80d (0x7fb4642676fd in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #56: <unknown function> + 0x867e0 (0x7fb4641dd7e0 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #57: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #58: <unknown function> + 0x63095 (0x7fb4641ba095 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #59: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #60: <unknown function> + 0xc2a45 (0x7fb464219a45 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #61: PyObject_Call + 0x43 (0x7fb4641ab373 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #62: PyEval_EvalFrameEx + 0x3b78 (0x7fb464261a78 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 frame #63: PyEval_EvalFrameEx + 0x7f86 (0x7fb464265e86 in /opt/python/2.7.15/lib/libpython2.7.so.1.0)\r\n14:56:59 :\r\n14:56:59 operation failed shape propagation:\r\n14:56:59 \r\n14:56:59 def the_method(i0):\r\n14:56:59     return i0.pow(3.14)\r\n14:56:59            ~~~~~~ <--- HERE\r\n14:56:59 \r\n```\r\n\r\nYou can see in the C++ backtrace that we go back into Python when shape propagation occurs. We should be able to extract a useful Python trace when this occurs; however, it seems to be lost."}