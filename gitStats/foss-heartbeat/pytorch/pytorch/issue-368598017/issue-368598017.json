{"url": "https://api.github.com/repos/pytorch/pytorch/issues/12528", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/12528/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/12528/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/12528/events", "html_url": "https://github.com/pytorch/pytorch/issues/12528", "id": 368598017, "node_id": "MDU6SXNzdWUzNjg1OTgwMTc=", "number": 12528, "title": "Unexpected key(s) in state_dict:", "user": {"login": "Xuxudong166", "id": 33542796, "node_id": "MDQ6VXNlcjMzNTQyNzk2", "avatar_url": "https://avatars2.githubusercontent.com/u/33542796?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Xuxudong166", "html_url": "https://github.com/Xuxudong166", "followers_url": "https://api.github.com/users/Xuxudong166/followers", "following_url": "https://api.github.com/users/Xuxudong166/following{/other_user}", "gists_url": "https://api.github.com/users/Xuxudong166/gists{/gist_id}", "starred_url": "https://api.github.com/users/Xuxudong166/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Xuxudong166/subscriptions", "organizations_url": "https://api.github.com/users/Xuxudong166/orgs", "repos_url": "https://api.github.com/users/Xuxudong166/repos", "events_url": "https://api.github.com/users/Xuxudong166/events{/privacy}", "received_events_url": "https://api.github.com/users/Xuxudong166/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 545367190, "node_id": "MDU6TGFiZWw1NDUzNjcxOTA=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/awaiting%20response", "name": "awaiting response", "color": "5319e7", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-10-10T10:26:00Z", "updated_at": "2018-10-23T16:29:07Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>I am getting this error when I am loading the weights for a model I trained on a GPU. I am trying to load the model on a CPU. Not sure what this error means. I did check the checkpoint[\u2018state_dict\u2019] keys and it does contain this \u2018num_batches_tracked\u2019 key for all the batch normalization layers. I am using the same model on the CPU as I trained on the GPU. I am training a UNet model.</p>\n<p>checkpoint = torch.load(\u2018model_best.pth-zeromask-notconsider.tar\u2019,map_location=lambda storage, loc: storage)<br>\ntrain_conv.model.load_state_dict(checkpoint[\u2018state_dict\u2019])</p>\n<p>RuntimeError Traceback (most recent call last)<br>\nin ()<br>\n----&gt; 1 train_conv.model.load_state_dict(checkpoint[\u2018state_dict\u2019])</p>\n<p>~\\AppData\\Local\\conda\\conda\\envs\\myfastai1\\lib\\site-packages\\torch\\nn\\modules\\module.py in load_state_dict(self, state_dict, strict)<br>\n719 if len(error_msgs) &gt; 0:<br>\n720 raise RuntimeError(\u2018Error(s) in loading state_dict for {}:\\n\\t{}\u2019.format(<br>\n\u2013&gt; 721 self.class.name, \u201c\\n\\t\u201d.join(error_msgs)))<br>\n722<br>\n723 def parameters(self):</p>\n<p>RuntimeError: Error(s) in loading state_dict for Unet34:<br>\nUnexpected key(s) in state_dict: \u201crn.1.num_batches_tracked\u201d, \u201crn.4.0.bn1.num_batches_tracked\u201d, \u201crn.4.0.bn2.num_batches_tracked\u201d, \u201crn.4.1.bn1.num_batches_tracked\u201d, \u201crn.4.1.bn2.num_batches_tracked\u201d, \u201crn.4.2.bn1.num_batches_tracked\u201d, \u201crn.4.2.bn2.num_batches_tracked\u201d, \u201crn.5.0.bn1.num_batches_tracked\u201d, \u201crn.5.0.bn2.num_batches_tracked\u201d, \u201crn.5.0.downsample.1.num_batches_tracked\u201d, \u201crn.5.1.bn1.num_batches_tracked\u201d, \u201crn.5.1.bn2.num_batches_tracked\u201d, \u201crn.5.2.bn1.num_batches_tracked\u201d, \u201crn.5.2.bn2.num_batches_tracked\u201d, \u201crn.5.3.bn1.num_batches_tracked\u201d, \u201crn.5.3.bn2.num_batches_tracked\u201d, \u201crn.6.0.bn1.num_batches_tracked\u201d, \u201crn.6.0.bn2.num_batches_tracked\u201d, \u201crn.6.0.downsample.1.num_batches_tracked\u201d, \u201crn.6.1.bn1.num_batches_tracked\u201d, \u201crn.6.1.bn2.num_batches_tracked\u201d, \u201crn.6.2.bn1.num_batches_tracked\u201d, \u201crn.6.2.bn2.num_batches_tracked\u201d, \u201crn.6.3.bn1.num_batches_tracked\u201d, \u201crn.6.3.bn2.num_batches_tracked\u201d, \u201crn.6.4.bn1.num_batches_tracked\u201d, \u201crn.6.4.bn2.num_batches_tracked\u201d, \u201crn.6.5.bn1.num_batches_tracked\u201d, \u201crn.6.5.bn2.num_batches_tracked\u201d, \u201crn.7.0.bn1.num_batches_tracked\u201d, \u201crn.7.0.bn2.num_batches_tracked\u201d, \u201crn.7.0.downsample.1.num_batches_tracked\u201d, \u201crn.7.1.bn1.num_batches_tracked\u201d, \u201crn.7.1.bn2.num_batches_tracked\u201d, \u201crn.7.2.bn1.num_batches_tracked\u201d, \u201crn.7.2.bn2.num_batches_tracked\u201d, \u201cup1.bn.num_batches_tracked\u201d, \u201cup2.bn.num_batches_tracked\u201d, \u201cup3.bn.num_batches_tracked\u201d, \u201cup4.bn.num_batches_tracked\u201d.</p>\n<p>My torchvision and model is 0.4.1.</p>", "body_text": "I am getting this error when I am loading the weights for a model I trained on a GPU. I am trying to load the model on a CPU. Not sure what this error means. I did check the checkpoint[\u2018state_dict\u2019] keys and it does contain this \u2018num_batches_tracked\u2019 key for all the batch normalization layers. I am using the same model on the CPU as I trained on the GPU. I am training a UNet model.\ncheckpoint = torch.load(\u2018model_best.pth-zeromask-notconsider.tar\u2019,map_location=lambda storage, loc: storage)\ntrain_conv.model.load_state_dict(checkpoint[\u2018state_dict\u2019])\nRuntimeError Traceback (most recent call last)\nin ()\n----> 1 train_conv.model.load_state_dict(checkpoint[\u2018state_dict\u2019])\n~\\AppData\\Local\\conda\\conda\\envs\\myfastai1\\lib\\site-packages\\torch\\nn\\modules\\module.py in load_state_dict(self, state_dict, strict)\n719 if len(error_msgs) > 0:\n720 raise RuntimeError(\u2018Error(s) in loading state_dict for {}:\\n\\t{}\u2019.format(\n\u2013> 721 self.class.name, \u201c\\n\\t\u201d.join(error_msgs)))\n722\n723 def parameters(self):\nRuntimeError: Error(s) in loading state_dict for Unet34:\nUnexpected key(s) in state_dict: \u201crn.1.num_batches_tracked\u201d, \u201crn.4.0.bn1.num_batches_tracked\u201d, \u201crn.4.0.bn2.num_batches_tracked\u201d, \u201crn.4.1.bn1.num_batches_tracked\u201d, \u201crn.4.1.bn2.num_batches_tracked\u201d, \u201crn.4.2.bn1.num_batches_tracked\u201d, \u201crn.4.2.bn2.num_batches_tracked\u201d, \u201crn.5.0.bn1.num_batches_tracked\u201d, \u201crn.5.0.bn2.num_batches_tracked\u201d, \u201crn.5.0.downsample.1.num_batches_tracked\u201d, \u201crn.5.1.bn1.num_batches_tracked\u201d, \u201crn.5.1.bn2.num_batches_tracked\u201d, \u201crn.5.2.bn1.num_batches_tracked\u201d, \u201crn.5.2.bn2.num_batches_tracked\u201d, \u201crn.5.3.bn1.num_batches_tracked\u201d, \u201crn.5.3.bn2.num_batches_tracked\u201d, \u201crn.6.0.bn1.num_batches_tracked\u201d, \u201crn.6.0.bn2.num_batches_tracked\u201d, \u201crn.6.0.downsample.1.num_batches_tracked\u201d, \u201crn.6.1.bn1.num_batches_tracked\u201d, \u201crn.6.1.bn2.num_batches_tracked\u201d, \u201crn.6.2.bn1.num_batches_tracked\u201d, \u201crn.6.2.bn2.num_batches_tracked\u201d, \u201crn.6.3.bn1.num_batches_tracked\u201d, \u201crn.6.3.bn2.num_batches_tracked\u201d, \u201crn.6.4.bn1.num_batches_tracked\u201d, \u201crn.6.4.bn2.num_batches_tracked\u201d, \u201crn.6.5.bn1.num_batches_tracked\u201d, \u201crn.6.5.bn2.num_batches_tracked\u201d, \u201crn.7.0.bn1.num_batches_tracked\u201d, \u201crn.7.0.bn2.num_batches_tracked\u201d, \u201crn.7.0.downsample.1.num_batches_tracked\u201d, \u201crn.7.1.bn1.num_batches_tracked\u201d, \u201crn.7.1.bn2.num_batches_tracked\u201d, \u201crn.7.2.bn1.num_batches_tracked\u201d, \u201crn.7.2.bn2.num_batches_tracked\u201d, \u201cup1.bn.num_batches_tracked\u201d, \u201cup2.bn.num_batches_tracked\u201d, \u201cup3.bn.num_batches_tracked\u201d, \u201cup4.bn.num_batches_tracked\u201d.\nMy torchvision and model is 0.4.1.", "body": "I am getting this error when I am loading the weights for a model I trained on a GPU. I am trying to load the model on a CPU. Not sure what this error means. I did check the checkpoint[\u2018state_dict\u2019] keys and it does contain this \u2018num_batches_tracked\u2019 key for all the batch normalization layers. I am using the same model on the CPU as I trained on the GPU. I am training a UNet model.\r\n\r\ncheckpoint = torch.load(\u2018model_best.pth-zeromask-notconsider.tar\u2019,map_location=lambda storage, loc: storage)\r\ntrain_conv.model.load_state_dict(checkpoint[\u2018state_dict\u2019])\r\n\r\nRuntimeError Traceback (most recent call last)\r\nin ()\r\n----> 1 train_conv.model.load_state_dict(checkpoint[\u2018state_dict\u2019])\r\n\r\n~\\AppData\\Local\\conda\\conda\\envs\\myfastai1\\lib\\site-packages\\torch\\nn\\modules\\module.py in load_state_dict(self, state_dict, strict)\r\n719 if len(error_msgs) > 0:\r\n720 raise RuntimeError(\u2018Error(s) in loading state_dict for {}:\\n\\t{}\u2019.format(\r\n\u2013> 721 self.class.name, \u201c\\n\\t\u201d.join(error_msgs)))\r\n722\r\n723 def parameters(self):\r\n\r\nRuntimeError: Error(s) in loading state_dict for Unet34:\r\nUnexpected key(s) in state_dict: \u201crn.1.num_batches_tracked\u201d, \u201crn.4.0.bn1.num_batches_tracked\u201d, \u201crn.4.0.bn2.num_batches_tracked\u201d, \u201crn.4.1.bn1.num_batches_tracked\u201d, \u201crn.4.1.bn2.num_batches_tracked\u201d, \u201crn.4.2.bn1.num_batches_tracked\u201d, \u201crn.4.2.bn2.num_batches_tracked\u201d, \u201crn.5.0.bn1.num_batches_tracked\u201d, \u201crn.5.0.bn2.num_batches_tracked\u201d, \u201crn.5.0.downsample.1.num_batches_tracked\u201d, \u201crn.5.1.bn1.num_batches_tracked\u201d, \u201crn.5.1.bn2.num_batches_tracked\u201d, \u201crn.5.2.bn1.num_batches_tracked\u201d, \u201crn.5.2.bn2.num_batches_tracked\u201d, \u201crn.5.3.bn1.num_batches_tracked\u201d, \u201crn.5.3.bn2.num_batches_tracked\u201d, \u201crn.6.0.bn1.num_batches_tracked\u201d, \u201crn.6.0.bn2.num_batches_tracked\u201d, \u201crn.6.0.downsample.1.num_batches_tracked\u201d, \u201crn.6.1.bn1.num_batches_tracked\u201d, \u201crn.6.1.bn2.num_batches_tracked\u201d, \u201crn.6.2.bn1.num_batches_tracked\u201d, \u201crn.6.2.bn2.num_batches_tracked\u201d, \u201crn.6.3.bn1.num_batches_tracked\u201d, \u201crn.6.3.bn2.num_batches_tracked\u201d, \u201crn.6.4.bn1.num_batches_tracked\u201d, \u201crn.6.4.bn2.num_batches_tracked\u201d, \u201crn.6.5.bn1.num_batches_tracked\u201d, \u201crn.6.5.bn2.num_batches_tracked\u201d, \u201crn.7.0.bn1.num_batches_tracked\u201d, \u201crn.7.0.bn2.num_batches_tracked\u201d, \u201crn.7.0.downsample.1.num_batches_tracked\u201d, \u201crn.7.1.bn1.num_batches_tracked\u201d, \u201crn.7.1.bn2.num_batches_tracked\u201d, \u201crn.7.2.bn1.num_batches_tracked\u201d, \u201crn.7.2.bn2.num_batches_tracked\u201d, \u201cup1.bn.num_batches_tracked\u201d, \u201cup2.bn.num_batches_tracked\u201d, \u201cup3.bn.num_batches_tracked\u201d, \u201cup4.bn.num_batches_tracked\u201d.\r\n\r\nMy torchvision and model is 0.4.1."}