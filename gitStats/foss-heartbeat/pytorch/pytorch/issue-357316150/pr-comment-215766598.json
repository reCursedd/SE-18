{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/215766598", "pull_request_review_id": 153107062, "id": 215766598, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNTc2NjU5OA==", "diff_hunk": "@@ -7344,6 +7313,87 @@ def func(x):\n ])\n \n \n+def add_autograd_test(\n+    postfix,\n+    fn_creator,\n+    run_magic_methods,\n+    exclude_list,\n+    name,\n+    self_size,\n+    new_args,\n+    test_name,\n+    output_process_fn,\n+    skipTestIf,\n+    kwargs,\n+):\n+    def do_test(\n+        self,\n+        name=name,\n+        self_size=self_size,\n+        args=new_args,\n+        test_name=test_name,\n+        output_process_fn=output_process_fn,\n+    ):\n+        def check(name):\n+            is_magic_method = name[:2] == \"__\" and name[-2:] == \"__\"\n+            is_inplace = name[-1] == \"_\" and not is_magic_method\n+            self_variable = create_input((self_size,))[0][0]\n+            # FixMe: run grad checks on inplace self\n+            if is_inplace:\n+                self_variable.requires_grad = False\n+            # need to record this because methods can change the size (e.g. unsqueeze)\n+            args_variable, kwargs_variable = create_input(args, requires_grad=not is_inplace, call_kwargs=kwargs)\n+            self_tensor = deepcopy(self_variable.data)\n+            args_tensor = deepcopy(unpack_variables(args_variable))\n+            output_variable = getattr(self_variable, name)(*args_variable, **kwargs_variable)\n+\n+            def fn(*inputs, **kwargs):\n+                output = getattr(inputs[0], name)(*inputs[1:], **kwargs)\n+                return output_process_fn(output)\n+\n+            if not is_inplace and name not in EXCLUDE_GRADCHECK and not exclude_tensor_method(name, test_name):\n+                if run_magic_methods or not is_magic_method:\n+                    check_against_reference(", "path": "test/test_jit.py", "position": null, "original_position": 118, "commit_id": "813c1c804961582f8d837656f39b982010a7f905", "original_commit_id": "deef0d896fe4840bbbdc7e3c37ee764495316887", "user": {"login": "driazati", "id": 9407960, "node_id": "MDQ6VXNlcjk0MDc5NjA=", "avatar_url": "https://avatars3.githubusercontent.com/u/9407960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/driazati", "html_url": "https://github.com/driazati", "followers_url": "https://api.github.com/users/driazati/followers", "following_url": "https://api.github.com/users/driazati/following{/other_user}", "gists_url": "https://api.github.com/users/driazati/gists{/gist_id}", "starred_url": "https://api.github.com/users/driazati/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/driazati/subscriptions", "organizations_url": "https://api.github.com/users/driazati/orgs", "repos_url": "https://api.github.com/users/driazati/repos", "events_url": "https://api.github.com/users/driazati/events{/privacy}", "received_events_url": "https://api.github.com/users/driazati/received_events", "type": "User", "site_admin": false}, "body": "This is change a copy-paste of the existing `do_test` logic, with it only running either a test with the tracer or as a script, breaking the autograd tests into 2 jit tests (with `_script` or `_traced` after the test name).", "created_at": "2018-09-06T20:28:56Z", "updated_at": "2018-11-23T15:50:42Z", "html_url": "https://github.com/pytorch/pytorch/pull/11279#discussion_r215766598", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/11279", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/215766598"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/11279#discussion_r215766598"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/11279"}}, "body_html": "<p>This is change a copy-paste of the existing <code>do_test</code> logic, with it only running either a test with the tracer or as a script, breaking the autograd tests into 2 jit tests (with <code>_script</code> or <code>_traced</code> after the test name).</p>", "body_text": "This is change a copy-paste of the existing do_test logic, with it only running either a test with the tracer or as a script, breaking the autograd tests into 2 jit tests (with _script or _traced after the test name)."}