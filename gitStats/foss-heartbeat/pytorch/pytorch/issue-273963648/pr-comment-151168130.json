{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/151168130", "pull_request_review_id": 76824743, "id": 151168130, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1MTE2ODEzMA==", "diff_hunk": "@@ -473,18 +482,15 @@ struct StageClosure {\n \n     // Prepare a list of values / handles to capture\n     for (auto captured_node : xstate.cur_stage_captures[stage]) {\n-      if (captured_node->kind() == kSelect) {\n-        auto & fn = node_map.at(captured_node->input());\n-        if (captured_node->type()->kind() == TypeKind::TensorType) {\n-          captured_variables.emplace_back(fn.get(), captured_node->i(kOffset), captured_node->unique());\n-        } else {\n-          JIT_ASSERT(captured_node->type()->kind() == TypeKind::HandleType);\n-          captured_handles.emplace(fn.get(), captured_node->unique());\n-        }\n+      auto & fn = (input_placeholders.count(captured_node) > 0) ?\n+        input_placeholders.at(captured_node)\n+        : node_map.at(captured_node->node());\n+      size_t offset = captured_node->node()->kind() == kParam ? 0 : captured_node->offset();\n+      if (captured_node->type()->kind() == TypeKind::TensorType) {", "path": "torch/csrc/autograd/functions/jit_closure.cpp", "position": null, "original_position": 79, "commit_id": "c84859a8d33c6b8f5f25aa0fec424f04b293bfb8", "original_commit_id": "7901741bc1a19aade61c7692c2a8009f4e690ab6", "user": {"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}, "body": "it's a bit annoying that `captured_node` is a `Value` instead of a `Node`, but we should be removing this code anyway", "created_at": "2017-11-15T15:56:27Z", "updated_at": "2018-11-23T15:36:32Z", "html_url": "https://github.com/pytorch/pytorch/pull/3705#discussion_r151168130", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/3705", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/151168130"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/3705#discussion_r151168130"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/3705"}}, "body_html": "<p>it's a bit annoying that <code>captured_node</code> is a <code>Value</code> instead of a <code>Node</code>, but we should be removing this code anyway</p>", "body_text": "it's a bit annoying that captured_node is a Value instead of a Node, but we should be removing this code anyway"}