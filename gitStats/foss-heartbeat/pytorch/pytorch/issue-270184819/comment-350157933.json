{"url": "https://api.github.com/repos/pytorch/pytorch/issues/comments/350157933", "html_url": "https://github.com/pytorch/pytorch/issues/3415#issuecomment-350157933", "issue_url": "https://api.github.com/repos/pytorch/pytorch/issues/3415", "id": 350157933, "node_id": "MDEyOklzc3VlQ29tbWVudDM1MDE1NzkzMw==", "user": {"login": "Vandermode", "id": 12930996, "node_id": "MDQ6VXNlcjEyOTMwOTk2", "avatar_url": "https://avatars2.githubusercontent.com/u/12930996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Vandermode", "html_url": "https://github.com/Vandermode", "followers_url": "https://api.github.com/users/Vandermode/followers", "following_url": "https://api.github.com/users/Vandermode/following{/other_user}", "gists_url": "https://api.github.com/users/Vandermode/gists{/gist_id}", "starred_url": "https://api.github.com/users/Vandermode/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Vandermode/subscriptions", "organizations_url": "https://api.github.com/users/Vandermode/orgs", "repos_url": "https://api.github.com/users/Vandermode/repos", "events_url": "https://api.github.com/users/Vandermode/events{/privacy}", "received_events_url": "https://api.github.com/users/Vandermode/received_events", "type": "User", "site_admin": false}, "created_at": "2017-12-08T02:51:47Z", "updated_at": "2017-12-08T03:04:12Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1310570\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/soumith\">@soumith</a>  when I add</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> torch.multiprocessing <span class=\"pl-k\">as</span> mp\nmp.set_start_method(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>spawn<span class=\"pl-pds\">'</span></span>)</pre></div>\n<p>into the top of my main script, another error occurred</p>\n<pre><code>Traceback (most recent call last):\n  File \"utility/dataset.py\", line 237, in &lt;module&gt;\n    data_iter = iter(train_loader)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/site-packages/torch/utils/data/dataloader.py\", line 310, in __iter__\n    return DataLoaderIter(self)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/site-packages/torch/utils/data/dataloader.py\", line 167, in __init__\n    w.start()\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/process.py\", line 105, in start\n    self._popen = self._Popen(self)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/context.py\", line 212, in _Popen\n    return _default_context.get_context().Process._Popen(process_obj)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/context.py\", line 274, in _Popen\n    return Popen(process_obj)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/popen_spawn_posix.py\", line 33, in __init__\n    super().__init__(process_obj)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/popen_fork.py\", line 20, in __init__\n    self._launch(process_obj)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/popen_spawn_posix.py\", line 48, in _launch\n    reduction.dump(process_obj, fp)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/reduction.py\", line 59, in dump\n    ForkingPickler(file, protocol).dump(obj)\nAttributeError: Can't pickle local object 'get_train_valid_loader.&lt;locals&gt;.&lt;lambda&gt;'\n</code></pre>\n<h2>any idea? thx</h2>\n<p>well, this error can be fixed by directly apply Dataloader on dataset rather than use an additional function get_train_valid_loader to wrap it. But still not solve this problem, in my situation, it returns another error:</p>\n<pre><code>RuntimeError: context has already been set\nTraceback (most recent call last):\n  File \"&lt;string&gt;\", line 1, in &lt;module&gt;\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/spawn.py\", line 106, in spawn_main\n    exitcode = _main(fd)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/spawn.py\", line 115, in _main\n    prepare(preparation_data)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/spawn.py\", line 226, in prepare\n    _fixup_main_from_path(data['init_main_from_path'])\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/spawn.py\", line 278, in _fixup_main_from_path\n    run_name=\"__mp_main__\")\n  File \"/home/kaixuan/anaconda3/lib/python3.5/runpy.py\", line 254, in run_path\n    pkg_name=pkg_name, script_name=fname)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/runpy.py\", line 96, in _run_module_code\n    mod_name, mod_spec, pkg_name, script_name)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/runpy.py\", line 85, in _run_code\n    exec(code, run_globals)\n  File \"/media/kaixuan/DATA/Papers/Code/utility/dataset.py\", line 7, in &lt;module&gt;\n    mp.set_start_method('spawn')\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/context.py\", line 231, in set_start_method\n    raise RuntimeError('context has already been set')\nRuntimeError: context has already been set\n</code></pre>\n<p>Another odd thing is the process not returns as if it stuck.<br>\nAlso note when I delete the two line added code, and set the num_workers to 1, it can return the correct result.</p>", "body_text": "@soumith  when I add\nimport torch.multiprocessing as mp\nmp.set_start_method('spawn')\ninto the top of my main script, another error occurred\nTraceback (most recent call last):\n  File \"utility/dataset.py\", line 237, in <module>\n    data_iter = iter(train_loader)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/site-packages/torch/utils/data/dataloader.py\", line 310, in __iter__\n    return DataLoaderIter(self)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/site-packages/torch/utils/data/dataloader.py\", line 167, in __init__\n    w.start()\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/process.py\", line 105, in start\n    self._popen = self._Popen(self)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/context.py\", line 212, in _Popen\n    return _default_context.get_context().Process._Popen(process_obj)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/context.py\", line 274, in _Popen\n    return Popen(process_obj)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/popen_spawn_posix.py\", line 33, in __init__\n    super().__init__(process_obj)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/popen_fork.py\", line 20, in __init__\n    self._launch(process_obj)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/popen_spawn_posix.py\", line 48, in _launch\n    reduction.dump(process_obj, fp)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/reduction.py\", line 59, in dump\n    ForkingPickler(file, protocol).dump(obj)\nAttributeError: Can't pickle local object 'get_train_valid_loader.<locals>.<lambda>'\n\nany idea? thx\nwell, this error can be fixed by directly apply Dataloader on dataset rather than use an additional function get_train_valid_loader to wrap it. But still not solve this problem, in my situation, it returns another error:\nRuntimeError: context has already been set\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/spawn.py\", line 106, in spawn_main\n    exitcode = _main(fd)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/spawn.py\", line 115, in _main\n    prepare(preparation_data)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/spawn.py\", line 226, in prepare\n    _fixup_main_from_path(data['init_main_from_path'])\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/spawn.py\", line 278, in _fixup_main_from_path\n    run_name=\"__mp_main__\")\n  File \"/home/kaixuan/anaconda3/lib/python3.5/runpy.py\", line 254, in run_path\n    pkg_name=pkg_name, script_name=fname)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/runpy.py\", line 96, in _run_module_code\n    mod_name, mod_spec, pkg_name, script_name)\n  File \"/home/kaixuan/anaconda3/lib/python3.5/runpy.py\", line 85, in _run_code\n    exec(code, run_globals)\n  File \"/media/kaixuan/DATA/Papers/Code/utility/dataset.py\", line 7, in <module>\n    mp.set_start_method('spawn')\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/context.py\", line 231, in set_start_method\n    raise RuntimeError('context has already been set')\nRuntimeError: context has already been set\n\nAnother odd thing is the process not returns as if it stuck.\nAlso note when I delete the two line added code, and set the num_workers to 1, it can return the correct result.", "body": "@soumith  when I add \r\n```python\r\nimport torch.multiprocessing as mp\r\nmp.set_start_method('spawn')\r\n```\r\ninto the top of my main script, another error occurred\r\n```\r\nTraceback (most recent call last):\r\n  File \"utility/dataset.py\", line 237, in <module>\r\n    data_iter = iter(train_loader)\r\n  File \"/home/kaixuan/anaconda3/lib/python3.5/site-packages/torch/utils/data/dataloader.py\", line 310, in __iter__\r\n    return DataLoaderIter(self)\r\n  File \"/home/kaixuan/anaconda3/lib/python3.5/site-packages/torch/utils/data/dataloader.py\", line 167, in __init__\r\n    w.start()\r\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/process.py\", line 105, in start\r\n    self._popen = self._Popen(self)\r\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/context.py\", line 212, in _Popen\r\n    return _default_context.get_context().Process._Popen(process_obj)\r\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/context.py\", line 274, in _Popen\r\n    return Popen(process_obj)\r\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/popen_spawn_posix.py\", line 33, in __init__\r\n    super().__init__(process_obj)\r\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/popen_fork.py\", line 20, in __init__\r\n    self._launch(process_obj)\r\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/popen_spawn_posix.py\", line 48, in _launch\r\n    reduction.dump(process_obj, fp)\r\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/reduction.py\", line 59, in dump\r\n    ForkingPickler(file, protocol).dump(obj)\r\nAttributeError: Can't pickle local object 'get_train_valid_loader.<locals>.<lambda>'\r\n```\r\nany idea? thx\r\n--------------------------\r\nwell, this error can be fixed by directly apply Dataloader on dataset rather than use an additional function get_train_valid_loader to wrap it. But still not solve this problem, in my situation, it returns another error:\r\n```\r\nRuntimeError: context has already been set\r\nTraceback (most recent call last):\r\n  File \"<string>\", line 1, in <module>\r\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/spawn.py\", line 106, in spawn_main\r\n    exitcode = _main(fd)\r\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/spawn.py\", line 115, in _main\r\n    prepare(preparation_data)\r\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/spawn.py\", line 226, in prepare\r\n    _fixup_main_from_path(data['init_main_from_path'])\r\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/spawn.py\", line 278, in _fixup_main_from_path\r\n    run_name=\"__mp_main__\")\r\n  File \"/home/kaixuan/anaconda3/lib/python3.5/runpy.py\", line 254, in run_path\r\n    pkg_name=pkg_name, script_name=fname)\r\n  File \"/home/kaixuan/anaconda3/lib/python3.5/runpy.py\", line 96, in _run_module_code\r\n    mod_name, mod_spec, pkg_name, script_name)\r\n  File \"/home/kaixuan/anaconda3/lib/python3.5/runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/media/kaixuan/DATA/Papers/Code/utility/dataset.py\", line 7, in <module>\r\n    mp.set_start_method('spawn')\r\n  File \"/home/kaixuan/anaconda3/lib/python3.5/multiprocessing/context.py\", line 231, in set_start_method\r\n    raise RuntimeError('context has already been set')\r\nRuntimeError: context has already been set\r\n```\r\nAnother odd thing is the process not returns as if it stuck.\r\nAlso note when I delete the two line added code, and set the num_workers to 1, it can return the correct result."}