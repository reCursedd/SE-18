{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/195136110", "pull_request_review_id": 128442203, "id": 195136110, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NTEzNjExMA==", "diff_hunk": "@@ -149,50 +151,52 @@ if (FALSE)\n endif()\n \n # ---[ List of libraries to link with\n-if(BUILD_CAFFE2)\n+if (BUILD_CAFFE2)\n   add_library(caffe2_protos STATIC $<TARGET_OBJECTS:Caffe_PROTO> $<TARGET_OBJECTS:Caffe2_PROTO>)\n   add_dependencies(caffe2_protos Caffe_PROTO Caffe2_PROTO)\n-  # If we are going to link protobuf locally inside caffe2 libraries, what we will do is\n-  # to create a helper static library that always contains libprotobuf source files, and\n-  # link the caffe2 related dependent libraries to it.\n-  target_include_directories(caffe2_protos INTERFACE $<INSTALL_INTERFACE:include>)\n-  # Reason for this public dependency is as follows:\n-  # (1) Strictly speaking, we should not expose any Protobuf related functions. We should\n-  #     only use function interfaces wrapped with our own public API, and link protobuf\n-  #     locally.\n-  # (2) However, currently across the Caffe2 codebase, we have extensive use of protobuf\n-  #     functionalities. For example, not only libcaffe2.so uses it, but also other\n-  #     binaries such as python extensions etc. As a result, we will have to have a\n-  #     transitive dependency to libprotobuf.\n-  #\n-  # Good thing is that, if we specify CAFFE2_LINK_LOCAL_PROTOBUF, then we do not need to\n-  # separately deploy protobuf binaries - libcaffe2.so will contain all functionalities\n-  # one needs. One can verify this via ldd.\n-  #\n-  # TODO item in the future includes:\n-  # (1) Enable using lite protobuf\n-  # (2) Properly define public API that do not directly depend on protobuf itself.\n-  # (3) Expose the libprotobuf.a file for dependent libraries to link to.\n-  #\n-  # What it means for users/developers?\n-  # (1) Users: nothing affecting the users, other than the fact that CAFFE2_LINK_LOCAL_PROTOBUF\n-  #     avoids the need to deploy protobuf.\n-  # (2) Developers: if one simply uses core caffe2 functionality without using protobuf,\n-  #     nothing changes. If one has a dependent library that uses protobuf, then one needs to\n-  #     have the right protobuf version as well as linking to libprotobuf.a.\n-  target_link_libraries(caffe2_protos PUBLIC protobuf::libprotobuf)\n+else()\n+  # Do not include caffe2 or caffe protos, but rather have it only be\n+  # a library to attach local protobuf.\n+  add_library(caffe2_protos STATIC utils/dummy.cpp)", "path": "caffe2/CMakeLists.txt", "position": 61, "original_position": 61, "commit_id": "c95a0d05a5f23b1a90c70c20dd01de5d6d39441c", "original_commit_id": "f4fe2c90bbe29b5989ac1798a1d718c22a1112b0", "user": {"login": "orionr", "id": 79994, "node_id": "MDQ6VXNlcjc5OTk0", "avatar_url": "https://avatars3.githubusercontent.com/u/79994?v=4", "gravatar_id": "", "url": "https://api.github.com/users/orionr", "html_url": "https://github.com/orionr", "followers_url": "https://api.github.com/users/orionr/followers", "following_url": "https://api.github.com/users/orionr/following{/other_user}", "gists_url": "https://api.github.com/users/orionr/gists{/gist_id}", "starred_url": "https://api.github.com/users/orionr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/orionr/subscriptions", "organizations_url": "https://api.github.com/users/orionr/orgs", "repos_url": "https://api.github.com/users/orionr/repos", "events_url": "https://api.github.com/users/orionr/events{/privacy}", "received_events_url": "https://api.github.com/users/orionr/received_events", "type": "User", "site_admin": false}, "body": "And just confirmed - result was\r\n\r\n```\r\nCMake Error at caffe2/CMakeLists.txt:190 (target_link_libraries):\r\n  INTERFACE library can only be used with the INTERFACE keyword of\r\n  target_link_libraries\r\n\r\n\r\nCMake Error at cmake/public/utils.cmake:65 (message):\r\n  You made a CMake build file error: target caffe2_protos must be of type\r\n  either STATIC_LIBRARY or SHARED_LIBRARY.  However, I got INTERFACE_LIBRARY.\r\nCall Stack (most recent call first):\r\n  caffe2/CMakeLists.txt:194 (caffe2_interface_library)\r\n```\r\nThere might be some way to eliminate the use of caffe2_interface_library, but I didn't see it being easy. Thoughts?", "created_at": "2018-06-13T15:44:30Z", "updated_at": "2018-11-23T15:45:26Z", "html_url": "https://github.com/pytorch/pytorch/pull/8073#discussion_r195136110", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/8073", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/195136110"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/8073#discussion_r195136110"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/8073"}}, "body_html": "<p>And just confirmed - result was</p>\n<pre><code>CMake Error at caffe2/CMakeLists.txt:190 (target_link_libraries):\n  INTERFACE library can only be used with the INTERFACE keyword of\n  target_link_libraries\n\n\nCMake Error at cmake/public/utils.cmake:65 (message):\n  You made a CMake build file error: target caffe2_protos must be of type\n  either STATIC_LIBRARY or SHARED_LIBRARY.  However, I got INTERFACE_LIBRARY.\nCall Stack (most recent call first):\n  caffe2/CMakeLists.txt:194 (caffe2_interface_library)\n</code></pre>\n<p>There might be some way to eliminate the use of caffe2_interface_library, but I didn't see it being easy. Thoughts?</p>", "body_text": "And just confirmed - result was\nCMake Error at caffe2/CMakeLists.txt:190 (target_link_libraries):\n  INTERFACE library can only be used with the INTERFACE keyword of\n  target_link_libraries\n\n\nCMake Error at cmake/public/utils.cmake:65 (message):\n  You made a CMake build file error: target caffe2_protos must be of type\n  either STATIC_LIBRARY or SHARED_LIBRARY.  However, I got INTERFACE_LIBRARY.\nCall Stack (most recent call first):\n  caffe2/CMakeLists.txt:194 (caffe2_interface_library)\n\nThere might be some way to eliminate the use of caffe2_interface_library, but I didn't see it being easy. Thoughts?", "in_reply_to_id": 195131750}