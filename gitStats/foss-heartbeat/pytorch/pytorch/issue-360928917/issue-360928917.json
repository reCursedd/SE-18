{"url": "https://api.github.com/repos/pytorch/pytorch/issues/11757", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/11757/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/11757/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/11757/events", "html_url": "https://github.com/pytorch/pytorch/issues/11757", "id": 360928917, "node_id": "MDU6SXNzdWUzNjA5Mjg5MTc=", "number": 11757, "title": "Unable to build PyTorch from source without NumPy support", "user": {"login": "vishwakftw", "id": 23639302, "node_id": "MDQ6VXNlcjIzNjM5MzAy", "avatar_url": "https://avatars2.githubusercontent.com/u/23639302?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vishwakftw", "html_url": "https://github.com/vishwakftw", "followers_url": "https://api.github.com/users/vishwakftw/followers", "following_url": "https://api.github.com/users/vishwakftw/following{/other_user}", "gists_url": "https://api.github.com/users/vishwakftw/gists{/gist_id}", "starred_url": "https://api.github.com/users/vishwakftw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vishwakftw/subscriptions", "organizations_url": "https://api.github.com/users/vishwakftw/orgs", "repos_url": "https://api.github.com/users/vishwakftw/repos", "events_url": "https://api.github.com/users/vishwakftw/events{/privacy}", "received_events_url": "https://api.github.com/users/vishwakftw/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-09-17T15:41:36Z", "updated_at": "2018-10-04T19:12:33Z", "closed_at": "2018-10-04T19:12:33Z", "author_association": "CONTRIBUTOR", "body_html": "<h2>Issue description</h2>\n<p>So far, all the builds in the CI have had NumPy support, meaning that this issue has not been exposed in its entirety yet.</p>\n<p>I tried to build PyTorch without NumPy support, and it wasn't possible at first. Editing <code>Dependencies.cmake</code> made sense to accomplish this, but then it seems that Caffe2 requires NumPy support.</p>\n<p>This is the error I got after (almost) building PyTorch.</p>\n<div class=\"highlight highlight-source-shell\"><pre>In file included from /media/vishwak/Official/Projects/pytorch/caffe2/python/pybind_state.cc:1:0:\n/media/vishwak/Official/Projects/pytorch/caffe2/python/pybind_state.h:24:10: fatal error: numpy/arrayobject.h: No such file or directory\n <span class=\"pl-c\"><span class=\"pl-c\">#</span>include &lt;numpy/arrayobject.h&gt;</span>\n          ^~~~~~~~~~~~~~~~~~~~~\ncompilation terminated.</pre></div>\n<h2>Code example</h2>\n<p>This is what I did to the <code>Dependencies.cmake</code> file:</p>\n<div class=\"highlight highlight-source-diff\"><pre><span class=\"pl-c1\">diff --git a/cmake/Dependencies.cmake b/cmake/Dependencies.cmake</span>\nindex dbec0d07e..c8dafb23e 100644\n<span class=\"pl-md\">--- a/cmake/Dependencies.cmake</span>\n<span class=\"pl-mi1\">+++ b/cmake/Dependencies.cmake</span>\n<span class=\"pl-mdr\">@@ -397,9 +397,12 @@</span> if(BUILD_PYTHON)\n   set(Python_ADDITIONAL_VERSIONS 3.7 3.6 3.5 2.8 2.7 2.6)\n   find_package(PythonInterp 2.7)\n   find_package(PythonLibs 2.7)\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>  find_package(NumPy REQUIRED)</span>\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>  if(PYTHONINTERP_FOUND AND PYTHONLIBS_FOUND AND NUMPY_FOUND)</span>\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>    include_directories(SYSTEM ${PYTHON_INCLUDE_DIR} ${NUMPY_INCLUDE_DIR})</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  find_package(NumPy)</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  if(PYTHONINTERP_FOUND AND PYTHONLIBS_FOUND)</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>    include_directories(SYSTEM ${PYTHON_INCLUDE_DIR})</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>    if(NUMPY_FOUND)</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      include_directories(SYSTEM ${NUMPY_INCLUDE_DIR})</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>    endif()</span>\n     # Observers are required in the python build\n     caffe2_update_option(USE_OBSERVERS ON)\n   else()</pre></div>\n<h2>System Info</h2>\n<ul>\n<li>PyTorch or Caffe2: PyTorch</li>\n<li>How you installed PyTorch (conda, pip, source): source</li>\n<li>Build command you used (if compiling from source): <code>NO_TEST=1 NO_CAFFE2_OPS=1 MAX_JOBS=3 NO_CUDA=1 python setup.py build</code></li>\n<li>OS: Ubuntu 18.04.1</li>\n<li>Python version: 3.7</li>\n<li>GCC version (if compiling from source): 7.3</li>\n<li>CMake version: 3.11.3</li>\n<li>Versions of any other relevant libraries: None</li>\n</ul>", "body_text": "Issue description\nSo far, all the builds in the CI have had NumPy support, meaning that this issue has not been exposed in its entirety yet.\nI tried to build PyTorch without NumPy support, and it wasn't possible at first. Editing Dependencies.cmake made sense to accomplish this, but then it seems that Caffe2 requires NumPy support.\nThis is the error I got after (almost) building PyTorch.\nIn file included from /media/vishwak/Official/Projects/pytorch/caffe2/python/pybind_state.cc:1:0:\n/media/vishwak/Official/Projects/pytorch/caffe2/python/pybind_state.h:24:10: fatal error: numpy/arrayobject.h: No such file or directory\n #include <numpy/arrayobject.h>\n          ^~~~~~~~~~~~~~~~~~~~~\ncompilation terminated.\nCode example\nThis is what I did to the Dependencies.cmake file:\ndiff --git a/cmake/Dependencies.cmake b/cmake/Dependencies.cmake\nindex dbec0d07e..c8dafb23e 100644\n--- a/cmake/Dependencies.cmake\n+++ b/cmake/Dependencies.cmake\n@@ -397,9 +397,12 @@ if(BUILD_PYTHON)\n   set(Python_ADDITIONAL_VERSIONS 3.7 3.6 3.5 2.8 2.7 2.6)\n   find_package(PythonInterp 2.7)\n   find_package(PythonLibs 2.7)\n-  find_package(NumPy REQUIRED)\n-  if(PYTHONINTERP_FOUND AND PYTHONLIBS_FOUND AND NUMPY_FOUND)\n-    include_directories(SYSTEM ${PYTHON_INCLUDE_DIR} ${NUMPY_INCLUDE_DIR})\n+  find_package(NumPy)\n+  if(PYTHONINTERP_FOUND AND PYTHONLIBS_FOUND)\n+    include_directories(SYSTEM ${PYTHON_INCLUDE_DIR})\n+    if(NUMPY_FOUND)\n+      include_directories(SYSTEM ${NUMPY_INCLUDE_DIR})\n+    endif()\n     # Observers are required in the python build\n     caffe2_update_option(USE_OBSERVERS ON)\n   else()\nSystem Info\n\nPyTorch or Caffe2: PyTorch\nHow you installed PyTorch (conda, pip, source): source\nBuild command you used (if compiling from source): NO_TEST=1 NO_CAFFE2_OPS=1 MAX_JOBS=3 NO_CUDA=1 python setup.py build\nOS: Ubuntu 18.04.1\nPython version: 3.7\nGCC version (if compiling from source): 7.3\nCMake version: 3.11.3\nVersions of any other relevant libraries: None", "body": "## Issue description\r\n\r\nSo far, all the builds in the CI have had NumPy support, meaning that this issue has not been exposed in its entirety yet.\r\n\r\nI tried to build PyTorch without NumPy support, and it wasn't possible at first. Editing `Dependencies.cmake` made sense to accomplish this, but then it seems that Caffe2 requires NumPy support.\r\n\r\nThis is the error I got after (almost) building PyTorch.\r\n```bash\r\nIn file included from /media/vishwak/Official/Projects/pytorch/caffe2/python/pybind_state.cc:1:0:\r\n/media/vishwak/Official/Projects/pytorch/caffe2/python/pybind_state.h:24:10: fatal error: numpy/arrayobject.h: No such file or directory\r\n #include <numpy/arrayobject.h>\r\n          ^~~~~~~~~~~~~~~~~~~~~\r\ncompilation terminated.\r\n```\r\n\r\n## Code example\r\n\r\nThis is what I did to the `Dependencies.cmake` file:\r\n```diff\r\ndiff --git a/cmake/Dependencies.cmake b/cmake/Dependencies.cmake\r\nindex dbec0d07e..c8dafb23e 100644\r\n--- a/cmake/Dependencies.cmake\r\n+++ b/cmake/Dependencies.cmake\r\n@@ -397,9 +397,12 @@ if(BUILD_PYTHON)\r\n   set(Python_ADDITIONAL_VERSIONS 3.7 3.6 3.5 2.8 2.7 2.6)\r\n   find_package(PythonInterp 2.7)\r\n   find_package(PythonLibs 2.7)\r\n-  find_package(NumPy REQUIRED)\r\n-  if(PYTHONINTERP_FOUND AND PYTHONLIBS_FOUND AND NUMPY_FOUND)\r\n-    include_directories(SYSTEM ${PYTHON_INCLUDE_DIR} ${NUMPY_INCLUDE_DIR})\r\n+  find_package(NumPy)\r\n+  if(PYTHONINTERP_FOUND AND PYTHONLIBS_FOUND)\r\n+    include_directories(SYSTEM ${PYTHON_INCLUDE_DIR})\r\n+    if(NUMPY_FOUND)\r\n+      include_directories(SYSTEM ${NUMPY_INCLUDE_DIR})\r\n+    endif()\r\n     # Observers are required in the python build\r\n     caffe2_update_option(USE_OBSERVERS ON)\r\n   else()\r\n```\r\n## System Info\r\n- PyTorch or Caffe2: PyTorch\r\n- How you installed PyTorch (conda, pip, source): source\r\n- Build command you used (if compiling from source): `NO_TEST=1 NO_CAFFE2_OPS=1 MAX_JOBS=3 NO_CUDA=1 python setup.py build`\r\n- OS: Ubuntu 18.04.1\r\n- Python version: 3.7\r\n- GCC version (if compiling from source): 7.3\r\n- CMake version: 3.11.3\r\n- Versions of any other relevant libraries: None\r\n"}