{"url": "https://api.github.com/repos/pytorch/pytorch/issues/3151", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/3151/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/3151/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/3151/events", "html_url": "https://github.com/pytorch/pytorch/pull/3151", "id": 266221980, "node_id": "MDExOlB1bGxSZXF1ZXN0MTQ3MTExMjQ3", "number": 3151, "title": "Prevent torch.autograd.grad from freeing buffers in the entire graph", "user": {"login": "apaszke", "id": 4583066, "node_id": "MDQ6VXNlcjQ1ODMwNjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4583066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apaszke", "html_url": "https://github.com/apaszke", "followers_url": "https://api.github.com/users/apaszke/followers", "following_url": "https://api.github.com/users/apaszke/following{/other_user}", "gists_url": "https://api.github.com/users/apaszke/gists{/gist_id}", "starred_url": "https://api.github.com/users/apaszke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apaszke/subscriptions", "organizations_url": "https://api.github.com/users/apaszke/orgs", "repos_url": "https://api.github.com/users/apaszke/repos", "events_url": "https://api.github.com/users/apaszke/events{/privacy}", "received_events_url": "https://api.github.com/users/apaszke/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2017-10-17T17:58:00Z", "updated_at": "2017-11-21T18:20:50Z", "closed_at": "2017-10-17T18:49:10Z", "author_association": "MEMBER", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/3151", "html_url": "https://github.com/pytorch/pytorch/pull/3151", "diff_url": "https://github.com/pytorch/pytorch/pull/3151.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/3151.patch"}, "body_html": "<p>Right now <code>torch.autograd.grad</code> stops executing functions at some point, but will still return zero grads so that dependencies for <code>next_functions</code> are freed. This is ok, because we don't execute any unnecessary function (they're aborted by an engine callback), but is wasteful since we have to iterate over the whole graph again. However, the worst part is that this iteration will actually free the buffers in the part that is not executed, causing errors later. See the new test for an example.</p>\n<p>cc: <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=35882\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/srush\">@srush</a></p>", "body_text": "Right now torch.autograd.grad stops executing functions at some point, but will still return zero grads so that dependencies for next_functions are freed. This is ok, because we don't execute any unnecessary function (they're aborted by an engine callback), but is wasteful since we have to iterate over the whole graph again. However, the worst part is that this iteration will actually free the buffers in the part that is not executed, causing errors later. See the new test for an example.\ncc: @srush", "body": "Right now `torch.autograd.grad` stops executing functions at some point, but will still return zero grads so that dependencies for `next_functions` are freed. This is ok, because we don't execute any unnecessary function (they're aborted by an engine callback), but is wasteful since we have to iterate over the whole graph again. However, the worst part is that this iteration will actually free the buffers in the part that is not executed, causing errors later. See the new test for an example.\r\n\r\ncc: @srush"}