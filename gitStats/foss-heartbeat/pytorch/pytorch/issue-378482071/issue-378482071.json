{"url": "https://api.github.com/repos/pytorch/pytorch/issues/13682", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/13682/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/13682/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/13682/events", "html_url": "https://github.com/pytorch/pytorch/pull/13682", "id": 378482071, "node_id": "MDExOlB1bGxSZXF1ZXN0MjI5MTc4MzUy", "number": 13682, "title": "[DONT MERGE] demonstrate cause of shape bug at flip()", "user": {"login": "weiyangfb", "id": 38509346, "node_id": "MDQ6VXNlcjM4NTA5MzQ2", "avatar_url": "https://avatars1.githubusercontent.com/u/38509346?v=4", "gravatar_id": "", "url": "https://api.github.com/users/weiyangfb", "html_url": "https://github.com/weiyangfb", "followers_url": "https://api.github.com/users/weiyangfb/followers", "following_url": "https://api.github.com/users/weiyangfb/following{/other_user}", "gists_url": "https://api.github.com/users/weiyangfb/gists{/gist_id}", "starred_url": "https://api.github.com/users/weiyangfb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/weiyangfb/subscriptions", "organizations_url": "https://api.github.com/users/weiyangfb/orgs", "repos_url": "https://api.github.com/users/weiyangfb/repos", "events_url": "https://api.github.com/users/weiyangfb/events{/privacy}", "received_events_url": "https://api.github.com/users/weiyangfb/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-11-07T21:44:36Z", "updated_at": "2018-11-23T15:54:29Z", "closed_at": "2018-11-08T04:32:11Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/13682", "html_url": "https://github.com/pytorch/pytorch/pull/13682", "diff_url": "https://github.com/pytorch/pytorch/pull/13682.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/13682.patch"}, "body_html": "<ul>\n<li>this demonstrate the root cause of the bug at <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"375312525\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/13292\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/13292/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/13292\">#13292</a>, and proposing a fix for it</li>\n<li>the cause is because of bug at permute:</li>\n</ul>\n<pre><code>&gt;&gt;&gt; a = torch.randn(1, 2, 3, 4)\n&gt;&gt;&gt; a_flip = flip(a, [1, 3])\n&gt;&gt;&gt; a_flip.shape\ntorch.Size([2, 4, 1, 3]) # need to permute([2, 0, 3, 1])\n\n# =====  original flip() impl only works for this case =======\n&gt;&gt;&gt; a = torch.randn(1, 2, 3, 4)\n&gt;&gt;&gt; a_flip = flip(a, [0, 2])\n&gt;&gt;&gt; a_flip.shape\ntorch.Size([1, 3, 2, 4]) # need to permute([0, 2, 1, 3])\n\n&gt;&gt;&gt; a = torch.randn(1, 2, 3, 4)\n&gt;&gt;&gt; a_flip = flip(a, [0, 3])\n&gt;&gt;&gt; a_flip.shape\ntorch.Size([1, 4, 2, 3]) # need to permute([0, 2, 3, 1])\n</code></pre>\n<ul>\n<li>performance:</li>\n</ul>\n<pre><code>&gt;&gt;&gt; a = torch.randn(1000, 1000)\n&gt;&gt;&gt; %timeit -r 10 a.flip(0, 1)\n15.2 ms \u00b1 2.57 ms per loop (mean \u00b1 std. dev. of 10 runs, 100 loops each)\n</code></pre>\n<p>cc <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=9110200\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/fmassa\">@fmassa</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=5674597\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/SsnL\">@SsnL</a></p>", "body_text": "this demonstrate the root cause of the bug at #13292, and proposing a fix for it\nthe cause is because of bug at permute:\n\n>>> a = torch.randn(1, 2, 3, 4)\n>>> a_flip = flip(a, [1, 3])\n>>> a_flip.shape\ntorch.Size([2, 4, 1, 3]) # need to permute([2, 0, 3, 1])\n\n# =====  original flip() impl only works for this case =======\n>>> a = torch.randn(1, 2, 3, 4)\n>>> a_flip = flip(a, [0, 2])\n>>> a_flip.shape\ntorch.Size([1, 3, 2, 4]) # need to permute([0, 2, 1, 3])\n\n>>> a = torch.randn(1, 2, 3, 4)\n>>> a_flip = flip(a, [0, 3])\n>>> a_flip.shape\ntorch.Size([1, 4, 2, 3]) # need to permute([0, 2, 3, 1])\n\n\nperformance:\n\n>>> a = torch.randn(1000, 1000)\n>>> %timeit -r 10 a.flip(0, 1)\n15.2 ms \u00b1 2.57 ms per loop (mean \u00b1 std. dev. of 10 runs, 100 loops each)\n\ncc @fmassa @SsnL", "body": "- this demonstrate the root cause of the bug at https://github.com/pytorch/pytorch/issues/13292, and proposing a fix for it\r\n- the cause is because of bug at permute:\r\n```\r\n>>> a = torch.randn(1, 2, 3, 4)\r\n>>> a_flip = flip(a, [1, 3])\r\n>>> a_flip.shape\r\ntorch.Size([2, 4, 1, 3]) # need to permute([2, 0, 3, 1])\r\n\r\n# =====  original flip() impl only works for this case =======\r\n>>> a = torch.randn(1, 2, 3, 4)\r\n>>> a_flip = flip(a, [0, 2])\r\n>>> a_flip.shape\r\ntorch.Size([1, 3, 2, 4]) # need to permute([0, 2, 1, 3])\r\n\r\n>>> a = torch.randn(1, 2, 3, 4)\r\n>>> a_flip = flip(a, [0, 3])\r\n>>> a_flip.shape\r\ntorch.Size([1, 4, 2, 3]) # need to permute([0, 2, 3, 1])\r\n```\r\n- performance:\r\n```\r\n>>> a = torch.randn(1000, 1000)\r\n>>> %timeit -r 10 a.flip(0, 1)\r\n15.2 ms \u00b1 2.57 ms per loop (mean \u00b1 std. dev. of 10 runs, 100 loops each)\r\n```\r\n\r\ncc @fmassa @SsnL "}