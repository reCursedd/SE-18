{"url": "https://api.github.com/repos/pytorch/pytorch/issues/12395", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/12395/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/12395/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/12395/events", "html_url": "https://github.com/pytorch/pytorch/issues/12395", "id": 367366546, "node_id": "MDU6SXNzdWUzNjczNjY1NDY=", "number": 12395, "title": "Caffe2 flaky tests on CircleCI", "user": {"login": "yf225", "id": 4063635, "node_id": "MDQ6VXNlcjQwNjM2MzU=", "avatar_url": "https://avatars0.githubusercontent.com/u/4063635?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yf225", "html_url": "https://github.com/yf225", "followers_url": "https://api.github.com/users/yf225/followers", "following_url": "https://api.github.com/users/yf225/following{/other_user}", "gists_url": "https://api.github.com/users/yf225/gists{/gist_id}", "starred_url": "https://api.github.com/users/yf225/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yf225/subscriptions", "organizations_url": "https://api.github.com/users/yf225/orgs", "repos_url": "https://api.github.com/users/yf225/repos", "events_url": "https://api.github.com/users/yf225/events{/privacy}", "received_events_url": "https://api.github.com/users/yf225/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 890282107, "node_id": "MDU6TGFiZWw4OTAyODIxMDc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/caffe2", "name": "caffe2", "color": "210aa8", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "yf225", "id": 4063635, "node_id": "MDQ6VXNlcjQwNjM2MzU=", "avatar_url": "https://avatars0.githubusercontent.com/u/4063635?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yf225", "html_url": "https://github.com/yf225", "followers_url": "https://api.github.com/users/yf225/followers", "following_url": "https://api.github.com/users/yf225/following{/other_user}", "gists_url": "https://api.github.com/users/yf225/gists{/gist_id}", "starred_url": "https://api.github.com/users/yf225/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yf225/subscriptions", "organizations_url": "https://api.github.com/users/yf225/orgs", "repos_url": "https://api.github.com/users/yf225/repos", "events_url": "https://api.github.com/users/yf225/events{/privacy}", "received_events_url": "https://api.github.com/users/yf225/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "yf225", "id": 4063635, "node_id": "MDQ6VXNlcjQwNjM2MzU=", "avatar_url": "https://avatars0.githubusercontent.com/u/4063635?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yf225", "html_url": "https://github.com/yf225", "followers_url": "https://api.github.com/users/yf225/followers", "following_url": "https://api.github.com/users/yf225/following{/other_user}", "gists_url": "https://api.github.com/users/yf225/gists{/gist_id}", "starred_url": "https://api.github.com/users/yf225/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yf225/subscriptions", "organizations_url": "https://api.github.com/users/yf225/orgs", "repos_url": "https://api.github.com/users/yf225/repos", "events_url": "https://api.github.com/users/yf225/events{/privacy}", "received_events_url": "https://api.github.com/users/yf225/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2018-10-05T20:58:58Z", "updated_at": "2018-10-31T16:36:59Z", "closed_at": "2018-10-31T16:36:59Z", "author_association": "CONTRIBUTOR", "body_html": "<p>When running on CircleCI, different tests are found to be flaky in different test environments. Here are the details:</p>\n<hr>\n<h3>Test environment</h3>\n<p><strong>Host OS on CircleCI</strong>: Ubuntu 14.04 (kernel: 3.13.0-151-generic) \u2192 Tests are flaky<br>\n(As comparison, on Jenkins we use Ubuntu 16.04 (kernel: 4.4.0-1062-aws) \u2192 Tests are stable)</p>\n<p><strong>OS in Docker container</strong>: Ubuntu 14.04 (kernel: 4.4.0-1062-aws)</p>\n<p><strong>How are we sharing the build products from build stage to test stage?</strong><br>\nBuild products are all in the intermediate Docker image which is shared from build stage to test stage.</p>\n<h3>Flaky tests</h3>\n<ol>\n<li>TestFcOperator.test_fc\n<ol>\n<li>caffe2_py2_gcc4_8_ubuntu14_04_test, <a href=\"https://circleci.com/gh/pytorch/pytorch/40627\" rel=\"nofollow\">https://circleci.com/gh/pytorch/pytorch/40627</a></li>\n</ol>\n</li>\n<li>TestCRFOp.test_crf_gradient\n<ol>\n<li>caffe2_py2_gcc4_8_ubuntu14_04_test, <a href=\"https://circleci.com/gh/pytorch/pytorch/40508\" rel=\"nofollow\">https://circleci.com/gh/pytorch/pytorch/40508</a></li>\n</ol>\n</li>\n<li>TestReduceOps.test_reduce_min\n<ol>\n<li>caffe2_py2_gcc4_8_ubuntu14_04_test, <a href=\"https://circleci.com/gh/pytorch/pytorch/40506\" rel=\"nofollow\">https://circleci.com/gh/pytorch/pytorch/40506</a></li>\n</ol>\n</li>\n<li>TestReduceFrontSum.test_col2im_gradients\n<ol>\n<li>caffe2_py2_gcc4_8_ubuntu14_04_test, <a href=\"https://circleci.com/gh/pytorch/pytorch/40771\" rel=\"nofollow\">https://circleci.com/gh/pytorch/pytorch/40771</a></li>\n</ol>\n</li>\n<li>TestLayerNormOp.test_layer_norm_op\n<ol>\n<li>caffe2_py2_gcc4_8_ubuntu14_04_test, <a href=\"https://circleci.com/gh/pytorch/pytorch/40507\" rel=\"nofollow\">https://circleci.com/gh/pytorch/pytorch/40507</a></li>\n<li>caffe2_py2_gcc4_8_ubuntu14_04_test, <a href=\"https://circleci.com/gh/pytorch/pytorch/40972\" rel=\"nofollow\">https://circleci.com/gh/pytorch/pytorch/40972</a></li>\n</ol>\n</li>\n<li>TestLayerNormOp.test_layer_norm_grad_op\n<ol>\n<li>caffe2_py2_gcc4_8_ubuntu14_04_test, <a href=\"https://circleci.com/gh/pytorch/pytorch/41306\" rel=\"nofollow\">https://circleci.com/gh/pytorch/pytorch/41306</a></li>\n</ol>\n</li>\n<li>RecurrentNetworkTest.test_sum_mul\n<ol>\n<li>caffe2_py2_gcc4_8_ubuntu14_04_test, <a href=\"https://circleci.com/gh/pytorch/pytorch/41027\" rel=\"nofollow\">https://circleci.com/gh/pytorch/pytorch/41027</a></li>\n</ol>\n</li>\n<li>TestAdagrad.test_row_wise_sparse_adagrad\n<ol>\n<li>caffe2_py2_gcc4_8_ubuntu14_04_test, <a href=\"https://circleci.com/gh/pytorch/pytorch/41227\" rel=\"nofollow\">https://circleci.com/gh/pytorch/pytorch/41227</a></li>\n</ol>\n</li>\n</ol>\n<hr>\n<h3>Test environment</h3>\n<p><strong>Host OS on CircleCI</strong>: Ubuntu 14.04 (kernel: 3.13.0-151-generic)  \u2192 Tests are flaky<br>\n(As comparison, on Jenkins we use Ubuntu 16.04 (kernel: 4.4.0-1062-aws) \u2192 Tests are stable)</p>\n<p><strong>OS in Docker container</strong>: Ubuntu 16.04 (kernel: 4.4.0-1062-aws)</p>\n<p><strong>How are we sharing the build products from build stage to test stage?</strong><br>\nBuild products are <strong>copied</strong> from build stage to test stage, without sharing the intermediate Docker image.</p>\n<h3>Flaky tests</h3>\n<ol>\n<li>GRUCellTest.test_gru_unit_op\n<ol>\n<li>caffe2_py2_cuda9_1_cudnn7_ubuntu16_04_test, <a href=\"https://circleci.com/gh/pytorch/pytorch/39963\" rel=\"nofollow\">https://circleci.com/gh/pytorch/pytorch/39963</a></li>\n</ol>\n</li>\n<li>TestLayerNormOp.test_layer_norm_grad_op\n<ol>\n<li>caffe2_py2_cuda8_0_cudnn6_ubuntu16_04_test, <a href=\"https://circleci.com/gh/pytorch/pytorch/39939\" rel=\"nofollow\">https://circleci.com/gh/pytorch/pytorch/39939</a></li>\n</ol>\n</li>\n<li>TestGlu.test_glu_old\n<ol>\n<li>caffe2_py2_cuda8_0_cudnn6_ubuntu16_04_test, <a href=\"https://circleci.com/gh/pytorch/pytorch/40017\" rel=\"nofollow\">https://circleci.com/gh/pytorch/pytorch/40017</a></li>\n<li>caffe2_py2_cuda9_1_cudnn7_ubuntu16_04_test, <a href=\"https://circleci.com/gh/pytorch/pytorch/39980\" rel=\"nofollow\">https://circleci.com/gh/pytorch/pytorch/39980</a></li>\n</ol>\n</li>\n<li>TestConvolution.test_conv_separate_stride_pad_gradients\n<ol>\n<li>caffe2_py2_cuda9_1_cudnn7_ubuntu16_04_test, <a href=\"https://circleci.com/gh/pytorch/pytorch/39989\" rel=\"nofollow\">https://circleci.com/gh/pytorch/pytorch/39989</a></li>\n</ol>\n</li>\n<li>TestReduceFrontSum.test_col2im_gradients\n<ol>\n<li>caffe2_py2_cuda8_0_cudnn6_ubuntu16_04_test, <a href=\"https://circleci.com/gh/pytorch/pytorch/39979\" rel=\"nofollow\">https://circleci.com/gh/pytorch/pytorch/39979</a></li>\n</ol>\n</li>\n<li>TestGroupConvolution.test_group_convolution\n<ol>\n<li>caffe2_py2_cuda9_0_cudnn7_ubuntu16_04_test, <a href=\"https://circleci.com/gh/pytorch/pytorch/39978\" rel=\"nofollow\">https://circleci.com/gh/pytorch/pytorch/39978</a></li>\n</ol>\n</li>\n</ol>", "body_text": "When running on CircleCI, different tests are found to be flaky in different test environments. Here are the details:\n\nTest environment\nHost OS on CircleCI: Ubuntu 14.04 (kernel: 3.13.0-151-generic) \u2192 Tests are flaky\n(As comparison, on Jenkins we use Ubuntu 16.04 (kernel: 4.4.0-1062-aws) \u2192 Tests are stable)\nOS in Docker container: Ubuntu 14.04 (kernel: 4.4.0-1062-aws)\nHow are we sharing the build products from build stage to test stage?\nBuild products are all in the intermediate Docker image which is shared from build stage to test stage.\nFlaky tests\n\nTestFcOperator.test_fc\n\ncaffe2_py2_gcc4_8_ubuntu14_04_test, https://circleci.com/gh/pytorch/pytorch/40627\n\n\nTestCRFOp.test_crf_gradient\n\ncaffe2_py2_gcc4_8_ubuntu14_04_test, https://circleci.com/gh/pytorch/pytorch/40508\n\n\nTestReduceOps.test_reduce_min\n\ncaffe2_py2_gcc4_8_ubuntu14_04_test, https://circleci.com/gh/pytorch/pytorch/40506\n\n\nTestReduceFrontSum.test_col2im_gradients\n\ncaffe2_py2_gcc4_8_ubuntu14_04_test, https://circleci.com/gh/pytorch/pytorch/40771\n\n\nTestLayerNormOp.test_layer_norm_op\n\ncaffe2_py2_gcc4_8_ubuntu14_04_test, https://circleci.com/gh/pytorch/pytorch/40507\ncaffe2_py2_gcc4_8_ubuntu14_04_test, https://circleci.com/gh/pytorch/pytorch/40972\n\n\nTestLayerNormOp.test_layer_norm_grad_op\n\ncaffe2_py2_gcc4_8_ubuntu14_04_test, https://circleci.com/gh/pytorch/pytorch/41306\n\n\nRecurrentNetworkTest.test_sum_mul\n\ncaffe2_py2_gcc4_8_ubuntu14_04_test, https://circleci.com/gh/pytorch/pytorch/41027\n\n\nTestAdagrad.test_row_wise_sparse_adagrad\n\ncaffe2_py2_gcc4_8_ubuntu14_04_test, https://circleci.com/gh/pytorch/pytorch/41227\n\n\n\n\nTest environment\nHost OS on CircleCI: Ubuntu 14.04 (kernel: 3.13.0-151-generic)  \u2192 Tests are flaky\n(As comparison, on Jenkins we use Ubuntu 16.04 (kernel: 4.4.0-1062-aws) \u2192 Tests are stable)\nOS in Docker container: Ubuntu 16.04 (kernel: 4.4.0-1062-aws)\nHow are we sharing the build products from build stage to test stage?\nBuild products are copied from build stage to test stage, without sharing the intermediate Docker image.\nFlaky tests\n\nGRUCellTest.test_gru_unit_op\n\ncaffe2_py2_cuda9_1_cudnn7_ubuntu16_04_test, https://circleci.com/gh/pytorch/pytorch/39963\n\n\nTestLayerNormOp.test_layer_norm_grad_op\n\ncaffe2_py2_cuda8_0_cudnn6_ubuntu16_04_test, https://circleci.com/gh/pytorch/pytorch/39939\n\n\nTestGlu.test_glu_old\n\ncaffe2_py2_cuda8_0_cudnn6_ubuntu16_04_test, https://circleci.com/gh/pytorch/pytorch/40017\ncaffe2_py2_cuda9_1_cudnn7_ubuntu16_04_test, https://circleci.com/gh/pytorch/pytorch/39980\n\n\nTestConvolution.test_conv_separate_stride_pad_gradients\n\ncaffe2_py2_cuda9_1_cudnn7_ubuntu16_04_test, https://circleci.com/gh/pytorch/pytorch/39989\n\n\nTestReduceFrontSum.test_col2im_gradients\n\ncaffe2_py2_cuda8_0_cudnn6_ubuntu16_04_test, https://circleci.com/gh/pytorch/pytorch/39979\n\n\nTestGroupConvolution.test_group_convolution\n\ncaffe2_py2_cuda9_0_cudnn7_ubuntu16_04_test, https://circleci.com/gh/pytorch/pytorch/39978", "body": "When running on CircleCI, different tests are found to be flaky in different test environments. Here are the details:\r\n\r\n-------------------------------------\r\n\r\n### Test environment\r\n\r\n**Host OS on CircleCI**: Ubuntu 14.04 (kernel: 3.13.0-151-generic) \u2192 Tests are flaky\r\n(As comparison, on Jenkins we use Ubuntu 16.04 (kernel: 4.4.0-1062-aws) \u2192 Tests are stable)\r\n\r\n**OS in Docker container**: Ubuntu 14.04 (kernel: 4.4.0-1062-aws)\r\n\r\n**How are we sharing the build products from build stage to test stage?**\r\nBuild products are all in the intermediate Docker image which is shared from build stage to test stage.\r\n\r\n### Flaky tests\r\n\r\n1. TestFcOperator.test_fc\r\n    1. caffe2_py2_gcc4_8_ubuntu14_04_test, https://circleci.com/gh/pytorch/pytorch/40627\r\n2. TestCRFOp.test_crf_gradient\r\n    1. caffe2_py2_gcc4_8_ubuntu14_04_test, https://circleci.com/gh/pytorch/pytorch/40508\r\n3. TestReduceOps.test_reduce_min\r\n    1. caffe2_py2_gcc4_8_ubuntu14_04_test, https://circleci.com/gh/pytorch/pytorch/40506\r\n4. TestReduceFrontSum.test_col2im_gradients\r\n    1. caffe2_py2_gcc4_8_ubuntu14_04_test, https://circleci.com/gh/pytorch/pytorch/40771\r\n5. TestLayerNormOp.test_layer_norm_op\r\n    1. caffe2_py2_gcc4_8_ubuntu14_04_test, https://circleci.com/gh/pytorch/pytorch/40507\r\n    2. caffe2_py2_gcc4_8_ubuntu14_04_test, https://circleci.com/gh/pytorch/pytorch/40972\r\n6. TestLayerNormOp.test_layer_norm_grad_op\r\n    1. caffe2_py2_gcc4_8_ubuntu14_04_test, https://circleci.com/gh/pytorch/pytorch/41306\r\n7. RecurrentNetworkTest.test_sum_mul\r\n    1. caffe2_py2_gcc4_8_ubuntu14_04_test, https://circleci.com/gh/pytorch/pytorch/41027\r\n8. TestAdagrad.test_row_wise_sparse_adagrad\r\n    1. caffe2_py2_gcc4_8_ubuntu14_04_test, https://circleci.com/gh/pytorch/pytorch/41227\r\n\r\n---------------------------\r\n\r\n### Test environment\r\n\r\n**Host OS on CircleCI**: Ubuntu 14.04 (kernel: 3.13.0-151-generic)  \u2192 Tests are flaky\r\n(As comparison, on Jenkins we use Ubuntu 16.04 (kernel: 4.4.0-1062-aws) \u2192 Tests are stable)\r\n\r\n**OS in Docker container**: Ubuntu 16.04 (kernel: 4.4.0-1062-aws)\r\n\r\n**How are we sharing the build products from build stage to test stage?**\r\nBuild products are **copied** from build stage to test stage, without sharing the intermediate Docker image.\r\n\r\n### Flaky tests\r\n\r\n1. GRUCellTest.test_gru_unit_op\r\n    1. caffe2_py2_cuda9_1_cudnn7_ubuntu16_04_test, https://circleci.com/gh/pytorch/pytorch/39963\r\n2. TestLayerNormOp.test_layer_norm_grad_op\r\n    1. caffe2_py2_cuda8_0_cudnn6_ubuntu16_04_test, https://circleci.com/gh/pytorch/pytorch/39939\r\n3. TestGlu.test_glu_old\r\n    1. caffe2_py2_cuda8_0_cudnn6_ubuntu16_04_test, https://circleci.com/gh/pytorch/pytorch/40017 \r\n    2. caffe2_py2_cuda9_1_cudnn7_ubuntu16_04_test, https://circleci.com/gh/pytorch/pytorch/39980\r\n4. TestConvolution.test_conv_separate_stride_pad_gradients\r\n    1. caffe2_py2_cuda9_1_cudnn7_ubuntu16_04_test, https://circleci.com/gh/pytorch/pytorch/39989\r\n5. TestReduceFrontSum.test_col2im_gradients\r\n    1. caffe2_py2_cuda8_0_cudnn6_ubuntu16_04_test, https://circleci.com/gh/pytorch/pytorch/39979\r\n6. TestGroupConvolution.test_group_convolution\r\n    1. caffe2_py2_cuda9_0_cudnn7_ubuntu16_04_test, https://circleci.com/gh/pytorch/pytorch/39978\r\n\r\n"}