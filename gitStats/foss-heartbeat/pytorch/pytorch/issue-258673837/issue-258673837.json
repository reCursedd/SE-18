{"url": "https://api.github.com/repos/pytorch/pytorch/issues/2781", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/2781/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/2781/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/2781/events", "html_url": "https://github.com/pytorch/pytorch/pull/2781", "id": 258673837, "node_id": "MDExOlB1bGxSZXF1ZXN0MTQxNzQzMDc1", "number": 2781, "title": "ONNX improvements", "user": {"login": "ezyang", "id": 13564, "node_id": "MDQ6VXNlcjEzNTY0", "avatar_url": "https://avatars0.githubusercontent.com/u/13564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ezyang", "html_url": "https://github.com/ezyang", "followers_url": "https://api.github.com/users/ezyang/followers", "following_url": "https://api.github.com/users/ezyang/following{/other_user}", "gists_url": "https://api.github.com/users/ezyang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ezyang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ezyang/subscriptions", "organizations_url": "https://api.github.com/users/ezyang/orgs", "repos_url": "https://api.github.com/users/ezyang/repos", "events_url": "https://api.github.com/users/ezyang/events{/privacy}", "received_events_url": "https://api.github.com/users/ezyang/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 679953983, "node_id": "MDU6TGFiZWw2Nzk5NTM5ODM=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/jit", "name": "jit", "color": "c5def5", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-09-19T02:13:00Z", "updated_at": "2018-11-23T15:34:41Z", "closed_at": "2017-09-21T16:03:24Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/2781", "html_url": "https://github.com/pytorch/pytorch/pull/2781", "diff_url": "https://github.com/pytorch/pytorch/pull/2781.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/2781.patch"}, "body_html": "<pre><code>commit 88a1e6acbc1d2aaf7731dadad69e0b4f8456cc29\nAuthor: Edward Z. Yang &lt;ezyang@fb.com&gt;\nDate:   Tue Sep 19 09:03:08 2017 -0700\n\n    Ask for the correct number of derivatives when tracing.\n    \n    - If you operate with TracingState, you MUST check if it is live.\n      Otherwise you will segfault if it is expired; it is VALID for\n      tracing states to become expired.\n    \n    - Tracing states can expire if they request backward tracing\n      (which the tracer does by default).  We don't want this to\n      happen for exports, which only look at forwards.  So make\n      sure we set the correct num_derivatives.\n    \n    Signed-off-by: Edward Z. Yang &lt;ezyang@fb.com&gt;\n\ncommit 37941667d8e82ed1888c5b0aeb6b46a65875b89e\nAuthor: Edward Z. Yang &lt;ezyang@fb.com&gt;\nDate:   Tue Sep 19 08:48:11 2017 -0700\n\n    Make assertExpected work with Unicode strings in Python 2.\n    \n    Signed-off-by: Edward Z. Yang &lt;ezyang@fb.com&gt;\n\ncommit d0dc72d8cd9a0df7b094633a40486715680e3c60\nAuthor: Edward Z. Yang &lt;ezyang@fb.com&gt;\nDate:   Mon Sep 18 18:55:33 2017 -0700\n\n    More expect test improvements.\n    \n    - Print some diagnostic information when accepting new test output.\n    \n    - If it's the first time you ran an expect test, print out\n      the output you got so it's easier to decide if you want\n      to accept it.\n    \n    - Add infrastructure for expect-testing against exceptions\n      (I'm going to use this in a later patch).\n    \n    Signed-off-by: Edward Z. Yang &lt;ezyang@fb.com&gt;\n\ncommit dd12823fade09e679629974ec3915c8585741d84\nAuthor: Edward Z. Yang &lt;ezyang@fb.com&gt;\nDate:   Mon Sep 18 13:57:37 2017 -0700\n\n    Tighten up the ONNX export interface\n    \n    - If a user accidentally attempts to export a model that is in training mode, the\n      tracer may perturb the parameters (since modules like batchnorm will update\n      their parameters.)  To prevent this from happening, we temporarily turn\n      off training mode to make sure this doesn't happen.  Temporary is\n      important, since model export should not actually affect the model\n    \n    - If you have a buggy model which is changing the parameters,\n      it is much better for us to export the state_dict() *prior*\n      to executing the model, because that is what we actually\n      used as the inputs to the trace.  The state_dict() afterwards\n      could be anything.\n    \n    - kwargs support never worked, so it's been excised.\n    \n    Signed-off-by: Edward Z. Yang &lt;ezyang@fb.com&gt;\n\ncommit 9e20d5b58b1d876f66effba438b096345bb0e687\nAuthor: Edward Z. Yang &lt;ezyang@fb.com&gt;\nDate:   Tue Sep 19 14:29:17 2017 -0700\n\n    Give better error message when symbolic() arguments to line up.\n    \n    Now we actually tell the user what operator was being translated\n    when there was a failure.\n    \n    Signed-off-by: Edward Z. Yang &lt;ezyang@fb.com&gt;\n\ncommit 6d9b3455c6278f297ab479542bf9aa2a611d172b\nAuthor: Edward Z. Yang &lt;ezyang@fb.com&gt;\nDate:   Tue Sep 19 11:08:14 2017 -0700\n\n    Fix minor bug when --accept'ing commits.\n    \n    Signed-off-by: Edward Z. Yang &lt;ezyang@fb.com&gt;\n\ncommit 73d3972feeb577a40dbcf138e882769bbbd760f5\nAuthor: Edward Z. Yang &lt;ezyang@fb.com&gt;\nDate:   Tue Sep 19 10:53:57 2017 -0700\n\n    Also fix AvgPool2d to follow new convention.\n    \n    Signed-off-by: Edward Z. Yang &lt;ezyang@fb.com&gt;\n</code></pre>\n<p>CC <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4583066\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/apaszke\">@apaszke</a>, <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=370202\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/zdevito\">@zdevito</a>, <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=13488275\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/prigoyal\">@prigoyal</a>, <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=30275821\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/houseroad\">@houseroad</a></p>", "body_text": "commit 88a1e6acbc1d2aaf7731dadad69e0b4f8456cc29\nAuthor: Edward Z. Yang <ezyang@fb.com>\nDate:   Tue Sep 19 09:03:08 2017 -0700\n\n    Ask for the correct number of derivatives when tracing.\n    \n    - If you operate with TracingState, you MUST check if it is live.\n      Otherwise you will segfault if it is expired; it is VALID for\n      tracing states to become expired.\n    \n    - Tracing states can expire if they request backward tracing\n      (which the tracer does by default).  We don't want this to\n      happen for exports, which only look at forwards.  So make\n      sure we set the correct num_derivatives.\n    \n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\n\ncommit 37941667d8e82ed1888c5b0aeb6b46a65875b89e\nAuthor: Edward Z. Yang <ezyang@fb.com>\nDate:   Tue Sep 19 08:48:11 2017 -0700\n\n    Make assertExpected work with Unicode strings in Python 2.\n    \n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\n\ncommit d0dc72d8cd9a0df7b094633a40486715680e3c60\nAuthor: Edward Z. Yang <ezyang@fb.com>\nDate:   Mon Sep 18 18:55:33 2017 -0700\n\n    More expect test improvements.\n    \n    - Print some diagnostic information when accepting new test output.\n    \n    - If it's the first time you ran an expect test, print out\n      the output you got so it's easier to decide if you want\n      to accept it.\n    \n    - Add infrastructure for expect-testing against exceptions\n      (I'm going to use this in a later patch).\n    \n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\n\ncommit dd12823fade09e679629974ec3915c8585741d84\nAuthor: Edward Z. Yang <ezyang@fb.com>\nDate:   Mon Sep 18 13:57:37 2017 -0700\n\n    Tighten up the ONNX export interface\n    \n    - If a user accidentally attempts to export a model that is in training mode, the\n      tracer may perturb the parameters (since modules like batchnorm will update\n      their parameters.)  To prevent this from happening, we temporarily turn\n      off training mode to make sure this doesn't happen.  Temporary is\n      important, since model export should not actually affect the model\n    \n    - If you have a buggy model which is changing the parameters,\n      it is much better for us to export the state_dict() *prior*\n      to executing the model, because that is what we actually\n      used as the inputs to the trace.  The state_dict() afterwards\n      could be anything.\n    \n    - kwargs support never worked, so it's been excised.\n    \n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\n\ncommit 9e20d5b58b1d876f66effba438b096345bb0e687\nAuthor: Edward Z. Yang <ezyang@fb.com>\nDate:   Tue Sep 19 14:29:17 2017 -0700\n\n    Give better error message when symbolic() arguments to line up.\n    \n    Now we actually tell the user what operator was being translated\n    when there was a failure.\n    \n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\n\ncommit 6d9b3455c6278f297ab479542bf9aa2a611d172b\nAuthor: Edward Z. Yang <ezyang@fb.com>\nDate:   Tue Sep 19 11:08:14 2017 -0700\n\n    Fix minor bug when --accept'ing commits.\n    \n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\n\ncommit 73d3972feeb577a40dbcf138e882769bbbd760f5\nAuthor: Edward Z. Yang <ezyang@fb.com>\nDate:   Tue Sep 19 10:53:57 2017 -0700\n\n    Also fix AvgPool2d to follow new convention.\n    \n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\n\nCC @apaszke, @zdevito, @prigoyal, @houseroad", "body": "```\r\ncommit 88a1e6acbc1d2aaf7731dadad69e0b4f8456cc29\r\nAuthor: Edward Z. Yang <ezyang@fb.com>\r\nDate:   Tue Sep 19 09:03:08 2017 -0700\r\n\r\n    Ask for the correct number of derivatives when tracing.\r\n    \r\n    - If you operate with TracingState, you MUST check if it is live.\r\n      Otherwise you will segfault if it is expired; it is VALID for\r\n      tracing states to become expired.\r\n    \r\n    - Tracing states can expire if they request backward tracing\r\n      (which the tracer does by default).  We don't want this to\r\n      happen for exports, which only look at forwards.  So make\r\n      sure we set the correct num_derivatives.\r\n    \r\n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\r\n\r\ncommit 37941667d8e82ed1888c5b0aeb6b46a65875b89e\r\nAuthor: Edward Z. Yang <ezyang@fb.com>\r\nDate:   Tue Sep 19 08:48:11 2017 -0700\r\n\r\n    Make assertExpected work with Unicode strings in Python 2.\r\n    \r\n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\r\n\r\ncommit d0dc72d8cd9a0df7b094633a40486715680e3c60\r\nAuthor: Edward Z. Yang <ezyang@fb.com>\r\nDate:   Mon Sep 18 18:55:33 2017 -0700\r\n\r\n    More expect test improvements.\r\n    \r\n    - Print some diagnostic information when accepting new test output.\r\n    \r\n    - If it's the first time you ran an expect test, print out\r\n      the output you got so it's easier to decide if you want\r\n      to accept it.\r\n    \r\n    - Add infrastructure for expect-testing against exceptions\r\n      (I'm going to use this in a later patch).\r\n    \r\n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\r\n\r\ncommit dd12823fade09e679629974ec3915c8585741d84\r\nAuthor: Edward Z. Yang <ezyang@fb.com>\r\nDate:   Mon Sep 18 13:57:37 2017 -0700\r\n\r\n    Tighten up the ONNX export interface\r\n    \r\n    - If a user accidentally attempts to export a model that is in training mode, the\r\n      tracer may perturb the parameters (since modules like batchnorm will update\r\n      their parameters.)  To prevent this from happening, we temporarily turn\r\n      off training mode to make sure this doesn't happen.  Temporary is\r\n      important, since model export should not actually affect the model\r\n    \r\n    - If you have a buggy model which is changing the parameters,\r\n      it is much better for us to export the state_dict() *prior*\r\n      to executing the model, because that is what we actually\r\n      used as the inputs to the trace.  The state_dict() afterwards\r\n      could be anything.\r\n    \r\n    - kwargs support never worked, so it's been excised.\r\n    \r\n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\r\n\r\ncommit 9e20d5b58b1d876f66effba438b096345bb0e687\r\nAuthor: Edward Z. Yang <ezyang@fb.com>\r\nDate:   Tue Sep 19 14:29:17 2017 -0700\r\n\r\n    Give better error message when symbolic() arguments to line up.\r\n    \r\n    Now we actually tell the user what operator was being translated\r\n    when there was a failure.\r\n    \r\n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\r\n\r\ncommit 6d9b3455c6278f297ab479542bf9aa2a611d172b\r\nAuthor: Edward Z. Yang <ezyang@fb.com>\r\nDate:   Tue Sep 19 11:08:14 2017 -0700\r\n\r\n    Fix minor bug when --accept'ing commits.\r\n    \r\n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\r\n\r\ncommit 73d3972feeb577a40dbcf138e882769bbbd760f5\r\nAuthor: Edward Z. Yang <ezyang@fb.com>\r\nDate:   Tue Sep 19 10:53:57 2017 -0700\r\n\r\n    Also fix AvgPool2d to follow new convention.\r\n    \r\n    Signed-off-by: Edward Z. Yang <ezyang@fb.com>\r\n```\r\n\r\nCC @apaszke, @zdevito, @prigoyal, @houseroad "}