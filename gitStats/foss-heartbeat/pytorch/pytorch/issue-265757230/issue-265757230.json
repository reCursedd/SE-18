{"url": "https://api.github.com/repos/pytorch/pytorch/issues/3129", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/3129/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/3129/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/3129/events", "html_url": "https://github.com/pytorch/pytorch/issues/3129", "id": 265757230, "node_id": "MDU6SXNzdWUyNjU3NTcyMzA=", "number": 3129, "title": "Sparse SGD + momentum  = cuda memory issue.", "user": {"login": "cedias", "id": 1705336, "node_id": "MDQ6VXNlcjE3MDUzMzY=", "avatar_url": "https://avatars1.githubusercontent.com/u/1705336?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cedias", "html_url": "https://github.com/cedias", "followers_url": "https://api.github.com/users/cedias/followers", "following_url": "https://api.github.com/users/cedias/following{/other_user}", "gists_url": "https://api.github.com/users/cedias/gists{/gist_id}", "starred_url": "https://api.github.com/users/cedias/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cedias/subscriptions", "organizations_url": "https://api.github.com/users/cedias/orgs", "repos_url": "https://api.github.com/users/cedias/repos", "events_url": "https://api.github.com/users/cedias/events{/privacy}", "received_events_url": "https://api.github.com/users/cedias/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-10-16T12:46:50Z", "updated_at": "2017-10-16T22:51:38Z", "closed_at": "2017-10-16T22:51:38Z", "author_association": "NONE", "body_html": "<p>When using classic SGD optimizer with momentum with sparse embeddings the memory keeps garbage collecting / allocating leading to slow down and out of memory error eventually. <a href=\"https://gist.github.com/cedias/946a380807b7e1bf92d738268b71415a\">Here is a minimal exemple to reproduce the issue</a></p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/1705336/31611730-87b2ccbc-b27d-11e7-8826-12023e848a77.png\"><img src=\"https://user-images.githubusercontent.com/1705336/31611730-87b2ccbc-b27d-11e7-8826-12023e848a77.png\" alt=\"slowing\" style=\"max-width:100%;\"></a></p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/1705336/31612140-0fea1080-b27f-11e7-99b7-8dae06d931b1.gif\"><img src=\"https://user-images.githubusercontent.com/1705336/31612140-0fea1080-b27f-11e7-99b7-8dae06d931b1.gif\" alt=\"memoryerror\" style=\"max-width:100%;\"></a></p>\n<p>The issue dissapears when momentum is not used<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/1705336/31611728-86c7a9f8-b27d-11e7-85b3-979ce180ec3d.png\"><img src=\"https://user-images.githubusercontent.com/1705336/31611728-86c7a9f8-b27d-11e7-85b3-979ce180ec3d.png\" alt=\"nomomentum\" style=\"max-width:100%;\"></a></p>\n<p>or when embeddings are not sparse<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/1705336/31611729-872bb416-b27d-11e7-8ca1-65629cfae6bc.png\"><img src=\"https://user-images.githubusercontent.com/1705336/31611729-872bb416-b27d-11e7-8ca1-65629cfae6bc.png\" alt=\"notsparse\" style=\"max-width:100%;\"></a></p>\n<p>I'm using the last pytorch version on conda: <code>'0.2.0_4'</code></p>", "body_text": "When using classic SGD optimizer with momentum with sparse embeddings the memory keeps garbage collecting / allocating leading to slow down and out of memory error eventually. Here is a minimal exemple to reproduce the issue\n\n\nThe issue dissapears when momentum is not used\n\nor when embeddings are not sparse\n\nI'm using the last pytorch version on conda: '0.2.0_4'", "body": "When using classic SGD optimizer with momentum with sparse embeddings the memory keeps garbage collecting / allocating leading to slow down and out of memory error eventually. [Here is a minimal exemple to reproduce the issue](https://gist.github.com/cedias/946a380807b7e1bf92d738268b71415a)\r\n\r\n![slowing](https://user-images.githubusercontent.com/1705336/31611730-87b2ccbc-b27d-11e7-8826-12023e848a77.png)\r\n\r\n![memoryerror](https://user-images.githubusercontent.com/1705336/31612140-0fea1080-b27f-11e7-99b7-8dae06d931b1.gif)\r\n\r\nThe issue dissapears when momentum is not used\r\n![nomomentum](https://user-images.githubusercontent.com/1705336/31611728-86c7a9f8-b27d-11e7-85b3-979ce180ec3d.png)\r\n\r\nor when embeddings are not sparse\r\n![notsparse](https://user-images.githubusercontent.com/1705336/31611729-872bb416-b27d-11e7-8ca1-65629cfae6bc.png)\r\n\r\n\r\nI'm using the last pytorch version on conda: `'0.2.0_4'`\r\n"}