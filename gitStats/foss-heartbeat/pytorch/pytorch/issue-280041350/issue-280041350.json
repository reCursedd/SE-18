{"url": "https://api.github.com/repos/pytorch/pytorch/issues/4069", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/4069/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/4069/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/4069/events", "html_url": "https://github.com/pytorch/pytorch/issues/4069", "id": 280041350, "node_id": "MDU6SXNzdWUyODAwNDEzNTA=", "number": 4069, "title": "\"masked_fill_\" fails to handle infinite values", "user": {"login": "hitvoice", "id": 13765633, "node_id": "MDQ6VXNlcjEzNzY1NjMz", "avatar_url": "https://avatars1.githubusercontent.com/u/13765633?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hitvoice", "html_url": "https://github.com/hitvoice", "followers_url": "https://api.github.com/users/hitvoice/followers", "following_url": "https://api.github.com/users/hitvoice/following{/other_user}", "gists_url": "https://api.github.com/users/hitvoice/gists{/gist_id}", "starred_url": "https://api.github.com/users/hitvoice/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hitvoice/subscriptions", "organizations_url": "https://api.github.com/users/hitvoice/orgs", "repos_url": "https://api.github.com/users/hitvoice/repos", "events_url": "https://api.github.com/users/hitvoice/events{/privacy}", "received_events_url": "https://api.github.com/users/hitvoice/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-12-07T08:25:40Z", "updated_at": "2017-12-08T17:51:41Z", "closed_at": "2017-12-08T17:51:41Z", "author_association": "NONE", "body_html": "<p>Example code:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> torch\n<span class=\"pl-k\">from</span> torch.autograd <span class=\"pl-k\">import</span> Variable\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> OK for FloatTensor</span>\nx <span class=\"pl-k\">=</span> torch.randn(<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">5</span>)\nmask <span class=\"pl-k\">=</span> torch.eq(x, <span class=\"pl-c1\">0</span>)\nx.masked_fill_(mask, <span class=\"pl-c1\">0</span>)\nx.masked_fill_(mask, <span class=\"pl-c1\">float</span>(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>-inf<span class=\"pl-pds\">'</span></span>))\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> fails when called by Variable</span>\nx <span class=\"pl-k\">=</span> Variable(x)\nmask <span class=\"pl-k\">=</span> torch.eq(x, <span class=\"pl-c1\">0</span>)\nx.masked_fill_(mask, <span class=\"pl-c1\">0</span>)\nx.masked_fill_(mask, <span class=\"pl-c1\">float</span>(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>-inf<span class=\"pl-pds\">'</span></span>))</pre></div>\n<p>And the result is:</p>\n<pre><code>Traceback (most recent call last):\n  File \"xxx.py\", line 14, in &lt;module&gt;\n    x.masked_fill_(mask, float('-inf'))\nRuntimeError: value cannot be converted to type float without overflow: -inf\n</code></pre>\n<p>which is not expected.</p>\n<p>Testing environment:</p>\n<ul>\n<li>pytorch: 0.3.0.post4</li>\n<li>python: 3.6.1</li>\n<li>platform: Linux-4.10.0-41-generic-x86_64-with-debian-stretch-sid (Ubuntu 16.04)</li>\n</ul>", "body_text": "Example code:\nimport torch\nfrom torch.autograd import Variable\n\n# OK for FloatTensor\nx = torch.randn(1, 5)\nmask = torch.eq(x, 0)\nx.masked_fill_(mask, 0)\nx.masked_fill_(mask, float('-inf'))\n\n# fails when called by Variable\nx = Variable(x)\nmask = torch.eq(x, 0)\nx.masked_fill_(mask, 0)\nx.masked_fill_(mask, float('-inf'))\nAnd the result is:\nTraceback (most recent call last):\n  File \"xxx.py\", line 14, in <module>\n    x.masked_fill_(mask, float('-inf'))\nRuntimeError: value cannot be converted to type float without overflow: -inf\n\nwhich is not expected.\nTesting environment:\n\npytorch: 0.3.0.post4\npython: 3.6.1\nplatform: Linux-4.10.0-41-generic-x86_64-with-debian-stretch-sid (Ubuntu 16.04)", "body": "Example code:\r\n```python\r\nimport torch\r\nfrom torch.autograd import Variable\r\n\r\n# OK for FloatTensor\r\nx = torch.randn(1, 5)\r\nmask = torch.eq(x, 0)\r\nx.masked_fill_(mask, 0)\r\nx.masked_fill_(mask, float('-inf'))\r\n\r\n# fails when called by Variable\r\nx = Variable(x)\r\nmask = torch.eq(x, 0)\r\nx.masked_fill_(mask, 0)\r\nx.masked_fill_(mask, float('-inf'))\r\n```\r\nAnd the result is:\r\n```\r\nTraceback (most recent call last):\r\n  File \"xxx.py\", line 14, in <module>\r\n    x.masked_fill_(mask, float('-inf'))\r\nRuntimeError: value cannot be converted to type float without overflow: -inf\r\n```\r\nwhich is not expected.\r\n\r\nTesting environment:\r\n- pytorch: 0.3.0.post4\r\n- python: 3.6.1\r\n- platform: Linux-4.10.0-41-generic-x86_64-with-debian-stretch-sid (Ubuntu 16.04)"}