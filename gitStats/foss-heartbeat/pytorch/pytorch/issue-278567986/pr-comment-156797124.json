{"url": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/156797124", "pull_request_review_id": 83330017, "id": 156797124, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1Njc5NzEyNA==", "diff_hunk": "@@ -1548,6 +1541,21 @@ def test_data_parallel_small_back(self):\n         out = dp.data_parallel(l, i, (0, 1))\n         self.assertEqual(out, l(i))\n \n+    @unittest.skipIf(not TEST_MULTIGPU, \"multi-GPU not supported\")\n+    def test_data_parallel_no_backprop(self):\n+        test = self\n+\n+        class Layer(nn.Module):\n+            def forward(self, x):\n+                test.assertFalse(torch.is_backprop_enabled())\n+                return x\n+\n+        l = Layer()\n+        i = Variable(torch.randn(20, 10).float().cuda())\n+        with torch.no_backprop():\n+            dp.data_parallel(l, i, (0, 1))\n+        self.assertRaises(AssertionError, lambda: dp.data_parallel(l, i, (0, 1)))", "path": "test/test_nn.py", "position": null, "original_position": 60, "commit_id": "5aa6a4195c92aa7a2c416cbdff72ae50e94d4e03", "original_commit_id": "aca0b327182511a74a0ff1ef2deff0656935b1d4", "user": {"login": "colesbury", "id": 655866, "node_id": "MDQ6VXNlcjY1NTg2Ng==", "avatar_url": "https://avatars1.githubusercontent.com/u/655866?v=4", "gravatar_id": "", "url": "https://api.github.com/users/colesbury", "html_url": "https://github.com/colesbury", "followers_url": "https://api.github.com/users/colesbury/followers", "following_url": "https://api.github.com/users/colesbury/following{/other_user}", "gists_url": "https://api.github.com/users/colesbury/gists{/gist_id}", "starred_url": "https://api.github.com/users/colesbury/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/colesbury/subscriptions", "organizations_url": "https://api.github.com/users/colesbury/orgs", "repos_url": "https://api.github.com/users/colesbury/repos", "events_url": "https://api.github.com/users/colesbury/events{/privacy}", "received_events_url": "https://api.github.com/users/colesbury/received_events", "type": "User", "site_admin": false}, "body": "Line 1556 does the important check here: that backprop is disabled in the DP thread if it's disabled in the parent.\r\n\r\nLine 1557 is just check that check actually occurred (i.e. that the previous check didn't spuriously succeed because forward wasn't called).\r\n\r\nI don't think we need a third-layer of checking the checks.", "created_at": "2017-12-13T21:55:34Z", "updated_at": "2018-11-23T15:37:20Z", "html_url": "https://github.com/pytorch/pytorch/pull/3970#discussion_r156797124", "pull_request_url": "https://api.github.com/repos/pytorch/pytorch/pulls/3970", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/comments/156797124"}, "html": {"href": "https://github.com/pytorch/pytorch/pull/3970#discussion_r156797124"}, "pull_request": {"href": "https://api.github.com/repos/pytorch/pytorch/pulls/3970"}}, "body_html": "<p>Line 1556 does the important check here: that backprop is disabled in the DP thread if it's disabled in the parent.</p>\n<p>Line 1557 is just check that check actually occurred (i.e. that the previous check didn't spuriously succeed because forward wasn't called).</p>\n<p>I don't think we need a third-layer of checking the checks.</p>", "body_text": "Line 1556 does the important check here: that backprop is disabled in the DP thread if it's disabled in the parent.\nLine 1557 is just check that check actually occurred (i.e. that the previous check didn't spuriously succeed because forward wasn't called).\nI don't think we need a third-layer of checking the checks.", "in_reply_to_id": 156768855}