{"url": "https://api.github.com/repos/pytorch/pytorch/issues/1904", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/1904/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/1904/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/1904/events", "html_url": "https://github.com/pytorch/pytorch/issues/1904", "id": 238386778, "node_id": "MDU6SXNzdWUyMzgzODY3Nzg=", "number": 1904, "title": "DataLoader raising inconsistent tensor sizes", "user": {"login": "bartolsthoorn", "id": 106586, "node_id": "MDQ6VXNlcjEwNjU4Ng==", "avatar_url": "https://avatars0.githubusercontent.com/u/106586?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bartolsthoorn", "html_url": "https://github.com/bartolsthoorn", "followers_url": "https://api.github.com/users/bartolsthoorn/followers", "following_url": "https://api.github.com/users/bartolsthoorn/following{/other_user}", "gists_url": "https://api.github.com/users/bartolsthoorn/gists{/gist_id}", "starred_url": "https://api.github.com/users/bartolsthoorn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bartolsthoorn/subscriptions", "organizations_url": "https://api.github.com/users/bartolsthoorn/orgs", "repos_url": "https://api.github.com/users/bartolsthoorn/repos", "events_url": "https://api.github.com/users/bartolsthoorn/events{/privacy}", "received_events_url": "https://api.github.com/users/bartolsthoorn/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-06-25T15:18:59Z", "updated_at": "2017-06-25T15:45:12Z", "closed_at": "2017-06-25T15:45:12Z", "author_association": "CONTRIBUTOR", "body_html": "<p>This will trigger the error:</p>\n<div class=\"highlight highlight-source-python\"><pre>testset <span class=\"pl-k\">=</span> dset.ImageFolder(<span class=\"pl-v\">root</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>data/test<span class=\"pl-pds\">'</span></span>, <span class=\"pl-v\">transform</span><span class=\"pl-k\">=</span>transform_test)\ntest_loader <span class=\"pl-k\">=</span> DataLoader(testset, <span class=\"pl-v\">batch_size</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">8</span>, <span class=\"pl-v\">shuffle</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>, <span class=\"pl-v\">num_workers</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">2</span>)\nloader <span class=\"pl-k\">=</span> <span class=\"pl-c1\">iter</span>(test_loader)\n<span class=\"pl-c1\">next</span>(loader)</pre></div>\n<p>Traceback:</p>\n<pre><code>RuntimeError: Traceback (most recent call last):\n  File \"/home/ubuntu/anaconda3/lib/python3.5/site-packages/torch/utils/data/dataloader.py\", line 40, in _worker_loop\n    samples = collate_fn([dataset[i] for i in batch_indices])\n  File \"/home/ubuntu/anaconda3/lib/python3.5/site-packages/torch/utils/data/dataloader.py\", line 109, in default_collate\n    return [default_collate(samples) for samples in transposed]\n  File \"/home/ubuntu/anaconda3/lib/python3.5/site-packages/torch/utils/data/dataloader.py\", line 109, in &lt;listcomp&gt;\n    return [default_collate(samples) for samples in transposed]\n  File \"/home/ubuntu/anaconda3/lib/python3.5/site-packages/torch/utils/data/dataloader.py\", line 91, in default_collate\n    return torch.stack(batch, 0, out=out)\n  File \"/home/ubuntu/anaconda3/lib/python3.5/site-packages/torch/functional.py\", line 66, in stack\n    return torch.cat(inputs, dim, out=out)\nRuntimeError: inconsistent tensor sizes at /home/ubuntu/pytorch/torch/lib/TH/generic/THTensorMath.c:2625\n</code></pre>\n<p>Running today's Pytorch (<a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/pytorch/pytorch/commit/32e666551a695cb0fee8c70474a13f3def042bb2/hovercard\" href=\"https://github.com/pytorch/pytorch/commit/32e666551a695cb0fee8c70474a13f3def042bb2\"><tt>32e6665</tt></a>).</p>\n<p>Since the code seems trivial, it is probably related to the context. Any ideas on where to look?</p>\n<p><strong>Update</strong>: I have noticed that changing <code>transform_test</code> made the error go away, looking into that now.</p>\n<p>Loading data with this transform fails:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-c1\">self</span>.input_size <span class=\"pl-k\">=</span> <span class=\"pl-c1\">224</span>\n<span class=\"pl-c1\">self</span>.transform_test <span class=\"pl-k\">=</span> transforms.Compose([\n    transforms.Scale(<span class=\"pl-c1\">self</span>.input_size),\n    transforms.ToTensor(),\n    transforms.Normalize(<span class=\"pl-v\">mean</span><span class=\"pl-k\">=</span>[<span class=\"pl-c1\">0.485</span>, <span class=\"pl-c1\">0.456</span>, <span class=\"pl-c1\">0.406</span>], <span class=\"pl-v\">std</span><span class=\"pl-k\">=</span>[<span class=\"pl-c1\">0.229</span>, <span class=\"pl-c1\">0.224</span>, <span class=\"pl-c1\">0.225</span>])\n])</pre></div>\n<p>but the following transforms does not cause an error:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-c1\">self</span>.transform_test <span class=\"pl-k\">=</span> transforms.Compose([\n    transforms.Scale((<span class=\"pl-c1\">self</span>.input_w, <span class=\"pl-c1\">self</span>.input_h)),\n    transforms.ToTensor(),\n    transforms.Normalize((<span class=\"pl-c1\">0.5</span>, <span class=\"pl-c1\">0.5</span>, <span class=\"pl-c1\">0.5</span>), (<span class=\"pl-c1\">0.5</span>, <span class=\"pl-c1\">0.5</span>, <span class=\"pl-c1\">0.5</span>)),\n])</pre></div>", "body_text": "This will trigger the error:\ntestset = dset.ImageFolder(root='data/test', transform=transform_test)\ntest_loader = DataLoader(testset, batch_size=8, shuffle=True, num_workers=2)\nloader = iter(test_loader)\nnext(loader)\nTraceback:\nRuntimeError: Traceback (most recent call last):\n  File \"/home/ubuntu/anaconda3/lib/python3.5/site-packages/torch/utils/data/dataloader.py\", line 40, in _worker_loop\n    samples = collate_fn([dataset[i] for i in batch_indices])\n  File \"/home/ubuntu/anaconda3/lib/python3.5/site-packages/torch/utils/data/dataloader.py\", line 109, in default_collate\n    return [default_collate(samples) for samples in transposed]\n  File \"/home/ubuntu/anaconda3/lib/python3.5/site-packages/torch/utils/data/dataloader.py\", line 109, in <listcomp>\n    return [default_collate(samples) for samples in transposed]\n  File \"/home/ubuntu/anaconda3/lib/python3.5/site-packages/torch/utils/data/dataloader.py\", line 91, in default_collate\n    return torch.stack(batch, 0, out=out)\n  File \"/home/ubuntu/anaconda3/lib/python3.5/site-packages/torch/functional.py\", line 66, in stack\n    return torch.cat(inputs, dim, out=out)\nRuntimeError: inconsistent tensor sizes at /home/ubuntu/pytorch/torch/lib/TH/generic/THTensorMath.c:2625\n\nRunning today's Pytorch (32e6665).\nSince the code seems trivial, it is probably related to the context. Any ideas on where to look?\nUpdate: I have noticed that changing transform_test made the error go away, looking into that now.\nLoading data with this transform fails:\nself.input_size = 224\nself.transform_test = transforms.Compose([\n    transforms.Scale(self.input_size),\n    transforms.ToTensor(),\n    transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])\n])\nbut the following transforms does not cause an error:\nself.transform_test = transforms.Compose([\n    transforms.Scale((self.input_w, self.input_h)),\n    transforms.ToTensor(),\n    transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5)),\n])", "body": "This will trigger the error:\r\n```python\r\ntestset = dset.ImageFolder(root='data/test', transform=transform_test)\r\ntest_loader = DataLoader(testset, batch_size=8, shuffle=True, num_workers=2)\r\nloader = iter(test_loader)\r\nnext(loader)\r\n```\r\n\r\nTraceback:\r\n```\r\nRuntimeError: Traceback (most recent call last):\r\n  File \"/home/ubuntu/anaconda3/lib/python3.5/site-packages/torch/utils/data/dataloader.py\", line 40, in _worker_loop\r\n    samples = collate_fn([dataset[i] for i in batch_indices])\r\n  File \"/home/ubuntu/anaconda3/lib/python3.5/site-packages/torch/utils/data/dataloader.py\", line 109, in default_collate\r\n    return [default_collate(samples) for samples in transposed]\r\n  File \"/home/ubuntu/anaconda3/lib/python3.5/site-packages/torch/utils/data/dataloader.py\", line 109, in <listcomp>\r\n    return [default_collate(samples) for samples in transposed]\r\n  File \"/home/ubuntu/anaconda3/lib/python3.5/site-packages/torch/utils/data/dataloader.py\", line 91, in default_collate\r\n    return torch.stack(batch, 0, out=out)\r\n  File \"/home/ubuntu/anaconda3/lib/python3.5/site-packages/torch/functional.py\", line 66, in stack\r\n    return torch.cat(inputs, dim, out=out)\r\nRuntimeError: inconsistent tensor sizes at /home/ubuntu/pytorch/torch/lib/TH/generic/THTensorMath.c:2625\r\n```\r\n\r\nRunning today's Pytorch (32e666551a695cb0fee8c70474a13f3def042bb2).\r\n\r\nSince the code seems trivial, it is probably related to the context. Any ideas on where to look?\r\n\r\n**Update**: I have noticed that changing `transform_test` made the error go away, looking into that now.\r\n\r\nLoading data with this transform fails:\r\n```python\r\nself.input_size = 224\r\nself.transform_test = transforms.Compose([\r\n    transforms.Scale(self.input_size),\r\n    transforms.ToTensor(),\r\n    transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])\r\n])\r\n```\r\nbut the following transforms does not cause an error:\r\n```python\r\nself.transform_test = transforms.Compose([\r\n    transforms.Scale((self.input_w, self.input_h)),\r\n    transforms.ToTensor(),\r\n    transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5)),\r\n])\r\n```"}