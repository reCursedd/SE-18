{"url": "https://api.github.com/repos/pytorch/pytorch/issues/3752", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/3752/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/3752/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/3752/events", "html_url": "https://github.com/pytorch/pytorch/pull/3752", "id": 274720878, "node_id": "MDExOlB1bGxSZXF1ZXN0MTUzMTkzMzI4", "number": 3752, "title": "Detect aliasing in cuDNN RNN flatten_parameters", "user": {"login": "jekbradbury", "id": 11729078, "node_id": "MDQ6VXNlcjExNzI5MDc4", "avatar_url": "https://avatars2.githubusercontent.com/u/11729078?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jekbradbury", "html_url": "https://github.com/jekbradbury", "followers_url": "https://api.github.com/users/jekbradbury/followers", "following_url": "https://api.github.com/users/jekbradbury/following{/other_user}", "gists_url": "https://api.github.com/users/jekbradbury/gists{/gist_id}", "starred_url": "https://api.github.com/users/jekbradbury/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jekbradbury/subscriptions", "organizations_url": "https://api.github.com/users/jekbradbury/orgs", "repos_url": "https://api.github.com/users/jekbradbury/repos", "events_url": "https://api.github.com/users/jekbradbury/events{/privacy}", "received_events_url": "https://api.github.com/users/jekbradbury/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 742585577, "node_id": "MDU6TGFiZWw3NDI1ODU1Nzc=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/0.3", "name": "0.3", "color": "d1c41b", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-11-17T01:21:33Z", "updated_at": "2018-11-23T15:36:39Z", "closed_at": "2017-11-18T03:32:39Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/pytorch/pytorch/pulls/3752", "html_url": "https://github.com/pytorch/pytorch/pull/3752", "diff_url": "https://github.com/pytorch/pytorch/pull/3752.diff", "patch_url": "https://github.com/pytorch/pytorch/pull/3752.patch"}, "body_html": "<p><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #3751.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"274720612\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/pytorch/pytorch/issues/3751\" data-hovercard-type=\"issue\" data-hovercard-url=\"/pytorch/pytorch/issues/3751/hovercard\" href=\"https://github.com/pytorch/pytorch/issues/3751\">#3751</a>.<br>\nCurrently, <code>nn.RNN.flatten_parameters</code> sets up a contiguous weight buffer to enable the no-copy code path for cuDNN RNNs, then uses <code>set_</code> to redirect the data pointers within the RNN's parameters to point into that weight buffer. Lastly it caches the list of parameter pointers within the buffer so that <code>nn.RNN.forward</code> can detect if the RNN's parameters change and fall back to the slow path. If certain preconditions aren't met, the cached list of parameter pointers is empty, forcing the RNN to always use the slow path. This patch adds an aliasing check to those preconditions.</p>\n<p>The added test fails on master and succeeds with this change.</p>", "body_text": "Fixes #3751.\nCurrently, nn.RNN.flatten_parameters sets up a contiguous weight buffer to enable the no-copy code path for cuDNN RNNs, then uses set_ to redirect the data pointers within the RNN's parameters to point into that weight buffer. Lastly it caches the list of parameter pointers within the buffer so that nn.RNN.forward can detect if the RNN's parameters change and fall back to the slow path. If certain preconditions aren't met, the cached list of parameter pointers is empty, forcing the RNN to always use the slow path. This patch adds an aliasing check to those preconditions.\nThe added test fails on master and succeeds with this change.", "body": "Fixes #3751. \r\nCurrently, `nn.RNN.flatten_parameters` sets up a contiguous weight buffer to enable the no-copy code path for cuDNN RNNs, then uses `set_` to redirect the data pointers within the RNN's parameters to point into that weight buffer. Lastly it caches the list of parameter pointers within the buffer so that `nn.RNN.forward` can detect if the RNN's parameters change and fall back to the slow path. If certain preconditions aren't met, the cached list of parameter pointers is empty, forcing the RNN to always use the slow path. This patch adds an aliasing check to those preconditions.\r\n\r\nThe added test fails on master and succeeds with this change."}