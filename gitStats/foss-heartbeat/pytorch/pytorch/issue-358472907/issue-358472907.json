{"url": "https://api.github.com/repos/pytorch/pytorch/issues/11447", "repository_url": "https://api.github.com/repos/pytorch/pytorch", "labels_url": "https://api.github.com/repos/pytorch/pytorch/issues/11447/labels{/name}", "comments_url": "https://api.github.com/repos/pytorch/pytorch/issues/11447/comments", "events_url": "https://api.github.com/repos/pytorch/pytorch/issues/11447/events", "html_url": "https://github.com/pytorch/pytorch/issues/11447", "id": 358472907, "node_id": "MDU6SXNzdWUzNTg0NzI5MDc=", "number": 11447, "title": "Current master doesn't link against nvToolsExt", "user": {"login": "leomao", "id": 1811303, "node_id": "MDQ6VXNlcjE4MTEzMDM=", "avatar_url": "https://avatars3.githubusercontent.com/u/1811303?v=4", "gravatar_id": "", "url": "https://api.github.com/users/leomao", "html_url": "https://github.com/leomao", "followers_url": "https://api.github.com/users/leomao/followers", "following_url": "https://api.github.com/users/leomao/following{/other_user}", "gists_url": "https://api.github.com/users/leomao/gists{/gist_id}", "starred_url": "https://api.github.com/users/leomao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/leomao/subscriptions", "organizations_url": "https://api.github.com/users/leomao/orgs", "repos_url": "https://api.github.com/users/leomao/repos", "events_url": "https://api.github.com/users/leomao/events{/privacy}", "received_events_url": "https://api.github.com/users/leomao/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 679952949, "node_id": "MDU6TGFiZWw2Nzk5NTI5NDk=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/binaries", "name": "binaries", "color": "e99695", "default": false}, {"id": 1002715609, "node_id": "MDU6TGFiZWwxMDAyNzE1NjA5", "url": "https://api.github.com/repos/pytorch/pytorch/labels/blocker", "name": "blocker", "color": "b60205", "default": false}, {"id": 443484135, "node_id": "MDU6TGFiZWw0NDM0ODQxMzU=", "url": "https://api.github.com/repos/pytorch/pytorch/labels/high%20priority", "name": "high priority", "color": "F22613", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "anderspapitto", "id": 1388690, "node_id": "MDQ6VXNlcjEzODg2OTA=", "avatar_url": "https://avatars3.githubusercontent.com/u/1388690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anderspapitto", "html_url": "https://github.com/anderspapitto", "followers_url": "https://api.github.com/users/anderspapitto/followers", "following_url": "https://api.github.com/users/anderspapitto/following{/other_user}", "gists_url": "https://api.github.com/users/anderspapitto/gists{/gist_id}", "starred_url": "https://api.github.com/users/anderspapitto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anderspapitto/subscriptions", "organizations_url": "https://api.github.com/users/anderspapitto/orgs", "repos_url": "https://api.github.com/users/anderspapitto/repos", "events_url": "https://api.github.com/users/anderspapitto/events{/privacy}", "received_events_url": "https://api.github.com/users/anderspapitto/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "anderspapitto", "id": 1388690, "node_id": "MDQ6VXNlcjEzODg2OTA=", "avatar_url": "https://avatars3.githubusercontent.com/u/1388690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anderspapitto", "html_url": "https://github.com/anderspapitto", "followers_url": "https://api.github.com/users/anderspapitto/followers", "following_url": "https://api.github.com/users/anderspapitto/following{/other_user}", "gists_url": "https://api.github.com/users/anderspapitto/gists{/gist_id}", "starred_url": "https://api.github.com/users/anderspapitto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anderspapitto/subscriptions", "organizations_url": "https://api.github.com/users/anderspapitto/orgs", "repos_url": "https://api.github.com/users/anderspapitto/repos", "events_url": "https://api.github.com/users/anderspapitto/events{/privacy}", "received_events_url": "https://api.github.com/users/anderspapitto/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2018-09-10T05:25:58Z", "updated_at": "2018-09-12T13:38:20Z", "closed_at": "2018-09-12T13:38:19Z", "author_association": "NONE", "body_html": "<h2>Issue description</h2>\n<p>I compile source from master with cuda 9.2.<br>\n<code>import torch</code> yields <code>undefined symbol: nvtxMarkA</code> error.<br>\nThis symbol is used in <code>libtorch.so</code> (check via <code>nm -D lib/libtorch.so</code>)</p>\n<p>It seems to be related to <div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/pytorch/pytorch/blob/560d6efd3a02a4314c6c506d6a977b1d875bc03c/torch/CMakeLists.txt#L338\">pytorch/torch/CMakeLists.txt</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n         Line 338\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/pytorch/pytorch/commit/560d6efd3a02a4314c6c506d6a977b1d875bc03c\">560d6ef</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L338\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"338\"></td>\n          <td id=\"LC338\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-c1\">target_link_libraries</span>(torch caffe2_gpu_library <span class=\"pl-smi\">${CUDA_LIBRARIES}</span>) </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>\n<p>After changing <code>CUDA_LIBRARIES</code> to <code>TORCH_CUDA_LIBRARIES</code>, <code>libtorch.so</code> is correctly linked against nvToolsExt and <code>import torch</code> works.</p>\n<h2>System Info</h2>\n<ul>\n<li>PyTorch or Caffe2: Pytorch</li>\n<li>How you installed PyTorch (conda, pip, source): source</li>\n<li>Build command you used (if compiling from source):</li>\n</ul>\n<pre><code>CC=gcc-7 \\\nCXX=g++-7 \\\nMAGMA_HOME=/opt/magma \\                                                        \nUSE_CUDA=1 \\                                                                   \nCUDA_HOME=/opt/cuda \\                                                          \nUSE_CUDNN=1 \\                                                                  \nCUDNN_LIB_DIR=/opt/cuda/lib64 \\                                                \nCUDNN_INCLUDE_DIR=/opt/cuda/include \\                                          \nNCCL_LIB_DIR=/opt/cuda/lib64 \\                                                 \nNCCL_INCLUDE_DIR=/opt/cuda/include \\                                           \nTORCH_NVCC_FLAGS=\"-Xfatbin -compress-all -D__CUDA_NO_HALF_OPERATORS__\" \\\npython setup.py build\n</code></pre>\n<ul>\n<li>OS: Arch Linux</li>\n<li>PyTorch version: master (<a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/pytorch/pytorch/commit/560d6efd3a02a4314c6c506d6a977b1d875bc03c/hovercard\" href=\"https://github.com/pytorch/pytorch/commit/560d6efd3a02a4314c6c506d6a977b1d875bc03c\"><tt>560d6ef</tt></a>)</li>\n<li>Python version: 3.7</li>\n<li>CUDA/cuDNN version: 9.2.148 / 7.2.1</li>\n<li>GPU models and configuration: (Not relevant)</li>\n<li>GCC version (if compiling from source): 7.3.1</li>\n<li>CMake version: 3.12.1</li>\n<li>Versions of any other relevant libraries:\n<ul>\n<li>Intel MKL 2018.3.222</li>\n<li>MAGMA 2.4</li>\n</ul>\n</li>\n</ul>", "body_text": "Issue description\nI compile source from master with cuda 9.2.\nimport torch yields undefined symbol: nvtxMarkA error.\nThis symbol is used in libtorch.so (check via nm -D lib/libtorch.so)\nIt seems to be related to \n  \n    \n      pytorch/torch/CMakeLists.txt\n    \n    \n         Line 338\n      in\n      560d6ef\n    \n    \n    \n    \n\n        \n          \n           target_link_libraries(torch caffe2_gpu_library ${CUDA_LIBRARIES}) \n        \n    \n  \n\n\nAfter changing CUDA_LIBRARIES to TORCH_CUDA_LIBRARIES, libtorch.so is correctly linked against nvToolsExt and import torch works.\nSystem Info\n\nPyTorch or Caffe2: Pytorch\nHow you installed PyTorch (conda, pip, source): source\nBuild command you used (if compiling from source):\n\nCC=gcc-7 \\\nCXX=g++-7 \\\nMAGMA_HOME=/opt/magma \\                                                        \nUSE_CUDA=1 \\                                                                   \nCUDA_HOME=/opt/cuda \\                                                          \nUSE_CUDNN=1 \\                                                                  \nCUDNN_LIB_DIR=/opt/cuda/lib64 \\                                                \nCUDNN_INCLUDE_DIR=/opt/cuda/include \\                                          \nNCCL_LIB_DIR=/opt/cuda/lib64 \\                                                 \nNCCL_INCLUDE_DIR=/opt/cuda/include \\                                           \nTORCH_NVCC_FLAGS=\"-Xfatbin -compress-all -D__CUDA_NO_HALF_OPERATORS__\" \\\npython setup.py build\n\n\nOS: Arch Linux\nPyTorch version: master (560d6ef)\nPython version: 3.7\nCUDA/cuDNN version: 9.2.148 / 7.2.1\nGPU models and configuration: (Not relevant)\nGCC version (if compiling from source): 7.3.1\nCMake version: 3.12.1\nVersions of any other relevant libraries:\n\nIntel MKL 2018.3.222\nMAGMA 2.4", "body": "## Issue description\r\n\r\nI compile source from master with cuda 9.2.\r\n`import torch` yields `undefined symbol: nvtxMarkA` error.\r\nThis symbol is used in `libtorch.so` (check via `nm -D lib/libtorch.so`)\r\n\r\nIt seems to be related to https://github.com/pytorch/pytorch/blob/560d6efd3a02a4314c6c506d6a977b1d875bc03c/torch/CMakeLists.txt#L338\r\n\r\nAfter changing `CUDA_LIBRARIES` to `TORCH_CUDA_LIBRARIES`, `libtorch.so` is correctly linked against nvToolsExt and `import torch` works.\r\n\r\n## System Info\r\n- PyTorch or Caffe2: Pytorch\r\n- How you installed PyTorch (conda, pip, source): source\r\n- Build command you used (if compiling from source):\r\n```\r\nCC=gcc-7 \\\r\nCXX=g++-7 \\\r\nMAGMA_HOME=/opt/magma \\                                                        \r\nUSE_CUDA=1 \\                                                                   \r\nCUDA_HOME=/opt/cuda \\                                                          \r\nUSE_CUDNN=1 \\                                                                  \r\nCUDNN_LIB_DIR=/opt/cuda/lib64 \\                                                \r\nCUDNN_INCLUDE_DIR=/opt/cuda/include \\                                          \r\nNCCL_LIB_DIR=/opt/cuda/lib64 \\                                                 \r\nNCCL_INCLUDE_DIR=/opt/cuda/include \\                                           \r\nTORCH_NVCC_FLAGS=\"-Xfatbin -compress-all -D__CUDA_NO_HALF_OPERATORS__\" \\\r\npython setup.py build\r\n```\r\n- OS: Arch Linux\r\n- PyTorch version: master (560d6efd3a)\r\n- Python version: 3.7\r\n- CUDA/cuDNN version: 9.2.148 / 7.2.1\r\n- GPU models and configuration: (Not relevant)\r\n- GCC version (if compiling from source): 7.3.1\r\n- CMake version: 3.12.1\r\n- Versions of any other relevant libraries:\r\n  - Intel MKL 2018.3.222\r\n  - MAGMA 2.4\r\n"}