{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/388454669", "html_url": "https://github.com/tensorflow/tensorflow/issues/18861#issuecomment-388454669", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18861", "id": 388454669, "node_id": "MDEyOklzc3VlQ29tbWVudDM4ODQ1NDY2OQ==", "user": {"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}, "created_at": "2018-05-11T18:54:31Z", "updated_at": "2018-05-11T18:54:31Z", "author_association": "MEMBER", "body_html": "<p>Thanks <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=7693798\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rundembear\">@rundembear</a></p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=31743510\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/aaroey\">@aaroey</a> : Is it possible that the changes to support virtual devices broke this?<br>\nI see that [in the r1.5 branch](<a href=\"https://github.com/tensorflow/tensorflow/blob/r1.5/tensorflow/core/common_runtime/gpu/gpu_device.cc#L756\">https://github.com/tensorflow/tensorflow/blob/r1.5/tensorflow/core/common_runtime/gpu/gpu_device.cc#L756</a>, we're creating <code>Device*</code> objects based on the <code>visible_devices_list</code> value.</p>\n<p>But by the <a href=\"https://github.com/tensorflow/tensorflow/blob/r1.6/tensorflow/core/common_runtime/gpu/gpu_device.cc#L930\">1.6 branch</a> we've started check-failing when <a href=\"https://github.com/tensorflow/tensorflow/blob/r1.6/tensorflow/core/common_runtime/gpu/gpu_id_utils.cc#L67\">there is a mapping change between <code>TfGpuId</code> and <code>CudaGpuId</code></a></p>\n<p>So I suspect this was indeed broken by <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/14cb8e14a8fb1e78e2ce623e4198972762e6e253/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/14cb8e14a8fb1e78e2ce623e4198972762e6e253\"><tt>14cb8e1</tt></a></p>\n<p>Sorry for the trouble <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=7693798\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rundembear\">@rundembear</a> - I was mistaken about which fields were process-global in 1.3.</p>", "body_text": "Thanks @rundembear\n@aaroey : Is it possible that the changes to support virtual devices broke this?\nI see that [in the r1.5 branch](https://github.com/tensorflow/tensorflow/blob/r1.5/tensorflow/core/common_runtime/gpu/gpu_device.cc#L756, we're creating Device* objects based on the visible_devices_list value.\nBut by the 1.6 branch we've started check-failing when there is a mapping change between TfGpuId and CudaGpuId\nSo I suspect this was indeed broken by 14cb8e1\nSorry for the trouble @rundembear - I was mistaken about which fields were process-global in 1.3.", "body": "Thanks @rundembear \r\n\r\n@aaroey : Is it possible that the changes to support virtual devices broke this?\r\nI see that [in the r1.5 branch](https://github.com/tensorflow/tensorflow/blob/r1.5/tensorflow/core/common_runtime/gpu/gpu_device.cc#L756, we're creating `Device*` objects based on the `visible_devices_list` value.\r\n\r\nBut by the [1.6 branch](https://github.com/tensorflow/tensorflow/blob/r1.6/tensorflow/core/common_runtime/gpu/gpu_device.cc#L930) we've started check-failing when [there is a mapping change between `TfGpuId` and `CudaGpuId`](https://github.com/tensorflow/tensorflow/blob/r1.6/tensorflow/core/common_runtime/gpu/gpu_id_utils.cc#L67)\r\n\r\nSo I suspect this was indeed broken by https://github.com/tensorflow/tensorflow/commit/14cb8e14a8fb1e78e2ce623e4198972762e6e253\r\n\r\nSorry for the trouble @rundembear - I was mistaken about which fields were process-global in 1.3."}