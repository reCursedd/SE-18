{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11069", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11069/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11069/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11069/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/11069", "id": 238714323, "node_id": "MDExOlB1bGxSZXF1ZXN0MTI3NTk2Mjg0", "number": 11069, "title": "Fix for contrib.layers test that was raising an IndexError", "user": {"login": "jalammar", "id": 1007956, "node_id": "MDQ6VXNlcjEwMDc5NTY=", "avatar_url": "https://avatars2.githubusercontent.com/u/1007956?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jalammar", "html_url": "https://github.com/jalammar", "followers_url": "https://api.github.com/users/jalammar/followers", "following_url": "https://api.github.com/users/jalammar/following{/other_user}", "gists_url": "https://api.github.com/users/jalammar/gists{/gist_id}", "starred_url": "https://api.github.com/users/jalammar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jalammar/subscriptions", "organizations_url": "https://api.github.com/users/jalammar/orgs", "repos_url": "https://api.github.com/users/jalammar/repos", "events_url": "https://api.github.com/users/jalammar/events{/privacy}", "received_events_url": "https://api.github.com/users/jalammar/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-06-27T01:37:10Z", "updated_at": "2017-06-27T20:07:05Z", "closed_at": "2017-06-27T20:07:05Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/11069", "html_url": "https://github.com/tensorflow/tensorflow/pull/11069", "diff_url": "https://github.com/tensorflow/tensorflow/pull/11069.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/11069.patch"}, "body_html": "<p>Following the discussion at <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"238411330\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/11049\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/11049/hovercard\" href=\"https://github.com/tensorflow/tensorflow/pull/11049\">#11049</a></p>\n<p>Running the <code>testSparsePartialFlatten</code> test would occasionally raise the following error:</p>\n<pre lang=\"======================================================================\"><code>ERROR: testSparsePartialFlatten (__main__.PartialFlattenTest)\nTest `_inner_flatten` on `SparseTensor`s.\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/var/lib/jenkins/workspace/tensorflow-pull-requests-cpu-python3/bazel-ci_build-cache/.cache/bazel/_bazel_jenkins/eab0d61a99b6696edb3d2aff87b585e8/execroot/workspace/bazel-out/local-py3-opt/bin/bazel_pip/tensorflow/contrib/layers/layers_test.runfiles/org_tensorflow/bazel_pip/tensorflow/contrib/layers/python/layers/layers_test.py\", line 1434, in testSparsePartialFlatten\n    expected_indices, expected_values, _ = _sparsify(reshaped_random_)\n  File \"/var/lib/jenkins/workspace/tensorflow-pull-requests-cpu-python3/bazel-ci_build-cache/.cache/bazel/_bazel_jenkins/eab0d61a99b6696edb3d2aff87b585e8/execroot/workspace/bazel-out/local-py3-opt/bin/bazel_pip/tensorflow/contrib/layers/layers_test.runfiles/org_tensorflow/bazel_pip/tensorflow/contrib/layers/python/layers/layers_test.py\", line 1399, in _sparsify\n    values = array[non_zero]\nIndexError: index 3 is out of bounds for axis 1 with size 3\n</code></pre>\n<p>This seems to be due to inconsistent behaviour from numpy.nonzero when operating on an array of over 4 dimensions. Reducing the size of the array in the test seems to eliminate the problem.</p>\n<p>Note: As the problem would only arise in some test runs, and not others. It's important that this commit be tested several times to ensure elimination of the issue.</p>", "body_text": "Following the discussion at #11049\nRunning the testSparsePartialFlatten test would occasionally raise the following error:\nERROR: testSparsePartialFlatten (__main__.PartialFlattenTest)\nTest `_inner_flatten` on `SparseTensor`s.\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/var/lib/jenkins/workspace/tensorflow-pull-requests-cpu-python3/bazel-ci_build-cache/.cache/bazel/_bazel_jenkins/eab0d61a99b6696edb3d2aff87b585e8/execroot/workspace/bazel-out/local-py3-opt/bin/bazel_pip/tensorflow/contrib/layers/layers_test.runfiles/org_tensorflow/bazel_pip/tensorflow/contrib/layers/python/layers/layers_test.py\", line 1434, in testSparsePartialFlatten\n    expected_indices, expected_values, _ = _sparsify(reshaped_random_)\n  File \"/var/lib/jenkins/workspace/tensorflow-pull-requests-cpu-python3/bazel-ci_build-cache/.cache/bazel/_bazel_jenkins/eab0d61a99b6696edb3d2aff87b585e8/execroot/workspace/bazel-out/local-py3-opt/bin/bazel_pip/tensorflow/contrib/layers/layers_test.runfiles/org_tensorflow/bazel_pip/tensorflow/contrib/layers/python/layers/layers_test.py\", line 1399, in _sparsify\n    values = array[non_zero]\nIndexError: index 3 is out of bounds for axis 1 with size 3\n\nThis seems to be due to inconsistent behaviour from numpy.nonzero when operating on an array of over 4 dimensions. Reducing the size of the array in the test seems to eliminate the problem.\nNote: As the problem would only arise in some test runs, and not others. It's important that this commit be tested several times to ensure elimination of the issue.", "body": "Following the discussion at https://github.com/tensorflow/tensorflow/pull/11049\r\n\r\nRunning the ```testSparsePartialFlatten``` test would occasionally raise the following error:\r\n\r\n```======================================================================\r\nERROR: testSparsePartialFlatten (__main__.PartialFlattenTest)\r\nTest `_inner_flatten` on `SparseTensor`s.\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/var/lib/jenkins/workspace/tensorflow-pull-requests-cpu-python3/bazel-ci_build-cache/.cache/bazel/_bazel_jenkins/eab0d61a99b6696edb3d2aff87b585e8/execroot/workspace/bazel-out/local-py3-opt/bin/bazel_pip/tensorflow/contrib/layers/layers_test.runfiles/org_tensorflow/bazel_pip/tensorflow/contrib/layers/python/layers/layers_test.py\", line 1434, in testSparsePartialFlatten\r\n    expected_indices, expected_values, _ = _sparsify(reshaped_random_)\r\n  File \"/var/lib/jenkins/workspace/tensorflow-pull-requests-cpu-python3/bazel-ci_build-cache/.cache/bazel/_bazel_jenkins/eab0d61a99b6696edb3d2aff87b585e8/execroot/workspace/bazel-out/local-py3-opt/bin/bazel_pip/tensorflow/contrib/layers/layers_test.runfiles/org_tensorflow/bazel_pip/tensorflow/contrib/layers/python/layers/layers_test.py\", line 1399, in _sparsify\r\n    values = array[non_zero]\r\nIndexError: index 3 is out of bounds for axis 1 with size 3\r\n```\r\n\r\nThis seems to be due to inconsistent behaviour from numpy.nonzero when operating on an array of over 4 dimensions. Reducing the size of the array in the test seems to eliminate the problem.\r\n\r\nNote: As the problem would only arise in some test runs, and not others. It's important that this commit be tested several times to ensure elimination of the issue."}