{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/308261533", "html_url": "https://github.com/tensorflow/tensorflow/issues/10663#issuecomment-308261533", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10663", "id": 308261533, "node_id": "MDEyOklzc3VlQ29tbWVudDMwODI2MTUzMw==", "user": {"login": "domluna", "id": 1907223, "node_id": "MDQ6VXNlcjE5MDcyMjM=", "avatar_url": "https://avatars2.githubusercontent.com/u/1907223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/domluna", "html_url": "https://github.com/domluna", "followers_url": "https://api.github.com/users/domluna/followers", "following_url": "https://api.github.com/users/domluna/following{/other_user}", "gists_url": "https://api.github.com/users/domluna/gists{/gist_id}", "starred_url": "https://api.github.com/users/domluna/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/domluna/subscriptions", "organizations_url": "https://api.github.com/users/domluna/orgs", "repos_url": "https://api.github.com/users/domluna/repos", "events_url": "https://api.github.com/users/domluna/events{/privacy}", "received_events_url": "https://api.github.com/users/domluna/received_events", "type": "User", "site_admin": false}, "created_at": "2017-06-13T22:00:42Z", "updated_at": "2017-06-13T23:47:28Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=326106\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/aselle\">@aselle</a> I'm saving it as pbtxt rather than pb because when I use a pb I get this error:</p>\n<pre><code>ubuntu@ip-172-31-31-102:~/code/segnet$ CUDA_VISIBLE_DEVICES=\"\" ~/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph --input_graph=graph.pb --output_graph=frozen.pb --output_nodes_names=Softmax --input_checkpoint=ckpt\nTraceback (most recent call last):\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 255, in &lt;module&gt;\n    app.run(main=main, argv=[sys.argv[0]] + unparsed)\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/platform/app.py\", line 48, in run\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 187, in main\n    FLAGS.variable_names_blacklist)\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 165, in freeze_graph\n    input_graph_def = _parse_input_graph_proto(input_graph, input_binary)\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 134, in _parse_input_graph_proto\n    text_format.Merge(f.read(), input_graph_def)\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/lib/io/file_io.py\", line 125, in read\n    pywrap_tensorflow.ReadFromStream(self._read_buf, length, status))\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/lib/io/file_io.py\", line 93, in _prepare_value\n    return compat.as_str_any(val)\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/util/compat.py\", line 106, in as_str_any\n    return as_str(value)\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/util/compat.py\", line 84, in as_text\n    return bytes_or_text.decode(encoding)\nUnicodeDecodeError: 'utf-8' codec can't decode byte 0xc5 in position 439: invalid continuation byte\n</code></pre>\n<p>I've tried saving with</p>\n<pre><code>tf.train.write_graph(sess.graph_def, '.', 'graph.pb', as_text=False)\n</code></pre>\n<p>and</p>\n<pre><code>with tf.gfile.GFile('graph.pb', 'rb') as f:\n    f.write(sess.graph_def.SerializeToString())\n</code></pre>\n<p>both result in the error.</p>\n<p>Any suggestions?</p>\n<p>Some more info that might be helpful, the graph has 2165 operations in it and it's a fully convolutional network using VGG16 as the base.</p>", "body_text": "@aselle I'm saving it as pbtxt rather than pb because when I use a pb I get this error:\nubuntu@ip-172-31-31-102:~/code/segnet$ CUDA_VISIBLE_DEVICES=\"\" ~/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph --input_graph=graph.pb --output_graph=frozen.pb --output_nodes_names=Softmax --input_checkpoint=ckpt\nTraceback (most recent call last):\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 255, in <module>\n    app.run(main=main, argv=[sys.argv[0]] + unparsed)\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/platform/app.py\", line 48, in run\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 187, in main\n    FLAGS.variable_names_blacklist)\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 165, in freeze_graph\n    input_graph_def = _parse_input_graph_proto(input_graph, input_binary)\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 134, in _parse_input_graph_proto\n    text_format.Merge(f.read(), input_graph_def)\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/lib/io/file_io.py\", line 125, in read\n    pywrap_tensorflow.ReadFromStream(self._read_buf, length, status))\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/lib/io/file_io.py\", line 93, in _prepare_value\n    return compat.as_str_any(val)\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/util/compat.py\", line 106, in as_str_any\n    return as_str(value)\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/util/compat.py\", line 84, in as_text\n    return bytes_or_text.decode(encoding)\nUnicodeDecodeError: 'utf-8' codec can't decode byte 0xc5 in position 439: invalid continuation byte\n\nI've tried saving with\ntf.train.write_graph(sess.graph_def, '.', 'graph.pb', as_text=False)\n\nand\nwith tf.gfile.GFile('graph.pb', 'rb') as f:\n    f.write(sess.graph_def.SerializeToString())\n\nboth result in the error.\nAny suggestions?\nSome more info that might be helpful, the graph has 2165 operations in it and it's a fully convolutional network using VGG16 as the base.", "body": "@aselle I'm saving it as pbtxt rather than pb because when I use a pb I get this error:\r\n\r\n```\r\nubuntu@ip-172-31-31-102:~/code/segnet$ CUDA_VISIBLE_DEVICES=\"\" ~/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph --input_graph=graph.pb --output_graph=frozen.pb --output_nodes_names=Softmax --input_checkpoint=ckpt\r\nTraceback (most recent call last):\r\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 255, in <module>\r\n    app.run(main=main, argv=[sys.argv[0]] + unparsed)\r\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/platform/app.py\", line 48, in run\r\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\r\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 187, in main\r\n    FLAGS.variable_names_blacklist)\r\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 165, in freeze_graph\r\n    input_graph_def = _parse_input_graph_proto(input_graph, input_binary)\r\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 134, in _parse_input_graph_proto\r\n    text_format.Merge(f.read(), input_graph_def)\r\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/lib/io/file_io.py\", line 125, in read\r\n    pywrap_tensorflow.ReadFromStream(self._read_buf, length, status))\r\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/lib/io/file_io.py\", line 93, in _prepare_value\r\n    return compat.as_str_any(val)\r\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/util/compat.py\", line 106, in as_str_any\r\n    return as_str(value)\r\n  File \"/home/ubuntu/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/util/compat.py\", line 84, in as_text\r\n    return bytes_or_text.decode(encoding)\r\nUnicodeDecodeError: 'utf-8' codec can't decode byte 0xc5 in position 439: invalid continuation byte\r\n```\r\n\r\nI've tried saving with\r\n\r\n```\r\ntf.train.write_graph(sess.graph_def, '.', 'graph.pb', as_text=False)\r\n```\r\n\r\nand\r\n\r\n```\r\nwith tf.gfile.GFile('graph.pb', 'rb') as f:\r\n    f.write(sess.graph_def.SerializeToString())\r\n```\r\n\r\nboth result in the error.\r\n\r\nAny suggestions?\r\n\r\nSome more info that might be helpful, the graph has 2165 operations in it and it's a fully convolutional network using VGG16 as the base."}