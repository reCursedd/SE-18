{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8284", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8284/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8284/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8284/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/8284", "id": 213417771, "node_id": "MDU6SXNzdWUyMTM0MTc3NzE=", "number": 8284, "title": "TF_ImportGraphDef crashes for the following graph", "user": {"login": "ajayaraman", "id": 6549485, "node_id": "MDQ6VXNlcjY1NDk0ODU=", "avatar_url": "https://avatars1.githubusercontent.com/u/6549485?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ajayaraman", "html_url": "https://github.com/ajayaraman", "followers_url": "https://api.github.com/users/ajayaraman/followers", "following_url": "https://api.github.com/users/ajayaraman/following{/other_user}", "gists_url": "https://api.github.com/users/ajayaraman/gists{/gist_id}", "starred_url": "https://api.github.com/users/ajayaraman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ajayaraman/subscriptions", "organizations_url": "https://api.github.com/users/ajayaraman/orgs", "repos_url": "https://api.github.com/users/ajayaraman/repos", "events_url": "https://api.github.com/users/ajayaraman/events{/privacy}", "received_events_url": "https://api.github.com/users/ajayaraman/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2017-03-10T18:33:43Z", "updated_at": "2017-03-14T19:12:47Z", "closed_at": "2017-03-14T19:12:47Z", "author_association": "NONE", "body_html": "<h3>What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?</h3>\n<p>None</p>\n<h3>Environment info</h3>\n<p>Operating System: Ubuntu 16.04</p>\n<p>Installed version of CUDA and cuDNN:<br>\n(please attach the output of <code>ls -l /path/to/cuda/lib/libcud*</code>):</p>\n<h4>CUDA</h4>\n<p>-rw-r--r-- 1 root root 558720 Nov 30 13:53 libcudadevrt.a<br>\nlrwxrwxrwx 1 root root     16 Nov 30 13:53 libcudart.so -&gt; libcudart.so.8.0<br>\nlrwxrwxrwx 1 root root     19 Nov 30 13:53 libcudart.so.8.0 -&gt; libcudart.so.8.0.44<br>\n-rwxr-xr-x 1 root root 415432 Nov 30 13:53 libcudart.so.8.0.44<br>\n-rw-r--r-- 1 root root 775162 Nov 30 13:53 libcudart_static.a</p>\n<h4>CUDNN</h4>\n<p>lrwxrwxrwx 1 ajayaram ajayaram       13 Nov 30 14:02 libcudnn.so -&gt; libcudnn.so.5<br>\nlrwxrwxrwx 1 ajayaram ajayaram       17 Nov 30 14:02 libcudnn.so.5 -&gt; libcudnn.so.5.1.5<br>\n-rwxrwxr-x 1 ajayaram ajayaram 79337624 Jul 27  2016 libcudnn.so.5.1.5<br>\n-rw-rw-r-- 1 ajayaram ajayaram 69756172 Jul 27  2016 libcudnn_static.a</p>\n<p>If installed from binary pip package, provide:</p>\n<ol>\n<li>A link to the pip package you installed:</li>\n<li>The output from <code>python -c \"import tensorflow; print(tensorflow.__version__)\"</code>.</li>\n</ol>\n<p>If installed from source, provide</p>\n<ol>\n<li>\n<p>The commit hash (<code>git rev-parse HEAD</code>)<br>\n<a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/29a6b4661258ef99842904d7c54993c963a8c2c0/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/29a6b4661258ef99842904d7c54993c963a8c2c0\"><tt>29a6b46</tt></a></p>\n</li>\n<li>\n<p>The output of <code>bazel version</code><br>\n.............................<br>\nBuild label: 0.4.4<br>\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar<br>\nBuild time: Wed Feb 1 18:54:21 2017 (1485975261)<br>\nBuild timestamp: 1485975261<br>\nBuild timestamp as int: 1485975261</p>\n</li>\n</ol>\n<h3>If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)</h3>\n<p><a href=\"https://github.com/tensorflow/tensorflow/files/834801/lstm_issue.zip\">lstm_issue.zip</a></p>\n<pre><code>#lstmkt.py : Write a keras model with LSTM layer to tensorflow graph\n\nfrom keras.models import Sequential\nfrom keras.layers import Input, Dense, Reshape\nfrom keras.layers.recurrent import LSTM\nfrom keras import backend as K\n\nimport tensorflow as tf\n\ndef build_model():\n  model = Sequential()\t\n  model.add(LSTM(4, input_shape= (1,1) ))  \n  model.add(Dense(1))\n  model.compile(optimizer='adam', loss='mse')\n  return model\n\nmodel = build_model()\nsess = K.get_session()\ngraph = sess.graph\nsess.run('init')\n\ntf.train.write_graph(sess.graph, './', 'lstmkt.pb', as_text=False)\n</code></pre>\n<pre><code>void free_buffer(void* data, size_t length);\nTF_Buffer* read_file(const char* file);\n\nint main()\n{\n\n    const char filename[] = \"lstmkt.pb\";\n    \n    TF_Status* s = TF_NewStatus();\n    TF_Graph* graph = TF_NewGraph();\n    TF_Buffer* graph_def = read_file(filename);\n    \n    // Import graph\n    TF_ImportGraphDefOptions* opts = TF_NewImportGraphDefOptions();\n \n    // This line of code crashes if the keras model contains an LSTM layer\n    TF_GraphImportGraphDef(graph, graph_def, opts, s);\n\n    return 0;\n}\n</code></pre>\n<h2>What other attempted solutions have you tried?</h2>\n<p>None. Stuck here. Works in python but I need to load this graph in C.</p>\n<h3>Logs or other output that would be helpful</h3>\n<p>(If logs are large, please upload as attachment or provide link).</p>\n<pre><code>Stack Trace (from fault):\n[  0] 0x00007f91b7a87338 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+63492920 _ZN10tensorflow15shape_inference16InferenceContext8WithRankENS0_11ShapeHandleEiPS2_+00000024\n[  1] 0x00007f91b66b8c88 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+42724488\n[  2] 0x00007f91b7a65a44 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+63355460 _ZNSt17_Function_handlerIFN10tensorflow6StatusEPNS0_15shape_inference16InferenceContextEEPS5_E9_M_invokeERKSt9_Any_dataOS4_+00000020\n[  3] 0x00007f91b79e2094 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+62816404 _ZN10tensorflow12ShapeRefiner7AddNodeEPKNS_4NodeE+00002996\n[  4] 0x00007f91b5bd42e5 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+31302373\n[  5] 0x00007f91b7a0dc2c /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+62995500\n[  6] 0x00007f91b7a0e6d3 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+62998227 _ZN10tensorflow14ImportGraphDefERKNS_21ImportGraphDefOptionsERKNS_8GraphDefEPNS_5GraphEPNS_12ShapeRefinerE+00000499\n[  7] 0x00007f91b5cb2434 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+32212020\n[  8] 0x00007f91b5cb52fc /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+32223996 TF_GraphImportGraphDef+00000204\n</code></pre>", "body_text": "What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\nNone\nEnvironment info\nOperating System: Ubuntu 16.04\nInstalled version of CUDA and cuDNN:\n(please attach the output of ls -l /path/to/cuda/lib/libcud*):\nCUDA\n-rw-r--r-- 1 root root 558720 Nov 30 13:53 libcudadevrt.a\nlrwxrwxrwx 1 root root     16 Nov 30 13:53 libcudart.so -> libcudart.so.8.0\nlrwxrwxrwx 1 root root     19 Nov 30 13:53 libcudart.so.8.0 -> libcudart.so.8.0.44\n-rwxr-xr-x 1 root root 415432 Nov 30 13:53 libcudart.so.8.0.44\n-rw-r--r-- 1 root root 775162 Nov 30 13:53 libcudart_static.a\nCUDNN\nlrwxrwxrwx 1 ajayaram ajayaram       13 Nov 30 14:02 libcudnn.so -> libcudnn.so.5\nlrwxrwxrwx 1 ajayaram ajayaram       17 Nov 30 14:02 libcudnn.so.5 -> libcudnn.so.5.1.5\n-rwxrwxr-x 1 ajayaram ajayaram 79337624 Jul 27  2016 libcudnn.so.5.1.5\n-rw-rw-r-- 1 ajayaram ajayaram 69756172 Jul 27  2016 libcudnn_static.a\nIf installed from binary pip package, provide:\n\nA link to the pip package you installed:\nThe output from python -c \"import tensorflow; print(tensorflow.__version__)\".\n\nIf installed from source, provide\n\n\nThe commit hash (git rev-parse HEAD)\n29a6b46\n\n\nThe output of bazel version\n.............................\nBuild label: 0.4.4\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Wed Feb 1 18:54:21 2017 (1485975261)\nBuild timestamp: 1485975261\nBuild timestamp as int: 1485975261\n\n\nIf possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\nlstm_issue.zip\n#lstmkt.py : Write a keras model with LSTM layer to tensorflow graph\n\nfrom keras.models import Sequential\nfrom keras.layers import Input, Dense, Reshape\nfrom keras.layers.recurrent import LSTM\nfrom keras import backend as K\n\nimport tensorflow as tf\n\ndef build_model():\n  model = Sequential()\t\n  model.add(LSTM(4, input_shape= (1,1) ))  \n  model.add(Dense(1))\n  model.compile(optimizer='adam', loss='mse')\n  return model\n\nmodel = build_model()\nsess = K.get_session()\ngraph = sess.graph\nsess.run('init')\n\ntf.train.write_graph(sess.graph, './', 'lstmkt.pb', as_text=False)\n\nvoid free_buffer(void* data, size_t length);\nTF_Buffer* read_file(const char* file);\n\nint main()\n{\n\n    const char filename[] = \"lstmkt.pb\";\n    \n    TF_Status* s = TF_NewStatus();\n    TF_Graph* graph = TF_NewGraph();\n    TF_Buffer* graph_def = read_file(filename);\n    \n    // Import graph\n    TF_ImportGraphDefOptions* opts = TF_NewImportGraphDefOptions();\n \n    // This line of code crashes if the keras model contains an LSTM layer\n    TF_GraphImportGraphDef(graph, graph_def, opts, s);\n\n    return 0;\n}\n\nWhat other attempted solutions have you tried?\nNone. Stuck here. Works in python but I need to load this graph in C.\nLogs or other output that would be helpful\n(If logs are large, please upload as attachment or provide link).\nStack Trace (from fault):\n[  0] 0x00007f91b7a87338 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+63492920 _ZN10tensorflow15shape_inference16InferenceContext8WithRankENS0_11ShapeHandleEiPS2_+00000024\n[  1] 0x00007f91b66b8c88 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+42724488\n[  2] 0x00007f91b7a65a44 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+63355460 _ZNSt17_Function_handlerIFN10tensorflow6StatusEPNS0_15shape_inference16InferenceContextEEPS5_E9_M_invokeERKSt9_Any_dataOS4_+00000020\n[  3] 0x00007f91b79e2094 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+62816404 _ZN10tensorflow12ShapeRefiner7AddNodeEPKNS_4NodeE+00002996\n[  4] 0x00007f91b5bd42e5 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+31302373\n[  5] 0x00007f91b7a0dc2c /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+62995500\n[  6] 0x00007f91b7a0e6d3 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+62998227 _ZN10tensorflow14ImportGraphDefERKNS_21ImportGraphDefOptionsERKNS_8GraphDefEPNS_5GraphEPNS_12ShapeRefinerE+00000499\n[  7] 0x00007f91b5cb2434 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+32212020\n[  8] 0x00007f91b5cb52fc /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+32223996 TF_GraphImportGraphDef+00000204", "body": "### What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\r\n\r\nNone\r\n\r\n### Environment info\r\nOperating System: Ubuntu 16.04 \r\n\r\nInstalled version of CUDA and cuDNN: \r\n(please attach the output of `ls -l /path/to/cuda/lib/libcud*`):\r\n\r\n#### CUDA\r\n-rw-r--r-- 1 root root 558720 Nov 30 13:53 libcudadevrt.a\r\nlrwxrwxrwx 1 root root     16 Nov 30 13:53 libcudart.so -> libcudart.so.8.0\r\nlrwxrwxrwx 1 root root     19 Nov 30 13:53 libcudart.so.8.0 -> libcudart.so.8.0.44\r\n-rwxr-xr-x 1 root root 415432 Nov 30 13:53 libcudart.so.8.0.44\r\n-rw-r--r-- 1 root root 775162 Nov 30 13:53 libcudart_static.a\r\n\r\n\r\n#### CUDNN\r\nlrwxrwxrwx 1 ajayaram ajayaram       13 Nov 30 14:02 libcudnn.so -> libcudnn.so.5\r\nlrwxrwxrwx 1 ajayaram ajayaram       17 Nov 30 14:02 libcudnn.so.5 -> libcudnn.so.5.1.5\r\n-rwxrwxr-x 1 ajayaram ajayaram 79337624 Jul 27  2016 libcudnn.so.5.1.5\r\n-rw-rw-r-- 1 ajayaram ajayaram 69756172 Jul 27  2016 libcudnn_static.a\r\n\r\nIf installed from binary pip package, provide:\r\n\r\n1. A link to the pip package you installed:\r\n2. The output from `python -c \"import tensorflow; print(tensorflow.__version__)\"`.\r\n\r\nIf installed from source, provide \r\n\r\n1. The commit hash (`git rev-parse HEAD`)\r\n29a6b4661258ef99842904d7c54993c963a8c2c0\r\n\r\n2. The output of `bazel version`\r\n.............................\r\nBuild label: 0.4.4\r\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\r\nBuild time: Wed Feb 1 18:54:21 2017 (1485975261)\r\nBuild timestamp: 1485975261\r\nBuild timestamp as int: 1485975261\r\n\r\n### If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\r\n[lstm_issue.zip](https://github.com/tensorflow/tensorflow/files/834801/lstm_issue.zip)\r\n\r\n\r\n```\r\n#lstmkt.py : Write a keras model with LSTM layer to tensorflow graph\r\n\r\nfrom keras.models import Sequential\r\nfrom keras.layers import Input, Dense, Reshape\r\nfrom keras.layers.recurrent import LSTM\r\nfrom keras import backend as K\r\n\r\nimport tensorflow as tf\r\n\r\ndef build_model():\r\n  model = Sequential()\t\r\n  model.add(LSTM(4, input_shape= (1,1) ))  \r\n  model.add(Dense(1))\r\n  model.compile(optimizer='adam', loss='mse')\r\n  return model\r\n\r\nmodel = build_model()\r\nsess = K.get_session()\r\ngraph = sess.graph\r\nsess.run('init')\r\n\r\ntf.train.write_graph(sess.graph, './', 'lstmkt.pb', as_text=False)\r\n```\r\n\r\n```\r\nvoid free_buffer(void* data, size_t length);\r\nTF_Buffer* read_file(const char* file);\r\n\r\nint main()\r\n{\r\n\r\n    const char filename[] = \"lstmkt.pb\";\r\n    \r\n    TF_Status* s = TF_NewStatus();\r\n    TF_Graph* graph = TF_NewGraph();\r\n    TF_Buffer* graph_def = read_file(filename);\r\n    \r\n    // Import graph\r\n    TF_ImportGraphDefOptions* opts = TF_NewImportGraphDefOptions();\r\n \r\n    // This line of code crashes if the keras model contains an LSTM layer\r\n    TF_GraphImportGraphDef(graph, graph_def, opts, s);\r\n\r\n    return 0;\r\n}\r\n```\r\n## What other attempted solutions have you tried?\r\nNone. Stuck here. Works in python but I need to load this graph in C.\r\n\r\n\r\n### Logs or other output that would be helpful\r\n(If logs are large, please upload as attachment or provide link).\r\n\r\n```\r\nStack Trace (from fault):\r\n[  0] 0x00007f91b7a87338 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+63492920 _ZN10tensorflow15shape_inference16InferenceContext8WithRankENS0_11ShapeHandleEiPS2_+00000024\r\n[  1] 0x00007f91b66b8c88 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+42724488\r\n[  2] 0x00007f91b7a65a44 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+63355460 _ZNSt17_Function_handlerIFN10tensorflow6StatusEPNS0_15shape_inference16InferenceContextEEPS5_E9_M_invokeERKSt9_Any_dataOS4_+00000020\r\n[  3] 0x00007f91b79e2094 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+62816404 _ZN10tensorflow12ShapeRefiner7AddNodeEPKNS_4NodeE+00002996\r\n[  4] 0x00007f91b5bd42e5 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+31302373\r\n[  5] 0x00007f91b7a0dc2c /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+62995500\r\n[  6] 0x00007f91b7a0e6d3 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+62998227 _ZN10tensorflow14ImportGraphDefERKNS_21ImportGraphDefOptionsERKNS_8GraphDefEPNS_5GraphEPNS_12ShapeRefinerE+00000499\r\n[  7] 0x00007f91b5cb2434 /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+32212020\r\n[  8] 0x00007f91b5cb52fc /home/ajayaram/tensorflow/bazel-bin/tensorflow/libtensorflow.so+32223996 TF_GraphImportGraphDef+00000204\r\n```"}