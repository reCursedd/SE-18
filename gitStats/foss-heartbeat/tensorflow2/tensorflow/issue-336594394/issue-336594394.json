{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20377", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20377/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20377/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20377/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/20377", "id": 336594394, "node_id": "MDU6SXNzdWUzMzY1OTQzOTQ=", "number": 20377, "title": "keras model to estimator in eager mode gives ValueError", "user": {"login": "kashif", "id": 8100, "node_id": "MDQ6VXNlcjgxMDA=", "avatar_url": "https://avatars0.githubusercontent.com/u/8100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kashif", "html_url": "https://github.com/kashif", "followers_url": "https://api.github.com/users/kashif/followers", "following_url": "https://api.github.com/users/kashif/following{/other_user}", "gists_url": "https://api.github.com/users/kashif/gists{/gist_id}", "starred_url": "https://api.github.com/users/kashif/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kashif/subscriptions", "organizations_url": "https://api.github.com/users/kashif/orgs", "repos_url": "https://api.github.com/users/kashif/repos", "events_url": "https://api.github.com/users/kashif/events{/privacy}", "received_events_url": "https://api.github.com/users/kashif/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "tanzhenyu", "id": 15220929, "node_id": "MDQ6VXNlcjE1MjIwOTI5", "avatar_url": "https://avatars3.githubusercontent.com/u/15220929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tanzhenyu", "html_url": "https://github.com/tanzhenyu", "followers_url": "https://api.github.com/users/tanzhenyu/followers", "following_url": "https://api.github.com/users/tanzhenyu/following{/other_user}", "gists_url": "https://api.github.com/users/tanzhenyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/tanzhenyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tanzhenyu/subscriptions", "organizations_url": "https://api.github.com/users/tanzhenyu/orgs", "repos_url": "https://api.github.com/users/tanzhenyu/repos", "events_url": "https://api.github.com/users/tanzhenyu/events{/privacy}", "received_events_url": "https://api.github.com/users/tanzhenyu/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "tanzhenyu", "id": 15220929, "node_id": "MDQ6VXNlcjE1MjIwOTI5", "avatar_url": "https://avatars3.githubusercontent.com/u/15220929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tanzhenyu", "html_url": "https://github.com/tanzhenyu", "followers_url": "https://api.github.com/users/tanzhenyu/followers", "following_url": "https://api.github.com/users/tanzhenyu/following{/other_user}", "gists_url": "https://api.github.com/users/tanzhenyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/tanzhenyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tanzhenyu/subscriptions", "organizations_url": "https://api.github.com/users/tanzhenyu/orgs", "repos_url": "https://api.github.com/users/tanzhenyu/repos", "events_url": "https://api.github.com/users/tanzhenyu/events{/privacy}", "received_events_url": "https://api.github.com/users/tanzhenyu/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 17, "created_at": "2018-06-28T12:10:27Z", "updated_at": "2018-07-12T09:46:08Z", "closed_at": "2018-07-12T09:46:08Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: no</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: OSX 10.13.4</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary</li>\n<li><strong>TensorFlow version (use command below)</strong>:  1.9.0-rc1</li>\n<li><strong>Python version</strong>:  3.6</li>\n<li><strong>Bazel version (if compiling from source)</strong>: N/A</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: N/A</li>\n<li><strong>CUDA/cuDNN version</strong>: N/A</li>\n<li><strong>GPU model and memory</strong>: N/A</li>\n<li><strong>Exact command to reproduce</strong>: N/A</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>After enabling eager mode with <code>tf.enable_eager_execution()</code> if I convert my <code>tf.keras.Model</code> to an estimator via: <code>tf.keras.estimator.model_to_estimator(model)</code> I get:</p>\n<pre><code>INFO:tensorflow:Using the Keras model provided.\nINFO:tensorflow:Using default config.\nWARNING:tensorflow:Using temporary folder as model directory: /var/folders/yg/t3pf0vds6c14zlhmq1jwwvtnsz8fsr/T/tmp197t8ju4\nINFO:tensorflow:Using config: {'_model_dir': '/var/folders/yg/t3pf0vds6c14zlhmq1jwwvtnsz8fsr/T/tmp197t8ju4', '_tf_random_seed': None, '_save_summary_steps': 100, '_save_checkpoints_steps': None, '_save_checkpoints_secs': 600, '_session_config': None, '_keep_checkpoint_max': 5, '_keep_checkpoint_every_n_hours': 10000, '_log_step_count_steps': 100, '_train_distribute': None, '_device_fn': None, '_service': None, '_cluster_spec': &lt;tensorflow.python.training.server_lib.ClusterSpec object at 0x1227bcdd8&gt;, '_task_type': 'worker', '_task_id': 0, '_global_id_in_cluster': 0, '_master': '', '_evaluation_master': '', '_is_chief': True, '_num_ps_replicas': 0, '_num_worker_replicas': 1}\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n&lt;ipython-input-8-6cc0c716ca8a&gt; in &lt;module&gt;()\n----&gt; 1 estimator = tf.keras.estimator.model_to_estimator(model)\n\n/usr/local/lib/python3.6/site-packages/tensorflow/python/estimator/keras.py in model_to_estimator(keras_model, keras_model_path, custom_objects, model_dir, config)\n    512 \n    513   # Check if we need to call get_weights:\n--&gt; 514   if _any_variable_initialized():\n    515     keras_weights = keras_model.get_weights()\n    516     # Warn if config passed to estimator tries to update GPUOptions. If a\n\n/usr/local/lib/python3.6/site-packages/tensorflow/python/estimator/keras.py in _any_variable_initialized()\n     77     boolean, True if at least one variable has been initialized, else False.\n     78   \"\"\"\n---&gt; 79   variables = variables_module.global_variables()\n     80   for v in variables:\n     81     if getattr(v, '_keras_initialized', False):\n\n/usr/local/lib/python3.6/site-packages/tensorflow/python/ops/variables.py in global_variables(scope)\n   1442     A list of `Variable` objects.\n   1443   \"\"\"\n-&gt; 1444   return ops.get_collection(ops.GraphKeys.GLOBAL_VARIABLES, scope)\n   1445 \n   1446 \n\n/usr/local/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in get_collection(key, scope)\n   5905   @end_compatibility\n   5906   \"\"\"\n-&gt; 5907   return get_default_graph().get_collection(key, scope)\n   5908 \n   5909 \n\n/usr/local/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in get_collection(self, name, scope)\n   3961       collected.\n   3962     \"\"\"  # pylint: disable=g-doc-exception\n-&gt; 3963     _assert_collection_is_ok(name)\n   3964     with self._lock:\n   3965       collection = self._collections.get(name, None)\n\n/usr/local/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in _assert_collection_is_ok(collection_name)\n   6146     if collection_name in GraphKeys._VARIABLE_COLLECTIONS:  # pylint: disable=protected-access\n   6147       raise ValueError(\n-&gt; 6148           \"variable collections are not supported when eager execution is enabled.\"\n   6149       )\n   6150 \n\nValueError: variable collections are not supported when eager execution is enabled.\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): no\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): OSX 10.13.4\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below):  1.9.0-rc1\nPython version:  3.6\nBazel version (if compiling from source): N/A\nGCC/Compiler version (if compiling from source): N/A\nCUDA/cuDNN version: N/A\nGPU model and memory: N/A\nExact command to reproduce: N/A\n\nDescribe the problem\nAfter enabling eager mode with tf.enable_eager_execution() if I convert my tf.keras.Model to an estimator via: tf.keras.estimator.model_to_estimator(model) I get:\nINFO:tensorflow:Using the Keras model provided.\nINFO:tensorflow:Using default config.\nWARNING:tensorflow:Using temporary folder as model directory: /var/folders/yg/t3pf0vds6c14zlhmq1jwwvtnsz8fsr/T/tmp197t8ju4\nINFO:tensorflow:Using config: {'_model_dir': '/var/folders/yg/t3pf0vds6c14zlhmq1jwwvtnsz8fsr/T/tmp197t8ju4', '_tf_random_seed': None, '_save_summary_steps': 100, '_save_checkpoints_steps': None, '_save_checkpoints_secs': 600, '_session_config': None, '_keep_checkpoint_max': 5, '_keep_checkpoint_every_n_hours': 10000, '_log_step_count_steps': 100, '_train_distribute': None, '_device_fn': None, '_service': None, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x1227bcdd8>, '_task_type': 'worker', '_task_id': 0, '_global_id_in_cluster': 0, '_master': '', '_evaluation_master': '', '_is_chief': True, '_num_ps_replicas': 0, '_num_worker_replicas': 1}\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-8-6cc0c716ca8a> in <module>()\n----> 1 estimator = tf.keras.estimator.model_to_estimator(model)\n\n/usr/local/lib/python3.6/site-packages/tensorflow/python/estimator/keras.py in model_to_estimator(keras_model, keras_model_path, custom_objects, model_dir, config)\n    512 \n    513   # Check if we need to call get_weights:\n--> 514   if _any_variable_initialized():\n    515     keras_weights = keras_model.get_weights()\n    516     # Warn if config passed to estimator tries to update GPUOptions. If a\n\n/usr/local/lib/python3.6/site-packages/tensorflow/python/estimator/keras.py in _any_variable_initialized()\n     77     boolean, True if at least one variable has been initialized, else False.\n     78   \"\"\"\n---> 79   variables = variables_module.global_variables()\n     80   for v in variables:\n     81     if getattr(v, '_keras_initialized', False):\n\n/usr/local/lib/python3.6/site-packages/tensorflow/python/ops/variables.py in global_variables(scope)\n   1442     A list of `Variable` objects.\n   1443   \"\"\"\n-> 1444   return ops.get_collection(ops.GraphKeys.GLOBAL_VARIABLES, scope)\n   1445 \n   1446 \n\n/usr/local/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in get_collection(key, scope)\n   5905   @end_compatibility\n   5906   \"\"\"\n-> 5907   return get_default_graph().get_collection(key, scope)\n   5908 \n   5909 \n\n/usr/local/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in get_collection(self, name, scope)\n   3961       collected.\n   3962     \"\"\"  # pylint: disable=g-doc-exception\n-> 3963     _assert_collection_is_ok(name)\n   3964     with self._lock:\n   3965       collection = self._collections.get(name, None)\n\n/usr/local/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in _assert_collection_is_ok(collection_name)\n   6146     if collection_name in GraphKeys._VARIABLE_COLLECTIONS:  # pylint: disable=protected-access\n   6147       raise ValueError(\n-> 6148           \"variable collections are not supported when eager execution is enabled.\"\n   6149       )\n   6150 \n\nValueError: variable collections are not supported when eager execution is enabled.", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: no\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: OSX 10.13.4\r\n- **TensorFlow installed from (source or binary)**: binary \r\n- **TensorFlow version (use command below)**:  1.9.0-rc1\r\n- **Python version**:  3.6\r\n- **Bazel version (if compiling from source)**: N/A\r\n- **GCC/Compiler version (if compiling from source)**: N/A\r\n- **CUDA/cuDNN version**: N/A\r\n- **GPU model and memory**: N/A\r\n- **Exact command to reproduce**: N/A\r\n\r\n### Describe the problem\r\nAfter enabling eager mode with `tf.enable_eager_execution()` if I convert my `tf.keras.Model` to an estimator via: `tf.keras.estimator.model_to_estimator(model)` I get:\r\n\r\n```\r\nINFO:tensorflow:Using the Keras model provided.\r\nINFO:tensorflow:Using default config.\r\nWARNING:tensorflow:Using temporary folder as model directory: /var/folders/yg/t3pf0vds6c14zlhmq1jwwvtnsz8fsr/T/tmp197t8ju4\r\nINFO:tensorflow:Using config: {'_model_dir': '/var/folders/yg/t3pf0vds6c14zlhmq1jwwvtnsz8fsr/T/tmp197t8ju4', '_tf_random_seed': None, '_save_summary_steps': 100, '_save_checkpoints_steps': None, '_save_checkpoints_secs': 600, '_session_config': None, '_keep_checkpoint_max': 5, '_keep_checkpoint_every_n_hours': 10000, '_log_step_count_steps': 100, '_train_distribute': None, '_device_fn': None, '_service': None, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x1227bcdd8>, '_task_type': 'worker', '_task_id': 0, '_global_id_in_cluster': 0, '_master': '', '_evaluation_master': '', '_is_chief': True, '_num_ps_replicas': 0, '_num_worker_replicas': 1}\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-8-6cc0c716ca8a> in <module>()\r\n----> 1 estimator = tf.keras.estimator.model_to_estimator(model)\r\n\r\n/usr/local/lib/python3.6/site-packages/tensorflow/python/estimator/keras.py in model_to_estimator(keras_model, keras_model_path, custom_objects, model_dir, config)\r\n    512 \r\n    513   # Check if we need to call get_weights:\r\n--> 514   if _any_variable_initialized():\r\n    515     keras_weights = keras_model.get_weights()\r\n    516     # Warn if config passed to estimator tries to update GPUOptions. If a\r\n\r\n/usr/local/lib/python3.6/site-packages/tensorflow/python/estimator/keras.py in _any_variable_initialized()\r\n     77     boolean, True if at least one variable has been initialized, else False.\r\n     78   \"\"\"\r\n---> 79   variables = variables_module.global_variables()\r\n     80   for v in variables:\r\n     81     if getattr(v, '_keras_initialized', False):\r\n\r\n/usr/local/lib/python3.6/site-packages/tensorflow/python/ops/variables.py in global_variables(scope)\r\n   1442     A list of `Variable` objects.\r\n   1443   \"\"\"\r\n-> 1444   return ops.get_collection(ops.GraphKeys.GLOBAL_VARIABLES, scope)\r\n   1445 \r\n   1446 \r\n\r\n/usr/local/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in get_collection(key, scope)\r\n   5905   @end_compatibility\r\n   5906   \"\"\"\r\n-> 5907   return get_default_graph().get_collection(key, scope)\r\n   5908 \r\n   5909 \r\n\r\n/usr/local/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in get_collection(self, name, scope)\r\n   3961       collected.\r\n   3962     \"\"\"  # pylint: disable=g-doc-exception\r\n-> 3963     _assert_collection_is_ok(name)\r\n   3964     with self._lock:\r\n   3965       collection = self._collections.get(name, None)\r\n\r\n/usr/local/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in _assert_collection_is_ok(collection_name)\r\n   6146     if collection_name in GraphKeys._VARIABLE_COLLECTIONS:  # pylint: disable=protected-access\r\n   6147       raise ValueError(\r\n-> 6148           \"variable collections are not supported when eager execution is enabled.\"\r\n   6149       )\r\n   6150 \r\n\r\nValueError: variable collections are not supported when eager execution is enabled.\r\n```"}