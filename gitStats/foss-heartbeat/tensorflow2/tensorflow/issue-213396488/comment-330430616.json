{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/330430616", "html_url": "https://github.com/tensorflow/tensorflow/issues/8277#issuecomment-330430616", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8277", "id": 330430616, "node_id": "MDEyOklzc3VlQ29tbWVudDMzMDQzMDYxNg==", "user": {"login": "tumusudheer", "id": 3826735, "node_id": "MDQ6VXNlcjM4MjY3MzU=", "avatar_url": "https://avatars3.githubusercontent.com/u/3826735?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tumusudheer", "html_url": "https://github.com/tumusudheer", "followers_url": "https://api.github.com/users/tumusudheer/followers", "following_url": "https://api.github.com/users/tumusudheer/following{/other_user}", "gists_url": "https://api.github.com/users/tumusudheer/gists{/gist_id}", "starred_url": "https://api.github.com/users/tumusudheer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tumusudheer/subscriptions", "organizations_url": "https://api.github.com/users/tumusudheer/orgs", "repos_url": "https://api.github.com/users/tumusudheer/repos", "events_url": "https://api.github.com/users/tumusudheer/events{/privacy}", "received_events_url": "https://api.github.com/users/tumusudheer/received_events", "type": "User", "site_admin": false}, "created_at": "2017-09-19T05:06:08Z", "updated_at": "2017-09-19T05:06:08Z", "author_association": "NONE", "body_html": "<p>Hi <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=51059\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/cancan101\">@cancan101</a> ,</p>\n<p>I've a net (graph) with some conv2D and maxPool operations declared using NCHW format. I've trained the net on GPUs and created some checkpoints. The graph and the model works well on GPUs when you test by restoring the checkpoints.</p>\n<p>Now I want to test the same code/graph on CPU.  The same net/graph is not working because the conv2D and maxPool operations do not run since they were declared using NCHW.<br>\nI'm getting the following error:</p>\n<pre><code>2017-09-18 17:57:48.890761: E tensorflow/core/common_runtime/executor.cc:644] Executor failed to create kernel. Invalid argument: Default MaxPoolingOp only supports NHWC.\n         [[Node: text_box_300/pool1/MaxPool = MaxPool[T=DT_FLOAT, data_format=\"NCHW\", ksize=[1, 1, 2, 2], padding=\"SAME\", strides=[1, 1, 2, 2], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](text_box_300/conv1/conv1_2/Relu)]]\n2017-09-18 17:57:48.892768: E main_textd_test.cc:457] Running model failed: Invalid argument: Default MaxPoolingOp only supports NHWC.\n         [[Node: text_box_300/pool1/MaxPool = MaxPool[T=DT_FLOAT, data_format=\"NCHW\", ksize=[1, 1, 2, 2], padding=\"SAME\", strides=[1, 1, 2, 2], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](text_box_300/conv1/conv1_2/Relu)]]\n</code></pre>\n<p>So I've modified the net so that the operations are declared using NHWC format. Is it possible to restore the same checkpoint weights with this new net/graph without retraining the new graph (that has  NHWC ops) ?</p>\n<p>finally I want to freeze the graph and have a standalone graph with weights to run/test forward pass.  I was not able to create a standalone graph using checkpoints I've got when I trained me NCHW graph and use the standalone graph on CPU for testing (running forward pass) ? Is there a way to do it ?</p>", "body_text": "Hi @cancan101 ,\nI've a net (graph) with some conv2D and maxPool operations declared using NCHW format. I've trained the net on GPUs and created some checkpoints. The graph and the model works well on GPUs when you test by restoring the checkpoints.\nNow I want to test the same code/graph on CPU.  The same net/graph is not working because the conv2D and maxPool operations do not run since they were declared using NCHW.\nI'm getting the following error:\n2017-09-18 17:57:48.890761: E tensorflow/core/common_runtime/executor.cc:644] Executor failed to create kernel. Invalid argument: Default MaxPoolingOp only supports NHWC.\n         [[Node: text_box_300/pool1/MaxPool = MaxPool[T=DT_FLOAT, data_format=\"NCHW\", ksize=[1, 1, 2, 2], padding=\"SAME\", strides=[1, 1, 2, 2], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](text_box_300/conv1/conv1_2/Relu)]]\n2017-09-18 17:57:48.892768: E main_textd_test.cc:457] Running model failed: Invalid argument: Default MaxPoolingOp only supports NHWC.\n         [[Node: text_box_300/pool1/MaxPool = MaxPool[T=DT_FLOAT, data_format=\"NCHW\", ksize=[1, 1, 2, 2], padding=\"SAME\", strides=[1, 1, 2, 2], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](text_box_300/conv1/conv1_2/Relu)]]\n\nSo I've modified the net so that the operations are declared using NHWC format. Is it possible to restore the same checkpoint weights with this new net/graph without retraining the new graph (that has  NHWC ops) ?\nfinally I want to freeze the graph and have a standalone graph with weights to run/test forward pass.  I was not able to create a standalone graph using checkpoints I've got when I trained me NCHW graph and use the standalone graph on CPU for testing (running forward pass) ? Is there a way to do it ?", "body": "Hi @cancan101 ,\r\n\r\nI've a net (graph) with some conv2D and maxPool operations declared using NCHW format. I've trained the net on GPUs and created some checkpoints. The graph and the model works well on GPUs when you test by restoring the checkpoints.\r\n\r\nNow I want to test the same code/graph on CPU.  The same net/graph is not working because the conv2D and maxPool operations do not run since they were declared using NCHW.\r\nI'm getting the following error:\r\n\r\n```\r\n2017-09-18 17:57:48.890761: E tensorflow/core/common_runtime/executor.cc:644] Executor failed to create kernel. Invalid argument: Default MaxPoolingOp only supports NHWC.\r\n         [[Node: text_box_300/pool1/MaxPool = MaxPool[T=DT_FLOAT, data_format=\"NCHW\", ksize=[1, 1, 2, 2], padding=\"SAME\", strides=[1, 1, 2, 2], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](text_box_300/conv1/conv1_2/Relu)]]\r\n2017-09-18 17:57:48.892768: E main_textd_test.cc:457] Running model failed: Invalid argument: Default MaxPoolingOp only supports NHWC.\r\n         [[Node: text_box_300/pool1/MaxPool = MaxPool[T=DT_FLOAT, data_format=\"NCHW\", ksize=[1, 1, 2, 2], padding=\"SAME\", strides=[1, 1, 2, 2], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](text_box_300/conv1/conv1_2/Relu)]]\r\n```\r\n\r\nSo I've modified the net so that the operations are declared using NHWC format. Is it possible to restore the same checkpoint weights with this new net/graph without retraining the new graph (that has  NHWC ops) ?\r\n\r\nfinally I want to freeze the graph and have a standalone graph with weights to run/test forward pass.  I was not able to create a standalone graph using checkpoints I've got when I trained me NCHW graph and use the standalone graph on CPU for testing (running forward pass) ? Is there a way to do it ?"}