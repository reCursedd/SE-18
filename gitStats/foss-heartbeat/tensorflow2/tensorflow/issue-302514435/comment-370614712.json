{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/370614712", "html_url": "https://github.com/tensorflow/tensorflow/pull/17455#issuecomment-370614712", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17455", "id": 370614712, "node_id": "MDEyOklzc3VlQ29tbWVudDM3MDYxNDcxMg==", "user": {"login": "alanhdu", "id": 1914111, "node_id": "MDQ6VXNlcjE5MTQxMTE=", "avatar_url": "https://avatars1.githubusercontent.com/u/1914111?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alanhdu", "html_url": "https://github.com/alanhdu", "followers_url": "https://api.github.com/users/alanhdu/followers", "following_url": "https://api.github.com/users/alanhdu/following{/other_user}", "gists_url": "https://api.github.com/users/alanhdu/gists{/gist_id}", "starred_url": "https://api.github.com/users/alanhdu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alanhdu/subscriptions", "organizations_url": "https://api.github.com/users/alanhdu/orgs", "repos_url": "https://api.github.com/users/alanhdu/repos", "events_url": "https://api.github.com/users/alanhdu/events{/privacy}", "received_events_url": "https://api.github.com/users/alanhdu/received_events", "type": "User", "site_admin": false}, "created_at": "2018-03-06T00:15:36Z", "updated_at": "2018-03-06T00:16:46Z", "author_association": "CONTRIBUTOR", "body_html": "<p>This PR was initially closed in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"301238801\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/17338\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/17338/hovercard\" href=\"https://github.com/tensorflow/tensorflow/pull/17338\">#17338</a> because <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=5117188\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/protoget\">@protoget</a> thought that:</p>\n<blockquote>\n<p>Internally we still need NCHW or NWHC, the data_format is later passed to gen_nn_ops.conv2d.</p>\n</blockquote>\n<p>But I've confirmed that this is actually not true: <code>tf.nn.conv1d</code> explicitly converts <code>NCW</code> and <code>NWC</code> back to <code>NCHW</code> and <code>NWHC</code>:</p>\n<p><div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/6fdb9ad1baf7686a75f9e660178f7ac595e7fc2e/tensorflow/python/ops/nn_ops.py#L2428-L2435\">tensorflow/tensorflow/python/ops/nn_ops.py</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n        Lines 2428 to 2435\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/6fdb9ad1baf7686a75f9e660178f7ac595e7fc2e\">6fdb9ad</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L2428\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"2428\"></td>\n          <td id=\"LC2428\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-k\">if</span> data_format <span class=\"pl-k\">is</span> <span class=\"pl-c1\">None</span> <span class=\"pl-k\">or</span> data_format <span class=\"pl-k\">==</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>NHWC<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">or</span> data_format <span class=\"pl-k\">==</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>NWC<span class=\"pl-pds\">\"</span></span>: </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2429\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"2429\"></td>\n          <td id=\"LC2429\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">   data_format <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>NHWC<span class=\"pl-pds\">\"</span></span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2430\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"2430\"></td>\n          <td id=\"LC2430\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">   spatial_start_dim <span class=\"pl-k\">=</span> <span class=\"pl-c1\">1</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2431\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"2431\"></td>\n          <td id=\"LC2431\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">   strides <span class=\"pl-k\">=</span> [<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">1</span>, stride, <span class=\"pl-c1\">1</span>] </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2432\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"2432\"></td>\n          <td id=\"LC2432\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-k\">elif</span> data_format <span class=\"pl-k\">==</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>NCHW<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">or</span> data_format <span class=\"pl-k\">==</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>NCW<span class=\"pl-pds\">\"</span></span>: </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2433\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"2433\"></td>\n          <td id=\"LC2433\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">   data_format <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>NCHW<span class=\"pl-pds\">\"</span></span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2434\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"2434\"></td>\n          <td id=\"LC2434\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">   spatial_start_dim <span class=\"pl-k\">=</span> <span class=\"pl-c1\">2</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2435\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"2435\"></td>\n          <td id=\"LC2435\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">   strides <span class=\"pl-k\">=</span> [<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">1</span>, stride] </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>\n<p>and has explicitly deprecated <code>NCHW</code> and NWHC` as arguments:</p>\n<p><div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/b07680459a88224fce83daa7b3b70bcc62b9c896/tensorflow/python/ops/nn_ops.py#L2366-L2375\">tensorflow/tensorflow/python/ops/nn_ops.py</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n        Lines 2366 to 2375\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/b07680459a88224fce83daa7b3b70bcc62b9c896\">b076804</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L2366\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"2366\"></td>\n          <td id=\"LC2366\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-en\">@deprecation.deprecated_arg_values</span>( </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2367\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"2367\"></td>\n          <td id=\"LC2367\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">     <span class=\"pl-c1\">None</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2368\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"2368\"></td>\n          <td id=\"LC2368\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">     <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>`NCHW` for data_format is deprecated, use `NCW` instead<span class=\"pl-pds\">\"</span></span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2369\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"2369\"></td>\n          <td id=\"LC2369\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">     <span class=\"pl-v\">warn_once</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2370\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"2370\"></td>\n          <td id=\"LC2370\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">     <span class=\"pl-v\">data_format</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>NCHW<span class=\"pl-pds\">\"</span></span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2371\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"2371\"></td>\n          <td id=\"LC2371\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-en\">@deprecation.deprecated_arg_values</span>( </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2372\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"2372\"></td>\n          <td id=\"LC2372\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">     <span class=\"pl-c1\">None</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2373\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"2373\"></td>\n          <td id=\"LC2373\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">     <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>`NHWC` for data_format is deprecated, use `NWC` instead<span class=\"pl-pds\">\"</span></span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2374\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"2374\"></td>\n          <td id=\"LC2374\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">     <span class=\"pl-v\">warn_once</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2375\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"2375\"></td>\n          <td id=\"LC2375\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">     <span class=\"pl-v\">data_format</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>NHWC<span class=\"pl-pds\">\"</span></span>) </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n.</p>", "body_text": "This PR was initially closed in #17338 because @protoget thought that:\n\nInternally we still need NCHW or NWHC, the data_format is later passed to gen_nn_ops.conv2d.\n\nBut I've confirmed that this is actually not true: tf.nn.conv1d explicitly converts NCW and NWC back to NCHW and NWHC:\n\n  \n    \n      tensorflow/tensorflow/python/ops/nn_ops.py\n    \n    \n        Lines 2428 to 2435\n      in\n      6fdb9ad\n    \n    \n    \n    \n\n        \n          \n           if data_format is None or data_format == \"NHWC\" or data_format == \"NWC\": \n        \n\n        \n          \n             data_format = \"NHWC\" \n        \n\n        \n          \n             spatial_start_dim = 1 \n        \n\n        \n          \n             strides = [1, 1, stride, 1] \n        \n\n        \n          \n           elif data_format == \"NCHW\" or data_format == \"NCW\": \n        \n\n        \n          \n             data_format = \"NCHW\" \n        \n\n        \n          \n             spatial_start_dim = 2 \n        \n\n        \n          \n             strides = [1, 1, 1, stride] \n        \n    \n  \n\n\nand has explicitly deprecated NCHW and NWHC` as arguments:\n\n  \n    \n      tensorflow/tensorflow/python/ops/nn_ops.py\n    \n    \n        Lines 2366 to 2375\n      in\n      b076804\n    \n    \n    \n    \n\n        \n          \n           @deprecation.deprecated_arg_values( \n        \n\n        \n          \n               None, \n        \n\n        \n          \n               \"`NCHW` for data_format is deprecated, use `NCW` instead\", \n        \n\n        \n          \n               warn_once=True, \n        \n\n        \n          \n               data_format=\"NCHW\") \n        \n\n        \n          \n           @deprecation.deprecated_arg_values( \n        \n\n        \n          \n               None, \n        \n\n        \n          \n               \"`NHWC` for data_format is deprecated, use `NWC` instead\", \n        \n\n        \n          \n               warn_once=True, \n        \n\n        \n          \n               data_format=\"NHWC\") \n        \n    \n  \n\n.", "body": "This PR was initially closed in #17338 because @protoget thought that:\r\n\r\n> Internally we still need NCHW or NWHC, the data_format is later passed to gen_nn_ops.conv2d.\r\n\r\nBut I've confirmed that this is actually not true: `tf.nn.conv1d` explicitly converts `NCW` and `NWC` back to `NCHW` and `NWHC`:\r\n\r\nhttps://github.com/tensorflow/tensorflow/blob/6fdb9ad1baf7686a75f9e660178f7ac595e7fc2e/tensorflow/python/ops/nn_ops.py#L2428-L2435\r\n\r\nand has explicitly deprecated `NCHW` and NWHC` as arguments:\r\n\r\nhttps://github.com/tensorflow/tensorflow/blob/b07680459a88224fce83daa7b3b70bcc62b9c896/tensorflow/python/ops/nn_ops.py#L2366-L2375.\r\n"}