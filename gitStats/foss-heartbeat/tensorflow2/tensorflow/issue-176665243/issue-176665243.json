{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4353", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4353/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4353/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4353/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/4353", "id": 176665243, "node_id": "MDU6SXNzdWUxNzY2NjUyNDM=", "number": 4353, "title": "confusion_matrix should use cast rather than convert to tensor for size", "user": {"login": "cancan101", "id": 51059, "node_id": "MDQ6VXNlcjUxMDU5", "avatar_url": "https://avatars1.githubusercontent.com/u/51059?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cancan101", "html_url": "https://github.com/cancan101", "followers_url": "https://api.github.com/users/cancan101/followers", "following_url": "https://api.github.com/users/cancan101/following{/other_user}", "gists_url": "https://api.github.com/users/cancan101/gists{/gist_id}", "starred_url": "https://api.github.com/users/cancan101/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cancan101/subscriptions", "organizations_url": "https://api.github.com/users/cancan101/orgs", "repos_url": "https://api.github.com/users/cancan101/repos", "events_url": "https://api.github.com/users/cancan101/events{/privacy}", "received_events_url": "https://api.github.com/users/cancan101/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "aquariusjay", "id": 9902093, "node_id": "MDQ6VXNlcjk5MDIwOTM=", "avatar_url": "https://avatars1.githubusercontent.com/u/9902093?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aquariusjay", "html_url": "https://github.com/aquariusjay", "followers_url": "https://api.github.com/users/aquariusjay/followers", "following_url": "https://api.github.com/users/aquariusjay/following{/other_user}", "gists_url": "https://api.github.com/users/aquariusjay/gists{/gist_id}", "starred_url": "https://api.github.com/users/aquariusjay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aquariusjay/subscriptions", "organizations_url": "https://api.github.com/users/aquariusjay/orgs", "repos_url": "https://api.github.com/users/aquariusjay/repos", "events_url": "https://api.github.com/users/aquariusjay/events{/privacy}", "received_events_url": "https://api.github.com/users/aquariusjay/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "aquariusjay", "id": 9902093, "node_id": "MDQ6VXNlcjk5MDIwOTM=", "avatar_url": "https://avatars1.githubusercontent.com/u/9902093?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aquariusjay", "html_url": "https://github.com/aquariusjay", "followers_url": "https://api.github.com/users/aquariusjay/followers", "following_url": "https://api.github.com/users/aquariusjay/following{/other_user}", "gists_url": "https://api.github.com/users/aquariusjay/gists{/gist_id}", "starred_url": "https://api.github.com/users/aquariusjay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aquariusjay/subscriptions", "organizations_url": "https://api.github.com/users/aquariusjay/orgs", "repos_url": "https://api.github.com/users/aquariusjay/repos", "events_url": "https://api.github.com/users/aquariusjay/events{/privacy}", "received_events_url": "https://api.github.com/users/aquariusjay/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2016-09-13T15:01:31Z", "updated_at": "2017-01-27T18:17:45Z", "closed_at": "2017-01-27T18:17:44Z", "author_association": "CONTRIBUTOR", "body_html": "<p>This does not work:</p>\n<pre><code>&gt;&gt;&gt; cm = tf.contrib.metrics.confusion_matrix(\n...     [1,2,3], [4,5,5], num_classes=tf.constant(3, dtype=tf.int32))\nTraceback (most recent call last):\n  File \"&lt;stdin&gt;\", line 2, in &lt;module&gt;\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/metrics/python/ops/confusion_matrix_ops.py\", line 84, in confusion_matrix\n    indices=indices, values=values, shape=shape)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 981, in __init__\n    shape = convert_to_tensor(shape, name=\"shape\", dtype=dtypes.int64)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 628, in convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 571, in _TensorTensorConversionFunction\n    % (dtype.name, t.dtype.name, str(t)))\nValueError: Tensor conversion requested dtype int64 for Tensor with dtype int32: 'Tensor(\"confusion_matrix/pack:0\", shape=(2,), dtype=int32)'\n</code></pre>\n<p>where as this does:</p>\n<pre><code>tf.contrib.metrics.confusion_matrix(\n    [1,2,3], [4,5,5], num_classes=tf.constant(3, dtype=tf.int64))\n</code></pre>\n<p>This seems related: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"152376404\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/2187\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/2187/hovercard\" href=\"https://github.com/tensorflow/tensorflow/pull/2187\">#2187</a></p>\n<p>Machine:</p>\n<pre><code> bazel version\nINFO: Reading 'startup' options from /root/.bazelrc: --batch\nExtracting Bazel installation...\nBuild label: 0.3.0\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Fri Jun 10 11:38:23 2016 (1465558703)\nBuild timestamp: 1465558703\nBuild timestamp as int: 1465558703\n</code></pre>\n<pre><code> git rev-parse HEAD\n58b37cf745c6c30d44878ddf5987c4283ed12c3c\n</code></pre>\n<pre><code>ls -l /usr/lib/x86_64-linux-gnu/libcud*\nlrwxrwxrwx 1 root root       29 Aug 12 05:11 /usr/lib/x86_64-linux-gnu/libcudnn.so -&gt; /etc/alternatives/libcudnn_so\nlrwxrwxrwx 1 root root       17 Jun 10 13:07 /usr/lib/x86_64-linux-gnu/libcudnn.so.5 -&gt; libcudnn.so.5.1.3\n-rw-r--r-- 1 root root 60696704 Jun 10 13:07 /usr/lib/x86_64-linux-gnu/libcudnn.so.5.1.3\nlrwxrwxrwx 1 root root       32 Aug 12 05:11 /usr/lib/x86_64-linux-gnu/libcudnn_static.a -&gt; /etc/alternatives/libcudnn_stlib\n-rw-r--r-- 1 root root 59715990 Jun 10 13:07 /usr/lib/x86_64-linux-gnu/libcudnn_static_v5.a\n</code></pre>\n<pre><code>I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUDA library libcublas.so.7.5 locally\nI tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUDA library libcudnn.so.5 locally\nI tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUDA library libcufft.so.7.5 locally\nI tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUDA library libcuda.so.1 locally\nI tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUDA library libcurand.so.7.5 locally\n</code></pre>", "body_text": "This does not work:\n>>> cm = tf.contrib.metrics.confusion_matrix(\n...     [1,2,3], [4,5,5], num_classes=tf.constant(3, dtype=tf.int32))\nTraceback (most recent call last):\n  File \"<stdin>\", line 2, in <module>\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/metrics/python/ops/confusion_matrix_ops.py\", line 84, in confusion_matrix\n    indices=indices, values=values, shape=shape)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 981, in __init__\n    shape = convert_to_tensor(shape, name=\"shape\", dtype=dtypes.int64)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 628, in convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 571, in _TensorTensorConversionFunction\n    % (dtype.name, t.dtype.name, str(t)))\nValueError: Tensor conversion requested dtype int64 for Tensor with dtype int32: 'Tensor(\"confusion_matrix/pack:0\", shape=(2,), dtype=int32)'\n\nwhere as this does:\ntf.contrib.metrics.confusion_matrix(\n    [1,2,3], [4,5,5], num_classes=tf.constant(3, dtype=tf.int64))\n\nThis seems related: #2187\nMachine:\n bazel version\nINFO: Reading 'startup' options from /root/.bazelrc: --batch\nExtracting Bazel installation...\nBuild label: 0.3.0\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Fri Jun 10 11:38:23 2016 (1465558703)\nBuild timestamp: 1465558703\nBuild timestamp as int: 1465558703\n\n git rev-parse HEAD\n58b37cf745c6c30d44878ddf5987c4283ed12c3c\n\nls -l /usr/lib/x86_64-linux-gnu/libcud*\nlrwxrwxrwx 1 root root       29 Aug 12 05:11 /usr/lib/x86_64-linux-gnu/libcudnn.so -> /etc/alternatives/libcudnn_so\nlrwxrwxrwx 1 root root       17 Jun 10 13:07 /usr/lib/x86_64-linux-gnu/libcudnn.so.5 -> libcudnn.so.5.1.3\n-rw-r--r-- 1 root root 60696704 Jun 10 13:07 /usr/lib/x86_64-linux-gnu/libcudnn.so.5.1.3\nlrwxrwxrwx 1 root root       32 Aug 12 05:11 /usr/lib/x86_64-linux-gnu/libcudnn_static.a -> /etc/alternatives/libcudnn_stlib\n-rw-r--r-- 1 root root 59715990 Jun 10 13:07 /usr/lib/x86_64-linux-gnu/libcudnn_static_v5.a\n\nI tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUDA library libcublas.so.7.5 locally\nI tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUDA library libcudnn.so.5 locally\nI tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUDA library libcufft.so.7.5 locally\nI tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUDA library libcuda.so.1 locally\nI tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUDA library libcurand.so.7.5 locally", "body": "This does not work:\n\n```\n>>> cm = tf.contrib.metrics.confusion_matrix(\n...     [1,2,3], [4,5,5], num_classes=tf.constant(3, dtype=tf.int32))\nTraceback (most recent call last):\n  File \"<stdin>\", line 2, in <module>\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/metrics/python/ops/confusion_matrix_ops.py\", line 84, in confusion_matrix\n    indices=indices, values=values, shape=shape)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 981, in __init__\n    shape = convert_to_tensor(shape, name=\"shape\", dtype=dtypes.int64)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 628, in convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 571, in _TensorTensorConversionFunction\n    % (dtype.name, t.dtype.name, str(t)))\nValueError: Tensor conversion requested dtype int64 for Tensor with dtype int32: 'Tensor(\"confusion_matrix/pack:0\", shape=(2,), dtype=int32)'\n```\n\nwhere as this does:\n\n```\ntf.contrib.metrics.confusion_matrix(\n    [1,2,3], [4,5,5], num_classes=tf.constant(3, dtype=tf.int64))\n```\n\nThis seems related: https://github.com/tensorflow/tensorflow/pull/2187\n\nMachine:\n\n```\n bazel version\nINFO: Reading 'startup' options from /root/.bazelrc: --batch\nExtracting Bazel installation...\nBuild label: 0.3.0\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Fri Jun 10 11:38:23 2016 (1465558703)\nBuild timestamp: 1465558703\nBuild timestamp as int: 1465558703\n```\n\n```\n git rev-parse HEAD\n58b37cf745c6c30d44878ddf5987c4283ed12c3c\n```\n\n```\nls -l /usr/lib/x86_64-linux-gnu/libcud*\nlrwxrwxrwx 1 root root       29 Aug 12 05:11 /usr/lib/x86_64-linux-gnu/libcudnn.so -> /etc/alternatives/libcudnn_so\nlrwxrwxrwx 1 root root       17 Jun 10 13:07 /usr/lib/x86_64-linux-gnu/libcudnn.so.5 -> libcudnn.so.5.1.3\n-rw-r--r-- 1 root root 60696704 Jun 10 13:07 /usr/lib/x86_64-linux-gnu/libcudnn.so.5.1.3\nlrwxrwxrwx 1 root root       32 Aug 12 05:11 /usr/lib/x86_64-linux-gnu/libcudnn_static.a -> /etc/alternatives/libcudnn_stlib\n-rw-r--r-- 1 root root 59715990 Jun 10 13:07 /usr/lib/x86_64-linux-gnu/libcudnn_static_v5.a\n```\n\n```\nI tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUDA library libcublas.so.7.5 locally\nI tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUDA library libcudnn.so.5 locally\nI tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUDA library libcufft.so.7.5 locally\nI tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUDA library libcuda.so.1 locally\nI tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUDA library libcurand.so.7.5 locally\n```\n"}