{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8328", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8328/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8328/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8328/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/8328", "id": 213616030, "node_id": "MDU6SXNzdWUyMTM2MTYwMzA=", "number": 8328, "title": "orthogonal_initializer() on GPU, horrible error message", "user": {"login": "olegklimov", "id": 18546213, "node_id": "MDQ6VXNlcjE4NTQ2MjEz", "avatar_url": "https://avatars1.githubusercontent.com/u/18546213?v=4", "gravatar_id": "", "url": "https://api.github.com/users/olegklimov", "html_url": "https://github.com/olegklimov", "followers_url": "https://api.github.com/users/olegklimov/followers", "following_url": "https://api.github.com/users/olegklimov/following{/other_user}", "gists_url": "https://api.github.com/users/olegklimov/gists{/gist_id}", "starred_url": "https://api.github.com/users/olegklimov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/olegklimov/subscriptions", "organizations_url": "https://api.github.com/users/olegklimov/orgs", "repos_url": "https://api.github.com/users/olegklimov/repos", "events_url": "https://api.github.com/users/olegklimov/events{/privacy}", "received_events_url": "https://api.github.com/users/olegklimov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}, {"id": 473173272, "node_id": "MDU6TGFiZWw0NzMxNzMyNzI=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:feature", "name": "type:feature", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2017-03-12T16:35:19Z", "updated_at": "2018-02-08T01:06:54Z", "closed_at": "2018-02-08T01:06:54Z", "author_association": "NONE", "body_html": "<p>Works fine on CPU.</p>\n<p><strong>Error message is horrible</strong>, without any hints towards <code>orthogonal_initializer</code>, or line it is used on, or GPU, or essence of the problem.</p>\n<p>Problems like this (not the first one for me) can only be handled as theory-by-theory manual search by user.</p>\n<p>Isolated example:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n<span class=\"pl-k\">import</span> numpy <span class=\"pl-k\">as</span> np\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">strange_assign</span>():\n\tconfig <span class=\"pl-k\">=</span> tf.ConfigProto()\n\tconfig.allow_soft_placement <span class=\"pl-k\">=</span> <span class=\"pl-c1\">True</span>\n\tsess <span class=\"pl-k\">=</span> tf.InteractiveSession(<span class=\"pl-v\">config</span><span class=\"pl-k\">=</span>config)\n\t<span class=\"pl-k\">with</span> tf.device(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>gpu:0<span class=\"pl-pds\">\"</span></span>):\n\t\tg1 <span class=\"pl-k\">=</span> tf.get_variable(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>g1<span class=\"pl-pds\">\"</span></span>, [<span class=\"pl-c1\">2</span>,<span class=\"pl-c1\">2</span>], tf.float32, tf.constant_initializer(<span class=\"pl-c1\">1.0</span>))\n\t\tg2 <span class=\"pl-k\">=</span> tf.get_variable(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>g2<span class=\"pl-pds\">\"</span></span>, [<span class=\"pl-c1\">2</span>,<span class=\"pl-c1\">2</span>], tf.float32, tf.zeros_initializer())\n\t\tg3 <span class=\"pl-k\">=</span> tf.get_variable(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>g3<span class=\"pl-pds\">\"</span></span>, [<span class=\"pl-c1\">2</span>,<span class=\"pl-c1\">2</span>], tf.float32, tf.ones_initializer())\n\t\tg4 <span class=\"pl-k\">=</span> tf.get_variable(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>g4<span class=\"pl-pds\">\"</span></span>, [<span class=\"pl-c1\">2</span>,<span class=\"pl-c1\">2</span>], tf.float32, tf.orthogonal_initializer(<span class=\"pl-c1\">1.0</span>))\n\t\tg5 <span class=\"pl-k\">=</span> tf.get_variable(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>g5<span class=\"pl-pds\">\"</span></span>, [<span class=\"pl-c1\">2</span>,<span class=\"pl-c1\">2</span>], tf.float32, tf.random_normal_initializer())\n\t\tg6 <span class=\"pl-k\">=</span> tf.get_variable(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>g6<span class=\"pl-pds\">\"</span></span>, [<span class=\"pl-c1\">2</span>,<span class=\"pl-c1\">2</span>], tf.float32, tf.random_uniform_initializer())\n\n\ttf.global_variables_initializer().run()\n\t<span class=\"pl-k\">for</span> test <span class=\"pl-k\">in</span> [g1,g2,g3,g4,g5,g6]:\n\t\tt <span class=\"pl-k\">=</span> sess.run(test)\n\t\t<span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ASSIGN TEST<span class=\"pl-pds\">\"</span></span>, test.name)\n\t\tph <span class=\"pl-k\">=</span> tf.placeholder(tf.float32, t.shape)\n\t\t<span class=\"pl-k\">try</span>:\n\t\t\tsess.run( [tf.assign(test, ph)] , <span class=\"pl-v\">feed_dict</span> <span class=\"pl-k\">=</span> { ph: t })\n\t\t\t<span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>OK<span class=\"pl-pds\">\"</span></span>)\n\t\t<span class=\"pl-k\">except</span>:\n\t\t\t<span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>FAIL<span class=\"pl-pds\">\"</span></span>)\n\nstrange_assign()</pre></div>\n<p>Output:</p>\n<pre><code>ASSIGN TEST g1:0\nOK\nASSIGN TEST g2:0\nOK\nASSIGN TEST g3:0\nOK\nASSIGN TEST g4:0\nE tensorflow/core/framework/op_segment.cc:53] Create kernel failed: Invalid argument: AttrValue must not have reference type value of float_ref\n\t for attr 'tensor_type'\n\t; NodeDef: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25); Op&lt;name=_Recv; signature= -&gt; tensor:tensor_type; attr=tensor_type:type; attr=tensor_name:string; attr=send_device:string; attr=send_device_incarnation:int; attr=recv_device:string; attr=client_terminated:bool,default=false; is_stateful=true&gt;\nE tensorflow/core/common_runtime/executor.cc:594] Executor failed to create kernel. Invalid argument: AttrValue must not have reference type value of float_ref\n\t for attr 'tensor_type'\n\t; NodeDef: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25); Op&lt;name=_Recv; signature= -&gt; tensor:tensor_type; attr=tensor_type:type; attr=tensor_name:string; attr=send_device:string; attr=send_device_incarnation:int; attr=recv_device:string; attr=client_terminated:bool,default=false; is_stateful=true&gt;\n\t [[Node: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25)]]\nFAIL\nASSIGN TEST g5:0\nOK\nASSIGN TEST g6:0\nOK\n</code></pre>\n<p>Error message:</p>\n<pre><code>E tensorflow/core/framework/op_segment.cc:53] Create kernel failed: Invalid argument: AttrValue must not have reference type value of float_ref\n\t for attr 'tensor_type'\n\t; NodeDef: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25); Op&lt;name=_Recv; signature= -&gt; tensor:tensor_type; attr=tensor_type:type; attr=tensor_name:string; attr=send_device:string; attr=send_device_incarnation:int; attr=recv_device:string; attr=client_terminated:bool,default=false; is_stateful=true&gt;\nE tensorflow/core/common_runtime/executor.cc:594] Executor failed to create kernel. Invalid argument: AttrValue must not have reference type value of float_ref\n\t for attr 'tensor_type'\n\t; NodeDef: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25); Op&lt;name=_Recv; signature= -&gt; tensor:tensor_type; attr=tensor_type:type; attr=tensor_name:string; attr=send_device:string; attr=send_device_incarnation:int; attr=recv_device:string; attr=client_terminated:bool,default=false; is_stateful=true&gt;\n\t [[Node: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25)]]\nTraceback (most recent call last):\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1022, in _do_call\n    return fn(*args)\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1004, in _run_fn\n    status, run_metadata)\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/contextlib.py\", line 66, in __exit__\n    next(self.gen)\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/framework/errors_impl.py\", line 466, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors_impl.InvalidArgumentError: AttrValue must not have reference type value of float_ref\n\t for attr 'tensor_type'\n\t; NodeDef: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25); Op&lt;name=_Recv; signature= -&gt; tensor:tensor_type; attr=tensor_type:type; attr=tensor_name:string; attr=send_device:string; attr=send_device_incarnation:int; attr=recv_device:string; attr=client_terminated:bool,default=false; is_stateful=true&gt;\n\t [[Node: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25)]]\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"wtf.py\", line 29, in &lt;module&gt;\n    strange_assign()\n  File \"wtf.py\", line 23, in strange_assign\n    sess.run( [tf.assign(test, ph)] , feed_dict = { ph: t })\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 767, in run\n    run_metadata_ptr)\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 965, in _run\n    feed_dict_string, options, run_metadata)\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1015, in _do_run\n    target_list, options, run_metadata)\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1035, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InvalidArgumentError: AttrValue must not have reference type value of float_ref\n\t for attr 'tensor_type'\n\t; NodeDef: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25); Op&lt;name=_Recv; signature= -&gt; tensor:tensor_type; attr=tensor_type:type; attr=tensor_name:string; attr=send_device:string; attr=send_device_incarnation:int; attr=recv_device:string; attr=client_terminated:bool,default=false; is_stateful=true&gt;\n\t [[Node: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25)]]\n</code></pre>\n<p>Versions:</p>\n<p>1.0.1</p>\n<p>/usr/local/cuda-8.0/lib64/libcudart.so.8.0.44</p>\n<p>/usr/local/cuda-8.0/lib64/libcudnn.so.5.1.5</p>", "body_text": "Works fine on CPU.\nError message is horrible, without any hints towards orthogonal_initializer, or line it is used on, or GPU, or essence of the problem.\nProblems like this (not the first one for me) can only be handled as theory-by-theory manual search by user.\nIsolated example:\nimport tensorflow as tf\nimport numpy as np\n\ndef strange_assign():\n\tconfig = tf.ConfigProto()\n\tconfig.allow_soft_placement = True\n\tsess = tf.InteractiveSession(config=config)\n\twith tf.device(\"gpu:0\"):\n\t\tg1 = tf.get_variable(\"g1\", [2,2], tf.float32, tf.constant_initializer(1.0))\n\t\tg2 = tf.get_variable(\"g2\", [2,2], tf.float32, tf.zeros_initializer())\n\t\tg3 = tf.get_variable(\"g3\", [2,2], tf.float32, tf.ones_initializer())\n\t\tg4 = tf.get_variable(\"g4\", [2,2], tf.float32, tf.orthogonal_initializer(1.0))\n\t\tg5 = tf.get_variable(\"g5\", [2,2], tf.float32, tf.random_normal_initializer())\n\t\tg6 = tf.get_variable(\"g6\", [2,2], tf.float32, tf.random_uniform_initializer())\n\n\ttf.global_variables_initializer().run()\n\tfor test in [g1,g2,g3,g4,g5,g6]:\n\t\tt = sess.run(test)\n\t\tprint(\"ASSIGN TEST\", test.name)\n\t\tph = tf.placeholder(tf.float32, t.shape)\n\t\ttry:\n\t\t\tsess.run( [tf.assign(test, ph)] , feed_dict = { ph: t })\n\t\t\tprint(\"OK\")\n\t\texcept:\n\t\t\tprint(\"FAIL\")\n\nstrange_assign()\nOutput:\nASSIGN TEST g1:0\nOK\nASSIGN TEST g2:0\nOK\nASSIGN TEST g3:0\nOK\nASSIGN TEST g4:0\nE tensorflow/core/framework/op_segment.cc:53] Create kernel failed: Invalid argument: AttrValue must not have reference type value of float_ref\n\t for attr 'tensor_type'\n\t; NodeDef: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25); Op<name=_Recv; signature= -> tensor:tensor_type; attr=tensor_type:type; attr=tensor_name:string; attr=send_device:string; attr=send_device_incarnation:int; attr=recv_device:string; attr=client_terminated:bool,default=false; is_stateful=true>\nE tensorflow/core/common_runtime/executor.cc:594] Executor failed to create kernel. Invalid argument: AttrValue must not have reference type value of float_ref\n\t for attr 'tensor_type'\n\t; NodeDef: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25); Op<name=_Recv; signature= -> tensor:tensor_type; attr=tensor_type:type; attr=tensor_name:string; attr=send_device:string; attr=send_device_incarnation:int; attr=recv_device:string; attr=client_terminated:bool,default=false; is_stateful=true>\n\t [[Node: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25)]]\nFAIL\nASSIGN TEST g5:0\nOK\nASSIGN TEST g6:0\nOK\n\nError message:\nE tensorflow/core/framework/op_segment.cc:53] Create kernel failed: Invalid argument: AttrValue must not have reference type value of float_ref\n\t for attr 'tensor_type'\n\t; NodeDef: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25); Op<name=_Recv; signature= -> tensor:tensor_type; attr=tensor_type:type; attr=tensor_name:string; attr=send_device:string; attr=send_device_incarnation:int; attr=recv_device:string; attr=client_terminated:bool,default=false; is_stateful=true>\nE tensorflow/core/common_runtime/executor.cc:594] Executor failed to create kernel. Invalid argument: AttrValue must not have reference type value of float_ref\n\t for attr 'tensor_type'\n\t; NodeDef: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25); Op<name=_Recv; signature= -> tensor:tensor_type; attr=tensor_type:type; attr=tensor_name:string; attr=send_device:string; attr=send_device_incarnation:int; attr=recv_device:string; attr=client_terminated:bool,default=false; is_stateful=true>\n\t [[Node: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25)]]\nTraceback (most recent call last):\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1022, in _do_call\n    return fn(*args)\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1004, in _run_fn\n    status, run_metadata)\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/contextlib.py\", line 66, in __exit__\n    next(self.gen)\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/framework/errors_impl.py\", line 466, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors_impl.InvalidArgumentError: AttrValue must not have reference type value of float_ref\n\t for attr 'tensor_type'\n\t; NodeDef: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25); Op<name=_Recv; signature= -> tensor:tensor_type; attr=tensor_type:type; attr=tensor_name:string; attr=send_device:string; attr=send_device_incarnation:int; attr=recv_device:string; attr=client_terminated:bool,default=false; is_stateful=true>\n\t [[Node: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25)]]\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"wtf.py\", line 29, in <module>\n    strange_assign()\n  File \"wtf.py\", line 23, in strange_assign\n    sess.run( [tf.assign(test, ph)] , feed_dict = { ph: t })\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 767, in run\n    run_metadata_ptr)\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 965, in _run\n    feed_dict_string, options, run_metadata)\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1015, in _do_run\n    target_list, options, run_metadata)\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1035, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InvalidArgumentError: AttrValue must not have reference type value of float_ref\n\t for attr 'tensor_type'\n\t; NodeDef: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25); Op<name=_Recv; signature= -> tensor:tensor_type; attr=tensor_type:type; attr=tensor_name:string; attr=send_device:string; attr=send_device_incarnation:int; attr=recv_device:string; attr=client_terminated:bool,default=false; is_stateful=true>\n\t [[Node: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25)]]\n\nVersions:\n1.0.1\n/usr/local/cuda-8.0/lib64/libcudart.so.8.0.44\n/usr/local/cuda-8.0/lib64/libcudnn.so.5.1.5", "body": "Works fine on CPU.\r\n\r\n**Error message is horrible**, without any hints towards `orthogonal_initializer`, or line it is used on, or GPU, or essence of the problem.\r\n\r\nProblems like this (not the first one for me) can only be handled as theory-by-theory manual search by user.\r\n\r\nIsolated example:\r\n\r\n```python\r\nimport tensorflow as tf\r\nimport numpy as np\r\n\r\ndef strange_assign():\r\n\tconfig = tf.ConfigProto()\r\n\tconfig.allow_soft_placement = True\r\n\tsess = tf.InteractiveSession(config=config)\r\n\twith tf.device(\"gpu:0\"):\r\n\t\tg1 = tf.get_variable(\"g1\", [2,2], tf.float32, tf.constant_initializer(1.0))\r\n\t\tg2 = tf.get_variable(\"g2\", [2,2], tf.float32, tf.zeros_initializer())\r\n\t\tg3 = tf.get_variable(\"g3\", [2,2], tf.float32, tf.ones_initializer())\r\n\t\tg4 = tf.get_variable(\"g4\", [2,2], tf.float32, tf.orthogonal_initializer(1.0))\r\n\t\tg5 = tf.get_variable(\"g5\", [2,2], tf.float32, tf.random_normal_initializer())\r\n\t\tg6 = tf.get_variable(\"g6\", [2,2], tf.float32, tf.random_uniform_initializer())\r\n\r\n\ttf.global_variables_initializer().run()\r\n\tfor test in [g1,g2,g3,g4,g5,g6]:\r\n\t\tt = sess.run(test)\r\n\t\tprint(\"ASSIGN TEST\", test.name)\r\n\t\tph = tf.placeholder(tf.float32, t.shape)\r\n\t\ttry:\r\n\t\t\tsess.run( [tf.assign(test, ph)] , feed_dict = { ph: t })\r\n\t\t\tprint(\"OK\")\r\n\t\texcept:\r\n\t\t\tprint(\"FAIL\")\r\n\r\nstrange_assign()\r\n```\r\n\r\nOutput:\r\n\r\n```\r\nASSIGN TEST g1:0\r\nOK\r\nASSIGN TEST g2:0\r\nOK\r\nASSIGN TEST g3:0\r\nOK\r\nASSIGN TEST g4:0\r\nE tensorflow/core/framework/op_segment.cc:53] Create kernel failed: Invalid argument: AttrValue must not have reference type value of float_ref\r\n\t for attr 'tensor_type'\r\n\t; NodeDef: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25); Op<name=_Recv; signature= -> tensor:tensor_type; attr=tensor_type:type; attr=tensor_name:string; attr=send_device:string; attr=send_device_incarnation:int; attr=recv_device:string; attr=client_terminated:bool,default=false; is_stateful=true>\r\nE tensorflow/core/common_runtime/executor.cc:594] Executor failed to create kernel. Invalid argument: AttrValue must not have reference type value of float_ref\r\n\t for attr 'tensor_type'\r\n\t; NodeDef: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25); Op<name=_Recv; signature= -> tensor:tensor_type; attr=tensor_type:type; attr=tensor_name:string; attr=send_device:string; attr=send_device_incarnation:int; attr=recv_device:string; attr=client_terminated:bool,default=false; is_stateful=true>\r\n\t [[Node: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25)]]\r\nFAIL\r\nASSIGN TEST g5:0\r\nOK\r\nASSIGN TEST g6:0\r\nOK\r\n```\r\n\r\n\r\nError message:\r\n\r\n```\r\nE tensorflow/core/framework/op_segment.cc:53] Create kernel failed: Invalid argument: AttrValue must not have reference type value of float_ref\r\n\t for attr 'tensor_type'\r\n\t; NodeDef: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25); Op<name=_Recv; signature= -> tensor:tensor_type; attr=tensor_type:type; attr=tensor_name:string; attr=send_device:string; attr=send_device_incarnation:int; attr=recv_device:string; attr=client_terminated:bool,default=false; is_stateful=true>\r\nE tensorflow/core/common_runtime/executor.cc:594] Executor failed to create kernel. Invalid argument: AttrValue must not have reference type value of float_ref\r\n\t for attr 'tensor_type'\r\n\t; NodeDef: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25); Op<name=_Recv; signature= -> tensor:tensor_type; attr=tensor_type:type; attr=tensor_name:string; attr=send_device:string; attr=send_device_incarnation:int; attr=recv_device:string; attr=client_terminated:bool,default=false; is_stateful=true>\r\n\t [[Node: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25)]]\r\nTraceback (most recent call last):\r\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1022, in _do_call\r\n    return fn(*args)\r\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1004, in _run_fn\r\n    status, run_metadata)\r\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/contextlib.py\", line 66, in __exit__\r\n    next(self.gen)\r\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/framework/errors_impl.py\", line 466, in raise_exception_on_not_ok_status\r\n    pywrap_tensorflow.TF_GetCode(status))\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: AttrValue must not have reference type value of float_ref\r\n\t for attr 'tensor_type'\r\n\t; NodeDef: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25); Op<name=_Recv; signature= -> tensor:tensor_type; attr=tensor_type:type; attr=tensor_name:string; attr=send_device:string; attr=send_device_incarnation:int; attr=recv_device:string; attr=client_terminated:bool,default=false; is_stateful=true>\r\n\t [[Node: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25)]]\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"wtf.py\", line 29, in <module>\r\n    strange_assign()\r\n  File \"wtf.py\", line 23, in strange_assign\r\n    sess.run( [tf.assign(test, ph)] , feed_dict = { ph: t })\r\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 767, in run\r\n    run_metadata_ptr)\r\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 965, in _run\r\n    feed_dict_string, options, run_metadata)\r\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1015, in _do_run\r\n    target_list, options, run_metadata)\r\n  File \".linuxbrew/Cellar/python3/3.5.2_3/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1035, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: AttrValue must not have reference type value of float_ref\r\n\t for attr 'tensor_type'\r\n\t; NodeDef: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25); Op<name=_Recv; signature= -> tensor:tensor_type; attr=tensor_type:type; attr=tensor_name:string; attr=send_device:string; attr=send_device_incarnation:int; attr=recv_device:string; attr=client_terminated:bool,default=false; is_stateful=true>\r\n\t [[Node: g1/_23 = _Recv[_start_time=0, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_3_g1\", tensor_type=DT_FLOAT_REF, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](^_recv_Placeholder_3_0/_25)]]\r\n```\r\n\r\nVersions:\r\n\r\n1.0.1\r\n\r\n/usr/local/cuda-8.0/lib64/libcudart.so.8.0.44\r\n\r\n/usr/local/cuda-8.0/lib64/libcudnn.so.5.1.5\r\n\r\n"}