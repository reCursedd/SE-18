{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22806", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22806/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22806/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22806/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/22806", "id": 367558948, "node_id": "MDU6SXNzdWUzNjc1NTg5NDg=", "number": 22806, "title": "tfp.bijectors.BatchNormalization ask for shape of tensor at graph construction", "user": {"login": "breadbread1984", "id": 1930282, "node_id": "MDQ6VXNlcjE5MzAyODI=", "avatar_url": "https://avatars0.githubusercontent.com/u/1930282?v=4", "gravatar_id": "", "url": "https://api.github.com/users/breadbread1984", "html_url": "https://github.com/breadbread1984", "followers_url": "https://api.github.com/users/breadbread1984/followers", "following_url": "https://api.github.com/users/breadbread1984/following{/other_user}", "gists_url": "https://api.github.com/users/breadbread1984/gists{/gist_id}", "starred_url": "https://api.github.com/users/breadbread1984/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/breadbread1984/subscriptions", "organizations_url": "https://api.github.com/users/breadbread1984/orgs", "repos_url": "https://api.github.com/users/breadbread1984/repos", "events_url": "https://api.github.com/users/breadbread1984/events{/privacy}", "received_events_url": "https://api.github.com/users/breadbread1984/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "wt-huang", "id": 42785337, "node_id": "MDQ6VXNlcjQyNzg1MzM3", "avatar_url": "https://avatars0.githubusercontent.com/u/42785337?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wt-huang", "html_url": "https://github.com/wt-huang", "followers_url": "https://api.github.com/users/wt-huang/followers", "following_url": "https://api.github.com/users/wt-huang/following{/other_user}", "gists_url": "https://api.github.com/users/wt-huang/gists{/gist_id}", "starred_url": "https://api.github.com/users/wt-huang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wt-huang/subscriptions", "organizations_url": "https://api.github.com/users/wt-huang/orgs", "repos_url": "https://api.github.com/users/wt-huang/repos", "events_url": "https://api.github.com/users/wt-huang/events{/privacy}", "received_events_url": "https://api.github.com/users/wt-huang/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "wt-huang", "id": 42785337, "node_id": "MDQ6VXNlcjQyNzg1MzM3", "avatar_url": "https://avatars0.githubusercontent.com/u/42785337?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wt-huang", "html_url": "https://github.com/wt-huang", "followers_url": "https://api.github.com/users/wt-huang/followers", "following_url": "https://api.github.com/users/wt-huang/following{/other_user}", "gists_url": "https://api.github.com/users/wt-huang/gists{/gist_id}", "starred_url": "https://api.github.com/users/wt-huang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wt-huang/subscriptions", "organizations_url": "https://api.github.com/users/wt-huang/orgs", "repos_url": "https://api.github.com/users/wt-huang/repos", "events_url": "https://api.github.com/users/wt-huang/events{/privacy}", "received_events_url": "https://api.github.com/users/wt-huang/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2018-10-07T14:19:57Z", "updated_at": "2018-10-10T18:13:59Z", "closed_at": "2018-10-10T01:10:05Z", "author_association": "NONE", "body_html": "<p>i am building a customized bijector with tfp.bijectors.BatchNormalization. when i construct the graph, the dimension of input tensor for forward function cannot be possibly fully defined, because of the unknown batch size. But bijector BatchNormalization keeps raising error message that input must have shape known at graph construction. The code is <a href=\"https://github.com/breadbread1984/glow-flow/blob/3c5645b1fa25e03110ec6d6553cb793eaf758b3f/GlowStep.py#L18\">here</a>. is it a bug or i am using it wrong?</p>\n<p>call stack when error occurs</p>\n<blockquote>\n<p>File \"C:\\Users\\yi.xie\\Documents\\glow-flow\\GlowStep.py\", line 28, in _forward<br>\nreturn self.flow.forward(x);<br>\nFile \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\bijector_impl.py\", line 764, in forward<br>\nreturn self._call_forward(x, name)<br>\nFile \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\bijector_impl.py\", line 745, in _call_forward<br>\nmapping = mapping.merge(y=self._forward(x, **kwargs))<br>\nFile \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow_probability\\python\\bijectors\\chain.py\", line 263, in _forward<br>\nx = b.forward(x, **kwargs.get(b.name, {}))<br>\nFile \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\bijector_impl.py\", line 764, in forward<br>\nreturn self._call_forward(x, name)<br>\nFile \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\bijector_impl.py\", line 745, in _call_forward<br>\nmapping = mapping.merge(y=self._forward(x, **kwargs))<br>\nFile \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow_probability\\python\\bijectors\\batch_normalization.py\", line 223, in _forward<br>\nreturn self._de_normalize(x)<br>\nFile \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow_probability\\python\\bijectors\\batch_normalization.py\", line 214, in _de_normalize<br>\nbroadcast_fn = self._get_broadcast_fn(x)<br>\nFile \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow_probability\\python\\bijectors\\batch_normalization.py\", line 188, in _get_broadcast_fn<br>\nraise ValueError(\"Input must have shape known at graph construction.\")<br>\nValueError: Input must have shape known at graph construction.</p>\n</blockquote>\n<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:windows 10</li>\n<li><strong>Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device</strong>:n/a</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>:binary</li>\n<li><strong>TensorFlow version (use command below)</strong>:1.11</li>\n<li><strong>Python version</strong>:3.6</li>\n<li><strong>Bazel version (if compiling from source)</strong>:n/a</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>:n/a</li>\n<li><strong>CUDA/cuDNN version</strong>:n/a</li>\n<li><strong>GPU model and memory</strong>:n/a</li>\n<li><strong>Exact command to reproduce</strong>:n/a</li>\n</ul>", "body_text": "i am building a customized bijector with tfp.bijectors.BatchNormalization. when i construct the graph, the dimension of input tensor for forward function cannot be possibly fully defined, because of the unknown batch size. But bijector BatchNormalization keeps raising error message that input must have shape known at graph construction. The code is here. is it a bug or i am using it wrong?\ncall stack when error occurs\n\nFile \"C:\\Users\\yi.xie\\Documents\\glow-flow\\GlowStep.py\", line 28, in _forward\nreturn self.flow.forward(x);\nFile \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\bijector_impl.py\", line 764, in forward\nreturn self._call_forward(x, name)\nFile \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\bijector_impl.py\", line 745, in _call_forward\nmapping = mapping.merge(y=self._forward(x, **kwargs))\nFile \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow_probability\\python\\bijectors\\chain.py\", line 263, in _forward\nx = b.forward(x, **kwargs.get(b.name, {}))\nFile \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\bijector_impl.py\", line 764, in forward\nreturn self._call_forward(x, name)\nFile \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\bijector_impl.py\", line 745, in _call_forward\nmapping = mapping.merge(y=self._forward(x, **kwargs))\nFile \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow_probability\\python\\bijectors\\batch_normalization.py\", line 223, in _forward\nreturn self._de_normalize(x)\nFile \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow_probability\\python\\bijectors\\batch_normalization.py\", line 214, in _de_normalize\nbroadcast_fn = self._get_broadcast_fn(x)\nFile \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow_probability\\python\\bijectors\\batch_normalization.py\", line 188, in _get_broadcast_fn\nraise ValueError(\"Input must have shape known at graph construction.\")\nValueError: Input must have shape known at graph construction.\n\nSystem information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):windows 10\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:n/a\nTensorFlow installed from (source or binary):binary\nTensorFlow version (use command below):1.11\nPython version:3.6\nBazel version (if compiling from source):n/a\nGCC/Compiler version (if compiling from source):n/a\nCUDA/cuDNN version:n/a\nGPU model and memory:n/a\nExact command to reproduce:n/a", "body": "i am building a customized bijector with tfp.bijectors.BatchNormalization. when i construct the graph, the dimension of input tensor for forward function cannot be possibly fully defined, because of the unknown batch size. But bijector BatchNormalization keeps raising error message that input must have shape known at graph construction. The code is [here](https://github.com/breadbread1984/glow-flow/blob/3c5645b1fa25e03110ec6d6553cb793eaf758b3f/GlowStep.py#L18). is it a bug or i am using it wrong?\r\n\r\ncall stack when error occurs\r\n>  File \"C:\\Users\\yi.xie\\Documents\\glow-flow\\GlowStep.py\", line 28, in _forward\r\n    return self.flow.forward(x);\r\n  File \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\bijector_impl.py\", line 764, in forward\r\n    return self._call_forward(x, name)\r\n  File \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\bijector_impl.py\", line 745, in _call_forward\r\n    mapping = mapping.merge(y=self._forward(x, **kwargs))\r\n  File \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow_probability\\python\\bijectors\\chain.py\", line 263, in _forward\r\n    x = b.forward(x, **kwargs.get(b.name, {}))\r\n  File \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\bijector_impl.py\", line 764, in forward\r\n    return self._call_forward(x, name)\r\n  File \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\bijector_impl.py\", line 745, in _call_forward\r\n    mapping = mapping.merge(y=self._forward(x, **kwargs))\r\n  File \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow_probability\\python\\bijectors\\batch_normalization.py\", line 223, in _forward\r\n    return self._de_normalize(x)\r\n  File \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow_probability\\python\\bijectors\\batch_normalization.py\", line 214, in _de_normalize\r\n    broadcast_fn = self._get_broadcast_fn(x)\r\n  File \"C:\\Users\\yi.xie\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow_probability\\python\\bijectors\\batch_normalization.py\", line 188, in _get_broadcast_fn\r\n    raise ValueError(\"Input must have shape known at graph construction.\")\r\nValueError: Input must have shape known at graph construction.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:windows 10\r\n- **Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device**:n/a\r\n- **TensorFlow installed from (source or binary)**:binary\r\n- **TensorFlow version (use command below)**:1.11\r\n- **Python version**:3.6\r\n- **Bazel version (if compiling from source)**:n/a\r\n- **GCC/Compiler version (if compiling from source)**:n/a\r\n- **CUDA/cuDNN version**:n/a\r\n- **GPU model and memory**:n/a\r\n- **Exact command to reproduce**:n/a\r\n\r\n"}