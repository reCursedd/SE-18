{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5448", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5448/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5448/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5448/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/5448", "id": 187692328, "node_id": "MDU6SXNzdWUxODc2OTIzMjg=", "number": 5448, "title": "Tensorflow hangs when initializing variables in a multi process setting", "user": {"login": "ramnath-k", "id": 2484842, "node_id": "MDQ6VXNlcjI0ODQ4NDI=", "avatar_url": "https://avatars3.githubusercontent.com/u/2484842?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ramnath-k", "html_url": "https://github.com/ramnath-k", "followers_url": "https://api.github.com/users/ramnath-k/followers", "following_url": "https://api.github.com/users/ramnath-k/following{/other_user}", "gists_url": "https://api.github.com/users/ramnath-k/gists{/gist_id}", "starred_url": "https://api.github.com/users/ramnath-k/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ramnath-k/subscriptions", "organizations_url": "https://api.github.com/users/ramnath-k/orgs", "repos_url": "https://api.github.com/users/ramnath-k/repos", "events_url": "https://api.github.com/users/ramnath-k/events{/privacy}", "received_events_url": "https://api.github.com/users/ramnath-k/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2016-11-07T11:51:15Z", "updated_at": "2017-07-13T02:39:55Z", "closed_at": "2016-11-07T23:52:13Z", "author_association": "NONE", "body_html": "<h3>What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?</h3>\n<p>Closest I found was <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"181014071\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/4767\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/4767/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/4767\">#4767</a><br>\nBut I don't intend to change the datatypes  of any variables...</p>\n<h3>Environment info</h3>\n<p>Operating System: Ubuntu 14.04</p>\n<p>Installed version of CUDA and cuDNN: CUDA 7.5 and CUDNN 4.0.7<br>\n(please attach the output of <code>ls -l /path/to/cuda/lib/libcud*</code>):<br>\n-rw-r--r-- 1 root root 189170 Aug 25 02:29 /usr/local/cuda/lib/libcudadevrt.a<br>\nlrwxrwxrwx 1 root root     16 Aug 25 02:29 /usr/local/cuda/lib/libcudart.so -&gt; libcudart.so.7.5<br>\nlrwxrwxrwx 1 root root     19 Aug 25 02:29 /usr/local/cuda/lib/libcudart.so.7.5 -&gt; libcudart.so.7.5.18<br>\n-rwxr-xr-x 1 root root 311596 Aug 25 02:29 /usr/local/cuda/lib/libcudart.so.7.5.18<br>\n-rw-r--r-- 1 root root 558020 Aug 25 02:29 /usr/local/cuda/lib/libcudart_static.a</p>\n<p>CUDNN libs are in /cuda/lib64/ (output of <code>ls -l /path/to/cuda/lib64/libcud*</code>):<br>\n-rw-r--r-- 1 root root   322936 Aug 25 02:29 /usr/local/cuda/lib64/libcudadevrt.a<br>\nlrwxrwxrwx 1 root root       16 Aug 25 02:29 /usr/local/cuda/lib64/libcudart.so -&gt; libcudart.so.7.5<br>\nlrwxrwxrwx 1 root root       19 Aug 25 02:29 /usr/local/cuda/lib64/libcudart.so.7.5 -&gt; libcudart.so.7.5.18<br>\n-rwxr-xr-x 1 root root   383336 Aug 25 02:29 /usr/local/cuda/lib64/libcudart.so.7.5.18<br>\n-rw-r--r-- 1 root root   720192 Aug 25 02:29 /usr/local/cuda/lib64/libcudart_static.a<br>\n-rwxr-xr-x 1 root root 61453024 Aug 25 02:36 /usr/local/cuda/lib64/libcudnn.so<br>\n-rwxr-xr-x 1 root root 61453024 Aug 25 02:36 /usr/local/cuda/lib64/libcudnn.so.4<br>\n-rwxr-xr-x 1 root root 61453024 Aug 25 02:36 /usr/local/cuda/lib64/libcudnn.so.4.0.7<br>\n-rw-r--r-- 1 root root 62025862 Aug 25 02:36 /usr/local/cuda/lib64/libcudnn_static.a</p>\n<p>But <strong>I have installed Tensorflow CPU only version in the virtualenv I am testing this code on</strong>, hence it might not be using CUDA at all as far as this issue is concerned (I am debugging an issue that occurred on a EC2 machine which has no GPU, by reproducing it in my local system)</p>\n<p>If installed from binary pip package, provide:</p>\n<ol>\n<li>\n<p>A link to the pip package you installed: <a href=\"https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.11.0rc2-cp27-none-linux_x86_64.whl\" rel=\"nofollow\">https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.11.0rc2-cp27-none-linux_x86_64.whl</a></p>\n</li>\n<li>\n<p>The output from <code>python -c \"import tensorflow; print(tensorflow.__version__)\"</code>.0.11.0rc2</p>\n</li>\n</ol>\n<h3>If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)</h3>\n<p>I have saved a minimal working code which reproduces this issue at <a href=\"https://gist.github.com/ramnath-k/d299964fead58c0d1e0df9c2190a4f91\">gist</a></p>\n<p>To reproduce the issue:</p>\n<ol>\n<li>Call saver.save in the main thread and checkpoint at least one tf.Variable</li>\n<li>loading this checkpoint from main thread and evaluating the variable works fine</li>\n<li>if I now launch a subprocess and try to load the checkpoint in that, Tensorflow hangs at sess.run(tf.initialize_all_variables())</li>\n</ol>\n<h3>What other attempted solutions have you tried?</h3>\n<p>I tried putting a container with names suffixed by the subprocess pid but it didn't help. I also tried a basic version of create_local_server and it didn't work too</p>\n<h3>Logs or other output that would be helpful</h3>\n<p>(If logs are large, please upload as attachment or provide link).<br>\nI don't see any errors in the console when the code hangs.</p>", "body_text": "What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\nClosest I found was #4767\nBut I don't intend to change the datatypes  of any variables...\nEnvironment info\nOperating System: Ubuntu 14.04\nInstalled version of CUDA and cuDNN: CUDA 7.5 and CUDNN 4.0.7\n(please attach the output of ls -l /path/to/cuda/lib/libcud*):\n-rw-r--r-- 1 root root 189170 Aug 25 02:29 /usr/local/cuda/lib/libcudadevrt.a\nlrwxrwxrwx 1 root root     16 Aug 25 02:29 /usr/local/cuda/lib/libcudart.so -> libcudart.so.7.5\nlrwxrwxrwx 1 root root     19 Aug 25 02:29 /usr/local/cuda/lib/libcudart.so.7.5 -> libcudart.so.7.5.18\n-rwxr-xr-x 1 root root 311596 Aug 25 02:29 /usr/local/cuda/lib/libcudart.so.7.5.18\n-rw-r--r-- 1 root root 558020 Aug 25 02:29 /usr/local/cuda/lib/libcudart_static.a\nCUDNN libs are in /cuda/lib64/ (output of ls -l /path/to/cuda/lib64/libcud*):\n-rw-r--r-- 1 root root   322936 Aug 25 02:29 /usr/local/cuda/lib64/libcudadevrt.a\nlrwxrwxrwx 1 root root       16 Aug 25 02:29 /usr/local/cuda/lib64/libcudart.so -> libcudart.so.7.5\nlrwxrwxrwx 1 root root       19 Aug 25 02:29 /usr/local/cuda/lib64/libcudart.so.7.5 -> libcudart.so.7.5.18\n-rwxr-xr-x 1 root root   383336 Aug 25 02:29 /usr/local/cuda/lib64/libcudart.so.7.5.18\n-rw-r--r-- 1 root root   720192 Aug 25 02:29 /usr/local/cuda/lib64/libcudart_static.a\n-rwxr-xr-x 1 root root 61453024 Aug 25 02:36 /usr/local/cuda/lib64/libcudnn.so\n-rwxr-xr-x 1 root root 61453024 Aug 25 02:36 /usr/local/cuda/lib64/libcudnn.so.4\n-rwxr-xr-x 1 root root 61453024 Aug 25 02:36 /usr/local/cuda/lib64/libcudnn.so.4.0.7\n-rw-r--r-- 1 root root 62025862 Aug 25 02:36 /usr/local/cuda/lib64/libcudnn_static.a\nBut I have installed Tensorflow CPU only version in the virtualenv I am testing this code on, hence it might not be using CUDA at all as far as this issue is concerned (I am debugging an issue that occurred on a EC2 machine which has no GPU, by reproducing it in my local system)\nIf installed from binary pip package, provide:\n\n\nA link to the pip package you installed: https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.11.0rc2-cp27-none-linux_x86_64.whl\n\n\nThe output from python -c \"import tensorflow; print(tensorflow.__version__)\".0.11.0rc2\n\n\nIf possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\nI have saved a minimal working code which reproduces this issue at gist\nTo reproduce the issue:\n\nCall saver.save in the main thread and checkpoint at least one tf.Variable\nloading this checkpoint from main thread and evaluating the variable works fine\nif I now launch a subprocess and try to load the checkpoint in that, Tensorflow hangs at sess.run(tf.initialize_all_variables())\n\nWhat other attempted solutions have you tried?\nI tried putting a container with names suffixed by the subprocess pid but it didn't help. I also tried a basic version of create_local_server and it didn't work too\nLogs or other output that would be helpful\n(If logs are large, please upload as attachment or provide link).\nI don't see any errors in the console when the code hangs.", "body": "### What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\r\nClosest I found was https://github.com/tensorflow/tensorflow/issues/4767\r\nBut I don't intend to change the datatypes  of any variables...\r\n\r\n### Environment info\r\nOperating System: Ubuntu 14.04\r\n\r\nInstalled version of CUDA and cuDNN: CUDA 7.5 and CUDNN 4.0.7\r\n(please attach the output of `ls -l /path/to/cuda/lib/libcud*`):\r\n-rw-r--r-- 1 root root 189170 Aug 25 02:29 /usr/local/cuda/lib/libcudadevrt.a\r\nlrwxrwxrwx 1 root root     16 Aug 25 02:29 /usr/local/cuda/lib/libcudart.so -> libcudart.so.7.5\r\nlrwxrwxrwx 1 root root     19 Aug 25 02:29 /usr/local/cuda/lib/libcudart.so.7.5 -> libcudart.so.7.5.18\r\n-rwxr-xr-x 1 root root 311596 Aug 25 02:29 /usr/local/cuda/lib/libcudart.so.7.5.18\r\n-rw-r--r-- 1 root root 558020 Aug 25 02:29 /usr/local/cuda/lib/libcudart_static.a\r\n\r\nCUDNN libs are in /cuda/lib64/ (output of `ls -l /path/to/cuda/lib64/libcud*`):\r\n-rw-r--r-- 1 root root   322936 Aug 25 02:29 /usr/local/cuda/lib64/libcudadevrt.a\r\nlrwxrwxrwx 1 root root       16 Aug 25 02:29 /usr/local/cuda/lib64/libcudart.so -> libcudart.so.7.5\r\nlrwxrwxrwx 1 root root       19 Aug 25 02:29 /usr/local/cuda/lib64/libcudart.so.7.5 -> libcudart.so.7.5.18\r\n-rwxr-xr-x 1 root root   383336 Aug 25 02:29 /usr/local/cuda/lib64/libcudart.so.7.5.18\r\n-rw-r--r-- 1 root root   720192 Aug 25 02:29 /usr/local/cuda/lib64/libcudart_static.a\r\n-rwxr-xr-x 1 root root 61453024 Aug 25 02:36 /usr/local/cuda/lib64/libcudnn.so\r\n-rwxr-xr-x 1 root root 61453024 Aug 25 02:36 /usr/local/cuda/lib64/libcudnn.so.4\r\n-rwxr-xr-x 1 root root 61453024 Aug 25 02:36 /usr/local/cuda/lib64/libcudnn.so.4.0.7\r\n-rw-r--r-- 1 root root 62025862 Aug 25 02:36 /usr/local/cuda/lib64/libcudnn_static.a\r\n\r\nBut **I have installed Tensorflow CPU only version in the virtualenv I am testing this code on**, hence it might not be using CUDA at all as far as this issue is concerned (I am debugging an issue that occurred on a EC2 machine which has no GPU, by reproducing it in my local system)\r\n \r\nIf installed from binary pip package, provide:\r\n\r\n1. A link to the pip package you installed: https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.11.0rc2-cp27-none-linux_x86_64.whl\r\n\r\n2. The output from `python -c \"import tensorflow; print(tensorflow.__version__)\"`.0.11.0rc2\r\n\r\n### If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\r\nI have saved a minimal working code which reproduces this issue at [gist](https://gist.github.com/ramnath-k/d299964fead58c0d1e0df9c2190a4f91)\r\n\r\nTo reproduce the issue:\r\n1. Call saver.save in the main thread and checkpoint at least one tf.Variable\r\n2. loading this checkpoint from main thread and evaluating the variable works fine\r\n3. if I now launch a subprocess and try to load the checkpoint in that, Tensorflow hangs at sess.run(tf.initialize_all_variables())\r\n\r\n### What other attempted solutions have you tried?\r\nI tried putting a container with names suffixed by the subprocess pid but it didn't help. I also tried a basic version of create_local_server and it didn't work too\r\n\r\n### Logs or other output that would be helpful\r\n(If logs are large, please upload as attachment or provide link).\r\nI don't see any errors in the console when the code hangs. "}