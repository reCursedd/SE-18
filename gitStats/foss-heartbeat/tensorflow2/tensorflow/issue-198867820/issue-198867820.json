{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6653", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6653/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6653/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6653/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/6653", "id": 198867820, "node_id": "MDU6SXNzdWUxOTg4Njc4MjA=", "number": 6653, "title": "Initialize variable failure when importing graph_def", "user": {"login": "DjangoPeng", "id": 16943353, "node_id": "MDQ6VXNlcjE2OTQzMzUz", "avatar_url": "https://avatars3.githubusercontent.com/u/16943353?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DjangoPeng", "html_url": "https://github.com/DjangoPeng", "followers_url": "https://api.github.com/users/DjangoPeng/followers", "following_url": "https://api.github.com/users/DjangoPeng/following{/other_user}", "gists_url": "https://api.github.com/users/DjangoPeng/gists{/gist_id}", "starred_url": "https://api.github.com/users/DjangoPeng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DjangoPeng/subscriptions", "organizations_url": "https://api.github.com/users/DjangoPeng/orgs", "repos_url": "https://api.github.com/users/DjangoPeng/repos", "events_url": "https://api.github.com/users/DjangoPeng/events{/privacy}", "received_events_url": "https://api.github.com/users/DjangoPeng/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2017-01-05T03:21:43Z", "updated_at": "2017-01-05T08:17:12Z", "closed_at": "2017-01-05T08:17:12Z", "author_association": "CONTRIBUTOR", "body_html": "<p>In r0.12, I'm trying to write a graph_def at local and import it in another server. But when I <code>session.run(a)</code> after <code>session.run(global_variables_initializer())</code>, it raises a <code>FailedPreconditionError: Attempting to use uninitialized value a</code> .</p>\n<h3>Write graph</h3>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\na <span class=\"pl-k\">=</span> tf.Variable(<span class=\"pl-c1\">1</span>, <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>a<span class=\"pl-pds\">'</span></span>, <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>tf.int32)\nb <span class=\"pl-k\">=</span> tf.Variable(<span class=\"pl-c1\">2</span>, <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>b<span class=\"pl-pds\">'</span></span>, <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>tf.int32)\nc <span class=\"pl-k\">=</span> a <span class=\"pl-k\">+</span> b\nd <span class=\"pl-k\">=</span> tf.Variable(c, <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>d<span class=\"pl-pds\">'</span></span>, <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>tf.int32)\nsess <span class=\"pl-k\">=</span> tf.Session()\ntf.train.write_graph(sess.graph, <span class=\"pl-k\">/</span>tmp<span class=\"pl-k\">/</span><span class=\"pl-c1\">PJT</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>, <span class=\"pl-pds\">'</span></span>test.pb<span class=\"pl-s\"><span class=\"pl-pds\">'</span>, as_text=False)<span class=\"pl-ii\"></span></span></pre></div>\n<h3>Import graph</h3>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n<span class=\"pl-k\">from</span> tensorflow.core.framework <span class=\"pl-k\">import</span> graph_pb2\n\ngraph_pb <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>/home/mind/PJT/test.pb<span class=\"pl-pds\">'</span></span>\ngraph_def <span class=\"pl-k\">=</span> graph_pb2.GraphDef()\n\n<span class=\"pl-k\">with</span> <span class=\"pl-c1\">open</span>(graph_pb, <span class=\"pl-s\"><span class=\"pl-pds\">'</span>rb<span class=\"pl-pds\">'</span></span>) <span class=\"pl-k\">as</span> f:\n    graph_def.ParseFromString(f.read())\n\ntf.import_graph_def(graph_def, <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span><span class=\"pl-pds\">'</span></span>)\nsess <span class=\"pl-k\">=</span> tf.Session()\na <span class=\"pl-k\">=</span> sess.graph.get_tensor_by_name(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>a:0<span class=\"pl-pds\">'</span></span>)\nsess.run(tf.global_variables_initializer())\nsess.run(a)</pre></div>\n<h3>Error log</h3>\n<pre><code>FailedPreconditionErrorTraceback (most recent call last)\n&lt;ipython-input-43-574ff7291e3a&gt; in &lt;module&gt;()\n      2 a = sess.graph.get_tensor_by_name('a:0')\n      3 sess.run(tf.global_variables_initializer())\n----&gt; 4 sess.run(a)\n\n/home/mind/anaconda2/envs/tf_0.12/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in run(self, fetches, feed_dict, options, run_metadata)\n    764     try:\n    765       result = self._run(None, fetches, feed_dict, options_ptr,\n--&gt; 766                          run_metadata_ptr)\n    767       if run_metadata:\n    768         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)\n\n/home/mind/anaconda2/envs/tf_0.12/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in _run(self, handle, fetches, feed_dict, options, run_metadata)\n    962     if final_fetches or final_targets:\n    963       results = self._do_run(handle, final_targets, final_fetches,\n--&gt; 964                              feed_dict_string, options, run_metadata)\n    965     else:\n    966       results = []\n\n/home/mind/anaconda2/envs/tf_0.12/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)\n   1012     if handle is None:\n   1013       return self._do_call(_run_fn, self._session, feed_dict, fetch_list,\n-&gt; 1014                            target_list, options, run_metadata)\n   1015     else:\n   1016       return self._do_call(_prun_fn, self._session, handle, feed_dict,\n\n/home/mind/anaconda2/envs/tf_0.12/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in _do_call(self, fn, *args)\n   1032         except KeyError:\n   1033           pass\n-&gt; 1034       raise type(e)(node_def, op, message)\n   1035 \n   1036   def _extend_graph(self):\n\nFailedPreconditionError: Attempting to use uninitialized value a\n\t [[Node: _send_a_0 = _Send[T=DT_INT32, client_terminated=true, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=784291433964173963, tensor_name=\"a:0\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](a)]]\n</code></pre>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=192142\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/mrry\">@mrry</a> Could you have a look?</p>", "body_text": "In r0.12, I'm trying to write a graph_def at local and import it in another server. But when I session.run(a) after session.run(global_variables_initializer()), it raises a FailedPreconditionError: Attempting to use uninitialized value a .\nWrite graph\nimport tensorflow as tf\n\na = tf.Variable(1, name='a', dtype=tf.int32)\nb = tf.Variable(2, name='b', dtype=tf.int32)\nc = a + b\nd = tf.Variable(c, name='d', dtype=tf.int32)\nsess = tf.Session()\ntf.train.write_graph(sess.graph, /tmp/PJT', 'test.pb', as_text=False)\nImport graph\nimport tensorflow as tf\nfrom tensorflow.core.framework import graph_pb2\n\ngraph_pb = '/home/mind/PJT/test.pb'\ngraph_def = graph_pb2.GraphDef()\n\nwith open(graph_pb, 'rb') as f:\n    graph_def.ParseFromString(f.read())\n\ntf.import_graph_def(graph_def, name='')\nsess = tf.Session()\na = sess.graph.get_tensor_by_name('a:0')\nsess.run(tf.global_variables_initializer())\nsess.run(a)\nError log\nFailedPreconditionErrorTraceback (most recent call last)\n<ipython-input-43-574ff7291e3a> in <module>()\n      2 a = sess.graph.get_tensor_by_name('a:0')\n      3 sess.run(tf.global_variables_initializer())\n----> 4 sess.run(a)\n\n/home/mind/anaconda2/envs/tf_0.12/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in run(self, fetches, feed_dict, options, run_metadata)\n    764     try:\n    765       result = self._run(None, fetches, feed_dict, options_ptr,\n--> 766                          run_metadata_ptr)\n    767       if run_metadata:\n    768         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)\n\n/home/mind/anaconda2/envs/tf_0.12/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in _run(self, handle, fetches, feed_dict, options, run_metadata)\n    962     if final_fetches or final_targets:\n    963       results = self._do_run(handle, final_targets, final_fetches,\n--> 964                              feed_dict_string, options, run_metadata)\n    965     else:\n    966       results = []\n\n/home/mind/anaconda2/envs/tf_0.12/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)\n   1012     if handle is None:\n   1013       return self._do_call(_run_fn, self._session, feed_dict, fetch_list,\n-> 1014                            target_list, options, run_metadata)\n   1015     else:\n   1016       return self._do_call(_prun_fn, self._session, handle, feed_dict,\n\n/home/mind/anaconda2/envs/tf_0.12/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in _do_call(self, fn, *args)\n   1032         except KeyError:\n   1033           pass\n-> 1034       raise type(e)(node_def, op, message)\n   1035 \n   1036   def _extend_graph(self):\n\nFailedPreconditionError: Attempting to use uninitialized value a\n\t [[Node: _send_a_0 = _Send[T=DT_INT32, client_terminated=true, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=784291433964173963, tensor_name=\"a:0\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](a)]]\n\n@mrry Could you have a look?", "body": "In r0.12, I'm trying to write a graph_def at local and import it in another server. But when I `session.run(a)` after `session.run(global_variables_initializer())`, it raises a `FailedPreconditionError: Attempting to use uninitialized value a` .\r\n\r\n### Write graph\r\n```python\r\nimport tensorflow as tf\r\n\r\na = tf.Variable(1, name='a', dtype=tf.int32)\r\nb = tf.Variable(2, name='b', dtype=tf.int32)\r\nc = a + b\r\nd = tf.Variable(c, name='d', dtype=tf.int32)\r\nsess = tf.Session()\r\ntf.train.write_graph(sess.graph, /tmp/PJT', 'test.pb', as_text=False)\r\n```\r\n### Import graph\r\n```python\r\nimport tensorflow as tf\r\nfrom tensorflow.core.framework import graph_pb2\r\n\r\ngraph_pb = '/home/mind/PJT/test.pb'\r\ngraph_def = graph_pb2.GraphDef()\r\n\r\nwith open(graph_pb, 'rb') as f:\r\n    graph_def.ParseFromString(f.read())\r\n\r\ntf.import_graph_def(graph_def, name='')\r\nsess = tf.Session()\r\na = sess.graph.get_tensor_by_name('a:0')\r\nsess.run(tf.global_variables_initializer())\r\nsess.run(a)\r\n```\r\n### Error log\r\n```\r\nFailedPreconditionErrorTraceback (most recent call last)\r\n<ipython-input-43-574ff7291e3a> in <module>()\r\n      2 a = sess.graph.get_tensor_by_name('a:0')\r\n      3 sess.run(tf.global_variables_initializer())\r\n----> 4 sess.run(a)\r\n\r\n/home/mind/anaconda2/envs/tf_0.12/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in run(self, fetches, feed_dict, options, run_metadata)\r\n    764     try:\r\n    765       result = self._run(None, fetches, feed_dict, options_ptr,\r\n--> 766                          run_metadata_ptr)\r\n    767       if run_metadata:\r\n    768         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)\r\n\r\n/home/mind/anaconda2/envs/tf_0.12/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in _run(self, handle, fetches, feed_dict, options, run_metadata)\r\n    962     if final_fetches or final_targets:\r\n    963       results = self._do_run(handle, final_targets, final_fetches,\r\n--> 964                              feed_dict_string, options, run_metadata)\r\n    965     else:\r\n    966       results = []\r\n\r\n/home/mind/anaconda2/envs/tf_0.12/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)\r\n   1012     if handle is None:\r\n   1013       return self._do_call(_run_fn, self._session, feed_dict, fetch_list,\r\n-> 1014                            target_list, options, run_metadata)\r\n   1015     else:\r\n   1016       return self._do_call(_prun_fn, self._session, handle, feed_dict,\r\n\r\n/home/mind/anaconda2/envs/tf_0.12/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in _do_call(self, fn, *args)\r\n   1032         except KeyError:\r\n   1033           pass\r\n-> 1034       raise type(e)(node_def, op, message)\r\n   1035 \r\n   1036   def _extend_graph(self):\r\n\r\nFailedPreconditionError: Attempting to use uninitialized value a\r\n\t [[Node: _send_a_0 = _Send[T=DT_INT32, client_terminated=true, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=784291433964173963, tensor_name=\"a:0\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](a)]]\r\n```\r\n\r\n@mrry Could you have a look?\r\n"}