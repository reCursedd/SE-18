{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/370854781", "html_url": "https://github.com/tensorflow/tensorflow/issues/5694#issuecomment-370854781", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5694", "id": 370854781, "node_id": "MDEyOklzc3VlQ29tbWVudDM3MDg1NDc4MQ==", "user": {"login": "ziyuang", "id": 735294, "node_id": "MDQ6VXNlcjczNTI5NA==", "avatar_url": "https://avatars2.githubusercontent.com/u/735294?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ziyuang", "html_url": "https://github.com/ziyuang", "followers_url": "https://api.github.com/users/ziyuang/followers", "following_url": "https://api.github.com/users/ziyuang/following{/other_user}", "gists_url": "https://api.github.com/users/ziyuang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ziyuang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ziyuang/subscriptions", "organizations_url": "https://api.github.com/users/ziyuang/orgs", "repos_url": "https://api.github.com/users/ziyuang/repos", "events_url": "https://api.github.com/users/ziyuang/events{/privacy}", "received_events_url": "https://api.github.com/users/ziyuang/received_events", "type": "User", "site_admin": false}, "created_at": "2018-03-06T17:09:40Z", "updated_at": "2018-03-07T10:48:09Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=5536129\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/tomrunia\">@tomrunia</a> how did you merge WxH? I tried</p>\n<pre><code># net is the output of conv3d\norig_shape = tf.shape(net)\nworkaround_shape = orig_shape[0], orig_shape[1], orig_shape[2]*orig_shape[3], orig_shape[4]\nnet = tf.reshape(net, workaround_shape)\nnet = tf.layers.batch_normalization(net, training=True)\nnet = tf.reshape(net, orig_shape)\n</code></pre>\n<p>But TensorFlow will complain at the <code>batch_normalization</code> line:</p>\n<pre><code>File \"~/anaconda3/lib/python3.6/site-packages/tensorflow/python/layers/normalization.py\", line 253, in build\n    input_shape)\nValueError: ('Input has undefined `axis` dimension. Input shape: ', TensorShape([Dimension(None), Dimension(None), Dimension(None), Dimension(None)]))\n</code></pre>\n<p><strong>Update</strong>: solved. I have to make sure <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/layers/normalization.py#L253\">the axis/axes passed to batch_normalization having known size(s)</a>. In my case, I know the images are of gray-scale, so just use</p>\n<p><code>workaround_shape = orig_shape[0], orig_shape[1], orig_shape[2]*orig_shape[3], 1</code></p>", "body_text": "@tomrunia how did you merge WxH? I tried\n# net is the output of conv3d\norig_shape = tf.shape(net)\nworkaround_shape = orig_shape[0], orig_shape[1], orig_shape[2]*orig_shape[3], orig_shape[4]\nnet = tf.reshape(net, workaround_shape)\nnet = tf.layers.batch_normalization(net, training=True)\nnet = tf.reshape(net, orig_shape)\n\nBut TensorFlow will complain at the batch_normalization line:\nFile \"~/anaconda3/lib/python3.6/site-packages/tensorflow/python/layers/normalization.py\", line 253, in build\n    input_shape)\nValueError: ('Input has undefined `axis` dimension. Input shape: ', TensorShape([Dimension(None), Dimension(None), Dimension(None), Dimension(None)]))\n\nUpdate: solved. I have to make sure the axis/axes passed to batch_normalization having known size(s). In my case, I know the images are of gray-scale, so just use\nworkaround_shape = orig_shape[0], orig_shape[1], orig_shape[2]*orig_shape[3], 1", "body": "@tomrunia how did you merge WxH? I tried\r\n\r\n```\r\n# net is the output of conv3d\r\norig_shape = tf.shape(net)\r\nworkaround_shape = orig_shape[0], orig_shape[1], orig_shape[2]*orig_shape[3], orig_shape[4]\r\nnet = tf.reshape(net, workaround_shape)\r\nnet = tf.layers.batch_normalization(net, training=True)\r\nnet = tf.reshape(net, orig_shape)\r\n```\r\nBut TensorFlow will complain at the `batch_normalization` line:\r\n```\r\nFile \"~/anaconda3/lib/python3.6/site-packages/tensorflow/python/layers/normalization.py\", line 253, in build\r\n    input_shape)\r\nValueError: ('Input has undefined `axis` dimension. Input shape: ', TensorShape([Dimension(None), Dimension(None), Dimension(None), Dimension(None)]))\r\n```\r\n\r\n**Update**: solved. I have to make sure [the axis/axes passed to batch_normalization having known size(s)](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/layers/normalization.py#L253). In my case, I know the images are of gray-scale, so just use \r\n\r\n`workaround_shape = orig_shape[0], orig_shape[1], orig_shape[2]*orig_shape[3], 1`\r\n"}