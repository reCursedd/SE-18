{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/425294542", "html_url": "https://github.com/tensorflow/tensorflow/issues/22526#issuecomment-425294542", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22526", "id": 425294542, "node_id": "MDEyOklzc3VlQ29tbWVudDQyNTI5NDU0Mg==", "user": {"login": "7oud", "id": 7981826, "node_id": "MDQ6VXNlcjc5ODE4MjY=", "avatar_url": "https://avatars0.githubusercontent.com/u/7981826?v=4", "gravatar_id": "", "url": "https://api.github.com/users/7oud", "html_url": "https://github.com/7oud", "followers_url": "https://api.github.com/users/7oud/followers", "following_url": "https://api.github.com/users/7oud/following{/other_user}", "gists_url": "https://api.github.com/users/7oud/gists{/gist_id}", "starred_url": "https://api.github.com/users/7oud/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/7oud/subscriptions", "organizations_url": "https://api.github.com/users/7oud/orgs", "repos_url": "https://api.github.com/users/7oud/repos", "events_url": "https://api.github.com/users/7oud/events{/privacy}", "received_events_url": "https://api.github.com/users/7oud/received_events", "type": "User", "site_admin": false}, "created_at": "2018-09-28T01:47:17Z", "updated_at": "2018-09-28T01:47:17Z", "author_association": "NONE", "body_html": "<p>There will be some trouble of data access, when using multi-process with its own session. So I choose only ONE process to run multi-session in sequential not parallel. Each session has similar procedure, as in code</p>\n<pre><code>// define option and new session\nSessionOptions options;\noptions.config.mutable_gpu_options().set_per_process_gpu_memory_fraction(fraction);\n...\nNewSession(options, &amp;_session);\n\n// run inference\n...\n\n// close session\n_session-&gt;Close();\ndelete _session;\n</code></pre>\n<p>The problem is when the start the 2nd session, function <strong>set_per_process_gpu_memory_fraction()</strong> with another fraction value will not work, the process still use the gpu memory fraction setting in the 1st session.</p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=42785337\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/wt-huang\">@wt-huang</a> Could you give the c++ version of your code snippet ?</p>", "body_text": "There will be some trouble of data access, when using multi-process with its own session. So I choose only ONE process to run multi-session in sequential not parallel. Each session has similar procedure, as in code\n// define option and new session\nSessionOptions options;\noptions.config.mutable_gpu_options().set_per_process_gpu_memory_fraction(fraction);\n...\nNewSession(options, &_session);\n\n// run inference\n...\n\n// close session\n_session->Close();\ndelete _session;\n\nThe problem is when the start the 2nd session, function set_per_process_gpu_memory_fraction() with another fraction value will not work, the process still use the gpu memory fraction setting in the 1st session.\n@wt-huang Could you give the c++ version of your code snippet ?", "body": "There will be some trouble of data access, when using multi-process with its own session. So I choose only ONE process to run multi-session in sequential not parallel. Each session has similar procedure, as in code\r\n```\r\n// define option and new session\r\nSessionOptions options;\r\noptions.config.mutable_gpu_options().set_per_process_gpu_memory_fraction(fraction);\r\n...\r\nNewSession(options, &_session);\r\n\r\n// run inference\r\n...\r\n\r\n// close session\r\n_session->Close();\r\ndelete _session;\r\n```\r\n\r\nThe problem is when the start the 2nd session, function **set_per_process_gpu_memory_fraction()** with another fraction value will not work, the process still use the gpu memory fraction setting in the 1st session.\r\n\r\n@wt-huang Could you give the c++ version of your code snippet ?"}