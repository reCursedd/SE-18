{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22526", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22526/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22526/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22526/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/22526", "id": 363916683, "node_id": "MDU6SXNzdWUzNjM5MTY2ODM=", "number": 22526, "title": "How to reset per_process_gpu_memory_fraction in tf using c++?", "user": {"login": "7oud", "id": 7981826, "node_id": "MDQ6VXNlcjc5ODE4MjY=", "avatar_url": "https://avatars0.githubusercontent.com/u/7981826?v=4", "gravatar_id": "", "url": "https://api.github.com/users/7oud", "html_url": "https://github.com/7oud", "followers_url": "https://api.github.com/users/7oud/followers", "following_url": "https://api.github.com/users/7oud/following{/other_user}", "gists_url": "https://api.github.com/users/7oud/gists{/gist_id}", "starred_url": "https://api.github.com/users/7oud/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/7oud/subscriptions", "organizations_url": "https://api.github.com/users/7oud/orgs", "repos_url": "https://api.github.com/users/7oud/repos", "events_url": "https://api.github.com/users/7oud/events{/privacy}", "received_events_url": "https://api.github.com/users/7oud/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1097547538, "node_id": "MDU6TGFiZWwxMDk3NTQ3NTM4", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:gpu", "name": "comp:gpu", "color": "0052cc", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "wt-huang", "id": 42785337, "node_id": "MDQ6VXNlcjQyNzg1MzM3", "avatar_url": "https://avatars0.githubusercontent.com/u/42785337?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wt-huang", "html_url": "https://github.com/wt-huang", "followers_url": "https://api.github.com/users/wt-huang/followers", "following_url": "https://api.github.com/users/wt-huang/following{/other_user}", "gists_url": "https://api.github.com/users/wt-huang/gists{/gist_id}", "starred_url": "https://api.github.com/users/wt-huang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wt-huang/subscriptions", "organizations_url": "https://api.github.com/users/wt-huang/orgs", "repos_url": "https://api.github.com/users/wt-huang/repos", "events_url": "https://api.github.com/users/wt-huang/events{/privacy}", "received_events_url": "https://api.github.com/users/wt-huang/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "wt-huang", "id": 42785337, "node_id": "MDQ6VXNlcjQyNzg1MzM3", "avatar_url": "https://avatars0.githubusercontent.com/u/42785337?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wt-huang", "html_url": "https://github.com/wt-huang", "followers_url": "https://api.github.com/users/wt-huang/followers", "following_url": "https://api.github.com/users/wt-huang/following{/other_user}", "gists_url": "https://api.github.com/users/wt-huang/gists{/gist_id}", "starred_url": "https://api.github.com/users/wt-huang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wt-huang/subscriptions", "organizations_url": "https://api.github.com/users/wt-huang/orgs", "repos_url": "https://api.github.com/users/wt-huang/repos", "events_url": "https://api.github.com/users/wt-huang/events{/privacy}", "received_events_url": "https://api.github.com/users/wt-huang/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2018-09-26T08:39:51Z", "updated_at": "2018-10-24T18:18:08Z", "closed_at": "2018-10-24T15:21:56Z", "author_association": "NONE", "body_html": "<p>I have develop two applications based on tf in c++ language, these applications are served as libraries. In the caller execuable program, library1 is called then library2. In library1 initialization,  gpu memory fraction is set to 0.5, run some inference, and session closed. then library2 is called, gpu memory fraction is set to 0.8, but the setting can not work, gpu memory allocation did not change. Both library have the same initialization code but differnet fraction value</p>\n<pre><code>int XXXLib::init(double per_process_gpu_memory_fraction)\n{\n    SessionOptions options;\n    ConfigProto* config = &amp;options.config;\n    GPUOptions* gpu_options = config-&gt;mutable_gpu_options();\n\n    // for library1, fraction = 0.5; for library2, fraction = 0.8\n    gpu_options-&gt;set_per_process_gpu_memory_fraction(per_process_gpu_memory_fraction);\n    Status status = NewSession(options, &amp;_session);\n}\n</code></pre>\n<p>It seems that when set_per_process_gpu_memory_fraction() is called, the gpu memory in this process is fixed, even new another Newsession(), the original fraction value is used.</p>\n<ol>\n<li>Should different app(library) use different session ?</li>\n<li>gpu memory fraction is related to session or to process ?</li>\n<li>How  to change the fraction in different session but the same process?</li>\n</ol>\n<p>Some env info:</p>\n<ul>\n<li>Have I written custom code? NO</li>\n<li>OS Platform and Distribution? Win10 Pro</li>\n<li>TensorFlow installed from? Source code</li>\n<li>TensorFlow version? 1.9</li>\n<li>CUDA/cuDNN version? CUDA9.0, cudnn 7.05</li>\n<li>GPU model and memory? GTX1080 with 8GB memory</li>\n</ul>", "body_text": "I have develop two applications based on tf in c++ language, these applications are served as libraries. In the caller execuable program, library1 is called then library2. In library1 initialization,  gpu memory fraction is set to 0.5, run some inference, and session closed. then library2 is called, gpu memory fraction is set to 0.8, but the setting can not work, gpu memory allocation did not change. Both library have the same initialization code but differnet fraction value\nint XXXLib::init(double per_process_gpu_memory_fraction)\n{\n    SessionOptions options;\n    ConfigProto* config = &options.config;\n    GPUOptions* gpu_options = config->mutable_gpu_options();\n\n    // for library1, fraction = 0.5; for library2, fraction = 0.8\n    gpu_options->set_per_process_gpu_memory_fraction(per_process_gpu_memory_fraction);\n    Status status = NewSession(options, &_session);\n}\n\nIt seems that when set_per_process_gpu_memory_fraction() is called, the gpu memory in this process is fixed, even new another Newsession(), the original fraction value is used.\n\nShould different app(library) use different session ?\ngpu memory fraction is related to session or to process ?\nHow  to change the fraction in different session but the same process?\n\nSome env info:\n\nHave I written custom code? NO\nOS Platform and Distribution? Win10 Pro\nTensorFlow installed from? Source code\nTensorFlow version? 1.9\nCUDA/cuDNN version? CUDA9.0, cudnn 7.05\nGPU model and memory? GTX1080 with 8GB memory", "body": "I have develop two applications based on tf in c++ language, these applications are served as libraries. In the caller execuable program, library1 is called then library2. In library1 initialization,  gpu memory fraction is set to 0.5, run some inference, and session closed. then library2 is called, gpu memory fraction is set to 0.8, but the setting can not work, gpu memory allocation did not change. Both library have the same initialization code but differnet fraction value\r\n```\r\nint XXXLib::init(double per_process_gpu_memory_fraction)\r\n{\r\n    SessionOptions options;\r\n    ConfigProto* config = &options.config;\r\n    GPUOptions* gpu_options = config->mutable_gpu_options();\r\n\r\n    // for library1, fraction = 0.5; for library2, fraction = 0.8\r\n    gpu_options->set_per_process_gpu_memory_fraction(per_process_gpu_memory_fraction);\r\n    Status status = NewSession(options, &_session);\r\n}\r\n```\r\nIt seems that when set_per_process_gpu_memory_fraction() is called, the gpu memory in this process is fixed, even new another Newsession(), the original fraction value is used.\r\n1. Should different app(library) use different session ?\r\n2. gpu memory fraction is related to session or to process ?\r\n3. How  to change the fraction in different session but the same process? \r\n\r\nSome env info:\r\n- Have I written custom code? NO\r\n-  OS Platform and Distribution? Win10 Pro\r\n-  TensorFlow installed from? Source code\r\n-  TensorFlow version? 1.9\r\n-  CUDA/cuDNN version? CUDA9.0, cudnn 7.05\r\n-  GPU model and memory? GTX1080 with 8GB memory"}