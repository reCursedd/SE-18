{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/333985350", "html_url": "https://github.com/tensorflow/tensorflow/issues/5688#issuecomment-333985350", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5688", "id": 333985350, "node_id": "MDEyOklzc3VlQ29tbWVudDMzMzk4NTM1MA==", "user": {"login": "yzhwang", "id": 1002405, "node_id": "MDQ6VXNlcjEwMDI0MDU=", "avatar_url": "https://avatars1.githubusercontent.com/u/1002405?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yzhwang", "html_url": "https://github.com/yzhwang", "followers_url": "https://api.github.com/users/yzhwang/followers", "following_url": "https://api.github.com/users/yzhwang/following{/other_user}", "gists_url": "https://api.github.com/users/yzhwang/gists{/gist_id}", "starred_url": "https://api.github.com/users/yzhwang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yzhwang/subscriptions", "organizations_url": "https://api.github.com/users/yzhwang/orgs", "repos_url": "https://api.github.com/users/yzhwang/repos", "events_url": "https://api.github.com/users/yzhwang/events{/privacy}", "received_events_url": "https://api.github.com/users/yzhwang/received_events", "type": "User", "site_admin": false}, "created_at": "2017-10-03T21:33:24Z", "updated_at": "2017-10-03T21:33:24Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Hi <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=26375398\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/hadarpo\">@hadarpo</a> I updated the original reproducer and ran it on a windows machine with the nightly build TF that you had and CUDA 8/cudnnv6, and I wasn't able to reproduce your error. Here's the result:</p>\n<pre><code>C:\\Users\\yangzihao\\Desktop&gt;\"C:\\Program Files\\Anaconda3\\python.exe\" tfversion.py\n1.4.0-dev20170929\n\nC:\\Users\\yangzihao\\Desktop&gt;\"C:\\Program Files\\Anaconda3\\python.exe\" run.py\n2017-10-03 20:41:13.569273: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\platform\\cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX\n2017-10-03 20:41:14.419846: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 0 with properties:\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\npciBusID: 0000:00:04.0\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\n2017-10-03 20:41:14.560192: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 1 with properties:\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\npciBusID: 0000:00:05.0\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\n2017-10-03 20:41:14.696383: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 2 with properties:\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\npciBusID: 0000:00:06.0\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\n2017-10-03 20:41:14.830435: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 3 with properties:\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\npciBusID: 0000:00:07.0\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\n2017-10-03 20:41:14.962369: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 4 with properties:\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\npciBusID: 0000:00:08.0\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\n2017-10-03 20:41:15.093104: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 5 with properties:\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\npciBusID: 0000:00:09.0\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\n2017-10-03 20:41:15.230357: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 6 with properties:\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\npciBusID: 0000:00:0a.0\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\n2017-10-03 20:41:15.368208: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 7 with properties:\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\npciBusID: 0000:00:0b.0\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\n2017-10-03 20:41:15.369462: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:980] Device peer to peer matrix\n2017-10-03 20:41:15.371303: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:986] DMA: 0 1 2 3 4 5 6 7\n2017-10-03 20:41:15.371382: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 0:   Y N N N N N N N\n2017-10-03 20:41:15.371969: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 1:   N Y N N N N N N\n2017-10-03 20:41:15.372523: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 2:   N N Y N N N N N\n2017-10-03 20:41:15.373115: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 3:   N N N Y N N N N\n2017-10-03 20:41:15.373629: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 4:   N N N N Y N N N\n2017-10-03 20:41:15.374197: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 5:   N N N N N Y N N\n2017-10-03 20:41:15.374683: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 6:   N N N N N N Y N\n2017-10-03 20:41:15.375206: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 7:   N N N N N N N Y\n2017-10-03 20:41:15.375761: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:0) -&gt; (device: 0, name: Tesla K80, pci bus id: 0000:00:04.0, compute capability: 3.7)\n2017-10-03 20:41:15.376257: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:1) -&gt; (device: 1, name: Tesla K80, pci bus id: 0000:00:05.0, compute capability: 3.7)\n2017-10-03 20:41:15.376797: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:2) -&gt; (device: 2, name: Tesla K80, pci bus id: 0000:00:06.0, compute capability: 3.7)\n2017-10-03 20:41:15.377331: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:3) -&gt; (device: 3, name: Tesla K80, pci bus id: 0000:00:07.0, compute capability: 3.7)\n2017-10-03 20:41:15.377845: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:4) -&gt; (device: 4, name: Tesla K80, pci bus id: 0000:00:08.0, compute capability: 3.7)\n2017-10-03 20:41:15.378384: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:5) -&gt; (device: 5, name: Tesla K80, pci bus id: 0000:00:09.0, compute capability: 3.7)\n2017-10-03 20:41:15.378910: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:6) -&gt; (device: 6, name: Tesla K80, pci bus id: 0000:00:0a.0, compute capability: 3.7)\n2017-10-03 20:41:15.379449: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:7) -&gt; (device: 7, name: Tesla K80, pci bus id: 0000:00:0b.0, compute capability: 3.7)\n</code></pre>\n<p>Here's the modified original reproducer (only interface changes to make it run on v1.4):</p>\n<pre><code>import numpy as np\nimport tensorflow as tf\n\ngraph = tf.Graph()\n\nwith graph.as_default():\n    tf_dataset = tf.placeholder(tf.float32, shape=(1, 512, 512, 512, 1))\n    tf_label = tf.placeholder(tf.float32, shape=(1, 512, 512, 512, 1))\n\n    layer1_weights = tf.Variable(tf.truncated_normal((2, 2, 2, 1, 1), stddev=0.1))\n    layer1_bias = tf.Variable(tf.zeros(1))\n\n    conv = tf.nn.conv3d(tf_dataset, layer1_weights, (1, 1, 1, 1, 1), padding='SAME')\n    logits = tf.nn.relu(conv+layer1_bias)\n\n    loss = tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(logits=logits, labels=tf_label))\n    optimizer = tf.train.GradientDescentOptimizer(0.05).minimize(loss)\n\nwith tf.Session(graph=graph) as session:\n    tf.global_variables_initializer().run()\n    batchData = np.random.rand(1, 512, 512, 512, 1).astype(np.float32)\n    batchLabels = (np.random.rand(1, 512, 512, 512, 1)&gt;0.5).astype(np.float32)\n    feed_dict = {tf_dataset : batchData, tf_label : batchLabels}\n    _ = session.run((optimizer, ), feed_dict=feed_dict)\n</code></pre>\n<p>Could you try to run other conv-related tests (for example this one):<br>\n<a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/kernel_tests/conv_ops_3d_test.py\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/kernel_tests/conv_ops_3d_test.py</a><br>\nAnd also other CUDA samples to make sure your CUDA/cudnn works correctly first?</p>\n<p>Since although it looks like the error was from conv3d_backprop, but the stream has already been polluted by earlier CUDA_ERROR_LAUNCH_FAILEDs in cuda_driver.cc and cuda_timer.cc.</p>", "body_text": "Hi @hadarpo I updated the original reproducer and ran it on a windows machine with the nightly build TF that you had and CUDA 8/cudnnv6, and I wasn't able to reproduce your error. Here's the result:\nC:\\Users\\yangzihao\\Desktop>\"C:\\Program Files\\Anaconda3\\python.exe\" tfversion.py\n1.4.0-dev20170929\n\nC:\\Users\\yangzihao\\Desktop>\"C:\\Program Files\\Anaconda3\\python.exe\" run.py\n2017-10-03 20:41:13.569273: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\platform\\cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX\n2017-10-03 20:41:14.419846: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 0 with properties:\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\npciBusID: 0000:00:04.0\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\n2017-10-03 20:41:14.560192: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 1 with properties:\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\npciBusID: 0000:00:05.0\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\n2017-10-03 20:41:14.696383: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 2 with properties:\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\npciBusID: 0000:00:06.0\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\n2017-10-03 20:41:14.830435: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 3 with properties:\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\npciBusID: 0000:00:07.0\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\n2017-10-03 20:41:14.962369: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 4 with properties:\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\npciBusID: 0000:00:08.0\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\n2017-10-03 20:41:15.093104: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 5 with properties:\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\npciBusID: 0000:00:09.0\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\n2017-10-03 20:41:15.230357: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 6 with properties:\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\npciBusID: 0000:00:0a.0\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\n2017-10-03 20:41:15.368208: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 7 with properties:\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\npciBusID: 0000:00:0b.0\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\n2017-10-03 20:41:15.369462: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:980] Device peer to peer matrix\n2017-10-03 20:41:15.371303: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:986] DMA: 0 1 2 3 4 5 6 7\n2017-10-03 20:41:15.371382: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 0:   Y N N N N N N N\n2017-10-03 20:41:15.371969: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 1:   N Y N N N N N N\n2017-10-03 20:41:15.372523: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 2:   N N Y N N N N N\n2017-10-03 20:41:15.373115: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 3:   N N N Y N N N N\n2017-10-03 20:41:15.373629: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 4:   N N N N Y N N N\n2017-10-03 20:41:15.374197: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 5:   N N N N N Y N N\n2017-10-03 20:41:15.374683: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 6:   N N N N N N Y N\n2017-10-03 20:41:15.375206: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 7:   N N N N N N N Y\n2017-10-03 20:41:15.375761: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:0) -> (device: 0, name: Tesla K80, pci bus id: 0000:00:04.0, compute capability: 3.7)\n2017-10-03 20:41:15.376257: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:1) -> (device: 1, name: Tesla K80, pci bus id: 0000:00:05.0, compute capability: 3.7)\n2017-10-03 20:41:15.376797: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:2) -> (device: 2, name: Tesla K80, pci bus id: 0000:00:06.0, compute capability: 3.7)\n2017-10-03 20:41:15.377331: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:3) -> (device: 3, name: Tesla K80, pci bus id: 0000:00:07.0, compute capability: 3.7)\n2017-10-03 20:41:15.377845: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:4) -> (device: 4, name: Tesla K80, pci bus id: 0000:00:08.0, compute capability: 3.7)\n2017-10-03 20:41:15.378384: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:5) -> (device: 5, name: Tesla K80, pci bus id: 0000:00:09.0, compute capability: 3.7)\n2017-10-03 20:41:15.378910: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:6) -> (device: 6, name: Tesla K80, pci bus id: 0000:00:0a.0, compute capability: 3.7)\n2017-10-03 20:41:15.379449: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:7) -> (device: 7, name: Tesla K80, pci bus id: 0000:00:0b.0, compute capability: 3.7)\n\nHere's the modified original reproducer (only interface changes to make it run on v1.4):\nimport numpy as np\nimport tensorflow as tf\n\ngraph = tf.Graph()\n\nwith graph.as_default():\n    tf_dataset = tf.placeholder(tf.float32, shape=(1, 512, 512, 512, 1))\n    tf_label = tf.placeholder(tf.float32, shape=(1, 512, 512, 512, 1))\n\n    layer1_weights = tf.Variable(tf.truncated_normal((2, 2, 2, 1, 1), stddev=0.1))\n    layer1_bias = tf.Variable(tf.zeros(1))\n\n    conv = tf.nn.conv3d(tf_dataset, layer1_weights, (1, 1, 1, 1, 1), padding='SAME')\n    logits = tf.nn.relu(conv+layer1_bias)\n\n    loss = tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(logits=logits, labels=tf_label))\n    optimizer = tf.train.GradientDescentOptimizer(0.05).minimize(loss)\n\nwith tf.Session(graph=graph) as session:\n    tf.global_variables_initializer().run()\n    batchData = np.random.rand(1, 512, 512, 512, 1).astype(np.float32)\n    batchLabels = (np.random.rand(1, 512, 512, 512, 1)>0.5).astype(np.float32)\n    feed_dict = {tf_dataset : batchData, tf_label : batchLabels}\n    _ = session.run((optimizer, ), feed_dict=feed_dict)\n\nCould you try to run other conv-related tests (for example this one):\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/kernel_tests/conv_ops_3d_test.py\nAnd also other CUDA samples to make sure your CUDA/cudnn works correctly first?\nSince although it looks like the error was from conv3d_backprop, but the stream has already been polluted by earlier CUDA_ERROR_LAUNCH_FAILEDs in cuda_driver.cc and cuda_timer.cc.", "body": "Hi @hadarpo I updated the original reproducer and ran it on a windows machine with the nightly build TF that you had and CUDA 8/cudnnv6, and I wasn't able to reproduce your error. Here's the result:\r\n\r\n```\r\nC:\\Users\\yangzihao\\Desktop>\"C:\\Program Files\\Anaconda3\\python.exe\" tfversion.py\r\n1.4.0-dev20170929\r\n\r\nC:\\Users\\yangzihao\\Desktop>\"C:\\Program Files\\Anaconda3\\python.exe\" run.py\r\n2017-10-03 20:41:13.569273: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\platform\\cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX\r\n2017-10-03 20:41:14.419846: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 0 with properties:\r\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\r\npciBusID: 0000:00:04.0\r\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\r\n2017-10-03 20:41:14.560192: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 1 with properties:\r\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\r\npciBusID: 0000:00:05.0\r\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\r\n2017-10-03 20:41:14.696383: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 2 with properties:\r\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\r\npciBusID: 0000:00:06.0\r\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\r\n2017-10-03 20:41:14.830435: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 3 with properties:\r\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\r\npciBusID: 0000:00:07.0\r\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\r\n2017-10-03 20:41:14.962369: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 4 with properties:\r\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\r\npciBusID: 0000:00:08.0\r\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\r\n2017-10-03 20:41:15.093104: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 5 with properties:\r\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\r\npciBusID: 0000:00:09.0\r\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\r\n2017-10-03 20:41:15.230357: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 6 with properties:\r\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\r\npciBusID: 0000:00:0a.0\r\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\r\n2017-10-03 20:41:15.368208: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:965] Found device 7 with properties:\r\nname: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235\r\npciBusID: 0000:00:0b.0\r\ntotalMemory: 11.18GiB freeMemory: 11.12GiB\r\n2017-10-03 20:41:15.369462: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:980] Device peer to peer matrix\r\n2017-10-03 20:41:15.371303: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:986] DMA: 0 1 2 3 4 5 6 7\r\n2017-10-03 20:41:15.371382: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 0:   Y N N N N N N N\r\n2017-10-03 20:41:15.371969: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 1:   N Y N N N N N N\r\n2017-10-03 20:41:15.372523: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 2:   N N Y N N N N N\r\n2017-10-03 20:41:15.373115: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 3:   N N N Y N N N N\r\n2017-10-03 20:41:15.373629: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 4:   N N N N Y N N N\r\n2017-10-03 20:41:15.374197: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 5:   N N N N N Y N N\r\n2017-10-03 20:41:15.374683: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 6:   N N N N N N Y N\r\n2017-10-03 20:41:15.375206: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:996] 7:   N N N N N N N Y\r\n2017-10-03 20:41:15.375761: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:0) -> (device: 0, name: Tesla K80, pci bus id: 0000:00:04.0, compute capability: 3.7)\r\n2017-10-03 20:41:15.376257: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:1) -> (device: 1, name: Tesla K80, pci bus id: 0000:00:05.0, compute capability: 3.7)\r\n2017-10-03 20:41:15.376797: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:2) -> (device: 2, name: Tesla K80, pci bus id: 0000:00:06.0, compute capability: 3.7)\r\n2017-10-03 20:41:15.377331: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:3) -> (device: 3, name: Tesla K80, pci bus id: 0000:00:07.0, compute capability: 3.7)\r\n2017-10-03 20:41:15.377845: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:4) -> (device: 4, name: Tesla K80, pci bus id: 0000:00:08.0, compute capability: 3.7)\r\n2017-10-03 20:41:15.378384: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:5) -> (device: 5, name: Tesla K80, pci bus id: 0000:00:09.0, compute capability: 3.7)\r\n2017-10-03 20:41:15.378910: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:6) -> (device: 6, name: Tesla K80, pci bus id: 0000:00:0a.0, compute capability: 3.7)\r\n2017-10-03 20:41:15.379449: I C:\\tf_jenkins\\home\\workspace\\tf-nightly-windows\\M\\windows-gpu\\PY\\35\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1055] Creating TensorFlow device (/device:GPU:7) -> (device: 7, name: Tesla K80, pci bus id: 0000:00:0b.0, compute capability: 3.7)\r\n```\r\n\r\nHere's the modified original reproducer (only interface changes to make it run on v1.4):\r\n\r\n```\r\nimport numpy as np\r\nimport tensorflow as tf\r\n\r\ngraph = tf.Graph()\r\n\r\nwith graph.as_default():\r\n    tf_dataset = tf.placeholder(tf.float32, shape=(1, 512, 512, 512, 1))\r\n    tf_label = tf.placeholder(tf.float32, shape=(1, 512, 512, 512, 1))\r\n\r\n    layer1_weights = tf.Variable(tf.truncated_normal((2, 2, 2, 1, 1), stddev=0.1))\r\n    layer1_bias = tf.Variable(tf.zeros(1))\r\n\r\n    conv = tf.nn.conv3d(tf_dataset, layer1_weights, (1, 1, 1, 1, 1), padding='SAME')\r\n    logits = tf.nn.relu(conv+layer1_bias)\r\n\r\n    loss = tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(logits=logits, labels=tf_label))\r\n    optimizer = tf.train.GradientDescentOptimizer(0.05).minimize(loss)\r\n\r\nwith tf.Session(graph=graph) as session:\r\n    tf.global_variables_initializer().run()\r\n    batchData = np.random.rand(1, 512, 512, 512, 1).astype(np.float32)\r\n    batchLabels = (np.random.rand(1, 512, 512, 512, 1)>0.5).astype(np.float32)\r\n    feed_dict = {tf_dataset : batchData, tf_label : batchLabels}\r\n    _ = session.run((optimizer, ), feed_dict=feed_dict)\r\n```\r\nCould you try to run other conv-related tests (for example this one):\r\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/kernel_tests/conv_ops_3d_test.py\r\nAnd also other CUDA samples to make sure your CUDA/cudnn works correctly first?\r\n\r\nSince although it looks like the error was from conv3d_backprop, but the stream has already been polluted by earlier CUDA_ERROR_LAUNCH_FAILEDs in cuda_driver.cc and cuda_timer.cc.\r\n\r\n"}