{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13063", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13063/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13063/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13063/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/13063", "id": 258033652, "node_id": "MDU6SXNzdWUyNTgwMzM2NTI=", "number": 13063, "title": "XLA representation of batch normalization has changed since TF 1.3", "user": {"login": "lazarevevgeny", "id": 30651952, "node_id": "MDQ6VXNlcjMwNjUxOTUy", "avatar_url": "https://avatars2.githubusercontent.com/u/30651952?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lazarevevgeny", "html_url": "https://github.com/lazarevevgeny", "followers_url": "https://api.github.com/users/lazarevevgeny/followers", "following_url": "https://api.github.com/users/lazarevevgeny/following{/other_user}", "gists_url": "https://api.github.com/users/lazarevevgeny/gists{/gist_id}", "starred_url": "https://api.github.com/users/lazarevevgeny/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lazarevevgeny/subscriptions", "organizations_url": "https://api.github.com/users/lazarevevgeny/orgs", "repos_url": "https://api.github.com/users/lazarevevgeny/repos", "events_url": "https://api.github.com/users/lazarevevgeny/events{/privacy}", "received_events_url": "https://api.github.com/users/lazarevevgeny/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-09-15T13:08:27Z", "updated_at": "2017-11-30T19:08:52Z", "closed_at": "2017-11-30T19:08:52Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Ubuntu 16.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: source (commit <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/1f19b8cf38dcf7b468cb7f4e6d969966a495e167/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/1f19b8cf38dcf7b468cb7f4e6d969966a495e167\"><tt>1f19b8c</tt></a>)</li>\n<li><strong>TensorFlow version (use command below)</strong>: ('v1.3.0-rc1-2173-g36813d5', '1.4.0-dev')</li>\n<li><strong>Python version</strong>: Python 2.7.12</li>\n<li><strong>Bazel version (if compiling from source)</strong>: Build label: 0.5.3</li>\n<li><strong>CUDA/cuDNN version</strong>: no</li>\n<li><strong>GPU model and memory</strong>: no</li>\n<li><strong>Exact command to reproduce</strong>: cannot provide</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>I use Tensorflow compiled from sources (last commit <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/1f19b8cf38dcf7b468cb7f4e6d969966a495e167/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/1f19b8cf38dcf7b468cb7f4e6d969966a495e167\"><tt>1f19b8c</tt></a>) with XLA JIT compilation enabled. My <strong>inference</strong> network uses batch normalization. When I visualize the HLO cluster dumped into the dot file with graphviz I see that batch normalization operation is translated differently in TF 1.3 and TF master. In the master branch the result is like this:<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/30651952/30482986-d53c9480-9a2d-11e7-8e8e-b5a48d5e95a2.png\"><img src=\"https://user-images.githubusercontent.com/30651952/30482986-d53c9480-9a2d-11e7-8e8e-b5a48d5e95a2.png\" alt=\"tf_1 3\" style=\"max-width:100%;\"></a><br>\nBut in the 1.3 branch all these instructions were merged into a single broadcast with a constant parameter. Looks like the translation behavior has been changed by commit <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/7359fec792e4efec1670a12332bb524a5608b215/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/7359fec792e4efec1670a12332bb524a5608b215\"><tt>7359fec</tt></a>. This introduces a kind of regression since these instructions can be pre-calculated because the input is constant (as it was done in 1.3).</p>\n<h3>Source code / logs</h3>\n<p>In order to reproduce the issue run the Inception V3 network from slim models zoo with variables converted to constants and marked with XLA compile flag.</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Ubuntu 16.04\nTensorFlow installed from (source or binary): source (commit 1f19b8c)\nTensorFlow version (use command below): ('v1.3.0-rc1-2173-g36813d5', '1.4.0-dev')\nPython version: Python 2.7.12\nBazel version (if compiling from source): Build label: 0.5.3\nCUDA/cuDNN version: no\nGPU model and memory: no\nExact command to reproduce: cannot provide\n\nDescribe the problem\nI use Tensorflow compiled from sources (last commit 1f19b8c) with XLA JIT compilation enabled. My inference network uses batch normalization. When I visualize the HLO cluster dumped into the dot file with graphviz I see that batch normalization operation is translated differently in TF 1.3 and TF master. In the master branch the result is like this:\n\nBut in the 1.3 branch all these instructions were merged into a single broadcast with a constant parameter. Looks like the translation behavior has been changed by commit 7359fec. This introduces a kind of regression since these instructions can be pre-calculated because the input is constant (as it was done in 1.3).\nSource code / logs\nIn order to reproduce the issue run the Inception V3 network from slim models zoo with variables converted to constants and marked with XLA compile flag.", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Ubuntu 16.04\r\n- **TensorFlow installed from (source or binary)**: source (commit 1f19b8c)\r\n- **TensorFlow version (use command below)**: ('v1.3.0-rc1-2173-g36813d5', '1.4.0-dev')\r\n- **Python version**: Python 2.7.12\r\n- **Bazel version (if compiling from source)**: Build label: 0.5.3\r\n- **CUDA/cuDNN version**: no\r\n- **GPU model and memory**: no\r\n- **Exact command to reproduce**: cannot provide\r\n\r\n### Describe the problem\r\nI use Tensorflow compiled from sources (last commit 1f19b8c) with XLA JIT compilation enabled. My **inference** network uses batch normalization. When I visualize the HLO cluster dumped into the dot file with graphviz I see that batch normalization operation is translated differently in TF 1.3 and TF master. In the master branch the result is like this:\r\n![tf_1 3](https://user-images.githubusercontent.com/30651952/30482986-d53c9480-9a2d-11e7-8e8e-b5a48d5e95a2.png)\r\nBut in the 1.3 branch all these instructions were merged into a single broadcast with a constant parameter. Looks like the translation behavior has been changed by commit 7359fec. This introduces a kind of regression since these instructions can be pre-calculated because the input is constant (as it was done in 1.3).\r\n\r\n### Source code / logs\r\nIn order to reproduce the issue run the Inception V3 network from slim models zoo with variables converted to constants and marked with XLA compile flag.\r\n"}