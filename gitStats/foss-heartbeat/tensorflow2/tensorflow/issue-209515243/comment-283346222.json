{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/283346222", "html_url": "https://github.com/tensorflow/tensorflow/issues/7784#issuecomment-283346222", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7784", "id": 283346222, "node_id": "MDEyOklzc3VlQ29tbWVudDI4MzM0NjIyMg==", "user": {"login": "mahatosourav91", "id": 25343161, "node_id": "MDQ6VXNlcjI1MzQzMTYx", "avatar_url": "https://avatars0.githubusercontent.com/u/25343161?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mahatosourav91", "html_url": "https://github.com/mahatosourav91", "followers_url": "https://api.github.com/users/mahatosourav91/followers", "following_url": "https://api.github.com/users/mahatosourav91/following{/other_user}", "gists_url": "https://api.github.com/users/mahatosourav91/gists{/gist_id}", "starred_url": "https://api.github.com/users/mahatosourav91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mahatosourav91/subscriptions", "organizations_url": "https://api.github.com/users/mahatosourav91/orgs", "repos_url": "https://api.github.com/users/mahatosourav91/repos", "events_url": "https://api.github.com/users/mahatosourav91/events{/privacy}", "received_events_url": "https://api.github.com/users/mahatosourav91/received_events", "type": "User", "site_admin": false}, "created_at": "2017-03-01T13:57:27Z", "updated_at": "2017-03-08T12:15:55Z", "author_association": "NONE", "body_html": "<p>Hi <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=15676913\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/poxvoculi\">@poxvoculi</a> , <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4549793\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/xavigonzalvo\">@xavigonzalvo</a> , As per previous comments, I have modified <a href=\"https://github.com/mahatosourav91/tensorflow/blob/pseudo_matrix_inverse/tensorflow/contrib/factorization/python/ops/gmm_ops.py\">gmm_ops.py</a> and <a href=\"https://github.com/mahatosourav91/tensorflow/blob/pseudo_matrix_inverse/tensorflow/python/ops/linalg_ops.py\">linalg_ops.py</a> <a href=\"https://github.com/mahatosourav91/tensorflow/blob/pseudo_matrix_inverse/tensorflow/contrib/factorization/python/ops/gmm_ops.py\">here</a>.</p>\n<p>But when I tried to execute the following code I am getting a <code>NanLossDuringTrainingError</code></p>\n<pre><code>from tensorflow.contrib.factorization.python.ops import gmm as gmm_lib\nfrom tensorflow.python.framework import constant_op\nimport random\nimport numpy as np\n\n\ndef input_fn(x):\n    \"\"\"Returns an input_fn that randomly selects batches from given points.\"\"\"\n    def _fn():\n      return constant_op.constant(x.astype('float32')), None\n    return _fn\n\nx = np.array([[random.random() for i in range(10)] for j in range(2384)], dtype=np.float32)\ngmm = gmm_lib.GMM(200, random_seed=0)\ngmm.fit(input_fn=input_fn(x), max_steps=300)\n\ny = gmm.predict_assignments(input_fn=input_fn(x))\n</code></pre>\n<p>Error :-</p>\n<pre><code>ERROR:tensorflow:Model diverged with loss = NaN.\nTraceback (most recent call last):\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\IPython\\core\\interactiveshell.py\", line 2881, in run_code\n    exec(code_obj, self.user_global_ns, self.user_ns)\n  File \"&lt;ipython-input-2-7be5ab638a15&gt;\", line 15, in &lt;module&gt;\n    gmm.fit(input_fn=input_fn(x), max_steps=300)\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py\", line 281, in new_func\n    return func(*args, **kwargs)\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\estimators\\estimator.py\", line 418, in fit\n    loss = self._train_model(input_fn=input_fn, hooks=hooks)\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\estimators\\estimator.py\", line 968, in _train_model\n    return loss\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\contextlib.py\", line 77, in __exit__\n    self.gen.throw(type, value, traceback)\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3623, in get_controller\n    yield default\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\estimators\\estimator.py\", line 968, in _train_model\n    return loss\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\contextlib.py\", line 77, in __exit__\n    self.gen.throw(type, value, traceback)\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3049, in device\n    yield\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\estimators\\estimator.py\", line 966, in _train_model\n    _, loss = mon_sess.run([model_fn_ops.train_op, model_fn_ops.loss])\n  File \"C:\\Users\\gidnri6\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\training\\monitored_session.py\", line 483, in run\n    run_metadata=run_metadata)\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\training\\monitored_session.py\", line 818, in run\n    run_metadata=run_metadata)\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\training\\monitored_session.py\", line 775, in run\n    return self._sess.run(*args, **kwargs)\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\training\\monitored_session.py\", line 936, in run\n    run_metadata=run_metadata))\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\training\\basic_session_run_hooks.py\", line 481, in after_run\n    raise NanLossDuringTrainingError\ntensorflow.python.training.basic_session_run_hooks.NanLossDuringTrainingError: NaN loss during training.\n\n</code></pre>\n<p>Please note that this error occurs in ubuntu 16.04 also</p>", "body_text": "Hi @poxvoculi , @xavigonzalvo , As per previous comments, I have modified gmm_ops.py and linalg_ops.py here.\nBut when I tried to execute the following code I am getting a NanLossDuringTrainingError\nfrom tensorflow.contrib.factorization.python.ops import gmm as gmm_lib\nfrom tensorflow.python.framework import constant_op\nimport random\nimport numpy as np\n\n\ndef input_fn(x):\n    \"\"\"Returns an input_fn that randomly selects batches from given points.\"\"\"\n    def _fn():\n      return constant_op.constant(x.astype('float32')), None\n    return _fn\n\nx = np.array([[random.random() for i in range(10)] for j in range(2384)], dtype=np.float32)\ngmm = gmm_lib.GMM(200, random_seed=0)\ngmm.fit(input_fn=input_fn(x), max_steps=300)\n\ny = gmm.predict_assignments(input_fn=input_fn(x))\n\nError :-\nERROR:tensorflow:Model diverged with loss = NaN.\nTraceback (most recent call last):\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\IPython\\core\\interactiveshell.py\", line 2881, in run_code\n    exec(code_obj, self.user_global_ns, self.user_ns)\n  File \"<ipython-input-2-7be5ab638a15>\", line 15, in <module>\n    gmm.fit(input_fn=input_fn(x), max_steps=300)\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py\", line 281, in new_func\n    return func(*args, **kwargs)\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\estimators\\estimator.py\", line 418, in fit\n    loss = self._train_model(input_fn=input_fn, hooks=hooks)\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\estimators\\estimator.py\", line 968, in _train_model\n    return loss\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\contextlib.py\", line 77, in __exit__\n    self.gen.throw(type, value, traceback)\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3623, in get_controller\n    yield default\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\estimators\\estimator.py\", line 968, in _train_model\n    return loss\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\contextlib.py\", line 77, in __exit__\n    self.gen.throw(type, value, traceback)\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3049, in device\n    yield\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\estimators\\estimator.py\", line 966, in _train_model\n    _, loss = mon_sess.run([model_fn_ops.train_op, model_fn_ops.loss])\n  File \"C:\\Users\\gidnri6\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\training\\monitored_session.py\", line 483, in run\n    run_metadata=run_metadata)\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\training\\monitored_session.py\", line 818, in run\n    run_metadata=run_metadata)\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\training\\monitored_session.py\", line 775, in run\n    return self._sess.run(*args, **kwargs)\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\training\\monitored_session.py\", line 936, in run\n    run_metadata=run_metadata))\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\training\\basic_session_run_hooks.py\", line 481, in after_run\n    raise NanLossDuringTrainingError\ntensorflow.python.training.basic_session_run_hooks.NanLossDuringTrainingError: NaN loss during training.\n\n\nPlease note that this error occurs in ubuntu 16.04 also", "body": "Hi @poxvoculi , @xavigonzalvo , As per previous comments, I have modified [gmm_ops.py](https://github.com/mahatosourav91/tensorflow/blob/pseudo_matrix_inverse/tensorflow/contrib/factorization/python/ops/gmm_ops.py) and [linalg_ops.py](https://github.com/mahatosourav91/tensorflow/blob/pseudo_matrix_inverse/tensorflow/python/ops/linalg_ops.py) [here](https://github.com/mahatosourav91/tensorflow/blob/pseudo_matrix_inverse/tensorflow/contrib/factorization/python/ops/gmm_ops.py).\r\n\r\nBut when I tried to execute the following code I am getting a `NanLossDuringTrainingError`\r\n\r\n```\r\nfrom tensorflow.contrib.factorization.python.ops import gmm as gmm_lib\r\nfrom tensorflow.python.framework import constant_op\r\nimport random\r\nimport numpy as np\r\n\r\n\r\ndef input_fn(x):\r\n    \"\"\"Returns an input_fn that randomly selects batches from given points.\"\"\"\r\n    def _fn():\r\n      return constant_op.constant(x.astype('float32')), None\r\n    return _fn\r\n\r\nx = np.array([[random.random() for i in range(10)] for j in range(2384)], dtype=np.float32)\r\ngmm = gmm_lib.GMM(200, random_seed=0)\r\ngmm.fit(input_fn=input_fn(x), max_steps=300)\r\n\r\ny = gmm.predict_assignments(input_fn=input_fn(x))\r\n```\r\n\r\nError :- \r\n\r\n```\r\nERROR:tensorflow:Model diverged with loss = NaN.\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\IPython\\core\\interactiveshell.py\", line 2881, in run_code\r\n    exec(code_obj, self.user_global_ns, self.user_ns)\r\n  File \"<ipython-input-2-7be5ab638a15>\", line 15, in <module>\r\n    gmm.fit(input_fn=input_fn(x), max_steps=300)\r\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py\", line 281, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\estimators\\estimator.py\", line 418, in fit\r\n    loss = self._train_model(input_fn=input_fn, hooks=hooks)\r\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\estimators\\estimator.py\", line 968, in _train_model\r\n    return loss\r\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\contextlib.py\", line 77, in __exit__\r\n    self.gen.throw(type, value, traceback)\r\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3623, in get_controller\r\n    yield default\r\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\estimators\\estimator.py\", line 968, in _train_model\r\n    return loss\r\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\contextlib.py\", line 77, in __exit__\r\n    self.gen.throw(type, value, traceback)\r\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3049, in device\r\n    yield\r\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\estimators\\estimator.py\", line 966, in _train_model\r\n    _, loss = mon_sess.run([model_fn_ops.train_op, model_fn_ops.loss])\r\n  File \"C:\\Users\\gidnri6\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\training\\monitored_session.py\", line 483, in run\r\n    run_metadata=run_metadata)\r\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\training\\monitored_session.py\", line 818, in run\r\n    run_metadata=run_metadata)\r\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\training\\monitored_session.py\", line 775, in run\r\n    return self._sess.run(*args, **kwargs)\r\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\training\\monitored_session.py\", line 936, in run\r\n    run_metadata=run_metadata))\r\n  File \"C:\\Users\\#####\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\training\\basic_session_run_hooks.py\", line 481, in after_run\r\n    raise NanLossDuringTrainingError\r\ntensorflow.python.training.basic_session_run_hooks.NanLossDuringTrainingError: NaN loss during training.\r\n\r\n```\r\nPlease note that this error occurs in ubuntu 16.04 also"}