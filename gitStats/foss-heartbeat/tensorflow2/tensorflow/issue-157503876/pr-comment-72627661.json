{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/72627661", "pull_request_review_id": null, "id": 72627661, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcyNjI3NjYx", "diff_hunk": "@@ -239,26 +239,39 @@ class TestConfig(object):\n   vocab_size = 10000\n \n \n-def run_epoch(session, m, data, eval_op, verbose=False):\n+def run_epoch(session, model, data, eval_op, verbose=False):\n   \"\"\"Runs the model on the given data.\"\"\"\n-  epoch_size = ((len(data) // m.batch_size) - 1) // m.num_steps\n+  epoch_size = ((len(data) // model.batch_size) - 1) // model.num_steps\n   start_time = time.time()\n   costs = 0.0\n   iters = 0\n-  state = m.initial_state.eval()\n-  for step, (x, y) in enumerate(reader.ptb_iterator(data, m.batch_size,\n-                                                    m.num_steps)):\n-    cost, state, _ = session.run([m.cost, m.final_state, eval_op],\n-                                 {m.input_data: x,\n-                                  m.targets: y,\n-                                  m.initial_state: state})\n+  state = []\n+  for c, m in model.initial_state: # initial_state: ((c1, m1), (c2, m2))\n+    state.append((c.eval(), m.eval()))\n+  for step, (x, y) in enumerate(reader.ptb_iterator(data, model.batch_size,\n+                                                    model.num_steps)):\n+    fetches = []\n+    fetches.append(model.cost)", "path": "tensorflow/models/rnn/ptb/ptb_word_lm.py", "position": null, "original_position": 39, "commit_id": "766584d4ec59bef1a915bf14e927716a2b6a3a76", "original_commit_id": "2819a680c951220d30b47b2212535412a66bbe7a", "user": {"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}, "body": "Looks like you have to feed those separately.\n\nOn Jul 28, 2016 3:47 AM, \"Dipanjan Sarkar\" notifications@github.com wrote:\n\n> In tensorflow/models/rnn/ptb/ptb_word_lm.py\n> https://github.com/tensorflow/tensorflow/pull/2580#discussion_r72601158:\n> \n> >    start_time = time.time()\n> >    costs = 0.0\n> >    iters = 0\n> > -  state = m.initial_state.eval()\n> > -  for step, (x, y) in enumerate(reader.ptb_iterator(data, m.batch_size,\n> > -                                                    m.num_steps)):\n> > -    cost, state, _ = session.run([m.cost, m.final_state, eval_op],\n> > -                                 {m.input_data: x,\n> > -                                  m.targets: y,\n> > -                                  m.initial_state: state})\n> > -  state = []\n> > -  for c, m in model.initial_state: # initial_state: ((c1, m1), (c2, m2))\n> > -    state.append((c.eval(), m.eval()))\n> > -  for step, (x, y) in enumerate(reader.ptb_iterator(data, model.batch_size,\n> > -                                                    model.num_steps)):\n> > -    fetches = []\n> > -    fetches.append(model.cost)\n> \n> Hi @ebrevdo https://github.com/ebrevdo ,\n> \n> Thanks for the suggestion, this works till the point where I am having\n> some issues with the state, since we have m.initial_state: state in\n> feed_dict but now our initial state is no longer a concatenated tensor\n> but two different ones for the c and h states so how can we pass it to\n> the feed_dict?\n> \n> I just started with TensorFlow recently so I might be missing something\n> obvious.\n> \n> \u2014\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> https://github.com/tensorflow/tensorflow/pull/2580/files/2819a680c951220d30b47b2212535412a66bbe7a#r72601158,\n> or mute the thread\n> https://github.com/notifications/unsubscribe-auth/ABtimzBJOGYRRBqB4_F3hyBrqinFmwr9ks5qaIjGgaJpZM4IpzVZ\n> .\n", "created_at": "2016-07-28T14:04:21Z", "updated_at": "2016-08-10T04:35:57Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/2580#discussion_r72627661", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/2580", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/72627661"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/2580#discussion_r72627661"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/2580"}}, "body_html": "<p>Looks like you have to feed those separately.</p>\n<p>On Jul 28, 2016 3:47 AM, \"Dipanjan Sarkar\" <a href=\"mailto:notifications@github.com\">notifications@github.com</a> wrote:</p>\n<blockquote>\n<p>In tensorflow/models/rnn/ptb/ptb_word_lm.py<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"157503876\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/2580\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/2580/hovercard?comment_id=72601158&amp;comment_type=review_comment\" href=\"https://github.com/tensorflow/tensorflow/pull/2580#discussion_r72601158\">#2580 (comment)</a>:</p>\n<blockquote>\n<p>start_time = time.time()<br>\ncosts = 0.0<br>\niters = 0</p>\n<ul>\n<li>state = m.initial_state.eval()</li>\n<li>for step, (x, y) in enumerate(reader.ptb_iterator(data, m.batch_size,</li>\n<li>\n<pre><code>                                               m.num_steps)):\n</code></pre>\n</li>\n<li>cost, state, _ = session.run([m.cost, m.final_state, eval_op],</li>\n<li>\n<pre><code>                            {m.input_data: x,\n</code></pre>\n</li>\n<li>\n<pre><code>                             m.targets: y,\n</code></pre>\n</li>\n<li>\n<pre><code>                             m.initial_state: state})\n</code></pre>\n</li>\n<li>state = []</li>\n<li>for c, m in model.initial_state: # initial_state: ((c1, m1), (c2, m2))</li>\n<li>state.append((c.eval(), m.eval()))</li>\n<li>for step, (x, y) in enumerate(reader.ptb_iterator(data, model.batch_size,</li>\n<li>\n<pre><code>                                               model.num_steps)):\n</code></pre>\n</li>\n<li>fetches = []</li>\n<li>fetches.append(model.cost)</li>\n</ul>\n</blockquote>\n<p>Hi <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1794715\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ebrevdo\">@ebrevdo</a> <a href=\"https://github.com/ebrevdo\">https://github.com/ebrevdo</a> ,</p>\n<p>Thanks for the suggestion, this works till the point where I am having<br>\nsome issues with the state, since we have m.initial_state: state in<br>\nfeed_dict but now our initial state is no longer a concatenated tensor<br>\nbut two different ones for the c and h states so how can we pass it to<br>\nthe feed_dict?</p>\n<p>I just started with TensorFlow recently so I might be missing something<br>\nobvious.</p>\n<p>\u2014<br>\nYou are receiving this because you were mentioned.<br>\nReply to this email directly, view it on GitHub<br>\n<a href=\"https://github.com/tensorflow/tensorflow/pull/2580/files/2819a680c951220d30b47b2212535412a66bbe7a#r72601158\">https://github.com/tensorflow/tensorflow/pull/2580/files/2819a680c951220d30b47b2212535412a66bbe7a#r72601158</a>,<br>\nor mute the thread<br>\n<a href=\"https://github.com/notifications/unsubscribe-auth/ABtimzBJOGYRRBqB4_F3hyBrqinFmwr9ks5qaIjGgaJpZM4IpzVZ\">https://github.com/notifications/unsubscribe-auth/ABtimzBJOGYRRBqB4_F3hyBrqinFmwr9ks5qaIjGgaJpZM4IpzVZ</a><br>\n.</p>\n</blockquote>", "body_text": "Looks like you have to feed those separately.\nOn Jul 28, 2016 3:47 AM, \"Dipanjan Sarkar\" notifications@github.com wrote:\n\nIn tensorflow/models/rnn/ptb/ptb_word_lm.py\n#2580 (comment):\n\nstart_time = time.time()\ncosts = 0.0\niters = 0\n\nstate = m.initial_state.eval()\nfor step, (x, y) in enumerate(reader.ptb_iterator(data, m.batch_size,\n\n                                               m.num_steps)):\n\n\ncost, state, _ = session.run([m.cost, m.final_state, eval_op],\n\n                            {m.input_data: x,\n\n\n\n                             m.targets: y,\n\n\n\n                             m.initial_state: state})\n\n\nstate = []\nfor c, m in model.initial_state: # initial_state: ((c1, m1), (c2, m2))\nstate.append((c.eval(), m.eval()))\nfor step, (x, y) in enumerate(reader.ptb_iterator(data, model.batch_size,\n\n                                               model.num_steps)):\n\n\nfetches = []\nfetches.append(model.cost)\n\n\nHi @ebrevdo https://github.com/ebrevdo ,\nThanks for the suggestion, this works till the point where I am having\nsome issues with the state, since we have m.initial_state: state in\nfeed_dict but now our initial state is no longer a concatenated tensor\nbut two different ones for the c and h states so how can we pass it to\nthe feed_dict?\nI just started with TensorFlow recently so I might be missing something\nobvious.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/tensorflow/tensorflow/pull/2580/files/2819a680c951220d30b47b2212535412a66bbe7a#r72601158,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ABtimzBJOGYRRBqB4_F3hyBrqinFmwr9ks5qaIjGgaJpZM4IpzVZ\n."}