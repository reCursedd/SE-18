{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6502", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6502/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6502/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6502/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/6502", "id": 197590487, "node_id": "MDU6SXNzdWUxOTc1OTA0ODc=", "number": 6502, "title": "Insert rows ( arrays ) into a tensor at specific index , and index keeps on changing with batch of data", "user": {"login": "s4sarath", "id": 10637096, "node_id": "MDQ6VXNlcjEwNjM3MDk2", "avatar_url": "https://avatars0.githubusercontent.com/u/10637096?v=4", "gravatar_id": "", "url": "https://api.github.com/users/s4sarath", "html_url": "https://github.com/s4sarath", "followers_url": "https://api.github.com/users/s4sarath/followers", "following_url": "https://api.github.com/users/s4sarath/following{/other_user}", "gists_url": "https://api.github.com/users/s4sarath/gists{/gist_id}", "starred_url": "https://api.github.com/users/s4sarath/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/s4sarath/subscriptions", "organizations_url": "https://api.github.com/users/s4sarath/orgs", "repos_url": "https://api.github.com/users/s4sarath/repos", "events_url": "https://api.github.com/users/s4sarath/events{/privacy}", "received_events_url": "https://api.github.com/users/s4sarath/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473184161, "node_id": "MDU6TGFiZWw0NzMxODQxNjE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:support", "name": "type:support", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-12-26T13:54:28Z", "updated_at": "2016-12-28T23:51:26Z", "closed_at": "2016-12-28T23:51:16Z", "author_association": "NONE", "body_html": "<p>I have function , to which I have to pass a dynamic list of values and dynamic batch size, along with feed dict in Tensorflow. The tf.unstack function accepts an int only. This int here is my batch size and doc_length is list of values. It will change with each batch of data. The idea here, from RNN, i am getting a state matrix and I have to insert zeros at some particular indices.</p>\n<p>How to pass these dynamic batch size and list of values with sess.run( _ , feed_dict) for every batch of data ? Hope the question is clear.</p>\n<pre><code>### sentence_vec is the output from an RNN \n\ndef sentence_converter(sentence_vec, doc_length , batch_size):\n    sentence_tensors = tf.unstack(sentence_vec, batch_size, axis=0)\n    max_len = max(doc_length)\n\n    zero_tensor = tf.zeros(self.encoder_units)\n    temp = 0\n    for elem in doc_length:\n        if elem == max_len:\n            continue\n        diff = max_len - elem\n        diff_range = range(1, diff+1)\n        for sub_elem in diff_range:\n            insert = temp + sub_elem + elem\n            sentence_tensors.insert(insert-1, zero_tensor)\n        temp = insert\n    return tf.stack(sentence_tensors)\n\nX = tf.placeholder(tf.int32, shape=[None, None], name='X_input')\nX_len = tf.placeholder(tf.int32, shape=[None], name='X_length')\n\nenc_cell = tf.nn.rnn_cell.GRUCell(self.enco:der_units)#python.ops.rnn_cell.GRUCell\nenc_out, enc_state = tf.nn.dynamic_rnn(cell=enc_cell, inputs=X,\n                             sequence_length=X_len, dtype=tf.float32)\nfinal_state = sentence_converter(enc_state , batch_size , doc_len)\n\n\nif __name__ == \"__main__\":\n      sess = tf.Session()\n      sess.run(tf.initialize_all_variables())\n      output_state = sess.run(final_state , feed_dict(X:np.random.randn(2,11) , X_len:[3,2])\n\n\n</code></pre>\n<p>So, here 2 is the batch size . Suppose the doc_len = [5,7] , how will I pass these to get the final_state , each time. These doc_len is dynamically changing list with each batch.</p>", "body_text": "I have function , to which I have to pass a dynamic list of values and dynamic batch size, along with feed dict in Tensorflow. The tf.unstack function accepts an int only. This int here is my batch size and doc_length is list of values. It will change with each batch of data. The idea here, from RNN, i am getting a state matrix and I have to insert zeros at some particular indices.\nHow to pass these dynamic batch size and list of values with sess.run( _ , feed_dict) for every batch of data ? Hope the question is clear.\n### sentence_vec is the output from an RNN \n\ndef sentence_converter(sentence_vec, doc_length , batch_size):\n    sentence_tensors = tf.unstack(sentence_vec, batch_size, axis=0)\n    max_len = max(doc_length)\n\n    zero_tensor = tf.zeros(self.encoder_units)\n    temp = 0\n    for elem in doc_length:\n        if elem == max_len:\n            continue\n        diff = max_len - elem\n        diff_range = range(1, diff+1)\n        for sub_elem in diff_range:\n            insert = temp + sub_elem + elem\n            sentence_tensors.insert(insert-1, zero_tensor)\n        temp = insert\n    return tf.stack(sentence_tensors)\n\nX = tf.placeholder(tf.int32, shape=[None, None], name='X_input')\nX_len = tf.placeholder(tf.int32, shape=[None], name='X_length')\n\nenc_cell = tf.nn.rnn_cell.GRUCell(self.enco:der_units)#python.ops.rnn_cell.GRUCell\nenc_out, enc_state = tf.nn.dynamic_rnn(cell=enc_cell, inputs=X,\n                             sequence_length=X_len, dtype=tf.float32)\nfinal_state = sentence_converter(enc_state , batch_size , doc_len)\n\n\nif __name__ == \"__main__\":\n      sess = tf.Session()\n      sess.run(tf.initialize_all_variables())\n      output_state = sess.run(final_state , feed_dict(X:np.random.randn(2,11) , X_len:[3,2])\n\n\n\nSo, here 2 is the batch size . Suppose the doc_len = [5,7] , how will I pass these to get the final_state , each time. These doc_len is dynamically changing list with each batch.", "body": "I have function , to which I have to pass a dynamic list of values and dynamic batch size, along with feed dict in Tensorflow. The tf.unstack function accepts an int only. This int here is my batch size and doc_length is list of values. It will change with each batch of data. The idea here, from RNN, i am getting a state matrix and I have to insert zeros at some particular indices.\r\n\r\nHow to pass these dynamic batch size and list of values with sess.run( _ , feed_dict) for every batch of data ? Hope the question is clear.\r\n\r\n```\r\n### sentence_vec is the output from an RNN \r\n\r\ndef sentence_converter(sentence_vec, doc_length , batch_size):\r\n    sentence_tensors = tf.unstack(sentence_vec, batch_size, axis=0)\r\n    max_len = max(doc_length)\r\n\r\n    zero_tensor = tf.zeros(self.encoder_units)\r\n    temp = 0\r\n    for elem in doc_length:\r\n        if elem == max_len:\r\n            continue\r\n        diff = max_len - elem\r\n        diff_range = range(1, diff+1)\r\n        for sub_elem in diff_range:\r\n            insert = temp + sub_elem + elem\r\n            sentence_tensors.insert(insert-1, zero_tensor)\r\n        temp = insert\r\n    return tf.stack(sentence_tensors)\r\n\r\nX = tf.placeholder(tf.int32, shape=[None, None], name='X_input')\r\nX_len = tf.placeholder(tf.int32, shape=[None], name='X_length')\r\n\r\nenc_cell = tf.nn.rnn_cell.GRUCell(self.enco:der_units)#python.ops.rnn_cell.GRUCell\r\nenc_out, enc_state = tf.nn.dynamic_rnn(cell=enc_cell, inputs=X,\r\n                             sequence_length=X_len, dtype=tf.float32)\r\nfinal_state = sentence_converter(enc_state , batch_size , doc_len)\r\n\r\n\r\nif __name__ == \"__main__\":\r\n      sess = tf.Session()\r\n      sess.run(tf.initialize_all_variables())\r\n      output_state = sess.run(final_state , feed_dict(X:np.random.randn(2,11) , X_len:[3,2])\r\n\r\n\r\n```\r\n\r\nSo, here 2 is the batch size . Suppose the doc_len = [5,7] , how will I pass these to get the final_state , each time. These doc_len is dynamically changing list with each batch. "}