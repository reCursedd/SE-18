{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/361453270", "html_url": "https://github.com/tensorflow/tensorflow/issues/15891#issuecomment-361453270", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15891", "id": 361453270, "node_id": "MDEyOklzc3VlQ29tbWVudDM2MTQ1MzI3MA==", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars3.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "site_admin": false}, "created_at": "2018-01-30T02:09:17Z", "updated_at": "2018-01-30T02:16:38Z", "author_association": "NONE", "body_html": "<p>I created a gist for the graph def: <a href=\"https://gist.github.com/dtrebbien/f917cb2891e0b141b9fa6323a3c55239\">https://gist.github.com/dtrebbien/f917cb2891e0b141b9fa6323a3c55239</a></p>\n<p>Here is the exact modified test case that I used to print the graph def:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">from</span> <span class=\"pl-c1\">__future__</span> <span class=\"pl-k\">import</span> division, print_function\n<span class=\"pl-k\">import</span> numpy <span class=\"pl-k\">as</span> np\n<span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\nrs <span class=\"pl-k\">=</span> np.random.RandomState(<span class=\"pl-v\">seed</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">2</span>)\nA <span class=\"pl-k\">=</span> rs.normal(<span class=\"pl-v\">size</span> <span class=\"pl-k\">=</span> (<span class=\"pl-c1\">10</span>, <span class=\"pl-c1\">10</span>,))\n<span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>singular values of A: <span class=\"pl-c1\">%s</span><span class=\"pl-pds\">'</span></span> <span class=\"pl-k\">%</span> (np.linalg.svd(A, <span class=\"pl-v\">compute_uv</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">False</span>),))\nB <span class=\"pl-k\">=</span> rs.normal(<span class=\"pl-v\">size</span> <span class=\"pl-k\">=</span> (<span class=\"pl-c1\">10</span>, <span class=\"pl-c1\">10</span>,))\n<span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>singular values of B: <span class=\"pl-c1\">%s</span><span class=\"pl-pds\">'</span></span> <span class=\"pl-k\">%</span> (np.linalg.svd(B, <span class=\"pl-v\">compute_uv</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">False</span>),))\n\ngraph <span class=\"pl-k\">=</span> tf.Graph()\n<span class=\"pl-k\">with</span> graph.as_default():\n    A_var <span class=\"pl-k\">=</span> tf.Variable(B, <span class=\"pl-v\">name</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>A_var<span class=\"pl-pds\">'</span></span>)\n    init_A_var_op <span class=\"pl-k\">=</span> tf.assign(A_var, A, <span class=\"pl-v\">name</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>init_A_var_op<span class=\"pl-pds\">'</span></span>)\n    A_dep <span class=\"pl-k\">=</span> tf.constant(<span class=\"pl-c1\">9</span>, tf.int32, <span class=\"pl-v\">name</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>initial_A_dep<span class=\"pl-pds\">'</span></span>)\n\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">loop_condition</span>(<span class=\"pl-smi\">j</span>, <span class=\"pl-smi\">A_dep</span>):\n        <span class=\"pl-k\">return</span> j <span class=\"pl-k\">&lt;</span> <span class=\"pl-c1\">1</span>\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">loop_body</span>(<span class=\"pl-smi\">j</span>, <span class=\"pl-smi\">A_dep</span>):\n        <span class=\"pl-k\">with</span> tf.control_dependencies([init_A_var_op]):\n            A_dep <span class=\"pl-k\">=</span> tf.add(A_dep, <span class=\"pl-c1\">1</span>, <span class=\"pl-v\">name</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>increment_A_dep<span class=\"pl-pds\">'</span></span>)\n        <span class=\"pl-k\">return</span> j <span class=\"pl-k\">+</span> <span class=\"pl-c1\">1</span>, A_dep\n\n    _, A_dep <span class=\"pl-k\">=</span> tf.while_loop(loop_condition,\n                             loop_body,\n                             <span class=\"pl-v\">loop_vars</span> <span class=\"pl-k\">=</span> [tf.constant(<span class=\"pl-c1\">0</span>, tf.int32), A_dep],\n                             <span class=\"pl-v\">parallel_iterations</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">1</span>,\n                             <span class=\"pl-v\">back_prop</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">False</span>)\n\n    <span class=\"pl-k\">with</span> tf.control_dependencies([A_dep]):\n        var_s <span class=\"pl-k\">=</span> tf.svd(A_var, <span class=\"pl-v\">compute_uv</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">False</span>)\n\n<span class=\"pl-c1\">print</span>(graph.as_graph_def())\n\n<span class=\"pl-k\">with</span> tf.Session(<span class=\"pl-v\">graph</span> <span class=\"pl-k\">=</span> graph) <span class=\"pl-k\">as</span> session:\n    session.run(tf.global_variables_initializer())\n    computed_A_dep, computed_s, computed_A_dep2 <span class=\"pl-k\">=</span> session.run([A_dep, var_s, A_dep])\n    <span class=\"pl-k\">assert</span> computed_A_dep <span class=\"pl-k\">==</span> computed_A_dep2\n<span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>computed_s = <span class=\"pl-c1\">%s</span>, computed_A_dep = <span class=\"pl-c1\">%d</span><span class=\"pl-pds\">'</span></span> <span class=\"pl-k\">%</span> (computed_s, computed_A_dep,))</pre></div>\n<p>By the way, is there a utility that can graphically display this?</p>", "body_text": "I created a gist for the graph def: https://gist.github.com/dtrebbien/f917cb2891e0b141b9fa6323a3c55239\nHere is the exact modified test case that I used to print the graph def:\nfrom __future__ import division, print_function\nimport numpy as np\nimport tensorflow as tf\n\nrs = np.random.RandomState(seed = 2)\nA = rs.normal(size = (10, 10,))\nprint('singular values of A: %s' % (np.linalg.svd(A, compute_uv = False),))\nB = rs.normal(size = (10, 10,))\nprint('singular values of B: %s' % (np.linalg.svd(B, compute_uv = False),))\n\ngraph = tf.Graph()\nwith graph.as_default():\n    A_var = tf.Variable(B, name = 'A_var')\n    init_A_var_op = tf.assign(A_var, A, name = 'init_A_var_op')\n    A_dep = tf.constant(9, tf.int32, name = 'initial_A_dep')\n\n    def loop_condition(j, A_dep):\n        return j < 1\n    def loop_body(j, A_dep):\n        with tf.control_dependencies([init_A_var_op]):\n            A_dep = tf.add(A_dep, 1, name = 'increment_A_dep')\n        return j + 1, A_dep\n\n    _, A_dep = tf.while_loop(loop_condition,\n                             loop_body,\n                             loop_vars = [tf.constant(0, tf.int32), A_dep],\n                             parallel_iterations = 1,\n                             back_prop = False)\n\n    with tf.control_dependencies([A_dep]):\n        var_s = tf.svd(A_var, compute_uv = False)\n\nprint(graph.as_graph_def())\n\nwith tf.Session(graph = graph) as session:\n    session.run(tf.global_variables_initializer())\n    computed_A_dep, computed_s, computed_A_dep2 = session.run([A_dep, var_s, A_dep])\n    assert computed_A_dep == computed_A_dep2\nprint('computed_s = %s, computed_A_dep = %d' % (computed_s, computed_A_dep,))\nBy the way, is there a utility that can graphically display this?", "body": "I created a gist for the graph def: https://gist.github.com/dtrebbien/f917cb2891e0b141b9fa6323a3c55239\r\n\r\nHere is the exact modified test case that I used to print the graph def:\r\n\r\n```python\r\nfrom __future__ import division, print_function\r\nimport numpy as np\r\nimport tensorflow as tf\r\n\r\nrs = np.random.RandomState(seed = 2)\r\nA = rs.normal(size = (10, 10,))\r\nprint('singular values of A: %s' % (np.linalg.svd(A, compute_uv = False),))\r\nB = rs.normal(size = (10, 10,))\r\nprint('singular values of B: %s' % (np.linalg.svd(B, compute_uv = False),))\r\n\r\ngraph = tf.Graph()\r\nwith graph.as_default():\r\n    A_var = tf.Variable(B, name = 'A_var')\r\n    init_A_var_op = tf.assign(A_var, A, name = 'init_A_var_op')\r\n    A_dep = tf.constant(9, tf.int32, name = 'initial_A_dep')\r\n\r\n    def loop_condition(j, A_dep):\r\n        return j < 1\r\n    def loop_body(j, A_dep):\r\n        with tf.control_dependencies([init_A_var_op]):\r\n            A_dep = tf.add(A_dep, 1, name = 'increment_A_dep')\r\n        return j + 1, A_dep\r\n\r\n    _, A_dep = tf.while_loop(loop_condition,\r\n                             loop_body,\r\n                             loop_vars = [tf.constant(0, tf.int32), A_dep],\r\n                             parallel_iterations = 1,\r\n                             back_prop = False)\r\n\r\n    with tf.control_dependencies([A_dep]):\r\n        var_s = tf.svd(A_var, compute_uv = False)\r\n\r\nprint(graph.as_graph_def())\r\n\r\nwith tf.Session(graph = graph) as session:\r\n    session.run(tf.global_variables_initializer())\r\n    computed_A_dep, computed_s, computed_A_dep2 = session.run([A_dep, var_s, A_dep])\r\n    assert computed_A_dep == computed_A_dep2\r\nprint('computed_s = %s, computed_A_dep = %d' % (computed_s, computed_A_dep,))\r\n```\r\n\r\nBy the way, is there a utility that can graphically display this?"}