{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/217825390", "pull_request_review_id": 153971420, "id": 217825390, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNzgyNTM5MA==", "diff_hunk": "@@ -1648,6 +1648,60 @@ REGISTER_OP(\"Slice\")\n       return Status::OK();\n     });\n \n+#ifdef INTEL_MKL\n+REGISTER_OP(\"_MklSlice\")\n+    .Input(\"input: T\")\n+    .Input(\"begin: Index\")\n+    .Input(\"size: Index\")\n+    .Input(\"mkl_input: uint8\")\n+    .Input(\"mkl_begin: uint8\")\n+    .Input(\"mkl_size: uint8\")\n+    .Output(\"output: T\")\n+    .Output(\"mkl_output: uint8\")\n+    .Attr(\"T: type\")\n+    .Attr(\"Index: {int32,int64}\")\n+    .SetShapeFn([](InferenceContext* c) {\n+      ShapeHandle input = c->input(0);\n+      ShapeHandle begin_shape;\n+      TF_RETURN_IF_ERROR(c->WithRank(c->input(1), 1, &begin_shape));\n+      ShapeHandle sizes_shape;\n+      TF_RETURN_IF_ERROR(c->WithRank(c->input(2), 1, &sizes_shape));\n+\n+      // Merge to check compatibility of begin and sizes tensors.\n+      TF_RETURN_IF_ERROR(c->Merge(begin_shape, sizes_shape, &begin_shape));\n+\n+      DimensionHandle ndims = c->Dim(begin_shape, 0);\n+      if (c->ValueKnown(ndims)) {\n+        TF_RETURN_IF_ERROR(c->WithRank(input, c->Value(ndims), &input));\n+      }\n+\n+      // NOTE(mrry): Use MakeShapeFromShapeTensor to handle partially-known\n+      // values, even though the `begin` value does not represent a shape.\n+      ShapeHandle begin_value;\n+      TF_RETURN_IF_ERROR(c->MakeShapeFromShapeTensor(1, &begin_value));\n+\n+      // NOTE(mrry): We can't use `MakeShapeFromShapeTensor` for `sizes` because\n+      // it might contain -1, which can't be represented -1 in the ShapeHandle\n+      // would meqan \"unknown\".\n+      const Tensor* sizes_value = c->input_tensor(3);\n+\n+      if (sizes_value != nullptr) {\n+        TF_RETURN_IF_ERROR(\n+            c->WithRank(begin_value, sizes_value->NumElements(), &begin_value));\n+        std::vector<DimensionHandle> dims;\n+        // If the begin and sizes tensors are available, then\n+        // we can be precise about the shape of the output.\n+        if (sizes_value->dtype() == DT_INT64) {\n+          TF_RETURN_IF_ERROR(\n+              SliceHelper<int64>(c, begin_value, sizes_value, &dims));\n+        } else {\n+          TF_RETURN_IF_ERROR(\n+              SliceHelper<int32>(c, begin_value, sizes_value, &dims));\n+        }\n+      }\n+    });", "path": "tensorflow/core/ops/array_ops.cc", "position": null, "original_position": 55, "commit_id": "d1ab8b71c2115caacfec19d849ddabf7f1f4287b", "original_commit_id": "6712df7f3c73bfabab51e7c7eed2130d7bcff6ec", "user": {"login": "penpornk", "id": 38085909, "node_id": "MDQ6VXNlcjM4MDg1OTA5", "avatar_url": "https://avatars3.githubusercontent.com/u/38085909?v=4", "gravatar_id": "", "url": "https://api.github.com/users/penpornk", "html_url": "https://github.com/penpornk", "followers_url": "https://api.github.com/users/penpornk/followers", "following_url": "https://api.github.com/users/penpornk/following{/other_user}", "gists_url": "https://api.github.com/users/penpornk/gists{/gist_id}", "starred_url": "https://api.github.com/users/penpornk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/penpornk/subscriptions", "organizations_url": "https://api.github.com/users/penpornk/orgs", "repos_url": "https://api.github.com/users/penpornk/repos", "events_url": "https://api.github.com/users/penpornk/events{/privacy}", "received_events_url": "https://api.github.com/users/penpornk/received_events", "type": "User", "site_admin": false}, "body": "Please set the inferred shape back into the `InferenceContext`, \r\n```c++\r\nc->set_output(0, c->MakeShape(dims));\r\n```\r\nThe function should also return a status,\r\n```c++\r\nreturn Status::OK();\r\n```", "created_at": "2018-09-14T19:54:45Z", "updated_at": "2018-09-25T03:16:24Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/22076#discussion_r217825390", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/22076", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/217825390"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/22076#discussion_r217825390"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/22076"}}, "body_html": "<p>Please set the inferred shape back into the <code>InferenceContext</code>,</p>\n<div class=\"highlight highlight-source-c++\"><pre>c-&gt;<span class=\"pl-en\">set_output</span>(<span class=\"pl-c1\">0</span>, c-&gt;<span class=\"pl-en\">MakeShape</span>(dims));</pre></div>\n<p>The function should also return a status,</p>\n<div class=\"highlight highlight-source-c++\"><pre><span class=\"pl-k\">return</span> Status::OK();</pre></div>", "body_text": "Please set the inferred shape back into the InferenceContext,\nc->set_output(0, c->MakeShape(dims));\nThe function should also return a status,\nreturn Status::OK();"}