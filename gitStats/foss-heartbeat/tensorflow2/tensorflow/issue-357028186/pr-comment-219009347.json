{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/219009347", "pull_request_review_id": 157077075, "id": 219009347, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTAwOTM0Nw==", "diff_hunk": "@@ -1306,6 +1306,110 @@ Status RandomShape(shape_inference::InferenceContext* c) {\n   return Status::OK();\n }\n \n+// This SliceHelper processes the output shape of the `slice`\n+// when the tensor of `sizes` is available.\n+template <typename T>\n+Status SliceHelper(InferenceContext* c, ShapeHandle begin_value,\n+                   const Tensor* sizes_value,\n+                   std::vector<DimensionHandle>* dims) {\n+  auto sizes_vec = sizes_value->vec<T>();\n+  for (int i = 0; i < sizes_value->NumElements(); ++i) {\n+    DimensionHandle dim = c->Dim(c->input(0), i);\n+    if (sizes_vec(i) != -1) {\n+      auto dim_val = c->Value(dim);\n+      if (sizes_vec(i) < 0) {\n+        return errors::InvalidArgument(\n+            \"Out of bounds slicing on dimension \", i, \" of length \", dim_val,\n+            \": sizes vector cannot be < -1, but was \", sizes_vec(i));\n+      }\n+\n+      dims->emplace_back(c->MakeDim(sizes_vec(i)));\n+    } else {\n+      DimensionHandle result;\n+      TF_RETURN_IF_ERROR(c->Subtract(dim, c->Dim(begin_value, i), &result));\n+      dims->emplace_back(result);\n+    }\n+  }\n+\n+  return Status::OK();\n+}\n+\n+Status SliceShape(InferenceContext* c) {\n+  ShapeHandle input = c->input(0);\n+  ShapeHandle begin_shape;\n+  TF_RETURN_IF_ERROR(c->WithRank(c->input(1), 1, &begin_shape));\n+  ShapeHandle sizes_shape;\n+  TF_RETURN_IF_ERROR(c->WithRank(c->input(2), 1, &sizes_shape));\n+\n+  // Merge to check compatibility of begin and sizes tensors.\n+  TF_RETURN_IF_ERROR(c->Merge(begin_shape, sizes_shape, &begin_shape));\n+\n+  DimensionHandle ndims = c->Dim(begin_shape, 0);\n+  if (c->ValueKnown(ndims)) {\n+    TF_RETURN_IF_ERROR(c->WithRank(input, c->Value(ndims), &input));\n+  }\n+\n+  // NOTE(mrry): Use MakeShapeFromShapeTensor to handle partially-known\n+  // values, even though the `begin` value does not represent a shape.\n+  ShapeHandle begin_value;\n+  TF_RETURN_IF_ERROR(c->MakeShapeFromShapeTensor(1, &begin_value));\n+\n+  // We check the tensor value here and will only use\n+  // `MakeShapeFromShapeTensor` when `sizes_value` is null.\n+  // The reason is that `sizes`might contain -1, which can't", "path": "tensorflow/core/framework/common_shape_fns.cc", "position": null, "original_position": 54, "commit_id": "d1ab8b71c2115caacfec19d849ddabf7f1f4287b", "original_commit_id": "d7a8e852941e8cd856caafddf7c93d857e83e8b1", "user": {"login": "penpornk", "id": 38085909, "node_id": "MDQ6VXNlcjM4MDg1OTA5", "avatar_url": "https://avatars3.githubusercontent.com/u/38085909?v=4", "gravatar_id": "", "url": "https://api.github.com/users/penpornk", "html_url": "https://github.com/penpornk", "followers_url": "https://api.github.com/users/penpornk/followers", "following_url": "https://api.github.com/users/penpornk/following{/other_user}", "gists_url": "https://api.github.com/users/penpornk/gists{/gist_id}", "starred_url": "https://api.github.com/users/penpornk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/penpornk/subscriptions", "organizations_url": "https://api.github.com/users/penpornk/orgs", "repos_url": "https://api.github.com/users/penpornk/repos", "events_url": "https://api.github.com/users/penpornk/events{/privacy}", "received_events_url": "https://api.github.com/users/penpornk/received_events", "type": "User", "site_admin": false}, "body": "Please add a space between `'sizes'` and `might`.", "created_at": "2018-09-20T01:12:42Z", "updated_at": "2018-09-25T03:16:24Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/22076#discussion_r219009347", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/22076", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/219009347"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/22076#discussion_r219009347"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/22076"}}, "body_html": "<p>Please add a space between <code>'sizes'</code> and <code>might</code>.</p>", "body_text": "Please add a space between 'sizes' and might."}