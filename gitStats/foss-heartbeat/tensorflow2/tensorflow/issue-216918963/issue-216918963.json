{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8702", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8702/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8702/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8702/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/8702", "id": 216918963, "node_id": "MDU6SXNzdWUyMTY5MTg5NjM=", "number": 8702, "title": "[bug] bazel cudnn-version-check is broken on python 2.7 / ubuntu 14.04", "user": {"login": "liuyipei", "id": 4404828, "node_id": "MDQ6VXNlcjQ0MDQ4Mjg=", "avatar_url": "https://avatars0.githubusercontent.com/u/4404828?v=4", "gravatar_id": "", "url": "https://api.github.com/users/liuyipei", "html_url": "https://github.com/liuyipei", "followers_url": "https://api.github.com/users/liuyipei/followers", "following_url": "https://api.github.com/users/liuyipei/following{/other_user}", "gists_url": "https://api.github.com/users/liuyipei/gists{/gist_id}", "starred_url": "https://api.github.com/users/liuyipei/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/liuyipei/subscriptions", "organizations_url": "https://api.github.com/users/liuyipei/orgs", "repos_url": "https://api.github.com/users/liuyipei/repos", "events_url": "https://api.github.com/users/liuyipei/events{/privacy}", "received_events_url": "https://api.github.com/users/liuyipei/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}, {"id": 473173351, "node_id": "MDU6TGFiZWw0NzMxNzMzNTE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:build/install", "name": "type:build/install", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2017-03-24T22:21:26Z", "updated_at": "2017-03-29T03:56:22Z", "closed_at": "2017-03-29T03:56:22Z", "author_association": "CONTRIBUTOR", "body_html": "<p>When I ./configure on /r1.1 or /r1.0, I get the following error:</p>\n<pre><code>Auto-Configuration Error: cuDNN version detected from /usr/local/cuda-8.0/include/cudnn.h (      5.      1. 5) does not match TF_CUDNN_VERSION (5.1.5)\n</code></pre>\n<p>For what it is worth, I counted the space in cudnn.h, and they match the number of spaces in that error message above. Not sure if related.</p>\n<pre><code>#define CUDNN_MAJOR      5\n#define CUDNN_MINOR      1\n#define CUDNN_PATCHLEVEL 5\n</code></pre>\n<pre><code>$ ./configure\nPlease specify the location of python. [Default is /usr/bin/python]: \nPlease specify optimization flags to use during compilation [Default is -march=native]: \nDo you wish to use jemalloc as the malloc implementation? (Linux only) [Y/n] \njemalloc enabled on Linux\nDo you wish to build TensorFlow with Google Cloud Platform support? [y/N] \nNo Google Cloud Platform support will be enabled for TensorFlow\nDo you wish to build TensorFlow with Hadoop File System support? [y/N] \nNo Hadoop File System support will be enabled for TensorFlow\nDo you wish to build TensorFlow with the XLA just-in-time compiler (experimental)? [y/N] \nNo XLA support will be enabled for TensorFlow\nFound possible Python library paths:\n  /usr/local/lib/python2.7/dist-packages\nPlease input the desired Python library path to use.  Default is [/usr/local/lib/python2.7/dist-packages]\n/usr/local/lib/python2.7/dist-packages\nDo you wish to build TensorFlow with OpenCL support? [y/N] \nNo OpenCL support will be enabled for TensorFlow\nDo you wish to build TensorFlow with CUDA support? [y/N] y\nCUDA support will be enabled for TensorFlow\nPlease specify which gcc should be used by nvcc as the host compiler. [Default is /usr/bin/gcc]: \nPlease specify the CUDA SDK version you want to use, e.g. 7.0. [Leave empty to use system default]: 8.0\nPlease specify the location where CUDA 8.0 toolkit is installed. Refer to README.md for more details. [Default is /usr/local/cuda]: \nPlease specify the Cudnn version you want to use. [Leave empty to use system default]: 5.1.5\nPlease specify the location where cuDNN 5.1.5 library is installed. Refer to README.md for more details. [Default is /usr/local/cuda]: \nPlease specify a list of comma-separated Cuda compute capabilities you want to build with.\nYou can find the compute capability of your device at: https://developer.nvidia.com/cuda-gpus.\nPlease note that each additional compute capability significantly increases your build time and binary size.\n[Default is: \"3.5,5.2\"]: \nINFO: Starting clean (this may take a while). Consider using --expunge_async if the clean takes more than several minutes.\n..........\nERROR: package contains errors: tensorflow/core/kernels/cloud.\nERROR: error loading package 'tensorflow/core/kernels/cloud': Encountered error while reading extension file 'cuda/build_defs.bzl': no such package '@local_config_cuda//cuda': Traceback (most recent call last):\n\tFile \"/mnt/6tb_internal/cnn_experiments/tensorflow_src/tensorflow/third_party/gpus/cuda_configure.bzl\", line 815\n\t\t_create_cuda_repository(repository_ctx)\n\tFile \"/mnt/6tb_internal/cnn_experiments/tensorflow_src/tensorflow/third_party/gpus/cuda_configure.bzl\", line 728, in _create_cuda_repository\n\t\t_get_cuda_config(repository_ctx)\n\tFile \"/mnt/6tb_internal/cnn_experiments/tensorflow_src/tensorflow/third_party/gpus/cuda_configure.bzl\", line 584, in _get_cuda_config\n\t\t_cudnn_version(repository_ctx, cudnn_install_base..., ...)\n\tFile \"/mnt/6tb_internal/cnn_experiments/tensorflow_src/tensorflow/third_party/gpus/cuda_configure.bzl\", line 311, in _cudnn_version\n\t\tauto_configure_fail(\"cuDNN version detected from %s ...))\n\tFile \"/mnt/6tb_internal/cnn_experiments/tensorflow_src/tensorflow/third_party/gpus/cuda_configure.bzl\", line 93, in auto_configure_fail\n\t\tfail(\"\n%sAuto-Configuration Error:%s ...))\n\nAuto-Configuration Error: cuDNN version detected from /usr/local/cuda-8.0/include/cudnn.h (      5.      1. 5) does not match TF_CUDNN_VERSION (5.1.5)\n</code></pre>\n<h3>Environment info</h3>\n<p>Operating System: Ubuntu 14.04 LTS</p>\n<p>Installed version of CUDA and cuDNN:<br>\n(please attach the output of <code>ls -l /path/to/cuda/lib/libcud*</code>):</p>\n<pre><code>$ ls -l /usr/local/cuda/lib64/libcud*\n-rw-r--r-- 1 root root   558720 Sep 14  2016 /usr/local/cuda/lib64/libcudadevrt.a\nlrwxrwxrwx 1 root root       16 Sep 14  2016 /usr/local/cuda/lib64/libcudart.so -&gt; libcudart.so.8.0\nlrwxrwxrwx 1 root root       19 Sep 14  2016 /usr/local/cuda/lib64/libcudart.so.8.0 -&gt; libcudart.so.8.0.44\n-rw-r--r-- 1 root root   415432 Sep 14  2016 /usr/local/cuda/lib64/libcudart.so.8.0.44\n-rw-r--r-- 1 root root   775162 Sep 14  2016 /usr/local/cuda/lib64/libcudart_static.a\n-rwxr-xr-x 1 root root 79337624 Nov  7 13:54 /usr/local/cuda/lib64/libcudnn.so\n-rwxr-xr-x 1 root root 79337624 Nov  7 13:54 /usr/local/cuda/lib64/libcudnn.so.5\n-rwxr-xr-x 1 root root 79337624 Nov  7 13:54 /usr/local/cuda/lib64/libcudnn.so.5.1.5\n-rw-r--r-- 1 root root 69756172 Nov  7 13:54 /usr/local/cuda/lib64/libcudnn_static.a\n</code></pre>\n<p>If installed from source, provide</p>\n<ol>\n<li>The commit hash (<code>git rev-parse HEAD</code>)</li>\n<li>The output of <code>bazel version</code></li>\n</ol>\n<pre><code>r1.0, r1.1\n\nBuild label: 0.4.5\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Thu Mar 16 12:19:38 2017 (1489666778)\nBuild timestamp: 1489666778\nBuild timestamp as int: 1489666778\n</code></pre>", "body_text": "When I ./configure on /r1.1 or /r1.0, I get the following error:\nAuto-Configuration Error: cuDNN version detected from /usr/local/cuda-8.0/include/cudnn.h (      5.      1. 5) does not match TF_CUDNN_VERSION (5.1.5)\n\nFor what it is worth, I counted the space in cudnn.h, and they match the number of spaces in that error message above. Not sure if related.\n#define CUDNN_MAJOR      5\n#define CUDNN_MINOR      1\n#define CUDNN_PATCHLEVEL 5\n\n$ ./configure\nPlease specify the location of python. [Default is /usr/bin/python]: \nPlease specify optimization flags to use during compilation [Default is -march=native]: \nDo you wish to use jemalloc as the malloc implementation? (Linux only) [Y/n] \njemalloc enabled on Linux\nDo you wish to build TensorFlow with Google Cloud Platform support? [y/N] \nNo Google Cloud Platform support will be enabled for TensorFlow\nDo you wish to build TensorFlow with Hadoop File System support? [y/N] \nNo Hadoop File System support will be enabled for TensorFlow\nDo you wish to build TensorFlow with the XLA just-in-time compiler (experimental)? [y/N] \nNo XLA support will be enabled for TensorFlow\nFound possible Python library paths:\n  /usr/local/lib/python2.7/dist-packages\nPlease input the desired Python library path to use.  Default is [/usr/local/lib/python2.7/dist-packages]\n/usr/local/lib/python2.7/dist-packages\nDo you wish to build TensorFlow with OpenCL support? [y/N] \nNo OpenCL support will be enabled for TensorFlow\nDo you wish to build TensorFlow with CUDA support? [y/N] y\nCUDA support will be enabled for TensorFlow\nPlease specify which gcc should be used by nvcc as the host compiler. [Default is /usr/bin/gcc]: \nPlease specify the CUDA SDK version you want to use, e.g. 7.0. [Leave empty to use system default]: 8.0\nPlease specify the location where CUDA 8.0 toolkit is installed. Refer to README.md for more details. [Default is /usr/local/cuda]: \nPlease specify the Cudnn version you want to use. [Leave empty to use system default]: 5.1.5\nPlease specify the location where cuDNN 5.1.5 library is installed. Refer to README.md for more details. [Default is /usr/local/cuda]: \nPlease specify a list of comma-separated Cuda compute capabilities you want to build with.\nYou can find the compute capability of your device at: https://developer.nvidia.com/cuda-gpus.\nPlease note that each additional compute capability significantly increases your build time and binary size.\n[Default is: \"3.5,5.2\"]: \nINFO: Starting clean (this may take a while). Consider using --expunge_async if the clean takes more than several minutes.\n..........\nERROR: package contains errors: tensorflow/core/kernels/cloud.\nERROR: error loading package 'tensorflow/core/kernels/cloud': Encountered error while reading extension file 'cuda/build_defs.bzl': no such package '@local_config_cuda//cuda': Traceback (most recent call last):\n\tFile \"/mnt/6tb_internal/cnn_experiments/tensorflow_src/tensorflow/third_party/gpus/cuda_configure.bzl\", line 815\n\t\t_create_cuda_repository(repository_ctx)\n\tFile \"/mnt/6tb_internal/cnn_experiments/tensorflow_src/tensorflow/third_party/gpus/cuda_configure.bzl\", line 728, in _create_cuda_repository\n\t\t_get_cuda_config(repository_ctx)\n\tFile \"/mnt/6tb_internal/cnn_experiments/tensorflow_src/tensorflow/third_party/gpus/cuda_configure.bzl\", line 584, in _get_cuda_config\n\t\t_cudnn_version(repository_ctx, cudnn_install_base..., ...)\n\tFile \"/mnt/6tb_internal/cnn_experiments/tensorflow_src/tensorflow/third_party/gpus/cuda_configure.bzl\", line 311, in _cudnn_version\n\t\tauto_configure_fail(\"cuDNN version detected from %s ...))\n\tFile \"/mnt/6tb_internal/cnn_experiments/tensorflow_src/tensorflow/third_party/gpus/cuda_configure.bzl\", line 93, in auto_configure_fail\n\t\tfail(\"\n%sAuto-Configuration Error:%s ...))\n\nAuto-Configuration Error: cuDNN version detected from /usr/local/cuda-8.0/include/cudnn.h (      5.      1. 5) does not match TF_CUDNN_VERSION (5.1.5)\n\nEnvironment info\nOperating System: Ubuntu 14.04 LTS\nInstalled version of CUDA and cuDNN:\n(please attach the output of ls -l /path/to/cuda/lib/libcud*):\n$ ls -l /usr/local/cuda/lib64/libcud*\n-rw-r--r-- 1 root root   558720 Sep 14  2016 /usr/local/cuda/lib64/libcudadevrt.a\nlrwxrwxrwx 1 root root       16 Sep 14  2016 /usr/local/cuda/lib64/libcudart.so -> libcudart.so.8.0\nlrwxrwxrwx 1 root root       19 Sep 14  2016 /usr/local/cuda/lib64/libcudart.so.8.0 -> libcudart.so.8.0.44\n-rw-r--r-- 1 root root   415432 Sep 14  2016 /usr/local/cuda/lib64/libcudart.so.8.0.44\n-rw-r--r-- 1 root root   775162 Sep 14  2016 /usr/local/cuda/lib64/libcudart_static.a\n-rwxr-xr-x 1 root root 79337624 Nov  7 13:54 /usr/local/cuda/lib64/libcudnn.so\n-rwxr-xr-x 1 root root 79337624 Nov  7 13:54 /usr/local/cuda/lib64/libcudnn.so.5\n-rwxr-xr-x 1 root root 79337624 Nov  7 13:54 /usr/local/cuda/lib64/libcudnn.so.5.1.5\n-rw-r--r-- 1 root root 69756172 Nov  7 13:54 /usr/local/cuda/lib64/libcudnn_static.a\n\nIf installed from source, provide\n\nThe commit hash (git rev-parse HEAD)\nThe output of bazel version\n\nr1.0, r1.1\n\nBuild label: 0.4.5\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Thu Mar 16 12:19:38 2017 (1489666778)\nBuild timestamp: 1489666778\nBuild timestamp as int: 1489666778", "body": "When I ./configure on /r1.1 or /r1.0, I get the following error:\r\n\r\n```\r\nAuto-Configuration Error: cuDNN version detected from /usr/local/cuda-8.0/include/cudnn.h (      5.      1. 5) does not match TF_CUDNN_VERSION (5.1.5)\r\n```\r\nFor what it is worth, I counted the space in cudnn.h, and they match the number of spaces in that error message above. Not sure if related.\r\n```\r\n#define CUDNN_MAJOR      5\r\n#define CUDNN_MINOR      1\r\n#define CUDNN_PATCHLEVEL 5\r\n```\r\n\r\n\r\n```\r\n$ ./configure\r\nPlease specify the location of python. [Default is /usr/bin/python]: \r\nPlease specify optimization flags to use during compilation [Default is -march=native]: \r\nDo you wish to use jemalloc as the malloc implementation? (Linux only) [Y/n] \r\njemalloc enabled on Linux\r\nDo you wish to build TensorFlow with Google Cloud Platform support? [y/N] \r\nNo Google Cloud Platform support will be enabled for TensorFlow\r\nDo you wish to build TensorFlow with Hadoop File System support? [y/N] \r\nNo Hadoop File System support will be enabled for TensorFlow\r\nDo you wish to build TensorFlow with the XLA just-in-time compiler (experimental)? [y/N] \r\nNo XLA support will be enabled for TensorFlow\r\nFound possible Python library paths:\r\n  /usr/local/lib/python2.7/dist-packages\r\nPlease input the desired Python library path to use.  Default is [/usr/local/lib/python2.7/dist-packages]\r\n/usr/local/lib/python2.7/dist-packages\r\nDo you wish to build TensorFlow with OpenCL support? [y/N] \r\nNo OpenCL support will be enabled for TensorFlow\r\nDo you wish to build TensorFlow with CUDA support? [y/N] y\r\nCUDA support will be enabled for TensorFlow\r\nPlease specify which gcc should be used by nvcc as the host compiler. [Default is /usr/bin/gcc]: \r\nPlease specify the CUDA SDK version you want to use, e.g. 7.0. [Leave empty to use system default]: 8.0\r\nPlease specify the location where CUDA 8.0 toolkit is installed. Refer to README.md for more details. [Default is /usr/local/cuda]: \r\nPlease specify the Cudnn version you want to use. [Leave empty to use system default]: 5.1.5\r\nPlease specify the location where cuDNN 5.1.5 library is installed. Refer to README.md for more details. [Default is /usr/local/cuda]: \r\nPlease specify a list of comma-separated Cuda compute capabilities you want to build with.\r\nYou can find the compute capability of your device at: https://developer.nvidia.com/cuda-gpus.\r\nPlease note that each additional compute capability significantly increases your build time and binary size.\r\n[Default is: \"3.5,5.2\"]: \r\nINFO: Starting clean (this may take a while). Consider using --expunge_async if the clean takes more than several minutes.\r\n..........\r\nERROR: package contains errors: tensorflow/core/kernels/cloud.\r\nERROR: error loading package 'tensorflow/core/kernels/cloud': Encountered error while reading extension file 'cuda/build_defs.bzl': no such package '@local_config_cuda//cuda': Traceback (most recent call last):\r\n\tFile \"/mnt/6tb_internal/cnn_experiments/tensorflow_src/tensorflow/third_party/gpus/cuda_configure.bzl\", line 815\r\n\t\t_create_cuda_repository(repository_ctx)\r\n\tFile \"/mnt/6tb_internal/cnn_experiments/tensorflow_src/tensorflow/third_party/gpus/cuda_configure.bzl\", line 728, in _create_cuda_repository\r\n\t\t_get_cuda_config(repository_ctx)\r\n\tFile \"/mnt/6tb_internal/cnn_experiments/tensorflow_src/tensorflow/third_party/gpus/cuda_configure.bzl\", line 584, in _get_cuda_config\r\n\t\t_cudnn_version(repository_ctx, cudnn_install_base..., ...)\r\n\tFile \"/mnt/6tb_internal/cnn_experiments/tensorflow_src/tensorflow/third_party/gpus/cuda_configure.bzl\", line 311, in _cudnn_version\r\n\t\tauto_configure_fail(\"cuDNN version detected from %s ...))\r\n\tFile \"/mnt/6tb_internal/cnn_experiments/tensorflow_src/tensorflow/third_party/gpus/cuda_configure.bzl\", line 93, in auto_configure_fail\r\n\t\tfail(\"\r\n%sAuto-Configuration Error:%s ...))\r\n\r\nAuto-Configuration Error: cuDNN version detected from /usr/local/cuda-8.0/include/cudnn.h (      5.      1. 5) does not match TF_CUDNN_VERSION (5.1.5)\r\n```\r\n\r\n### Environment info\r\nOperating System: Ubuntu 14.04 LTS\r\n\r\nInstalled version of CUDA and cuDNN: \r\n(please attach the output of `ls -l /path/to/cuda/lib/libcud*`):\r\n```\r\n$ ls -l /usr/local/cuda/lib64/libcud*\r\n-rw-r--r-- 1 root root   558720 Sep 14  2016 /usr/local/cuda/lib64/libcudadevrt.a\r\nlrwxrwxrwx 1 root root       16 Sep 14  2016 /usr/local/cuda/lib64/libcudart.so -> libcudart.so.8.0\r\nlrwxrwxrwx 1 root root       19 Sep 14  2016 /usr/local/cuda/lib64/libcudart.so.8.0 -> libcudart.so.8.0.44\r\n-rw-r--r-- 1 root root   415432 Sep 14  2016 /usr/local/cuda/lib64/libcudart.so.8.0.44\r\n-rw-r--r-- 1 root root   775162 Sep 14  2016 /usr/local/cuda/lib64/libcudart_static.a\r\n-rwxr-xr-x 1 root root 79337624 Nov  7 13:54 /usr/local/cuda/lib64/libcudnn.so\r\n-rwxr-xr-x 1 root root 79337624 Nov  7 13:54 /usr/local/cuda/lib64/libcudnn.so.5\r\n-rwxr-xr-x 1 root root 79337624 Nov  7 13:54 /usr/local/cuda/lib64/libcudnn.so.5.1.5\r\n-rw-r--r-- 1 root root 69756172 Nov  7 13:54 /usr/local/cuda/lib64/libcudnn_static.a\r\n```\r\n\r\nIf installed from source, provide \r\n\r\n1. The commit hash (`git rev-parse HEAD`)\r\n2. The output of `bazel version`\r\n```\r\nr1.0, r1.1\r\n\r\nBuild label: 0.4.5\r\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\r\nBuild time: Thu Mar 16 12:19:38 2017 (1489666778)\r\nBuild timestamp: 1489666778\r\nBuild timestamp as int: 1489666778\r\n```\r\n\r\n"}