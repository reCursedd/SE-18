{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10860", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10860/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10860/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10860/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/10860", "id": 237291065, "node_id": "MDU6SXNzdWUyMzcyOTEwNjU=", "number": 10860, "title": "control_dependencies possibly broken", "user": {"login": "yaringal", "id": 3817641, "node_id": "MDQ6VXNlcjM4MTc2NDE=", "avatar_url": "https://avatars0.githubusercontent.com/u/3817641?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yaringal", "html_url": "https://github.com/yaringal", "followers_url": "https://api.github.com/users/yaringal/followers", "following_url": "https://api.github.com/users/yaringal/following{/other_user}", "gists_url": "https://api.github.com/users/yaringal/gists{/gist_id}", "starred_url": "https://api.github.com/users/yaringal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yaringal/subscriptions", "organizations_url": "https://api.github.com/users/yaringal/orgs", "repos_url": "https://api.github.com/users/yaringal/repos", "events_url": "https://api.github.com/users/yaringal/events{/privacy}", "received_events_url": "https://api.github.com/users/yaringal/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473184161, "node_id": "MDU6TGFiZWw0NzMxODQxNjE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:support", "name": "type:support", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-06-20T17:43:44Z", "updated_at": "2017-06-30T17:48:57Z", "closed_at": "2017-06-30T17:48:57Z", "author_association": "NONE", "body_html": "<p>Hi all, I've been playing with control_dependencies in the latest stable version, and I get different results to version 1.0.1. The code below is adapted from the TF Adam optimiser, which might be affected as well.</p>\n<p>The code I ran is</p>\n<pre><code>import tensorflow as tf\nimport numpy as np\n\ngraph = tf.Graph()\n\nwith graph.as_default():\n    x = tf.Variable(1.0, dtype=tf.float32, name='x')    \n    y = tf.Variable(10., dtype=tf.float32, name='y')\n    update_x = tf.assign(x, y)\n    with tf.control_dependencies([update_x]):\n        update_y = tf.assign(y, x * y)\n    update_op = tf.group(update_x, update_y)\n    init_op = tf.global_variables_initializer()\nprint tf.__version__\n\nres = []\nfor _ in range(10):\n    if 'sess' in locals():\n        locals()['sess'].close()\n    if 'sess' in globals():\n        globals()['sess'].close()\n\n    sess = tf.Session(graph=graph)\n    sess.run(init_op)\n    res += [sess.run([update_op, x, y])]\nprint np.mean([r[-1] for r in res])\nprint np.mean([r[-2] for r in res])\n</code></pre>\n<p>And get results</p>\n<pre><code>1.0.1\n100.0\n10.0\n</code></pre>\n<p>vs</p>\n<pre><code>1.2.0\n28.0\n5.5\n</code></pre>\n<p>suggesting that the control dependencies are not used as expected in version 1.2.0.<br>\nCan anyone spot any mistakes in the way I use the control dependencies?<br>\nCheers,<br>\nYarin</p>", "body_text": "Hi all, I've been playing with control_dependencies in the latest stable version, and I get different results to version 1.0.1. The code below is adapted from the TF Adam optimiser, which might be affected as well.\nThe code I ran is\nimport tensorflow as tf\nimport numpy as np\n\ngraph = tf.Graph()\n\nwith graph.as_default():\n    x = tf.Variable(1.0, dtype=tf.float32, name='x')    \n    y = tf.Variable(10., dtype=tf.float32, name='y')\n    update_x = tf.assign(x, y)\n    with tf.control_dependencies([update_x]):\n        update_y = tf.assign(y, x * y)\n    update_op = tf.group(update_x, update_y)\n    init_op = tf.global_variables_initializer()\nprint tf.__version__\n\nres = []\nfor _ in range(10):\n    if 'sess' in locals():\n        locals()['sess'].close()\n    if 'sess' in globals():\n        globals()['sess'].close()\n\n    sess = tf.Session(graph=graph)\n    sess.run(init_op)\n    res += [sess.run([update_op, x, y])]\nprint np.mean([r[-1] for r in res])\nprint np.mean([r[-2] for r in res])\n\nAnd get results\n1.0.1\n100.0\n10.0\n\nvs\n1.2.0\n28.0\n5.5\n\nsuggesting that the control dependencies are not used as expected in version 1.2.0.\nCan anyone spot any mistakes in the way I use the control dependencies?\nCheers,\nYarin", "body": "Hi all, I've been playing with control_dependencies in the latest stable version, and I get different results to version 1.0.1. The code below is adapted from the TF Adam optimiser, which might be affected as well.\r\n\r\nThe code I ran is\r\n```\r\nimport tensorflow as tf\r\nimport numpy as np\r\n\r\ngraph = tf.Graph()\r\n\r\nwith graph.as_default():\r\n    x = tf.Variable(1.0, dtype=tf.float32, name='x')    \r\n    y = tf.Variable(10., dtype=tf.float32, name='y')\r\n    update_x = tf.assign(x, y)\r\n    with tf.control_dependencies([update_x]):\r\n        update_y = tf.assign(y, x * y)\r\n    update_op = tf.group(update_x, update_y)\r\n    init_op = tf.global_variables_initializer()\r\nprint tf.__version__\r\n\r\nres = []\r\nfor _ in range(10):\r\n    if 'sess' in locals():\r\n        locals()['sess'].close()\r\n    if 'sess' in globals():\r\n        globals()['sess'].close()\r\n\r\n    sess = tf.Session(graph=graph)\r\n    sess.run(init_op)\r\n    res += [sess.run([update_op, x, y])]\r\nprint np.mean([r[-1] for r in res])\r\nprint np.mean([r[-2] for r in res])\r\n```\r\n\r\nAnd get results \r\n```\r\n1.0.1\r\n100.0\r\n10.0\r\n```\r\nvs\r\n```\r\n1.2.0\r\n28.0\r\n5.5\r\n```\r\nsuggesting that the control dependencies are not used as expected in version 1.2.0. \r\nCan anyone spot any mistakes in the way I use the control dependencies?\r\nCheers,\r\nYarin"}