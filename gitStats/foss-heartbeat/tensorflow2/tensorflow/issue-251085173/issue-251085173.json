{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12373", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12373/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12373/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12373/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/12373", "id": 251085173, "node_id": "MDU6SXNzdWUyNTEwODUxNzM=", "number": 12373, "title": "tf.contrib.data.Dataset behaves strangely when re-defined.", "user": {"login": "newt0311", "id": 24376349, "node_id": "MDQ6VXNlcjI0Mzc2MzQ5", "avatar_url": "https://avatars2.githubusercontent.com/u/24376349?v=4", "gravatar_id": "", "url": "https://api.github.com/users/newt0311", "html_url": "https://github.com/newt0311", "followers_url": "https://api.github.com/users/newt0311/followers", "following_url": "https://api.github.com/users/newt0311/following{/other_user}", "gists_url": "https://api.github.com/users/newt0311/gists{/gist_id}", "starred_url": "https://api.github.com/users/newt0311/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/newt0311/subscriptions", "organizations_url": "https://api.github.com/users/newt0311/orgs", "repos_url": "https://api.github.com/users/newt0311/repos", "events_url": "https://api.github.com/users/newt0311/events{/privacy}", "received_events_url": "https://api.github.com/users/newt0311/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-08-17T22:02:22Z", "updated_at": "2017-08-22T21:04:44Z", "closed_at": "2017-08-17T23:23:11Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: Yes.</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Ubuntu 16.04 on GCP</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: pip (implies binary install I think).</li>\n<li><strong>TensorFlow version (use command below)</strong>: GIT Version: v1.2.0-5-g435cdfc, Version: 1.2.1</li>\n<li><strong>Python version</strong>: 2.7 and 3.5 (I checked with both)</li>\n<li><strong>Bazel version (if compiling from source)</strong>: N/A</li>\n<li><strong>CUDA/cuDNN version</strong>: N/A</li>\n<li><strong>GPU model and memory</strong>: N/A</li>\n<li><strong>Exact command to reproduce</strong>: Run the attached script.<br>\n<a href=\"https://github.com/tensorflow/tensorflow/files/1232707/tf_repro.txt\">tf_repro.txt</a></li>\n</ul>\n<h3>Describe the problem</h3>\n<p>It seems like once we start initializing and using datasets, redefining them even in minor ways leads to errors? I think? This is rather unlike any other error in python. Normally I wouldn't expect redefinitions of python variables to cause problems.</p>\n<p>I've noticed the following:</p>\n<ul>\n<li>Using separate variables for the datasets does not help (regardless of whether the old dataset is kept around or not).</li>\n<li>Creating the datasets first and using them after does work (again regardless of whether separate variables.</li>\n</ul>\n<p>If this is intended behavior, it might be worth documenting it. It's easy enough to work around I suppose. I don't know enough about TensorFlow internals to know what might be causing it.</p>\n<h3>Source code / logs</h3>\n<p>Here's the output I get when I run the attached script:</p>\n<pre><code>2017-08-17 21:56:55.536140: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.\n2017-08-17 21:56:55.536187: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\n2017-08-17 21:56:55.536194: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.\n2017-08-17 21:56:55.536199: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX2 instructions, but these are available on your machine and could speed up CPU computations.\n2017-08-17 21:56:55.536203: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use FMA instructions, but these are available on your machine and could speed up CPU computations.\nFirst run works.\n2017-08-17 21:57:00.353667: W tensorflow/core/framework/op_kernel.cc:1158] Not found: Function tf_map_func_065aa1a3 is not defined.\nSecond run failed...\nFunction tf_map_func_065aa1a3 is not defined.\n         [[Node: MapDataset_1 = MapDataset[Targuments=[], f=tf_map_func_065aa1a3[], output_shapes=[[]], output_types=[DT_INT32], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](RepeatDataset_1)]]\n\nCaused by op 'MapDataset_1', defined at:\n  File \"/home/prakhar/scratch/tf_repro.py\", line 22, in &lt;module&gt;\n    iterator = ds.make_initializable_iterator()\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 396, in make_initializable_iterator\n    return Iterator.from_dataset(self, shared_name)\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 98, in from_dataset\n    initializer = gen_dataset_ops.make_iterator(dataset.make_dataset_resource(),\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1457, in make_dataset_resource\n    output_shapes=nest.flatten(self.output_shapes))\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/python/ops/gen_dataset_ops.py\", line 297, in map_dataset\n    output_shapes=output_shapes, name=name)\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 767, in apply_op\n    op_def=op_def)\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2506, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1269, in __init__\n    self._traceback = _extract_stack()\n\nNotFoundError (see above for traceback): Function tf_map_func_065aa1a3 is not defined.\n         [[Node: MapDataset_1 = MapDataset[Targuments=[], f=tf_map_func_065aa1a3[], output_shapes=[[]], output_types=[DT_INT32], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](RepeatDataset_1)]]\n\nThird run works.\n</code></pre>\n<p>-- PG</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes.\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Ubuntu 16.04 on GCP\nTensorFlow installed from (source or binary): pip (implies binary install I think).\nTensorFlow version (use command below): GIT Version: v1.2.0-5-g435cdfc, Version: 1.2.1\nPython version: 2.7 and 3.5 (I checked with both)\nBazel version (if compiling from source): N/A\nCUDA/cuDNN version: N/A\nGPU model and memory: N/A\nExact command to reproduce: Run the attached script.\ntf_repro.txt\n\nDescribe the problem\nIt seems like once we start initializing and using datasets, redefining them even in minor ways leads to errors? I think? This is rather unlike any other error in python. Normally I wouldn't expect redefinitions of python variables to cause problems.\nI've noticed the following:\n\nUsing separate variables for the datasets does not help (regardless of whether the old dataset is kept around or not).\nCreating the datasets first and using them after does work (again regardless of whether separate variables.\n\nIf this is intended behavior, it might be worth documenting it. It's easy enough to work around I suppose. I don't know enough about TensorFlow internals to know what might be causing it.\nSource code / logs\nHere's the output I get when I run the attached script:\n2017-08-17 21:56:55.536140: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.\n2017-08-17 21:56:55.536187: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\n2017-08-17 21:56:55.536194: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.\n2017-08-17 21:56:55.536199: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX2 instructions, but these are available on your machine and could speed up CPU computations.\n2017-08-17 21:56:55.536203: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use FMA instructions, but these are available on your machine and could speed up CPU computations.\nFirst run works.\n2017-08-17 21:57:00.353667: W tensorflow/core/framework/op_kernel.cc:1158] Not found: Function tf_map_func_065aa1a3 is not defined.\nSecond run failed...\nFunction tf_map_func_065aa1a3 is not defined.\n         [[Node: MapDataset_1 = MapDataset[Targuments=[], f=tf_map_func_065aa1a3[], output_shapes=[[]], output_types=[DT_INT32], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](RepeatDataset_1)]]\n\nCaused by op 'MapDataset_1', defined at:\n  File \"/home/prakhar/scratch/tf_repro.py\", line 22, in <module>\n    iterator = ds.make_initializable_iterator()\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 396, in make_initializable_iterator\n    return Iterator.from_dataset(self, shared_name)\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 98, in from_dataset\n    initializer = gen_dataset_ops.make_iterator(dataset.make_dataset_resource(),\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1457, in make_dataset_resource\n    output_shapes=nest.flatten(self.output_shapes))\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/python/ops/gen_dataset_ops.py\", line 297, in map_dataset\n    output_shapes=output_shapes, name=name)\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 767, in apply_op\n    op_def=op_def)\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2506, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1269, in __init__\n    self._traceback = _extract_stack()\n\nNotFoundError (see above for traceback): Function tf_map_func_065aa1a3 is not defined.\n         [[Node: MapDataset_1 = MapDataset[Targuments=[], f=tf_map_func_065aa1a3[], output_shapes=[[]], output_types=[DT_INT32], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](RepeatDataset_1)]]\n\nThird run works.\n\n-- PG", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: Yes.\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Ubuntu 16.04 on GCP\r\n- **TensorFlow installed from (source or binary)**: pip (implies binary install I think).\r\n- **TensorFlow version (use command below)**: GIT Version: v1.2.0-5-g435cdfc, Version: 1.2.1\r\n- **Python version**: 2.7 and 3.5 (I checked with both)\r\n- **Bazel version (if compiling from source)**: N/A\r\n- **CUDA/cuDNN version**: N/A\r\n- **GPU model and memory**: N/A\r\n- **Exact command to reproduce**: Run the attached script.\r\n[tf_repro.txt](https://github.com/tensorflow/tensorflow/files/1232707/tf_repro.txt)\r\n\r\n### Describe the problem\r\nIt seems like once we start initializing and using datasets, redefining them even in minor ways leads to errors? I think? This is rather unlike any other error in python. Normally I wouldn't expect redefinitions of python variables to cause problems.\r\n\r\nI've noticed the following:\r\n* Using separate variables for the datasets does not help (regardless of whether the old dataset is kept around or not).\r\n* Creating the datasets first and using them after does work (again regardless of whether separate variables.\r\n\r\nIf this is intended behavior, it might be worth documenting it. It's easy enough to work around I suppose. I don't know enough about TensorFlow internals to know what might be causing it.\r\n\r\n### Source code / logs\r\nHere's the output I get when I run the attached script:\r\n```\r\n2017-08-17 21:56:55.536140: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.\r\n2017-08-17 21:56:55.536187: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\r\n2017-08-17 21:56:55.536194: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.\r\n2017-08-17 21:56:55.536199: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX2 instructions, but these are available on your machine and could speed up CPU computations.\r\n2017-08-17 21:56:55.536203: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use FMA instructions, but these are available on your machine and could speed up CPU computations.\r\nFirst run works.\r\n2017-08-17 21:57:00.353667: W tensorflow/core/framework/op_kernel.cc:1158] Not found: Function tf_map_func_065aa1a3 is not defined.\r\nSecond run failed...\r\nFunction tf_map_func_065aa1a3 is not defined.\r\n         [[Node: MapDataset_1 = MapDataset[Targuments=[], f=tf_map_func_065aa1a3[], output_shapes=[[]], output_types=[DT_INT32], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](RepeatDataset_1)]]\r\n\r\nCaused by op 'MapDataset_1', defined at:\r\n  File \"/home/prakhar/scratch/tf_repro.py\", line 22, in <module>\r\n    iterator = ds.make_initializable_iterator()\r\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 396, in make_initializable_iterator\r\n    return Iterator.from_dataset(self, shared_name)\r\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 98, in from_dataset\r\n    initializer = gen_dataset_ops.make_iterator(dataset.make_dataset_resource(),\r\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1457, in make_dataset_resource\r\n    output_shapes=nest.flatten(self.output_shapes))\r\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/python/ops/gen_dataset_ops.py\", line 297, in map_dataset\r\n    output_shapes=output_shapes, name=name)\r\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 767, in apply_op\r\n    op_def=op_def)\r\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2506, in create_op\r\n    original_op=self._default_original_op, op_def=op_def)\r\n  File \"/mnt/eph/user-pg-r0033ed652607/mypyenv/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1269, in __init__\r\n    self._traceback = _extract_stack()\r\n\r\nNotFoundError (see above for traceback): Function tf_map_func_065aa1a3 is not defined.\r\n         [[Node: MapDataset_1 = MapDataset[Targuments=[], f=tf_map_func_065aa1a3[], output_shapes=[[]], output_types=[DT_INT32], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](RepeatDataset_1)]]\r\n\r\nThird run works.\r\n```\r\n\r\n-- PG"}