{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21845", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21845/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21845/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21845/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/21845", "id": 353694205, "node_id": "MDU6SXNzdWUzNTM2OTQyMDU=", "number": 21845, "title": "android yolo sample output format is different from the official documentation", "user": {"login": "lolicon", "id": 227627, "node_id": "MDQ6VXNlcjIyNzYyNw==", "avatar_url": "https://avatars0.githubusercontent.com/u/227627?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lolicon", "html_url": "https://github.com/lolicon", "followers_url": "https://api.github.com/users/lolicon/followers", "following_url": "https://api.github.com/users/lolicon/following{/other_user}", "gists_url": "https://api.github.com/users/lolicon/gists{/gist_id}", "starred_url": "https://api.github.com/users/lolicon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lolicon/subscriptions", "organizations_url": "https://api.github.com/users/lolicon/orgs", "repos_url": "https://api.github.com/users/lolicon/repos", "events_url": "https://api.github.com/users/lolicon/events{/privacy}", "received_events_url": "https://api.github.com/users/lolicon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}, {"id": 284443156, "node_id": "MDU6TGFiZWwyODQ0NDMxNTY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:docs", "name": "type:docs", "color": "159b2e", "default": false}], "state": "open", "locked": false, "assignee": {"login": "andrewharp", "id": 3376817, "node_id": "MDQ6VXNlcjMzNzY4MTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/3376817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewharp", "html_url": "https://github.com/andrewharp", "followers_url": "https://api.github.com/users/andrewharp/followers", "following_url": "https://api.github.com/users/andrewharp/following{/other_user}", "gists_url": "https://api.github.com/users/andrewharp/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewharp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewharp/subscriptions", "organizations_url": "https://api.github.com/users/andrewharp/orgs", "repos_url": "https://api.github.com/users/andrewharp/repos", "events_url": "https://api.github.com/users/andrewharp/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewharp/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "andrewharp", "id": 3376817, "node_id": "MDQ6VXNlcjMzNzY4MTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/3376817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewharp", "html_url": "https://github.com/andrewharp", "followers_url": "https://api.github.com/users/andrewharp/followers", "following_url": "https://api.github.com/users/andrewharp/following{/other_user}", "gists_url": "https://api.github.com/users/andrewharp/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewharp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewharp/subscriptions", "organizations_url": "https://api.github.com/users/andrewharp/orgs", "repos_url": "https://api.github.com/users/andrewharp/repos", "events_url": "https://api.github.com/users/andrewharp/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewharp/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2018-08-24T08:36:45Z", "updated_at": "2018-11-11T18:41:09Z", "closed_at": null, "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: No</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:  MacOS 10.13.5 (Non-Relevant)</li>\n<li><strong>Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device</strong>:  Non-Relevant</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: Unsure</li>\n<li><strong>TensorFlow version (use command below)</strong>: org.tensorflow:tensorflow-android:1.9.0 Non-Relevant</li>\n<li><strong>Python version</strong>:  N/A</li>\n<li><strong>Bazel version (if compiling from source)</strong>: N/A</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: N/A</li>\n<li><strong>CUDA/cuDNN version</strong>: N/A</li>\n<li><strong>GPU model and memory</strong>: N/A</li>\n<li><strong>Exact command to reproduce</strong>:N/A</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>In Android Yolo Sample Code</p>\n<p><a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/android/src/org/tensorflow/demo/TensorFlowYoloDetector.java#L171\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/android/src/org/tensorflow/demo/TensorFlowYoloDetector.java#L171</a></p>\n<div class=\"highlight highlight-source-java\"><pre>        <span class=\"pl-k\">new</span> <span class=\"pl-smi\">float</span>[gridWidth <span class=\"pl-k\">*</span> gridHeight <span class=\"pl-k\">*</span> (<span class=\"pl-c1\">NUM_CLASSES</span> <span class=\"pl-k\">+</span> <span class=\"pl-c1\">5</span>) <span class=\"pl-k\">*</span> <span class=\"pl-c1\">NUM_BOXES_PER_BLOCK</span>];\n        <span class=\"pl-c1\">............</span>\n        <span class=\"pl-k\">for</span> (<span class=\"pl-k\">int</span> y <span class=\"pl-k\">=</span> <span class=\"pl-c1\">0</span>; y <span class=\"pl-k\">&lt;</span> gridHeight; <span class=\"pl-k\">++</span>y) {\n           <span class=\"pl-k\">for</span> (<span class=\"pl-k\">int</span> x <span class=\"pl-k\">=</span> <span class=\"pl-c1\">0</span>; x <span class=\"pl-k\">&lt;</span> gridWidth; <span class=\"pl-k\">++</span>x) {\n               <span class=\"pl-k\">for</span> (<span class=\"pl-k\">int</span> b <span class=\"pl-k\">=</span> <span class=\"pl-c1\">0</span>; b <span class=\"pl-k\">&lt;</span> <span class=\"pl-c1\">NUM_BOXES_PER_BLOCK</span>; <span class=\"pl-k\">++</span>b) {\n                   <span class=\"pl-c1\">..........</span>\n                    <span class=\"pl-k\">for</span> (<span class=\"pl-k\">int</span> c <span class=\"pl-k\">=</span> <span class=\"pl-c1\">0</span>; c <span class=\"pl-k\">&lt;</span> <span class=\"pl-c1\">NUM_CLASSES</span>; <span class=\"pl-k\">++</span>c) {\n                        classes[c] <span class=\"pl-k\">=</span> output[offset <span class=\"pl-k\">+</span> <span class=\"pl-c1\">5</span> <span class=\"pl-k\">+</span> c];</pre></div>\n<p>along with the following output decoding process, is not compatible with the original paper<br>\nthese code assumes the output formats was</p>\n<p><strong>grid * grid * (class + 5) * box</strong></p>\n<p>but in the original paper and other resource , this should be</p>\n<p><strong>grid * grid * (class + box * 5)</strong></p>\n<p>as per in the paper [https://arxiv.org/pdf/1506.02640.pdf]( S * S * (B * 5 + C) )<br>\nthis is totally different in format and size since every offset of the grid messed up<br>\nthe paper indicates that the network only predicts one set of class probabilities per cell, regardless of the number of boxes B</p>\n<h3>Source code / logs</h3>\n<p><a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/android/src/org/tensorflow/demo/TensorFlowYoloDetector.java#L171\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/android/src/org/tensorflow/demo/TensorFlowYoloDetector.java#L171</a></p>\n<p><a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/android/src/org/tensorflow/demo/TensorFlowYoloDetector.java#L187-L213\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/android/src/org/tensorflow/demo/TensorFlowYoloDetector.java#L187-L213</a></p>\n<p><a href=\"https://arxiv.org/pdf/1506.02640.pdf\" rel=\"nofollow\">https://arxiv.org/pdf/1506.02640.pdf</a></p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): No\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):  MacOS 10.13.5 (Non-Relevant)\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:  Non-Relevant\nTensorFlow installed from (source or binary): Unsure\nTensorFlow version (use command below): org.tensorflow:tensorflow-android:1.9.0 Non-Relevant\nPython version:  N/A\nBazel version (if compiling from source): N/A\nGCC/Compiler version (if compiling from source): N/A\nCUDA/cuDNN version: N/A\nGPU model and memory: N/A\nExact command to reproduce:N/A\n\nDescribe the problem\nIn Android Yolo Sample Code\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/android/src/org/tensorflow/demo/TensorFlowYoloDetector.java#L171\n        new float[gridWidth * gridHeight * (NUM_CLASSES + 5) * NUM_BOXES_PER_BLOCK];\n        ............\n        for (int y = 0; y < gridHeight; ++y) {\n           for (int x = 0; x < gridWidth; ++x) {\n               for (int b = 0; b < NUM_BOXES_PER_BLOCK; ++b) {\n                   ..........\n                    for (int c = 0; c < NUM_CLASSES; ++c) {\n                        classes[c] = output[offset + 5 + c];\nalong with the following output decoding process, is not compatible with the original paper\nthese code assumes the output formats was\ngrid * grid * (class + 5) * box\nbut in the original paper and other resource , this should be\ngrid * grid * (class + box * 5)\nas per in the paper [https://arxiv.org/pdf/1506.02640.pdf]( S * S * (B * 5 + C) )\nthis is totally different in format and size since every offset of the grid messed up\nthe paper indicates that the network only predicts one set of class probabilities per cell, regardless of the number of boxes B\nSource code / logs\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/android/src/org/tensorflow/demo/TensorFlowYoloDetector.java#L171\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/android/src/org/tensorflow/demo/TensorFlowYoloDetector.java#L187-L213\nhttps://arxiv.org/pdf/1506.02640.pdf", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:  MacOS 10.13.5 (Non-Relevant)\r\n- **Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device**:  Non-Relevant\r\n- **TensorFlow installed from (source or binary)**: Unsure\r\n- **TensorFlow version (use command below)**: org.tensorflow:tensorflow-android:1.9.0 Non-Relevant\r\n- **Python version**:  N/A\r\n- **Bazel version (if compiling from source)**: N/A\r\n- **GCC/Compiler version (if compiling from source)**: N/A\r\n- **CUDA/cuDNN version**: N/A\r\n- **GPU model and memory**: N/A\r\n- **Exact command to reproduce**:N/A\r\n\r\n### Describe the problem\r\n\r\nIn Android Yolo Sample Code\r\n\r\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/android/src/org/tensorflow/demo/TensorFlowYoloDetector.java#L171\r\n\r\n```java\r\n        new float[gridWidth * gridHeight * (NUM_CLASSES + 5) * NUM_BOXES_PER_BLOCK];\r\n        ............\r\n        for (int y = 0; y < gridHeight; ++y) {\r\n           for (int x = 0; x < gridWidth; ++x) {\r\n               for (int b = 0; b < NUM_BOXES_PER_BLOCK; ++b) {\r\n                   ..........\r\n                    for (int c = 0; c < NUM_CLASSES; ++c) {\r\n                        classes[c] = output[offset + 5 + c];\r\n```\r\nalong with the following output decoding process, is not compatible with the original paper\r\nthese code assumes the output formats was \r\n\r\n **grid * grid * (class + 5) * box** \r\n\r\nbut in the original paper and other resource , this should be   \r\n\r\n**grid * grid * (class + box * 5)**\r\n\r\nas per in the paper [https://arxiv.org/pdf/1506.02640.pdf]( S * S * (B * 5 + C) )\r\nthis is totally different in format and size since every offset of the grid messed up\r\nthe paper indicates that the network only predicts one set of class probabilities per cell, regardless of the number of boxes B\r\n\r\n### Source code / logs\r\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/android/src/org/tensorflow/demo/TensorFlowYoloDetector.java#L171\r\n\r\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/android/src/org/tensorflow/demo/TensorFlowYoloDetector.java#L187-L213\r\n\r\nhttps://arxiv.org/pdf/1506.02640.pdf\r\n"}