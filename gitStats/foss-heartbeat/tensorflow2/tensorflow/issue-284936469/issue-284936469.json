{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15696", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15696/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15696/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15696/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15696", "id": 284936469, "node_id": "MDU6SXNzdWUyODQ5MzY0Njk=", "number": 15696, "title": "A fix for error in tf.layers.conv3d_transpose when inferred batch size", "user": {"login": "Joshuaalbert", "id": 14807032, "node_id": "MDQ6VXNlcjE0ODA3MDMy", "avatar_url": "https://avatars2.githubusercontent.com/u/14807032?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Joshuaalbert", "html_url": "https://github.com/Joshuaalbert", "followers_url": "https://api.github.com/users/Joshuaalbert/followers", "following_url": "https://api.github.com/users/Joshuaalbert/following{/other_user}", "gists_url": "https://api.github.com/users/Joshuaalbert/gists{/gist_id}", "starred_url": "https://api.github.com/users/Joshuaalbert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Joshuaalbert/subscriptions", "organizations_url": "https://api.github.com/users/Joshuaalbert/orgs", "repos_url": "https://api.github.com/users/Joshuaalbert/repos", "events_url": "https://api.github.com/users/Joshuaalbert/events{/privacy}", "received_events_url": "https://api.github.com/users/Joshuaalbert/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2017-12-28T15:27:47Z", "updated_at": "2018-02-01T12:41:42Z", "closed_at": "2018-02-01T12:41:42Z", "author_association": "NONE", "body_html": "<h2>Context</h2>\n<p>When using the <code>tf.layers.conv3d_tranpose</code> Op with a dynamic batch size and when <code>use_bias=True</code> then there is a <a href=\"https://github.com/tensorflow/tensorflow/issues/10520\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/10520/hovercard\">well known error that occurs</a>.<br>\nThe error is due to a <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/layers/convolutional.py#L1628\">tf.reshape Op that chunks together some of the axes before adding the bias for a slight performance improvement</a>.<br>\nE.g. in the case of <code>data_format == 'channels_last'</code>,</p>\n<pre><code>outputs_4d = array_ops.reshape(outputs, [\n            outputs_shape[0], outputs_shape[1],\n            outputs_shape[2] * outputs_shape[3], outputs_shape[4]\n        ])\n</code></pre>\n<p>gives an error when <code>outputs_shape[0] == None</code>, i.e. when batch size is inferred.</p>\n<h2>Simple fix</h2>\n<p>To fix this with minimal modification to other code, it would be great if someone could replace <code>outputs_shape[0]</code> with <code>-1</code> in these two lines:<br>\n<a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/layers/convolutional.py#L1627\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/layers/convolutional.py#L1627</a><br>\n<a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/layers/convolutional.py#L1632\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/layers/convolutional.py#L1632</a></p>", "body_text": "Context\nWhen using the tf.layers.conv3d_tranpose Op with a dynamic batch size and when use_bias=True then there is a well known error that occurs.\nThe error is due to a tf.reshape Op that chunks together some of the axes before adding the bias for a slight performance improvement.\nE.g. in the case of data_format == 'channels_last',\noutputs_4d = array_ops.reshape(outputs, [\n            outputs_shape[0], outputs_shape[1],\n            outputs_shape[2] * outputs_shape[3], outputs_shape[4]\n        ])\n\ngives an error when outputs_shape[0] == None, i.e. when batch size is inferred.\nSimple fix\nTo fix this with minimal modification to other code, it would be great if someone could replace outputs_shape[0] with -1 in these two lines:\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/layers/convolutional.py#L1627\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/layers/convolutional.py#L1632", "body": "## Context\r\nWhen using the `tf.layers.conv3d_tranpose` Op with a dynamic batch size and when `use_bias=True` then there is a [well known error that occurs](https://github.com/tensorflow/tensorflow/issues/10520).\r\nThe error is due to a [tf.reshape Op that chunks together some of the axes before adding the bias for a slight performance improvement](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/layers/convolutional.py#L1628).\r\nE.g. in the case of `data_format == 'channels_last'`, \r\n```\r\noutputs_4d = array_ops.reshape(outputs, [\r\n            outputs_shape[0], outputs_shape[1],\r\n            outputs_shape[2] * outputs_shape[3], outputs_shape[4]\r\n        ])\r\n```\r\ngives an error when `outputs_shape[0] == None`, i.e. when batch size is inferred. \r\n\r\n## Simple fix\r\nTo fix this with minimal modification to other code, it would be great if someone could replace `outputs_shape[0]` with `-1` in these two lines:\r\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/layers/convolutional.py#L1627\r\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/layers/convolutional.py#L1632"}