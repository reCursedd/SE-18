{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7528", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7528/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7528/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7528/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/7528", "id": 207804441, "node_id": "MDExOlB1bGxSZXF1ZXN0MTA2MzEwNDYz", "number": 7528, "title": "Fix GetDsoHandle segfault", "user": {"login": "wrmsr", "id": 559096, "node_id": "MDQ6VXNlcjU1OTA5Ng==", "avatar_url": "https://avatars3.githubusercontent.com/u/559096?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wrmsr", "html_url": "https://github.com/wrmsr", "followers_url": "https://api.github.com/users/wrmsr/followers", "following_url": "https://api.github.com/users/wrmsr/following{/other_user}", "gists_url": "https://api.github.com/users/wrmsr/gists{/gist_id}", "starred_url": "https://api.github.com/users/wrmsr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wrmsr/subscriptions", "organizations_url": "https://api.github.com/users/wrmsr/orgs", "repos_url": "https://api.github.com/users/wrmsr/repos", "events_url": "https://api.github.com/users/wrmsr/events{/privacy}", "received_events_url": "https://api.github.com/users/wrmsr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-02-15T13:30:51Z", "updated_at": "2017-02-15T16:47:25Z", "closed_at": "2017-02-15T16:47:25Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/7528", "html_url": "https://github.com/tensorflow/tensorflow/pull/7528", "diff_url": "https://github.com/tensorflow/tensorflow/pull/7528.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/7528.patch"}, "body_html": "<p>Currently segfaults when LD_PRELOAD_PATH isn't set when it tries to include it in a log message:</p>\n<pre><code>Process 86579 launched: '/Users/spinlock/src/carpedm20/DCGAN-tensorflow/.venv/bin/python' (x86_64)\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcublas.8.0.dylib locally\nProcess 86579 stopped\n* thread #1: tid = 0x15ed75, 0x00007fff89152132 libsystem_c.dylib`strlen + 18, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x0)\n    frame #0: 0x00007fff89152132 libsystem_c.dylib`strlen + 18\nlibsystem_c.dylib`strlen:\n-&gt;  0x7fff89152132 &lt;+18&gt;: pcmpeqb xmm0, xmmword ptr [rdi]\n    0x7fff89152136 &lt;+22&gt;: pmovmskb esi, xmm0\n    0x7fff8915213a &lt;+26&gt;: and    rcx, 0xf\n    0x7fff8915213e &lt;+30&gt;: or     rax, -0x1\n(lldb) bt\n* thread #1: tid = 0x15ed75, 0x00007fff89152132 libsystem_c.dylib`strlen + 18, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x0)\n  * frame #0: 0x00007fff89152132 libsystem_c.dylib`strlen + 18\n    frame #1: 0x000000010651cd8a _pywrap_tensorflow.so`perftools::gputools::internal::DsoLoader::GetDsoHandle(tensorflow::StringPiece, void**, perftools::gputools::internal::DsoLoader::LoadKind) + 282\n...\n    0x10651cd31 &lt;+193&gt;: lea    rsi, [rip + 0xf7545a]     ; \"Couldn't open CUDA library \"\n    0x10651cd38 &lt;+200&gt;: lea    rdi, [rbp - 0x228]\n    0x10651cd3f &lt;+207&gt;: mov    edx, 0x1b\n    0x10651cd44 &lt;+212&gt;: call   0x1043d2620               ; std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp; std::__1::__put_character_sequence&lt;char, std::__1::char_traits&lt;char&gt; &gt;(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp;, char const*, unsigned long)\n    0x10651cd49 &lt;+217&gt;: lea    rdi, [rbp - 0x228]\n    0x10651cd50 &lt;+224&gt;: mov    rsi, r12\n    0x10651cd53 &lt;+227&gt;: mov    rdx, r15\n    0x10651cd56 &lt;+230&gt;: call   0x1067f9c80               ; tensorflow::operator&lt;&lt;(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp;, tensorflow::StringPiece)\n    0x10651cd5b &lt;+235&gt;: lea    rsi, [rip + 0xf7544c]     ; \". LD_LIBRARY_PATH: \"\n    0x10651cd62 &lt;+242&gt;: lea    rdi, [rbp - 0x228]\n    0x10651cd69 &lt;+249&gt;: mov    edx, 0x13\n    0x10651cd6e &lt;+254&gt;: call   0x1043d2620               ; std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp; std::__1::__put_character_sequence&lt;char, std::__1::char_traits&lt;char&gt; &gt;(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp;, char const*, unsigned long)\n    0x10651cd73 &lt;+259&gt;: lea    rdi, [rip + 0xf6ffd4]     ; \"LD_LIBRARY_PATH\"\n    0x10651cd7a &lt;+266&gt;: call   0x106af84c8               ; symbol stub for: getenv\n    0x10651cd7f &lt;+271&gt;: mov    rbx, rax\n    0x10651cd82 &lt;+274&gt;: mov    rdi, rbx\n    0x10651cd85 &lt;+277&gt;: call   0x106af87fe               ; symbol stub for: strlen\n    0x10651cd8a &lt;+282&gt;: lea    rdi, [rbp - 0x228]\n    0x10651cd91 &lt;+289&gt;: mov    rsi, rbx\n    0x10651cd94 &lt;+292&gt;: mov    rdx, rax\n    0x10651cd97 &lt;+295&gt;: call   0x1043d2620               ; std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp; std::__1::__put_character_sequence&lt;char, std::__1::char_traits&lt;char&gt; &gt;(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp;, char const*, unsigned long)\n    0x10651cd9c &lt;+300&gt;: lea    rdi, [rbp - 0x228]\n    0x10651cda3 &lt;+307&gt;: call   0x10681be90               ; tensorflow::internal::LogMessage::~LogMessage()\n    0x10651cda8 &lt;+312&gt;: lea    rax, [rip + 0xf75413]     ; \"could not dlopen DSO: \"\n</code></pre>\n<p>Trying to verify but still trying to get a working dev environment setup.</p>", "body_text": "Currently segfaults when LD_PRELOAD_PATH isn't set when it tries to include it in a log message:\nProcess 86579 launched: '/Users/spinlock/src/carpedm20/DCGAN-tensorflow/.venv/bin/python' (x86_64)\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcublas.8.0.dylib locally\nProcess 86579 stopped\n* thread #1: tid = 0x15ed75, 0x00007fff89152132 libsystem_c.dylib`strlen + 18, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x0)\n    frame #0: 0x00007fff89152132 libsystem_c.dylib`strlen + 18\nlibsystem_c.dylib`strlen:\n->  0x7fff89152132 <+18>: pcmpeqb xmm0, xmmword ptr [rdi]\n    0x7fff89152136 <+22>: pmovmskb esi, xmm0\n    0x7fff8915213a <+26>: and    rcx, 0xf\n    0x7fff8915213e <+30>: or     rax, -0x1\n(lldb) bt\n* thread #1: tid = 0x15ed75, 0x00007fff89152132 libsystem_c.dylib`strlen + 18, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x0)\n  * frame #0: 0x00007fff89152132 libsystem_c.dylib`strlen + 18\n    frame #1: 0x000000010651cd8a _pywrap_tensorflow.so`perftools::gputools::internal::DsoLoader::GetDsoHandle(tensorflow::StringPiece, void**, perftools::gputools::internal::DsoLoader::LoadKind) + 282\n...\n    0x10651cd31 <+193>: lea    rsi, [rip + 0xf7545a]     ; \"Couldn't open CUDA library \"\n    0x10651cd38 <+200>: lea    rdi, [rbp - 0x228]\n    0x10651cd3f <+207>: mov    edx, 0x1b\n    0x10651cd44 <+212>: call   0x1043d2620               ; std::__1::basic_ostream<char, std::__1::char_traits<char> >& std::__1::__put_character_sequence<char, std::__1::char_traits<char> >(std::__1::basic_ostream<char, std::__1::char_traits<char> >&, char const*, unsigned long)\n    0x10651cd49 <+217>: lea    rdi, [rbp - 0x228]\n    0x10651cd50 <+224>: mov    rsi, r12\n    0x10651cd53 <+227>: mov    rdx, r15\n    0x10651cd56 <+230>: call   0x1067f9c80               ; tensorflow::operator<<(std::__1::basic_ostream<char, std::__1::char_traits<char> >&, tensorflow::StringPiece)\n    0x10651cd5b <+235>: lea    rsi, [rip + 0xf7544c]     ; \". LD_LIBRARY_PATH: \"\n    0x10651cd62 <+242>: lea    rdi, [rbp - 0x228]\n    0x10651cd69 <+249>: mov    edx, 0x13\n    0x10651cd6e <+254>: call   0x1043d2620               ; std::__1::basic_ostream<char, std::__1::char_traits<char> >& std::__1::__put_character_sequence<char, std::__1::char_traits<char> >(std::__1::basic_ostream<char, std::__1::char_traits<char> >&, char const*, unsigned long)\n    0x10651cd73 <+259>: lea    rdi, [rip + 0xf6ffd4]     ; \"LD_LIBRARY_PATH\"\n    0x10651cd7a <+266>: call   0x106af84c8               ; symbol stub for: getenv\n    0x10651cd7f <+271>: mov    rbx, rax\n    0x10651cd82 <+274>: mov    rdi, rbx\n    0x10651cd85 <+277>: call   0x106af87fe               ; symbol stub for: strlen\n    0x10651cd8a <+282>: lea    rdi, [rbp - 0x228]\n    0x10651cd91 <+289>: mov    rsi, rbx\n    0x10651cd94 <+292>: mov    rdx, rax\n    0x10651cd97 <+295>: call   0x1043d2620               ; std::__1::basic_ostream<char, std::__1::char_traits<char> >& std::__1::__put_character_sequence<char, std::__1::char_traits<char> >(std::__1::basic_ostream<char, std::__1::char_traits<char> >&, char const*, unsigned long)\n    0x10651cd9c <+300>: lea    rdi, [rbp - 0x228]\n    0x10651cda3 <+307>: call   0x10681be90               ; tensorflow::internal::LogMessage::~LogMessage()\n    0x10651cda8 <+312>: lea    rax, [rip + 0xf75413]     ; \"could not dlopen DSO: \"\n\nTrying to verify but still trying to get a working dev environment setup.", "body": "Currently segfaults when LD_PRELOAD_PATH isn't set when it tries to include it in a log message:\r\n\r\n```\r\nProcess 86579 launched: '/Users/spinlock/src/carpedm20/DCGAN-tensorflow/.venv/bin/python' (x86_64)\r\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcublas.8.0.dylib locally\r\nProcess 86579 stopped\r\n* thread #1: tid = 0x15ed75, 0x00007fff89152132 libsystem_c.dylib`strlen + 18, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x0)\r\n    frame #0: 0x00007fff89152132 libsystem_c.dylib`strlen + 18\r\nlibsystem_c.dylib`strlen:\r\n->  0x7fff89152132 <+18>: pcmpeqb xmm0, xmmword ptr [rdi]\r\n    0x7fff89152136 <+22>: pmovmskb esi, xmm0\r\n    0x7fff8915213a <+26>: and    rcx, 0xf\r\n    0x7fff8915213e <+30>: or     rax, -0x1\r\n(lldb) bt\r\n* thread #1: tid = 0x15ed75, 0x00007fff89152132 libsystem_c.dylib`strlen + 18, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x0)\r\n  * frame #0: 0x00007fff89152132 libsystem_c.dylib`strlen + 18\r\n    frame #1: 0x000000010651cd8a _pywrap_tensorflow.so`perftools::gputools::internal::DsoLoader::GetDsoHandle(tensorflow::StringPiece, void**, perftools::gputools::internal::DsoLoader::LoadKind) + 282\r\n...\r\n    0x10651cd31 <+193>: lea    rsi, [rip + 0xf7545a]     ; \"Couldn't open CUDA library \"\r\n    0x10651cd38 <+200>: lea    rdi, [rbp - 0x228]\r\n    0x10651cd3f <+207>: mov    edx, 0x1b\r\n    0x10651cd44 <+212>: call   0x1043d2620               ; std::__1::basic_ostream<char, std::__1::char_traits<char> >& std::__1::__put_character_sequence<char, std::__1::char_traits<char> >(std::__1::basic_ostream<char, std::__1::char_traits<char> >&, char const*, unsigned long)\r\n    0x10651cd49 <+217>: lea    rdi, [rbp - 0x228]\r\n    0x10651cd50 <+224>: mov    rsi, r12\r\n    0x10651cd53 <+227>: mov    rdx, r15\r\n    0x10651cd56 <+230>: call   0x1067f9c80               ; tensorflow::operator<<(std::__1::basic_ostream<char, std::__1::char_traits<char> >&, tensorflow::StringPiece)\r\n    0x10651cd5b <+235>: lea    rsi, [rip + 0xf7544c]     ; \". LD_LIBRARY_PATH: \"\r\n    0x10651cd62 <+242>: lea    rdi, [rbp - 0x228]\r\n    0x10651cd69 <+249>: mov    edx, 0x13\r\n    0x10651cd6e <+254>: call   0x1043d2620               ; std::__1::basic_ostream<char, std::__1::char_traits<char> >& std::__1::__put_character_sequence<char, std::__1::char_traits<char> >(std::__1::basic_ostream<char, std::__1::char_traits<char> >&, char const*, unsigned long)\r\n    0x10651cd73 <+259>: lea    rdi, [rip + 0xf6ffd4]     ; \"LD_LIBRARY_PATH\"\r\n    0x10651cd7a <+266>: call   0x106af84c8               ; symbol stub for: getenv\r\n    0x10651cd7f <+271>: mov    rbx, rax\r\n    0x10651cd82 <+274>: mov    rdi, rbx\r\n    0x10651cd85 <+277>: call   0x106af87fe               ; symbol stub for: strlen\r\n    0x10651cd8a <+282>: lea    rdi, [rbp - 0x228]\r\n    0x10651cd91 <+289>: mov    rsi, rbx\r\n    0x10651cd94 <+292>: mov    rdx, rax\r\n    0x10651cd97 <+295>: call   0x1043d2620               ; std::__1::basic_ostream<char, std::__1::char_traits<char> >& std::__1::__put_character_sequence<char, std::__1::char_traits<char> >(std::__1::basic_ostream<char, std::__1::char_traits<char> >&, char const*, unsigned long)\r\n    0x10651cd9c <+300>: lea    rdi, [rbp - 0x228]\r\n    0x10651cda3 <+307>: call   0x10681be90               ; tensorflow::internal::LogMessage::~LogMessage()\r\n    0x10651cda8 <+312>: lea    rax, [rip + 0xf75413]     ; \"could not dlopen DSO: \"\r\n```\r\n\r\nTrying to verify but still trying to get a working dev environment setup."}