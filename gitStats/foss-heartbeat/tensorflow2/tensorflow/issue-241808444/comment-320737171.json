{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/320737171", "html_url": "https://github.com/tensorflow/tensorflow/issues/11416#issuecomment-320737171", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11416", "id": 320737171, "node_id": "MDEyOklzc3VlQ29tbWVudDMyMDczNzE3MQ==", "user": {"login": "bobzhuyb", "id": 1696340, "node_id": "MDQ6VXNlcjE2OTYzNDA=", "avatar_url": "https://avatars3.githubusercontent.com/u/1696340?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bobzhuyb", "html_url": "https://github.com/bobzhuyb", "followers_url": "https://api.github.com/users/bobzhuyb/followers", "following_url": "https://api.github.com/users/bobzhuyb/following{/other_user}", "gists_url": "https://api.github.com/users/bobzhuyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/bobzhuyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bobzhuyb/subscriptions", "organizations_url": "https://api.github.com/users/bobzhuyb/orgs", "repos_url": "https://api.github.com/users/bobzhuyb/repos", "events_url": "https://api.github.com/users/bobzhuyb/events{/privacy}", "received_events_url": "https://api.github.com/users/bobzhuyb/received_events", "type": "User", "site_admin": false}, "created_at": "2017-08-07T18:06:16Z", "updated_at": "2017-08-07T18:16:24Z", "author_association": "NONE", "body_html": "<p>We don't have a concrete evidence. However, we did a basic test -- when we malloc the receiver buffer, we init the buffer with a special value as a signature (say every byte initialized as 0xab). After the successful receive event triggered by WRITE_WITH_IMM, we immediate check the receiver buffer contents. It remains unchanged in TF process.</p>\n<p>If you use ibdump at the receiver side, you should see the special signature in the packets. So the data must have arrived. Would you do the same as above to confirm that we are seeing the same (or similar) problem?</p>\n<p>There are only two potential explanations,</p>\n<ol>\n<li>Receiver NIC didn't DMA the data into the receiver buffer -- we don't see why this may happen</li>\n<li>NIC did write the data to physical memory, but the vaddr mapping has changed</li>\n</ol>\n<p>To get a concrete evidence, we will need to get the vaddr to physical addr mapping at different stages. Not sure whether the info in /proc/$PID/maps can help us.</p>", "body_text": "We don't have a concrete evidence. However, we did a basic test -- when we malloc the receiver buffer, we init the buffer with a special value as a signature (say every byte initialized as 0xab). After the successful receive event triggered by WRITE_WITH_IMM, we immediate check the receiver buffer contents. It remains unchanged in TF process.\nIf you use ibdump at the receiver side, you should see the special signature in the packets. So the data must have arrived. Would you do the same as above to confirm that we are seeing the same (or similar) problem?\nThere are only two potential explanations,\n\nReceiver NIC didn't DMA the data into the receiver buffer -- we don't see why this may happen\nNIC did write the data to physical memory, but the vaddr mapping has changed\n\nTo get a concrete evidence, we will need to get the vaddr to physical addr mapping at different stages. Not sure whether the info in /proc/$PID/maps can help us.", "body": "We don't have a concrete evidence. However, we did a basic test -- when we malloc the receiver buffer, we init the buffer with a special value as a signature (say every byte initialized as 0xab). After the successful receive event triggered by WRITE_WITH_IMM, we immediate check the receiver buffer contents. It remains unchanged in TF process. \r\n\r\nIf you use ibdump at the receiver side, you should see the special signature in the packets. So the data must have arrived. Would you do the same as above to confirm that we are seeing the same (or similar) problem?\r\n\r\nThere are only two potential explanations, \r\n\r\n1. Receiver NIC didn't DMA the data into the receiver buffer -- we don't see why this may happen\r\n2. NIC did write the data to physical memory, but the vaddr mapping has changed\r\n\r\nTo get a concrete evidence, we will need to get the vaddr to physical addr mapping at different stages. Not sure whether the info in /proc/$PID/maps can help us."}