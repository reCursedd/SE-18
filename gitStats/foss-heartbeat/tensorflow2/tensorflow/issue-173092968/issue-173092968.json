{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4029", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4029/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4029/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4029/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/4029", "id": 173092968, "node_id": "MDU6SXNzdWUxNzMwOTI5Njg=", "number": 4029, "title": "ptb language modeling example broken with --use_fp16 and dropout other than 0", "user": {"login": "nryant", "id": 716377, "node_id": "MDQ6VXNlcjcxNjM3Nw==", "avatar_url": "https://avatars3.githubusercontent.com/u/716377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nryant", "html_url": "https://github.com/nryant", "followers_url": "https://api.github.com/users/nryant/followers", "following_url": "https://api.github.com/users/nryant/following{/other_user}", "gists_url": "https://api.github.com/users/nryant/gists{/gist_id}", "starred_url": "https://api.github.com/users/nryant/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nryant/subscriptions", "organizations_url": "https://api.github.com/users/nryant/orgs", "repos_url": "https://api.github.com/users/nryant/repos", "events_url": "https://api.github.com/users/nryant/events{/privacy}", "received_events_url": "https://api.github.com/users/nryant/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "benoitsteiner", "id": 6969686, "node_id": "MDQ6VXNlcjY5Njk2ODY=", "avatar_url": "https://avatars0.githubusercontent.com/u/6969686?v=4", "gravatar_id": "", "url": "https://api.github.com/users/benoitsteiner", "html_url": "https://github.com/benoitsteiner", "followers_url": "https://api.github.com/users/benoitsteiner/followers", "following_url": "https://api.github.com/users/benoitsteiner/following{/other_user}", "gists_url": "https://api.github.com/users/benoitsteiner/gists{/gist_id}", "starred_url": "https://api.github.com/users/benoitsteiner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/benoitsteiner/subscriptions", "organizations_url": "https://api.github.com/users/benoitsteiner/orgs", "repos_url": "https://api.github.com/users/benoitsteiner/repos", "events_url": "https://api.github.com/users/benoitsteiner/events{/privacy}", "received_events_url": "https://api.github.com/users/benoitsteiner/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "benoitsteiner", "id": 6969686, "node_id": "MDQ6VXNlcjY5Njk2ODY=", "avatar_url": "https://avatars0.githubusercontent.com/u/6969686?v=4", "gravatar_id": "", "url": "https://api.github.com/users/benoitsteiner", "html_url": "https://github.com/benoitsteiner", "followers_url": "https://api.github.com/users/benoitsteiner/followers", "following_url": "https://api.github.com/users/benoitsteiner/following{/other_user}", "gists_url": "https://api.github.com/users/benoitsteiner/gists{/gist_id}", "starred_url": "https://api.github.com/users/benoitsteiner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/benoitsteiner/subscriptions", "organizations_url": "https://api.github.com/users/benoitsteiner/orgs", "repos_url": "https://api.github.com/users/benoitsteiner/repos", "events_url": "https://api.github.com/users/benoitsteiner/events{/privacy}", "received_events_url": "https://api.github.com/users/benoitsteiner/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2016-08-25T01:09:51Z", "updated_at": "2016-09-13T17:54:21Z", "closed_at": "2016-09-13T17:42:00Z", "author_association": "NONE", "body_html": "<h3>Environment info</h3>\n<p>Operating System: Ubuntu 16.04 LTS<br>\nGPU: GTX 1080<br>\nNvidia driver: 370.23<br>\nCUDA: 8.0<br>\ncuDNN: 5<br>\nbazel:</p>\n<pre><code>Build label: 0.3.1- (@non-git)\nBuild target: bazel-out/local- fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Wed Aug 24 00:13:09 2016 (1471997589)\nBuild timestamp: 1471997589\nBuild timestamp as int: 1471997589\n</code></pre>\n<p>git commit hash: <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/cc3153a7a0a23533d14ead34db37e4ccd7892079/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/cc3153a7a0a23533d14ead34db37e4ccd7892079\"><tt>cc3153a</tt></a></p>\n<h3>Description</h3>\n<p>When run using the <code>--use_fp16</code> flag and either <code>--model medium</code> or <code>--model large</code>, the PTB language model example fails:</p>\n<pre><code>Traceback (most recent call last):\n  File \"ptb_word_lm.py\", line 339, in &lt;module&gt;\n    tf.app.run()\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv))\n  File \"ptb_word_lm.py\", line 316, in main\n    m = PTBModel(is_training=True, config=config)\n  File \"ptb_word_lm.py\", line 117, in __init__\n    inputs = tf.nn.dropout(inputs, config.keep_prob)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/nn_ops.py\", line 1121, in dropout\n    if tensor_util.constant_value(keep_prob) == 1:\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_util.py\", line 634, in constant_value\n    ret = _ConstantValue(tensor)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_util.py\", line 549, in _ConstantValue\n    return MakeNdarray(tensor.op.get_attr(\"value\"))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_util.py\", line 517, in MakeNdarray\n    raise TypeError(\"Unsupported tensor type: %s\" % tensor.dtype)\nTypeError: Unsupported tensor type: 19\n</code></pre>\n<p>Modifying the model configs so that keep probability is 1 eliminates the problem, while any value other than 1 results in a call to <code>tf.nn.dropout</code> and, in turn, a call to <code>tensor_util.constant_value</code>, which results in a <code>TypeError</code>.</p>\n<h3>What have you tried?</h3>\n<p>I have another machine running Ubuntu 14.04, CUDA 7.5, and a slightly older version of TensorFlow that does not have this issue. Details for this other set up:</p>\n<p>Operating System: Ubuntu 14.04 LTS<br>\nGPU: Titan X<br>\nNvidia driver: 352.39<br>\nCUDA: 7.5<br>\ncuDNN: 5<br>\nbazel:</p>\n<pre><code>Build label: 0.3.0-2016-07-25 (@e671d29)\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Mon Jul 25 17:47:58 2016 (1469468878)\nBuild timestamp: 1469468878\nBuild timestamp as int: 1469468878\n</code></pre>\n<p>git commit hash: <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/27eeb441bad8bcaa1bcba42a4b4ee49fb50ea0d3/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/27eeb441bad8bcaa1bcba42a4b4ee49fb50ea0d3\"><tt>27eeb44</tt></a></p>", "body_text": "Environment info\nOperating System: Ubuntu 16.04 LTS\nGPU: GTX 1080\nNvidia driver: 370.23\nCUDA: 8.0\ncuDNN: 5\nbazel:\nBuild label: 0.3.1- (@non-git)\nBuild target: bazel-out/local- fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Wed Aug 24 00:13:09 2016 (1471997589)\nBuild timestamp: 1471997589\nBuild timestamp as int: 1471997589\n\ngit commit hash: cc3153a\nDescription\nWhen run using the --use_fp16 flag and either --model medium or --model large, the PTB language model example fails:\nTraceback (most recent call last):\n  File \"ptb_word_lm.py\", line 339, in <module>\n    tf.app.run()\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv))\n  File \"ptb_word_lm.py\", line 316, in main\n    m = PTBModel(is_training=True, config=config)\n  File \"ptb_word_lm.py\", line 117, in __init__\n    inputs = tf.nn.dropout(inputs, config.keep_prob)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/nn_ops.py\", line 1121, in dropout\n    if tensor_util.constant_value(keep_prob) == 1:\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_util.py\", line 634, in constant_value\n    ret = _ConstantValue(tensor)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_util.py\", line 549, in _ConstantValue\n    return MakeNdarray(tensor.op.get_attr(\"value\"))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_util.py\", line 517, in MakeNdarray\n    raise TypeError(\"Unsupported tensor type: %s\" % tensor.dtype)\nTypeError: Unsupported tensor type: 19\n\nModifying the model configs so that keep probability is 1 eliminates the problem, while any value other than 1 results in a call to tf.nn.dropout and, in turn, a call to tensor_util.constant_value, which results in a TypeError.\nWhat have you tried?\nI have another machine running Ubuntu 14.04, CUDA 7.5, and a slightly older version of TensorFlow that does not have this issue. Details for this other set up:\nOperating System: Ubuntu 14.04 LTS\nGPU: Titan X\nNvidia driver: 352.39\nCUDA: 7.5\ncuDNN: 5\nbazel:\nBuild label: 0.3.0-2016-07-25 (@e671d29)\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Mon Jul 25 17:47:58 2016 (1469468878)\nBuild timestamp: 1469468878\nBuild timestamp as int: 1469468878\n\ngit commit hash: 27eeb44", "body": "### Environment info\n\nOperating System: Ubuntu 16.04 LTS\nGPU: GTX 1080\nNvidia driver: 370.23\nCUDA: 8.0\ncuDNN: 5\nbazel: \n\n```\nBuild label: 0.3.1- (@non-git)\nBuild target: bazel-out/local- fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Wed Aug 24 00:13:09 2016 (1471997589)\nBuild timestamp: 1471997589\nBuild timestamp as int: 1471997589\n```\n\ngit commit hash: cc3153a7a0a23533d14ead34db37e4ccd7892079\n### Description\n\nWhen run using the `--use_fp16` flag and either `--model medium` or `--model large`, the PTB language model example fails:\n\n```\nTraceback (most recent call last):\n  File \"ptb_word_lm.py\", line 339, in <module>\n    tf.app.run()\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv))\n  File \"ptb_word_lm.py\", line 316, in main\n    m = PTBModel(is_training=True, config=config)\n  File \"ptb_word_lm.py\", line 117, in __init__\n    inputs = tf.nn.dropout(inputs, config.keep_prob)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/nn_ops.py\", line 1121, in dropout\n    if tensor_util.constant_value(keep_prob) == 1:\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_util.py\", line 634, in constant_value\n    ret = _ConstantValue(tensor)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_util.py\", line 549, in _ConstantValue\n    return MakeNdarray(tensor.op.get_attr(\"value\"))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_util.py\", line 517, in MakeNdarray\n    raise TypeError(\"Unsupported tensor type: %s\" % tensor.dtype)\nTypeError: Unsupported tensor type: 19\n```\n\nModifying the model configs so that keep probability is 1 eliminates the problem, while any value other than 1 results in a call to `tf.nn.dropout` and, in turn, a call to `tensor_util.constant_value`, which results in a `TypeError`.\n### What have you tried?\n\nI have another machine running Ubuntu 14.04, CUDA 7.5, and a slightly older version of TensorFlow that does not have this issue. Details for this other set up:\n\nOperating System: Ubuntu 14.04 LTS\nGPU: Titan X\nNvidia driver: 352.39 \nCUDA: 7.5\ncuDNN: 5\nbazel: \n\n```\nBuild label: 0.3.0-2016-07-25 (@e671d29)\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Mon Jul 25 17:47:58 2016 (1469468878)\nBuild timestamp: 1469468878\nBuild timestamp as int: 1469468878\n```\n\ngit commit hash: 27eeb441bad8bcaa1bcba42a4b4ee49fb50ea0d3\n"}