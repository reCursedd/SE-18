{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8657", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8657/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8657/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8657/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/8657", "id": 216413438, "node_id": "MDU6SXNzdWUyMTY0MTM0Mzg=", "number": 8657, "title": "Numeric stability CPU vs GPU", "user": {"login": "jostosh", "id": 9034754, "node_id": "MDQ6VXNlcjkwMzQ3NTQ=", "avatar_url": "https://avatars0.githubusercontent.com/u/9034754?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jostosh", "html_url": "https://github.com/jostosh", "followers_url": "https://api.github.com/users/jostosh/followers", "following_url": "https://api.github.com/users/jostosh/following{/other_user}", "gists_url": "https://api.github.com/users/jostosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/jostosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jostosh/subscriptions", "organizations_url": "https://api.github.com/users/jostosh/orgs", "repos_url": "https://api.github.com/users/jostosh/repos", "events_url": "https://api.github.com/users/jostosh/events{/privacy}", "received_events_url": "https://api.github.com/users/jostosh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473184161, "node_id": "MDU6TGFiZWw0NzMxODQxNjE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:support", "name": "type:support", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-03-23T12:36:54Z", "updated_at": "2017-03-24T17:01:41Z", "closed_at": "2017-03-24T17:01:34Z", "author_association": "NONE", "body_html": "<h3>Numerical stability CPU vs GPU</h3>\n<p>My lab partner and I found that in some cases, our scripts would run into numerical instability issues when using GPU, while they would run fine using a CPU. To minimally reproduce this issue, we've come up with the following script:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n<span class=\"pl-k\">import</span> numpy <span class=\"pl-k\">as</span> np\n\n<span class=\"pl-k\">if</span> <span class=\"pl-c1\">__name__</span> <span class=\"pl-k\">==</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>__main__<span class=\"pl-pds\">\"</span></span>:\n\n    t <span class=\"pl-k\">=</span> tf.placeholder(tf.float32, [])\n    division <span class=\"pl-k\">=</span> tf.constant(<span class=\"pl-c1\">1</span>, <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>float32<span class=\"pl-pds\">'</span></span>) <span class=\"pl-k\">/</span> tf.pow(<span class=\"pl-c1\">1.5</span>, <span class=\"pl-k\">-</span>t)\n\n    sess <span class=\"pl-k\">=</span> tf.Session()\n    <span class=\"pl-k\">for</span> count <span class=\"pl-k\">in</span> <span class=\"pl-c1\">range</span>(<span class=\"pl-c1\">100000000</span>):\n        val <span class=\"pl-k\">=</span> sess.run(division, <span class=\"pl-v\">feed_dict</span><span class=\"pl-k\">=</span>{t: count})\n\n        <span class=\"pl-k\">if</span> np.isnan(val) <span class=\"pl-k\">or</span> np.isinf(val) <span class=\"pl-k\">or</span> val <span class=\"pl-k\">&lt;</span> <span class=\"pl-c1\">0</span>:\n            <span class=\"pl-c1\">print</span>(count)\n            <span class=\"pl-k\">break</span>\n</pre></div>\n<p>If we run this with CUDA_VISIBLE_DEVICES=\"\", we see that the script reaches 219 steps before being either <code>nan</code> or <code>inf</code>. If we use GPU instead, we see that the script reaches <strong>only 216</strong> steps before being either <code>nan</code> or <code>inf</code>.</p>\n<h3>Operating system</h3>\n<p>Ubuntu 16.04</p>\n<p>Installed version of CUDA and cuDNN:</p>\n<pre><code>-rw-r--r-- 1 root root   560184 sep 11  2016 /usr/local/cuda-8.0/lib64/libcudadevrt.a\nlrwxrwxrwx 1 root root       16 sep 11  2016 /usr/local/cuda-8.0/lib64/libcudart.so -&gt; libcudart.so.8.0\nlrwxrwxrwx 1 root root       19 sep 11  2016 /usr/local/cuda-8.0/lib64/libcudart.so.8.0 -&gt; libcudart.so.8.0.27\n-rwxr-xr-x 1 root root   394472 sep 11  2016 /usr/local/cuda-8.0/lib64/libcudart.so.8.0.27\n-rw-r--r-- 1 root root   737516 sep 11  2016 /usr/local/cuda-8.0/lib64/libcudart_static.a\n-rwxr-xr-x 1 root root 79337624 nov  5 12:57 /usr/local/cuda-8.0/lib64/libcudnn.so\n-rwxr-xr-x 1 root root 79337624 nov  5 12:57 /usr/local/cuda-8.0/lib64/libcudnn.so.5\n-rwxr-xr-x 1 root root 79337624 nov  5 12:57 /usr/local/cuda-8.0/lib64/libcudnn.so.5.1.5\n-rw-r--r-- 1 root root 69756172 nov  5 12:57 /usr/local/cuda-8.0/lib64/libcudnn_static.a\n</code></pre>\n<p>Tensorflow version (from binary):<br>\n0.12.0</p>", "body_text": "Numerical stability CPU vs GPU\nMy lab partner and I found that in some cases, our scripts would run into numerical instability issues when using GPU, while they would run fine using a CPU. To minimally reproduce this issue, we've come up with the following script:\nimport tensorflow as tf\nimport numpy as np\n\nif __name__ == \"__main__\":\n\n    t = tf.placeholder(tf.float32, [])\n    division = tf.constant(1, dtype='float32') / tf.pow(1.5, -t)\n\n    sess = tf.Session()\n    for count in range(100000000):\n        val = sess.run(division, feed_dict={t: count})\n\n        if np.isnan(val) or np.isinf(val) or val < 0:\n            print(count)\n            break\n\nIf we run this with CUDA_VISIBLE_DEVICES=\"\", we see that the script reaches 219 steps before being either nan or inf. If we use GPU instead, we see that the script reaches only 216 steps before being either nan or inf.\nOperating system\nUbuntu 16.04\nInstalled version of CUDA and cuDNN:\n-rw-r--r-- 1 root root   560184 sep 11  2016 /usr/local/cuda-8.0/lib64/libcudadevrt.a\nlrwxrwxrwx 1 root root       16 sep 11  2016 /usr/local/cuda-8.0/lib64/libcudart.so -> libcudart.so.8.0\nlrwxrwxrwx 1 root root       19 sep 11  2016 /usr/local/cuda-8.0/lib64/libcudart.so.8.0 -> libcudart.so.8.0.27\n-rwxr-xr-x 1 root root   394472 sep 11  2016 /usr/local/cuda-8.0/lib64/libcudart.so.8.0.27\n-rw-r--r-- 1 root root   737516 sep 11  2016 /usr/local/cuda-8.0/lib64/libcudart_static.a\n-rwxr-xr-x 1 root root 79337624 nov  5 12:57 /usr/local/cuda-8.0/lib64/libcudnn.so\n-rwxr-xr-x 1 root root 79337624 nov  5 12:57 /usr/local/cuda-8.0/lib64/libcudnn.so.5\n-rwxr-xr-x 1 root root 79337624 nov  5 12:57 /usr/local/cuda-8.0/lib64/libcudnn.so.5.1.5\n-rw-r--r-- 1 root root 69756172 nov  5 12:57 /usr/local/cuda-8.0/lib64/libcudnn_static.a\n\nTensorflow version (from binary):\n0.12.0", "body": "### Numerical stability CPU vs GPU\r\nMy lab partner and I found that in some cases, our scripts would run into numerical instability issues when using GPU, while they would run fine using a CPU. To minimally reproduce this issue, we've come up with the following script:\r\n```python\r\nimport tensorflow as tf\r\nimport numpy as np\r\n\r\nif __name__ == \"__main__\":\r\n\r\n    t = tf.placeholder(tf.float32, [])\r\n    division = tf.constant(1, dtype='float32') / tf.pow(1.5, -t)\r\n\r\n    sess = tf.Session()\r\n    for count in range(100000000):\r\n        val = sess.run(division, feed_dict={t: count})\r\n\r\n        if np.isnan(val) or np.isinf(val) or val < 0:\r\n            print(count)\r\n            break\r\n\r\n```\r\nIf we run this with CUDA_VISIBLE_DEVICES=\"\", we see that the script reaches 219 steps before being either `nan` or `inf`. If we use GPU instead, we see that the script reaches **only 216** steps before being either `nan` or `inf`.\r\n\r\n### Operating system\r\nUbuntu 16.04\r\n\r\nInstalled version of CUDA and cuDNN:\r\n```\r\n-rw-r--r-- 1 root root   560184 sep 11  2016 /usr/local/cuda-8.0/lib64/libcudadevrt.a\r\nlrwxrwxrwx 1 root root       16 sep 11  2016 /usr/local/cuda-8.0/lib64/libcudart.so -> libcudart.so.8.0\r\nlrwxrwxrwx 1 root root       19 sep 11  2016 /usr/local/cuda-8.0/lib64/libcudart.so.8.0 -> libcudart.so.8.0.27\r\n-rwxr-xr-x 1 root root   394472 sep 11  2016 /usr/local/cuda-8.0/lib64/libcudart.so.8.0.27\r\n-rw-r--r-- 1 root root   737516 sep 11  2016 /usr/local/cuda-8.0/lib64/libcudart_static.a\r\n-rwxr-xr-x 1 root root 79337624 nov  5 12:57 /usr/local/cuda-8.0/lib64/libcudnn.so\r\n-rwxr-xr-x 1 root root 79337624 nov  5 12:57 /usr/local/cuda-8.0/lib64/libcudnn.so.5\r\n-rwxr-xr-x 1 root root 79337624 nov  5 12:57 /usr/local/cuda-8.0/lib64/libcudnn.so.5.1.5\r\n-rw-r--r-- 1 root root 69756172 nov  5 12:57 /usr/local/cuda-8.0/lib64/libcudnn_static.a\r\n```\r\nTensorflow version (from binary):\r\n0.12.0"}