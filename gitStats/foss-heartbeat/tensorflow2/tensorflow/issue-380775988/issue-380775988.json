{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23748", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23748/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23748/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23748/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23748", "id": 380775988, "node_id": "MDU6SXNzdWUzODA3NzU5ODg=", "number": 23748, "title": "tensorflow.keras Dense layers complain if the input is a sparse Input layer.", "user": {"login": "JamesGlooTeam", "id": 7522514, "node_id": "MDQ6VXNlcjc1MjI1MTQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/7522514?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JamesGlooTeam", "html_url": "https://github.com/JamesGlooTeam", "followers_url": "https://api.github.com/users/JamesGlooTeam/followers", "following_url": "https://api.github.com/users/JamesGlooTeam/following{/other_user}", "gists_url": "https://api.github.com/users/JamesGlooTeam/gists{/gist_id}", "starred_url": "https://api.github.com/users/JamesGlooTeam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JamesGlooTeam/subscriptions", "organizations_url": "https://api.github.com/users/JamesGlooTeam/orgs", "repos_url": "https://api.github.com/users/JamesGlooTeam/repos", "events_url": "https://api.github.com/users/JamesGlooTeam/events{/privacy}", "received_events_url": "https://api.github.com/users/JamesGlooTeam/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": {"login": "karmel", "id": 667809, "node_id": "MDQ6VXNlcjY2NzgwOQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/667809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/karmel", "html_url": "https://github.com/karmel", "followers_url": "https://api.github.com/users/karmel/followers", "following_url": "https://api.github.com/users/karmel/following{/other_user}", "gists_url": "https://api.github.com/users/karmel/gists{/gist_id}", "starred_url": "https://api.github.com/users/karmel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/karmel/subscriptions", "organizations_url": "https://api.github.com/users/karmel/orgs", "repos_url": "https://api.github.com/users/karmel/repos", "events_url": "https://api.github.com/users/karmel/events{/privacy}", "received_events_url": "https://api.github.com/users/karmel/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "karmel", "id": 667809, "node_id": "MDQ6VXNlcjY2NzgwOQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/667809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/karmel", "html_url": "https://github.com/karmel", "followers_url": "https://api.github.com/users/karmel/followers", "following_url": "https://api.github.com/users/karmel/following{/other_user}", "gists_url": "https://api.github.com/users/karmel/gists{/gist_id}", "starred_url": "https://api.github.com/users/karmel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/karmel/subscriptions", "organizations_url": "https://api.github.com/users/karmel/orgs", "repos_url": "https://api.github.com/users/karmel/repos", "events_url": "https://api.github.com/users/karmel/events{/privacy}", "received_events_url": "https://api.github.com/users/karmel/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2018-11-14T16:19:40Z", "updated_at": "2018-11-19T21:54:06Z", "closed_at": null, "author_association": "NONE", "body_html": "<p><strong>System information</strong></p>\n<ul>\n<li>Have I written custom code (as opposed to using a stock example script provided in TensorFlow):<br>\nYes.</li>\n<li>OS Platform and Distribution (e.g., Linux Ubuntu 16.04):<br>\nOSX Mojave 10.14.1</li>\n<li>Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:<br>\nna</li>\n<li>TensorFlow installed from (source or binary):<br>\nbinary</li>\n<li>TensorFlow version (use command below):<br>\n1.10.0 (v1.10.0-rc1-19-g656e7a2b34)</li>\n<li>Python version:<br>\n3.5</li>\n<li>Bazel version (if compiling from source):<br>\nNA</li>\n<li>GCC/Compiler version (if compiling from source):</li>\n<li>CUDA/cuDNN version:</li>\n<li>GPU model and memory:</li>\n</ul>\n<p>You can collect some of this information using our environment capture <a href=\"https://github.com/tensorflow/tensorflow/tree/master/tools/tf_env_collect.sh\">script</a><br>\nYou can also obtain the TensorFlow version with<br>\npython -c \"import tensorflow as tf; print(tf.GIT_VERSION, tf.VERSION)\"</p>\n<p><strong>Describe the current behavior</strong><br>\nSee below, which I ran on a OSX Mojave Macbook Pro (Early 2015), ipython running python 3.5, tensorflow 1.10.0:</p>\n<pre><code>In [1]: from tensorflow.keras.models import Model\n//anaconda/envs/dssm/lib/python3.5/importlib/_bootstrap.py:222: RuntimeWarning: compiletime version 3.6 of module 'tensorflow.python.framework.fast_tensor_util' does not match runtime version 3.5\n  return f(*args, **kwds)\n\nIn [2]: from tensorflow.keras.layers import Input, Dense\n\nIn [3]: i = Input((4,), sparse=True)\n\nIn [4]: d = Dense(4)(i)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n&lt;ipython-input-4-0fb73bda26dc&gt; in &lt;module&gt;\n----&gt; 1 d = Dense(4)(i)\n\n//anaconda/envs/dssm/lib/python3.5/site-packages/tensorflow/python/keras/engine/base_layer.py in __call__(self, inputs, *args, **kwargs)\n    718\n    719         # Check input assumptions set before layer building, e.g. input rank.\n--&gt; 720         self._assert_input_compatibility(inputs)\n    721         if input_list and self._dtype is None:\n    722           try:\n\n//anaconda/envs/dssm/lib/python3.5/site-packages/tensorflow/python/keras/engine/base_layer.py in _assert_input_compatibility(self, inputs)\n   1408           spec.min_ndim is not None or\n   1409           spec.max_ndim is not None):\n-&gt; 1410         if x.shape.ndims is None:\n   1411           raise ValueError('Input ' + str(input_index) + ' of layer ' +\n   1412                            self.name + ' is incompatible with the layer: '\n\nAttributeError: 'SparseTensor' object has no attribute 'shape'\n</code></pre>\n<p><strong>Describe the expected behavior</strong></p>\n<p>If I were using normal Keras, I'd expect no errors trying to do the above and for the model to compile subsequently without issue.</p>\n<p><strong>Code to reproduce the issue</strong><br>\nSee the code in my snippet above.</p>\n<p><strong>Other info / logs</strong></p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nYes.\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nOSX Mojave 10.14.1\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:\nna\nTensorFlow installed from (source or binary):\nbinary\nTensorFlow version (use command below):\n1.10.0 (v1.10.0-rc1-19-g656e7a2b34)\nPython version:\n3.5\nBazel version (if compiling from source):\nNA\nGCC/Compiler version (if compiling from source):\nCUDA/cuDNN version:\nGPU model and memory:\n\nYou can collect some of this information using our environment capture script\nYou can also obtain the TensorFlow version with\npython -c \"import tensorflow as tf; print(tf.GIT_VERSION, tf.VERSION)\"\nDescribe the current behavior\nSee below, which I ran on a OSX Mojave Macbook Pro (Early 2015), ipython running python 3.5, tensorflow 1.10.0:\nIn [1]: from tensorflow.keras.models import Model\n//anaconda/envs/dssm/lib/python3.5/importlib/_bootstrap.py:222: RuntimeWarning: compiletime version 3.6 of module 'tensorflow.python.framework.fast_tensor_util' does not match runtime version 3.5\n  return f(*args, **kwds)\n\nIn [2]: from tensorflow.keras.layers import Input, Dense\n\nIn [3]: i = Input((4,), sparse=True)\n\nIn [4]: d = Dense(4)(i)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-4-0fb73bda26dc> in <module>\n----> 1 d = Dense(4)(i)\n\n//anaconda/envs/dssm/lib/python3.5/site-packages/tensorflow/python/keras/engine/base_layer.py in __call__(self, inputs, *args, **kwargs)\n    718\n    719         # Check input assumptions set before layer building, e.g. input rank.\n--> 720         self._assert_input_compatibility(inputs)\n    721         if input_list and self._dtype is None:\n    722           try:\n\n//anaconda/envs/dssm/lib/python3.5/site-packages/tensorflow/python/keras/engine/base_layer.py in _assert_input_compatibility(self, inputs)\n   1408           spec.min_ndim is not None or\n   1409           spec.max_ndim is not None):\n-> 1410         if x.shape.ndims is None:\n   1411           raise ValueError('Input ' + str(input_index) + ' of layer ' +\n   1412                            self.name + ' is incompatible with the layer: '\n\nAttributeError: 'SparseTensor' object has no attribute 'shape'\n\nDescribe the expected behavior\nIf I were using normal Keras, I'd expect no errors trying to do the above and for the model to compile subsequently without issue.\nCode to reproduce the issue\nSee the code in my snippet above.\nOther info / logs", "body": "**System information**\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow):\r\nYes.\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 16.04):\r\nOSX Mojave 10.14.1\r\n- Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:\r\nna\r\n- TensorFlow installed from (source or binary):\r\nbinary\r\n- TensorFlow version (use command below):\r\n1.10.0 (v1.10.0-rc1-19-g656e7a2b34)\r\n- Python version:\r\n3.5\r\n- Bazel version (if compiling from source):\r\nNA\r\n- GCC/Compiler version (if compiling from source):\r\n- CUDA/cuDNN version:\r\n- GPU model and memory:\r\n\r\n\r\nYou can collect some of this information using our environment capture [script](https://github.com/tensorflow/tensorflow/tree/master/tools/tf_env_collect.sh)\r\nYou can also obtain the TensorFlow version with\r\npython -c \"import tensorflow as tf; print(tf.GIT_VERSION, tf.VERSION)\"\r\n\r\n**Describe the current behavior**\r\nSee below, which I ran on a OSX Mojave Macbook Pro (Early 2015), ipython running python 3.5, tensorflow 1.10.0:\r\n\r\n```\r\nIn [1]: from tensorflow.keras.models import Model\r\n//anaconda/envs/dssm/lib/python3.5/importlib/_bootstrap.py:222: RuntimeWarning: compiletime version 3.6 of module 'tensorflow.python.framework.fast_tensor_util' does not match runtime version 3.5\r\n  return f(*args, **kwds)\r\n\r\nIn [2]: from tensorflow.keras.layers import Input, Dense\r\n\r\nIn [3]: i = Input((4,), sparse=True)\r\n\r\nIn [4]: d = Dense(4)(i)\r\n---------------------------------------------------------------------------\r\nAttributeError                            Traceback (most recent call last)\r\n<ipython-input-4-0fb73bda26dc> in <module>\r\n----> 1 d = Dense(4)(i)\r\n\r\n//anaconda/envs/dssm/lib/python3.5/site-packages/tensorflow/python/keras/engine/base_layer.py in __call__(self, inputs, *args, **kwargs)\r\n    718\r\n    719         # Check input assumptions set before layer building, e.g. input rank.\r\n--> 720         self._assert_input_compatibility(inputs)\r\n    721         if input_list and self._dtype is None:\r\n    722           try:\r\n\r\n//anaconda/envs/dssm/lib/python3.5/site-packages/tensorflow/python/keras/engine/base_layer.py in _assert_input_compatibility(self, inputs)\r\n   1408           spec.min_ndim is not None or\r\n   1409           spec.max_ndim is not None):\r\n-> 1410         if x.shape.ndims is None:\r\n   1411           raise ValueError('Input ' + str(input_index) + ' of layer ' +\r\n   1412                            self.name + ' is incompatible with the layer: '\r\n\r\nAttributeError: 'SparseTensor' object has no attribute 'shape'\r\n```\r\n\r\n**Describe the expected behavior**\r\n\r\nIf I were using normal Keras, I'd expect no errors trying to do the above and for the model to compile subsequently without issue.\r\n\r\n**Code to reproduce the issue**\r\nSee the code in my snippet above.\r\n\r\n**Other info / logs**\r\n\r\n"}