{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17124", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17124/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17124/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17124/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/17124", "id": 298224300, "node_id": "MDU6SXNzdWUyOTgyMjQzMDA=", "number": 17124, "title": "tf serving - dependency_optimizer - Non-existent input  for node dynamic_seq2seq/decoder/decoder/GatherTree", "user": {"login": "phisch124", "id": 3951108, "node_id": "MDQ6VXNlcjM5NTExMDg=", "avatar_url": "https://avatars0.githubusercontent.com/u/3951108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phisch124", "html_url": "https://github.com/phisch124", "followers_url": "https://api.github.com/users/phisch124/followers", "following_url": "https://api.github.com/users/phisch124/following{/other_user}", "gists_url": "https://api.github.com/users/phisch124/gists{/gist_id}", "starred_url": "https://api.github.com/users/phisch124/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phisch124/subscriptions", "organizations_url": "https://api.github.com/users/phisch124/orgs", "repos_url": "https://api.github.com/users/phisch124/repos", "events_url": "https://api.github.com/users/phisch124/events{/privacy}", "received_events_url": "https://api.github.com/users/phisch124/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-02-19T10:24:01Z", "updated_at": "2018-02-20T08:08:23Z", "closed_at": "2018-02-20T08:08:23Z", "author_association": "NONE", "body_html": "<p>I am trying to serve a tensorflow/nmt model with tf serving. I copied my SavedModel into the docker image and I'm serving it using:</p>\n<p><code>bazel-bin/tensorflow_serving/model_servers/tensorflow_model_server --port=9000 --model_name=model_test --model_base_path=/serving/SavedModel &amp;&gt; model_test.log &amp;</code></p>\n<p>Here the logs:</p>\n<pre><code>root@8de7a26d2e65:/serving# cat model_test.log\n2018-02-19 10:07:01.227129: I tensorflow_serving/model_servers/main.cc:153] Building single TensorFlow model file config:  model_name: rxn_test model_base_path: /serving/SavedModel\n2018-02-19 10:07:01.228912: I tensorflow_serving/model_servers/server_core.cc:444] Adding/updating models.\n2018-02-19 10:07:01.228996: I tensorflow_serving/model_servers/server_core.cc:499]  (Re-)adding model: rxn_test\n2018-02-19 10:07:01.330004: I tensorflow_serving/core/basic_manager.cc:716] Successfully reserved resources to load servable {name: rxn_test version: 1}\n2018-02-19 10:07:01.330050: I tensorflow_serving/core/loader_harness.cc:66] Approving load for servable version {name: rxn_test version: 1}\n2018-02-19 10:07:01.330072: I tensorflow_serving/core/loader_harness.cc:74] Loading servable version {name: rxn_test version: 1}\n2018-02-19 10:07:01.330097: I external/org_tensorflow/tensorflow/contrib/session_bundle/bundle_shim.cc:360] Attempting to load native SavedModelBundle in bundle-shim from: /serving/SavedModel/1\n2018-02-19 10:07:01.330124: I external/org_tensorflow/tensorflow/cc/saved_model/loader.cc:240] Loading SavedModel with tags: { serve }; from: /serving/SavedModel/1\n2018-02-19 10:07:01.338657: I external/org_tensorflow/tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\n2018-02-19 10:07:01.371196: I external/org_tensorflow/tensorflow/cc/saved_model/loader.cc:159] Restoring SavedModel bundle.\n2018-02-19 10:07:01.641102: I external/org_tensorflow/tensorflow/cc/saved_model/loader.cc:194] Running LegacyInitOp on SavedModel bundle.\n2018-02-19 10:07:01.659991: I external/org_tensorflow/tensorflow/cc/saved_model/loader.cc:289] SavedModel load for tags { serve }; Status: success. Took 329854 microseconds.\n2018-02-19 10:07:01.660289: I tensorflow_serving/core/loader_harness.cc:86] Successfully loaded servable version {name: rxn_test version: 1}\n2018-02-19 10:07:01.664151: I tensorflow_serving/model_servers/main.cc:315] **Running ModelServer at 0.0.0.0:9000 ...** &lt;--- it runs \n</code></pre>\n<p>When I try to predict something, using predict.py:</p>\n<p><code>python predict.py --server=localhost:9000 --inputs='input string' </code></p>\n<p>it fails with following error:</p>\n<pre><code>Traceback (most recent call last):\n  File \"/envs/tf35/lib/python3.5/site-packages/grpc/beta/_client_adaptations.py\", line 193, in _blocking_unary_unary\n    credentials=_credentials(protocol_options))\n  File \"/envs/tf35/lib/python3.5/site-packages/grpc/_channel.py\", line 487, in __call__\n    return _end_unary_response_blocking(state, call, False, deadline)\n  File \"/envs/tf35/lib/python3.5/site-packages/grpc/_channel.py\", line 437, in _end_unary_response_blocking\n    raise _Rendezvous(state, None, None, deadline)\ngrpc._channel._Rendezvous: &lt;_Rendezvous of RPC that terminated with (StatusCode.INVALID_ARGUMENT, Incomplete graph, missing 1 inputs for dynamic_seq2seq/decoder/decoder/GatherTree)&gt;\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"predict.py\", line 50, in &lt;module&gt;\n    tf.app.run()\n  File \"/envs/tf35/lib/python3.5/site-packages/tensorflow/python/platform/app.py\", line 48, in run\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\n  File \"predict.py\", line 45, in main\n    result = stub.Predict(request, 60.0)  # 60 secs timeout\n  File \"/envs/tf35/lib/python3.5/site-packages/grpc/beta/_client_adaptations.py\", line 309, in __call__\n    self._request_serializer, self._response_deserializer)\n  File \"/envs/tf35/lib/python3.5/site-packages/grpc/beta/_client_adaptations.py\", line 195, in _blocking_unary_unary\n    raise _abortion_error(rpc_error_call)\ngrpc.framework.interfaces.face.face.AbortionError: AbortionError(code=StatusCode.INVALID_ARGUMENT, details=\"Incomplete graph, missing 1 inputs for dynamic_seq2seq/decoder/decoder/GatherTree\")\n</code></pre>\n<p>And in the model_test.log</p>\n<pre><code>2018-02-19 10:07:16.628894: E external/org_tensorflow/tensorflow/core/grappler/optimizers/dependency_optimizer.cc:584] Non-existent input  for node dynamic_seq2seq/decoder/decoder/GatherTree\n2018-02-19 10:07:16.638890: E external/org_tensorflow/tensorflow/core/grappler/optimizers/dependency_optimizer.cc:584] Non-existent input  for node dynamic_seq2seq/decoder/decoder/GatherTree\n</code></pre>\n<p>Did anyone experience this?</p>", "body_text": "I am trying to serve a tensorflow/nmt model with tf serving. I copied my SavedModel into the docker image and I'm serving it using:\nbazel-bin/tensorflow_serving/model_servers/tensorflow_model_server --port=9000 --model_name=model_test --model_base_path=/serving/SavedModel &> model_test.log &\nHere the logs:\nroot@8de7a26d2e65:/serving# cat model_test.log\n2018-02-19 10:07:01.227129: I tensorflow_serving/model_servers/main.cc:153] Building single TensorFlow model file config:  model_name: rxn_test model_base_path: /serving/SavedModel\n2018-02-19 10:07:01.228912: I tensorflow_serving/model_servers/server_core.cc:444] Adding/updating models.\n2018-02-19 10:07:01.228996: I tensorflow_serving/model_servers/server_core.cc:499]  (Re-)adding model: rxn_test\n2018-02-19 10:07:01.330004: I tensorflow_serving/core/basic_manager.cc:716] Successfully reserved resources to load servable {name: rxn_test version: 1}\n2018-02-19 10:07:01.330050: I tensorflow_serving/core/loader_harness.cc:66] Approving load for servable version {name: rxn_test version: 1}\n2018-02-19 10:07:01.330072: I tensorflow_serving/core/loader_harness.cc:74] Loading servable version {name: rxn_test version: 1}\n2018-02-19 10:07:01.330097: I external/org_tensorflow/tensorflow/contrib/session_bundle/bundle_shim.cc:360] Attempting to load native SavedModelBundle in bundle-shim from: /serving/SavedModel/1\n2018-02-19 10:07:01.330124: I external/org_tensorflow/tensorflow/cc/saved_model/loader.cc:240] Loading SavedModel with tags: { serve }; from: /serving/SavedModel/1\n2018-02-19 10:07:01.338657: I external/org_tensorflow/tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\n2018-02-19 10:07:01.371196: I external/org_tensorflow/tensorflow/cc/saved_model/loader.cc:159] Restoring SavedModel bundle.\n2018-02-19 10:07:01.641102: I external/org_tensorflow/tensorflow/cc/saved_model/loader.cc:194] Running LegacyInitOp on SavedModel bundle.\n2018-02-19 10:07:01.659991: I external/org_tensorflow/tensorflow/cc/saved_model/loader.cc:289] SavedModel load for tags { serve }; Status: success. Took 329854 microseconds.\n2018-02-19 10:07:01.660289: I tensorflow_serving/core/loader_harness.cc:86] Successfully loaded servable version {name: rxn_test version: 1}\n2018-02-19 10:07:01.664151: I tensorflow_serving/model_servers/main.cc:315] **Running ModelServer at 0.0.0.0:9000 ...** <--- it runs \n\nWhen I try to predict something, using predict.py:\npython predict.py --server=localhost:9000 --inputs='input string' \nit fails with following error:\nTraceback (most recent call last):\n  File \"/envs/tf35/lib/python3.5/site-packages/grpc/beta/_client_adaptations.py\", line 193, in _blocking_unary_unary\n    credentials=_credentials(protocol_options))\n  File \"/envs/tf35/lib/python3.5/site-packages/grpc/_channel.py\", line 487, in __call__\n    return _end_unary_response_blocking(state, call, False, deadline)\n  File \"/envs/tf35/lib/python3.5/site-packages/grpc/_channel.py\", line 437, in _end_unary_response_blocking\n    raise _Rendezvous(state, None, None, deadline)\ngrpc._channel._Rendezvous: <_Rendezvous of RPC that terminated with (StatusCode.INVALID_ARGUMENT, Incomplete graph, missing 1 inputs for dynamic_seq2seq/decoder/decoder/GatherTree)>\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"predict.py\", line 50, in <module>\n    tf.app.run()\n  File \"/envs/tf35/lib/python3.5/site-packages/tensorflow/python/platform/app.py\", line 48, in run\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\n  File \"predict.py\", line 45, in main\n    result = stub.Predict(request, 60.0)  # 60 secs timeout\n  File \"/envs/tf35/lib/python3.5/site-packages/grpc/beta/_client_adaptations.py\", line 309, in __call__\n    self._request_serializer, self._response_deserializer)\n  File \"/envs/tf35/lib/python3.5/site-packages/grpc/beta/_client_adaptations.py\", line 195, in _blocking_unary_unary\n    raise _abortion_error(rpc_error_call)\ngrpc.framework.interfaces.face.face.AbortionError: AbortionError(code=StatusCode.INVALID_ARGUMENT, details=\"Incomplete graph, missing 1 inputs for dynamic_seq2seq/decoder/decoder/GatherTree\")\n\nAnd in the model_test.log\n2018-02-19 10:07:16.628894: E external/org_tensorflow/tensorflow/core/grappler/optimizers/dependency_optimizer.cc:584] Non-existent input  for node dynamic_seq2seq/decoder/decoder/GatherTree\n2018-02-19 10:07:16.638890: E external/org_tensorflow/tensorflow/core/grappler/optimizers/dependency_optimizer.cc:584] Non-existent input  for node dynamic_seq2seq/decoder/decoder/GatherTree\n\nDid anyone experience this?", "body": "I am trying to serve a tensorflow/nmt model with tf serving. I copied my SavedModel into the docker image and I'm serving it using:\r\n\r\n`bazel-bin/tensorflow_serving/model_servers/tensorflow_model_server --port=9000 --model_name=model_test --model_base_path=/serving/SavedModel &> model_test.log &`\r\n\r\nHere the logs: \r\n\r\n```\r\nroot@8de7a26d2e65:/serving# cat model_test.log\r\n2018-02-19 10:07:01.227129: I tensorflow_serving/model_servers/main.cc:153] Building single TensorFlow model file config:  model_name: rxn_test model_base_path: /serving/SavedModel\r\n2018-02-19 10:07:01.228912: I tensorflow_serving/model_servers/server_core.cc:444] Adding/updating models.\r\n2018-02-19 10:07:01.228996: I tensorflow_serving/model_servers/server_core.cc:499]  (Re-)adding model: rxn_test\r\n2018-02-19 10:07:01.330004: I tensorflow_serving/core/basic_manager.cc:716] Successfully reserved resources to load servable {name: rxn_test version: 1}\r\n2018-02-19 10:07:01.330050: I tensorflow_serving/core/loader_harness.cc:66] Approving load for servable version {name: rxn_test version: 1}\r\n2018-02-19 10:07:01.330072: I tensorflow_serving/core/loader_harness.cc:74] Loading servable version {name: rxn_test version: 1}\r\n2018-02-19 10:07:01.330097: I external/org_tensorflow/tensorflow/contrib/session_bundle/bundle_shim.cc:360] Attempting to load native SavedModelBundle in bundle-shim from: /serving/SavedModel/1\r\n2018-02-19 10:07:01.330124: I external/org_tensorflow/tensorflow/cc/saved_model/loader.cc:240] Loading SavedModel with tags: { serve }; from: /serving/SavedModel/1\r\n2018-02-19 10:07:01.338657: I external/org_tensorflow/tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\r\n2018-02-19 10:07:01.371196: I external/org_tensorflow/tensorflow/cc/saved_model/loader.cc:159] Restoring SavedModel bundle.\r\n2018-02-19 10:07:01.641102: I external/org_tensorflow/tensorflow/cc/saved_model/loader.cc:194] Running LegacyInitOp on SavedModel bundle.\r\n2018-02-19 10:07:01.659991: I external/org_tensorflow/tensorflow/cc/saved_model/loader.cc:289] SavedModel load for tags { serve }; Status: success. Took 329854 microseconds.\r\n2018-02-19 10:07:01.660289: I tensorflow_serving/core/loader_harness.cc:86] Successfully loaded servable version {name: rxn_test version: 1}\r\n2018-02-19 10:07:01.664151: I tensorflow_serving/model_servers/main.cc:315] **Running ModelServer at 0.0.0.0:9000 ...** <--- it runs \r\n```\r\n\r\nWhen I try to predict something, using predict.py:\r\n\r\n`python predict.py --server=localhost:9000 --inputs='input string' `\r\n\r\n it fails with following error: \r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/envs/tf35/lib/python3.5/site-packages/grpc/beta/_client_adaptations.py\", line 193, in _blocking_unary_unary\r\n    credentials=_credentials(protocol_options))\r\n  File \"/envs/tf35/lib/python3.5/site-packages/grpc/_channel.py\", line 487, in __call__\r\n    return _end_unary_response_blocking(state, call, False, deadline)\r\n  File \"/envs/tf35/lib/python3.5/site-packages/grpc/_channel.py\", line 437, in _end_unary_response_blocking\r\n    raise _Rendezvous(state, None, None, deadline)\r\ngrpc._channel._Rendezvous: <_Rendezvous of RPC that terminated with (StatusCode.INVALID_ARGUMENT, Incomplete graph, missing 1 inputs for dynamic_seq2seq/decoder/decoder/GatherTree)>\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"predict.py\", line 50, in <module>\r\n    tf.app.run()\r\n  File \"/envs/tf35/lib/python3.5/site-packages/tensorflow/python/platform/app.py\", line 48, in run\r\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\r\n  File \"predict.py\", line 45, in main\r\n    result = stub.Predict(request, 60.0)  # 60 secs timeout\r\n  File \"/envs/tf35/lib/python3.5/site-packages/grpc/beta/_client_adaptations.py\", line 309, in __call__\r\n    self._request_serializer, self._response_deserializer)\r\n  File \"/envs/tf35/lib/python3.5/site-packages/grpc/beta/_client_adaptations.py\", line 195, in _blocking_unary_unary\r\n    raise _abortion_error(rpc_error_call)\r\ngrpc.framework.interfaces.face.face.AbortionError: AbortionError(code=StatusCode.INVALID_ARGUMENT, details=\"Incomplete graph, missing 1 inputs for dynamic_seq2seq/decoder/decoder/GatherTree\")\r\n```\r\n\r\nAnd in the model_test.log\r\n```\r\n2018-02-19 10:07:16.628894: E external/org_tensorflow/tensorflow/core/grappler/optimizers/dependency_optimizer.cc:584] Non-existent input  for node dynamic_seq2seq/decoder/decoder/GatherTree\r\n2018-02-19 10:07:16.638890: E external/org_tensorflow/tensorflow/core/grappler/optimizers/dependency_optimizer.cc:584] Non-existent input  for node dynamic_seq2seq/decoder/decoder/GatherTree\r\n```\r\n\r\nDid anyone experience this?\r\n\r\n\r\n"}