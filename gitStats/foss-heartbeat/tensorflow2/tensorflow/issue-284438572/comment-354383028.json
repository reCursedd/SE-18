{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/354383028", "html_url": "https://github.com/tensorflow/tensorflow/issues/15625#issuecomment-354383028", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15625", "id": 354383028, "node_id": "MDEyOklzc3VlQ29tbWVudDM1NDM4MzAyOA==", "user": {"login": "nullian", "id": 16415446, "node_id": "MDQ6VXNlcjE2NDE1NDQ2", "avatar_url": "https://avatars0.githubusercontent.com/u/16415446?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nullian", "html_url": "https://github.com/nullian", "followers_url": "https://api.github.com/users/nullian/followers", "following_url": "https://api.github.com/users/nullian/following{/other_user}", "gists_url": "https://api.github.com/users/nullian/gists{/gist_id}", "starred_url": "https://api.github.com/users/nullian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nullian/subscriptions", "organizations_url": "https://api.github.com/users/nullian/orgs", "repos_url": "https://api.github.com/users/nullian/repos", "events_url": "https://api.github.com/users/nullian/events{/privacy}", "received_events_url": "https://api.github.com/users/nullian/received_events", "type": "User", "site_admin": false}, "created_at": "2017-12-29T01:08:49Z", "updated_at": "2017-12-29T01:08:49Z", "author_association": "NONE", "body_html": "<p>i also try it on Ubuntu 14.0.4. use bazel 0.5.4 and NDK r12b to compile static library .<br>\nthen i create an Android application link compiled librayies.<br>\nmy native method like this:</p>\n<p>tensorflow::GraphDef graphDef;<br>\ntensorflow::string path = \"sdcard/frozen_inference_graph.pb\";</p>\n<pre><code>tensorflow::Status status = ReadBinaryProto(tensorflow::Env::Default(), path, &amp;graphDef);\nif(!status.ok()) {\n    return env-&gt;NewStringUTF(\"not found graph\");\n}\n\nstd::unique_ptr&lt;tensorflow::Session&gt; session;\n\n(&amp;session)-&gt;reset(tensorflow::NewSession(tensorflow::SessionOptions()));\n\nstatus = session-&gt;Create(graphDef);\n\nif(!status.ok()) {\n    return env-&gt;NewStringUTF(\"create session error\");\n}\n</code></pre>\n<p>and CMakeLists.txt</p>\n<p>cmake_minimum_required(VERSION 3.4.1)</p>\n<p>set( CMAKE_BUILD_TYPE  \"Release\")</p>\n<p>set( CMAKE_CXX_FLAGS  \"${CMAKE_CXX_FLAGS} -Wl,--allow-multiple-definition -Wl,--whole-archive\")</p>\n<p>set( tf_include  /home/yuanhao/Android/tf/tf)</p>\n<p>include_directories( ${tf_include})</p>\n<p>add_library( pb  STATIC  IMPORTED )<br>\nset_target_properties( pb  PROPERTIES  IMPORTED_LOCATION  /home/yuanhao/Android/tf/libprotobuf.a)</p>\n<p>add_library( tf  STATIC  IMPORTED )<br>\nset_target_properties( tf  PROPERTIES  IMPORTED_LOCATION  /home/yuanhao/Android/tf/libtensorflow-core.a)</p>\n<p>file( GLOB  src  \"src/main/cpp/*.cpp\")</p>\n<p>add_library( native-lib  SHARED  ${src} )</p>\n<p>target_link_libraries( native-lib  log  tf  pb )</p>\n<p>when i build my application, errors</p>\n<p>Build command failed.<br>\nError while executing process /home/yuanhao/Android/Sdk/cmake/3.6.4111459/bin/cmake with arguments {--build /home/yuanhao/AndroidStudioProjects/Test/app/.externalNativeBuild/cmake/debug/armeabi-v7a --target native-lib}<br>\n[1/2] Building CXX object CMakeFiles/native-lib.dir/src/main/cpp/native-lib.cpp.o<br>\n[2/2] Linking CXX shared library ../../../../build/intermediates/cmake/debug/obj/armeabi-v7a/libnative-lib.so<br>\nFAILED: : &amp;&amp; /home/yuanhao/Android/android-ndk-r12b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin/arm-linux-androideabi-g++  --sysroot=/home/yuanhao/Android/android-ndk-r12b/platforms/android-21/arch-arm -fPIC -g -DANDROID -ffunction-sections -funwind-tables -fstack-protector-strong -no-canonical-prefixes -march=armv7-a -mfloat-abi=softfp -mfpu=vfpv3-d16 -mthumb -Wa,--noexecstack -Wformat -Werror=format-security -fno-exceptions -fno-rtti -g -DANDROID -ffunction-sections -funwind-tables -fstack-protector-strong -no-canonical-prefixes -march=armv7-a -mfloat-abi=softfp -mfpu=vfpv3-d16 -mthumb -Wa,--noexecstack -Wformat -Werror=format-security -fno-exceptions -fno-rtti -std=c++11 -frtti -fexceptions -Wl,--allow-multiple-definition -Wl,--whole-archive -Os -DNDEBUG -Os -DNDEBUG  -Wl,--build-id -Wl,--warn-shared-textrel -Wl,--fatal-warnings -Wl,--fix-cortex-a8 -Wl,--no-undefined -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,now -Wl,--build-id -Wl,--warn-shared-textrel -Wl,--fatal-warnings -Wl,--fix-cortex-a8 -Wl,--no-undefined -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,now -shared -Wl,-soname,libnative-lib.so -o ../../../../build/intermediates/cmake/debug/obj/armeabi-v7a/libnative-lib.so CMakeFiles/native-lib.dir/src/main/cpp/native-lib.cpp.o  -llog /home/yuanhao/Android/tf/libtensorflow-core.a /home/yuanhao/Android/tf/libprotobuf.a -lm \"/home/yuanhao/Android/android-ndk-r12b/sources/cxx-stl/gnu-libstdc++/4.9/libs/armeabi-v7a/libgnustl_static.a\" &amp;&amp; :<br>\n/home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::GzipInputStream::~GzipInputStream(): error: undefined reference to 'inflateEnd'<br>\n/home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::internalInflateInit2(z_stream_s*, google::protobuf::io::GzipInputStream::Format): error: undefined reference to 'inflateInit2_'<br>\n/home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::GzipInputStream::Inflate(int): error: undefined reference to 'inflate'<br>\n/home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::GzipInputStream::Next(void const**, int*): error: undefined reference to 'inflateEnd'<br>\n/home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::GzipOutputStream::Init(google::protobuf::io::ZeroCopyOutputStream*, google::protobuf::io::GzipOutputStream::Options const&amp;): error: undefined reference to 'deflateInit2_'<br>\n/home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::GzipOutputStream::Deflate(int): error: undefined reference to 'deflate'<br>\n/home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::GzipOutputStream::Close(): error: undefined reference to 'deflateEnd'<br>\ncollect2: error: ld returned 1 exit status<br>\nninja: build stopped: subcommand failed.</p>", "body_text": "i also try it on Ubuntu 14.0.4. use bazel 0.5.4 and NDK r12b to compile static library .\nthen i create an Android application link compiled librayies.\nmy native method like this:\ntensorflow::GraphDef graphDef;\ntensorflow::string path = \"sdcard/frozen_inference_graph.pb\";\ntensorflow::Status status = ReadBinaryProto(tensorflow::Env::Default(), path, &graphDef);\nif(!status.ok()) {\n    return env->NewStringUTF(\"not found graph\");\n}\n\nstd::unique_ptr<tensorflow::Session> session;\n\n(&session)->reset(tensorflow::NewSession(tensorflow::SessionOptions()));\n\nstatus = session->Create(graphDef);\n\nif(!status.ok()) {\n    return env->NewStringUTF(\"create session error\");\n}\n\nand CMakeLists.txt\ncmake_minimum_required(VERSION 3.4.1)\nset( CMAKE_BUILD_TYPE  \"Release\")\nset( CMAKE_CXX_FLAGS  \"${CMAKE_CXX_FLAGS} -Wl,--allow-multiple-definition -Wl,--whole-archive\")\nset( tf_include  /home/yuanhao/Android/tf/tf)\ninclude_directories( ${tf_include})\nadd_library( pb  STATIC  IMPORTED )\nset_target_properties( pb  PROPERTIES  IMPORTED_LOCATION  /home/yuanhao/Android/tf/libprotobuf.a)\nadd_library( tf  STATIC  IMPORTED )\nset_target_properties( tf  PROPERTIES  IMPORTED_LOCATION  /home/yuanhao/Android/tf/libtensorflow-core.a)\nfile( GLOB  src  \"src/main/cpp/*.cpp\")\nadd_library( native-lib  SHARED  ${src} )\ntarget_link_libraries( native-lib  log  tf  pb )\nwhen i build my application, errors\nBuild command failed.\nError while executing process /home/yuanhao/Android/Sdk/cmake/3.6.4111459/bin/cmake with arguments {--build /home/yuanhao/AndroidStudioProjects/Test/app/.externalNativeBuild/cmake/debug/armeabi-v7a --target native-lib}\n[1/2] Building CXX object CMakeFiles/native-lib.dir/src/main/cpp/native-lib.cpp.o\n[2/2] Linking CXX shared library ../../../../build/intermediates/cmake/debug/obj/armeabi-v7a/libnative-lib.so\nFAILED: : && /home/yuanhao/Android/android-ndk-r12b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin/arm-linux-androideabi-g++  --sysroot=/home/yuanhao/Android/android-ndk-r12b/platforms/android-21/arch-arm -fPIC -g -DANDROID -ffunction-sections -funwind-tables -fstack-protector-strong -no-canonical-prefixes -march=armv7-a -mfloat-abi=softfp -mfpu=vfpv3-d16 -mthumb -Wa,--noexecstack -Wformat -Werror=format-security -fno-exceptions -fno-rtti -g -DANDROID -ffunction-sections -funwind-tables -fstack-protector-strong -no-canonical-prefixes -march=armv7-a -mfloat-abi=softfp -mfpu=vfpv3-d16 -mthumb -Wa,--noexecstack -Wformat -Werror=format-security -fno-exceptions -fno-rtti -std=c++11 -frtti -fexceptions -Wl,--allow-multiple-definition -Wl,--whole-archive -Os -DNDEBUG -Os -DNDEBUG  -Wl,--build-id -Wl,--warn-shared-textrel -Wl,--fatal-warnings -Wl,--fix-cortex-a8 -Wl,--no-undefined -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,now -Wl,--build-id -Wl,--warn-shared-textrel -Wl,--fatal-warnings -Wl,--fix-cortex-a8 -Wl,--no-undefined -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,now -shared -Wl,-soname,libnative-lib.so -o ../../../../build/intermediates/cmake/debug/obj/armeabi-v7a/libnative-lib.so CMakeFiles/native-lib.dir/src/main/cpp/native-lib.cpp.o  -llog /home/yuanhao/Android/tf/libtensorflow-core.a /home/yuanhao/Android/tf/libprotobuf.a -lm \"/home/yuanhao/Android/android-ndk-r12b/sources/cxx-stl/gnu-libstdc++/4.9/libs/armeabi-v7a/libgnustl_static.a\" && :\n/home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::GzipInputStream::~GzipInputStream(): error: undefined reference to 'inflateEnd'\n/home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::internalInflateInit2(z_stream_s*, google::protobuf::io::GzipInputStream::Format): error: undefined reference to 'inflateInit2_'\n/home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::GzipInputStream::Inflate(int): error: undefined reference to 'inflate'\n/home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::GzipInputStream::Next(void const**, int*): error: undefined reference to 'inflateEnd'\n/home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::GzipOutputStream::Init(google::protobuf::io::ZeroCopyOutputStream*, google::protobuf::io::GzipOutputStream::Options const&): error: undefined reference to 'deflateInit2_'\n/home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::GzipOutputStream::Deflate(int): error: undefined reference to 'deflate'\n/home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::GzipOutputStream::Close(): error: undefined reference to 'deflateEnd'\ncollect2: error: ld returned 1 exit status\nninja: build stopped: subcommand failed.", "body": "i also try it on Ubuntu 14.0.4. use bazel 0.5.4 and NDK r12b to compile static library .\r\nthen i create an Android application link compiled librayies.\r\n my native method like this:\r\n\r\ntensorflow::GraphDef graphDef;\r\n    tensorflow::string path = \"sdcard/frozen_inference_graph.pb\";\r\n\r\n    tensorflow::Status status = ReadBinaryProto(tensorflow::Env::Default(), path, &graphDef);\r\n    if(!status.ok()) {\r\n        return env->NewStringUTF(\"not found graph\");\r\n    }\r\n\r\n    std::unique_ptr<tensorflow::Session> session;\r\n\r\n    (&session)->reset(tensorflow::NewSession(tensorflow::SessionOptions()));\r\n\r\n    status = session->Create(graphDef);\r\n\r\n    if(!status.ok()) {\r\n        return env->NewStringUTF(\"create session error\");\r\n    }\r\n\r\nand CMakeLists.txt\r\n\r\ncmake_minimum_required(VERSION 3.4.1)\r\n\r\nset( CMAKE_BUILD_TYPE  \"Release\")\r\n\r\nset( CMAKE_CXX_FLAGS  \"${CMAKE_CXX_FLAGS} -Wl,--allow-multiple-definition -Wl,--whole-archive\")\r\n\r\nset( tf_include  /home/yuanhao/Android/tf/tf)\r\n\r\ninclude_directories( ${tf_include})\r\n\r\n\r\nadd_library( pb  STATIC  IMPORTED )\r\nset_target_properties( pb  PROPERTIES  IMPORTED_LOCATION  /home/yuanhao/Android/tf/libprotobuf.a)\r\n\r\nadd_library( tf  STATIC  IMPORTED )\r\nset_target_properties( tf  PROPERTIES  IMPORTED_LOCATION  /home/yuanhao/Android/tf/libtensorflow-core.a)\r\n\r\nfile( GLOB  src  \"src/main/cpp/*.cpp\")\r\n\r\nadd_library( native-lib  SHARED  ${src} )\r\n\r\n\r\ntarget_link_libraries( native-lib  log  tf  pb )\r\n\r\nwhen i build my application, errors \r\n\r\n Build command failed.\r\n  Error while executing process /home/yuanhao/Android/Sdk/cmake/3.6.4111459/bin/cmake with arguments {--build /home/yuanhao/AndroidStudioProjects/Test/app/.externalNativeBuild/cmake/debug/armeabi-v7a --target native-lib}\r\n  [1/2] Building CXX object CMakeFiles/native-lib.dir/src/main/cpp/native-lib.cpp.o\r\n  [2/2] Linking CXX shared library ../../../../build/intermediates/cmake/debug/obj/armeabi-v7a/libnative-lib.so\r\n  FAILED: : && /home/yuanhao/Android/android-ndk-r12b/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin/arm-linux-androideabi-g++  --sysroot=/home/yuanhao/Android/android-ndk-r12b/platforms/android-21/arch-arm -fPIC -g -DANDROID -ffunction-sections -funwind-tables -fstack-protector-strong -no-canonical-prefixes -march=armv7-a -mfloat-abi=softfp -mfpu=vfpv3-d16 -mthumb -Wa,--noexecstack -Wformat -Werror=format-security -fno-exceptions -fno-rtti -g -DANDROID -ffunction-sections -funwind-tables -fstack-protector-strong -no-canonical-prefixes -march=armv7-a -mfloat-abi=softfp -mfpu=vfpv3-d16 -mthumb -Wa,--noexecstack -Wformat -Werror=format-security -fno-exceptions -fno-rtti -std=c++11 -frtti -fexceptions -Wl,--allow-multiple-definition -Wl,--whole-archive -Os -DNDEBUG -Os -DNDEBUG  -Wl,--build-id -Wl,--warn-shared-textrel -Wl,--fatal-warnings -Wl,--fix-cortex-a8 -Wl,--no-undefined -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,now -Wl,--build-id -Wl,--warn-shared-textrel -Wl,--fatal-warnings -Wl,--fix-cortex-a8 -Wl,--no-undefined -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,now -shared -Wl,-soname,libnative-lib.so -o ../../../../build/intermediates/cmake/debug/obj/armeabi-v7a/libnative-lib.so CMakeFiles/native-lib.dir/src/main/cpp/native-lib.cpp.o  -llog /home/yuanhao/Android/tf/libtensorflow-core.a /home/yuanhao/Android/tf/libprotobuf.a -lm \"/home/yuanhao/Android/android-ndk-r12b/sources/cxx-stl/gnu-libstdc++/4.9/libs/armeabi-v7a/libgnustl_static.a\" && :\r\n  /home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::GzipInputStream::~GzipInputStream(): error: undefined reference to 'inflateEnd'\r\n  /home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::internalInflateInit2(z_stream_s*, google::protobuf::io::GzipInputStream::Format): error: undefined reference to 'inflateInit2_'\r\n  /home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::GzipInputStream::Inflate(int): error: undefined reference to 'inflate'\r\n  /home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::GzipInputStream::Next(void const**, int*): error: undefined reference to 'inflateEnd'\r\n  /home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::GzipOutputStream::Init(google::protobuf::io::ZeroCopyOutputStream*, google::protobuf::io::GzipOutputStream::Options const&): error: undefined reference to 'deflateInit2_'\r\n  /home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::GzipOutputStream::Deflate(int): error: undefined reference to 'deflate'\r\n  /home/yuanhao/Android/tf/libprotobuf.a(gzip_stream.o):gzip_stream.cc:function google::protobuf::io::GzipOutputStream::Close(): error: undefined reference to 'deflateEnd'\r\n  collect2: error: ld returned 1 exit status\r\n  ninja: build stopped: subcommand failed."}