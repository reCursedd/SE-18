{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8731", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8731/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8731/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8731/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/8731", "id": 217086688, "node_id": "MDU6SXNzdWUyMTcwODY2ODg=", "number": 8731, "title": "Error from 'bazel build' after r1.1.0: TensorFlow is not configured to build with GPU support", "user": {"login": "mckinziebrandon", "id": 11165945, "node_id": "MDQ6VXNlcjExMTY1OTQ1", "avatar_url": "https://avatars2.githubusercontent.com/u/11165945?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mckinziebrandon", "html_url": "https://github.com/mckinziebrandon", "followers_url": "https://api.github.com/users/mckinziebrandon/followers", "following_url": "https://api.github.com/users/mckinziebrandon/following{/other_user}", "gists_url": "https://api.github.com/users/mckinziebrandon/gists{/gist_id}", "starred_url": "https://api.github.com/users/mckinziebrandon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mckinziebrandon/subscriptions", "organizations_url": "https://api.github.com/users/mckinziebrandon/orgs", "repos_url": "https://api.github.com/users/mckinziebrandon/repos", "events_url": "https://api.github.com/users/mckinziebrandon/events{/privacy}", "received_events_url": "https://api.github.com/users/mckinziebrandon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "gunan", "id": 7946809, "node_id": "MDQ6VXNlcjc5NDY4MDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/7946809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gunan", "html_url": "https://github.com/gunan", "followers_url": "https://api.github.com/users/gunan/followers", "following_url": "https://api.github.com/users/gunan/following{/other_user}", "gists_url": "https://api.github.com/users/gunan/gists{/gist_id}", "starred_url": "https://api.github.com/users/gunan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gunan/subscriptions", "organizations_url": "https://api.github.com/users/gunan/orgs", "repos_url": "https://api.github.com/users/gunan/repos", "events_url": "https://api.github.com/users/gunan/events{/privacy}", "received_events_url": "https://api.github.com/users/gunan/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "gunan", "id": 7946809, "node_id": "MDQ6VXNlcjc5NDY4MDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/7946809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gunan", "html_url": "https://github.com/gunan", "followers_url": "https://api.github.com/users/gunan/followers", "following_url": "https://api.github.com/users/gunan/following{/other_user}", "gists_url": "https://api.github.com/users/gunan/gists{/gist_id}", "starred_url": "https://api.github.com/users/gunan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gunan/subscriptions", "organizations_url": "https://api.github.com/users/gunan/orgs", "repos_url": "https://api.github.com/users/gunan/repos", "events_url": "https://api.github.com/users/gunan/events{/privacy}", "received_events_url": "https://api.github.com/users/gunan/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2017-03-26T20:30:52Z", "updated_at": "2017-06-16T21:12:45Z", "closed_at": "2017-06-16T21:12:45Z", "author_association": "NONE", "body_html": "<h3>Environment info</h3>\n<p>Operating System: Ubuntu Desktop 16.04</p>\n<p>Installed version of CUDA and cuDNN:  8.0, 5<br>\n(please attach the output of <code>ls -l /path/to/cuda/lib/libcud*</code>):</p>\n<pre><code>lrwxrwxrwx 1 root root       19 Sep 14  2016 /usr/local/cuda/lib64/libcudart.so.8.0 -&gt; libcudart.so.8.0.44\n-rw-r--r-- 1 root root   415432 Sep 14  2016 /usr/local/cuda/lib64/libcudart.so.8.0.44\n-rwxr-xr-x 1 root root 79337624 Jan 20 18:48 /usr/local/cuda/lib64/libcudnn.so.5\n-rwxr-xr-x 1 root root 79337624 Jan 20 18:48 /usr/local/cuda/lib64/libcudnn.so.5.1.5\n-rw-r--r-- 1 root root   558720 Sep 14  2016 /usr/local/cuda/lib64/libcudadevrt.a\n-rw-r--r-- 1 root root   775162 Sep 14  2016 /usr/local/cuda/lib64/libcudart_static.a\n-rw-r--r-- 1 root root 69756172 Jan 20 18:48 /usr/local/cuda/lib64/libcudnn_static.a\nlrwxrwxrwx 1 root root       16 Sep 14  2016 /usr/local/cuda/lib64/libcudart.so -&gt; libcudart.so.8.0\n-rwxr-xr-x 1 root root 79337624 Jan 20 18:48 /usr/local/cuda/lib64/libcudnn.so\n</code></pre>\n<p>If installed from source, provide</p>\n<ol>\n<li>\n<p>The commit hash (<code>git rev-parse HEAD</code>):<br>\n<a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/bbe056e5a0ab81b67fcb6053400812b3d5805fc7/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/bbe056e5a0ab81b67fcb6053400812b3d5805fc7\"><tt>bbe056e</tt></a> (master branch)</p>\n</li>\n<li>\n<p>The output of <code>bazel version</code>:</p>\n</li>\n</ol>\n<pre><code>Build label: 0.4.5\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Thu Mar 16 12:19:38 2017 (1489666778)\nBuild timestamp: 1489666778\nBuild timestamp as int: 1489666778\n</code></pre>\n<hr>\n<h3>If possible, provide a minimal reproducible example.</h3>\n<ul>\n<li><strong>Summary</strong>: bazel build says TensorFlow is not configured with GPU support even though ./configure confirmed CUDA support will be enabled. Main error output seems to be (full error shown further down):</li>\n</ul>\n<pre><code>ERROR: Building with --config=cuda but TensorFlow is not configured to build with GPU support. \n</code></pre>\n<p>Please note that I've done this many times so (hopefully) I don't think I'm overlooking some common mistake on my end. Details below.</p>\n<ul>\n<li><strong>./configure info</strong>: Here are the non-default (i.e. not just hitting enter) configuration flags I give to ./configure and its corresponding outputs:</li>\n</ul>\n<pre><code>./configure \nPlease specify the location of python. [Default is /usr/bin/python]: /usr/bin/python3\nDo you wish to use jemalloc as the malloc implementation? [Y/n] \njemalloc enabled\nDo you wish to build TensorFlow with the XLA just-in-time compiler (experimental)? [y/N] y\nXLA JIT support will be enabled for TensorFlow\nFound possible Python library paths:\n  /usr/local/lib/python3.5/dist-packages\n  /usr/lib/python3/dist-packages\n  /home/brandon/bin/caffe/python\n  /usr/local/boost_1_63_0\nUsing python library path: /usr/local/lib/python3.5/dist-packages\nDo you wish to build TensorFlow with CUDA support? [y/N] y\nCUDA support will be enabled for TensorFlow\nPlease specify the CUDA SDK version you want to use, e.g. 7.0. [Leave empty to use system default]: 8.0\nPlease specify the cuDNN version you want to use. [Leave empty to use system default]: 5\nPlease specify a list of comma-separated Cuda compute capabilities you want to build with: 6.1 \n</code></pre>\n<ul>\n<li><strong>Error from bazel build</strong>: Then I run bazel build as follows with the error message below.</li>\n</ul>\n<pre><code> bazel build --config=opt --config=cuda --local_resources 8192,4.0,1.0 //tensorflow/tools/pip_package:build_pip_package\nERROR: /home/brandon/.cache/bazel/_bazel_brandon/9d57692c8667febd112ef76b5ba08968/external/local_config_cuda/crosstool/BUILD:4:1: Traceback (most recent call last):\n\tFile \"/home/brandon/.cache/bazel/_bazel_brandon/9d57692c8667febd112ef76b5ba08968/external/local_config_cuda/crosstool/BUILD\", line 4\n\t\terror_gpu_disabled()\n\tFile \"/home/brandon/.cache/bazel/_bazel_brandon/9d57692c8667febd112ef76b5ba08968/external/local_config_cuda/crosstool/error_gpu_disabled.bzl\", line 3, in error_gpu_disabled\n\t\tfail(\"ERROR: Building with --config=c...\")\nERROR: Building with --config=cuda but TensorFlow is not configured to build with GPU support. Please re-run ./configure and enter 'Y' at the prompt to build with GPU support.\nERROR: no such target '@local_config_cuda//crosstool:toolchain': target 'toolchain' not declared in package 'crosstool' defined by /home/brandon/.cache/bazel/_bazel_brandon/9d57692c8667febd112ef76b5ba08968/external/local_config_cuda/crosstool/BUILD.\nINFO: Elapsed time: 0.199s\n</code></pre>\n<hr>\n<p>I'm running a GTX 1080. If it's useful as a sanity-check, I've included a portion of nvidia-smi below:</p>\n<pre><code>+-----------------------------------------------------------------------------+\n| NVIDIA-SMI 375.39                 Driver Version: 375.39                    |\n|-------------------------------+----------------------+----------------------+\n| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n|===============================+======================+======================|\n|   0  GeForce GTX 1080    Off  | 0000:01:00.0      On |                  N/A |\n|  0%   45C    P8    17W / 240W |    347MiB /  8110MiB |      0%      Default |\n+-------------------------------+----------------------+----------------------+\n</code></pre>\n<p>Any idea why bazel thinks TF configured without GPU support? Also, I should note that ./configure did not run initially, but then I ran ``sudo apt-get upgrade bazel``` and that fixed the issue.  <strong>My best guess is this is related to ./configure not playing nice with the new bazel upgrade</strong> or something similar. This was the first time I've had to upgrade bazel in awhile just to run ./configure. Thanks for any help/suggestions.</p>", "body_text": "Environment info\nOperating System: Ubuntu Desktop 16.04\nInstalled version of CUDA and cuDNN:  8.0, 5\n(please attach the output of ls -l /path/to/cuda/lib/libcud*):\nlrwxrwxrwx 1 root root       19 Sep 14  2016 /usr/local/cuda/lib64/libcudart.so.8.0 -> libcudart.so.8.0.44\n-rw-r--r-- 1 root root   415432 Sep 14  2016 /usr/local/cuda/lib64/libcudart.so.8.0.44\n-rwxr-xr-x 1 root root 79337624 Jan 20 18:48 /usr/local/cuda/lib64/libcudnn.so.5\n-rwxr-xr-x 1 root root 79337624 Jan 20 18:48 /usr/local/cuda/lib64/libcudnn.so.5.1.5\n-rw-r--r-- 1 root root   558720 Sep 14  2016 /usr/local/cuda/lib64/libcudadevrt.a\n-rw-r--r-- 1 root root   775162 Sep 14  2016 /usr/local/cuda/lib64/libcudart_static.a\n-rw-r--r-- 1 root root 69756172 Jan 20 18:48 /usr/local/cuda/lib64/libcudnn_static.a\nlrwxrwxrwx 1 root root       16 Sep 14  2016 /usr/local/cuda/lib64/libcudart.so -> libcudart.so.8.0\n-rwxr-xr-x 1 root root 79337624 Jan 20 18:48 /usr/local/cuda/lib64/libcudnn.so\n\nIf installed from source, provide\n\n\nThe commit hash (git rev-parse HEAD):\nbbe056e (master branch)\n\n\nThe output of bazel version:\n\n\nBuild label: 0.4.5\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Thu Mar 16 12:19:38 2017 (1489666778)\nBuild timestamp: 1489666778\nBuild timestamp as int: 1489666778\n\n\nIf possible, provide a minimal reproducible example.\n\nSummary: bazel build says TensorFlow is not configured with GPU support even though ./configure confirmed CUDA support will be enabled. Main error output seems to be (full error shown further down):\n\nERROR: Building with --config=cuda but TensorFlow is not configured to build with GPU support. \n\nPlease note that I've done this many times so (hopefully) I don't think I'm overlooking some common mistake on my end. Details below.\n\n./configure info: Here are the non-default (i.e. not just hitting enter) configuration flags I give to ./configure and its corresponding outputs:\n\n./configure \nPlease specify the location of python. [Default is /usr/bin/python]: /usr/bin/python3\nDo you wish to use jemalloc as the malloc implementation? [Y/n] \njemalloc enabled\nDo you wish to build TensorFlow with the XLA just-in-time compiler (experimental)? [y/N] y\nXLA JIT support will be enabled for TensorFlow\nFound possible Python library paths:\n  /usr/local/lib/python3.5/dist-packages\n  /usr/lib/python3/dist-packages\n  /home/brandon/bin/caffe/python\n  /usr/local/boost_1_63_0\nUsing python library path: /usr/local/lib/python3.5/dist-packages\nDo you wish to build TensorFlow with CUDA support? [y/N] y\nCUDA support will be enabled for TensorFlow\nPlease specify the CUDA SDK version you want to use, e.g. 7.0. [Leave empty to use system default]: 8.0\nPlease specify the cuDNN version you want to use. [Leave empty to use system default]: 5\nPlease specify a list of comma-separated Cuda compute capabilities you want to build with: 6.1 \n\n\nError from bazel build: Then I run bazel build as follows with the error message below.\n\n bazel build --config=opt --config=cuda --local_resources 8192,4.0,1.0 //tensorflow/tools/pip_package:build_pip_package\nERROR: /home/brandon/.cache/bazel/_bazel_brandon/9d57692c8667febd112ef76b5ba08968/external/local_config_cuda/crosstool/BUILD:4:1: Traceback (most recent call last):\n\tFile \"/home/brandon/.cache/bazel/_bazel_brandon/9d57692c8667febd112ef76b5ba08968/external/local_config_cuda/crosstool/BUILD\", line 4\n\t\terror_gpu_disabled()\n\tFile \"/home/brandon/.cache/bazel/_bazel_brandon/9d57692c8667febd112ef76b5ba08968/external/local_config_cuda/crosstool/error_gpu_disabled.bzl\", line 3, in error_gpu_disabled\n\t\tfail(\"ERROR: Building with --config=c...\")\nERROR: Building with --config=cuda but TensorFlow is not configured to build with GPU support. Please re-run ./configure and enter 'Y' at the prompt to build with GPU support.\nERROR: no such target '@local_config_cuda//crosstool:toolchain': target 'toolchain' not declared in package 'crosstool' defined by /home/brandon/.cache/bazel/_bazel_brandon/9d57692c8667febd112ef76b5ba08968/external/local_config_cuda/crosstool/BUILD.\nINFO: Elapsed time: 0.199s\n\n\nI'm running a GTX 1080. If it's useful as a sanity-check, I've included a portion of nvidia-smi below:\n+-----------------------------------------------------------------------------+\n| NVIDIA-SMI 375.39                 Driver Version: 375.39                    |\n|-------------------------------+----------------------+----------------------+\n| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n|===============================+======================+======================|\n|   0  GeForce GTX 1080    Off  | 0000:01:00.0      On |                  N/A |\n|  0%   45C    P8    17W / 240W |    347MiB /  8110MiB |      0%      Default |\n+-------------------------------+----------------------+----------------------+\n\nAny idea why bazel thinks TF configured without GPU support? Also, I should note that ./configure did not run initially, but then I ran ``sudo apt-get upgrade bazel``` and that fixed the issue.  My best guess is this is related to ./configure not playing nice with the new bazel upgrade or something similar. This was the first time I've had to upgrade bazel in awhile just to run ./configure. Thanks for any help/suggestions.", "body": "### Environment info\r\nOperating System: Ubuntu Desktop 16.04\r\n\r\nInstalled version of CUDA and cuDNN:  8.0, 5\r\n(please attach the output of `ls -l /path/to/cuda/lib/libcud*`):\r\n\r\n```\r\nlrwxrwxrwx 1 root root       19 Sep 14  2016 /usr/local/cuda/lib64/libcudart.so.8.0 -> libcudart.so.8.0.44\r\n-rw-r--r-- 1 root root   415432 Sep 14  2016 /usr/local/cuda/lib64/libcudart.so.8.0.44\r\n-rwxr-xr-x 1 root root 79337624 Jan 20 18:48 /usr/local/cuda/lib64/libcudnn.so.5\r\n-rwxr-xr-x 1 root root 79337624 Jan 20 18:48 /usr/local/cuda/lib64/libcudnn.so.5.1.5\r\n-rw-r--r-- 1 root root   558720 Sep 14  2016 /usr/local/cuda/lib64/libcudadevrt.a\r\n-rw-r--r-- 1 root root   775162 Sep 14  2016 /usr/local/cuda/lib64/libcudart_static.a\r\n-rw-r--r-- 1 root root 69756172 Jan 20 18:48 /usr/local/cuda/lib64/libcudnn_static.a\r\nlrwxrwxrwx 1 root root       16 Sep 14  2016 /usr/local/cuda/lib64/libcudart.so -> libcudart.so.8.0\r\n-rwxr-xr-x 1 root root 79337624 Jan 20 18:48 /usr/local/cuda/lib64/libcudnn.so\r\n```\r\nIf installed from source, provide \r\n\r\n1. The commit hash (`git rev-parse HEAD`): \r\nbbe056e5a0ab81b67fcb6053400812b3d5805fc7 (master branch)\r\n\r\n2. The output of `bazel version`:\r\n\r\n```\r\nBuild label: 0.4.5\r\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\r\nBuild time: Thu Mar 16 12:19:38 2017 (1489666778)\r\nBuild timestamp: 1489666778\r\nBuild timestamp as int: 1489666778\r\n```\r\n\r\n----------------------------------------------------------------------\r\n\r\n### If possible, provide a minimal reproducible example. \r\n\r\n\r\n* __Summary__: bazel build says TensorFlow is not configured with GPU support even though ./configure confirmed CUDA support will be enabled. Main error output seems to be (full error shown further down):\r\n```\r\nERROR: Building with --config=cuda but TensorFlow is not configured to build with GPU support. \r\n```\r\nPlease note that I've done this many times so (hopefully) I don't think I'm overlooking some common mistake on my end. Details below.\r\n\r\n* __./configure info__: Here are the non-default (i.e. not just hitting enter) configuration flags I give to ./configure and its corresponding outputs:\r\n\r\n```\r\n./configure \r\nPlease specify the location of python. [Default is /usr/bin/python]: /usr/bin/python3\r\nDo you wish to use jemalloc as the malloc implementation? [Y/n] \r\njemalloc enabled\r\nDo you wish to build TensorFlow with the XLA just-in-time compiler (experimental)? [y/N] y\r\nXLA JIT support will be enabled for TensorFlow\r\nFound possible Python library paths:\r\n  /usr/local/lib/python3.5/dist-packages\r\n  /usr/lib/python3/dist-packages\r\n  /home/brandon/bin/caffe/python\r\n  /usr/local/boost_1_63_0\r\nUsing python library path: /usr/local/lib/python3.5/dist-packages\r\nDo you wish to build TensorFlow with CUDA support? [y/N] y\r\nCUDA support will be enabled for TensorFlow\r\nPlease specify the CUDA SDK version you want to use, e.g. 7.0. [Leave empty to use system default]: 8.0\r\nPlease specify the cuDNN version you want to use. [Leave empty to use system default]: 5\r\nPlease specify a list of comma-separated Cuda compute capabilities you want to build with: 6.1 \r\n```\r\n\r\n* __Error from bazel build__: Then I run bazel build as follows with the error message below. \r\n\r\n```\r\n bazel build --config=opt --config=cuda --local_resources 8192,4.0,1.0 //tensorflow/tools/pip_package:build_pip_package\r\nERROR: /home/brandon/.cache/bazel/_bazel_brandon/9d57692c8667febd112ef76b5ba08968/external/local_config_cuda/crosstool/BUILD:4:1: Traceback (most recent call last):\r\n\tFile \"/home/brandon/.cache/bazel/_bazel_brandon/9d57692c8667febd112ef76b5ba08968/external/local_config_cuda/crosstool/BUILD\", line 4\r\n\t\terror_gpu_disabled()\r\n\tFile \"/home/brandon/.cache/bazel/_bazel_brandon/9d57692c8667febd112ef76b5ba08968/external/local_config_cuda/crosstool/error_gpu_disabled.bzl\", line 3, in error_gpu_disabled\r\n\t\tfail(\"ERROR: Building with --config=c...\")\r\nERROR: Building with --config=cuda but TensorFlow is not configured to build with GPU support. Please re-run ./configure and enter 'Y' at the prompt to build with GPU support.\r\nERROR: no such target '@local_config_cuda//crosstool:toolchain': target 'toolchain' not declared in package 'crosstool' defined by /home/brandon/.cache/bazel/_bazel_brandon/9d57692c8667febd112ef76b5ba08968/external/local_config_cuda/crosstool/BUILD.\r\nINFO: Elapsed time: 0.199s\r\n```\r\n\r\n-------------------------------------------------------------------------------\r\n\r\nI'm running a GTX 1080. If it's useful as a sanity-check, I've included a portion of nvidia-smi below:\r\n```\r\n+-----------------------------------------------------------------------------+\r\n| NVIDIA-SMI 375.39                 Driver Version: 375.39                    |\r\n|-------------------------------+----------------------+----------------------+\r\n| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\r\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\r\n|===============================+======================+======================|\r\n|   0  GeForce GTX 1080    Off  | 0000:01:00.0      On |                  N/A |\r\n|  0%   45C    P8    17W / 240W |    347MiB /  8110MiB |      0%      Default |\r\n+-------------------------------+----------------------+----------------------+\r\n```\r\n\r\nAny idea why bazel thinks TF configured without GPU support? Also, I should note that ./configure did not run initially, but then I ran ``sudo apt-get upgrade bazel``` and that fixed the issue.  __My best guess is this is related to ./configure not playing nice with the new bazel upgrade__ or something similar. This was the first time I've had to upgrade bazel in awhile just to run ./configure. Thanks for any help/suggestions. "}