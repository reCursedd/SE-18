{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2508", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2508/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2508/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2508/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/2508", "id": 156843662, "node_id": "MDU6SXNzdWUxNTY4NDM2NjI=", "number": 2508, "title": "Can't place tf.nn.moments() on GPU ", "user": {"login": "thouis", "id": 473043, "node_id": "MDQ6VXNlcjQ3MzA0Mw==", "avatar_url": "https://avatars1.githubusercontent.com/u/473043?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thouis", "html_url": "https://github.com/thouis", "followers_url": "https://api.github.com/users/thouis/followers", "following_url": "https://api.github.com/users/thouis/following{/other_user}", "gists_url": "https://api.github.com/users/thouis/gists{/gist_id}", "starred_url": "https://api.github.com/users/thouis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thouis/subscriptions", "organizations_url": "https://api.github.com/users/thouis/orgs", "repos_url": "https://api.github.com/users/thouis/repos", "events_url": "https://api.github.com/users/thouis/events{/privacy}", "received_events_url": "https://api.github.com/users/thouis/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-05-25T20:32:41Z", "updated_at": "2016-05-26T18:52:00Z", "closed_at": "2016-05-26T18:52:00Z", "author_association": "NONE", "body_html": "<p>While trying to optimize training of a network by moving most work to the GPU, I encountered the following error below.  Although this references a variable defined in the batch_normalization helper class I've used, removing that class (replacing all calls to it with an identify function) results in a similar error elsewhere.</p>\n<pre><code>Traceback (most recent call last):\n  File \"train_resnet.py\", line 106, in &lt;module&gt;\n    tf.app.run()\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv))\n  File \"train_resnet.py\", line 103, in main\n    run_training()\n  File \"train_resnet.py\", line 97, in run_training\n    sess.run(tf.initialize_all_variables())\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 333, in run\n    run_metadata_ptr)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 573, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 648, in _do_run\n    target_list, options, run_metadata)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 668, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors.InvalidArgumentError: Cannot assign a device to node 'gradients/resnet_module_1/bn/moments/moments/mean_ss_grad/Maximum/y': Could not satisfy explicit device specification '/device:GPU:0' because no supported kernel for GPU devices is available\n         [[Node: gradients/resnet_module_1/bn/moments/moments/mean_ss_grad/Maximum/y = Const[_class=[\"loc:@resnet_module_1/bn/moments/moments/mean_ss\"], dtype=DT_INT32, value=Tensor&lt;type: int32 shape: [] values: 1&gt;, _device=\"/device:GPU:0\"]()]]\nCaused by op 'gradients/resnet_module_1/bn/moments/moments/mean_ss_grad/Maximum/y', defined at:\n  File \"train_resnet.py\", line 106, in &lt;module&gt;\n    tf.app.run()\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv))\n  File \"train_resnet.py\", line 103, in main\n    run_training()\n  File \"train_resnet.py\", line 89, in run_training\n    train_op = opt.minimize(loss, colocate_gradients_with_ops=True, aggregation_method=2)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 193, in minimize\n    grad_loss=grad_loss)\n  File \"/data/Ray/policy_network/gpu/clipopt.py\", line 9, in compute_gradients\n    *args, **kwargs)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 250, in compute_gradients\n    colocate_gradients_with_ops=colocate_gradients_with_ops)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/gradients.py\", line 481, in gradients\n    in_grads = _AsList(grad_fn(op, *out_grads))\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/math_grad.py\", line 41, in _SumGrad\n    tile_scaling = _safe_shape_div(input_shape, output_shape_kept_dims)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/math_grad.py\", line 33, in _safe_shape_div\n    return x // math_ops.maximum(y, 1)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 1173, in maximum\n    result = _op_def_lib.apply_op(\"Maximum\", x=x, y=y, name=name)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/op_def_library.py\", line 455, in apply_op\n    as_ref=input_arg.is_ref)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 620, in convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/constant_op.py\", line 179, in _constant_tensor_conversion_function\n    return constant(v, dtype=dtype, name=name)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/constant_op.py\", line 166, in constant\n    attrs={\"value\": tensor_value, \"dtype\": dtype_value}, name=name).outputs[0]\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2240, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1224, in __init__\n    self._traceback = _extract_stack()\n\n...which was originally created as op 'resnet_module_1/bn/moments/moments/mean_ss', defined at:\n  File \"train_resnet.py\", line 106, in &lt;module&gt;\n    tf.app.run()\n[elided 1 identical lines from previous traceback]\n  File \"train_resnet.py\", line 103, in main\n    run_training()\n  File \"train_resnet.py\", line 77, in run_training\n    depth=FLAGS.num_features)\n  File \"train_resnet.py\", line 45, in model\n    model = res_3x3_pair(model, depth, \"resnet_module_{}\".format(idx + 1), training_switch, keep_prob_var)\n  File \"train_resnet.py\", line 29, in res_3x3_pair\n    normed = tf.nn.relu(batch_norm(data, depth, training_switch))\n  File \"/data/Ray/policy_network/gpu/batchnorm.py\", line 22, in batch_norm\n    batch_mean, batch_var = tf.nn.moments(x, [0, 1, 2], name='moments')\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/nn.py\", line 712, in moments\n    name=name)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/nn.py\", line 649, in sufficient_statistics\n    m_ss = math_ops.reduce_sum(m_ss, axes, keep_dims=keep_dims, name=\"mean_ss\")\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/math_ops.py\", line 909, in reduce_sum\n    keep_dims, name=name)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 2087, in _sum\n    keep_dims=keep_dims, name=name)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/op_def_library.py\", line 704, in apply_op\n    op_def=op_def)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2240, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1224, in __init__\n    self._traceback = _extract_stack()\n</code></pre>\n<h3>Environment info</h3>\n<p>Operating System: Ubuntu 16.06</p>\n<p>Installed version of CUDA and cuDNN:</p>\n<pre><code>-rw-r--r-- 1 root root 189170 May 24 11:22 /usr/local/cuda/lib/libcudadevrt.a\nlrwxrwxrwx 1 root root     16 May 24 11:22 /usr/local/cuda/lib/libcudart.so -&gt; libcudart.so.7.5\nlrwxrwxrwx 1 root root     19 May 24 11:22 /usr/local/cuda/lib/libcudart.so.7.5 -&gt; libcudart.so.7.5.18\n-rwxr-xr-x 1 root root 311596 May 24 11:22 /usr/local/cuda/lib/libcudart.so.7.5.18\n-rw-r--r-- 1 root root 558020 May 24 11:22 /usr/local/cuda/lib/libcudart_static.a\n</code></pre>\n<p>If installed from binary pip package, provide:</p>\n<p>pip installed from May 25 nightly build of Linux GPU version.</p>\n<pre><code>python -c \"import tensorflow; print(tensorflow.__version__)\"\n0.8.0\n</code></pre>\n<h3>Steps to reproduce</h3>\n<ul>\n<li>grab python files from <a href=\"https://gist.github.com/thouis/9bbd330a153b1f553fd58743a3ae4c9a\">https://gist.github.com/thouis/9bbd330a153b1f553fd58743a3ae4c9a</a></li>\n<li><code>python -u -i train_resnet.py --learning_rate 0.005  --num_modules 16 --num_features 192 --summary_dir Workspace --checkpoint_dir Workspace --batch_size 64</code></li>\n</ul>\n<h3>What have you tried?</h3>\n<ol>\n<li>I tried to cast the values in _safe_shape_div() to int64 in case that was the underlying cause, but that seemed to cause different problems.</li>\n</ol>\n<h3>Logs or other output that would be helpful</h3>\n<p>All files (python, run log) at:<br>\n<a href=\"https://gist.github.com/thouis/9bbd330a153b1f553fd58743a3ae4c9a\">https://gist.github.com/thouis/9bbd330a153b1f553fd58743a3ae4c9a</a></p>", "body_text": "While trying to optimize training of a network by moving most work to the GPU, I encountered the following error below.  Although this references a variable defined in the batch_normalization helper class I've used, removing that class (replacing all calls to it with an identify function) results in a similar error elsewhere.\nTraceback (most recent call last):\n  File \"train_resnet.py\", line 106, in <module>\n    tf.app.run()\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv))\n  File \"train_resnet.py\", line 103, in main\n    run_training()\n  File \"train_resnet.py\", line 97, in run_training\n    sess.run(tf.initialize_all_variables())\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 333, in run\n    run_metadata_ptr)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 573, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 648, in _do_run\n    target_list, options, run_metadata)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 668, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors.InvalidArgumentError: Cannot assign a device to node 'gradients/resnet_module_1/bn/moments/moments/mean_ss_grad/Maximum/y': Could not satisfy explicit device specification '/device:GPU:0' because no supported kernel for GPU devices is available\n         [[Node: gradients/resnet_module_1/bn/moments/moments/mean_ss_grad/Maximum/y = Const[_class=[\"loc:@resnet_module_1/bn/moments/moments/mean_ss\"], dtype=DT_INT32, value=Tensor<type: int32 shape: [] values: 1>, _device=\"/device:GPU:0\"]()]]\nCaused by op 'gradients/resnet_module_1/bn/moments/moments/mean_ss_grad/Maximum/y', defined at:\n  File \"train_resnet.py\", line 106, in <module>\n    tf.app.run()\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv))\n  File \"train_resnet.py\", line 103, in main\n    run_training()\n  File \"train_resnet.py\", line 89, in run_training\n    train_op = opt.minimize(loss, colocate_gradients_with_ops=True, aggregation_method=2)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 193, in minimize\n    grad_loss=grad_loss)\n  File \"/data/Ray/policy_network/gpu/clipopt.py\", line 9, in compute_gradients\n    *args, **kwargs)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 250, in compute_gradients\n    colocate_gradients_with_ops=colocate_gradients_with_ops)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/gradients.py\", line 481, in gradients\n    in_grads = _AsList(grad_fn(op, *out_grads))\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/math_grad.py\", line 41, in _SumGrad\n    tile_scaling = _safe_shape_div(input_shape, output_shape_kept_dims)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/math_grad.py\", line 33, in _safe_shape_div\n    return x // math_ops.maximum(y, 1)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 1173, in maximum\n    result = _op_def_lib.apply_op(\"Maximum\", x=x, y=y, name=name)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/op_def_library.py\", line 455, in apply_op\n    as_ref=input_arg.is_ref)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 620, in convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/constant_op.py\", line 179, in _constant_tensor_conversion_function\n    return constant(v, dtype=dtype, name=name)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/constant_op.py\", line 166, in constant\n    attrs={\"value\": tensor_value, \"dtype\": dtype_value}, name=name).outputs[0]\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2240, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1224, in __init__\n    self._traceback = _extract_stack()\n\n...which was originally created as op 'resnet_module_1/bn/moments/moments/mean_ss', defined at:\n  File \"train_resnet.py\", line 106, in <module>\n    tf.app.run()\n[elided 1 identical lines from previous traceback]\n  File \"train_resnet.py\", line 103, in main\n    run_training()\n  File \"train_resnet.py\", line 77, in run_training\n    depth=FLAGS.num_features)\n  File \"train_resnet.py\", line 45, in model\n    model = res_3x3_pair(model, depth, \"resnet_module_{}\".format(idx + 1), training_switch, keep_prob_var)\n  File \"train_resnet.py\", line 29, in res_3x3_pair\n    normed = tf.nn.relu(batch_norm(data, depth, training_switch))\n  File \"/data/Ray/policy_network/gpu/batchnorm.py\", line 22, in batch_norm\n    batch_mean, batch_var = tf.nn.moments(x, [0, 1, 2], name='moments')\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/nn.py\", line 712, in moments\n    name=name)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/nn.py\", line 649, in sufficient_statistics\n    m_ss = math_ops.reduce_sum(m_ss, axes, keep_dims=keep_dims, name=\"mean_ss\")\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/math_ops.py\", line 909, in reduce_sum\n    keep_dims, name=name)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 2087, in _sum\n    keep_dims=keep_dims, name=name)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/op_def_library.py\", line 704, in apply_op\n    op_def=op_def)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2240, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1224, in __init__\n    self._traceback = _extract_stack()\n\nEnvironment info\nOperating System: Ubuntu 16.06\nInstalled version of CUDA and cuDNN:\n-rw-r--r-- 1 root root 189170 May 24 11:22 /usr/local/cuda/lib/libcudadevrt.a\nlrwxrwxrwx 1 root root     16 May 24 11:22 /usr/local/cuda/lib/libcudart.so -> libcudart.so.7.5\nlrwxrwxrwx 1 root root     19 May 24 11:22 /usr/local/cuda/lib/libcudart.so.7.5 -> libcudart.so.7.5.18\n-rwxr-xr-x 1 root root 311596 May 24 11:22 /usr/local/cuda/lib/libcudart.so.7.5.18\n-rw-r--r-- 1 root root 558020 May 24 11:22 /usr/local/cuda/lib/libcudart_static.a\n\nIf installed from binary pip package, provide:\npip installed from May 25 nightly build of Linux GPU version.\npython -c \"import tensorflow; print(tensorflow.__version__)\"\n0.8.0\n\nSteps to reproduce\n\ngrab python files from https://gist.github.com/thouis/9bbd330a153b1f553fd58743a3ae4c9a\npython -u -i train_resnet.py --learning_rate 0.005  --num_modules 16 --num_features 192 --summary_dir Workspace --checkpoint_dir Workspace --batch_size 64\n\nWhat have you tried?\n\nI tried to cast the values in _safe_shape_div() to int64 in case that was the underlying cause, but that seemed to cause different problems.\n\nLogs or other output that would be helpful\nAll files (python, run log) at:\nhttps://gist.github.com/thouis/9bbd330a153b1f553fd58743a3ae4c9a", "body": "While trying to optimize training of a network by moving most work to the GPU, I encountered the following error below.  Although this references a variable defined in the batch_normalization helper class I've used, removing that class (replacing all calls to it with an identify function) results in a similar error elsewhere.\n\n```\nTraceback (most recent call last):\n  File \"train_resnet.py\", line 106, in <module>\n    tf.app.run()\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv))\n  File \"train_resnet.py\", line 103, in main\n    run_training()\n  File \"train_resnet.py\", line 97, in run_training\n    sess.run(tf.initialize_all_variables())\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 333, in run\n    run_metadata_ptr)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 573, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 648, in _do_run\n    target_list, options, run_metadata)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 668, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors.InvalidArgumentError: Cannot assign a device to node 'gradients/resnet_module_1/bn/moments/moments/mean_ss_grad/Maximum/y': Could not satisfy explicit device specification '/device:GPU:0' because no supported kernel for GPU devices is available\n         [[Node: gradients/resnet_module_1/bn/moments/moments/mean_ss_grad/Maximum/y = Const[_class=[\"loc:@resnet_module_1/bn/moments/moments/mean_ss\"], dtype=DT_INT32, value=Tensor<type: int32 shape: [] values: 1>, _device=\"/device:GPU:0\"]()]]\nCaused by op 'gradients/resnet_module_1/bn/moments/moments/mean_ss_grad/Maximum/y', defined at:\n  File \"train_resnet.py\", line 106, in <module>\n    tf.app.run()\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv))\n  File \"train_resnet.py\", line 103, in main\n    run_training()\n  File \"train_resnet.py\", line 89, in run_training\n    train_op = opt.minimize(loss, colocate_gradients_with_ops=True, aggregation_method=2)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 193, in minimize\n    grad_loss=grad_loss)\n  File \"/data/Ray/policy_network/gpu/clipopt.py\", line 9, in compute_gradients\n    *args, **kwargs)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 250, in compute_gradients\n    colocate_gradients_with_ops=colocate_gradients_with_ops)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/gradients.py\", line 481, in gradients\n    in_grads = _AsList(grad_fn(op, *out_grads))\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/math_grad.py\", line 41, in _SumGrad\n    tile_scaling = _safe_shape_div(input_shape, output_shape_kept_dims)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/math_grad.py\", line 33, in _safe_shape_div\n    return x // math_ops.maximum(y, 1)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 1173, in maximum\n    result = _op_def_lib.apply_op(\"Maximum\", x=x, y=y, name=name)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/op_def_library.py\", line 455, in apply_op\n    as_ref=input_arg.is_ref)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 620, in convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/constant_op.py\", line 179, in _constant_tensor_conversion_function\n    return constant(v, dtype=dtype, name=name)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/constant_op.py\", line 166, in constant\n    attrs={\"value\": tensor_value, \"dtype\": dtype_value}, name=name).outputs[0]\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2240, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1224, in __init__\n    self._traceback = _extract_stack()\n\n...which was originally created as op 'resnet_module_1/bn/moments/moments/mean_ss', defined at:\n  File \"train_resnet.py\", line 106, in <module>\n    tf.app.run()\n[elided 1 identical lines from previous traceback]\n  File \"train_resnet.py\", line 103, in main\n    run_training()\n  File \"train_resnet.py\", line 77, in run_training\n    depth=FLAGS.num_features)\n  File \"train_resnet.py\", line 45, in model\n    model = res_3x3_pair(model, depth, \"resnet_module_{}\".format(idx + 1), training_switch, keep_prob_var)\n  File \"train_resnet.py\", line 29, in res_3x3_pair\n    normed = tf.nn.relu(batch_norm(data, depth, training_switch))\n  File \"/data/Ray/policy_network/gpu/batchnorm.py\", line 22, in batch_norm\n    batch_mean, batch_var = tf.nn.moments(x, [0, 1, 2], name='moments')\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/nn.py\", line 712, in moments\n    name=name)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/nn.py\", line 649, in sufficient_statistics\n    m_ss = math_ops.reduce_sum(m_ss, axes, keep_dims=keep_dims, name=\"mean_ss\")\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/math_ops.py\", line 909, in reduce_sum\n    keep_dims, name=name)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 2087, in _sum\n    keep_dims=keep_dims, name=name)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/ops/op_def_library.py\", line 704, in apply_op\n    op_def=op_def)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2240, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/thouis/VENV35/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1224, in __init__\n    self._traceback = _extract_stack()\n```\n### Environment info\n\nOperating System: Ubuntu 16.06\n\nInstalled version of CUDA and cuDNN: \n\n```\n-rw-r--r-- 1 root root 189170 May 24 11:22 /usr/local/cuda/lib/libcudadevrt.a\nlrwxrwxrwx 1 root root     16 May 24 11:22 /usr/local/cuda/lib/libcudart.so -> libcudart.so.7.5\nlrwxrwxrwx 1 root root     19 May 24 11:22 /usr/local/cuda/lib/libcudart.so.7.5 -> libcudart.so.7.5.18\n-rwxr-xr-x 1 root root 311596 May 24 11:22 /usr/local/cuda/lib/libcudart.so.7.5.18\n-rw-r--r-- 1 root root 558020 May 24 11:22 /usr/local/cuda/lib/libcudart_static.a\n```\n\nIf installed from binary pip package, provide:\n\npip installed from May 25 nightly build of Linux GPU version.\n\n```\npython -c \"import tensorflow; print(tensorflow.__version__)\"\n0.8.0\n```\n### Steps to reproduce\n- grab python files from https://gist.github.com/thouis/9bbd330a153b1f553fd58743a3ae4c9a\n- `python -u -i train_resnet.py --learning_rate 0.005  --num_modules 16 --num_features 192 --summary_dir Workspace --checkpoint_dir Workspace --batch_size 64`\n### What have you tried?\n1. I tried to cast the values in _safe_shape_div() to int64 in case that was the underlying cause, but that seemed to cause different problems.\n### Logs or other output that would be helpful\n\nAll files (python, run log) at:\nhttps://gist.github.com/thouis/9bbd330a153b1f553fd58743a3ae4c9a\n"}