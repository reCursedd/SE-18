{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5618", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5618/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5618/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5618/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/5618", "id": 189405043, "node_id": "MDU6SXNzdWUxODk0MDUwNDM=", "number": 5618, "title": "0.11.0rc2 bug weird placeholder feeding problem when using exponential moving average", "user": {"login": "ischlag", "id": 7107156, "node_id": "MDQ6VXNlcjcxMDcxNTY=", "avatar_url": "https://avatars0.githubusercontent.com/u/7107156?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ischlag", "html_url": "https://github.com/ischlag", "followers_url": "https://api.github.com/users/ischlag/followers", "following_url": "https://api.github.com/users/ischlag/following{/other_user}", "gists_url": "https://api.github.com/users/ischlag/gists{/gist_id}", "starred_url": "https://api.github.com/users/ischlag/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ischlag/subscriptions", "organizations_url": "https://api.github.com/users/ischlag/orgs", "repos_url": "https://api.github.com/users/ischlag/repos", "events_url": "https://api.github.com/users/ischlag/events{/privacy}", "received_events_url": "https://api.github.com/users/ischlag/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}, {"id": 473184161, "node_id": "MDU6TGFiZWw0NzMxODQxNjE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:support", "name": "type:support", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2016-11-15T14:24:27Z", "updated_at": "2016-11-17T00:57:04Z", "closed_at": "2016-11-17T00:57:04Z", "author_association": "NONE", "body_html": "<p>using 0.11.0rc2</p>\n<p>this simple (nonesense) script breaks:</p>\n<pre><code>import tensorflow as tf\nfrom tensorflow.examples.tutorials.mnist import input_data\nmnist = input_data.read_data_sets('MNIST_data', one_hot=True)\n\nBATCH_SIZE = 128\nlearning_rate = 0.01\n\ndef model(x):\n  \"\"\"Defines the CNN architecture and returns its output tensor.\"\"\"\n  ema = tf.train.ExponentialMovingAverage(decay=0.5)\n\n  def mean_var_with_update():\n    ema_apply_op = ema.apply([tf.constant(1.0), tf.constant(2.0)])\n    return tf.constant(1.0), tf.constant(2.0)\n\n  mean, var = tf.cond(is_training,\n                      mean_var_with_update,\n                      lambda: (tf.constant(2.0), tf.constant(3.0)))\n  return x\n\nbatch_size = tf.placeholder(tf.float32, name=\"batch_size\")\nlr = tf.placeholder(tf.float32, name=\"learning_rate\")\nis_training = tf.placeholder(tf.bool, name='is_training')\ninput_image_batch = tf.placeholder(tf.float32, shape=[BATCH_SIZE, 28, 28, 1],\n                                   name=\"input_image_batch\")\ninput_label_batch = tf.placeholder(tf.float32, shape=[None, 10], name=\"input_label_batch\")\nlogits = model(input_image_batch)\ninit_op = tf.global_variables_initializer()\nsess = tf.Session()\nsess.run(init_op)\n</code></pre>\n<p>produces:</p>\n<pre><code>I tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -&gt; (device: 0, name: GeForce GTX 1080, pci bus id: 0000:05:00.0)\nTraceback (most recent call last):\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1021, in _do_call\n    return fn(*args)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1003, in _run_fn\n    status, run_metadata)\n  File \"/usr/lib/python3.5/contextlib.py\", line 66, in __exit__\n    next(self.gen)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/framework/errors_impl.py\", line 469, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors_impl.InvalidArgumentError: You must feed a value for placeholder tensor 'is_training' with dtype bool\n\t [[Node: is_training = Placeholder[dtype=DT_BOOL, shape=[], _device=\"/job:localhost/replica:0/task:0/gpu:0\"]()]]\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"slim.py\", line 48, in &lt;module&gt;\n    sess.run(init_op)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 766, in run\n    run_metadata_ptr)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 964, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1014, in _do_run\n    target_list, options, run_metadata)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1034, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InvalidArgumentError: You must feed a value for placeholder tensor 'is_training' with dtype bool\n\t [[Node: is_training = Placeholder[dtype=DT_BOOL, shape=[], _device=\"/job:localhost/replica:0/task:0/gpu:0\"]()]]\n\nCaused by op 'is_training', defined at:\n  File \"slim.py\", line 36, in &lt;module&gt;\n    is_training = tf.placeholder(tf.bool, name='is_training')\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/ops/array_ops.py\", line 1519, in placeholder\n    name=name)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 2039, in _placeholder\n    name=name)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 759, in apply_op\n    op_def=op_def)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2259, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1130, in __init__\n    self._traceback = _extract_stack()\n\nInvalidArgumentError (see above for traceback): You must feed a value for placeholder tensor 'is_training' with dtype bool\n\t [[Node: is_training = Placeholder[dtype=DT_BOOL, shape=[], _device=\"/job:localhost/replica:0/task:0/gpu:0\"]()]]\n</code></pre>\n<p>I don't understand the problem. If I remove the ema (which I'm not using in the example) it works. I can also fix this by adding a feed dict to the init operation like this:</p>\n<pre><code>sess.run(init_op, feed_dict={is_training.name: False})\n</code></pre>\n<p>I don't think I have this problem with v0.11. I'm using ema in my batchnorm function. I removed all the unnecessary code from my full implementation.</p>", "body_text": "using 0.11.0rc2\nthis simple (nonesense) script breaks:\nimport tensorflow as tf\nfrom tensorflow.examples.tutorials.mnist import input_data\nmnist = input_data.read_data_sets('MNIST_data', one_hot=True)\n\nBATCH_SIZE = 128\nlearning_rate = 0.01\n\ndef model(x):\n  \"\"\"Defines the CNN architecture and returns its output tensor.\"\"\"\n  ema = tf.train.ExponentialMovingAverage(decay=0.5)\n\n  def mean_var_with_update():\n    ema_apply_op = ema.apply([tf.constant(1.0), tf.constant(2.0)])\n    return tf.constant(1.0), tf.constant(2.0)\n\n  mean, var = tf.cond(is_training,\n                      mean_var_with_update,\n                      lambda: (tf.constant(2.0), tf.constant(3.0)))\n  return x\n\nbatch_size = tf.placeholder(tf.float32, name=\"batch_size\")\nlr = tf.placeholder(tf.float32, name=\"learning_rate\")\nis_training = tf.placeholder(tf.bool, name='is_training')\ninput_image_batch = tf.placeholder(tf.float32, shape=[BATCH_SIZE, 28, 28, 1],\n                                   name=\"input_image_batch\")\ninput_label_batch = tf.placeholder(tf.float32, shape=[None, 10], name=\"input_label_batch\")\nlogits = model(input_image_batch)\ninit_op = tf.global_variables_initializer()\nsess = tf.Session()\nsess.run(init_op)\n\nproduces:\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -> (device: 0, name: GeForce GTX 1080, pci bus id: 0000:05:00.0)\nTraceback (most recent call last):\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1021, in _do_call\n    return fn(*args)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1003, in _run_fn\n    status, run_metadata)\n  File \"/usr/lib/python3.5/contextlib.py\", line 66, in __exit__\n    next(self.gen)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/framework/errors_impl.py\", line 469, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors_impl.InvalidArgumentError: You must feed a value for placeholder tensor 'is_training' with dtype bool\n\t [[Node: is_training = Placeholder[dtype=DT_BOOL, shape=[], _device=\"/job:localhost/replica:0/task:0/gpu:0\"]()]]\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"slim.py\", line 48, in <module>\n    sess.run(init_op)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 766, in run\n    run_metadata_ptr)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 964, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1014, in _do_run\n    target_list, options, run_metadata)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1034, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InvalidArgumentError: You must feed a value for placeholder tensor 'is_training' with dtype bool\n\t [[Node: is_training = Placeholder[dtype=DT_BOOL, shape=[], _device=\"/job:localhost/replica:0/task:0/gpu:0\"]()]]\n\nCaused by op 'is_training', defined at:\n  File \"slim.py\", line 36, in <module>\n    is_training = tf.placeholder(tf.bool, name='is_training')\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/ops/array_ops.py\", line 1519, in placeholder\n    name=name)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 2039, in _placeholder\n    name=name)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 759, in apply_op\n    op_def=op_def)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2259, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1130, in __init__\n    self._traceback = _extract_stack()\n\nInvalidArgumentError (see above for traceback): You must feed a value for placeholder tensor 'is_training' with dtype bool\n\t [[Node: is_training = Placeholder[dtype=DT_BOOL, shape=[], _device=\"/job:localhost/replica:0/task:0/gpu:0\"]()]]\n\nI don't understand the problem. If I remove the ema (which I'm not using in the example) it works. I can also fix this by adding a feed dict to the init operation like this:\nsess.run(init_op, feed_dict={is_training.name: False})\n\nI don't think I have this problem with v0.11. I'm using ema in my batchnorm function. I removed all the unnecessary code from my full implementation.", "body": "using 0.11.0rc2\r\n\r\nthis simple (nonesense) script breaks:\r\n```\r\nimport tensorflow as tf\r\nfrom tensorflow.examples.tutorials.mnist import input_data\r\nmnist = input_data.read_data_sets('MNIST_data', one_hot=True)\r\n\r\nBATCH_SIZE = 128\r\nlearning_rate = 0.01\r\n\r\ndef model(x):\r\n  \"\"\"Defines the CNN architecture and returns its output tensor.\"\"\"\r\n  ema = tf.train.ExponentialMovingAverage(decay=0.5)\r\n\r\n  def mean_var_with_update():\r\n    ema_apply_op = ema.apply([tf.constant(1.0), tf.constant(2.0)])\r\n    return tf.constant(1.0), tf.constant(2.0)\r\n\r\n  mean, var = tf.cond(is_training,\r\n                      mean_var_with_update,\r\n                      lambda: (tf.constant(2.0), tf.constant(3.0)))\r\n  return x\r\n\r\nbatch_size = tf.placeholder(tf.float32, name=\"batch_size\")\r\nlr = tf.placeholder(tf.float32, name=\"learning_rate\")\r\nis_training = tf.placeholder(tf.bool, name='is_training')\r\ninput_image_batch = tf.placeholder(tf.float32, shape=[BATCH_SIZE, 28, 28, 1],\r\n                                   name=\"input_image_batch\")\r\ninput_label_batch = tf.placeholder(tf.float32, shape=[None, 10], name=\"input_label_batch\")\r\nlogits = model(input_image_batch)\r\ninit_op = tf.global_variables_initializer()\r\nsess = tf.Session()\r\nsess.run(init_op)\r\n```\r\n\r\nproduces:\r\n```\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -> (device: 0, name: GeForce GTX 1080, pci bus id: 0000:05:00.0)\r\nTraceback (most recent call last):\r\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1021, in _do_call\r\n    return fn(*args)\r\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1003, in _run_fn\r\n    status, run_metadata)\r\n  File \"/usr/lib/python3.5/contextlib.py\", line 66, in __exit__\r\n    next(self.gen)\r\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/framework/errors_impl.py\", line 469, in raise_exception_on_not_ok_status\r\n    pywrap_tensorflow.TF_GetCode(status))\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: You must feed a value for placeholder tensor 'is_training' with dtype bool\r\n\t [[Node: is_training = Placeholder[dtype=DT_BOOL, shape=[], _device=\"/job:localhost/replica:0/task:0/gpu:0\"]()]]\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"slim.py\", line 48, in <module>\r\n    sess.run(init_op)\r\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 766, in run\r\n    run_metadata_ptr)\r\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 964, in _run\r\n    feed_dict_string, options, run_metadata)\r\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1014, in _do_run\r\n    target_list, options, run_metadata)\r\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1034, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: You must feed a value for placeholder tensor 'is_training' with dtype bool\r\n\t [[Node: is_training = Placeholder[dtype=DT_BOOL, shape=[], _device=\"/job:localhost/replica:0/task:0/gpu:0\"]()]]\r\n\r\nCaused by op 'is_training', defined at:\r\n  File \"slim.py\", line 36, in <module>\r\n    is_training = tf.placeholder(tf.bool, name='is_training')\r\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/ops/array_ops.py\", line 1519, in placeholder\r\n    name=name)\r\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 2039, in _placeholder\r\n    name=name)\r\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 759, in apply_op\r\n    op_def=op_def)\r\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2259, in create_op\r\n    original_op=self._default_original_op, op_def=op_def)\r\n  File \"/home/schlag/MyStuff/LearnSpecific/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1130, in __init__\r\n    self._traceback = _extract_stack()\r\n\r\nInvalidArgumentError (see above for traceback): You must feed a value for placeholder tensor 'is_training' with dtype bool\r\n\t [[Node: is_training = Placeholder[dtype=DT_BOOL, shape=[], _device=\"/job:localhost/replica:0/task:0/gpu:0\"]()]]\r\n```\r\n\r\nI don't understand the problem. If I remove the ema (which I'm not using in the example) it works. I can also fix this by adding a feed dict to the init operation like this: \r\n```\r\nsess.run(init_op, feed_dict={is_training.name: False})\r\n```\r\nI don't think I have this problem with v0.11. I'm using ema in my batchnorm function. I removed all the unnecessary code from my full implementation.\r\n"}