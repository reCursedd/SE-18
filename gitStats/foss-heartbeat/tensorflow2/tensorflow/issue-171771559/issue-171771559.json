{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3886", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3886/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3886/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3886/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/3886", "id": 171771559, "node_id": "MDU6SXNzdWUxNzE3NzE1NTk=", "number": 3886, "title": "control_dependencies() maybe fails to mfence when an assign() with different shape occurs", "user": {"login": "smacke", "id": 325653, "node_id": "MDQ6VXNlcjMyNTY1Mw==", "avatar_url": "https://avatars3.githubusercontent.com/u/325653?v=4", "gravatar_id": "", "url": "https://api.github.com/users/smacke", "html_url": "https://github.com/smacke", "followers_url": "https://api.github.com/users/smacke/followers", "following_url": "https://api.github.com/users/smacke/following{/other_user}", "gists_url": "https://api.github.com/users/smacke/gists{/gist_id}", "starred_url": "https://api.github.com/users/smacke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/smacke/subscriptions", "organizations_url": "https://api.github.com/users/smacke/orgs", "repos_url": "https://api.github.com/users/smacke/repos", "events_url": "https://api.github.com/users/smacke/events{/privacy}", "received_events_url": "https://api.github.com/users/smacke/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2016-08-17T22:02:57Z", "updated_at": "2016-08-24T04:40:32Z", "closed_at": "2016-08-24T04:40:32Z", "author_association": "NONE", "body_html": "<h3>Environment info</h3>\n<p>Operating System: OS X El Capitan</p>\n<p>Installed CPU version (OSX pip package)<br>\ntensorflow version: 0.10.0rc0</p>\n<h3>Steps to reproduce</h3>\n<p>Consider the following code snippet:</p>\n<div class=\"highlight highlight-source-python\"><pre>x <span class=\"pl-k\">=</span> tf.Variable(<span class=\"pl-c1\">0</span>.)\nx_op <span class=\"pl-k\">=</span> tf.assign(x, [<span class=\"pl-c1\">1</span>.], <span class=\"pl-v\">validate_shape</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">False</span>)\n\n<span class=\"pl-k\">with</span> tf.control_dependencies([x_op]):\n    plus_op <span class=\"pl-k\">=</span> x<span class=\"pl-k\">+</span><span class=\"pl-c1\">2</span>\n\ntf.initialize_variables([x]).run()\n<span class=\"pl-c1\">print</span> plus_op.eval()</pre></div>\n<p>The expected output is <code>[3]</code>, but instead I get <code>2</code></p>\n<h3>What have you tried?</h3>\n<p>If we don't assign an inconsistent shape (e.g. assign <code>1</code> instead of <code>[1]</code>), then things work the way one would expect (output is <code>3</code>)</p>\n<p>If we replace</p>\n<p><code>plus_op = x+2</code></p>\n<p>with</p>\n<p><code>plus_op=x.ref() + 2</code></p>\n<p>then we get the expected output of <code>[3]</code> instead of <code>2</code>.</p>\n<p>I suspect this is because calling <code>ref()</code> may somehow trigger a memory fence which fixes the broken behavior.</p>\n<p>Also, it is possible that this is the intended behavior and that I misunderstood control_dependencies(), in which case I apologize.</p>", "body_text": "Environment info\nOperating System: OS X El Capitan\nInstalled CPU version (OSX pip package)\ntensorflow version: 0.10.0rc0\nSteps to reproduce\nConsider the following code snippet:\nx = tf.Variable(0.)\nx_op = tf.assign(x, [1.], validate_shape=False)\n\nwith tf.control_dependencies([x_op]):\n    plus_op = x+2\n\ntf.initialize_variables([x]).run()\nprint plus_op.eval()\nThe expected output is [3], but instead I get 2\nWhat have you tried?\nIf we don't assign an inconsistent shape (e.g. assign 1 instead of [1]), then things work the way one would expect (output is 3)\nIf we replace\nplus_op = x+2\nwith\nplus_op=x.ref() + 2\nthen we get the expected output of [3] instead of 2.\nI suspect this is because calling ref() may somehow trigger a memory fence which fixes the broken behavior.\nAlso, it is possible that this is the intended behavior and that I misunderstood control_dependencies(), in which case I apologize.", "body": "### Environment info\n\nOperating System: OS X El Capitan\n\nInstalled CPU version (OSX pip package)\ntensorflow version: 0.10.0rc0\n### Steps to reproduce\n\nConsider the following code snippet:\n\n``` python\nx = tf.Variable(0.)\nx_op = tf.assign(x, [1.], validate_shape=False)\n\nwith tf.control_dependencies([x_op]):\n    plus_op = x+2\n\ntf.initialize_variables([x]).run()\nprint plus_op.eval()\n```\n\nThe expected output is `[3]`, but instead I get `2`\n### What have you tried?\n\nIf we don't assign an inconsistent shape (e.g. assign `1` instead of `[1]`), then things work the way one would expect (output is `3`)\n\nIf we replace\n\n`plus_op = x+2`\n\nwith\n\n`plus_op=x.ref() + 2`\n\nthen we get the expected output of `[3]` instead of `2`.\n\nI suspect this is because calling `ref()` may somehow trigger a memory fence which fixes the broken behavior.\n\nAlso, it is possible that this is the intended behavior and that I misunderstood control_dependencies(), in which case I apologize.\n"}