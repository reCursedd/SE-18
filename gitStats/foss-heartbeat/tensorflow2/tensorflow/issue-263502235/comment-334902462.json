{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/334902462", "html_url": "https://github.com/tensorflow/tensorflow/issues/13529#issuecomment-334902462", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13529", "id": 334902462, "node_id": "MDEyOklzc3VlQ29tbWVudDMzNDkwMjQ2Mg==", "user": {"login": "Prinsphield", "id": 12531720, "node_id": "MDQ6VXNlcjEyNTMxNzIw", "avatar_url": "https://avatars0.githubusercontent.com/u/12531720?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Prinsphield", "html_url": "https://github.com/Prinsphield", "followers_url": "https://api.github.com/users/Prinsphield/followers", "following_url": "https://api.github.com/users/Prinsphield/following{/other_user}", "gists_url": "https://api.github.com/users/Prinsphield/gists{/gist_id}", "starred_url": "https://api.github.com/users/Prinsphield/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Prinsphield/subscriptions", "organizations_url": "https://api.github.com/users/Prinsphield/orgs", "repos_url": "https://api.github.com/users/Prinsphield/repos", "events_url": "https://api.github.com/users/Prinsphield/events{/privacy}", "received_events_url": "https://api.github.com/users/Prinsphield/received_events", "type": "User", "site_admin": false}, "created_at": "2017-10-07T01:43:14Z", "updated_at": "2017-10-07T01:47:12Z", "author_association": "NONE", "body_html": "<p>I have tried using <code>tf.contrib.data</code>, if I skip some samples, then the <code>Dataset.filter()</code> returns None, which will raise the error.</p>\n<p>Here is what I did:</p>\n<pre><code>```\ndef filter_fn(self, image, label):\n\u00a6   if label == 1:\n\u00a6   \u00a6   return image, label\n\u00a6   else:\n\u00a6   \u00a6   pass\n\ndef input(self, data_type='train') :\n\u00a6   if data_type == 'train':\n\u00a6   \u00a6   filenames = self.train_file\n\u00a6   elif data_type == 'val':\n\u00a6   \u00a6   filenames = self.val_file\n\u00a6   else:\n\u00a6   \u00a6   raise NotImplementationError()\n\n\u00a6   dataset = tf.contrib.data.TFRecordDataset(filenames)\n\u00a6   dataset = dataset.map(self.parse_fn, num_threads=self.num_threads)\n\u00a6   # dataset = dataset.shuffle(buffer_size=10000)\n\u00a6   dataset = dataset.filter(self.filter_fn)\n\u00a6   dataset = dataset.batch(self.batch_size)\n\u00a6   dataset = dataset.repeat()\n\u00a6   dataset = dataset.make_one_shot_iterator()\n\u00a6   return dataset.get_next()\n</code></pre>\n<pre><code>\nThen it raises the error:\n\n  File \"new_data.py\", line 160, in input\n    dataset = dataset.filter(self.filter_fn)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1072, in filter\n    return FilterDataset(self, predicate)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1916, in __init__\n    self._predicate.add_to_graph(ops.get_default_graph())\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/function.py\", line 449, in add_to_graph\n    self._create_definition_if_needed()\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/data/python/framework/function.py\", line 168, in _create_definition_if_needed\n    outputs = self._func(*inputs)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1908, in tf_predicate\n    ret = ops.convert_to_tensor(ret, dtype=dtypes.bool)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 611, in convert_to_tensor\n    as_ref=False)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 676, in internal_convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/constant_op.py\", line 121, in _constant_tensor_conversion_function\n    return constant(v, dtype=dtype, name=name)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/constant_op.py\", line 102, in constant\n    tensor_util.make_tensor_proto(value, dtype=dtype, shape=shape, verify_shape=verify_shape))\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/tensor_util.py\", line 364, in make_tensor_proto\n    raise ValueError(\"None values not supported.\")\nValueError: None values not supported.\n\n</code></pre>", "body_text": "I have tried using tf.contrib.data, if I skip some samples, then the Dataset.filter() returns None, which will raise the error.\nHere is what I did:\n```\ndef filter_fn(self, image, label):\n\u00a6   if label == 1:\n\u00a6   \u00a6   return image, label\n\u00a6   else:\n\u00a6   \u00a6   pass\n\ndef input(self, data_type='train') :\n\u00a6   if data_type == 'train':\n\u00a6   \u00a6   filenames = self.train_file\n\u00a6   elif data_type == 'val':\n\u00a6   \u00a6   filenames = self.val_file\n\u00a6   else:\n\u00a6   \u00a6   raise NotImplementationError()\n\n\u00a6   dataset = tf.contrib.data.TFRecordDataset(filenames)\n\u00a6   dataset = dataset.map(self.parse_fn, num_threads=self.num_threads)\n\u00a6   # dataset = dataset.shuffle(buffer_size=10000)\n\u00a6   dataset = dataset.filter(self.filter_fn)\n\u00a6   dataset = dataset.batch(self.batch_size)\n\u00a6   dataset = dataset.repeat()\n\u00a6   dataset = dataset.make_one_shot_iterator()\n\u00a6   return dataset.get_next()\n\n\nThen it raises the error:\n\n  File \"new_data.py\", line 160, in input\n    dataset = dataset.filter(self.filter_fn)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1072, in filter\n    return FilterDataset(self, predicate)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1916, in __init__\n    self._predicate.add_to_graph(ops.get_default_graph())\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/function.py\", line 449, in add_to_graph\n    self._create_definition_if_needed()\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/data/python/framework/function.py\", line 168, in _create_definition_if_needed\n    outputs = self._func(*inputs)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1908, in tf_predicate\n    ret = ops.convert_to_tensor(ret, dtype=dtypes.bool)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 611, in convert_to_tensor\n    as_ref=False)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 676, in internal_convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/constant_op.py\", line 121, in _constant_tensor_conversion_function\n    return constant(v, dtype=dtype, name=name)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/constant_op.py\", line 102, in constant\n    tensor_util.make_tensor_proto(value, dtype=dtype, shape=shape, verify_shape=verify_shape))\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/tensor_util.py\", line 364, in make_tensor_proto\n    raise ValueError(\"None values not supported.\")\nValueError: None values not supported.", "body": "I have tried using `tf.contrib.data`, if I skip some samples, then the `Dataset.filter()` returns None, which will raise the error.\r\n\r\nHere is what I did:\r\n\r\n    ```\r\n    def filter_fn(self, image, label):\r\n    \u00a6   if label == 1:\r\n    \u00a6   \u00a6   return image, label\r\n    \u00a6   else:\r\n    \u00a6   \u00a6   pass\r\n\r\n    def input(self, data_type='train') :\r\n    \u00a6   if data_type == 'train':\r\n    \u00a6   \u00a6   filenames = self.train_file\r\n    \u00a6   elif data_type == 'val':\r\n    \u00a6   \u00a6   filenames = self.val_file\r\n    \u00a6   else:\r\n    \u00a6   \u00a6   raise NotImplementationError()\r\n\r\n    \u00a6   dataset = tf.contrib.data.TFRecordDataset(filenames)\r\n    \u00a6   dataset = dataset.map(self.parse_fn, num_threads=self.num_threads)\r\n    \u00a6   # dataset = dataset.shuffle(buffer_size=10000)\r\n    \u00a6   dataset = dataset.filter(self.filter_fn)\r\n    \u00a6   dataset = dataset.batch(self.batch_size)\r\n    \u00a6   dataset = dataset.repeat()\r\n    \u00a6   dataset = dataset.make_one_shot_iterator()\r\n    \u00a6   return dataset.get_next()\r\n```\r\n\r\nThen it raises the error:\r\n\r\n  File \"new_data.py\", line 160, in input\r\n    dataset = dataset.filter(self.filter_fn)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1072, in filter\r\n    return FilterDataset(self, predicate)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1916, in __init__\r\n    self._predicate.add_to_graph(ops.get_default_graph())\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/function.py\", line 449, in add_to_graph\r\n    self._create_definition_if_needed()\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/data/python/framework/function.py\", line 168, in _create_definition_if_needed\r\n    outputs = self._func(*inputs)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1908, in tf_predicate\r\n    ret = ops.convert_to_tensor(ret, dtype=dtypes.bool)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 611, in convert_to_tensor\r\n    as_ref=False)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 676, in internal_convert_to_tensor\r\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/constant_op.py\", line 121, in _constant_tensor_conversion_function\r\n    return constant(v, dtype=dtype, name=name)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/constant_op.py\", line 102, in constant\r\n    tensor_util.make_tensor_proto(value, dtype=dtype, shape=shape, verify_shape=verify_shape))\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/tensor_util.py\", line 364, in make_tensor_proto\r\n    raise ValueError(\"None values not supported.\")\r\nValueError: None values not supported.\r\n\r\n"}