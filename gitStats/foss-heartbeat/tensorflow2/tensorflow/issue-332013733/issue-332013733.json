{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19988", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19988/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19988/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19988/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/19988", "id": 332013733, "node_id": "MDU6SXNzdWUzMzIwMTM3MzM=", "number": 19988, "title": "Official profile python API not work on the official mnist example", "user": {"login": "MrWanter", "id": 18298163, "node_id": "MDQ6VXNlcjE4Mjk4MTYz", "avatar_url": "https://avatars0.githubusercontent.com/u/18298163?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MrWanter", "html_url": "https://github.com/MrWanter", "followers_url": "https://api.github.com/users/MrWanter/followers", "following_url": "https://api.github.com/users/MrWanter/following{/other_user}", "gists_url": "https://api.github.com/users/MrWanter/gists{/gist_id}", "starred_url": "https://api.github.com/users/MrWanter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MrWanter/subscriptions", "organizations_url": "https://api.github.com/users/MrWanter/orgs", "repos_url": "https://api.github.com/users/MrWanter/repos", "events_url": "https://api.github.com/users/MrWanter/events{/privacy}", "received_events_url": "https://api.github.com/users/MrWanter/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2018-06-13T14:13:00Z", "updated_at": "2018-08-20T22:46:48Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>Hi! I was using the official minist summaries example which uses run_metadata to track model runtime statistics:</p>\n<p><a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/tutorials/mnist/mnist_with_summaries.py\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/tutorials/mnist/mnist_with_summaries.py</a></p>\n<p>I tried to add simple profiler python API as suggest by</p>\n<p><a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/profiler/g3doc/python_api.md\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/profiler/g3doc/python_api.md</a></p>\n<p>So, my code is:<br>\n<a href=\"https://github.com/MrWanter/mnist-proflie/blob/c0f5b59403fbf3258e8236fa7c983750623354e6/mnist-profile.py#L175-L184\">https://github.com/MrWanter/mnist-proflie/blob/c0f5b59403fbf3258e8236fa7c983750623354e6/mnist-profile.py#L175-L184</a></p>\n<p>but running the model gives</p>\n<pre><code>Added profiling by user\nParsing Inputs...\nIncomplete shape.\nIncomplete shape.\nOptions -step=199 not found.\nAvailable steps: 0 \nAdding run metadata for 199\n</code></pre>\n<p>but tensorboard shows the memory consumption of nodes, which suggests runtime statistics are captured:<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/18298163/41357872-b3d623fe-6f59-11e8-91c2-539f55340e8a.png\"><img src=\"https://user-images.githubusercontent.com/18298163/41357872-b3d623fe-6f59-11e8-91c2-539f55340e8a.png\" alt=\"image\" style=\"max-width:100%;\"></a></p>\n<p>what is incomplete shape, the input shape has None for batch size, but since it is runtime statistics, I thought it would work, but it does not, can someone help?</p>\n<p>As in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"331804891\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/19962\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/19962/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/19962\">#19962</a>, it is hard to know how to deal with profiler problem since documentation is not enough and    codes are hard to read as it is implemented with C++ and heavily wrapped</p>\n<p><strong>UPDATA</strong>:<br>\nTh problem is caused by input shape of None for batch size, change it to fixed shape solve the problem, but there would inevitably be a large amount of None in tensors since we have to deal with variable sized inputs, in those cases, it should be reasonable for the profiler to capture runtime statistics, so how can we do it? where am I wrong?</p>\n<p><strong>UPDATE</strong><br>\nFound a quote on the official profiler doc:</p>\n<blockquote>\n<p>It must have known \"shape\" information for RegisterStatistics('flops') to calculate the statistics. It is suggested to pass in -run_meta_path if shape is only known during runtime. tfprof can fill in the missing shape with the runtime shape information from RunMetadata. Hence, it is suggested to use -account_displayed_op_only option so that you know the statistics are only for the operations printed out.</p>\n</blockquote>\n<p>seems profiler can fill in the missing shape with runtime shape information, but how to pass in <code>- run_meta_path</code>,  I did not find anything relevant in the profiler options:</p>\n<pre><code>      self._options = {'max_depth': 100,\n                       'min_bytes': 0,\n                       'min_micros': 0,\n                       'min_params': 0,\n                       'min_float_ops': 0,\n                       'min_occurrence': 0,\n                       'order_by': 'name',\n                       'account_type_regexes': ['.*'],\n                       'start_name_regexes': ['.*'],\n                       'trim_name_regexes': [],\n                       'show_name_regexes': ['.*'],\n                       'hide_name_regexes': [],\n                       'account_displayed_op_only': False,\n                       'select': ['micros'],\n                       'step': -1,\n                       'output': 'stdout'}\n</code></pre>", "body_text": "Hi! I was using the official minist summaries example which uses run_metadata to track model runtime statistics:\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/tutorials/mnist/mnist_with_summaries.py\nI tried to add simple profiler python API as suggest by\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/profiler/g3doc/python_api.md\nSo, my code is:\nhttps://github.com/MrWanter/mnist-proflie/blob/c0f5b59403fbf3258e8236fa7c983750623354e6/mnist-profile.py#L175-L184\nbut running the model gives\nAdded profiling by user\nParsing Inputs...\nIncomplete shape.\nIncomplete shape.\nOptions -step=199 not found.\nAvailable steps: 0 \nAdding run metadata for 199\n\nbut tensorboard shows the memory consumption of nodes, which suggests runtime statistics are captured:\n\nwhat is incomplete shape, the input shape has None for batch size, but since it is runtime statistics, I thought it would work, but it does not, can someone help?\nAs in #19962, it is hard to know how to deal with profiler problem since documentation is not enough and    codes are hard to read as it is implemented with C++ and heavily wrapped\nUPDATA:\nTh problem is caused by input shape of None for batch size, change it to fixed shape solve the problem, but there would inevitably be a large amount of None in tensors since we have to deal with variable sized inputs, in those cases, it should be reasonable for the profiler to capture runtime statistics, so how can we do it? where am I wrong?\nUPDATE\nFound a quote on the official profiler doc:\n\nIt must have known \"shape\" information for RegisterStatistics('flops') to calculate the statistics. It is suggested to pass in -run_meta_path if shape is only known during runtime. tfprof can fill in the missing shape with the runtime shape information from RunMetadata. Hence, it is suggested to use -account_displayed_op_only option so that you know the statistics are only for the operations printed out.\n\nseems profiler can fill in the missing shape with runtime shape information, but how to pass in - run_meta_path,  I did not find anything relevant in the profiler options:\n      self._options = {'max_depth': 100,\n                       'min_bytes': 0,\n                       'min_micros': 0,\n                       'min_params': 0,\n                       'min_float_ops': 0,\n                       'min_occurrence': 0,\n                       'order_by': 'name',\n                       'account_type_regexes': ['.*'],\n                       'start_name_regexes': ['.*'],\n                       'trim_name_regexes': [],\n                       'show_name_regexes': ['.*'],\n                       'hide_name_regexes': [],\n                       'account_displayed_op_only': False,\n                       'select': ['micros'],\n                       'step': -1,\n                       'output': 'stdout'}", "body": "Hi! I was using the official minist summaries example which uses run_metadata to track model runtime statistics:\r\n\r\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/tutorials/mnist/mnist_with_summaries.py\r\n\r\nI tried to add simple profiler python API as suggest by \r\n\r\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/profiler/g3doc/python_api.md\r\n\r\nSo, my code is:\r\nhttps://github.com/MrWanter/mnist-proflie/blob/c0f5b59403fbf3258e8236fa7c983750623354e6/mnist-profile.py#L175-L184\r\n\r\nbut running the model gives \r\n```\r\nAdded profiling by user\r\nParsing Inputs...\r\nIncomplete shape.\r\nIncomplete shape.\r\nOptions -step=199 not found.\r\nAvailable steps: 0 \r\nAdding run metadata for 199\r\n```\r\nbut tensorboard shows the memory consumption of nodes, which suggests runtime statistics are captured:\r\n![image](https://user-images.githubusercontent.com/18298163/41357872-b3d623fe-6f59-11e8-91c2-539f55340e8a.png)\r\n\r\nwhat is incomplete shape, the input shape has None for batch size, but since it is runtime statistics, I thought it would work, but it does not, can someone help?\r\n\r\nAs in #19962, it is hard to know how to deal with profiler problem since documentation is not enough and    codes are hard to read as it is implemented with C++ and heavily wrapped\r\n\r\n**UPDATA**:\r\nTh problem is caused by input shape of None for batch size, change it to fixed shape solve the problem, but there would inevitably be a large amount of None in tensors since we have to deal with variable sized inputs, in those cases, it should be reasonable for the profiler to capture runtime statistics, so how can we do it? where am I wrong?\r\n\r\n**UPDATE**\r\nFound a quote on the official profiler doc:\r\n> It must have known \"shape\" information for RegisterStatistics('flops') to calculate the statistics. It is suggested to pass in -run_meta_path if shape is only known during runtime. tfprof can fill in the missing shape with the runtime shape information from RunMetadata. Hence, it is suggested to use -account_displayed_op_only option so that you know the statistics are only for the operations printed out.\r\n\r\nseems profiler can fill in the missing shape with runtime shape information, but how to pass in `-\r\nrun_meta_path`,  I did not find anything relevant in the profiler options:\r\n```\r\n      self._options = {'max_depth': 100,\r\n                       'min_bytes': 0,\r\n                       'min_micros': 0,\r\n                       'min_params': 0,\r\n                       'min_float_ops': 0,\r\n                       'min_occurrence': 0,\r\n                       'order_by': 'name',\r\n                       'account_type_regexes': ['.*'],\r\n                       'start_name_regexes': ['.*'],\r\n                       'trim_name_regexes': [],\r\n                       'show_name_regexes': ['.*'],\r\n                       'hide_name_regexes': [],\r\n                       'account_displayed_op_only': False,\r\n                       'select': ['micros'],\r\n                       'step': -1,\r\n                       'output': 'stdout'}\r\n```"}