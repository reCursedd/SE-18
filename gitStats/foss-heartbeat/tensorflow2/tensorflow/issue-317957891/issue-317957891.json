{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18896", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18896/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18896/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18896/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/18896", "id": 317957891, "node_id": "MDExOlB1bGxSZXF1ZXN0MTg0Mjg2MjY1", "number": 18896, "title": "Fix some issues in official tf.nn.topk() in lite", "user": {"login": "scottcjt", "id": 34140249, "node_id": "MDQ6VXNlcjM0MTQwMjQ5", "avatar_url": "https://avatars2.githubusercontent.com/u/34140249?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scottcjt", "html_url": "https://github.com/scottcjt", "followers_url": "https://api.github.com/users/scottcjt/followers", "following_url": "https://api.github.com/users/scottcjt/following{/other_user}", "gists_url": "https://api.github.com/users/scottcjt/gists{/gist_id}", "starred_url": "https://api.github.com/users/scottcjt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scottcjt/subscriptions", "organizations_url": "https://api.github.com/users/scottcjt/orgs", "repos_url": "https://api.github.com/users/scottcjt/repos", "events_url": "https://api.github.com/users/scottcjt/events{/privacy}", "received_events_url": "https://api.github.com/users/scottcjt/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-04-26T09:56:50Z", "updated_at": "2018-04-27T06:27:41Z", "closed_at": "2018-04-26T22:27:09Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/18896", "html_url": "https://github.com/tensorflow/tensorflow/pull/18896", "diff_url": "https://github.com/tensorflow/tensorflow/pull/18896.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/18896.patch"}, "body_html": "<p>Not sure if Google is planning a breaking change. If not:</p>\n<ol>\n<li>\n<p>The topk_v2 implementation has its output <strong>values</strong> and <strong>indices</strong> in the opposite order.</p>\n<p>Below is TensorFlow Python API behavior:</p>\n<div class=\"highlight highlight-source-python\"><pre>In [<span class=\"pl-c1\">5</span>]: x\nOut[<span class=\"pl-c1\">5</span>]: <span class=\"pl-k\">&lt;</span>tf.Tensor <span class=\"pl-s\"><span class=\"pl-pds\">'</span>x:0<span class=\"pl-pds\">'</span></span> shape<span class=\"pl-k\">=</span>(<span class=\"pl-c1\">100</span>,) dtype<span class=\"pl-k\">=</span>float32<span class=\"pl-k\">&gt;</span>\n\nIn [<span class=\"pl-c1\">7</span>]: y, z <span class=\"pl-k\">=</span> tf.nn.top_k(x, <span class=\"pl-v\">k</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">10</span>)\n\nIn [<span class=\"pl-c1\">8</span>]: y\nOut[<span class=\"pl-c1\">8</span>]: <span class=\"pl-k\">&lt;</span>tf.Tensor <span class=\"pl-s\"><span class=\"pl-pds\">'</span>TopKV2:0<span class=\"pl-pds\">'</span></span> shape<span class=\"pl-k\">=</span>(<span class=\"pl-c1\">10</span>,) dtype<span class=\"pl-k\">=</span>float32<span class=\"pl-k\">&gt;</span>\n\nIn [<span class=\"pl-c1\">10</span>]: z\nOut[<span class=\"pl-c1\">10</span>]: <span class=\"pl-k\">&lt;</span>tf.Tensor <span class=\"pl-s\"><span class=\"pl-pds\">'</span>TopKV2:1<span class=\"pl-pds\">'</span></span> shape<span class=\"pl-k\">=</span>(<span class=\"pl-c1\">10</span>,) dtype<span class=\"pl-k\">=</span>int32<span class=\"pl-k\">&gt;</span></pre></div>\n</li>\n<li>\n<p>Output array types are not correctly propagated.</p>\n</li>\n<li>\n<p>First output array name should not be appended with <code>\":0\"</code> because it is deliberately removed <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/lite/toco/import_tensorflow.cc#L2039\">here</a>.</p>\n</li>\n<li>\n<p>If <code>k</code> is provided at run time, two output arrays will be dynamic, and have shape [..., 0] <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/lite/toco/graph_transformations/propagate_fixed_sizes.cc#L1142-L1143\">here</a>. I changed toco to only check constant buffers instead, RFC.</p>\n</li>\n</ol>", "body_text": "Not sure if Google is planning a breaking change. If not:\n\n\nThe topk_v2 implementation has its output values and indices in the opposite order.\nBelow is TensorFlow Python API behavior:\nIn [5]: x\nOut[5]: <tf.Tensor 'x:0' shape=(100,) dtype=float32>\n\nIn [7]: y, z = tf.nn.top_k(x, k=10)\n\nIn [8]: y\nOut[8]: <tf.Tensor 'TopKV2:0' shape=(10,) dtype=float32>\n\nIn [10]: z\nOut[10]: <tf.Tensor 'TopKV2:1' shape=(10,) dtype=int32>\n\n\nOutput array types are not correctly propagated.\n\n\nFirst output array name should not be appended with \":0\" because it is deliberately removed here.\n\n\nIf k is provided at run time, two output arrays will be dynamic, and have shape [..., 0] here. I changed toco to only check constant buffers instead, RFC.", "body": "Not sure if Google is planning a breaking change. If not:\r\n\r\n1. The topk_v2 implementation has its output **values** and **indices** in the opposite order.\r\n\r\n    Below is TensorFlow Python API behavior:\r\n\r\n    ```python\r\n    In [5]: x\r\n    Out[5]: <tf.Tensor 'x:0' shape=(100,) dtype=float32>\r\n\r\n    In [7]: y, z = tf.nn.top_k(x, k=10)\r\n\r\n    In [8]: y\r\n    Out[8]: <tf.Tensor 'TopKV2:0' shape=(10,) dtype=float32>\r\n\r\n    In [10]: z\r\n    Out[10]: <tf.Tensor 'TopKV2:1' shape=(10,) dtype=int32>\r\n    ```\r\n\r\n2. Output array types are not correctly propagated.\r\n3. First output array name should not be appended with `\":0\"` because it is deliberately removed [here](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/lite/toco/import_tensorflow.cc#L2039).\r\n4. If `k` is provided at run time, two output arrays will be dynamic, and have shape [..., 0] [here](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/lite/toco/graph_transformations/propagate_fixed_sizes.cc#L1142-L1143). I changed toco to only check constant buffers instead, RFC."}