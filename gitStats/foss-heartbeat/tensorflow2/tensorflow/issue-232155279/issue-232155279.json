{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10281", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10281/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10281/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10281/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/10281", "id": 232155279, "node_id": "MDU6SXNzdWUyMzIxNTUyNzk=", "number": 10281, "title": "//tensorflow/python:function_test is passing without GPU support but failing with GPU support", "user": {"login": "sandipmgiri", "id": 16284232, "node_id": "MDQ6VXNlcjE2Mjg0MjMy", "avatar_url": "https://avatars0.githubusercontent.com/u/16284232?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sandipmgiri", "html_url": "https://github.com/sandipmgiri", "followers_url": "https://api.github.com/users/sandipmgiri/followers", "following_url": "https://api.github.com/users/sandipmgiri/following{/other_user}", "gists_url": "https://api.github.com/users/sandipmgiri/gists{/gist_id}", "starred_url": "https://api.github.com/users/sandipmgiri/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sandipmgiri/subscriptions", "organizations_url": "https://api.github.com/users/sandipmgiri/orgs", "repos_url": "https://api.github.com/users/sandipmgiri/repos", "events_url": "https://api.github.com/users/sandipmgiri/events{/privacy}", "received_events_url": "https://api.github.com/users/sandipmgiri/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-05-30T06:34:58Z", "updated_at": "2017-06-01T11:18:24Z", "closed_at": "2017-06-01T11:18:24Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nUbuntu 16.04 (ppc64le)</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>:<br>\nInstalled from source (v1.0.1)</li>\n<li><strong>TensorFlow version (use command below)</strong>:<br>\n('v1.0.1-0-ge895d5c-dirty', '1.0.1')</li>\n<li><strong>Bazel version (if compiling from source)</strong>:<br>\n0.4.4-2017-05-26 (@80a07b5)</li>\n<li><strong>CUDA/cuDNN version</strong>:<br>\nCUDA = 8.0 and cuDNN = 5.1</li>\n<li><strong>GPU model and memory</strong>:<br>\nGPU 0: Tesla P100-SXM2-16GB<br>\nGPU 1: Tesla P100-SXM2-16GB</li>\n<li><strong>Exact command to reproduce</strong>:<br>\nbazel test --config=opt --config=cuda  //tensorflow/python:function_test</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>If we run this test without CUDA then its passing, however with CUDA getting failure i.e.  \"array mismatch 0.64697265625%\" error , see below for details :</p>\n<h3>Source code / logs</h3>\n<pre><code>$ bazel test --config=opt --config=cuda //tensorflow/python:function_test\n\nexec ${PAGER:-/usr/bin/less} \"$0\" || exit 1\n-----------------------------------------------------------------------------\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcublas.so.8.0 locally\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcudnn.so.5 locally\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcufft.so.8.0 locally\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcuda.so.1 locally\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcurand.so.8.0 locally\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:885] Found device 0 with properties:\nname: Tesla P100-SXM2-16GB\nmajor: 6 minor: 0 memoryClockRate (GHz) 1.4805\npciBusID 0002:01:00.0\nTotal memory: 15.89GiB\nFree memory: 15.61GiB\nW tensorflow/stream_executor/cuda/cuda_driver.cc:590] creating context when one is currently active; existing: 0x10002b8ea90\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:885] Found device 1 with properties:\nname: Tesla P100-SXM2-16GB\nmajor: 6 minor: 0 memoryClockRate (GHz) 1.4805\npciBusID 0006:01:00.0\nTotal memory: 15.89GiB\nFree memory: 15.61GiB\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:777] Peer access not supported between device ordinals 0 and 1\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:777] Peer access not supported between device ordinals 1 and 0\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:906] DMA: 0 1\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:916] 0:   Y N\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:916] 1:   N Y\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -&gt; (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -&gt; (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\nI tensorflow/compiler/xla/service/platform_util.cc:58] platform CUDA present with 2 visible devices\nI tensorflow/compiler/xla/service/platform_util.cc:58] platform Host present with 160 visible devices\nI tensorflow/compiler/xla/service/service.cc:180] XLA service executing computations on platform Host. Devices:\nI tensorflow/compiler/xla/service/service.cc:187]   StreamExecutor device (0): &lt;undefined&gt;, &lt;undefined&gt;\nI tensorflow/compiler/xla/service/platform_util.cc:58] platform CUDA present with 2 visible devices\nI tensorflow/compiler/xla/service/platform_util.cc:58] platform Host present with 160 visible devices\nI tensorflow/compiler/xla/service/service.cc:180] XLA service executing computations on platform CUDA. Devices:\nI tensorflow/compiler/xla/service/service.cc:187]   StreamExecutor device (0): Tesla P100-SXM2-16GB, Compute Capability 6.0\nI tensorflow/compiler/xla/service/service.cc:187]   StreamExecutor device (1): Tesla P100-SXM2-16GB, Compute Capability 6.0\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcupti.so.8.0 locally\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -&gt; (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -&gt; (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\n..I tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -&gt; (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -&gt; (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\n..I tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -&gt; (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -&gt; (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\n.\n.\n.\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -&gt; (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -&gt; (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\nF.I tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -&gt; (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -&gt; (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -&gt; (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -&gt; (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\n..\n======================================================================\nFAIL: testUnrollLSTMGrad (__main__.UnrollLSTMTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/amit/.cache/bazel/_bazel_amit/c2069970ba4ea955300413b19a88640d/execroot/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/function_test.runfiles/org_tensorflow/tensorflow/python/framework/function_test.py\", line 832, in testUnrollLSTMGrad\n    self.assertAllClose(d0, d1, rtol=1e-4)\n  File \"/home/amit/.cache/bazel/_bazel_amit/c2069970ba4ea955300413b19a88640d/execroot/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/function_test.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 485, in assertAllClose\n    np.testing.assert_allclose(a, b, rtol=rtol, atol=atol)\n  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 1411, in assert_allclose\n    verbose=verbose, header=header, equal_nan=equal_nan)\n  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 796, in assert_array_compare\n    raise AssertionError(msg)\nAssertionError:\nNot equal to tolerance rtol=0.0001, atol=1e-06\n\n(mismatch 0.64697265625%)\n x: array([[[ 4.276238,  0.15792 ,  0.614052, ...,  2.567241,  0.883315,\n          0.162565],\n        [ 3.256324,  0.069458,  1.132122, ...,  2.211422,  0.491486,...\n y: array([[[ 4.276276,  0.15792 ,  0.614058, ...,  2.567239,  0.883316,\n          0.162566],\n        [ 3.256359,  0.069458,  1.132127, ...,  2.211414,  0.491488,...\n\n----------------------------------------------------------------------\nRan 41 tests in 14.361s\n\nFAILED (failures=1)\n255.971 13.0395\n255.971 13.0395\nnot close where =  (array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n       0, 0, 0, 0, 0, 0, 0]), array([ 0,  1,  4,  6,  6,  8,  8,  9, 11, 12, 12, 13, 13, 15, 18, 19, 26,\n       26, 26, 28, 28, 29, 29, 30, 30, 31, 31, 32, 33, 34, 34, 34, 39, 41,\n       41, 42, 42, 43, 45, 47, 48, 48, 50, 50, 50, 52, 55, 55, 55, 57, 59,\n       61, 62]), array([110,  49,  28, 110, 117,  24,  45,  24, 117,  45,  85,  28, 110,\n       104,  20,  13,  21,  28, 109,  24, 104, 110, 117,  45, 117, 104,\n       110, 106,  23,   0,  77,  87,  13,  28,  49,  53,  89, 110,  49,\n        28,  49, 122,  21,  23,  87,  45,  45,  87, 112, 124,  28,   7,  36]))\nnot close lhs =  [ 0.00964716  0.0108541  -0.02481478  0.01410314 -0.01004539 -0.00598446\n -0.06178713 -0.00234316  0.00250508  0.13677871  0.01347511  0.03004426\n -0.02344483  0.03969495 -0.00342371  0.06425443  0.04404789  0.01697282\n  0.00173055  0.00629981 -0.07690701  0.01800087  0.00182568  0.10605431\n -0.00270458  0.01780143  0.00939897 -0.01084067 -0.00755548  0.00419208\n -0.00418841 -0.00287345  0.05488337 -0.03028315  0.00747772 -0.00952677\n  0.01471797 -0.00804311  0.01273583  0.00947097  0.00700331 -0.00019016\n  0.03132032  0.14848644 -0.00288739 -0.01046085  0.0042536   0.04803397\n  0.0140109  -0.03605841 -0.00635294  0.16805029 -0.01475533]\nnot close rhs =  [ 0.0096446   0.01085714 -0.02482039  0.01410037 -0.01004928 -0.00598631\n -0.06180775 -0.00234506  0.00250115  0.13676071  0.01347163  0.03003997\n -0.02344918  0.03968659 -0.00342231  0.06426588  0.04405451  0.0169698\n  0.00172922  0.00629799 -0.07691711  0.01799804  0.00182213  0.1060307\n -0.0027072   0.01779342  0.00939631 -0.01084429 -0.00755821  0.00418651\n -0.00418626 -0.00287483  0.05489143 -0.03027856  0.0074747  -0.00952475\n  0.01471417 -0.00804621  0.01273203  0.00946853  0.00700712 -0.00019156\n  0.03132723  0.14846958 -0.00288068 -0.01046896  0.00425826  0.04802619\n  0.01401426 -0.03605241 -0.00635018  0.16807139 -0.01475281]\nnot close dif =  [  2.56299973e-06   3.04728746e-06   5.60283661e-06   2.77161598e-06\n   3.88920307e-06   1.84774399e-06   2.06232071e-05   1.89989805e-06\n   3.93390656e-06   1.80006027e-05   3.47942114e-06   4.29153442e-06\n  4.35113907e-06   8.35955143e-06   1.40070915e-06   1.14440918e-05\n   6.61611557e-06   3.02493572e-06   1.32620335e-06   1.81794167e-06\n   1.01029873e-05   2.83122063e-06   3.54647636e-06   2.36034393e-05\n   2.62260437e-06   8.01682472e-06   2.65240669e-06   3.62098217e-06\n   2.72691250e-06   5.57303429e-06   2.15321779e-06   1.37463212e-06\n   8.05780292e-06   4.58955765e-06   3.01748514e-06   2.02655792e-06\n   3.79979610e-06   3.09944153e-06   3.79979610e-06   2.44379044e-06\n   3.81469727e-06   1.40070915e-06   6.91413879e-06   1.68532133e-05\n   6.71669841e-06   8.10623169e-06   4.66406345e-06   7.78585672e-06\n   3.36393714e-06   5.99771738e-06   2.75671482e-06   2.11000443e-05\n   2.51457095e-06]\nnot close tol =  [  1.96445990e-06   2.08571419e-06   3.48203866e-06   2.41003727e-06\n   2.00492832e-06   1.59863112e-06   7.18077490e-06   1.23450559e-06\n   1.25011445e-06   1.46760713e-05   2.34716254e-06   4.00399631e-06\n   3.34491824e-06   4.96865869e-06   1.34223126e-06   7.42658722e-06\n   5.40545079e-06   2.69698012e-06   1.17292200e-06   1.62979904e-06\n   8.69171163e-06   2.79980395e-06   1.18221283e-06   1.16030706e-05\n   1.27071985e-06   2.77934168e-06   1.93963137e-06   2.08442907e-06\n   1.75582113e-06   1.41865110e-06   1.41862574e-06   1.28748252e-06\n   6.48914238e-06   4.02785645e-06   1.74746981e-06   1.95247480e-06\n   2.47141656e-06   1.80462098e-06   2.27320288e-06   1.94685254e-06\n   1.70071212e-06   1.01915577e-06   4.13272301e-06   1.58469575e-05\n   1.28806778e-06   2.04689604e-06   1.42582599e-06   5.80261849e-06\n   2.40142572e-06   4.60524143e-06   1.63501818e-06   1.78071386e-05\n   2.47528124e-06]\ndtype = float32, shape = (1, 64, 128)\n</code></pre>\n<p>Any comments/suggestions ?</p>", "body_text": "System information\n\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nUbuntu 16.04 (ppc64le)\nTensorFlow installed from (source or binary):\nInstalled from source (v1.0.1)\nTensorFlow version (use command below):\n('v1.0.1-0-ge895d5c-dirty', '1.0.1')\nBazel version (if compiling from source):\n0.4.4-2017-05-26 (@80a07b5)\nCUDA/cuDNN version:\nCUDA = 8.0 and cuDNN = 5.1\nGPU model and memory:\nGPU 0: Tesla P100-SXM2-16GB\nGPU 1: Tesla P100-SXM2-16GB\nExact command to reproduce:\nbazel test --config=opt --config=cuda  //tensorflow/python:function_test\n\nDescribe the problem\nIf we run this test without CUDA then its passing, however with CUDA getting failure i.e.  \"array mismatch 0.64697265625%\" error , see below for details :\nSource code / logs\n$ bazel test --config=opt --config=cuda //tensorflow/python:function_test\n\nexec ${PAGER:-/usr/bin/less} \"$0\" || exit 1\n-----------------------------------------------------------------------------\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcublas.so.8.0 locally\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcudnn.so.5 locally\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcufft.so.8.0 locally\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcuda.so.1 locally\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcurand.so.8.0 locally\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:885] Found device 0 with properties:\nname: Tesla P100-SXM2-16GB\nmajor: 6 minor: 0 memoryClockRate (GHz) 1.4805\npciBusID 0002:01:00.0\nTotal memory: 15.89GiB\nFree memory: 15.61GiB\nW tensorflow/stream_executor/cuda/cuda_driver.cc:590] creating context when one is currently active; existing: 0x10002b8ea90\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:885] Found device 1 with properties:\nname: Tesla P100-SXM2-16GB\nmajor: 6 minor: 0 memoryClockRate (GHz) 1.4805\npciBusID 0006:01:00.0\nTotal memory: 15.89GiB\nFree memory: 15.61GiB\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:777] Peer access not supported between device ordinals 0 and 1\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:777] Peer access not supported between device ordinals 1 and 0\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:906] DMA: 0 1\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:916] 0:   Y N\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:916] 1:   N Y\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -> (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\nI tensorflow/compiler/xla/service/platform_util.cc:58] platform CUDA present with 2 visible devices\nI tensorflow/compiler/xla/service/platform_util.cc:58] platform Host present with 160 visible devices\nI tensorflow/compiler/xla/service/service.cc:180] XLA service executing computations on platform Host. Devices:\nI tensorflow/compiler/xla/service/service.cc:187]   StreamExecutor device (0): <undefined>, <undefined>\nI tensorflow/compiler/xla/service/platform_util.cc:58] platform CUDA present with 2 visible devices\nI tensorflow/compiler/xla/service/platform_util.cc:58] platform Host present with 160 visible devices\nI tensorflow/compiler/xla/service/service.cc:180] XLA service executing computations on platform CUDA. Devices:\nI tensorflow/compiler/xla/service/service.cc:187]   StreamExecutor device (0): Tesla P100-SXM2-16GB, Compute Capability 6.0\nI tensorflow/compiler/xla/service/service.cc:187]   StreamExecutor device (1): Tesla P100-SXM2-16GB, Compute Capability 6.0\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcupti.so.8.0 locally\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -> (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\n..I tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -> (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\n..I tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -> (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\n.\n.\n.\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -> (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\nF.I tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -> (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -> (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\n..\n======================================================================\nFAIL: testUnrollLSTMGrad (__main__.UnrollLSTMTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/amit/.cache/bazel/_bazel_amit/c2069970ba4ea955300413b19a88640d/execroot/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/function_test.runfiles/org_tensorflow/tensorflow/python/framework/function_test.py\", line 832, in testUnrollLSTMGrad\n    self.assertAllClose(d0, d1, rtol=1e-4)\n  File \"/home/amit/.cache/bazel/_bazel_amit/c2069970ba4ea955300413b19a88640d/execroot/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/function_test.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 485, in assertAllClose\n    np.testing.assert_allclose(a, b, rtol=rtol, atol=atol)\n  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 1411, in assert_allclose\n    verbose=verbose, header=header, equal_nan=equal_nan)\n  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 796, in assert_array_compare\n    raise AssertionError(msg)\nAssertionError:\nNot equal to tolerance rtol=0.0001, atol=1e-06\n\n(mismatch 0.64697265625%)\n x: array([[[ 4.276238,  0.15792 ,  0.614052, ...,  2.567241,  0.883315,\n          0.162565],\n        [ 3.256324,  0.069458,  1.132122, ...,  2.211422,  0.491486,...\n y: array([[[ 4.276276,  0.15792 ,  0.614058, ...,  2.567239,  0.883316,\n          0.162566],\n        [ 3.256359,  0.069458,  1.132127, ...,  2.211414,  0.491488,...\n\n----------------------------------------------------------------------\nRan 41 tests in 14.361s\n\nFAILED (failures=1)\n255.971 13.0395\n255.971 13.0395\nnot close where =  (array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n       0, 0, 0, 0, 0, 0, 0]), array([ 0,  1,  4,  6,  6,  8,  8,  9, 11, 12, 12, 13, 13, 15, 18, 19, 26,\n       26, 26, 28, 28, 29, 29, 30, 30, 31, 31, 32, 33, 34, 34, 34, 39, 41,\n       41, 42, 42, 43, 45, 47, 48, 48, 50, 50, 50, 52, 55, 55, 55, 57, 59,\n       61, 62]), array([110,  49,  28, 110, 117,  24,  45,  24, 117,  45,  85,  28, 110,\n       104,  20,  13,  21,  28, 109,  24, 104, 110, 117,  45, 117, 104,\n       110, 106,  23,   0,  77,  87,  13,  28,  49,  53,  89, 110,  49,\n        28,  49, 122,  21,  23,  87,  45,  45,  87, 112, 124,  28,   7,  36]))\nnot close lhs =  [ 0.00964716  0.0108541  -0.02481478  0.01410314 -0.01004539 -0.00598446\n -0.06178713 -0.00234316  0.00250508  0.13677871  0.01347511  0.03004426\n -0.02344483  0.03969495 -0.00342371  0.06425443  0.04404789  0.01697282\n  0.00173055  0.00629981 -0.07690701  0.01800087  0.00182568  0.10605431\n -0.00270458  0.01780143  0.00939897 -0.01084067 -0.00755548  0.00419208\n -0.00418841 -0.00287345  0.05488337 -0.03028315  0.00747772 -0.00952677\n  0.01471797 -0.00804311  0.01273583  0.00947097  0.00700331 -0.00019016\n  0.03132032  0.14848644 -0.00288739 -0.01046085  0.0042536   0.04803397\n  0.0140109  -0.03605841 -0.00635294  0.16805029 -0.01475533]\nnot close rhs =  [ 0.0096446   0.01085714 -0.02482039  0.01410037 -0.01004928 -0.00598631\n -0.06180775 -0.00234506  0.00250115  0.13676071  0.01347163  0.03003997\n -0.02344918  0.03968659 -0.00342231  0.06426588  0.04405451  0.0169698\n  0.00172922  0.00629799 -0.07691711  0.01799804  0.00182213  0.1060307\n -0.0027072   0.01779342  0.00939631 -0.01084429 -0.00755821  0.00418651\n -0.00418626 -0.00287483  0.05489143 -0.03027856  0.0074747  -0.00952475\n  0.01471417 -0.00804621  0.01273203  0.00946853  0.00700712 -0.00019156\n  0.03132723  0.14846958 -0.00288068 -0.01046896  0.00425826  0.04802619\n  0.01401426 -0.03605241 -0.00635018  0.16807139 -0.01475281]\nnot close dif =  [  2.56299973e-06   3.04728746e-06   5.60283661e-06   2.77161598e-06\n   3.88920307e-06   1.84774399e-06   2.06232071e-05   1.89989805e-06\n   3.93390656e-06   1.80006027e-05   3.47942114e-06   4.29153442e-06\n  4.35113907e-06   8.35955143e-06   1.40070915e-06   1.14440918e-05\n   6.61611557e-06   3.02493572e-06   1.32620335e-06   1.81794167e-06\n   1.01029873e-05   2.83122063e-06   3.54647636e-06   2.36034393e-05\n   2.62260437e-06   8.01682472e-06   2.65240669e-06   3.62098217e-06\n   2.72691250e-06   5.57303429e-06   2.15321779e-06   1.37463212e-06\n   8.05780292e-06   4.58955765e-06   3.01748514e-06   2.02655792e-06\n   3.79979610e-06   3.09944153e-06   3.79979610e-06   2.44379044e-06\n   3.81469727e-06   1.40070915e-06   6.91413879e-06   1.68532133e-05\n   6.71669841e-06   8.10623169e-06   4.66406345e-06   7.78585672e-06\n   3.36393714e-06   5.99771738e-06   2.75671482e-06   2.11000443e-05\n   2.51457095e-06]\nnot close tol =  [  1.96445990e-06   2.08571419e-06   3.48203866e-06   2.41003727e-06\n   2.00492832e-06   1.59863112e-06   7.18077490e-06   1.23450559e-06\n   1.25011445e-06   1.46760713e-05   2.34716254e-06   4.00399631e-06\n   3.34491824e-06   4.96865869e-06   1.34223126e-06   7.42658722e-06\n   5.40545079e-06   2.69698012e-06   1.17292200e-06   1.62979904e-06\n   8.69171163e-06   2.79980395e-06   1.18221283e-06   1.16030706e-05\n   1.27071985e-06   2.77934168e-06   1.93963137e-06   2.08442907e-06\n   1.75582113e-06   1.41865110e-06   1.41862574e-06   1.28748252e-06\n   6.48914238e-06   4.02785645e-06   1.74746981e-06   1.95247480e-06\n   2.47141656e-06   1.80462098e-06   2.27320288e-06   1.94685254e-06\n   1.70071212e-06   1.01915577e-06   4.13272301e-06   1.58469575e-05\n   1.28806778e-06   2.04689604e-06   1.42582599e-06   5.80261849e-06\n   2.40142572e-06   4.60524143e-06   1.63501818e-06   1.78071386e-05\n   2.47528124e-06]\ndtype = float32, shape = (1, 64, 128)\n\nAny comments/suggestions ?", "body": "### System information\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\n     Ubuntu 16.04 (ppc64le)\r\n- **TensorFlow installed from (source or binary)**:\r\n     Installed from source (v1.0.1)\r\n- **TensorFlow version (use command below)**:\r\n    ('v1.0.1-0-ge895d5c-dirty', '1.0.1')\r\n- **Bazel version (if compiling from source)**:\r\n    0.4.4-2017-05-26 (@80a07b5)\r\n- **CUDA/cuDNN version**:\r\n     CUDA = 8.0 and cuDNN = 5.1\r\n- **GPU model and memory**:  \r\n     GPU 0: Tesla P100-SXM2-16GB \r\n     GPU 1: Tesla P100-SXM2-16GB\r\n- **Exact command to reproduce**:\r\n      bazel test --config=opt --config=cuda  //tensorflow/python:function_test\r\n\r\n### Describe the problem\r\nIf we run this test without CUDA then its passing, however with CUDA getting failure i.e.  \"array mismatch 0.64697265625%\" error , see below for details : \r\n\r\n### Source code / logs\r\n```\r\n$ bazel test --config=opt --config=cuda //tensorflow/python:function_test\r\n\r\nexec ${PAGER:-/usr/bin/less} \"$0\" || exit 1\r\n-----------------------------------------------------------------------------\r\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcublas.so.8.0 locally\r\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcudnn.so.5 locally\r\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcufft.so.8.0 locally\r\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcuda.so.1 locally\r\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcurand.so.8.0 locally\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:885] Found device 0 with properties:\r\nname: Tesla P100-SXM2-16GB\r\nmajor: 6 minor: 0 memoryClockRate (GHz) 1.4805\r\npciBusID 0002:01:00.0\r\nTotal memory: 15.89GiB\r\nFree memory: 15.61GiB\r\nW tensorflow/stream_executor/cuda/cuda_driver.cc:590] creating context when one is currently active; existing: 0x10002b8ea90\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:885] Found device 1 with properties:\r\nname: Tesla P100-SXM2-16GB\r\nmajor: 6 minor: 0 memoryClockRate (GHz) 1.4805\r\npciBusID 0006:01:00.0\r\nTotal memory: 15.89GiB\r\nFree memory: 15.61GiB\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:777] Peer access not supported between device ordinals 0 and 1\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:777] Peer access not supported between device ordinals 1 and 0\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:906] DMA: 0 1\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:916] 0:   Y N\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:916] 1:   N Y\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -> (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\r\nI tensorflow/compiler/xla/service/platform_util.cc:58] platform CUDA present with 2 visible devices\r\nI tensorflow/compiler/xla/service/platform_util.cc:58] platform Host present with 160 visible devices\r\nI tensorflow/compiler/xla/service/service.cc:180] XLA service executing computations on platform Host. Devices:\r\nI tensorflow/compiler/xla/service/service.cc:187]   StreamExecutor device (0): <undefined>, <undefined>\r\nI tensorflow/compiler/xla/service/platform_util.cc:58] platform CUDA present with 2 visible devices\r\nI tensorflow/compiler/xla/service/platform_util.cc:58] platform Host present with 160 visible devices\r\nI tensorflow/compiler/xla/service/service.cc:180] XLA service executing computations on platform CUDA. Devices:\r\nI tensorflow/compiler/xla/service/service.cc:187]   StreamExecutor device (0): Tesla P100-SXM2-16GB, Compute Capability 6.0\r\nI tensorflow/compiler/xla/service/service.cc:187]   StreamExecutor device (1): Tesla P100-SXM2-16GB, Compute Capability 6.0\r\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcupti.so.8.0 locally\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -> (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\r\n..I tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -> (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\r\n..I tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -> (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\r\n.\r\n.\r\n.\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -> (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\r\nF.I tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -> (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Tesla P100-SXM2-16GB, pci bus id: 0002:01:00.0)\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:1) -> (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\r\n..\r\n======================================================================\r\nFAIL: testUnrollLSTMGrad (__main__.UnrollLSTMTest)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/home/amit/.cache/bazel/_bazel_amit/c2069970ba4ea955300413b19a88640d/execroot/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/function_test.runfiles/org_tensorflow/tensorflow/python/framework/function_test.py\", line 832, in testUnrollLSTMGrad\r\n    self.assertAllClose(d0, d1, rtol=1e-4)\r\n  File \"/home/amit/.cache/bazel/_bazel_amit/c2069970ba4ea955300413b19a88640d/execroot/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/function_test.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 485, in assertAllClose\r\n    np.testing.assert_allclose(a, b, rtol=rtol, atol=atol)\r\n  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 1411, in assert_allclose\r\n    verbose=verbose, header=header, equal_nan=equal_nan)\r\n  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 796, in assert_array_compare\r\n    raise AssertionError(msg)\r\nAssertionError:\r\nNot equal to tolerance rtol=0.0001, atol=1e-06\r\n\r\n(mismatch 0.64697265625%)\r\n x: array([[[ 4.276238,  0.15792 ,  0.614052, ...,  2.567241,  0.883315,\r\n          0.162565],\r\n        [ 3.256324,  0.069458,  1.132122, ...,  2.211422,  0.491486,...\r\n y: array([[[ 4.276276,  0.15792 ,  0.614058, ...,  2.567239,  0.883316,\r\n          0.162566],\r\n        [ 3.256359,  0.069458,  1.132127, ...,  2.211414,  0.491488,...\r\n\r\n----------------------------------------------------------------------\r\nRan 41 tests in 14.361s\r\n\r\nFAILED (failures=1)\r\n255.971 13.0395\r\n255.971 13.0395\r\nnot close where =  (array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\r\n       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\r\n       0, 0, 0, 0, 0, 0, 0]), array([ 0,  1,  4,  6,  6,  8,  8,  9, 11, 12, 12, 13, 13, 15, 18, 19, 26,\r\n       26, 26, 28, 28, 29, 29, 30, 30, 31, 31, 32, 33, 34, 34, 34, 39, 41,\r\n       41, 42, 42, 43, 45, 47, 48, 48, 50, 50, 50, 52, 55, 55, 55, 57, 59,\r\n       61, 62]), array([110,  49,  28, 110, 117,  24,  45,  24, 117,  45,  85,  28, 110,\r\n       104,  20,  13,  21,  28, 109,  24, 104, 110, 117,  45, 117, 104,\r\n       110, 106,  23,   0,  77,  87,  13,  28,  49,  53,  89, 110,  49,\r\n        28,  49, 122,  21,  23,  87,  45,  45,  87, 112, 124,  28,   7,  36]))\r\nnot close lhs =  [ 0.00964716  0.0108541  -0.02481478  0.01410314 -0.01004539 -0.00598446\r\n -0.06178713 -0.00234316  0.00250508  0.13677871  0.01347511  0.03004426\r\n -0.02344483  0.03969495 -0.00342371  0.06425443  0.04404789  0.01697282\r\n  0.00173055  0.00629981 -0.07690701  0.01800087  0.00182568  0.10605431\r\n -0.00270458  0.01780143  0.00939897 -0.01084067 -0.00755548  0.00419208\r\n -0.00418841 -0.00287345  0.05488337 -0.03028315  0.00747772 -0.00952677\r\n  0.01471797 -0.00804311  0.01273583  0.00947097  0.00700331 -0.00019016\r\n  0.03132032  0.14848644 -0.00288739 -0.01046085  0.0042536   0.04803397\r\n  0.0140109  -0.03605841 -0.00635294  0.16805029 -0.01475533]\r\nnot close rhs =  [ 0.0096446   0.01085714 -0.02482039  0.01410037 -0.01004928 -0.00598631\r\n -0.06180775 -0.00234506  0.00250115  0.13676071  0.01347163  0.03003997\r\n -0.02344918  0.03968659 -0.00342231  0.06426588  0.04405451  0.0169698\r\n  0.00172922  0.00629799 -0.07691711  0.01799804  0.00182213  0.1060307\r\n -0.0027072   0.01779342  0.00939631 -0.01084429 -0.00755821  0.00418651\r\n -0.00418626 -0.00287483  0.05489143 -0.03027856  0.0074747  -0.00952475\r\n  0.01471417 -0.00804621  0.01273203  0.00946853  0.00700712 -0.00019156\r\n  0.03132723  0.14846958 -0.00288068 -0.01046896  0.00425826  0.04802619\r\n  0.01401426 -0.03605241 -0.00635018  0.16807139 -0.01475281]\r\nnot close dif =  [  2.56299973e-06   3.04728746e-06   5.60283661e-06   2.77161598e-06\r\n   3.88920307e-06   1.84774399e-06   2.06232071e-05   1.89989805e-06\r\n   3.93390656e-06   1.80006027e-05   3.47942114e-06   4.29153442e-06\r\n  4.35113907e-06   8.35955143e-06   1.40070915e-06   1.14440918e-05\r\n   6.61611557e-06   3.02493572e-06   1.32620335e-06   1.81794167e-06\r\n   1.01029873e-05   2.83122063e-06   3.54647636e-06   2.36034393e-05\r\n   2.62260437e-06   8.01682472e-06   2.65240669e-06   3.62098217e-06\r\n   2.72691250e-06   5.57303429e-06   2.15321779e-06   1.37463212e-06\r\n   8.05780292e-06   4.58955765e-06   3.01748514e-06   2.02655792e-06\r\n   3.79979610e-06   3.09944153e-06   3.79979610e-06   2.44379044e-06\r\n   3.81469727e-06   1.40070915e-06   6.91413879e-06   1.68532133e-05\r\n   6.71669841e-06   8.10623169e-06   4.66406345e-06   7.78585672e-06\r\n   3.36393714e-06   5.99771738e-06   2.75671482e-06   2.11000443e-05\r\n   2.51457095e-06]\r\nnot close tol =  [  1.96445990e-06   2.08571419e-06   3.48203866e-06   2.41003727e-06\r\n   2.00492832e-06   1.59863112e-06   7.18077490e-06   1.23450559e-06\r\n   1.25011445e-06   1.46760713e-05   2.34716254e-06   4.00399631e-06\r\n   3.34491824e-06   4.96865869e-06   1.34223126e-06   7.42658722e-06\r\n   5.40545079e-06   2.69698012e-06   1.17292200e-06   1.62979904e-06\r\n   8.69171163e-06   2.79980395e-06   1.18221283e-06   1.16030706e-05\r\n   1.27071985e-06   2.77934168e-06   1.93963137e-06   2.08442907e-06\r\n   1.75582113e-06   1.41865110e-06   1.41862574e-06   1.28748252e-06\r\n   6.48914238e-06   4.02785645e-06   1.74746981e-06   1.95247480e-06\r\n   2.47141656e-06   1.80462098e-06   2.27320288e-06   1.94685254e-06\r\n   1.70071212e-06   1.01915577e-06   4.13272301e-06   1.58469575e-05\r\n   1.28806778e-06   2.04689604e-06   1.42582599e-06   5.80261849e-06\r\n   2.40142572e-06   4.60524143e-06   1.63501818e-06   1.78071386e-05\r\n   2.47528124e-06]\r\ndtype = float32, shape = (1, 64, 128)\r\n```\r\nAny comments/suggestions ?"}