{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/302632665", "html_url": "https://github.com/tensorflow/tensorflow/issues/9747#issuecomment-302632665", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9747", "id": 302632665, "node_id": "MDEyOklzc3VlQ29tbWVudDMwMjYzMjY2NQ==", "user": {"login": "davsuacar", "id": 2671502, "node_id": "MDQ6VXNlcjI2NzE1MDI=", "avatar_url": "https://avatars1.githubusercontent.com/u/2671502?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davsuacar", "html_url": "https://github.com/davsuacar", "followers_url": "https://api.github.com/users/davsuacar/followers", "following_url": "https://api.github.com/users/davsuacar/following{/other_user}", "gists_url": "https://api.github.com/users/davsuacar/gists{/gist_id}", "starred_url": "https://api.github.com/users/davsuacar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davsuacar/subscriptions", "organizations_url": "https://api.github.com/users/davsuacar/orgs", "repos_url": "https://api.github.com/users/davsuacar/repos", "events_url": "https://api.github.com/users/davsuacar/events{/privacy}", "received_events_url": "https://api.github.com/users/davsuacar/received_events", "type": "User", "site_admin": false}, "created_at": "2017-05-19T07:40:54Z", "updated_at": "2017-05-19T07:45:13Z", "author_association": "NONE", "body_html": "<p>Same case for me. I'm using tf.metrics.accuracy() in my training process.</p>\n<pre><code>self.accuracy_metrics, self.update_accuracy_metrics = tf.metrics.accuracy(self.label,\n                                                                                  self.one_hot,\n                                                                                  name='accuracy')\n</code></pre>\n<p>When I try to restore the saved model:</p>\n<pre><code>new_saver = tf.train.import_meta_graph(save_path + '.meta')\n    new_saver.restore(sess, save_path)\n    graph = tf.get_default_graph()\n</code></pre>\n<p>and use the function accuracy again:</p>\n<pre><code>accuracy_update = graph.get_operation_by_name('accuracy/update_op').outputs[0]\n\ninput_data, output_data = validator.read_batch(config['READ_BUFFER_SIZE'], sys.stdin,\n                                                       config['SEPARATOR'], config['OUTPUT_SIZE'])\ninput_data = input_data.reshape(input_data.shape[0], config['SEQ_LENGTH'], config['N_FEATURES'])\noutput_data = output_data.reshape(output_data.shape[0], config['OUTPUT_SIZE'])\n\naccuracy = sess.run(accuracy_update, {\"data:0\": input_data, \"target:0\": output_data,\n                                                         \"keep_prob:0\": config['KEEP_PROB']})\nprint(accuracy)\n</code></pre>\n<p>it fails:</p>\n<blockquote>\n<p>Traceback (most recent call last):<br>\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/client/session.py\", line 1022, in _do_call<br>\nreturn fn(*args)<br>\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/client/session.py\", line 1004, in _run_fn<br>\nstatus, run_metadata)<br>\nFile \"/usr/lib/python3.4/contextlib.py\", line 66, in <strong>exit</strong><br>\nnext(self.gen)<br>\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/errors_impl.py\", line 466, in raise_exception_on_not_ok_status<br>\npywrap_tensorflow.TF_GetCode(status))<br>\ntensorflow.python.framework.errors_impl.FailedPreconditionError: Attempting to use uninitialized value accuracy/count_1<br>\n[[Node: accuracy/AssignAdd_3 = AssignAdd[T=DT_FLOAT, _class=[\"loc:@accuracy/count_1\"], use_locking=false, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](accuracy/count_1, accuracy/ToFloat_2)]]</p>\n<p>During handling of the above exception, another exception occurred:</p>\n<p>Traceback (most recent call last):<br>\nFile \"main.py\", line 70, in <br>\nmain()<br>\nFile \"main.py\", line 46, in main<br>\n{\"data:0\":input_data.reshape(200, 10, 16), \"label_aux:0\": output_data, \"keep_prob:0\": config['KEEP_PROB']})<br>\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/client/session.py\", line 767, in run<br>\nrun_metadata_ptr)<br>\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/client/session.py\", line 965, in _run<br>\nfeed_dict_string, options, run_metadata)<br>\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/client/session.py\", line 1015, in _do_run<br>\ntarget_list, options, run_metadata)<br>\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/client/session.py\", line 1035, in _do_call<br>\nraise type(e)(node_def, op, message)<br>\ntensorflow.python.framework.errors_impl.FailedPreconditionError: Attempting to use uninitialized value accuracy/count_1<br>\n[[Node: accuracy/AssignAdd_3 = AssignAdd[T=DT_FLOAT, _class=[\"loc:@accuracy/count_1\"], use_locking=false, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](accuracy/count_1, accuracy/ToFloat_2)]]</p>\n<p>Caused by op 'accuracy/AssignAdd_3', defined at:<br>\nFile \"main.py\", line 70, in <br>\nmain()<br>\nFile \"main.py\", line 43, in main<br>\naccuracy_metrics, update_accuracy_metrics = tf.metrics.accuracy(label_operation, one_hot)<br>\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/ops/metrics_impl.py\", line 332, in accuracy<br>\nupdates_collections, name or 'accuracy')<br>\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/ops/metrics_impl.py\", line 267, in mean<br>\nupdate_count_op = state_ops.assign_add(count, num_values)<br>\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/ops/gen_state_ops.py\", line 75, in assign_add<br>\nuse_locking=use_locking, name=name)<br>\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op<br>\nop_def=op_def)<br>\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/ops.py\", line 2327, in create_op<br>\noriginal_op=self._default_original_op, op_def=op_def)<br>\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/ops.py\", line 1226, in <strong>init</strong><br>\nself._traceback = _extract_stack()</p>\n<p>FailedPreconditionError (see above for traceback): Attempting to use uninitialized value accuracy/count_1<br>\n[[Node: accuracy/AssignAdd_3 = AssignAdd[T=DT_FLOAT, _class=[\"loc:@accuracy/count_1\"], use_locking=false, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](accuracy/count_1, accuracy/ToFloat_2)]]</p>\n</blockquote>", "body_text": "Same case for me. I'm using tf.metrics.accuracy() in my training process.\nself.accuracy_metrics, self.update_accuracy_metrics = tf.metrics.accuracy(self.label,\n                                                                                  self.one_hot,\n                                                                                  name='accuracy')\n\nWhen I try to restore the saved model:\nnew_saver = tf.train.import_meta_graph(save_path + '.meta')\n    new_saver.restore(sess, save_path)\n    graph = tf.get_default_graph()\n\nand use the function accuracy again:\naccuracy_update = graph.get_operation_by_name('accuracy/update_op').outputs[0]\n\ninput_data, output_data = validator.read_batch(config['READ_BUFFER_SIZE'], sys.stdin,\n                                                       config['SEPARATOR'], config['OUTPUT_SIZE'])\ninput_data = input_data.reshape(input_data.shape[0], config['SEQ_LENGTH'], config['N_FEATURES'])\noutput_data = output_data.reshape(output_data.shape[0], config['OUTPUT_SIZE'])\n\naccuracy = sess.run(accuracy_update, {\"data:0\": input_data, \"target:0\": output_data,\n                                                         \"keep_prob:0\": config['KEEP_PROB']})\nprint(accuracy)\n\nit fails:\n\nTraceback (most recent call last):\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/client/session.py\", line 1022, in _do_call\nreturn fn(*args)\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/client/session.py\", line 1004, in _run_fn\nstatus, run_metadata)\nFile \"/usr/lib/python3.4/contextlib.py\", line 66, in exit\nnext(self.gen)\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/errors_impl.py\", line 466, in raise_exception_on_not_ok_status\npywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors_impl.FailedPreconditionError: Attempting to use uninitialized value accuracy/count_1\n[[Node: accuracy/AssignAdd_3 = AssignAdd[T=DT_FLOAT, _class=[\"loc:@accuracy/count_1\"], use_locking=false, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](accuracy/count_1, accuracy/ToFloat_2)]]\nDuring handling of the above exception, another exception occurred:\nTraceback (most recent call last):\nFile \"main.py\", line 70, in \nmain()\nFile \"main.py\", line 46, in main\n{\"data:0\":input_data.reshape(200, 10, 16), \"label_aux:0\": output_data, \"keep_prob:0\": config['KEEP_PROB']})\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/client/session.py\", line 767, in run\nrun_metadata_ptr)\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/client/session.py\", line 965, in _run\nfeed_dict_string, options, run_metadata)\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/client/session.py\", line 1015, in _do_run\ntarget_list, options, run_metadata)\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/client/session.py\", line 1035, in _do_call\nraise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.FailedPreconditionError: Attempting to use uninitialized value accuracy/count_1\n[[Node: accuracy/AssignAdd_3 = AssignAdd[T=DT_FLOAT, _class=[\"loc:@accuracy/count_1\"], use_locking=false, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](accuracy/count_1, accuracy/ToFloat_2)]]\nCaused by op 'accuracy/AssignAdd_3', defined at:\nFile \"main.py\", line 70, in \nmain()\nFile \"main.py\", line 43, in main\naccuracy_metrics, update_accuracy_metrics = tf.metrics.accuracy(label_operation, one_hot)\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/ops/metrics_impl.py\", line 332, in accuracy\nupdates_collections, name or 'accuracy')\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/ops/metrics_impl.py\", line 267, in mean\nupdate_count_op = state_ops.assign_add(count, num_values)\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/ops/gen_state_ops.py\", line 75, in assign_add\nuse_locking=use_locking, name=name)\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\nop_def=op_def)\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/ops.py\", line 2327, in create_op\noriginal_op=self._default_original_op, op_def=op_def)\nFile \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/ops.py\", line 1226, in init\nself._traceback = _extract_stack()\nFailedPreconditionError (see above for traceback): Attempting to use uninitialized value accuracy/count_1\n[[Node: accuracy/AssignAdd_3 = AssignAdd[T=DT_FLOAT, _class=[\"loc:@accuracy/count_1\"], use_locking=false, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](accuracy/count_1, accuracy/ToFloat_2)]]", "body": "Same case for me. I'm using tf.metrics.accuracy() in my training process.\r\n```\r\nself.accuracy_metrics, self.update_accuracy_metrics = tf.metrics.accuracy(self.label,\r\n                                                                                  self.one_hot,\r\n                                                                                  name='accuracy')\r\n```\r\n\r\nWhen I try to restore the saved model:\r\n```\r\nnew_saver = tf.train.import_meta_graph(save_path + '.meta')\r\n    new_saver.restore(sess, save_path)\r\n    graph = tf.get_default_graph()\r\n```\r\n and use the function accuracy again:\r\n```\r\naccuracy_update = graph.get_operation_by_name('accuracy/update_op').outputs[0]\r\n\r\ninput_data, output_data = validator.read_batch(config['READ_BUFFER_SIZE'], sys.stdin,\r\n                                                       config['SEPARATOR'], config['OUTPUT_SIZE'])\r\ninput_data = input_data.reshape(input_data.shape[0], config['SEQ_LENGTH'], config['N_FEATURES'])\r\noutput_data = output_data.reshape(output_data.shape[0], config['OUTPUT_SIZE'])\r\n\r\naccuracy = sess.run(accuracy_update, {\"data:0\": input_data, \"target:0\": output_data,\r\n                                                         \"keep_prob:0\": config['KEEP_PROB']})\r\nprint(accuracy)\r\n```\r\nit fails:\r\n\r\n> Traceback (most recent call last):\r\n>   File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/client/session.py\", line 1022, in _do_call\r\n>     return fn(*args)\r\n>   File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/client/session.py\", line 1004, in _run_fn\r\n>     status, run_metadata)\r\n>   File \"/usr/lib/python3.4/contextlib.py\", line 66, in __exit__\r\n>     next(self.gen)\r\n>   File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/errors_impl.py\", line 466, in raise_exception_on_not_ok_status\r\n>     pywrap_tensorflow.TF_GetCode(status))\r\n> tensorflow.python.framework.errors_impl.FailedPreconditionError: Attempting to use uninitialized value accuracy/count_1\r\n> \t [[Node: accuracy/AssignAdd_3 = AssignAdd[T=DT_FLOAT, _class=[\"loc:@accuracy/count_1\"], use_locking=false, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](accuracy/count_1, accuracy/ToFloat_2)]]\r\n> \r\n> During handling of the above exception, another exception occurred:\r\n> \r\n> Traceback (most recent call last):\r\n>   File \"main.py\", line 70, in <module>\r\n>     main()\r\n>   File \"main.py\", line 46, in main\r\n>     {\"data:0\":input_data.reshape(200, 10, 16), \"label_aux:0\": output_data, \"keep_prob:0\": config['KEEP_PROB']})\r\n>   File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/client/session.py\", line 767, in run\r\n>     run_metadata_ptr)\r\n>   File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/client/session.py\", line 965, in _run\r\n>     feed_dict_string, options, run_metadata)\r\n>   File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/client/session.py\", line 1015, in _do_run\r\n>     target_list, options, run_metadata)\r\n>   File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/client/session.py\", line 1035, in _do_call\r\n>     raise type(e)(node_def, op, message)\r\n> tensorflow.python.framework.errors_impl.FailedPreconditionError: Attempting to use uninitialized value accuracy/count_1\r\n> \t [[Node: accuracy/AssignAdd_3 = AssignAdd[T=DT_FLOAT, _class=[\"loc:@accuracy/count_1\"], use_locking=false, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](accuracy/count_1, accuracy/ToFloat_2)]]\r\n> \r\n> Caused by op 'accuracy/AssignAdd_3', defined at:\r\n>   File \"main.py\", line 70, in <module>\r\n>     main()\r\n>   File \"main.py\", line 43, in main\r\n>     accuracy_metrics, update_accuracy_metrics = tf.metrics.accuracy(label_operation, one_hot)\r\n>   File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/ops/metrics_impl.py\", line 332, in accuracy\r\n>     updates_collections, name or 'accuracy')\r\n>   File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/ops/metrics_impl.py\", line 267, in mean\r\n>     update_count_op = state_ops.assign_add(count, num_values)\r\n>   File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/ops/gen_state_ops.py\", line 75, in assign_add\r\n>     use_locking=use_locking, name=name)\r\n>   File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\r\n>     op_def=op_def)\r\n>   File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/ops.py\", line 2327, in create_op\r\n>     original_op=self._default_original_op, op_def=op_def)\r\n>   File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/ops.py\", line 1226, in __init__\r\n>     self._traceback = _extract_stack()\r\n> \r\n> FailedPreconditionError (see above for traceback): Attempting to use uninitialized value accuracy/count_1\r\n> \t [[Node: accuracy/AssignAdd_3 = AssignAdd[T=DT_FLOAT, _class=[\"loc:@accuracy/count_1\"], use_locking=false, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](accuracy/count_1, accuracy/ToFloat_2)]]\r\n> \r\n> "}