{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13477", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13477/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13477/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13477/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/13477", "id": 262599793, "node_id": "MDU6SXNzdWUyNjI1OTk3OTM=", "number": 13477, "title": "Bug in 1.3 Preventing Export of Canned Estimators", "user": {"login": "befowler", "id": 22122319, "node_id": "MDQ6VXNlcjIyMTIyMzE5", "avatar_url": "https://avatars2.githubusercontent.com/u/22122319?v=4", "gravatar_id": "", "url": "https://api.github.com/users/befowler", "html_url": "https://github.com/befowler", "followers_url": "https://api.github.com/users/befowler/followers", "following_url": "https://api.github.com/users/befowler/following{/other_user}", "gists_url": "https://api.github.com/users/befowler/gists{/gist_id}", "starred_url": "https://api.github.com/users/befowler/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/befowler/subscriptions", "organizations_url": "https://api.github.com/users/befowler/orgs", "repos_url": "https://api.github.com/users/befowler/repos", "events_url": "https://api.github.com/users/befowler/events{/privacy}", "received_events_url": "https://api.github.com/users/befowler/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "martinwicke", "id": 577277, "node_id": "MDQ6VXNlcjU3NzI3Nw==", "avatar_url": "https://avatars2.githubusercontent.com/u/577277?v=4", "gravatar_id": "", "url": "https://api.github.com/users/martinwicke", "html_url": "https://github.com/martinwicke", "followers_url": "https://api.github.com/users/martinwicke/followers", "following_url": "https://api.github.com/users/martinwicke/following{/other_user}", "gists_url": "https://api.github.com/users/martinwicke/gists{/gist_id}", "starred_url": "https://api.github.com/users/martinwicke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/martinwicke/subscriptions", "organizations_url": "https://api.github.com/users/martinwicke/orgs", "repos_url": "https://api.github.com/users/martinwicke/repos", "events_url": "https://api.github.com/users/martinwicke/events{/privacy}", "received_events_url": "https://api.github.com/users/martinwicke/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "martinwicke", "id": 577277, "node_id": "MDQ6VXNlcjU3NzI3Nw==", "avatar_url": "https://avatars2.githubusercontent.com/u/577277?v=4", "gravatar_id": "", "url": "https://api.github.com/users/martinwicke", "html_url": "https://github.com/martinwicke", "followers_url": "https://api.github.com/users/martinwicke/followers", "following_url": "https://api.github.com/users/martinwicke/following{/other_user}", "gists_url": "https://api.github.com/users/martinwicke/gists{/gist_id}", "starred_url": "https://api.github.com/users/martinwicke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/martinwicke/subscriptions", "organizations_url": "https://api.github.com/users/martinwicke/orgs", "repos_url": "https://api.github.com/users/martinwicke/repos", "events_url": "https://api.github.com/users/martinwicke/events{/privacy}", "received_events_url": "https://api.github.com/users/martinwicke/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2017-10-03T21:46:11Z", "updated_at": "2018-08-20T09:23:09Z", "closed_at": "2017-10-03T22:08:44Z", "author_association": "NONE", "body_html": "<hr>\n<h3>System information</h3>\n<p>TensorFlow v1.3.0-rc2-20-g0787eee 1.3.0<br>\nPython version 3.5</p>\n<h3>Describe the problem</h3>\n<p>See below Stack Overflow Page.<br>\n<a href=\"https://stackoverflow.com/questions/46098863/how-to-import-an-saved-tensorflow-model-train-using-tf-estimator-and-predict-on\" rel=\"nofollow\">https://stackoverflow.com/questions/46098863/how-to-import-an-saved-tensorflow-model-train-using-tf-estimator-and-predict-on</a></p>\n<p>Use case <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"115894138\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/2\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/2/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/2\">#2</a> is what this bug is about. The model appears to export, but when attempting to perform predictions on new data, the following error message is rendered:<br>\nValueError: Got unexpected keys in input_dict: {'feature1', 'feature2', 'feature3'...}</p>\n<h3>Source code / logs</h3>\n<h3>Code to store the model:</h3>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">def</span> <span class=\"pl-en\">column_to_dtype</span>(<span class=\"pl-smi\">column</span>):\n    <span class=\"pl-k\">if</span> column <span class=\"pl-k\">in</span> <span class=\"pl-c1\">CATEGORICAL_COLUMNS</span>:\n        <span class=\"pl-k\">return</span> tf.string\n    <span class=\"pl-k\">else</span>:\n        <span class=\"pl-k\">return</span> tf.float32\n    \nfeature_spec <span class=\"pl-k\">=</span> {\n    column: tf.FixedLenFeature(<span class=\"pl-v\">shape</span><span class=\"pl-k\">=</span>[<span class=\"pl-c1\">1</span>], <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>column_to_dtype(column))\n        <span class=\"pl-k\">for</span> column <span class=\"pl-k\">in</span> <span class=\"pl-c1\">FEATURE_COLUMNS</span>\n}\nserving_fn <span class=\"pl-k\">=</span> tf.estimator.export.build_parsing_serving_input_receiver_fn(feature_spec)\nservable_model_dir <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>DLModels<span class=\"pl-pds\">\"</span></span>\nservable_model_path <span class=\"pl-k\">=</span> m.export_savedmodel(<span class=\"pl-v\">export_dir_base</span><span class=\"pl-k\">=</span>servable_model_dir,\n                            <span class=\"pl-v\">serving_input_receiver_fn</span><span class=\"pl-k\">=</span>serving_fn)</pre></div>\n<h3>Code to recall the model for predictions on new data:</h3>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">from</span> tensorflow.contrib <span class=\"pl-k\">import</span> predictor\npredict_fn <span class=\"pl-k\">=</span> predictor.from_saved_model(servable_model_path)\npredictions <span class=\"pl-k\">=</span> predict_fn(trainfeatures1)\n<span class=\"pl-c1\">print</span>(predictions)<span class=\"pl-s\"><span class=\"pl-pds\">'''</span></span>\n<span class=\"pl-s\"></span>\n<span class=\"pl-s\">### Error message:</span>\n<span class=\"pl-s\">2017-10-03 21:23:37,175, INFO, Restoring parameters from b'DLModels/1507065657/variables/variables'</span>\n<span class=\"pl-s\">---------------------------------------------------------------------------</span>\n<span class=\"pl-s\">ValueError                                Traceback (most recent call last)</span>\n<span class=\"pl-s\">&lt;ipython-input-3479-70528b4cfb46&gt; in &lt;module&gt;()</span>\n<span class=\"pl-s\">      1 from tensorflow.contrib import predictor</span>\n<span class=\"pl-s\">      2 predict_fn = predictor.from_saved_model(servable_model_path)</span>\n<span class=\"pl-s\">----&gt; 3 predictions = predict_fn(trainfeatures1)</span>\n<span class=\"pl-s\">      4 print(predictions)</span>\n<span class=\"pl-s\"></span>\n<span class=\"pl-s\">/opt/miniconda/lib/python3.5/site-packages/tensorflow/contrib/predictor/predictor.py in __call__(self, input_dict)</span>\n<span class=\"pl-s\">     68     if unexpected_keys:</span>\n<span class=\"pl-s\">     69       raise ValueError('Got unexpected keys in input_dict: <span class=\"pl-c1\">{}</span>'.format(</span>\n<span class=\"pl-s\">---&gt; 70           unexpected_keys))</span>\n<span class=\"pl-s\">     71 </span>\n<span class=\"pl-s\">     72     feed_dict = <span class=\"pl-c1\">{}</span></span>\n<span class=\"pl-s\"></span>\n<span class=\"pl-s\">ValueError: Got unexpected keys in input_dict: {'feature1', 'feature2', 'feature3'}</span></pre></div>", "body_text": "System information\nTensorFlow v1.3.0-rc2-20-g0787eee 1.3.0\nPython version 3.5\nDescribe the problem\nSee below Stack Overflow Page.\nhttps://stackoverflow.com/questions/46098863/how-to-import-an-saved-tensorflow-model-train-using-tf-estimator-and-predict-on\nUse case #2 is what this bug is about. The model appears to export, but when attempting to perform predictions on new data, the following error message is rendered:\nValueError: Got unexpected keys in input_dict: {'feature1', 'feature2', 'feature3'...}\nSource code / logs\nCode to store the model:\ndef column_to_dtype(column):\n    if column in CATEGORICAL_COLUMNS:\n        return tf.string\n    else:\n        return tf.float32\n    \nfeature_spec = {\n    column: tf.FixedLenFeature(shape=[1], dtype=column_to_dtype(column))\n        for column in FEATURE_COLUMNS\n}\nserving_fn = tf.estimator.export.build_parsing_serving_input_receiver_fn(feature_spec)\nservable_model_dir = \"DLModels\"\nservable_model_path = m.export_savedmodel(export_dir_base=servable_model_dir,\n                            serving_input_receiver_fn=serving_fn)\nCode to recall the model for predictions on new data:\nfrom tensorflow.contrib import predictor\npredict_fn = predictor.from_saved_model(servable_model_path)\npredictions = predict_fn(trainfeatures1)\nprint(predictions)'''\n\n### Error message:\n2017-10-03 21:23:37,175, INFO, Restoring parameters from b'DLModels/1507065657/variables/variables'\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-3479-70528b4cfb46> in <module>()\n      1 from tensorflow.contrib import predictor\n      2 predict_fn = predictor.from_saved_model(servable_model_path)\n----> 3 predictions = predict_fn(trainfeatures1)\n      4 print(predictions)\n\n/opt/miniconda/lib/python3.5/site-packages/tensorflow/contrib/predictor/predictor.py in __call__(self, input_dict)\n     68     if unexpected_keys:\n     69       raise ValueError('Got unexpected keys in input_dict: {}'.format(\n---> 70           unexpected_keys))\n     71 \n     72     feed_dict = {}\n\nValueError: Got unexpected keys in input_dict: {'feature1', 'feature2', 'feature3'}", "body": "\r\n------------------------\r\n\r\n### System information\r\n\r\nTensorFlow v1.3.0-rc2-20-g0787eee 1.3.0\r\nPython version 3.5\r\n\r\n\r\n### Describe the problem\r\n\r\nSee below Stack Overflow Page. \r\nhttps://stackoverflow.com/questions/46098863/how-to-import-an-saved-tensorflow-model-train-using-tf-estimator-and-predict-on\r\n\r\nUse case #2 is what this bug is about. The model appears to export, but when attempting to perform predictions on new data, the following error message is rendered: \r\nValueError: Got unexpected keys in input_dict: {'feature1', 'feature2', 'feature3'...}\r\n\r\n### Source code / logs\r\n### Code to store the model:\r\n\r\n```python\r\ndef column_to_dtype(column):\r\n    if column in CATEGORICAL_COLUMNS:\r\n        return tf.string\r\n    else:\r\n        return tf.float32\r\n    \r\nfeature_spec = {\r\n    column: tf.FixedLenFeature(shape=[1], dtype=column_to_dtype(column))\r\n        for column in FEATURE_COLUMNS\r\n}\r\nserving_fn = tf.estimator.export.build_parsing_serving_input_receiver_fn(feature_spec)\r\nservable_model_dir = \"DLModels\"\r\nservable_model_path = m.export_savedmodel(export_dir_base=servable_model_dir,\r\n                            serving_input_receiver_fn=serving_fn)\r\n```\r\n### Code to recall the model for predictions on new data:\r\n```python\r\nfrom tensorflow.contrib import predictor\r\npredict_fn = predictor.from_saved_model(servable_model_path)\r\npredictions = predict_fn(trainfeatures1)\r\nprint(predictions)'''\r\n\r\n### Error message:\r\n2017-10-03 21:23:37,175, INFO, Restoring parameters from b'DLModels/1507065657/variables/variables'\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-3479-70528b4cfb46> in <module>()\r\n      1 from tensorflow.contrib import predictor\r\n      2 predict_fn = predictor.from_saved_model(servable_model_path)\r\n----> 3 predictions = predict_fn(trainfeatures1)\r\n      4 print(predictions)\r\n\r\n/opt/miniconda/lib/python3.5/site-packages/tensorflow/contrib/predictor/predictor.py in __call__(self, input_dict)\r\n     68     if unexpected_keys:\r\n     69       raise ValueError('Got unexpected keys in input_dict: {}'.format(\r\n---> 70           unexpected_keys))\r\n     71 \r\n     72     feed_dict = {}\r\n\r\nValueError: Got unexpected keys in input_dict: {'feature1', 'feature2', 'feature3'}\r\n"}