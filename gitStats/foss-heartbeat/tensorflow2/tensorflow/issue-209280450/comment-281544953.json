{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/281544953", "html_url": "https://github.com/tensorflow/tensorflow/issues/7751#issuecomment-281544953", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7751", "id": 281544953, "node_id": "MDEyOklzc3VlQ29tbWVudDI4MTU0NDk1Mw==", "user": {"login": "Franck-Dernoncourt", "id": 15331, "node_id": "MDQ6VXNlcjE1MzMx", "avatar_url": "https://avatars2.githubusercontent.com/u/15331?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Franck-Dernoncourt", "html_url": "https://github.com/Franck-Dernoncourt", "followers_url": "https://api.github.com/users/Franck-Dernoncourt/followers", "following_url": "https://api.github.com/users/Franck-Dernoncourt/following{/other_user}", "gists_url": "https://api.github.com/users/Franck-Dernoncourt/gists{/gist_id}", "starred_url": "https://api.github.com/users/Franck-Dernoncourt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Franck-Dernoncourt/subscriptions", "organizations_url": "https://api.github.com/users/Franck-Dernoncourt/orgs", "repos_url": "https://api.github.com/users/Franck-Dernoncourt/repos", "events_url": "https://api.github.com/users/Franck-Dernoncourt/events{/privacy}", "received_events_url": "https://api.github.com/users/Franck-Dernoncourt/received_events", "type": "User", "site_admin": false}, "created_at": "2017-02-22T02:03:34Z", "updated_at": "2017-02-22T02:03:34Z", "author_association": "CONTRIBUTOR", "body_html": "<p><code>num_words = 2</code> or <code>num_words = 5</code> work. Good catch, I don't know why <code>num_words - 1</code> is used in the CRF example instead of <code>num_words</code> in the line of code you quote.</p>\n<p><div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/e121667dc609de978a223c56ee906368d2c4ceef/tensorflow/contrib/crf/python/ops/crf.py#L121\">tensorflow/tensorflow/contrib/crf/python/ops/crf.py</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n         Line 121\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/e121667dc609de978a223c56ee906368d2c4ceef\">e121667</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L121\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"121\"></td>\n          <td id=\"LC121\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-v\">sequence_length</span><span class=\"pl-k\">=</span>sequence_lengths <span class=\"pl-k\">-</span> <span class=\"pl-c1\">1</span>, </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n is already decrementing the <code>sequence_length</code> by 1:</p>\n<pre><code> # Compute the alpha values in the forward algorithm in order to get the\n  # partition function.\n  forward_cell = CrfForwardRnnCell(transition_params)\n  _, alphas = rnn.dynamic_rnn(\n      cell=forward_cell,\n      inputs=rest_of_input,\n      sequence_length=sequence_lengths - 1,\n      initial_state=first_input,\n      dtype=dtypes.float32)\n  log_norm = math_ops.reduce_logsumexp(alphas, [1])\n  return log_norm\n</code></pre>\n<p>However, changing <code>sequence_lengths = np.full(num_examples, num_words - 1, dtype=np.int32)</code> to <code>sequence_lengths = np.full(num_examples, num_words, dtype=np.int32)</code> does not solve the issue when <code>num_words = 1</code> .</p>", "body_text": "num_words = 2 or num_words = 5 work. Good catch, I don't know why num_words - 1 is used in the CRF example instead of num_words in the line of code you quote.\n\n  \n    \n      tensorflow/tensorflow/contrib/crf/python/ops/crf.py\n    \n    \n         Line 121\n      in\n      e121667\n    \n    \n    \n    \n\n        \n          \n           sequence_length=sequence_lengths - 1, \n        \n    \n  \n\n is already decrementing the sequence_length by 1:\n # Compute the alpha values in the forward algorithm in order to get the\n  # partition function.\n  forward_cell = CrfForwardRnnCell(transition_params)\n  _, alphas = rnn.dynamic_rnn(\n      cell=forward_cell,\n      inputs=rest_of_input,\n      sequence_length=sequence_lengths - 1,\n      initial_state=first_input,\n      dtype=dtypes.float32)\n  log_norm = math_ops.reduce_logsumexp(alphas, [1])\n  return log_norm\n\nHowever, changing sequence_lengths = np.full(num_examples, num_words - 1, dtype=np.int32) to sequence_lengths = np.full(num_examples, num_words, dtype=np.int32) does not solve the issue when num_words = 1 .", "body": "`num_words = 2` or `num_words = 5` work. Good catch, I don't know why `num_words - 1` is used in the CRF example instead of `num_words` in the line of code you quote.\r\n\r\nhttps://github.com/tensorflow/tensorflow/blob/e121667dc609de978a223c56ee906368d2c4ceef/tensorflow/contrib/crf/python/ops/crf.py#L121 is already decrementing the `sequence_length` by 1:\r\n\r\n```\r\n # Compute the alpha values in the forward algorithm in order to get the\r\n  # partition function.\r\n  forward_cell = CrfForwardRnnCell(transition_params)\r\n  _, alphas = rnn.dynamic_rnn(\r\n      cell=forward_cell,\r\n      inputs=rest_of_input,\r\n      sequence_length=sequence_lengths - 1,\r\n      initial_state=first_input,\r\n      dtype=dtypes.float32)\r\n  log_norm = math_ops.reduce_logsumexp(alphas, [1])\r\n  return log_norm\r\n```\r\n\r\n\r\nHowever, changing `sequence_lengths = np.full(num_examples, num_words - 1, dtype=np.int32)` to `sequence_lengths = np.full(num_examples, num_words, dtype=np.int32)` does not solve the issue when `num_words = 1` ."}