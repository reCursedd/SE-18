{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/390820906", "html_url": "https://github.com/tensorflow/tensorflow/issues/19385#issuecomment-390820906", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19385", "id": 390820906, "node_id": "MDEyOklzc3VlQ29tbWVudDM5MDgyMDkwNg==", "user": {"login": "allenlavoie", "id": 3731025, "node_id": "MDQ6VXNlcjM3MzEwMjU=", "avatar_url": "https://avatars3.githubusercontent.com/u/3731025?v=4", "gravatar_id": "", "url": "https://api.github.com/users/allenlavoie", "html_url": "https://github.com/allenlavoie", "followers_url": "https://api.github.com/users/allenlavoie/followers", "following_url": "https://api.github.com/users/allenlavoie/following{/other_user}", "gists_url": "https://api.github.com/users/allenlavoie/gists{/gist_id}", "starred_url": "https://api.github.com/users/allenlavoie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/allenlavoie/subscriptions", "organizations_url": "https://api.github.com/users/allenlavoie/orgs", "repos_url": "https://api.github.com/users/allenlavoie/repos", "events_url": "https://api.github.com/users/allenlavoie/events{/privacy}", "received_events_url": "https://api.github.com/users/allenlavoie/received_events", "type": "User", "site_admin": false}, "created_at": "2018-05-22T00:00:55Z", "updated_at": "2018-05-22T00:00:55Z", "author_association": "MEMBER", "body_html": "<p>Thank you for the report!</p>\n<p>Narrowed down slightly to eager op execution's interactions with numpy inputs:</p>\n<pre><code>import numpy\n\nfrom tensorflow.python.eager import context\nfrom tensorflow.python.framework import dtypes\nfrom tensorflow.python.ops import gen_nn_ops\nfrom tensorflow.python.ops import array_ops\n\nimport tensorflow as tf\n\ntf.enable_eager_execution()\ninp = array_ops.zeros([1, 10, 10, 3], dtypes.float32)\nfilt = array_ops.zeros([3, 3, 3, 32], dtypes.float32)\nstrides = list(numpy.array([1] * 4))\n\nfor _ in range(10000000):\n  #strides = [int(_i) for _i in strides]\n  gen_nn_ops.conv2d(input=inp, filter=filt, strides=strides, padding='VALID')\n</code></pre>\n<p>And running with <code>--vmodule=pywrap_tfe_src=3</code>:</p>\n<blockquote>\n<p>I0521 16:53:57.182346  110126 pywrap_tfe_src.cc:2212] Falling back to slow path for Op \"Conv2D\" since we are unable to set the value for attr \"strides\" due to: Expecting int64_t value for attr strides, got numpy.int64</p>\n</blockquote>\n<p>So it looks like (1) we should be using the fast path, and (2) the slow path shouldn't leak. <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=122911\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/akshaym\">@akshaym</a> has expressed interest in fixing :)</p>", "body_text": "Thank you for the report!\nNarrowed down slightly to eager op execution's interactions with numpy inputs:\nimport numpy\n\nfrom tensorflow.python.eager import context\nfrom tensorflow.python.framework import dtypes\nfrom tensorflow.python.ops import gen_nn_ops\nfrom tensorflow.python.ops import array_ops\n\nimport tensorflow as tf\n\ntf.enable_eager_execution()\ninp = array_ops.zeros([1, 10, 10, 3], dtypes.float32)\nfilt = array_ops.zeros([3, 3, 3, 32], dtypes.float32)\nstrides = list(numpy.array([1] * 4))\n\nfor _ in range(10000000):\n  #strides = [int(_i) for _i in strides]\n  gen_nn_ops.conv2d(input=inp, filter=filt, strides=strides, padding='VALID')\n\nAnd running with --vmodule=pywrap_tfe_src=3:\n\nI0521 16:53:57.182346  110126 pywrap_tfe_src.cc:2212] Falling back to slow path for Op \"Conv2D\" since we are unable to set the value for attr \"strides\" due to: Expecting int64_t value for attr strides, got numpy.int64\n\nSo it looks like (1) we should be using the fast path, and (2) the slow path shouldn't leak. @akshaym has expressed interest in fixing :)", "body": "Thank you for the report!\r\n\r\nNarrowed down slightly to eager op execution's interactions with numpy inputs:\r\n\r\n```\r\nimport numpy\r\n\r\nfrom tensorflow.python.eager import context\r\nfrom tensorflow.python.framework import dtypes\r\nfrom tensorflow.python.ops import gen_nn_ops\r\nfrom tensorflow.python.ops import array_ops\r\n\r\nimport tensorflow as tf\r\n\r\ntf.enable_eager_execution()\r\ninp = array_ops.zeros([1, 10, 10, 3], dtypes.float32)\r\nfilt = array_ops.zeros([3, 3, 3, 32], dtypes.float32)\r\nstrides = list(numpy.array([1] * 4))\r\n\r\nfor _ in range(10000000):\r\n  #strides = [int(_i) for _i in strides]\r\n  gen_nn_ops.conv2d(input=inp, filter=filt, strides=strides, padding='VALID')\r\n```\r\n\r\nAnd running with `--vmodule=pywrap_tfe_src=3`:\r\n\r\n> I0521 16:53:57.182346  110126 pywrap_tfe_src.cc:2212] Falling back to slow path for Op \"Conv2D\" since we are unable to set the value for attr \"strides\" due to: Expecting int64_t value for attr strides, got numpy.int64\r\n\r\nSo it looks like (1) we should be using the fast path, and (2) the slow path shouldn't leak. @akshaym has expressed interest in fixing :)"}