{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/255814883", "html_url": "https://github.com/tensorflow/tensorflow/issues/4359#issuecomment-255814883", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4359", "id": 255814883, "node_id": "MDEyOklzc3VlQ29tbWVudDI1NTgxNDg4Mw==", "user": {"login": "aidan-plenert-macdonald", "id": 6690599, "node_id": "MDQ6VXNlcjY2OTA1OTk=", "avatar_url": "https://avatars2.githubusercontent.com/u/6690599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aidan-plenert-macdonald", "html_url": "https://github.com/aidan-plenert-macdonald", "followers_url": "https://api.github.com/users/aidan-plenert-macdonald/followers", "following_url": "https://api.github.com/users/aidan-plenert-macdonald/following{/other_user}", "gists_url": "https://api.github.com/users/aidan-plenert-macdonald/gists{/gist_id}", "starred_url": "https://api.github.com/users/aidan-plenert-macdonald/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aidan-plenert-macdonald/subscriptions", "organizations_url": "https://api.github.com/users/aidan-plenert-macdonald/orgs", "repos_url": "https://api.github.com/users/aidan-plenert-macdonald/repos", "events_url": "https://api.github.com/users/aidan-plenert-macdonald/events{/privacy}", "received_events_url": "https://api.github.com/users/aidan-plenert-macdonald/received_events", "type": "User", "site_admin": false}, "created_at": "2016-10-24T17:53:10Z", "updated_at": "2016-10-24T17:53:10Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=463737\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/vrv\">@vrv</a></p>\n<p>I am getting segfaults from the destructors where the program terminates (below is a stacktrace).</p>\n<pre><code>Program received signal SIGSEGV, Segmentation fault.\n0x0000000000000000 in ?? ()\n(gdb) backtrace\n#0  0x0000000000000000 in ?? ()\n#1  0x00007fffe0524e94 in tensorflow::(anonymous namespace)::Buffer&lt;float&gt;::~Buffer() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#2  0x00007fffe0524f41 in tensorflow::(anonymous namespace)::Buffer&lt;float&gt;::~Buffer() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#3  0x00007fffe0525fd6 in tensorflow::Tensor::~Tensor() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#4  0x00007fffe0162514 in tensorflow::VariableOp::Var::~Var() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#5  0x00007fffe051a474 in tensorflow::ResourceMgr::Clear() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#6  0x00007fffe051a501 in tensorflow::ResourceMgr::~ResourceMgr() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#7  0x00007fffe04505a0 in tensorflow::Device::~Device() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#8  0x00007fffe894e6d1 in tensorflow::KPUDevice::~KPUDevice (this=0xe65ee0, __in_chrg=&lt;optimized out&gt;) at kpu/device.cc:49\n#9  0x00007fffe894e700 in tensorflow::KPUDevice::~KPUDevice (this=0xe65ee0, __in_chrg=&lt;optimized out&gt;) at kpu/device.cc:52\n#10 0x00007fffe045284e in tensorflow::DeviceMgr::~DeviceMgr() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#11 0x00007fffe035b087 in tensorflow::DirectSession::~DirectSession() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#12 0x00007fffe035b1d1 in tensorflow::DirectSession::~DirectSession() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#13 0x00007fffe04401b7 in TF_DeleteSession () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#14 0x00007fffdf16a90b in _wrap_TF_DeleteSession () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#15 0x000000000049968d in PyEval_EvalFrameEx ()\n</code></pre>\n<p>I am using the default VariableOp by just importing the header and registering it to my device. I am unsure what I am doing wrong that would cause it to segfault. I believe it is trying to free the pointers to my tensor data incorrectly, but I am neither sure of that, nor is it clear how to fix it.</p>\n<div class=\"highlight highlight-source-c++\"><pre>#<span class=\"pl-k\">include</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>kpu/kpu.h<span class=\"pl-pds\">\"</span></span>\n#<span class=\"pl-k\">include</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>tensorflow/core/kernels/variable_ops.h<span class=\"pl-pds\">\"</span></span>\n\n#<span class=\"pl-k\">include</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>tensorflow/core/framework/op_kernel.h<span class=\"pl-pds\">\"</span></span>\n#<span class=\"pl-k\">include</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>tensorflow/core/framework/register_types.h<span class=\"pl-pds\">\"</span></span>\n#<span class=\"pl-k\">include</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>tensorflow/core/lib/core/errors.h<span class=\"pl-pds\">\"</span></span>\n#<span class=\"pl-k\">include</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>tensorflow/core/platform/types.h<span class=\"pl-pds\">\"</span></span>\n\n<span class=\"pl-k\">namespace</span> <span class=\"pl-en\">tensorflow</span> {\n\n#<span class=\"pl-k\">define</span> <span class=\"pl-en\">REGISTER_KPU_KERNELS</span>(<span class=\"pl-v\">type</span>)                                       \\\n  <span class=\"pl-en\">REGISTER_KERNEL_BUILDER</span>(                                               \\\n      <span class=\"pl-en\">Name</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Variable<span class=\"pl-pds\">\"</span></span>).Device(DEVICE_KPU).TypeConstraint&lt;type&gt;(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>dtype<span class=\"pl-pds\">\"</span></span>), \\\n      VariableOp);                                                       \\\n  <span class=\"pl-en\">REGISTER_KERNEL_BUILDER</span>(Name(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>TemporaryVariable<span class=\"pl-pds\">\"</span></span>)                      \\\n                              .Device(DEVICE_KPU)                        \\\n                              .TypeConstraint&lt;type&gt;(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>dtype<span class=\"pl-pds\">\"</span></span>),            \\\n                          TemporaryVariableOp);                          \\\n  <span class=\"pl-en\">REGISTER_KERNEL_BUILDER</span>(Name(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>DestroyTemporaryVariable<span class=\"pl-pds\">\"</span></span>)               \\\n                              .Device(DEVICE_KPU)                        \\\n                              .TypeConstraint&lt;type&gt;(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>T<span class=\"pl-pds\">\"</span></span>),                \\\n                          DestroyTemporaryVariableOp);                   \\\n  <span class=\"pl-en\">REGISTER_KERNEL_BUILDER</span>(Name(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>IsVariableInitialized<span class=\"pl-pds\">\"</span></span>)                  \\\n                              .Device(DEVICE_KPU)                        \\\n                              .TypeConstraint&lt;type&gt;(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>dtype<span class=\"pl-pds\">\"</span></span>)             \\\n                              .HostMemory(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>is_initialized<span class=\"pl-pds\">\"</span></span>),             \\\n                          IsVariableInitializedOp);\n\n  <span class=\"pl-en\">TF_CALL_GPU_NUMBER_TYPES</span>(REGISTER_KPU_KERNELS);\n\n}  <span class=\"pl-c\"><span class=\"pl-c\">//</span> namespace tensorflow </span></pre></div>\n<p>Could you help me understand what is happening?</p>", "body_text": "@vrv\nI am getting segfaults from the destructors where the program terminates (below is a stacktrace).\nProgram received signal SIGSEGV, Segmentation fault.\n0x0000000000000000 in ?? ()\n(gdb) backtrace\n#0  0x0000000000000000 in ?? ()\n#1  0x00007fffe0524e94 in tensorflow::(anonymous namespace)::Buffer<float>::~Buffer() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#2  0x00007fffe0524f41 in tensorflow::(anonymous namespace)::Buffer<float>::~Buffer() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#3  0x00007fffe0525fd6 in tensorflow::Tensor::~Tensor() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#4  0x00007fffe0162514 in tensorflow::VariableOp::Var::~Var() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#5  0x00007fffe051a474 in tensorflow::ResourceMgr::Clear() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#6  0x00007fffe051a501 in tensorflow::ResourceMgr::~ResourceMgr() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#7  0x00007fffe04505a0 in tensorflow::Device::~Device() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#8  0x00007fffe894e6d1 in tensorflow::KPUDevice::~KPUDevice (this=0xe65ee0, __in_chrg=<optimized out>) at kpu/device.cc:49\n#9  0x00007fffe894e700 in tensorflow::KPUDevice::~KPUDevice (this=0xe65ee0, __in_chrg=<optimized out>) at kpu/device.cc:52\n#10 0x00007fffe045284e in tensorflow::DeviceMgr::~DeviceMgr() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#11 0x00007fffe035b087 in tensorflow::DirectSession::~DirectSession() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#12 0x00007fffe035b1d1 in tensorflow::DirectSession::~DirectSession() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#13 0x00007fffe04401b7 in TF_DeleteSession () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#14 0x00007fffdf16a90b in _wrap_TF_DeleteSession () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#15 0x000000000049968d in PyEval_EvalFrameEx ()\n\nI am using the default VariableOp by just importing the header and registering it to my device. I am unsure what I am doing wrong that would cause it to segfault. I believe it is trying to free the pointers to my tensor data incorrectly, but I am neither sure of that, nor is it clear how to fix it.\n#include \"kpu/kpu.h\"\n#include \"tensorflow/core/kernels/variable_ops.h\"\n\n#include \"tensorflow/core/framework/op_kernel.h\"\n#include \"tensorflow/core/framework/register_types.h\"\n#include \"tensorflow/core/lib/core/errors.h\"\n#include \"tensorflow/core/platform/types.h\"\n\nnamespace tensorflow {\n\n#define REGISTER_KPU_KERNELS(type)                                       \\\n  REGISTER_KERNEL_BUILDER(                                               \\\n      Name(\"Variable\").Device(DEVICE_KPU).TypeConstraint<type>(\"dtype\"), \\\n      VariableOp);                                                       \\\n  REGISTER_KERNEL_BUILDER(Name(\"TemporaryVariable\")                      \\\n                              .Device(DEVICE_KPU)                        \\\n                              .TypeConstraint<type>(\"dtype\"),            \\\n                          TemporaryVariableOp);                          \\\n  REGISTER_KERNEL_BUILDER(Name(\"DestroyTemporaryVariable\")               \\\n                              .Device(DEVICE_KPU)                        \\\n                              .TypeConstraint<type>(\"T\"),                \\\n                          DestroyTemporaryVariableOp);                   \\\n  REGISTER_KERNEL_BUILDER(Name(\"IsVariableInitialized\")                  \\\n                              .Device(DEVICE_KPU)                        \\\n                              .TypeConstraint<type>(\"dtype\")             \\\n                              .HostMemory(\"is_initialized\"),             \\\n                          IsVariableInitializedOp);\n\n  TF_CALL_GPU_NUMBER_TYPES(REGISTER_KPU_KERNELS);\n\n}  // namespace tensorflow \nCould you help me understand what is happening?", "body": "@vrv \n\nI am getting segfaults from the destructors where the program terminates (below is a stacktrace).\n\n```\nProgram received signal SIGSEGV, Segmentation fault.\n0x0000000000000000 in ?? ()\n(gdb) backtrace\n#0  0x0000000000000000 in ?? ()\n#1  0x00007fffe0524e94 in tensorflow::(anonymous namespace)::Buffer<float>::~Buffer() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#2  0x00007fffe0524f41 in tensorflow::(anonymous namespace)::Buffer<float>::~Buffer() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#3  0x00007fffe0525fd6 in tensorflow::Tensor::~Tensor() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#4  0x00007fffe0162514 in tensorflow::VariableOp::Var::~Var() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#5  0x00007fffe051a474 in tensorflow::ResourceMgr::Clear() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#6  0x00007fffe051a501 in tensorflow::ResourceMgr::~ResourceMgr() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#7  0x00007fffe04505a0 in tensorflow::Device::~Device() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#8  0x00007fffe894e6d1 in tensorflow::KPUDevice::~KPUDevice (this=0xe65ee0, __in_chrg=<optimized out>) at kpu/device.cc:49\n#9  0x00007fffe894e700 in tensorflow::KPUDevice::~KPUDevice (this=0xe65ee0, __in_chrg=<optimized out>) at kpu/device.cc:52\n#10 0x00007fffe045284e in tensorflow::DeviceMgr::~DeviceMgr() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#11 0x00007fffe035b087 in tensorflow::DirectSession::~DirectSession() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#12 0x00007fffe035b1d1 in tensorflow::DirectSession::~DirectSession() () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#13 0x00007fffe04401b7 in TF_DeleteSession () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#14 0x00007fffdf16a90b in _wrap_TF_DeleteSession () from /usr/local/lib/python2.7/dist-packages/tensorflow/python/_pywrap_tensorflow.so\n#15 0x000000000049968d in PyEval_EvalFrameEx ()\n```\n\nI am using the default VariableOp by just importing the header and registering it to my device. I am unsure what I am doing wrong that would cause it to segfault. I believe it is trying to free the pointers to my tensor data incorrectly, but I am neither sure of that, nor is it clear how to fix it.\n\n``` c++\n#include \"kpu/kpu.h\"\n#include \"tensorflow/core/kernels/variable_ops.h\"\n\n#include \"tensorflow/core/framework/op_kernel.h\"\n#include \"tensorflow/core/framework/register_types.h\"\n#include \"tensorflow/core/lib/core/errors.h\"\n#include \"tensorflow/core/platform/types.h\"\n\nnamespace tensorflow {\n\n#define REGISTER_KPU_KERNELS(type)                                       \\\n  REGISTER_KERNEL_BUILDER(                                               \\\n      Name(\"Variable\").Device(DEVICE_KPU).TypeConstraint<type>(\"dtype\"), \\\n      VariableOp);                                                       \\\n  REGISTER_KERNEL_BUILDER(Name(\"TemporaryVariable\")                      \\\n                              .Device(DEVICE_KPU)                        \\\n                              .TypeConstraint<type>(\"dtype\"),            \\\n                          TemporaryVariableOp);                          \\\n  REGISTER_KERNEL_BUILDER(Name(\"DestroyTemporaryVariable\")               \\\n                              .Device(DEVICE_KPU)                        \\\n                              .TypeConstraint<type>(\"T\"),                \\\n                          DestroyTemporaryVariableOp);                   \\\n  REGISTER_KERNEL_BUILDER(Name(\"IsVariableInitialized\")                  \\\n                              .Device(DEVICE_KPU)                        \\\n                              .TypeConstraint<type>(\"dtype\")             \\\n                              .HostMemory(\"is_initialized\"),             \\\n                          IsVariableInitializedOp);\n\n  TF_CALL_GPU_NUMBER_TYPES(REGISTER_KPU_KERNELS);\n\n}  // namespace tensorflow \n```\n\nCould you help me understand what is happening?\n"}