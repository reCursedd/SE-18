{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16982", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16982/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16982/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16982/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/16982", "id": 296759636, "node_id": "MDU6SXNzdWUyOTY3NTk2MzY=", "number": 16982, "title": "dnnConversionCreate_F32 fails when running TF with optimized MKL", "user": {"login": "jakubkarczewski", "id": 29629847, "node_id": "MDQ6VXNlcjI5NjI5ODQ3", "avatar_url": "https://avatars1.githubusercontent.com/u/29629847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubkarczewski", "html_url": "https://github.com/jakubkarczewski", "followers_url": "https://api.github.com/users/jakubkarczewski/followers", "following_url": "https://api.github.com/users/jakubkarczewski/following{/other_user}", "gists_url": "https://api.github.com/users/jakubkarczewski/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubkarczewski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubkarczewski/subscriptions", "organizations_url": "https://api.github.com/users/jakubkarczewski/orgs", "repos_url": "https://api.github.com/users/jakubkarczewski/repos", "events_url": "https://api.github.com/users/jakubkarczewski/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubkarczewski/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "cy89", "id": 29663194, "node_id": "MDQ6VXNlcjI5NjYzMTk0", "avatar_url": "https://avatars0.githubusercontent.com/u/29663194?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cy89", "html_url": "https://github.com/cy89", "followers_url": "https://api.github.com/users/cy89/followers", "following_url": "https://api.github.com/users/cy89/following{/other_user}", "gists_url": "https://api.github.com/users/cy89/gists{/gist_id}", "starred_url": "https://api.github.com/users/cy89/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cy89/subscriptions", "organizations_url": "https://api.github.com/users/cy89/orgs", "repos_url": "https://api.github.com/users/cy89/repos", "events_url": "https://api.github.com/users/cy89/events{/privacy}", "received_events_url": "https://api.github.com/users/cy89/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "cy89", "id": 29663194, "node_id": "MDQ6VXNlcjI5NjYzMTk0", "avatar_url": "https://avatars0.githubusercontent.com/u/29663194?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cy89", "html_url": "https://github.com/cy89", "followers_url": "https://api.github.com/users/cy89/followers", "following_url": "https://api.github.com/users/cy89/following{/other_user}", "gists_url": "https://api.github.com/users/cy89/gists{/gist_id}", "starred_url": "https://api.github.com/users/cy89/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cy89/subscriptions", "organizations_url": "https://api.github.com/users/cy89/orgs", "repos_url": "https://api.github.com/users/cy89/repos", "events_url": "https://api.github.com/users/cy89/events{/privacy}", "received_events_url": "https://api.github.com/users/cy89/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 27, "created_at": "2018-02-13T14:39:12Z", "updated_at": "2018-05-28T02:26:10Z", "closed_at": "2018-05-28T02:26:10Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code</strong>: Yes, (<a href=\"https://github.com/jakubkarczewski/AlexNetF/blob/master/alexnet.py\">https://github.com/jakubkarczewski/AlexNetF/blob/master/alexnet.py</a>)</li>\n<li><strong>OS Platform and Distribution</strong>: Linux Centos 7</li>\n<li><strong>TensorFlow installed from</strong>: compiled from source from <a href=\"https://github.com/tensorflow/tensorflow/releases\">https://github.com/tensorflow/tensorflow/releases</a></li>\n<li><strong>TensorFlow version</strong>: 1.6.0-rc0</li>\n<li><strong>Python version</strong>:  2.7</li>\n<li><strong>Bazel version</strong>: 0.10.0</li>\n<li><strong>GCC/Compiler version</strong>: stock Centos 7 gcc</li>\n<li><strong>Compilation command</strong>: <code>bazel build --config=mkl --copt=\"-DINTEL_MKL_ML\" --copt=\"-mfma\" --copt=\"-mavx2\" --copt=\"-march=broadwell\" --copt=\"-O3\" -s -c opt //tensorflow/tools/pip_package:build_pip_package;;</code></li>\n<li><strong>Exact command to reproduce</strong>: python alexnet.py --training_epoch=1 --model_version=1 output/</li>\n<li><strong>CUDA/cuDNN version</strong>: N/A</li>\n<li><strong>GPU model and memory</strong>: N/A</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>Running following training with Tensorflow compiled with command specified above results in error: <code>2018-02-12 23:40:38.088756: F tensorflow/core/kernels/mkl_lrn_op.cc:595] Check failed: dnnConversionCreate_F32( &amp;convert_input, static_cast&lt;dnnLayout_t&gt;(inimage_shape.GetCurLayout()), lt_internal_input) == E_SUCCESS (-1 vs. 0) </code> as opossed to running without any error and training properly on Tensorflow version available under <code>pip install tensorflow</code>.<br>\nFor training data I used Imagenet 60gb dataset (<a href=\"http://www.image-net.org/challenges/LSVRC/2012/\" rel=\"nofollow\">http://www.image-net.org/challenges/LSVRC/2012/</a>) with 1000 classes.<br>\nWhat's more - following error can be found when running with Tensorflow from precompiled wheel files for both versions of python. This makes me think that the way I compile TF is not the problem here.</p>", "body_text": "System information\n\nHave I written custom code: Yes, (https://github.com/jakubkarczewski/AlexNetF/blob/master/alexnet.py)\nOS Platform and Distribution: Linux Centos 7\nTensorFlow installed from: compiled from source from https://github.com/tensorflow/tensorflow/releases\nTensorFlow version: 1.6.0-rc0\nPython version:  2.7\nBazel version: 0.10.0\nGCC/Compiler version: stock Centos 7 gcc\nCompilation command: bazel build --config=mkl --copt=\"-DINTEL_MKL_ML\" --copt=\"-mfma\" --copt=\"-mavx2\" --copt=\"-march=broadwell\" --copt=\"-O3\" -s -c opt //tensorflow/tools/pip_package:build_pip_package;;\nExact command to reproduce: python alexnet.py --training_epoch=1 --model_version=1 output/\nCUDA/cuDNN version: N/A\nGPU model and memory: N/A\n\nDescribe the problem\nRunning following training with Tensorflow compiled with command specified above results in error: 2018-02-12 23:40:38.088756: F tensorflow/core/kernels/mkl_lrn_op.cc:595] Check failed: dnnConversionCreate_F32( &convert_input, static_cast<dnnLayout_t>(inimage_shape.GetCurLayout()), lt_internal_input) == E_SUCCESS (-1 vs. 0)  as opossed to running without any error and training properly on Tensorflow version available under pip install tensorflow.\nFor training data I used Imagenet 60gb dataset (http://www.image-net.org/challenges/LSVRC/2012/) with 1000 classes.\nWhat's more - following error can be found when running with Tensorflow from precompiled wheel files for both versions of python. This makes me think that the way I compile TF is not the problem here.", "body": "### System information\r\n- **Have I written custom code**: Yes, (https://github.com/jakubkarczewski/AlexNetF/blob/master/alexnet.py)\r\n- **OS Platform and Distribution**: Linux Centos 7\r\n- **TensorFlow installed from**: compiled from source from https://github.com/tensorflow/tensorflow/releases\r\n- **TensorFlow version**: 1.6.0-rc0\r\n- **Python version**:  2.7\r\n- **Bazel version**: 0.10.0\r\n- **GCC/Compiler version**: stock Centos 7 gcc\r\n- **Compilation command**: ```bazel build --config=mkl --copt=\"-DINTEL_MKL_ML\" --copt=\"-mfma\" --copt=\"-mavx2\" --copt=\"-march=broadwell\" --copt=\"-O3\" -s -c opt //tensorflow/tools/pip_package:build_pip_package;;```\r\n- **Exact command to reproduce**: python alexnet.py --training_epoch=1 --model_version=1 output/\r\n- **CUDA/cuDNN version**: N/A\r\n- **GPU model and memory**: N/A\r\n\r\n\r\n### Describe the problem\r\nRunning following training with Tensorflow compiled with command specified above results in error: ```2018-02-12 23:40:38.088756: F tensorflow/core/kernels/mkl_lrn_op.cc:595] Check failed: dnnConversionCreate_F32( &convert_input, static_cast<dnnLayout_t>(inimage_shape.GetCurLayout()), lt_internal_input) == E_SUCCESS (-1 vs. 0) ``` as opossed to running without any error and training properly on Tensorflow version available under ```pip install tensorflow```.\r\nFor training data I used Imagenet 60gb dataset (http://www.image-net.org/challenges/LSVRC/2012/) with 1000 classes.\r\nWhat's more - following error can be found when running with Tensorflow from precompiled wheel files for both versions of python. This makes me think that the way I compile TF is not the problem here."}