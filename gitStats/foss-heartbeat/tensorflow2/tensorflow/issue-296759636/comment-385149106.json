{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/385149106", "html_url": "https://github.com/tensorflow/tensorflow/issues/16982#issuecomment-385149106", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16982", "id": 385149106, "node_id": "MDEyOklzc3VlQ29tbWVudDM4NTE0OTEwNg==", "user": {"login": "wei-v-wang", "id": 22306846, "node_id": "MDQ6VXNlcjIyMzA2ODQ2", "avatar_url": "https://avatars3.githubusercontent.com/u/22306846?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wei-v-wang", "html_url": "https://github.com/wei-v-wang", "followers_url": "https://api.github.com/users/wei-v-wang/followers", "following_url": "https://api.github.com/users/wei-v-wang/following{/other_user}", "gists_url": "https://api.github.com/users/wei-v-wang/gists{/gist_id}", "starred_url": "https://api.github.com/users/wei-v-wang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wei-v-wang/subscriptions", "organizations_url": "https://api.github.com/users/wei-v-wang/orgs", "repos_url": "https://api.github.com/users/wei-v-wang/repos", "events_url": "https://api.github.com/users/wei-v-wang/events{/privacy}", "received_events_url": "https://api.github.com/users/wei-v-wang/received_events", "type": "User", "site_admin": false}, "created_at": "2018-04-28T07:32:45Z", "updated_at": "2018-04-28T07:32:45Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=29629847\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jakubkarczewski\">@jakubkarczewski</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=29663194\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/cy89\">@cy89</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=986732\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/tatianashp\">@tatianashp</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=16018\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/asimshankar\">@asimshankar</a></p>\n<p>Please see below for my newest findings regarding this issue - it seems the issue disappeared if we use Intel MKL DNN backend (with recent commits) rather than Intel MKL ML backend.</p>\n<p>AlexNet]$ export OMP_NUM_THREADS=4 (may need to do this to avoid OpenMP resource issue)<br>\nAlexNet]$ python alexnet.py   testoutput/<br>\n/usr/lib64/python2.7/site-packages/h5py/<strong>init</strong>.py:36: FutureWarning: Conversion of the second argument of issubdtype from <code>float</code> to <code>np.floating</code> is deprecated. In future, it will be treated as <code>np.float64 == np.dtype(float).type</code>.<br>\nfrom ._conv import register_converters as _register_converters<br>\nLoading data<br>\nData loaded.<br>\n1281167<br>\n1000<br>\nWARNING:tensorflow:From alexnet.py:329: softmax_cross_entropy_with_logits (from tensorflow.python.ops.nn_ops) is deprecated and will be removed in a future version.<br>\nInstructions for updating:</p>\n<p>Future major versions of TensorFlow will allow gradients to flow<br>\ninto the labels input on backprop by default.</p>\n<p>See tf.nn.softmax_cross_entropy_with_logits_v2.</p>\n<p>Start time is: 1524900472.01<br>\n2018-04-28 00:27:52.015040: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX512F<br>\nIter 0, Minibatch Loss= 6.898850, Training Accuracy= 0.0 Elapsed time:8.87320780754acc_up=[0.0, 0.0]<br>\nIter 20, Minibatch Loss= 6.916332, Training Accuracy= 0.0 Elapsed time:87.2397489548acc_up=[0.0, 0.0]</p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=29629847\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jakubkarczewski\">@jakubkarczewski</a> Is it OK for you to use Intel MKL DNN? In order to use Intel MKL DNN backend, you<br>\ncan just use the previous command you tried<br>\nbazel build --config=mkl --copt=\u201d-DEIGEN_USE_VML\u201d -c opt //tensorflow/tools/pip_package: build_pip_package  (*please do not specify   --copt=\"-DINTEL_MKL_ML\" * , this way by default will be INTEL_MKL_DNN). Sorry for the confusion.</p>\n<p>Could you please confirm?</p>", "body_text": "@jakubkarczewski @cy89 @tatianashp @asimshankar\nPlease see below for my newest findings regarding this issue - it seems the issue disappeared if we use Intel MKL DNN backend (with recent commits) rather than Intel MKL ML backend.\nAlexNet]$ export OMP_NUM_THREADS=4 (may need to do this to avoid OpenMP resource issue)\nAlexNet]$ python alexnet.py   testoutput/\n/usr/lib64/python2.7/site-packages/h5py/init.py:36: FutureWarning: Conversion of the second argument of issubdtype from float to np.floating is deprecated. In future, it will be treated as np.float64 == np.dtype(float).type.\nfrom ._conv import register_converters as _register_converters\nLoading data\nData loaded.\n1281167\n1000\nWARNING:tensorflow:From alexnet.py:329: softmax_cross_entropy_with_logits (from tensorflow.python.ops.nn_ops) is deprecated and will be removed in a future version.\nInstructions for updating:\nFuture major versions of TensorFlow will allow gradients to flow\ninto the labels input on backprop by default.\nSee tf.nn.softmax_cross_entropy_with_logits_v2.\nStart time is: 1524900472.01\n2018-04-28 00:27:52.015040: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX512F\nIter 0, Minibatch Loss= 6.898850, Training Accuracy= 0.0 Elapsed time:8.87320780754acc_up=[0.0, 0.0]\nIter 20, Minibatch Loss= 6.916332, Training Accuracy= 0.0 Elapsed time:87.2397489548acc_up=[0.0, 0.0]\n@jakubkarczewski Is it OK for you to use Intel MKL DNN? In order to use Intel MKL DNN backend, you\ncan just use the previous command you tried\nbazel build --config=mkl --copt=\u201d-DEIGEN_USE_VML\u201d -c opt //tensorflow/tools/pip_package: build_pip_package  (*please do not specify   --copt=\"-DINTEL_MKL_ML\" * , this way by default will be INTEL_MKL_DNN). Sorry for the confusion.\nCould you please confirm?", "body": "@jakubkarczewski @cy89 @tatianashp @asimshankar \r\n\r\nPlease see below for my newest findings regarding this issue - it seems the issue disappeared if we use Intel MKL DNN backend (with recent commits) rather than Intel MKL ML backend. \r\n\r\nAlexNet]$ export OMP_NUM_THREADS=4 (may need to do this to avoid OpenMP resource issue)\r\nAlexNet]$ python alexnet.py   testoutput/\r\n/usr/lib64/python2.7/site-packages/h5py/__init__.py:36: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`.\r\n  from ._conv import register_converters as _register_converters\r\nLoading data\r\nData loaded.\r\n1281167\r\n1000\r\nWARNING:tensorflow:From alexnet.py:329: softmax_cross_entropy_with_logits (from tensorflow.python.ops.nn_ops) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\n\r\nFuture major versions of TensorFlow will allow gradients to flow\r\ninto the labels input on backprop by default.\r\n\r\nSee tf.nn.softmax_cross_entropy_with_logits_v2.\r\n\r\nStart time is: 1524900472.01\r\n2018-04-28 00:27:52.015040: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX512F\r\n Iter 0, Minibatch Loss= 6.898850, Training Accuracy= 0.0 Elapsed time:8.87320780754acc_up=[0.0, 0.0]\r\n Iter 20, Minibatch Loss= 6.916332, Training Accuracy= 0.0 Elapsed time:87.2397489548acc_up=[0.0, 0.0]\r\n\r\n@jakubkarczewski Is it OK for you to use Intel MKL DNN? In order to use Intel MKL DNN backend, you\r\ncan just use the previous command you tried \r\nbazel build --config=mkl --copt=\u201d-DEIGEN_USE_VML\u201d -c opt //tensorflow/tools/pip_package: build_pip_package  (*please do not specify   --copt=\"-DINTEL_MKL_ML\" * , this way by default will be INTEL_MKL_DNN). Sorry for the confusion. \r\n\r\nCould you please confirm? "}