{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/416605737", "html_url": "https://github.com/tensorflow/tensorflow/issues/21834#issuecomment-416605737", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21834", "id": 416605737, "node_id": "MDEyOklzc3VlQ29tbWVudDQxNjYwNTczNw==", "user": {"login": "aselle", "id": 326106, "node_id": "MDQ6VXNlcjMyNjEwNg==", "avatar_url": "https://avatars1.githubusercontent.com/u/326106?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aselle", "html_url": "https://github.com/aselle", "followers_url": "https://api.github.com/users/aselle/followers", "following_url": "https://api.github.com/users/aselle/following{/other_user}", "gists_url": "https://api.github.com/users/aselle/gists{/gist_id}", "starred_url": "https://api.github.com/users/aselle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aselle/subscriptions", "organizations_url": "https://api.github.com/users/aselle/orgs", "repos_url": "https://api.github.com/users/aselle/repos", "events_url": "https://api.github.com/users/aselle/events{/privacy}", "received_events_url": "https://api.github.com/users/aselle/received_events", "type": "User", "site_admin": false}, "created_at": "2018-08-28T14:27:04Z", "updated_at": "2018-08-28T14:27:04Z", "author_association": "MEMBER", "body_html": "<p>It seems gcc 4.7 has a bug in its unique_ptr handling. You can change simple_memory_arena.cc<br>\nto use a raw pointer.</p>\n<ol>\n<li>Change the header to have underlying_buffer_ be of type</li>\n</ol>\n<div class=\"highlight highlight-source-c++\"><pre>std::unique_ptr&lt;<span class=\"pl-k\">char</span>[]&gt; underlying_buffer_; </pre></div>\n<p>becomes</p>\n<div class=\"highlight highlight-source-c++\"><pre>  <span class=\"pl-k\">char</span>* underlying_buffer_;</pre></div>\n<ol start=\"2\">\n<li>Add a destroy to destructor</li>\n</ol>\n<div class=\"highlight highlight-source-c++\"><pre><span class=\"pl-k\">delete []</span> underlying_buffer_</pre></div>\n<p>Change all uses of underlying_buffer_ in</p>\n<div class=\"highlight highlight-source-c++\"><pre>TfLiteStatus <span class=\"pl-en\">SimpleMemoryArena::Commit</span>(TfLiteContext* context) </pre></div>\n<p>I.e. where it uses reset() change it to</p>\n<div class=\"highlight highlight-source-c++\"><pre><span class=\"pl-k\">delete []</span> underlying_buffer_;\nunderlying_buffer_=<span class=\"pl-k\">new</span> <span class=\"pl-k\">char</span>[whateversize was theere];</pre></div>\n<p>and remove any .get()'s</p>", "body_text": "It seems gcc 4.7 has a bug in its unique_ptr handling. You can change simple_memory_arena.cc\nto use a raw pointer.\n\nChange the header to have underlying_buffer_ be of type\n\nstd::unique_ptr<char[]> underlying_buffer_; \nbecomes\n  char* underlying_buffer_;\n\nAdd a destroy to destructor\n\ndelete [] underlying_buffer_\nChange all uses of underlying_buffer_ in\nTfLiteStatus SimpleMemoryArena::Commit(TfLiteContext* context) \nI.e. where it uses reset() change it to\ndelete [] underlying_buffer_;\nunderlying_buffer_=new char[whateversize was theere];\nand remove any .get()'s", "body": "It seems gcc 4.7 has a bug in its unique_ptr handling. You can change simple_memory_arena.cc\r\nto use a raw pointer. \r\n\r\n1. Change the header to have underlying_buffer_ be of type\r\n```cpp\r\nstd::unique_ptr<char[]> underlying_buffer_; \r\n```\r\nbecomes\r\n```cpp\r\n  char* underlying_buffer_;\r\n```\r\n2. Add a destroy to destructor\r\n```cpp\r\ndelete [] underlying_buffer_\r\n```\r\n\r\nChange all uses of underlying_buffer_ in\r\n```cpp\r\nTfLiteStatus SimpleMemoryArena::Commit(TfLiteContext* context) \r\n```\r\n\r\nI.e. where it uses reset() change it to\r\n```cpp\r\ndelete [] underlying_buffer_;\r\nunderlying_buffer_=new char[whateversize was theere];\r\n```\r\nand remove any .get()'s\r\n\r\n"}