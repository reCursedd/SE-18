{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6687", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6687/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6687/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6687/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/6687", "id": 199153868, "node_id": "MDU6SXNzdWUxOTkxNTM4Njg=", "number": 6687, "title": "Cannot run a distributed training example with tensorflow v0.12.1", "user": {"login": "infwinston", "id": 1206058, "node_id": "MDQ6VXNlcjEyMDYwNTg=", "avatar_url": "https://avatars3.githubusercontent.com/u/1206058?v=4", "gravatar_id": "", "url": "https://api.github.com/users/infwinston", "html_url": "https://github.com/infwinston", "followers_url": "https://api.github.com/users/infwinston/followers", "following_url": "https://api.github.com/users/infwinston/following{/other_user}", "gists_url": "https://api.github.com/users/infwinston/gists{/gist_id}", "starred_url": "https://api.github.com/users/infwinston/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/infwinston/subscriptions", "organizations_url": "https://api.github.com/users/infwinston/orgs", "repos_url": "https://api.github.com/users/infwinston/repos", "events_url": "https://api.github.com/users/infwinston/events{/privacy}", "received_events_url": "https://api.github.com/users/infwinston/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "sherrym", "id": 12770037, "node_id": "MDQ6VXNlcjEyNzcwMDM3", "avatar_url": "https://avatars0.githubusercontent.com/u/12770037?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sherrym", "html_url": "https://github.com/sherrym", "followers_url": "https://api.github.com/users/sherrym/followers", "following_url": "https://api.github.com/users/sherrym/following{/other_user}", "gists_url": "https://api.github.com/users/sherrym/gists{/gist_id}", "starred_url": "https://api.github.com/users/sherrym/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sherrym/subscriptions", "organizations_url": "https://api.github.com/users/sherrym/orgs", "repos_url": "https://api.github.com/users/sherrym/repos", "events_url": "https://api.github.com/users/sherrym/events{/privacy}", "received_events_url": "https://api.github.com/users/sherrym/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "sherrym", "id": 12770037, "node_id": "MDQ6VXNlcjEyNzcwMDM3", "avatar_url": "https://avatars0.githubusercontent.com/u/12770037?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sherrym", "html_url": "https://github.com/sherrym", "followers_url": "https://api.github.com/users/sherrym/followers", "following_url": "https://api.github.com/users/sherrym/following{/other_user}", "gists_url": "https://api.github.com/users/sherrym/gists{/gist_id}", "starred_url": "https://api.github.com/users/sherrym/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sherrym/subscriptions", "organizations_url": "https://api.github.com/users/sherrym/orgs", "repos_url": "https://api.github.com/users/sherrym/repos", "events_url": "https://api.github.com/users/sherrym/events{/privacy}", "received_events_url": "https://api.github.com/users/sherrym/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2017-01-06T09:11:05Z", "updated_at": "2017-12-03T22:58:48Z", "closed_at": "2017-06-16T18:15:48Z", "author_association": "NONE", "body_html": "<p>Hi,</p>\n<p>I was trying to run a distributed tensorflow <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/dist_test/python/mnist_replica.py\">example</a> in the official repository with v0.12.1 (current latest release).<br>\nI can run asynchronous version without problems, but when I turned on <code>sync_replicas</code> tag, some errors occurred.<br>\n(Please check the following logs in details)</p>\n<p>This example code can be ran successfully with v0.12.0, so I guess there might be some modification from 0.12.0 to 0.12.1?<br>\nCould someone check if that's the case? Thanks.</p>\n<h3>What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?</h3>\n<p>I haven't found others reported this issue as tensorflow v0.12.1 just released,</p>\n<h3>Environment info</h3>\n<p>Operating System:<br>\nUbuntu 14.04</p>\n<p>Installed version of CUDA and cuDNN:<br>\nCUDA 7.5, cuDNN 5.1</p>\n<pre><code>&gt; ls -l /usr/local/cuda/lib/libcud*\n-rw-r--r-- 1 root root 189170 Oct 25 22:51 /usr/local/cuda/lib/libcudadevrt.a\nlrwxrwxrwx 1 root root     16 Oct 25 22:51 /usr/local/cuda/lib/libcudart.so -&gt; libcudart.so.7.5\nlrwxrwxrwx 1 root root     19 Oct 25 22:51 /usr/local/cuda/lib/libcudart.so.7.5 -&gt; libcudart.so.7.5.18\n-rwxr-xr-x 1 root root 311596 Oct 25 22:51 /usr/local/cuda/lib/libcudart.so.7.5.18\n-rw-r--r-- 1 root root 558020 Oct 25 22:51 /usr/local/cuda/lib/libcudart_static.a\n</code></pre>\n<p>If installed from source, provide</p>\n<ol>\n<li>The commit hash (<code>git rev-parse HEAD</code>)<br>\n<a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/4d924e796368163eff11a8151e8505715345f58d/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/4d924e796368163eff11a8151e8505715345f58d\"><tt>4d924e7</tt></a> (Release 0.12.1)</li>\n<li>The output of <code>bazel version</code></li>\n</ol>\n<pre><code>Build label: 0.4.2\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Wed Dec 7 18:47:11 2016 (1481136431)\nBuild timestamp: 1481136431\nBuild timestamp as int: 1481136431\n</code></pre>\n<h3>If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)</h3>\n<p>I simply used this example <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/dist_test/python/mnist_replica.py\">mnist_replica.py</a> in tensorflow repository.</p>\n<h3>Logs or other output that would be helpful</h3>\n<p>First I launched the parameter server</p>\n<pre><code>export CUDA_VISIBLE_DEVICES=0; python mnist_replica.py --ps_hosts=\"localhost:50000\" --worker_hosts=\"localhost:50001\" --job_name=\"ps\" --task_index=0 --num_gpus=1 --sync_replicas=True\n</code></pre>\n<p>and then launched the worker with <code>sync_replicas=True</code> tag</p>\n<pre><code>export CUDA_VISIBLE_DEVICES=1; python mnist_replica.py --ps_hosts=\"localhost:50000\" --worker_hosts=\"localhost:50001\" --job_name=\"worker\" --task_index=0 --num_gpus=2 --train_steps=100 --sync_replicas=True\n</code></pre>\n<p>but I got some errors here</p>\n<pre><code>...\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -&gt; (device: 0, name: Tesla K40m, pci bus id: 0000:2b:00.0)\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:197] Initialize GrpcChannelCache for job ps -&gt; {0 -&gt; localhost:50000}\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:197] Initialize GrpcChannelCache for job worker -&gt; {0 -&gt; localhost:50001, 1 -&gt; localhost:50002}\nI tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:211] Started server with target: grpc://localhost:50002\nTraceback (most recent call last):\n  File \"mnist_replica.py\", line 281, in &lt;module&gt;\n    tf.app.run()\n  File \"local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 43, in run\n    sys.exit(main(sys.argv[:1] + flags_passthrough))\n  File \"mnist_replica.py\", line 186, in main\n    train_step = opt.minimize(cross_entropy, global_step=global_step)\n  File \"local/lib/python2.7/site-packages/tensorflow/python/training/optimizer.py\", line 279, in minimize\n    name=name)\n  File \"local/lib/python2.7/site-packages/tensorflow/python/training/sync_replicas_optimizer.py\", line 751, in apply_gradients\n    array_ops.reshape(self._replica_id, (1,)),\n  File \"local/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 2448, in reshape\n    name=name)\n  File \"local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 503, in apply_op\n    as_ref=input_arg.is_ref).dtype.name\n  File \"local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 669, in convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"local/lib/python2.7/site-packages/tensorflow/python/framework/constant_op.py\", line 176, in _constant_tensor_conversion_function\n    return constant(v, dtype=dtype, name=name)\n  File \"local/lib/python2.7/site-packages/tensorflow/python/framework/constant_op.py\", line 165, in constant\n    tensor_util.make_tensor_proto(value, dtype=dtype, shape=shape, verify_shape=verify_shape))\n  File \"local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_util.py\", line 360, in make_tensor_proto\n    raise ValueError(\"None values not supported.\")\nValueError: None values not supported.\n</code></pre>", "body_text": "Hi,\nI was trying to run a distributed tensorflow example in the official repository with v0.12.1 (current latest release).\nI can run asynchronous version without problems, but when I turned on sync_replicas tag, some errors occurred.\n(Please check the following logs in details)\nThis example code can be ran successfully with v0.12.0, so I guess there might be some modification from 0.12.0 to 0.12.1?\nCould someone check if that's the case? Thanks.\nWhat related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\nI haven't found others reported this issue as tensorflow v0.12.1 just released,\nEnvironment info\nOperating System:\nUbuntu 14.04\nInstalled version of CUDA and cuDNN:\nCUDA 7.5, cuDNN 5.1\n> ls -l /usr/local/cuda/lib/libcud*\n-rw-r--r-- 1 root root 189170 Oct 25 22:51 /usr/local/cuda/lib/libcudadevrt.a\nlrwxrwxrwx 1 root root     16 Oct 25 22:51 /usr/local/cuda/lib/libcudart.so -> libcudart.so.7.5\nlrwxrwxrwx 1 root root     19 Oct 25 22:51 /usr/local/cuda/lib/libcudart.so.7.5 -> libcudart.so.7.5.18\n-rwxr-xr-x 1 root root 311596 Oct 25 22:51 /usr/local/cuda/lib/libcudart.so.7.5.18\n-rw-r--r-- 1 root root 558020 Oct 25 22:51 /usr/local/cuda/lib/libcudart_static.a\n\nIf installed from source, provide\n\nThe commit hash (git rev-parse HEAD)\n4d924e7 (Release 0.12.1)\nThe output of bazel version\n\nBuild label: 0.4.2\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Wed Dec 7 18:47:11 2016 (1481136431)\nBuild timestamp: 1481136431\nBuild timestamp as int: 1481136431\n\nIf possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\nI simply used this example mnist_replica.py in tensorflow repository.\nLogs or other output that would be helpful\nFirst I launched the parameter server\nexport CUDA_VISIBLE_DEVICES=0; python mnist_replica.py --ps_hosts=\"localhost:50000\" --worker_hosts=\"localhost:50001\" --job_name=\"ps\" --task_index=0 --num_gpus=1 --sync_replicas=True\n\nand then launched the worker with sync_replicas=True tag\nexport CUDA_VISIBLE_DEVICES=1; python mnist_replica.py --ps_hosts=\"localhost:50000\" --worker_hosts=\"localhost:50001\" --job_name=\"worker\" --task_index=0 --num_gpus=2 --train_steps=100 --sync_replicas=True\n\nbut I got some errors here\n...\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Tesla K40m, pci bus id: 0000:2b:00.0)\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:197] Initialize GrpcChannelCache for job ps -> {0 -> localhost:50000}\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:197] Initialize GrpcChannelCache for job worker -> {0 -> localhost:50001, 1 -> localhost:50002}\nI tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:211] Started server with target: grpc://localhost:50002\nTraceback (most recent call last):\n  File \"mnist_replica.py\", line 281, in <module>\n    tf.app.run()\n  File \"local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 43, in run\n    sys.exit(main(sys.argv[:1] + flags_passthrough))\n  File \"mnist_replica.py\", line 186, in main\n    train_step = opt.minimize(cross_entropy, global_step=global_step)\n  File \"local/lib/python2.7/site-packages/tensorflow/python/training/optimizer.py\", line 279, in minimize\n    name=name)\n  File \"local/lib/python2.7/site-packages/tensorflow/python/training/sync_replicas_optimizer.py\", line 751, in apply_gradients\n    array_ops.reshape(self._replica_id, (1,)),\n  File \"local/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 2448, in reshape\n    name=name)\n  File \"local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 503, in apply_op\n    as_ref=input_arg.is_ref).dtype.name\n  File \"local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 669, in convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"local/lib/python2.7/site-packages/tensorflow/python/framework/constant_op.py\", line 176, in _constant_tensor_conversion_function\n    return constant(v, dtype=dtype, name=name)\n  File \"local/lib/python2.7/site-packages/tensorflow/python/framework/constant_op.py\", line 165, in constant\n    tensor_util.make_tensor_proto(value, dtype=dtype, shape=shape, verify_shape=verify_shape))\n  File \"local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_util.py\", line 360, in make_tensor_proto\n    raise ValueError(\"None values not supported.\")\nValueError: None values not supported.", "body": "Hi,\r\n\r\nI was trying to run a distributed tensorflow [example](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/dist_test/python/mnist_replica.py\r\n) in the official repository with v0.12.1 (current latest release).\r\nI can run asynchronous version without problems, but when I turned on `sync_replicas` tag, some errors occurred.\r\n(Please check the following logs in details)\r\n\r\nThis example code can be ran successfully with v0.12.0, so I guess there might be some modification from 0.12.0 to 0.12.1?\r\nCould someone check if that's the case? Thanks.\r\n\r\n### What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\r\n\r\nI haven't found others reported this issue as tensorflow v0.12.1 just released,\r\n\r\n### Environment info\r\nOperating System:\r\nUbuntu 14.04\r\n\r\nInstalled version of CUDA and cuDNN: \r\nCUDA 7.5, cuDNN 5.1\r\n\r\n```\r\n> ls -l /usr/local/cuda/lib/libcud*\r\n-rw-r--r-- 1 root root 189170 Oct 25 22:51 /usr/local/cuda/lib/libcudadevrt.a\r\nlrwxrwxrwx 1 root root     16 Oct 25 22:51 /usr/local/cuda/lib/libcudart.so -> libcudart.so.7.5\r\nlrwxrwxrwx 1 root root     19 Oct 25 22:51 /usr/local/cuda/lib/libcudart.so.7.5 -> libcudart.so.7.5.18\r\n-rwxr-xr-x 1 root root 311596 Oct 25 22:51 /usr/local/cuda/lib/libcudart.so.7.5.18\r\n-rw-r--r-- 1 root root 558020 Oct 25 22:51 /usr/local/cuda/lib/libcudart_static.a\r\n```\r\n\r\nIf installed from source, provide \r\n\r\n1. The commit hash (`git rev-parse HEAD`)\r\n4d924e796368163eff11a8151e8505715345f58d (Release 0.12.1)\r\n2. The output of `bazel version`\r\n```\r\nBuild label: 0.4.2\r\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\r\nBuild time: Wed Dec 7 18:47:11 2016 (1481136431)\r\nBuild timestamp: 1481136431\r\nBuild timestamp as int: 1481136431\r\n```\r\n\r\n### If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\r\n\r\nI simply used this example [mnist_replica.py](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/dist_test/python/mnist_replica.py) in tensorflow repository.\r\n\r\n### Logs or other output that would be helpful\r\n\r\nFirst I launched the parameter server\r\n```\r\nexport CUDA_VISIBLE_DEVICES=0; python mnist_replica.py --ps_hosts=\"localhost:50000\" --worker_hosts=\"localhost:50001\" --job_name=\"ps\" --task_index=0 --num_gpus=1 --sync_replicas=True\r\n```\r\nand then launched the worker with `sync_replicas=True` tag\r\n```\r\nexport CUDA_VISIBLE_DEVICES=1; python mnist_replica.py --ps_hosts=\"localhost:50000\" --worker_hosts=\"localhost:50001\" --job_name=\"worker\" --task_index=0 --num_gpus=2 --train_steps=100 --sync_replicas=True\r\n```\r\n\r\nbut I got some errors here\r\n\r\n```\r\n...\r\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:975] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Tesla K40m, pci bus id: 0000:2b:00.0)\r\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:197] Initialize GrpcChannelCache for job ps -> {0 -> localhost:50000}\r\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:197] Initialize GrpcChannelCache for job worker -> {0 -> localhost:50001, 1 -> localhost:50002}\r\nI tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:211] Started server with target: grpc://localhost:50002\r\nTraceback (most recent call last):\r\n  File \"mnist_replica.py\", line 281, in <module>\r\n    tf.app.run()\r\n  File \"local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 43, in run\r\n    sys.exit(main(sys.argv[:1] + flags_passthrough))\r\n  File \"mnist_replica.py\", line 186, in main\r\n    train_step = opt.minimize(cross_entropy, global_step=global_step)\r\n  File \"local/lib/python2.7/site-packages/tensorflow/python/training/optimizer.py\", line 279, in minimize\r\n    name=name)\r\n  File \"local/lib/python2.7/site-packages/tensorflow/python/training/sync_replicas_optimizer.py\", line 751, in apply_gradients\r\n    array_ops.reshape(self._replica_id, (1,)),\r\n  File \"local/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 2448, in reshape\r\n    name=name)\r\n  File \"local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 503, in apply_op\r\n    as_ref=input_arg.is_ref).dtype.name\r\n  File \"local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 669, in convert_to_tensor\r\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\r\n  File \"local/lib/python2.7/site-packages/tensorflow/python/framework/constant_op.py\", line 176, in _constant_tensor_conversion_function\r\n    return constant(v, dtype=dtype, name=name)\r\n  File \"local/lib/python2.7/site-packages/tensorflow/python/framework/constant_op.py\", line 165, in constant\r\n    tensor_util.make_tensor_proto(value, dtype=dtype, shape=shape, verify_shape=verify_shape))\r\n  File \"local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_util.py\", line 360, in make_tensor_proto\r\n    raise ValueError(\"None values not supported.\")\r\nValueError: None values not supported.\r\n```"}