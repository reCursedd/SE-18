{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/22922", "id": 222340590, "node_id": "MDExOlB1bGxSZXF1ZXN0MjIyMzQwNTkw", "html_url": "https://github.com/tensorflow/tensorflow/pull/22922", "diff_url": "https://github.com/tensorflow/tensorflow/pull/22922.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/22922.patch", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22922", "number": 22922, "state": "closed", "locked": false, "title": "r1.12-rc1 cherry-pick request: Make sure that all operands and outputs of Sort have the same layout.", "user": {"login": "tatatodd", "id": 5453737, "node_id": "MDQ6VXNlcjU0NTM3Mzc=", "avatar_url": "https://avatars3.githubusercontent.com/u/5453737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tatatodd", "html_url": "https://github.com/tatatodd", "followers_url": "https://api.github.com/users/tatatodd/followers", "following_url": "https://api.github.com/users/tatatodd/following{/other_user}", "gists_url": "https://api.github.com/users/tatatodd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tatatodd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tatatodd/subscriptions", "organizations_url": "https://api.github.com/users/tatatodd/orgs", "repos_url": "https://api.github.com/users/tatatodd/repos", "events_url": "https://api.github.com/users/tatatodd/events{/privacy}", "received_events_url": "https://api.github.com/users/tatatodd/received_events", "type": "User", "site_admin": false}, "body": "PiperOrigin-RevId: 215324035\r\nPiperOrigin-RevId: 215515611\r\nPiperOrigin-RevId: 216726796\r\n\r\nThis PR includes cherrypicks of the above three PiperOrigin CLs.  All three are necessary to avoid conflicts.  The cherrypick we really want is the last one (216726796), the other two are coming along for the ride.\r\n\r\n------\r\ncl/215324035\r\n[XLA] Migrate from gtl::FlatSet to absl::flat_hash_set\r\n\r\n------\r\ncl/215515611\r\n[XLA] Modify the function that determines whether an instruction can change\r\nlayout so that it can be used by the HLO verifier.\r\n\r\nChange the function to a static member function of the LayoutAssignment class.\r\n\r\nAdd an std::function member to LayoutAssignment to store the function object\r\npassed down from the backend compiler class and use it to decide whether an\r\ninstruction can change layouts.\r\n\r\nFix affected test cases.\r\n\r\n------\r\ncl/216726796\r\n\r\nMake sure that all operands and outputs of Sort have the same layout.\r\n\r\nAlso fix the DotLayout test, it would pass even when commenting out the dot specific logic in GpuLayoutAssignment.\r\n", "created_at": "2018-10-12T03:40:20Z", "updated_at": "2018-10-12T04:25:40Z", "closed_at": "2018-10-12T04:25:39Z", "merged_at": "2018-10-12T04:25:39Z", "merge_commit_sha": "1d02ebdb3062ebacfa3b1a4bef5d93214e6ef6a5", "assignee": null, "assignees": [], "requested_reviewers": [{"login": "tayo", "id": 10927929, "node_id": "MDQ6VXNlcjEwOTI3OTI5", "avatar_url": "https://avatars3.githubusercontent.com/u/10927929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tayo", "html_url": "https://github.com/tayo", "followers_url": "https://api.github.com/users/tayo/followers", "following_url": "https://api.github.com/users/tayo/following{/other_user}", "gists_url": "https://api.github.com/users/tayo/gists{/gist_id}", "starred_url": "https://api.github.com/users/tayo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tayo/subscriptions", "organizations_url": "https://api.github.com/users/tayo/orgs", "repos_url": "https://api.github.com/users/tayo/repos", "events_url": "https://api.github.com/users/tayo/events{/privacy}", "received_events_url": "https://api.github.com/users/tayo/received_events", "type": "User", "site_admin": false}, {"login": "bixia1", "id": 35820639, "node_id": "MDQ6VXNlcjM1ODIwNjM5", "avatar_url": "https://avatars1.githubusercontent.com/u/35820639?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bixia1", "html_url": "https://github.com/bixia1", "followers_url": "https://api.github.com/users/bixia1/followers", "following_url": "https://api.github.com/users/bixia1/following{/other_user}", "gists_url": "https://api.github.com/users/bixia1/gists{/gist_id}", "starred_url": "https://api.github.com/users/bixia1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bixia1/subscriptions", "organizations_url": "https://api.github.com/users/bixia1/orgs", "repos_url": "https://api.github.com/users/bixia1/repos", "events_url": "https://api.github.com/users/bixia1/events{/privacy}", "received_events_url": "https://api.github.com/users/bixia1/received_events", "type": "User", "site_admin": false}], "requested_teams": [], "labels": [{"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}], "milestone": null, "commits_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/22922/commits", "review_comments_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/22922/comments", "review_comment_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments{/number}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22922/comments", "statuses_url": "https://api.github.com/repos/tensorflow/tensorflow/statuses/13a6dd922626e0b1f9da6a25c16c5adea18ee3fd", "head": {"label": "tatatodd:cherrypicks_FFROZ", "ref": "cherrypicks_FFROZ", "sha": "13a6dd922626e0b1f9da6a25c16c5adea18ee3fd", "user": {"login": "tatatodd", "id": 5453737, "node_id": "MDQ6VXNlcjU0NTM3Mzc=", "avatar_url": "https://avatars3.githubusercontent.com/u/5453737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tatatodd", "html_url": "https://github.com/tatatodd", "followers_url": "https://api.github.com/users/tatatodd/followers", "following_url": "https://api.github.com/users/tatatodd/following{/other_user}", "gists_url": "https://api.github.com/users/tatatodd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tatatodd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tatatodd/subscriptions", "organizations_url": "https://api.github.com/users/tatatodd/orgs", "repos_url": "https://api.github.com/users/tatatodd/repos", "events_url": "https://api.github.com/users/tatatodd/events{/privacy}", "received_events_url": "https://api.github.com/users/tatatodd/received_events", "type": "User", "site_admin": false}, "repo": {"id": 81253510, "node_id": "MDEwOlJlcG9zaXRvcnk4MTI1MzUxMA==", "name": "tensorflow", "full_name": "tatatodd/tensorflow", "private": false, "owner": {"login": "tatatodd", "id": 5453737, "node_id": "MDQ6VXNlcjU0NTM3Mzc=", "avatar_url": "https://avatars3.githubusercontent.com/u/5453737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tatatodd", "html_url": "https://github.com/tatatodd", "followers_url": "https://api.github.com/users/tatatodd/followers", "following_url": "https://api.github.com/users/tatatodd/following{/other_user}", "gists_url": "https://api.github.com/users/tatatodd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tatatodd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tatatodd/subscriptions", "organizations_url": "https://api.github.com/users/tatatodd/orgs", "repos_url": "https://api.github.com/users/tatatodd/repos", "events_url": "https://api.github.com/users/tatatodd/events{/privacy}", "received_events_url": "https://api.github.com/users/tatatodd/received_events", "type": "User", "site_admin": false}, "html_url": "https://github.com/tatatodd/tensorflow", "description": "Computation using data flow graphs for scalable machine learning", "fork": true, "url": "https://api.github.com/repos/tatatodd/tensorflow", "forks_url": "https://api.github.com/repos/tatatodd/tensorflow/forks", "keys_url": "https://api.github.com/repos/tatatodd/tensorflow/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/tatatodd/tensorflow/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/tatatodd/tensorflow/teams", "hooks_url": "https://api.github.com/repos/tatatodd/tensorflow/hooks", "issue_events_url": "https://api.github.com/repos/tatatodd/tensorflow/issues/events{/number}", "events_url": "https://api.github.com/repos/tatatodd/tensorflow/events", "assignees_url": "https://api.github.com/repos/tatatodd/tensorflow/assignees{/user}", "branches_url": "https://api.github.com/repos/tatatodd/tensorflow/branches{/branch}", "tags_url": "https://api.github.com/repos/tatatodd/tensorflow/tags", "blobs_url": "https://api.github.com/repos/tatatodd/tensorflow/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/tatatodd/tensorflow/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/tatatodd/tensorflow/git/refs{/sha}", "trees_url": "https://api.github.com/repos/tatatodd/tensorflow/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/tatatodd/tensorflow/statuses/{sha}", "languages_url": "https://api.github.com/repos/tatatodd/tensorflow/languages", "stargazers_url": "https://api.github.com/repos/tatatodd/tensorflow/stargazers", "contributors_url": "https://api.github.com/repos/tatatodd/tensorflow/contributors", "subscribers_url": "https://api.github.com/repos/tatatodd/tensorflow/subscribers", "subscription_url": "https://api.github.com/repos/tatatodd/tensorflow/subscription", "commits_url": "https://api.github.com/repos/tatatodd/tensorflow/commits{/sha}", "git_commits_url": "https://api.github.com/repos/tatatodd/tensorflow/git/commits{/sha}", "comments_url": "https://api.github.com/repos/tatatodd/tensorflow/comments{/number}", "issue_comment_url": "https://api.github.com/repos/tatatodd/tensorflow/issues/comments{/number}", "contents_url": "https://api.github.com/repos/tatatodd/tensorflow/contents/{+path}", "compare_url": "https://api.github.com/repos/tatatodd/tensorflow/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/tatatodd/tensorflow/merges", "archive_url": "https://api.github.com/repos/tatatodd/tensorflow/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/tatatodd/tensorflow/downloads", "issues_url": "https://api.github.com/repos/tatatodd/tensorflow/issues{/number}", "pulls_url": "https://api.github.com/repos/tatatodd/tensorflow/pulls{/number}", "milestones_url": "https://api.github.com/repos/tatatodd/tensorflow/milestones{/number}", "notifications_url": "https://api.github.com/repos/tatatodd/tensorflow/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/tatatodd/tensorflow/labels{/name}", "releases_url": "https://api.github.com/repos/tatatodd/tensorflow/releases{/id}", "deployments_url": "https://api.github.com/repos/tatatodd/tensorflow/deployments", "created_at": "2017-02-07T20:58:14Z", "updated_at": "2018-11-02T21:10:16Z", "pushed_at": "2018-11-02T21:09:31Z", "git_url": "git://github.com/tatatodd/tensorflow.git", "ssh_url": "git@github.com:tatatodd/tensorflow.git", "clone_url": "https://github.com/tatatodd/tensorflow.git", "svn_url": "https://github.com/tatatodd/tensorflow", "homepage": "http://tensorflow.org", "size": 273005, "stargazers_count": 0, "watchers_count": 0, "language": "C++", "has_issues": false, "has_projects": true, "has_downloads": true, "has_wiki": false, "has_pages": false, "forks_count": 0, "mirror_url": null, "archived": false, "open_issues_count": 0, "license": {"key": "apache-2.0", "name": "Apache License 2.0", "spdx_id": "Apache-2.0", "url": "https://api.github.com/licenses/apache-2.0", "node_id": "MDc6TGljZW5zZTI="}, "forks": 0, "open_issues": 0, "watchers": 0, "default_branch": "master"}}, "base": {"label": "tensorflow:r1.12", "ref": "r1.12", "sha": "856cf9927774b4e348435c784726f31701931415", "user": {"login": "tensorflow", "id": 15658638, "node_id": "MDEyOk9yZ2FuaXphdGlvbjE1NjU4NjM4", "avatar_url": "https://avatars1.githubusercontent.com/u/15658638?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tensorflow", "html_url": "https://github.com/tensorflow", "followers_url": "https://api.github.com/users/tensorflow/followers", "following_url": "https://api.github.com/users/tensorflow/following{/other_user}", "gists_url": "https://api.github.com/users/tensorflow/gists{/gist_id}", "starred_url": "https://api.github.com/users/tensorflow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tensorflow/subscriptions", "organizations_url": "https://api.github.com/users/tensorflow/orgs", "repos_url": "https://api.github.com/users/tensorflow/repos", "events_url": "https://api.github.com/users/tensorflow/events{/privacy}", "received_events_url": "https://api.github.com/users/tensorflow/received_events", "type": "Organization", "site_admin": false}, "repo": {"id": 45717250, "node_id": "MDEwOlJlcG9zaXRvcnk0NTcxNzI1MA==", "name": "tensorflow", "full_name": "tensorflow/tensorflow", "private": false, "owner": {"login": "tensorflow", "id": 15658638, "node_id": "MDEyOk9yZ2FuaXphdGlvbjE1NjU4NjM4", "avatar_url": "https://avatars1.githubusercontent.com/u/15658638?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tensorflow", "html_url": "https://github.com/tensorflow", "followers_url": "https://api.github.com/users/tensorflow/followers", "following_url": "https://api.github.com/users/tensorflow/following{/other_user}", "gists_url": "https://api.github.com/users/tensorflow/gists{/gist_id}", "starred_url": "https://api.github.com/users/tensorflow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tensorflow/subscriptions", "organizations_url": "https://api.github.com/users/tensorflow/orgs", "repos_url": "https://api.github.com/users/tensorflow/repos", "events_url": "https://api.github.com/users/tensorflow/events{/privacy}", "received_events_url": "https://api.github.com/users/tensorflow/received_events", "type": "Organization", "site_admin": false}, "html_url": "https://github.com/tensorflow/tensorflow", "description": "An Open Source Machine Learning Framework for Everyone", "fork": false, "url": "https://api.github.com/repos/tensorflow/tensorflow", "forks_url": "https://api.github.com/repos/tensorflow/tensorflow/forks", "keys_url": "https://api.github.com/repos/tensorflow/tensorflow/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/tensorflow/tensorflow/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/tensorflow/tensorflow/teams", "hooks_url": "https://api.github.com/repos/tensorflow/tensorflow/hooks", "issue_events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/events{/number}", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/events", "assignees_url": "https://api.github.com/repos/tensorflow/tensorflow/assignees{/user}", "branches_url": "https://api.github.com/repos/tensorflow/tensorflow/branches{/branch}", "tags_url": "https://api.github.com/repos/tensorflow/tensorflow/tags", "blobs_url": "https://api.github.com/repos/tensorflow/tensorflow/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/tensorflow/tensorflow/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/tensorflow/tensorflow/git/refs{/sha}", "trees_url": "https://api.github.com/repos/tensorflow/tensorflow/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/tensorflow/tensorflow/statuses/{sha}", "languages_url": "https://api.github.com/repos/tensorflow/tensorflow/languages", "stargazers_url": "https://api.github.com/repos/tensorflow/tensorflow/stargazers", "contributors_url": "https://api.github.com/repos/tensorflow/tensorflow/contributors", "subscribers_url": "https://api.github.com/repos/tensorflow/tensorflow/subscribers", "subscription_url": "https://api.github.com/repos/tensorflow/tensorflow/subscription", "commits_url": "https://api.github.com/repos/tensorflow/tensorflow/commits{/sha}", "git_commits_url": "https://api.github.com/repos/tensorflow/tensorflow/git/commits{/sha}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/comments{/number}", "issue_comment_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments{/number}", "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/{+path}", "compare_url": "https://api.github.com/repos/tensorflow/tensorflow/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/tensorflow/tensorflow/merges", "archive_url": "https://api.github.com/repos/tensorflow/tensorflow/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/tensorflow/tensorflow/downloads", "issues_url": "https://api.github.com/repos/tensorflow/tensorflow/issues{/number}", "pulls_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls{/number}", "milestones_url": "https://api.github.com/repos/tensorflow/tensorflow/milestones{/number}", "notifications_url": "https://api.github.com/repos/tensorflow/tensorflow/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/labels{/name}", "releases_url": "https://api.github.com/repos/tensorflow/tensorflow/releases{/id}", "deployments_url": "https://api.github.com/repos/tensorflow/tensorflow/deployments", "created_at": "2015-11-07T01:19:20Z", "updated_at": "2018-11-25T01:43:55Z", "pushed_at": "2018-11-24T18:40:19Z", "git_url": "git://github.com/tensorflow/tensorflow.git", "ssh_url": "git@github.com:tensorflow/tensorflow.git", "clone_url": "https://github.com/tensorflow/tensorflow.git", "svn_url": "https://github.com/tensorflow/tensorflow", "homepage": "https://tensorflow.org", "size": 284546, "stargazers_count": 115177, "watchers_count": 115177, "language": "C++", "has_issues": true, "has_projects": true, "has_downloads": true, "has_wiki": false, "has_pages": false, "forks_count": 69948, "mirror_url": null, "archived": false, "open_issues_count": 1760, "license": {"key": "apache-2.0", "name": "Apache License 2.0", "spdx_id": "Apache-2.0", "url": "https://api.github.com/licenses/apache-2.0", "node_id": "MDc6TGljZW5zZTI="}, "forks": 69948, "open_issues": 1760, "watchers": 115177, "default_branch": "master"}}, "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/22922"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/22922"}, "issue": {"href": "https://api.github.com/repos/tensorflow/tensorflow/issues/22922"}, "comments": {"href": "https://api.github.com/repos/tensorflow/tensorflow/issues/22922/comments"}, "review_comments": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/22922/comments"}, "review_comment": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments{/number}"}, "commits": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/22922/commits"}, "statuses": {"href": "https://api.github.com/repos/tensorflow/tensorflow/statuses/13a6dd922626e0b1f9da6a25c16c5adea18ee3fd"}}, "author_association": "MEMBER", "body_html": "<p>PiperOrigin-RevId: 215324035<br>\nPiperOrigin-RevId: 215515611<br>\nPiperOrigin-RevId: 216726796</p>\n<p>This PR includes cherrypicks of the above three PiperOrigin CLs.  All three are necessary to avoid conflicts.  The cherrypick we really want is the last one (216726796), the other two are coming along for the ride.</p>\n<hr>\n<p>cl/215324035<br>\n[XLA] Migrate from gtl::FlatSet to absl::flat_hash_set</p>\n<hr>\n<p>cl/215515611<br>\n[XLA] Modify the function that determines whether an instruction can change<br>\nlayout so that it can be used by the HLO verifier.</p>\n<p>Change the function to a static member function of the LayoutAssignment class.</p>\n<p>Add an std::function member to LayoutAssignment to store the function object<br>\npassed down from the backend compiler class and use it to decide whether an<br>\ninstruction can change layouts.</p>\n<p>Fix affected test cases.</p>\n<hr>\n<p>cl/216726796</p>\n<p>Make sure that all operands and outputs of Sort have the same layout.</p>\n<p>Also fix the DotLayout test, it would pass even when commenting out the dot specific logic in GpuLayoutAssignment.</p>", "body_text": "PiperOrigin-RevId: 215324035\nPiperOrigin-RevId: 215515611\nPiperOrigin-RevId: 216726796\nThis PR includes cherrypicks of the above three PiperOrigin CLs.  All three are necessary to avoid conflicts.  The cherrypick we really want is the last one (216726796), the other two are coming along for the ride.\n\ncl/215324035\n[XLA] Migrate from gtl::FlatSet to absl::flat_hash_set\n\ncl/215515611\n[XLA] Modify the function that determines whether an instruction can change\nlayout so that it can be used by the HLO verifier.\nChange the function to a static member function of the LayoutAssignment class.\nAdd an std::function member to LayoutAssignment to store the function object\npassed down from the backend compiler class and use it to decide whether an\ninstruction can change layouts.\nFix affected test cases.\n\ncl/216726796\nMake sure that all operands and outputs of Sort have the same layout.\nAlso fix the DotLayout test, it would pass even when commenting out the dot specific logic in GpuLayoutAssignment.", "merged": true, "mergeable": null, "rebaseable": null, "mergeable_state": "unknown", "merged_by": {"login": "tatatodd", "id": 5453737, "node_id": "MDQ6VXNlcjU0NTM3Mzc=", "avatar_url": "https://avatars3.githubusercontent.com/u/5453737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tatatodd", "html_url": "https://github.com/tatatodd", "followers_url": "https://api.github.com/users/tatatodd/followers", "following_url": "https://api.github.com/users/tatatodd/following{/other_user}", "gists_url": "https://api.github.com/users/tatatodd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tatatodd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tatatodd/subscriptions", "organizations_url": "https://api.github.com/users/tatatodd/orgs", "repos_url": "https://api.github.com/users/tatatodd/repos", "events_url": "https://api.github.com/users/tatatodd/events{/privacy}", "received_events_url": "https://api.github.com/users/tatatodd/received_events", "type": "User", "site_admin": false}, "comments": 1, "review_comments": 0, "maintainer_can_modify": false, "commits": 3, "additions": 350, "deletions": 213, "changed_files": 73}