{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/288492144", "html_url": "https://github.com/tensorflow/tensorflow/issues/7896#issuecomment-288492144", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7896", "id": 288492144, "node_id": "MDEyOklzc3VlQ29tbWVudDI4ODQ5MjE0NA==", "user": {"login": "bdhingra", "id": 8645980, "node_id": "MDQ6VXNlcjg2NDU5ODA=", "avatar_url": "https://avatars3.githubusercontent.com/u/8645980?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bdhingra", "html_url": "https://github.com/bdhingra", "followers_url": "https://api.github.com/users/bdhingra/followers", "following_url": "https://api.github.com/users/bdhingra/following{/other_user}", "gists_url": "https://api.github.com/users/bdhingra/gists{/gist_id}", "starred_url": "https://api.github.com/users/bdhingra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bdhingra/subscriptions", "organizations_url": "https://api.github.com/users/bdhingra/orgs", "repos_url": "https://api.github.com/users/bdhingra/repos", "events_url": "https://api.github.com/users/bdhingra/events{/privacy}", "received_events_url": "https://api.github.com/users/bdhingra/received_events", "type": "User", "site_admin": false}, "created_at": "2017-03-22T18:18:28Z", "updated_at": "2017-03-22T18:23:29Z", "author_association": "NONE", "body_html": "<p>I am facing the exact same error. Relevant code below:</p>\n<pre><code>def _mem_read(self, e):\n        # e : B x R x C, self.memory : B x N x R x Dr\n        N = tf.shape(self.memory)[1] # length of the sequence + 1\n        eshuf = tf.transpose(e, perm=(2,0,1)) # C x B x R\n        e1hot = tf.one_hot(eshuf, N, axis=2) # C x B x N x R\n\n        # accumulate across C\n        def _accum(acc, x):\n            # x : B x N x R\n            # acc : B x N x R x Dr\n            return acc + tf.expand_dims(x, axis=3)*self.memory\n\n        out = tf.scan(_accum, e1hot,\n                initializer=tf.zeros((tf.shape(e)[0], N, self.num_relations, self.rdims),\n                    dtype=tf.float32)) # B x N x R x Dr\n        out = tf.reduce_sum(out, axis=1) # B x R x Dr\n        return out\n</code></pre>\n<p>The error i receive is:</p>\n<blockquote>\n<p>ValueError: The shape for scan/while/scan/while/Merge_1:0 is not an invariant for the loop. It enters the loop with shape (?, ?, 2, 2), but has shape &lt;unknown&gt; after one iteration. Provide shape invariants using either the <code>shape_invariants</code> argument of tf.while_loop or set_shape() on the loop variables.</p>\n</blockquote>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=9432938\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/RiaanZoetmulder\">@RiaanZoetmulder</a> could you please elaborate exactly where you added the additional expand_dims and squeeze to resolve the error?</p>\n<p>Thanks,<br>\nBhuwan</p>", "body_text": "I am facing the exact same error. Relevant code below:\ndef _mem_read(self, e):\n        # e : B x R x C, self.memory : B x N x R x Dr\n        N = tf.shape(self.memory)[1] # length of the sequence + 1\n        eshuf = tf.transpose(e, perm=(2,0,1)) # C x B x R\n        e1hot = tf.one_hot(eshuf, N, axis=2) # C x B x N x R\n\n        # accumulate across C\n        def _accum(acc, x):\n            # x : B x N x R\n            # acc : B x N x R x Dr\n            return acc + tf.expand_dims(x, axis=3)*self.memory\n\n        out = tf.scan(_accum, e1hot,\n                initializer=tf.zeros((tf.shape(e)[0], N, self.num_relations, self.rdims),\n                    dtype=tf.float32)) # B x N x R x Dr\n        out = tf.reduce_sum(out, axis=1) # B x R x Dr\n        return out\n\nThe error i receive is:\n\nValueError: The shape for scan/while/scan/while/Merge_1:0 is not an invariant for the loop. It enters the loop with shape (?, ?, 2, 2), but has shape <unknown> after one iteration. Provide shape invariants using either the shape_invariants argument of tf.while_loop or set_shape() on the loop variables.\n\n@RiaanZoetmulder could you please elaborate exactly where you added the additional expand_dims and squeeze to resolve the error?\nThanks,\nBhuwan", "body": "I am facing the exact same error. Relevant code below:\r\n\r\n```\r\ndef _mem_read(self, e):\r\n        # e : B x R x C, self.memory : B x N x R x Dr\r\n        N = tf.shape(self.memory)[1] # length of the sequence + 1\r\n        eshuf = tf.transpose(e, perm=(2,0,1)) # C x B x R\r\n        e1hot = tf.one_hot(eshuf, N, axis=2) # C x B x N x R\r\n\r\n        # accumulate across C\r\n        def _accum(acc, x):\r\n            # x : B x N x R\r\n            # acc : B x N x R x Dr\r\n            return acc + tf.expand_dims(x, axis=3)*self.memory\r\n\r\n        out = tf.scan(_accum, e1hot,\r\n                initializer=tf.zeros((tf.shape(e)[0], N, self.num_relations, self.rdims),\r\n                    dtype=tf.float32)) # B x N x R x Dr\r\n        out = tf.reduce_sum(out, axis=1) # B x R x Dr\r\n        return out\r\n```\r\nThe error i receive is:\r\n\r\n> ValueError: The shape for scan/while/scan/while/Merge_1:0 is not an invariant for the loop. It enters the loop with shape (?, ?, 2, 2), but has shape \\<unknown\\> after one iteration. Provide shape invariants using either the `shape_invariants` argument of tf.while_loop or set_shape() on the loop variables.\r\n\r\n@RiaanZoetmulder could you please elaborate exactly where you added the additional expand_dims and squeeze to resolve the error?\r\n\r\nThanks,\r\nBhuwan"}