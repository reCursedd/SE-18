{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/323017174", "html_url": "https://github.com/tensorflow/tensorflow/issues/12328#issuecomment-323017174", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12328", "id": 323017174, "node_id": "MDEyOklzc3VlQ29tbWVudDMyMzAxNzE3NA==", "user": {"login": "marhlder", "id": 2690031, "node_id": "MDQ6VXNlcjI2OTAwMzE=", "avatar_url": "https://avatars0.githubusercontent.com/u/2690031?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marhlder", "html_url": "https://github.com/marhlder", "followers_url": "https://api.github.com/users/marhlder/followers", "following_url": "https://api.github.com/users/marhlder/following{/other_user}", "gists_url": "https://api.github.com/users/marhlder/gists{/gist_id}", "starred_url": "https://api.github.com/users/marhlder/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marhlder/subscriptions", "organizations_url": "https://api.github.com/users/marhlder/orgs", "repos_url": "https://api.github.com/users/marhlder/repos", "events_url": "https://api.github.com/users/marhlder/events{/privacy}", "received_events_url": "https://api.github.com/users/marhlder/received_events", "type": "User", "site_admin": false}, "created_at": "2017-08-17T09:25:27Z", "updated_at": "2017-08-17T17:16:23Z", "author_association": "NONE", "body_html": "<p>Might there be a memory management issue in the JNI code?<br>\nJava_org_tensorflow_Tensor_scalarBytes?<br>\nLooks like it might be releasing the byte array before the java code gets a chance it use it?</p>\n<p>I'm not much into JNI but other snippets seems to parse the byte array to a method before they release it (i.e. giving the java program a chance to make a copy or something)<br>\nE.g. <a href=\"https://stackoverflow.com/questions/24076624/how-to-pass-char-array-from-c-jni-function-to-java-method-as-byte\" rel=\"nofollow\">https://stackoverflow.com/questions/24076624/how-to-pass-char-array-from-c-jni-function-to-java-method-as-byte</a></p>\n<p>Hmm i guess release means something else in this context..</p>\n<p>I just printed the string in the JNI code and it seems like there is problems already before the JNI code gets its hands on it.</p>\n<p>I inserted a tf.Print op at the end of my graph in python before i export it to a SavedModelBundle and got the following output (I'm still running the model through Java):</p>\n<p>[\\n\\003-:0\\022$I love grapes.Do you even lift bro ?\\032\\033\\n\\001I\\020\\000\\030\\000 \\001*\\003PRP2\\004PRON:\\005nsubj\\032\\033\\n\\004love\\020\\001\\030\\004*\\003VBP2\\004VERB:\\004ROOT\\032!\\n\\tgrapes.Do\\020\\006\\030\\016 \\001*\\002NN2\\004NOUN:\\004dobj\\032\\035\\n\\003you\\020\\020\\030\\022 \\005*\\003PRP2\\004PRON:\\005nsubj\\032\\035\\n\\004even\\020\\024\\030\\027 \\005*\\002RB2\\003ADV:\\006advmod\\032\\035\\n\\004lift\\020\\031\\030\\034 \\002*\\002VB2\\004VERB:\\005ccomp\\032\\034\\n\\003bro\\020\\036\\030  \\005*\\003NNP2\\004NOUN:\\004dobj\\032\\026\\n\\001?\\020\"\\030\" \\001*\\001.2\\001.:\\005punct]</p>", "body_text": "Might there be a memory management issue in the JNI code?\nJava_org_tensorflow_Tensor_scalarBytes?\nLooks like it might be releasing the byte array before the java code gets a chance it use it?\nI'm not much into JNI but other snippets seems to parse the byte array to a method before they release it (i.e. giving the java program a chance to make a copy or something)\nE.g. https://stackoverflow.com/questions/24076624/how-to-pass-char-array-from-c-jni-function-to-java-method-as-byte\nHmm i guess release means something else in this context..\nI just printed the string in the JNI code and it seems like there is problems already before the JNI code gets its hands on it.\nI inserted a tf.Print op at the end of my graph in python before i export it to a SavedModelBundle and got the following output (I'm still running the model through Java):\n[\\n\\003-:0\\022$I love grapes.Do you even lift bro ?\\032\\033\\n\\001I\\020\\000\\030\\000 \\001*\\003PRP2\\004PRON:\\005nsubj\\032\\033\\n\\004love\\020\\001\\030\\004*\\003VBP2\\004VERB:\\004ROOT\\032!\\n\\tgrapes.Do\\020\\006\\030\\016 \\001*\\002NN2\\004NOUN:\\004dobj\\032\\035\\n\\003you\\020\\020\\030\\022 \\005*\\003PRP2\\004PRON:\\005nsubj\\032\\035\\n\\004even\\020\\024\\030\\027 \\005*\\002RB2\\003ADV:\\006advmod\\032\\035\\n\\004lift\\020\\031\\030\\034 \\002*\\002VB2\\004VERB:\\005ccomp\\032\\034\\n\\003bro\\020\\036\\030  \\005*\\003NNP2\\004NOUN:\\004dobj\\032\\026\\n\\001?\\020\"\\030\" \\001*\\001.2\\001.:\\005punct]", "body": "Might there be a memory management issue in the JNI code? \r\nJava_org_tensorflow_Tensor_scalarBytes?\r\nLooks like it might be releasing the byte array before the java code gets a chance it use it?\r\n\r\nI'm not much into JNI but other snippets seems to parse the byte array to a method before they release it (i.e. giving the java program a chance to make a copy or something)\r\nE.g. https://stackoverflow.com/questions/24076624/how-to-pass-char-array-from-c-jni-function-to-java-method-as-byte\r\n\r\nHmm i guess release means something else in this context.. \r\n\r\nI just printed the string in the JNI code and it seems like there is problems already before the JNI code gets its hands on it. \r\n\r\nI inserted a tf.Print op at the end of my graph in python before i export it to a SavedModelBundle and got the following output (I'm still running the model through Java): \r\n\r\n[\\n\\003-:0\\022$I love grapes.Do you even lift bro ?\\032\\033\\n\\001I\\020\\000\\030\\000 \\001*\\003PRP2\\004PRON:\\005nsubj\\032\\033\\n\\004love\\020\\001\\030\\004*\\003VBP2\\004VERB:\\004ROOT\\032!\\n\\tgrapes.Do\\020\\006\\030\\016 \\001*\\002NN2\\004NOUN:\\004dobj\\032\\035\\n\\003you\\020\\020\\030\\022 \\005*\\003PRP2\\004PRON:\\005nsubj\\032\\035\\n\\004even\\020\\024\\030\\027 \\005*\\002RB2\\003ADV:\\006advmod\\032\\035\\n\\004lift\\020\\031\\030\\034 \\002*\\002VB2\\004VERB:\\005ccomp\\032\\034\\n\\003bro\\020\\036\\030  \\005*\\003NNP2\\004NOUN:\\004dobj\\032\\026\\n\\001?\\020\\\"\\030\\\" \\001*\\001.2\\001.:\\005punct] \r\n"}