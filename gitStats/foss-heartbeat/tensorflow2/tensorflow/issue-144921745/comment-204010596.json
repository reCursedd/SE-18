{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/204010596", "html_url": "https://github.com/tensorflow/tensorflow/issues/1724#issuecomment-204010596", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1724", "id": 204010596, "node_id": "MDEyOklzc3VlQ29tbWVudDIwNDAxMDU5Ng==", "user": {"login": "rdipietro", "id": 5150559, "node_id": "MDQ6VXNlcjUxNTA1NTk=", "avatar_url": "https://avatars1.githubusercontent.com/u/5150559?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rdipietro", "html_url": "https://github.com/rdipietro", "followers_url": "https://api.github.com/users/rdipietro/followers", "following_url": "https://api.github.com/users/rdipietro/following{/other_user}", "gists_url": "https://api.github.com/users/rdipietro/gists{/gist_id}", "starred_url": "https://api.github.com/users/rdipietro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rdipietro/subscriptions", "organizations_url": "https://api.github.com/users/rdipietro/orgs", "repos_url": "https://api.github.com/users/rdipietro/repos", "events_url": "https://api.github.com/users/rdipietro/events{/privacy}", "received_events_url": "https://api.github.com/users/rdipietro/received_events", "type": "User", "site_admin": false}, "created_at": "2016-03-31T16:30:23Z", "updated_at": "2016-03-31T16:30:23Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Reproduced this. I'm compiling from source, commit <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/b4b276eb785f77beb226189ca1d32ba36717a588/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/b4b276eb785f77beb226189ca1d32ba36717a588\"><tt>b4b276e</tt></a>.</p>\n<p>Even more confusing to me:</p>\n<pre><code>import tensorflow as tf\nimport numpy as np\n\nx = tf.Variable(1.)\nupdate_x = tf.assign_add(x, 1.0)\n\ndo_update = tf.placeholder(tf.bool)\n\nema = tf.train.ExponentialMovingAverage(.9)\nema_assign = ema.apply([x])\n\navg_without_update = ema.average(x)\n\nwith tf.control_dependencies([ema_assign]):\n    avg_with_update = tf.identity(avg_without_update)\n\navg = tf.python.control_flow_ops.cond(do_update, lambda: avg_with_update, lambda: avg_without_update)\n\nwith tf.Session() as sess:\n    sess.run(tf.initialize_all_variables())\n    print(sess.run([update_x, avg], {do_update: False}))\n    print(sess.run([update_x, avg], {do_update: False}))\n    print(sess.run([update_x, avg], {do_update: False}))\n    print(sess.run([update_x, avg], {do_update: False}))\n    print(sess.run([update_x, avg], {do_update: False}))\n</code></pre>\n<p>results in</p>\n<pre><code>[2.0, 1.0]\n[3.0, 1.1]\n[4.0, 1.3900001]\n[5.0, 1.7510002]\n[6.0, 2.0759003]\n</code></pre>", "body_text": "Reproduced this. I'm compiling from source, commit b4b276e.\nEven more confusing to me:\nimport tensorflow as tf\nimport numpy as np\n\nx = tf.Variable(1.)\nupdate_x = tf.assign_add(x, 1.0)\n\ndo_update = tf.placeholder(tf.bool)\n\nema = tf.train.ExponentialMovingAverage(.9)\nema_assign = ema.apply([x])\n\navg_without_update = ema.average(x)\n\nwith tf.control_dependencies([ema_assign]):\n    avg_with_update = tf.identity(avg_without_update)\n\navg = tf.python.control_flow_ops.cond(do_update, lambda: avg_with_update, lambda: avg_without_update)\n\nwith tf.Session() as sess:\n    sess.run(tf.initialize_all_variables())\n    print(sess.run([update_x, avg], {do_update: False}))\n    print(sess.run([update_x, avg], {do_update: False}))\n    print(sess.run([update_x, avg], {do_update: False}))\n    print(sess.run([update_x, avg], {do_update: False}))\n    print(sess.run([update_x, avg], {do_update: False}))\n\nresults in\n[2.0, 1.0]\n[3.0, 1.1]\n[4.0, 1.3900001]\n[5.0, 1.7510002]\n[6.0, 2.0759003]", "body": "Reproduced this. I'm compiling from source, commit https://github.com/tensorflow/tensorflow/commit/b4b276eb785f77beb226189ca1d32ba36717a588.\n\nEven more confusing to me:\n\n```\nimport tensorflow as tf\nimport numpy as np\n\nx = tf.Variable(1.)\nupdate_x = tf.assign_add(x, 1.0)\n\ndo_update = tf.placeholder(tf.bool)\n\nema = tf.train.ExponentialMovingAverage(.9)\nema_assign = ema.apply([x])\n\navg_without_update = ema.average(x)\n\nwith tf.control_dependencies([ema_assign]):\n    avg_with_update = tf.identity(avg_without_update)\n\navg = tf.python.control_flow_ops.cond(do_update, lambda: avg_with_update, lambda: avg_without_update)\n\nwith tf.Session() as sess:\n    sess.run(tf.initialize_all_variables())\n    print(sess.run([update_x, avg], {do_update: False}))\n    print(sess.run([update_x, avg], {do_update: False}))\n    print(sess.run([update_x, avg], {do_update: False}))\n    print(sess.run([update_x, avg], {do_update: False}))\n    print(sess.run([update_x, avg], {do_update: False}))\n```\n\nresults in\n\n```\n[2.0, 1.0]\n[3.0, 1.1]\n[4.0, 1.3900001]\n[5.0, 1.7510002]\n[6.0, 2.0759003]\n```\n"}