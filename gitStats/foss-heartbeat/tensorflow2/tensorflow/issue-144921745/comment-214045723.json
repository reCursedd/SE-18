{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/214045723", "html_url": "https://github.com/tensorflow/tensorflow/issues/1724#issuecomment-214045723", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1724", "id": 214045723, "node_id": "MDEyOklzc3VlQ29tbWVudDIxNDA0NTcyMw==", "user": {"login": "mikowals", "id": 1331470, "node_id": "MDQ6VXNlcjEzMzE0NzA=", "avatar_url": "https://avatars0.githubusercontent.com/u/1331470?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikowals", "html_url": "https://github.com/mikowals", "followers_url": "https://api.github.com/users/mikowals/followers", "following_url": "https://api.github.com/users/mikowals/following{/other_user}", "gists_url": "https://api.github.com/users/mikowals/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikowals/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikowals/subscriptions", "organizations_url": "https://api.github.com/users/mikowals/orgs", "repos_url": "https://api.github.com/users/mikowals/repos", "events_url": "https://api.github.com/users/mikowals/events{/privacy}", "received_events_url": "https://api.github.com/users/mikowals/received_events", "type": "User", "site_admin": false}, "created_at": "2016-04-24T22:03:10Z", "updated_at": "2016-04-24T22:03:10Z", "author_association": "CONTRIBUTOR", "body_html": "<p>There was an explanation / workaround posted to a issue <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"150315254\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/2062\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/2062/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/2062\">#2062</a> a couple of days ago.  The dependency node needs to be moved inside the conditional function.</p>\n<p>So an EMA update from this issues works as expected if the condition is done like this:</p>\n<pre><code>import tensorflow as tf\nimport numpy as np\n\ninpt = tf.Variable(np.array([1.]))\ndo_update = tf.placeholder(tf.bool)\n\nema = tf.train.ExponentialMovingAverage(.9)\n\ndef update():\n  ema_assign = ema.apply([inpt])\n  with tf.control_dependencies([ema_assign]):\n      return tf.identity(ema.average(inpt))      # note the identity.\n\ndef no_update():\n  return ema.average(inpt)\n\nrun = tf.python.control_flow_ops.cond(do_update, update, no_update)\n</code></pre>", "body_text": "There was an explanation / workaround posted to a issue #2062 a couple of days ago.  The dependency node needs to be moved inside the conditional function.\nSo an EMA update from this issues works as expected if the condition is done like this:\nimport tensorflow as tf\nimport numpy as np\n\ninpt = tf.Variable(np.array([1.]))\ndo_update = tf.placeholder(tf.bool)\n\nema = tf.train.ExponentialMovingAverage(.9)\n\ndef update():\n  ema_assign = ema.apply([inpt])\n  with tf.control_dependencies([ema_assign]):\n      return tf.identity(ema.average(inpt))      # note the identity.\n\ndef no_update():\n  return ema.average(inpt)\n\nrun = tf.python.control_flow_ops.cond(do_update, update, no_update)", "body": "There was an explanation / workaround posted to a issue #2062 a couple of days ago.  The dependency node needs to be moved inside the conditional function.  \n\nSo an EMA update from this issues works as expected if the condition is done like this:\n\n```\nimport tensorflow as tf\nimport numpy as np\n\ninpt = tf.Variable(np.array([1.]))\ndo_update = tf.placeholder(tf.bool)\n\nema = tf.train.ExponentialMovingAverage(.9)\n\ndef update():\n  ema_assign = ema.apply([inpt])\n  with tf.control_dependencies([ema_assign]):\n      return tf.identity(ema.average(inpt))      # note the identity.\n\ndef no_update():\n  return ema.average(inpt)\n\nrun = tf.python.control_flow_ops.cond(do_update, update, no_update)\n```\n"}