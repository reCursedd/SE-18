{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17015", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17015/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17015/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17015/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/17015", "id": 297179611, "node_id": "MDU6SXNzdWUyOTcxNzk2MTE=", "number": 17015, "title": "tfcompile tf.cond not dominated by switch nodes", "user": {"login": "jhunsaker", "id": 18537138, "node_id": "MDQ6VXNlcjE4NTM3MTM4", "avatar_url": "https://avatars1.githubusercontent.com/u/18537138?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhunsaker", "html_url": "https://github.com/jhunsaker", "followers_url": "https://api.github.com/users/jhunsaker/followers", "following_url": "https://api.github.com/users/jhunsaker/following{/other_user}", "gists_url": "https://api.github.com/users/jhunsaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhunsaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhunsaker/subscriptions", "organizations_url": "https://api.github.com/users/jhunsaker/orgs", "repos_url": "https://api.github.com/users/jhunsaker/repos", "events_url": "https://api.github.com/users/jhunsaker/events{/privacy}", "received_events_url": "https://api.github.com/users/jhunsaker/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-02-14T17:23:34Z", "updated_at": "2018-03-02T13:55:31Z", "closed_at": "2018-02-23T08:30:41Z", "author_association": "NONE", "body_html": "<p>Using the following example:</p>\n<pre><code>graph = tf.Graph()\nwith graph.as_default():\n  x = tf.placeholder(name='x', shape=(2,), dtype=tf.float64)\n  y = tf.cond(x[0] &gt; x[1], partial(lambda x: x[0], x), partial(lambda x: x[1], x))\n</code></pre>\n<p>Compiling with:<br>\n<code>tfcompile --graph=test_graph.pb --config=test_config.pb --entry_point=test_func --cpp_class=test --out_object=test.o --out_header=test.hpp --gen_program_shape=true --target_cpu=haswell</code></p>\n<p>Gives the following error:<br>\n<code>2018-02-13 16:32:27.484808: F tensorflow/compiler/aot/tfcompile_main.cc:140] Non-OK-status: status status: Failed precondition: Value {name:'cond/strided_slice_1' id:20 op device:{/device:XLA_CPU_JIT} def:{cond/strided_slice_1 = StridedSlice[Index=DT_INT32, T=DT_DOUBLE, begin_mask=0, ellipsis_mask=0, end_mask=0, new_axis_mask=0, shrink_axis_mask=1](cond/strided_slice_1/Switch, cond/strided_slice_1/stack, cond/strided_slice_1/stack_1, cond/strided_slice_1/stack_2)}} not dominated by switch nodes.</code></p>\n<p>Would expect code to be generated similar to:</p>\n<pre><code>double test_func( double* x )\n{\n  if (x[0] &gt; x[1] )\n    return x[0];\n  else\n    return x[1];\n}\n</code></pre>\n<p>tensorflow version 1.5.0<br>\nRHEL 7.3 64bit<br>\ntensorflow built from source<br>\npython 2.7<br>\nbazel 0.7<br>\ngcc 4.8.5</p>", "body_text": "Using the following example:\ngraph = tf.Graph()\nwith graph.as_default():\n  x = tf.placeholder(name='x', shape=(2,), dtype=tf.float64)\n  y = tf.cond(x[0] > x[1], partial(lambda x: x[0], x), partial(lambda x: x[1], x))\n\nCompiling with:\ntfcompile --graph=test_graph.pb --config=test_config.pb --entry_point=test_func --cpp_class=test --out_object=test.o --out_header=test.hpp --gen_program_shape=true --target_cpu=haswell\nGives the following error:\n2018-02-13 16:32:27.484808: F tensorflow/compiler/aot/tfcompile_main.cc:140] Non-OK-status: status status: Failed precondition: Value {name:'cond/strided_slice_1' id:20 op device:{/device:XLA_CPU_JIT} def:{cond/strided_slice_1 = StridedSlice[Index=DT_INT32, T=DT_DOUBLE, begin_mask=0, ellipsis_mask=0, end_mask=0, new_axis_mask=0, shrink_axis_mask=1](cond/strided_slice_1/Switch, cond/strided_slice_1/stack, cond/strided_slice_1/stack_1, cond/strided_slice_1/stack_2)}} not dominated by switch nodes.\nWould expect code to be generated similar to:\ndouble test_func( double* x )\n{\n  if (x[0] > x[1] )\n    return x[0];\n  else\n    return x[1];\n}\n\ntensorflow version 1.5.0\nRHEL 7.3 64bit\ntensorflow built from source\npython 2.7\nbazel 0.7\ngcc 4.8.5", "body": "Using the following example:\r\n\r\n```\r\ngraph = tf.Graph()\r\nwith graph.as_default():\r\n  x = tf.placeholder(name='x', shape=(2,), dtype=tf.float64)\r\n  y = tf.cond(x[0] > x[1], partial(lambda x: x[0], x), partial(lambda x: x[1], x))\r\n```\r\n\r\nCompiling with:\r\n`\r\ntfcompile --graph=test_graph.pb --config=test_config.pb --entry_point=test_func --cpp_class=test --out_object=test.o --out_header=test.hpp --gen_program_shape=true --target_cpu=haswell\r\n`\r\n\r\nGives the following error:\r\n`\r\n2018-02-13 16:32:27.484808: F tensorflow/compiler/aot/tfcompile_main.cc:140] Non-OK-status: status status: Failed precondition: Value {name:'cond/strided_slice_1' id:20 op device:{/device:XLA_CPU_JIT} def:{cond/strided_slice_1 = StridedSlice[Index=DT_INT32, T=DT_DOUBLE, begin_mask=0, ellipsis_mask=0, end_mask=0, new_axis_mask=0, shrink_axis_mask=1](cond/strided_slice_1/Switch, cond/strided_slice_1/stack, cond/strided_slice_1/stack_1, cond/strided_slice_1/stack_2)}} not dominated by switch nodes.\r\n`\r\n\r\nWould expect code to be generated similar to:\r\n```\r\ndouble test_func( double* x )\r\n{\r\n  if (x[0] > x[1] )\r\n    return x[0];\r\n  else\r\n    return x[1];\r\n}\r\n```\r\n\r\ntensorflow version 1.5.0\r\nRHEL 7.3 64bit\r\ntensorflow built from source \r\npython 2.7\r\nbazel 0.7\r\ngcc 4.8.5\r\n"}