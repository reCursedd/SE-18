{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19289", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19289/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19289/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19289/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/19289", "id": 323154672, "node_id": "MDU6SXNzdWUzMjMxNTQ2NzI=", "number": 19289, "title": "Error in model load weights", "user": {"login": "lenlen", "id": 2477675, "node_id": "MDQ6VXNlcjI0Nzc2NzU=", "avatar_url": "https://avatars2.githubusercontent.com/u/2477675?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lenlen", "html_url": "https://github.com/lenlen", "followers_url": "https://api.github.com/users/lenlen/followers", "following_url": "https://api.github.com/users/lenlen/following{/other_user}", "gists_url": "https://api.github.com/users/lenlen/gists{/gist_id}", "starred_url": "https://api.github.com/users/lenlen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lenlen/subscriptions", "organizations_url": "https://api.github.com/users/lenlen/orgs", "repos_url": "https://api.github.com/users/lenlen/repos", "events_url": "https://api.github.com/users/lenlen/events{/privacy}", "received_events_url": "https://api.github.com/users/lenlen/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "allenlavoie", "id": 3731025, "node_id": "MDQ6VXNlcjM3MzEwMjU=", "avatar_url": "https://avatars3.githubusercontent.com/u/3731025?v=4", "gravatar_id": "", "url": "https://api.github.com/users/allenlavoie", "html_url": "https://github.com/allenlavoie", "followers_url": "https://api.github.com/users/allenlavoie/followers", "following_url": "https://api.github.com/users/allenlavoie/following{/other_user}", "gists_url": "https://api.github.com/users/allenlavoie/gists{/gist_id}", "starred_url": "https://api.github.com/users/allenlavoie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/allenlavoie/subscriptions", "organizations_url": "https://api.github.com/users/allenlavoie/orgs", "repos_url": "https://api.github.com/users/allenlavoie/repos", "events_url": "https://api.github.com/users/allenlavoie/events{/privacy}", "received_events_url": "https://api.github.com/users/allenlavoie/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "allenlavoie", "id": 3731025, "node_id": "MDQ6VXNlcjM3MzEwMjU=", "avatar_url": "https://avatars3.githubusercontent.com/u/3731025?v=4", "gravatar_id": "", "url": "https://api.github.com/users/allenlavoie", "html_url": "https://github.com/allenlavoie", "followers_url": "https://api.github.com/users/allenlavoie/followers", "following_url": "https://api.github.com/users/allenlavoie/following{/other_user}", "gists_url": "https://api.github.com/users/allenlavoie/gists{/gist_id}", "starred_url": "https://api.github.com/users/allenlavoie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/allenlavoie/subscriptions", "organizations_url": "https://api.github.com/users/allenlavoie/orgs", "repos_url": "https://api.github.com/users/allenlavoie/repos", "events_url": "https://api.github.com/users/allenlavoie/events{/privacy}", "received_events_url": "https://api.github.com/users/allenlavoie/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2018-05-15T10:17:56Z", "updated_at": "2018-05-16T20:32:25Z", "closed_at": "2018-05-16T20:32:25Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: N/A</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: from nightly-devel-gpu-py3 and nightly-gpu-py3 docker images</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: from nightly-devel-gpu-py3 and nightly-gpu-py3 docker images</li>\n<li><strong>TensorFlow version (use command below)</strong>: from nightly-devel-gpu-py3 and nightly-gpu-py3 docker images</li>\n<li><strong>Python version</strong>: from nightly-devel-gpu-py3 and nightly-gpu-py3 docker images</li>\n<li><strong>Bazel version (if compiling from source)</strong>: from nightly-devel-gpu-py3 and nightly-gpu-py3 docker images</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: from nightly-devel-gpu-py3 and nightly-gpu-py3 docker images</li>\n<li><strong>CUDA/cuDNN version</strong>: 9.0</li>\n<li><strong>GPU model and memory</strong>: tesla k80</li>\n<li><strong>Exact command to reproduce</strong>: N/A</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>Running with nightly (both nightly-devel-gpu-py3 and nightly-gpu-py3) is not possible load weights on the keras model.<br>\nIn the example belowe I have saved the weights, they are saved correctly in the file system and then I have tryed to load them, but I've got an error.</p>\n<h3>Source code / logs</h3>\n<p>Here the snippet:</p>\n<pre><code>import tensorflow as tf\nfrom tensorflow import keras as ks\n\n\ndef main():\n    input_rgb = ks.layers.Input(shape=(1, 5, 5, 3), name=\"input_rgb\")\n    x = ks.layers.Dense(1, activation='relu', name=\"Dense_1\")(input_rgb)\n    x = ks.layers.Dense(1, activation='sigmoid', name=\"sigmoid\")(x)\n    model = ks.models.Model(inputs=[input_rgb], outputs=[x])\n    model.compile(\n        loss={'sigmoid': 'binary_crossentropy'},\n        optimizer=tf.keras.optimizers.Adam())\n    model.save_weights('/tmp/test_weights.h5')\n\n    model.load_weights('/tmp/test_weights.h5', by_name=True)\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>\n<p>And here the output:</p>\n<pre><code>2018-05-15 09:56:21.404382: W tensorflow/core/util/tensor_slice_reader.cc:95] Could not open /tmp/test_weights.h5: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): N/A\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): from nightly-devel-gpu-py3 and nightly-gpu-py3 docker images\nTensorFlow installed from (source or binary): from nightly-devel-gpu-py3 and nightly-gpu-py3 docker images\nTensorFlow version (use command below): from nightly-devel-gpu-py3 and nightly-gpu-py3 docker images\nPython version: from nightly-devel-gpu-py3 and nightly-gpu-py3 docker images\nBazel version (if compiling from source): from nightly-devel-gpu-py3 and nightly-gpu-py3 docker images\nGCC/Compiler version (if compiling from source): from nightly-devel-gpu-py3 and nightly-gpu-py3 docker images\nCUDA/cuDNN version: 9.0\nGPU model and memory: tesla k80\nExact command to reproduce: N/A\n\nDescribe the problem\nRunning with nightly (both nightly-devel-gpu-py3 and nightly-gpu-py3) is not possible load weights on the keras model.\nIn the example belowe I have saved the weights, they are saved correctly in the file system and then I have tryed to load them, but I've got an error.\nSource code / logs\nHere the snippet:\nimport tensorflow as tf\nfrom tensorflow import keras as ks\n\n\ndef main():\n    input_rgb = ks.layers.Input(shape=(1, 5, 5, 3), name=\"input_rgb\")\n    x = ks.layers.Dense(1, activation='relu', name=\"Dense_1\")(input_rgb)\n    x = ks.layers.Dense(1, activation='sigmoid', name=\"sigmoid\")(x)\n    model = ks.models.Model(inputs=[input_rgb], outputs=[x])\n    model.compile(\n        loss={'sigmoid': 'binary_crossentropy'},\n        optimizer=tf.keras.optimizers.Adam())\n    model.save_weights('/tmp/test_weights.h5')\n\n    model.load_weights('/tmp/test_weights.h5', by_name=True)\n\n\nif __name__ == \"__main__\":\n    main()\n\nAnd here the output:\n2018-05-15 09:56:21.404382: W tensorflow/core/util/tensor_slice_reader.cc:95] Could not open /tmp/test_weights.h5: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: N/A\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: from nightly-devel-gpu-py3 and nightly-gpu-py3 docker images\r\n- **TensorFlow installed from (source or binary)**: from nightly-devel-gpu-py3 and nightly-gpu-py3 docker images\r\n- **TensorFlow version (use command below)**: from nightly-devel-gpu-py3 and nightly-gpu-py3 docker images\r\n- **Python version**: from nightly-devel-gpu-py3 and nightly-gpu-py3 docker images\r\n- **Bazel version (if compiling from source)**: from nightly-devel-gpu-py3 and nightly-gpu-py3 docker images\r\n- **GCC/Compiler version (if compiling from source)**: from nightly-devel-gpu-py3 and nightly-gpu-py3 docker images\r\n- **CUDA/cuDNN version**: 9.0\r\n- **GPU model and memory**: tesla k80\r\n- **Exact command to reproduce**: N/A\r\n\r\n\r\n### Describe the problem\r\nRunning with nightly (both nightly-devel-gpu-py3 and nightly-gpu-py3) is not possible load weights on the keras model.\r\nIn the example belowe I have saved the weights, they are saved correctly in the file system and then I have tryed to load them, but I've got an error.\r\n\r\n### Source code / logs\r\nHere the snippet:\r\n\r\n```\r\nimport tensorflow as tf\r\nfrom tensorflow import keras as ks\r\n\r\n\r\ndef main():\r\n    input_rgb = ks.layers.Input(shape=(1, 5, 5, 3), name=\"input_rgb\")\r\n    x = ks.layers.Dense(1, activation='relu', name=\"Dense_1\")(input_rgb)\r\n    x = ks.layers.Dense(1, activation='sigmoid', name=\"sigmoid\")(x)\r\n    model = ks.models.Model(inputs=[input_rgb], outputs=[x])\r\n    model.compile(\r\n        loss={'sigmoid': 'binary_crossentropy'},\r\n        optimizer=tf.keras.optimizers.Adam())\r\n    model.save_weights('/tmp/test_weights.h5')\r\n\r\n    model.load_weights('/tmp/test_weights.h5', by_name=True)\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    main()\r\n```\r\n\r\nAnd here the output:\r\n\r\n```\r\n2018-05-15 09:56:21.404382: W tensorflow/core/util/tensor_slice_reader.cc:95] Could not open /tmp/test_weights.h5: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\r\n```"}