{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1793", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1793/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1793/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1793/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/1793", "id": 146383577, "node_id": "MDU6SXNzdWUxNDYzODM1Nzc=", "number": 1793, "title": "Missing gradient for tf.nn.max_pool_with_argmax", "user": {"login": "Thrasi", "id": 5024283, "node_id": "MDQ6VXNlcjUwMjQyODM=", "avatar_url": "https://avatars1.githubusercontent.com/u/5024283?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Thrasi", "html_url": "https://github.com/Thrasi", "followers_url": "https://api.github.com/users/Thrasi/followers", "following_url": "https://api.github.com/users/Thrasi/following{/other_user}", "gists_url": "https://api.github.com/users/Thrasi/gists{/gist_id}", "starred_url": "https://api.github.com/users/Thrasi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Thrasi/subscriptions", "organizations_url": "https://api.github.com/users/Thrasi/orgs", "repos_url": "https://api.github.com/users/Thrasi/repos", "events_url": "https://api.github.com/users/Thrasi/events{/privacy}", "received_events_url": "https://api.github.com/users/Thrasi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2016-04-06T17:36:59Z", "updated_at": "2017-05-25T02:58:14Z", "closed_at": "2017-04-10T23:10:17Z", "author_association": "NONE", "body_html": "<p>I swapped out the first max_pool operation in <a href=\"https://github.com/tensorflow/tensorflow/blob/r0.7/tensorflow/models/image/mnist/convolutional.py\">convolutional.py</a> tutorial for a max_pool_with_argmax operation and there doesn't seem to exist a gradient for that op:</p>\n<p><code>(virtenv)$ python convolutional.py</code><br>\n<code>Extracting data/train-images-idx3-ubyte.gz</code><br>\n<code>Extracting data/train-labels-idx1-ubyte.gz</code><br>\n<code>Extracting data/t10k-images-idx3-ubyte.gz</code><br>\n<code>Extracting data/t10k-labels-idx1-ubyte.gz</code><br>\n<code>Traceback (most recent call last):</code><br>\n<code>File \"convolutional.py\", line 316, in &lt;module&gt;</code><br>\n<code>tf.app.run()</code><br>\n<code>File \"/home/name/virtenv/local/lib/python2.7/site-packages/tensorflow/python/platform/default/_app.py\", line 30, in run</code><br>\n<code>sys.exit(main(sys.argv))</code><br>\n<code>File \"convolutional.py\", line 244, in main</code><br>\n<code>global_step=batch)</code><br>\n<code>File \"/home/name/virtenv/local/lib/python2.7/site-packages/tensorflow/python/training/optimizer.py\", line 190, in minimize</code><br>\n<code>colocate_gradients_with_ops=colocate_gradients_with_ops)</code><br>\n<code>File \"/home/name/virtenv/local/lib/python2.7/site-packages/tensorflow/python/training/optimizer.py\", line 241, in compute_gradients</code><br>\n<code>colocate_gradients_with_ops=colocate_gradients_with_ops)</code><br>\n<code>File \"/home/name/virtenv/local/lib/python2.7/site-packages/tensorflow/python/ops/gradients.py\", line 453, in gradients</code><br>\n<code>(op.name, op.type))</code><br>\n<code>LookupError: No gradient defined for operation 'MaxPoolWithArgmax' (op type: MaxPoolWithArgmax)</code></p>\n<h3>Environment info</h3>\n<p>Operating System: Ubuntu 14.04.1 LTS</p>\n<p>If installed from binary pip package, provide:</p>\n<p>(virtenv)$ pip install --upgrade <a href=\"https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.7.1-cp27-none-linux_x86_64.whl\" rel=\"nofollow\">https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.7.1-cp27-none-linux_x86_64.whl</a><br>\n(virtenv)$ python -c \"import tensorflow; print(tensorflow.<strong>version</strong>)\"<br>\n0.7.1</p>\n<h3>Steps to reproduce</h3>\n<ol>\n<li>\n<p>Change line 192-5 of <a href=\"https://github.com/tensorflow/tensorflow/blob/r0.7/tensorflow/models/image/mnist/convolutional.py\">convolutional.py</a> from:</p>\n<p><code>pool = tf.nn.max_pool(relu, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], padding='SAME')</code></p>\n<p>to:</p>\n<p><code>pool, pos = tf.nn.max_pool_with_argmax(relu, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], padding='SAME')</code></p>\n</li>\n<li>\n<p>Run:</p>\n<p><code>(virtenv)$ python convolutional.py</code></p>\n</li>\n</ol>\n<h3>What have you tried?</h3>\n<ol>\n<li></li>\n</ol>\n<h3>Logs or other output that would be helpful</h3>\n<p>(If logs are large, please upload as attachment).</p>", "body_text": "I swapped out the first max_pool operation in convolutional.py tutorial for a max_pool_with_argmax operation and there doesn't seem to exist a gradient for that op:\n(virtenv)$ python convolutional.py\nExtracting data/train-images-idx3-ubyte.gz\nExtracting data/train-labels-idx1-ubyte.gz\nExtracting data/t10k-images-idx3-ubyte.gz\nExtracting data/t10k-labels-idx1-ubyte.gz\nTraceback (most recent call last):\nFile \"convolutional.py\", line 316, in <module>\ntf.app.run()\nFile \"/home/name/virtenv/local/lib/python2.7/site-packages/tensorflow/python/platform/default/_app.py\", line 30, in run\nsys.exit(main(sys.argv))\nFile \"convolutional.py\", line 244, in main\nglobal_step=batch)\nFile \"/home/name/virtenv/local/lib/python2.7/site-packages/tensorflow/python/training/optimizer.py\", line 190, in minimize\ncolocate_gradients_with_ops=colocate_gradients_with_ops)\nFile \"/home/name/virtenv/local/lib/python2.7/site-packages/tensorflow/python/training/optimizer.py\", line 241, in compute_gradients\ncolocate_gradients_with_ops=colocate_gradients_with_ops)\nFile \"/home/name/virtenv/local/lib/python2.7/site-packages/tensorflow/python/ops/gradients.py\", line 453, in gradients\n(op.name, op.type))\nLookupError: No gradient defined for operation 'MaxPoolWithArgmax' (op type: MaxPoolWithArgmax)\nEnvironment info\nOperating System: Ubuntu 14.04.1 LTS\nIf installed from binary pip package, provide:\n(virtenv)$ pip install --upgrade https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.7.1-cp27-none-linux_x86_64.whl\n(virtenv)$ python -c \"import tensorflow; print(tensorflow.version)\"\n0.7.1\nSteps to reproduce\n\n\nChange line 192-5 of convolutional.py from:\npool = tf.nn.max_pool(relu, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], padding='SAME')\nto:\npool, pos = tf.nn.max_pool_with_argmax(relu, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], padding='SAME')\n\n\nRun:\n(virtenv)$ python convolutional.py\n\n\nWhat have you tried?\n\n\n\nLogs or other output that would be helpful\n(If logs are large, please upload as attachment).", "body": "I swapped out the first max_pool operation in [convolutional.py](https://github.com/tensorflow/tensorflow/blob/r0.7/tensorflow/models/image/mnist/convolutional.py) tutorial for a max_pool_with_argmax operation and there doesn't seem to exist a gradient for that op:\n\n`(virtenv)$ python convolutional.py`\n`Extracting data/train-images-idx3-ubyte.gz`\n`Extracting data/train-labels-idx1-ubyte.gz`\n`Extracting data/t10k-images-idx3-ubyte.gz`\n`Extracting data/t10k-labels-idx1-ubyte.gz`\n`Traceback (most recent call last):`\n`File \"convolutional.py\", line 316, in <module>`\n`tf.app.run()`\n`File \"/home/name/virtenv/local/lib/python2.7/site-packages/tensorflow/python/platform/default/_app.py\", line 30, in run`\n`sys.exit(main(sys.argv))`\n`File \"convolutional.py\", line 244, in main`\n`global_step=batch)`\n`File \"/home/name/virtenv/local/lib/python2.7/site-packages/tensorflow/python/training/optimizer.py\", line 190, in minimize`\n`colocate_gradients_with_ops=colocate_gradients_with_ops)`\n`File \"/home/name/virtenv/local/lib/python2.7/site-packages/tensorflow/python/training/optimizer.py\", line 241, in compute_gradients`\n`colocate_gradients_with_ops=colocate_gradients_with_ops)`\n`File \"/home/name/virtenv/local/lib/python2.7/site-packages/tensorflow/python/ops/gradients.py\", line 453, in gradients`\n`(op.name, op.type))`\n`LookupError: No gradient defined for operation 'MaxPoolWithArgmax' (op type: MaxPoolWithArgmax)`\n### Environment info\n\nOperating System: Ubuntu 14.04.1 LTS\n\nIf installed from binary pip package, provide:\n\n(virtenv)$ pip install --upgrade https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.7.1-cp27-none-linux_x86_64.whl\n(virtenv)$ python -c \"import tensorflow; print(tensorflow.**version**)\"\n0.7.1\n### Steps to reproduce\n1. Change line 192-5 of [convolutional.py](https://github.com/tensorflow/tensorflow/blob/r0.7/tensorflow/models/image/mnist/convolutional.py) from:\n   \n   `pool = tf.nn.max_pool(relu, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], padding='SAME')`\n   \n   to:\n   \n   `pool, pos = tf.nn.max_pool_with_argmax(relu, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], padding='SAME')`\n2. Run:\n   \n   `(virtenv)$ python convolutional.py`\n### What have you tried?\n\n1.\n### Logs or other output that would be helpful\n\n(If logs are large, please upload as attachment).\n"}