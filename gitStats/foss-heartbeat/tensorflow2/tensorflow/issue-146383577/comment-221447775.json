{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/221447775", "html_url": "https://github.com/tensorflow/tensorflow/issues/1793#issuecomment-221447775", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1793", "id": 221447775, "node_id": "MDEyOklzc3VlQ29tbWVudDIyMTQ0Nzc3NQ==", "user": {"login": "mwalton", "id": 1017968, "node_id": "MDQ6VXNlcjEwMTc5Njg=", "avatar_url": "https://avatars2.githubusercontent.com/u/1017968?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mwalton", "html_url": "https://github.com/mwalton", "followers_url": "https://api.github.com/users/mwalton/followers", "following_url": "https://api.github.com/users/mwalton/following{/other_user}", "gists_url": "https://api.github.com/users/mwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/mwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mwalton/subscriptions", "organizations_url": "https://api.github.com/users/mwalton/orgs", "repos_url": "https://api.github.com/users/mwalton/repos", "events_url": "https://api.github.com/users/mwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/mwalton/received_events", "type": "User", "site_admin": false}, "created_at": "2016-05-25T01:14:30Z", "updated_at": "2016-05-25T01:14:30Z", "author_association": "NONE", "body_html": "<p>this is a bit of a hack, but copying the gradient for maxpool and registering it for max_pool_with_argmax works. The function signature has an additional arg (presumably this has to do with the argmax). Also the op doesn't have a data_format, so that is left default (NHWC).</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">from</span> tensorflow.python.framework <span class=\"pl-k\">import</span> ops\n<span class=\"pl-k\">from</span> tensorflow.python.ops <span class=\"pl-k\">import</span> gen_nn_ops\n<span class=\"pl-en\">@ops.RegisterGradient</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>MaxPoolWithArgmax<span class=\"pl-pds\">\"</span></span>)\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">_MaxPoolWithArgmaxGrad</span>(<span class=\"pl-smi\">op</span>, <span class=\"pl-smi\">grad</span>, <span class=\"pl-smi\">some_other_arg</span>):\n  <span class=\"pl-k\">return</span> gen_nn_ops._max_pool_grad(op.inputs[<span class=\"pl-c1\">0</span>],\n                                   op.outputs[<span class=\"pl-c1\">0</span>],\n                                   grad,\n                                   op.get_attr(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ksize<span class=\"pl-pds\">\"</span></span>),\n                                   op.get_attr(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>strides<span class=\"pl-pds\">\"</span></span>),\n                                   <span class=\"pl-v\">padding</span><span class=\"pl-k\">=</span>op.get_attr(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>padding<span class=\"pl-pds\">\"</span></span>),\n                                   <span class=\"pl-v\">data_format</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>NHWC<span class=\"pl-pds\">'</span></span>)</pre></div>", "body_text": "this is a bit of a hack, but copying the gradient for maxpool and registering it for max_pool_with_argmax works. The function signature has an additional arg (presumably this has to do with the argmax). Also the op doesn't have a data_format, so that is left default (NHWC).\nfrom tensorflow.python.framework import ops\nfrom tensorflow.python.ops import gen_nn_ops\n@ops.RegisterGradient(\"MaxPoolWithArgmax\")\ndef _MaxPoolWithArgmaxGrad(op, grad, some_other_arg):\n  return gen_nn_ops._max_pool_grad(op.inputs[0],\n                                   op.outputs[0],\n                                   grad,\n                                   op.get_attr(\"ksize\"),\n                                   op.get_attr(\"strides\"),\n                                   padding=op.get_attr(\"padding\"),\n                                   data_format='NHWC')", "body": "this is a bit of a hack, but copying the gradient for maxpool and registering it for max_pool_with_argmax works. The function signature has an additional arg (presumably this has to do with the argmax). Also the op doesn't have a data_format, so that is left default (NHWC).\n\n``` python\nfrom tensorflow.python.framework import ops\nfrom tensorflow.python.ops import gen_nn_ops\n@ops.RegisterGradient(\"MaxPoolWithArgmax\")\ndef _MaxPoolWithArgmaxGrad(op, grad, some_other_arg):\n  return gen_nn_ops._max_pool_grad(op.inputs[0],\n                                   op.outputs[0],\n                                   grad,\n                                   op.get_attr(\"ksize\"),\n                                   op.get_attr(\"strides\"),\n                                   padding=op.get_attr(\"padding\"),\n                                   data_format='NHWC')\n```\n"}