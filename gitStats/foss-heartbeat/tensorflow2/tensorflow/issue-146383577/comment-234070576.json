{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/234070576", "html_url": "https://github.com/tensorflow/tensorflow/issues/1793#issuecomment-234070576", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1793", "id": 234070576, "node_id": "MDEyOklzc3VlQ29tbWVudDIzNDA3MDU3Ng==", "user": {"login": "bcaine", "id": 1737445, "node_id": "MDQ6VXNlcjE3Mzc0NDU=", "avatar_url": "https://avatars3.githubusercontent.com/u/1737445?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bcaine", "html_url": "https://github.com/bcaine", "followers_url": "https://api.github.com/users/bcaine/followers", "following_url": "https://api.github.com/users/bcaine/following{/other_user}", "gists_url": "https://api.github.com/users/bcaine/gists{/gist_id}", "starred_url": "https://api.github.com/users/bcaine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bcaine/subscriptions", "organizations_url": "https://api.github.com/users/bcaine/orgs", "repos_url": "https://api.github.com/users/bcaine/repos", "events_url": "https://api.github.com/users/bcaine/events{/privacy}", "received_events_url": "https://api.github.com/users/bcaine/received_events", "type": "User", "site_admin": false}, "created_at": "2016-07-20T20:24:03Z", "updated_at": "2016-07-20T20:24:03Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1017968\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/mwalton\">@mwalton</a> Not sure if you've made any progress on this, but I believe the correct change would be the following:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-en\">@ops.RegisterGradient</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>MaxPoolWithArgmax<span class=\"pl-pds\">\"</span></span>)\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">_MaxPoolGradWithArgmax</span>(<span class=\"pl-smi\">op</span>, <span class=\"pl-smi\">grad</span>, <span class=\"pl-smi\">unused_argmax_grad</span>):\n  <span class=\"pl-k\">return</span> gen_nn_ops._max_pool_grad_with_argmax(op.inputs[<span class=\"pl-c1\">0</span>],\n                                               grad,\n                                               op.outputs[<span class=\"pl-c1\">1</span>],\n                                               op.get_attr(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ksize<span class=\"pl-pds\">\"</span></span>),\n                                               op.get_attr(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>strides<span class=\"pl-pds\">\"</span></span>),\n                                               <span class=\"pl-v\">padding</span><span class=\"pl-k\">=</span>op.get_attr(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>padding<span class=\"pl-pds\">\"</span></span>))</pre></div>\n<p>Seems to be working on a model I'm training. Haven't had time to write tests for it yet, nor do I know how/what tests are needed for registering an existing op (that appears to have <strong>some</strong> test coverage, see <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/kernel_tests/pooling_ops_test.py#L521\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/kernel_tests/pooling_ops_test.py#L521</a>).</p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=70511\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/girving\">@girving</a> If you can provide some direction on what tests I'd need to add for this change, I can try to pull together a PR.</p>", "body_text": "@mwalton Not sure if you've made any progress on this, but I believe the correct change would be the following:\n@ops.RegisterGradient(\"MaxPoolWithArgmax\")\ndef _MaxPoolGradWithArgmax(op, grad, unused_argmax_grad):\n  return gen_nn_ops._max_pool_grad_with_argmax(op.inputs[0],\n                                               grad,\n                                               op.outputs[1],\n                                               op.get_attr(\"ksize\"),\n                                               op.get_attr(\"strides\"),\n                                               padding=op.get_attr(\"padding\"))\nSeems to be working on a model I'm training. Haven't had time to write tests for it yet, nor do I know how/what tests are needed for registering an existing op (that appears to have some test coverage, see https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/kernel_tests/pooling_ops_test.py#L521).\n@girving If you can provide some direction on what tests I'd need to add for this change, I can try to pull together a PR.", "body": "@mwalton Not sure if you've made any progress on this, but I believe the correct change would be the following:\n\n``` python\n@ops.RegisterGradient(\"MaxPoolWithArgmax\")\ndef _MaxPoolGradWithArgmax(op, grad, unused_argmax_grad):\n  return gen_nn_ops._max_pool_grad_with_argmax(op.inputs[0],\n                                               grad,\n                                               op.outputs[1],\n                                               op.get_attr(\"ksize\"),\n                                               op.get_attr(\"strides\"),\n                                               padding=op.get_attr(\"padding\"))\n```\n\nSeems to be working on a model I'm training. Haven't had time to write tests for it yet, nor do I know how/what tests are needed for registering an existing op (that appears to have **some** test coverage, see https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/kernel_tests/pooling_ops_test.py#L521). \n\n@girving If you can provide some direction on what tests I'd need to add for this change, I can try to pull together a PR. \n"}