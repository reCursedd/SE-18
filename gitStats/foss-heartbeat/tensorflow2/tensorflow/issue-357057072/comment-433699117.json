{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/433699117", "html_url": "https://github.com/tensorflow/tensorflow/issues/22077#issuecomment-433699117", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22077", "id": 433699117, "node_id": "MDEyOklzc3VlQ29tbWVudDQzMzY5OTExNw==", "user": {"login": "wangshuaizs", "id": 21264093, "node_id": "MDQ6VXNlcjIxMjY0MDkz", "avatar_url": "https://avatars2.githubusercontent.com/u/21264093?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wangshuaizs", "html_url": "https://github.com/wangshuaizs", "followers_url": "https://api.github.com/users/wangshuaizs/followers", "following_url": "https://api.github.com/users/wangshuaizs/following{/other_user}", "gists_url": "https://api.github.com/users/wangshuaizs/gists{/gist_id}", "starred_url": "https://api.github.com/users/wangshuaizs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wangshuaizs/subscriptions", "organizations_url": "https://api.github.com/users/wangshuaizs/orgs", "repos_url": "https://api.github.com/users/wangshuaizs/repos", "events_url": "https://api.github.com/users/wangshuaizs/events{/privacy}", "received_events_url": "https://api.github.com/users/wangshuaizs/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-28T12:06:48Z", "updated_at": "2018-10-28T12:06:48Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=22274255\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/shamoya\">@shamoya</a></p>\n<p>I run ib_write_bw as following:<br>\nreceiver:</p>\n<pre><code>ib_write_bw -d mlx4_0 -i 1 -x 2 --report_gbits --port=12500 -D 10\n\n************************************\n* Waiting for client to connect... *\n************************************\n---------------------------------------------------------------------------------------\n                    RDMA_Write BW Test\n Dual-port       : OFF          Device         : mlx4_0\n Number of qps   : 1            Transport type : IB\n Connection type : RC           Using SRQ      : OFF\n CQ Moderation   : 100\n Mtu             : 1024[B]\n Link type       : Ethernet\n GID index       : 2\n Max inline data : 0[B]\n rdma_cm QPs     : OFF\n Data ex. method : Ethernet\n---------------------------------------------------------------------------------------\n local address: LID 0000 QPN 0x0260 PSN 0x90ca24 RKey 0x6801010c VAddr 0x007f2529d77000\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:10:10:10:06\n remote address: LID 0000 QPN 0x0260 PSN 0x14f043 RKey 0xa8010105 VAddr 0x007f820fee5000\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:10:10:10:02\n---------------------------------------------------------------------------------------\n #bytes     #iterations    BW peak[Gb/sec]    BW average[Gb/sec]   MsgRate[Mpps]\n 65536      415500           0.00               36.31              0.069247\n---------------------------------------------------------------------------------------\n</code></pre>\n<p>sender:</p>\n<pre><code>ib_write_bw -d mlx4_0 -i 1 -x 2 -S 4 --report_gbits 10.10.10.6 --port=12500 -D 10\n---------------------------------------------------------------------------------------\n                    RDMA_Write BW Test\n Dual-port       : OFF          Device         : mlx4_0\n Number of qps   : 1            Transport type : IB\n Connection type : RC           Using SRQ      : OFF\n TX depth        : 128\n CQ Moderation   : 100\n Mtu             : 1024[B]\n Link type       : Ethernet\n GID index       : 2\n Max inline data : 0[B]\n rdma_cm QPs     : OFF\n Data ex. method : Ethernet\n---------------------------------------------------------------------------------------\n local address: LID 0000 QPN 0x0260 PSN 0x14f043 RKey 0xa8010105 VAddr 0x007f820fee5000\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:10:10:10:02\n remote address: LID 0000 QPN 0x0260 PSN 0x90ca24 RKey 0x6801010c VAddr 0x007f2529d77000\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:10:10:10:06\n---------------------------------------------------------------------------------------\n #bytes     #iterations    BW peak[Gb/sec]    BW average[Gb/sec]   MsgRate[Mpps]\nConflicting CPU frequency values detected: 1200.000000 != 3199.951000. CPU Frequency is not max.\n 65536      415500           0.00               36.31              0.069247\n---------------------------------------------------------------------------------------\n</code></pre>\n<p>Same parameters for TF job are these:</p>\n<pre><code>export RDMA_DEVICE=\"mlx4_0\"\nexport RDMA_DEVICE_PORT=1\nexport RDMA_GID_INDEX=2\nexport RDMA_QP_SL=4\n</code></pre>\n<p>they can let two machines communicate with each other, but no packets in corresponding priority_4 can be found (packets can be found when using ib_write_bw ).</p>\n<p>Here is the output of mlnx_qos  (same output on two machines):</p>\n<pre><code>mlnx_qos -i eth2\nPriority trust mode is not supported on your system\nPriority trust mode: none\nPFC configuration:\n        priority    0   1   2   3   4   5   6   7\n        enabled     0   1   1   0   1   0   0   0\n\ntc: 0 ratelimit: unlimited, tsa: vendor\n         priority:  0\ntc: 1 ratelimit: unlimited, tsa: vendor\n         priority:  1\ntc: 2 ratelimit: unlimited, tsa: vendor\n         priority:  2\ntc: 3 ratelimit: unlimited, tsa: vendor\n         priority:  3\ntc: 4 ratelimit: unlimited, tsa: vendor\n         priority:  4\ntc: 5 ratelimit: unlimited, tsa: vendor\n         priority:  5\ntc: 6 ratelimit: unlimited, tsa: vendor\n         priority:  6\ntc: 7 ratelimit: unlimited, tsa: vendor\n         priority:  7\n</code></pre>", "body_text": "@shamoya\nI run ib_write_bw as following:\nreceiver:\nib_write_bw -d mlx4_0 -i 1 -x 2 --report_gbits --port=12500 -D 10\n\n************************************\n* Waiting for client to connect... *\n************************************\n---------------------------------------------------------------------------------------\n                    RDMA_Write BW Test\n Dual-port       : OFF          Device         : mlx4_0\n Number of qps   : 1            Transport type : IB\n Connection type : RC           Using SRQ      : OFF\n CQ Moderation   : 100\n Mtu             : 1024[B]\n Link type       : Ethernet\n GID index       : 2\n Max inline data : 0[B]\n rdma_cm QPs     : OFF\n Data ex. method : Ethernet\n---------------------------------------------------------------------------------------\n local address: LID 0000 QPN 0x0260 PSN 0x90ca24 RKey 0x6801010c VAddr 0x007f2529d77000\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:10:10:10:06\n remote address: LID 0000 QPN 0x0260 PSN 0x14f043 RKey 0xa8010105 VAddr 0x007f820fee5000\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:10:10:10:02\n---------------------------------------------------------------------------------------\n #bytes     #iterations    BW peak[Gb/sec]    BW average[Gb/sec]   MsgRate[Mpps]\n 65536      415500           0.00               36.31              0.069247\n---------------------------------------------------------------------------------------\n\nsender:\nib_write_bw -d mlx4_0 -i 1 -x 2 -S 4 --report_gbits 10.10.10.6 --port=12500 -D 10\n---------------------------------------------------------------------------------------\n                    RDMA_Write BW Test\n Dual-port       : OFF          Device         : mlx4_0\n Number of qps   : 1            Transport type : IB\n Connection type : RC           Using SRQ      : OFF\n TX depth        : 128\n CQ Moderation   : 100\n Mtu             : 1024[B]\n Link type       : Ethernet\n GID index       : 2\n Max inline data : 0[B]\n rdma_cm QPs     : OFF\n Data ex. method : Ethernet\n---------------------------------------------------------------------------------------\n local address: LID 0000 QPN 0x0260 PSN 0x14f043 RKey 0xa8010105 VAddr 0x007f820fee5000\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:10:10:10:02\n remote address: LID 0000 QPN 0x0260 PSN 0x90ca24 RKey 0x6801010c VAddr 0x007f2529d77000\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:10:10:10:06\n---------------------------------------------------------------------------------------\n #bytes     #iterations    BW peak[Gb/sec]    BW average[Gb/sec]   MsgRate[Mpps]\nConflicting CPU frequency values detected: 1200.000000 != 3199.951000. CPU Frequency is not max.\n 65536      415500           0.00               36.31              0.069247\n---------------------------------------------------------------------------------------\n\nSame parameters for TF job are these:\nexport RDMA_DEVICE=\"mlx4_0\"\nexport RDMA_DEVICE_PORT=1\nexport RDMA_GID_INDEX=2\nexport RDMA_QP_SL=4\n\nthey can let two machines communicate with each other, but no packets in corresponding priority_4 can be found (packets can be found when using ib_write_bw ).\nHere is the output of mlnx_qos  (same output on two machines):\nmlnx_qos -i eth2\nPriority trust mode is not supported on your system\nPriority trust mode: none\nPFC configuration:\n        priority    0   1   2   3   4   5   6   7\n        enabled     0   1   1   0   1   0   0   0\n\ntc: 0 ratelimit: unlimited, tsa: vendor\n         priority:  0\ntc: 1 ratelimit: unlimited, tsa: vendor\n         priority:  1\ntc: 2 ratelimit: unlimited, tsa: vendor\n         priority:  2\ntc: 3 ratelimit: unlimited, tsa: vendor\n         priority:  3\ntc: 4 ratelimit: unlimited, tsa: vendor\n         priority:  4\ntc: 5 ratelimit: unlimited, tsa: vendor\n         priority:  5\ntc: 6 ratelimit: unlimited, tsa: vendor\n         priority:  6\ntc: 7 ratelimit: unlimited, tsa: vendor\n         priority:  7", "body": "@shamoya \r\n\r\nI run ib_write_bw as following:\r\nreceiver:\r\n```\r\nib_write_bw -d mlx4_0 -i 1 -x 2 --report_gbits --port=12500 -D 10\r\n\r\n************************************\r\n* Waiting for client to connect... *\r\n************************************\r\n---------------------------------------------------------------------------------------\r\n                    RDMA_Write BW Test\r\n Dual-port       : OFF          Device         : mlx4_0\r\n Number of qps   : 1            Transport type : IB\r\n Connection type : RC           Using SRQ      : OFF\r\n CQ Moderation   : 100\r\n Mtu             : 1024[B]\r\n Link type       : Ethernet\r\n GID index       : 2\r\n Max inline data : 0[B]\r\n rdma_cm QPs     : OFF\r\n Data ex. method : Ethernet\r\n---------------------------------------------------------------------------------------\r\n local address: LID 0000 QPN 0x0260 PSN 0x90ca24 RKey 0x6801010c VAddr 0x007f2529d77000\r\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:10:10:10:06\r\n remote address: LID 0000 QPN 0x0260 PSN 0x14f043 RKey 0xa8010105 VAddr 0x007f820fee5000\r\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:10:10:10:02\r\n---------------------------------------------------------------------------------------\r\n #bytes     #iterations    BW peak[Gb/sec]    BW average[Gb/sec]   MsgRate[Mpps]\r\n 65536      415500           0.00               36.31              0.069247\r\n---------------------------------------------------------------------------------------\r\n```\r\nsender:\r\n```\r\nib_write_bw -d mlx4_0 -i 1 -x 2 -S 4 --report_gbits 10.10.10.6 --port=12500 -D 10\r\n---------------------------------------------------------------------------------------\r\n                    RDMA_Write BW Test\r\n Dual-port       : OFF          Device         : mlx4_0\r\n Number of qps   : 1            Transport type : IB\r\n Connection type : RC           Using SRQ      : OFF\r\n TX depth        : 128\r\n CQ Moderation   : 100\r\n Mtu             : 1024[B]\r\n Link type       : Ethernet\r\n GID index       : 2\r\n Max inline data : 0[B]\r\n rdma_cm QPs     : OFF\r\n Data ex. method : Ethernet\r\n---------------------------------------------------------------------------------------\r\n local address: LID 0000 QPN 0x0260 PSN 0x14f043 RKey 0xa8010105 VAddr 0x007f820fee5000\r\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:10:10:10:02\r\n remote address: LID 0000 QPN 0x0260 PSN 0x90ca24 RKey 0x6801010c VAddr 0x007f2529d77000\r\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:10:10:10:06\r\n---------------------------------------------------------------------------------------\r\n #bytes     #iterations    BW peak[Gb/sec]    BW average[Gb/sec]   MsgRate[Mpps]\r\nConflicting CPU frequency values detected: 1200.000000 != 3199.951000. CPU Frequency is not max.\r\n 65536      415500           0.00               36.31              0.069247\r\n---------------------------------------------------------------------------------------\r\n```\r\nSame parameters for TF job are these:\r\n```\r\nexport RDMA_DEVICE=\"mlx4_0\"\r\nexport RDMA_DEVICE_PORT=1\r\nexport RDMA_GID_INDEX=2\r\nexport RDMA_QP_SL=4\r\n```\r\nthey can let two machines communicate with each other, but no packets in corresponding priority_4 can be found (packets can be found when using ib_write_bw ).\r\n\r\nHere is the output of mlnx_qos  (same output on two machines):\r\n```\r\nmlnx_qos -i eth2\r\nPriority trust mode is not supported on your system\r\nPriority trust mode: none\r\nPFC configuration:\r\n        priority    0   1   2   3   4   5   6   7\r\n        enabled     0   1   1   0   1   0   0   0\r\n\r\ntc: 0 ratelimit: unlimited, tsa: vendor\r\n         priority:  0\r\ntc: 1 ratelimit: unlimited, tsa: vendor\r\n         priority:  1\r\ntc: 2 ratelimit: unlimited, tsa: vendor\r\n         priority:  2\r\ntc: 3 ratelimit: unlimited, tsa: vendor\r\n         priority:  3\r\ntc: 4 ratelimit: unlimited, tsa: vendor\r\n         priority:  4\r\ntc: 5 ratelimit: unlimited, tsa: vendor\r\n         priority:  5\r\ntc: 6 ratelimit: unlimited, tsa: vendor\r\n         priority:  6\r\ntc: 7 ratelimit: unlimited, tsa: vendor\r\n         priority:  7\r\n```"}