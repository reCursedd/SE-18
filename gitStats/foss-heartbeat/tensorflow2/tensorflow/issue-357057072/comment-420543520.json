{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/420543520", "html_url": "https://github.com/tensorflow/tensorflow/issues/22077#issuecomment-420543520", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22077", "id": 420543520, "node_id": "MDEyOklzc3VlQ29tbWVudDQyMDU0MzUyMA==", "user": {"login": "wangshuaizs", "id": 21264093, "node_id": "MDQ6VXNlcjIxMjY0MDkz", "avatar_url": "https://avatars2.githubusercontent.com/u/21264093?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wangshuaizs", "html_url": "https://github.com/wangshuaizs", "followers_url": "https://api.github.com/users/wangshuaizs/followers", "following_url": "https://api.github.com/users/wangshuaizs/following{/other_user}", "gists_url": "https://api.github.com/users/wangshuaizs/gists{/gist_id}", "starred_url": "https://api.github.com/users/wangshuaizs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wangshuaizs/subscriptions", "organizations_url": "https://api.github.com/users/wangshuaizs/orgs", "repos_url": "https://api.github.com/users/wangshuaizs/repos", "events_url": "https://api.github.com/users/wangshuaizs/events{/privacy}", "received_events_url": "https://api.github.com/users/wangshuaizs/received_events", "type": "User", "site_admin": false}, "created_at": "2018-09-12T07:33:08Z", "updated_at": "2018-09-12T07:33:08Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=31474666\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/eladweiss\">@eladweiss</a></p>\n<p>Hi,  eladweiss</p>\n<p>Here are the commands:</p>\n<p>PS:</p>\n<pre><code>$ CUDA_VISIBLE_DEVICES='0' python benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --local_parameter_device=cpu --num_gpus=1 --batch_size=128 --num_epochs=10 --model=alexnet --variable_update=distributed_replicated --data_dir=/home/shuai/imagenet-data --all_reduce_spec=pscpu --job_name=ps --ps_hosts=10.10.10.6:2222 --worker_hosts=10.10.10.5:3333 --task_index=0 --server_protocol=grpc+verbs\n</code></pre>\n<p>Woker:</p>\n<pre><code>$ python benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --local_parameter_device=gpu --num_gpus=4 --batch_size=128 --num_epochs=10 --model=alexnet --variable_update=distributed_replicated --data_dir=/home/shuai/imagenet-data --all_reduce_spec=pscpu --job_name=worker --ps_hosts=10.10.10.6:2222 --worker_hosts=10.10.10.5:3333 --task_index=0 --server_protocol=grpc+verbs\n</code></pre>\n<p>And their outputs:</p>\n<p>PS:</p>\n<pre><code>2018-09-12 15:28:20.273246: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1405] Found device 0 with properties:\nname: Tesla K40c major: 3 minor: 5 memoryClockRate(GHz): 0.745\npciBusID: 0000:83:00.0\ntotalMemory: 11.92GiB freeMemory: 11.84GiB\n2018-09-12 15:28:20.273318: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1484] Adding visible gpu devices: 0\n2018-09-12 15:28:21.648094: I tensorflow/core/common_runtime/gpu/gpu_device.cc:965] Device interconnect StreamExecutor with strength 1 edge matrix:\n2018-09-12 15:28:21.648164: I tensorflow/core/common_runtime/gpu/gpu_device.cc:971]      0\n2018-09-12 15:28:21.648177: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 0:   N\n2018-09-12 15:28:21.648712: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:ps/replica:0/task:0/device:GPU:0 with 11475 MB memory) -&gt; physical GPU (device: 0, name: Tesla K40c, pci bus id: 0000:83:00.0, compute capability: 3.5)\n2018-09-12 15:28:21.881963: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job ps -&gt; {0 -&gt; localhost:2222}\n2018-09-12 15:28:21.882020: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job worker -&gt; {0 -&gt; 10.10.10.5:3333}\n2018-09-12 15:28:21.888656: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job ps -&gt; {0 -&gt; localhost:2222}\n2018-09-12 15:28:21.888705: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job worker -&gt; {0 -&gt; 10.10.10.5:3333}\n2018-09-12 15:28:21.896826: I tensorflow/contrib/verbs/rdma.cc:315] RoCE v2 is not configured for GID_INDEX 0\n2018-09-12 15:28:21.898419: I tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:375] Started server with target: grpc://localhost:2222\n2018-09-12 15:28:22.899591: I tensorflow/contrib/verbs/rdma_mgr.cc:129] Connected to remote node /job:worker/replica:0/task:0\n2018-09-12 15:28:27.106560: F tensorflow/contrib/verbs/rdma_mgr.cc:171] Check failed: s == IBV_WC_SUCCESS : transport retry counter exceeded(12) to /job:worker/replica:0/task:0\nAborted (core dumped)\n</code></pre>\n<p>Worker:</p>\n<pre><code>2018-09-12 15:28:20.043446: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1405] Found device 0 with properties:\nname: Tesla K40c major: 3 minor: 5 memoryClockRate(GHz): 0.745\npciBusID: 0000:02:00.0\ntotalMemory: 11.92GiB freeMemory: 11.84GiB\n2018-09-12 15:28:20.217124: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1405] Found device 1 with properties:\nname: Tesla K40c major: 3 minor: 5 memoryClockRate(GHz): 0.745\npciBusID: 0000:03:00.0\ntotalMemory: 11.92GiB freeMemory: 11.84GiB\n2018-09-12 15:28:20.379978: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1405] Found device 2 with properties:\nname: Tesla K40c major: 3 minor: 5 memoryClockRate(GHz): 0.745\npciBusID: 0000:83:00.0\ntotalMemory: 11.92GiB freeMemory: 11.84GiB\n2018-09-12 15:28:20.552778: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1405] Found device 3 with properties:\nname: Tesla K40c major: 3 minor: 5 memoryClockRate(GHz): 0.745\npciBusID: 0000:84:00.0\ntotalMemory: 11.92GiB freeMemory: 11.84GiB\n2018-09-12 15:28:20.553338: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1484] Adding visible gpu devices: 0, 1, 2, 3\n2018-09-12 15:28:21.710571: I tensorflow/core/common_runtime/gpu/gpu_device.cc:965] Device interconnect StreamExecutor with strength 1 edge matrix:\n2018-09-12 15:28:21.710613: I tensorflow/core/common_runtime/gpu/gpu_device.cc:971]      0 1 2 3\n2018-09-12 15:28:21.710619: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 0:   N Y N N\n2018-09-12 15:28:21.710623: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 1:   Y N N N\n2018-09-12 15:28:21.710627: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 2:   N N N Y\n2018-09-12 15:28:21.710630: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 3:   N N Y N\n2018-09-12 15:28:21.711594: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:0 with 11473 MB memory) -&gt; physical GPU (device: 0, name: Tesla K40c, pci bus id: 0000:02:00.0, compute capability: 3.5)\n2018-09-12 15:28:21.810055: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:1 with 11473 MB memory) -&gt; physical GPU (device: 1, name: Tesla K40c, pci bus id: 0000:03:00.0, compute capability: 3.5)\n2018-09-12 15:28:21.907987: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:2 with 11473 MB memory) -&gt; physical GPU (device: 2, name: Tesla K40c, pci bus id: 0000:83:00.0, compute capability: 3.5)\n2018-09-12 15:28:22.058943: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:3 with 11473 MB memory) -&gt; physical GPU (device: 3, name: Tesla K40c, pci bus id: 0000:84:00.0, compute capability: 3.5)\n2018-09-12 15:28:22.214050: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job ps -&gt; {0 -&gt; 10.10.10.6:2222}\n2018-09-12 15:28:22.214083: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job worker -&gt; {0 -&gt; localhost:3333}\n2018-09-12 15:28:22.216382: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job ps -&gt; {0 -&gt; 10.10.10.6:2222}\n2018-09-12 15:28:22.216399: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job worker -&gt; {0 -&gt; localhost:3333}\n2018-09-12 15:28:22.222362: I tensorflow/contrib/verbs/rdma.cc:315] RoCE v2 is not configured for GID_INDEX 0\n2018-09-12 15:28:22.226575: I tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:375] Started server with target: grpc://localhost:3333\n2018-09-12 15:28:22.229269: I tensorflow/contrib/verbs/rdma_mgr.cc:129] Connected to remote node /job:ps/replica:0/task:0\n2018-09-12 15:28:26.522003: F tensorflow/contrib/verbs/rdma_mgr.cc:171] Check failed: s == IBV_WC_SUCCESS : transport retry counter exceeded(12) to /job:ps/replica:0/task:0\nAborted (core dumped)\n</code></pre>\n<p>The relative configuration of network is as the following:</p>\n<p>PS</p>\n<pre><code>\neth2      Link encap:Ethernet  HWaddr 00:02:c9:b3:6c:a1\n          inet addr:12.12.10.16  Bcast:12.12.10.255  Mask:255.255.255.0\n          inet6 addr: fe80::202:c9ff:feb3:6ca1/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:1423943565 errors:0 dropped:5041404 overruns:5041404 frame:0\n          TX packets:1423659468 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:2123250675808 (2.1 TB)  TX bytes:2129488926814 (2.1 TB)\n\neth3      Link encap:Ethernet  HWaddr 00:02:c9:b3:6c:a2\n          inet addr:12.12.11.16  Bcast:12.12.11.255  Mask:255.255.255.0\n          inet6 addr: fe80::202:c9ff:feb3:6ca2/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:47011941 errors:0 dropped:2525670 overruns:2525670 frame:0\n          TX packets:355985405 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:3504413138 (3.5 GB)  TX bytes:503017410925 (503.0 GB)\n\neth2.10   Link encap:Ethernet  HWaddr 00:02:c9:b3:6c:a1\n          inet addr:10.10.10.6  Bcast:10.10.10.255  Mask:255.255.255.0\n          inet6 addr: fe80::202:c9ff:feb3:6ca1/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:141928452 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:65669678 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:2036642868180 (2.0 TB)  TX bytes:2039860904188 (2.0 TB)\n</code></pre>\n<p>Worker:</p>\n<pre><code>\neth2      Link encap:Ethernet  HWaddr f4:52:14:8c:bd:31\n          inet addr:12.12.10.15  Bcast:12.12.10.255  Mask:255.255.255.0\n          inet6 addr: fe80::f652:14ff:fe8c:bd31/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:1420277011 errors:0 dropped:3189942 overruns:3189942 frame:0\n          TX packets:1426906489 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:2122949751945 (2.1 TB)  TX bytes:2129171627848 (2.1 TB)\n\neth3      Link encap:Ethernet  HWaddr f4:52:14:8c:bd:32\n          inet addr:12.12.11.15  Bcast:12.12.11.255  Mask:255.255.255.0\n          inet6 addr: fe80::f652:14ff:fe8c:bd32/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:60662288 errors:0 dropped:2492643 overruns:2492643 frame:0\n          TX packets:459009319 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:4518366385 (4.5 GB)  TX bytes:650313430347 (650.3 GB)\n\neth2.10   Link encap:Ethernet  HWaddr f4:52:14:8c:bd:31\n          inet addr:10.10.10.5  Bcast:10.10.10.255  Mask:255.255.255.0\n          inet6 addr: fe80::f652:14ff:fe8c:bd31/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:89531729 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:63422690 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:2033861446400 (2.0 TB)  TX bytes:2039178863340 (2.0 TB)\n\n</code></pre>", "body_text": "@eladweiss\nHi,  eladweiss\nHere are the commands:\nPS:\n$ CUDA_VISIBLE_DEVICES='0' python benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --local_parameter_device=cpu --num_gpus=1 --batch_size=128 --num_epochs=10 --model=alexnet --variable_update=distributed_replicated --data_dir=/home/shuai/imagenet-data --all_reduce_spec=pscpu --job_name=ps --ps_hosts=10.10.10.6:2222 --worker_hosts=10.10.10.5:3333 --task_index=0 --server_protocol=grpc+verbs\n\nWoker:\n$ python benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --local_parameter_device=gpu --num_gpus=4 --batch_size=128 --num_epochs=10 --model=alexnet --variable_update=distributed_replicated --data_dir=/home/shuai/imagenet-data --all_reduce_spec=pscpu --job_name=worker --ps_hosts=10.10.10.6:2222 --worker_hosts=10.10.10.5:3333 --task_index=0 --server_protocol=grpc+verbs\n\nAnd their outputs:\nPS:\n2018-09-12 15:28:20.273246: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1405] Found device 0 with properties:\nname: Tesla K40c major: 3 minor: 5 memoryClockRate(GHz): 0.745\npciBusID: 0000:83:00.0\ntotalMemory: 11.92GiB freeMemory: 11.84GiB\n2018-09-12 15:28:20.273318: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1484] Adding visible gpu devices: 0\n2018-09-12 15:28:21.648094: I tensorflow/core/common_runtime/gpu/gpu_device.cc:965] Device interconnect StreamExecutor with strength 1 edge matrix:\n2018-09-12 15:28:21.648164: I tensorflow/core/common_runtime/gpu/gpu_device.cc:971]      0\n2018-09-12 15:28:21.648177: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 0:   N\n2018-09-12 15:28:21.648712: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:ps/replica:0/task:0/device:GPU:0 with 11475 MB memory) -> physical GPU (device: 0, name: Tesla K40c, pci bus id: 0000:83:00.0, compute capability: 3.5)\n2018-09-12 15:28:21.881963: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job ps -> {0 -> localhost:2222}\n2018-09-12 15:28:21.882020: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job worker -> {0 -> 10.10.10.5:3333}\n2018-09-12 15:28:21.888656: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job ps -> {0 -> localhost:2222}\n2018-09-12 15:28:21.888705: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job worker -> {0 -> 10.10.10.5:3333}\n2018-09-12 15:28:21.896826: I tensorflow/contrib/verbs/rdma.cc:315] RoCE v2 is not configured for GID_INDEX 0\n2018-09-12 15:28:21.898419: I tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:375] Started server with target: grpc://localhost:2222\n2018-09-12 15:28:22.899591: I tensorflow/contrib/verbs/rdma_mgr.cc:129] Connected to remote node /job:worker/replica:0/task:0\n2018-09-12 15:28:27.106560: F tensorflow/contrib/verbs/rdma_mgr.cc:171] Check failed: s == IBV_WC_SUCCESS : transport retry counter exceeded(12) to /job:worker/replica:0/task:0\nAborted (core dumped)\n\nWorker:\n2018-09-12 15:28:20.043446: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1405] Found device 0 with properties:\nname: Tesla K40c major: 3 minor: 5 memoryClockRate(GHz): 0.745\npciBusID: 0000:02:00.0\ntotalMemory: 11.92GiB freeMemory: 11.84GiB\n2018-09-12 15:28:20.217124: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1405] Found device 1 with properties:\nname: Tesla K40c major: 3 minor: 5 memoryClockRate(GHz): 0.745\npciBusID: 0000:03:00.0\ntotalMemory: 11.92GiB freeMemory: 11.84GiB\n2018-09-12 15:28:20.379978: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1405] Found device 2 with properties:\nname: Tesla K40c major: 3 minor: 5 memoryClockRate(GHz): 0.745\npciBusID: 0000:83:00.0\ntotalMemory: 11.92GiB freeMemory: 11.84GiB\n2018-09-12 15:28:20.552778: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1405] Found device 3 with properties:\nname: Tesla K40c major: 3 minor: 5 memoryClockRate(GHz): 0.745\npciBusID: 0000:84:00.0\ntotalMemory: 11.92GiB freeMemory: 11.84GiB\n2018-09-12 15:28:20.553338: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1484] Adding visible gpu devices: 0, 1, 2, 3\n2018-09-12 15:28:21.710571: I tensorflow/core/common_runtime/gpu/gpu_device.cc:965] Device interconnect StreamExecutor with strength 1 edge matrix:\n2018-09-12 15:28:21.710613: I tensorflow/core/common_runtime/gpu/gpu_device.cc:971]      0 1 2 3\n2018-09-12 15:28:21.710619: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 0:   N Y N N\n2018-09-12 15:28:21.710623: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 1:   Y N N N\n2018-09-12 15:28:21.710627: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 2:   N N N Y\n2018-09-12 15:28:21.710630: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 3:   N N Y N\n2018-09-12 15:28:21.711594: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:0 with 11473 MB memory) -> physical GPU (device: 0, name: Tesla K40c, pci bus id: 0000:02:00.0, compute capability: 3.5)\n2018-09-12 15:28:21.810055: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:1 with 11473 MB memory) -> physical GPU (device: 1, name: Tesla K40c, pci bus id: 0000:03:00.0, compute capability: 3.5)\n2018-09-12 15:28:21.907987: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:2 with 11473 MB memory) -> physical GPU (device: 2, name: Tesla K40c, pci bus id: 0000:83:00.0, compute capability: 3.5)\n2018-09-12 15:28:22.058943: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:3 with 11473 MB memory) -> physical GPU (device: 3, name: Tesla K40c, pci bus id: 0000:84:00.0, compute capability: 3.5)\n2018-09-12 15:28:22.214050: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job ps -> {0 -> 10.10.10.6:2222}\n2018-09-12 15:28:22.214083: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job worker -> {0 -> localhost:3333}\n2018-09-12 15:28:22.216382: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job ps -> {0 -> 10.10.10.6:2222}\n2018-09-12 15:28:22.216399: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job worker -> {0 -> localhost:3333}\n2018-09-12 15:28:22.222362: I tensorflow/contrib/verbs/rdma.cc:315] RoCE v2 is not configured for GID_INDEX 0\n2018-09-12 15:28:22.226575: I tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:375] Started server with target: grpc://localhost:3333\n2018-09-12 15:28:22.229269: I tensorflow/contrib/verbs/rdma_mgr.cc:129] Connected to remote node /job:ps/replica:0/task:0\n2018-09-12 15:28:26.522003: F tensorflow/contrib/verbs/rdma_mgr.cc:171] Check failed: s == IBV_WC_SUCCESS : transport retry counter exceeded(12) to /job:ps/replica:0/task:0\nAborted (core dumped)\n\nThe relative configuration of network is as the following:\nPS\n\neth2      Link encap:Ethernet  HWaddr 00:02:c9:b3:6c:a1\n          inet addr:12.12.10.16  Bcast:12.12.10.255  Mask:255.255.255.0\n          inet6 addr: fe80::202:c9ff:feb3:6ca1/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:1423943565 errors:0 dropped:5041404 overruns:5041404 frame:0\n          TX packets:1423659468 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:2123250675808 (2.1 TB)  TX bytes:2129488926814 (2.1 TB)\n\neth3      Link encap:Ethernet  HWaddr 00:02:c9:b3:6c:a2\n          inet addr:12.12.11.16  Bcast:12.12.11.255  Mask:255.255.255.0\n          inet6 addr: fe80::202:c9ff:feb3:6ca2/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:47011941 errors:0 dropped:2525670 overruns:2525670 frame:0\n          TX packets:355985405 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:3504413138 (3.5 GB)  TX bytes:503017410925 (503.0 GB)\n\neth2.10   Link encap:Ethernet  HWaddr 00:02:c9:b3:6c:a1\n          inet addr:10.10.10.6  Bcast:10.10.10.255  Mask:255.255.255.0\n          inet6 addr: fe80::202:c9ff:feb3:6ca1/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:141928452 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:65669678 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:2036642868180 (2.0 TB)  TX bytes:2039860904188 (2.0 TB)\n\nWorker:\n\neth2      Link encap:Ethernet  HWaddr f4:52:14:8c:bd:31\n          inet addr:12.12.10.15  Bcast:12.12.10.255  Mask:255.255.255.0\n          inet6 addr: fe80::f652:14ff:fe8c:bd31/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:1420277011 errors:0 dropped:3189942 overruns:3189942 frame:0\n          TX packets:1426906489 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:2122949751945 (2.1 TB)  TX bytes:2129171627848 (2.1 TB)\n\neth3      Link encap:Ethernet  HWaddr f4:52:14:8c:bd:32\n          inet addr:12.12.11.15  Bcast:12.12.11.255  Mask:255.255.255.0\n          inet6 addr: fe80::f652:14ff:fe8c:bd32/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:60662288 errors:0 dropped:2492643 overruns:2492643 frame:0\n          TX packets:459009319 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:4518366385 (4.5 GB)  TX bytes:650313430347 (650.3 GB)\n\neth2.10   Link encap:Ethernet  HWaddr f4:52:14:8c:bd:31\n          inet addr:10.10.10.5  Bcast:10.10.10.255  Mask:255.255.255.0\n          inet6 addr: fe80::f652:14ff:fe8c:bd31/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:89531729 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:63422690 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:2033861446400 (2.0 TB)  TX bytes:2039178863340 (2.0 TB)", "body": "@eladweiss \r\n\r\nHi,  eladweiss\r\n\r\nHere are the commands:\r\n\r\nPS:\r\n```\r\n$ CUDA_VISIBLE_DEVICES='0' python benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --local_parameter_device=cpu --num_gpus=1 --batch_size=128 --num_epochs=10 --model=alexnet --variable_update=distributed_replicated --data_dir=/home/shuai/imagenet-data --all_reduce_spec=pscpu --job_name=ps --ps_hosts=10.10.10.6:2222 --worker_hosts=10.10.10.5:3333 --task_index=0 --server_protocol=grpc+verbs\r\n```\r\n\r\nWoker:\r\n```\r\n$ python benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --local_parameter_device=gpu --num_gpus=4 --batch_size=128 --num_epochs=10 --model=alexnet --variable_update=distributed_replicated --data_dir=/home/shuai/imagenet-data --all_reduce_spec=pscpu --job_name=worker --ps_hosts=10.10.10.6:2222 --worker_hosts=10.10.10.5:3333 --task_index=0 --server_protocol=grpc+verbs\r\n```\r\n\r\nAnd their outputs:\r\n\r\nPS:\r\n```\r\n2018-09-12 15:28:20.273246: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1405] Found device 0 with properties:\r\nname: Tesla K40c major: 3 minor: 5 memoryClockRate(GHz): 0.745\r\npciBusID: 0000:83:00.0\r\ntotalMemory: 11.92GiB freeMemory: 11.84GiB\r\n2018-09-12 15:28:20.273318: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1484] Adding visible gpu devices: 0\r\n2018-09-12 15:28:21.648094: I tensorflow/core/common_runtime/gpu/gpu_device.cc:965] Device interconnect StreamExecutor with strength 1 edge matrix:\r\n2018-09-12 15:28:21.648164: I tensorflow/core/common_runtime/gpu/gpu_device.cc:971]      0\r\n2018-09-12 15:28:21.648177: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 0:   N\r\n2018-09-12 15:28:21.648712: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:ps/replica:0/task:0/device:GPU:0 with 11475 MB memory) -> physical GPU (device: 0, name: Tesla K40c, pci bus id: 0000:83:00.0, compute capability: 3.5)\r\n2018-09-12 15:28:21.881963: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job ps -> {0 -> localhost:2222}\r\n2018-09-12 15:28:21.882020: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job worker -> {0 -> 10.10.10.5:3333}\r\n2018-09-12 15:28:21.888656: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job ps -> {0 -> localhost:2222}\r\n2018-09-12 15:28:21.888705: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job worker -> {0 -> 10.10.10.5:3333}\r\n2018-09-12 15:28:21.896826: I tensorflow/contrib/verbs/rdma.cc:315] RoCE v2 is not configured for GID_INDEX 0\r\n2018-09-12 15:28:21.898419: I tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:375] Started server with target: grpc://localhost:2222\r\n2018-09-12 15:28:22.899591: I tensorflow/contrib/verbs/rdma_mgr.cc:129] Connected to remote node /job:worker/replica:0/task:0\r\n2018-09-12 15:28:27.106560: F tensorflow/contrib/verbs/rdma_mgr.cc:171] Check failed: s == IBV_WC_SUCCESS : transport retry counter exceeded(12) to /job:worker/replica:0/task:0\r\nAborted (core dumped)\r\n```\r\n\r\nWorker:\r\n```\r\n2018-09-12 15:28:20.043446: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1405] Found device 0 with properties:\r\nname: Tesla K40c major: 3 minor: 5 memoryClockRate(GHz): 0.745\r\npciBusID: 0000:02:00.0\r\ntotalMemory: 11.92GiB freeMemory: 11.84GiB\r\n2018-09-12 15:28:20.217124: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1405] Found device 1 with properties:\r\nname: Tesla K40c major: 3 minor: 5 memoryClockRate(GHz): 0.745\r\npciBusID: 0000:03:00.0\r\ntotalMemory: 11.92GiB freeMemory: 11.84GiB\r\n2018-09-12 15:28:20.379978: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1405] Found device 2 with properties:\r\nname: Tesla K40c major: 3 minor: 5 memoryClockRate(GHz): 0.745\r\npciBusID: 0000:83:00.0\r\ntotalMemory: 11.92GiB freeMemory: 11.84GiB\r\n2018-09-12 15:28:20.552778: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1405] Found device 3 with properties:\r\nname: Tesla K40c major: 3 minor: 5 memoryClockRate(GHz): 0.745\r\npciBusID: 0000:84:00.0\r\ntotalMemory: 11.92GiB freeMemory: 11.84GiB\r\n2018-09-12 15:28:20.553338: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1484] Adding visible gpu devices: 0, 1, 2, 3\r\n2018-09-12 15:28:21.710571: I tensorflow/core/common_runtime/gpu/gpu_device.cc:965] Device interconnect StreamExecutor with strength 1 edge matrix:\r\n2018-09-12 15:28:21.710613: I tensorflow/core/common_runtime/gpu/gpu_device.cc:971]      0 1 2 3\r\n2018-09-12 15:28:21.710619: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 0:   N Y N N\r\n2018-09-12 15:28:21.710623: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 1:   Y N N N\r\n2018-09-12 15:28:21.710627: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 2:   N N N Y\r\n2018-09-12 15:28:21.710630: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 3:   N N Y N\r\n2018-09-12 15:28:21.711594: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:0 with 11473 MB memory) -> physical GPU (device: 0, name: Tesla K40c, pci bus id: 0000:02:00.0, compute capability: 3.5)\r\n2018-09-12 15:28:21.810055: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:1 with 11473 MB memory) -> physical GPU (device: 1, name: Tesla K40c, pci bus id: 0000:03:00.0, compute capability: 3.5)\r\n2018-09-12 15:28:21.907987: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:2 with 11473 MB memory) -> physical GPU (device: 2, name: Tesla K40c, pci bus id: 0000:83:00.0, compute capability: 3.5)\r\n2018-09-12 15:28:22.058943: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:worker/replica:0/task:0/device:GPU:3 with 11473 MB memory) -> physical GPU (device: 3, name: Tesla K40c, pci bus id: 0000:84:00.0, compute capability: 3.5)\r\n2018-09-12 15:28:22.214050: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job ps -> {0 -> 10.10.10.6:2222}\r\n2018-09-12 15:28:22.214083: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job worker -> {0 -> localhost:3333}\r\n2018-09-12 15:28:22.216382: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job ps -> {0 -> 10.10.10.6:2222}\r\n2018-09-12 15:28:22.216399: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job worker -> {0 -> localhost:3333}\r\n2018-09-12 15:28:22.222362: I tensorflow/contrib/verbs/rdma.cc:315] RoCE v2 is not configured for GID_INDEX 0\r\n2018-09-12 15:28:22.226575: I tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:375] Started server with target: grpc://localhost:3333\r\n2018-09-12 15:28:22.229269: I tensorflow/contrib/verbs/rdma_mgr.cc:129] Connected to remote node /job:ps/replica:0/task:0\r\n2018-09-12 15:28:26.522003: F tensorflow/contrib/verbs/rdma_mgr.cc:171] Check failed: s == IBV_WC_SUCCESS : transport retry counter exceeded(12) to /job:ps/replica:0/task:0\r\nAborted (core dumped)\r\n```\r\n\r\nThe relative configuration of network is as the following:\r\n\r\nPS\r\n```\r\n\r\neth2      Link encap:Ethernet  HWaddr 00:02:c9:b3:6c:a1\r\n          inet addr:12.12.10.16  Bcast:12.12.10.255  Mask:255.255.255.0\r\n          inet6 addr: fe80::202:c9ff:feb3:6ca1/64 Scope:Link\r\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\r\n          RX packets:1423943565 errors:0 dropped:5041404 overruns:5041404 frame:0\r\n          TX packets:1423659468 errors:0 dropped:0 overruns:0 carrier:0\r\n          collisions:0 txqueuelen:1000\r\n          RX bytes:2123250675808 (2.1 TB)  TX bytes:2129488926814 (2.1 TB)\r\n\r\neth3      Link encap:Ethernet  HWaddr 00:02:c9:b3:6c:a2\r\n          inet addr:12.12.11.16  Bcast:12.12.11.255  Mask:255.255.255.0\r\n          inet6 addr: fe80::202:c9ff:feb3:6ca2/64 Scope:Link\r\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\r\n          RX packets:47011941 errors:0 dropped:2525670 overruns:2525670 frame:0\r\n          TX packets:355985405 errors:0 dropped:0 overruns:0 carrier:0\r\n          collisions:0 txqueuelen:1000\r\n          RX bytes:3504413138 (3.5 GB)  TX bytes:503017410925 (503.0 GB)\r\n\r\neth2.10   Link encap:Ethernet  HWaddr 00:02:c9:b3:6c:a1\r\n          inet addr:10.10.10.6  Bcast:10.10.10.255  Mask:255.255.255.0\r\n          inet6 addr: fe80::202:c9ff:feb3:6ca1/64 Scope:Link\r\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\r\n          RX packets:141928452 errors:0 dropped:0 overruns:0 frame:0\r\n          TX packets:65669678 errors:0 dropped:0 overruns:0 carrier:0\r\n          collisions:0 txqueuelen:1000\r\n          RX bytes:2036642868180 (2.0 TB)  TX bytes:2039860904188 (2.0 TB)\r\n```\r\n\r\nWorker:\r\n```\r\n\r\neth2      Link encap:Ethernet  HWaddr f4:52:14:8c:bd:31\r\n          inet addr:12.12.10.15  Bcast:12.12.10.255  Mask:255.255.255.0\r\n          inet6 addr: fe80::f652:14ff:fe8c:bd31/64 Scope:Link\r\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\r\n          RX packets:1420277011 errors:0 dropped:3189942 overruns:3189942 frame:0\r\n          TX packets:1426906489 errors:0 dropped:0 overruns:0 carrier:0\r\n          collisions:0 txqueuelen:1000\r\n          RX bytes:2122949751945 (2.1 TB)  TX bytes:2129171627848 (2.1 TB)\r\n\r\neth3      Link encap:Ethernet  HWaddr f4:52:14:8c:bd:32\r\n          inet addr:12.12.11.15  Bcast:12.12.11.255  Mask:255.255.255.0\r\n          inet6 addr: fe80::f652:14ff:fe8c:bd32/64 Scope:Link\r\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\r\n          RX packets:60662288 errors:0 dropped:2492643 overruns:2492643 frame:0\r\n          TX packets:459009319 errors:0 dropped:0 overruns:0 carrier:0\r\n          collisions:0 txqueuelen:1000\r\n          RX bytes:4518366385 (4.5 GB)  TX bytes:650313430347 (650.3 GB)\r\n\r\neth2.10   Link encap:Ethernet  HWaddr f4:52:14:8c:bd:31\r\n          inet addr:10.10.10.5  Bcast:10.10.10.255  Mask:255.255.255.0\r\n          inet6 addr: fe80::f652:14ff:fe8c:bd31/64 Scope:Link\r\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\r\n          RX packets:89531729 errors:0 dropped:0 overruns:0 frame:0\r\n          TX packets:63422690 errors:0 dropped:0 overruns:0 carrier:0\r\n          collisions:0 txqueuelen:1000\r\n          RX bytes:2033861446400 (2.0 TB)  TX bytes:2039178863340 (2.0 TB)\r\n\r\n```"}