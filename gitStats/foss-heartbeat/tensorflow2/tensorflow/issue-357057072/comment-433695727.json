{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/433695727", "html_url": "https://github.com/tensorflow/tensorflow/issues/22077#issuecomment-433695727", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22077", "id": 433695727, "node_id": "MDEyOklzc3VlQ29tbWVudDQzMzY5NTcyNw==", "user": {"login": "wangshuaizs", "id": 21264093, "node_id": "MDQ6VXNlcjIxMjY0MDkz", "avatar_url": "https://avatars2.githubusercontent.com/u/21264093?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wangshuaizs", "html_url": "https://github.com/wangshuaizs", "followers_url": "https://api.github.com/users/wangshuaizs/followers", "following_url": "https://api.github.com/users/wangshuaizs/following{/other_user}", "gists_url": "https://api.github.com/users/wangshuaizs/gists{/gist_id}", "starred_url": "https://api.github.com/users/wangshuaizs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wangshuaizs/subscriptions", "organizations_url": "https://api.github.com/users/wangshuaizs/orgs", "repos_url": "https://api.github.com/users/wangshuaizs/repos", "events_url": "https://api.github.com/users/wangshuaizs/events{/privacy}", "received_events_url": "https://api.github.com/users/wangshuaizs/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-28T11:14:06Z", "updated_at": "2018-10-28T11:14:06Z", "author_association": "NONE", "body_html": "<p>hi <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=22274255\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/shamoya\">@shamoya</a> ,</p>\n<p>Unfortunately, that didn't work after using <code>export  RDMA_QP_SL=4</code> on both terminals. I didn't set SL when running ib_writer_bw, and the command and outputs are as following :<br>\nreceiver:</p>\n<pre><code>ib_write_bw -R --report_gbits --port=12500 -D 10                                                                           \n************************************\n* Waiting for client to connect... *\n************************************\n---------------------------------------------------------------------------------------\n                    RDMA_Write BW Test\n Dual-port       : OFF          Device         : mlx5_0\n Number of qps   : 1            Transport type : IB\n Connection type : RC           Using SRQ      : OFF\n CQ Moderation   : 100\n Mtu             : 1024[B]\n Link type       : Ethernet\n GID index       : 1\n Max inline data : 0[B]\n rdma_cm QPs     : ON\n Data ex. method : rdma_cm\n---------------------------------------------------------------------------------------\n Waiting for client rdma_cm QP to connect\n Please run the same command with the IB/RoCE interface IP\n---------------------------------------------------------------------------------------\n local address: LID 0000 QPN 0x025e PSN 0xb34c82\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:12:12:12:16\n remote address: LID 0000 QPN 0x025e PSN 0x7695fc\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:12:12:12:12\n---------------------------------------------------------------------------------------\n #bytes     #iterations    BW peak[Gb/sec]    BW average[Gb/sec]   MsgRate[Mpps]\n 65536      410400           0.00               35.86              0.068393\n---------------------------------------------------------------------------------------\n</code></pre>\n<p>send:</p>\n<pre><code>ib_write_bw -R --report_gbits 10.10.10.6 --port=12500 -D 10\n---------------------------------------------------------------------------------------\n                    RDMA_Write BW Test\n Dual-port       : OFF          Device         : mlx5_0\n Number of qps   : 1            Transport type : IB\n Connection type : RC           Using SRQ      : OFF\n TX depth        : 128\n CQ Moderation   : 100\n Mtu             : 1024[B]\n Link type       : Ethernet\n GID index       : 1\n Max inline data : 0[B]\n rdma_cm QPs     : ON\n Data ex. method : rdma_cm\n---------------------------------------------------------------------------------------\n local address: LID 0000 QPN 0x025e PSN 0x7695fc\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:12:12:12:12\n remote address: LID 0000 QPN 0x025e PSN 0xb34c82\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:12:12:12:16\n---------------------------------------------------------------------------------------\n #bytes     #iterations    BW peak[Gb/sec]    BW average[Gb/sec]   MsgRate[Mpps]\nConflicting CPU frequency values detected: 2899.951000 != 1200.000000. CPU Frequency is not max.\n 65536      410400           0.00               35.86              0.068393\n---------------------------------------------------------------------------------------\n</code></pre>\n<p>In this case, I did see the number of packets in priority 4 increasing.</p>", "body_text": "hi @shamoya ,\nUnfortunately, that didn't work after using export  RDMA_QP_SL=4 on both terminals. I didn't set SL when running ib_writer_bw, and the command and outputs are as following :\nreceiver:\nib_write_bw -R --report_gbits --port=12500 -D 10                                                                           \n************************************\n* Waiting for client to connect... *\n************************************\n---------------------------------------------------------------------------------------\n                    RDMA_Write BW Test\n Dual-port       : OFF          Device         : mlx5_0\n Number of qps   : 1            Transport type : IB\n Connection type : RC           Using SRQ      : OFF\n CQ Moderation   : 100\n Mtu             : 1024[B]\n Link type       : Ethernet\n GID index       : 1\n Max inline data : 0[B]\n rdma_cm QPs     : ON\n Data ex. method : rdma_cm\n---------------------------------------------------------------------------------------\n Waiting for client rdma_cm QP to connect\n Please run the same command with the IB/RoCE interface IP\n---------------------------------------------------------------------------------------\n local address: LID 0000 QPN 0x025e PSN 0xb34c82\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:12:12:12:16\n remote address: LID 0000 QPN 0x025e PSN 0x7695fc\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:12:12:12:12\n---------------------------------------------------------------------------------------\n #bytes     #iterations    BW peak[Gb/sec]    BW average[Gb/sec]   MsgRate[Mpps]\n 65536      410400           0.00               35.86              0.068393\n---------------------------------------------------------------------------------------\n\nsend:\nib_write_bw -R --report_gbits 10.10.10.6 --port=12500 -D 10\n---------------------------------------------------------------------------------------\n                    RDMA_Write BW Test\n Dual-port       : OFF          Device         : mlx5_0\n Number of qps   : 1            Transport type : IB\n Connection type : RC           Using SRQ      : OFF\n TX depth        : 128\n CQ Moderation   : 100\n Mtu             : 1024[B]\n Link type       : Ethernet\n GID index       : 1\n Max inline data : 0[B]\n rdma_cm QPs     : ON\n Data ex. method : rdma_cm\n---------------------------------------------------------------------------------------\n local address: LID 0000 QPN 0x025e PSN 0x7695fc\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:12:12:12:12\n remote address: LID 0000 QPN 0x025e PSN 0xb34c82\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:12:12:12:16\n---------------------------------------------------------------------------------------\n #bytes     #iterations    BW peak[Gb/sec]    BW average[Gb/sec]   MsgRate[Mpps]\nConflicting CPU frequency values detected: 2899.951000 != 1200.000000. CPU Frequency is not max.\n 65536      410400           0.00               35.86              0.068393\n---------------------------------------------------------------------------------------\n\nIn this case, I did see the number of packets in priority 4 increasing.", "body": "hi @shamoya ,\r\n\r\nUnfortunately, that didn't work after using ```export  RDMA_QP_SL=4``` on both terminals. I didn't set SL when running ib_writer_bw, and the command and outputs are as following :\r\nreceiver:\r\n```\r\nib_write_bw -R --report_gbits --port=12500 -D 10                                                                           \r\n************************************\r\n* Waiting for client to connect... *\r\n************************************\r\n---------------------------------------------------------------------------------------\r\n                    RDMA_Write BW Test\r\n Dual-port       : OFF          Device         : mlx5_0\r\n Number of qps   : 1            Transport type : IB\r\n Connection type : RC           Using SRQ      : OFF\r\n CQ Moderation   : 100\r\n Mtu             : 1024[B]\r\n Link type       : Ethernet\r\n GID index       : 1\r\n Max inline data : 0[B]\r\n rdma_cm QPs     : ON\r\n Data ex. method : rdma_cm\r\n---------------------------------------------------------------------------------------\r\n Waiting for client rdma_cm QP to connect\r\n Please run the same command with the IB/RoCE interface IP\r\n---------------------------------------------------------------------------------------\r\n local address: LID 0000 QPN 0x025e PSN 0xb34c82\r\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:12:12:12:16\r\n remote address: LID 0000 QPN 0x025e PSN 0x7695fc\r\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:12:12:12:12\r\n---------------------------------------------------------------------------------------\r\n #bytes     #iterations    BW peak[Gb/sec]    BW average[Gb/sec]   MsgRate[Mpps]\r\n 65536      410400           0.00               35.86              0.068393\r\n---------------------------------------------------------------------------------------\r\n```\r\nsend:\r\n```\r\nib_write_bw -R --report_gbits 10.10.10.6 --port=12500 -D 10\r\n---------------------------------------------------------------------------------------\r\n                    RDMA_Write BW Test\r\n Dual-port       : OFF          Device         : mlx5_0\r\n Number of qps   : 1            Transport type : IB\r\n Connection type : RC           Using SRQ      : OFF\r\n TX depth        : 128\r\n CQ Moderation   : 100\r\n Mtu             : 1024[B]\r\n Link type       : Ethernet\r\n GID index       : 1\r\n Max inline data : 0[B]\r\n rdma_cm QPs     : ON\r\n Data ex. method : rdma_cm\r\n---------------------------------------------------------------------------------------\r\n local address: LID 0000 QPN 0x025e PSN 0x7695fc\r\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:12:12:12:12\r\n remote address: LID 0000 QPN 0x025e PSN 0xb34c82\r\n GID: 00:00:00:00:00:00:00:00:00:00:255:255:12:12:12:16\r\n---------------------------------------------------------------------------------------\r\n #bytes     #iterations    BW peak[Gb/sec]    BW average[Gb/sec]   MsgRate[Mpps]\r\nConflicting CPU frequency values detected: 2899.951000 != 1200.000000. CPU Frequency is not max.\r\n 65536      410400           0.00               35.86              0.068393\r\n---------------------------------------------------------------------------------------\r\n```\r\nIn this case, I did see the number of packets in priority 4 increasing."}