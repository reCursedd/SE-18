{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/433690933", "html_url": "https://github.com/tensorflow/tensorflow/issues/22077#issuecomment-433690933", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22077", "id": 433690933, "node_id": "MDEyOklzc3VlQ29tbWVudDQzMzY5MDkzMw==", "user": {"login": "wangshuaizs", "id": 21264093, "node_id": "MDQ6VXNlcjIxMjY0MDkz", "avatar_url": "https://avatars2.githubusercontent.com/u/21264093?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wangshuaizs", "html_url": "https://github.com/wangshuaizs", "followers_url": "https://api.github.com/users/wangshuaizs/followers", "following_url": "https://api.github.com/users/wangshuaizs/following{/other_user}", "gists_url": "https://api.github.com/users/wangshuaizs/gists{/gist_id}", "starred_url": "https://api.github.com/users/wangshuaizs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wangshuaizs/subscriptions", "organizations_url": "https://api.github.com/users/wangshuaizs/orgs", "repos_url": "https://api.github.com/users/wangshuaizs/repos", "events_url": "https://api.github.com/users/wangshuaizs/events{/privacy}", "received_events_url": "https://api.github.com/users/wangshuaizs/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-28T09:54:52Z", "updated_at": "2018-10-28T09:54:52Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=22274255\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/shamoya\">@shamoya</a></p>\n<p>I tried to set relative env variables, including RDMA_DEVICE, RDMA_DEVICE_PORT, RDMA_GID_INDEX. Here are the outputs of two machines  (another two machines are used this time, and another ConnectX-5 NIC is added on each machine):<br>\nps:</p>\n<pre><code>DEV     PORT    INDEX   GID                                     IPv4            VER     DEV\n---     ----    -----   ---                                     ------------    ---     ---\nmlx4_0  1       0       fe80:0000:0000:0000:0202:c9ff:feb3:8421                 v1      eth2\nmlx4_0  1       1       0000:0000:0000:0000:0000:ffff:0c0c:0c0c 12.12.12.12     v1      eth2\nmlx4_0  1       2       0000:0000:0000:0000:0000:ffff:0a0a:0a02 10.10.10.2      v1      eth2.10\nmlx4_0  2       0       fe80:0000:0000:0000:0202:c9ff:feb3:8422                 v1      eth3\nmlx4_0  2       1       0000:0000:0000:0000:0000:ffff:0c0c:0a0c 12.12.10.12     v1      eth3\nmlx5_0  1       0       fe80:0000:0000:0000:268a:07ff:fe8f:9bbc                 v1      eth4\nmlx5_0  1       1       fe80:0000:0000:0000:268a:07ff:fe8f:9bbc                 v2      eth4\nmlx5_0  1       2       0000:0000:0000:0000:0000:ffff:0c0c:0b0c 12.12.11.12     v1      eth4\nmlx5_0  1       3       0000:0000:0000:0000:0000:ffff:0c0c:0b0c 12.12.11.12     v2      eth4\nn_gids_found=9\n</code></pre>\n<p>and worker:</p>\n<pre><code>DEV     PORT    INDEX   GID                                     IPv4            VER     DEV\n---     ----    -----   ---                                     ------------    ---     ---\nmlx4_0  1       0       fe80:0000:0000:0000:0202:c9ff:feb3:6ca1                 v1      eth2\nmlx4_0  1       1       0000:0000:0000:0000:0000:ffff:0c0c:0c10 12.12.12.16     v1      eth2\nmlx4_0  1       2       0000:0000:0000:0000:0000:ffff:0a0a:0a06 10.10.10.6      v1      eth2.10\nmlx4_0  2       0       fe80:0000:0000:0000:0202:c9ff:feb3:6ca2                 v1      eth3\nmlx4_0  2       1       0000:0000:0000:0000:0000:ffff:0c0c:0a10 12.12.10.16     v1      eth3\nmlx5_0  1       0       fe80:0000:0000:0000:268a:07ff:fe8f:9bd8                 v1      eth4\nmlx5_0  1       1       fe80:0000:0000:0000:268a:07ff:fe8f:9bd8                 v2      eth4\nmlx5_0  1       2       0000:0000:0000:0000:0000:ffff:0c0c:0b10 12.12.11.16     v1      eth4\nmlx5_0  1       3       0000:0000:0000:0000:0000:ffff:0c0c:0b10 12.12.11.16     v2      eth4\nn_gids_found=9\n</code></pre>\n<p>I set env variables as following:</p>\n<pre><code>export RDMA_DEVICE=\"mlx4_0\"\nexport RDMA_DEVICE_PORT=1\nexport RDMA_GID_INDEX=0/1/2 (respectively)\n</code></pre>\n<p>However, when RDMA_GID_INDEX is set as 0/1, the results are as before; when it is set as 2, i.e., VLAN, these 2 machines can communicate with each other, but I found no packets in prio_4 on end host, using <code>ethtool -S eth2 | grep prio_4 </code>. There seems something wrong, because I can find packets in prio_4 when using <code>ib_write_bw</code>.</p>", "body_text": "@shamoya\nI tried to set relative env variables, including RDMA_DEVICE, RDMA_DEVICE_PORT, RDMA_GID_INDEX. Here are the outputs of two machines  (another two machines are used this time, and another ConnectX-5 NIC is added on each machine):\nps:\nDEV     PORT    INDEX   GID                                     IPv4            VER     DEV\n---     ----    -----   ---                                     ------------    ---     ---\nmlx4_0  1       0       fe80:0000:0000:0000:0202:c9ff:feb3:8421                 v1      eth2\nmlx4_0  1       1       0000:0000:0000:0000:0000:ffff:0c0c:0c0c 12.12.12.12     v1      eth2\nmlx4_0  1       2       0000:0000:0000:0000:0000:ffff:0a0a:0a02 10.10.10.2      v1      eth2.10\nmlx4_0  2       0       fe80:0000:0000:0000:0202:c9ff:feb3:8422                 v1      eth3\nmlx4_0  2       1       0000:0000:0000:0000:0000:ffff:0c0c:0a0c 12.12.10.12     v1      eth3\nmlx5_0  1       0       fe80:0000:0000:0000:268a:07ff:fe8f:9bbc                 v1      eth4\nmlx5_0  1       1       fe80:0000:0000:0000:268a:07ff:fe8f:9bbc                 v2      eth4\nmlx5_0  1       2       0000:0000:0000:0000:0000:ffff:0c0c:0b0c 12.12.11.12     v1      eth4\nmlx5_0  1       3       0000:0000:0000:0000:0000:ffff:0c0c:0b0c 12.12.11.12     v2      eth4\nn_gids_found=9\n\nand worker:\nDEV     PORT    INDEX   GID                                     IPv4            VER     DEV\n---     ----    -----   ---                                     ------------    ---     ---\nmlx4_0  1       0       fe80:0000:0000:0000:0202:c9ff:feb3:6ca1                 v1      eth2\nmlx4_0  1       1       0000:0000:0000:0000:0000:ffff:0c0c:0c10 12.12.12.16     v1      eth2\nmlx4_0  1       2       0000:0000:0000:0000:0000:ffff:0a0a:0a06 10.10.10.6      v1      eth2.10\nmlx4_0  2       0       fe80:0000:0000:0000:0202:c9ff:feb3:6ca2                 v1      eth3\nmlx4_0  2       1       0000:0000:0000:0000:0000:ffff:0c0c:0a10 12.12.10.16     v1      eth3\nmlx5_0  1       0       fe80:0000:0000:0000:268a:07ff:fe8f:9bd8                 v1      eth4\nmlx5_0  1       1       fe80:0000:0000:0000:268a:07ff:fe8f:9bd8                 v2      eth4\nmlx5_0  1       2       0000:0000:0000:0000:0000:ffff:0c0c:0b10 12.12.11.16     v1      eth4\nmlx5_0  1       3       0000:0000:0000:0000:0000:ffff:0c0c:0b10 12.12.11.16     v2      eth4\nn_gids_found=9\n\nI set env variables as following:\nexport RDMA_DEVICE=\"mlx4_0\"\nexport RDMA_DEVICE_PORT=1\nexport RDMA_GID_INDEX=0/1/2 (respectively)\n\nHowever, when RDMA_GID_INDEX is set as 0/1, the results are as before; when it is set as 2, i.e., VLAN, these 2 machines can communicate with each other, but I found no packets in prio_4 on end host, using ethtool -S eth2 | grep prio_4 . There seems something wrong, because I can find packets in prio_4 when using ib_write_bw.", "body": "@shamoya \r\n\r\nI tried to set relative env variables, including RDMA_DEVICE, RDMA_DEVICE_PORT, RDMA_GID_INDEX. Here are the outputs of two machines  (another two machines are used this time, and another ConnectX-5 NIC is added on each machine):\r\nps:\r\n```\r\nDEV     PORT    INDEX   GID                                     IPv4            VER     DEV\r\n---     ----    -----   ---                                     ------------    ---     ---\r\nmlx4_0  1       0       fe80:0000:0000:0000:0202:c9ff:feb3:8421                 v1      eth2\r\nmlx4_0  1       1       0000:0000:0000:0000:0000:ffff:0c0c:0c0c 12.12.12.12     v1      eth2\r\nmlx4_0  1       2       0000:0000:0000:0000:0000:ffff:0a0a:0a02 10.10.10.2      v1      eth2.10\r\nmlx4_0  2       0       fe80:0000:0000:0000:0202:c9ff:feb3:8422                 v1      eth3\r\nmlx4_0  2       1       0000:0000:0000:0000:0000:ffff:0c0c:0a0c 12.12.10.12     v1      eth3\r\nmlx5_0  1       0       fe80:0000:0000:0000:268a:07ff:fe8f:9bbc                 v1      eth4\r\nmlx5_0  1       1       fe80:0000:0000:0000:268a:07ff:fe8f:9bbc                 v2      eth4\r\nmlx5_0  1       2       0000:0000:0000:0000:0000:ffff:0c0c:0b0c 12.12.11.12     v1      eth4\r\nmlx5_0  1       3       0000:0000:0000:0000:0000:ffff:0c0c:0b0c 12.12.11.12     v2      eth4\r\nn_gids_found=9\r\n```\r\nand worker:\r\n```\r\nDEV     PORT    INDEX   GID                                     IPv4            VER     DEV\r\n---     ----    -----   ---                                     ------------    ---     ---\r\nmlx4_0  1       0       fe80:0000:0000:0000:0202:c9ff:feb3:6ca1                 v1      eth2\r\nmlx4_0  1       1       0000:0000:0000:0000:0000:ffff:0c0c:0c10 12.12.12.16     v1      eth2\r\nmlx4_0  1       2       0000:0000:0000:0000:0000:ffff:0a0a:0a06 10.10.10.6      v1      eth2.10\r\nmlx4_0  2       0       fe80:0000:0000:0000:0202:c9ff:feb3:6ca2                 v1      eth3\r\nmlx4_0  2       1       0000:0000:0000:0000:0000:ffff:0c0c:0a10 12.12.10.16     v1      eth3\r\nmlx5_0  1       0       fe80:0000:0000:0000:268a:07ff:fe8f:9bd8                 v1      eth4\r\nmlx5_0  1       1       fe80:0000:0000:0000:268a:07ff:fe8f:9bd8                 v2      eth4\r\nmlx5_0  1       2       0000:0000:0000:0000:0000:ffff:0c0c:0b10 12.12.11.16     v1      eth4\r\nmlx5_0  1       3       0000:0000:0000:0000:0000:ffff:0c0c:0b10 12.12.11.16     v2      eth4\r\nn_gids_found=9\r\n```\r\nI set env variables as following:\r\n```\r\nexport RDMA_DEVICE=\"mlx4_0\"\r\nexport RDMA_DEVICE_PORT=1\r\nexport RDMA_GID_INDEX=0/1/2 (respectively)\r\n```\r\n\r\nHowever, when RDMA_GID_INDEX is set as 0/1, the results are as before; when it is set as 2, i.e., VLAN, these 2 machines can communicate with each other, but I found no packets in prio_4 on end host, using ```ethtool -S eth2 | grep prio_4 ```. There seems something wrong, because I can find packets in prio_4 when using ```ib_write_bw```."}