{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2637", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2637/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2637/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2637/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/2637", "id": 158316415, "node_id": "MDU6SXNzdWUxNTgzMTY0MTU=", "number": 2637, "title": "Possible way to apply gradients using tf.identity()?", "user": {"login": "myme5261314", "id": 1814831, "node_id": "MDQ6VXNlcjE4MTQ4MzE=", "avatar_url": "https://avatars3.githubusercontent.com/u/1814831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/myme5261314", "html_url": "https://github.com/myme5261314", "followers_url": "https://api.github.com/users/myme5261314/followers", "following_url": "https://api.github.com/users/myme5261314/following{/other_user}", "gists_url": "https://api.github.com/users/myme5261314/gists{/gist_id}", "starred_url": "https://api.github.com/users/myme5261314/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/myme5261314/subscriptions", "organizations_url": "https://api.github.com/users/myme5261314/orgs", "repos_url": "https://api.github.com/users/myme5261314/repos", "events_url": "https://api.github.com/users/myme5261314/events{/privacy}", "received_events_url": "https://api.github.com/users/myme5261314/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-06-03T08:28:59Z", "updated_at": "2016-06-03T14:10:11Z", "closed_at": "2016-06-03T14:10:10Z", "author_association": "NONE", "body_html": "<h3>Environment info</h3>\n<p>Operating System: Ubuntu 14.04</p>\n<p>Installed version of CUDA and cuDNN: 7.5 and R4</p>\n<p>If installed from binary pip package, provide:</p>\n<ol>\n<li>Which pip package you installed.</li>\n<li>The output from python -c \"import tensorflow; print(tensorflow.<strong>version</strong>)\".</li>\n</ol>\n<p>If installed from sources, provide the commit hash: <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/79174afa30046ecdc437b531812f2cb41a32695e/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/79174afa30046ecdc437b531812f2cb41a32695e\"><tt>79174af</tt></a></p>\n<h3>Steps to reproduce</h3>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\na <span class=\"pl-k\">=</span> tf.constant(<span class=\"pl-c1\">1</span>.)\nb <span class=\"pl-k\">=</span> tf.Variable(<span class=\"pl-c1\">2</span>.)\nc <span class=\"pl-k\">=</span> a <span class=\"pl-k\">*</span> b\ngrad_symbolic <span class=\"pl-k\">=</span> tf.gradients(c, tf.trainable_variables())\ngrad_vars <span class=\"pl-k\">=</span> [tf.Variable(tf.zeros_like(_)) <span class=\"pl-k\">for</span> _ <span class=\"pl-k\">in</span> tf.trainable_variables()]\ngrad_zero_ops <span class=\"pl-k\">=</span> [_.assign(tf.zeros_like(_)) <span class=\"pl-k\">for</span> _ <span class=\"pl-k\">in</span> grad_vars]\ngrad_accum_ops <span class=\"pl-k\">=</span> [grad_vars[i].assign_add(grad_symbolic[i])\n                  <span class=\"pl-k\">for</span> i <span class=\"pl-k\">in</span> <span class=\"pl-v\">xrange</span>(<span class=\"pl-c1\">len</span>(grad_vars))]\nopt <span class=\"pl-k\">=</span> tf.train.GradientDescentOptimizer(<span class=\"pl-c1\">1</span>.)\ntrain_op <span class=\"pl-k\">=</span> opt.apply_gradients(<span class=\"pl-c1\">zip</span>(\n    [tf.identity(_) <span class=\"pl-k\">for</span> _ <span class=\"pl-k\">in</span> grad_vars], tf.trainable_variables()))\nsess <span class=\"pl-k\">=</span> tf.Session()\nsess.run(tf.initialize_all_variables()) <span class=\"pl-c\"><span class=\"pl-c\">#</span> This will cause error.</span>\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> This will run successfully.</span>\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> for _ in tf.all_variables():</span>\n<span class=\"pl-c\"><span class=\"pl-c\">#</span>     sess.run(tf.initialize_variables([_]))</span></pre></div>\n<h3>What have you tried?</h3>\n<ol>\n<li><a href=\"http://stackoverflow.com/questions/35656643/tf-initialize-variables-inconvenience-failedpreconditionerror-tensorflow\" rel=\"nofollow\">workaround</a></li>\n<li>But in my real project code, the program stucks into the <code>variable initialization</code> for too many minutes if I initialize variables one by one.</li>\n</ol>\n<h3>Logs or other output that would be helpful</h3>\n<p>(If logs are large, please upload as attachment).</p>\n<pre><code>Traceback (most recent call last):\n  File \"test_identity_gradient_apply.py\", line 26, in &lt;module&gt;\n    sess.run(tf.initialize_all_variables()) # This will cause error.\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 333, in run\n    run_metadata_ptr)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 573, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 648, in _do_run\n    target_list, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 668, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors.FailedPreconditionError: Attempting to use uninitialized value Variable\n     [[Node: Variable/read = Identity[T=DT_FLOAT, _class=[\"loc:@Variable\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](Variable)]]\nCaused by op u'Variable/read', defined at:\n  File \"test_identity_gradient_apply.py\", line 15, in &lt;module&gt;\n    b = tf.Variable(2.)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 211, in __init__\n    dtype=dtype)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 319, in _init_from_args\n    self._snapshot = array_ops.identity(self._variable, name=\"read\")\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_array_ops.py\", line 788, in identity\n    result = _op_def_lib.apply_op(\"Identity\", input=input, name=name)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/op_def_library.py\", line 704, in apply_op\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2249, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1224, in __init__\n    self._traceback = _extract_stack()\n\n</code></pre>", "body_text": "Environment info\nOperating System: Ubuntu 14.04\nInstalled version of CUDA and cuDNN: 7.5 and R4\nIf installed from binary pip package, provide:\n\nWhich pip package you installed.\nThe output from python -c \"import tensorflow; print(tensorflow.version)\".\n\nIf installed from sources, provide the commit hash: 79174af\nSteps to reproduce\nimport tensorflow as tf\n\na = tf.constant(1.)\nb = tf.Variable(2.)\nc = a * b\ngrad_symbolic = tf.gradients(c, tf.trainable_variables())\ngrad_vars = [tf.Variable(tf.zeros_like(_)) for _ in tf.trainable_variables()]\ngrad_zero_ops = [_.assign(tf.zeros_like(_)) for _ in grad_vars]\ngrad_accum_ops = [grad_vars[i].assign_add(grad_symbolic[i])\n                  for i in xrange(len(grad_vars))]\nopt = tf.train.GradientDescentOptimizer(1.)\ntrain_op = opt.apply_gradients(zip(\n    [tf.identity(_) for _ in grad_vars], tf.trainable_variables()))\nsess = tf.Session()\nsess.run(tf.initialize_all_variables()) # This will cause error.\n# This will run successfully.\n# for _ in tf.all_variables():\n#     sess.run(tf.initialize_variables([_]))\nWhat have you tried?\n\nworkaround\nBut in my real project code, the program stucks into the variable initialization for too many minutes if I initialize variables one by one.\n\nLogs or other output that would be helpful\n(If logs are large, please upload as attachment).\nTraceback (most recent call last):\n  File \"test_identity_gradient_apply.py\", line 26, in <module>\n    sess.run(tf.initialize_all_variables()) # This will cause error.\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 333, in run\n    run_metadata_ptr)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 573, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 648, in _do_run\n    target_list, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 668, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors.FailedPreconditionError: Attempting to use uninitialized value Variable\n     [[Node: Variable/read = Identity[T=DT_FLOAT, _class=[\"loc:@Variable\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](Variable)]]\nCaused by op u'Variable/read', defined at:\n  File \"test_identity_gradient_apply.py\", line 15, in <module>\n    b = tf.Variable(2.)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 211, in __init__\n    dtype=dtype)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 319, in _init_from_args\n    self._snapshot = array_ops.identity(self._variable, name=\"read\")\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_array_ops.py\", line 788, in identity\n    result = _op_def_lib.apply_op(\"Identity\", input=input, name=name)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/op_def_library.py\", line 704, in apply_op\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2249, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1224, in __init__\n    self._traceback = _extract_stack()", "body": "### Environment info\n\nOperating System: Ubuntu 14.04\n\nInstalled version of CUDA and cuDNN: 7.5 and R4\n\nIf installed from binary pip package, provide:\n1. Which pip package you installed.\n2. The output from python -c \"import tensorflow; print(tensorflow.**version**)\".\n\nIf installed from sources, provide the commit hash: 79174afa30046ecdc437b531812f2cb41a32695e\n### Steps to reproduce\n\n``` python\nimport tensorflow as tf\n\na = tf.constant(1.)\nb = tf.Variable(2.)\nc = a * b\ngrad_symbolic = tf.gradients(c, tf.trainable_variables())\ngrad_vars = [tf.Variable(tf.zeros_like(_)) for _ in tf.trainable_variables()]\ngrad_zero_ops = [_.assign(tf.zeros_like(_)) for _ in grad_vars]\ngrad_accum_ops = [grad_vars[i].assign_add(grad_symbolic[i])\n                  for i in xrange(len(grad_vars))]\nopt = tf.train.GradientDescentOptimizer(1.)\ntrain_op = opt.apply_gradients(zip(\n    [tf.identity(_) for _ in grad_vars], tf.trainable_variables()))\nsess = tf.Session()\nsess.run(tf.initialize_all_variables()) # This will cause error.\n# This will run successfully.\n# for _ in tf.all_variables():\n#     sess.run(tf.initialize_variables([_]))\n```\n### What have you tried?\n1. [workaround](http://stackoverflow.com/questions/35656643/tf-initialize-variables-inconvenience-failedpreconditionerror-tensorflow)\n2. But in my real project code, the program stucks into the `variable initialization` for too many minutes if I initialize variables one by one.\n### Logs or other output that would be helpful\n\n(If logs are large, please upload as attachment).\n\n```\nTraceback (most recent call last):\n  File \"test_identity_gradient_apply.py\", line 26, in <module>\n    sess.run(tf.initialize_all_variables()) # This will cause error.\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 333, in run\n    run_metadata_ptr)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 573, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 648, in _do_run\n    target_list, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 668, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors.FailedPreconditionError: Attempting to use uninitialized value Variable\n     [[Node: Variable/read = Identity[T=DT_FLOAT, _class=[\"loc:@Variable\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](Variable)]]\nCaused by op u'Variable/read', defined at:\n  File \"test_identity_gradient_apply.py\", line 15, in <module>\n    b = tf.Variable(2.)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 211, in __init__\n    dtype=dtype)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 319, in _init_from_args\n    self._snapshot = array_ops.identity(self._variable, name=\"read\")\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_array_ops.py\", line 788, in identity\n    result = _op_def_lib.apply_op(\"Identity\", input=input, name=name)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/op_def_library.py\", line 704, in apply_op\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2249, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1224, in __init__\n    self._traceback = _extract_stack()\n\n```\n"}