{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9262", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9262/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9262/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9262/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/9262", "id": 222090263, "node_id": "MDU6SXNzdWUyMjIwOTAyNjM=", "number": 9262, "title": "Estimator numpy_input_fn doesn't work when reading input with pytables", "user": {"login": "StarvingMarvin", "id": 56292, "node_id": "MDQ6VXNlcjU2Mjky", "avatar_url": "https://avatars3.githubusercontent.com/u/56292?v=4", "gravatar_id": "", "url": "https://api.github.com/users/StarvingMarvin", "html_url": "https://github.com/StarvingMarvin", "followers_url": "https://api.github.com/users/StarvingMarvin/followers", "following_url": "https://api.github.com/users/StarvingMarvin/following{/other_user}", "gists_url": "https://api.github.com/users/StarvingMarvin/gists{/gist_id}", "starred_url": "https://api.github.com/users/StarvingMarvin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/StarvingMarvin/subscriptions", "organizations_url": "https://api.github.com/users/StarvingMarvin/orgs", "repos_url": "https://api.github.com/users/StarvingMarvin/repos", "events_url": "https://api.github.com/users/StarvingMarvin/events{/privacy}", "received_events_url": "https://api.github.com/users/StarvingMarvin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "martinwicke", "id": 577277, "node_id": "MDQ6VXNlcjU3NzI3Nw==", "avatar_url": "https://avatars2.githubusercontent.com/u/577277?v=4", "gravatar_id": "", "url": "https://api.github.com/users/martinwicke", "html_url": "https://github.com/martinwicke", "followers_url": "https://api.github.com/users/martinwicke/followers", "following_url": "https://api.github.com/users/martinwicke/following{/other_user}", "gists_url": "https://api.github.com/users/martinwicke/gists{/gist_id}", "starred_url": "https://api.github.com/users/martinwicke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/martinwicke/subscriptions", "organizations_url": "https://api.github.com/users/martinwicke/orgs", "repos_url": "https://api.github.com/users/martinwicke/repos", "events_url": "https://api.github.com/users/martinwicke/events{/privacy}", "received_events_url": "https://api.github.com/users/martinwicke/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "martinwicke", "id": 577277, "node_id": "MDQ6VXNlcjU3NzI3Nw==", "avatar_url": "https://avatars2.githubusercontent.com/u/577277?v=4", "gravatar_id": "", "url": "https://api.github.com/users/martinwicke", "html_url": "https://github.com/martinwicke", "followers_url": "https://api.github.com/users/martinwicke/followers", "following_url": "https://api.github.com/users/martinwicke/following{/other_user}", "gists_url": "https://api.github.com/users/martinwicke/gists{/gist_id}", "starred_url": "https://api.github.com/users/martinwicke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/martinwicke/subscriptions", "organizations_url": "https://api.github.com/users/martinwicke/orgs", "repos_url": "https://api.github.com/users/martinwicke/repos", "events_url": "https://api.github.com/users/martinwicke/events{/privacy}", "received_events_url": "https://api.github.com/users/martinwicke/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2017-04-17T08:28:29Z", "updated_at": "2017-04-18T16:11:00Z", "closed_at": "2017-04-18T16:11:00Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: Relatively straightforward attempt at using estimator flow with <code>input_fn</code></li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Gentoo Linux</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: source</li>\n<li><strong>TensorFlow version (use command below)</strong>: b'v1.0.0-2171-gbaa85cb' 1.0.1</li>\n<li><strong>Bazel version (if compiling from source)</strong>: 0.4.4-</li>\n<li><strong>CUDA/cuDNN version</strong>: 8.0.61</li>\n<li><strong>GPU model and memory</strong>: GTX 970 4GB</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<p>Other stuff: Python 3.4, pytables 3.3.0, numpy 1.12.1, hdf5-1.8.18</p>\n<h3>Describe the problem</h3>\n<p>I have an issue when reading multidimensional arrays from hdf5 file using pytables. I can fix the issue for myself locally by changing <code>_OrderedDictNumpyFeedFn</code> class (line 173 in my version) from</p>\n<div class=\"highlight highlight-source-python\"><pre> column[integer_indexes]</pre></div>\n<p>to</p>\n<div class=\"highlight highlight-source-python\"><pre>np.take(column, integer_indexes, <span class=\"pl-v\">axis</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">0</span>)</pre></div>\n<h3>Source code / logs</h3>\n<p>Relevant bit of code:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">def</span> <span class=\"pl-en\">make_input_fn</span>(<span class=\"pl-smi\">data</span>, <span class=\"pl-smi\">batch_size</span>):\n    input_features <span class=\"pl-k\">=</span> {node.name: node <span class=\"pl-k\">for</span> node <span class=\"pl-k\">in</span> data.get_node(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>/x<span class=\"pl-pds\">'</span></span>)}\n    ys <span class=\"pl-k\">=</span> data.get_node(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>/y<span class=\"pl-pds\">'</span></span>)\n    <span class=\"pl-k\">return</span> numpy_input_fn(input_features, ys, <span class=\"pl-v\">batch_size</span><span class=\"pl-k\">=</span>batch_size, <span class=\"pl-v\">num_epochs</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">5</span>, <span class=\"pl-v\">shuffle</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">False</span>, <span class=\"pl-v\">num_threads</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">1</span>)\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">main</span>(<span class=\"pl-smi\">unused_argv</span>):\n    model_fn <span class=\"pl-k\">=</span> make_train_model(feat)\n    config <span class=\"pl-k\">=</span> learn.RunConfig(<span class=\"pl-v\">save_checkpoints_secs</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">60</span>)\n    est <span class=\"pl-k\">=</span> learn.Estimator(\n        <span class=\"pl-v\">model_fn</span><span class=\"pl-k\">=</span>model_fn, <span class=\"pl-v\">model_dir</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>data/tf/try1<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-v\">config</span><span class=\"pl-k\">=</span>config\n    )\n    training_data <span class=\"pl-k\">=</span> tables.open_file(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>data/hdf5/training.h5<span class=\"pl-pds\">'</span></span>)\n    train_in <span class=\"pl-k\">=</span> make_input_fn(training_data, <span class=\"pl-c1\">256</span>)\n    est.fit(\n        <span class=\"pl-v\">input_fn</span><span class=\"pl-k\">=</span>train_in,\n        <span class=\"pl-v\">steps</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">100</span>\n    )\n    training_data.close()</pre></div>\n<p>Error I get:</p>\n<pre><code>INFO:tensorflow:Using config: {'_is_chief': True, '_keep_checkpoint_max': 5, '_save_checkpoints_secs': 60, '_environment': 'local', '_num_ps_replicas': 0, '_master': '', '_task_type': None, '_tf_config': gpu_options {\n  per_process_gpu_memory_fraction: 1.0\n}\n, '_num_worker_replicas': 0, '_cluster_spec': &lt;tensorflow.python.training.server_lib.ClusterSpec object at 0x7ff377eaf550&gt;, '_keep_checkpoint_every_n_hours': 10000, '_save_checkpoints_steps': None, '_evaluation_master': '', '_model_dir': None, '_save_summary_steps': 100, '_tf_random_seed': None, '_task_id': 0}\nINFO:tensorflow:Create CheckpointSaverHook.\n2017-04-17 10:05:38.231511: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:901] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2017-04-17 10:05:38.231863: I tensorflow/core/common_runtime/gpu/gpu_device.cc:887] Found device 0 with properties: \nname: GeForce GTX 970\nmajor: 5 minor: 2 memoryClockRate (GHz) 1.4305\npciBusID 0000:01:00.0\nTotal memory: 3.94GiB\nFree memory: 3.45GiB\n2017-04-17 10:05:38.232016: I tensorflow/core/common_runtime/gpu/gpu_device.cc:908] DMA: 0 \n2017-04-17 10:05:38.232048: I tensorflow/core/common_runtime/gpu/gpu_device.cc:918] 0:   Y \n2017-04-17 10:05:38.232081: I tensorflow/core/common_runtime/gpu/gpu_device.cc:977] Creating TensorFlow device (/gpu:0) -&gt; (device: 0, name: GeForce GTX 970, pci bus id: 0000:01:00.0)\nINFO:tensorflow:Restoring parameters from data/tf/try1/model.ckpt-4\nINFO:tensorflow:Error reported to Coordinator: &lt;class 'ValueError'&gt;, operands could not be broadcast together with shapes (256,) (4,) \nINFO:tensorflow:Saving checkpoints for 4 into data/tf/try1/model.ckpt.\nTraceback (most recent call last):\n  File \".../venv/lib/python3.4/site-packages/tables/array.py\", line 651, in __getitem__\n    startl, stopl, stepl, shape = self._interpret_indexing(key)\n  File \".../venv/lib/python3.4/site-packages/tables/array.py\", line 408, in _interpret_indexing\n    raise TypeError(\"Non-valid index or slice: %s\" % key)\nTypeError: Non-valid index or slice: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255]\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/usr/lib64/python3.4/runpy.py\", line 170, in _run_module_as_main\n    \"__main__\", mod_spec)\n  File \"/usr/lib64/python3.4/runpy.py\", line 85, in _run_code\n    exec(code, run_globals)\n  File \"/zfs_data/Sources/betahex/betahex/training/supervised.py\", line 106, in &lt;module&gt;\n    tf.app.run()\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/platform/app.py\", line 48, in run\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\n  File \"/zfs_data/Sources/betahex/betahex/training/supervised.py\", line 99, in main\n    steps=50\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/util/deprecation.py\", line 281, in new_func\n    return func(*args, **kwargs)\n  File \".../venvs/default/lib/python3.4/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 429, in fit\n    loss = self._train_model(input_fn=input_fn, hooks=hooks)\n  File \".../venv/lib/python3.4/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 977, in _train_model\n    _, loss = mon_sess.run([model_fn_ops.train_op, model_fn_ops.loss])\n  File .../venv/lib/python3.4/site-packages/tensorflow/python/training/monitored_session.py\", line 500, in __exit__\n    self._close_internal(exception_type)\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/training/monitored_session.py\", line 535, in _close_internal\n    self._sess.close()\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/training/monitored_session.py\", line 769, in close\n    self._sess.close()\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/training/monitored_session.py\", line 866, in close\n    ignore_live_threads=True)\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/training/coordinator.py\", line 389, in join\n    six.reraise(*self._exc_info_to_raise)\n  File \"/usr/lib/python3.4/site-packages/six.py\", line 686, in reraise\n    raise value\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/estimator/inputs/queues/feeding_queue_runner.py\", line 93, in _run\n    feed_dict = None if feed_fn is None else feed_fn()\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/estimator/inputs/queues/feeding_functions.py\", line 175, in __call__\n    for column in self._ordered_dict_of_arrays.values()\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/estimator/inputs/queues/feeding_functions.py\", line 175, in &lt;listcomp&gt;\n    for column in self._ordered_dict_of_arrays.values()\n  File \".../venv/lib/python3.4/site-packages/tables/array.py\", line 656, in __getitem__\n    coords = self._point_selection(key)\n  File \".../venv/lib/python3.4/site-packages/tables/leaf.py\", line 561, in _point_selection\n    coords[idx] = (coords + self.shape)[idx]\nValueError: operands could not be broadcast together with shapes (256,) (4,) \nClosing remaining open files:data/hdf5/training.h5...done\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Relatively straightforward attempt at using estimator flow with input_fn\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Gentoo Linux\nTensorFlow installed from (source or binary): source\nTensorFlow version (use command below): b'v1.0.0-2171-gbaa85cb' 1.0.1\nBazel version (if compiling from source): 0.4.4-\nCUDA/cuDNN version: 8.0.61\nGPU model and memory: GTX 970 4GB\nExact command to reproduce:\n\nOther stuff: Python 3.4, pytables 3.3.0, numpy 1.12.1, hdf5-1.8.18\nDescribe the problem\nI have an issue when reading multidimensional arrays from hdf5 file using pytables. I can fix the issue for myself locally by changing _OrderedDictNumpyFeedFn class (line 173 in my version) from\n column[integer_indexes]\nto\nnp.take(column, integer_indexes, axis=0)\nSource code / logs\nRelevant bit of code:\ndef make_input_fn(data, batch_size):\n    input_features = {node.name: node for node in data.get_node('/x')}\n    ys = data.get_node('/y')\n    return numpy_input_fn(input_features, ys, batch_size=batch_size, num_epochs=5, shuffle=False, num_threads=1)\n\ndef main(unused_argv):\n    model_fn = make_train_model(feat)\n    config = learn.RunConfig(save_checkpoints_secs=60)\n    est = learn.Estimator(\n        model_fn=model_fn, model_dir=\"data/tf/try1\", config=config\n    )\n    training_data = tables.open_file('data/hdf5/training.h5')\n    train_in = make_input_fn(training_data, 256)\n    est.fit(\n        input_fn=train_in,\n        steps=100\n    )\n    training_data.close()\nError I get:\nINFO:tensorflow:Using config: {'_is_chief': True, '_keep_checkpoint_max': 5, '_save_checkpoints_secs': 60, '_environment': 'local', '_num_ps_replicas': 0, '_master': '', '_task_type': None, '_tf_config': gpu_options {\n  per_process_gpu_memory_fraction: 1.0\n}\n, '_num_worker_replicas': 0, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7ff377eaf550>, '_keep_checkpoint_every_n_hours': 10000, '_save_checkpoints_steps': None, '_evaluation_master': '', '_model_dir': None, '_save_summary_steps': 100, '_tf_random_seed': None, '_task_id': 0}\nINFO:tensorflow:Create CheckpointSaverHook.\n2017-04-17 10:05:38.231511: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:901] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2017-04-17 10:05:38.231863: I tensorflow/core/common_runtime/gpu/gpu_device.cc:887] Found device 0 with properties: \nname: GeForce GTX 970\nmajor: 5 minor: 2 memoryClockRate (GHz) 1.4305\npciBusID 0000:01:00.0\nTotal memory: 3.94GiB\nFree memory: 3.45GiB\n2017-04-17 10:05:38.232016: I tensorflow/core/common_runtime/gpu/gpu_device.cc:908] DMA: 0 \n2017-04-17 10:05:38.232048: I tensorflow/core/common_runtime/gpu/gpu_device.cc:918] 0:   Y \n2017-04-17 10:05:38.232081: I tensorflow/core/common_runtime/gpu/gpu_device.cc:977] Creating TensorFlow device (/gpu:0) -> (device: 0, name: GeForce GTX 970, pci bus id: 0000:01:00.0)\nINFO:tensorflow:Restoring parameters from data/tf/try1/model.ckpt-4\nINFO:tensorflow:Error reported to Coordinator: <class 'ValueError'>, operands could not be broadcast together with shapes (256,) (4,) \nINFO:tensorflow:Saving checkpoints for 4 into data/tf/try1/model.ckpt.\nTraceback (most recent call last):\n  File \".../venv/lib/python3.4/site-packages/tables/array.py\", line 651, in __getitem__\n    startl, stopl, stepl, shape = self._interpret_indexing(key)\n  File \".../venv/lib/python3.4/site-packages/tables/array.py\", line 408, in _interpret_indexing\n    raise TypeError(\"Non-valid index or slice: %s\" % key)\nTypeError: Non-valid index or slice: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255]\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/usr/lib64/python3.4/runpy.py\", line 170, in _run_module_as_main\n    \"__main__\", mod_spec)\n  File \"/usr/lib64/python3.4/runpy.py\", line 85, in _run_code\n    exec(code, run_globals)\n  File \"/zfs_data/Sources/betahex/betahex/training/supervised.py\", line 106, in <module>\n    tf.app.run()\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/platform/app.py\", line 48, in run\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\n  File \"/zfs_data/Sources/betahex/betahex/training/supervised.py\", line 99, in main\n    steps=50\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/util/deprecation.py\", line 281, in new_func\n    return func(*args, **kwargs)\n  File \".../venvs/default/lib/python3.4/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 429, in fit\n    loss = self._train_model(input_fn=input_fn, hooks=hooks)\n  File \".../venv/lib/python3.4/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 977, in _train_model\n    _, loss = mon_sess.run([model_fn_ops.train_op, model_fn_ops.loss])\n  File .../venv/lib/python3.4/site-packages/tensorflow/python/training/monitored_session.py\", line 500, in __exit__\n    self._close_internal(exception_type)\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/training/monitored_session.py\", line 535, in _close_internal\n    self._sess.close()\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/training/monitored_session.py\", line 769, in close\n    self._sess.close()\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/training/monitored_session.py\", line 866, in close\n    ignore_live_threads=True)\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/training/coordinator.py\", line 389, in join\n    six.reraise(*self._exc_info_to_raise)\n  File \"/usr/lib/python3.4/site-packages/six.py\", line 686, in reraise\n    raise value\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/estimator/inputs/queues/feeding_queue_runner.py\", line 93, in _run\n    feed_dict = None if feed_fn is None else feed_fn()\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/estimator/inputs/queues/feeding_functions.py\", line 175, in __call__\n    for column in self._ordered_dict_of_arrays.values()\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/estimator/inputs/queues/feeding_functions.py\", line 175, in <listcomp>\n    for column in self._ordered_dict_of_arrays.values()\n  File \".../venv/lib/python3.4/site-packages/tables/array.py\", line 656, in __getitem__\n    coords = self._point_selection(key)\n  File \".../venv/lib/python3.4/site-packages/tables/leaf.py\", line 561, in _point_selection\n    coords[idx] = (coords + self.shape)[idx]\nValueError: operands could not be broadcast together with shapes (256,) (4,) \nClosing remaining open files:data/hdf5/training.h5...done", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: Relatively straightforward attempt at using estimator flow with `input_fn`\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Gentoo Linux\r\n- **TensorFlow installed from (source or binary)**: source\r\n- **TensorFlow version (use command below)**: b'v1.0.0-2171-gbaa85cb' 1.0.1\r\n- **Bazel version (if compiling from source)**: 0.4.4-\r\n- **CUDA/cuDNN version**: 8.0.61\r\n- **GPU model and memory**: GTX 970 4GB\r\n- **Exact command to reproduce**: \r\n\r\nOther stuff: Python 3.4, pytables 3.3.0, numpy 1.12.1, hdf5-1.8.18\r\n\r\n### Describe the problem\r\n\r\nI have an issue when reading multidimensional arrays from hdf5 file using pytables. I can fix the issue for myself locally by changing `_OrderedDictNumpyFeedFn` class (line 173 in my version) from \r\n\r\n```python\r\n column[integer_indexes]\r\n```\r\n\r\nto\r\n\r\n```python\r\nnp.take(column, integer_indexes, axis=0)\r\n```\r\n\r\n### Source code / logs\r\n\r\nRelevant bit of code:\r\n\r\n```python\r\ndef make_input_fn(data, batch_size):\r\n    input_features = {node.name: node for node in data.get_node('/x')}\r\n    ys = data.get_node('/y')\r\n    return numpy_input_fn(input_features, ys, batch_size=batch_size, num_epochs=5, shuffle=False, num_threads=1)\r\n\r\ndef main(unused_argv):\r\n    model_fn = make_train_model(feat)\r\n    config = learn.RunConfig(save_checkpoints_secs=60)\r\n    est = learn.Estimator(\r\n        model_fn=model_fn, model_dir=\"data/tf/try1\", config=config\r\n    )\r\n    training_data = tables.open_file('data/hdf5/training.h5')\r\n    train_in = make_input_fn(training_data, 256)\r\n    est.fit(\r\n        input_fn=train_in,\r\n        steps=100\r\n    )\r\n    training_data.close()\r\n```\r\n\r\nError I get:\r\n\r\n```\r\nINFO:tensorflow:Using config: {'_is_chief': True, '_keep_checkpoint_max': 5, '_save_checkpoints_secs': 60, '_environment': 'local', '_num_ps_replicas': 0, '_master': '', '_task_type': None, '_tf_config': gpu_options {\r\n  per_process_gpu_memory_fraction: 1.0\r\n}\r\n, '_num_worker_replicas': 0, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7ff377eaf550>, '_keep_checkpoint_every_n_hours': 10000, '_save_checkpoints_steps': None, '_evaluation_master': '', '_model_dir': None, '_save_summary_steps': 100, '_tf_random_seed': None, '_task_id': 0}\r\nINFO:tensorflow:Create CheckpointSaverHook.\r\n2017-04-17 10:05:38.231511: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:901] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2017-04-17 10:05:38.231863: I tensorflow/core/common_runtime/gpu/gpu_device.cc:887] Found device 0 with properties: \r\nname: GeForce GTX 970\r\nmajor: 5 minor: 2 memoryClockRate (GHz) 1.4305\r\npciBusID 0000:01:00.0\r\nTotal memory: 3.94GiB\r\nFree memory: 3.45GiB\r\n2017-04-17 10:05:38.232016: I tensorflow/core/common_runtime/gpu/gpu_device.cc:908] DMA: 0 \r\n2017-04-17 10:05:38.232048: I tensorflow/core/common_runtime/gpu/gpu_device.cc:918] 0:   Y \r\n2017-04-17 10:05:38.232081: I tensorflow/core/common_runtime/gpu/gpu_device.cc:977] Creating TensorFlow device (/gpu:0) -> (device: 0, name: GeForce GTX 970, pci bus id: 0000:01:00.0)\r\nINFO:tensorflow:Restoring parameters from data/tf/try1/model.ckpt-4\r\nINFO:tensorflow:Error reported to Coordinator: <class 'ValueError'>, operands could not be broadcast together with shapes (256,) (4,) \r\nINFO:tensorflow:Saving checkpoints for 4 into data/tf/try1/model.ckpt.\r\nTraceback (most recent call last):\r\n  File \".../venv/lib/python3.4/site-packages/tables/array.py\", line 651, in __getitem__\r\n    startl, stopl, stepl, shape = self._interpret_indexing(key)\r\n  File \".../venv/lib/python3.4/site-packages/tables/array.py\", line 408, in _interpret_indexing\r\n    raise TypeError(\"Non-valid index or slice: %s\" % key)\r\nTypeError: Non-valid index or slice: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255]\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/usr/lib64/python3.4/runpy.py\", line 170, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"/usr/lib64/python3.4/runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/zfs_data/Sources/betahex/betahex/training/supervised.py\", line 106, in <module>\r\n    tf.app.run()\r\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/platform/app.py\", line 48, in run\r\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\r\n  File \"/zfs_data/Sources/betahex/betahex/training/supervised.py\", line 99, in main\r\n    steps=50\r\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/util/deprecation.py\", line 281, in new_func\r\n    return func(*args, **kwargs)\r\n  File \".../venvs/default/lib/python3.4/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 429, in fit\r\n    loss = self._train_model(input_fn=input_fn, hooks=hooks)\r\n  File \".../venv/lib/python3.4/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 977, in _train_model\r\n    _, loss = mon_sess.run([model_fn_ops.train_op, model_fn_ops.loss])\r\n  File .../venv/lib/python3.4/site-packages/tensorflow/python/training/monitored_session.py\", line 500, in __exit__\r\n    self._close_internal(exception_type)\r\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/training/monitored_session.py\", line 535, in _close_internal\r\n    self._sess.close()\r\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/training/monitored_session.py\", line 769, in close\r\n    self._sess.close()\r\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/training/monitored_session.py\", line 866, in close\r\n    ignore_live_threads=True)\r\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/training/coordinator.py\", line 389, in join\r\n    six.reraise(*self._exc_info_to_raise)\r\n  File \"/usr/lib/python3.4/site-packages/six.py\", line 686, in reraise\r\n    raise value\r\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/estimator/inputs/queues/feeding_queue_runner.py\", line 93, in _run\r\n    feed_dict = None if feed_fn is None else feed_fn()\r\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/estimator/inputs/queues/feeding_functions.py\", line 175, in __call__\r\n    for column in self._ordered_dict_of_arrays.values()\r\n  File \".../venv/lib/python3.4/site-packages/tensorflow/python/estimator/inputs/queues/feeding_functions.py\", line 175, in <listcomp>\r\n    for column in self._ordered_dict_of_arrays.values()\r\n  File \".../venv/lib/python3.4/site-packages/tables/array.py\", line 656, in __getitem__\r\n    coords = self._point_selection(key)\r\n  File \".../venv/lib/python3.4/site-packages/tables/leaf.py\", line 561, in _point_selection\r\n    coords[idx] = (coords + self.shape)[idx]\r\nValueError: operands could not be broadcast together with shapes (256,) (4,) \r\nClosing remaining open files:data/hdf5/training.h5...done\r\n```"}