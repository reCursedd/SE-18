{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12096", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12096/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12096/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12096/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/12096", "id": 248587562, "node_id": "MDU6SXNzdWUyNDg1ODc1NjI=", "number": 12096, "title": "I configured ops_to_register.h and set #define SHOULD_REGISTER_OP_GRADIENT false, but unexpectedly the generated libtensorflow_inference.so file get larger.", "user": {"login": "scucheri", "id": 10495849, "node_id": "MDQ6VXNlcjEwNDk1ODQ5", "avatar_url": "https://avatars2.githubusercontent.com/u/10495849?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scucheri", "html_url": "https://github.com/scucheri", "followers_url": "https://api.github.com/users/scucheri/followers", "following_url": "https://api.github.com/users/scucheri/following{/other_user}", "gists_url": "https://api.github.com/users/scucheri/gists{/gist_id}", "starred_url": "https://api.github.com/users/scucheri/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scucheri/subscriptions", "organizations_url": "https://api.github.com/users/scucheri/orgs", "repos_url": "https://api.github.com/users/scucheri/repos", "events_url": "https://api.github.com/users/scucheri/events{/privacy}", "received_events_url": "https://api.github.com/users/scucheri/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-08-08T03:03:51Z", "updated_at": "2017-08-09T09:30:36Z", "closed_at": "2017-08-08T19:45:31Z", "author_association": "NONE", "body_html": "<h3>Describe the problem</h3>\n<p>I  configured ops_to_register.h as below:</p>\n<p>#define SHOULD_REGISTER_OP(op) true<br>\n#define SHOULD_REGISTER_OP_GRADIENT false<br>\n#define SHOULD_REGISTER_OP_KERNEL(clz) true</p>\n<p>set  SHOULD_REGISTER_OP_GRADIENT false. And then I used command below to generate libtensorflow_inference.so file.</p>\n<p><code>bazel build -c opt --copt=\"-DSELECTIVE_REGISTRATION\" \\                                          --copt=\"-DSUPPORT_SELECTIVE_REGISTRATION\" \\ //tensorflow/contrib/android:libtensorflow_inference.so \\ --host_crosstool_top=@bazel_tools//tools/cpp:toolchain \\ --crosstool_top=//external:android/crosstool --cpu=armeabi-v7a</code></p>\n<p>I expected that this configuration will reduce gradient operations and make the genereted libtensorflow_inference.so file smaller. But unexpectedly, the generated file is 16M ,while  the .so file generate by command below which will include all operators is 9.7M.</p>\n<p><code> bazel build -c opt //tensorflow/contrib/android:libtensorflow_inference.so \\ --crosstool_top=//external:android/crosstool \\ --host_crosstool_top=@bazel_tools//tools/cpp:toolchain \\ --cpu=armeabi-v7a</code></p>\n<h3>Question</h3>\n<p>I can't understand why the .so file get larger when  I set SHOULD_REGISTER_OP_GRADIENT false than the original .so file which include all operators. Could you please explain it to me ? Thank you very much and hope for your answer.</p>", "body_text": "Describe the problem\nI  configured ops_to_register.h as below:\n#define SHOULD_REGISTER_OP(op) true\n#define SHOULD_REGISTER_OP_GRADIENT false\n#define SHOULD_REGISTER_OP_KERNEL(clz) true\nset  SHOULD_REGISTER_OP_GRADIENT false. And then I used command below to generate libtensorflow_inference.so file.\nbazel build -c opt --copt=\"-DSELECTIVE_REGISTRATION\" \\                                          --copt=\"-DSUPPORT_SELECTIVE_REGISTRATION\" \\ //tensorflow/contrib/android:libtensorflow_inference.so \\ --host_crosstool_top=@bazel_tools//tools/cpp:toolchain \\ --crosstool_top=//external:android/crosstool --cpu=armeabi-v7a\nI expected that this configuration will reduce gradient operations and make the genereted libtensorflow_inference.so file smaller. But unexpectedly, the generated file is 16M ,while  the .so file generate by command below which will include all operators is 9.7M.\n bazel build -c opt //tensorflow/contrib/android:libtensorflow_inference.so \\ --crosstool_top=//external:android/crosstool \\ --host_crosstool_top=@bazel_tools//tools/cpp:toolchain \\ --cpu=armeabi-v7a\nQuestion\nI can't understand why the .so file get larger when  I set SHOULD_REGISTER_OP_GRADIENT false than the original .so file which include all operators. Could you please explain it to me ? Thank you very much and hope for your answer.", "body": "### Describe the problem\r\n I  configured ops_to_register.h as below:\r\n\r\n#define SHOULD_REGISTER_OP(op) true\r\n#define SHOULD_REGISTER_OP_GRADIENT false\r\n#define SHOULD_REGISTER_OP_KERNEL(clz) true\r\n\r\nset  SHOULD_REGISTER_OP_GRADIENT false. And then I used command below to generate libtensorflow_inference.so file. \r\n\r\n`bazel build -c opt --copt=\"-DSELECTIVE_REGISTRATION\" \\                                         \r\n            --copt=\"-DSUPPORT_SELECTIVE_REGISTRATION\" \\\r\n            //tensorflow/contrib/android:libtensorflow_inference.so \\\r\n            --host_crosstool_top=@bazel_tools//tools/cpp:toolchain \\\r\n            --crosstool_top=//external:android/crosstool --cpu=armeabi-v7a`\r\n\r\nI expected that this configuration will reduce gradient operations and make the genereted libtensorflow_inference.so file smaller. But unexpectedly, the generated file is 16M ,while  the .so file generate by command below which will include all operators is 9.7M.\r\n\r\n` bazel build -c opt //tensorflow/contrib/android:libtensorflow_inference.so \\\r\n         --crosstool_top=//external:android/crosstool \\\r\n         --host_crosstool_top=@bazel_tools//tools/cpp:toolchain \\\r\n         --cpu=armeabi-v7a`\r\n\r\n### Question\r\nI can't understand why the .so file get larger when  I set SHOULD_REGISTER_OP_GRADIENT false than the original .so file which include all operators. Could you please explain it to me ? Thank you very much and hope for your answer."}