{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/410731343", "html_url": "https://github.com/tensorflow/tensorflow/issues/20585#issuecomment-410731343", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20585", "id": 410731343, "node_id": "MDEyOklzc3VlQ29tbWVudDQxMDczMTM0Mw==", "user": {"login": "junshi15", "id": 12075848, "node_id": "MDQ6VXNlcjEyMDc1ODQ4", "avatar_url": "https://avatars3.githubusercontent.com/u/12075848?v=4", "gravatar_id": "", "url": "https://api.github.com/users/junshi15", "html_url": "https://github.com/junshi15", "followers_url": "https://api.github.com/users/junshi15/followers", "following_url": "https://api.github.com/users/junshi15/following{/other_user}", "gists_url": "https://api.github.com/users/junshi15/gists{/gist_id}", "starred_url": "https://api.github.com/users/junshi15/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/junshi15/subscriptions", "organizations_url": "https://api.github.com/users/junshi15/orgs", "repos_url": "https://api.github.com/users/junshi15/repos", "events_url": "https://api.github.com/users/junshi15/events{/privacy}", "received_events_url": "https://api.github.com/users/junshi15/received_events", "type": "User", "site_admin": false}, "created_at": "2018-08-06T14:40:30Z", "updated_at": "2018-08-06T14:40:47Z", "author_association": "CONTRIBUTOR", "body_html": "<p>For \"transpose-then-lookup\" code, the chief worker ran fine, but non-chief worker hung. After I set <code>tf.logging.set_verbosity(tf.logging.DEBUG)</code>, I saw the following on the non-chief worker. It seems embedding_encoder and embedding_decoder were not ready on the non-chief worker. No other error messages were seen.</p>\n<pre><code>junshi15$ python nonchief_hang_v3.py --time_major --out_dir=/tmp/rnn/work1 --ps_hosts=localhost:2222  --worker_hosts=localhost:1111,localhost:3333 --task_index=1 --job_name=worker\n\n2018-08-06 07:27:35.223313: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\n2018-08-06 07:27:35.224656: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job ps -&gt; {0 -&gt; localhost:2222}\n2018-08-06 07:27:35.224674: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job worker -&gt; {0 -&gt; localhost:1111, 1 -&gt; localhost:3333}\n2018-08-06 07:27:35.225027: I tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:332] Started server with target: grpc://localhost:3333\nINFO:tensorflow:Graph was finalized.\n2018-08-06 07:27:42.742037: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session 6f967f601337d97c with config:\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, encoder/rnn/basic_lstm_cell/kernel, encoder/rnn/basic_lstm_cell/bias, decoder/basic_lstm_cell/kernel, decoder/basic_lstm_cell/bias, global_step, ready: None\n2018-08-06 07:28:12.781871: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session 3139c55b7e2bdbef with config:\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\n2018-08-06 07:28:42.816610: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session 7d5684fbb32ca03b with config:\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\n2018-08-06 07:29:12.848483: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session 34122298c96817e7 with config:\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\n2018-08-06 07:29:42.877087: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session 0e9164b2458e92cf with config:\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\n2018-08-06 07:30:12.905306: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session fb3c939889939c88 with config: \nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\n2018-08-06 07:30:42.936056: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session c3e8a41826633f8a with config:\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\n2018-08-06 07:31:12.966590: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session 284b8fd3e8c8772e with config:\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\n</code></pre>", "body_text": "For \"transpose-then-lookup\" code, the chief worker ran fine, but non-chief worker hung. After I set tf.logging.set_verbosity(tf.logging.DEBUG), I saw the following on the non-chief worker. It seems embedding_encoder and embedding_decoder were not ready on the non-chief worker. No other error messages were seen.\njunshi15$ python nonchief_hang_v3.py --time_major --out_dir=/tmp/rnn/work1 --ps_hosts=localhost:2222  --worker_hosts=localhost:1111,localhost:3333 --task_index=1 --job_name=worker\n\n2018-08-06 07:27:35.223313: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\n2018-08-06 07:27:35.224656: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job ps -> {0 -> localhost:2222}\n2018-08-06 07:27:35.224674: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job worker -> {0 -> localhost:1111, 1 -> localhost:3333}\n2018-08-06 07:27:35.225027: I tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:332] Started server with target: grpc://localhost:3333\nINFO:tensorflow:Graph was finalized.\n2018-08-06 07:27:42.742037: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session 6f967f601337d97c with config:\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, encoder/rnn/basic_lstm_cell/kernel, encoder/rnn/basic_lstm_cell/bias, decoder/basic_lstm_cell/kernel, decoder/basic_lstm_cell/bias, global_step, ready: None\n2018-08-06 07:28:12.781871: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session 3139c55b7e2bdbef with config:\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\n2018-08-06 07:28:42.816610: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session 7d5684fbb32ca03b with config:\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\n2018-08-06 07:29:12.848483: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session 34122298c96817e7 with config:\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\n2018-08-06 07:29:42.877087: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session 0e9164b2458e92cf with config:\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\n2018-08-06 07:30:12.905306: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session fb3c939889939c88 with config: \nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\n2018-08-06 07:30:42.936056: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session c3e8a41826633f8a with config:\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\n2018-08-06 07:31:12.966590: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session 284b8fd3e8c8772e with config:\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None", "body": "For \"transpose-then-lookup\" code, the chief worker ran fine, but non-chief worker hung. After I set `tf.logging.set_verbosity(tf.logging.DEBUG)`, I saw the following on the non-chief worker. It seems embedding_encoder and embedding_decoder were not ready on the non-chief worker. No other error messages were seen.\r\n\r\n```\r\njunshi15$ python nonchief_hang_v3.py --time_major --out_dir=/tmp/rnn/work1 --ps_hosts=localhost:2222  --worker_hosts=localhost:1111,localhost:3333 --task_index=1 --job_name=worker\r\n\r\n2018-08-06 07:27:35.223313: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\r\n2018-08-06 07:27:35.224656: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job ps -> {0 -> localhost:2222}\r\n2018-08-06 07:27:35.224674: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:215] Initialize GrpcChannelCache for job worker -> {0 -> localhost:1111, 1 -> localhost:3333}\r\n2018-08-06 07:27:35.225027: I tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:332] Started server with target: grpc://localhost:3333\r\nINFO:tensorflow:Graph was finalized.\r\n2018-08-06 07:27:42.742037: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session 6f967f601337d97c with config:\r\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, encoder/rnn/basic_lstm_cell/kernel, encoder/rnn/basic_lstm_cell/bias, decoder/basic_lstm_cell/kernel, decoder/basic_lstm_cell/bias, global_step, ready: None\r\n2018-08-06 07:28:12.781871: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session 3139c55b7e2bdbef with config:\r\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\r\n2018-08-06 07:28:42.816610: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session 7d5684fbb32ca03b with config:\r\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\r\n2018-08-06 07:29:12.848483: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session 34122298c96817e7 with config:\r\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\r\n2018-08-06 07:29:42.877087: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session 0e9164b2458e92cf with config:\r\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\r\n2018-08-06 07:30:12.905306: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session fb3c939889939c88 with config: \r\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\r\n2018-08-06 07:30:42.936056: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session c3e8a41826633f8a with config:\r\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\r\n2018-08-06 07:31:12.966590: I tensorflow/core/distributed_runtime/master_session.cc:1136] Start master session 284b8fd3e8c8772e with config:\r\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  Variables not initialized: embedding_encoder, embedding_decoder, ready: None\r\n```"}