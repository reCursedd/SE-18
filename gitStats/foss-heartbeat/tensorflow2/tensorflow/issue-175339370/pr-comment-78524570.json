{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/78524570", "pull_request_review_id": null, "id": 78524570, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDc4NTI0NTcw", "diff_hunk": "@@ -120,13 +120,33 @@ def _enable_cuda(repository_ctx):\n   return False\n \n \n-def _cuda_toolkit_path(repository_ctx):\n-  \"\"\"Finds the cuda toolkit directory.\"\"\"\n+def _cuda_toolkit_path(repository_ctx, cuda_version):\n+  \"\"\"Finds the cuda toolkit directory.\n+\n+   If cuda_version is given, attempts to return a real path.\n+\n+  Args:\n+    repository_ctx: The repository context.\n+    cuda_version: The cuda toolkit version.\n+\n+  Returns:\n+    A speculative real path of the cuda toolkit install directory.\n+  \"\"\"\n   cuda_toolkit_path = _DEFAULT_CUDA_TOOLKIT_PATH\n   if _CUDA_TOOLKIT_PATH in repository_ctx.os.environ:\n     cuda_toolkit_path = repository_ctx.os.environ[_CUDA_TOOLKIT_PATH].strip()\n   if not repository_ctx.path(cuda_toolkit_path).exists:\n     auto_configure_fail(\"Cannot find cuda toolkit path.\")\n+\n+  if cuda_version:\n+    # Handle typical configuration where the real path is\n+    # <basedir>/cuda-<version> and the provided path is <basedir>/cuda.\n+    version_suffixed = \"%s-%s\" % (cuda_toolkit_path, cuda_version)\n+    if repository_ctx.path(version_suffixed).exists:\n+      return version_suffixed\n+  # Now hoping that the provided path was already a real path.", "path": "third_party/gpus/cuda_configure.bzl", "position": null, "original_position": 30, "commit_id": "57222b869d247e2cd212fd90ef63ce8e7fcadb05", "original_commit_id": "57be6d3a800d6f3c6230577a6121c2b5ba5f704d", "user": {"login": "davidzchen", "id": 5283042, "node_id": "MDQ6VXNlcjUyODMwNDI=", "avatar_url": "https://avatars1.githubusercontent.com/u/5283042?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidzchen", "html_url": "https://github.com/davidzchen", "followers_url": "https://api.github.com/users/davidzchen/followers", "following_url": "https://api.github.com/users/davidzchen/following{/other_user}", "gists_url": "https://api.github.com/users/davidzchen/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidzchen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidzchen/subscriptions", "organizations_url": "https://api.github.com/users/davidzchen/orgs", "repos_url": "https://api.github.com/users/davidzchen/repos", "events_url": "https://api.github.com/users/davidzchen/events{/privacy}", "received_events_url": "https://api.github.com/users/davidzchen/received_events", "type": "User", "site_admin": false}, "body": "Returns the non-versioned path if cuda version is not provided or if the installation does not use a cuda-<version> directory, such as on ArchLinux where CUDA installs directly to /opt/cuda.\n", "created_at": "2016-09-13T09:23:59Z", "updated_at": "2016-09-19T09:50:05Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/4233#discussion_r78524570", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/4233", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/78524570"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/4233#discussion_r78524570"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/4233"}}, "body_html": "<p>Returns the non-versioned path if cuda version is not provided or if the installation does not use a cuda- directory, such as on ArchLinux where CUDA installs directly to /opt/cuda.</p>", "body_text": "Returns the non-versioned path if cuda version is not provided or if the installation does not use a cuda- directory, such as on ArchLinux where CUDA installs directly to /opt/cuda."}