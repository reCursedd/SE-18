{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/132803953", "pull_request_review_id": 55929657, "id": 132803953, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzMjgwMzk1Mw==", "diff_hunk": "@@ -1203,12 +1211,6 @@ def _get_eval_ops(self, features, labels, metrics):\n     model_fn_ops = self._call_model_fn(\n         features, labels, model_fn_lib.ModeKeys.EVAL)", "path": "tensorflow/contrib/learn/python/learn/estimators/estimator.py", "position": null, "original_position": 54, "commit_id": "9dbca108653e18c7b9eea855ddfbad82caee02fe", "original_commit_id": "1c9b6c4b300df1b823a6427f4112610c57586c6b", "user": {"login": "facaiy", "id": 1112263, "node_id": "MDQ6VXNlcjExMTIyNjM=", "avatar_url": "https://avatars3.githubusercontent.com/u/1112263?v=4", "gravatar_id": "", "url": "https://api.github.com/users/facaiy", "html_url": "https://github.com/facaiy", "followers_url": "https://api.github.com/users/facaiy/followers", "following_url": "https://api.github.com/users/facaiy/following{/other_user}", "gists_url": "https://api.github.com/users/facaiy/gists{/gist_id}", "starred_url": "https://api.github.com/users/facaiy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/facaiy/subscriptions", "organizations_url": "https://api.github.com/users/facaiy/orgs", "repos_url": "https://api.github.com/users/facaiy/repos", "events_url": "https://api.github.com/users/facaiy/events{/privacy}", "received_events_url": "https://api.github.com/users/facaiy/received_events", "type": "User", "site_admin": false}, "body": "Thanks for your review. \r\n\r\nNow `feature_engineerng_fn(features, label)` is called by `Estimator.eval()` twice. See code [here](https://github.com/facaiy/tensorflow/blob/c7b80d51da4fb6d51ea54a0bdf2601afa379d60c/tensorflow/contrib/learn/python/learn/estimators/estimator.py#L1095) and [there](https://github.com/facaiy/tensorflow/blob/c7b80d51da4fb6d51ea54a0bdf2601afa379d60c/tensorflow/contrib/learn/python/learn/estimators/estimator.py#L1165).\r\nBecause `features` can be a `dict` which is passed by pointer for function, hence `features` will be converted by `feature_engineering_fn` twice. It's dangerous and might get in trouble.\r\n\r\nSo we should assure that `feature_engineering_fn` only be called once for `train`, `eval` and `predict`. That's why I send metrics to `call_model_fn`. \r\n\r\nIn fact, I have added an unit test below to catch the error. \r\n \r\n", "created_at": "2017-08-12T00:15:55Z", "updated_at": "2017-08-13T23:32:41Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/12206#discussion_r132803953", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12206", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/132803953"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/12206#discussion_r132803953"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12206"}}, "body_html": "<p>Thanks for your review.</p>\n<p>Now <code>feature_engineerng_fn(features, label)</code> is called by <code>Estimator.eval()</code> twice. See code <a href=\"https://github.com/facaiy/tensorflow/blob/c7b80d51da4fb6d51ea54a0bdf2601afa379d60c/tensorflow/contrib/learn/python/learn/estimators/estimator.py#L1095\">here</a> and <a href=\"https://github.com/facaiy/tensorflow/blob/c7b80d51da4fb6d51ea54a0bdf2601afa379d60c/tensorflow/contrib/learn/python/learn/estimators/estimator.py#L1165\">there</a>.<br>\nBecause <code>features</code> can be a <code>dict</code> which is passed by pointer for function, hence <code>features</code> will be converted by <code>feature_engineering_fn</code> twice. It's dangerous and might get in trouble.</p>\n<p>So we should assure that <code>feature_engineering_fn</code> only be called once for <code>train</code>, <code>eval</code> and <code>predict</code>. That's why I send metrics to <code>call_model_fn</code>.</p>\n<p>In fact, I have added an unit test below to catch the error.</p>", "body_text": "Thanks for your review.\nNow feature_engineerng_fn(features, label) is called by Estimator.eval() twice. See code here and there.\nBecause features can be a dict which is passed by pointer for function, hence features will be converted by feature_engineering_fn twice. It's dangerous and might get in trouble.\nSo we should assure that feature_engineering_fn only be called once for train, eval and predict. That's why I send metrics to call_model_fn.\nIn fact, I have added an unit test below to catch the error.", "in_reply_to_id": 132721763}