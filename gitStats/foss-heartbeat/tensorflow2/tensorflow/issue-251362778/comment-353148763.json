{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/353148763", "html_url": "https://github.com/tensorflow/tensorflow/issues/12405#issuecomment-353148763", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12405", "id": 353148763, "node_id": "MDEyOklzc3VlQ29tbWVudDM1MzE0ODc2Mw==", "user": {"login": "reedwm", "id": 6510203, "node_id": "MDQ6VXNlcjY1MTAyMDM=", "avatar_url": "https://avatars2.githubusercontent.com/u/6510203?v=4", "gravatar_id": "", "url": "https://api.github.com/users/reedwm", "html_url": "https://github.com/reedwm", "followers_url": "https://api.github.com/users/reedwm/followers", "following_url": "https://api.github.com/users/reedwm/following{/other_user}", "gists_url": "https://api.github.com/users/reedwm/gists{/gist_id}", "starred_url": "https://api.github.com/users/reedwm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/reedwm/subscriptions", "organizations_url": "https://api.github.com/users/reedwm/orgs", "repos_url": "https://api.github.com/users/reedwm/repos", "events_url": "https://api.github.com/users/reedwm/events{/privacy}", "received_events_url": "https://api.github.com/users/reedwm/received_events", "type": "User", "site_admin": false}, "created_at": "2017-12-20T18:45:50Z", "updated_at": "2017-12-20T18:45:50Z", "author_association": "MEMBER", "body_html": "<p><code>tf.boolean_mask</code> calls <code>tf.gather</code>, which has the same problem:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n<span class=\"pl-k\">from</span> tensorflow.core.protobuf <span class=\"pl-k\">import</span> rewriter_config_pb2\n\nconfig <span class=\"pl-k\">=</span> tf.ConfigProto()\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Disable constant propagation</span>\nconfig.graph_options.optimizer_options.opt_level <span class=\"pl-k\">=</span> tf.OptimizerOptions.L0\nconfig.graph_options.rewrite_options.constant_folding <span class=\"pl-k\">=</span> rewriter_config_pb2.RewriterConfig.<span class=\"pl-c1\">OFF</span>\n\n<span class=\"pl-k\">with</span> tf.device(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>/gpu:0<span class=\"pl-pds\">'</span></span>):\n  y <span class=\"pl-k\">=</span> tf.gather([<span class=\"pl-c1\">1</span>., <span class=\"pl-c1\">2</span>.], [<span class=\"pl-c1\">3</span>])\n  <span class=\"pl-k\">with</span> tf.Session(<span class=\"pl-v\">config</span><span class=\"pl-k\">=</span>config) <span class=\"pl-k\">as</span> sess:\n    <span class=\"pl-c1\">print</span>(sess.run(y))</pre></div>\n<p>/CC <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=26527\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rryan\">@rryan</a>, can you look into this?</p>", "body_text": "tf.boolean_mask calls tf.gather, which has the same problem:\nimport tensorflow as tf\nfrom tensorflow.core.protobuf import rewriter_config_pb2\n\nconfig = tf.ConfigProto()\n# Disable constant propagation\nconfig.graph_options.optimizer_options.opt_level = tf.OptimizerOptions.L0\nconfig.graph_options.rewrite_options.constant_folding = rewriter_config_pb2.RewriterConfig.OFF\n\nwith tf.device('/gpu:0'):\n  y = tf.gather([1., 2.], [3])\n  with tf.Session(config=config) as sess:\n    print(sess.run(y))\n/CC @rryan, can you look into this?", "body": "`tf.boolean_mask` calls `tf.gather`, which has the same problem:\r\n\r\n```python\r\nimport tensorflow as tf\r\nfrom tensorflow.core.protobuf import rewriter_config_pb2\r\n\r\nconfig = tf.ConfigProto()\r\n# Disable constant propagation\r\nconfig.graph_options.optimizer_options.opt_level = tf.OptimizerOptions.L0\r\nconfig.graph_options.rewrite_options.constant_folding = rewriter_config_pb2.RewriterConfig.OFF\r\n\r\nwith tf.device('/gpu:0'):\r\n  y = tf.gather([1., 2.], [3])\r\n  with tf.Session(config=config) as sess:\r\n    print(sess.run(y))\r\n```\r\n\r\n/CC @rryan, can you look into this?"}