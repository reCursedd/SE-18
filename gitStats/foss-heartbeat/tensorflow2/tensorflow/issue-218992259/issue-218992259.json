{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8928", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8928/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8928/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8928/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/8928", "id": 218992259, "node_id": "MDU6SXNzdWUyMTg5OTIyNTk=", "number": 8928, "title": "cudnnFindConvolutionForwardAlgorithmEx vs cudnnGetConvolutionForwardAlgorithm", "user": {"login": "cancan101", "id": 51059, "node_id": "MDQ6VXNlcjUxMDU5", "avatar_url": "https://avatars1.githubusercontent.com/u/51059?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cancan101", "html_url": "https://github.com/cancan101", "followers_url": "https://api.github.com/users/cancan101/followers", "following_url": "https://api.github.com/users/cancan101/following{/other_user}", "gists_url": "https://api.github.com/users/cancan101/gists{/gist_id}", "starred_url": "https://api.github.com/users/cancan101/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cancan101/subscriptions", "organizations_url": "https://api.github.com/users/cancan101/orgs", "repos_url": "https://api.github.com/users/cancan101/repos", "events_url": "https://api.github.com/users/cancan101/events{/privacy}", "received_events_url": "https://api.github.com/users/cancan101/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2017-04-03T16:38:37Z", "updated_at": "2017-04-04T00:03:39Z", "closed_at": "2017-04-04T00:03:39Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Following up on <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"204598482\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/7187\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/7187/hovercard?comment_id=290284053&amp;comment_type=issue_comment\" href=\"https://github.com/tensorflow/tensorflow/issues/7187#issuecomment-290284053\">#7187 (comment)</a>, why does Tensorflow use <a href=\"https://github.com/tensorflow/tensorflow/blob/904edee4456a61d50d5b1ffe9858a7772acc423e/tensorflow/stream_executor/cuda/cuda_dnn.cc#L1844\"><code>cudnnGetConvolutionForwardAlgorithm</code></a> rather than <code>cudnnFindConvolutionForwardAlgorithmEx</code>?  It looks like <a href=\"https://github.com/tensorflow/tensorflow/blob/f8d8172c0086a42dfc1ed732fcf083dbd62c42e4/tensorflow/core/kernels/conv_ops.cc#L664-L689\">Tensorflow tries to do the more complete profiling itself</a>.</p>\n<p>For reference, <code>cudnnGetConvolutionForwardAlgorithm</code> serves as a heuristic for obtaining the best suited algorithm for cudnnConvolutionForward for the given layer specifications. Based on the input preference, this function will either return the fastest algorithm or the fastest algorithm within a given memory limit. For an exhaustive search for the fastest algorithm, please use <code>cudnnFindConvolutionForwardAlgorithm</code>.</p>\n<p>Whereas:<br>\n<code>cudnnFindConvolutionForwardAlgorithmEx</code> function attempts all available cuDNN algorithms for cudnnConvolutionForward, using user-allocated GPU memory, and outputs performance metrics to a user-allocated array of cudnnConvolutionFwdAlgoPerf_t. These metrics are written in sorted fashion where the first element has the lowest compute time.</p>\n<p>Looking at a number of other DNN, they seem to use <code>cudnnFindConvolutionForwardAlgorithmEx</code> / <code>cudnnFindConvolutionForwardAlgorithm</code>:</p>\n<ul>\n<li><a href=\"https://github.com/pytorch/pytorch/blob/e50a1f19b3dc735f0710929b97b0af384aafe09b/torch/csrc/cudnn/Conv.cpp#L214\">pytorch</a> (when benchmark is on):</li>\n<li><a href=\"https://github.com/Theano/Theano/blob/c6ffa460d43b6650aefbe7939f332084caafeaa4/theano/gpuarray/dnn_fwd.c#L125\">Theano</a> (if <code>time_once</code> or <code>time_on_shape_change</code>)</li>\n<li><a href=\"https://github.com/Microsoft/CNTK/blob/5651d574c8f3fecf2533cf01beebaaa6e07453e2/Source/Math/CuDnnConvolutionEngine.cu#L229\">cntk</a> (non-static finder)</li>\n</ul>\n<p>/CC <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=551151\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/Yangqing\">@Yangqing</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=15736910\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/zheng-xq\">@zheng-xq</a></p>", "body_text": "Following up on #7187 (comment), why does Tensorflow use cudnnGetConvolutionForwardAlgorithm rather than cudnnFindConvolutionForwardAlgorithmEx?  It looks like Tensorflow tries to do the more complete profiling itself.\nFor reference, cudnnGetConvolutionForwardAlgorithm serves as a heuristic for obtaining the best suited algorithm for cudnnConvolutionForward for the given layer specifications. Based on the input preference, this function will either return the fastest algorithm or the fastest algorithm within a given memory limit. For an exhaustive search for the fastest algorithm, please use cudnnFindConvolutionForwardAlgorithm.\nWhereas:\ncudnnFindConvolutionForwardAlgorithmEx function attempts all available cuDNN algorithms for cudnnConvolutionForward, using user-allocated GPU memory, and outputs performance metrics to a user-allocated array of cudnnConvolutionFwdAlgoPerf_t. These metrics are written in sorted fashion where the first element has the lowest compute time.\nLooking at a number of other DNN, they seem to use cudnnFindConvolutionForwardAlgorithmEx / cudnnFindConvolutionForwardAlgorithm:\n\npytorch (when benchmark is on):\nTheano (if time_once or time_on_shape_change)\ncntk (non-static finder)\n\n/CC @Yangqing @zheng-xq", "body": "Following up on https://github.com/tensorflow/tensorflow/issues/7187#issuecomment-290284053, why does Tensorflow use [`cudnnGetConvolutionForwardAlgorithm`](https://github.com/tensorflow/tensorflow/blob/904edee4456a61d50d5b1ffe9858a7772acc423e/tensorflow/stream_executor/cuda/cuda_dnn.cc#L1844) rather than `cudnnFindConvolutionForwardAlgorithmEx`?  It looks like [Tensorflow tries to do the more complete profiling itself](https://github.com/tensorflow/tensorflow/blob/f8d8172c0086a42dfc1ed732fcf083dbd62c42e4/tensorflow/core/kernels/conv_ops.cc#L664-L689). \r\n\r\nFor reference, `cudnnGetConvolutionForwardAlgorithm` serves as a heuristic for obtaining the best suited algorithm for cudnnConvolutionForward for the given layer specifications. Based on the input preference, this function will either return the fastest algorithm or the fastest algorithm within a given memory limit. For an exhaustive search for the fastest algorithm, please use `cudnnFindConvolutionForwardAlgorithm`.\r\n\r\nWhereas:\r\n`cudnnFindConvolutionForwardAlgorithmEx` function attempts all available cuDNN algorithms for cudnnConvolutionForward, using user-allocated GPU memory, and outputs performance metrics to a user-allocated array of cudnnConvolutionFwdAlgoPerf_t. These metrics are written in sorted fashion where the first element has the lowest compute time.\r\n\r\nLooking at a number of other DNN, they seem to use `cudnnFindConvolutionForwardAlgorithmEx` / `cudnnFindConvolutionForwardAlgorithm`:\r\n* [pytorch](https://github.com/pytorch/pytorch/blob/e50a1f19b3dc735f0710929b97b0af384aafe09b/torch/csrc/cudnn/Conv.cpp#L214) (when benchmark is on): \r\n* [Theano](https://github.com/Theano/Theano/blob/c6ffa460d43b6650aefbe7939f332084caafeaa4/theano/gpuarray/dnn_fwd.c#L125) (if `time_once` or `time_on_shape_change`)\r\n* [cntk](https://github.com/Microsoft/CNTK/blob/5651d574c8f3fecf2533cf01beebaaa6e07453e2/Source/Math/CuDnnConvolutionEngine.cu#L229) (non-static finder)\r\n\r\n/CC @Yangqing @zheng-xq"}