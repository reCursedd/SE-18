{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/229031210", "html_url": "https://github.com/tensorflow/tensorflow/issues/3073#issuecomment-229031210", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3073", "id": 229031210, "node_id": "MDEyOklzc3VlQ29tbWVudDIyOTAzMTIxMA==", "user": {"login": "yaroslavvb", "id": 23068, "node_id": "MDQ6VXNlcjIzMDY4", "avatar_url": "https://avatars3.githubusercontent.com/u/23068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yaroslavvb", "html_url": "https://github.com/yaroslavvb", "followers_url": "https://api.github.com/users/yaroslavvb/followers", "following_url": "https://api.github.com/users/yaroslavvb/following{/other_user}", "gists_url": "https://api.github.com/users/yaroslavvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/yaroslavvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yaroslavvb/subscriptions", "organizations_url": "https://api.github.com/users/yaroslavvb/orgs", "repos_url": "https://api.github.com/users/yaroslavvb/repos", "events_url": "https://api.github.com/users/yaroslavvb/events{/privacy}", "received_events_url": "https://api.github.com/users/yaroslavvb/received_events", "type": "User", "site_admin": false}, "created_at": "2016-06-28T12:13:07Z", "updated_at": "2016-06-28T12:13:07Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Variables sizes do not get reset. Variables buffers are allocated in a<br>\ncontainer, which is a property of a session. There's no way to destroy a<br>\nvariable in a session, so to reset size you need to create new session, or<br>\ncreate new variable (use different name)</p>\n<p>On Tue, Jun 28, 2016 at 11:50 AM, \u90d1\u6cfd\u5b87 <a href=\"mailto:notifications@github.com\">notifications@github.com</a> wrote:</p>\n<blockquote>\n<p>In my understanding reset_default_graph() will reset the whole graph.<br>\nHowever, it seems that this will only reset the value of variables when<br>\nrunning parameter servers on kubernetes.</p>\n<p>First, I tried to get variable values before and after<br>\nreset_default_graph(). The value is reset (value is 0) after running<br>\nreset_default_graph().</p>\n<p>Then I tried to run a totally different algorithm using the same parameter<br>\nserver, it reported the error below:</p>\n<p><em>Assign requires shapes of both tensors to match. lhs shape= [5,5,32,64]<br>\nrhs shape= [50000]</em></p>\n<p>Only chief run the reset_default_graph() cmd. The code is:</p>\n<p>is_chief = (FLAGS.worker_index == 0)<br>\nif is_chief: tf.reset_default_graph()</p>\n<p>The whole error message is:</p>\n<p>Traceback (most recent call last):<br>\nFile \"word2vector.py\", line 160, in <br>\nwith sv.prepare_or_wait_for_session(FLAGS.worker_grpc_url, config=sess_config) as sess:<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/supervisor.py\", line 685, in prepare_or_wait_for_session<br>\nconfig=config, init_feed_dict=self._init_feed_dict)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/session_manager.py\", line 163, in prepare_session<br>\nsess.run(init_op, feed_dict=init_feed_dict)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 340, in run<br>\nrun_metadata_ptr)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 564, in _run<br>\nfeed_dict_string, options, run_metadata)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 637, in _do_run<br>\ntarget_list, options, run_metadata)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 659, in _do_call<br>\ne.code)</p>\n<p>tensorflow.python.framework.errors.InvalidArgumentError: Assign requires shapes of both tensors to match. lhs shape= [5,5,32,64] rhs shape= [50000]</p>\n<pre><code>     [[Node: Variable_3/Assign = Assign[T=DT_FLOAT, _class=[\"loc:@Variable_3\"], use_locking=true, validate_shape=true, _device=\n</code></pre>\n<p>\"/job:ps/replica:0/task:3/cpu:0\"](Variable_3, zeros_S1)]]<br>\nCaused by op u'Variable_3/Assign', defined at:<br>\nFile \"word2vector.py\", line 127, in <br>\nnce_biases = tf.Variable(tf.zeros([vocabulary_size]))<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 209, in <strong>init</strong><br>\ndtype=dtype)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 308, in _init_from_args<br>\nvalidate_shape=validate_shape).op<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_state_ops.py\", line 40, in assign<br>\nuse_locking=use_locking, name=name)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/op_def_library.py\", line 655, in apply_op<br>\nop_def=op_def)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2154, in create_op<br>\noriginal_op=self._default_original_op, op_def=op_def)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1154, in <strong>init</strong><br>\nself._traceback = _extract_stack()</p>\n<p>\u2014<br>\nYou are receiving this because you are subscribed to this thread.<br>\nReply to this email directly, view it on GitHub<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"162634078\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/3073\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/3073/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/3073\">#3073</a>, or mute the thread<br>\n<a href=\"https://github.com/notifications/unsubscribe/AABaHKDyt4ZMvgAkoMYlbJv0G39xETpTks5qQOBygaJpZM4I_4JN\">https://github.com/notifications/unsubscribe/AABaHKDyt4ZMvgAkoMYlbJv0G39xETpTks5qQOBygaJpZM4I_4JN</a><br>\n.</p>\n</blockquote>", "body_text": "Variables sizes do not get reset. Variables buffers are allocated in a\ncontainer, which is a property of a session. There's no way to destroy a\nvariable in a session, so to reset size you need to create new session, or\ncreate new variable (use different name)\nOn Tue, Jun 28, 2016 at 11:50 AM, \u90d1\u6cfd\u5b87 notifications@github.com wrote:\n\nIn my understanding reset_default_graph() will reset the whole graph.\nHowever, it seems that this will only reset the value of variables when\nrunning parameter servers on kubernetes.\nFirst, I tried to get variable values before and after\nreset_default_graph(). The value is reset (value is 0) after running\nreset_default_graph().\nThen I tried to run a totally different algorithm using the same parameter\nserver, it reported the error below:\nAssign requires shapes of both tensors to match. lhs shape= [5,5,32,64]\nrhs shape= [50000]\nOnly chief run the reset_default_graph() cmd. The code is:\nis_chief = (FLAGS.worker_index == 0)\nif is_chief: tf.reset_default_graph()\nThe whole error message is:\nTraceback (most recent call last):\nFile \"word2vector.py\", line 160, in \nwith sv.prepare_or_wait_for_session(FLAGS.worker_grpc_url, config=sess_config) as sess:\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/supervisor.py\", line 685, in prepare_or_wait_for_session\nconfig=config, init_feed_dict=self._init_feed_dict)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/session_manager.py\", line 163, in prepare_session\nsess.run(init_op, feed_dict=init_feed_dict)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 340, in run\nrun_metadata_ptr)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 564, in _run\nfeed_dict_string, options, run_metadata)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 637, in _do_run\ntarget_list, options, run_metadata)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 659, in _do_call\ne.code)\ntensorflow.python.framework.errors.InvalidArgumentError: Assign requires shapes of both tensors to match. lhs shape= [5,5,32,64] rhs shape= [50000]\n     [[Node: Variable_3/Assign = Assign[T=DT_FLOAT, _class=[\"loc:@Variable_3\"], use_locking=true, validate_shape=true, _device=\n\n\"/job:ps/replica:0/task:3/cpu:0\"](Variable_3, zeros_S1)]]\nCaused by op u'Variable_3/Assign', defined at:\nFile \"word2vector.py\", line 127, in \nnce_biases = tf.Variable(tf.zeros([vocabulary_size]))\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 209, in init\ndtype=dtype)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 308, in _init_from_args\nvalidate_shape=validate_shape).op\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_state_ops.py\", line 40, in assign\nuse_locking=use_locking, name=name)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/op_def_library.py\", line 655, in apply_op\nop_def=op_def)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2154, in create_op\noriginal_op=self._default_original_op, op_def=op_def)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1154, in init\nself._traceback = _extract_stack()\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\n#3073, or mute the thread\nhttps://github.com/notifications/unsubscribe/AABaHKDyt4ZMvgAkoMYlbJv0G39xETpTks5qQOBygaJpZM4I_4JN\n.", "body": "Variables sizes do not get reset. Variables buffers are allocated in a\ncontainer, which is a property of a session. There's no way to destroy a\nvariable in a session, so to reset size you need to create new session, or\ncreate new variable (use different name)\n\nOn Tue, Jun 28, 2016 at 11:50 AM, \u90d1\u6cfd\u5b87 notifications@github.com wrote:\n\n> In my understanding reset_default_graph() will reset the whole graph.\n> However, it seems that this will only reset the value of variables when\n> running parameter servers on kubernetes.\n> \n> First, I tried to get variable values before and after\n> reset_default_graph(). The value is reset (value is 0) after running\n> reset_default_graph().\n> \n> Then I tried to run a totally different algorithm using the same parameter\n> server, it reported the error below:\n> \n> _Assign requires shapes of both tensors to match. lhs shape= [5,5,32,64]\n> rhs shape= [50000]_\n> \n> Only chief run the reset_default_graph() cmd. The code is:\n> \n> is_chief = (FLAGS.worker_index == 0)\n> if is_chief: tf.reset_default_graph()\n> \n> The whole error message is:\n> \n> Traceback (most recent call last):\n>   File \"word2vector.py\", line 160, in <module>\n>     with sv.prepare_or_wait_for_session(FLAGS.worker_grpc_url, config=sess_config) as sess:\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/supervisor.py\", line 685, in prepare_or_wait_for_session\n>     config=config, init_feed_dict=self._init_feed_dict)\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/session_manager.py\", line 163, in prepare_session\n>     sess.run(init_op, feed_dict=init_feed_dict)\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 340, in run\n>     run_metadata_ptr)\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 564, in _run\n>     feed_dict_string, options, run_metadata)\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 637, in _do_run\n>     target_list, options, run_metadata)\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 659, in _do_call\n>     e.code)\n> \n> tensorflow.python.framework.errors.InvalidArgumentError: Assign requires shapes of both tensors to match. lhs shape= [5,5,32,64] rhs shape= [50000]\n> \n> ```\n>      [[Node: Variable_3/Assign = Assign[T=DT_FLOAT, _class=[\"loc:@Variable_3\"], use_locking=true, validate_shape=true, _device=\n> ```\n> \n> \"/job:ps/replica:0/task:3/cpu:0\"](Variable_3, zeros_S1)]]\n> Caused by op u'Variable_3/Assign', defined at:\n>   File \"word2vector.py\", line 127, in <module>\n>     nce_biases = tf.Variable(tf.zeros([vocabulary_size]))\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 209, in **init**\n>     dtype=dtype)\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 308, in _init_from_args\n>     validate_shape=validate_shape).op\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_state_ops.py\", line 40, in assign\n>     use_locking=use_locking, name=name)\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/op_def_library.py\", line 655, in apply_op\n>     op_def=op_def)\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2154, in create_op\n>     original_op=self._default_original_op, op_def=op_def)\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1154, in __init__\n>     self._traceback = _extract_stack()\n> \n> \u2014\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> https://github.com/tensorflow/tensorflow/issues/3073, or mute the thread\n> https://github.com/notifications/unsubscribe/AABaHKDyt4ZMvgAkoMYlbJv0G39xETpTks5qQOBygaJpZM4I_4JN\n> .\n"}