{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/316974259", "html_url": "https://github.com/tensorflow/tensorflow/pull/9606#issuecomment-316974259", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9606", "id": 316974259, "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjk3NDI1OQ==", "user": {"login": "FrisaSZ", "id": 8479205, "node_id": "MDQ6VXNlcjg0NzkyMDU=", "avatar_url": "https://avatars3.githubusercontent.com/u/8479205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FrisaSZ", "html_url": "https://github.com/FrisaSZ", "followers_url": "https://api.github.com/users/FrisaSZ/followers", "following_url": "https://api.github.com/users/FrisaSZ/following{/other_user}", "gists_url": "https://api.github.com/users/FrisaSZ/gists{/gist_id}", "starred_url": "https://api.github.com/users/FrisaSZ/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FrisaSZ/subscriptions", "organizations_url": "https://api.github.com/users/FrisaSZ/orgs", "repos_url": "https://api.github.com/users/FrisaSZ/repos", "events_url": "https://api.github.com/users/FrisaSZ/events{/privacy}", "received_events_url": "https://api.github.com/users/FrisaSZ/received_events", "type": "User", "site_admin": false}, "created_at": "2017-07-21T11:09:22Z", "updated_at": "2017-07-21T11:09:22Z", "author_association": "NONE", "body_html": "<p>I can't use the GLSTMCell to build a dynamic rnn. When I use the tf.contrib.rnn.GLSTMCell in tf.contrib.rnn.stack_bidirectional_dynamic_rnn() or tf.nn.dynamic_rnn(), like</p>\n<pre><code>rnn_outputs, _, _ = tf.contrib.rnn.stack_bidirectional_dynamic_rnn(\n[tf.contrib.rnn.GLSTMCell(num_units=self.num_hidden, num_proj=self.num_proj, number_of_groups=4) for _ in range(self.num_layers)],\n[tf.contrib.rnn.GLSTMCell(num_units=self.num_hidden, num_proj=self.num_proj, number_of_groups=4) for _ in range(self.num_layers)],\nself.rnn_inputs, dtype=tf.float32, sequence_length=self.rnn_seq_len, scope='BDDLSTM')\n</code></pre>\n<p>I got the error</p>\n<pre><code>Traceback (most recent call last):\nFile \"/home/frisasz/pycharm/helpers/pydev/pydevd.py\", line 1591, in &lt;module&gt;\nglobals = debugger.run(setup['file'], None, None, is_module)\nFile \"/home/frisasz/pycharm/helpers/pydev/pydevd.py\", line 1018, in run\npydev_imports.execfile(file, globals, locals)  # execute the script\nFile \"/media/frisasz/DATA/FSZ_Work/deep learning/IDOCR_/work/train.py\", line 171, in &lt;module&gt;\ntrain(train_dir='/media/frisasz/Windows/40T/', val_dir='../../0000/40V/')\nFile \"/media/frisasz/DATA/FSZ_Work/deep learning/IDOCR_/work/train.py\", line 41, in train\nFLAGS.momentum)\nFile \"/media/frisasz/DATA/FSZ_Work/deep learning/IDOCR_/work/model.py\", line 61, in __init__\nself.logits = self.rnn_net()\nFile \"/media/frisasz/DATA/FSZ_Work/deep learning/IDOCR_/work/model.py\", line 285, in rnn_net\noutputs, _ = tf.nn.dynamic_rnn(tf.contrib.rnn.GLSTMCell(self.num_hidden), self.rnn_inputs, self.rnn_seq_len, dtype=tf.float32)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 574, in dynamic_rnn\ndtype=dtype)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 737, in _dynamic_rnn_loop\nswap_memory=swap_memory)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2770, in while_loop\nresult = context.BuildLoop(cond, body, loop_vars, shape_invariants)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2599, in BuildLoop\npred, body, original_loop_vars, loop_vars, shape_invariants)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2549, in _BuildLoop\nbody_result = body(*packed_vars_for_body)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 720, in _time_step\nskip_conditionals=True)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 206, in _rnn_step\nnew_output, new_state = call_cell()\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 708, in &lt;lambda&gt;\ncall_cell = lambda: cell(input_t, state)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell_impl.py\", line 180, in __call__\nreturn super(RNNCell, self).__call__(inputs, state)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/layers/base.py\", line 441, in __call__\noutputs = self.call(inputs, *args, **kwargs)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/contrib/rnn/python/ops/rnn_cell.py\", line 2054, in call\nR_k = _linear(x_g_id, 4 * self._group_shape[1], bias=False)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell_impl.py\", line 1005, in _linear\n\"but saw %s\" % (shape, shape[1]))\nValueError: linear expects shape[1] to be provided for shape (?, ?), but saw ?\n</code></pre>\n<p>I'm not sure if this is the right way or it is a bug</p>", "body_text": "I can't use the GLSTMCell to build a dynamic rnn. When I use the tf.contrib.rnn.GLSTMCell in tf.contrib.rnn.stack_bidirectional_dynamic_rnn() or tf.nn.dynamic_rnn(), like\nrnn_outputs, _, _ = tf.contrib.rnn.stack_bidirectional_dynamic_rnn(\n[tf.contrib.rnn.GLSTMCell(num_units=self.num_hidden, num_proj=self.num_proj, number_of_groups=4) for _ in range(self.num_layers)],\n[tf.contrib.rnn.GLSTMCell(num_units=self.num_hidden, num_proj=self.num_proj, number_of_groups=4) for _ in range(self.num_layers)],\nself.rnn_inputs, dtype=tf.float32, sequence_length=self.rnn_seq_len, scope='BDDLSTM')\n\nI got the error\nTraceback (most recent call last):\nFile \"/home/frisasz/pycharm/helpers/pydev/pydevd.py\", line 1591, in <module>\nglobals = debugger.run(setup['file'], None, None, is_module)\nFile \"/home/frisasz/pycharm/helpers/pydev/pydevd.py\", line 1018, in run\npydev_imports.execfile(file, globals, locals)  # execute the script\nFile \"/media/frisasz/DATA/FSZ_Work/deep learning/IDOCR_/work/train.py\", line 171, in <module>\ntrain(train_dir='/media/frisasz/Windows/40T/', val_dir='../../0000/40V/')\nFile \"/media/frisasz/DATA/FSZ_Work/deep learning/IDOCR_/work/train.py\", line 41, in train\nFLAGS.momentum)\nFile \"/media/frisasz/DATA/FSZ_Work/deep learning/IDOCR_/work/model.py\", line 61, in __init__\nself.logits = self.rnn_net()\nFile \"/media/frisasz/DATA/FSZ_Work/deep learning/IDOCR_/work/model.py\", line 285, in rnn_net\noutputs, _ = tf.nn.dynamic_rnn(tf.contrib.rnn.GLSTMCell(self.num_hidden), self.rnn_inputs, self.rnn_seq_len, dtype=tf.float32)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 574, in dynamic_rnn\ndtype=dtype)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 737, in _dynamic_rnn_loop\nswap_memory=swap_memory)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2770, in while_loop\nresult = context.BuildLoop(cond, body, loop_vars, shape_invariants)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2599, in BuildLoop\npred, body, original_loop_vars, loop_vars, shape_invariants)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2549, in _BuildLoop\nbody_result = body(*packed_vars_for_body)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 720, in _time_step\nskip_conditionals=True)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 206, in _rnn_step\nnew_output, new_state = call_cell()\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 708, in <lambda>\ncall_cell = lambda: cell(input_t, state)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell_impl.py\", line 180, in __call__\nreturn super(RNNCell, self).__call__(inputs, state)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/layers/base.py\", line 441, in __call__\noutputs = self.call(inputs, *args, **kwargs)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/contrib/rnn/python/ops/rnn_cell.py\", line 2054, in call\nR_k = _linear(x_g_id, 4 * self._group_shape[1], bias=False)\nFile \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell_impl.py\", line 1005, in _linear\n\"but saw %s\" % (shape, shape[1]))\nValueError: linear expects shape[1] to be provided for shape (?, ?), but saw ?\n\nI'm not sure if this is the right way or it is a bug", "body": "I can't use the GLSTMCell to build a dynamic rnn. When I use the tf.contrib.rnn.GLSTMCell in tf.contrib.rnn.stack_bidirectional_dynamic_rnn() or tf.nn.dynamic_rnn(), like\r\n\r\n    rnn_outputs, _, _ = tf.contrib.rnn.stack_bidirectional_dynamic_rnn(\r\n    [tf.contrib.rnn.GLSTMCell(num_units=self.num_hidden, num_proj=self.num_proj, number_of_groups=4) for _ in range(self.num_layers)],\r\n    [tf.contrib.rnn.GLSTMCell(num_units=self.num_hidden, num_proj=self.num_proj, number_of_groups=4) for _ in range(self.num_layers)],\r\n    self.rnn_inputs, dtype=tf.float32, sequence_length=self.rnn_seq_len, scope='BDDLSTM')\r\n\r\n\r\nI got the error\r\n\r\n    Traceback (most recent call last):\r\n    File \"/home/frisasz/pycharm/helpers/pydev/pydevd.py\", line 1591, in <module>\r\n    globals = debugger.run(setup['file'], None, None, is_module)\r\n    File \"/home/frisasz/pycharm/helpers/pydev/pydevd.py\", line 1018, in run\r\n    pydev_imports.execfile(file, globals, locals)  # execute the script\r\n    File \"/media/frisasz/DATA/FSZ_Work/deep learning/IDOCR_/work/train.py\", line 171, in <module>\r\n    train(train_dir='/media/frisasz/Windows/40T/', val_dir='../../0000/40V/')\r\n    File \"/media/frisasz/DATA/FSZ_Work/deep learning/IDOCR_/work/train.py\", line 41, in train\r\n    FLAGS.momentum)\r\n    File \"/media/frisasz/DATA/FSZ_Work/deep learning/IDOCR_/work/model.py\", line 61, in __init__\r\n    self.logits = self.rnn_net()\r\n    File \"/media/frisasz/DATA/FSZ_Work/deep learning/IDOCR_/work/model.py\", line 285, in rnn_net\r\n    outputs, _ = tf.nn.dynamic_rnn(tf.contrib.rnn.GLSTMCell(self.num_hidden), self.rnn_inputs, self.rnn_seq_len, dtype=tf.float32)\r\n    File \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 574, in dynamic_rnn\r\n    dtype=dtype)\r\n    File \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 737, in _dynamic_rnn_loop\r\n    swap_memory=swap_memory)\r\n    File \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2770, in while_loop\r\n    result = context.BuildLoop(cond, body, loop_vars, shape_invariants)\r\n    File \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2599, in BuildLoop\r\n    pred, body, original_loop_vars, loop_vars, shape_invariants)\r\n    File \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2549, in _BuildLoop\r\n    body_result = body(*packed_vars_for_body)\r\n    File \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 720, in _time_step\r\n    skip_conditionals=True)\r\n    File \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 206, in _rnn_step\r\n    new_output, new_state = call_cell()\r\n    File \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 708, in <lambda>\r\n    call_cell = lambda: cell(input_t, state)\r\n    File \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell_impl.py\", line 180, in __call__\r\n    return super(RNNCell, self).__call__(inputs, state)\r\n    File \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/layers/base.py\", line 441, in __call__\r\n    outputs = self.call(inputs, *args, **kwargs)\r\n    File \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/contrib/rnn/python/ops/rnn_cell.py\", line 2054, in call\r\n    R_k = _linear(x_g_id, 4 * self._group_shape[1], bias=False)\r\n    File \"/home/frisasz/miniconda2/envs/dl/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell_impl.py\", line 1005, in _linear\r\n    \"but saw %s\" % (shape, shape[1]))\r\n    ValueError: linear expects shape[1] to be provided for shape (?, ?), but saw ?\r\n\r\nI'm not sure if this is the right way or it is a bug"}