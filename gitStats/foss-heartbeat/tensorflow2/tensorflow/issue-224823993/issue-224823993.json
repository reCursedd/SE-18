{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9489", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9489/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9489/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9489/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/9489", "id": 224823993, "node_id": "MDU6SXNzdWUyMjQ4MjM5OTM=", "number": 9489, "title": "failed to create cublas handle: CUBLAS_STATUS_NOT_INITIALIZED", "user": {"login": "chuchuhao", "id": 13161274, "node_id": "MDQ6VXNlcjEzMTYxMjc0", "avatar_url": "https://avatars1.githubusercontent.com/u/13161274?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chuchuhao", "html_url": "https://github.com/chuchuhao", "followers_url": "https://api.github.com/users/chuchuhao/followers", "following_url": "https://api.github.com/users/chuchuhao/following{/other_user}", "gists_url": "https://api.github.com/users/chuchuhao/gists{/gist_id}", "starred_url": "https://api.github.com/users/chuchuhao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chuchuhao/subscriptions", "organizations_url": "https://api.github.com/users/chuchuhao/orgs", "repos_url": "https://api.github.com/users/chuchuhao/repos", "events_url": "https://api.github.com/users/chuchuhao/events{/privacy}", "received_events_url": "https://api.github.com/users/chuchuhao/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}, {"id": 473173351, "node_id": "MDU6TGFiZWw0NzMxNzMzNTE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:build/install", "name": "type:build/install", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 17, "created_at": "2017-04-27T15:33:41Z", "updated_at": "2018-08-30T18:23:07Z", "closed_at": "2017-06-16T22:17:58Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:</li>\n</ul>\n<pre><code>Linux 4.4.0-75-generic #96-Ubuntu SMP Thu Apr 20 09:56:33 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\n</code></pre>\n<ul>\n<li><strong>TensorFlow version (use command below)</strong>:</li>\n</ul>\n<pre><code>I tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcublas.so.8.0 locally\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcudnn.so.5 locally\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcufft.so.8.0 locally\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcuda.so.1 locally\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcurand.so.8.0 locally\nv1.0.0-65-g4763edf-dirty 1.0.1\n</code></pre>\n<ul>\n<li>\n<p><strong>CUDA/cuDNN version</strong>:  8.0</p>\n</li>\n<li>\n<p><strong>GPU model and memory</strong>:</p>\n</li>\n</ul>\n<pre><code>name: GeForce GTX 980\nmajor: 5 minor: 2 memoryClockRate (GHz) 1.2785\npciBusID 0000:01:00.0\nTotal memory: 3.94GiB\nFree memory: 145.50MiB\n</code></pre>\n<h3>Describe the problem</h3>\n<p>If I change the order of device usage, it would report error</p>\n<h3>Source code / logs</h3>\n<ul>\n<li>If I use GPU first then CPU, it would be fine</li>\n</ul>\n<pre><code>with tf.device('/gpu:0'):\n    a = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[2, 3], name='a')\n    b = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[3, 2], name='b')\n    c = tf.matmul(a, b)\nwith tf.device('/cpu:0'):\n    e = tf.constant([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18], shape=[2, 9],dtype=tf.float32, name='e')\n    f = tf.matmul(c,e)\nsess = tf.Session(config=tf.ConfigProto(log_device_placement=True))\nprint(sess.run(f))\n</code></pre>\n<ul>\n<li>But if I use CPU first then GPU, it return error</li>\n</ul>\n<pre><code>with tf.device('/cpu:0'):\n    a = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[2, 3], name='a')\n    b = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[3, 2], name='b')\n    c = tf.matmul(a, b)\nwith tf.device('/gpu:0'):\n    e = tf.constant([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18], shape=[2, 9],dtype=tf.float32, name='e')\n    f = tf.matmul(c,e)\nsess = tf.Session(config=tf.ConfigProto(log_device_placement=True))\nprint(sess.run(f))\n</code></pre>\n<ul>\n<li>the error dump below</li>\n</ul>\n<pre><code>    print(sess.run(f))\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 767, in run\n    run_metadata_ptr)\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 965, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1015, in _do_run\n    target_list, options, run_metadata)\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1035, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InternalError: Blas SGEMM launch failed : a.shape=(2, 2), b.shape=(2, 9), m=2, n=9, k=2\n         [[Node: MatMul_1 = MatMul[T=DT_FLOAT, transpose_a=false, transpose_b=false, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](MatMul/_1, e)]]\n\nCaused by op 'MatMul_1', defined at:\n  File \"m1_n0teb00k/tensorflow_palyground.py\", line 13, in &lt;module&gt;\n    f = tf.matmul(c,e)\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/ops/math_ops.py\", line 1765, in matmul\n    a, b, transpose_a=transpose_a, transpose_b=transpose_b, name=name)\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 1454, in _mat_mul\n    transpose_b=transpose_b, name=name)\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\n    op_def=op_def)\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2327, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1226, in __init__\n    self._traceback = _extract_stack()\n\nInternalError (see above for traceback): Blas SGEMM launch failed : a.shape=(2, 2), b.shape=(2, 9), m=2, n=9, k=2\n         [[Node: MatMul_1 = MatMul[T=DT_FLOAT, transpose_a=false, transpose_b=false, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](MatMul/_1, e)]]\n</code></pre>", "body_text": "System information\n\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\n\nLinux 4.4.0-75-generic #96-Ubuntu SMP Thu Apr 20 09:56:33 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\n\n\nTensorFlow version (use command below):\n\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcublas.so.8.0 locally\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcudnn.so.5 locally\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcufft.so.8.0 locally\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcuda.so.1 locally\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcurand.so.8.0 locally\nv1.0.0-65-g4763edf-dirty 1.0.1\n\n\n\nCUDA/cuDNN version:  8.0\n\n\nGPU model and memory:\n\n\nname: GeForce GTX 980\nmajor: 5 minor: 2 memoryClockRate (GHz) 1.2785\npciBusID 0000:01:00.0\nTotal memory: 3.94GiB\nFree memory: 145.50MiB\n\nDescribe the problem\nIf I change the order of device usage, it would report error\nSource code / logs\n\nIf I use GPU first then CPU, it would be fine\n\nwith tf.device('/gpu:0'):\n    a = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[2, 3], name='a')\n    b = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[3, 2], name='b')\n    c = tf.matmul(a, b)\nwith tf.device('/cpu:0'):\n    e = tf.constant([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18], shape=[2, 9],dtype=tf.float32, name='e')\n    f = tf.matmul(c,e)\nsess = tf.Session(config=tf.ConfigProto(log_device_placement=True))\nprint(sess.run(f))\n\n\nBut if I use CPU first then GPU, it return error\n\nwith tf.device('/cpu:0'):\n    a = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[2, 3], name='a')\n    b = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[3, 2], name='b')\n    c = tf.matmul(a, b)\nwith tf.device('/gpu:0'):\n    e = tf.constant([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18], shape=[2, 9],dtype=tf.float32, name='e')\n    f = tf.matmul(c,e)\nsess = tf.Session(config=tf.ConfigProto(log_device_placement=True))\nprint(sess.run(f))\n\n\nthe error dump below\n\n    print(sess.run(f))\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 767, in run\n    run_metadata_ptr)\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 965, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1015, in _do_run\n    target_list, options, run_metadata)\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1035, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InternalError: Blas SGEMM launch failed : a.shape=(2, 2), b.shape=(2, 9), m=2, n=9, k=2\n         [[Node: MatMul_1 = MatMul[T=DT_FLOAT, transpose_a=false, transpose_b=false, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](MatMul/_1, e)]]\n\nCaused by op 'MatMul_1', defined at:\n  File \"m1_n0teb00k/tensorflow_palyground.py\", line 13, in <module>\n    f = tf.matmul(c,e)\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/ops/math_ops.py\", line 1765, in matmul\n    a, b, transpose_a=transpose_a, transpose_b=transpose_b, name=name)\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 1454, in _mat_mul\n    transpose_b=transpose_b, name=name)\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\n    op_def=op_def)\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2327, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1226, in __init__\n    self._traceback = _extract_stack()\n\nInternalError (see above for traceback): Blas SGEMM launch failed : a.shape=(2, 2), b.shape=(2, 9), m=2, n=9, k=2\n         [[Node: MatMul_1 = MatMul[T=DT_FLOAT, transpose_a=false, transpose_b=false, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](MatMul/_1, e)]]", "body": "### System information\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\n```\r\nLinux 4.4.0-75-generic #96-Ubuntu SMP Thu Apr 20 09:56:33 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n- **TensorFlow version (use command below)**:\r\n```\r\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcublas.so.8.0 locally\r\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcudnn.so.5 locally\r\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcufft.so.8.0 locally\r\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcuda.so.1 locally\r\nI tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcurand.so.8.0 locally\r\nv1.0.0-65-g4763edf-dirty 1.0.1\r\n```\r\n- **CUDA/cuDNN version**:  8.0\r\n\r\n- **GPU model and memory**:\r\n```\r\nname: GeForce GTX 980\r\nmajor: 5 minor: 2 memoryClockRate (GHz) 1.2785\r\npciBusID 0000:01:00.0\r\nTotal memory: 3.94GiB\r\nFree memory: 145.50MiB\r\n```\r\n\r\n### Describe the problem\r\nIf I change the order of device usage, it would report error \r\n\r\n### Source code / logs\r\n- If I use GPU first then CPU, it would be fine\r\n```\r\nwith tf.device('/gpu:0'):\r\n    a = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[2, 3], name='a')\r\n    b = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[3, 2], name='b')\r\n    c = tf.matmul(a, b)\r\nwith tf.device('/cpu:0'):\r\n    e = tf.constant([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18], shape=[2, 9],dtype=tf.float32, name='e')\r\n    f = tf.matmul(c,e)\r\nsess = tf.Session(config=tf.ConfigProto(log_device_placement=True))\r\nprint(sess.run(f))\r\n```\r\n- But if I use CPU first then GPU, it return error\r\n```\r\nwith tf.device('/cpu:0'):\r\n    a = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[2, 3], name='a')\r\n    b = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[3, 2], name='b')\r\n    c = tf.matmul(a, b)\r\nwith tf.device('/gpu:0'):\r\n    e = tf.constant([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18], shape=[2, 9],dtype=tf.float32, name='e')\r\n    f = tf.matmul(c,e)\r\nsess = tf.Session(config=tf.ConfigProto(log_device_placement=True))\r\nprint(sess.run(f))\r\n```\r\n- the error dump below\r\n```\r\n    print(sess.run(f))\r\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 767, in run\r\n    run_metadata_ptr)\r\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 965, in _run\r\n    feed_dict_string, options, run_metadata)\r\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1015, in _do_run\r\n    target_list, options, run_metadata)\r\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1035, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InternalError: Blas SGEMM launch failed : a.shape=(2, 2), b.shape=(2, 9), m=2, n=9, k=2\r\n         [[Node: MatMul_1 = MatMul[T=DT_FLOAT, transpose_a=false, transpose_b=false, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](MatMul/_1, e)]]\r\n\r\nCaused by op 'MatMul_1', defined at:\r\n  File \"m1_n0teb00k/tensorflow_palyground.py\", line 13, in <module>\r\n    f = tf.matmul(c,e)\r\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/ops/math_ops.py\", line 1765, in matmul\r\n    a, b, transpose_a=transpose_a, transpose_b=transpose_b, name=name)\r\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 1454, in _mat_mul\r\n    transpose_b=transpose_b, name=name)\r\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\r\n    op_def=op_def)\r\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2327, in create_op\r\n    original_op=self._default_original_op, op_def=op_def)\r\n  File \"/home/pika/.local/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1226, in __init__\r\n    self._traceback = _extract_stack()\r\n\r\nInternalError (see above for traceback): Blas SGEMM launch failed : a.shape=(2, 2), b.shape=(2, 9), m=2, n=9, k=2\r\n         [[Node: MatMul_1 = MatMul[T=DT_FLOAT, transpose_a=false, transpose_b=false, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](MatMul/_1, e)]]\r\n```"}