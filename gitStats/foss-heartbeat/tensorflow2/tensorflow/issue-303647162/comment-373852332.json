{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/373852332", "html_url": "https://github.com/tensorflow/tensorflow/issues/17571#issuecomment-373852332", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17571", "id": 373852332, "node_id": "MDEyOklzc3VlQ29tbWVudDM3Mzg1MjMzMg==", "user": {"login": "knathanieltucker", "id": 4574574, "node_id": "MDQ6VXNlcjQ1NzQ1NzQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/4574574?v=4", "gravatar_id": "", "url": "https://api.github.com/users/knathanieltucker", "html_url": "https://github.com/knathanieltucker", "followers_url": "https://api.github.com/users/knathanieltucker/followers", "following_url": "https://api.github.com/users/knathanieltucker/following{/other_user}", "gists_url": "https://api.github.com/users/knathanieltucker/gists{/gist_id}", "starred_url": "https://api.github.com/users/knathanieltucker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/knathanieltucker/subscriptions", "organizations_url": "https://api.github.com/users/knathanieltucker/orgs", "repos_url": "https://api.github.com/users/knathanieltucker/repos", "events_url": "https://api.github.com/users/knathanieltucker/events{/privacy}", "received_events_url": "https://api.github.com/users/knathanieltucker/received_events", "type": "User", "site_admin": false}, "created_at": "2018-03-16T21:39:43Z", "updated_at": "2018-03-16T21:39:43Z", "author_association": "NONE", "body_html": "<p>Just a small followup here. I have gone ahead and added image summaries to the model, however I am unable to output image summaries to TB with the evaluation hook:</p>\n<pre><code>    est = tf.keras.estimator.model_to_estimator(\n        keras_model=model, model_dir=model_dir)\n\n    eval_summary_hook = tf.train.SummarySaverHook(save_steps=validation_steps,\n                                                  output_dir=os.path.join(\n                                                      model_dir, 'test_images'),\n                                                  summary_op=tf.summary.merge_all())\n\n    for _ in range(epochs):\n        est.train(lambda: make_train_iter(\n            'image_input'), steps=steps_per_epoch)\n        est.evaluate(lambda: make_test_iter('image_input'),\n                     steps=validation_steps, name='test', hooks=[eval_summary_hook])\n</code></pre>\n<p>The error I get is:</p>\n<p><code>ValueError: Fetch argument &lt;tf.Tensor 'Merge/MergeSummary:0' shape=() dtype=string&gt; cannot be interpreted as a Tensor. (Tensor Tensor(\"Merge/MergeSummary:0\", shape=(), dtype=string) is not an element of this graph.)</code></p>\n<p>This seems to imply the summaries that I merged from the keras estimator originally are forgotten when keras clones the model, so I only reference the old summaries. Super related to: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"281654334\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/15332\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/15332/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/15332\">#15332</a></p>", "body_text": "Just a small followup here. I have gone ahead and added image summaries to the model, however I am unable to output image summaries to TB with the evaluation hook:\n    est = tf.keras.estimator.model_to_estimator(\n        keras_model=model, model_dir=model_dir)\n\n    eval_summary_hook = tf.train.SummarySaverHook(save_steps=validation_steps,\n                                                  output_dir=os.path.join(\n                                                      model_dir, 'test_images'),\n                                                  summary_op=tf.summary.merge_all())\n\n    for _ in range(epochs):\n        est.train(lambda: make_train_iter(\n            'image_input'), steps=steps_per_epoch)\n        est.evaluate(lambda: make_test_iter('image_input'),\n                     steps=validation_steps, name='test', hooks=[eval_summary_hook])\n\nThe error I get is:\nValueError: Fetch argument <tf.Tensor 'Merge/MergeSummary:0' shape=() dtype=string> cannot be interpreted as a Tensor. (Tensor Tensor(\"Merge/MergeSummary:0\", shape=(), dtype=string) is not an element of this graph.)\nThis seems to imply the summaries that I merged from the keras estimator originally are forgotten when keras clones the model, so I only reference the old summaries. Super related to: #15332", "body": "Just a small followup here. I have gone ahead and added image summaries to the model, however I am unable to output image summaries to TB with the evaluation hook:\r\n\r\n```\r\n    est = tf.keras.estimator.model_to_estimator(\r\n        keras_model=model, model_dir=model_dir)\r\n\r\n    eval_summary_hook = tf.train.SummarySaverHook(save_steps=validation_steps,\r\n                                                  output_dir=os.path.join(\r\n                                                      model_dir, 'test_images'),\r\n                                                  summary_op=tf.summary.merge_all())\r\n\r\n    for _ in range(epochs):\r\n        est.train(lambda: make_train_iter(\r\n            'image_input'), steps=steps_per_epoch)\r\n        est.evaluate(lambda: make_test_iter('image_input'),\r\n                     steps=validation_steps, name='test', hooks=[eval_summary_hook])\r\n```\r\n\r\nThe error I get is: \r\n\r\n`ValueError: Fetch argument <tf.Tensor 'Merge/MergeSummary:0' shape=() dtype=string> cannot be interpreted as a Tensor. (Tensor Tensor(\"Merge/MergeSummary:0\", shape=(), dtype=string) is not an element of this graph.)`\r\n\r\nThis seems to imply the summaries that I merged from the keras estimator originally are forgotten when keras clones the model, so I only reference the old summaries. Super related to: #15332"}