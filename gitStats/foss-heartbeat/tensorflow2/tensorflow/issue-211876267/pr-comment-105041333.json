{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/105041333", "pull_request_review_id": 25902926, "id": 105041333, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEwNTA0MTMzMw==", "diff_hunk": "@@ -147,6 +147,10 @@ Status HadoopFileSystem::Connect(StringPiece fname, hdfsFS* fs) {\n   hdfsBuilder* builder = hdfs_->hdfsNewBuilder();\n   if (scheme == \"file\") {\n     hdfs_->hdfsBuilderSetNameNode(builder, nullptr);\n+  } else if (scheme == \"viewfs\") {\n+    // The default NameNode configuration will be used (from the XML configuration files). See:\n+    // https://github.com/tensorflow/tensorflow/blob/v1.0.0/third_party/hadoop/hdfs.h#L259\n+    hdfs_->hdfsBuilderSetNameNode(builder, \"default\");", "path": "tensorflow/core/platform/hadoop/hadoop_file_system.cc", "position": null, "original_position": 7, "commit_id": "46267b2daf4e57bb4e24d57da6a879ffab695b45", "original_commit_id": "981c84bdf31b6351b0c1c569a3c28696c3c3c600", "user": {"login": "jhseu", "id": 170179, "node_id": "MDQ6VXNlcjE3MDE3OQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/170179?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhseu", "html_url": "https://github.com/jhseu", "followers_url": "https://api.github.com/users/jhseu/followers", "following_url": "https://api.github.com/users/jhseu/following{/other_user}", "gists_url": "https://api.github.com/users/jhseu/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhseu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhseu/subscriptions", "organizations_url": "https://api.github.com/users/jhseu/orgs", "repos_url": "https://api.github.com/users/jhseu/repos", "events_url": "https://api.github.com/users/jhseu/events{/privacy}", "received_events_url": "https://api.github.com/users/jhseu/received_events", "type": "User", "site_admin": false}, "body": "Right, but that only works if `fs.defaultFS` is set, right? There's no way to refer to another cluster here, and it'll always use the default one.\r\n\r\nSuppose `fs.defaultFS` is set to `viewfs://cluster4`. If someone refers to a file: `viewfs:///foo/bar`, that'll point to `viewfs://cluster4/foo/bar`. With this change, if someone uses `viewfs://cluster5/foo/bar`, that'll also point to `viewfs://cluster4/foo/bar` because cluster4 is the defaultFS.\r\n\r\nI couldn't figure out how to pass the viewfs cluster to the HDFS C API. If we can't, how about checking that nn is an empty string, otherwise return an error? That way viewfs is only supported as a defaultFS.", "created_at": "2017-03-08T22:31:26Z", "updated_at": "2017-03-12T08:47:16Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/8079#discussion_r105041333", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/8079", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/105041333"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/8079#discussion_r105041333"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/8079"}}, "body_html": "<p>Right, but that only works if <code>fs.defaultFS</code> is set, right? There's no way to refer to another cluster here, and it'll always use the default one.</p>\n<p>Suppose <code>fs.defaultFS</code> is set to <code>viewfs://cluster4</code>. If someone refers to a file: <code>viewfs:///foo/bar</code>, that'll point to <code>viewfs://cluster4/foo/bar</code>. With this change, if someone uses <code>viewfs://cluster5/foo/bar</code>, that'll also point to <code>viewfs://cluster4/foo/bar</code> because cluster4 is the defaultFS.</p>\n<p>I couldn't figure out how to pass the viewfs cluster to the HDFS C API. If we can't, how about checking that nn is an empty string, otherwise return an error? That way viewfs is only supported as a defaultFS.</p>", "body_text": "Right, but that only works if fs.defaultFS is set, right? There's no way to refer to another cluster here, and it'll always use the default one.\nSuppose fs.defaultFS is set to viewfs://cluster4. If someone refers to a file: viewfs:///foo/bar, that'll point to viewfs://cluster4/foo/bar. With this change, if someone uses viewfs://cluster5/foo/bar, that'll also point to viewfs://cluster4/foo/bar because cluster4 is the defaultFS.\nI couldn't figure out how to pass the viewfs cluster to the HDFS C API. If we can't, how about checking that nn is an empty string, otherwise return an error? That way viewfs is only supported as a defaultFS.", "in_reply_to_id": 104853374}