{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6319", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6319/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6319/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6319/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/6319", "id": 195659517, "node_id": "MDU6SXNzdWUxOTU2NTk1MTc=", "number": 6319, "title": "Occasional \"Connection timed out\" in distributed TensorFlow", "user": {"login": "yaroslavvb", "id": 23068, "node_id": "MDQ6VXNlcjIzMDY4", "avatar_url": "https://avatars3.githubusercontent.com/u/23068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yaroslavvb", "html_url": "https://github.com/yaroslavvb", "followers_url": "https://api.github.com/users/yaroslavvb/followers", "following_url": "https://api.github.com/users/yaroslavvb/following{/other_user}", "gists_url": "https://api.github.com/users/yaroslavvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/yaroslavvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yaroslavvb/subscriptions", "organizations_url": "https://api.github.com/users/yaroslavvb/orgs", "repos_url": "https://api.github.com/users/yaroslavvb/repos", "events_url": "https://api.github.com/users/yaroslavvb/events{/privacy}", "received_events_url": "https://api.github.com/users/yaroslavvb/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-12-14T22:07:20Z", "updated_at": "2016-12-15T17:28:27Z", "closed_at": "2016-12-15T05:14:15Z", "author_association": "CONTRIBUTOR", "body_html": "<p>We are occasionally observing crashes like below (training on AWS, seeing couple of crashes per day). It looks like in gRPC, recvmsg returns with \"Connection timed out\". The error points to <a href=\"https://github.com/grpc/grpc/blob/a98778f33dc602ad474b19e2f5243972722e758e/src/core/lib/iomgr/tcp_posix.c#L224\">this line</a>. Default behavior in TensorFlow seems to be \"wait forever\", is there way to have same behavior for slow grpc connections?</p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=192142\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/mrry\">@mrry</a></p>\n<pre><code>Traceback (most recent call last):\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/client/session.py\", line 972, in _do_call\n    return fn(*args)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/client/session.py\", line 954, in _run_fn\n    status, run_metadata)\n  File \"/usr/lib/python3.5/contextlib.py\", line 66, in __exit__\n    next(self.gen)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/errors.py\", line 463, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors.UnavailableError: {\"created\":\"@1481750298.553120216\",\"description\":\"OS Error\",\"errno\":110,\"file\":\"external/grpc/src/core/lib/iomgr/tcp_posix.c\",\"file_line\":229,\"grpc_status\":14,\"os_error\":\"Connection timed out\",\"syscall\":\"recvmsg\"}\n     [[Node: ExponentialMovingAverage/decay_S37 = _Recv[client_terminated=false, recv_device=\"/job:ps/replica:0/task:0/cpu:0\", send_device=\"/job:worker/replica:0/task:2/cpu:0\", send_device_incarnation=3009888913849196393, tensor_name=\"edge_1032_ExponentialMovingAverage/decay\", tensor_type=DT_FLOAT, _device=\"/job:ps/replica:0/task:0/cpu:0\"]()]]\n     [[Node: gradients/truediv_grad/Shape_1_S63 = _HostRecv[client_terminated=false, recv_device=\"/job:worker/replica:0/task:2/cpu:0\", send_device=\"/job:ps/replica:0/task:0/cpu:0\", send_device_incarnation=-6688974477600735349, tensor_name=\"edge_115_gradients/truediv_grad/Shape_1\", tensor_type=DT_INT32, _device=\"/job:worker/replica:0/task:2/cpu:0\"]()]]\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"bin/worker\", line 231, in &lt;module&gt;\n    tf.app.run()\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv[:1] + flags_passthrough))\n  File \"bin/worker\", line 228, in main\n    run_generic(server, args, trainer, num_global_steps=num_global_steps)\n  File \"bin/worker\", line 152, in run_generic\n    trainer.process(sess)\n  File \"/experiment/vnc-agents/trainers/base.py\", line 351, in process\n    fetched = sess.run(fetches, feed_dict=feed_dict)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/client/session.py\", line 717, in run\n    run_metadata_ptr)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/client/session.py\", line 915, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/client/session.py\", line 965, in _do_run\n    target_list, options, run_metadata)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/client/session.py\", line 985, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors.UnavailableError: {\"created\":\"@1481750298.553120216\",\"description\":\"OS Error\",\"errno\":110,\"file\":\"external/grpc/src/core/lib/iomgr/tcp_posix.c\",\"file_line\":229,\"grpc_status\":14,\"os_error\":\"Connection timed out\",\"syscall\":\"recvmsg\"}\n     [[Node: ExponentialMovingAverage/decay_S37 = _Recv[client_terminated=false, recv_device=\"/job:ps/replica:0/task:0/cpu:0\", send_device=\"/job:worker/replica:0/task:2/cpu:0\", send_device_incarnation=3009888913849196393, tensor_name=\"edge_1032_ExponentialMovingAverage/decay\", tensor_type=DT_FLOAT, _device=\"/job:ps/replica:0/task:0/cpu:0\"]()]]\n     [[Node: gradients/truediv_grad/Shape_1_S63 = _HostRecv[client_terminated=false, recv_device=\"/job:worker/replica:0/task:2/cpu:0\", send_device=\"/job:ps/replica:0/task:0/cpu:0\", send_device_incarnation=-6688974477600735349, tensor_name=\"edge_115_gradients/truediv_grad/Shape_1\", tensor_type=DT_INT32, _device=\"/job:worker/replica:0/task:2/cpu:0\"]()]]\n</code></pre>", "body_text": "We are occasionally observing crashes like below (training on AWS, seeing couple of crashes per day). It looks like in gRPC, recvmsg returns with \"Connection timed out\". The error points to this line. Default behavior in TensorFlow seems to be \"wait forever\", is there way to have same behavior for slow grpc connections?\n@mrry\nTraceback (most recent call last):\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/client/session.py\", line 972, in _do_call\n    return fn(*args)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/client/session.py\", line 954, in _run_fn\n    status, run_metadata)\n  File \"/usr/lib/python3.5/contextlib.py\", line 66, in __exit__\n    next(self.gen)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/errors.py\", line 463, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors.UnavailableError: {\"created\":\"@1481750298.553120216\",\"description\":\"OS Error\",\"errno\":110,\"file\":\"external/grpc/src/core/lib/iomgr/tcp_posix.c\",\"file_line\":229,\"grpc_status\":14,\"os_error\":\"Connection timed out\",\"syscall\":\"recvmsg\"}\n     [[Node: ExponentialMovingAverage/decay_S37 = _Recv[client_terminated=false, recv_device=\"/job:ps/replica:0/task:0/cpu:0\", send_device=\"/job:worker/replica:0/task:2/cpu:0\", send_device_incarnation=3009888913849196393, tensor_name=\"edge_1032_ExponentialMovingAverage/decay\", tensor_type=DT_FLOAT, _device=\"/job:ps/replica:0/task:0/cpu:0\"]()]]\n     [[Node: gradients/truediv_grad/Shape_1_S63 = _HostRecv[client_terminated=false, recv_device=\"/job:worker/replica:0/task:2/cpu:0\", send_device=\"/job:ps/replica:0/task:0/cpu:0\", send_device_incarnation=-6688974477600735349, tensor_name=\"edge_115_gradients/truediv_grad/Shape_1\", tensor_type=DT_INT32, _device=\"/job:worker/replica:0/task:2/cpu:0\"]()]]\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"bin/worker\", line 231, in <module>\n    tf.app.run()\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv[:1] + flags_passthrough))\n  File \"bin/worker\", line 228, in main\n    run_generic(server, args, trainer, num_global_steps=num_global_steps)\n  File \"bin/worker\", line 152, in run_generic\n    trainer.process(sess)\n  File \"/experiment/vnc-agents/trainers/base.py\", line 351, in process\n    fetched = sess.run(fetches, feed_dict=feed_dict)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/client/session.py\", line 717, in run\n    run_metadata_ptr)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/client/session.py\", line 915, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/client/session.py\", line 965, in _do_run\n    target_list, options, run_metadata)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/client/session.py\", line 985, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors.UnavailableError: {\"created\":\"@1481750298.553120216\",\"description\":\"OS Error\",\"errno\":110,\"file\":\"external/grpc/src/core/lib/iomgr/tcp_posix.c\",\"file_line\":229,\"grpc_status\":14,\"os_error\":\"Connection timed out\",\"syscall\":\"recvmsg\"}\n     [[Node: ExponentialMovingAverage/decay_S37 = _Recv[client_terminated=false, recv_device=\"/job:ps/replica:0/task:0/cpu:0\", send_device=\"/job:worker/replica:0/task:2/cpu:0\", send_device_incarnation=3009888913849196393, tensor_name=\"edge_1032_ExponentialMovingAverage/decay\", tensor_type=DT_FLOAT, _device=\"/job:ps/replica:0/task:0/cpu:0\"]()]]\n     [[Node: gradients/truediv_grad/Shape_1_S63 = _HostRecv[client_terminated=false, recv_device=\"/job:worker/replica:0/task:2/cpu:0\", send_device=\"/job:ps/replica:0/task:0/cpu:0\", send_device_incarnation=-6688974477600735349, tensor_name=\"edge_115_gradients/truediv_grad/Shape_1\", tensor_type=DT_INT32, _device=\"/job:worker/replica:0/task:2/cpu:0\"]()]]", "body": "We are occasionally observing crashes like below (training on AWS, seeing couple of crashes per day). It looks like in gRPC, recvmsg returns with \"Connection timed out\". The error points to [this line](https://github.com/grpc/grpc/blob/a98778f33dc602ad474b19e2f5243972722e758e/src/core/lib/iomgr/tcp_posix.c#L224). Default behavior in TensorFlow seems to be \"wait forever\", is there way to have same behavior for slow grpc connections?\r\n\r\n@mrry\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/client/session.py\", line 972, in _do_call\r\n    return fn(*args)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/client/session.py\", line 954, in _run_fn\r\n    status, run_metadata)\r\n  File \"/usr/lib/python3.5/contextlib.py\", line 66, in __exit__\r\n    next(self.gen)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/errors.py\", line 463, in raise_exception_on_not_ok_status\r\n    pywrap_tensorflow.TF_GetCode(status))\r\ntensorflow.python.framework.errors.UnavailableError: {\"created\":\"@1481750298.553120216\",\"description\":\"OS Error\",\"errno\":110,\"file\":\"external/grpc/src/core/lib/iomgr/tcp_posix.c\",\"file_line\":229,\"grpc_status\":14,\"os_error\":\"Connection timed out\",\"syscall\":\"recvmsg\"}\r\n     [[Node: ExponentialMovingAverage/decay_S37 = _Recv[client_terminated=false, recv_device=\"/job:ps/replica:0/task:0/cpu:0\", send_device=\"/job:worker/replica:0/task:2/cpu:0\", send_device_incarnation=3009888913849196393, tensor_name=\"edge_1032_ExponentialMovingAverage/decay\", tensor_type=DT_FLOAT, _device=\"/job:ps/replica:0/task:0/cpu:0\"]()]]\r\n     [[Node: gradients/truediv_grad/Shape_1_S63 = _HostRecv[client_terminated=false, recv_device=\"/job:worker/replica:0/task:2/cpu:0\", send_device=\"/job:ps/replica:0/task:0/cpu:0\", send_device_incarnation=-6688974477600735349, tensor_name=\"edge_115_gradients/truediv_grad/Shape_1\", tensor_type=DT_INT32, _device=\"/job:worker/replica:0/task:2/cpu:0\"]()]]\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"bin/worker\", line 231, in <module>\r\n    tf.app.run()\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/platform/app.py\", line 30, in run\r\n    sys.exit(main(sys.argv[:1] + flags_passthrough))\r\n  File \"bin/worker\", line 228, in main\r\n    run_generic(server, args, trainer, num_global_steps=num_global_steps)\r\n  File \"bin/worker\", line 152, in run_generic\r\n    trainer.process(sess)\r\n  File \"/experiment/vnc-agents/trainers/base.py\", line 351, in process\r\n    fetched = sess.run(fetches, feed_dict=feed_dict)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/client/session.py\", line 717, in run\r\n    run_metadata_ptr)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/client/session.py\", line 915, in _run\r\n    feed_dict_string, options, run_metadata)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/client/session.py\", line 965, in _do_run\r\n    target_list, options, run_metadata)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/client/session.py\", line 985, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors.UnavailableError: {\"created\":\"@1481750298.553120216\",\"description\":\"OS Error\",\"errno\":110,\"file\":\"external/grpc/src/core/lib/iomgr/tcp_posix.c\",\"file_line\":229,\"grpc_status\":14,\"os_error\":\"Connection timed out\",\"syscall\":\"recvmsg\"}\r\n     [[Node: ExponentialMovingAverage/decay_S37 = _Recv[client_terminated=false, recv_device=\"/job:ps/replica:0/task:0/cpu:0\", send_device=\"/job:worker/replica:0/task:2/cpu:0\", send_device_incarnation=3009888913849196393, tensor_name=\"edge_1032_ExponentialMovingAverage/decay\", tensor_type=DT_FLOAT, _device=\"/job:ps/replica:0/task:0/cpu:0\"]()]]\r\n     [[Node: gradients/truediv_grad/Shape_1_S63 = _HostRecv[client_terminated=false, recv_device=\"/job:worker/replica:0/task:2/cpu:0\", send_device=\"/job:ps/replica:0/task:0/cpu:0\", send_device_incarnation=-6688974477600735349, tensor_name=\"edge_115_gradients/truediv_grad/Shape_1\", tensor_type=DT_INT32, _device=\"/job:worker/replica:0/task:2/cpu:0\"]()]]\r\n```"}