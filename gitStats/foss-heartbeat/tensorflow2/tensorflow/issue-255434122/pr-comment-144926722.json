{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/144926722", "pull_request_review_id": 69643574, "id": 144926722, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0NDkyNjcyMg==", "diff_hunk": "@@ -81,22 +94,37 @@ def _VerifyValues(self, tensor_in_sizes, filter_in_sizes, stride, padding,\n                     expected):\n     results = []\n     for data_format, use_gpu in GetTestConfigs():\n-      result = self._SetupValuesForDevice(\n-          tensor_in_sizes,\n-          filter_in_sizes,\n-          stride,\n-          padding,\n-          data_format,\n-          use_gpu=use_gpu)\n-      results.append(result)\n-      tolerance = 1e-2 if use_gpu else 1e-5\n+      for dtype in self._DtypesToTest(use_gpu):\n+        result = self._SetupValuesForDevice(\n+            tensor_in_sizes,\n+            filter_in_sizes,\n+            stride,\n+            padding,\n+            data_format,\n+            dtype,\n+            use_gpu=use_gpu)\n+        results.append((result, use_gpu, dtype, data_format))\n+\n       with self.test_session() as sess:\n-        values = sess.run(results)\n-        for value in values:\n+        tensor_results = [result[0] for result in results]\n+        test_params = [result[1:] for result in results]\n+        values = sess.run(tensor_results)\n+        for i in range(len(tensor_results)):\n+          value = values[i]\n           print(\"expected = \", expected)\n           print(\"actual = \", value)\n-          self.assertAllClose(expected, value.flatten(), atol=tolerance,\n-                              rtol=1e-6)\n+          tol = 1e-6\n+          if value.dtype == np.float16:\n+            tol = 1e-3\n+            # fp16 using may result in inf values and large absolute errors\n+            # when used with large numbers (fp16 max is 65004.)\n+            if np.any(value > 1e4):", "path": "tensorflow/python/kernel_tests/conv_ops_3d_test.py", "position": null, "original_position": 82, "commit_id": "7bcf8a127c5c9141535b126ac6d32b7a2dbea841", "original_commit_id": "879ec7cf433d645121109584a997ab7dbc2b3296", "user": {"login": "reedwm", "id": 6510203, "node_id": "MDQ6VXNlcjY1MTAyMDM=", "avatar_url": "https://avatars2.githubusercontent.com/u/6510203?v=4", "gravatar_id": "", "url": "https://api.github.com/users/reedwm", "html_url": "https://github.com/reedwm", "followers_url": "https://api.github.com/users/reedwm/followers", "following_url": "https://api.github.com/users/reedwm/following{/other_user}", "gists_url": "https://api.github.com/users/reedwm/gists{/gist_id}", "starred_url": "https://api.github.com/users/reedwm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/reedwm/subscriptions", "organizations_url": "https://api.github.com/users/reedwm/orgs", "repos_url": "https://api.github.com/users/reedwm/repos", "events_url": "https://api.github.com/users/reedwm/events{/privacy}", "received_events_url": "https://api.github.com/users/reedwm/received_events", "type": "User", "site_admin": false}, "body": "As I stated before, this will skip some important tests, causing some things not to be tested. testConv3D2x2x2FilterStride2, testConv3DStride3, and testConv3D2x2x2FilterStride2Same and not run at all with this, so you should add more tests.\r\n\r\n@mjanusz, how were the expected outputs calculated for the original tests? It is a pain to add new tests since new expected outputs need to be calculated.", "created_at": "2017-10-16T18:18:40Z", "updated_at": "2017-10-25T22:56:52Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/12832#discussion_r144926722", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12832", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/144926722"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/12832#discussion_r144926722"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12832"}}, "body_html": "<p>As I stated before, this will skip some important tests, causing some things not to be tested. testConv3D2x2x2FilterStride2, testConv3DStride3, and testConv3D2x2x2FilterStride2Same and not run at all with this, so you should add more tests.</p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=328443\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/mjanusz\">@mjanusz</a>, how were the expected outputs calculated for the original tests? It is a pain to add new tests since new expected outputs need to be calculated.</p>", "body_text": "As I stated before, this will skip some important tests, causing some things not to be tested. testConv3D2x2x2FilterStride2, testConv3DStride3, and testConv3D2x2x2FilterStride2Same and not run at all with this, so you should add more tests.\n@mjanusz, how were the expected outputs calculated for the original tests? It is a pain to add new tests since new expected outputs need to be calculated."}