{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/145604852", "pull_request_review_id": 70428131, "id": 145604852, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0NTYwNDg1Mg==", "diff_hunk": "@@ -81,22 +94,37 @@ def _VerifyValues(self, tensor_in_sizes, filter_in_sizes, stride, padding,\n                     expected):\n     results = []\n     for data_format, use_gpu in GetTestConfigs():\n-      result = self._SetupValuesForDevice(\n-          tensor_in_sizes,\n-          filter_in_sizes,\n-          stride,\n-          padding,\n-          data_format,\n-          use_gpu=use_gpu)\n-      results.append(result)\n-      tolerance = 1e-2 if use_gpu else 1e-5\n+      for dtype in self._DtypesToTest(use_gpu):\n+        result = self._SetupValuesForDevice(\n+            tensor_in_sizes,\n+            filter_in_sizes,\n+            stride,\n+            padding,\n+            data_format,\n+            dtype,\n+            use_gpu=use_gpu)\n+        results.append((result, use_gpu, dtype, data_format))\n+\n       with self.test_session() as sess:\n-        values = sess.run(results)\n-        for value in values:\n+        tensor_results = [result[0] for result in results]\n+        test_params = [result[1:] for result in results]\n+        values = sess.run(tensor_results)\n+        for i in range(len(tensor_results)):\n+          value = values[i]\n           print(\"expected = \", expected)\n           print(\"actual = \", value)\n-          self.assertAllClose(expected, value.flatten(), atol=tolerance,\n-                              rtol=1e-6)\n+          tol = 1e-6\n+          if value.dtype == np.float16:\n+            tol = 1e-3\n+            # fp16 using may result in inf values and large absolute errors\n+            # when used with large numbers (fp16 max is 65004.)\n+            if np.any(value > 1e4):", "path": "tensorflow/python/kernel_tests/conv_ops_3d_test.py", "position": null, "original_position": 82, "commit_id": "7bcf8a127c5c9141535b126ac6d32b7a2dbea841", "original_commit_id": "879ec7cf433d645121109584a997ab7dbc2b3296", "user": {"login": "opensourcemattress", "id": 31660642, "node_id": "MDQ6VXNlcjMxNjYwNjQy", "avatar_url": "https://avatars1.githubusercontent.com/u/31660642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/opensourcemattress", "html_url": "https://github.com/opensourcemattress", "followers_url": "https://api.github.com/users/opensourcemattress/followers", "following_url": "https://api.github.com/users/opensourcemattress/following{/other_user}", "gists_url": "https://api.github.com/users/opensourcemattress/gists{/gist_id}", "starred_url": "https://api.github.com/users/opensourcemattress/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/opensourcemattress/subscriptions", "organizations_url": "https://api.github.com/users/opensourcemattress/orgs", "repos_url": "https://api.github.com/users/opensourcemattress/repos", "events_url": "https://api.github.com/users/opensourcemattress/events{/privacy}", "received_events_url": "https://api.github.com/users/opensourcemattress/received_events", "type": "User", "site_admin": false}, "body": "I made normalization of input and supposed  that current fp64 convs implemented correctly => I took them as reference value. It's not a good idea to test fp64 outputs by themselves but I not sure how to solve this problem in different way. \r\nIt's better just to have reference implementation and just compare outputs but it's additional code and we need more tests for tests, yes? :) ", "created_at": "2017-10-19T05:53:27Z", "updated_at": "2017-10-25T22:56:52Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/12832#discussion_r145604852", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12832", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/145604852"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/12832#discussion_r145604852"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12832"}}, "body_html": "<p>I made normalization of input and supposed  that current fp64 convs implemented correctly =&gt; I took them as reference value. It's not a good idea to test fp64 outputs by themselves but I not sure how to solve this problem in different way.<br>\nIt's better just to have reference implementation and just compare outputs but it's additional code and we need more tests for tests, yes? :)</p>", "body_text": "I made normalization of input and supposed  that current fp64 convs implemented correctly => I took them as reference value. It's not a good idea to test fp64 outputs by themselves but I not sure how to solve this problem in different way.\nIt's better just to have reference implementation and just compare outputs but it's additional code and we need more tests for tests, yes? :)", "in_reply_to_id": 144926722}