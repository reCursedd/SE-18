{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/141506565", "pull_request_review_id": 65727784, "id": 141506565, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0MTUwNjU2NQ==", "diff_hunk": "@@ -80,23 +90,42 @@ def _SetupValuesForDevice(self, tensor_in_sizes, filter_in_sizes, stride,\n   def _VerifyValues(self, tensor_in_sizes, filter_in_sizes, stride, padding,\n                     expected):\n     results = []\n-    for data_format, use_gpu in GetTestConfigs():\n-      result = self._SetupValuesForDevice(\n-          tensor_in_sizes,\n-          filter_in_sizes,\n-          stride,\n-          padding,\n-          data_format,\n-          use_gpu=use_gpu)\n-      results.append(result)\n-      tolerance = 1e-2 if use_gpu else 1e-5\n+    for (data_format, use_gpu) in GetTestConfigs():\n+      for dtype in self._DtypesToTest(use_gpu):\n+        result = self._SetupValuesForDevice(\n+            tensor_in_sizes,\n+            filter_in_sizes,\n+            stride,\n+            padding,\n+            data_format,\n+            dtype,\n+            use_gpu=use_gpu)\n+        results.append((result, use_gpu, dtype, data_format))\n+\n       with self.test_session() as sess:\n-        values = sess.run(results)\n-        for value in values:\n+        tensor_results = [result[0] for result in results]\n+        test_params = [result[1:] for result in results]\n+        values = sess.run(tensor_results)\n+        for i in range(len(tensor_results)):\n+          value = values[i]\n+          print(\"use_gpu:\", test_params[i][0])\n+          print(\"dtype:\", test_params[i][1])\n+          print(\"data_format:\", test_params[i][2])\n+\n           print(\"expected = \", expected)\n           print(\"actual = \", value)\n-          self.assertAllClose(expected, value.flatten(), atol=tolerance,\n-                              rtol=1e-6)\n+          tol = 1e-5\n+          if value.dtype == np.float16:\n+            tol = 1e-3\n+            # fp16 using may result in inf values and large absolute errors\n+            # when used with large numbers", "path": "tensorflow/python/kernel_tests/conv_ops_3d_test.py", "position": null, "original_position": 84, "commit_id": "7bcf8a127c5c9141535b126ac6d32b7a2dbea841", "original_commit_id": "0853d075ceaaaf18f5d8de35656635f9e4cd6845", "user": {"login": "yzhwang", "id": 1002405, "node_id": "MDQ6VXNlcjEwMDI0MDU=", "avatar_url": "https://avatars1.githubusercontent.com/u/1002405?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yzhwang", "html_url": "https://github.com/yzhwang", "followers_url": "https://api.github.com/users/yzhwang/followers", "following_url": "https://api.github.com/users/yzhwang/following{/other_user}", "gists_url": "https://api.github.com/users/yzhwang/gists{/gist_id}", "starred_url": "https://api.github.com/users/yzhwang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yzhwang/subscriptions", "organizations_url": "https://api.github.com/users/yzhwang/orgs", "repos_url": "https://api.github.com/users/yzhwang/repos", "events_url": "https://api.github.com/users/yzhwang/events{/privacy}", "received_events_url": "https://api.github.com/users/yzhwang/received_events", "type": "User", "site_admin": false}, "body": "Could you be more specific about large numbers? Or if you could change the value of the input tensors to make them smaller, that would be better. I'm worried that the skipped tests may affect our coverage.", "created_at": "2017-09-28T01:15:04Z", "updated_at": "2017-10-25T22:56:52Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/12832#discussion_r141506565", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12832", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/141506565"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/12832#discussion_r141506565"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12832"}}, "body_html": "<p>Could you be more specific about large numbers? Or if you could change the value of the input tensors to make them smaller, that would be better. I'm worried that the skipped tests may affect our coverage.</p>", "body_text": "Could you be more specific about large numbers? Or if you could change the value of the input tensors to make them smaller, that would be better. I'm worried that the skipped tests may affect our coverage."}