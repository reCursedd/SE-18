{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21033", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21033/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21033/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21033/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/21033", "id": 343405063, "node_id": "MDU6SXNzdWUzNDM0MDUwNjM=", "number": 21033, "title": "\u2018tf.train.shuffle_batch\u2019 problem", "user": {"login": "friedhelm739", "id": 35217522, "node_id": "MDQ6VXNlcjM1MjE3NTIy", "avatar_url": "https://avatars1.githubusercontent.com/u/35217522?v=4", "gravatar_id": "", "url": "https://api.github.com/users/friedhelm739", "html_url": "https://github.com/friedhelm739", "followers_url": "https://api.github.com/users/friedhelm739/followers", "following_url": "https://api.github.com/users/friedhelm739/following{/other_user}", "gists_url": "https://api.github.com/users/friedhelm739/gists{/gist_id}", "starred_url": "https://api.github.com/users/friedhelm739/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/friedhelm739/subscriptions", "organizations_url": "https://api.github.com/users/friedhelm739/orgs", "repos_url": "https://api.github.com/users/friedhelm739/repos", "events_url": "https://api.github.com/users/friedhelm739/events{/privacy}", "received_events_url": "https://api.github.com/users/friedhelm739/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "skye", "id": 88808, "node_id": "MDQ6VXNlcjg4ODA4", "avatar_url": "https://avatars1.githubusercontent.com/u/88808?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skye", "html_url": "https://github.com/skye", "followers_url": "https://api.github.com/users/skye/followers", "following_url": "https://api.github.com/users/skye/following{/other_user}", "gists_url": "https://api.github.com/users/skye/gists{/gist_id}", "starred_url": "https://api.github.com/users/skye/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skye/subscriptions", "organizations_url": "https://api.github.com/users/skye/orgs", "repos_url": "https://api.github.com/users/skye/repos", "events_url": "https://api.github.com/users/skye/events{/privacy}", "received_events_url": "https://api.github.com/users/skye/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "skye", "id": 88808, "node_id": "MDQ6VXNlcjg4ODA4", "avatar_url": "https://avatars1.githubusercontent.com/u/88808?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skye", "html_url": "https://github.com/skye", "followers_url": "https://api.github.com/users/skye/followers", "following_url": "https://api.github.com/users/skye/following{/other_user}", "gists_url": "https://api.github.com/users/skye/gists{/gist_id}", "starred_url": "https://api.github.com/users/skye/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skye/subscriptions", "organizations_url": "https://api.github.com/users/skye/orgs", "repos_url": "https://api.github.com/users/skye/repos", "events_url": "https://api.github.com/users/skye/events{/privacy}", "received_events_url": "https://api.github.com/users/skye/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2018-07-22T13:12:59Z", "updated_at": "2018-07-24T18:44:07Z", "closed_at": "2018-07-24T18:44:07Z", "author_association": "NONE", "body_html": "<p>When I train my face_detection model\uff0cI set 0 as my non-face label ,and 1 as face label .After building TFRecord dataset\uff0cI use 'image_batch, label_batch = tf.train.shuffle_batch ' ,it  is clear  that \u2018image_batch \u2019 corresponds to \u2018label_batch\u2019   .However,I found that \u2018image_batch \u2019 is not corresponding to \u2018label_batch\u2019. some non-face pictures'label is 1,and some face pictures' label is 0,why?<br>\nhere is my code:`import tensorflow as tf<br>\nimport time<br>\nimport matplotlib.pyplot as plt</p>\n<p>begin=time.time()<br>\nfilename_queue = tf.train.string_input_producer(['C:\\Users\\312\\Desktop\\Face_Detection\\ai.tfrecords'],shuffle=False)</p>\n<p>reader = tf.TFRecordReader()<br>\n_, serialized_example = reader.read(filename_queue)</p>\n<p>features = tf.parse_single_example(serialized_example,<br>\nfeatures={<br>\n'label':tf.FixedLenFeature([],tf.int64),<br>\n'img_raw':tf.FixedLenFeature([],tf.string),<br>\n})<br>\nimg=tf.decode_raw(features['img_raw'],tf.uint8)<br>\nimg = tf.reshape(img, [227,227,3])<br>\nlabel=tf.cast(features['label'],tf.int32)</p>\n<p>min_after_dequeue = 200<br>\nbatch_size = 128<br>\ncapacity = min_after_dequeue + 10 * batch_size<br>\nimage_batch, label_batch = tf.train.batch([img, label], batch_size=batch_size, capacity=capacity)</p>\n<p>image_batch, label_batch = tf.train.shuffle_batch(<br>\n[img, label],<br>\nbatch_size=32,<br>\nnum_threads=7,<br>\ncapacity=500,<br>\nmin_after_dequeue=200)</p>\n<p>with tf.Session() as sess:<br>\nsess.run((tf.global_variables_initializer(),<br>\ntf.local_variables_initializer()))<br>\ncoord = tf.train.Coordinator()<br>\nthreads = tf.train.start_queue_runners(sess=sess,coord=coord)<br>\nfor i in range(1):<br>\nlabel=sess.run(label)<br>\nlabel_batch=sess.run(label_batch)<br>\nimage_batch=sess.run(image_batch)</p>\n<pre><code>    for j in range(8):\n        plt.imshow(image_batch[j])\n        print(label_batch[j])\n        plt.show()\ncoord.request_stop()\ncoord.join(threads)\n</code></pre>\n<p>print(time.time()-begin)<br>\n`</p>", "body_text": "When I train my face_detection model\uff0cI set 0 as my non-face label ,and 1 as face label .After building TFRecord dataset\uff0cI use 'image_batch, label_batch = tf.train.shuffle_batch ' ,it  is clear  that \u2018image_batch \u2019 corresponds to \u2018label_batch\u2019   .However,I found that \u2018image_batch \u2019 is not corresponding to \u2018label_batch\u2019. some non-face pictures'label is 1,and some face pictures' label is 0,why?\nhere is my code:`import tensorflow as tf\nimport time\nimport matplotlib.pyplot as plt\nbegin=time.time()\nfilename_queue = tf.train.string_input_producer(['C:\\Users\\312\\Desktop\\Face_Detection\\ai.tfrecords'],shuffle=False)\nreader = tf.TFRecordReader()\n_, serialized_example = reader.read(filename_queue)\nfeatures = tf.parse_single_example(serialized_example,\nfeatures={\n'label':tf.FixedLenFeature([],tf.int64),\n'img_raw':tf.FixedLenFeature([],tf.string),\n})\nimg=tf.decode_raw(features['img_raw'],tf.uint8)\nimg = tf.reshape(img, [227,227,3])\nlabel=tf.cast(features['label'],tf.int32)\nmin_after_dequeue = 200\nbatch_size = 128\ncapacity = min_after_dequeue + 10 * batch_size\nimage_batch, label_batch = tf.train.batch([img, label], batch_size=batch_size, capacity=capacity)\nimage_batch, label_batch = tf.train.shuffle_batch(\n[img, label],\nbatch_size=32,\nnum_threads=7,\ncapacity=500,\nmin_after_dequeue=200)\nwith tf.Session() as sess:\nsess.run((tf.global_variables_initializer(),\ntf.local_variables_initializer()))\ncoord = tf.train.Coordinator()\nthreads = tf.train.start_queue_runners(sess=sess,coord=coord)\nfor i in range(1):\nlabel=sess.run(label)\nlabel_batch=sess.run(label_batch)\nimage_batch=sess.run(image_batch)\n    for j in range(8):\n        plt.imshow(image_batch[j])\n        print(label_batch[j])\n        plt.show()\ncoord.request_stop()\ncoord.join(threads)\n\nprint(time.time()-begin)\n`", "body": "When I train my face_detection model\uff0cI set 0 as my non-face label ,and 1 as face label .After building TFRecord dataset\uff0cI use 'image_batch, label_batch = tf.train.shuffle_batch ' ,it  is clear  that \u2018image_batch \u2019 corresponds to \u2018label_batch\u2019   .However,I found that \u2018image_batch \u2019 is not corresponding to \u2018label_batch\u2019. some non-face pictures'label is 1,and some face pictures' label is 0,why?\r\nhere is my code:`import tensorflow as tf\r\nimport time\r\nimport matplotlib.pyplot as plt\r\n\r\n\r\nbegin=time.time()\r\nfilename_queue = tf.train.string_input_producer(['C:\\\\Users\\\\312\\\\Desktop\\\\Face_Detection\\\\ai.tfrecords'],shuffle=False)\r\n\r\nreader = tf.TFRecordReader()\r\n_, serialized_example = reader.read(filename_queue)\r\n\r\nfeatures = tf.parse_single_example(serialized_example,\r\n                               features={\r\n                               'label':tf.FixedLenFeature([],tf.int64),\r\n                               'img_raw':tf.FixedLenFeature([],tf.string),\r\n                               })\r\nimg=tf.decode_raw(features['img_raw'],tf.uint8)\r\nimg = tf.reshape(img, [227,227,3])\r\nlabel=tf.cast(features['label'],tf.int32)\r\n\r\nmin_after_dequeue = 200\r\nbatch_size = 128\r\ncapacity = min_after_dequeue + 10 * batch_size\r\nimage_batch, label_batch = tf.train.batch([img, label], batch_size=batch_size, capacity=capacity)\r\n\r\nimage_batch, label_batch = tf.train.shuffle_batch(\r\n      [img, label],\r\n      batch_size=32,\r\n      num_threads=7,\r\n      capacity=500,\r\n      min_after_dequeue=200)\r\n\r\nwith tf.Session() as sess:\r\n    sess.run((tf.global_variables_initializer(),\r\n              tf.local_variables_initializer()))\r\n    coord = tf.train.Coordinator()\r\n    threads = tf.train.start_queue_runners(sess=sess,coord=coord)\r\n    for i in range(1): \r\n        label=sess.run(label)\r\n        label_batch=sess.run(label_batch)\r\n        image_batch=sess.run(image_batch) \r\n\r\n        for j in range(8):\r\n            plt.imshow(image_batch[j])\r\n            print(label_batch[j])\r\n            plt.show()\r\n    coord.request_stop()\r\n    coord.join(threads)\r\nprint(time.time()-begin)\r\n    `"}