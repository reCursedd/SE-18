{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14576", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14576/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14576/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14576/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/14576", "id": 274083674, "node_id": "MDU6SXNzdWUyNzQwODM2NzQ=", "number": 14576, "title": "FAIL://tensorflow/core:common_runtime_direct_session_with_tracking_alloc_test with GPU support", "user": {"login": "sandipmgiri", "id": 16284232, "node_id": "MDQ6VXNlcjE2Mjg0MjMy", "avatar_url": "https://avatars0.githubusercontent.com/u/16284232?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sandipmgiri", "html_url": "https://github.com/sandipmgiri", "followers_url": "https://api.github.com/users/sandipmgiri/followers", "following_url": "https://api.github.com/users/sandipmgiri/following{/other_user}", "gists_url": "https://api.github.com/users/sandipmgiri/gists{/gist_id}", "starred_url": "https://api.github.com/users/sandipmgiri/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sandipmgiri/subscriptions", "organizations_url": "https://api.github.com/users/sandipmgiri/orgs", "repos_url": "https://api.github.com/users/sandipmgiri/repos", "events_url": "https://api.github.com/users/sandipmgiri/events{/privacy}", "received_events_url": "https://api.github.com/users/sandipmgiri/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-11-15T09:13:29Z", "updated_at": "2017-11-16T05:02:19Z", "closed_at": "2017-11-16T05:02:19Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nUbuntu 16.04 (ppc64le)</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>:<br>\nInstalled from source</li>\n<li><strong>TensorFlow version (use command below)</strong>:<br>\nTF-1.3.1</li>\n<li><strong>Python version</strong>:<br>\nPython 2.7.5</li>\n<li><strong>Bazel version (if compiling from source)</strong>:<br>\nBazel - 0.5.4</li>\n<li><strong>CUDA/cuDNN version</strong>:<br>\ncuda-8.0 and cuDNN-6.0.21</li>\n<li><strong>GPU model and memory</strong>:<br>\n0   Tesla P100-SXM2 16276MiB<br>\n1   Tesla P100-SXM2 16276MiB</li>\n<li><strong>Exact command to reproduce</strong>:<br>\n<code> bazel test --config=opt --config=cuda -k //tensorflow/core:common_runtime_direct_session_with_tracking_alloc_test</code></li>\n</ul>\n<h3>Describe the problem</h3>\n<p>This test passed successfully with CPU only. However its failing for GPU , getting following error :<br>\n<code>F tensorflow/core/common_runtime/direct_session_with_tracking_alloc_test.cc:141] Check failed: cost_models.size() == 1 (2 vs. 1)</code></p>\n<p>(Test expects cost_models.size() == '1' , but we are getting '2' with GPU)</p>\n<p>I was looking into this test failure and I found some relevant discussion links -</p>\n<ol>\n<li><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"235307854\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/lukeiwanski/tensorflow/issues/75\" data-hovercard-type=\"issue\" data-hovercard-url=\"/lukeiwanski/tensorflow/issues/75/hovercard\" href=\"https://github.com/lukeiwanski/tensorflow/issues/75\">lukeiwanski#75</a>  - Here mentioned , this test is marked for no_gpu</li>\n<li><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"240614605\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/lukeiwanski/tensorflow/issues/115\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/lukeiwanski/tensorflow/pull/115/hovercard\" href=\"https://github.com/lukeiwanski/tensorflow/pull/115\">lukeiwanski#115</a> - Here I found following comments:</li>\n</ol>\n<p>The aim of this test is to ensure that there is at least one cost model (that of the CPU), as if there are no cost models then the test should fail and there is no point in trying to run the other tests on the cost<br>\nmodel.</p>\n<p>The number of cost models provided by a session should matches the number of devices used by that session. When additional devices are present there will be more than one cost model, so we should not be checking for equality, but rather that the number of cost models is at least one.</p>\n<p>As per above comments , I think we should raise a PR with following changes to pass on GPU as well -<br>\n<a href=\"https://github.com/tensorflow/tensorflow/blob/v1.3.1/tensorflow/core/common_runtime/direct_session_with_tracking_alloc_test.cc#L141\">https://github.com/tensorflow/tensorflow/blob/v1.3.1/tensorflow/core/common_runtime/direct_session_with_tracking_alloc_test.cc#L141</a><br>\nOriginal - <code>CHECK_EQ(cost_models.size(), 1);</code><br>\nUpdated to - <code>CHECK_GE(cost_models.size(), 1); </code></p>\n<p>Please provide your comments on this. Thanks!</p>\n<h3>Source code / logs</h3>\n<pre><code>$  bazel test --config=opt --config=cuda -k //tensorflow/core:common_runtime_direct_session_with_tracking_alloc_test\n\n...\n2017-11-15 08:42:51.345108: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1045] Creating TensorFlow device (/gpu:1) -&gt; (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\n2017-11-15 08:42:51.352293: F tensorflow/core/common_runtime/direct_session_with_tracking_alloc_test.cc:141] Check failed: cost_models.size() == 1 (2 vs. 1)\n================================================================================\nTarget //tensorflow/core:common_runtime_direct_session_with_tracking_alloc_test up-to-date:\n  bazel-bin/tensorflow/core/common_runtime_direct_session_with_tracking_alloc_test\nINFO: Elapsed time: 80.635s, Critical Path: 80.25s\n//tensorflow/core:common_runtime_direct_session_with_tracking_alloc_test FAILED in 75.0s\n</code></pre>", "body_text": "System information\n\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nUbuntu 16.04 (ppc64le)\nTensorFlow installed from (source or binary):\nInstalled from source\nTensorFlow version (use command below):\nTF-1.3.1\nPython version:\nPython 2.7.5\nBazel version (if compiling from source):\nBazel - 0.5.4\nCUDA/cuDNN version:\ncuda-8.0 and cuDNN-6.0.21\nGPU model and memory:\n0   Tesla P100-SXM2 16276MiB\n1   Tesla P100-SXM2 16276MiB\nExact command to reproduce:\n bazel test --config=opt --config=cuda -k //tensorflow/core:common_runtime_direct_session_with_tracking_alloc_test\n\nDescribe the problem\nThis test passed successfully with CPU only. However its failing for GPU , getting following error :\nF tensorflow/core/common_runtime/direct_session_with_tracking_alloc_test.cc:141] Check failed: cost_models.size() == 1 (2 vs. 1)\n(Test expects cost_models.size() == '1' , but we are getting '2' with GPU)\nI was looking into this test failure and I found some relevant discussion links -\n\nlukeiwanski#75  - Here mentioned , this test is marked for no_gpu\nlukeiwanski#115 - Here I found following comments:\n\nThe aim of this test is to ensure that there is at least one cost model (that of the CPU), as if there are no cost models then the test should fail and there is no point in trying to run the other tests on the cost\nmodel.\nThe number of cost models provided by a session should matches the number of devices used by that session. When additional devices are present there will be more than one cost model, so we should not be checking for equality, but rather that the number of cost models is at least one.\nAs per above comments , I think we should raise a PR with following changes to pass on GPU as well -\nhttps://github.com/tensorflow/tensorflow/blob/v1.3.1/tensorflow/core/common_runtime/direct_session_with_tracking_alloc_test.cc#L141\nOriginal - CHECK_EQ(cost_models.size(), 1);\nUpdated to - CHECK_GE(cost_models.size(), 1); \nPlease provide your comments on this. Thanks!\nSource code / logs\n$  bazel test --config=opt --config=cuda -k //tensorflow/core:common_runtime_direct_session_with_tracking_alloc_test\n\n...\n2017-11-15 08:42:51.345108: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1045] Creating TensorFlow device (/gpu:1) -> (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\n2017-11-15 08:42:51.352293: F tensorflow/core/common_runtime/direct_session_with_tracking_alloc_test.cc:141] Check failed: cost_models.size() == 1 (2 vs. 1)\n================================================================================\nTarget //tensorflow/core:common_runtime_direct_session_with_tracking_alloc_test up-to-date:\n  bazel-bin/tensorflow/core/common_runtime_direct_session_with_tracking_alloc_test\nINFO: Elapsed time: 80.635s, Critical Path: 80.25s\n//tensorflow/core:common_runtime_direct_session_with_tracking_alloc_test FAILED in 75.0s", "body": "\r\n### System information\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\n     Ubuntu 16.04 (ppc64le)\r\n- **TensorFlow installed from (source or binary)**:\r\n      Installed from source\r\n- **TensorFlow version (use command below)**:\r\n      TF-1.3.1\r\n- **Python version**:\r\n      Python 2.7.5 \r\n- **Bazel version (if compiling from source)**:\r\n      Bazel - 0.5.4\r\n- **CUDA/cuDNN version**:\r\n      cuda-8.0 and cuDNN-6.0.21\r\n- **GPU model and memory**:\r\n        0   Tesla P100-SXM2 16276MiB\r\n        1   Tesla P100-SXM2 16276MiB\r\n- **Exact command to reproduce**:\r\n     ` bazel test --config=opt --config=cuda -k //tensorflow/core:common_runtime_direct_session_with_tracking_alloc_test`\r\n\r\n### Describe the problem\r\nThis test passed successfully with CPU only. However its failing for GPU , getting following error :\r\n`F tensorflow/core/common_runtime/direct_session_with_tracking_alloc_test.cc:141] Check failed: cost_models.size() == 1 (2 vs. 1)`\r\n\r\n(Test expects cost_models.size() == '1' , but we are getting '2' with GPU)\r\n\r\nI was looking into this test failure and I found some relevant discussion links -\r\n1) https://github.com/lukeiwanski/tensorflow/issues/75  - Here mentioned , this test is marked for no_gpu\r\n2) https://github.com/lukeiwanski/tensorflow/pull/115 - Here I found following comments:\r\n\r\nThe aim of this test is to ensure that there is at least one cost model (that of the CPU), as if there are no cost models then the test should fail and there is no point in trying to run the other tests on the cost\r\nmodel.\r\n\r\nThe number of cost models provided by a session should matches the number of devices used by that session. When additional devices are present there will be more than one cost model, so we should not be checking for equality, but rather that the number of cost models is at least one.\r\n\r\nAs per above comments , I think we should raise a PR with following changes to pass on GPU as well -\r\nhttps://github.com/tensorflow/tensorflow/blob/v1.3.1/tensorflow/core/common_runtime/direct_session_with_tracking_alloc_test.cc#L141\r\nOriginal - `CHECK_EQ(cost_models.size(), 1);`\r\nUpdated to - `CHECK_GE(cost_models.size(), 1); `\r\n\r\nPlease provide your comments on this. Thanks!\r\n### Source code / logs\r\n```\r\n$  bazel test --config=opt --config=cuda -k //tensorflow/core:common_runtime_direct_session_with_tracking_alloc_test\r\n\r\n...\r\n2017-11-15 08:42:51.345108: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1045] Creating TensorFlow device (/gpu:1) -> (device: 1, name: Tesla P100-SXM2-16GB, pci bus id: 0006:01:00.0)\r\n2017-11-15 08:42:51.352293: F tensorflow/core/common_runtime/direct_session_with_tracking_alloc_test.cc:141] Check failed: cost_models.size() == 1 (2 vs. 1)\r\n================================================================================\r\nTarget //tensorflow/core:common_runtime_direct_session_with_tracking_alloc_test up-to-date:\r\n  bazel-bin/tensorflow/core/common_runtime_direct_session_with_tracking_alloc_test\r\nINFO: Elapsed time: 80.635s, Critical Path: 80.25s\r\n//tensorflow/core:common_runtime_direct_session_with_tracking_alloc_test FAILED in 75.0s\r\n```\r\n"}