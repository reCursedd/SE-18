{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12583", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12583/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12583/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12583/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/12583", "id": 252800496, "node_id": "MDU6SXNzdWUyNTI4MDA0OTY=", "number": 12583, "title": "BUG: indices[0] = [0,-1] is out of bounds for _OneHotColumn", "user": {"login": "facaiy", "id": 1112263, "node_id": "MDQ6VXNlcjExMTIyNjM=", "avatar_url": "https://avatars3.githubusercontent.com/u/1112263?v=4", "gravatar_id": "", "url": "https://api.github.com/users/facaiy", "html_url": "https://github.com/facaiy", "followers_url": "https://api.github.com/users/facaiy/followers", "following_url": "https://api.github.com/users/facaiy/following{/other_user}", "gists_url": "https://api.github.com/users/facaiy/gists{/gist_id}", "starred_url": "https://api.github.com/users/facaiy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/facaiy/subscriptions", "organizations_url": "https://api.github.com/users/facaiy/orgs", "repos_url": "https://api.github.com/users/facaiy/repos", "events_url": "https://api.github.com/users/facaiy/events{/privacy}", "received_events_url": "https://api.github.com/users/facaiy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-08-25T05:14:18Z", "updated_at": "2017-09-07T23:56:15Z", "closed_at": "2017-09-07T23:56:15Z", "author_association": "MEMBER", "body_html": "<h3>Describe the problem</h3>\n<p>For <code>sparse_column_with_keys</code>, out-of-vocabulary feature values is -1 by default. However, -1 is invalid index when sparse_tensor is converted to tensor in <code>one_hot_column</code>.</p>\n<h3>Source code / logs</h3>\n<p>code:</p>\n<div class=\"highlight highlight-source-python\"><pre>    ids <span class=\"pl-k\">=</span> fc.sparse_column_with_keys(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ids<span class=\"pl-pds\">\"</span></span>, [<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>marlo<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>omar<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>stringer<span class=\"pl-pds\">\"</span></span>])\n    weighted_ids <span class=\"pl-k\">=</span> fc.weighted_sparse_column(ids, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>weights<span class=\"pl-pds\">\"</span></span>)\n    one_hot <span class=\"pl-k\">=</span> fc.one_hot_column(weighted_ids)</pre></div>\n<p>logs:</p>\n<div class=\"highlight highlight-source-python\"><pre>  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/facai/Workshop/sina/Prometheus/prometheus/python/feature/column_test.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">373</span>, <span class=\"pl-k\">in</span> _feature_column_from_tensor_dict\n    <span class=\"pl-k\">return</span> layers.input_from_feature_columns(tensor_dicts, feature_columns)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/contrib/layers/python/layers/feature_column_ops.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">212</span>, <span class=\"pl-k\">in</span> input_from_feature_columns\n    default_name<span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>input_from_feature_columns<span class=\"pl-pds\">'</span></span>)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/contrib/layers/python/layers/feature_column_ops.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">143</span>, <span class=\"pl-k\">in</span> _input_from_feature_columns\n    output_rank<span class=\"pl-k\">=</span>output_rank))\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/contrib/layers/python/layers/feature_column.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">936</span>, <span class=\"pl-k\">in</span> _to_dnn_input_layer\n    <span class=\"pl-k\">return</span> sparse_ops.sparse_tensor_to_dense(weighted_column)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/ops/sparse_ops.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">845</span>, <span class=\"pl-k\">in</span> sparse_tensor_to_dense\n    name<span class=\"pl-k\">=</span>name)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/ops/sparse_ops.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">710</span>, <span class=\"pl-k\">in</span> sparse_to_dense\n    name<span class=\"pl-k\">=</span>name)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/ops/gen_sparse_ops.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">1094</span>, <span class=\"pl-k\">in</span> _sparse_to_dense\n    validate_indices<span class=\"pl-k\">=</span>validate_indices, name<span class=\"pl-k\">=</span>name)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">767</span>, <span class=\"pl-k\">in</span> apply_op\n    op_def<span class=\"pl-k\">=</span>op_def)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">2506</span>, <span class=\"pl-k\">in</span> create_op\n    original_op<span class=\"pl-k\">=</span><span class=\"pl-c1\">self</span>._default_original_op, op_def<span class=\"pl-k\">=</span>op_def)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">1269</span>, <span class=\"pl-k\">in</span> <span class=\"pl-c1\">__init__</span>\n    <span class=\"pl-c1\">self</span>._traceback <span class=\"pl-k\">=</span> _extract_stack()\n\nInvalidArgumentError (see above <span class=\"pl-k\">for</span> traceback): indices[<span class=\"pl-c1\">0</span>] <span class=\"pl-k\">=</span> [<span class=\"pl-c1\">0</span>,<span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>] <span class=\"pl-k\">is</span> out of bounds: need <span class=\"pl-c1\">0</span> <span class=\"pl-k\">&lt;=</span> index <span class=\"pl-k\">&lt;</span> [<span class=\"pl-c1\">1</span>,<span class=\"pl-c1\">4</span>]\n         [[Node: input_from_feature_columns<span class=\"pl-k\">/</span>col_tag_weighted_by_col_weight_one_hot<span class=\"pl-k\">/</span>SparseToDense = SparseToDense[T=<span class=\"pl-c1\">DT_FLOAT</span>, Tindices=<span class=\"pl-c1\">DT_INT64</span>, validate_indices=true, _device=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/job:localhost/replica:0/task:0/cpu:0<span class=\"pl-pds\">\"</span></span>](input_from_feature_columns<span class=\"pl-k\">/</span>col_tag_weighted_by_col_weight_one_hot<span class=\"pl-k\">/</span>SparseMerge<span class=\"pl-k\">/</span>SparseReorder, input_from_feature_columns<span class=\"pl-k\">/</span>col_tag_weighted_by_col_weight_one_hot<span class=\"pl-k\">/</span>SparseMerge<span class=\"pl-k\">/</span>Identity, input_from_feature_columns<span class=\"pl-k\">/</span>col_tag_weighted_by_col_weight_one_hot<span class=\"pl-k\">/</span>SparseMerge<span class=\"pl-k\">/</span>SparseReorder:<span class=\"pl-c1\">1</span>, input_from_feature_columns<span class=\"pl-k\">/</span>col_tag_weighted_by_col_weight_one_hot<span class=\"pl-k\">/</span>SparseToDense<span class=\"pl-k\">/</span>default_value)]]</pre></div>", "body_text": "Describe the problem\nFor sparse_column_with_keys, out-of-vocabulary feature values is -1 by default. However, -1 is invalid index when sparse_tensor is converted to tensor in one_hot_column.\nSource code / logs\ncode:\n    ids = fc.sparse_column_with_keys(\"ids\", [\"marlo\", \"omar\", \"stringer\"])\n    weighted_ids = fc.weighted_sparse_column(ids, \"weights\")\n    one_hot = fc.one_hot_column(weighted_ids)\nlogs:\n  File \"/Users/facai/Workshop/sina/Prometheus/prometheus/python/feature/column_test.py\", line 373, in _feature_column_from_tensor_dict\n    return layers.input_from_feature_columns(tensor_dicts, feature_columns)\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/contrib/layers/python/layers/feature_column_ops.py\", line 212, in input_from_feature_columns\n    default_name='input_from_feature_columns')\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/contrib/layers/python/layers/feature_column_ops.py\", line 143, in _input_from_feature_columns\n    output_rank=output_rank))\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/contrib/layers/python/layers/feature_column.py\", line 936, in _to_dnn_input_layer\n    return sparse_ops.sparse_tensor_to_dense(weighted_column)\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/ops/sparse_ops.py\", line 845, in sparse_tensor_to_dense\n    name=name)\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/ops/sparse_ops.py\", line 710, in sparse_to_dense\n    name=name)\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/ops/gen_sparse_ops.py\", line 1094, in _sparse_to_dense\n    validate_indices=validate_indices, name=name)\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 767, in apply_op\n    op_def=op_def)\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2506, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1269, in __init__\n    self._traceback = _extract_stack()\n\nInvalidArgumentError (see above for traceback): indices[0] = [0,-1] is out of bounds: need 0 <= index < [1,4]\n         [[Node: input_from_feature_columns/col_tag_weighted_by_col_weight_one_hot/SparseToDense = SparseToDense[T=DT_FLOAT, Tindices=DT_INT64, validate_indices=true, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](input_from_feature_columns/col_tag_weighted_by_col_weight_one_hot/SparseMerge/SparseReorder, input_from_feature_columns/col_tag_weighted_by_col_weight_one_hot/SparseMerge/Identity, input_from_feature_columns/col_tag_weighted_by_col_weight_one_hot/SparseMerge/SparseReorder:1, input_from_feature_columns/col_tag_weighted_by_col_weight_one_hot/SparseToDense/default_value)]]", "body": "### Describe the problem\r\n\r\nFor `sparse_column_with_keys`, out-of-vocabulary feature values is -1 by default. However, -1 is invalid index when sparse_tensor is converted to tensor in `one_hot_column`.\r\n\r\n\r\n### Source code / logs\r\n\r\ncode:\r\n\r\n```python\r\n    ids = fc.sparse_column_with_keys(\"ids\", [\"marlo\", \"omar\", \"stringer\"])\r\n    weighted_ids = fc.weighted_sparse_column(ids, \"weights\")\r\n    one_hot = fc.one_hot_column(weighted_ids)\r\n```\r\n\r\nlogs:\r\n\r\n```python\r\n  File \"/Users/facai/Workshop/sina/Prometheus/prometheus/python/feature/column_test.py\", line 373, in _feature_column_from_tensor_dict\r\n    return layers.input_from_feature_columns(tensor_dicts, feature_columns)\r\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/contrib/layers/python/layers/feature_column_ops.py\", line 212, in input_from_feature_columns\r\n    default_name='input_from_feature_columns')\r\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/contrib/layers/python/layers/feature_column_ops.py\", line 143, in _input_from_feature_columns\r\n    output_rank=output_rank))\r\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/contrib/layers/python/layers/feature_column.py\", line 936, in _to_dnn_input_layer\r\n    return sparse_ops.sparse_tensor_to_dense(weighted_column)\r\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/ops/sparse_ops.py\", line 845, in sparse_tensor_to_dense\r\n    name=name)\r\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/ops/sparse_ops.py\", line 710, in sparse_to_dense\r\n    name=name)\r\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/ops/gen_sparse_ops.py\", line 1094, in _sparse_to_dense\r\n    validate_indices=validate_indices, name=name)\r\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 767, in apply_op\r\n    op_def=op_def)\r\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2506, in create_op\r\n    original_op=self._default_original_op, op_def=op_def)\r\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1269, in __init__\r\n    self._traceback = _extract_stack()\r\n\r\nInvalidArgumentError (see above for traceback): indices[0] = [0,-1] is out of bounds: need 0 <= index < [1,4]\r\n         [[Node: input_from_feature_columns/col_tag_weighted_by_col_weight_one_hot/SparseToDense = SparseToDense[T=DT_FLOAT, Tindices=DT_INT64, validate_indices=true, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](input_from_feature_columns/col_tag_weighted_by_col_weight_one_hot/SparseMerge/SparseReorder, input_from_feature_columns/col_tag_weighted_by_col_weight_one_hot/SparseMerge/Identity, input_from_feature_columns/col_tag_weighted_by_col_weight_one_hot/SparseMerge/SparseReorder:1, input_from_feature_columns/col_tag_weighted_by_col_weight_one_hot/SparseToDense/default_value)]]\r\n```\r\n"}