{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15284", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15284/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15284/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15284/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15284", "id": 281211460, "node_id": "MDU6SXNzdWUyODEyMTE0NjA=", "number": 15284, "title": "[RFE] Runtime GPU Docker image without Jupyter", "user": {"login": "flx42", "id": 3645581, "node_id": "MDQ6VXNlcjM2NDU1ODE=", "avatar_url": "https://avatars3.githubusercontent.com/u/3645581?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flx42", "html_url": "https://github.com/flx42", "followers_url": "https://api.github.com/users/flx42/followers", "following_url": "https://api.github.com/users/flx42/following{/other_user}", "gists_url": "https://api.github.com/users/flx42/gists{/gist_id}", "starred_url": "https://api.github.com/users/flx42/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flx42/subscriptions", "organizations_url": "https://api.github.com/users/flx42/orgs", "repos_url": "https://api.github.com/users/flx42/repos", "events_url": "https://api.github.com/users/flx42/events{/privacy}", "received_events_url": "https://api.github.com/users/flx42/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": {"login": "angersson", "id": 32465472, "node_id": "MDQ6VXNlcjMyNDY1NDcy", "avatar_url": "https://avatars2.githubusercontent.com/u/32465472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/angersson", "html_url": "https://github.com/angersson", "followers_url": "https://api.github.com/users/angersson/followers", "following_url": "https://api.github.com/users/angersson/following{/other_user}", "gists_url": "https://api.github.com/users/angersson/gists{/gist_id}", "starred_url": "https://api.github.com/users/angersson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/angersson/subscriptions", "organizations_url": "https://api.github.com/users/angersson/orgs", "repos_url": "https://api.github.com/users/angersson/repos", "events_url": "https://api.github.com/users/angersson/events{/privacy}", "received_events_url": "https://api.github.com/users/angersson/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "angersson", "id": 32465472, "node_id": "MDQ6VXNlcjMyNDY1NDcy", "avatar_url": "https://avatars2.githubusercontent.com/u/32465472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/angersson", "html_url": "https://github.com/angersson", "followers_url": "https://api.github.com/users/angersson/followers", "following_url": "https://api.github.com/users/angersson/following{/other_user}", "gists_url": "https://api.github.com/users/angersson/gists{/gist_id}", "starred_url": "https://api.github.com/users/angersson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/angersson/subscriptions", "organizations_url": "https://api.github.com/users/angersson/orgs", "repos_url": "https://api.github.com/users/angersson/repos", "events_url": "https://api.github.com/users/angersson/events{/privacy}", "received_events_url": "https://api.github.com/users/angersson/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 36, "created_at": "2017-12-12T00:09:08Z", "updated_at": "2018-11-15T19:01:17Z", "closed_at": null, "author_association": "CONTRIBUTOR", "body_html": "<p>Current image size for <code>nightly-gpu</code>:</p>\n<div class=\"highlight highlight-source-shell\"><pre>$ docker images tensorflow/tensorflow:nightly-gpu\nREPOSITORY              TAG                 IMAGE ID            CREATED             SIZE\ntensorflow/tensorflow   nightly-gpu         8f64c1fbb504        12 hours ago        2.62GB</pre></div>\n<p>Current Dockerfile:<br>\n<a href=\"https://github.com/tensorflow/tensorflow/blob/abd5375ba8d373045321d1eebdb4501c36ab0ccd/tensorflow/tools/docker/Dockerfile.gpu\">https://github.com/tensorflow/tensorflow/blob/abd5375ba8d373045321d1eebdb4501c36ab0ccd/tensorflow/tools/docker/Dockerfile.gpu</a></p>\n<p>I see two potential improvements:</p>\n<ol>\n<li>\n<p>We already switched the <code>FROM</code> to use the <code>runtime</code> base image of CUDA. We could go one step further and use <code>nvidia/cuda:9.0-base</code>. This flavor of CUDA is new with CUDA 9.0, it just installs the repos and libcudart. You have to manually install the CUDA libraries you want afterwards. The gain wouldn't be that big with TensorFlow since you use most of the libraries from the CUDA toolkit. But we will at least remove NPP from the shipped image.</p>\n</li>\n<li>\n<p>Looks like many dependencies in the current Dockerfile are required for Jupyter. Can we provide a new tag without Jupyter? Or stop shipping Jupyter in the runtime image? Users will still be able to use the <code>devel</code> image.</p>\n</li>\n</ol>\n<p>I have a quick Dockerfile proof-of-concept with both improvements:</p>\n<pre><code>FROM nvidia/cuda:9.0-base-ubuntu16.04\n\nLABEL maintainer=\"Gunhan Gulsoy &lt;gunan@google.com&gt;\"\n\nRUN echo \"/usr/local/cuda-9.0/extras/CUPTI/lib64\" &gt; /etc/ld.so.conf.d/cupti.conf &amp;&amp; \\\n    apt-get update &amp;&amp; apt-get install -y --no-install-recommends \\\n        libgomp1 \\\n        libcudnn7 \\\n        cuda-command-line-tools-9-0 \\\n        cuda-cudart-9-0 \\\n        cuda-cufft-9-0 \\\n        cuda-cublas-9-0 \\\n        cuda-cusparse-9-0 \\\n        cuda-curand-9-0 \\\n        cuda-cusolver-9-0 \\\n        python-pip \\\n        &amp;&amp; \\\n    rm -rf /var/lib/apt/lists/\n\nRUN pip --no-cache-dir install --upgrade \\\n        pip setuptools\n\nRUN pip --no-cache-dir install http://ci.tensorflow.org/view/tf-nightly/job/tf-nightly-linux/TF_BUILD_IS_OPT=OPT,TF_BUILD_IS_PIP=PIP,TF_BUILD_PYTHON_VERSION=PYTHON2,label=gpu-linux/lastSuccessfulBuild/artifact/pip_test/whl/tf_nightly_gpu-1.head-cp27-cp27mu-manylinux1_x86_64.whl\n</code></pre>\n<p>Size is now 1.73 GB, down from 2.62 GB. And there is still room for improvement in CUDA 9.1 when CUPTI has its own package (today we have to pull <code>cuda-command-line-tools-9-0</code>), or if we disable CUPTI tracing (not sure if possible).</p>", "body_text": "Current image size for nightly-gpu:\n$ docker images tensorflow/tensorflow:nightly-gpu\nREPOSITORY              TAG                 IMAGE ID            CREATED             SIZE\ntensorflow/tensorflow   nightly-gpu         8f64c1fbb504        12 hours ago        2.62GB\nCurrent Dockerfile:\nhttps://github.com/tensorflow/tensorflow/blob/abd5375ba8d373045321d1eebdb4501c36ab0ccd/tensorflow/tools/docker/Dockerfile.gpu\nI see two potential improvements:\n\n\nWe already switched the FROM to use the runtime base image of CUDA. We could go one step further and use nvidia/cuda:9.0-base. This flavor of CUDA is new with CUDA 9.0, it just installs the repos and libcudart. You have to manually install the CUDA libraries you want afterwards. The gain wouldn't be that big with TensorFlow since you use most of the libraries from the CUDA toolkit. But we will at least remove NPP from the shipped image.\n\n\nLooks like many dependencies in the current Dockerfile are required for Jupyter. Can we provide a new tag without Jupyter? Or stop shipping Jupyter in the runtime image? Users will still be able to use the devel image.\n\n\nI have a quick Dockerfile proof-of-concept with both improvements:\nFROM nvidia/cuda:9.0-base-ubuntu16.04\n\nLABEL maintainer=\"Gunhan Gulsoy <gunan@google.com>\"\n\nRUN echo \"/usr/local/cuda-9.0/extras/CUPTI/lib64\" > /etc/ld.so.conf.d/cupti.conf && \\\n    apt-get update && apt-get install -y --no-install-recommends \\\n        libgomp1 \\\n        libcudnn7 \\\n        cuda-command-line-tools-9-0 \\\n        cuda-cudart-9-0 \\\n        cuda-cufft-9-0 \\\n        cuda-cublas-9-0 \\\n        cuda-cusparse-9-0 \\\n        cuda-curand-9-0 \\\n        cuda-cusolver-9-0 \\\n        python-pip \\\n        && \\\n    rm -rf /var/lib/apt/lists/\n\nRUN pip --no-cache-dir install --upgrade \\\n        pip setuptools\n\nRUN pip --no-cache-dir install http://ci.tensorflow.org/view/tf-nightly/job/tf-nightly-linux/TF_BUILD_IS_OPT=OPT,TF_BUILD_IS_PIP=PIP,TF_BUILD_PYTHON_VERSION=PYTHON2,label=gpu-linux/lastSuccessfulBuild/artifact/pip_test/whl/tf_nightly_gpu-1.head-cp27-cp27mu-manylinux1_x86_64.whl\n\nSize is now 1.73 GB, down from 2.62 GB. And there is still room for improvement in CUDA 9.1 when CUPTI has its own package (today we have to pull cuda-command-line-tools-9-0), or if we disable CUPTI tracing (not sure if possible).", "body": "Current image size for `nightly-gpu`:\r\n```sh\r\n$ docker images tensorflow/tensorflow:nightly-gpu\r\nREPOSITORY              TAG                 IMAGE ID            CREATED             SIZE\r\ntensorflow/tensorflow   nightly-gpu         8f64c1fbb504        12 hours ago        2.62GB\r\n```\r\nCurrent Dockerfile:\r\nhttps://github.com/tensorflow/tensorflow/blob/abd5375ba8d373045321d1eebdb4501c36ab0ccd/tensorflow/tools/docker/Dockerfile.gpu\r\n\r\nI see two potential improvements:\r\n1) We already switched the `FROM` to use the `runtime` base image of CUDA. We could go one step further and use `nvidia/cuda:9.0-base`. This flavor of CUDA is new with CUDA 9.0, it just installs the repos and libcudart. You have to manually install the CUDA libraries you want afterwards. The gain wouldn't be that big with TensorFlow since you use most of the libraries from the CUDA toolkit. But we will at least remove NPP from the shipped image.\r\n\r\n2) Looks like many dependencies in the current Dockerfile are required for Jupyter. Can we provide a new tag without Jupyter? Or stop shipping Jupyter in the runtime image? Users will still be able to use the `devel` image.\r\n\r\nI have a quick Dockerfile proof-of-concept with both improvements:\r\n```\r\nFROM nvidia/cuda:9.0-base-ubuntu16.04\r\n\r\nLABEL maintainer=\"Gunhan Gulsoy <gunan@google.com>\"\r\n\r\nRUN echo \"/usr/local/cuda-9.0/extras/CUPTI/lib64\" > /etc/ld.so.conf.d/cupti.conf && \\\r\n    apt-get update && apt-get install -y --no-install-recommends \\\r\n        libgomp1 \\\r\n        libcudnn7 \\\r\n        cuda-command-line-tools-9-0 \\\r\n        cuda-cudart-9-0 \\\r\n        cuda-cufft-9-0 \\\r\n        cuda-cublas-9-0 \\\r\n        cuda-cusparse-9-0 \\\r\n        cuda-curand-9-0 \\\r\n        cuda-cusolver-9-0 \\\r\n        python-pip \\\r\n        && \\\r\n    rm -rf /var/lib/apt/lists/\r\n\r\nRUN pip --no-cache-dir install --upgrade \\\r\n        pip setuptools\r\n\r\nRUN pip --no-cache-dir install http://ci.tensorflow.org/view/tf-nightly/job/tf-nightly-linux/TF_BUILD_IS_OPT=OPT,TF_BUILD_IS_PIP=PIP,TF_BUILD_PYTHON_VERSION=PYTHON2,label=gpu-linux/lastSuccessfulBuild/artifact/pip_test/whl/tf_nightly_gpu-1.head-cp27-cp27mu-manylinux1_x86_64.whl\r\n```\r\nSize is now 1.73 GB, down from 2.62 GB. And there is still room for improvement in CUDA 9.1 when CUPTI has its own package (today we have to pull `cuda-command-line-tools-9-0`), or if we disable CUPTI tracing (not sure if possible).\r\n"}