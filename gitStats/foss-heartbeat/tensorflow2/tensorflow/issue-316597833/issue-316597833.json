{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18777", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18777/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18777/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18777/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/18777", "id": 316597833, "node_id": "MDU6SXNzdWUzMTY1OTc4MzM=", "number": 18777, "title": "GraphDef not ok for the TensorRT API but ok for the TensorFlow iteslf ", "user": {"login": "arassadin", "id": 3072128, "node_id": "MDQ6VXNlcjMwNzIxMjg=", "avatar_url": "https://avatars0.githubusercontent.com/u/3072128?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arassadin", "html_url": "https://github.com/arassadin", "followers_url": "https://api.github.com/users/arassadin/followers", "following_url": "https://api.github.com/users/arassadin/following{/other_user}", "gists_url": "https://api.github.com/users/arassadin/gists{/gist_id}", "starred_url": "https://api.github.com/users/arassadin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arassadin/subscriptions", "organizations_url": "https://api.github.com/users/arassadin/orgs", "repos_url": "https://api.github.com/users/arassadin/repos", "events_url": "https://api.github.com/users/arassadin/events{/privacy}", "received_events_url": "https://api.github.com/users/arassadin/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2018-04-22T17:36:29Z", "updated_at": "2018-05-10T22:02:57Z", "closed_at": "2018-05-10T22:02:57Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: Yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Ubuntu 16.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.7.0</li>\n<li><strong>Python version</strong>: Python 3.5</li>\n<li><strong>Bazel version (if compiling from source)</strong>: 0.11.1</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: 5.4.0-6ubuntu1~16.04.9</li>\n<li><strong>CUDA/cuDNN version</strong>: 9.0 / 7.0.5</li>\n<li><strong>GPU model and memory</strong>: GTX 1070, 8Gb</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>I'm trying to convert <code>Keras</code> model (<code>MobileNet</code> or <code>Xception</code>) to <code>TensorRT</code> engine using <code>TensorFlow</code> API.<br>\nFirst, I'm getting graph from <code>K.session()</code> and appropriate <code>GraphDef</code>.<br>\nSecond, I'm freeze it with <code>convert_variables_to_constants</code>.<br>\nThen, I'm able to make predictions using <code>TensorFlow</code>. But when I submit it to the the <code>create_inference_graph</code>, it complaints to bad dimensions:</p>\n<pre><code>2018-04-22 20:13:17.560097: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:47 due to: \"Unimplemented: Not supported constant type, at conv_pw_4_bn/Const_5\" SKIPPING......( 7 nodes)\n2018-04-22 20:13:17.563078: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:48 due to: \"Unimplemented: Not supported constant type, at conv_pw_1_bn/Const_5\" SKIPPING......( 7 nodes)\n2018-04-22 20:13:17.565057: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:49 due to: \"Unimplemented: Not supported constant type, at conv_dw_1_bn/Const_5\" SKIPPING......( 7 nodes)\n2018-04-22 20:13:17.567257: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:50 due to: \"Unimplemented: Not supported constant type, at conv_dw_12_bn/Const_5\" SKIPPING......( 7 nodes)\n2018-04-22 20:13:17.569343: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:51 due to: \"Unimplemented: Not supported constant type, at conv_dw_7_bn/Const_5\" SKIPPING......( 7 nodes)\n2018-04-22 20:13:17.571571: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:52 due to: \"Unimplemented: Not supported constant type, at conv_pw_10_bn/Const_5\" SKIPPING......( 7 nodes)\n2018-04-22 20:13:17.573851: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:53 due to: \"Unimplemented: Require 4 dimensional input. Got 1 conv_dw_6_bn/cond/batchnorm/add/Switch\" SKIPPING......( 6 nodes)\n</code></pre>\n<p>as many times as there are such <code>*/Switch</code> nodes. Digging deeper, I found such strange design in the graph's <code>GraphDef</code>:</p>\n<pre><code>tensor_shape {\n  dim {\n  }\n}\n</code></pre>\n<p>within some (<strong>not all</strong>) nodes of type <code>Const</code>, e.g.</p>\n<pre><code>node {\n  name: \"conv_pw_8_bn/Const_5\"\n  op: \"Const\"\n  attr {\n    key: \"dtype\"\n    value {\n      type: DT_FLOAT\n    }\n  }\n  attr {\n    key: \"value\"\n    value {\n      tensor {\n        dtype: DT_FLOAT\n        tensor_shape {\n          dim {\n          }\n        }\n      }\n    }\n  }\n}\n</code></pre>\n<p>All such nodes are mentioned in the traceback.</p>\n<p>So, it's ok for <code>TensorFlow</code> itself but wrong for the <code>TensorRT</code>. I gues there is an error either in <code>GraphDef</code> generation or while parsing for <code>TensorRT</code>.</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Ubuntu 16.04\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below): 1.7.0\nPython version: Python 3.5\nBazel version (if compiling from source): 0.11.1\nGCC/Compiler version (if compiling from source): 5.4.0-6ubuntu1~16.04.9\nCUDA/cuDNN version: 9.0 / 7.0.5\nGPU model and memory: GTX 1070, 8Gb\n\nDescribe the problem\nI'm trying to convert Keras model (MobileNet or Xception) to TensorRT engine using TensorFlow API.\nFirst, I'm getting graph from K.session() and appropriate GraphDef.\nSecond, I'm freeze it with convert_variables_to_constants.\nThen, I'm able to make predictions using TensorFlow. But when I submit it to the the create_inference_graph, it complaints to bad dimensions:\n2018-04-22 20:13:17.560097: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:47 due to: \"Unimplemented: Not supported constant type, at conv_pw_4_bn/Const_5\" SKIPPING......( 7 nodes)\n2018-04-22 20:13:17.563078: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:48 due to: \"Unimplemented: Not supported constant type, at conv_pw_1_bn/Const_5\" SKIPPING......( 7 nodes)\n2018-04-22 20:13:17.565057: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:49 due to: \"Unimplemented: Not supported constant type, at conv_dw_1_bn/Const_5\" SKIPPING......( 7 nodes)\n2018-04-22 20:13:17.567257: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:50 due to: \"Unimplemented: Not supported constant type, at conv_dw_12_bn/Const_5\" SKIPPING......( 7 nodes)\n2018-04-22 20:13:17.569343: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:51 due to: \"Unimplemented: Not supported constant type, at conv_dw_7_bn/Const_5\" SKIPPING......( 7 nodes)\n2018-04-22 20:13:17.571571: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:52 due to: \"Unimplemented: Not supported constant type, at conv_pw_10_bn/Const_5\" SKIPPING......( 7 nodes)\n2018-04-22 20:13:17.573851: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:53 due to: \"Unimplemented: Require 4 dimensional input. Got 1 conv_dw_6_bn/cond/batchnorm/add/Switch\" SKIPPING......( 6 nodes)\n\nas many times as there are such */Switch nodes. Digging deeper, I found such strange design in the graph's GraphDef:\ntensor_shape {\n  dim {\n  }\n}\n\nwithin some (not all) nodes of type Const, e.g.\nnode {\n  name: \"conv_pw_8_bn/Const_5\"\n  op: \"Const\"\n  attr {\n    key: \"dtype\"\n    value {\n      type: DT_FLOAT\n    }\n  }\n  attr {\n    key: \"value\"\n    value {\n      tensor {\n        dtype: DT_FLOAT\n        tensor_shape {\n          dim {\n          }\n        }\n      }\n    }\n  }\n}\n\nAll such nodes are mentioned in the traceback.\nSo, it's ok for TensorFlow itself but wrong for the TensorRT. I gues there is an error either in GraphDef generation or while parsing for TensorRT.", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: Yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Ubuntu 16.04\r\n- **TensorFlow installed from (source or binary)**: binary\r\n- **TensorFlow version (use command below)**: 1.7.0\r\n- **Python version**: Python 3.5\r\n- **Bazel version (if compiling from source)**: 0.11.1\r\n- **GCC/Compiler version (if compiling from source)**: 5.4.0-6ubuntu1~16.04.9\r\n- **CUDA/cuDNN version**: 9.0 / 7.0.5\r\n- **GPU model and memory**: GTX 1070, 8Gb\r\n\r\n### Describe the problem\r\nI'm trying to convert `Keras` model (`MobileNet` or `Xception`) to `TensorRT` engine using `TensorFlow` API.\r\nFirst, I'm getting graph from `K.session()` and appropriate `GraphDef`.\r\nSecond, I'm freeze it with `convert_variables_to_constants`.\r\nThen, I'm able to make predictions using `TensorFlow`. But when I submit it to the the `create_inference_graph`, it complaints to bad dimensions:\r\n```\r\n2018-04-22 20:13:17.560097: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:47 due to: \"Unimplemented: Not supported constant type, at conv_pw_4_bn/Const_5\" SKIPPING......( 7 nodes)\r\n2018-04-22 20:13:17.563078: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:48 due to: \"Unimplemented: Not supported constant type, at conv_pw_1_bn/Const_5\" SKIPPING......( 7 nodes)\r\n2018-04-22 20:13:17.565057: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:49 due to: \"Unimplemented: Not supported constant type, at conv_dw_1_bn/Const_5\" SKIPPING......( 7 nodes)\r\n2018-04-22 20:13:17.567257: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:50 due to: \"Unimplemented: Not supported constant type, at conv_dw_12_bn/Const_5\" SKIPPING......( 7 nodes)\r\n2018-04-22 20:13:17.569343: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:51 due to: \"Unimplemented: Not supported constant type, at conv_dw_7_bn/Const_5\" SKIPPING......( 7 nodes)\r\n2018-04-22 20:13:17.571571: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:52 due to: \"Unimplemented: Not supported constant type, at conv_pw_10_bn/Const_5\" SKIPPING......( 7 nodes)\r\n2018-04-22 20:13:17.573851: W tensorflow/contrib/tensorrt/convert/convert_graph.cc:412] subgraph conversion error for subgraph_index:53 due to: \"Unimplemented: Require 4 dimensional input. Got 1 conv_dw_6_bn/cond/batchnorm/add/Switch\" SKIPPING......( 6 nodes)\r\n```\r\nas many times as there are such `*/Switch` nodes. Digging deeper, I found such strange design in the graph's `GraphDef`:\r\n```\r\ntensor_shape {\r\n  dim {\r\n  }\r\n}\r\n```\r\nwithin some (**not all**) nodes of type `Const`, e.g.\r\n```\r\nnode {\r\n  name: \"conv_pw_8_bn/Const_5\"\r\n  op: \"Const\"\r\n  attr {\r\n    key: \"dtype\"\r\n    value {\r\n      type: DT_FLOAT\r\n    }\r\n  }\r\n  attr {\r\n    key: \"value\"\r\n    value {\r\n      tensor {\r\n        dtype: DT_FLOAT\r\n        tensor_shape {\r\n          dim {\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n``` \r\nAll such nodes are mentioned in the traceback.\r\n\r\nSo, it's ok for `TensorFlow` itself but wrong for the `TensorRT`. I gues there is an error either in `GraphDef` generation or while parsing for `TensorRT`."}