{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15800", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15800/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15800/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15800/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15800", "id": 285572126, "node_id": "MDU6SXNzdWUyODU1NzIxMjY=", "number": 15800, "title": "[bug] tf.estimator.DNNClassifier setting n_classes has no effect", "user": {"login": "Echooff3", "id": 76337, "node_id": "MDQ6VXNlcjc2MzM3", "avatar_url": "https://avatars3.githubusercontent.com/u/76337?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Echooff3", "html_url": "https://github.com/Echooff3", "followers_url": "https://api.github.com/users/Echooff3/followers", "following_url": "https://api.github.com/users/Echooff3/following{/other_user}", "gists_url": "https://api.github.com/users/Echooff3/gists{/gist_id}", "starred_url": "https://api.github.com/users/Echooff3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Echooff3/subscriptions", "organizations_url": "https://api.github.com/users/Echooff3/orgs", "repos_url": "https://api.github.com/users/Echooff3/repos", "events_url": "https://api.github.com/users/Echooff3/events{/privacy}", "received_events_url": "https://api.github.com/users/Echooff3/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2018-01-03T00:18:44Z", "updated_at": "2018-11-06T21:40:26Z", "closed_at": "2018-01-03T15:52:39Z", "author_association": "NONE", "body_html": "<h3>Describe the problem</h3>\n<p>I was following the examples for a <a href=\"https://developers.googleblog.com/2017/09/introducing-tensorflow-datasets.html\" rel=\"nofollow\">tensorflow estimator</a>. I am setting n_classes but the label check in (_check_labels tensorflow/python/estimator/canned/head.py\", line 222) keeps kicking back the following error:</p>\n<p><strong>ValueError: Mismatched label shape. Classifier configured with n_classes=1.  Received 4. Suggested Fix: check your n_classes argument to the estimator and/or the shape of your label.</strong></p>\n<h3>Source code / logs</h3>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n<span class=\"pl-k\">import</span> numpy <span class=\"pl-k\">as</span> np\n\ntrainX <span class=\"pl-k\">=</span> np.array([<span class=\"pl-c1\">1</span>,<span class=\"pl-c1\">0</span>,<span class=\"pl-c1\">2</span>,<span class=\"pl-c1\">3</span>])\nnum_classes <span class=\"pl-k\">=</span> <span class=\"pl-c1\">4</span>\nfeature_names <span class=\"pl-k\">=</span> [<span class=\"pl-s\"><span class=\"pl-pds\">'</span>f1<span class=\"pl-pds\">'</span></span>]\nfeature_columns <span class=\"pl-k\">=</span> [tf.feature_column.numeric_column(k) <span class=\"pl-k\">for</span> k <span class=\"pl-k\">in</span> feature_names]\nclassifier <span class=\"pl-k\">=</span> tf.estimator.DNNClassifier(<span class=\"pl-v\">feature_columns</span><span class=\"pl-k\">=</span>feature_columns, \n                                            <span class=\"pl-v\">n_classes</span><span class=\"pl-k\">=</span>num_classes, <span class=\"pl-c\"><span class=\"pl-c\">#</span>setting number of classes here</span>\n                                            <span class=\"pl-v\">hidden_units</span><span class=\"pl-k\">=</span>[<span class=\"pl-c1\">10</span>])\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">input_fn</span>():\n    my_int_variable <span class=\"pl-k\">=</span> tf.get_variable(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>my_int_variable<span class=\"pl-pds\">\"</span></span>, [<span class=\"pl-c1\">1</span>], <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>tf.int32, <span class=\"pl-v\">initializer</span><span class=\"pl-k\">=</span>tf.zeros_initializer)\n    label <span class=\"pl-k\">=</span> tf.one_hot(my_int_variable, num_classes) <span class=\"pl-c\"><span class=\"pl-c\">#</span>using same number of classes</span>\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\"><span class=\"pl-pds\">'</span>f1<span class=\"pl-pds\">'</span></span>:trainX},label\n\nclassifier.train(<span class=\"pl-v\">input_fn</span><span class=\"pl-k\">=</span><span class=\"pl-k\">lambda</span>: input_fn())</pre></div>\n<div class=\"highlight highlight-source-shell\"><pre>Traceback (most recent call last):\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>test.py<span class=\"pl-pds\">\"</span></span>, line 17, <span class=\"pl-k\">in</span> <span class=\"pl-k\">&lt;</span>module<span class=\"pl-k\">&gt;</span>\n    classifier.train(input_fn=lambda: <span class=\"pl-en\">input_fn</span>())\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py<span class=\"pl-pds\">\"</span></span>, line 302, <span class=\"pl-k\">in</span> train\n    loss = self._train_model(input_fn, hooks, saving_listeners)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py<span class=\"pl-pds\">\"</span></span>, line 711, <span class=\"pl-k\">in</span> _train_model\n    features, labels, model_fn_lib.ModeKeys.TRAIN, self.config)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py<span class=\"pl-pds\">\"</span></span>, line 694, <span class=\"pl-k\">in</span> _call_model_fn\n    model_fn_results = self._model_fn(features=features, <span class=\"pl-k\">**</span>kwargs)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/canned/dnn.py<span class=\"pl-pds\">\"</span></span>, line 334, <span class=\"pl-k\">in</span> _model_fn\n    config=config)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/canned/dnn.py<span class=\"pl-pds\">\"</span></span>, line 203, <span class=\"pl-k\">in</span> _dnn_model_fn\n    logits=logits)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/canned/head.py<span class=\"pl-pds\">\"</span></span>, line 493, <span class=\"pl-k\">in</span> create_estimator_spec\n    features=features, mode=mode, logits=logits, labels=labels)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/canned/head.py<span class=\"pl-pds\">\"</span></span>, line 433, <span class=\"pl-k\">in</span> create_loss\n    label_ids = self._label_ids(_check_labels(_maybe_expand_dim(labels), 1))\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/canned/head.py<span class=\"pl-pds\">\"</span></span>, line 222, <span class=\"pl-k\">in</span> _check_labels\n    (expected_labels_dimension, dim1))\nValueError: Mismatched label shape. Classifier configured with n_classes=1.  Received 4. Suggested Fix: check your n_classes argument to the estimator and/or the shape of your label.</pre></div>\n<hr>\n<h3>System information</h3>\n<p>Mac OSX 10.12.6<br>\nPython 2.7<br>\nTensorflow ('v1.4.0-19-ga52c8d9b01', '1.4.1')</p>", "body_text": "Describe the problem\nI was following the examples for a tensorflow estimator. I am setting n_classes but the label check in (_check_labels tensorflow/python/estimator/canned/head.py\", line 222) keeps kicking back the following error:\nValueError: Mismatched label shape. Classifier configured with n_classes=1.  Received 4. Suggested Fix: check your n_classes argument to the estimator and/or the shape of your label.\nSource code / logs\nimport tensorflow as tf\nimport numpy as np\n\ntrainX = np.array([1,0,2,3])\nnum_classes = 4\nfeature_names = ['f1']\nfeature_columns = [tf.feature_column.numeric_column(k) for k in feature_names]\nclassifier = tf.estimator.DNNClassifier(feature_columns=feature_columns, \n                                            n_classes=num_classes, #setting number of classes here\n                                            hidden_units=[10])\n\ndef input_fn():\n    my_int_variable = tf.get_variable(\"my_int_variable\", [1], dtype=tf.int32, initializer=tf.zeros_initializer)\n    label = tf.one_hot(my_int_variable, num_classes) #using same number of classes\n    return {'f1':trainX},label\n\nclassifier.train(input_fn=lambda: input_fn())\nTraceback (most recent call last):\n  File \"test.py\", line 17, in <module>\n    classifier.train(input_fn=lambda: input_fn())\n  File \"/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 302, in train\n    loss = self._train_model(input_fn, hooks, saving_listeners)\n  File \"/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 711, in _train_model\n    features, labels, model_fn_lib.ModeKeys.TRAIN, self.config)\n  File \"/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 694, in _call_model_fn\n    model_fn_results = self._model_fn(features=features, **kwargs)\n  File \"/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/canned/dnn.py\", line 334, in _model_fn\n    config=config)\n  File \"/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/canned/dnn.py\", line 203, in _dnn_model_fn\n    logits=logits)\n  File \"/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/canned/head.py\", line 493, in create_estimator_spec\n    features=features, mode=mode, logits=logits, labels=labels)\n  File \"/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/canned/head.py\", line 433, in create_loss\n    label_ids = self._label_ids(_check_labels(_maybe_expand_dim(labels), 1))\n  File \"/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/canned/head.py\", line 222, in _check_labels\n    (expected_labels_dimension, dim1))\nValueError: Mismatched label shape. Classifier configured with n_classes=1.  Received 4. Suggested Fix: check your n_classes argument to the estimator and/or the shape of your label.\n\nSystem information\nMac OSX 10.12.6\nPython 2.7\nTensorflow ('v1.4.0-19-ga52c8d9b01', '1.4.1')", "body": "### Describe the problem\r\nI was following the examples for a [tensorflow estimator](https://developers.googleblog.com/2017/09/introducing-tensorflow-datasets.html). I am setting n_classes but the label check in (_check_labels tensorflow/python/estimator/canned/head.py\", line 222) keeps kicking back the following error:\r\n\r\n**ValueError: Mismatched label shape. Classifier configured with n_classes=1.  Received 4. Suggested Fix: check your n_classes argument to the estimator and/or the shape of your label.**\r\n\r\n### Source code / logs\r\n``` python\r\nimport tensorflow as tf\r\nimport numpy as np\r\n\r\ntrainX = np.array([1,0,2,3])\r\nnum_classes = 4\r\nfeature_names = ['f1']\r\nfeature_columns = [tf.feature_column.numeric_column(k) for k in feature_names]\r\nclassifier = tf.estimator.DNNClassifier(feature_columns=feature_columns, \r\n                                            n_classes=num_classes, #setting number of classes here\r\n                                            hidden_units=[10])\r\n\r\ndef input_fn():\r\n    my_int_variable = tf.get_variable(\"my_int_variable\", [1], dtype=tf.int32, initializer=tf.zeros_initializer)\r\n    label = tf.one_hot(my_int_variable, num_classes) #using same number of classes\r\n    return {'f1':trainX},label\r\n\r\nclassifier.train(input_fn=lambda: input_fn())\r\n```\r\n\r\n``` bash\r\nTraceback (most recent call last):\r\n  File \"test.py\", line 17, in <module>\r\n    classifier.train(input_fn=lambda: input_fn())\r\n  File \"/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 302, in train\r\n    loss = self._train_model(input_fn, hooks, saving_listeners)\r\n  File \"/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 711, in _train_model\r\n    features, labels, model_fn_lib.ModeKeys.TRAIN, self.config)\r\n  File \"/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 694, in _call_model_fn\r\n    model_fn_results = self._model_fn(features=features, **kwargs)\r\n  File \"/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/canned/dnn.py\", line 334, in _model_fn\r\n    config=config)\r\n  File \"/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/canned/dnn.py\", line 203, in _dnn_model_fn\r\n    logits=logits)\r\n  File \"/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/canned/head.py\", line 493, in create_estimator_spec\r\n    features=features, mode=mode, logits=logits, labels=labels)\r\n  File \"/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/canned/head.py\", line 433, in create_loss\r\n    label_ids = self._label_ids(_check_labels(_maybe_expand_dim(labels), 1))\r\n  File \"/home/user/tensorflow/tf/lib/python2.7/site-packages/tensorflow/python/estimator/canned/head.py\", line 222, in _check_labels\r\n    (expected_labels_dimension, dim1))\r\nValueError: Mismatched label shape. Classifier configured with n_classes=1.  Received 4. Suggested Fix: check your n_classes argument to the estimator and/or the shape of your label.\r\n```\r\n\r\n------------------------\r\n\r\n### System information\r\nMac OSX 10.12.6\r\nPython 2.7\r\nTensorflow ('v1.4.0-19-ga52c8d9b01', '1.4.1')\r\n\r\n\r\n\r\n"}