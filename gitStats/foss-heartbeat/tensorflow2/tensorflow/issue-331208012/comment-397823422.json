{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/397823422", "html_url": "https://github.com/tensorflow/tensorflow/issues/19909#issuecomment-397823422", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19909", "id": 397823422, "node_id": "MDEyOklzc3VlQ29tbWVudDM5NzgyMzQyMg==", "user": {"login": "MarkDaoust", "id": 1414837, "node_id": "MDQ6VXNlcjE0MTQ4Mzc=", "avatar_url": "https://avatars1.githubusercontent.com/u/1414837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MarkDaoust", "html_url": "https://github.com/MarkDaoust", "followers_url": "https://api.github.com/users/MarkDaoust/followers", "following_url": "https://api.github.com/users/MarkDaoust/following{/other_user}", "gists_url": "https://api.github.com/users/MarkDaoust/gists{/gist_id}", "starred_url": "https://api.github.com/users/MarkDaoust/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MarkDaoust/subscriptions", "organizations_url": "https://api.github.com/users/MarkDaoust/orgs", "repos_url": "https://api.github.com/users/MarkDaoust/repos", "events_url": "https://api.github.com/users/MarkDaoust/events{/privacy}", "received_events_url": "https://api.github.com/users/MarkDaoust/received_events", "type": "User", "site_admin": false}, "created_at": "2018-06-16T16:24:15Z", "updated_at": "2018-06-16T16:24:15Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Hey <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=25300810\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/spivakoa\">@spivakoa</a></p>\n<p>Is this based on an existing example? which one (there are lots of example folders)? We could look into adding some better handling for batching there.</p>\n<p>I haven't used the c++ interface (but java is similar) so I'm not 100% sure about this, but I think the problem is here:</p>\n<div class=\"highlight highlight-source-c++\"><pre>\t<span class=\"pl-k\">auto</span> boxes = outputs[<span class=\"pl-c1\">0</span>].flat_outer_dims&lt;<span class=\"pl-k\">float</span>, <span class=\"pl-c1\">3</span>&gt;();\n\ttensorflow::TTypes&lt;<span class=\"pl-k\">float</span>&gt;::Flat scores = outputs[<span class=\"pl-c1\">1</span>].flat&lt;<span class=\"pl-k\">float</span>&gt;();\n\ttensorflow::TTypes&lt;<span class=\"pl-k\">float</span>&gt;::Flat classes = outputs[<span class=\"pl-c1\">2</span>].flat&lt;<span class=\"pl-k\">float</span>&gt;();\n\ttensorflow::TTypes&lt;<span class=\"pl-k\">float</span>&gt;::Flat num_detections = outputs[<span class=\"pl-c1\">3</span>].flat&lt;<span class=\"pl-k\">float</span>&gt;();</pre></div>\n<p>The first dimension of the output tensors should be the <code>batch</code> dimension. Can you check the shapes of the tensors to confirm?</p>\n<p>But it looks like you're flattening the tensors (to remove the batch dimension for the batch_size=1 base case). if you check the length of those resulting tensors you should see that they're <code>batch</code> times as long.</p>\n<p>If you can iterate or index along that first dimension those slices will be the single image results you're looking for.</p>", "body_text": "Hey @spivakoa\nIs this based on an existing example? which one (there are lots of example folders)? We could look into adding some better handling for batching there.\nI haven't used the c++ interface (but java is similar) so I'm not 100% sure about this, but I think the problem is here:\n\tauto boxes = outputs[0].flat_outer_dims<float, 3>();\n\ttensorflow::TTypes<float>::Flat scores = outputs[1].flat<float>();\n\ttensorflow::TTypes<float>::Flat classes = outputs[2].flat<float>();\n\ttensorflow::TTypes<float>::Flat num_detections = outputs[3].flat<float>();\nThe first dimension of the output tensors should be the batch dimension. Can you check the shapes of the tensors to confirm?\nBut it looks like you're flattening the tensors (to remove the batch dimension for the batch_size=1 base case). if you check the length of those resulting tensors you should see that they're batch times as long.\nIf you can iterate or index along that first dimension those slices will be the single image results you're looking for.", "body": "Hey @spivakoa \r\n\r\nIs this based on an existing example? which one (there are lots of example folders)? We could look into adding some better handling for batching there.\r\n\r\nI haven't used the c++ interface (but java is similar) so I'm not 100% sure about this, but I think the problem is here:\r\n\r\n```c++\r\n\tauto boxes = outputs[0].flat_outer_dims<float, 3>();\r\n\ttensorflow::TTypes<float>::Flat scores = outputs[1].flat<float>();\r\n\ttensorflow::TTypes<float>::Flat classes = outputs[2].flat<float>();\r\n\ttensorflow::TTypes<float>::Flat num_detections = outputs[3].flat<float>();\r\n```\r\n\r\nThe first dimension of the output tensors should be the `batch` dimension. Can you check the shapes of the tensors to confirm?\r\n\r\nBut it looks like you're flattening the tensors (to remove the batch dimension for the batch_size=1 base case). if you check the length of those resulting tensors you should see that they're `batch` times as long.\r\n\r\n If you can iterate or index along that first dimension those slices will be the single image results you're looking for.\r\n\r\n"}