{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20568", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20568/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20568/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20568/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/20568", "id": 338617551, "node_id": "MDU6SXNzdWUzMzg2MTc1NTE=", "number": 20568, "title": "CMake: Build break occurs when making tf_python_build_pip_package using cmake.", "user": {"login": "again4you", "id": 433435, "node_id": "MDQ6VXNlcjQzMzQzNQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/433435?v=4", "gravatar_id": "", "url": "https://api.github.com/users/again4you", "html_url": "https://github.com/again4you", "followers_url": "https://api.github.com/users/again4you/followers", "following_url": "https://api.github.com/users/again4you/following{/other_user}", "gists_url": "https://api.github.com/users/again4you/gists{/gist_id}", "starred_url": "https://api.github.com/users/again4you/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/again4you/subscriptions", "organizations_url": "https://api.github.com/users/again4you/orgs", "repos_url": "https://api.github.com/users/again4you/repos", "events_url": "https://api.github.com/users/again4you/events{/privacy}", "received_events_url": "https://api.github.com/users/again4you/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586558, "node_id": "MDU6TGFiZWw0MDQ1ODY1NTg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:community%20support", "name": "stat:community support", "color": "f4b400", "default": false}, {"id": 473173351, "node_id": "MDU6TGFiZWw0NzMxNzMzNTE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:build/install", "name": "type:build/install", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2018-07-05T15:14:40Z", "updated_at": "2018-10-31T16:33:43Z", "closed_at": "2018-10-31T16:33:43Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>Problem</h3>\n<p>Build break occurs when making <strong>tf_python_build_pip_package</strong> using <strong>cmake</strong> instead of Bazel.</p>\n<h3>System information</h3>\n<ul>\n<li>Have I written custom code: N/A</li>\n<li>OS Platform and Distribution: Ubuntu 16.04.4 LTS</li>\n<li>TensorFlow installed from: Not installed</li>\n<li>TensorFlow version: N/A</li>\n<li>Python version: 2.7.12</li>\n<li>Bazel version: Not used since CMake build</li>\n<li>CMake version: 3.5.1</li>\n<li>GCC/Compiler version: 5.4.0</li>\n<li>CUDA/cuDNN version: 9.0 (But not important in this case)</li>\n<li>GPU model and memory: Nvidia 1080ti / 11G</li>\n<li>Exact command to reproduce: refer the below 'How to reproduce'</li>\n</ul>\n<h3>Source code information</h3>\n<ul>\n<li>Branch: r1.9</li>\n<li>Commit ID: <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/e3f2b5903c56ec09fa501dd8e95dd0e4336843fc/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/e3f2b5903c56ec09fa501dd8e95dd0e4336843fc\"><tt>e3f2b59</tt></a> (latest when I built)</li>\n<li>Just clone without modification</li>\n</ul>\n<h3>How to reproduce</h3>\n<div class=\"highlight highlight-source-shell\"><pre>$ git clone https://github.com/tensorflow/tensorflow.git\n$ <span class=\"pl-c1\">cd</span> tensorflow\n$ git checkout -b cmake_build_test e3f2b5903c56ec09fa501dd8e95dd0e4336843fc\n$ mkdir build\n$ <span class=\"pl-c1\">cd</span> build\n$ cmake -DCMAKE_BUILD_TYPE=Release ../tensorflow/contrib/cmake\n$ make VERBOSE=1 -j4  tf_python_build_pip_package <span class=\"pl-k\">&amp;</span><span class=\"pl-k\">&gt;</span> cmake_build_log.txt</pre></div>\n<h3>Error message</h3>\n<ul>\n<li>ImportError: No module named tensorflow.python.util</li>\n<li>Download the full build log message: <a href=\"https://www.dropbox.com/s/5hfgqugzbwwu3i2/cmake_build_log.txt?dl=0\" rel=\"nofollow\">link</a></li>\n</ul>\n<div class=\"highlight highlight-source-shell\"><pre>make[3]: Entering directory <span class=\"pl-s\"><span class=\"pl-pds\">'</span>/home/again4you/tensorflow/build<span class=\"pl-pds\">'</span></span>                  \n[100%] Generating __init__.py files <span class=\"pl-k\">for</span> Python API.                             \n<span class=\"pl-c1\">cd</span> /home/again4you/tensorflow/build/tf_python <span class=\"pl-k\">&amp;&amp;</span> /usr/bin/cmake -E remove -f /home/again4you/tensorflow/build/tf_python/tensorflow/__init__.py\n<span class=\"pl-c1\">cd</span> /home/again4you/tensorflow/build/tf_python <span class=\"pl-k\">&amp;&amp;</span> /usr/bin/cmake -E env PYTHONPATH=/home/again4you/tensorflow/build/tf_python /usr/bin/python /home/again4you/tensorflow/build/tf_python/tensorflow/tools/api/generator/create_python_api.py --root_init_template=/home/again4you/tensorflow/build/tf_python/tensorflow/api_template.__init__.py --apidir=/home/again4you/tensorflow/build/tf_python/tensorflow /home/again4you/tensorflow/api_init_files_list.txt\nTraceback (most recent call last):                                              \n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/again4you/tensorflow/build/tf_python/tensorflow/tools/api/generator/create_python_api.py<span class=\"pl-pds\">\"</span></span>, line 27, <span class=\"pl-k\">in</span> <span class=\"pl-k\">&lt;</span>module<span class=\"pl-k\">&gt;</span>\n    from tensorflow.python.util import tf_decorator                             \nImportError: No module named tensorflow.python.util                             \nCMakeFiles/tf_python_api.dir/build.make:57: recipe <span class=\"pl-k\">for</span> target <span class=\"pl-s\"><span class=\"pl-pds\">'</span>tf_python/tensorflow/__init__.py<span class=\"pl-pds\">'</span></span> failed\nmake[3]: <span class=\"pl-k\">***</span> [tf_python/tensorflow/__init__.py] Error 1                         \nmake[3]: Leaving directory <span class=\"pl-s\"><span class=\"pl-pds\">'</span>/home/again4you/tensorflow/build<span class=\"pl-pds\">'</span></span></pre></div>\n<h3>Detailed reason that I found</h3>\n<ul>\n<li><strong>tf_python/tensorflow/__init.py__</strong> does not exist as below.</li>\n</ul>\n<div class=\"highlight highlight-source-shell\"><pre>$ ls tf_python/tensorflow/__init__.py\nls: cannot access <span class=\"pl-s\"><span class=\"pl-pds\">'</span>tf_python/tensorflow/__init__.py<span class=\"pl-pds\">'</span></span>: No such file or directory</pre></div>\n<ul>\n<li>\n<p><del>When building tensorflow using <strong>python 3</strong>, it does not matter since python3 supports <a href=\"https://www.python.org/dev/peps/pep-0420/\" rel=\"nofollow\">Implicit Namespace Packages</a>. So <code>create_python_api.py</code> runs without errors. However, <strong>ImportError</strong> occurs when using <strong>python 2</strong> if tf_python/tensorflow/__init__.py does not exist.</del></p>\n</li>\n<li>\n<p>The similar error occurs when using <strong>python 3</strong>. Refer my below comment.</p>\n</li>\n<li>\n<p>After checking the build log with 'VERBOSE' option, I found out the below message.<br>\nBecause of 'tf_python/tensorflow/<strong>app</strong>' module, 'tf_python/tensorflow/__init__.py' is deleted. But I can't find any 'app' module in tf_python.</p>\n</li>\n</ul>\n<div class=\"highlight highlight-source-shell\"><pre>...\n[100%] Built target tf_extension_ops                                            \nmake -f CMakeFiles/tf_python_api.dir/build.make CMakeFiles/tf_python_api.dir/depend\nmake[3]: Entering directory <span class=\"pl-s\"><span class=\"pl-pds\">'</span>/home/again4you/tensorflow/build<span class=\"pl-pds\">'</span></span>                  \n<span class=\"pl-c1\">cd</span> /home/again4you/tensorflow/build <span class=\"pl-k\">&amp;&amp;</span> /usr/bin/cmake -E cmake_depends <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Unix Makefiles<span class=\"pl-pds\">\"</span></span> /home/again4you/tensorflow/tensorflow/contrib/cmake /home/again4you/tensorflow/tensorflow/contrib/cmake /home/again4you/tensorflow/build /home/again4you/tensorflow/build /home/again4you/tensorflow/build/CMakeFiles/tf_python_api.dir/DependInfo.cmake --color=\nDeleting primary custom <span class=\"pl-c1\">command</span> output <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/again4you/tensorflow/build/tf_python/tensorflow/__init__.py<span class=\"pl-pds\">\"</span></span> because another output <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/again4you/tensorflow/build/tf_python/tensorflow/app/__init__.py<span class=\"pl-pds\">\"</span></span> does not exist.\nDependee <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/again4you/tensorflow/build/CMakeFiles/tf_python_api.dir/DependInfo.cmake<span class=\"pl-pds\">\"</span></span> is newer than depender <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/again4you/tensorflow/build/CMakeFiles/tf_python_api.dir/depend.internal<span class=\"pl-pds\">\"</span></span>.\n...</pre></div>", "body_text": "Problem\nBuild break occurs when making tf_python_build_pip_package using cmake instead of Bazel.\nSystem information\n\nHave I written custom code: N/A\nOS Platform and Distribution: Ubuntu 16.04.4 LTS\nTensorFlow installed from: Not installed\nTensorFlow version: N/A\nPython version: 2.7.12\nBazel version: Not used since CMake build\nCMake version: 3.5.1\nGCC/Compiler version: 5.4.0\nCUDA/cuDNN version: 9.0 (But not important in this case)\nGPU model and memory: Nvidia 1080ti / 11G\nExact command to reproduce: refer the below 'How to reproduce'\n\nSource code information\n\nBranch: r1.9\nCommit ID: e3f2b59 (latest when I built)\nJust clone without modification\n\nHow to reproduce\n$ git clone https://github.com/tensorflow/tensorflow.git\n$ cd tensorflow\n$ git checkout -b cmake_build_test e3f2b5903c56ec09fa501dd8e95dd0e4336843fc\n$ mkdir build\n$ cd build\n$ cmake -DCMAKE_BUILD_TYPE=Release ../tensorflow/contrib/cmake\n$ make VERBOSE=1 -j4  tf_python_build_pip_package &> cmake_build_log.txt\nError message\n\nImportError: No module named tensorflow.python.util\nDownload the full build log message: link\n\nmake[3]: Entering directory '/home/again4you/tensorflow/build'                  \n[100%] Generating __init__.py files for Python API.                             \ncd /home/again4you/tensorflow/build/tf_python && /usr/bin/cmake -E remove -f /home/again4you/tensorflow/build/tf_python/tensorflow/__init__.py\ncd /home/again4you/tensorflow/build/tf_python && /usr/bin/cmake -E env PYTHONPATH=/home/again4you/tensorflow/build/tf_python /usr/bin/python /home/again4you/tensorflow/build/tf_python/tensorflow/tools/api/generator/create_python_api.py --root_init_template=/home/again4you/tensorflow/build/tf_python/tensorflow/api_template.__init__.py --apidir=/home/again4you/tensorflow/build/tf_python/tensorflow /home/again4you/tensorflow/api_init_files_list.txt\nTraceback (most recent call last):                                              \n  File \"/home/again4you/tensorflow/build/tf_python/tensorflow/tools/api/generator/create_python_api.py\", line 27, in <module>\n    from tensorflow.python.util import tf_decorator                             \nImportError: No module named tensorflow.python.util                             \nCMakeFiles/tf_python_api.dir/build.make:57: recipe for target 'tf_python/tensorflow/__init__.py' failed\nmake[3]: *** [tf_python/tensorflow/__init__.py] Error 1                         \nmake[3]: Leaving directory '/home/again4you/tensorflow/build'\nDetailed reason that I found\n\ntf_python/tensorflow/__init.py__ does not exist as below.\n\n$ ls tf_python/tensorflow/__init__.py\nls: cannot access 'tf_python/tensorflow/__init__.py': No such file or directory\n\n\nWhen building tensorflow using python 3, it does not matter since python3 supports Implicit Namespace Packages. So create_python_api.py runs without errors. However, ImportError occurs when using python 2 if tf_python/tensorflow/__init__.py does not exist.\n\n\nThe similar error occurs when using python 3. Refer my below comment.\n\n\nAfter checking the build log with 'VERBOSE' option, I found out the below message.\nBecause of 'tf_python/tensorflow/app' module, 'tf_python/tensorflow/__init__.py' is deleted. But I can't find any 'app' module in tf_python.\n\n\n...\n[100%] Built target tf_extension_ops                                            \nmake -f CMakeFiles/tf_python_api.dir/build.make CMakeFiles/tf_python_api.dir/depend\nmake[3]: Entering directory '/home/again4you/tensorflow/build'                  \ncd /home/again4you/tensorflow/build && /usr/bin/cmake -E cmake_depends \"Unix Makefiles\" /home/again4you/tensorflow/tensorflow/contrib/cmake /home/again4you/tensorflow/tensorflow/contrib/cmake /home/again4you/tensorflow/build /home/again4you/tensorflow/build /home/again4you/tensorflow/build/CMakeFiles/tf_python_api.dir/DependInfo.cmake --color=\nDeleting primary custom command output \"/home/again4you/tensorflow/build/tf_python/tensorflow/__init__.py\" because another output \"/home/again4you/tensorflow/build/tf_python/tensorflow/app/__init__.py\" does not exist.\nDependee \"/home/again4you/tensorflow/build/CMakeFiles/tf_python_api.dir/DependInfo.cmake\" is newer than depender \"/home/again4you/tensorflow/build/CMakeFiles/tf_python_api.dir/depend.internal\".\n...", "body": "### Problem\r\nBuild break occurs when making __tf_python_build_pip_package__ using __cmake__ instead of Bazel.\r\n\r\n### System information\r\n* Have I written custom code: N/A\r\n* OS Platform and Distribution: Ubuntu 16.04.4 LTS\r\n* TensorFlow installed from: Not installed\r\n* TensorFlow version: N/A\r\n* Python version: 2.7.12\r\n* Bazel version: Not used since CMake build\r\n* CMake version: 3.5.1\r\n* GCC/Compiler version: 5.4.0\r\n* CUDA/cuDNN version: 9.0 (But not important in this case)\r\n* GPU model and memory: Nvidia 1080ti / 11G\r\n* Exact command to reproduce: refer the below 'How to reproduce'\r\n\r\n### Source code information\r\n* Branch: r1.9\r\n* Commit ID: e3f2b5903c56ec09fa501dd8e95dd0e4336843fc (latest when I built)\r\n* Just clone without modification\r\n\r\n### How to reproduce \r\n```bash\r\n$ git clone https://github.com/tensorflow/tensorflow.git\r\n$ cd tensorflow\r\n$ git checkout -b cmake_build_test e3f2b5903c56ec09fa501dd8e95dd0e4336843fc\r\n$ mkdir build\r\n$ cd build\r\n$ cmake -DCMAKE_BUILD_TYPE=Release ../tensorflow/contrib/cmake\r\n$ make VERBOSE=1 -j4  tf_python_build_pip_package &> cmake_build_log.txt\r\n```\r\n\r\n### Error message\r\n* ImportError: No module named tensorflow.python.util\r\n* Download the full build log message: [link](https://www.dropbox.com/s/5hfgqugzbwwu3i2/cmake_build_log.txt?dl=0)\r\n```bash\r\nmake[3]: Entering directory '/home/again4you/tensorflow/build'                  \r\n[100%] Generating __init__.py files for Python API.                             \r\ncd /home/again4you/tensorflow/build/tf_python && /usr/bin/cmake -E remove -f /home/again4you/tensorflow/build/tf_python/tensorflow/__init__.py\r\ncd /home/again4you/tensorflow/build/tf_python && /usr/bin/cmake -E env PYTHONPATH=/home/again4you/tensorflow/build/tf_python /usr/bin/python /home/again4you/tensorflow/build/tf_python/tensorflow/tools/api/generator/create_python_api.py --root_init_template=/home/again4you/tensorflow/build/tf_python/tensorflow/api_template.__init__.py --apidir=/home/again4you/tensorflow/build/tf_python/tensorflow /home/again4you/tensorflow/api_init_files_list.txt\r\nTraceback (most recent call last):                                              \r\n  File \"/home/again4you/tensorflow/build/tf_python/tensorflow/tools/api/generator/create_python_api.py\", line 27, in <module>\r\n    from tensorflow.python.util import tf_decorator                             \r\nImportError: No module named tensorflow.python.util                             \r\nCMakeFiles/tf_python_api.dir/build.make:57: recipe for target 'tf_python/tensorflow/__init__.py' failed\r\nmake[3]: *** [tf_python/tensorflow/__init__.py] Error 1                         \r\nmake[3]: Leaving directory '/home/again4you/tensorflow/build'\r\n```\r\n\r\n### Detailed reason that I found\r\n* __tf_python/tensorflow/\\_\\_init.py\\_\\___ does not exist as below.\r\n```bash\r\n$ ls tf_python/tensorflow/__init__.py\r\nls: cannot access 'tf_python/tensorflow/__init__.py': No such file or directory\r\n```\r\n\r\n* ~~When building tensorflow using __python 3__, it does not matter since python3 supports [Implicit Namespace Packages](https://www.python.org/dev/peps/pep-0420/). So `create_python_api.py` runs without errors. However, __ImportError__ occurs when using __python 2__ if tf_python/tensorflow/\\_\\_init\\_\\_.py does not exist.~~\r\n* The similar error occurs when using __python 3__. Refer my below comment.\r\n\r\n* After checking the build log with 'VERBOSE' option, I found out the below message.\r\nBecause of 'tf_python/tensorflow/**app**' module, 'tf_python/tensorflow/\\_\\_init\\_\\_.py' is deleted. But I can't find any 'app' module in tf_python.\r\n\r\n```bash\r\n...\r\n[100%] Built target tf_extension_ops                                            \r\nmake -f CMakeFiles/tf_python_api.dir/build.make CMakeFiles/tf_python_api.dir/depend\r\nmake[3]: Entering directory '/home/again4you/tensorflow/build'                  \r\ncd /home/again4you/tensorflow/build && /usr/bin/cmake -E cmake_depends \"Unix Makefiles\" /home/again4you/tensorflow/tensorflow/contrib/cmake /home/again4you/tensorflow/tensorflow/contrib/cmake /home/again4you/tensorflow/build /home/again4you/tensorflow/build /home/again4you/tensorflow/build/CMakeFiles/tf_python_api.dir/DependInfo.cmake --color=\r\nDeleting primary custom command output \"/home/again4you/tensorflow/build/tf_python/tensorflow/__init__.py\" because another output \"/home/again4you/tensorflow/build/tf_python/tensorflow/app/__init__.py\" does not exist.\r\nDependee \"/home/again4you/tensorflow/build/CMakeFiles/tf_python_api.dir/DependInfo.cmake\" is newer than depender \"/home/again4you/tensorflow/build/CMakeFiles/tf_python_api.dir/depend.internal\".\r\n...\r\n```\r\n"}