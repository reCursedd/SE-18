{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14257", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14257/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14257/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14257/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/14257", "id": 271276742, "node_id": "MDU6SXNzdWUyNzEyNzY3NDI=", "number": 14257, "title": "TFGAN gan_model tensor conversion necessary?", "user": {"login": "sleighsoft", "id": 9438971, "node_id": "MDQ6VXNlcjk0Mzg5NzE=", "avatar_url": "https://avatars3.githubusercontent.com/u/9438971?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sleighsoft", "html_url": "https://github.com/sleighsoft", "followers_url": "https://api.github.com/users/sleighsoft/followers", "following_url": "https://api.github.com/users/sleighsoft/following{/other_user}", "gists_url": "https://api.github.com/users/sleighsoft/gists{/gist_id}", "starred_url": "https://api.github.com/users/sleighsoft/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sleighsoft/subscriptions", "organizations_url": "https://api.github.com/users/sleighsoft/orgs", "repos_url": "https://api.github.com/users/sleighsoft/repos", "events_url": "https://api.github.com/users/sleighsoft/events{/privacy}", "received_events_url": "https://api.github.com/users/sleighsoft/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473173272, "node_id": "MDU6TGFiZWw0NzMxNzMyNzI=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:feature", "name": "type:feature", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "joel-shor", "id": 6020988, "node_id": "MDQ6VXNlcjYwMjA5ODg=", "avatar_url": "https://avatars1.githubusercontent.com/u/6020988?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joel-shor", "html_url": "https://github.com/joel-shor", "followers_url": "https://api.github.com/users/joel-shor/followers", "following_url": "https://api.github.com/users/joel-shor/following{/other_user}", "gists_url": "https://api.github.com/users/joel-shor/gists{/gist_id}", "starred_url": "https://api.github.com/users/joel-shor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joel-shor/subscriptions", "organizations_url": "https://api.github.com/users/joel-shor/orgs", "repos_url": "https://api.github.com/users/joel-shor/repos", "events_url": "https://api.github.com/users/joel-shor/events{/privacy}", "received_events_url": "https://api.github.com/users/joel-shor/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "joel-shor", "id": 6020988, "node_id": "MDQ6VXNlcjYwMjA5ODg=", "avatar_url": "https://avatars1.githubusercontent.com/u/6020988?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joel-shor", "html_url": "https://github.com/joel-shor", "followers_url": "https://api.github.com/users/joel-shor/followers", "following_url": "https://api.github.com/users/joel-shor/following{/other_user}", "gists_url": "https://api.github.com/users/joel-shor/gists{/gist_id}", "starred_url": "https://api.github.com/users/joel-shor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joel-shor/subscriptions", "organizations_url": "https://api.github.com/users/joel-shor/orgs", "repos_url": "https://api.github.com/users/joel-shor/repos", "events_url": "https://api.github.com/users/joel-shor/events{/privacy}", "received_events_url": "https://api.github.com/users/joel-shor/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 25, "created_at": "2017-11-05T13:29:27Z", "updated_at": "2018-01-18T21:27:31Z", "closed_at": "2018-01-18T21:27:31Z", "author_association": "CONTRIBUTOR", "body_html": "<p>I would like to use the <code>Dataset</code> API with the <code>GANEstimator</code>/<code>TFGAN</code>.</p>\n<p>I know that <code>MakeIterator</code> cannot be cast to a tensor, but I would like to pass it to <code>generator_fn</code> anyways. Is the conversion of <code>generator_inputs</code> to tensors really necessary?</p>\n<p>With the plain <code>Estimator</code> API I also do not have this restriction.</p>\n<p>I am passing the following object to <code>gan_model</code> through <code>generator_inputs</code>:</p>\n<div class=\"highlight highlight-source-python\"><pre>TextInput(<span class=\"pl-v\">initializer</span><span class=\"pl-k\">=</span><span class=\"pl-k\">&lt;</span>tf.Operation <span class=\"pl-s\"><span class=\"pl-pds\">'</span>MakeIterator<span class=\"pl-pds\">'</span></span> <span class=\"pl-v\">type</span><span class=\"pl-k\">=</span>MakeIterator<span class=\"pl-k\">&gt;</span>, <span class=\"pl-v\">batch_size</span><span class=\"pl-k\">=</span><span class=\"pl-k\">&lt;</span>tf.Tensor <span class=\"pl-s\"><span class=\"pl-pds\">'</span>Size:0<span class=\"pl-pds\">'</span></span> <span class=\"pl-v\">shape</span><span class=\"pl-k\">=</span>() <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>int32<span class=\"pl-k\">&gt;</span>, <span class=\"pl-v\">source</span><span class=\"pl-k\">=</span><span class=\"pl-k\">&lt;</span>tf.Tensor <span class=\"pl-s\"><span class=\"pl-pds\">'</span>IteratorGetNext:0<span class=\"pl-pds\">'</span></span> <span class=\"pl-v\">shape</span><span class=\"pl-k\">=</span>(<span class=\"pl-ii\">?</span>, <span class=\"pl-ii\">?</span>) <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>int32<span class=\"pl-k\">&gt;</span>, <span class=\"pl-v\">target_input</span><span class=\"pl-k\">=</span><span class=\"pl-k\">&lt;</span>tf.Tensor <span class=\"pl-s\"><span class=\"pl-pds\">'</span>IteratorGetNext:1<span class=\"pl-pds\">'</span></span> <span class=\"pl-v\">shape</span><span class=\"pl-k\">=</span>(<span class=\"pl-ii\">?</span>, <span class=\"pl-ii\">?</span>) <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>int32<span class=\"pl-k\">&gt;</span>, <span class=\"pl-v\">target_output</span><span class=\"pl-k\">=</span><span class=\"pl-k\">&lt;</span>tf.Tensor <span class=\"pl-s\"><span class=\"pl-pds\">'</span>IteratorGetNext:2<span class=\"pl-pds\">'</span></span> <span class=\"pl-v\">shape</span><span class=\"pl-k\">=</span>(<span class=\"pl-ii\">?</span>, <span class=\"pl-ii\">?</span>) <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>int32<span class=\"pl-k\">&gt;</span>, <span class=\"pl-v\">source_sequence_length</span><span class=\"pl-k\">=</span><span class=\"pl-k\">&lt;</span>tf.Tensor <span class=\"pl-s\"><span class=\"pl-pds\">'</span>IteratorGetNext:3<span class=\"pl-pds\">'</span></span> <span class=\"pl-v\">shape</span><span class=\"pl-k\">=</span>(<span class=\"pl-ii\">?</span>,) <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>int32<span class=\"pl-k\">&gt;</span>, <span class=\"pl-v\">target_sequence_length</span><span class=\"pl-k\">=</span><span class=\"pl-k\">&lt;</span>tf.Tensor <span class=\"pl-s\"><span class=\"pl-pds\">'</span>IteratorGetNext:4<span class=\"pl-pds\">'</span></span> <span class=\"pl-v\">shape</span><span class=\"pl-k\">=</span>(<span class=\"pl-ii\">?</span>,) <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>int32<span class=\"pl-k\">&gt;</span>)</pre></div>\n<p>When running my program <code>_convert_tensor_or_l_or_d</code> throws an error:</p>\n<pre><code>  File \"C:\\Development\\Tools\\miniconda\\envs\\tf-backbone\\lib\\site-packages\\tensorflow\\contrib\\gan\\python\\train.py\", line 103, in gan_model\n    with variable_scope.variable_scope(generator_scope) as gen_scope:\n  File \"C:\\Development\\Tools\\miniconda\\envs\\tf-backbone\\lib\\site-packages\\tensorflow\\contrib\\gan\\python\\train.py\", line 789, in _convert_tensor_or_l_or_d\n    return [ops.convert_to_tensor(x) for x in tensor_or_l_or_d]\n  File \"C:\\Development\\Tools\\miniconda\\envs\\tf-backbone\\lib\\site-packages\\tensorflow\\contrib\\gan\\python\\train.py\", line 789, in &lt;listcomp&gt;\n    return [ops.convert_to_tensor(x) for x in tensor_or_l_or_d]\n  File \"C:\\Development\\Tools\\miniconda\\envs\\tf-backbone\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 836, in convert_to_tensor\n    as_ref=False)\n  File \"C:\\Development\\Tools\\miniconda\\envs\\tf-backbone\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 926, in internal_convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"C:\\Development\\Tools\\miniconda\\envs\\tf-backbone\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 5069, in _operation_conversion_error\n    name, as_ref))\nTypeError: Can't convert Operation 'MakeIterator' to Tensor (target dtype=None, name=None, as_ref=False)\n</code></pre>\n<p><div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/7f84d88d39f236e5c0cea492a2248782e696c972/tensorflow/contrib/gan/python/train.py#L104\">tensorflow/tensorflow/contrib/gan/python/train.py</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n         Line 104\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/7f84d88d39f236e5c0cea492a2248782e696c972\">7f84d88</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L104\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"104\"></td>\n          <td id=\"LC104\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> generator_inputs <span class=\"pl-k\">=</span> _convert_tensor_or_l_or_d(generator_inputs) </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>", "body_text": "I would like to use the Dataset API with the GANEstimator/TFGAN.\nI know that MakeIterator cannot be cast to a tensor, but I would like to pass it to generator_fn anyways. Is the conversion of generator_inputs to tensors really necessary?\nWith the plain Estimator API I also do not have this restriction.\nI am passing the following object to gan_model through generator_inputs:\nTextInput(initializer=<tf.Operation 'MakeIterator' type=MakeIterator>, batch_size=<tf.Tensor 'Size:0' shape=() dtype=int32>, source=<tf.Tensor 'IteratorGetNext:0' shape=(?, ?) dtype=int32>, target_input=<tf.Tensor 'IteratorGetNext:1' shape=(?, ?) dtype=int32>, target_output=<tf.Tensor 'IteratorGetNext:2' shape=(?, ?) dtype=int32>, source_sequence_length=<tf.Tensor 'IteratorGetNext:3' shape=(?,) dtype=int32>, target_sequence_length=<tf.Tensor 'IteratorGetNext:4' shape=(?,) dtype=int32>)\nWhen running my program _convert_tensor_or_l_or_d throws an error:\n  File \"C:\\Development\\Tools\\miniconda\\envs\\tf-backbone\\lib\\site-packages\\tensorflow\\contrib\\gan\\python\\train.py\", line 103, in gan_model\n    with variable_scope.variable_scope(generator_scope) as gen_scope:\n  File \"C:\\Development\\Tools\\miniconda\\envs\\tf-backbone\\lib\\site-packages\\tensorflow\\contrib\\gan\\python\\train.py\", line 789, in _convert_tensor_or_l_or_d\n    return [ops.convert_to_tensor(x) for x in tensor_or_l_or_d]\n  File \"C:\\Development\\Tools\\miniconda\\envs\\tf-backbone\\lib\\site-packages\\tensorflow\\contrib\\gan\\python\\train.py\", line 789, in <listcomp>\n    return [ops.convert_to_tensor(x) for x in tensor_or_l_or_d]\n  File \"C:\\Development\\Tools\\miniconda\\envs\\tf-backbone\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 836, in convert_to_tensor\n    as_ref=False)\n  File \"C:\\Development\\Tools\\miniconda\\envs\\tf-backbone\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 926, in internal_convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"C:\\Development\\Tools\\miniconda\\envs\\tf-backbone\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 5069, in _operation_conversion_error\n    name, as_ref))\nTypeError: Can't convert Operation 'MakeIterator' to Tensor (target dtype=None, name=None, as_ref=False)\n\n\n  \n    \n      tensorflow/tensorflow/contrib/gan/python/train.py\n    \n    \n         Line 104\n      in\n      7f84d88\n    \n    \n    \n    \n\n        \n          \n           generator_inputs = _convert_tensor_or_l_or_d(generator_inputs)", "body": "I would like to use the `Dataset` API with the `GANEstimator`/`TFGAN`.\r\n\r\nI know that `MakeIterator` cannot be cast to a tensor, but I would like to pass it to `generator_fn` anyways. Is the conversion of `generator_inputs` to tensors really necessary?\r\n\r\nWith the plain `Estimator` API I also do not have this restriction.\r\n\r\nI am passing the following object to `gan_model` through `generator_inputs`:\r\n```python\r\nTextInput(initializer=<tf.Operation 'MakeIterator' type=MakeIterator>, batch_size=<tf.Tensor 'Size:0' shape=() dtype=int32>, source=<tf.Tensor 'IteratorGetNext:0' shape=(?, ?) dtype=int32>, target_input=<tf.Tensor 'IteratorGetNext:1' shape=(?, ?) dtype=int32>, target_output=<tf.Tensor 'IteratorGetNext:2' shape=(?, ?) dtype=int32>, source_sequence_length=<tf.Tensor 'IteratorGetNext:3' shape=(?,) dtype=int32>, target_sequence_length=<tf.Tensor 'IteratorGetNext:4' shape=(?,) dtype=int32>)\r\n``` \r\n\r\nWhen running my program `_convert_tensor_or_l_or_d` throws an error:\r\n```\r\n  File \"C:\\Development\\Tools\\miniconda\\envs\\tf-backbone\\lib\\site-packages\\tensorflow\\contrib\\gan\\python\\train.py\", line 103, in gan_model\r\n    with variable_scope.variable_scope(generator_scope) as gen_scope:\r\n  File \"C:\\Development\\Tools\\miniconda\\envs\\tf-backbone\\lib\\site-packages\\tensorflow\\contrib\\gan\\python\\train.py\", line 789, in _convert_tensor_or_l_or_d\r\n    return [ops.convert_to_tensor(x) for x in tensor_or_l_or_d]\r\n  File \"C:\\Development\\Tools\\miniconda\\envs\\tf-backbone\\lib\\site-packages\\tensorflow\\contrib\\gan\\python\\train.py\", line 789, in <listcomp>\r\n    return [ops.convert_to_tensor(x) for x in tensor_or_l_or_d]\r\n  File \"C:\\Development\\Tools\\miniconda\\envs\\tf-backbone\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 836, in convert_to_tensor\r\n    as_ref=False)\r\n  File \"C:\\Development\\Tools\\miniconda\\envs\\tf-backbone\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 926, in internal_convert_to_tensor\r\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\r\n  File \"C:\\Development\\Tools\\miniconda\\envs\\tf-backbone\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 5069, in _operation_conversion_error\r\n    name, as_ref))\r\nTypeError: Can't convert Operation 'MakeIterator' to Tensor (target dtype=None, name=None, as_ref=False)\r\n```\r\n\r\nhttps://github.com/tensorflow/tensorflow/blob/7f84d88d39f236e5c0cea492a2248782e696c972/tensorflow/contrib/gan/python/train.py#L104"}