{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22881", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22881/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22881/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22881/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/22881", "id": 368931793, "node_id": "MDU6SXNzdWUzNjg5MzE3OTM=", "number": 22881, "title": "How to quantize the format of h5 by API tf.keras ?", "user": {"login": "dlml", "id": 35597616, "node_id": "MDQ6VXNlcjM1NTk3NjE2", "avatar_url": "https://avatars3.githubusercontent.com/u/35597616?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dlml", "html_url": "https://github.com/dlml", "followers_url": "https://api.github.com/users/dlml/followers", "following_url": "https://api.github.com/users/dlml/following{/other_user}", "gists_url": "https://api.github.com/users/dlml/gists{/gist_id}", "starred_url": "https://api.github.com/users/dlml/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dlml/subscriptions", "organizations_url": "https://api.github.com/users/dlml/orgs", "repos_url": "https://api.github.com/users/dlml/repos", "events_url": "https://api.github.com/users/dlml/events{/privacy}", "received_events_url": "https://api.github.com/users/dlml/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1097546578, "node_id": "MDU6TGFiZWwxMDk3NTQ2NTc4", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:keras", "name": "comp:keras", "color": "0052cc", "default": false}, {"id": 750616506, "node_id": "MDU6TGFiZWw3NTA2MTY1MDY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:lite", "name": "comp:lite", "color": "0052cc", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "wt-huang", "id": 42785337, "node_id": "MDQ6VXNlcjQyNzg1MzM3", "avatar_url": "https://avatars0.githubusercontent.com/u/42785337?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wt-huang", "html_url": "https://github.com/wt-huang", "followers_url": "https://api.github.com/users/wt-huang/followers", "following_url": "https://api.github.com/users/wt-huang/following{/other_user}", "gists_url": "https://api.github.com/users/wt-huang/gists{/gist_id}", "starred_url": "https://api.github.com/users/wt-huang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wt-huang/subscriptions", "organizations_url": "https://api.github.com/users/wt-huang/orgs", "repos_url": "https://api.github.com/users/wt-huang/repos", "events_url": "https://api.github.com/users/wt-huang/events{/privacy}", "received_events_url": "https://api.github.com/users/wt-huang/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "wt-huang", "id": 42785337, "node_id": "MDQ6VXNlcjQyNzg1MzM3", "avatar_url": "https://avatars0.githubusercontent.com/u/42785337?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wt-huang", "html_url": "https://github.com/wt-huang", "followers_url": "https://api.github.com/users/wt-huang/followers", "following_url": "https://api.github.com/users/wt-huang/following{/other_user}", "gists_url": "https://api.github.com/users/wt-huang/gists{/gist_id}", "starred_url": "https://api.github.com/users/wt-huang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wt-huang/subscriptions", "organizations_url": "https://api.github.com/users/wt-huang/orgs", "repos_url": "https://api.github.com/users/wt-huang/repos", "events_url": "https://api.github.com/users/wt-huang/events{/privacy}", "received_events_url": "https://api.github.com/users/wt-huang/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2018-10-11T02:55:41Z", "updated_at": "2018-11-12T01:19:57Z", "closed_at": "2018-11-12T01:19:57Z", "author_association": "NONE", "body_html": "<p>import numpy as np<br>\nimport tensorflow as tf</p>\n<p><strong>the code only generate a float tflite, but i want to get an int8 tflite, i dont't kown how to do</strong><br>\nif somebody can solve this issue <a href=\"url\">https://github.com/tensorflow/tensorflow/issues/22880</a> , maybe this problem can be solved.</p>\n<h1>Generate tf.keras model.</h1>\n<p>model = tf.keras.models.Sequential()<br>\nmodel.add(tf.keras.layers.Dense(2, input_shape=(3,)))<br>\nmodel.add(tf.keras.layers.RepeatVector(3))<br>\nmodel.add(tf.keras.layers.TimeDistributed(tf.keras.layers.Dense(3)))<br>\nmodel.compile(loss=tf.keras.losses.MSE,<br>\noptimizer=tf.keras.optimizers.RMSprop(lr=0.0001),<br>\nmetrics=[tf.keras.metrics.categorical_accuracy],<br>\nsample_weight_mode='temporal')</p>\n<p>x = np.random.random((1, 3))<br>\ny = np.random.random((1, 3, 3))<br>\nmodel.train_on_batch(x, y)<br>\nmodel.predict(x)</p>\n<h1>Save tf.keras model in HDF5 format.</h1>\n<p>keras_file = \"keras_model.h5\"<br>\ntf.keras.models.save_model(model, keras_file)</p>\n<h1>Convert to TensorFlow Lite model.</h1>\n<p>converter = tf.contrib.lite.TFLiteConverter.from_keras_model_file(keras_file)<br>\ntflite_model = converter.convert()<br>\nopen(\"converted_model.tflite\", \"wb\").write(tflite_model)</p>", "body_text": "import numpy as np\nimport tensorflow as tf\nthe code only generate a float tflite, but i want to get an int8 tflite, i dont't kown how to do\nif somebody can solve this issue https://github.com/tensorflow/tensorflow/issues/22880 , maybe this problem can be solved.\nGenerate tf.keras model.\nmodel = tf.keras.models.Sequential()\nmodel.add(tf.keras.layers.Dense(2, input_shape=(3,)))\nmodel.add(tf.keras.layers.RepeatVector(3))\nmodel.add(tf.keras.layers.TimeDistributed(tf.keras.layers.Dense(3)))\nmodel.compile(loss=tf.keras.losses.MSE,\noptimizer=tf.keras.optimizers.RMSprop(lr=0.0001),\nmetrics=[tf.keras.metrics.categorical_accuracy],\nsample_weight_mode='temporal')\nx = np.random.random((1, 3))\ny = np.random.random((1, 3, 3))\nmodel.train_on_batch(x, y)\nmodel.predict(x)\nSave tf.keras model in HDF5 format.\nkeras_file = \"keras_model.h5\"\ntf.keras.models.save_model(model, keras_file)\nConvert to TensorFlow Lite model.\nconverter = tf.contrib.lite.TFLiteConverter.from_keras_model_file(keras_file)\ntflite_model = converter.convert()\nopen(\"converted_model.tflite\", \"wb\").write(tflite_model)", "body": "import numpy as np\r\nimport tensorflow as tf\r\n\r\n**the code only generate a float tflite, but i want to get an int8 tflite, i dont't kown how to do** \r\nif somebody can solve this issue [https://github.com/tensorflow/tensorflow/issues/22880](url) , maybe this problem can be solved.\r\n\r\n# Generate tf.keras model.\r\nmodel = tf.keras.models.Sequential()\r\nmodel.add(tf.keras.layers.Dense(2, input_shape=(3,)))\r\nmodel.add(tf.keras.layers.RepeatVector(3))\r\nmodel.add(tf.keras.layers.TimeDistributed(tf.keras.layers.Dense(3)))\r\nmodel.compile(loss=tf.keras.losses.MSE,\r\n              optimizer=tf.keras.optimizers.RMSprop(lr=0.0001),\r\n              metrics=[tf.keras.metrics.categorical_accuracy],\r\n              sample_weight_mode='temporal')\r\n\r\nx = np.random.random((1, 3))\r\ny = np.random.random((1, 3, 3))\r\nmodel.train_on_batch(x, y)\r\nmodel.predict(x)\r\n\r\n# Save tf.keras model in HDF5 format.\r\nkeras_file = \"keras_model.h5\"\r\ntf.keras.models.save_model(model, keras_file)\r\n\r\n# Convert to TensorFlow Lite model.\r\nconverter = tf.contrib.lite.TFLiteConverter.from_keras_model_file(keras_file)\r\ntflite_model = converter.convert()\r\nopen(\"converted_model.tflite\", \"wb\").write(tflite_model)"}