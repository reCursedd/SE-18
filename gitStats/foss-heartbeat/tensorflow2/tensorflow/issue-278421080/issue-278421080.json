{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15034", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15034/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15034/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15034/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15034", "id": 278421080, "node_id": "MDU6SXNzdWUyNzg0MjEwODA=", "number": 15034, "title": "Optimize graph & graph transform tools do not support NCHW", "user": {"login": "khanrc", "id": 3657248, "node_id": "MDQ6VXNlcjM2NTcyNDg=", "avatar_url": "https://avatars1.githubusercontent.com/u/3657248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/khanrc", "html_url": "https://github.com/khanrc", "followers_url": "https://api.github.com/users/khanrc/followers", "following_url": "https://api.github.com/users/khanrc/following{/other_user}", "gists_url": "https://api.github.com/users/khanrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/khanrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/khanrc/subscriptions", "organizations_url": "https://api.github.com/users/khanrc/orgs", "repos_url": "https://api.github.com/users/khanrc/repos", "events_url": "https://api.github.com/users/khanrc/events{/privacy}", "received_events_url": "https://api.github.com/users/khanrc/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2017-12-01T10:24:45Z", "updated_at": "2018-01-31T23:02:26Z", "closed_at": "2018-01-31T23:02:26Z", "author_association": "NONE", "body_html": "<p>I tried optimizing graph using both <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/graph_transforms/README.md\">Graph transform tool</a> and <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/tools/optimize_for_inference.py\">Optimize graph for inference</a>. Both cases produced the same error because the fused batchnorm used not NCHW, but NHWC. I've got the error like this:</p>\n<pre><code>InvalidArgumentError (see above for traceback): Must provide as many biases as the channel dimension of the input tensor: [256] vs. 19 in [1,256,19,19]\n\t [[Node: prefix/convblock/BatchNorm/FusedBatchNorm = BiasAdd[T=DT_FLOAT, data_format=\"NHWC\", _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"](prefix/convblock/Conv2D, prefix/convblock/Conv2D_bn_offset)]\n</code></pre>\n<p>Although NCHW is faster than NHWC in GPU environment, why the tools do not support NCHW?</p>", "body_text": "I tried optimizing graph using both Graph transform tool and Optimize graph for inference. Both cases produced the same error because the fused batchnorm used not NCHW, but NHWC. I've got the error like this:\nInvalidArgumentError (see above for traceback): Must provide as many biases as the channel dimension of the input tensor: [256] vs. 19 in [1,256,19,19]\n\t [[Node: prefix/convblock/BatchNorm/FusedBatchNorm = BiasAdd[T=DT_FLOAT, data_format=\"NHWC\", _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"](prefix/convblock/Conv2D, prefix/convblock/Conv2D_bn_offset)]\n\nAlthough NCHW is faster than NHWC in GPU environment, why the tools do not support NCHW?", "body": "I tried optimizing graph using both [Graph transform tool](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/graph_transforms/README.md) and [Optimize graph for inference](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/tools/optimize_for_inference.py). Both cases produced the same error because the fused batchnorm used not NCHW, but NHWC. I've got the error like this:\r\n\r\n```\r\nInvalidArgumentError (see above for traceback): Must provide as many biases as the channel dimension of the input tensor: [256] vs. 19 in [1,256,19,19]\r\n\t [[Node: prefix/convblock/BatchNorm/FusedBatchNorm = BiasAdd[T=DT_FLOAT, data_format=\"NHWC\", _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"](prefix/convblock/Conv2D, prefix/convblock/Conv2D_bn_offset)]\r\n```\r\n\r\nAlthough NCHW is faster than NHWC in GPU environment, why the tools do not support NCHW?\r\n\r\n"}