{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/157068142", "pull_request_review_id": 83651513, "id": 157068142, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzA2ODE0Mg==", "diff_hunk": "@@ -352,32 +354,45 @@ def _SvdGrad(op, grad_s, grad_u, grad_v):\n             array_ops.expand_dims(s2, -2) - array_ops.expand_dims(s2, -1)),\n         array_ops.zeros_like(s))\n     s_inv_mat = array_ops.matrix_diag(math_ops.reciprocal(s))\n+\n+    v1 = v[..., :, :m]\n+    grad_v1 = grad_v[..., :, :m]\n+\n     u_gu = math_ops.matmul(u, grad_u, adjoint_a=True)\n-    v_gv = math_ops.matmul(v, grad_v, adjoint_a=True)\n+    v_gv = math_ops.matmul(v1, grad_v1, adjoint_a=True)\n \n-    if m == n:\n-      f_u = f * u_gu\n-      f_v = f * v_gv\n-    else:\n-      dv2 = array_ops.matrix_transpose(v_gv[..., m:n, :m]) - v_gv[..., :m, m:n]\n-      f_u = f * u_gu\n-      f_v = f * v_gv[..., :m, :m]\n+    f_u = f * u_gu\n+    f_v = f * v_gv\n \n-    grad_a_nouv = (\n+    term1_nouv = (\n         grad_s_mat + math_ops.matmul(f_u + _linalg.adjoint(f_u), s_mat) +\n         math_ops.matmul(s_mat, f_v + _linalg.adjoint(f_v)))\n \n-    if m != n:\n-      grad_a_nouv = array_ops.concat(\n-          [grad_a_nouv, math_ops.matmul(s_inv_mat, dv2)], -1)\n+    term1 = math_ops.matmul(u, math_ops.matmul(term1_nouv, v1, adjoint_b=True))\n+\n+    if m == n:\n+      grad_a_before_transpose = term1\n+    else:\n+      proj_v1_perp = (linalg_ops.eye(n, dtype=v.dtype)", "path": "tensorflow/python/ops/linalg_grad.py", "position": null, "original_position": 79, "commit_id": "f7a0cc05b4210ae3f1598de619da37f94ff3d2b2", "original_commit_id": "b739ee1734baf437f1925ea09d07647ec7602caf", "user": {"login": "rmlarsen", "id": 16907534, "node_id": "MDQ6VXNlcjE2OTA3NTM0", "avatar_url": "https://avatars2.githubusercontent.com/u/16907534?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rmlarsen", "html_url": "https://github.com/rmlarsen", "followers_url": "https://api.github.com/users/rmlarsen/followers", "following_url": "https://api.github.com/users/rmlarsen/following{/other_user}", "gists_url": "https://api.github.com/users/rmlarsen/gists{/gist_id}", "starred_url": "https://api.github.com/users/rmlarsen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rmlarsen/subscriptions", "organizations_url": "https://api.github.com/users/rmlarsen/orgs", "repos_url": "https://api.github.com/users/rmlarsen/repos", "events_url": "https://api.github.com/users/rmlarsen/events{/privacy}", "received_events_url": "https://api.github.com/users/rmlarsen/received_events", "type": "User", "site_admin": false}, "body": "proj_v1_perp is potentially very large. I think it would be more efficient to compute term2_nous as\r\n\r\ngrad_v1 - math_ops.matmul(math_ops.matmul(grad_v1, v1), v1, adjoint_b=True)", "created_at": "2017-12-14T21:35:01Z", "updated_at": "2017-12-18T04:35:35Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/14259#discussion_r157068142", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/14259", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/157068142"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/14259#discussion_r157068142"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/14259"}}, "body_html": "<p>proj_v1_perp is potentially very large. I think it would be more efficient to compute term2_nous as</p>\n<p>grad_v1 - math_ops.matmul(math_ops.matmul(grad_v1, v1), v1, adjoint_b=True)</p>", "body_text": "proj_v1_perp is potentially very large. I think it would be more efficient to compute term2_nous as\ngrad_v1 - math_ops.matmul(math_ops.matmul(grad_v1, v1), v1, adjoint_b=True)"}