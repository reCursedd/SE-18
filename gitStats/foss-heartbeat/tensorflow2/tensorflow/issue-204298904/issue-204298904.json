{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7162", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7162/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7162/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7162/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/7162", "id": 204298904, "node_id": "MDU6SXNzdWUyMDQyOTg5MDQ=", "number": 7162, "title": "Can't quantize nodes of an RNN (\"The node has inputs from different frames.\")", "user": {"login": "reuben", "id": 477142, "node_id": "MDQ6VXNlcjQ3NzE0Mg==", "avatar_url": "https://avatars3.githubusercontent.com/u/477142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/reuben", "html_url": "https://github.com/reuben", "followers_url": "https://api.github.com/users/reuben/followers", "following_url": "https://api.github.com/users/reuben/following{/other_user}", "gists_url": "https://api.github.com/users/reuben/gists{/gist_id}", "starred_url": "https://api.github.com/users/reuben/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/reuben/subscriptions", "organizations_url": "https://api.github.com/users/reuben/orgs", "repos_url": "https://api.github.com/users/reuben/repos", "events_url": "https://api.github.com/users/reuben/events{/privacy}", "received_events_url": "https://api.github.com/users/reuben/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}, {"login": "suharshs", "id": 1450614, "node_id": "MDQ6VXNlcjE0NTA2MTQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/1450614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/suharshs", "html_url": "https://github.com/suharshs", "followers_url": "https://api.github.com/users/suharshs/followers", "following_url": "https://api.github.com/users/suharshs/following{/other_user}", "gists_url": "https://api.github.com/users/suharshs/gists{/gist_id}", "starred_url": "https://api.github.com/users/suharshs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/suharshs/subscriptions", "organizations_url": "https://api.github.com/users/suharshs/orgs", "repos_url": "https://api.github.com/users/suharshs/repos", "events_url": "https://api.github.com/users/suharshs/events{/privacy}", "received_events_url": "https://api.github.com/users/suharshs/received_events", "type": "User", "site_admin": false}, {"login": "raghuraman-k", "id": 34699873, "node_id": "MDQ6VXNlcjM0Njk5ODcz", "avatar_url": "https://avatars2.githubusercontent.com/u/34699873?v=4", "gravatar_id": "", "url": "https://api.github.com/users/raghuraman-k", "html_url": "https://github.com/raghuraman-k", "followers_url": "https://api.github.com/users/raghuraman-k/followers", "following_url": "https://api.github.com/users/raghuraman-k/following{/other_user}", "gists_url": "https://api.github.com/users/raghuraman-k/gists{/gist_id}", "starred_url": "https://api.github.com/users/raghuraman-k/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/raghuraman-k/subscriptions", "organizations_url": "https://api.github.com/users/raghuraman-k/orgs", "repos_url": "https://api.github.com/users/raghuraman-k/repos", "events_url": "https://api.github.com/users/raghuraman-k/events{/privacy}", "received_events_url": "https://api.github.com/users/raghuraman-k/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 31, "created_at": "2017-01-31T13:42:51Z", "updated_at": "2018-09-29T03:08:00Z", "closed_at": "2018-09-29T03:08:00Z", "author_association": "NONE", "body_html": "<h3>What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?</h3>\n<p>I found a few similar, but not equivalent, problems with frozen/quantized graphs:</p>\n<p>Cannot import graph_def for 8-bit Quantized cnn model <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"187883997\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/5470\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/5470/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/5470\">#5470</a></p>\n<p>tf.import_graph_def: graph_def is invalid at node <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"173286340\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/4044\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/4044/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/4044\">#4044</a></p>\n<p>Unable to import frozen graph with batchnorm <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"169195660\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/3628\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/3628/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/3628\">#3628</a></p>\n<h3>Environment info</h3>\n<p>Operating System: Ubuntu 16.10</p>\n<p>Installed version of CUDA and cuDNN:<br>\n(please attach the output of <code>ls -l /path/to/cuda/lib/libcud*</code>):</p>\n<pre><code>-rw-r--r-- 1 root root   558720 Sep 14 20:02 /usr/local/cuda/lib64/libcudadevrt.a\nlrwxrwxrwx 1 root root       16 Sep 14 20:05 /usr/local/cuda/lib64/libcudart.so -&gt; libcudart.so.8.0\nlrwxrwxrwx 1 root root       19 Sep 14 20:05 /usr/local/cuda/lib64/libcudart.so.8.0 -&gt; libcudart.so.8.0.44\n-rw-r--r-- 1 root root   415432 Sep 14 20:02 /usr/local/cuda/lib64/libcudart.so.8.0.44\n-rw-r--r-- 1 root root   775162 Sep 14 20:02 /usr/local/cuda/lib64/libcudart_static.a\nlrwxrwxrwx 1 root root       13 Jan 27 22:01 /usr/local/cuda/lib64/libcudnn.so -&gt; libcudnn.so.5\nlrwxrwxrwx 1 root root       17 Jan 27 22:01 /usr/local/cuda/lib64/libcudnn.so.5 -&gt; libcudnn.so.5.1.5\n-rwxr-xr-x 1 root root 79337624 Jan 27 22:01 /usr/local/cuda/lib64/libcudnn.so.5.1.5\n-rw-r--r-- 1 root root 69756172 Jan 27 22:01 /usr/local/cuda/lib64/libcudnn_static.a\n</code></pre>\n<p>If installed from binary pip package, provide:</p>\n<ol>\n<li>A link to the pip package you installed: <a href=\"https://pypi.python.org/pypi/tensorflow-gpu\" rel=\"nofollow\">https://pypi.python.org/pypi/tensorflow-gpu</a></li>\n<li>The output from <code>python -c \"import tensorflow; print(tensorflow.__version__)\"</code>:</li>\n</ol>\n<pre><code>I tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcublas.so locally\nI tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcudnn.so locally\nI tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcufft.so locally\nI tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcuda.so.1 locally\nI tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcurand.so locally\n0.12.1\n</code></pre>\n<h3>If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)</h3>\n<p>I reduced this to a simple RNN model available here on branch tf_issue_7162: <a href=\"https://github.com/reuben/tf-export-test/tree/tf_issue_7162\">https://github.com/reuben/tf-export-test/tree/tf_issue_7162</a></p>\n<p>You don't have to train it again, the repository includes a checkpoint with trained weights. If you run the commands starting from the freeze_graph in the <a href=\"https://github.com/reuben/tf-export-test/blob/master/README.md\">README</a> there, you get this error when importing the quantized graph:</p>\n<pre><code>Traceback (most recent call last):\n  File \"import.py\", line 14, in &lt;module&gt;\n    imports = tf.import_graph_def(pb, name=\"\")\n  File \"/home/reuben/.local/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 339, in import_graph_def\n    % (input_name,)))\nValueError: graph_def is invalid at node u'RNN/cond/Greater/y': More inputs specified ('RNN/cond/Switch:0') than the op expects..\n</code></pre>", "body_text": "What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\nI found a few similar, but not equivalent, problems with frozen/quantized graphs:\nCannot import graph_def for 8-bit Quantized cnn model #5470\ntf.import_graph_def: graph_def is invalid at node #4044\nUnable to import frozen graph with batchnorm #3628\nEnvironment info\nOperating System: Ubuntu 16.10\nInstalled version of CUDA and cuDNN:\n(please attach the output of ls -l /path/to/cuda/lib/libcud*):\n-rw-r--r-- 1 root root   558720 Sep 14 20:02 /usr/local/cuda/lib64/libcudadevrt.a\nlrwxrwxrwx 1 root root       16 Sep 14 20:05 /usr/local/cuda/lib64/libcudart.so -> libcudart.so.8.0\nlrwxrwxrwx 1 root root       19 Sep 14 20:05 /usr/local/cuda/lib64/libcudart.so.8.0 -> libcudart.so.8.0.44\n-rw-r--r-- 1 root root   415432 Sep 14 20:02 /usr/local/cuda/lib64/libcudart.so.8.0.44\n-rw-r--r-- 1 root root   775162 Sep 14 20:02 /usr/local/cuda/lib64/libcudart_static.a\nlrwxrwxrwx 1 root root       13 Jan 27 22:01 /usr/local/cuda/lib64/libcudnn.so -> libcudnn.so.5\nlrwxrwxrwx 1 root root       17 Jan 27 22:01 /usr/local/cuda/lib64/libcudnn.so.5 -> libcudnn.so.5.1.5\n-rwxr-xr-x 1 root root 79337624 Jan 27 22:01 /usr/local/cuda/lib64/libcudnn.so.5.1.5\n-rw-r--r-- 1 root root 69756172 Jan 27 22:01 /usr/local/cuda/lib64/libcudnn_static.a\n\nIf installed from binary pip package, provide:\n\nA link to the pip package you installed: https://pypi.python.org/pypi/tensorflow-gpu\nThe output from python -c \"import tensorflow; print(tensorflow.__version__)\":\n\nI tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcublas.so locally\nI tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcudnn.so locally\nI tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcufft.so locally\nI tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcuda.so.1 locally\nI tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcurand.so locally\n0.12.1\n\nIf possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\nI reduced this to a simple RNN model available here on branch tf_issue_7162: https://github.com/reuben/tf-export-test/tree/tf_issue_7162\nYou don't have to train it again, the repository includes a checkpoint with trained weights. If you run the commands starting from the freeze_graph in the README there, you get this error when importing the quantized graph:\nTraceback (most recent call last):\n  File \"import.py\", line 14, in <module>\n    imports = tf.import_graph_def(pb, name=\"\")\n  File \"/home/reuben/.local/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 339, in import_graph_def\n    % (input_name,)))\nValueError: graph_def is invalid at node u'RNN/cond/Greater/y': More inputs specified ('RNN/cond/Switch:0') than the op expects..", "body": "### What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\r\n\r\nI found a few similar, but not equivalent, problems with frozen/quantized graphs:\r\n\r\nCannot import graph_def for 8-bit Quantized cnn model #5470\r\n\r\ntf.import_graph_def: graph_def is invalid at node #4044\r\n\r\nUnable to import frozen graph with batchnorm #3628 \r\n\r\n### Environment info\r\nOperating System: Ubuntu 16.10\r\n\r\nInstalled version of CUDA and cuDNN: \r\n(please attach the output of `ls -l /path/to/cuda/lib/libcud*`):\r\n\r\n```\r\n-rw-r--r-- 1 root root   558720 Sep 14 20:02 /usr/local/cuda/lib64/libcudadevrt.a\r\nlrwxrwxrwx 1 root root       16 Sep 14 20:05 /usr/local/cuda/lib64/libcudart.so -> libcudart.so.8.0\r\nlrwxrwxrwx 1 root root       19 Sep 14 20:05 /usr/local/cuda/lib64/libcudart.so.8.0 -> libcudart.so.8.0.44\r\n-rw-r--r-- 1 root root   415432 Sep 14 20:02 /usr/local/cuda/lib64/libcudart.so.8.0.44\r\n-rw-r--r-- 1 root root   775162 Sep 14 20:02 /usr/local/cuda/lib64/libcudart_static.a\r\nlrwxrwxrwx 1 root root       13 Jan 27 22:01 /usr/local/cuda/lib64/libcudnn.so -> libcudnn.so.5\r\nlrwxrwxrwx 1 root root       17 Jan 27 22:01 /usr/local/cuda/lib64/libcudnn.so.5 -> libcudnn.so.5.1.5\r\n-rwxr-xr-x 1 root root 79337624 Jan 27 22:01 /usr/local/cuda/lib64/libcudnn.so.5.1.5\r\n-rw-r--r-- 1 root root 69756172 Jan 27 22:01 /usr/local/cuda/lib64/libcudnn_static.a\r\n```\r\n\r\nIf installed from binary pip package, provide:\r\n\r\n1. A link to the pip package you installed: https://pypi.python.org/pypi/tensorflow-gpu\r\n2. The output from `python -c \"import tensorflow; print(tensorflow.__version__)\"`:\r\n\r\n```\r\nI tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcublas.so locally\r\nI tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcudnn.so locally\r\nI tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcufft.so locally\r\nI tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcuda.so.1 locally\r\nI tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcurand.so locally\r\n0.12.1\r\n```\r\n\r\n### If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\r\n\r\nI reduced this to a simple RNN model available here on branch tf_issue_7162: https://github.com/reuben/tf-export-test/tree/tf_issue_7162\r\n\r\nYou don't have to train it again, the repository includes a checkpoint with trained weights. If you run the commands starting from the freeze_graph in the [README](https://github.com/reuben/tf-export-test/blob/master/README.md) there, you get this error when importing the quantized graph:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"import.py\", line 14, in <module>\r\n    imports = tf.import_graph_def(pb, name=\"\")\r\n  File \"/home/reuben/.local/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 339, in import_graph_def\r\n    % (input_name,)))\r\nValueError: graph_def is invalid at node u'RNN/cond/Greater/y': More inputs specified ('RNN/cond/Switch:0') than the op expects..\r\n```"}