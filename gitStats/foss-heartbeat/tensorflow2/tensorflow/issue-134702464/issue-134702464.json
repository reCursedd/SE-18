{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1179", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1179/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1179/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1179/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/1179", "id": 134702464, "node_id": "MDU6SXNzdWUxMzQ3MDI0NjQ=", "number": 1179, "title": "libcuda suffix issue", "user": {"login": "rundel", "id": 273926, "node_id": "MDQ6VXNlcjI3MzkyNg==", "avatar_url": "https://avatars0.githubusercontent.com/u/273926?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rundel", "html_url": "https://github.com/rundel", "followers_url": "https://api.github.com/users/rundel/followers", "following_url": "https://api.github.com/users/rundel/following{/other_user}", "gists_url": "https://api.github.com/users/rundel/gists{/gist_id}", "starred_url": "https://api.github.com/users/rundel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rundel/subscriptions", "organizations_url": "https://api.github.com/users/rundel/orgs", "repos_url": "https://api.github.com/users/rundel/repos", "events_url": "https://api.github.com/users/rundel/events{/privacy}", "received_events_url": "https://api.github.com/users/rundel/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-02-18T21:31:16Z", "updated_at": "2016-02-18T21:32:35Z", "closed_at": "2016-02-18T21:32:35Z", "author_association": "NONE", "body_html": "<p>For bugs/issues, please fill in the following.  The more information you<br>\nprovide, the more likely we can help you.</p>\n<h3>Environment info</h3>\n<p>Operating System: Centos 7<br>\nCuda 7.5, cuDNN v4</p>\n<p>If installed from sources, provide the commit hash: <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/99813c26f9fae11b2d6a6f8d12e68493cb06f73c/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/99813c26f9fae11b2d6a6f8d12e68493cb06f73c\"><tt>99813c2</tt></a></p>\n<h3>Steps to reproduce</h3>\n<ol>\n<li>Followed \"Installing from sources\" instructions</li>\n<li><code>./configure</code> - run and cuda version explicitly set to 7.5</li>\n<li><code>bazel build -c opt --config=cuda //tensorflow/cc:tutorials_example_trainer</code> - runs without issue</li>\n<li><code>bazel-bin/tensorflow/cc/tutorials_example_trainer --use_gpu</code> - fails (relevant log below) due to an attempt to load libcuda.so.7.5 via <code>tensorflow/stream_executor/dso_loader.cc</code>.</li>\n</ol>\n<h3>What have you tried?</h3>\n<ol>\n<li>Attempting to create a symbolic link of <code>libcuda.so.7.5</code> pointing at <code>libcuda.so</code> did not work.</li>\n<li>Editing <code>tensorflow/stream_executor/dso_loader.cc</code> line 99 from:</li>\n</ol>\n<div class=\"highlight highlight-source-c\"><pre><span class=\"pl-c\"><span class=\"pl-c\">/*</span> static <span class=\"pl-c\">*/</span></span> port::Status <span class=\"pl-en\">DsoLoader::GetLibcudaDsoHandle</span>(<span class=\"pl-k\">void</span>** dso_handle) {\n  <span class=\"pl-k\">return</span> <span class=\"pl-c1\">GetDsoHandle</span>(<span class=\"pl-c1\">FindDsoPath</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>libcuda.so<span class=\"pl-pds\">\"</span></span> + <span class=\"pl-c1\">GetCudaVersion</span>(),\n                                  <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>third_party/gpus/cuda/driver/lib64<span class=\"pl-pds\">\"</span></span>),\n                      dso_handle);\n}</pre></div>\n<p>to</p>\n<div class=\"highlight highlight-source-c\"><pre><span class=\"pl-c\"><span class=\"pl-c\">/*</span> static <span class=\"pl-c\">*/</span></span> port::Status <span class=\"pl-en\">DsoLoader::GetLibcudaDsoHandle</span>(<span class=\"pl-k\">void</span>** dso_handle) {\n  <span class=\"pl-k\">return</span> <span class=\"pl-c1\">GetDsoHandle</span>(<span class=\"pl-c1\">FindDsoPath</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>libcuda.so<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c\"><span class=\"pl-c\">//</span> + GetCudaVersion(),</span>\n                                  <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>third_party/gpus/cuda/driver/lib64<span class=\"pl-pds\">\"</span></span>),\n                      dso_handle);\n}</pre></div>\n<p>fixed the issue.<br>\n3. This naming convention issue also appears to be the case on Ubuntu 14.04 - but I have not attempted to rebuilt everything there.</p>\n<h3>Logs or other output that would be helpful</h3>\n<pre><code>[tensorflow]$ bazel-bin/tensorflow/cc/tutorials_example_trainer --use_gpu\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcublas.so.7.5 locally\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcudnn.so locally\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcufft.so.7.5 locally\nI tensorflow/stream_executor/dso_loader.cc:99] Couldn't open CUDA library libcuda.so.7.5. LD_LIBRARY_PATH:\nI tensorflow/stream_executor/cuda/cuda_diagnostics.cc:121] hostname: ---\nI tensorflow/stream_executor/cuda/cuda_diagnostics.cc:146] libcuda reported version is: Not found: was unable to find libcuda.so DSO loaded into this program\n...\n</code></pre>", "body_text": "For bugs/issues, please fill in the following.  The more information you\nprovide, the more likely we can help you.\nEnvironment info\nOperating System: Centos 7\nCuda 7.5, cuDNN v4\nIf installed from sources, provide the commit hash: 99813c2\nSteps to reproduce\n\nFollowed \"Installing from sources\" instructions\n./configure - run and cuda version explicitly set to 7.5\nbazel build -c opt --config=cuda //tensorflow/cc:tutorials_example_trainer - runs without issue\nbazel-bin/tensorflow/cc/tutorials_example_trainer --use_gpu - fails (relevant log below) due to an attempt to load libcuda.so.7.5 via tensorflow/stream_executor/dso_loader.cc.\n\nWhat have you tried?\n\nAttempting to create a symbolic link of libcuda.so.7.5 pointing at libcuda.so did not work.\nEditing tensorflow/stream_executor/dso_loader.cc line 99 from:\n\n/* static */ port::Status DsoLoader::GetLibcudaDsoHandle(void** dso_handle) {\n  return GetDsoHandle(FindDsoPath(\"libcuda.so\" + GetCudaVersion(),\n                                  \"third_party/gpus/cuda/driver/lib64\"),\n                      dso_handle);\n}\nto\n/* static */ port::Status DsoLoader::GetLibcudaDsoHandle(void** dso_handle) {\n  return GetDsoHandle(FindDsoPath(\"libcuda.so\", // + GetCudaVersion(),\n                                  \"third_party/gpus/cuda/driver/lib64\"),\n                      dso_handle);\n}\nfixed the issue.\n3. This naming convention issue also appears to be the case on Ubuntu 14.04 - but I have not attempted to rebuilt everything there.\nLogs or other output that would be helpful\n[tensorflow]$ bazel-bin/tensorflow/cc/tutorials_example_trainer --use_gpu\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcublas.so.7.5 locally\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcudnn.so locally\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcufft.so.7.5 locally\nI tensorflow/stream_executor/dso_loader.cc:99] Couldn't open CUDA library libcuda.so.7.5. LD_LIBRARY_PATH:\nI tensorflow/stream_executor/cuda/cuda_diagnostics.cc:121] hostname: ---\nI tensorflow/stream_executor/cuda/cuda_diagnostics.cc:146] libcuda reported version is: Not found: was unable to find libcuda.so DSO loaded into this program\n...", "body": "For bugs/issues, please fill in the following.  The more information you\nprovide, the more likely we can help you.\n### Environment info\n\nOperating System: Centos 7\nCuda 7.5, cuDNN v4\n\nIf installed from sources, provide the commit hash: 99813c26f9fae11b2d6a6f8d12e68493cb06f73c\n### Steps to reproduce\n1. Followed \"Installing from sources\" instructions\n2. `./configure` - run and cuda version explicitly set to 7.5 \n3. `bazel build -c opt --config=cuda //tensorflow/cc:tutorials_example_trainer` - runs without issue\n4. `bazel-bin/tensorflow/cc/tutorials_example_trainer --use_gpu` - fails (relevant log below) due to an attempt to load libcuda.so.7.5 via `tensorflow/stream_executor/dso_loader.cc`. \n### What have you tried?\n1. Attempting to create a symbolic link of `libcuda.so.7.5` pointing at `libcuda.so` did not work.\n2. Editing `tensorflow/stream_executor/dso_loader.cc` line 99 from:\n\n``` c\n/* static */ port::Status DsoLoader::GetLibcudaDsoHandle(void** dso_handle) {\n  return GetDsoHandle(FindDsoPath(\"libcuda.so\" + GetCudaVersion(),\n                                  \"third_party/gpus/cuda/driver/lib64\"),\n                      dso_handle);\n}\n```\n\nto\n\n``` c\n/* static */ port::Status DsoLoader::GetLibcudaDsoHandle(void** dso_handle) {\n  return GetDsoHandle(FindDsoPath(\"libcuda.so\", // + GetCudaVersion(),\n                                  \"third_party/gpus/cuda/driver/lib64\"),\n                      dso_handle);\n}\n```\n\nfixed the issue.\n3. This naming convention issue also appears to be the case on Ubuntu 14.04 - but I have not attempted to rebuilt everything there.\n### Logs or other output that would be helpful\n\n```\n[tensorflow]$ bazel-bin/tensorflow/cc/tutorials_example_trainer --use_gpu\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcublas.so.7.5 locally\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcudnn.so locally\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcufft.so.7.5 locally\nI tensorflow/stream_executor/dso_loader.cc:99] Couldn't open CUDA library libcuda.so.7.5. LD_LIBRARY_PATH:\nI tensorflow/stream_executor/cuda/cuda_diagnostics.cc:121] hostname: ---\nI tensorflow/stream_executor/cuda/cuda_diagnostics.cc:146] libcuda reported version is: Not found: was unable to find libcuda.so DSO loaded into this program\n...\n```\n"}