{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9073", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9073/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9073/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9073/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/9073", "id": 220436770, "node_id": "MDU6SXNzdWUyMjA0MzY3NzA=", "number": 9073, "title": "Errors when building iOS binaries with selective registration", "user": {"login": "timanglade", "id": 9924, "node_id": "MDQ6VXNlcjk5MjQ=", "avatar_url": "https://avatars2.githubusercontent.com/u/9924?v=4", "gravatar_id": "", "url": "https://api.github.com/users/timanglade", "html_url": "https://github.com/timanglade", "followers_url": "https://api.github.com/users/timanglade/followers", "following_url": "https://api.github.com/users/timanglade/following{/other_user}", "gists_url": "https://api.github.com/users/timanglade/gists{/gist_id}", "starred_url": "https://api.github.com/users/timanglade/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/timanglade/subscriptions", "organizations_url": "https://api.github.com/users/timanglade/orgs", "repos_url": "https://api.github.com/users/timanglade/repos", "events_url": "https://api.github.com/users/timanglade/events{/privacy}", "received_events_url": "https://api.github.com/users/timanglade/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 23, "created_at": "2017-04-09T00:12:53Z", "updated_at": "2018-10-03T12:40:36Z", "closed_at": "2017-04-17T00:53:57Z", "author_association": "CONTRIBUTOR", "body_html": "<p>The header file generated by <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/tools/print_selective_registration_header.py\">print_selective_registration_header.py</a> makes use of strcmp, which causes an error when compiling TensorFlow for iOS with selective registration enabled (<code>-DSELECTIVE_REGISTRATION</code>)</p>\n<p>Apparently this was fixed in <a href=\"https://github.com/tensorflow/tensorflow/commit/c37847c1e5aedf5f33151895bdcbf9de89bbd759\">a commit back in October</a> but that commit was <a href=\"https://github.com/tensorflow/tensorflow/commit/3510b3060abef6b99fe4bc0656d8dc9406d6c46d\">reverted the same day</a> for some reason.</p>\n<p>I\u2019ve tried building the tool from the commit of TensorFlow that has the fix, but <code>./configure</code> fails for me on that version (missing targets &amp; zlib download). I\u2019ve also tried replacing calls to strcmp with a constexpr variant, but I\u2019m not much help with C++ and couldn\u2019t get anything to work there.</p>\n<p>This prevents me from compiling a slimmed down TensorFlow binary for iOS.</p>\n<p>cc <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=161459\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/petewarden\">@petewarden</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=17578177\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/cwhipkey\">@cwhipkey</a></p>\n<h3>You must complete this information or else your issue will be closed</h3>\n<ul>\n<li><em>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)?</em>: No, just following the instructions in <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/tools/print_selective_registration_header.py\">print_selective_registration_header.py</a> and <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/framework/selective_registration.h\">selective_registration.h</a></li>\n<li><em>TensorFlow installed from (source or binary)?</em>: Source</li>\n<li><em>TensorFlow version</em>: master (<a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/45115c0a985815feef3a97a13d6b082997b38e5d/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/45115c0a985815feef3a97a13d6b082997b38e5d\"><tt>45115c0</tt></a>)</li>\n<li><em>Bazel version (if compiling from source)</em>: 0.4.5</li>\n<li><em>CUDA/cuDNN version</em>: N/A</li>\n<li><em>GPU Model and Memory</em>: N/A</li>\n<li><em>Exact command to reproduce</em>:\n<div class=\"highlight highlight-source-shell\"><pre>$ bazel build tensorflow/python/tools/print_selective_registration_header\n$ bazel-bin/tensorflow/python/tools/print_selective_registration_header \\\n  --graphs=graph.pb <span class=\"pl-k\">&gt;</span> tensorflow/core/framework/ops_to_register.h\n$ tensorflow/contrib/makefile/compile_ios_tensorflow.sh <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-Os -DSELECTIVE_REGISTRATION<span class=\"pl-pds\">\"</span></span>\n</pre></div>\n</li>\n</ul>\n<h3>Source Code / Logs</h3>\n<p>Here is the relevant log output on the last command:</p>\n<pre><code>In file included from ./tensorflow/core/framework/selective_registration.h:46:\n./tensorflow/core/framework/ops_to_register.h:4:23: error: constexpr function never produces a\n      constant expression [-Winvalid-constexpr]\nconstexpr inline bool ShouldRegisterOp(const char op[]) {\n                      ^\n./tensorflow/core/framework/ops_to_register.h:6:10: note: non-constexpr function 'strcmp' cannot\n      be used in a constant expression\n     || (strcmp(op, \"Add\") == 0)\n         ^\n/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS10.2.sdk/usr/include/string.h:77:6: note:\n      declared here\nint      strcmp(const char *__s1, const char *__s2);\n         ^\n</code></pre>", "body_text": "The header file generated by print_selective_registration_header.py makes use of strcmp, which causes an error when compiling TensorFlow for iOS with selective registration enabled (-DSELECTIVE_REGISTRATION)\nApparently this was fixed in a commit back in October but that commit was reverted the same day for some reason.\nI\u2019ve tried building the tool from the commit of TensorFlow that has the fix, but ./configure fails for me on that version (missing targets & zlib download). I\u2019ve also tried replacing calls to strcmp with a constexpr variant, but I\u2019m not much help with C++ and couldn\u2019t get anything to work there.\nThis prevents me from compiling a slimmed down TensorFlow binary for iOS.\ncc @petewarden @cwhipkey\nYou must complete this information or else your issue will be closed\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow)?: No, just following the instructions in print_selective_registration_header.py and selective_registration.h\nTensorFlow installed from (source or binary)?: Source\nTensorFlow version: master (45115c0)\nBazel version (if compiling from source): 0.4.5\nCUDA/cuDNN version: N/A\nGPU Model and Memory: N/A\nExact command to reproduce:\n$ bazel build tensorflow/python/tools/print_selective_registration_header\n$ bazel-bin/tensorflow/python/tools/print_selective_registration_header \\\n  --graphs=graph.pb > tensorflow/core/framework/ops_to_register.h\n$ tensorflow/contrib/makefile/compile_ios_tensorflow.sh \"-Os -DSELECTIVE_REGISTRATION\"\n\n\n\nSource Code / Logs\nHere is the relevant log output on the last command:\nIn file included from ./tensorflow/core/framework/selective_registration.h:46:\n./tensorflow/core/framework/ops_to_register.h:4:23: error: constexpr function never produces a\n      constant expression [-Winvalid-constexpr]\nconstexpr inline bool ShouldRegisterOp(const char op[]) {\n                      ^\n./tensorflow/core/framework/ops_to_register.h:6:10: note: non-constexpr function 'strcmp' cannot\n      be used in a constant expression\n     || (strcmp(op, \"Add\") == 0)\n         ^\n/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS10.2.sdk/usr/include/string.h:77:6: note:\n      declared here\nint      strcmp(const char *__s1, const char *__s2);\n         ^", "body": "The header file generated by [print_selective_registration_header.py](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/tools/print_selective_registration_header.py) makes use of strcmp, which causes an error when compiling TensorFlow for iOS with selective registration enabled (`-DSELECTIVE_REGISTRATION`)\r\n\r\nApparently this was fixed in [a commit back in October](https://github.com/tensorflow/tensorflow/commit/c37847c1e5aedf5f33151895bdcbf9de89bbd759) but that commit was [reverted the same day](https://github.com/tensorflow/tensorflow/commit/3510b3060abef6b99fe4bc0656d8dc9406d6c46d) for some reason.\r\n\r\nI\u2019ve tried building the tool from the commit of TensorFlow that has the fix, but `./configure` fails for me on that version (missing targets & zlib download). I\u2019ve also tried replacing calls to strcmp with a constexpr variant, but I\u2019m not much help with C++ and couldn\u2019t get anything to work there.\r\n\r\nThis prevents me from compiling a slimmed down TensorFlow binary for iOS.\r\n\r\ncc @petewarden @cwhipkey \r\n\r\n### You must complete this information or else your issue will be closed\r\n- *Have I written custom code (as opposed to using a stock example script provided in TensorFlow)?*: No, just following the instructions in [print_selective_registration_header.py](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/tools/print_selective_registration_header.py) and [selective_registration.h](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/framework/selective_registration.h)\r\n- *TensorFlow installed from (source or binary)?*: Source\r\n- *TensorFlow version*: master (45115c0a985815feef3a97a13d6b082997b38e5d)\r\n- *Bazel version (if compiling from source)*: 0.4.5\r\n- *CUDA/cuDNN version*: N/A\r\n- *GPU Model and Memory*: N/A\r\n- *Exact command to reproduce*:\r\n    ```bash\r\n    $ bazel build tensorflow/python/tools/print_selective_registration_header\r\n    $ bazel-bin/tensorflow/python/tools/print_selective_registration_header \\\r\n      --graphs=graph.pb > tensorflow/core/framework/ops_to_register.h\r\n    $ tensorflow/contrib/makefile/compile_ios_tensorflow.sh \"-Os -DSELECTIVE_REGISTRATION\"\r\n\r\n### Source Code / Logs\r\nHere is the relevant log output on the last command:\r\n\r\n```\r\nIn file included from ./tensorflow/core/framework/selective_registration.h:46:\r\n./tensorflow/core/framework/ops_to_register.h:4:23: error: constexpr function never produces a\r\n      constant expression [-Winvalid-constexpr]\r\nconstexpr inline bool ShouldRegisterOp(const char op[]) {\r\n                      ^\r\n./tensorflow/core/framework/ops_to_register.h:6:10: note: non-constexpr function 'strcmp' cannot\r\n      be used in a constant expression\r\n     || (strcmp(op, \"Add\") == 0)\r\n         ^\r\n/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS10.2.sdk/usr/include/string.h:77:6: note:\r\n      declared here\r\nint      strcmp(const char *__s1, const char *__s2);\r\n         ^\r\n```\r\n"}