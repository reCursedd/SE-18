{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/232788475", "pull_request_review_id": 174064154, "id": 232788475, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMjc4ODQ3NQ==", "diff_hunk": "@@ -2808,3 +2808,68 @@ def sobel_edges(image):\n   output = array_ops.reshape(output, shape=shape)\n   output.set_shape(static_image_shape.concatenate([num_kernels]))\n   return output\n+\n+@tf_export('image.non_max_suppression_lite')\n+def non_max_suppression_lite(boxes,\n+                             scores,\n+                             max_output_size_per_class,\n+                             max_total_size,\n+                             iou_threshold=0.5,\n+                             score_threshold=float('-inf'),\n+                             use_static_shapes=False,\n+                             name=None):\n+  \"\"\"Greedily selects a subset of bounding boxes in descending order of score.\n+\n+  This operation performs non_max_suppression on the inputs per batch, across\n+  all classes. \n+  Prunes away boxes that have high intersection-over-union (IOU) overlap\n+  with previously selected boxes.  Bounding boxes are supplied as\n+  [y1, x1, y2, x2], where (y1, x1) and (y2, x2) are the coordinates of any\n+  diagonal pair of box corners and the coordinates can be provided as normalized\n+  (i.e., lying in the interval [0, 1]) or absolute.  Note that this algorithm\n+  is agnostic to where the origin is in the coordinate system.  Note that this\n+  algorithm is invariant to orthogonal transformations and translations\n+  of the coordinate system; thus translating or reflections of the coordinate\n+  system result in the same boxes being selected by the algorithm.\n+  The output of this operation is the final boxes, scores and classes tensor \n+  returned after performing non_max_suppression.\n+\n+  Args:\n+    boxes: A 4-D float `Tensor` of shape `[batch_size, num_boxes, q, 4]`.\n+    scores: A 3-D float `Tensor` of shape `[batch_size, num_boxes, num_classes]` \n+    representing a single score corresponding to each box (each row of boxes).\n+    max_output_size_per_class: A scalar integer `Tensor` representing the \n+    maximum number of boxes to be selected by non max suppression per class\n+    max_total_size: A scalar representing maximum number of boxes retained over\n+    all classes.\n+    iou_threshold: A float representing the threshold for deciding whether boxes\n+      overlap too much with respect to IOU.\n+    score_threshold: A float representing the threshold for deciding when to\n+      remove boxes based on score.\n+    use_static_shapes: If true, the output nmsed boxes, scores, classes and ", "path": "tensorflow/python/ops/image_ops_impl.py", "position": null, "original_position": 42, "commit_id": "e433fd8adab6a6646f9c6c738ce70682a15193bb", "original_commit_id": "ff885ef229da8e0e19792b9ce6a9c506d3738157", "user": {"login": "supriyar", "id": 2657489, "node_id": "MDQ6VXNlcjI2NTc0ODk=", "avatar_url": "https://avatars0.githubusercontent.com/u/2657489?v=4", "gravatar_id": "", "url": "https://api.github.com/users/supriyar", "html_url": "https://github.com/supriyar", "followers_url": "https://api.github.com/users/supriyar/followers", "following_url": "https://api.github.com/users/supriyar/following{/other_user}", "gists_url": "https://api.github.com/users/supriyar/gists{/gist_id}", "starred_url": "https://api.github.com/users/supriyar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/supriyar/subscriptions", "organizations_url": "https://api.github.com/users/supriyar/orgs", "repos_url": "https://api.github.com/users/supriyar/repos", "events_url": "https://api.github.com/users/supriyar/events{/privacy}", "received_events_url": "https://api.github.com/users/supriyar/received_events", "type": "User", "site_admin": false}, "body": "Based on the current implementation, if use_static_shapes is false, we always pad/clip to max_total_size.\r\nhttps://github.com/tensorflow/models/blob/628b970a3d7c59a3b65220e24972f9987e879bca/research/object_detection/core/post_processing.py#L454\r\nAnd if use_static_shapes is true we pad to minimum of (max_total_size, max_size_per_class*num_classes). Please let me know if our understanding is incorrect.\r\n\r\nAlso, looks like max_total_size can never be 0 or less than max_size_per_class \r\nhttps://github.com/tensorflow/models/blob/c4c49d1a1534b3664ac12aad69a124f87a9e3f7f/research/object_detection/builders/post_processing_builder.py#L78", "created_at": "2018-11-12T19:43:55Z", "updated_at": "2018-11-15T21:42:03Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/23567#discussion_r232788475", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/23567", "author_association": "NONE", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/232788475"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/23567#discussion_r232788475"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/23567"}}, "body_html": "<p>Based on the current implementation, if use_static_shapes is false, we always pad/clip to max_total_size.<br>\n<a href=\"https://github.com/tensorflow/models/blob/628b970a3d7c59a3b65220e24972f9987e879bca/research/object_detection/core/post_processing.py#L454\">https://github.com/tensorflow/models/blob/628b970a3d7c59a3b65220e24972f9987e879bca/research/object_detection/core/post_processing.py#L454</a><br>\nAnd if use_static_shapes is true we pad to minimum of (max_total_size, max_size_per_class*num_classes). Please let me know if our understanding is incorrect.</p>\n<p>Also, looks like max_total_size can never be 0 or less than max_size_per_class<br>\n<a href=\"https://github.com/tensorflow/models/blob/c4c49d1a1534b3664ac12aad69a124f87a9e3f7f/research/object_detection/builders/post_processing_builder.py#L78\">https://github.com/tensorflow/models/blob/c4c49d1a1534b3664ac12aad69a124f87a9e3f7f/research/object_detection/builders/post_processing_builder.py#L78</a></p>", "body_text": "Based on the current implementation, if use_static_shapes is false, we always pad/clip to max_total_size.\nhttps://github.com/tensorflow/models/blob/628b970a3d7c59a3b65220e24972f9987e879bca/research/object_detection/core/post_processing.py#L454\nAnd if use_static_shapes is true we pad to minimum of (max_total_size, max_size_per_class*num_classes). Please let me know if our understanding is incorrect.\nAlso, looks like max_total_size can never be 0 or less than max_size_per_class\nhttps://github.com/tensorflow/models/blob/c4c49d1a1534b3664ac12aad69a124f87a9e3f7f/research/object_detection/builders/post_processing_builder.py#L78", "in_reply_to_id": 232503974}