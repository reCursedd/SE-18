{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5902", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5902/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5902/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5902/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/5902", "id": 192006661, "node_id": "MDU6SXNzdWUxOTIwMDY2NjE=", "number": 5902, "title": "Input tensor on GPU in C++ API", "user": {"login": "larsmennen", "id": 1162951, "node_id": "MDQ6VXNlcjExNjI5NTE=", "avatar_url": "https://avatars2.githubusercontent.com/u/1162951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/larsmennen", "html_url": "https://github.com/larsmennen", "followers_url": "https://api.github.com/users/larsmennen/followers", "following_url": "https://api.github.com/users/larsmennen/following{/other_user}", "gists_url": "https://api.github.com/users/larsmennen/gists{/gist_id}", "starred_url": "https://api.github.com/users/larsmennen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/larsmennen/subscriptions", "organizations_url": "https://api.github.com/users/larsmennen/orgs", "repos_url": "https://api.github.com/users/larsmennen/repos", "events_url": "https://api.github.com/users/larsmennen/events{/privacy}", "received_events_url": "https://api.github.com/users/larsmennen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}, {"id": 473173272, "node_id": "MDU6TGFiZWw0NzMxNzMyNzI=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:feature", "name": "type:feature", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 17, "created_at": "2016-11-28T13:31:48Z", "updated_at": "2018-10-29T02:01:20Z", "closed_at": "2016-12-01T17:18:36Z", "author_association": "NONE", "body_html": "<p>I am trying to feed a Tensor (using the C++ API) that has memory allocated on the GPU (using GPUBFCAllocator) into a network.<br>\nNow, the placeholder in the network is on the GPU (I checked this in Tensorboard), and the memory allocated for the input tensor is on the GPU, but whenever I run the network, <code>nvprof --print-gpu-trace</code> shows me <code>[CUDA memcpy HtoD]</code> and <code>[CUDA memcpy DtoH]</code>, before the computations (i.e. convolutions etc.) start.<br>\nThis suggests to me that the input tensor is being copied to CPU memory, and then back to GPU memory.</p>\n<p>While debugging this, I found multiple hints in the source that seem to suggest the CPU is always used as device to feed tensors from.<br>\nSee e.g.:<br>\n<div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/eb56a8af24695bf8258addf28b0c53fbabff72e6/tensorflow/core/common_runtime/direct_session.cc#L264\">tensorflow/tensorflow/core/common_runtime/direct_session.cc</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n         Line 264\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/eb56a8af24695bf8258addf28b0c53fbabff72e6\">eb56a8a</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L264\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"264\"></td>\n          <td id=\"LC264\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-k\">if</span> (devices_added == <span class=\"pl-c1\">0</span>) { </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<br>\n<div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/429905c6283d3182a816487807e97e592849ce19/tensorflow/core/common_runtime/graph_runner.cc#L109\">tensorflow/tensorflow/core/common_runtime/graph_runner.cc</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n         Line 109\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/429905c6283d3182a816487807e97e592849ce19\">429905c</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L109\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"109\"></td>\n          <td id=\"LC109\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> std::unique_ptr&lt;Device&gt; device = <span class=\"pl-c1\">GetCPUDevice</span>(env); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>\n<ol>\n<li>Is this analysis correct?</li>\n<li>How can one feed in a tensor that has memory allocated on GPU memory, without copying back and forth to CPU memory? If this is currently not possible, then I think this would be a good feature to add.<br>\nEspecially when one wants to combine Tensorflow input/output with other algorithms (not in TF), one might want to keep data on the GPU, to avoid host to device and device to host transfers.</li>\n</ol>\n<p>Thanks in advance.</p>\n<h3>Environment info</h3>\n<p>Operating System: Ubuntu 16.04.1 LTS</p>\n<p>Installed version of CUDA and cuDNN: CUDA 8.0, cuDNN 5.1.5<br>\nOutput of <code>ls -l /usr/local/cuda/lib64/libcud*</code>:</p>\n<pre><code>-rw-r--r-- 1 root root 558720 Sep 15 00:02 /usr/local/cuda/lib64/libcudadevrt.a\nlrwxrwxrwx 1 root root     16 Sep 15 00:05 /usr/local/cuda/lib64/libcudart.so -&gt; libcudart.so.8.0\nlrwxrwxrwx 1 root root     19 Sep 15 00:05 /usr/local/cuda/lib64/libcudart.so.8.0 -&gt; libcudart.so.8.0.44\n-rw-r--r-- 1 root root 415432 Sep 15 00:02 /usr/local/cuda/lib64/libcudart.so.8.0.44\n-rw-r--r-- 1 root root 775162 Sep 15 00:02 /usr/local/cuda/lib64/libcudart_static.a\nlrwxrwxrwx 1 root root     43 Oct  3 17:03 /usr/local/cuda/lib64/libcudnn.so -&gt; /usr/local/cudnn-8.0-v5.1/lib64/libcudnn.so\nlrwxrwxrwx 1 root root     45 Oct  3 17:03 /usr/local/cuda/lib64/libcudnn.so.5 -&gt; /usr/local/cudnn-8.0-v5.1/lib64/libcudnn.so.5\nlrwxrwxrwx 1 root root     49 Oct  3 17:03 /usr/local/cuda/lib64/libcudnn.so.5.1.5 -&gt; /usr/local/cudnn-8.0-v5.1/lib64/libcudnn.so.5.1.5\nlrwxrwxrwx 1 root root     49 Oct  3 17:03 /usr/local/cuda/lib64/libcudnn_static.a -&gt; /usr/local/cudnn-8.0-v5.1/lib64/libcudnn_static.a\n</code></pre>\n<p>Tensorflow installed from source:</p>\n<ol>\n<li>The commit hash (<code>git rev-parse HEAD</code>): <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/a5074383617a9947f248a0ddd56b94f9fb0f970b/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/a5074383617a9947f248a0ddd56b94f9fb0f970b\"><tt>a507438</tt></a></li>\n<li>The output of <code>bazel version</code>:</li>\n</ol>\n<pre><code>Build label: 0.4.0\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Wed Nov 2 17:54:14 2016 (1478109254)\nBuild timestamp: 1478109254\nBuild timestamp as int: 1478109254\n</code></pre>\n<h3>If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)</h3>\n<p>This should give the general idea.</p>\n<div class=\"highlight highlight-source-c++\"><pre>tensorflow::GPUBFCAllocator* allocator = <span class=\"pl-k\">new</span> tensorflow::GPUBFCAllocator(<span class=\"pl-c1\">0</span>, <span class=\"pl-k\">sizeof</span>(<span class=\"pl-k\">float</span>) * height * width * <span class=\"pl-c1\">3</span>);\ntensorflow::Tensor input_tensor = tensorflow::Tensor(allocator, tensorflow::DataType::DT_FLOAT, tensorflow::TensorShape( { <span class=\"pl-c1\">1</span>, height, width, <span class=\"pl-c1\">3</span> }));\nstd::vector&lt;tensorflow::Tensor&gt;* outputs = <span class=\"pl-k\">new</span> std::vector&lt;tensorflow::Tensor&gt;;\n&lt;copy some data into the allocated space&gt;\n&lt;create a <span class=\"pl-k\">new</span> session, load graph etc.&gt; <span class=\"pl-c\"><span class=\"pl-c\">//</span> Note: the \"input_layer\" is on the GPU</span>\nsession-&gt;<span class=\"pl-en\">Run</span>( { { <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>input_layer<span class=\"pl-pds\">\"</span></span>, input_tensor } }, { <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>output_layer<span class=\"pl-pds\">\"</span></span> }, { }, outputs);</pre></div>\n<h3>Logs or other output that would be helpful</h3>\n<p>Partial output of nvprof --print-gpu-trace:</p>\n<pre><code>   Start  Duration            Grid Size      Block Size     Regs*    SSMem*    DSMem*      Size  Throughput           Device   Context    Stream  Name\n249.54ms  4.7360us                    -               -         -         -         -  1.0039KB  207.01MB/s  GeForce GTX 107         1         7  [CUDA memset]\n932.67ms  44.799us                    -               -         -         -         -  384.00KB  8.1745GB/s  GeForce GTX 107         1         7  [CUDA memcpy HtoD]\n933.22ms  15.584us            (12 32 1)        (32 8 1)        20        0B        0B         -           -  GeForce GTX 107         1         7  void cv::cudev::grid_transform_detail::transformSmart&lt;int=4, unsigned char, float, cv::cudev::saturate_cast_func&lt;unsigned char, float&gt;, cv::cudev::WithOutMask&gt;(cv::cudev::GlobPtr&lt;unsigned char&gt;, cv::cudev::grid_transform_detail::transformSmart&lt;int=4, unsigned char, float, cv::cudev::saturate_cast_func&lt;unsigned char, float, float&gt;, cv::cudev::WithOutMask&gt;, unsigned char, float, int, int) [158]\n933.29ms  121.12us                    -               -         -         -         -  1.5000MB  12.094GB/s  GeForce GTX 107         1         7  [CUDA memcpy DtoH]\n1.24468s  2.1120us                    -               -         -         -         -        4B  1.8062MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24492s     992ns                    -               -         -         -         -        4B  3.8455MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24522s     992ns                    -               -         -         -         -        4B  3.8455MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24553s     992ns                    -               -         -         -         -        4B  3.8455MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24594s  1.0880us                    -               -         -         -         -        4B  3.5062MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24632s     992ns                    -               -         -         -         -        4B  3.8455MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24800s     992ns                    -               -         -         -         -        8B  7.6909MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24816s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24830s  38.879us                    -               -         -         -         -  288.00KB  7.0644GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24846s  1.0880us                    -               -         -         -         -      512B  448.79MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24858s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24868s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24874s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24963s  106.62us                    -               -         -         -         -  1.1250MB  10.304GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24981s  1.4080us                    -               -         -         -         -  1.0000KB  693.58MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24987s  1.1840us                    -               -         -         -         -  1.0000KB  824.80MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25153s  196.60us                    -               -         -         -         -  2.2500MB  11.176GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25189s  1.4080us                    -               -         -         -         -  1.0000KB  693.58MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25196s  1.2800us                    -               -         -         -         -  1.0000KB  762.94MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25250s  180.92us                    -               -         -         -         -  2.2500MB  12.145GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25276s  1.4080us                    -               -         -         -         -  1.0000KB  693.58MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25281s  1.1840us                    -               -         -         -         -  1.0000KB  824.80MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25332s  180.67us                    -               -         -         -         -  2.2500MB  12.162GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25355s  1.4400us                    -               -         -         -         -  1.0000KB  678.17MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25359s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25406s  191.36us                    -               -         -         -         -  2.2500MB  11.483GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25431s  1.4400us                    -               -         -         -         -  1.0000KB  678.17MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25435s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25461s  90.910us                    -               -         -         -         -  1.1250MB  12.085GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25477s  1.3120us                    -               -         -         -         -  1.0000KB  744.33MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25482s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25486s  1.0560us                    -               -         -         -         -       68B  61.411MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25490s  4.1280us                    -               -         -         -         -  38.250KB  8.8367GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25500s  1.1840us                    -               -         -         -         -      256B  206.20MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25506s  1.0560us                    -               -         -         -         -      256B  231.19MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25511s  12.288us                    -               -         -         -         -  144.00KB  11.176GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25523s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25526s  1.0560us                    -               -         -         -         -      256B  231.19MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25532s  12.320us                    -               -         -         -         -  144.00KB  11.147GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25542s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25545s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25549s  1.6640us                    -               -         -         -         -  6.7500KB  3.8686GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25552s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25555s  1.1840us                    -               -         -         -         -      256B  206.20MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25559s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25562s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25570s  23.487us                    -               -         -         -         -  288.00KB  11.694GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25580s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25584s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25597s  45.919us                    -               -         -         -         -  576.00KB  11.963GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25607s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25610s  1.0880us                    -               -         -         -         -      512B  448.79MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25624s  45.919us                    -               -         -         -         -  576.00KB  11.963GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25634s  1.0880us                    -               -         -         -         -      512B  448.79MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25638s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25641s  1.4720us                    -               -         -         -         -  2.0000KB  1.2958GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25645s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25649s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25652s  1.1840us                    -               -         -         -         -  1.0000KB  824.80MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25656s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25659s  1.0880us                    -               -         -         -         -      512B  448.79MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25662s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25666s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25669s  1.0560us                    -               -         -         -         -      256B  231.19MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25673s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25676s  1.1840us                    -               -         -         -         -  1.0000KB  824.80MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25680s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25965s  360.89us                    -               -         -         -         -  4.5000MB  12.177GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.26011s  1.5360us                    -               -         -         -         -  2.0000KB  1.2418GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.26015s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.26543s  719.60us                    -               -         -         -         -  9.0000MB  12.214GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.26626s  1.8240us                    -               -         -         -         -  2.0000KB  1.0457GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.26630s  1.2480us                    -               -         -         -         -  2.0000KB  1.5283GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.26788s  727.98us                    -               -         -         -         -  9.0000MB  12.073GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.26872s  1.5040us                    -               -         -         -         -  2.0000KB  1.2682GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.26876s  1.2480us                    -               -         -         -         -  2.0000KB  1.5283GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27030s  718.67us                    -               -         -         -         -  9.0000MB  12.230GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27109s  1.5680us                    -               -         -         -         -  2.0000KB  1.2164GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27112s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27268s  718.58us                    -               -         -         -         -  9.0000MB  12.231GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27349s  1.5040us                    -               -         -         -         -  2.0000KB  1.2682GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27359s  1.6000us                    -               -         -         -         -  2.0000KB  1.1921GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27437s  360.12us                    -               -         -         -         -  4.5000MB  12.203GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27479s  1.5360us                    -               -         -         -         -  2.0000KB  1.2418GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27484s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27487s  1.2480us                    -               -         -         -         -  2.0000KB  1.5283GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27491s  1.3120us                    -               -         -         -         -  2.0000KB  1.4538GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27495s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27651s  719.02us                    -               -         -         -         -  9.0000MB  12.224GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27732s  1.5040us                    -               -         -         -         -  2.0000KB  1.2682GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27736s  1.3440us                    -               -         -         -         -  2.0000KB  1.4192GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27890s  719.02us                    -               -         -         -         -  9.0000MB  12.224GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27970s  1.5350us                    -               -         -         -         -  2.0000KB  1.2426GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27976s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28131s  719.09us                    -               -         -         -         -  9.0000MB  12.223GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28212s  1.5360us                    -               -         -         -         -  2.0000KB  1.2418GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28222s  1.2480us                    -               -         -         -         -  2.0000KB  1.5283GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28377s  718.06us                    -               -         -         -         -  9.0000MB  12.240GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28463s  1.6320us                    -               -         -         -         -  2.0000KB  1.1687GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28468s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28619s  719.86us                    -               -         -         -         -  9.0000MB  12.209GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28703s  1.5040us                    -               -         -         -         -  2.0000KB  1.2682GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28707s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28863s  719.28us                    -               -         -         -         -  9.0000MB  12.219GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28946s  1.5040us                    -               -         -         -         -  2.0000KB  1.2682GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28951s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28955s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28960s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28964s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.29034s  20.768us                    -               -         -         -         -  1.5000MB  70.534GB/s  GeForce GTX 107         1        14  [CUDA memcpy DtoD]\n1.29047s  30.015us             (16 1 1)      (1024 1 1)        25        0B        0B         -           -  GeForce GTX 107         1        13  void tensorflow::functor::SwapDimension1And2InTensor3&lt;float&gt;(int, float const *, tensorflow::functor::Dimension&lt;int=3&gt;, tensorflow::functor::SwapDimension1And2InTensor3&lt;float&gt;*) [936]\n1.29050s  3.7120us              (2 1 1)      (1024 1 1)        27        0B        0B         -           -  GeForce GTX 107         1        13  void tensorflow::functor::SwapDimension0And2InTensor3&lt;float&gt;(int, float const *, tensorflow::functor::Dimension&lt;int=3&gt;, tensorflow::functor::SwapDimension0And2InTensor3&lt;float&gt;*) [942]\n1.59580s     864ns                    -               -         -         -         -      112B  123.62MB/s  GeForce GTX 107         1         7  [CUDA memcpy HtoD]\n&lt;computations start&gt;\n</code></pre>", "body_text": "I am trying to feed a Tensor (using the C++ API) that has memory allocated on the GPU (using GPUBFCAllocator) into a network.\nNow, the placeholder in the network is on the GPU (I checked this in Tensorboard), and the memory allocated for the input tensor is on the GPU, but whenever I run the network, nvprof --print-gpu-trace shows me [CUDA memcpy HtoD] and [CUDA memcpy DtoH], before the computations (i.e. convolutions etc.) start.\nThis suggests to me that the input tensor is being copied to CPU memory, and then back to GPU memory.\nWhile debugging this, I found multiple hints in the source that seem to suggest the CPU is always used as device to feed tensors from.\nSee e.g.:\n\n  \n    \n      tensorflow/tensorflow/core/common_runtime/direct_session.cc\n    \n    \n         Line 264\n      in\n      eb56a8a\n    \n    \n    \n    \n\n        \n          \n           if (devices_added == 0) { \n        \n    \n  \n\n\n\n  \n    \n      tensorflow/tensorflow/core/common_runtime/graph_runner.cc\n    \n    \n         Line 109\n      in\n      429905c\n    \n    \n    \n    \n\n        \n          \n           std::unique_ptr<Device> device = GetCPUDevice(env); \n        \n    \n  \n\n\n\nIs this analysis correct?\nHow can one feed in a tensor that has memory allocated on GPU memory, without copying back and forth to CPU memory? If this is currently not possible, then I think this would be a good feature to add.\nEspecially when one wants to combine Tensorflow input/output with other algorithms (not in TF), one might want to keep data on the GPU, to avoid host to device and device to host transfers.\n\nThanks in advance.\nEnvironment info\nOperating System: Ubuntu 16.04.1 LTS\nInstalled version of CUDA and cuDNN: CUDA 8.0, cuDNN 5.1.5\nOutput of ls -l /usr/local/cuda/lib64/libcud*:\n-rw-r--r-- 1 root root 558720 Sep 15 00:02 /usr/local/cuda/lib64/libcudadevrt.a\nlrwxrwxrwx 1 root root     16 Sep 15 00:05 /usr/local/cuda/lib64/libcudart.so -> libcudart.so.8.0\nlrwxrwxrwx 1 root root     19 Sep 15 00:05 /usr/local/cuda/lib64/libcudart.so.8.0 -> libcudart.so.8.0.44\n-rw-r--r-- 1 root root 415432 Sep 15 00:02 /usr/local/cuda/lib64/libcudart.so.8.0.44\n-rw-r--r-- 1 root root 775162 Sep 15 00:02 /usr/local/cuda/lib64/libcudart_static.a\nlrwxrwxrwx 1 root root     43 Oct  3 17:03 /usr/local/cuda/lib64/libcudnn.so -> /usr/local/cudnn-8.0-v5.1/lib64/libcudnn.so\nlrwxrwxrwx 1 root root     45 Oct  3 17:03 /usr/local/cuda/lib64/libcudnn.so.5 -> /usr/local/cudnn-8.0-v5.1/lib64/libcudnn.so.5\nlrwxrwxrwx 1 root root     49 Oct  3 17:03 /usr/local/cuda/lib64/libcudnn.so.5.1.5 -> /usr/local/cudnn-8.0-v5.1/lib64/libcudnn.so.5.1.5\nlrwxrwxrwx 1 root root     49 Oct  3 17:03 /usr/local/cuda/lib64/libcudnn_static.a -> /usr/local/cudnn-8.0-v5.1/lib64/libcudnn_static.a\n\nTensorflow installed from source:\n\nThe commit hash (git rev-parse HEAD): a507438\nThe output of bazel version:\n\nBuild label: 0.4.0\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Wed Nov 2 17:54:14 2016 (1478109254)\nBuild timestamp: 1478109254\nBuild timestamp as int: 1478109254\n\nIf possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\nThis should give the general idea.\ntensorflow::GPUBFCAllocator* allocator = new tensorflow::GPUBFCAllocator(0, sizeof(float) * height * width * 3);\ntensorflow::Tensor input_tensor = tensorflow::Tensor(allocator, tensorflow::DataType::DT_FLOAT, tensorflow::TensorShape( { 1, height, width, 3 }));\nstd::vector<tensorflow::Tensor>* outputs = new std::vector<tensorflow::Tensor>;\n<copy some data into the allocated space>\n<create a new session, load graph etc.> // Note: the \"input_layer\" is on the GPU\nsession->Run( { { \"input_layer\", input_tensor } }, { \"output_layer\" }, { }, outputs);\nLogs or other output that would be helpful\nPartial output of nvprof --print-gpu-trace:\n   Start  Duration            Grid Size      Block Size     Regs*    SSMem*    DSMem*      Size  Throughput           Device   Context    Stream  Name\n249.54ms  4.7360us                    -               -         -         -         -  1.0039KB  207.01MB/s  GeForce GTX 107         1         7  [CUDA memset]\n932.67ms  44.799us                    -               -         -         -         -  384.00KB  8.1745GB/s  GeForce GTX 107         1         7  [CUDA memcpy HtoD]\n933.22ms  15.584us            (12 32 1)        (32 8 1)        20        0B        0B         -           -  GeForce GTX 107         1         7  void cv::cudev::grid_transform_detail::transformSmart<int=4, unsigned char, float, cv::cudev::saturate_cast_func<unsigned char, float>, cv::cudev::WithOutMask>(cv::cudev::GlobPtr<unsigned char>, cv::cudev::grid_transform_detail::transformSmart<int=4, unsigned char, float, cv::cudev::saturate_cast_func<unsigned char, float, float>, cv::cudev::WithOutMask>, unsigned char, float, int, int) [158]\n933.29ms  121.12us                    -               -         -         -         -  1.5000MB  12.094GB/s  GeForce GTX 107         1         7  [CUDA memcpy DtoH]\n1.24468s  2.1120us                    -               -         -         -         -        4B  1.8062MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24492s     992ns                    -               -         -         -         -        4B  3.8455MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24522s     992ns                    -               -         -         -         -        4B  3.8455MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24553s     992ns                    -               -         -         -         -        4B  3.8455MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24594s  1.0880us                    -               -         -         -         -        4B  3.5062MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24632s     992ns                    -               -         -         -         -        4B  3.8455MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24800s     992ns                    -               -         -         -         -        8B  7.6909MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24816s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24830s  38.879us                    -               -         -         -         -  288.00KB  7.0644GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24846s  1.0880us                    -               -         -         -         -      512B  448.79MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24858s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24868s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24874s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24963s  106.62us                    -               -         -         -         -  1.1250MB  10.304GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24981s  1.4080us                    -               -         -         -         -  1.0000KB  693.58MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.24987s  1.1840us                    -               -         -         -         -  1.0000KB  824.80MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25153s  196.60us                    -               -         -         -         -  2.2500MB  11.176GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25189s  1.4080us                    -               -         -         -         -  1.0000KB  693.58MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25196s  1.2800us                    -               -         -         -         -  1.0000KB  762.94MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25250s  180.92us                    -               -         -         -         -  2.2500MB  12.145GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25276s  1.4080us                    -               -         -         -         -  1.0000KB  693.58MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25281s  1.1840us                    -               -         -         -         -  1.0000KB  824.80MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25332s  180.67us                    -               -         -         -         -  2.2500MB  12.162GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25355s  1.4400us                    -               -         -         -         -  1.0000KB  678.17MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25359s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25406s  191.36us                    -               -         -         -         -  2.2500MB  11.483GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25431s  1.4400us                    -               -         -         -         -  1.0000KB  678.17MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25435s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25461s  90.910us                    -               -         -         -         -  1.1250MB  12.085GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25477s  1.3120us                    -               -         -         -         -  1.0000KB  744.33MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25482s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25486s  1.0560us                    -               -         -         -         -       68B  61.411MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25490s  4.1280us                    -               -         -         -         -  38.250KB  8.8367GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25500s  1.1840us                    -               -         -         -         -      256B  206.20MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25506s  1.0560us                    -               -         -         -         -      256B  231.19MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25511s  12.288us                    -               -         -         -         -  144.00KB  11.176GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25523s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25526s  1.0560us                    -               -         -         -         -      256B  231.19MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25532s  12.320us                    -               -         -         -         -  144.00KB  11.147GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25542s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25545s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25549s  1.6640us                    -               -         -         -         -  6.7500KB  3.8686GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25552s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25555s  1.1840us                    -               -         -         -         -      256B  206.20MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25559s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25562s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25570s  23.487us                    -               -         -         -         -  288.00KB  11.694GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25580s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25584s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25597s  45.919us                    -               -         -         -         -  576.00KB  11.963GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25607s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25610s  1.0880us                    -               -         -         -         -      512B  448.79MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25624s  45.919us                    -               -         -         -         -  576.00KB  11.963GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25634s  1.0880us                    -               -         -         -         -      512B  448.79MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25638s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25641s  1.4720us                    -               -         -         -         -  2.0000KB  1.2958GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25645s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25649s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25652s  1.1840us                    -               -         -         -         -  1.0000KB  824.80MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25656s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25659s  1.0880us                    -               -         -         -         -      512B  448.79MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25662s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25666s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25669s  1.0560us                    -               -         -         -         -      256B  231.19MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25673s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25676s  1.1840us                    -               -         -         -         -  1.0000KB  824.80MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25680s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.25965s  360.89us                    -               -         -         -         -  4.5000MB  12.177GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.26011s  1.5360us                    -               -         -         -         -  2.0000KB  1.2418GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.26015s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.26543s  719.60us                    -               -         -         -         -  9.0000MB  12.214GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.26626s  1.8240us                    -               -         -         -         -  2.0000KB  1.0457GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.26630s  1.2480us                    -               -         -         -         -  2.0000KB  1.5283GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.26788s  727.98us                    -               -         -         -         -  9.0000MB  12.073GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.26872s  1.5040us                    -               -         -         -         -  2.0000KB  1.2682GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.26876s  1.2480us                    -               -         -         -         -  2.0000KB  1.5283GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27030s  718.67us                    -               -         -         -         -  9.0000MB  12.230GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27109s  1.5680us                    -               -         -         -         -  2.0000KB  1.2164GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27112s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27268s  718.58us                    -               -         -         -         -  9.0000MB  12.231GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27349s  1.5040us                    -               -         -         -         -  2.0000KB  1.2682GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27359s  1.6000us                    -               -         -         -         -  2.0000KB  1.1921GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27437s  360.12us                    -               -         -         -         -  4.5000MB  12.203GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27479s  1.5360us                    -               -         -         -         -  2.0000KB  1.2418GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27484s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27487s  1.2480us                    -               -         -         -         -  2.0000KB  1.5283GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27491s  1.3120us                    -               -         -         -         -  2.0000KB  1.4538GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27495s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27651s  719.02us                    -               -         -         -         -  9.0000MB  12.224GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27732s  1.5040us                    -               -         -         -         -  2.0000KB  1.2682GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27736s  1.3440us                    -               -         -         -         -  2.0000KB  1.4192GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27890s  719.02us                    -               -         -         -         -  9.0000MB  12.224GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27970s  1.5350us                    -               -         -         -         -  2.0000KB  1.2426GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.27976s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28131s  719.09us                    -               -         -         -         -  9.0000MB  12.223GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28212s  1.5360us                    -               -         -         -         -  2.0000KB  1.2418GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28222s  1.2480us                    -               -         -         -         -  2.0000KB  1.5283GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28377s  718.06us                    -               -         -         -         -  9.0000MB  12.240GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28463s  1.6320us                    -               -         -         -         -  2.0000KB  1.1687GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28468s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28619s  719.86us                    -               -         -         -         -  9.0000MB  12.209GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28703s  1.5040us                    -               -         -         -         -  2.0000KB  1.2682GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28707s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28863s  719.28us                    -               -         -         -         -  9.0000MB  12.219GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28946s  1.5040us                    -               -         -         -         -  2.0000KB  1.2682GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28951s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28955s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28960s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.28964s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\n1.29034s  20.768us                    -               -         -         -         -  1.5000MB  70.534GB/s  GeForce GTX 107         1        14  [CUDA memcpy DtoD]\n1.29047s  30.015us             (16 1 1)      (1024 1 1)        25        0B        0B         -           -  GeForce GTX 107         1        13  void tensorflow::functor::SwapDimension1And2InTensor3<float>(int, float const *, tensorflow::functor::Dimension<int=3>, tensorflow::functor::SwapDimension1And2InTensor3<float>*) [936]\n1.29050s  3.7120us              (2 1 1)      (1024 1 1)        27        0B        0B         -           -  GeForce GTX 107         1        13  void tensorflow::functor::SwapDimension0And2InTensor3<float>(int, float const *, tensorflow::functor::Dimension<int=3>, tensorflow::functor::SwapDimension0And2InTensor3<float>*) [942]\n1.59580s     864ns                    -               -         -         -         -      112B  123.62MB/s  GeForce GTX 107         1         7  [CUDA memcpy HtoD]\n<computations start>", "body": "I am trying to feed a Tensor (using the C++ API) that has memory allocated on the GPU (using GPUBFCAllocator) into a network.\r\nNow, the placeholder in the network is on the GPU (I checked this in Tensorboard), and the memory allocated for the input tensor is on the GPU, but whenever I run the network, `nvprof --print-gpu-trace` shows me `[CUDA memcpy HtoD]` and `[CUDA memcpy DtoH]`, before the computations (i.e. convolutions etc.) start.\r\nThis suggests to me that the input tensor is being copied to CPU memory, and then back to GPU memory.\r\n\r\nWhile debugging this, I found multiple hints in the source that seem to suggest the CPU is always used as device to feed tensors from.\r\nSee e.g.:\r\nhttps://github.com/tensorflow/tensorflow/blob/eb56a8af24695bf8258addf28b0c53fbabff72e6/tensorflow/core/common_runtime/direct_session.cc#L264\r\nhttps://github.com/tensorflow/tensorflow/blob/429905c6283d3182a816487807e97e592849ce19/tensorflow/core/common_runtime/graph_runner.cc#L109\r\n\r\n1. Is this analysis correct?\r\n2. How can one feed in a tensor that has memory allocated on GPU memory, without copying back and forth to CPU memory? If this is currently not possible, then I think this would be a good feature to add.\r\nEspecially when one wants to combine Tensorflow input/output with other algorithms (not in TF), one might want to keep data on the GPU, to avoid host to device and device to host transfers.\r\n\r\nThanks in advance.\r\n\r\n### Environment info\r\nOperating System: Ubuntu 16.04.1 LTS\r\n\r\nInstalled version of CUDA and cuDNN: CUDA 8.0, cuDNN 5.1.5\r\nOutput of `ls -l /usr/local/cuda/lib64/libcud*`:\r\n```\r\n-rw-r--r-- 1 root root 558720 Sep 15 00:02 /usr/local/cuda/lib64/libcudadevrt.a\r\nlrwxrwxrwx 1 root root     16 Sep 15 00:05 /usr/local/cuda/lib64/libcudart.so -> libcudart.so.8.0\r\nlrwxrwxrwx 1 root root     19 Sep 15 00:05 /usr/local/cuda/lib64/libcudart.so.8.0 -> libcudart.so.8.0.44\r\n-rw-r--r-- 1 root root 415432 Sep 15 00:02 /usr/local/cuda/lib64/libcudart.so.8.0.44\r\n-rw-r--r-- 1 root root 775162 Sep 15 00:02 /usr/local/cuda/lib64/libcudart_static.a\r\nlrwxrwxrwx 1 root root     43 Oct  3 17:03 /usr/local/cuda/lib64/libcudnn.so -> /usr/local/cudnn-8.0-v5.1/lib64/libcudnn.so\r\nlrwxrwxrwx 1 root root     45 Oct  3 17:03 /usr/local/cuda/lib64/libcudnn.so.5 -> /usr/local/cudnn-8.0-v5.1/lib64/libcudnn.so.5\r\nlrwxrwxrwx 1 root root     49 Oct  3 17:03 /usr/local/cuda/lib64/libcudnn.so.5.1.5 -> /usr/local/cudnn-8.0-v5.1/lib64/libcudnn.so.5.1.5\r\nlrwxrwxrwx 1 root root     49 Oct  3 17:03 /usr/local/cuda/lib64/libcudnn_static.a -> /usr/local/cudnn-8.0-v5.1/lib64/libcudnn_static.a\r\n```\r\nTensorflow installed from source:\r\n1. The commit hash (`git rev-parse HEAD`): a5074383617a9947f248a0ddd56b94f9fb0f970b\r\n2. The output of `bazel version`:\r\n```\r\nBuild label: 0.4.0\r\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\r\nBuild time: Wed Nov 2 17:54:14 2016 (1478109254)\r\nBuild timestamp: 1478109254\r\nBuild timestamp as int: 1478109254\r\n```\r\n\r\n### If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\r\n\r\nThis should give the general idea.\r\n```cpp\r\ntensorflow::GPUBFCAllocator* allocator = new tensorflow::GPUBFCAllocator(0, sizeof(float) * height * width * 3);\r\ntensorflow::Tensor input_tensor = tensorflow::Tensor(allocator, tensorflow::DataType::DT_FLOAT, tensorflow::TensorShape( { 1, height, width, 3 }));\r\nstd::vector<tensorflow::Tensor>* outputs = new std::vector<tensorflow::Tensor>;\r\n<copy some data into the allocated space>\r\n<create a new session, load graph etc.> // Note: the \"input_layer\" is on the GPU\r\nsession->Run( { { \"input_layer\", input_tensor } }, { \"output_layer\" }, { }, outputs);\r\n```\r\n\r\n### Logs or other output that would be helpful\r\n\r\nPartial output of nvprof --print-gpu-trace:\r\n```\r\n   Start  Duration            Grid Size      Block Size     Regs*    SSMem*    DSMem*      Size  Throughput           Device   Context    Stream  Name\r\n249.54ms  4.7360us                    -               -         -         -         -  1.0039KB  207.01MB/s  GeForce GTX 107         1         7  [CUDA memset]\r\n932.67ms  44.799us                    -               -         -         -         -  384.00KB  8.1745GB/s  GeForce GTX 107         1         7  [CUDA memcpy HtoD]\r\n933.22ms  15.584us            (12 32 1)        (32 8 1)        20        0B        0B         -           -  GeForce GTX 107         1         7  void cv::cudev::grid_transform_detail::transformSmart<int=4, unsigned char, float, cv::cudev::saturate_cast_func<unsigned char, float>, cv::cudev::WithOutMask>(cv::cudev::GlobPtr<unsigned char>, cv::cudev::grid_transform_detail::transformSmart<int=4, unsigned char, float, cv::cudev::saturate_cast_func<unsigned char, float, float>, cv::cudev::WithOutMask>, unsigned char, float, int, int) [158]\r\n933.29ms  121.12us                    -               -         -         -         -  1.5000MB  12.094GB/s  GeForce GTX 107         1         7  [CUDA memcpy DtoH]\r\n1.24468s  2.1120us                    -               -         -         -         -        4B  1.8062MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.24492s     992ns                    -               -         -         -         -        4B  3.8455MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.24522s     992ns                    -               -         -         -         -        4B  3.8455MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.24553s     992ns                    -               -         -         -         -        4B  3.8455MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.24594s  1.0880us                    -               -         -         -         -        4B  3.5062MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.24632s     992ns                    -               -         -         -         -        4B  3.8455MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.24800s     992ns                    -               -         -         -         -        8B  7.6909MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.24816s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.24830s  38.879us                    -               -         -         -         -  288.00KB  7.0644GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.24846s  1.0880us                    -               -         -         -         -      512B  448.79MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.24858s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.24868s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.24874s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.24963s  106.62us                    -               -         -         -         -  1.1250MB  10.304GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.24981s  1.4080us                    -               -         -         -         -  1.0000KB  693.58MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.24987s  1.1840us                    -               -         -         -         -  1.0000KB  824.80MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25153s  196.60us                    -               -         -         -         -  2.2500MB  11.176GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25189s  1.4080us                    -               -         -         -         -  1.0000KB  693.58MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25196s  1.2800us                    -               -         -         -         -  1.0000KB  762.94MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25250s  180.92us                    -               -         -         -         -  2.2500MB  12.145GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25276s  1.4080us                    -               -         -         -         -  1.0000KB  693.58MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25281s  1.1840us                    -               -         -         -         -  1.0000KB  824.80MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25332s  180.67us                    -               -         -         -         -  2.2500MB  12.162GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25355s  1.4400us                    -               -         -         -         -  1.0000KB  678.17MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25359s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25406s  191.36us                    -               -         -         -         -  2.2500MB  11.483GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25431s  1.4400us                    -               -         -         -         -  1.0000KB  678.17MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25435s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25461s  90.910us                    -               -         -         -         -  1.1250MB  12.085GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25477s  1.3120us                    -               -         -         -         -  1.0000KB  744.33MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25482s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25486s  1.0560us                    -               -         -         -         -       68B  61.411MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25490s  4.1280us                    -               -         -         -         -  38.250KB  8.8367GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25500s  1.1840us                    -               -         -         -         -      256B  206.20MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25506s  1.0560us                    -               -         -         -         -      256B  231.19MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25511s  12.288us                    -               -         -         -         -  144.00KB  11.176GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25523s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25526s  1.0560us                    -               -         -         -         -      256B  231.19MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25532s  12.320us                    -               -         -         -         -  144.00KB  11.147GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25542s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25545s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25549s  1.6640us                    -               -         -         -         -  6.7500KB  3.8686GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25552s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25555s  1.1840us                    -               -         -         -         -      256B  206.20MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25559s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25562s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25570s  23.487us                    -               -         -         -         -  288.00KB  11.694GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25580s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25584s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25597s  45.919us                    -               -         -         -         -  576.00KB  11.963GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25607s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25610s  1.0880us                    -               -         -         -         -      512B  448.79MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25624s  45.919us                    -               -         -         -         -  576.00KB  11.963GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25634s  1.0880us                    -               -         -         -         -      512B  448.79MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25638s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25641s  1.4720us                    -               -         -         -         -  2.0000KB  1.2958GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25645s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25649s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25652s  1.1840us                    -               -         -         -         -  1.0000KB  824.80MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25656s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25659s  1.0880us                    -               -         -         -         -      512B  448.79MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25662s  1.1200us                    -               -         -         -         -      512B  435.97MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25666s  1.0880us                    -               -         -         -         -      256B  224.39MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25669s  1.0560us                    -               -         -         -         -      256B  231.19MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25673s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25676s  1.1840us                    -               -         -         -         -  1.0000KB  824.80MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25680s  1.1520us                    -               -         -         -         -  1.0000KB  847.71MB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.25965s  360.89us                    -               -         -         -         -  4.5000MB  12.177GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.26011s  1.5360us                    -               -         -         -         -  2.0000KB  1.2418GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.26015s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.26543s  719.60us                    -               -         -         -         -  9.0000MB  12.214GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.26626s  1.8240us                    -               -         -         -         -  2.0000KB  1.0457GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.26630s  1.2480us                    -               -         -         -         -  2.0000KB  1.5283GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.26788s  727.98us                    -               -         -         -         -  9.0000MB  12.073GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.26872s  1.5040us                    -               -         -         -         -  2.0000KB  1.2682GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.26876s  1.2480us                    -               -         -         -         -  2.0000KB  1.5283GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.27030s  718.67us                    -               -         -         -         -  9.0000MB  12.230GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.27109s  1.5680us                    -               -         -         -         -  2.0000KB  1.2164GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.27112s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.27268s  718.58us                    -               -         -         -         -  9.0000MB  12.231GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.27349s  1.5040us                    -               -         -         -         -  2.0000KB  1.2682GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.27359s  1.6000us                    -               -         -         -         -  2.0000KB  1.1921GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.27437s  360.12us                    -               -         -         -         -  4.5000MB  12.203GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.27479s  1.5360us                    -               -         -         -         -  2.0000KB  1.2418GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.27484s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.27487s  1.2480us                    -               -         -         -         -  2.0000KB  1.5283GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.27491s  1.3120us                    -               -         -         -         -  2.0000KB  1.4538GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.27495s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.27651s  719.02us                    -               -         -         -         -  9.0000MB  12.224GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.27732s  1.5040us                    -               -         -         -         -  2.0000KB  1.2682GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.27736s  1.3440us                    -               -         -         -         -  2.0000KB  1.4192GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.27890s  719.02us                    -               -         -         -         -  9.0000MB  12.224GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.27970s  1.5350us                    -               -         -         -         -  2.0000KB  1.2426GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.27976s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.28131s  719.09us                    -               -         -         -         -  9.0000MB  12.223GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.28212s  1.5360us                    -               -         -         -         -  2.0000KB  1.2418GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.28222s  1.2480us                    -               -         -         -         -  2.0000KB  1.5283GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.28377s  718.06us                    -               -         -         -         -  9.0000MB  12.240GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.28463s  1.6320us                    -               -         -         -         -  2.0000KB  1.1687GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.28468s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.28619s  719.86us                    -               -         -         -         -  9.0000MB  12.209GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.28703s  1.5040us                    -               -         -         -         -  2.0000KB  1.2682GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.28707s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.28863s  719.28us                    -               -         -         -         -  9.0000MB  12.219GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.28946s  1.5040us                    -               -         -         -         -  2.0000KB  1.2682GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.28951s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.28955s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.28960s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.28964s  1.2800us                    -               -         -         -         -  2.0000KB  1.4901GB/s  GeForce GTX 107         1        14  [CUDA memcpy HtoD]\r\n1.29034s  20.768us                    -               -         -         -         -  1.5000MB  70.534GB/s  GeForce GTX 107         1        14  [CUDA memcpy DtoD]\r\n1.29047s  30.015us             (16 1 1)      (1024 1 1)        25        0B        0B         -           -  GeForce GTX 107         1        13  void tensorflow::functor::SwapDimension1And2InTensor3<float>(int, float const *, tensorflow::functor::Dimension<int=3>, tensorflow::functor::SwapDimension1And2InTensor3<float>*) [936]\r\n1.29050s  3.7120us              (2 1 1)      (1024 1 1)        27        0B        0B         -           -  GeForce GTX 107         1        13  void tensorflow::functor::SwapDimension0And2InTensor3<float>(int, float const *, tensorflow::functor::Dimension<int=3>, tensorflow::functor::SwapDimension0And2InTensor3<float>*) [942]\r\n1.59580s     864ns                    -               -         -         -         -      112B  123.62MB/s  GeForce GTX 107         1         7  [CUDA memcpy HtoD]\r\n<computations start>\r\n```\r\n"}