{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/392626879", "html_url": "https://github.com/tensorflow/tensorflow/pull/16185#issuecomment-392626879", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16185", "id": 392626879, "node_id": "MDEyOklzc3VlQ29tbWVudDM5MjYyNjg3OQ==", "user": {"login": "zhuangh", "id": 1780002, "node_id": "MDQ6VXNlcjE3ODAwMDI=", "avatar_url": "https://avatars2.githubusercontent.com/u/1780002?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhuangh", "html_url": "https://github.com/zhuangh", "followers_url": "https://api.github.com/users/zhuangh/followers", "following_url": "https://api.github.com/users/zhuangh/following{/other_user}", "gists_url": "https://api.github.com/users/zhuangh/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhuangh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhuangh/subscriptions", "organizations_url": "https://api.github.com/users/zhuangh/orgs", "repos_url": "https://api.github.com/users/zhuangh/repos", "events_url": "https://api.github.com/users/zhuangh/events{/privacy}", "received_events_url": "https://api.github.com/users/zhuangh/received_events", "type": "User", "site_admin": false}, "created_at": "2018-05-29T01:19:07Z", "updated_at": "2018-05-29T01:19:07Z", "author_association": "NONE", "body_html": "<p>Hi <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=16907534\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rmlarsen\">@rmlarsen</a></p>\n<p>Not sure where I should post the following question (let me know if this is not the good place).</p>\n<p>I made some code change to translate the permutation matrix to indices. Code got complied but failed at the test part.</p>\n<p>The error \"tensorflow/core/framework/tensor.cc:617] Check failed: dtype() == expected_dtype (3 vs. 1)\"</p>\n<p>Detail log <a href=\"https://docs.google.com/document/d/174PI43b40Lnca6goHnp-yhghj1N7QJlSG9NqY7vHm1g/edit\" rel=\"nofollow\">https://docs.google.com/document/d/174PI43b40Lnca6goHnp-yhghj1N7QJlSG9NqY7vHm1g/edit</a></p>\n<p>I suspect <code>outputs-&gt;at(2) = perm.cast&lt;Scalar&gt;()</code> in<br>\n<a href=\"https://github.com/zhuangh/tensorflow/blob/8b304e22bba7f8ccab137d2985e25fcfef6ba3bd/tensorflow/core/kernels/lu_op.cc#L75-L82\">https://github.com/zhuangh/tensorflow/blob/8b304e22bba7f8ccab137d2985e25fcfef6ba3bd/tensorflow/core/kernels/lu_op.cc#L75-L82</a></p>\n<p>has a conflict with \"Tperm\" in</p>\n<pre><code>REGISTER_OP(\"Lu\")\n    .Input(\"input: T\")\n    .Output(\"l: T\")\n    .Output(\"u: T\")   \n    .Output(\"p: Tperm\")\n    .Attr(\"T: {double, float, complex64, complex128}\")\n    .Attr(\"Tperm: {int32, int64} = DT_INT32\")\n    .SetShapeFn(LuShapeFn);\n</code></pre>\n<p>in<br>\n<a href=\"https://github.com/zhuangh/tensorflow/blob/8b304e22bba7f8ccab137d2985e25fcfef6ba3bd/tensorflow/core/ops/linalg_ops.cc#L363\">https://github.com/zhuangh/tensorflow/blob/8b304e22bba7f8ccab137d2985e25fcfef6ba3bd/tensorflow/core/ops/linalg_ops.cc#L363</a></p>\n<p>If I turned <code>outputs-&gt;at(2) = perm.cast&lt;Scalar&gt;()</code> into <code>outputs-&gt;at(2) = perm.cast&lt;int64&gt;()</code>, the complication failed due to<br>\n\"external/eigen_archive/unsupported/Eigen/CXX11/../../../Eigen/src/Core/AssignEvaluator.h:834:3: error: static assertion failed: YOU_MIXED_DIFFERENT_NUMERIC_TYPES__YOU_NEED_TO_USE_THE_CAST_METHOD_OF_MATRIXBASE_TO_CAST_NUMERIC_TYPES_EXPLICITLY<br>\nEIGEN_CHECK_BINARY_COMPATIBILIY(Func,typename ActualDstTypeCleaned::Scalar,typename Src::Scalar);<br>\n\"\"</p>\n<p>The detail log: <a href=\"https://docs.google.com/document/d/1GtozEITwvVNYGJsK6yqS0ybuh6BuS53pmjklgVVfq8U/edit\" rel=\"nofollow\">https://docs.google.com/document/d/1GtozEITwvVNYGJsK6yqS0ybuh6BuS53pmjklgVVfq8U/edit</a></p>\n<p><strong>So my question, what is a good way to cast the type for the Op with mixed-type output tensors?</strong></p>\n<p>Thanks</p>", "body_text": "Hi @rmlarsen\nNot sure where I should post the following question (let me know if this is not the good place).\nI made some code change to translate the permutation matrix to indices. Code got complied but failed at the test part.\nThe error \"tensorflow/core/framework/tensor.cc:617] Check failed: dtype() == expected_dtype (3 vs. 1)\"\nDetail log https://docs.google.com/document/d/174PI43b40Lnca6goHnp-yhghj1N7QJlSG9NqY7vHm1g/edit\nI suspect outputs->at(2) = perm.cast<Scalar>() in\nhttps://github.com/zhuangh/tensorflow/blob/8b304e22bba7f8ccab137d2985e25fcfef6ba3bd/tensorflow/core/kernels/lu_op.cc#L75-L82\nhas a conflict with \"Tperm\" in\nREGISTER_OP(\"Lu\")\n    .Input(\"input: T\")\n    .Output(\"l: T\")\n    .Output(\"u: T\")   \n    .Output(\"p: Tperm\")\n    .Attr(\"T: {double, float, complex64, complex128}\")\n    .Attr(\"Tperm: {int32, int64} = DT_INT32\")\n    .SetShapeFn(LuShapeFn);\n\nin\nhttps://github.com/zhuangh/tensorflow/blob/8b304e22bba7f8ccab137d2985e25fcfef6ba3bd/tensorflow/core/ops/linalg_ops.cc#L363\nIf I turned outputs->at(2) = perm.cast<Scalar>() into outputs->at(2) = perm.cast<int64>(), the complication failed due to\n\"external/eigen_archive/unsupported/Eigen/CXX11/../../../Eigen/src/Core/AssignEvaluator.h:834:3: error: static assertion failed: YOU_MIXED_DIFFERENT_NUMERIC_TYPES__YOU_NEED_TO_USE_THE_CAST_METHOD_OF_MATRIXBASE_TO_CAST_NUMERIC_TYPES_EXPLICITLY\nEIGEN_CHECK_BINARY_COMPATIBILIY(Func,typename ActualDstTypeCleaned::Scalar,typename Src::Scalar);\n\"\"\nThe detail log: https://docs.google.com/document/d/1GtozEITwvVNYGJsK6yqS0ybuh6BuS53pmjklgVVfq8U/edit\nSo my question, what is a good way to cast the type for the Op with mixed-type output tensors?\nThanks", "body": "Hi @rmlarsen \r\n\r\nNot sure where I should post the following question (let me know if this is not the good place).\r\n\r\nI made some code change to translate the permutation matrix to indices. Code got complied but failed at the test part.\r\n\r\nThe error \"tensorflow/core/framework/tensor.cc:617] Check failed: dtype() == expected_dtype (3 vs. 1)\"\r\n\r\nDetail log https://docs.google.com/document/d/174PI43b40Lnca6goHnp-yhghj1N7QJlSG9NqY7vHm1g/edit\r\n\r\nI suspect ```outputs->at(2) = perm.cast<Scalar>()``` in  \r\nhttps://github.com/zhuangh/tensorflow/blob/8b304e22bba7f8ccab137d2985e25fcfef6ba3bd/tensorflow/core/kernels/lu_op.cc#L75-L82\r\n \r\nhas a conflict with \"Tperm\" in\r\n\r\n```\r\nREGISTER_OP(\"Lu\")\r\n    .Input(\"input: T\")\r\n    .Output(\"l: T\")\r\n    .Output(\"u: T\")   \r\n    .Output(\"p: Tperm\")\r\n    .Attr(\"T: {double, float, complex64, complex128}\")\r\n    .Attr(\"Tperm: {int32, int64} = DT_INT32\")\r\n    .SetShapeFn(LuShapeFn);\r\n```\r\nin\r\nhttps://github.com/zhuangh/tensorflow/blob/8b304e22bba7f8ccab137d2985e25fcfef6ba3bd/tensorflow/core/ops/linalg_ops.cc#L363\r\n\r\nIf I turned ```outputs->at(2) = perm.cast<Scalar>()``` into ```outputs->at(2) = perm.cast<int64>()```, the complication failed due to \r\n\"external/eigen_archive/unsupported/Eigen/CXX11/../../../Eigen/src/Core/AssignEvaluator.h:834:3: error: static assertion failed: YOU_MIXED_DIFFERENT_NUMERIC_TYPES__YOU_NEED_TO_USE_THE_CAST_METHOD_OF_MATRIXBASE_TO_CAST_NUMERIC_TYPES_EXPLICITLY\r\n   EIGEN_CHECK_BINARY_COMPATIBILIY(Func,typename ActualDstTypeCleaned::Scalar,typename Src::Scalar);\r\n\"\"\r\n\r\nThe detail log: https://docs.google.com/document/d/1GtozEITwvVNYGJsK6yqS0ybuh6BuS53pmjklgVVfq8U/edit\r\n\r\n**So my question, what is a good way to cast the type for the Op with mixed-type output tensors?**\r\n\r\nThanks\r\n"}