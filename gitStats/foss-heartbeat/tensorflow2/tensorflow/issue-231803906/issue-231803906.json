{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10250", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10250/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10250/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10250/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/10250", "id": 231803906, "node_id": "MDU6SXNzdWUyMzE4MDM5MDY=", "number": 10250, "title": "Error on importing metagraph that uses unbound input multiple times", "user": {"login": "freitmi", "id": 25958780, "node_id": "MDQ6VXNlcjI1OTU4Nzgw", "avatar_url": "https://avatars2.githubusercontent.com/u/25958780?v=4", "gravatar_id": "", "url": "https://api.github.com/users/freitmi", "html_url": "https://github.com/freitmi", "followers_url": "https://api.github.com/users/freitmi/followers", "following_url": "https://api.github.com/users/freitmi/following{/other_user}", "gists_url": "https://api.github.com/users/freitmi/gists{/gist_id}", "starred_url": "https://api.github.com/users/freitmi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/freitmi/subscriptions", "organizations_url": "https://api.github.com/users/freitmi/orgs", "repos_url": "https://api.github.com/users/freitmi/repos", "events_url": "https://api.github.com/users/freitmi/events{/privacy}", "received_events_url": "https://api.github.com/users/freitmi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2017-05-27T14:14:45Z", "updated_at": "2018-02-09T00:16:18Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>If I export a scoped metagraph which has multiple references to a tensor which will be unbound after exporting, I cannot re-import the metagraph. This problem can be reproduced with the following MWE.</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\ngraph <span class=\"pl-k\">=</span> tf.Graph()\n\n<span class=\"pl-k\">with</span> graph.as_default():\n    inputs <span class=\"pl-k\">=</span> tf.placeholder(<span class=\"pl-v\">shape</span><span class=\"pl-k\">=</span>[], <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>tf.float32, <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>inputs<span class=\"pl-pds\">\"</span></span>)\n\n    <span class=\"pl-k\">with</span> tf.name_scope(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>scope<span class=\"pl-pds\">\"</span></span>):\n        output <span class=\"pl-k\">=</span> inputs <span class=\"pl-k\">+</span> inputs\n\n    tf.train.export_meta_graph(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>./mwe.meta<span class=\"pl-pds\">\"</span></span>,\n                               <span class=\"pl-v\">export_scope</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>scope<span class=\"pl-pds\">\"</span></span>,\n                               <span class=\"pl-v\">as_text</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>)\n\ngraph <span class=\"pl-k\">=</span> tf.Graph()\n\n<span class=\"pl-k\">with</span> graph.as_default():\n    inputs <span class=\"pl-k\">=</span> tf.constant(<span class=\"pl-v\">shape</span><span class=\"pl-k\">=</span>[], <span class=\"pl-v\">value</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">1.0</span>)\n\n    tf.train.import_meta_graph(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>./mwe.meta<span class=\"pl-pds\">\"</span></span>,\n                               <span class=\"pl-v\">import_scope</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>scope<span class=\"pl-pds\">\"</span></span>,\n                               <span class=\"pl-v\">input_map</span><span class=\"pl-k\">=</span>{\n                                   <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>$unbound_inputs_inputs<span class=\"pl-pds\">\"</span></span>: inputs\n                               })\n</pre></div>\n<p>Running this code results in the following error.</p>\n<pre><code>Traceback (most recent call last):\n  File \"&lt;snip&gt;\\metagraph_bug_mwe.py\", line 23, in &lt;module&gt;\n    \"$unbound_inputs_inputs\": inputs\n  File \"&lt;snip&gt;\\Python35\\lib\\site-packages\\tensorflow\\python\\training\\saver.py\", line 1595, in import_meta_graph\n    **kwargs)\n  File \"&lt;snip&gt;\\Python35\\lib\\site-packages\\tensorflow\\python\\framework\\meta_graph.py\", line 479, in import_scoped_meta_graph\n    \",\".join([compat.as_str(v) for v in field.value\nValueError: Graph contains unbound inputs: $unbound_inputs_inputs,$unbound_inputs_inputs. Must provide these inputs through input_map.\n</code></pre>\n<p>Upon inspection of the generated metagraph file (see <a href=\"https://github.com/tensorflow/tensorflow/files/1033570/mwe.meta.txt\">mwe.meta</a>, lines 67 - 75), I noticed that the <code>inputs</code> tensor actually has two entries in the <code>unbound_inputs</code> collection. Since the <code>import_scoped_meta_graph</code> function compares the full collection read from the proto to the <code>input_map</code> parameter, they do not match and the error is raised.</p>\n<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: Yes, see above</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Windows 10</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.1.0</li>\n<li><strong>Bazel version (if compiling from source)</strong>: N/A</li>\n<li><strong>CUDA/cuDNN version</strong>: 8.0/5.1.10</li>\n<li><strong>GPU model and memory</strong>: Nvidia GeForce GTX 860M with 2GB VRAM + 4GB shared</li>\n<li><strong>Exact command to reproduce</strong>: See MWE above</li>\n</ul>", "body_text": "If I export a scoped metagraph which has multiple references to a tensor which will be unbound after exporting, I cannot re-import the metagraph. This problem can be reproduced with the following MWE.\nimport tensorflow as tf\n\ngraph = tf.Graph()\n\nwith graph.as_default():\n    inputs = tf.placeholder(shape=[], dtype=tf.float32, name=\"inputs\")\n\n    with tf.name_scope(\"scope\"):\n        output = inputs + inputs\n\n    tf.train.export_meta_graph(\"./mwe.meta\",\n                               export_scope=\"scope\",\n                               as_text=True)\n\ngraph = tf.Graph()\n\nwith graph.as_default():\n    inputs = tf.constant(shape=[], value=1.0)\n\n    tf.train.import_meta_graph(\"./mwe.meta\",\n                               import_scope=\"scope\",\n                               input_map={\n                                   \"$unbound_inputs_inputs\": inputs\n                               })\n\nRunning this code results in the following error.\nTraceback (most recent call last):\n  File \"<snip>\\metagraph_bug_mwe.py\", line 23, in <module>\n    \"$unbound_inputs_inputs\": inputs\n  File \"<snip>\\Python35\\lib\\site-packages\\tensorflow\\python\\training\\saver.py\", line 1595, in import_meta_graph\n    **kwargs)\n  File \"<snip>\\Python35\\lib\\site-packages\\tensorflow\\python\\framework\\meta_graph.py\", line 479, in import_scoped_meta_graph\n    \",\".join([compat.as_str(v) for v in field.value\nValueError: Graph contains unbound inputs: $unbound_inputs_inputs,$unbound_inputs_inputs. Must provide these inputs through input_map.\n\nUpon inspection of the generated metagraph file (see mwe.meta, lines 67 - 75), I noticed that the inputs tensor actually has two entries in the unbound_inputs collection. Since the import_scoped_meta_graph function compares the full collection read from the proto to the input_map parameter, they do not match and the error is raised.\nSystem information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes, see above\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Windows 10\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below): 1.1.0\nBazel version (if compiling from source): N/A\nCUDA/cuDNN version: 8.0/5.1.10\nGPU model and memory: Nvidia GeForce GTX 860M with 2GB VRAM + 4GB shared\nExact command to reproduce: See MWE above", "body": "If I export a scoped metagraph which has multiple references to a tensor which will be unbound after exporting, I cannot re-import the metagraph. This problem can be reproduced with the following MWE.\r\n\r\n```python\r\nimport tensorflow as tf\r\n\r\ngraph = tf.Graph()\r\n\r\nwith graph.as_default():\r\n    inputs = tf.placeholder(shape=[], dtype=tf.float32, name=\"inputs\")\r\n\r\n    with tf.name_scope(\"scope\"):\r\n        output = inputs + inputs\r\n\r\n    tf.train.export_meta_graph(\"./mwe.meta\",\r\n                               export_scope=\"scope\",\r\n                               as_text=True)\r\n\r\ngraph = tf.Graph()\r\n\r\nwith graph.as_default():\r\n    inputs = tf.constant(shape=[], value=1.0)\r\n\r\n    tf.train.import_meta_graph(\"./mwe.meta\",\r\n                               import_scope=\"scope\",\r\n                               input_map={\r\n                                   \"$unbound_inputs_inputs\": inputs\r\n                               })\r\n\r\n```\r\nRunning this code results in the following error.\r\n```\r\nTraceback (most recent call last):\r\n  File \"<snip>\\metagraph_bug_mwe.py\", line 23, in <module>\r\n    \"$unbound_inputs_inputs\": inputs\r\n  File \"<snip>\\Python35\\lib\\site-packages\\tensorflow\\python\\training\\saver.py\", line 1595, in import_meta_graph\r\n    **kwargs)\r\n  File \"<snip>\\Python35\\lib\\site-packages\\tensorflow\\python\\framework\\meta_graph.py\", line 479, in import_scoped_meta_graph\r\n    \",\".join([compat.as_str(v) for v in field.value\r\nValueError: Graph contains unbound inputs: $unbound_inputs_inputs,$unbound_inputs_inputs. Must provide these inputs through input_map.\r\n```\r\nUpon inspection of the generated metagraph file (see [mwe.meta](https://github.com/tensorflow/tensorflow/files/1033570/mwe.meta.txt), lines 67 - 75), I noticed that the `inputs` tensor actually has two entries in the `unbound_inputs` collection. Since the `import_scoped_meta_graph` function compares the full collection read from the proto to the `input_map` parameter, they do not match and the error is raised.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: Yes, see above\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Windows 10\r\n- **TensorFlow installed from (source or binary)**: binary\r\n- **TensorFlow version (use command below)**: 1.1.0\r\n- **Bazel version (if compiling from source)**: N/A\r\n- **CUDA/cuDNN version**: 8.0/5.1.10\r\n- **GPU model and memory**: Nvidia GeForce GTX 860M with 2GB VRAM + 4GB shared\r\n- **Exact command to reproduce**: See MWE above\r\n\r\n"}