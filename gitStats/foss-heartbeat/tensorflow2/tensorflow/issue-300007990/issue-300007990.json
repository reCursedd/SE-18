{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17252", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17252/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17252/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17252/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/17252", "id": 300007990, "node_id": "MDU6SXNzdWUzMDAwMDc5OTA=", "number": 17252, "title": "Retrain.py script failing with nan-error at random without any code changes", "user": {"login": "RT-TL", "id": 13029793, "node_id": "MDQ6VXNlcjEzMDI5Nzkz", "avatar_url": "https://avatars1.githubusercontent.com/u/13029793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RT-TL", "html_url": "https://github.com/RT-TL", "followers_url": "https://api.github.com/users/RT-TL/followers", "following_url": "https://api.github.com/users/RT-TL/following{/other_user}", "gists_url": "https://api.github.com/users/RT-TL/gists{/gist_id}", "starred_url": "https://api.github.com/users/RT-TL/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RT-TL/subscriptions", "organizations_url": "https://api.github.com/users/RT-TL/orgs", "repos_url": "https://api.github.com/users/RT-TL/repos", "events_url": "https://api.github.com/users/RT-TL/events{/privacy}", "received_events_url": "https://api.github.com/users/RT-TL/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-02-25T08:20:20Z", "updated_at": "2018-03-06T13:31:20Z", "closed_at": "2018-03-06T13:31:20Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: No</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Working on a notebook with MacOS High Sierra v10.13.1 in a Docker container using Ubuntu 16.04.3</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: Source</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.5</li>\n<li><strong>Python version</strong>: 2.7</li>\n<li><strong>Bazel version (if compiling from source)</strong>: -</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: -</li>\n<li><strong>CUDA/cuDNN version</strong>: Using CPU</li>\n<li><strong>GPU model and memory</strong>:</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<pre><code>python -m scripts.retrain \\\n  --bottleneck_dir=tf_files/bottlenecks \\\n  --summaries_dir=tf_files/training_summaries/ \\\n  --output_graph=tf_files/retrained_graph.pb \\\n  --output_labels=tf_files/retrained_labels.txt \\\n  --image_dir=/ml/data/images\n</code></pre>\n<h3>Describe the problem</h3>\n<p>My set up is based on the tensorflow-for-poets tutorial. To test if everything is working I use the contained flower dataset. I tried to train the default inceptionV3 as well as the mobilenet architectures. However, training fails at some random point with the below listed error. This error does not seem to appear (or at least not as regular) if I train 500 or less training steps.</p>\n<p>Based on what I read here the thrown error is indicating model instability. Since I changed neither code nor data this seems a bit strange. I think it might be a bug but you can probably help me figuring out if this is the case.</p>\n<h3>Source code / logs</h3>\n<p>This is the error:</p>\n<pre><code>Traceback (most recent call last):\n  File \"/usr/lib/python2.7/runpy.py\", line 174, in _run_module_as_main\n    \"__main__\", fname, loader, pkg_name)\n  File \"/usr/lib/python2.7/runpy.py\", line 72, in _run_code\n    exec code in run_globals\n  File \"/ml/tensorflow-for-poets/scripts/retrain.py\", line 1296, in &lt;module&gt;\n    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 124, in run\n    _sys.exit(main(argv))\n  File \"/ml/tensorflow-for-poets/scripts/retrain.py\", line 1041, in main\n    ground_truth_input: train_ground_truth})\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 895, in run\n    run_metadata_ptr)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1128, in _run\n    feed_dict_tensor, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1344, in _do_run\n    options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1363, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Nan in summary histogram for: activations\n\t [[Node: activations = HistogramSummary[T=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](activations/tag, final_result)]]\n\nCaused by op u'activations', defined at:\n  File \"/usr/lib/python2.7/runpy.py\", line 174, in _run_module_as_main\n    \"__main__\", fname, loader, pkg_name)\n  File \"/usr/lib/python2.7/runpy.py\", line 72, in _run_code\n    exec code in run_globals\n  File \"/ml/tensorflow-for-poets/scripts/retrain.py\", line 1296, in &lt;module&gt;\n    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 124, in run\n    _sys.exit(main(argv))\n  File \"/ml/tensorflow-for-poets/scripts/retrain.py\", line 1001, in main\n    model_info['bottleneck_tensor_size'], model_info['quantize_layer'])\n  File \"/ml/tensorflow-for-poets/scripts/retrain.py\", line 754, in add_final_training_ops\n    tf.summary.histogram('activations', final_tensor)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/summary/summary.py\", line 193, in histogram\n    tag=tag, values=values, name=scope)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_logging_ops.py\", line 189, in _histogram_summary\n    \"HistogramSummary\", tag=tag, values=values, name=name)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 3160, in create_op\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1625, in __init__\n    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\n\nInvalidArgumentError (see above for traceback): Nan in summary histogram for: activations\n\t [[Node: activations = HistogramSummary[T=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](activations/tag, final_result)]]\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): No\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Working on a notebook with MacOS High Sierra v10.13.1 in a Docker container using Ubuntu 16.04.3\nTensorFlow installed from (source or binary): Source\nTensorFlow version (use command below): 1.5\nPython version: 2.7\nBazel version (if compiling from source): -\nGCC/Compiler version (if compiling from source): -\nCUDA/cuDNN version: Using CPU\nGPU model and memory:\nExact command to reproduce:\n\npython -m scripts.retrain \\\n  --bottleneck_dir=tf_files/bottlenecks \\\n  --summaries_dir=tf_files/training_summaries/ \\\n  --output_graph=tf_files/retrained_graph.pb \\\n  --output_labels=tf_files/retrained_labels.txt \\\n  --image_dir=/ml/data/images\n\nDescribe the problem\nMy set up is based on the tensorflow-for-poets tutorial. To test if everything is working I use the contained flower dataset. I tried to train the default inceptionV3 as well as the mobilenet architectures. However, training fails at some random point with the below listed error. This error does not seem to appear (or at least not as regular) if I train 500 or less training steps.\nBased on what I read here the thrown error is indicating model instability. Since I changed neither code nor data this seems a bit strange. I think it might be a bug but you can probably help me figuring out if this is the case.\nSource code / logs\nThis is the error:\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/runpy.py\", line 174, in _run_module_as_main\n    \"__main__\", fname, loader, pkg_name)\n  File \"/usr/lib/python2.7/runpy.py\", line 72, in _run_code\n    exec code in run_globals\n  File \"/ml/tensorflow-for-poets/scripts/retrain.py\", line 1296, in <module>\n    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 124, in run\n    _sys.exit(main(argv))\n  File \"/ml/tensorflow-for-poets/scripts/retrain.py\", line 1041, in main\n    ground_truth_input: train_ground_truth})\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 895, in run\n    run_metadata_ptr)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1128, in _run\n    feed_dict_tensor, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1344, in _do_run\n    options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1363, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Nan in summary histogram for: activations\n\t [[Node: activations = HistogramSummary[T=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](activations/tag, final_result)]]\n\nCaused by op u'activations', defined at:\n  File \"/usr/lib/python2.7/runpy.py\", line 174, in _run_module_as_main\n    \"__main__\", fname, loader, pkg_name)\n  File \"/usr/lib/python2.7/runpy.py\", line 72, in _run_code\n    exec code in run_globals\n  File \"/ml/tensorflow-for-poets/scripts/retrain.py\", line 1296, in <module>\n    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 124, in run\n    _sys.exit(main(argv))\n  File \"/ml/tensorflow-for-poets/scripts/retrain.py\", line 1001, in main\n    model_info['bottleneck_tensor_size'], model_info['quantize_layer'])\n  File \"/ml/tensorflow-for-poets/scripts/retrain.py\", line 754, in add_final_training_ops\n    tf.summary.histogram('activations', final_tensor)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/summary/summary.py\", line 193, in histogram\n    tag=tag, values=values, name=scope)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_logging_ops.py\", line 189, in _histogram_summary\n    \"HistogramSummary\", tag=tag, values=values, name=name)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 3160, in create_op\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1625, in __init__\n    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\n\nInvalidArgumentError (see above for traceback): Nan in summary histogram for: activations\n\t [[Node: activations = HistogramSummary[T=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](activations/tag, final_result)]]", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Working on a notebook with MacOS High Sierra v10.13.1 in a Docker container using Ubuntu 16.04.3\r\n- **TensorFlow installed from (source or binary)**: Source\r\n- **TensorFlow version (use command below)**: 1.5\r\n- **Python version**: 2.7\r\n- **Bazel version (if compiling from source)**: -\r\n- **GCC/Compiler version (if compiling from source)**: -\r\n- **CUDA/cuDNN version**: Using CPU \r\n- **GPU model and memory**:\r\n- **Exact command to reproduce**: \r\n\r\n```\r\npython -m scripts.retrain \\\r\n  --bottleneck_dir=tf_files/bottlenecks \\\r\n  --summaries_dir=tf_files/training_summaries/ \\\r\n  --output_graph=tf_files/retrained_graph.pb \\\r\n  --output_labels=tf_files/retrained_labels.txt \\\r\n  --image_dir=/ml/data/images\r\n```\r\n\r\n### Describe the problem\r\n\r\nMy set up is based on the tensorflow-for-poets tutorial. To test if everything is working I use the contained flower dataset. I tried to train the default inceptionV3 as well as the mobilenet architectures. However, training fails at some random point with the below listed error. This error does not seem to appear (or at least not as regular) if I train 500 or less training steps.\r\n\r\nBased on what I read here the thrown error is indicating model instability. Since I changed neither code nor data this seems a bit strange. I think it might be a bug but you can probably help me figuring out if this is the case.\r\n\r\n### Source code / logs\r\n\r\nThis is the error:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python2.7/runpy.py\", line 174, in _run_module_as_main\r\n    \"__main__\", fname, loader, pkg_name)\r\n  File \"/usr/lib/python2.7/runpy.py\", line 72, in _run_code\r\n    exec code in run_globals\r\n  File \"/ml/tensorflow-for-poets/scripts/retrain.py\", line 1296, in <module>\r\n    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 124, in run\r\n    _sys.exit(main(argv))\r\n  File \"/ml/tensorflow-for-poets/scripts/retrain.py\", line 1041, in main\r\n    ground_truth_input: train_ground_truth})\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 895, in run\r\n    run_metadata_ptr)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1128, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1344, in _do_run\r\n    options, run_metadata)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1363, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Nan in summary histogram for: activations\r\n\t [[Node: activations = HistogramSummary[T=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](activations/tag, final_result)]]\r\n\r\nCaused by op u'activations', defined at:\r\n  File \"/usr/lib/python2.7/runpy.py\", line 174, in _run_module_as_main\r\n    \"__main__\", fname, loader, pkg_name)\r\n  File \"/usr/lib/python2.7/runpy.py\", line 72, in _run_code\r\n    exec code in run_globals\r\n  File \"/ml/tensorflow-for-poets/scripts/retrain.py\", line 1296, in <module>\r\n    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 124, in run\r\n    _sys.exit(main(argv))\r\n  File \"/ml/tensorflow-for-poets/scripts/retrain.py\", line 1001, in main\r\n    model_info['bottleneck_tensor_size'], model_info['quantize_layer'])\r\n  File \"/ml/tensorflow-for-poets/scripts/retrain.py\", line 754, in add_final_training_ops\r\n    tf.summary.histogram('activations', final_tensor)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/summary/summary.py\", line 193, in histogram\r\n    tag=tag, values=values, name=scope)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_logging_ops.py\", line 189, in _histogram_summary\r\n    \"HistogramSummary\", tag=tag, values=values, name=name)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 3160, in create_op\r\n    op_def=op_def)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1625, in __init__\r\n    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\r\n\r\nInvalidArgumentError (see above for traceback): Nan in summary histogram for: activations\r\n\t [[Node: activations = HistogramSummary[T=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](activations/tag, final_result)]]\r\n```"}