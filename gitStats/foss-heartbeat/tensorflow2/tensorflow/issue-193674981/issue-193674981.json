{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6110", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6110/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6110/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6110/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/6110", "id": 193674981, "node_id": "MDU6SXNzdWUxOTM2NzQ5ODE=", "number": 6110, "title": "generate signature for SparseTensor failed", "user": {"login": "ericyue", "id": 918889, "node_id": "MDQ6VXNlcjkxODg4OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/918889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ericyue", "html_url": "https://github.com/ericyue", "followers_url": "https://api.github.com/users/ericyue/followers", "following_url": "https://api.github.com/users/ericyue/following{/other_user}", "gists_url": "https://api.github.com/users/ericyue/gists{/gist_id}", "starred_url": "https://api.github.com/users/ericyue/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ericyue/subscriptions", "organizations_url": "https://api.github.com/users/ericyue/orgs", "repos_url": "https://api.github.com/users/ericyue/repos", "events_url": "https://api.github.com/users/ericyue/events{/privacy}", "received_events_url": "https://api.github.com/users/ericyue/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2016-12-06T03:36:10Z", "updated_at": "2018-03-20T09:53:58Z", "closed_at": "2016-12-06T11:40:01Z", "author_association": "NONE", "body_html": "<h3>What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?</h3>\n<p>I can not find any posts about how to export a sparse model in tensorflow. I searched for hours.</p>\n<h3>Environment info</h3>\n<p>Operating System:<br>\ncentos7 without gpu</p>\n<h3>If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)</h3>\n<p>export function:</p>\n<pre><code># Read TFRecords files for training\nfilename_queue = tf.train.string_input_producer(\n    tf.train.match_filenames_once(FLAGS.train),\n    num_epochs=epoch_number)\nserialized_example = read_and_decode(filename_queue)\nbatch_serialized_example = tf.train.shuffle_batch(\n    [serialized_example],\n    batch_size=batch_size,\n    num_threads=thread_number,\n    capacity=capacity,\n    min_after_dequeue=min_after_dequeue)\nfeatures = tf.parse_example(\n    batch_serialized_example,\n    features={\n        \"label\": tf.FixedLenFeature([], tf.float32),\n        \"ids\": tf.VarLenFeature(tf.int64),\n        \"values\": tf.VarLenFeature(tf.float32),\n    })\nbatch_labels = features[\"label\"]\nbatch_ids = features[\"ids\"]\nbatch_values = features[\"values\"]\n\n        print(\"Start to run export model\")\n        start_time = datetime.datetime.now()\n\n        ckpt = tf.train.get_checkpoint_state(checkpoint_dir)\n        if ckpt and ckpt.model_checkpoint_path:\n            print(\"Use the model {}\".format(ckpt.model_checkpoint_path))\n            saver.restore(sess, ckpt.model_checkpoint_path)\n            export_version = FLAGS.export_version\n            export_path = \"./export/\"+job_name\n            print('Exporting trained model to %s' % export_path)\n            model_exporter = exporter.Exporter(saver)\n            model_exporter.init(\n                sess.graph.as_graph_def(),\n                named_graph_signatures = {\n                  'inputs': exporter.generic_signature({'ids': features['ids'], 'values':features['values']}),\n                  'outputs': exporter.generic_signature({'labels': features['labels']})},\n                init_op=init_op)\n            model_exporter.export(export_path, tf.constant(export_version), sess)\n            print('Done exporting!')\n</code></pre>\n<h3>Logs or other output that would be helpful</h3>\n<p>(If logs are large, please upload as attachment or provide link).</p>\n<pre><code>Traceback (most recent call last):\n  File \"run.py\", line 343, in &lt;module&gt;\n    'inputs': exporter.generic_signature({'ids': features['ids'], 'values':features['values']}),\n  File \"/home/serving/anaconda2/lib/python2.7/site-packages/tensorflow/contrib/session_bundle/exporter.py\", line 121, in generic_signature\n    signature.generic_signature.map[name].tensor_name = tensor.name\nAttributeError: 'SparseTensor' object has no attribute 'name'\n</code></pre>", "body_text": "What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\nI can not find any posts about how to export a sparse model in tensorflow. I searched for hours.\nEnvironment info\nOperating System:\ncentos7 without gpu\nIf possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\nexport function:\n# Read TFRecords files for training\nfilename_queue = tf.train.string_input_producer(\n    tf.train.match_filenames_once(FLAGS.train),\n    num_epochs=epoch_number)\nserialized_example = read_and_decode(filename_queue)\nbatch_serialized_example = tf.train.shuffle_batch(\n    [serialized_example],\n    batch_size=batch_size,\n    num_threads=thread_number,\n    capacity=capacity,\n    min_after_dequeue=min_after_dequeue)\nfeatures = tf.parse_example(\n    batch_serialized_example,\n    features={\n        \"label\": tf.FixedLenFeature([], tf.float32),\n        \"ids\": tf.VarLenFeature(tf.int64),\n        \"values\": tf.VarLenFeature(tf.float32),\n    })\nbatch_labels = features[\"label\"]\nbatch_ids = features[\"ids\"]\nbatch_values = features[\"values\"]\n\n        print(\"Start to run export model\")\n        start_time = datetime.datetime.now()\n\n        ckpt = tf.train.get_checkpoint_state(checkpoint_dir)\n        if ckpt and ckpt.model_checkpoint_path:\n            print(\"Use the model {}\".format(ckpt.model_checkpoint_path))\n            saver.restore(sess, ckpt.model_checkpoint_path)\n            export_version = FLAGS.export_version\n            export_path = \"./export/\"+job_name\n            print('Exporting trained model to %s' % export_path)\n            model_exporter = exporter.Exporter(saver)\n            model_exporter.init(\n                sess.graph.as_graph_def(),\n                named_graph_signatures = {\n                  'inputs': exporter.generic_signature({'ids': features['ids'], 'values':features['values']}),\n                  'outputs': exporter.generic_signature({'labels': features['labels']})},\n                init_op=init_op)\n            model_exporter.export(export_path, tf.constant(export_version), sess)\n            print('Done exporting!')\n\nLogs or other output that would be helpful\n(If logs are large, please upload as attachment or provide link).\nTraceback (most recent call last):\n  File \"run.py\", line 343, in <module>\n    'inputs': exporter.generic_signature({'ids': features['ids'], 'values':features['values']}),\n  File \"/home/serving/anaconda2/lib/python2.7/site-packages/tensorflow/contrib/session_bundle/exporter.py\", line 121, in generic_signature\n    signature.generic_signature.map[name].tensor_name = tensor.name\nAttributeError: 'SparseTensor' object has no attribute 'name'", "body": "### What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\r\nI can not find any posts about how to export a sparse model in tensorflow. I searched for hours.\r\n\r\n### Environment info\r\nOperating System:\r\ncentos7 without gpu\r\n\r\n### If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\r\nexport function:\r\n```\r\n# Read TFRecords files for training\r\nfilename_queue = tf.train.string_input_producer(\r\n    tf.train.match_filenames_once(FLAGS.train),\r\n    num_epochs=epoch_number)\r\nserialized_example = read_and_decode(filename_queue)\r\nbatch_serialized_example = tf.train.shuffle_batch(\r\n    [serialized_example],\r\n    batch_size=batch_size,\r\n    num_threads=thread_number,\r\n    capacity=capacity,\r\n    min_after_dequeue=min_after_dequeue)\r\nfeatures = tf.parse_example(\r\n    batch_serialized_example,\r\n    features={\r\n        \"label\": tf.FixedLenFeature([], tf.float32),\r\n        \"ids\": tf.VarLenFeature(tf.int64),\r\n        \"values\": tf.VarLenFeature(tf.float32),\r\n    })\r\nbatch_labels = features[\"label\"]\r\nbatch_ids = features[\"ids\"]\r\nbatch_values = features[\"values\"]\r\n\r\n        print(\"Start to run export model\")\r\n        start_time = datetime.datetime.now()\r\n\r\n        ckpt = tf.train.get_checkpoint_state(checkpoint_dir)\r\n        if ckpt and ckpt.model_checkpoint_path:\r\n            print(\"Use the model {}\".format(ckpt.model_checkpoint_path))\r\n            saver.restore(sess, ckpt.model_checkpoint_path)\r\n            export_version = FLAGS.export_version\r\n            export_path = \"./export/\"+job_name\r\n            print('Exporting trained model to %s' % export_path)\r\n            model_exporter = exporter.Exporter(saver)\r\n            model_exporter.init(\r\n                sess.graph.as_graph_def(),\r\n                named_graph_signatures = {\r\n                  'inputs': exporter.generic_signature({'ids': features['ids'], 'values':features['values']}),\r\n                  'outputs': exporter.generic_signature({'labels': features['labels']})},\r\n                init_op=init_op)\r\n            model_exporter.export(export_path, tf.constant(export_version), sess)\r\n            print('Done exporting!')\r\n```\r\n\r\n### Logs or other output that would be helpful\r\n(If logs are large, please upload as attachment or provide link).\r\n```\r\nTraceback (most recent call last):\r\n  File \"run.py\", line 343, in <module>\r\n    'inputs': exporter.generic_signature({'ids': features['ids'], 'values':features['values']}),\r\n  File \"/home/serving/anaconda2/lib/python2.7/site-packages/tensorflow/contrib/session_bundle/exporter.py\", line 121, in generic_signature\r\n    signature.generic_signature.map[name].tensor_name = tensor.name\r\nAttributeError: 'SparseTensor' object has no attribute 'name'\r\n```"}