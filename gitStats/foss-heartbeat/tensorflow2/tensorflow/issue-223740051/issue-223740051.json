{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9405", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9405/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9405/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9405/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/9405", "id": 223740051, "node_id": "MDU6SXNzdWUyMjM3NDAwNTE=", "number": 9405, "title": "testAvgPoolSamePadding fails on ppc64le. Attempting to root cause, have some info need some help", "user": {"login": "vaibhavsood", "id": 3442240, "node_id": "MDQ6VXNlcjM0NDIyNDA=", "avatar_url": "https://avatars2.githubusercontent.com/u/3442240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vaibhavsood", "html_url": "https://github.com/vaibhavsood", "followers_url": "https://api.github.com/users/vaibhavsood/followers", "following_url": "https://api.github.com/users/vaibhavsood/following{/other_user}", "gists_url": "https://api.github.com/users/vaibhavsood/gists{/gist_id}", "starred_url": "https://api.github.com/users/vaibhavsood/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vaibhavsood/subscriptions", "organizations_url": "https://api.github.com/users/vaibhavsood/orgs", "repos_url": "https://api.github.com/users/vaibhavsood/repos", "events_url": "https://api.github.com/users/vaibhavsood/events{/privacy}", "received_events_url": "https://api.github.com/users/vaibhavsood/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586558, "node_id": "MDU6TGFiZWw0MDQ1ODY1NTg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:community%20support", "name": "stat:community support", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "drpngx", "id": 20959853, "node_id": "MDQ6VXNlcjIwOTU5ODUz", "avatar_url": "https://avatars1.githubusercontent.com/u/20959853?v=4", "gravatar_id": "", "url": "https://api.github.com/users/drpngx", "html_url": "https://github.com/drpngx", "followers_url": "https://api.github.com/users/drpngx/followers", "following_url": "https://api.github.com/users/drpngx/following{/other_user}", "gists_url": "https://api.github.com/users/drpngx/gists{/gist_id}", "starred_url": "https://api.github.com/users/drpngx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/drpngx/subscriptions", "organizations_url": "https://api.github.com/users/drpngx/orgs", "repos_url": "https://api.github.com/users/drpngx/repos", "events_url": "https://api.github.com/users/drpngx/events{/privacy}", "received_events_url": "https://api.github.com/users/drpngx/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "drpngx", "id": 20959853, "node_id": "MDQ6VXNlcjIwOTU5ODUz", "avatar_url": "https://avatars1.githubusercontent.com/u/20959853?v=4", "gravatar_id": "", "url": "https://api.github.com/users/drpngx", "html_url": "https://github.com/drpngx", "followers_url": "https://api.github.com/users/drpngx/followers", "following_url": "https://api.github.com/users/drpngx/following{/other_user}", "gists_url": "https://api.github.com/users/drpngx/gists{/gist_id}", "starred_url": "https://api.github.com/users/drpngx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/drpngx/subscriptions", "organizations_url": "https://api.github.com/users/drpngx/orgs", "repos_url": "https://api.github.com/users/drpngx/repos", "events_url": "https://api.github.com/users/drpngx/events{/privacy}", "received_events_url": "https://api.github.com/users/drpngx/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2017-04-24T08:26:04Z", "updated_at": "2017-06-16T21:41:11Z", "closed_at": "2017-06-16T21:41:11Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Please go to Stack Overflow for help and support.<br>\n<a href=\"http://stackoverflow.com/questions/tagged/tensorflow\" rel=\"nofollow\">http://stackoverflow.com/questions/tagged/tensorflow</a></p>\n<p>If you open a GitHub issue, here is our policy:</p>\n<ol>\n<li>It must be a bug or a feature request.</li>\n<li>The form below must be filled out.</li>\n</ol>\n<p><strong>Here's why we have that policy</strong>: TensorFlow developers respond to issues.<br>\nWe want to focus on work that benefits the whole community, e.g., fixing<br>\nbugs and adding features. Support only helps individuals. GitHub also notifies<br>\nthousands of people when issues are filed. We want them to see you communicating<br>\nan interesting problem, rather than being redirected to Stack Overflow.</p>\n<hr>\n<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:<br>\nNo</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nUbuntu 16.04 ppc64le</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>:<br>\nFrom source</li>\n<li><strong>TensorFlow version (use command below)</strong>:<br>\n'v1.0.1-0-ge895d5c-dirty'</li>\n<li><strong>Bazel version (if compiling from source)</strong>:<br>\nBuild label: 0.4.4-2017-04-13 (@80a07b5)</li>\n<li><strong>CUDA/cuDNN version</strong>:<br>\nNo GPU</li>\n<li><strong>GPU model and memory</strong>:<br>\nNo GPU</li>\n<li><strong>Exact command to reproduce</strong>:<br>\nbazel test //tensorflow/compiler/tests:pooling_ops_test_cpu<br>\nYou can collect some of this information using our environment capture script:<br>\n<a href=\"https://github.com/tensorflow/tensorflow/tree/master/tools/tf_env_collect.sh\">https://github.com/tensorflow/tensorflow/tree/master/tools/tf_env_collect.sh</a></li>\n</ul>\n<p>You can collect the TensorFlow version with</p>\n<div class=\"highlight highlight-source-shell\"><pre>python -c <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>import tensorflow as tf; print (tf.GIT_VERSION, tf.VERSION)<span class=\"pl-pds\">\"</span></span></pre></div>\n<h3>Describe the problem</h3>\n<p>pooling_ops_test_cpu <strong>fails on ppc64le</strong>, the test failing is <strong>testAvgPoolSamePadding</strong></p>\n<p>I am making an attempt to root cause the issue, need some help with understanding the code flow (i am new to tensorflow code but interested/would-like-to debug &amp; help <g-emoji class=\"g-emoji\" alias=\"smile\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f604.png\">\ud83d\ude04</g-emoji> )</p>\n<p>First i tried to understand the input parameters being passed to the avg_pool function (this is after understanding what avg_pool does)</p>\n<p>The input tensor for this test case is<br>\n[[[1 2 3],[4 5 6],[7 8 9],[10 11 12],[13 14 15],[16 17 18]]]   (4-d tensor)</p>\n<p>The test expects avg_pool o/p as [  7. ,   8. ,   9. ,  11.5,  12.5,  13.5] but gets [  7. ,   8. ,   9. ,  11.5,   9. ,  13.5] (4th entry is different)</p>\n<p>Then i tried to trace the code to see why the entry differs (only for ppc64le, x86 the test passes)</p>\n<p>Test case calls avg_pool in python/ops/nn_ops.py, which ultimately drops into core/kernels/avgpooling_op.cc. The AvgPoolingOp class \"compute\" func calls SpatialAvgPool which i tried to find/grep, could find it in core/kernels/eigen_pooling.h.</p>\n<p>This is where i am getting lost. I am suspecting an int overflow or sign type issue and my goal is to pinpoint the exact location where this could be happening, however seeing the code in avgpooling_op.cc (or eigen_pooling.h) i cant seem to find any good places where i can debug further<br>\nAny help or pointers where i can go from here (or if i am following the right trail) would help</p>\n<p>Thanks!<br>\nVaibhav</p>\n<h3>Source code / logs</h3>\n<p>Include any logs or source code that would be helpful to diagnose the problem.<br>\nIf including tracebacks, please include the full traceback. Large logs and files<br>\nshould be attached. Try to provide a reproducible test case that is the minimum<br>\nnecessary to generate the problem.</p>\n<p>Failure assertion snippet</p>\n<h2>exec ${PAGER:-/usr/bin/less} \"$0\" || exit 1</h2>\n<h1>I tensorflow/compiler/xla/service/platform_util.cc:58] platform Host present with 16 visible devices<br>\nI tensorflow/compiler/xla/service/service.cc:180] XLA service executing computations on platform Host. Devices:<br>\nI tensorflow/compiler/xla/service/service.cc:187]   StreamExecutor device (0): , <br>\nF.</h1>\n<h2>FAIL: testAvgPoolSamePadding (<strong>main</strong>.PoolingTest)</h2>\n<p>File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/compiler/tests/pooling_ops_test.py\", line 288, in testAvgPoolSamePadding<br>\nexpected=expected_output)<br>\nFile \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/compiler/tests/pooling_ops_test.py\", line 125, in _VerifyValues<br>\ndata_format, expected)<br>\nFile \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/compiler/tests/pooling_ops_test.py\", line 108, in _VerifyOneTest<br>\nself.assertAllClose(expected, actual.flatten(), rtol=1e-5, atol=1e-6)<br>\nFile \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 485, in assertAllClose<br>\nnp.testing.assert_allclose(a, b, rtol=rtol, atol=atol)<br>\nFile \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 1411, in assert_allclose<br>\nverbose=verbose, header=header, equal_nan=equal_nan)<br>\nFile \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 796, in assert_array_compare<br>\nraise AssertionError(msg)<br>\nAssertionError:<br>\nNot equal to tolerance rtol=1e-05, atol=1e-06</p>\n<p>(mismatch 16.6666666667%)<br>\nx: array([  7. ,   8. ,   9. ,  11.5,  12.5,  13.5])<br>\ny: array([  7. ,   8. ,   9. ,  11.5,   9. ,  13.5], dtype=float32)</p>\n<hr>\n<p>Ran 2 tests in 0.514s</p>", "body_text": "Please go to Stack Overflow for help and support.\nhttp://stackoverflow.com/questions/tagged/tensorflow\nIf you open a GitHub issue, here is our policy:\n\nIt must be a bug or a feature request.\nThe form below must be filled out.\n\nHere's why we have that policy: TensorFlow developers respond to issues.\nWe want to focus on work that benefits the whole community, e.g., fixing\nbugs and adding features. Support only helps individuals. GitHub also notifies\nthousands of people when issues are filed. We want them to see you communicating\nan interesting problem, rather than being redirected to Stack Overflow.\n\nSystem information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nNo\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nUbuntu 16.04 ppc64le\nTensorFlow installed from (source or binary):\nFrom source\nTensorFlow version (use command below):\n'v1.0.1-0-ge895d5c-dirty'\nBazel version (if compiling from source):\nBuild label: 0.4.4-2017-04-13 (@80a07b5)\nCUDA/cuDNN version:\nNo GPU\nGPU model and memory:\nNo GPU\nExact command to reproduce:\nbazel test //tensorflow/compiler/tests:pooling_ops_test_cpu\nYou can collect some of this information using our environment capture script:\nhttps://github.com/tensorflow/tensorflow/tree/master/tools/tf_env_collect.sh\n\nYou can collect the TensorFlow version with\npython -c \"import tensorflow as tf; print (tf.GIT_VERSION, tf.VERSION)\"\nDescribe the problem\npooling_ops_test_cpu fails on ppc64le, the test failing is testAvgPoolSamePadding\nI am making an attempt to root cause the issue, need some help with understanding the code flow (i am new to tensorflow code but interested/would-like-to debug & help \ud83d\ude04 )\nFirst i tried to understand the input parameters being passed to the avg_pool function (this is after understanding what avg_pool does)\nThe input tensor for this test case is\n[[[1 2 3],[4 5 6],[7 8 9],[10 11 12],[13 14 15],[16 17 18]]]   (4-d tensor)\nThe test expects avg_pool o/p as [  7. ,   8. ,   9. ,  11.5,  12.5,  13.5] but gets [  7. ,   8. ,   9. ,  11.5,   9. ,  13.5] (4th entry is different)\nThen i tried to trace the code to see why the entry differs (only for ppc64le, x86 the test passes)\nTest case calls avg_pool in python/ops/nn_ops.py, which ultimately drops into core/kernels/avgpooling_op.cc. The AvgPoolingOp class \"compute\" func calls SpatialAvgPool which i tried to find/grep, could find it in core/kernels/eigen_pooling.h.\nThis is where i am getting lost. I am suspecting an int overflow or sign type issue and my goal is to pinpoint the exact location where this could be happening, however seeing the code in avgpooling_op.cc (or eigen_pooling.h) i cant seem to find any good places where i can debug further\nAny help or pointers where i can go from here (or if i am following the right trail) would help\nThanks!\nVaibhav\nSource code / logs\nInclude any logs or source code that would be helpful to diagnose the problem.\nIf including tracebacks, please include the full traceback. Large logs and files\nshould be attached. Try to provide a reproducible test case that is the minimum\nnecessary to generate the problem.\nFailure assertion snippet\nexec ${PAGER:-/usr/bin/less} \"$0\" || exit 1\nI tensorflow/compiler/xla/service/platform_util.cc:58] platform Host present with 16 visible devices\nI tensorflow/compiler/xla/service/service.cc:180] XLA service executing computations on platform Host. Devices:\nI tensorflow/compiler/xla/service/service.cc:187]   StreamExecutor device (0): , \nF.\nFAIL: testAvgPoolSamePadding (main.PoolingTest)\nFile \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/compiler/tests/pooling_ops_test.py\", line 288, in testAvgPoolSamePadding\nexpected=expected_output)\nFile \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/compiler/tests/pooling_ops_test.py\", line 125, in _VerifyValues\ndata_format, expected)\nFile \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/compiler/tests/pooling_ops_test.py\", line 108, in _VerifyOneTest\nself.assertAllClose(expected, actual.flatten(), rtol=1e-5, atol=1e-6)\nFile \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 485, in assertAllClose\nnp.testing.assert_allclose(a, b, rtol=rtol, atol=atol)\nFile \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 1411, in assert_allclose\nverbose=verbose, header=header, equal_nan=equal_nan)\nFile \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 796, in assert_array_compare\nraise AssertionError(msg)\nAssertionError:\nNot equal to tolerance rtol=1e-05, atol=1e-06\n(mismatch 16.6666666667%)\nx: array([  7. ,   8. ,   9. ,  11.5,  12.5,  13.5])\ny: array([  7. ,   8. ,   9. ,  11.5,   9. ,  13.5], dtype=float32)\n\nRan 2 tests in 0.514s", "body": "Please go to Stack Overflow for help and support.\r\nhttp://stackoverflow.com/questions/tagged/tensorflow\r\n\r\nIf you open a GitHub issue, here is our policy:\r\n\r\n1. It must be a bug or a feature request.\r\n2. The form below must be filled out.\r\n\r\n**Here's why we have that policy**: TensorFlow developers respond to issues.\r\nWe want to focus on work that benefits the whole community, e.g., fixing\r\nbugs and adding features. Support only helps individuals. GitHub also notifies\r\nthousands of people when issues are filed. We want them to see you communicating\r\nan interesting problem, rather than being redirected to Stack Overflow.\r\n\r\n------------------------\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\n  No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\n  Ubuntu 16.04 ppc64le\r\n- **TensorFlow installed from (source or binary)**:\r\n  From source\r\n- **TensorFlow version (use command below)**:\r\n  'v1.0.1-0-ge895d5c-dirty'\r\n- **Bazel version (if compiling from source)**:\r\n  Build label: 0.4.4-2017-04-13 (@80a07b5)\r\n- **CUDA/cuDNN version**:\r\n  No GPU\r\n- **GPU model and memory**:\r\n  No GPU\r\n- **Exact command to reproduce**:\r\n  bazel test //tensorflow/compiler/tests:pooling_ops_test_cpu\r\nYou can collect some of this information using our environment capture script:\r\nhttps://github.com/tensorflow/tensorflow/tree/master/tools/tf_env_collect.sh\r\n\r\nYou can collect the TensorFlow version with\r\n```sh\r\npython -c \"import tensorflow as tf; print (tf.GIT_VERSION, tf.VERSION)\"\r\n```\r\n\r\n### Describe the problem\r\npooling_ops_test_cpu **fails on ppc64le**, the test failing is **testAvgPoolSamePadding**\r\n\r\nI am making an attempt to root cause the issue, need some help with understanding the code flow (i am new to tensorflow code but interested/would-like-to debug & help :smile: )\r\n\r\nFirst i tried to understand the input parameters being passed to the avg_pool function (this is after understanding what avg_pool does)\r\n\r\nThe input tensor for this test case is \r\n[[[1 2 3],[4 5 6],[7 8 9],[10 11 12],[13 14 15],[16 17 18]]]   (4-d tensor)\r\n\r\nThe test expects avg_pool o/p as [  7. ,   8. ,   9. ,  11.5,  12.5,  13.5] but gets [  7. ,   8. ,   9. ,  11.5,   9. ,  13.5] (4th entry is different)\r\n\r\nThen i tried to trace the code to see why the entry differs (only for ppc64le, x86 the test passes)\r\n\r\nTest case calls avg_pool in python/ops/nn_ops.py, which ultimately drops into core/kernels/avgpooling_op.cc. The AvgPoolingOp class \"compute\" func calls SpatialAvgPool which i tried to find/grep, could find it in core/kernels/eigen_pooling.h. \r\n\r\nThis is where i am getting lost. I am suspecting an int overflow or sign type issue and my goal is to pinpoint the exact location where this could be happening, however seeing the code in avgpooling_op.cc (or eigen_pooling.h) i cant seem to find any good places where i can debug further\r\nAny help or pointers where i can go from here (or if i am following the right trail) would help\r\n\r\nThanks!\r\nVaibhav\r\n\r\n\r\n### Source code / logs\r\nInclude any logs or source code that would be helpful to diagnose the problem.\r\nIf including tracebacks, please include the full traceback. Large logs and files\r\nshould be attached. Try to provide a reproducible test case that is the minimum\r\nnecessary to generate the problem.\r\n\r\nFailure assertion snippet\r\n\r\nexec ${PAGER:-/usr/bin/less} \"$0\" || exit 1\r\n-----------------------------------------------------------------------------\r\nI tensorflow/compiler/xla/service/platform_util.cc:58] platform Host present with 16 visible devices\r\nI tensorflow/compiler/xla/service/service.cc:180] XLA service executing computations on platform Host. Devices:\r\nI tensorflow/compiler/xla/service/service.cc:187]   StreamExecutor device (0): <undefined>, <undefined>\r\nF.\r\n======================================================================\r\nFAIL: testAvgPoolSamePadding (__main__.PoolingTest)\r\n----------------------------------------------------------------------\r\n  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/compiler/tests/pooling_ops_test.py\", line 288, in testAvgPoolSamePadding\r\n    expected=expected_output)\r\n  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/compiler/tests/pooling_ops_test.py\", line 125, in _VerifyValues\r\n    data_format, expected)\r\n  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/compiler/tests/pooling_ops_test.py\", line 108, in _VerifyOneTest\r\n    self.assertAllClose(expected, actual.flatten(), rtol=1e-5, atol=1e-6)\r\n  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 485, in assertAllClose\r\n    np.testing.assert_allclose(a, b, rtol=rtol, atol=atol)\r\n  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 1411, in assert_allclose\r\n    verbose=verbose, header=header, equal_nan=equal_nan)\r\n  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 796, in assert_array_compare\r\n    raise AssertionError(msg)\r\nAssertionError:\r\nNot equal to tolerance rtol=1e-05, atol=1e-06\r\n\r\n(mismatch 16.6666666667%)\r\n x: array([  7. ,   8. ,   9. ,  11.5,  12.5,  13.5])\r\n y: array([  7. ,   8. ,   9. ,  11.5,   9. ,  13.5], dtype=float32)\r\n\r\n----------------------------------------------------------------------\r\nRan 2 tests in 0.514s\r\n"}