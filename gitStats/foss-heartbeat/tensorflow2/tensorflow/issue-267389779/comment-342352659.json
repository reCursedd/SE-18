{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/342352659", "html_url": "https://github.com/tensorflow/tensorflow/issues/13880#issuecomment-342352659", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13880", "id": 342352659, "node_id": "MDEyOklzc3VlQ29tbWVudDM0MjM1MjY1OQ==", "user": {"login": "skye", "id": 88808, "node_id": "MDQ6VXNlcjg4ODA4", "avatar_url": "https://avatars1.githubusercontent.com/u/88808?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skye", "html_url": "https://github.com/skye", "followers_url": "https://api.github.com/users/skye/followers", "following_url": "https://api.github.com/users/skye/following{/other_user}", "gists_url": "https://api.github.com/users/skye/gists{/gist_id}", "starred_url": "https://api.github.com/users/skye/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skye/subscriptions", "organizations_url": "https://api.github.com/users/skye/orgs", "repos_url": "https://api.github.com/users/skye/repos", "events_url": "https://api.github.com/users/skye/events{/privacy}", "received_events_url": "https://api.github.com/users/skye/received_events", "type": "User", "site_admin": false}, "created_at": "2017-11-07T02:09:03Z", "updated_at": "2017-11-07T02:09:03Z", "author_association": "MEMBER", "body_html": "<p>I think I figured it out... under the hood, this code is creating colocated graph operations, including the variables. The problem is that when <code>place_pruned_graph = True</code> (which InteractiveSession sets), the variable initialization run() call places a Variable op on the GPU (since it doesn't see any of the pruned colocated ops). Then when you try to run the train_op, it \"realizes\" all the colocated ops must be run on CPU due to a missing GPU kernel, but it's too late since the Variable op was already placed on the GPU.</p>\n<p>Unfortunately there isn't a great fix for this... for now, I suggest either using a regular Session, or explicitly setting <code>place_pruned_graph=False</code> in your ConfigProto. Alternatively, you could try out Eager instead of using a session at all :)</p>\n<p>I'll keep this issue open, but unfortunately I don't think there will be an actual fix anytime soon.</p>", "body_text": "I think I figured it out... under the hood, this code is creating colocated graph operations, including the variables. The problem is that when place_pruned_graph = True (which InteractiveSession sets), the variable initialization run() call places a Variable op on the GPU (since it doesn't see any of the pruned colocated ops). Then when you try to run the train_op, it \"realizes\" all the colocated ops must be run on CPU due to a missing GPU kernel, but it's too late since the Variable op was already placed on the GPU.\nUnfortunately there isn't a great fix for this... for now, I suggest either using a regular Session, or explicitly setting place_pruned_graph=False in your ConfigProto. Alternatively, you could try out Eager instead of using a session at all :)\nI'll keep this issue open, but unfortunately I don't think there will be an actual fix anytime soon.", "body": "I think I figured it out... under the hood, this code is creating colocated graph operations, including the variables. The problem is that when `place_pruned_graph = True` (which InteractiveSession sets), the variable initialization run() call places a Variable op on the GPU (since it doesn't see any of the pruned colocated ops). Then when you try to run the train_op, it \"realizes\" all the colocated ops must be run on CPU due to a missing GPU kernel, but it's too late since the Variable op was already placed on the GPU.\r\n\r\nUnfortunately there isn't a great fix for this... for now, I suggest either using a regular Session, or explicitly setting `place_pruned_graph=False` in your ConfigProto. Alternatively, you could try out Eager instead of using a session at all :)\r\n\r\nI'll keep this issue open, but unfortunately I don't think there will be an actual fix anytime soon."}