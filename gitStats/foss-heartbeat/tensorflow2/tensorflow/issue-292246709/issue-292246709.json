{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16526", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16526/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16526/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16526/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/16526", "id": 292246709, "node_id": "MDU6SXNzdWUyOTIyNDY3MDk=", "number": 16526, "title": "TF1.5 configure overwrites export TF_CUDA_VERSION=9.1", "user": {"login": "ahundt", "id": 55744, "node_id": "MDQ6VXNlcjU1NzQ0", "avatar_url": "https://avatars1.githubusercontent.com/u/55744?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ahundt", "html_url": "https://github.com/ahundt", "followers_url": "https://api.github.com/users/ahundt/followers", "following_url": "https://api.github.com/users/ahundt/following{/other_user}", "gists_url": "https://api.github.com/users/ahundt/gists{/gist_id}", "starred_url": "https://api.github.com/users/ahundt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ahundt/subscriptions", "organizations_url": "https://api.github.com/users/ahundt/orgs", "repos_url": "https://api.github.com/users/ahundt/repos", "events_url": "https://api.github.com/users/ahundt/events{/privacy}", "received_events_url": "https://api.github.com/users/ahundt/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": {"login": "case540", "id": 1299636, "node_id": "MDQ6VXNlcjEyOTk2MzY=", "avatar_url": "https://avatars2.githubusercontent.com/u/1299636?v=4", "gravatar_id": "", "url": "https://api.github.com/users/case540", "html_url": "https://github.com/case540", "followers_url": "https://api.github.com/users/case540/followers", "following_url": "https://api.github.com/users/case540/following{/other_user}", "gists_url": "https://api.github.com/users/case540/gists{/gist_id}", "starred_url": "https://api.github.com/users/case540/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/case540/subscriptions", "organizations_url": "https://api.github.com/users/case540/orgs", "repos_url": "https://api.github.com/users/case540/repos", "events_url": "https://api.github.com/users/case540/events{/privacy}", "received_events_url": "https://api.github.com/users/case540/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "case540", "id": 1299636, "node_id": "MDQ6VXNlcjEyOTk2MzY=", "avatar_url": "https://avatars2.githubusercontent.com/u/1299636?v=4", "gravatar_id": "", "url": "https://api.github.com/users/case540", "html_url": "https://github.com/case540", "followers_url": "https://api.github.com/users/case540/followers", "following_url": "https://api.github.com/users/case540/following{/other_user}", "gists_url": "https://api.github.com/users/case540/gists{/gist_id}", "starred_url": "https://api.github.com/users/case540/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/case540/subscriptions", "organizations_url": "https://api.github.com/users/case540/orgs", "repos_url": "https://api.github.com/users/case540/repos", "events_url": "https://api.github.com/users/case540/events{/privacy}", "received_events_url": "https://api.github.com/users/case540/received_events", "type": "User", "site_admin": false}, {"login": "gunan", "id": 7946809, "node_id": "MDQ6VXNlcjc5NDY4MDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/7946809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gunan", "html_url": "https://github.com/gunan", "followers_url": "https://api.github.com/users/gunan/followers", "following_url": "https://api.github.com/users/gunan/following{/other_user}", "gists_url": "https://api.github.com/users/gunan/gists{/gist_id}", "starred_url": "https://api.github.com/users/gunan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gunan/subscriptions", "organizations_url": "https://api.github.com/users/gunan/orgs", "repos_url": "https://api.github.com/users/gunan/repos", "events_url": "https://api.github.com/users/gunan/events{/privacy}", "received_events_url": "https://api.github.com/users/gunan/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 10, "created_at": "2018-01-28T22:44:52Z", "updated_at": "2018-11-22T18:53:51Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>It seems <code>configure</code> overwrites the BASH flag:</p>\n<div class=\"highlight highlight-source-shell\"><pre><span class=\"pl-k\">export</span> TF_CUDA_VERSION=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>9.1<span class=\"pl-pds\">\"</span></span></pre></div>\n<p>Here is the 1.5 branch of my <a href=\"https://github.com/ahundt/robotics_setup/blob/tf-1.5/tensorflow.sh\">tensorflow.sh</a> install script.</p>\n<p>Here are the key code lines from the <a href=\"https://github.com/ahundt/robotics_setup/blob/8a7940f74945f09d2a6bfc1a08d06f156a4c79f9/tensorflow.sh\">tensorflow.sh specific hash to reproduce this error</a> install script,  and 161 at the time of writing:</p>\n<pre><code>    # line 134 at the time of writing\n    export TF_NEED_CUDA=1\n    export TF_CUDA_VERSION=\"9.1\"\n    export TF_CUDNN_VERSION=7\n    export CUDA_TOOLKIT_PATH=/usr/local/cuda-9.1/targets/x86_64-linux/lib/\n    # ...snip... to line 161 at the time of writing\n    yes \"\" | ./configure\n</code></pre>\n<p>I believe the problem is either in the <code>configure</code> script, <a href=\"https://github.com/tensorflow/tensorflow/blob/r1.5/configure.py#L805\">configure.py set_tf_cuda_version() ask_cuda_version</a> or in the call to <a href=\"https://github.com/tensorflow/tensorflow/blob/r1.5/configure.py#L1320\">set_tf_cuda_version</a>, none of which seem to check the environment variable first and possibly overwrite it.</p>\n<p>The result is the following error:</p>\n<pre><code>Invalid path to CUDA 9.0 toolkit. /usr/local/cuda/lib64/libcudart.so.9.0 cannot be found\nPlease specify the CUDA SDK version you want to use, e.g. 7.0. [Leave empty to default to CUDA 9.0]:\n\nPlease specify the location where CUDA 9.0 toolkit is installed. Refer to README.md for more details. [Default is /usr/local/cuda]:\n\nInvalid path to CUDA 9.0 toolkit. /usr/local/cuda/lib64/libcudart.so.9.0 cannot be found\nTraceback (most recent call last):\n  File \"configure.py\", line 1365, in &lt;module&gt;\n    main()\n  File \"configure.py\", line 1320, in main\n    set_tf_cuda_version(environ_cp)\n  File \"configure.py\", line 850, in set_tf_cuda_version\n    _DEFAULT_PROMPT_ASK_ATTEMPTS)\n__main__.UserInputError: Invalid TF_CUDA_SETTING setting was provided 10 times in a row. Assuming to be a scripting mistake.\n-&gt; [1]\nahundt@femur|~/src/robotics_setup on tf-1.5!?\n\u00b1 ls /usr/local/cuda/lib64/\nstubs                  libcusparse.so.9.1     libnppist.so.9.1\nlibaccinj64.so         libcusparse.so.9.1.85  libnppist.so.9.1.85\nlibaccinj64.so.9.1     libcusparse_static.a   libnppist_static.a\nlibaccinj64.so.9.1.85  libnppc.so             libnppisu.so\nlibcublas_device.a     libnppc.so.9.1         libnppisu.so.9.1\nlibcublas.so           libnppc.so.9.1.85      libnppisu.so.9.1.85\nlibcublas.so.9.1       libnppc_static.a       libnppisu_static.a\nlibcublas.so.9.1.128   libnppial.so           libnppitc.so\nlibcublas.so.9.1.85    libnppial.so.9.1       libnppitc.so.9.1\nlibcublas_static.a     libnppial.so.9.1.85    libnppitc.so.9.1.85\nlibcudadevrt.a         libnppial_static.a     libnppitc_static.a\nlibcudart.so           libnppicc.so           libnpps.so\nlibcudart.so.9.1       libnppicc.so.9.1       libnpps.so.9.1\nlibcudart.so.9.1.85    libnppicc.so.9.1.85    libnpps.so.9.1.85\nlibcudart_static.a     libnppicc_static.a     libnpps_static.a\nlibcufft.so            libnppicom.so          libnvblas.so\nlibcufft.so.9.1        libnppicom.so.9.1      libnvblas.so.9.1\nlibcufft.so.9.1.85     libnppicom.so.9.1.85   libnvblas.so.9.1.128\nlibcufft_static.a      libnppicom_static.a    libnvblas.so.9.1.85\nlibcufftw.so           libnppidei.so          libnvgraph.so\nlibcufftw.so.9.1       libnppidei.so.9.1      libnvgraph.so.9.1\nlibcufftw.so.9.1.85    libnppidei.so.9.1.85   libnvgraph.so.9.1.85\nlibcufftw_static.a     libnppidei_static.a    libnvgraph_static.a\nlibcuinj64.so          libnppif.so            libnvrtc-builtins.so\nlibcuinj64.so.9.1      libnppif.so.9.1        libnvrtc-builtins.so.9.1\nlibcuinj64.so.9.1.85   libnppif.so.9.1.85     libnvrtc-builtins.so.9.1.85\nlibculibos.a           libnppif_static.a      libnvrtc.so\nlibcurand.so           libnppig.so            libnvrtc.so.9.1\nlibcurand.so.9.1       libnppig.so.9.1        libnvrtc.so.9.1.85\nlibcurand.so.9.1.85    libnppig.so.9.1.85     libnvToolsExt.so\nlibcurand_static.a     libnppig_static.a      libnvToolsExt.so.1\nlibcusolver.so         libnppim.so            libnvToolsExt.so.1.0.0\nlibcusolver.so.9.1     libnppim.so.9.1        libOpenCL.so\nlibcusolver.so.9.1.85  libnppim.so.9.1.85     libOpenCL.so.1\nlibcusolver_static.a   libnppim_static.a      libOpenCL.so.1.0\nlibcusparse.so         libnppist.so           libOpenCL.so.1.0.0\n</code></pre>", "body_text": "It seems configure overwrites the BASH flag:\nexport TF_CUDA_VERSION=\"9.1\"\nHere is the 1.5 branch of my tensorflow.sh install script.\nHere are the key code lines from the tensorflow.sh specific hash to reproduce this error install script,  and 161 at the time of writing:\n    # line 134 at the time of writing\n    export TF_NEED_CUDA=1\n    export TF_CUDA_VERSION=\"9.1\"\n    export TF_CUDNN_VERSION=7\n    export CUDA_TOOLKIT_PATH=/usr/local/cuda-9.1/targets/x86_64-linux/lib/\n    # ...snip... to line 161 at the time of writing\n    yes \"\" | ./configure\n\nI believe the problem is either in the configure script, configure.py set_tf_cuda_version() ask_cuda_version or in the call to set_tf_cuda_version, none of which seem to check the environment variable first and possibly overwrite it.\nThe result is the following error:\nInvalid path to CUDA 9.0 toolkit. /usr/local/cuda/lib64/libcudart.so.9.0 cannot be found\nPlease specify the CUDA SDK version you want to use, e.g. 7.0. [Leave empty to default to CUDA 9.0]:\n\nPlease specify the location where CUDA 9.0 toolkit is installed. Refer to README.md for more details. [Default is /usr/local/cuda]:\n\nInvalid path to CUDA 9.0 toolkit. /usr/local/cuda/lib64/libcudart.so.9.0 cannot be found\nTraceback (most recent call last):\n  File \"configure.py\", line 1365, in <module>\n    main()\n  File \"configure.py\", line 1320, in main\n    set_tf_cuda_version(environ_cp)\n  File \"configure.py\", line 850, in set_tf_cuda_version\n    _DEFAULT_PROMPT_ASK_ATTEMPTS)\n__main__.UserInputError: Invalid TF_CUDA_SETTING setting was provided 10 times in a row. Assuming to be a scripting mistake.\n-> [1]\nahundt@femur|~/src/robotics_setup on tf-1.5!?\n\u00b1 ls /usr/local/cuda/lib64/\nstubs                  libcusparse.so.9.1     libnppist.so.9.1\nlibaccinj64.so         libcusparse.so.9.1.85  libnppist.so.9.1.85\nlibaccinj64.so.9.1     libcusparse_static.a   libnppist_static.a\nlibaccinj64.so.9.1.85  libnppc.so             libnppisu.so\nlibcublas_device.a     libnppc.so.9.1         libnppisu.so.9.1\nlibcublas.so           libnppc.so.9.1.85      libnppisu.so.9.1.85\nlibcublas.so.9.1       libnppc_static.a       libnppisu_static.a\nlibcublas.so.9.1.128   libnppial.so           libnppitc.so\nlibcublas.so.9.1.85    libnppial.so.9.1       libnppitc.so.9.1\nlibcublas_static.a     libnppial.so.9.1.85    libnppitc.so.9.1.85\nlibcudadevrt.a         libnppial_static.a     libnppitc_static.a\nlibcudart.so           libnppicc.so           libnpps.so\nlibcudart.so.9.1       libnppicc.so.9.1       libnpps.so.9.1\nlibcudart.so.9.1.85    libnppicc.so.9.1.85    libnpps.so.9.1.85\nlibcudart_static.a     libnppicc_static.a     libnpps_static.a\nlibcufft.so            libnppicom.so          libnvblas.so\nlibcufft.so.9.1        libnppicom.so.9.1      libnvblas.so.9.1\nlibcufft.so.9.1.85     libnppicom.so.9.1.85   libnvblas.so.9.1.128\nlibcufft_static.a      libnppicom_static.a    libnvblas.so.9.1.85\nlibcufftw.so           libnppidei.so          libnvgraph.so\nlibcufftw.so.9.1       libnppidei.so.9.1      libnvgraph.so.9.1\nlibcufftw.so.9.1.85    libnppidei.so.9.1.85   libnvgraph.so.9.1.85\nlibcufftw_static.a     libnppidei_static.a    libnvgraph_static.a\nlibcuinj64.so          libnppif.so            libnvrtc-builtins.so\nlibcuinj64.so.9.1      libnppif.so.9.1        libnvrtc-builtins.so.9.1\nlibcuinj64.so.9.1.85   libnppif.so.9.1.85     libnvrtc-builtins.so.9.1.85\nlibculibos.a           libnppif_static.a      libnvrtc.so\nlibcurand.so           libnppig.so            libnvrtc.so.9.1\nlibcurand.so.9.1       libnppig.so.9.1        libnvrtc.so.9.1.85\nlibcurand.so.9.1.85    libnppig.so.9.1.85     libnvToolsExt.so\nlibcurand_static.a     libnppig_static.a      libnvToolsExt.so.1\nlibcusolver.so         libnppim.so            libnvToolsExt.so.1.0.0\nlibcusolver.so.9.1     libnppim.so.9.1        libOpenCL.so\nlibcusolver.so.9.1.85  libnppim.so.9.1.85     libOpenCL.so.1\nlibcusolver_static.a   libnppim_static.a      libOpenCL.so.1.0\nlibcusparse.so         libnppist.so           libOpenCL.so.1.0.0", "body": "It seems `configure` overwrites the BASH flag:\r\n```bash\r\nexport TF_CUDA_VERSION=\"9.1\"\r\n```\r\nHere is the 1.5 branch of my [tensorflow.sh](https://github.com/ahundt/robotics_setup/blob/tf-1.5/tensorflow.sh) install script.\r\n\r\nHere are the key code lines from the [tensorflow.sh specific hash to reproduce this error](https://github.com/ahundt/robotics_setup/blob/8a7940f74945f09d2a6bfc1a08d06f156a4c79f9/tensorflow.sh) install script,  and 161 at the time of writing:\r\n```\r\n    # line 134 at the time of writing\r\n    export TF_NEED_CUDA=1\r\n    export TF_CUDA_VERSION=\"9.1\"\r\n    export TF_CUDNN_VERSION=7\r\n    export CUDA_TOOLKIT_PATH=/usr/local/cuda-9.1/targets/x86_64-linux/lib/\r\n    # ...snip... to line 161 at the time of writing\r\n    yes \"\" | ./configure\r\n```\r\n\r\nI believe the problem is either in the `configure` script, [configure.py set_tf_cuda_version() ask_cuda_version](https://github.com/tensorflow/tensorflow/blob/r1.5/configure.py#L805) or in the call to [set_tf_cuda_version](https://github.com/tensorflow/tensorflow/blob/r1.5/configure.py#L1320), none of which seem to check the environment variable first and possibly overwrite it.\r\n\r\nThe result is the following error:\r\n```\r\nInvalid path to CUDA 9.0 toolkit. /usr/local/cuda/lib64/libcudart.so.9.0 cannot be found\r\nPlease specify the CUDA SDK version you want to use, e.g. 7.0. [Leave empty to default to CUDA 9.0]:\r\n\r\nPlease specify the location where CUDA 9.0 toolkit is installed. Refer to README.md for more details. [Default is /usr/local/cuda]:\r\n\r\nInvalid path to CUDA 9.0 toolkit. /usr/local/cuda/lib64/libcudart.so.9.0 cannot be found\r\nTraceback (most recent call last):\r\n  File \"configure.py\", line 1365, in <module>\r\n    main()\r\n  File \"configure.py\", line 1320, in main\r\n    set_tf_cuda_version(environ_cp)\r\n  File \"configure.py\", line 850, in set_tf_cuda_version\r\n    _DEFAULT_PROMPT_ASK_ATTEMPTS)\r\n__main__.UserInputError: Invalid TF_CUDA_SETTING setting was provided 10 times in a row. Assuming to be a scripting mistake.\r\n-> [1]\r\nahundt@femur|~/src/robotics_setup on tf-1.5!?\r\n\u00b1 ls /usr/local/cuda/lib64/\r\nstubs                  libcusparse.so.9.1     libnppist.so.9.1\r\nlibaccinj64.so         libcusparse.so.9.1.85  libnppist.so.9.1.85\r\nlibaccinj64.so.9.1     libcusparse_static.a   libnppist_static.a\r\nlibaccinj64.so.9.1.85  libnppc.so             libnppisu.so\r\nlibcublas_device.a     libnppc.so.9.1         libnppisu.so.9.1\r\nlibcublas.so           libnppc.so.9.1.85      libnppisu.so.9.1.85\r\nlibcublas.so.9.1       libnppc_static.a       libnppisu_static.a\r\nlibcublas.so.9.1.128   libnppial.so           libnppitc.so\r\nlibcublas.so.9.1.85    libnppial.so.9.1       libnppitc.so.9.1\r\nlibcublas_static.a     libnppial.so.9.1.85    libnppitc.so.9.1.85\r\nlibcudadevrt.a         libnppial_static.a     libnppitc_static.a\r\nlibcudart.so           libnppicc.so           libnpps.so\r\nlibcudart.so.9.1       libnppicc.so.9.1       libnpps.so.9.1\r\nlibcudart.so.9.1.85    libnppicc.so.9.1.85    libnpps.so.9.1.85\r\nlibcudart_static.a     libnppicc_static.a     libnpps_static.a\r\nlibcufft.so            libnppicom.so          libnvblas.so\r\nlibcufft.so.9.1        libnppicom.so.9.1      libnvblas.so.9.1\r\nlibcufft.so.9.1.85     libnppicom.so.9.1.85   libnvblas.so.9.1.128\r\nlibcufft_static.a      libnppicom_static.a    libnvblas.so.9.1.85\r\nlibcufftw.so           libnppidei.so          libnvgraph.so\r\nlibcufftw.so.9.1       libnppidei.so.9.1      libnvgraph.so.9.1\r\nlibcufftw.so.9.1.85    libnppidei.so.9.1.85   libnvgraph.so.9.1.85\r\nlibcufftw_static.a     libnppidei_static.a    libnvgraph_static.a\r\nlibcuinj64.so          libnppif.so            libnvrtc-builtins.so\r\nlibcuinj64.so.9.1      libnppif.so.9.1        libnvrtc-builtins.so.9.1\r\nlibcuinj64.so.9.1.85   libnppif.so.9.1.85     libnvrtc-builtins.so.9.1.85\r\nlibculibos.a           libnppif_static.a      libnvrtc.so\r\nlibcurand.so           libnppig.so            libnvrtc.so.9.1\r\nlibcurand.so.9.1       libnppig.so.9.1        libnvrtc.so.9.1.85\r\nlibcurand.so.9.1.85    libnppig.so.9.1.85     libnvToolsExt.so\r\nlibcurand_static.a     libnppig_static.a      libnvToolsExt.so.1\r\nlibcusolver.so         libnppim.so            libnvToolsExt.so.1.0.0\r\nlibcusolver.so.9.1     libnppim.so.9.1        libOpenCL.so\r\nlibcusolver.so.9.1.85  libnppim.so.9.1.85     libOpenCL.so.1\r\nlibcusolver_static.a   libnppim_static.a      libOpenCL.so.1.0\r\nlibcusparse.so         libnppist.so           libOpenCL.so.1.0.0\r\n```"}