{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13114", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13114/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13114/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13114/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/13114", "id": 258383013, "node_id": "MDU6SXNzdWUyNTgzODMwMTM=", "number": 13114, "title": "Extremely slow first epoch.", "user": {"login": "w4-kang", "id": 19260474, "node_id": "MDQ6VXNlcjE5MjYwNDc0", "avatar_url": "https://avatars2.githubusercontent.com/u/19260474?v=4", "gravatar_id": "", "url": "https://api.github.com/users/w4-kang", "html_url": "https://github.com/w4-kang", "followers_url": "https://api.github.com/users/w4-kang/followers", "following_url": "https://api.github.com/users/w4-kang/following{/other_user}", "gists_url": "https://api.github.com/users/w4-kang/gists{/gist_id}", "starred_url": "https://api.github.com/users/w4-kang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/w4-kang/subscriptions", "organizations_url": "https://api.github.com/users/w4-kang/orgs", "repos_url": "https://api.github.com/users/w4-kang/repos", "events_url": "https://api.github.com/users/w4-kang/events{/privacy}", "received_events_url": "https://api.github.com/users/w4-kang/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586558, "node_id": "MDU6TGFiZWw0MDQ1ODY1NTg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:community%20support", "name": "stat:community support", "color": "f4b400", "default": false}, {"id": 473184161, "node_id": "MDU6TGFiZWw0NzMxODQxNjE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:support", "name": "type:support", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2017-09-18T06:48:28Z", "updated_at": "2017-10-07T00:50:16Z", "closed_at": "2017-10-07T00:50:12Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: No.</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Ubuntu 16.04.2 LTS</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: PIP, tensorflow-gpu==1.2.1</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.2.1</li>\n<li><strong>Python version</strong>: Python 3.6.2</li>\n<li><strong>CUDA/cuDNN version</strong>: CUDA Version 8.0.61 / cuDNN Version 5.1.10</li>\n<li><strong>GPU model and memory</strong>: GTX 1080ti x 2, 11171MiB each.</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>When training model, \"<strong>only First epoch after executing training script is extremely slow</strong> (More specifically, It takes 12 hours while second and third epoch after executed takes 2.5 hours with my environment and dataset)\"</p>\n<p>I uploaded this issue because similar issue in stackoverflow is not handled long time.<br>\n(<a href=\"https://stackoverflow.com/questions/44966831/tensorflow-first-epoch-is-extremely-slow-maybe-related-to-pool-allocator\" rel=\"nofollow\">https://stackoverflow.com/questions/44966831/tensorflow-first-epoch-is-extremely-slow-maybe-related-to-pool-allocator</a>)</p>\n<p>In more detail,<br>\nmy code uses model with  <strong>1d convolution layers</strong> (tf.nn.conv1d - tf.bias_add - tf.nn.relu) as model.<br>\n<strong>tf.ctc_loss</strong> as loss function.<br>\nData is served with tf.PaddingFIFOQueue &amp;&amp; tf.QueueBase.dequeue_many and \"<strong>each data has different size</strong>\".</p>\n<p>Here is what I tried,<br>\nFirst I also assumed that pool allocator makes this problem like <a href=\"https://stackoverflow.com/questions/44966831/tensorflow-first-epoch-is-extremely-slow-maybe-related-to-pool-allocator\" rel=\"nofollow\">above stackoverflow link</a> (<strong>but now I think this issue is not from pool allocator</strong>)</p>\n<ol>\n<li>Uses tcmalloc<br>\n<code>LD_PRELOAD=\"/usr/lib/libtcmalloc.so\"</code> which is suggested in <a href=\"https://groups.google.com/a/tensorflow.org/forum/#!topic/discuss/ja7FlGrvh-E\" rel=\"nofollow\">here</a></li>\n<li>Uses BFC allocator type.</li>\n</ol>\n<ul>\n<li>With <code>TF_CPU_ALLOCATOR_USE_BFC=true</code></li>\n<li>And I tried <code>tf.ConfigProto().gpu_options. allocator_type = 'BFC'</code> also.</li>\n</ul>\n<ol start=\"3\">\n<li>Build tensorflow from source with modified initial pool size limit (100 to 10000), (Which is hard coded in <a href=\"https://github.com/tensorflow/tensorflow/blob/927f811b0303e51126531c135f8b093383de2d6d/tensorflow/core/common_runtime/gpu/process_state.cc#L187\">here</a>)</li>\n</ol>\n<p>And all trying was ineffective.</p>\n<p>Except extremely slow first epoch, everything was fine. Weights of model is trained well, save and load checkpoint and continuing training or inferencing is also fine without any warning and error.</p>\n<p>Is it one of avoidable characteristic of Tensorflow or bugs?</p>\n<p>Thank you for your reading.<br>\nIf you need any more information, please notify me.</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): No.\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Ubuntu 16.04.2 LTS\nTensorFlow installed from (source or binary): PIP, tensorflow-gpu==1.2.1\nTensorFlow version (use command below): 1.2.1\nPython version: Python 3.6.2\nCUDA/cuDNN version: CUDA Version 8.0.61 / cuDNN Version 5.1.10\nGPU model and memory: GTX 1080ti x 2, 11171MiB each.\n\nDescribe the problem\nWhen training model, \"only First epoch after executing training script is extremely slow (More specifically, It takes 12 hours while second and third epoch after executed takes 2.5 hours with my environment and dataset)\"\nI uploaded this issue because similar issue in stackoverflow is not handled long time.\n(https://stackoverflow.com/questions/44966831/tensorflow-first-epoch-is-extremely-slow-maybe-related-to-pool-allocator)\nIn more detail,\nmy code uses model with  1d convolution layers (tf.nn.conv1d - tf.bias_add - tf.nn.relu) as model.\ntf.ctc_loss as loss function.\nData is served with tf.PaddingFIFOQueue && tf.QueueBase.dequeue_many and \"each data has different size\".\nHere is what I tried,\nFirst I also assumed that pool allocator makes this problem like above stackoverflow link (but now I think this issue is not from pool allocator)\n\nUses tcmalloc\nLD_PRELOAD=\"/usr/lib/libtcmalloc.so\" which is suggested in here\nUses BFC allocator type.\n\n\nWith TF_CPU_ALLOCATOR_USE_BFC=true\nAnd I tried tf.ConfigProto().gpu_options. allocator_type = 'BFC' also.\n\n\nBuild tensorflow from source with modified initial pool size limit (100 to 10000), (Which is hard coded in here)\n\nAnd all trying was ineffective.\nExcept extremely slow first epoch, everything was fine. Weights of model is trained well, save and load checkpoint and continuing training or inferencing is also fine without any warning and error.\nIs it one of avoidable characteristic of Tensorflow or bugs?\nThank you for your reading.\nIf you need any more information, please notify me.", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: No.\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Ubuntu 16.04.2 LTS\r\n- **TensorFlow installed from (source or binary)**: PIP, tensorflow-gpu==1.2.1\r\n- **TensorFlow version (use command below)**: 1.2.1\r\n- **Python version**: Python 3.6.2\r\n- **CUDA/cuDNN version**: CUDA Version 8.0.61 / cuDNN Version 5.1.10\r\n- **GPU model and memory**: GTX 1080ti x 2, 11171MiB each.\r\n\r\n### Describe the problem\r\nWhen training model, \"**only First epoch after executing training script is extremely slow** (More specifically, It takes 12 hours while second and third epoch after executed takes 2.5 hours with my environment and dataset)\"\r\n\r\nI uploaded this issue because similar issue in stackoverflow is not handled long time.\r\n(https://stackoverflow.com/questions/44966831/tensorflow-first-epoch-is-extremely-slow-maybe-related-to-pool-allocator)\r\n\r\nIn more detail,\r\nmy code uses model with  **1d convolution layers** (tf.nn.conv1d - tf.bias_add - tf.nn.relu) as model.\r\n**tf.ctc_loss** as loss function.\r\nData is served with tf.PaddingFIFOQueue && tf.QueueBase.dequeue_many and \"**each data has different size**\".\r\n\r\nHere is what I tried,\r\nFirst I also assumed that pool allocator makes this problem like [above stackoverflow link](https://stackoverflow.com/questions/44966831/tensorflow-first-epoch-is-extremely-slow-maybe-related-to-pool-allocator) (**but now I think this issue is not from pool allocator**)\r\n1. Uses tcmalloc\r\n`LD_PRELOAD=\"/usr/lib/libtcmalloc.so\"` which is suggested in [here](https://groups.google.com/a/tensorflow.org/forum/#!topic/discuss/ja7FlGrvh-E)\r\n2. Uses BFC allocator type.\r\n- With `TF_CPU_ALLOCATOR_USE_BFC=true`\r\n- And I tried `tf.ConfigProto().gpu_options. allocator_type = 'BFC'` also.\r\n3. Build tensorflow from source with modified initial pool size limit (100 to 10000), (Which is hard coded in [here](https://github.com/tensorflow/tensorflow/blob/927f811b0303e51126531c135f8b093383de2d6d/tensorflow/core/common_runtime/gpu/process_state.cc#L187)) \r\n\r\nAnd all trying was ineffective.\r\n\r\nExcept extremely slow first epoch, everything was fine. Weights of model is trained well, save and load checkpoint and continuing training or inferencing is also fine without any warning and error.\r\n\r\nIs it one of avoidable characteristic of Tensorflow or bugs?\r\n\r\nThank you for your reading.\r\nIf you need any more information, please notify me."}