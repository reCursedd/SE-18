{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15968", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15968/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15968/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15968/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15968", "id": 286977825, "node_id": "MDU6SXNzdWUyODY5Nzc4MjU=", "number": 15968, "title": "Imperfect implementation of tf.losses.mean_pairwise_squared_error", "user": {"login": "chofchof", "id": 16874885, "node_id": "MDQ6VXNlcjE2ODc0ODg1", "avatar_url": "https://avatars1.githubusercontent.com/u/16874885?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chofchof", "html_url": "https://github.com/chofchof", "followers_url": "https://api.github.com/users/chofchof/followers", "following_url": "https://api.github.com/users/chofchof/following{/other_user}", "gists_url": "https://api.github.com/users/chofchof/gists{/gist_id}", "starred_url": "https://api.github.com/users/chofchof/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chofchof/subscriptions", "organizations_url": "https://api.github.com/users/chofchof/orgs", "repos_url": "https://api.github.com/users/chofchof/repos", "events_url": "https://api.github.com/users/chofchof/events{/privacy}", "received_events_url": "https://api.github.com/users/chofchof/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "martinwicke", "id": 577277, "node_id": "MDQ6VXNlcjU3NzI3Nw==", "avatar_url": "https://avatars2.githubusercontent.com/u/577277?v=4", "gravatar_id": "", "url": "https://api.github.com/users/martinwicke", "html_url": "https://github.com/martinwicke", "followers_url": "https://api.github.com/users/martinwicke/followers", "following_url": "https://api.github.com/users/martinwicke/following{/other_user}", "gists_url": "https://api.github.com/users/martinwicke/gists{/gist_id}", "starred_url": "https://api.github.com/users/martinwicke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/martinwicke/subscriptions", "organizations_url": "https://api.github.com/users/martinwicke/orgs", "repos_url": "https://api.github.com/users/martinwicke/repos", "events_url": "https://api.github.com/users/martinwicke/events{/privacy}", "received_events_url": "https://api.github.com/users/martinwicke/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "martinwicke", "id": 577277, "node_id": "MDQ6VXNlcjU3NzI3Nw==", "avatar_url": "https://avatars2.githubusercontent.com/u/577277?v=4", "gravatar_id": "", "url": "https://api.github.com/users/martinwicke", "html_url": "https://github.com/martinwicke", "followers_url": "https://api.github.com/users/martinwicke/followers", "following_url": "https://api.github.com/users/martinwicke/following{/other_user}", "gists_url": "https://api.github.com/users/martinwicke/gists{/gist_id}", "starred_url": "https://api.github.com/users/martinwicke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/martinwicke/subscriptions", "organizations_url": "https://api.github.com/users/martinwicke/orgs", "repos_url": "https://api.github.com/users/martinwicke/repos", "events_url": "https://api.github.com/users/martinwicke/events{/privacy}", "received_events_url": "https://api.github.com/users/martinwicke/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2018-01-09T05:51:16Z", "updated_at": "2018-02-02T13:37:01Z", "closed_at": "2018-02-02T13:37:01Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>TensorFlow version</strong>: 1.4.0, 1.4.1, and 1.5.0-rc0 (checked)</li>\n<li><strong>Have I written custom code</strong>: N/A</li>\n<li><strong>OS Platform and Distribution</strong>: N/A</li>\n<li><strong>TensorFlow installed from</strong>: N/A</li>\n<li><strong>Bazel version</strong>: N/A</li>\n<li><strong>CUDA/cuDNN version</strong>: N/A</li>\n<li><strong>GPU model and memory</strong>: N/A</li>\n<li><strong>Exact command to reproduce</strong>: N/A</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>The implementation of <code>tf.losses.mean_pairwise_squared_error</code> looks imperfect.<br>\nFor example, as explained in <a href=\"https://www.tensorflow.org/api_docs/python/tf/losses/mean_pairwise_squared_error\" rel=\"nofollow\">the API reference of the function</a></p>\n<blockquote>\n<p>For example, if <code>labels</code>=[a, b, c] and <code>predictions</code>=[x, y, z], there are three pairs of differences are summed to compute the loss: loss = [ ((a-b) - (x-y)).^2 + ((a-c) - (x-z)).^2 + ((b-c) - (y-z)).^2 ] / 3</p>\n</blockquote>\n<p>let me put the following data as <code>labels</code> and <code>predictions</code>:</p>\n<pre><code>labels = tf.constant([[0., 0.5, 1.]])\npredictions = tf.constant([[1., 1., 1.]])\ntf.losses.mean_pairwise_squared_error(labels, predictions)\n</code></pre>\n<p>In this case, the result should be <code>[(0-0.5)^2+(0-1)^2+(0.5-1)^2]/3=0.5</code>, but tensorflow returns different value 0.3333333134651184.</p>\n<h3>Suggestion to fix the source code</h3>\n<p><a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/losses/losses_impl.py\">tensorflow/python/ops/losses/losses_impl.py</a></p>\n<p>If the loss function <code>mean_pairwise_squared_error</code> measures the differences between pairs of corresponding elements of <code>predictions</code> and <code>labels</code> as explained in <a href=\"https://www.tensorflow.org/api_docs/python/tf/losses/mean_pairwise_squared_error\" rel=\"nofollow\">the API reference of the function</a>, here is a simple patch:</p>\n<blockquote>\n<p>(lines 520-521 need to be changed as)<br>\n<code>term1 = 2.0 * _safe_div(sum_squares_diff_per_batch, num_present_per_batch-1)</code><br>\nand<br>\n(lines 525-526 need to be changed as)<br>\n<code>term2 = 2.0 * _safe_div(math_ops.square(sum_diff), math_ops.multiply(num_present_per_batch, num_present_per_batch-1))</code></p>\n</blockquote>", "body_text": "System information\n\nTensorFlow version: 1.4.0, 1.4.1, and 1.5.0-rc0 (checked)\nHave I written custom code: N/A\nOS Platform and Distribution: N/A\nTensorFlow installed from: N/A\nBazel version: N/A\nCUDA/cuDNN version: N/A\nGPU model and memory: N/A\nExact command to reproduce: N/A\n\nDescribe the problem\nThe implementation of tf.losses.mean_pairwise_squared_error looks imperfect.\nFor example, as explained in the API reference of the function\n\nFor example, if labels=[a, b, c] and predictions=[x, y, z], there are three pairs of differences are summed to compute the loss: loss = [ ((a-b) - (x-y)).^2 + ((a-c) - (x-z)).^2 + ((b-c) - (y-z)).^2 ] / 3\n\nlet me put the following data as labels and predictions:\nlabels = tf.constant([[0., 0.5, 1.]])\npredictions = tf.constant([[1., 1., 1.]])\ntf.losses.mean_pairwise_squared_error(labels, predictions)\n\nIn this case, the result should be [(0-0.5)^2+(0-1)^2+(0.5-1)^2]/3=0.5, but tensorflow returns different value 0.3333333134651184.\nSuggestion to fix the source code\ntensorflow/python/ops/losses/losses_impl.py\nIf the loss function mean_pairwise_squared_error measures the differences between pairs of corresponding elements of predictions and labels as explained in the API reference of the function, here is a simple patch:\n\n(lines 520-521 need to be changed as)\nterm1 = 2.0 * _safe_div(sum_squares_diff_per_batch, num_present_per_batch-1)\nand\n(lines 525-526 need to be changed as)\nterm2 = 2.0 * _safe_div(math_ops.square(sum_diff), math_ops.multiply(num_present_per_batch, num_present_per_batch-1))", "body": "### System information\r\n- **TensorFlow version**: 1.4.0, 1.4.1, and 1.5.0-rc0 (checked)\r\n- **Have I written custom code**: N/A\r\n- **OS Platform and Distribution**: N/A\r\n- **TensorFlow installed from**: N/A\r\n- **Bazel version**: N/A\r\n- **CUDA/cuDNN version**: N/A\r\n- **GPU model and memory**: N/A\r\n- **Exact command to reproduce**: N/A\r\n\r\n### Describe the problem\r\nThe implementation of `tf.losses.mean_pairwise_squared_error` looks imperfect.\r\nFor example, as explained in [the API reference of the function](https://www.tensorflow.org/api_docs/python/tf/losses/mean_pairwise_squared_error)\r\n> For example, if `labels`=[a, b, c] and `predictions`=[x, y, z], there are three pairs of differences are summed to compute the loss: loss = [ ((a-b) - (x-y)).^2 + ((a-c) - (x-z)).^2 + ((b-c) - (y-z)).^2 ] / 3\r\n\r\nlet me put the following data as `labels` and `predictions`:\r\n```\r\nlabels = tf.constant([[0., 0.5, 1.]])\r\npredictions = tf.constant([[1., 1., 1.]])\r\ntf.losses.mean_pairwise_squared_error(labels, predictions)\r\n```\r\nIn this case, the result should be `[(0-0.5)^2+(0-1)^2+(0.5-1)^2]/3=0.5`, but tensorflow returns different value 0.3333333134651184.\r\n\r\n### Suggestion to fix the source code\r\n[tensorflow/python/ops/losses/losses_impl.py](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/losses/losses_impl.py)\r\n\r\nIf the loss function `mean_pairwise_squared_error` measures the differences between pairs of corresponding elements of `predictions` and `labels` as explained in [the API reference of the function](https://www.tensorflow.org/api_docs/python/tf/losses/mean_pairwise_squared_error), here is a simple patch:\r\n> (lines 520-521 need to be changed as)\r\n> `term1 = 2.0 * _safe_div(sum_squares_diff_per_batch, num_present_per_batch-1)`\r\nand\r\n> (lines 525-526 need to be changed as)\r\n> `term2 = 2.0 * _safe_div(math_ops.square(sum_diff), math_ops.multiply(num_present_per_batch, num_present_per_batch-1))`\r\n  "}