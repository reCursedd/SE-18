{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/286929679", "html_url": "https://github.com/tensorflow/tensorflow/issues/8447#issuecomment-286929679", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8447", "id": 286929679, "node_id": "MDEyOklzc3VlQ29tbWVudDI4NjkyOTY3OQ==", "user": {"login": "cshallue", "id": 20667461, "node_id": "MDQ6VXNlcjIwNjY3NDYx", "avatar_url": "https://avatars1.githubusercontent.com/u/20667461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cshallue", "html_url": "https://github.com/cshallue", "followers_url": "https://api.github.com/users/cshallue/followers", "following_url": "https://api.github.com/users/cshallue/following{/other_user}", "gists_url": "https://api.github.com/users/cshallue/gists{/gist_id}", "starred_url": "https://api.github.com/users/cshallue/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cshallue/subscriptions", "organizations_url": "https://api.github.com/users/cshallue/orgs", "repos_url": "https://api.github.com/users/cshallue/repos", "events_url": "https://api.github.com/users/cshallue/events{/privacy}", "received_events_url": "https://api.github.com/users/cshallue/received_events", "type": "User", "site_admin": false}, "created_at": "2017-03-16T01:21:56Z", "updated_at": "2017-03-16T04:12:03Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=15131907\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/mustafaxfe\">@mustafaxfe</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=592670\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/concretevitamin\">@concretevitamin</a></p>\n<p>Yes, this has to do with the RNN refactors. It looks like what's happened here is you trained your model with a previous version of TF, and now it won't open with the new version of TF. Downgrading the TF version on its own won't help, because this repository's code has been updated for TF 1.0.</p>\n<p>It's quite simple to rename the offending Variables in your previous checkpoint. I believe this will work, although you may need to tweak it a bit.</p>\n<pre><code>vars_to_rename = {\n      \"lstm/BasicLSTMCell/Linear/Matrix\": \"lstm/basic_lstm_cell/weights\",\n      \"lstm/BasicLSTMCell/Linear/Bias\": \"lstm/basic_lstm_cell/biases\",\n}\nnew_checkpoint_vars = {}\nreader = tf.train.NewCheckpointReader(path_to_checkpoint)\nfor old_name in reader.get_variable_to_shape_map():\n  if old_name in vars_to_rename:\n    new_name = vars_to_rename[old_name]\n  else:\n    new_name = old_name\n  new_checkpoint_vars[new_name] = tf.Variable(reader.get_tensor(old_name))\n\ninit = tf.global_variables_initializer()\nsaver = tf.train.Saver(new_checkpoint_vars)\n\nwith tf.Session() as sess:\n  sess.run(init)\n  saver.save(sess, path_to_new_checkpoint)\n</code></pre>", "body_text": "@mustafaxfe @concretevitamin\nYes, this has to do with the RNN refactors. It looks like what's happened here is you trained your model with a previous version of TF, and now it won't open with the new version of TF. Downgrading the TF version on its own won't help, because this repository's code has been updated for TF 1.0.\nIt's quite simple to rename the offending Variables in your previous checkpoint. I believe this will work, although you may need to tweak it a bit.\nvars_to_rename = {\n      \"lstm/BasicLSTMCell/Linear/Matrix\": \"lstm/basic_lstm_cell/weights\",\n      \"lstm/BasicLSTMCell/Linear/Bias\": \"lstm/basic_lstm_cell/biases\",\n}\nnew_checkpoint_vars = {}\nreader = tf.train.NewCheckpointReader(path_to_checkpoint)\nfor old_name in reader.get_variable_to_shape_map():\n  if old_name in vars_to_rename:\n    new_name = vars_to_rename[old_name]\n  else:\n    new_name = old_name\n  new_checkpoint_vars[new_name] = tf.Variable(reader.get_tensor(old_name))\n\ninit = tf.global_variables_initializer()\nsaver = tf.train.Saver(new_checkpoint_vars)\n\nwith tf.Session() as sess:\n  sess.run(init)\n  saver.save(sess, path_to_new_checkpoint)", "body": "@mustafaxfe @concretevitamin \r\n\r\nYes, this has to do with the RNN refactors. It looks like what's happened here is you trained your model with a previous version of TF, and now it won't open with the new version of TF. Downgrading the TF version on its own won't help, because this repository's code has been updated for TF 1.0.\r\n\r\nIt's quite simple to rename the offending Variables in your previous checkpoint. I believe this will work, although you may need to tweak it a bit.\r\n\r\n```\r\nvars_to_rename = {\r\n      \"lstm/BasicLSTMCell/Linear/Matrix\": \"lstm/basic_lstm_cell/weights\",\r\n      \"lstm/BasicLSTMCell/Linear/Bias\": \"lstm/basic_lstm_cell/biases\",\r\n}\r\nnew_checkpoint_vars = {}\r\nreader = tf.train.NewCheckpointReader(path_to_checkpoint)\r\nfor old_name in reader.get_variable_to_shape_map():\r\n  if old_name in vars_to_rename:\r\n    new_name = vars_to_rename[old_name]\r\n  else:\r\n    new_name = old_name\r\n  new_checkpoint_vars[new_name] = tf.Variable(reader.get_tensor(old_name))\r\n\r\ninit = tf.global_variables_initializer()\r\nsaver = tf.train.Saver(new_checkpoint_vars)\r\n\r\nwith tf.Session() as sess:\r\n  sess.run(init)\r\n  saver.save(sess, path_to_new_checkpoint)\r\n```"}