{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/277883819", "html_url": "https://github.com/tensorflow/tensorflow/issues/6968#issuecomment-277883819", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6968", "id": 277883819, "node_id": "MDEyOklzc3VlQ29tbWVudDI3Nzg4MzgxOQ==", "user": {"login": "Montmorency", "id": 962924, "node_id": "MDQ6VXNlcjk2MjkyNA==", "avatar_url": "https://avatars2.githubusercontent.com/u/962924?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Montmorency", "html_url": "https://github.com/Montmorency", "followers_url": "https://api.github.com/users/Montmorency/followers", "following_url": "https://api.github.com/users/Montmorency/following{/other_user}", "gists_url": "https://api.github.com/users/Montmorency/gists{/gist_id}", "starred_url": "https://api.github.com/users/Montmorency/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Montmorency/subscriptions", "organizations_url": "https://api.github.com/users/Montmorency/orgs", "repos_url": "https://api.github.com/users/Montmorency/repos", "events_url": "https://api.github.com/users/Montmorency/events{/privacy}", "received_events_url": "https://api.github.com/users/Montmorency/received_events", "type": "User", "site_admin": false}, "created_at": "2017-02-07T02:37:30Z", "updated_at": "2017-02-07T02:37:30Z", "author_association": "NONE", "body_html": "<p>Not sure if this is related but I am unable to build with jemalloc on a cluster with gcc 4.8.2 and an older version of libc.so.6 (old enough that I have to build tensor flow from source). The build fails with a message:</p>\n<p>ERROR:~/.cache/bazel/<em>bazel</em>/e924d9c3ba75314415252c6f4f93bb86/external/jemalloc/BUILD:10:1: C++ compilation of rule '@jemalloc//:jemalloc' failed: gcc failed: error executing command /opt/apps/compilers/gcc/4.8.2/bin/gcc -U_FORTIFY_SOURCE -fstack-protector -Wall -B/opt/apps/compilers/gcc/4.8.2/bin -B/usr/bin -Wunused-but-set-parameter -Wno-free-nonheap-object ... (remaining 38 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.</p>\n<p>Disabling jemalloc at the configure stage means I can finish the tensor flow build and install. I can then train my models (i.e. model.fit()) on the cluster but when I try to  run model.predict_prob() I am getting this error:<br>\n*** glibc detected *** python: double free or corruption (!prev): 0x00000000013fcda0 ***<br>\n======= Backtrace: =========<br>\n/lib64/libc.so.6[0x3e22e75e66]<br>\n/lib64/libc.so.6[0x3e22e789b3]<br>\n/lib64/ld-linux-x86-64.so.2(_dl_deallocate_tls+0x67)[0x3e226112f7]<br>\n/lib64/libpthread.so.0[0x3e2320675d]<br>\n/lib64/libpthread.so.0[0x3e232078ea]<br>\n/lib64/libpthread.so.0(pthread_join+0xd4)[0x3e232081f4]<br>\n/opt/apps/compilers/gcc/4.8.2/lib64/libstdc++.so.6(_ZNSt6thread4joinEv+0x27)[0x7f657b6263c7]<br>\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(+0x2567e60)[0x7f657dde2e60]<br>\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow6thread10ThreadPool4ImplD0Ev+0xb3)[0x7f657ddbf5b3]<br>\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow6thread10ThreadPoolD1Ev+0x1a)[0x7f657ddbfc1a]<br>\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow10FileSystem16GetMatchingPathsERKSsPSt6vectorISsSaISsEE+0x592)[0x7f657dddf8a2]<br>\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow3Env16GetMatchingPathsERKSsPSt6vectorISsSaISsEE+0x9b)[0x7f657dddbc1b]<br>\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(+0xadc66b)[0x7f657c35766b]<br>\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(+0xade610)[0x7f657c359610]</p>\n<p>So just wondering if there is some conflict with compiler/glibc libraries that is causing these issues?</p>", "body_text": "Not sure if this is related but I am unable to build with jemalloc on a cluster with gcc 4.8.2 and an older version of libc.so.6 (old enough that I have to build tensor flow from source). The build fails with a message:\nERROR:~/.cache/bazel/bazel/e924d9c3ba75314415252c6f4f93bb86/external/jemalloc/BUILD:10:1: C++ compilation of rule '@jemalloc//:jemalloc' failed: gcc failed: error executing command /opt/apps/compilers/gcc/4.8.2/bin/gcc -U_FORTIFY_SOURCE -fstack-protector -Wall -B/opt/apps/compilers/gcc/4.8.2/bin -B/usr/bin -Wunused-but-set-parameter -Wno-free-nonheap-object ... (remaining 38 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\nDisabling jemalloc at the configure stage means I can finish the tensor flow build and install. I can then train my models (i.e. model.fit()) on the cluster but when I try to  run model.predict_prob() I am getting this error:\n*** glibc detected *** python: double free or corruption (!prev): 0x00000000013fcda0 ***\n======= Backtrace: =========\n/lib64/libc.so.6[0x3e22e75e66]\n/lib64/libc.so.6[0x3e22e789b3]\n/lib64/ld-linux-x86-64.so.2(_dl_deallocate_tls+0x67)[0x3e226112f7]\n/lib64/libpthread.so.0[0x3e2320675d]\n/lib64/libpthread.so.0[0x3e232078ea]\n/lib64/libpthread.so.0(pthread_join+0xd4)[0x3e232081f4]\n/opt/apps/compilers/gcc/4.8.2/lib64/libstdc++.so.6(_ZNSt6thread4joinEv+0x27)[0x7f657b6263c7]\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(+0x2567e60)[0x7f657dde2e60]\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow6thread10ThreadPool4ImplD0Ev+0xb3)[0x7f657ddbf5b3]\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow6thread10ThreadPoolD1Ev+0x1a)[0x7f657ddbfc1a]\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow10FileSystem16GetMatchingPathsERKSsPSt6vectorISsSaISsEE+0x592)[0x7f657dddf8a2]\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow3Env16GetMatchingPathsERKSsPSt6vectorISsSaISsEE+0x9b)[0x7f657dddbc1b]\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(+0xadc66b)[0x7f657c35766b]\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(+0xade610)[0x7f657c359610]\nSo just wondering if there is some conflict with compiler/glibc libraries that is causing these issues?", "body": "Not sure if this is related but I am unable to build with jemalloc on a cluster with gcc 4.8.2 and an older version of libc.so.6 (old enough that I have to build tensor flow from source). The build fails with a message:\r\n\r\nERROR:~/.cache/bazel/_bazel_/e924d9c3ba75314415252c6f4f93bb86/external/jemalloc/BUILD:10:1: C++ compilation of rule '@jemalloc//:jemalloc' failed: gcc failed: error executing command /opt/apps/compilers/gcc/4.8.2/bin/gcc -U_FORTIFY_SOURCE -fstack-protector -Wall -B/opt/apps/compilers/gcc/4.8.2/bin -B/usr/bin -Wunused-but-set-parameter -Wno-free-nonheap-object ... (remaining 38 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\r\n\r\nDisabling jemalloc at the configure stage means I can finish the tensor flow build and install. I can then train my models (i.e. model.fit()) on the cluster but when I try to  run model.predict_prob() I am getting this error:\r\n*** glibc detected *** python: double free or corruption (!prev): 0x00000000013fcda0 ***\r\n======= Backtrace: =========\r\n/lib64/libc.so.6[0x3e22e75e66]\r\n/lib64/libc.so.6[0x3e22e789b3]\r\n/lib64/ld-linux-x86-64.so.2(_dl_deallocate_tls+0x67)[0x3e226112f7]\r\n/lib64/libpthread.so.0[0x3e2320675d]\r\n/lib64/libpthread.so.0[0x3e232078ea]\r\n/lib64/libpthread.so.0(pthread_join+0xd4)[0x3e232081f4]\r\n/opt/apps/compilers/gcc/4.8.2/lib64/libstdc++.so.6(_ZNSt6thread4joinEv+0x27)[0x7f657b6263c7]\r\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(+0x2567e60)[0x7f657dde2e60]\r\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow6thread10ThreadPool4ImplD0Ev+0xb3)[0x7f657ddbf5b3]\r\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow6thread10ThreadPoolD1Ev+0x1a)[0x7f657ddbfc1a]\r\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow10FileSystem16GetMatchingPathsERKSsPSt6vectorISsSaISsEE+0x592)[0x7f657dddf8a2]\r\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow3Env16GetMatchingPathsERKSsPSt6vectorISsSaISsEE+0x9b)[0x7f657dddbc1b]\r\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(+0xadc66b)[0x7f657c35766b]\r\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(+0xade610)[0x7f657c359610]\r\n\r\nSo just wondering if there is some conflict with compiler/glibc libraries that is causing these issues?"}