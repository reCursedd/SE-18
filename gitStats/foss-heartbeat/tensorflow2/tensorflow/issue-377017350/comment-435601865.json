{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/435601865", "html_url": "https://github.com/tensorflow/tensorflow/issues/23471#issuecomment-435601865", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23471", "id": 435601865, "node_id": "MDEyOklzc3VlQ29tbWVudDQzNTYwMTg2NQ==", "user": {"login": "jthestness", "id": 28744304, "node_id": "MDQ6VXNlcjI4NzQ0MzA0", "avatar_url": "https://avatars0.githubusercontent.com/u/28744304?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jthestness", "html_url": "https://github.com/jthestness", "followers_url": "https://api.github.com/users/jthestness/followers", "following_url": "https://api.github.com/users/jthestness/following{/other_user}", "gists_url": "https://api.github.com/users/jthestness/gists{/gist_id}", "starred_url": "https://api.github.com/users/jthestness/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jthestness/subscriptions", "organizations_url": "https://api.github.com/users/jthestness/orgs", "repos_url": "https://api.github.com/users/jthestness/repos", "events_url": "https://api.github.com/users/jthestness/events{/privacy}", "received_events_url": "https://api.github.com/users/jthestness/received_events", "type": "User", "site_admin": false}, "created_at": "2018-11-03T16:36:23Z", "updated_at": "2018-11-03T16:36:23Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Hi guys. I'm afraid we haven't moved beyond TF 1.7 yet, so I haven't encountered these issues myself. However, there might be some things that could help track down the issue:</p>\n<p>First, I don't think you should need to manually apply <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"334087961\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/20147\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/20147/hovercard\" href=\"https://github.com/tensorflow/tensorflow/pull/20147\">#20147</a>, since it has already been merged. That change was in response to TF changes that moved the namespaces for threading between roughly TF 1.4 and 1.7. Also this summer, TF again changed namespaces (maybe for devices?) in roughly v1.8, and I suspect we will need to make changes analogous to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"334087961\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/20147\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/20147/hovercard\" href=\"https://github.com/tensorflow/tensorflow/pull/20147\">#20147</a> to find the right includes and get the appropriate device types. (I'm actually surprised that the errors show Eigen::ThreadPoolDevice as the specialization type, since I believe the device specializations should be CPUDevice, GPUDevice, etc. --- that's a big red flag).</p>\n<p>If I had time to debug this, I'd start by trying to bisect the builds starting around TF 1.8 and identify the PR that caused MPI collectives to stop building correctly. From there, it should be straightforward to figure out the appropriate includes to get correct device types.</p>\n<p>I'd also recommend a quick test to declare the explicit specializations with Eigen::ThreadPoolDevice right after the CopyTensorData and AccumulateTensorData declarations in <code>mpi_collectives/kernels/ring.h</code> just to see if that might fix the problem.</p>", "body_text": "Hi guys. I'm afraid we haven't moved beyond TF 1.7 yet, so I haven't encountered these issues myself. However, there might be some things that could help track down the issue:\nFirst, I don't think you should need to manually apply #20147, since it has already been merged. That change was in response to TF changes that moved the namespaces for threading between roughly TF 1.4 and 1.7. Also this summer, TF again changed namespaces (maybe for devices?) in roughly v1.8, and I suspect we will need to make changes analogous to #20147 to find the right includes and get the appropriate device types. (I'm actually surprised that the errors show Eigen::ThreadPoolDevice as the specialization type, since I believe the device specializations should be CPUDevice, GPUDevice, etc. --- that's a big red flag).\nIf I had time to debug this, I'd start by trying to bisect the builds starting around TF 1.8 and identify the PR that caused MPI collectives to stop building correctly. From there, it should be straightforward to figure out the appropriate includes to get correct device types.\nI'd also recommend a quick test to declare the explicit specializations with Eigen::ThreadPoolDevice right after the CopyTensorData and AccumulateTensorData declarations in mpi_collectives/kernels/ring.h just to see if that might fix the problem.", "body": "Hi guys. I'm afraid we haven't moved beyond TF 1.7 yet, so I haven't encountered these issues myself. However, there might be some things that could help track down the issue:\r\n\r\nFirst, I don't think you should need to manually apply #20147, since it has already been merged. That change was in response to TF changes that moved the namespaces for threading between roughly TF 1.4 and 1.7. Also this summer, TF again changed namespaces (maybe for devices?) in roughly v1.8, and I suspect we will need to make changes analogous to #20147 to find the right includes and get the appropriate device types. (I'm actually surprised that the errors show Eigen::ThreadPoolDevice as the specialization type, since I believe the device specializations should be CPUDevice, GPUDevice, etc. --- that's a big red flag).\r\n\r\nIf I had time to debug this, I'd start by trying to bisect the builds starting around TF 1.8 and identify the PR that caused MPI collectives to stop building correctly. From there, it should be straightforward to figure out the appropriate includes to get correct device types.\r\n\r\nI'd also recommend a quick test to declare the explicit specializations with Eigen::ThreadPoolDevice right after the CopyTensorData and AccumulateTensorData declarations in `mpi_collectives/kernels/ring.h` just to see if that might fix the problem."}