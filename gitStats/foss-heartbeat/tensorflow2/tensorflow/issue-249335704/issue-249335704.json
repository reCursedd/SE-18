{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12177", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12177/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12177/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12177/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/12177", "id": 249335704, "node_id": "MDU6SXNzdWUyNDkzMzU3MDQ=", "number": 12177, "title": "InvalidArgumentError in tensorflow reduce_sum gradient when compiling from sources", "user": {"login": "tbsflk", "id": 8472955, "node_id": "MDQ6VXNlcjg0NzI5NTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/8472955?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tbsflk", "html_url": "https://github.com/tbsflk", "followers_url": "https://api.github.com/users/tbsflk/followers", "following_url": "https://api.github.com/users/tbsflk/following{/other_user}", "gists_url": "https://api.github.com/users/tbsflk/gists{/gist_id}", "starred_url": "https://api.github.com/users/tbsflk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tbsflk/subscriptions", "organizations_url": "https://api.github.com/users/tbsflk/orgs", "repos_url": "https://api.github.com/users/tbsflk/repos", "events_url": "https://api.github.com/users/tbsflk/events{/privacy}", "received_events_url": "https://api.github.com/users/tbsflk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}, {"id": 473173351, "node_id": "MDU6TGFiZWw0NzMxNzMzNTE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:build/install", "name": "type:build/install", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2017-08-10T12:51:14Z", "updated_at": "2017-12-15T09:41:26Z", "closed_at": "2017-12-15T09:41:26Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:<br>\nyes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nWindows 10</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>:<br>\nsource</li>\n<li><strong>TensorFlow version (use command below)</strong>:<br>\n1.3.0rc2</li>\n<li><strong>Python version</strong>:<br>\n3.5.3</li>\n<li><strong>Bazel version (if compiling from source)</strong>:<br>\ncmake 3.9.0</li>\n<li><strong>CUDA/cuDNN version</strong>:<br>\ncpu only</li>\n<li><strong>GPU model and memory</strong>:<br>\ncpu only</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<p>I compiled tensorflow from source according to the instructions given here: <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/cmake/README.md\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/cmake/README.md</a><br>\nI activated support for AVX (that's the reason I want to compile from source). All steps work without problems. I then install the whl with pip in my python environment.</p>\n<p>Now, if I run my code with that version of tf, it crashes, but it works if I use a pre-compiled version.</p>\n<h3>Describe the problem</h3>\n<p>A script that runs without problems when I use a pre-built version of tensorflow throws an error when I use the compiled version (see below for trace). I also compiled r1.2 and saw the same problem. Since the code works with the pre-built tf version (1.1), I suspect the problem is related to compiling from source.</p>\n<h3>Source code / logs</h3>\n<p>Error when running with the compiled tf:</p>\n<pre><code>  File \"test_network.py\", line 35, in &lt;module&gt;\n    network = Network(**configuration)\n[elided 0 identical lines from previous traceback]\n  File \"C:\\Users\\falke\\EclipseWorkspace\\nn\\src\\codebase\\network.py\", line 194, in __init__\n    self._build_graph()\n  File \"C:\\Users\\falke\\EclipseWorkspace\\nn\\src\\codebase\\network.py\", line 227, in _build_graph\n    self.graph_states = gop(self.graph_states, enc_state)\n  File \"C:\\Users\\falke\\EclipseWorkspace\\nn\\src\\codebase\\network.py\", line 158, in __call__\n    w = tf.exp(tf.reduce_sum(tf.multiply(node_labels, enc_state), axis=2, keep_dims=True))\n  File \"C:\\Anaconda\\envs\\tfc\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 1279, in reduce_sum\n    name=name)\n  File \"C:\\Anaconda\\envs\\tfc\\lib\\site-packages\\tensorflow\\python\\ops\\gen_math_ops.py\", line 2727, in _sum\n    keep_dims=keep_dims, name=name)\n  File \"C:\\Anaconda\\envs\\tfc\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 328, in apply_op\n    op_type_name, name, **keywords)\n  File \"C:\\Anaconda\\envs\\tfc\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 787, in _apply_op_helper\n    op_def=op_def)\n  File \"C:\\Anaconda\\envs\\tfc\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 2624, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"C:\\Anaconda\\envs\\tfc\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1210, in __init__\n    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\n\nInvalidArgumentError (see above for traceback): indices[1] is out of range\n         [[Node: opt/gradients/node_label_update_1/Sum_grad/DynamicStitch = DynamicStitch[N=2, T=DT_INT32, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](opt/gradients/node_label_update_1/Sum_grad/range, opt/gradients/node_label_update_1/Sum_grad/mod, opt/gradients/node_label_update_1/Sum_grad/Shape, opt/gradients/node_label_update_1/Sum_grad/Fill)]]\n</code></pre>\n<p>The code causing the error is:<br>\n<code>w = tf.exp(tf.reduce_sum(tf.multiply(node_labels, enc_state), axis=2, keep_dims=True))</code><br>\nBoth <code>node_labels</code> and <code>enc_state</code> are 40x5x30 dim tensors. And as I already said, there are no issues at all running this code if I don't compile from source.</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nyes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nWindows 10\nTensorFlow installed from (source or binary):\nsource\nTensorFlow version (use command below):\n1.3.0rc2\nPython version:\n3.5.3\nBazel version (if compiling from source):\ncmake 3.9.0\nCUDA/cuDNN version:\ncpu only\nGPU model and memory:\ncpu only\nExact command to reproduce:\n\nI compiled tensorflow from source according to the instructions given here: https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/cmake/README.md\nI activated support for AVX (that's the reason I want to compile from source). All steps work without problems. I then install the whl with pip in my python environment.\nNow, if I run my code with that version of tf, it crashes, but it works if I use a pre-compiled version.\nDescribe the problem\nA script that runs without problems when I use a pre-built version of tensorflow throws an error when I use the compiled version (see below for trace). I also compiled r1.2 and saw the same problem. Since the code works with the pre-built tf version (1.1), I suspect the problem is related to compiling from source.\nSource code / logs\nError when running with the compiled tf:\n  File \"test_network.py\", line 35, in <module>\n    network = Network(**configuration)\n[elided 0 identical lines from previous traceback]\n  File \"C:\\Users\\falke\\EclipseWorkspace\\nn\\src\\codebase\\network.py\", line 194, in __init__\n    self._build_graph()\n  File \"C:\\Users\\falke\\EclipseWorkspace\\nn\\src\\codebase\\network.py\", line 227, in _build_graph\n    self.graph_states = gop(self.graph_states, enc_state)\n  File \"C:\\Users\\falke\\EclipseWorkspace\\nn\\src\\codebase\\network.py\", line 158, in __call__\n    w = tf.exp(tf.reduce_sum(tf.multiply(node_labels, enc_state), axis=2, keep_dims=True))\n  File \"C:\\Anaconda\\envs\\tfc\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 1279, in reduce_sum\n    name=name)\n  File \"C:\\Anaconda\\envs\\tfc\\lib\\site-packages\\tensorflow\\python\\ops\\gen_math_ops.py\", line 2727, in _sum\n    keep_dims=keep_dims, name=name)\n  File \"C:\\Anaconda\\envs\\tfc\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 328, in apply_op\n    op_type_name, name, **keywords)\n  File \"C:\\Anaconda\\envs\\tfc\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 787, in _apply_op_helper\n    op_def=op_def)\n  File \"C:\\Anaconda\\envs\\tfc\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 2624, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"C:\\Anaconda\\envs\\tfc\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1210, in __init__\n    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\n\nInvalidArgumentError (see above for traceback): indices[1] is out of range\n         [[Node: opt/gradients/node_label_update_1/Sum_grad/DynamicStitch = DynamicStitch[N=2, T=DT_INT32, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](opt/gradients/node_label_update_1/Sum_grad/range, opt/gradients/node_label_update_1/Sum_grad/mod, opt/gradients/node_label_update_1/Sum_grad/Shape, opt/gradients/node_label_update_1/Sum_grad/Fill)]]\n\nThe code causing the error is:\nw = tf.exp(tf.reduce_sum(tf.multiply(node_labels, enc_state), axis=2, keep_dims=True))\nBoth node_labels and enc_state are 40x5x30 dim tensors. And as I already said, there are no issues at all running this code if I don't compile from source.", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\nyes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\nWindows 10\r\n- **TensorFlow installed from (source or binary)**:\r\nsource\r\n- **TensorFlow version (use command below)**:\r\n1.3.0rc2\r\n- **Python version**: \r\n3.5.3\r\n- **Bazel version (if compiling from source)**:\r\ncmake 3.9.0\r\n- **CUDA/cuDNN version**:\r\ncpu only\r\n- **GPU model and memory**:\r\ncpu only\r\n- **Exact command to reproduce**:\r\n\r\nI compiled tensorflow from source according to the instructions given here: https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/cmake/README.md\r\nI activated support for AVX (that's the reason I want to compile from source). All steps work without problems. I then install the whl with pip in my python environment.\r\n\r\nNow, if I run my code with that version of tf, it crashes, but it works if I use a pre-compiled version.\r\n\r\n### Describe the problem\r\nA script that runs without problems when I use a pre-built version of tensorflow throws an error when I use the compiled version (see below for trace). I also compiled r1.2 and saw the same problem. Since the code works with the pre-built tf version (1.1), I suspect the problem is related to compiling from source.\r\n\r\n### Source code / logs\r\nError when running with the compiled tf:\r\n\r\n```\r\n  File \"test_network.py\", line 35, in <module>\r\n    network = Network(**configuration)\r\n[elided 0 identical lines from previous traceback]\r\n  File \"C:\\Users\\falke\\EclipseWorkspace\\nn\\src\\codebase\\network.py\", line 194, in __init__\r\n    self._build_graph()\r\n  File \"C:\\Users\\falke\\EclipseWorkspace\\nn\\src\\codebase\\network.py\", line 227, in _build_graph\r\n    self.graph_states = gop(self.graph_states, enc_state)\r\n  File \"C:\\Users\\falke\\EclipseWorkspace\\nn\\src\\codebase\\network.py\", line 158, in __call__\r\n    w = tf.exp(tf.reduce_sum(tf.multiply(node_labels, enc_state), axis=2, keep_dims=True))\r\n  File \"C:\\Anaconda\\envs\\tfc\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 1279, in reduce_sum\r\n    name=name)\r\n  File \"C:\\Anaconda\\envs\\tfc\\lib\\site-packages\\tensorflow\\python\\ops\\gen_math_ops.py\", line 2727, in _sum\r\n    keep_dims=keep_dims, name=name)\r\n  File \"C:\\Anaconda\\envs\\tfc\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 328, in apply_op\r\n    op_type_name, name, **keywords)\r\n  File \"C:\\Anaconda\\envs\\tfc\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 787, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"C:\\Anaconda\\envs\\tfc\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 2624, in create_op\r\n    original_op=self._default_original_op, op_def=op_def)\r\n  File \"C:\\Anaconda\\envs\\tfc\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1210, in __init__\r\n    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\r\n\r\nInvalidArgumentError (see above for traceback): indices[1] is out of range\r\n         [[Node: opt/gradients/node_label_update_1/Sum_grad/DynamicStitch = DynamicStitch[N=2, T=DT_INT32, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](opt/gradients/node_label_update_1/Sum_grad/range, opt/gradients/node_label_update_1/Sum_grad/mod, opt/gradients/node_label_update_1/Sum_grad/Shape, opt/gradients/node_label_update_1/Sum_grad/Fill)]]\r\n```\r\n\r\nThe code causing the error is:\r\n`w = tf.exp(tf.reduce_sum(tf.multiply(node_labels, enc_state), axis=2, keep_dims=True))`\r\nBoth `node_labels` and `enc_state` are 40x5x30 dim tensors. And as I already said, there are no issues at all running this code if I don't compile from source."}