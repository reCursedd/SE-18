{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11603", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11603/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11603/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11603/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/11603", "id": 244011182, "node_id": "MDU6SXNzdWUyNDQwMTExODI=", "number": 11603, "title": "//tensorflow/python:nn_test is failing on ppc64le with AssertionError: False is not true ", "user": {"login": "sandipmgiri", "id": 16284232, "node_id": "MDQ6VXNlcjE2Mjg0MjMy", "avatar_url": "https://avatars0.githubusercontent.com/u/16284232?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sandipmgiri", "html_url": "https://github.com/sandipmgiri", "followers_url": "https://api.github.com/users/sandipmgiri/followers", "following_url": "https://api.github.com/users/sandipmgiri/following{/other_user}", "gists_url": "https://api.github.com/users/sandipmgiri/gists{/gist_id}", "starred_url": "https://api.github.com/users/sandipmgiri/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sandipmgiri/subscriptions", "organizations_url": "https://api.github.com/users/sandipmgiri/orgs", "repos_url": "https://api.github.com/users/sandipmgiri/repos", "events_url": "https://api.github.com/users/sandipmgiri/events{/privacy}", "received_events_url": "https://api.github.com/users/sandipmgiri/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586558, "node_id": "MDU6TGFiZWw0MDQ1ODY1NTg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:community%20support", "name": "stat:community support", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 18, "created_at": "2017-07-19T11:38:01Z", "updated_at": "2018-05-16T16:56:34Z", "closed_at": "2018-05-16T16:56:34Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nUbuntu 16.04 (ppc64le)</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>:<br>\nInstalled from source (v1.2.1)</li>\n<li><strong>TensorFlow version (use command below)</strong>:<br>\n('v1.2.1-0-gb4957ff', '1.2.1')</li>\n<li><strong>Python version</strong>:<br>\nPython 2.7.5</li>\n<li><strong>Bazel version (if compiling from source)</strong>:<br>\n0.4.5-2017-07-13 (@037b9b9)</li>\n<li><strong>CUDA/cuDNN version</strong>:<br>\nNA</li>\n<li><strong>GPU model and memory</strong>:<br>\nNA</li>\n<li><strong>Exact command to reproduce</strong>:<br>\nbazel test //tensorflow/python:nn_test</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>Here  testNaNs is failing , see relevant code-<br>\n<a href=\"https://github.com/tensorflow/tensorflow/blob/v1.2.1/tensorflow/python/ops/nn_test.py#L835-L841\">https://github.com/tensorflow/tensorflow/blob/v1.2.1/tensorflow/python/ops/nn_test.py#L835-L841</a></p>\n<pre><code>def testNaNs(self):\n    # Test that relu(nan) = nan for various sizes.\n    for i in range(18):\n      x = np.zeros(i) + np.nan\n      with self.test_session():\n        z = nn_ops.relu(constant_op.constant(x)).eval()\n        print(\"\\n current i value is \", i)\n        print(\"\\n z value is \", z)\n        self.assertTrue(np.isnan(z).all())\n</code></pre>\n<p>This test is failing ,because nn_ops.relu function returning incorrect results on ppc64le (0 vs expected nan).......(for i = 2 to 18 )</p>\n<p>for<code> i = 0</code>  :   z value =   []    ............... (ok)<br>\nfor <code>i = 1</code>  :   z value =  [ nan]  ........... (ok)<br>\nfor <code>i = 2</code>  :   z value =  [ 0.  0.]  ...........(not ok on ppc64le, bcz <code>0. != nan</code>)</p>\n<p>It looks like this is a bug in the nn_ops.relu function for ppc64le, currently I am trying to understand the reason. Please provide comments/suggestions if any. Thanks!</p>\n<h3>Source code / logs</h3>\n<pre><code>$ bazel test --test_output=errors //tensorflow/python:nn_test\n\n......................../root/.cache/bazel/_bazel_root/725e77151072daec43bc353cb6fcb26c/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/nn_test.runfiles/org_tensorflow/tensorflow/python/ops/nn_test.py:108: RuntimeWarning: divide by zero encountered in log\n  stirling_approx = z * np.log(z) - z + 0.5 * np.log(2. * np.pi * z)\n/root/.cache/bazel/_bazel_root/725e77151072daec43bc353cb6fcb26c/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/nn_test.runfiles/org_tensorflow/tensorflow/python/ops/nn_test.py:108: RuntimeWarning: invalid value encountered in multiply\n  stirling_approx = z * np.log(z) - z + 0.5 * np.log(2. * np.pi * z)\n................F.......\n======================================================================\nFAIL: testNaNs (__main__.ReluTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/root/.cache/bazel/_bazel_root/725e77151072daec43bc353cb6fcb26c/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/nn_test.runfiles/org_tensorflow/tensorflow/python/ops/nn_test.py\", line 841, in testNaNs\n    self.assertTrue(np.isnan(z).all())\nAssertionError: False is not true\n\n----------------------------------------------------------------------\nRan 48 tests in 7.253s\n\nFAILED (failures=1)\n0.0208333333333\n0.00566666666667\n0.0075\n0.0208333333333\n0.00566666666667\n0.0075\n0.0208333333333\n0.00566666666667\n0.0075\nL2Loss gradient err = 9.6958e-12\nL2Normalize gradient err = 4.2424e-08\nL2Normalize gradient err = 5.45829e-07\nL2Normalize gradient err = 7.61142e-05\n================================================================================\n\n</code></pre>", "body_text": "System information\n\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nUbuntu 16.04 (ppc64le)\nTensorFlow installed from (source or binary):\nInstalled from source (v1.2.1)\nTensorFlow version (use command below):\n('v1.2.1-0-gb4957ff', '1.2.1')\nPython version:\nPython 2.7.5\nBazel version (if compiling from source):\n0.4.5-2017-07-13 (@037b9b9)\nCUDA/cuDNN version:\nNA\nGPU model and memory:\nNA\nExact command to reproduce:\nbazel test //tensorflow/python:nn_test\n\nDescribe the problem\nHere  testNaNs is failing , see relevant code-\nhttps://github.com/tensorflow/tensorflow/blob/v1.2.1/tensorflow/python/ops/nn_test.py#L835-L841\ndef testNaNs(self):\n    # Test that relu(nan) = nan for various sizes.\n    for i in range(18):\n      x = np.zeros(i) + np.nan\n      with self.test_session():\n        z = nn_ops.relu(constant_op.constant(x)).eval()\n        print(\"\\n current i value is \", i)\n        print(\"\\n z value is \", z)\n        self.assertTrue(np.isnan(z).all())\n\nThis test is failing ,because nn_ops.relu function returning incorrect results on ppc64le (0 vs expected nan).......(for i = 2 to 18 )\nfor i = 0  :   z value =   []    ............... (ok)\nfor i = 1  :   z value =  [ nan]  ........... (ok)\nfor i = 2  :   z value =  [ 0.  0.]  ...........(not ok on ppc64le, bcz 0. != nan)\nIt looks like this is a bug in the nn_ops.relu function for ppc64le, currently I am trying to understand the reason. Please provide comments/suggestions if any. Thanks!\nSource code / logs\n$ bazel test --test_output=errors //tensorflow/python:nn_test\n\n......................../root/.cache/bazel/_bazel_root/725e77151072daec43bc353cb6fcb26c/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/nn_test.runfiles/org_tensorflow/tensorflow/python/ops/nn_test.py:108: RuntimeWarning: divide by zero encountered in log\n  stirling_approx = z * np.log(z) - z + 0.5 * np.log(2. * np.pi * z)\n/root/.cache/bazel/_bazel_root/725e77151072daec43bc353cb6fcb26c/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/nn_test.runfiles/org_tensorflow/tensorflow/python/ops/nn_test.py:108: RuntimeWarning: invalid value encountered in multiply\n  stirling_approx = z * np.log(z) - z + 0.5 * np.log(2. * np.pi * z)\n................F.......\n======================================================================\nFAIL: testNaNs (__main__.ReluTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/root/.cache/bazel/_bazel_root/725e77151072daec43bc353cb6fcb26c/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/nn_test.runfiles/org_tensorflow/tensorflow/python/ops/nn_test.py\", line 841, in testNaNs\n    self.assertTrue(np.isnan(z).all())\nAssertionError: False is not true\n\n----------------------------------------------------------------------\nRan 48 tests in 7.253s\n\nFAILED (failures=1)\n0.0208333333333\n0.00566666666667\n0.0075\n0.0208333333333\n0.00566666666667\n0.0075\n0.0208333333333\n0.00566666666667\n0.0075\nL2Loss gradient err = 9.6958e-12\nL2Normalize gradient err = 4.2424e-08\nL2Normalize gradient err = 5.45829e-07\nL2Normalize gradient err = 7.61142e-05\n================================================================================", "body": "### System information\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\n     Ubuntu 16.04 (ppc64le)\r\n- **TensorFlow installed from (source or binary)**:\r\n      Installed from source (v1.2.1)\r\n- **TensorFlow version (use command below)**:\r\n      ('v1.2.1-0-gb4957ff', '1.2.1')\r\n- **Python version**: \r\n     Python 2.7.5\r\n- **Bazel version (if compiling from source)**:\r\n       0.4.5-2017-07-13 (@037b9b9)\r\n- **CUDA/cuDNN version**:\r\n     NA\r\n- **GPU model and memory**:\r\n      NA\r\n- **Exact command to reproduce**:\r\n      bazel test //tensorflow/python:nn_test\r\n\r\n### Describe the problem\r\nHere  testNaNs is failing , see relevant code-\r\nhttps://github.com/tensorflow/tensorflow/blob/v1.2.1/tensorflow/python/ops/nn_test.py#L835-L841\r\n\r\n```\r\ndef testNaNs(self):\r\n    # Test that relu(nan) = nan for various sizes.\r\n    for i in range(18):\r\n      x = np.zeros(i) + np.nan\r\n      with self.test_session():\r\n        z = nn_ops.relu(constant_op.constant(x)).eval()\r\n        print(\"\\n current i value is \", i)\r\n        print(\"\\n z value is \", z)\r\n        self.assertTrue(np.isnan(z).all())\r\n```\r\nThis test is failing ,because nn_ops.relu function returning incorrect results on ppc64le (0 vs expected nan).......(for i = 2 to 18 )\r\n\r\nfor` i = 0`  :   z value =   []    ............... (ok)\r\nfor `i = 1`  :   z value =  [ nan]  ........... (ok)\r\nfor `i = 2`  :   z value =  [ 0.  0.]  ...........(not ok on ppc64le, bcz `0. != nan`)\r\n\r\nIt looks like this is a bug in the nn_ops.relu function for ppc64le, currently I am trying to understand the reason. Please provide comments/suggestions if any. Thanks!\r\n### Source code / logs\r\n\r\n```\r\n$ bazel test --test_output=errors //tensorflow/python:nn_test\r\n\r\n......................../root/.cache/bazel/_bazel_root/725e77151072daec43bc353cb6fcb26c/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/nn_test.runfiles/org_tensorflow/tensorflow/python/ops/nn_test.py:108: RuntimeWarning: divide by zero encountered in log\r\n  stirling_approx = z * np.log(z) - z + 0.5 * np.log(2. * np.pi * z)\r\n/root/.cache/bazel/_bazel_root/725e77151072daec43bc353cb6fcb26c/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/nn_test.runfiles/org_tensorflow/tensorflow/python/ops/nn_test.py:108: RuntimeWarning: invalid value encountered in multiply\r\n  stirling_approx = z * np.log(z) - z + 0.5 * np.log(2. * np.pi * z)\r\n................F.......\r\n======================================================================\r\nFAIL: testNaNs (__main__.ReluTest)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/root/.cache/bazel/_bazel_root/725e77151072daec43bc353cb6fcb26c/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/nn_test.runfiles/org_tensorflow/tensorflow/python/ops/nn_test.py\", line 841, in testNaNs\r\n    self.assertTrue(np.isnan(z).all())\r\nAssertionError: False is not true\r\n\r\n----------------------------------------------------------------------\r\nRan 48 tests in 7.253s\r\n\r\nFAILED (failures=1)\r\n0.0208333333333\r\n0.00566666666667\r\n0.0075\r\n0.0208333333333\r\n0.00566666666667\r\n0.0075\r\n0.0208333333333\r\n0.00566666666667\r\n0.0075\r\nL2Loss gradient err = 9.6958e-12\r\nL2Normalize gradient err = 4.2424e-08\r\nL2Normalize gradient err = 5.45829e-07\r\nL2Normalize gradient err = 7.61142e-05\r\n================================================================================\r\n\r\n```"}