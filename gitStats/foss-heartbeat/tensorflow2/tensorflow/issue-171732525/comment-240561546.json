{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/240561546", "html_url": "https://github.com/tensorflow/tensorflow/issues/3879#issuecomment-240561546", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3879", "id": 240561546, "node_id": "MDEyOklzc3VlQ29tbWVudDI0MDU2MTU0Ng==", "user": {"login": "yaroslavvb", "id": 23068, "node_id": "MDQ6VXNlcjIzMDY4", "avatar_url": "https://avatars3.githubusercontent.com/u/23068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yaroslavvb", "html_url": "https://github.com/yaroslavvb", "followers_url": "https://api.github.com/users/yaroslavvb/followers", "following_url": "https://api.github.com/users/yaroslavvb/following{/other_user}", "gists_url": "https://api.github.com/users/yaroslavvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/yaroslavvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yaroslavvb/subscriptions", "organizations_url": "https://api.github.com/users/yaroslavvb/orgs", "repos_url": "https://api.github.com/users/yaroslavvb/repos", "events_url": "https://api.github.com/users/yaroslavvb/events{/privacy}", "received_events_url": "https://api.github.com/users/yaroslavvb/received_events", "type": "User", "site_admin": false}, "created_at": "2016-08-17T21:55:38Z", "updated_at": "2016-08-17T21:55:38Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Alternatively you can replace your \"assign\" ops with \"assign_add\".<br>\nThe \"assign\" operation gets turned into variable read, add, assign. The<br>\n\"read\" op can return value either before or after the parallel assign<br>\nfinished. But with \"assign_add\", there's no separate read op so the result<br>\nshould be deterministic (possibly need to use \"use_locking=True\" option)</p>\n<p>On Wed, Aug 17, 2016 at 2:04 PM, danfei <a href=\"mailto:notifications@github.com\">notifications@github.com</a> wrote:</p>\n<blockquote>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=23068\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/yaroslavvb\">@yaroslavvb</a> <a href=\"https://github.com/yaroslavvb\">https://github.com/yaroslavvb</a> Thanks!</p>\n<p>I tried both 0.9 and 0.10. The behavior still persists.<br>\na.py:</p>\n<p>import tensorflow as tf<br>\nprint(tf.<strong>version</strong>)</p>\n<p>with tf.variable_scope('a'):<br>\na = tf.get_variable('v', [], initializer=tf.constant_initializer(0), dtype=tf.int32)<br>\na_assign = a.assign(a+100)</p>\n<p>with tf.variable_scope('a', reuse=True):<br>\nb = tf.get_variable('v', [], initializer=tf.constant_initializer(0), dtype=tf.int32)<br>\nb_assign = b.assign(b+1)</p>\n<p>with tf.control_dependencies([a_assign, b_assign]):<br>\nc = tf.constant(0)</p>\n<p>sess = tf.InteractiveSession()<br>\nsess.run(tf.initialize_all_variables())<br>\nfor _ in range(10):<br>\nprint(sess.run([c, a, b]))</p>\n<p>$python a.py</p>\n<p>0.10.0rc0<br>\n[0, 1, 1]<br>\n[0, 2, 2]<br>\n[0, 3, 3]<br>\n[0, 103, 103]<br>\n[0, 203, 203]<br>\n[0, 204, 204]<br>\n[0, 305, 305]<br>\n[0, 405, 405]<br>\n[0, 406, 406]<br>\n[0, 506, 506]</p>\n<p>\u2014<br>\nYou are receiving this because you were mentioned.<br>\nReply to this email directly, view it on GitHub<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"171732525\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/3879\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/3879/hovercard?comment_id=240547859&amp;comment_type=issue_comment\" href=\"https://github.com/tensorflow/tensorflow/issues/3879#issuecomment-240547859\">#3879 (comment)</a>,<br>\nor mute the thread<br>\n<a href=\"https://github.com/notifications/unsubscribe-auth/AABaHBBKxm4S-FsflvBZ0Ti4vdicGdb8ks5qg3dkgaJpZM4JmxLT\">https://github.com/notifications/unsubscribe-auth/AABaHBBKxm4S-FsflvBZ0Ti4vdicGdb8ks5qg3dkgaJpZM4JmxLT</a><br>\n.</p>\n</blockquote>", "body_text": "Alternatively you can replace your \"assign\" ops with \"assign_add\".\nThe \"assign\" operation gets turned into variable read, add, assign. The\n\"read\" op can return value either before or after the parallel assign\nfinished. But with \"assign_add\", there's no separate read op so the result\nshould be deterministic (possibly need to use \"use_locking=True\" option)\nOn Wed, Aug 17, 2016 at 2:04 PM, danfei notifications@github.com wrote:\n\n@yaroslavvb https://github.com/yaroslavvb Thanks!\nI tried both 0.9 and 0.10. The behavior still persists.\na.py:\nimport tensorflow as tf\nprint(tf.version)\nwith tf.variable_scope('a'):\na = tf.get_variable('v', [], initializer=tf.constant_initializer(0), dtype=tf.int32)\na_assign = a.assign(a+100)\nwith tf.variable_scope('a', reuse=True):\nb = tf.get_variable('v', [], initializer=tf.constant_initializer(0), dtype=tf.int32)\nb_assign = b.assign(b+1)\nwith tf.control_dependencies([a_assign, b_assign]):\nc = tf.constant(0)\nsess = tf.InteractiveSession()\nsess.run(tf.initialize_all_variables())\nfor _ in range(10):\nprint(sess.run([c, a, b]))\n$python a.py\n0.10.0rc0\n[0, 1, 1]\n[0, 2, 2]\n[0, 3, 3]\n[0, 103, 103]\n[0, 203, 203]\n[0, 204, 204]\n[0, 305, 305]\n[0, 405, 405]\n[0, 406, 406]\n[0, 506, 506]\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\n#3879 (comment),\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AABaHBBKxm4S-FsflvBZ0Ti4vdicGdb8ks5qg3dkgaJpZM4JmxLT\n.", "body": "Alternatively you can replace your \"assign\" ops with \"assign_add\".\nThe \"assign\" operation gets turned into variable read, add, assign. The\n\"read\" op can return value either before or after the parallel assign\nfinished. But with \"assign_add\", there's no separate read op so the result\nshould be deterministic (possibly need to use \"use_locking=True\" option)\n\nOn Wed, Aug 17, 2016 at 2:04 PM, danfei notifications@github.com wrote:\n\n> @yaroslavvb https://github.com/yaroslavvb Thanks!\n> \n> I tried both 0.9 and 0.10. The behavior still persists.\n> a.py:\n> \n> import tensorflow as tf\n> print(tf.**version**)\n> \n> with tf.variable_scope('a'):\n>     a = tf.get_variable('v', [], initializer=tf.constant_initializer(0), dtype=tf.int32)\n>     a_assign = a.assign(a+100)\n> \n> with tf.variable_scope('a', reuse=True):\n>     b = tf.get_variable('v', [], initializer=tf.constant_initializer(0), dtype=tf.int32)\n>     b_assign = b.assign(b+1)\n> \n> with tf.control_dependencies([a_assign, b_assign]):\n>     c = tf.constant(0)\n> \n> sess = tf.InteractiveSession()\n> sess.run(tf.initialize_all_variables())\n> for _ in range(10):\n>     print(sess.run([c, a, b]))\n> \n> $python a.py\n> \n> 0.10.0rc0\n> [0, 1, 1]\n> [0, 2, 2]\n> [0, 3, 3]\n> [0, 103, 103]\n> [0, 203, 203]\n> [0, 204, 204]\n> [0, 305, 305]\n> [0, 405, 405]\n> [0, 406, 406]\n> [0, 506, 506]\n> \n> \u2014\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> https://github.com/tensorflow/tensorflow/issues/3879#issuecomment-240547859,\n> or mute the thread\n> https://github.com/notifications/unsubscribe-auth/AABaHBBKxm4S-FsflvBZ0Ti4vdicGdb8ks5qg3dkgaJpZM4JmxLT\n> .\n"}