{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12205", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12205/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12205/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12205/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/12205", "id": 249567261, "node_id": "MDU6SXNzdWUyNDk1NjcyNjE=", "number": 12205, "title": "BUG: TypeError in DNNClassifier.eval() when using same name for feature in feature_engineering_fn", "user": {"login": "facaiy", "id": 1112263, "node_id": "MDQ6VXNlcjExMTIyNjM=", "avatar_url": "https://avatars3.githubusercontent.com/u/1112263?v=4", "gravatar_id": "", "url": "https://api.github.com/users/facaiy", "html_url": "https://github.com/facaiy", "followers_url": "https://api.github.com/users/facaiy/followers", "following_url": "https://api.github.com/users/facaiy/following{/other_user}", "gists_url": "https://api.github.com/users/facaiy/gists{/gist_id}", "starred_url": "https://api.github.com/users/facaiy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/facaiy/subscriptions", "organizations_url": "https://api.github.com/users/facaiy/orgs", "repos_url": "https://api.github.com/users/facaiy/repos", "events_url": "https://api.github.com/users/facaiy/events{/privacy}", "received_events_url": "https://api.github.com/users/facaiy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "facaiy", "id": 1112263, "node_id": "MDQ6VXNlcjExMTIyNjM=", "avatar_url": "https://avatars3.githubusercontent.com/u/1112263?v=4", "gravatar_id": "", "url": "https://api.github.com/users/facaiy", "html_url": "https://github.com/facaiy", "followers_url": "https://api.github.com/users/facaiy/followers", "following_url": "https://api.github.com/users/facaiy/following{/other_user}", "gists_url": "https://api.github.com/users/facaiy/gists{/gist_id}", "starred_url": "https://api.github.com/users/facaiy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/facaiy/subscriptions", "organizations_url": "https://api.github.com/users/facaiy/orgs", "repos_url": "https://api.github.com/users/facaiy/repos", "events_url": "https://api.github.com/users/facaiy/events{/privacy}", "received_events_url": "https://api.github.com/users/facaiy/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "facaiy", "id": 1112263, "node_id": "MDQ6VXNlcjExMTIyNjM=", "avatar_url": "https://avatars3.githubusercontent.com/u/1112263?v=4", "gravatar_id": "", "url": "https://api.github.com/users/facaiy", "html_url": "https://github.com/facaiy", "followers_url": "https://api.github.com/users/facaiy/followers", "following_url": "https://api.github.com/users/facaiy/following{/other_user}", "gists_url": "https://api.github.com/users/facaiy/gists{/gist_id}", "starred_url": "https://api.github.com/users/facaiy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/facaiy/subscriptions", "organizations_url": "https://api.github.com/users/facaiy/orgs", "repos_url": "https://api.github.com/users/facaiy/repos", "events_url": "https://api.github.com/users/facaiy/events{/privacy}", "received_events_url": "https://api.github.com/users/facaiy/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2017-08-11T08:21:10Z", "updated_at": "2017-08-21T23:56:32Z", "closed_at": "2017-08-21T23:56:32Z", "author_association": "MEMBER", "body_html": "<h3>Describe the problem</h3>\n<p>If we use the  same key to replace a feature, tensorflow might throw TypeError when evaluating:</p>\n<p>eg:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">def</span> <span class=\"pl-en\">feature_engineering_fn</span>(<span class=\"pl-smi\">features</span>, <span class=\"pl-smi\">label</span>):\n  features[<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>x<span class=\"pl-pds\">\"</span></span>] <span class=\"pl-k\">=</span> some_func(features[<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>x<span class=\"pl-pds\">\"</span></span>])</pre></div>\n<p>When <code>features</code> is <code>dict</code>, it is a mutable object. Hence the bug is caused by <code>evaluate</code> method which runs <code>feature_engineering_fn</code> again, see <a href=\"https://github.com/facaiy/tensorflow/blob/c7b80d51da4fb6d51ea54a0bdf2601afa379d60c/tensorflow/contrib/learn/python/learn/estimators/estimator.py#L1165\">code</a>.</p>\n<p>I'll open a PR later.</p>", "body_text": "Describe the problem\nIf we use the  same key to replace a feature, tensorflow might throw TypeError when evaluating:\neg:\ndef feature_engineering_fn(features, label):\n  features[\"x\"] = some_func(features[\"x\"])\nWhen features is dict, it is a mutable object. Hence the bug is caused by evaluate method which runs feature_engineering_fn again, see code.\nI'll open a PR later.", "body": "### Describe the problem\r\n\r\nIf we use the  same key to replace a feature, tensorflow might throw TypeError when evaluating:\r\n\r\neg:\r\n```python\r\ndef feature_engineering_fn(features, label):\r\n  features[\"x\"] = some_func(features[\"x\"])\r\n```\r\n\r\nWhen `features` is `dict`, it is a mutable object. Hence the bug is caused by `evaluate` method which runs `feature_engineering_fn` again, see [code](https://github.com/facaiy/tensorflow/blob/c7b80d51da4fb6d51ea54a0bdf2601afa379d60c/tensorflow/contrib/learn/python/learn/estimators/estimator.py#L1165).\r\n\r\nI'll open a PR later.\r\n"}