{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/903", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/903/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/903/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/903/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/903", "id": 129067456, "node_id": "MDU6SXNzdWUxMjkwNjc0NTY=", "number": 903, "title": "Wrong Momentum Equation in Tensorflow's Kernel", "user": {"login": "eduardo-elizondo", "id": 5315899, "node_id": "MDQ6VXNlcjUzMTU4OTk=", "avatar_url": "https://avatars3.githubusercontent.com/u/5315899?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eduardo-elizondo", "html_url": "https://github.com/eduardo-elizondo", "followers_url": "https://api.github.com/users/eduardo-elizondo/followers", "following_url": "https://api.github.com/users/eduardo-elizondo/following{/other_user}", "gists_url": "https://api.github.com/users/eduardo-elizondo/gists{/gist_id}", "starred_url": "https://api.github.com/users/eduardo-elizondo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eduardo-elizondo/subscriptions", "organizations_url": "https://api.github.com/users/eduardo-elizondo/orgs", "repos_url": "https://api.github.com/users/eduardo-elizondo/repos", "events_url": "https://api.github.com/users/eduardo-elizondo/events{/privacy}", "received_events_url": "https://api.github.com/users/eduardo-elizondo/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-01-27T08:19:58Z", "updated_at": "2016-01-28T06:30:33Z", "closed_at": "2016-01-28T03:29:36Z", "author_association": "NONE", "body_html": "<p>I believe I found a slight error in the multiplication of the learning rate</p>\n<p>Momentum Optimization has the form:<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://cloud.githubusercontent.com/assets/5315899/12606885/98bc9276-c496-11e5-8bfc-0b887bfaef71.png\"><img src=\"https://cloud.githubusercontent.com/assets/5315899/12606885/98bc9276-c496-11e5-8bfc-0b887bfaef71.png\" alt=\"brahms_cpmc_columbia_edu_publications_momentum_pdf\" style=\"max-width:100%;\"></a><br>\nWhere epsilon is the learning rate and p is the momentum.<br>\nReference: Ning Qian's Momentum Paper (1999) <a href=\"http://brahms.cpmc.columbia.edu/publications/momentum.pdf\" rel=\"nofollow\">http://brahms.cpmc.columbia.edu/publications/momentum.pdf</a></p>\n<p>In tensorflow/core/kernel/training_ops.cc, lines 68 and 69 (ApplyMomentum) we find:</p>\n<div class=\"highlight highlight-source-c++\"><pre>accum = accum * <span class=\"pl-en\">momentum</span>() + grad;\nvar -= accum * <span class=\"pl-en\">lr</span>();</pre></div>\n<p>Expanding this, we get:</p>\n<div class=\"highlight highlight-source-c++\"><pre>var -= (accum*<span class=\"pl-en\">momentum</span>() + grad) * lr();\n<span class=\"pl-c\"><span class=\"pl-c\">//</span> =&gt;</span>\nvar -= accum*<span class=\"pl-en\">momentum</span>()*lr() + grad*lr();</pre></div>\n<p>Notice how the momentum variable is being multiplied by the learning rate, but this should not be the case. The correct form is:</p>\n<div class=\"highlight highlight-source-c++\"><pre>accum = accum * <span class=\"pl-en\">momentum</span>() + grad * lr();\nvar -= accum;</pre></div>\n<p>Here's my pull request fixing this: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"129067639\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/904\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/904/hovercard\" href=\"https://github.com/tensorflow/tensorflow/pull/904\">#904</a></p>", "body_text": "I believe I found a slight error in the multiplication of the learning rate\nMomentum Optimization has the form:\n\nWhere epsilon is the learning rate and p is the momentum.\nReference: Ning Qian's Momentum Paper (1999) http://brahms.cpmc.columbia.edu/publications/momentum.pdf\nIn tensorflow/core/kernel/training_ops.cc, lines 68 and 69 (ApplyMomentum) we find:\naccum = accum * momentum() + grad;\nvar -= accum * lr();\nExpanding this, we get:\nvar -= (accum*momentum() + grad) * lr();\n// =>\nvar -= accum*momentum()*lr() + grad*lr();\nNotice how the momentum variable is being multiplied by the learning rate, but this should not be the case. The correct form is:\naccum = accum * momentum() + grad * lr();\nvar -= accum;\nHere's my pull request fixing this: #904", "body": "I believe I found a slight error in the multiplication of the learning rate\n\nMomentum Optimization has the form:\n![brahms_cpmc_columbia_edu_publications_momentum_pdf](https://cloud.githubusercontent.com/assets/5315899/12606885/98bc9276-c496-11e5-8bfc-0b887bfaef71.png)\nWhere epsilon is the learning rate and p is the momentum.\nReference: Ning Qian's Momentum Paper (1999) http://brahms.cpmc.columbia.edu/publications/momentum.pdf\n\nIn tensorflow/core/kernel/training_ops.cc, lines 68 and 69 (ApplyMomentum) we find:\n\n``` c++\naccum = accum * momentum() + grad;\nvar -= accum * lr();\n```\n\nExpanding this, we get:\n\n``` c++\nvar -= (accum*momentum() + grad) * lr();\n// =>\nvar -= accum*momentum()*lr() + grad*lr();\n```\n\nNotice how the momentum variable is being multiplied by the learning rate, but this should not be the case. The correct form is:\n\n``` c++\naccum = accum * momentum() + grad * lr();\nvar -= accum;\n```\n\nHere's my pull request fixing this: #904 \n"}