{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/428428639", "html_url": "https://github.com/tensorflow/tensorflow/pull/22851#issuecomment-428428639", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22851", "id": 428428639, "node_id": "MDEyOklzc3VlQ29tbWVudDQyODQyODYzOQ==", "user": {"login": "scttl", "id": 30309, "node_id": "MDQ6VXNlcjMwMzA5", "avatar_url": "https://avatars3.githubusercontent.com/u/30309?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scttl", "html_url": "https://github.com/scttl", "followers_url": "https://api.github.com/users/scttl/followers", "following_url": "https://api.github.com/users/scttl/following{/other_user}", "gists_url": "https://api.github.com/users/scttl/gists{/gist_id}", "starred_url": "https://api.github.com/users/scttl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scttl/subscriptions", "organizations_url": "https://api.github.com/users/scttl/orgs", "repos_url": "https://api.github.com/users/scttl/repos", "events_url": "https://api.github.com/users/scttl/events{/privacy}", "received_events_url": "https://api.github.com/users/scttl/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-10T03:48:39Z", "updated_at": "2018-10-10T03:48:39Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Yes.  Per the <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/docker/Dockerfile.devel-mkl\">Dockerfile</a> the build happens via <code>RUN tensorflow/tools/ci_build/builds/configured CPU bazel --bazelrc=/root/.bazelrc</code> so its looking at <code>/root/.bazelrc</code> for options.</p>\n<p>This file gets built from the <code>COPY .bazelrc /root/.bazelrc</code> line and the <code>.bazelrc</code> being copied into the container is the one on the <strong>host</strong> constructed as part of <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/docker/parameterized_docker_build.sh#L373\">this line</a> in <code>parameterized_docker_build.sh</code>.</p>\n<p>The content of <code>TF_BAZEL_BUILD_OPTIONS</code> is being set based on <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/ci_build/linux/mkl/build-dev-container.sh#L39\">this line</a> and then <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/ci_build/linux/mkl/build-dev-container.sh#L73\">this line for avx2</a> of <code>build-dev-container.sh</code> so the entire contents of <code>/root/.bazelrc</code> being passed to the build will look something like:</p>\n<pre><code>build --config=mkl --copt=-march=haswell --copt=-mtune=broadwell --copt=-O3 --cxxopt=-D_GLIBCXX_USE_CXX11_ABI=0\n</code></pre>\n<p>and the local in-container <code>.bazelrc</code> (and <code>.tf_configure.bazelrc</code>) generated as output from <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/docker/Dockerfile.devel-mkl#L117\">this line</a> are completely ignored.</p>", "body_text": "Yes.  Per the Dockerfile the build happens via RUN tensorflow/tools/ci_build/builds/configured CPU bazel --bazelrc=/root/.bazelrc so its looking at /root/.bazelrc for options.\nThis file gets built from the COPY .bazelrc /root/.bazelrc line and the .bazelrc being copied into the container is the one on the host constructed as part of this line in parameterized_docker_build.sh.\nThe content of TF_BAZEL_BUILD_OPTIONS is being set based on this line and then this line for avx2 of build-dev-container.sh so the entire contents of /root/.bazelrc being passed to the build will look something like:\nbuild --config=mkl --copt=-march=haswell --copt=-mtune=broadwell --copt=-O3 --cxxopt=-D_GLIBCXX_USE_CXX11_ABI=0\n\nand the local in-container .bazelrc (and .tf_configure.bazelrc) generated as output from this line are completely ignored.", "body": "Yes.  Per the [Dockerfile](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/docker/Dockerfile.devel-mkl) the build happens via `RUN tensorflow/tools/ci_build/builds/configured CPU bazel --bazelrc=/root/.bazelrc` so its looking at `/root/.bazelrc` for options.\r\n\r\nThis file gets built from the `COPY .bazelrc /root/.bazelrc` line and the `.bazelrc` being copied into the container is the one on the **host** constructed as part of [this line](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/docker/parameterized_docker_build.sh#L373) in `parameterized_docker_build.sh`.\r\n\r\nThe content of `TF_BAZEL_BUILD_OPTIONS` is being set based on [this line](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/ci_build/linux/mkl/build-dev-container.sh#L39) and then [this line for avx2](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/ci_build/linux/mkl/build-dev-container.sh#L73) of `build-dev-container.sh` so the entire contents of `/root/.bazelrc` being passed to the build will look something like:\r\n```\r\nbuild --config=mkl --copt=-march=haswell --copt=-mtune=broadwell --copt=-O3 --cxxopt=-D_GLIBCXX_USE_CXX11_ABI=0\r\n```\r\n\r\nand the local in-container `.bazelrc` (and `.tf_configure.bazelrc`) generated as output from [this line](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/docker/Dockerfile.devel-mkl#L117) are completely ignored."}