{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17047", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17047/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17047/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17047/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/17047", "id": 297488935, "node_id": "MDU6SXNzdWUyOTc0ODg5MzU=", "number": 17047, "title": "Failing assertion when building with MKL and using Xception", "user": {"login": "abiro", "id": 5764438, "node_id": "MDQ6VXNlcjU3NjQ0Mzg=", "avatar_url": "https://avatars0.githubusercontent.com/u/5764438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abiro", "html_url": "https://github.com/abiro", "followers_url": "https://api.github.com/users/abiro/followers", "following_url": "https://api.github.com/users/abiro/following{/other_user}", "gists_url": "https://api.github.com/users/abiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/abiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abiro/subscriptions", "organizations_url": "https://api.github.com/users/abiro/orgs", "repos_url": "https://api.github.com/users/abiro/repos", "events_url": "https://api.github.com/users/abiro/events{/privacy}", "received_events_url": "https://api.github.com/users/abiro/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2018-02-15T15:33:48Z", "updated_at": "2018-05-09T10:25:27Z", "closed_at": "2018-05-09T10:25:27Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:<br>\nYes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nLinux Ubuntu 16.04.3 LTS</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>:<br>\nSource</li>\n<li><strong>TensorFlow version (use command below)</strong>:<br>\nv1.6.0-rc0-19-gecec1d8</li>\n<li><strong>Python version</strong>:<br>\nPython 2.7.12</li>\n<li><strong>Bazel version (if compiling from source)</strong>:<br>\nBazel 0.8.0</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>:<br>\ngcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.5)</li>\n<li><strong>CUDA/cuDNN version</strong>:<br>\nNone</li>\n<li><strong>GPU model and memory</strong>:<br>\nNone</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<ol>\n<li>Get the Dockerfile from here: <a href=\"https://gist.github.com/abiro/c155a8107879d9c4e0368f3c3e94ea81\">https://gist.github.com/abiro/c155a8107879d9c4e0368f3c3e94ea81</a></li>\n<li>Build with the MKL library: <code>docker build -t tf_mkl -f Dockerfile.devel-cpu-mkl .</code></li>\n<li>Build without the MKL library: <code>docker build -t tf_nomkl -f Dockerfile.devel-cpu-mkl --build-arg MKL_FLAG=0 .</code></li>\n<li>Run image built with the MKL library: <code>docker run tf_mkl</code><br>\nResult: error (see output below)</li>\n<li>Run image built without the MKL library: <code>docker run tf_nomkl</code><br>\nResult: no error</li>\n</ol>\n<h3>Describe the problem</h3>\n<p>When building TensorFlow 1.6 with the MKL library, inference with the Xception model results in a failing assertion and the program exits. See the error message and the code below please. The Dockerfile linked above contains the source code and can be used to easily reproduce the problem.</p>\n<h3>Source code / logs</h3>\n<h4>Source code</h4>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n<span class=\"pl-k\">import</span> numpy <span class=\"pl-k\">as</span> np\n\nx <span class=\"pl-k\">=</span> tf.keras.applications.xception.Xception(<span class=\"pl-v\">weights</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>xception_weights.h5<span class=\"pl-pds\">\"</span></span>)\nx.predict(np.zeros((<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">299</span>, <span class=\"pl-c1\">299</span>, <span class=\"pl-c1\">3</span>)), <span class=\"pl-v\">batch_size</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">1</span>)</pre></div>\n<h4>Logs</h4>\n<p>Step 4 from above outputs the following:</p>\n<blockquote>\n<p>2018-02-15 15:04:26.610461: F tensorflow/core/kernels/mkl_input_conversion_op.cc:448] Check failed: tf_input.CheckReorderToOpMem( memory::primitive_desc(output_mkl_md, cpu_engine), tensor_out, &amp;net) == true (0 vs. 1)<br>\nAborted (core dumped)</p>\n</blockquote>\n<h4>Misc</h4>\n<p>The host machine used to build and run the Docker containers was an EC2 c4.2xlarge instance with an Intel(R) Xeon(R) CPU E5-2666 v3 @ 2.90GHz processor.</p>\n<p>Related to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"296759636\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/16982\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/16982/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/16982\">#16982</a></p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nYes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nLinux Ubuntu 16.04.3 LTS\nTensorFlow installed from (source or binary):\nSource\nTensorFlow version (use command below):\nv1.6.0-rc0-19-gecec1d8\nPython version:\nPython 2.7.12\nBazel version (if compiling from source):\nBazel 0.8.0\nGCC/Compiler version (if compiling from source):\ngcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.5)\nCUDA/cuDNN version:\nNone\nGPU model and memory:\nNone\nExact command to reproduce:\n\n\nGet the Dockerfile from here: https://gist.github.com/abiro/c155a8107879d9c4e0368f3c3e94ea81\nBuild with the MKL library: docker build -t tf_mkl -f Dockerfile.devel-cpu-mkl .\nBuild without the MKL library: docker build -t tf_nomkl -f Dockerfile.devel-cpu-mkl --build-arg MKL_FLAG=0 .\nRun image built with the MKL library: docker run tf_mkl\nResult: error (see output below)\nRun image built without the MKL library: docker run tf_nomkl\nResult: no error\n\nDescribe the problem\nWhen building TensorFlow 1.6 with the MKL library, inference with the Xception model results in a failing assertion and the program exits. See the error message and the code below please. The Dockerfile linked above contains the source code and can be used to easily reproduce the problem.\nSource code / logs\nSource code\nimport tensorflow as tf\nimport numpy as np\n\nx = tf.keras.applications.xception.Xception(weights=\"xception_weights.h5\")\nx.predict(np.zeros((1, 299, 299, 3)), batch_size=1)\nLogs\nStep 4 from above outputs the following:\n\n2018-02-15 15:04:26.610461: F tensorflow/core/kernels/mkl_input_conversion_op.cc:448] Check failed: tf_input.CheckReorderToOpMem( memory::primitive_desc(output_mkl_md, cpu_engine), tensor_out, &net) == true (0 vs. 1)\nAborted (core dumped)\n\nMisc\nThe host machine used to build and run the Docker containers was an EC2 c4.2xlarge instance with an Intel(R) Xeon(R) CPU E5-2666 v3 @ 2.90GHz processor.\nRelated to #16982", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\nYes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\nLinux Ubuntu 16.04.3 LTS\r\n- **TensorFlow installed from (source or binary)**:\r\nSource\r\n- **TensorFlow version (use command below)**:\r\nv1.6.0-rc0-19-gecec1d8\r\n- **Python version**: \r\nPython 2.7.12\r\n- **Bazel version (if compiling from source)**:\r\nBazel 0.8.0\r\n- **GCC/Compiler version (if compiling from source)**:\r\ngcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.5)\r\n- **CUDA/cuDNN version**:\r\nNone\r\n- **GPU model and memory**:\r\nNone\r\n- **Exact command to reproduce**:\r\n1. Get the Dockerfile from here: https://gist.github.com/abiro/c155a8107879d9c4e0368f3c3e94ea81\r\n2. Build with the MKL library: `docker build -t tf_mkl -f Dockerfile.devel-cpu-mkl .`\r\n3. Build without the MKL library: `docker build -t tf_nomkl -f Dockerfile.devel-cpu-mkl --build-arg MKL_FLAG=0 .`\r\n3. Run image built with the MKL library: `docker run tf_mkl`\r\nResult: error (see output below)\r\n4. Run image built without the MKL library: `docker run tf_nomkl`\r\nResult: no error\r\n\r\n### Describe the problem\r\nWhen building TensorFlow 1.6 with the MKL library, inference with the Xception model results in a failing assertion and the program exits. See the error message and the code below please. The Dockerfile linked above contains the source code and can be used to easily reproduce the problem.\r\n\r\n### Source code / logs\r\n#### Source code\r\n```python\r\nimport tensorflow as tf\r\nimport numpy as np\r\n\r\nx = tf.keras.applications.xception.Xception(weights=\"xception_weights.h5\")\r\nx.predict(np.zeros((1, 299, 299, 3)), batch_size=1)\r\n```\r\n\r\n#### Logs\r\nStep 4 from above outputs the following:\r\n>2018-02-15 15:04:26.610461: F tensorflow/core/kernels/mkl_input_conversion_op.cc:448] Check failed: tf_input.CheckReorderToOpMem( memory::primitive_desc(output_mkl_md, cpu_engine), tensor_out, &net) == true (0 vs. 1)\r\nAborted (core dumped)\r\n\r\n#### Misc\r\nThe host machine used to build and run the Docker containers was an EC2 c4.2xlarge instance with an Intel(R) Xeon(R) CPU E5-2666 v3 @ 2.90GHz processor.\r\n\r\nRelated to #16982"}