{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6551", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6551/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6551/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6551/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/6551", "id": 197943957, "node_id": "MDU6SXNzdWUxOTc5NDM5NTc=", "number": 6551, "title": "Can't restore a partitioned variable", "user": {"login": "IgorWang", "id": 10041387, "node_id": "MDQ6VXNlcjEwMDQxMzg3", "avatar_url": "https://avatars1.githubusercontent.com/u/10041387?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IgorWang", "html_url": "https://github.com/IgorWang", "followers_url": "https://api.github.com/users/IgorWang/followers", "following_url": "https://api.github.com/users/IgorWang/following{/other_user}", "gists_url": "https://api.github.com/users/IgorWang/gists{/gist_id}", "starred_url": "https://api.github.com/users/IgorWang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IgorWang/subscriptions", "organizations_url": "https://api.github.com/users/IgorWang/orgs", "repos_url": "https://api.github.com/users/IgorWang/repos", "events_url": "https://api.github.com/users/IgorWang/events{/privacy}", "received_events_url": "https://api.github.com/users/IgorWang/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-12-29T02:23:18Z", "updated_at": "2017-06-16T20:30:12Z", "closed_at": "2017-06-16T20:29:50Z", "author_association": "NONE", "body_html": "<p>I have a large matrix.</p>\n<p>I use bellow method create this variable as number of shards.</p>\n<pre><code>softmax_w = tf.get_variable(\"softmax_w\", [hps.vocab_size, hps.projected_size],\n                            partitioner=tf.fixed_size_partitioner(hps.num_shards, 0))\n</code></pre>\n<p>create log:</p>\n<pre><code>model/softmax_w/part_0:0 (99184, 512) /cpu:0\nmodel/softmax_w/part_1:0 (99184, 512) /cpu:0\nmodel/softmax_w/part_2:0 (99184, 512) /cpu:0\nmodel/softmax_w/part_3:0 (99184, 512) /cpu:0\nmodel/softmax_w/part_4:0 (99184, 512) /cpu:0\nmodel/softmax_w/part_5:0 (99184, 512) /cpu:0\nmodel/softmax_w/part_6:0 (99183, 512) /cpu:0\nmodel/softmax_w/part_7:0 (99183, 512) /cpu:0\n</code></pre>\n<p>I can training and save it success. But when I try to restore model I got this error:</p>\n<p>restore log</p>\n<pre><code>W tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_7 not found in checkpoint\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_6 not found in checkpoint\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_5 not found in checkpoint\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_4 not found in checkpoint\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_3 not found in checkpoint\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_2 not found in checkpoint\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_1 not found in checkpoint\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_0 not found in checkpoint\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_7 not found in checkpoint\n</code></pre>\n<p>I found tensorflow save the variable as a whole part. The saved parameter just have one softmax_w. No longer a partitioned variable, I can use bellow code restore that variable.</p>\n<pre><code>softmax_w = tf.get_variable(\"softmax_w\", [hps.vocab_size, hps.projected_size])\n</code></pre>", "body_text": "I have a large matrix.\nI use bellow method create this variable as number of shards.\nsoftmax_w = tf.get_variable(\"softmax_w\", [hps.vocab_size, hps.projected_size],\n                            partitioner=tf.fixed_size_partitioner(hps.num_shards, 0))\n\ncreate log:\nmodel/softmax_w/part_0:0 (99184, 512) /cpu:0\nmodel/softmax_w/part_1:0 (99184, 512) /cpu:0\nmodel/softmax_w/part_2:0 (99184, 512) /cpu:0\nmodel/softmax_w/part_3:0 (99184, 512) /cpu:0\nmodel/softmax_w/part_4:0 (99184, 512) /cpu:0\nmodel/softmax_w/part_5:0 (99184, 512) /cpu:0\nmodel/softmax_w/part_6:0 (99183, 512) /cpu:0\nmodel/softmax_w/part_7:0 (99183, 512) /cpu:0\n\nI can training and save it success. But when I try to restore model I got this error:\nrestore log\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_7 not found in checkpoint\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_6 not found in checkpoint\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_5 not found in checkpoint\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_4 not found in checkpoint\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_3 not found in checkpoint\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_2 not found in checkpoint\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_1 not found in checkpoint\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_0 not found in checkpoint\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_7 not found in checkpoint\n\nI found tensorflow save the variable as a whole part. The saved parameter just have one softmax_w. No longer a partitioned variable, I can use bellow code restore that variable.\nsoftmax_w = tf.get_variable(\"softmax_w\", [hps.vocab_size, hps.projected_size])", "body": "I have a large matrix.\r\n\r\nI use bellow method create this variable as number of shards.\r\n```\r\nsoftmax_w = tf.get_variable(\"softmax_w\", [hps.vocab_size, hps.projected_size],\r\n                            partitioner=tf.fixed_size_partitioner(hps.num_shards, 0))\r\n```\r\ncreate log:\r\n```\r\nmodel/softmax_w/part_0:0 (99184, 512) /cpu:0\r\nmodel/softmax_w/part_1:0 (99184, 512) /cpu:0\r\nmodel/softmax_w/part_2:0 (99184, 512) /cpu:0\r\nmodel/softmax_w/part_3:0 (99184, 512) /cpu:0\r\nmodel/softmax_w/part_4:0 (99184, 512) /cpu:0\r\nmodel/softmax_w/part_5:0 (99184, 512) /cpu:0\r\nmodel/softmax_w/part_6:0 (99183, 512) /cpu:0\r\nmodel/softmax_w/part_7:0 (99183, 512) /cpu:0\r\n```\r\nI can training and save it success. But when I try to restore model I got this error:\r\n\r\nrestore log\r\n```\r\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_7 not found in checkpoint\r\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_6 not found in checkpoint\r\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_5 not found in checkpoint\r\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_4 not found in checkpoint\r\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_3 not found in checkpoint\r\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_2 not found in checkpoint\r\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_1 not found in checkpoint\r\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_0 not found in checkpoint\r\nW tensorflow/core/framework/op_kernel.cc:975] Not found: Key model/softmax_w/part_7 not found in checkpoint\r\n```\r\n\r\nI found tensorflow save the variable as a whole part. The saved parameter just have one softmax_w. No longer a partitioned variable, I can use bellow code restore that variable. \r\n```\r\nsoftmax_w = tf.get_variable(\"softmax_w\", [hps.vocab_size, hps.projected_size])\r\n```"}