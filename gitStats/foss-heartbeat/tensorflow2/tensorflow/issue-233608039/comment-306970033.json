{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/306970033", "html_url": "https://github.com/tensorflow/tensorflow/issues/10437#issuecomment-306970033", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10437", "id": 306970033, "node_id": "MDEyOklzc3VlQ29tbWVudDMwNjk3MDAzMw==", "user": {"login": "hawkinsp", "id": 348932, "node_id": "MDQ6VXNlcjM0ODkzMg==", "avatar_url": "https://avatars0.githubusercontent.com/u/348932?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hawkinsp", "html_url": "https://github.com/hawkinsp", "followers_url": "https://api.github.com/users/hawkinsp/followers", "following_url": "https://api.github.com/users/hawkinsp/following{/other_user}", "gists_url": "https://api.github.com/users/hawkinsp/gists{/gist_id}", "starred_url": "https://api.github.com/users/hawkinsp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hawkinsp/subscriptions", "organizations_url": "https://api.github.com/users/hawkinsp/orgs", "repos_url": "https://api.github.com/users/hawkinsp/repos", "events_url": "https://api.github.com/users/hawkinsp/events{/privacy}", "received_events_url": "https://api.github.com/users/hawkinsp/received_events", "type": "User", "site_admin": false}, "created_at": "2017-06-08T01:16:04Z", "updated_at": "2017-06-08T01:16:04Z", "author_association": "MEMBER", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=2188479\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/adityaatluri\">@adityaatluri</a> I have a pending change that adds bazel build rules for the AMDGPU LLVM backend that should land in the next few days. That takes care of building the backend.</p>\n<p>Once that it is landed, you will need to do at least these three things to use the backend:<br>\na) uncomment <code>\"AMDGPU\"</code> in the <code>llvm_targets</code> list at the top of the build file.<br>\nIt will appear roughly here once the change lands:<br>\n<a href=\"https://github.com/tensorflow/tensorflow/blob/master/third_party/llvm/llvm.BUILD#L25\">https://github.com/tensorflow/tensorflow/blob/master/third_party/llvm/llvm.BUILD#L25</a><br>\nI left it commented out for now to avoid making builds longer since there are no actual users yet.</p>\n<p>b) add a bazel build dependency on <code>\"@llvm//:amdgpu_target\"</code> from somewhere.<br>\nc) add a call to <code>LLVMInitializeAMDGPUTarget()</code>.</p>\n<p>Note that (c) is essential --- if a symbol is not used then bazel will strip it from the binary. That's probably what's going wrong with your attempt.</p>\n<p>As an experiment I added such a call here: <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/compiler/xla/service/cpu/cpu_compiler.cc#L127\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/compiler/xla/service/cpu/cpu_compiler.cc#L127</a><br>\nand I verified that LLVMInitializeAMDGPUTarget was present in the pywrap_tensorflow.so symbols. (Obviously the XLA <em>CPU</em> plugin isn't the right place in reality --- you really want to add it to the GPU plugin or add a separate AMDGPU plugin, depending on how similar you expect the two to be.)</p>", "body_text": "@adityaatluri I have a pending change that adds bazel build rules for the AMDGPU LLVM backend that should land in the next few days. That takes care of building the backend.\nOnce that it is landed, you will need to do at least these three things to use the backend:\na) uncomment \"AMDGPU\" in the llvm_targets list at the top of the build file.\nIt will appear roughly here once the change lands:\nhttps://github.com/tensorflow/tensorflow/blob/master/third_party/llvm/llvm.BUILD#L25\nI left it commented out for now to avoid making builds longer since there are no actual users yet.\nb) add a bazel build dependency on \"@llvm//:amdgpu_target\" from somewhere.\nc) add a call to LLVMInitializeAMDGPUTarget().\nNote that (c) is essential --- if a symbol is not used then bazel will strip it from the binary. That's probably what's going wrong with your attempt.\nAs an experiment I added such a call here: https://github.com/tensorflow/tensorflow/blob/master/tensorflow/compiler/xla/service/cpu/cpu_compiler.cc#L127\nand I verified that LLVMInitializeAMDGPUTarget was present in the pywrap_tensorflow.so symbols. (Obviously the XLA CPU plugin isn't the right place in reality --- you really want to add it to the GPU plugin or add a separate AMDGPU plugin, depending on how similar you expect the two to be.)", "body": "@adityaatluri I have a pending change that adds bazel build rules for the AMDGPU LLVM backend that should land in the next few days. That takes care of building the backend.\r\n\r\nOnce that it is landed, you will need to do at least these three things to use the backend:\r\na) uncomment `\"AMDGPU\"` in the `llvm_targets` list at the top of the build file.\r\nIt will appear roughly here once the change lands:\r\nhttps://github.com/tensorflow/tensorflow/blob/master/third_party/llvm/llvm.BUILD#L25\r\nI left it commented out for now to avoid making builds longer since there are no actual users yet.\r\n\r\nb) add a bazel build dependency on `\"@llvm//:amdgpu_target\"` from somewhere.\r\nc) add a call to `LLVMInitializeAMDGPUTarget()`.\r\n\r\nNote that (c) is essential --- if a symbol is not used then bazel will strip it from the binary. That's probably what's going wrong with your attempt.\r\n\r\nAs an experiment I added such a call here: https://github.com/tensorflow/tensorflow/blob/master/tensorflow/compiler/xla/service/cpu/cpu_compiler.cc#L127\r\nand I verified that LLVMInitializeAMDGPUTarget was present in the pywrap_tensorflow.so symbols. (Obviously the XLA *CPU* plugin isn't the right place in reality --- you really want to add it to the GPU plugin or add a separate AMDGPU plugin, depending on how similar you expect the two to be.)"}