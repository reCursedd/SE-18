{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14515", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14515/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14515/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14515/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/14515", "id": 273358723, "node_id": "MDU6SXNzdWUyNzMzNTg3MjM=", "number": 14515, "title": "//tensorflow/python:session_clusterspec_prop_test is failing with GPU support ", "user": {"login": "sandipmgiri", "id": 16284232, "node_id": "MDQ6VXNlcjE2Mjg0MjMy", "avatar_url": "https://avatars0.githubusercontent.com/u/16284232?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sandipmgiri", "html_url": "https://github.com/sandipmgiri", "followers_url": "https://api.github.com/users/sandipmgiri/followers", "following_url": "https://api.github.com/users/sandipmgiri/following{/other_user}", "gists_url": "https://api.github.com/users/sandipmgiri/gists{/gist_id}", "starred_url": "https://api.github.com/users/sandipmgiri/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sandipmgiri/subscriptions", "organizations_url": "https://api.github.com/users/sandipmgiri/orgs", "repos_url": "https://api.github.com/users/sandipmgiri/repos", "events_url": "https://api.github.com/users/sandipmgiri/events{/privacy}", "received_events_url": "https://api.github.com/users/sandipmgiri/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-11-13T09:19:33Z", "updated_at": "2017-11-16T04:58:48Z", "closed_at": "2017-11-16T04:58:48Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nUbuntu 16.04 (ppc64le)</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>:<br>\nInstalled from source</li>\n<li><strong>TensorFlow version (use command below)</strong>:<br>\nTF1.3.1</li>\n<li><strong>Python version</strong>:<br>\nPython 2.7.5</li>\n<li><strong>Bazel version (if compiling from source)</strong>:<br>\nBazel - 0.5.4</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>:<br>\ngcc - 4.8.5</li>\n<li><strong>CUDA/cuDNN version</strong>:<br>\ncuda-8.0  and cuDNN-6.0.21</li>\n<li><strong>GPU model and memory</strong>:<br>\n0 Tesla P100-SXM2   16276MiB<br>\n1 Tesla P100-SXM2   16276MiB</li>\n<li><strong>Exact command to reproduce</strong>:<br>\n<code>bazel test  --config=opt --config=cuda -k  //tensorflow/python:session_clusterspec_prop_test</code></li>\n</ul>\n<h3>Describe the problem</h3>\n<p>This test passed successfully with CPU only.<br>\nHowever its failing with GPU support , getting assertion error <code>1 != 0</code>.</p>\n<p>I was debugging this test failure and found following code fails for GPU -<br>\n<a href=\"https://github.com/tensorflow/tensorflow/blob/v1.3.1/tensorflow/python/client/session_clusterspec_prop_test.py#L86-L92\">https://github.com/tensorflow/tensorflow/blob/v1.3.1/tensorflow/python/client/session_clusterspec_prop_test.py#L86-L92</a></p>\n<pre><code>self.assertEqual(1,\n                  len([\n                      node_stats\n                      for dev_stats in run_metadata.step_stats.dev_stats\n                      for node_stats in dev_stats.node_stats\n                      if '/job:worker/replica:0/task:1/device:CPU:0' ==\n                      dev_stats.device and 'Const' == node_stats.node_name\n                  ]))\n</code></pre>\n<p>Test expects output '1' , but len function returns '0', because of following  lines</p>\n<pre><code>  if '/job:worker/replica:0/task:1/device:CPU:0' ==\n  dev_stats.device and 'Const' == node_stats.node_name\n\n</code></pre>\n<p>I have printed/checked values of <code>dev_stats.device</code> using print statements, see below -</p>\n<ol>\n<li>With CPU only support - we are getting CPU:0 device for task0 and task1 :</li>\n</ol>\n<pre><code> dev_stats.device =  /job:worker/replica:0/task:0/device:CPU:0\n dev_stats.device = /job:worker/replica:0/task:1/device:CPU:0\n</code></pre>\n<ol start=\"2\">\n<li>But with GPU support - for task0 ---&gt; device:CPU:0 and for task1 ---&gt; device:GPU:0</li>\n</ol>\n<pre><code> dev_stats.device = /job:worker/replica:0/task:0/device:CPU:0\n dev_stats.device = /job:worker/replica:0/task:1/device:GPU:0\n</code></pre>\n<p>That's why this test is failing with GPU support , as if condition is not satisfied ( <code> if '/job:worker/replica:0/task:1/device:CPU:0' ! = /job:worker/replica:0/task:1/device:GPU:0</code>)</p>\n<p>I tried changing if condition from  <code>if '/job:worker/replica:0/task:1/device:CPU:0'</code> to <code>if '/job:worker/replica:0/task:1/device:GPU:0'</code> and test passed successfully (with GPU).</p>\n<p>This is my overall understanding.<br>\nI want to fix this test, please provide your comments/suggestions.</p>\n<h3>Source code / logs</h3>\n<p>..</p>\n<pre><code>$  bazel test  --config=opt --config=cuda -k  //tensorflow/python:session_clusterspec_prop_test\n...\n======================================================================\nFAIL: testClusterSpecPropagationWorker2Placement (__main__.SessionClusterSpecPropagationTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/sandip/.cache/bazel/_bazel_sandip/a43c7182abc6db034a12d4266337a49c/execroot/org_tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/session_clusterspec_prop_test.runfiles/org_tensorflow/tensorflow/python/client/session_clusterspec_prop_test.py\", line 92, in testClusterSpecPropagationWorker2Placement\n    dev_stats.device and 'Const' == node_stats.node_name\nAssertionError: 1 != 0\n\n----------------------------------------------------------------------\nRan 12 tests in 1.797s\n\nFAILED (failures=1)\n================================================================================\n\n</code></pre>", "body_text": "System information\n\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nUbuntu 16.04 (ppc64le)\nTensorFlow installed from (source or binary):\nInstalled from source\nTensorFlow version (use command below):\nTF1.3.1\nPython version:\nPython 2.7.5\nBazel version (if compiling from source):\nBazel - 0.5.4\nGCC/Compiler version (if compiling from source):\ngcc - 4.8.5\nCUDA/cuDNN version:\ncuda-8.0  and cuDNN-6.0.21\nGPU model and memory:\n0 Tesla P100-SXM2   16276MiB\n1 Tesla P100-SXM2   16276MiB\nExact command to reproduce:\nbazel test  --config=opt --config=cuda -k  //tensorflow/python:session_clusterspec_prop_test\n\nDescribe the problem\nThis test passed successfully with CPU only.\nHowever its failing with GPU support , getting assertion error 1 != 0.\nI was debugging this test failure and found following code fails for GPU -\nhttps://github.com/tensorflow/tensorflow/blob/v1.3.1/tensorflow/python/client/session_clusterspec_prop_test.py#L86-L92\nself.assertEqual(1,\n                  len([\n                      node_stats\n                      for dev_stats in run_metadata.step_stats.dev_stats\n                      for node_stats in dev_stats.node_stats\n                      if '/job:worker/replica:0/task:1/device:CPU:0' ==\n                      dev_stats.device and 'Const' == node_stats.node_name\n                  ]))\n\nTest expects output '1' , but len function returns '0', because of following  lines\n  if '/job:worker/replica:0/task:1/device:CPU:0' ==\n  dev_stats.device and 'Const' == node_stats.node_name\n\n\nI have printed/checked values of dev_stats.device using print statements, see below -\n\nWith CPU only support - we are getting CPU:0 device for task0 and task1 :\n\n dev_stats.device =  /job:worker/replica:0/task:0/device:CPU:0\n dev_stats.device = /job:worker/replica:0/task:1/device:CPU:0\n\n\nBut with GPU support - for task0 ---> device:CPU:0 and for task1 ---> device:GPU:0\n\n dev_stats.device = /job:worker/replica:0/task:0/device:CPU:0\n dev_stats.device = /job:worker/replica:0/task:1/device:GPU:0\n\nThat's why this test is failing with GPU support , as if condition is not satisfied (  if '/job:worker/replica:0/task:1/device:CPU:0' ! = /job:worker/replica:0/task:1/device:GPU:0)\nI tried changing if condition from  if '/job:worker/replica:0/task:1/device:CPU:0' to if '/job:worker/replica:0/task:1/device:GPU:0' and test passed successfully (with GPU).\nThis is my overall understanding.\nI want to fix this test, please provide your comments/suggestions.\nSource code / logs\n..\n$  bazel test  --config=opt --config=cuda -k  //tensorflow/python:session_clusterspec_prop_test\n...\n======================================================================\nFAIL: testClusterSpecPropagationWorker2Placement (__main__.SessionClusterSpecPropagationTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/sandip/.cache/bazel/_bazel_sandip/a43c7182abc6db034a12d4266337a49c/execroot/org_tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/session_clusterspec_prop_test.runfiles/org_tensorflow/tensorflow/python/client/session_clusterspec_prop_test.py\", line 92, in testClusterSpecPropagationWorker2Placement\n    dev_stats.device and 'Const' == node_stats.node_name\nAssertionError: 1 != 0\n\n----------------------------------------------------------------------\nRan 12 tests in 1.797s\n\nFAILED (failures=1)\n================================================================================", "body": "### System information\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\n     Ubuntu 16.04 (ppc64le)\r\n- **TensorFlow installed from (source or binary)**:\r\n     Installed from source\r\n- **TensorFlow version (use command below)**:\r\n     TF1.3.1\r\n- **Python version**:\r\n     Python 2.7.5 \r\n- **Bazel version (if compiling from source)**:\r\n     Bazel - 0.5.4\r\n- **GCC/Compiler version (if compiling from source)**:\r\n     gcc - 4.8.5\r\n- **CUDA/cuDNN version**:\r\n     cuda-8.0  and cuDNN-6.0.21\r\n- **GPU model and memory**:\r\n      0 Tesla P100-SXM2   16276MiB\r\n      1 Tesla P100-SXM2   16276MiB\r\n- **Exact command to reproduce**:\r\n`bazel test  --config=opt --config=cuda -k  //tensorflow/python:session_clusterspec_prop_test`\r\n\r\n### Describe the problem\r\nThis test passed successfully with CPU only.\r\nHowever its failing with GPU support , getting assertion error `1 != 0`. \r\n\r\nI was debugging this test failure and found following code fails for GPU -\r\nhttps://github.com/tensorflow/tensorflow/blob/v1.3.1/tensorflow/python/client/session_clusterspec_prop_test.py#L86-L92\r\n   ```\r\nself.assertEqual(1,\r\n                     len([\r\n                         node_stats\r\n                         for dev_stats in run_metadata.step_stats.dev_stats\r\n                         for node_stats in dev_stats.node_stats\r\n                         if '/job:worker/replica:0/task:1/device:CPU:0' ==\r\n                         dev_stats.device and 'Const' == node_stats.node_name\r\n                     ]))\r\n```\r\nTest expects output '1' , but len function returns '0', because of following  lines \r\n```\r\n  if '/job:worker/replica:0/task:1/device:CPU:0' ==\r\n  dev_stats.device and 'Const' == node_stats.node_name\r\n\r\n```\r\nI have printed/checked values of `dev_stats.device` using print statements, see below -\r\n1) With CPU only support - we are getting CPU:0 device for task0 and task1 :\r\n```\r\n dev_stats.device =  /job:worker/replica:0/task:0/device:CPU:0\r\n dev_stats.device = /job:worker/replica:0/task:1/device:CPU:0\r\n```\r\n2) But with GPU support - for task0 ---> device:CPU:0 and for task1 ---> device:GPU:0\r\n```\r\n dev_stats.device = /job:worker/replica:0/task:0/device:CPU:0\r\n dev_stats.device = /job:worker/replica:0/task:1/device:GPU:0\r\n```\r\nThat's why this test is failing with GPU support , as if condition is not satisfied ( `  if '/job:worker/replica:0/task:1/device:CPU:0' ! = /job:worker/replica:0/task:1/device:GPU:0 `)\r\n\r\nI tried changing if condition from  `if '/job:worker/replica:0/task:1/device:CPU:0'` to `if '/job:worker/replica:0/task:1/device:GPU:0'` and test passed successfully (with GPU).\r\n\r\nThis is my overall understanding.\r\nI want to fix this test, please provide your comments/suggestions.\r\n### Source code / logs\r\n..\r\n```\r\n$  bazel test  --config=opt --config=cuda -k  //tensorflow/python:session_clusterspec_prop_test\r\n...\r\n======================================================================\r\nFAIL: testClusterSpecPropagationWorker2Placement (__main__.SessionClusterSpecPropagationTest)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/home/sandip/.cache/bazel/_bazel_sandip/a43c7182abc6db034a12d4266337a49c/execroot/org_tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/session_clusterspec_prop_test.runfiles/org_tensorflow/tensorflow/python/client/session_clusterspec_prop_test.py\", line 92, in testClusterSpecPropagationWorker2Placement\r\n    dev_stats.device and 'Const' == node_stats.node_name\r\nAssertionError: 1 != 0\r\n\r\n----------------------------------------------------------------------\r\nRan 12 tests in 1.797s\r\n\r\nFAILED (failures=1)\r\n================================================================================\r\n\r\n```"}