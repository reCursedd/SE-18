{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3126", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3126/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3126/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3126/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/3126", "id": 163218714, "node_id": "MDU6SXNzdWUxNjMyMTg3MTQ=", "number": 3126, "title": "GPU not working on C++", "user": {"login": "dzhyeon", "id": 6189571, "node_id": "MDQ6VXNlcjYxODk1NzE=", "avatar_url": "https://avatars2.githubusercontent.com/u/6189571?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dzhyeon", "html_url": "https://github.com/dzhyeon", "followers_url": "https://api.github.com/users/dzhyeon/followers", "following_url": "https://api.github.com/users/dzhyeon/following{/other_user}", "gists_url": "https://api.github.com/users/dzhyeon/gists{/gist_id}", "starred_url": "https://api.github.com/users/dzhyeon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dzhyeon/subscriptions", "organizations_url": "https://api.github.com/users/dzhyeon/orgs", "repos_url": "https://api.github.com/users/dzhyeon/repos", "events_url": "https://api.github.com/users/dzhyeon/events{/privacy}", "received_events_url": "https://api.github.com/users/dzhyeon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2016-06-30T17:19:10Z", "updated_at": "2018-05-10T02:36:02Z", "closed_at": "2016-07-01T11:20:37Z", "author_association": "NONE", "body_html": "<p>I'm on working on load trained model in c++ like <a href=\"http://stackoverflow.com/questions/34343259/is-there-an-example-on-how-to-generate-protobuf-files-holding-trained-tensorflow/34343517#34343517\" rel=\"nofollow\">this</a>.<br>\nAfter many tries, I've manage to load trained model with its weights. But it looks like c++ version doesn't use GPU for inference. While running my code in c++, I check GPU usage using nvidia-smi and there is no change in GPU usage. After close looking at the example code in /tensorflow/cc/tutorials/example_trainer.cc and <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/graph/default_device.h\">this,</a> I've tried assigning device to each node like below. But still, no GPU usage in nvidia-smi and actual running time is horribly slow. BTW, there is no problem using GPU if it is running on python.<br>\n`  const std::string device = \"/gpu:0\";</p>\n<p>std::vector vNames;</p>\n<p>int node_count = graph_def.node_size();<br>\nfor (int i = 0; i &lt; node_count; i++) {<br>\nauto n = graph_def.node(i);<br>\nif (n.name().find(\"nWeights\") != std::string::npos) {<br>\nvNames.push_back(n.name());<br>\nstd::cout &lt;&lt; n.name() &lt;&lt; std::endl;<br>\n}<br>\nauto node = graph_def.mutable_node(i);<br>\nnode-&gt;set_device(device);<br>\n}`</p>\n<p>My Environment:<br>\nOS: ubuntu 14.04<br>\nGraphics: GeForce GTX 980 Ti<br>\nCUDA Driver Version / Runtime Version          7.5 / 7.5<br>\nCUDA Capability Major/Minor version number:    5.2</p>", "body_text": "I'm on working on load trained model in c++ like this.\nAfter many tries, I've manage to load trained model with its weights. But it looks like c++ version doesn't use GPU for inference. While running my code in c++, I check GPU usage using nvidia-smi and there is no change in GPU usage. After close looking at the example code in /tensorflow/cc/tutorials/example_trainer.cc and this, I've tried assigning device to each node like below. But still, no GPU usage in nvidia-smi and actual running time is horribly slow. BTW, there is no problem using GPU if it is running on python.\n`  const std::string device = \"/gpu:0\";\nstd::vector vNames;\nint node_count = graph_def.node_size();\nfor (int i = 0; i < node_count; i++) {\nauto n = graph_def.node(i);\nif (n.name().find(\"nWeights\") != std::string::npos) {\nvNames.push_back(n.name());\nstd::cout << n.name() << std::endl;\n}\nauto node = graph_def.mutable_node(i);\nnode->set_device(device);\n}`\nMy Environment:\nOS: ubuntu 14.04\nGraphics: GeForce GTX 980 Ti\nCUDA Driver Version / Runtime Version          7.5 / 7.5\nCUDA Capability Major/Minor version number:    5.2", "body": "I'm on working on load trained model in c++ like [this](http://stackoverflow.com/questions/34343259/is-there-an-example-on-how-to-generate-protobuf-files-holding-trained-tensorflow/34343517#34343517).\nAfter many tries, I've manage to load trained model with its weights. But it looks like c++ version doesn't use GPU for inference. While running my code in c++, I check GPU usage using nvidia-smi and there is no change in GPU usage. After close looking at the example code in /tensorflow/cc/tutorials/example_trainer.cc and [this,](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/graph/default_device.h) I've tried assigning device to each node like below. But still, no GPU usage in nvidia-smi and actual running time is horribly slow. BTW, there is no problem using GPU if it is running on python.\n`  const std::string device = \"/gpu:0\";\n\n  std::vector<string> vNames;\n\n  int node_count = graph_def.node_size();\n  for (int i = 0; i < node_count; i++) {\n      auto n = graph_def.node(i);\n       if (n.name().find(\"nWeights\") != std::string::npos) {\n          vNames.push_back(n.name());\n          std::cout << n.name() << std::endl;\n      }\n      auto node = graph_def.mutable_node(i);\n      node->set_device(device);\n  }`\n\nMy Environment:\nOS: ubuntu 14.04\nGraphics: GeForce GTX 980 Ti\nCUDA Driver Version / Runtime Version          7.5 / 7.5\nCUDA Capability Major/Minor version number:    5.2\n"}