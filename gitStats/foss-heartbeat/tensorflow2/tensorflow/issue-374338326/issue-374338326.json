{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23294", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23294/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23294/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23294/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23294", "id": 374338326, "node_id": "MDU6SXNzdWUzNzQzMzgzMjY=", "number": 23294, "title": "Dataset shard index automatic change in Estimator DistributionStrategy", "user": {"login": "wangsiyu", "id": 5387343, "node_id": "MDQ6VXNlcjUzODczNDM=", "avatar_url": "https://avatars0.githubusercontent.com/u/5387343?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wangsiyu", "html_url": "https://github.com/wangsiyu", "followers_url": "https://api.github.com/users/wangsiyu/followers", "following_url": "https://api.github.com/users/wangsiyu/following{/other_user}", "gists_url": "https://api.github.com/users/wangsiyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/wangsiyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wangsiyu/subscriptions", "organizations_url": "https://api.github.com/users/wangsiyu/orgs", "repos_url": "https://api.github.com/users/wangsiyu/repos", "events_url": "https://api.github.com/users/wangsiyu/events{/privacy}", "received_events_url": "https://api.github.com/users/wangsiyu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 996845227, "node_id": "MDU6TGFiZWw5OTY4NDUyMjc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:dist-strat", "name": "comp:dist-strat", "color": "0052cc", "default": false}], "state": "open", "locked": false, "assignee": {"login": "yuefengz", "id": 1647833, "node_id": "MDQ6VXNlcjE2NDc4MzM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1647833?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuefengz", "html_url": "https://github.com/yuefengz", "followers_url": "https://api.github.com/users/yuefengz/followers", "following_url": "https://api.github.com/users/yuefengz/following{/other_user}", "gists_url": "https://api.github.com/users/yuefengz/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuefengz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuefengz/subscriptions", "organizations_url": "https://api.github.com/users/yuefengz/orgs", "repos_url": "https://api.github.com/users/yuefengz/repos", "events_url": "https://api.github.com/users/yuefengz/events{/privacy}", "received_events_url": "https://api.github.com/users/yuefengz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "yuefengz", "id": 1647833, "node_id": "MDQ6VXNlcjE2NDc4MzM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1647833?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuefengz", "html_url": "https://github.com/yuefengz", "followers_url": "https://api.github.com/users/yuefengz/followers", "following_url": "https://api.github.com/users/yuefengz/following{/other_user}", "gists_url": "https://api.github.com/users/yuefengz/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuefengz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuefengz/subscriptions", "organizations_url": "https://api.github.com/users/yuefengz/orgs", "repos_url": "https://api.github.com/users/yuefengz/repos", "events_url": "https://api.github.com/users/yuefengz/events{/privacy}", "received_events_url": "https://api.github.com/users/yuefengz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2018-10-26T11:15:41Z", "updated_at": "2018-11-14T19:12:07Z", "closed_at": null, "author_association": "CONTRIBUTOR", "body_html": "<p><strong>System information</strong></p>\n<ul>\n<li>TensorFlow version (you are using): 1.10</li>\n<li>Are you willing to contribute it (Yes/No): Yes</li>\n</ul>\n<p><strong>Describe the feature and the current behavior/state.</strong><br>\nAccording to the cluster role defined in <code>Estimator</code>, the task index of <code>chief</code> and <code>worker</code> both start from 0. This brings trouble usage for reading data shard under distributed environment. Users should either change code to distinguish the task index between <code>chief</code> and <code>worker_0</code> or modify the <code>TF_CONFIG</code> environment to read different data shards.</p>\n<pre><code>d = tf.data.TFRecordDataset(FLAGS.input_file)\nd = d.shard(FLAGS.num_workers, FLAGS.worker_index)\n</code></pre>\n<p>The propose of <code>DistributionStrategy</code> is to make distribution easy writing with minimal changes to model function and input function. However, we currently cannot avoid the problems described above.</p>\n<p>Is there any solutions for this problem? I am very willing to contribute for this but want to have more discussion for the design.</p>\n<p><strong>Will this change the current api? How?</strong><br>\nMaybe yes.</p>\n<p><strong>Who will benefit with this feature?</strong><br>\nDistributionStrategy users.</p>\n<p><strong>Any Other info.</strong><br>\nAny  discussion is appreciated.</p>", "body_text": "System information\n\nTensorFlow version (you are using): 1.10\nAre you willing to contribute it (Yes/No): Yes\n\nDescribe the feature and the current behavior/state.\nAccording to the cluster role defined in Estimator, the task index of chief and worker both start from 0. This brings trouble usage for reading data shard under distributed environment. Users should either change code to distinguish the task index between chief and worker_0 or modify the TF_CONFIG environment to read different data shards.\nd = tf.data.TFRecordDataset(FLAGS.input_file)\nd = d.shard(FLAGS.num_workers, FLAGS.worker_index)\n\nThe propose of DistributionStrategy is to make distribution easy writing with minimal changes to model function and input function. However, we currently cannot avoid the problems described above.\nIs there any solutions for this problem? I am very willing to contribute for this but want to have more discussion for the design.\nWill this change the current api? How?\nMaybe yes.\nWho will benefit with this feature?\nDistributionStrategy users.\nAny Other info.\nAny  discussion is appreciated.", "body": "**System information**\r\n- TensorFlow version (you are using): 1.10\r\n- Are you willing to contribute it (Yes/No): Yes\r\n\r\n\r\n**Describe the feature and the current behavior/state.**\r\nAccording to the cluster role defined in `Estimator`, the task index of `chief` and `worker` both start from 0. This brings trouble usage for reading data shard under distributed environment. Users should either change code to distinguish the task index between `chief` and `worker_0` or modify the `TF_CONFIG` environment to read different data shards.\r\n\r\n```\r\nd = tf.data.TFRecordDataset(FLAGS.input_file)\r\nd = d.shard(FLAGS.num_workers, FLAGS.worker_index)\r\n```\r\n\r\nThe propose of `DistributionStrategy` is to make distribution easy writing with minimal changes to model function and input function. However, we currently cannot avoid the problems described above. \r\n\r\nIs there any solutions for this problem? I am very willing to contribute for this but want to have more discussion for the design. \r\n\r\n**Will this change the current api? How?**\r\nMaybe yes.\r\n\r\n**Who will benefit with this feature?**\r\nDistributionStrategy users.\r\n\r\n**Any Other info.**\r\nAny  discussion is appreciated."}