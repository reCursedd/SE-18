{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/309846751", "html_url": "https://github.com/tensorflow/tensorflow/issues/10843#issuecomment-309846751", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10843", "id": 309846751, "node_id": "MDEyOklzc3VlQ29tbWVudDMwOTg0Njc1MQ==", "user": {"login": "tatatodd", "id": 5453737, "node_id": "MDQ6VXNlcjU0NTM3Mzc=", "avatar_url": "https://avatars3.githubusercontent.com/u/5453737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tatatodd", "html_url": "https://github.com/tatatodd", "followers_url": "https://api.github.com/users/tatatodd/followers", "following_url": "https://api.github.com/users/tatatodd/following{/other_user}", "gists_url": "https://api.github.com/users/tatatodd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tatatodd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tatatodd/subscriptions", "organizations_url": "https://api.github.com/users/tatatodd/orgs", "repos_url": "https://api.github.com/users/tatatodd/repos", "events_url": "https://api.github.com/users/tatatodd/events{/privacy}", "received_events_url": "https://api.github.com/users/tatatodd/received_events", "type": "User", "site_admin": false}, "created_at": "2017-06-20T18:27:40Z", "updated_at": "2017-06-20T18:27:40Z", "author_association": "MEMBER", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1664\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/svenstaro\">@svenstaro</a> It seems that the version of gcc you're using doesn't support the same template argument deduction that we get with the version that we're using:</p>\n<pre><code>ERROR: /build/tensorflow/src/tensorflow-1.2.0/tensorflow/compiler/xla/service/llvm_ir/BUILD:60:1: C++ compilation of rule '//tensorflow/compiler/xla/service/llvm_ir:ir_array' failed: gcc failed: error executing command /usr/bin/gcc -U_FORTIFY_SOURCE -fstack-protector -Wall -B/usr/bin -B/usr/bin -Wunused-but-set-parameter -Wno-free-nonheap-object -fno-omit-frame-pointer -g0 -O2 '-D_FORTIFY_SOURCE=1' -DNDEBUG ... (remaining 133 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\ntensorflow/compiler/xla/service/llvm_ir/ir_array.cc: In member function 'xla::llvm_ir::IrArray::Index xla::llvm_ir::IrArray::Index::SourceIndexOfTranspose(const xla::Shape&amp;, const xla::Shape&amp;, tensorflow::gtl::ArraySlice&lt;long long int&gt;, llvm::IRBuilder&lt;&gt;*) const':\ntensorflow/compiler/xla/service/llvm_ir/ir_array.cc:161:44: error: no matching function for call to 'Permute(tensorflow::gtl::ArraySlice&lt;long long int&gt;&amp;, const std::vector&lt;llvm::Value*, std::allocator&lt;llvm::Value*&gt; &gt;&amp;)'\n       Permute(dimension_mapping, multidim());\n                                            ^\nIn file included from tensorflow/compiler/xla/service/llvm_ir/ir_array.cc:24:0:\n./tensorflow/compiler/xla/util.h:197:16: note: candidate: template&lt;template&lt;class ...&gt; class C, class T&gt; std::vector&lt;T&gt; xla::Permute(tensorflow::gtl::ArraySlice&lt;long long int&gt;, C&lt;T&gt;)\n std::vector&lt;T&gt; Permute(tensorflow::gtl::ArraySlice&lt;int64&gt; permutation,\n                ^~~~~~~\n./tensorflow/compiler/xla/util.h:197:16: note:   template argument deduction/substitution failed:\ntensorflow/compiler/xla/service/llvm_ir/ir_array.cc:161:44: note:   candidate expects 1 argument, 2 provided\n       Permute(dimension_mapping, multidim());\n                                            ^\ntensorflow/compiler/xla/service/llvm_ir/ir_array.cc:161:44: note:   candidate expects 1 argument, 2 provided\ntensorflow/compiler/xla/service/llvm_ir/ir_array.cc:161:44: note:   'std::vector&lt;llvm::Value*, std::allocator&lt;llvm::Value*&gt; &gt;' is not derived from 'C&lt;T&gt;'\n</code></pre>\n<p>A possible (untested) fix is to change this line:<br>\n<a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/compiler/xla/service/llvm_ir/ir_array.cc#L161\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/compiler/xla/service/llvm_ir/ir_array.cc#L161</a></p>\n<p>from:</p>\n<pre><code>  std::vector&lt;llvm::Value*&gt; operand_multidim_index =\n      Permute(dimension_mapping, multidim());\n</code></pre>\n<p>to:</p>\n<pre><code>  std::vector&lt;llvm::Value*&gt; operand_multidim_index =\n      Permute&lt;std::vector, llvm::Value*&gt;(dimension_mapping, multidim());\n</code></pre>\n<p>Can you try that out to see if it fixes things?  And if it works, would you mind creating a PR for this fix?  I'm suggesting this route since it'll ensure it actually fixes the problem for you.  Thanks!</p>", "body_text": "@svenstaro It seems that the version of gcc you're using doesn't support the same template argument deduction that we get with the version that we're using:\nERROR: /build/tensorflow/src/tensorflow-1.2.0/tensorflow/compiler/xla/service/llvm_ir/BUILD:60:1: C++ compilation of rule '//tensorflow/compiler/xla/service/llvm_ir:ir_array' failed: gcc failed: error executing command /usr/bin/gcc -U_FORTIFY_SOURCE -fstack-protector -Wall -B/usr/bin -B/usr/bin -Wunused-but-set-parameter -Wno-free-nonheap-object -fno-omit-frame-pointer -g0 -O2 '-D_FORTIFY_SOURCE=1' -DNDEBUG ... (remaining 133 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\ntensorflow/compiler/xla/service/llvm_ir/ir_array.cc: In member function 'xla::llvm_ir::IrArray::Index xla::llvm_ir::IrArray::Index::SourceIndexOfTranspose(const xla::Shape&, const xla::Shape&, tensorflow::gtl::ArraySlice<long long int>, llvm::IRBuilder<>*) const':\ntensorflow/compiler/xla/service/llvm_ir/ir_array.cc:161:44: error: no matching function for call to 'Permute(tensorflow::gtl::ArraySlice<long long int>&, const std::vector<llvm::Value*, std::allocator<llvm::Value*> >&)'\n       Permute(dimension_mapping, multidim());\n                                            ^\nIn file included from tensorflow/compiler/xla/service/llvm_ir/ir_array.cc:24:0:\n./tensorflow/compiler/xla/util.h:197:16: note: candidate: template<template<class ...> class C, class T> std::vector<T> xla::Permute(tensorflow::gtl::ArraySlice<long long int>, C<T>)\n std::vector<T> Permute(tensorflow::gtl::ArraySlice<int64> permutation,\n                ^~~~~~~\n./tensorflow/compiler/xla/util.h:197:16: note:   template argument deduction/substitution failed:\ntensorflow/compiler/xla/service/llvm_ir/ir_array.cc:161:44: note:   candidate expects 1 argument, 2 provided\n       Permute(dimension_mapping, multidim());\n                                            ^\ntensorflow/compiler/xla/service/llvm_ir/ir_array.cc:161:44: note:   candidate expects 1 argument, 2 provided\ntensorflow/compiler/xla/service/llvm_ir/ir_array.cc:161:44: note:   'std::vector<llvm::Value*, std::allocator<llvm::Value*> >' is not derived from 'C<T>'\n\nA possible (untested) fix is to change this line:\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/compiler/xla/service/llvm_ir/ir_array.cc#L161\nfrom:\n  std::vector<llvm::Value*> operand_multidim_index =\n      Permute(dimension_mapping, multidim());\n\nto:\n  std::vector<llvm::Value*> operand_multidim_index =\n      Permute<std::vector, llvm::Value*>(dimension_mapping, multidim());\n\nCan you try that out to see if it fixes things?  And if it works, would you mind creating a PR for this fix?  I'm suggesting this route since it'll ensure it actually fixes the problem for you.  Thanks!", "body": "@svenstaro It seems that the version of gcc you're using doesn't support the same template argument deduction that we get with the version that we're using:\r\n\r\n```\r\nERROR: /build/tensorflow/src/tensorflow-1.2.0/tensorflow/compiler/xla/service/llvm_ir/BUILD:60:1: C++ compilation of rule '//tensorflow/compiler/xla/service/llvm_ir:ir_array' failed: gcc failed: error executing command /usr/bin/gcc -U_FORTIFY_SOURCE -fstack-protector -Wall -B/usr/bin -B/usr/bin -Wunused-but-set-parameter -Wno-free-nonheap-object -fno-omit-frame-pointer -g0 -O2 '-D_FORTIFY_SOURCE=1' -DNDEBUG ... (remaining 133 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\r\ntensorflow/compiler/xla/service/llvm_ir/ir_array.cc: In member function 'xla::llvm_ir::IrArray::Index xla::llvm_ir::IrArray::Index::SourceIndexOfTranspose(const xla::Shape&, const xla::Shape&, tensorflow::gtl::ArraySlice<long long int>, llvm::IRBuilder<>*) const':\r\ntensorflow/compiler/xla/service/llvm_ir/ir_array.cc:161:44: error: no matching function for call to 'Permute(tensorflow::gtl::ArraySlice<long long int>&, const std::vector<llvm::Value*, std::allocator<llvm::Value*> >&)'\r\n       Permute(dimension_mapping, multidim());\r\n                                            ^\r\nIn file included from tensorflow/compiler/xla/service/llvm_ir/ir_array.cc:24:0:\r\n./tensorflow/compiler/xla/util.h:197:16: note: candidate: template<template<class ...> class C, class T> std::vector<T> xla::Permute(tensorflow::gtl::ArraySlice<long long int>, C<T>)\r\n std::vector<T> Permute(tensorflow::gtl::ArraySlice<int64> permutation,\r\n                ^~~~~~~\r\n./tensorflow/compiler/xla/util.h:197:16: note:   template argument deduction/substitution failed:\r\ntensorflow/compiler/xla/service/llvm_ir/ir_array.cc:161:44: note:   candidate expects 1 argument, 2 provided\r\n       Permute(dimension_mapping, multidim());\r\n                                            ^\r\ntensorflow/compiler/xla/service/llvm_ir/ir_array.cc:161:44: note:   candidate expects 1 argument, 2 provided\r\ntensorflow/compiler/xla/service/llvm_ir/ir_array.cc:161:44: note:   'std::vector<llvm::Value*, std::allocator<llvm::Value*> >' is not derived from 'C<T>'\r\n```\r\n\r\nA possible (untested) fix is to change this line:\r\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/compiler/xla/service/llvm_ir/ir_array.cc#L161\r\n\r\nfrom:\r\n```\r\n  std::vector<llvm::Value*> operand_multidim_index =\r\n      Permute(dimension_mapping, multidim());\r\n```\r\n\r\nto:\r\n```\r\n  std::vector<llvm::Value*> operand_multidim_index =\r\n      Permute<std::vector, llvm::Value*>(dimension_mapping, multidim());\r\n```\r\n\r\nCan you try that out to see if it fixes things?  And if it works, would you mind creating a PR for this fix?  I'm suggesting this route since it'll ensure it actually fixes the problem for you.  Thanks!"}