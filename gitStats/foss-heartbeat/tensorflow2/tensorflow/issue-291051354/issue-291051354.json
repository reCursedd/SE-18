{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16344", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16344/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16344/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16344/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/16344", "id": 291051354, "node_id": "MDU6SXNzdWUyOTEwNTEzNTQ=", "number": 16344, "title": "Variance of weights initialized with tf.variance_scaling_initializer is somewhat surprising", "user": {"login": "simonster", "id": 470884, "node_id": "MDQ6VXNlcjQ3MDg4NA==", "avatar_url": "https://avatars2.githubusercontent.com/u/470884?v=4", "gravatar_id": "", "url": "https://api.github.com/users/simonster", "html_url": "https://github.com/simonster", "followers_url": "https://api.github.com/users/simonster/followers", "following_url": "https://api.github.com/users/simonster/following{/other_user}", "gists_url": "https://api.github.com/users/simonster/gists{/gist_id}", "starred_url": "https://api.github.com/users/simonster/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/simonster/subscriptions", "organizations_url": "https://api.github.com/users/simonster/orgs", "repos_url": "https://api.github.com/users/simonster/repos", "events_url": "https://api.github.com/users/simonster/events{/privacy}", "received_events_url": "https://api.github.com/users/simonster/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473173272, "node_id": "MDU6TGFiZWw0NzMxNzMyNzI=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:feature", "name": "type:feature", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "fchollet", "id": 710255, "node_id": "MDQ6VXNlcjcxMDI1NQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/710255?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fchollet", "html_url": "https://github.com/fchollet", "followers_url": "https://api.github.com/users/fchollet/followers", "following_url": "https://api.github.com/users/fchollet/following{/other_user}", "gists_url": "https://api.github.com/users/fchollet/gists{/gist_id}", "starred_url": "https://api.github.com/users/fchollet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fchollet/subscriptions", "organizations_url": "https://api.github.com/users/fchollet/orgs", "repos_url": "https://api.github.com/users/fchollet/repos", "events_url": "https://api.github.com/users/fchollet/events{/privacy}", "received_events_url": "https://api.github.com/users/fchollet/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "fchollet", "id": 710255, "node_id": "MDQ6VXNlcjcxMDI1NQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/710255?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fchollet", "html_url": "https://github.com/fchollet", "followers_url": "https://api.github.com/users/fchollet/followers", "following_url": "https://api.github.com/users/fchollet/following{/other_user}", "gists_url": "https://api.github.com/users/fchollet/gists{/gist_id}", "starred_url": "https://api.github.com/users/fchollet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fchollet/subscriptions", "organizations_url": "https://api.github.com/users/fchollet/orgs", "repos_url": "https://api.github.com/users/fchollet/repos", "events_url": "https://api.github.com/users/fchollet/events{/privacy}", "received_events_url": "https://api.github.com/users/fchollet/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 15, "created_at": "2018-01-24T01:16:35Z", "updated_at": "2018-07-14T07:45:40Z", "closed_at": "2018-07-14T07:45:40Z", "author_association": "NONE", "body_html": "<p>If <code>tf.variance_scaling_initializer</code> is called with <code>distribution='uniform'</code>, then the weights have variance <code>scale / n</code>. However, if <code>tf.variance_scaling_initializer</code> is called with <code>distribution='normal'</code>, the weights have variance <code>scale / n * (1 - (4 * norm.pdf(2))/(2 * norm.cdf(2) - 1))</code>, because the weights are drawn from a normal distribution truncated at +/- 2 std and the scale is not adjusted for this truncation.</p>\n<p>While I understand that there are reasons to use a truncated normal distribution, I would argue that the distribution should be scaled to adjust for the truncation, or the fact that the scale is not adjusted for truncation should feature more prominently in the documentation. The current statement that:</p>\n<blockquote>\n<p>With <code>distribution=\"normal\"</code>, samples are drawn from a truncated normal distribution centered on zero, with <code>stddev = sqrt(scale / n)</code></p>\n</blockquote>\n<p>is not totally clear, since it's not obvious that <code>stddev</code> is referring to the standard deviation of the normal distribution before truncation and not after.</p>\n<p>To make matters more confusing, unlike <code>tf.variance_scaling_initializer</code>, <code>tf.contrib.layers.variance_scaling_initializer</code> performs the appropriate correction so that the weights have variance <code>scale / n</code>.</p>", "body_text": "If tf.variance_scaling_initializer is called with distribution='uniform', then the weights have variance scale / n. However, if tf.variance_scaling_initializer is called with distribution='normal', the weights have variance scale / n * (1 - (4 * norm.pdf(2))/(2 * norm.cdf(2) - 1)), because the weights are drawn from a normal distribution truncated at +/- 2 std and the scale is not adjusted for this truncation.\nWhile I understand that there are reasons to use a truncated normal distribution, I would argue that the distribution should be scaled to adjust for the truncation, or the fact that the scale is not adjusted for truncation should feature more prominently in the documentation. The current statement that:\n\nWith distribution=\"normal\", samples are drawn from a truncated normal distribution centered on zero, with stddev = sqrt(scale / n)\n\nis not totally clear, since it's not obvious that stddev is referring to the standard deviation of the normal distribution before truncation and not after.\nTo make matters more confusing, unlike tf.variance_scaling_initializer, tf.contrib.layers.variance_scaling_initializer performs the appropriate correction so that the weights have variance scale / n.", "body": "If `tf.variance_scaling_initializer` is called with `distribution='uniform'`, then the weights have variance `scale / n`. However, if `tf.variance_scaling_initializer` is called with `distribution='normal'`, the weights have variance `scale / n * (1 - (4 * norm.pdf(2))/(2 * norm.cdf(2) - 1))`, because the weights are drawn from a normal distribution truncated at +/- 2 std and the scale is not adjusted for this truncation.\r\n\r\nWhile I understand that there are reasons to use a truncated normal distribution, I would argue that the distribution should be scaled to adjust for the truncation, or the fact that the scale is not adjusted for truncation should feature more prominently in the documentation. The current statement that:\r\n\r\n> With `distribution=\"normal\"`, samples are drawn from a truncated normal distribution centered on zero, with `stddev = sqrt(scale / n)`\r\n\r\nis not totally clear, since it's not obvious that `stddev` is referring to the standard deviation of the normal distribution before truncation and not after.\r\n\r\nTo make matters more confusing, unlike `tf.variance_scaling_initializer`, `tf.contrib.layers.variance_scaling_initializer` performs the appropriate correction so that the weights have variance `scale / n`."}