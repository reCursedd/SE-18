{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22212", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22212/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22212/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22212/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/22212", "id": 359043420, "node_id": "MDU6SXNzdWUzNTkwNDM0MjA=", "number": 22212, "title": "Tensorflow with MKL Very Slow", "user": {"login": "zealthinker", "id": 43147613, "node_id": "MDQ6VXNlcjQzMTQ3NjEz", "avatar_url": "https://avatars2.githubusercontent.com/u/43147613?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zealthinker", "html_url": "https://github.com/zealthinker", "followers_url": "https://api.github.com/users/zealthinker/followers", "following_url": "https://api.github.com/users/zealthinker/following{/other_user}", "gists_url": "https://api.github.com/users/zealthinker/gists{/gist_id}", "starred_url": "https://api.github.com/users/zealthinker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zealthinker/subscriptions", "organizations_url": "https://api.github.com/users/zealthinker/orgs", "repos_url": "https://api.github.com/users/zealthinker/repos", "events_url": "https://api.github.com/users/zealthinker/events{/privacy}", "received_events_url": "https://api.github.com/users/zealthinker/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "ezhulenev", "id": 1174378, "node_id": "MDQ6VXNlcjExNzQzNzg=", "avatar_url": "https://avatars2.githubusercontent.com/u/1174378?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ezhulenev", "html_url": "https://github.com/ezhulenev", "followers_url": "https://api.github.com/users/ezhulenev/followers", "following_url": "https://api.github.com/users/ezhulenev/following{/other_user}", "gists_url": "https://api.github.com/users/ezhulenev/gists{/gist_id}", "starred_url": "https://api.github.com/users/ezhulenev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ezhulenev/subscriptions", "organizations_url": "https://api.github.com/users/ezhulenev/orgs", "repos_url": "https://api.github.com/users/ezhulenev/repos", "events_url": "https://api.github.com/users/ezhulenev/events{/privacy}", "received_events_url": "https://api.github.com/users/ezhulenev/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ezhulenev", "id": 1174378, "node_id": "MDQ6VXNlcjExNzQzNzg=", "avatar_url": "https://avatars2.githubusercontent.com/u/1174378?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ezhulenev", "html_url": "https://github.com/ezhulenev", "followers_url": "https://api.github.com/users/ezhulenev/followers", "following_url": "https://api.github.com/users/ezhulenev/following{/other_user}", "gists_url": "https://api.github.com/users/ezhulenev/gists{/gist_id}", "starred_url": "https://api.github.com/users/ezhulenev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ezhulenev/subscriptions", "organizations_url": "https://api.github.com/users/ezhulenev/orgs", "repos_url": "https://api.github.com/users/ezhulenev/repos", "events_url": "https://api.github.com/users/ezhulenev/events{/privacy}", "received_events_url": "https://api.github.com/users/ezhulenev/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2018-09-11T13:17:25Z", "updated_at": "2018-10-10T23:35:34Z", "closed_at": "2018-09-28T21:17:08Z", "author_association": "NONE", "body_html": "<p>I am trying to reduce the time taken by an LSTM model using MKL. I use Tensorflow 1.10.0. I have give information about configuration I am using below. It will be great, if you can help me improve the speed of my model. Please let me know what more information you need. Thanks a lot!</p>\n<p>CPU make and model (try lscpu; if your lscpu does not list CPU flags,<br>\ntry running cat /proc/cpuinfo | grep flags | sort -u)<br>\nflags\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl xtopology nonstop_tsc cpuid aperfmperf pni pclmulqdq monitor est ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch cpuid_fault invpcid_single pti fsgsbase bmi1 hle avx2 smep bmi2 erms invpcid rtm rdseed adx xsaveopt ida</p>\n<p>OS version (uname -a)<br>\nLinux ip-172-31-24-72 4.14.67-66.56.amzn1.x86_64 <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"115886302\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/1\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/1/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/1\">#1</a> SMP Tue Sep 4 22:03:21 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</p>\n<p>Compiler version (gcc --version)<br>\ngcc (GCC) 4.8.5 20150623 (Red Hat 4.8.5-11)</p>\n<p>os.environ['OMP_NUM_THREADS'] = '32'<br>\nos.environ['KMP_BLOCKTIME'] = '0'<br>\nos.environ['KMP_AFFINITY'] = 'granularity=fine,verbose,compact,1,0'<br>\nK.set_image_data_format('channels_first')<br>\nconfig = tf.ConfigProto()<br>\nconfig.inter_op_parallelism_threads = 1<br>\nconfig.intra_op_parallelism_threads = 32<br>\nsession = tf.Session(config=config)<br>\nK.set_session(session)</p>\n<ul>\n<li>\n<p><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:<br>\nYes</p>\n</li>\n<li>\n<p><strong>Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device</strong>:<br>\nNo</p>\n</li>\n<li>\n<p><strong>TensorFlow installed from (source or binary)</strong>:<br>\nSource</p>\n</li>\n<li>\n<p><strong>TensorFlow version (use command below)</strong>:<br>\n1.10.0</p>\n</li>\n<li>\n<p><strong>Python version</strong>:<br>\n2.7</p>\n</li>\n<li>\n<p><strong>Bazel version (if compiling from source)</strong>:<br>\n<a href=\"https://copr.fedorainfracloud.org/coprs/vbatts/bazel/repo/epel-7/vbatts-bazel-epel-7.repo\" rel=\"nofollow\">https://copr.fedorainfracloud.org/coprs/vbatts/bazel/repo/epel-7/vbatts-bazel-epel-7.repo</a></p>\n</li>\n<li>\n<p><strong>CUDA/cuDNN version</strong>:<br>\nNone</p>\n</li>\n<li>\n<p><strong>GPU model and memory</strong>:<br>\nNone</p>\n</li>\n</ul>", "body_text": "I am trying to reduce the time taken by an LSTM model using MKL. I use Tensorflow 1.10.0. I have give information about configuration I am using below. It will be great, if you can help me improve the speed of my model. Please let me know what more information you need. Thanks a lot!\nCPU make and model (try lscpu; if your lscpu does not list CPU flags,\ntry running cat /proc/cpuinfo | grep flags | sort -u)\nflags\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl xtopology nonstop_tsc cpuid aperfmperf pni pclmulqdq monitor est ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch cpuid_fault invpcid_single pti fsgsbase bmi1 hle avx2 smep bmi2 erms invpcid rtm rdseed adx xsaveopt ida\nOS version (uname -a)\nLinux ip-172-31-24-72 4.14.67-66.56.amzn1.x86_64 #1 SMP Tue Sep 4 22:03:21 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\nCompiler version (gcc --version)\ngcc (GCC) 4.8.5 20150623 (Red Hat 4.8.5-11)\nos.environ['OMP_NUM_THREADS'] = '32'\nos.environ['KMP_BLOCKTIME'] = '0'\nos.environ['KMP_AFFINITY'] = 'granularity=fine,verbose,compact,1,0'\nK.set_image_data_format('channels_first')\nconfig = tf.ConfigProto()\nconfig.inter_op_parallelism_threads = 1\nconfig.intra_op_parallelism_threads = 32\nsession = tf.Session(config=config)\nK.set_session(session)\n\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nYes\n\n\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:\nNo\n\n\nTensorFlow installed from (source or binary):\nSource\n\n\nTensorFlow version (use command below):\n1.10.0\n\n\nPython version:\n2.7\n\n\nBazel version (if compiling from source):\nhttps://copr.fedorainfracloud.org/coprs/vbatts/bazel/repo/epel-7/vbatts-bazel-epel-7.repo\n\n\nCUDA/cuDNN version:\nNone\n\n\nGPU model and memory:\nNone", "body": "I am trying to reduce the time taken by an LSTM model using MKL. I use Tensorflow 1.10.0. I have give information about configuration I am using below. It will be great, if you can help me improve the speed of my model. Please let me know what more information you need. Thanks a lot!\r\n\r\nCPU make and model (try lscpu; if your lscpu does not list CPU flags,\r\ntry running cat /proc/cpuinfo | grep flags | sort -u)\r\nflags\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl xtopology nonstop_tsc cpuid aperfmperf pni pclmulqdq monitor est ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch cpuid_fault invpcid_single pti fsgsbase bmi1 hle avx2 smep bmi2 erms invpcid rtm rdseed adx xsaveopt ida\r\n\r\nOS version (uname -a)\r\nLinux ip-172-31-24-72 4.14.67-66.56.amzn1.x86_64 #1 SMP Tue Sep 4 22:03:21 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nCompiler version (gcc --version)\r\ngcc (GCC) 4.8.5 20150623 (Red Hat 4.8.5-11)\r\n\r\nos.environ['OMP_NUM_THREADS'] = '32'\r\nos.environ['KMP_BLOCKTIME'] = '0'\r\nos.environ['KMP_AFFINITY'] = 'granularity=fine,verbose,compact,1,0'\r\nK.set_image_data_format('channels_first')\r\nconfig = tf.ConfigProto()\r\nconfig.inter_op_parallelism_threads = 1\r\nconfig.intra_op_parallelism_threads = 32\r\nsession = tf.Session(config=config)\r\nK.set_session(session)\r\n\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\nYes\r\n\r\n- **Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device**:\r\nNo\r\n\r\n- **TensorFlow installed from (source or binary)**:\r\nSource\r\n\r\n- **TensorFlow version (use command below)**:\r\n1.10.0\r\n\r\n- **Python version**:\r\n2.7\r\n\r\n- **Bazel version (if compiling from source)**:\r\nhttps://copr.fedorainfracloud.org/coprs/vbatts/bazel/repo/epel-7/vbatts-bazel-epel-7.repo\r\n\r\n- **CUDA/cuDNN version**:\r\nNone\r\n\r\n- **GPU model and memory**:\r\nNone"}