{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21429", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21429/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21429/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21429/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/21429", "id": 348179866, "node_id": "MDU6SXNzdWUzNDgxNzk4NjY=", "number": 21429, "title": "TocoConvertor: converting keras models to tflite doesn't support custom objects", "user": {"login": "ophiry", "id": 5228696, "node_id": "MDQ6VXNlcjUyMjg2OTY=", "avatar_url": "https://avatars1.githubusercontent.com/u/5228696?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ophiry", "html_url": "https://github.com/ophiry", "followers_url": "https://api.github.com/users/ophiry/followers", "following_url": "https://api.github.com/users/ophiry/following{/other_user}", "gists_url": "https://api.github.com/users/ophiry/gists{/gist_id}", "starred_url": "https://api.github.com/users/ophiry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ophiry/subscriptions", "organizations_url": "https://api.github.com/users/ophiry/orgs", "repos_url": "https://api.github.com/users/ophiry/repos", "events_url": "https://api.github.com/users/ophiry/events{/privacy}", "received_events_url": "https://api.github.com/users/ophiry/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 750616506, "node_id": "MDU6TGFiZWw3NTA2MTY1MDY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:lite", "name": "comp:lite", "color": "0052cc", "default": false}, {"id": 473173272, "node_id": "MDU6TGFiZWw0NzMxNzMyNzI=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:feature", "name": "type:feature", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "gargn", "id": 1900612, "node_id": "MDQ6VXNlcjE5MDA2MTI=", "avatar_url": "https://avatars2.githubusercontent.com/u/1900612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gargn", "html_url": "https://github.com/gargn", "followers_url": "https://api.github.com/users/gargn/followers", "following_url": "https://api.github.com/users/gargn/following{/other_user}", "gists_url": "https://api.github.com/users/gargn/gists{/gist_id}", "starred_url": "https://api.github.com/users/gargn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gargn/subscriptions", "organizations_url": "https://api.github.com/users/gargn/orgs", "repos_url": "https://api.github.com/users/gargn/repos", "events_url": "https://api.github.com/users/gargn/events{/privacy}", "received_events_url": "https://api.github.com/users/gargn/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "gargn", "id": 1900612, "node_id": "MDQ6VXNlcjE5MDA2MTI=", "avatar_url": "https://avatars2.githubusercontent.com/u/1900612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gargn", "html_url": "https://github.com/gargn", "followers_url": "https://api.github.com/users/gargn/followers", "following_url": "https://api.github.com/users/gargn/following{/other_user}", "gists_url": "https://api.github.com/users/gargn/gists{/gist_id}", "starred_url": "https://api.github.com/users/gargn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gargn/subscriptions", "organizations_url": "https://api.github.com/users/gargn/orgs", "repos_url": "https://api.github.com/users/gargn/repos", "events_url": "https://api.github.com/users/gargn/events{/privacy}", "received_events_url": "https://api.github.com/users/gargn/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2018-08-07T06:08:42Z", "updated_at": "2018-09-11T18:40:35Z", "closed_at": "2018-09-11T18:40:34Z", "author_association": "NONE", "body_html": "<p>Have I written custom code: No<br>\nOS Platform and Distribution: Mac<br>\nTensorFlow installed from: pip<br>\nTensorFlow version: 1.10-rc1<br>\nBazel version: N/A<br>\nCUDA/cuDNN version: N/A<br>\nGPU model and memory: N/A<br>\nExact command to reproduce: <code>tensorflow.contrib.lite.TocoConverter.from_keras_model_file(model_file, custom_objects=CUSTOM_OBJECTS)</code><br>\nMobile device: N/A</p>\n<hr>\n<p>This is required to convert models that use custom layers or loss functions</p>\n<p>this is the fix (will submit a PR soon):</p>\n<pre><code>From 2c2179765cc9006762cf75c6a1b587e06895b869 Mon Sep 17 00:00:00 2001\nFrom: Ophir Yoktan &lt;ophir@ziprecruiter.com&gt;\nDate: Wed, 1 Aug 2018 10:16:10 +0300\nSubject: [PATCH] add support for custom_objects when loading keras model for\n conversion\n\n---\n tensorflow/contrib/lite/python/lite.py | 5 +++--\n 1 file changed, 3 insertions(+), 2 deletions(-)\n\ndiff --git a/tensorflow/contrib/lite/python/lite.py b/tensorflow/contrib/lite/python/lite.py\nindex 2f9b9d469a2..c12617df061 100644\n--- a/tensorflow/contrib/lite/python/lite.py\n+++ b/tensorflow/contrib/lite/python/lite.py\n@@ -274,7 +274,8 @@ def from_keras_model_file(cls,\n                             model_file,\n                             input_arrays=None,\n                             input_shapes=None,\n-                            output_arrays=None):\n+                            output_arrays=None,\n+                            custom_objects=None):\n     \"\"\"Creates a TocoConverter class from a tf.keras model file.\n \n     Args:\n@@ -293,7 +294,7 @@ def from_keras_model_file(cls,\n     \"\"\"\n     _keras.backend.clear_session()\n     _keras.backend.set_learning_phase(False)\n-    keras_model = _keras.models.load_model(model_file)\n+    keras_model = _keras.models.load_model(model_file, custom_objects=custom_objects)\n     sess = _keras.backend.get_session()\n \n     # Get input and output tensors.\n</code></pre>", "body_text": "Have I written custom code: No\nOS Platform and Distribution: Mac\nTensorFlow installed from: pip\nTensorFlow version: 1.10-rc1\nBazel version: N/A\nCUDA/cuDNN version: N/A\nGPU model and memory: N/A\nExact command to reproduce: tensorflow.contrib.lite.TocoConverter.from_keras_model_file(model_file, custom_objects=CUSTOM_OBJECTS)\nMobile device: N/A\n\nThis is required to convert models that use custom layers or loss functions\nthis is the fix (will submit a PR soon):\nFrom 2c2179765cc9006762cf75c6a1b587e06895b869 Mon Sep 17 00:00:00 2001\nFrom: Ophir Yoktan <ophir@ziprecruiter.com>\nDate: Wed, 1 Aug 2018 10:16:10 +0300\nSubject: [PATCH] add support for custom_objects when loading keras model for\n conversion\n\n---\n tensorflow/contrib/lite/python/lite.py | 5 +++--\n 1 file changed, 3 insertions(+), 2 deletions(-)\n\ndiff --git a/tensorflow/contrib/lite/python/lite.py b/tensorflow/contrib/lite/python/lite.py\nindex 2f9b9d469a2..c12617df061 100644\n--- a/tensorflow/contrib/lite/python/lite.py\n+++ b/tensorflow/contrib/lite/python/lite.py\n@@ -274,7 +274,8 @@ def from_keras_model_file(cls,\n                             model_file,\n                             input_arrays=None,\n                             input_shapes=None,\n-                            output_arrays=None):\n+                            output_arrays=None,\n+                            custom_objects=None):\n     \"\"\"Creates a TocoConverter class from a tf.keras model file.\n \n     Args:\n@@ -293,7 +294,7 @@ def from_keras_model_file(cls,\n     \"\"\"\n     _keras.backend.clear_session()\n     _keras.backend.set_learning_phase(False)\n-    keras_model = _keras.models.load_model(model_file)\n+    keras_model = _keras.models.load_model(model_file, custom_objects=custom_objects)\n     sess = _keras.backend.get_session()\n \n     # Get input and output tensors.", "body": "Have I written custom code: No\r\nOS Platform and Distribution: Mac \r\nTensorFlow installed from: pip\r\nTensorFlow version: 1.10-rc1\r\nBazel version: N/A\r\nCUDA/cuDNN version: N/A\r\nGPU model and memory: N/A\r\nExact command to reproduce: `tensorflow.contrib.lite.TocoConverter.from_keras_model_file(model_file, custom_objects=CUSTOM_OBJECTS)`\r\nMobile device: N/A\r\n\r\n-----\r\n\r\nThis is required to convert models that use custom layers or loss functions\r\n\r\nthis is the fix (will submit a PR soon):\r\n```\r\nFrom 2c2179765cc9006762cf75c6a1b587e06895b869 Mon Sep 17 00:00:00 2001\r\nFrom: Ophir Yoktan <ophir@ziprecruiter.com>\r\nDate: Wed, 1 Aug 2018 10:16:10 +0300\r\nSubject: [PATCH] add support for custom_objects when loading keras model for\r\n conversion\r\n\r\n---\r\n tensorflow/contrib/lite/python/lite.py | 5 +++--\r\n 1 file changed, 3 insertions(+), 2 deletions(-)\r\n\r\ndiff --git a/tensorflow/contrib/lite/python/lite.py b/tensorflow/contrib/lite/python/lite.py\r\nindex 2f9b9d469a2..c12617df061 100644\r\n--- a/tensorflow/contrib/lite/python/lite.py\r\n+++ b/tensorflow/contrib/lite/python/lite.py\r\n@@ -274,7 +274,8 @@ def from_keras_model_file(cls,\r\n                             model_file,\r\n                             input_arrays=None,\r\n                             input_shapes=None,\r\n-                            output_arrays=None):\r\n+                            output_arrays=None,\r\n+                            custom_objects=None):\r\n     \"\"\"Creates a TocoConverter class from a tf.keras model file.\r\n \r\n     Args:\r\n@@ -293,7 +294,7 @@ def from_keras_model_file(cls,\r\n     \"\"\"\r\n     _keras.backend.clear_session()\r\n     _keras.backend.set_learning_phase(False)\r\n-    keras_model = _keras.models.load_model(model_file)\r\n+    keras_model = _keras.models.load_model(model_file, custom_objects=custom_objects)\r\n     sess = _keras.backend.get_session()\r\n \r\n     # Get input and output tensors.\r\n```"}