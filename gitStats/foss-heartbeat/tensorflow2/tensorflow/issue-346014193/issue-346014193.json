{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21260", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21260/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21260/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21260/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/21260", "id": 346014193, "node_id": "MDU6SXNzdWUzNDYwMTQxOTM=", "number": 21260, "title": "Using Dataset api with Estimator in MirroredStrategy, Dst tensor is not initialized", "user": {"login": "Jetcodery", "id": 31854634, "node_id": "MDQ6VXNlcjMxODU0NjM0", "avatar_url": "https://avatars1.githubusercontent.com/u/31854634?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jetcodery", "html_url": "https://github.com/Jetcodery", "followers_url": "https://api.github.com/users/Jetcodery/followers", "following_url": "https://api.github.com/users/Jetcodery/following{/other_user}", "gists_url": "https://api.github.com/users/Jetcodery/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jetcodery/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jetcodery/subscriptions", "organizations_url": "https://api.github.com/users/Jetcodery/orgs", "repos_url": "https://api.github.com/users/Jetcodery/repos", "events_url": "https://api.github.com/users/Jetcodery/events{/privacy}", "received_events_url": "https://api.github.com/users/Jetcodery/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 996845227, "node_id": "MDU6TGFiZWw5OTY4NDUyMjc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:dist-strat", "name": "comp:dist-strat", "color": "0052cc", "default": false}, {"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "guptapriya", "id": 14104855, "node_id": "MDQ6VXNlcjE0MTA0ODU1", "avatar_url": "https://avatars1.githubusercontent.com/u/14104855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guptapriya", "html_url": "https://github.com/guptapriya", "followers_url": "https://api.github.com/users/guptapriya/followers", "following_url": "https://api.github.com/users/guptapriya/following{/other_user}", "gists_url": "https://api.github.com/users/guptapriya/gists{/gist_id}", "starred_url": "https://api.github.com/users/guptapriya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guptapriya/subscriptions", "organizations_url": "https://api.github.com/users/guptapriya/orgs", "repos_url": "https://api.github.com/users/guptapriya/repos", "events_url": "https://api.github.com/users/guptapriya/events{/privacy}", "received_events_url": "https://api.github.com/users/guptapriya/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "guptapriya", "id": 14104855, "node_id": "MDQ6VXNlcjE0MTA0ODU1", "avatar_url": "https://avatars1.githubusercontent.com/u/14104855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guptapriya", "html_url": "https://github.com/guptapriya", "followers_url": "https://api.github.com/users/guptapriya/followers", "following_url": "https://api.github.com/users/guptapriya/following{/other_user}", "gists_url": "https://api.github.com/users/guptapriya/gists{/gist_id}", "starred_url": "https://api.github.com/users/guptapriya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guptapriya/subscriptions", "organizations_url": "https://api.github.com/users/guptapriya/orgs", "repos_url": "https://api.github.com/users/guptapriya/repos", "events_url": "https://api.github.com/users/guptapriya/events{/privacy}", "received_events_url": "https://api.github.com/users/guptapriya/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2018-07-31T02:41:39Z", "updated_at": "2018-09-28T21:52:41Z", "closed_at": "2018-09-28T21:52:09Z", "author_association": "NONE", "body_html": "<h3><strong>System information</strong></h3>\n<ul>\n<li>Have I written custom code (as opposed to using a stock example script provided in TensorFlow):</li>\n<li>OS Platform and Distribution (e.g., Linux Ubuntu 16.04): centos</li>\n<li>TensorFlow installed from (source or binary): source</li>\n<li>TensorFlow version (use command below):1.9.0</li>\n<li>Python version: python 2.7</li>\n<li>Bazel version (if compiling from source): 0.15.0</li>\n<li>GCC/Compiler version (if compiling from source):4.8.5</li>\n<li>CUDA/cuDNN version: 9.0</li>\n<li>GPU model and memory:GeForce GTX 1080Ti * 4</li>\n<li>Exact command to reproduce:</li>\n</ul>\n<h3><strong>Describe the problem</strong></h3>\n<p>In order to solve the problem here:<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"326916279\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/19588\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/19588/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/19588\">#19588</a>, I git clone the master branch of tensorflow and compile it with bazel 0.15.0, then the  \"Non-DMA-safe string tensor error\" disappeared ,  the training went well , but when the evaluation part start, it ran into this:<br>\n<strong>'Dst tensor is not initialized'</strong><br>\nit should be a \u201cNot enough memory\u201d problem , what i have tried:</p>\n<ol>\n<li>tune the batchsize to a very small one</li>\n<li>set config.gpu_options.per_process_gpu_memory_fraction to a smaller fraction like 0.6</li>\n<li>set config.gpu_options.allow_growth to True</li>\n<li>use a small dataset</li>\n</ol>\n<p>But none of them can help .</p>\n<h3><strong>Source code / logs</strong></h3>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/31854634/43434228-5b6e6356-94ad-11e8-9e8d-e00a2c64bb1a.png\"><img src=\"https://user-images.githubusercontent.com/31854634/43434228-5b6e6356-94ad-11e8-9e8d-e00a2c64bb1a.png\" alt=\"image\" style=\"max-width:100%;\"></a></p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/31854634/43434328-c4f53642-94ad-11e8-8113-554a1c03c5a9.png\"><img src=\"https://user-images.githubusercontent.com/31854634/43434328-c4f53642-94ad-11e8-8113-554a1c03c5a9.png\" alt=\"image\" style=\"max-width:100%;\"></a></p>\n<p>LOG\uff1a<br>\n(Jet_env_3) [lijiaji@m7-model-gpu05 classification]$ python demo.py<br>\n2018-07-30 11:49:33,994:INFO:tensorflow:Begin configure dataset.<br>\n2018-07-30 11:49:34,210:INFO:tensorflow:End configure dataset.<br>\n2018-07-30 11:49:34,210:INFO:tensorflow:Mission hyper parameters<br>\n2018-07-30 11:49:34,210:INFO:tensorflow:{'adagrad_initial_accumulator_value': 0.1, 'label_list': ['1', '0', '3', '2', '5', '4', '7', '6', '9', '8'], 'learning_rate_decay_factor': 0.94, 'learning_rate_decay_type': 'exponential', 'save_steps': 1000, 'ftrl_initial_accumulator_value': 0.1, 'ftrl_learning_rate_power': -0.5, 'num_train_samples': 48000, 'rmsprop_decay': 0.9, 'weight_decay': 4e-05, 'end_learning_rate': 0.0001, 'num_epochs': 2, 'trainable_scopes': None, 'checkpoint_path': None, 'finetune_flag': 'False', 'rmsprop_momentum': 0.9, 'model_dir': '/home/lijiaji/test_models/multi_gou_test', 'replicas_to_aggregate': 1, 'learning_rate': 0.01, 'momentum': 0.9, 'opt_epsilon': 1.0, 'optimizer': 'momentum', 'num_epochs_per_decay': 2.0, 'label_smoothing': 0.0, 'adam_beta1': 0.9, 'adam_beta2': 0.999, 'batch_size': 32, 'num_classes': 10, 'ftrl_l1': 0.0, 'ftrl_l2': 0.0, 'train_image_size': 224, 'train_dir': '/home/lijiaji/project/augments/mnist', 'moving_average_decay': None, 'sync_replicas': False, 'checkpoint_exclude_scopes': None, 'ignore_missing_vars': False, 'model_name': 'inception_resnet_v2', 'adadelta_rho': 0.95}<br>\n2018-07-30 11:49:34,211:INFO:tensorflow:Using config: {'_save_checkpoints_secs': None, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_cluster_spec': &lt;tensorflow.python.training.server_lib.ClusterSpec object at 0x7f0dcd846ed0&gt;, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tf_random_seed': 912, '_device_fn': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': 100, '_evaluation_master': '', '_train_distribute': &lt;tensorflow.contrib.distribute.python.mirrored_strategy.MirroredStrategy object at 0x7f0dcd846b90&gt;, '_session_config': gpu_options {<br>\nallow_growth: true<br>\n}<br>\nallow_soft_placement: true<br>\n, '_global_id_in_cluster': 0, '_is_chief': True, '_protocol': None, '_save_checkpoints_steps': 1000, '_save_summary_steps': 1000, '_model_dir': '/home/lijiaji/test_models/multi_gou_test', '_master': ''}<br>\n2018-07-30 11:49:34,212:INFO:tensorflow:Starting epoch 1 / 2<br>\n2018-07-30 11:49:42,557:INFO:tensorflow:Device is available but not used by distribute strategy: /device:CPU:0<br>\n2018-07-30 11:49:42,559:INFO:tensorflow:Device is available but not used by distribute strategy: /device:XLA_GPU:0<br>\n2018-07-30 11:49:42,559:INFO:tensorflow:Device is available but not used by distribute strategy: /device:XLA_CPU:0<br>\n2018-07-30 11:49:42,559:INFO:tensorflow:Device is available but not used by distribute strategy: /device:GPU:0<br>\n2018-07-30 11:49:42,559:INFO:tensorflow:Device is available but not used by distribute strategy: /device:GPU:1<br>\n2018-07-30 11:49:42,559:INFO:tensorflow:Configured nccl all-reduce.<br>\n2018-07-30 11:49:42,655:INFO:tensorflow:Calling model_fn.<br>\n2018-07-30 11:50:09,603:INFO:tensorflow:Calling model_fn.<br>\n2018-07-30 11:50:22,764:INFO:tensorflow:batch_all_reduce invoked for batches size = 496 with algorithm = nccl, num_packs = 1, agg_small_grads_max_bytes = 0 and agg_small_grads_max_group = 10<br>\n2018-07-30 11:50:34,055:INFO:tensorflow:Done calling model_fn.<br>\n2018-07-30 11:50:34,067:INFO:tensorflow:Done calling model_fn.<br>\n2018-07-30 11:50:39,149:INFO:tensorflow:Create CheckpointSaverHook.<br>\n2018-07-30 11:51:11,985:INFO:tensorflow:Graph was finalized.<br>\n2018-07-30 11:51:37,259:INFO:tensorflow:Running local_init_op.<br>\n2018-07-30 11:51:38,022:INFO:tensorflow:Done running local_init_op.<br>\n2018-07-30 11:52:26,489:INFO:tensorflow:Saving checkpoints for 0 into /home/lijiaji/test_models/multi_gou_test/model.ckpt.<br>\n18/07/30 11:53:09 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable<br>\n2018-07-30 11:53:21,956:INFO:tensorflow:loss = 11.345272, step = 0<br>\n2018-07-30 11:55:20,779:INFO:tensorflow:global_step/sec: 0.841569<br>\n2018-07-30 11:55:20,780:INFO:tensorflow:loss = 1.7503239, step = 100 (118.825 sec)<br>\n2018-07-30 11:56:24,385:INFO:tensorflow:global_step/sec: 1.5722<br>\n2018-07-30 11:56:24,385:INFO:tensorflow:loss = 1.5974646, step = 200 (63.605 sec)<br>\n2018-07-30 11:57:28,862:INFO:tensorflow:global_step/sec: 1.55093<br>\n2018-07-30 11:57:28,863:INFO:tensorflow:loss = 1.3371584, step = 300 (64.478 sec)<br>\n2018-07-30 11:58:18,151:INFO:tensorflow:Saving checkpoints for 375 into /home/lijiaji/test_models/multi_gou_test/model.ckpt.<br>\n2018-07-30 11:58:28,894:INFO:tensorflow:Loss for final step: 1.3792272.<br>\n2018-07-30 11:58:28,900:INFO:tensorflow:Begin evaluation of epoch 1<br>\n2018-07-30 11:58:28,973:INFO:tensorflow:Calling model_fn.<br>\n2018-07-30 11:58:36,515:INFO:tensorflow:Done calling model_fn.<br>\n2018-07-30 11:58:36,539:INFO:tensorflow:Starting evaluation at 2018-07-30-03:58:36<br>\n2018-07-30 11:58:41,904:INFO:tensorflow:Graph was finalized.<br>\n2018-07-30 11:58:41,907:INFO:tensorflow:Restoring parameters from /home/lijiaji/test_models/multi_gou_test/model.ckpt-375<br>\nTraceback (most recent call last):<br>\nFile \"demo.py\", line 22, in <br>\nrun(config)<br>\nFile \"/mnt/disk0/home/lijiaji/test_cvalgo/cv_algo/classification/run_classification.py\", line 473, in run<br>\nrun_impl(args)<br>\nFile \"/mnt/disk0/home/lijiaji/test_cvalgo/cv_algo/classification/run_classification.py\", line 435, in run_impl<br>\nsteps = args.save_steps * 2<br>\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 464, in evaluate<br>\noutput_dir=self.eval_dir(name))<br>\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1521, in _evaluate_run<br>\nconfig=self._session_config)<br>\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/evaluation.py\", line 209, in _evaluate_once<br>\nsession_creator=session_creator, hooks=hooks) as session:<br>\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 832, in <strong>init</strong><br>\nstop_grace_period_secs=stop_grace_period_secs)<br>\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 555, in <strong>init</strong><br>\nself._sess = _RecoverableSession(self._coordinated_creator)<br>\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1018, in <strong>init</strong><br>\n_WrappedSession.<strong>init</strong>(self, self._create_session())<br>\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1023, in _create_session<br>\nreturn self._sess_creator.create_session()<br>\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 712, in create_session<br>\nself.tf_sess = self._session_creator.create_session()<br>\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 483, in create_session<br>\ninit_fn=self._scaffold.init_fn)<br>\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/session_manager.py\", line 281, in prepare_session<br>\nconfig=config)<br>\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/session_manager.py\", line 195, in _restore_checkpoint<br>\nsaver.restore(sess, checkpoint_filename_with_path)<br>\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/saver.py\", line 1727, in restore<br>\n{self.saver_def.filename_tensor_name: save_path})<br>\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 886, in run<br>\nrun_metadata_ptr)<br>\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1109, in _run<br>\nfeed_dict_tensor, options, run_metadata)<br>\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1281, in _do_run<br>\nrun_metadata)<br>\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1300, in _do_call<br>\nraise type(e)(node_def, op, message)<br>\ntensorflow.python.framework.errors_impl.InternalError: Dst tensor is not initialized.<br>\n[[Node: save/RestoreV2/_1311 = _Recv<a href=\"\">client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device_incarnation=1, tensor_name=\"edge_1315_save/RestoreV2\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"</a>]]<br>\n[[Node: save/RestoreV2/_1438 = _Send<a href=\"save/RestoreV2:719\">T=DT_FLOAT, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device_incarnation=1, tensor_name=\"edge_1443_save/RestoreV2\", _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"</a>]]</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): centos\nTensorFlow installed from (source or binary): source\nTensorFlow version (use command below):1.9.0\nPython version: python 2.7\nBazel version (if compiling from source): 0.15.0\nGCC/Compiler version (if compiling from source):4.8.5\nCUDA/cuDNN version: 9.0\nGPU model and memory:GeForce GTX 1080Ti * 4\nExact command to reproduce:\n\nDescribe the problem\nIn order to solve the problem here:#19588, I git clone the master branch of tensorflow and compile it with bazel 0.15.0, then the  \"Non-DMA-safe string tensor error\" disappeared ,  the training went well , but when the evaluation part start, it ran into this:\n'Dst tensor is not initialized'\nit should be a \u201cNot enough memory\u201d problem , what i have tried:\n\ntune the batchsize to a very small one\nset config.gpu_options.per_process_gpu_memory_fraction to a smaller fraction like 0.6\nset config.gpu_options.allow_growth to True\nuse a small dataset\n\nBut none of them can help .\nSource code / logs\n\n\nLOG\uff1a\n(Jet_env_3) [lijiaji@m7-model-gpu05 classification]$ python demo.py\n2018-07-30 11:49:33,994:INFO:tensorflow:Begin configure dataset.\n2018-07-30 11:49:34,210:INFO:tensorflow:End configure dataset.\n2018-07-30 11:49:34,210:INFO:tensorflow:Mission hyper parameters\n2018-07-30 11:49:34,210:INFO:tensorflow:{'adagrad_initial_accumulator_value': 0.1, 'label_list': ['1', '0', '3', '2', '5', '4', '7', '6', '9', '8'], 'learning_rate_decay_factor': 0.94, 'learning_rate_decay_type': 'exponential', 'save_steps': 1000, 'ftrl_initial_accumulator_value': 0.1, 'ftrl_learning_rate_power': -0.5, 'num_train_samples': 48000, 'rmsprop_decay': 0.9, 'weight_decay': 4e-05, 'end_learning_rate': 0.0001, 'num_epochs': 2, 'trainable_scopes': None, 'checkpoint_path': None, 'finetune_flag': 'False', 'rmsprop_momentum': 0.9, 'model_dir': '/home/lijiaji/test_models/multi_gou_test', 'replicas_to_aggregate': 1, 'learning_rate': 0.01, 'momentum': 0.9, 'opt_epsilon': 1.0, 'optimizer': 'momentum', 'num_epochs_per_decay': 2.0, 'label_smoothing': 0.0, 'adam_beta1': 0.9, 'adam_beta2': 0.999, 'batch_size': 32, 'num_classes': 10, 'ftrl_l1': 0.0, 'ftrl_l2': 0.0, 'train_image_size': 224, 'train_dir': '/home/lijiaji/project/augments/mnist', 'moving_average_decay': None, 'sync_replicas': False, 'checkpoint_exclude_scopes': None, 'ignore_missing_vars': False, 'model_name': 'inception_resnet_v2', 'adadelta_rho': 0.95}\n2018-07-30 11:49:34,211:INFO:tensorflow:Using config: {'_save_checkpoints_secs': None, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f0dcd846ed0>, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tf_random_seed': 912, '_device_fn': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': 100, '_evaluation_master': '', '_train_distribute': <tensorflow.contrib.distribute.python.mirrored_strategy.MirroredStrategy object at 0x7f0dcd846b90>, '_session_config': gpu_options {\nallow_growth: true\n}\nallow_soft_placement: true\n, '_global_id_in_cluster': 0, '_is_chief': True, '_protocol': None, '_save_checkpoints_steps': 1000, '_save_summary_steps': 1000, '_model_dir': '/home/lijiaji/test_models/multi_gou_test', '_master': ''}\n2018-07-30 11:49:34,212:INFO:tensorflow:Starting epoch 1 / 2\n2018-07-30 11:49:42,557:INFO:tensorflow:Device is available but not used by distribute strategy: /device:CPU:0\n2018-07-30 11:49:42,559:INFO:tensorflow:Device is available but not used by distribute strategy: /device:XLA_GPU:0\n2018-07-30 11:49:42,559:INFO:tensorflow:Device is available but not used by distribute strategy: /device:XLA_CPU:0\n2018-07-30 11:49:42,559:INFO:tensorflow:Device is available but not used by distribute strategy: /device:GPU:0\n2018-07-30 11:49:42,559:INFO:tensorflow:Device is available but not used by distribute strategy: /device:GPU:1\n2018-07-30 11:49:42,559:INFO:tensorflow:Configured nccl all-reduce.\n2018-07-30 11:49:42,655:INFO:tensorflow:Calling model_fn.\n2018-07-30 11:50:09,603:INFO:tensorflow:Calling model_fn.\n2018-07-30 11:50:22,764:INFO:tensorflow:batch_all_reduce invoked for batches size = 496 with algorithm = nccl, num_packs = 1, agg_small_grads_max_bytes = 0 and agg_small_grads_max_group = 10\n2018-07-30 11:50:34,055:INFO:tensorflow:Done calling model_fn.\n2018-07-30 11:50:34,067:INFO:tensorflow:Done calling model_fn.\n2018-07-30 11:50:39,149:INFO:tensorflow:Create CheckpointSaverHook.\n2018-07-30 11:51:11,985:INFO:tensorflow:Graph was finalized.\n2018-07-30 11:51:37,259:INFO:tensorflow:Running local_init_op.\n2018-07-30 11:51:38,022:INFO:tensorflow:Done running local_init_op.\n2018-07-30 11:52:26,489:INFO:tensorflow:Saving checkpoints for 0 into /home/lijiaji/test_models/multi_gou_test/model.ckpt.\n18/07/30 11:53:09 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\n2018-07-30 11:53:21,956:INFO:tensorflow:loss = 11.345272, step = 0\n2018-07-30 11:55:20,779:INFO:tensorflow:global_step/sec: 0.841569\n2018-07-30 11:55:20,780:INFO:tensorflow:loss = 1.7503239, step = 100 (118.825 sec)\n2018-07-30 11:56:24,385:INFO:tensorflow:global_step/sec: 1.5722\n2018-07-30 11:56:24,385:INFO:tensorflow:loss = 1.5974646, step = 200 (63.605 sec)\n2018-07-30 11:57:28,862:INFO:tensorflow:global_step/sec: 1.55093\n2018-07-30 11:57:28,863:INFO:tensorflow:loss = 1.3371584, step = 300 (64.478 sec)\n2018-07-30 11:58:18,151:INFO:tensorflow:Saving checkpoints for 375 into /home/lijiaji/test_models/multi_gou_test/model.ckpt.\n2018-07-30 11:58:28,894:INFO:tensorflow:Loss for final step: 1.3792272.\n2018-07-30 11:58:28,900:INFO:tensorflow:Begin evaluation of epoch 1\n2018-07-30 11:58:28,973:INFO:tensorflow:Calling model_fn.\n2018-07-30 11:58:36,515:INFO:tensorflow:Done calling model_fn.\n2018-07-30 11:58:36,539:INFO:tensorflow:Starting evaluation at 2018-07-30-03:58:36\n2018-07-30 11:58:41,904:INFO:tensorflow:Graph was finalized.\n2018-07-30 11:58:41,907:INFO:tensorflow:Restoring parameters from /home/lijiaji/test_models/multi_gou_test/model.ckpt-375\nTraceback (most recent call last):\nFile \"demo.py\", line 22, in \nrun(config)\nFile \"/mnt/disk0/home/lijiaji/test_cvalgo/cv_algo/classification/run_classification.py\", line 473, in run\nrun_impl(args)\nFile \"/mnt/disk0/home/lijiaji/test_cvalgo/cv_algo/classification/run_classification.py\", line 435, in run_impl\nsteps = args.save_steps * 2\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 464, in evaluate\noutput_dir=self.eval_dir(name))\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1521, in _evaluate_run\nconfig=self._session_config)\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/evaluation.py\", line 209, in _evaluate_once\nsession_creator=session_creator, hooks=hooks) as session:\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 832, in init\nstop_grace_period_secs=stop_grace_period_secs)\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 555, in init\nself._sess = _RecoverableSession(self._coordinated_creator)\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1018, in init\n_WrappedSession.init(self, self._create_session())\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1023, in _create_session\nreturn self._sess_creator.create_session()\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 712, in create_session\nself.tf_sess = self._session_creator.create_session()\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 483, in create_session\ninit_fn=self._scaffold.init_fn)\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/session_manager.py\", line 281, in prepare_session\nconfig=config)\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/session_manager.py\", line 195, in _restore_checkpoint\nsaver.restore(sess, checkpoint_filename_with_path)\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/saver.py\", line 1727, in restore\n{self.saver_def.filename_tensor_name: save_path})\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 886, in run\nrun_metadata_ptr)\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1109, in _run\nfeed_dict_tensor, options, run_metadata)\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1281, in _do_run\nrun_metadata)\nFile \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1300, in _do_call\nraise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InternalError: Dst tensor is not initialized.\n[[Node: save/RestoreV2/_1311 = _Recvclient_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device_incarnation=1, tensor_name=\"edge_1315_save/RestoreV2\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"]]\n[[Node: save/RestoreV2/_1438 = _SendT=DT_FLOAT, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device_incarnation=1, tensor_name=\"edge_1443_save/RestoreV2\", _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"]]", "body": "### **System information**\r\n\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow):\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 16.04): centos\r\n- TensorFlow installed from (source or binary): source\r\n- TensorFlow version (use command below):1.9.0\r\n- Python version: python 2.7\r\n- Bazel version (if compiling from source): 0.15.0\r\n- GCC/Compiler version (if compiling from source):4.8.5\r\n- CUDA/cuDNN version: 9.0\r\n- GPU model and memory:GeForce GTX 1080Ti * 4\r\n- Exact command to reproduce:\r\n### **Describe the problem**\r\n In order to solve the problem here:https://github.com/tensorflow/tensorflow/issues/19588, I git clone the master branch of tensorflow and compile it with bazel 0.15.0, then the  \"Non-DMA-safe string tensor error\" disappeared ,  the training went well , but when the evaluation part start, it ran into this: \r\n **'Dst tensor is not initialized'**\r\nit should be a \u201cNot enough memory\u201d problem , what i have tried:\r\n\r\n1. tune the batchsize to a very small one\r\n2. set config.gpu_options.per_process_gpu_memory_fraction to a smaller fraction like 0.6\r\n3. set config.gpu_options.allow_growth to True\r\n4. use a small dataset\r\n\r\nBut none of them can help .\r\n\r\n### **Source code / logs**\r\n![image](https://user-images.githubusercontent.com/31854634/43434228-5b6e6356-94ad-11e8-9e8d-e00a2c64bb1a.png)\r\n\r\n![image](https://user-images.githubusercontent.com/31854634/43434328-c4f53642-94ad-11e8-8113-554a1c03c5a9.png)\r\n\r\n\r\nLOG\uff1a\r\n(Jet_env_3) [lijiaji@m7-model-gpu05 classification]$ python demo.py \r\n2018-07-30 11:49:33,994:INFO:tensorflow:Begin configure dataset.\r\n2018-07-30 11:49:34,210:INFO:tensorflow:End configure dataset.\r\n2018-07-30 11:49:34,210:INFO:tensorflow:Mission hyper parameters\r\n2018-07-30 11:49:34,210:INFO:tensorflow:{'adagrad_initial_accumulator_value': 0.1, 'label_list': ['1', '0', '3', '2', '5', '4', '7', '6', '9', '8'], 'learning_rate_decay_factor': 0.94, 'learning_rate_decay_type': 'exponential', 'save_steps': 1000, 'ftrl_initial_accumulator_value': 0.1, 'ftrl_learning_rate_power': -0.5, 'num_train_samples': 48000, 'rmsprop_decay': 0.9, 'weight_decay': 4e-05, 'end_learning_rate': 0.0001, 'num_epochs': 2, 'trainable_scopes': None, 'checkpoint_path': None, 'finetune_flag': 'False', 'rmsprop_momentum': 0.9, 'model_dir': '/home/lijiaji/test_models/multi_gou_test', 'replicas_to_aggregate': 1, 'learning_rate': 0.01, 'momentum': 0.9, 'opt_epsilon': 1.0, 'optimizer': 'momentum', 'num_epochs_per_decay': 2.0, 'label_smoothing': 0.0, 'adam_beta1': 0.9, 'adam_beta2': 0.999, 'batch_size': 32, 'num_classes': 10, 'ftrl_l1': 0.0, 'ftrl_l2': 0.0, 'train_image_size': 224, 'train_dir': '/home/lijiaji/project/augments/mnist', 'moving_average_decay': None, 'sync_replicas': False, 'checkpoint_exclude_scopes': None, 'ignore_missing_vars': False, 'model_name': 'inception_resnet_v2', 'adadelta_rho': 0.95}\r\n2018-07-30 11:49:34,211:INFO:tensorflow:Using config: {'_save_checkpoints_secs': None, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f0dcd846ed0>, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tf_random_seed': 912, '_device_fn': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': 100, '_evaluation_master': '', '_train_distribute': <tensorflow.contrib.distribute.python.mirrored_strategy.MirroredStrategy object at 0x7f0dcd846b90>, '_session_config': gpu_options {\r\n  allow_growth: true\r\n}\r\nallow_soft_placement: true\r\n, '_global_id_in_cluster': 0, '_is_chief': True, '_protocol': None, '_save_checkpoints_steps': 1000, '_save_summary_steps': 1000, '_model_dir': '/home/lijiaji/test_models/multi_gou_test', '_master': ''}\r\n2018-07-30 11:49:34,212:INFO:tensorflow:Starting epoch 1 / 2\r\n2018-07-30 11:49:42,557:INFO:tensorflow:Device is available but not used by distribute strategy: /device:CPU:0\r\n2018-07-30 11:49:42,559:INFO:tensorflow:Device is available but not used by distribute strategy: /device:XLA_GPU:0\r\n2018-07-30 11:49:42,559:INFO:tensorflow:Device is available but not used by distribute strategy: /device:XLA_CPU:0\r\n2018-07-30 11:49:42,559:INFO:tensorflow:Device is available but not used by distribute strategy: /device:GPU:0\r\n2018-07-30 11:49:42,559:INFO:tensorflow:Device is available but not used by distribute strategy: /device:GPU:1\r\n2018-07-30 11:49:42,559:INFO:tensorflow:Configured nccl all-reduce.\r\n2018-07-30 11:49:42,655:INFO:tensorflow:Calling model_fn.\r\n2018-07-30 11:50:09,603:INFO:tensorflow:Calling model_fn.\r\n2018-07-30 11:50:22,764:INFO:tensorflow:batch_all_reduce invoked for batches size = 496 with algorithm = nccl, num_packs = 1, agg_small_grads_max_bytes = 0 and agg_small_grads_max_group = 10\r\n2018-07-30 11:50:34,055:INFO:tensorflow:Done calling model_fn.\r\n2018-07-30 11:50:34,067:INFO:tensorflow:Done calling model_fn.\r\n2018-07-30 11:50:39,149:INFO:tensorflow:Create CheckpointSaverHook.\r\n2018-07-30 11:51:11,985:INFO:tensorflow:Graph was finalized.\r\n2018-07-30 11:51:37,259:INFO:tensorflow:Running local_init_op.\r\n2018-07-30 11:51:38,022:INFO:tensorflow:Done running local_init_op.\r\n2018-07-30 11:52:26,489:INFO:tensorflow:Saving checkpoints for 0 into /home/lijiaji/test_models/multi_gou_test/model.ckpt.\r\n18/07/30 11:53:09 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\r\n2018-07-30 11:53:21,956:INFO:tensorflow:loss = 11.345272, step = 0\r\n2018-07-30 11:55:20,779:INFO:tensorflow:global_step/sec: 0.841569\r\n2018-07-30 11:55:20,780:INFO:tensorflow:loss = 1.7503239, step = 100 (118.825 sec)\r\n2018-07-30 11:56:24,385:INFO:tensorflow:global_step/sec: 1.5722\r\n2018-07-30 11:56:24,385:INFO:tensorflow:loss = 1.5974646, step = 200 (63.605 sec)\r\n2018-07-30 11:57:28,862:INFO:tensorflow:global_step/sec: 1.55093\r\n2018-07-30 11:57:28,863:INFO:tensorflow:loss = 1.3371584, step = 300 (64.478 sec)\r\n2018-07-30 11:58:18,151:INFO:tensorflow:Saving checkpoints for 375 into /home/lijiaji/test_models/multi_gou_test/model.ckpt.\r\n2018-07-30 11:58:28,894:INFO:tensorflow:Loss for final step: 1.3792272.\r\n2018-07-30 11:58:28,900:INFO:tensorflow:Begin evaluation of epoch 1\r\n2018-07-30 11:58:28,973:INFO:tensorflow:Calling model_fn.\r\n2018-07-30 11:58:36,515:INFO:tensorflow:Done calling model_fn.\r\n2018-07-30 11:58:36,539:INFO:tensorflow:Starting evaluation at 2018-07-30-03:58:36\r\n2018-07-30 11:58:41,904:INFO:tensorflow:Graph was finalized.\r\n2018-07-30 11:58:41,907:INFO:tensorflow:Restoring parameters from /home/lijiaji/test_models/multi_gou_test/model.ckpt-375\r\nTraceback (most recent call last):\r\n  File \"demo.py\", line 22, in <module>\r\n    run(config)\r\n  File \"/mnt/disk0/home/lijiaji/test_cvalgo/cv_algo/classification/run_classification.py\", line 473, in run\r\n    run_impl(args)   \r\n  File \"/mnt/disk0/home/lijiaji/test_cvalgo/cv_algo/classification/run_classification.py\", line 435, in run_impl\r\n    steps = args.save_steps * 2\r\n  File \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 464, in evaluate\r\n    output_dir=self.eval_dir(name))\r\n  File \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1521, in _evaluate_run\r\n    config=self._session_config)\r\n  File \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/evaluation.py\", line 209, in _evaluate_once\r\n    session_creator=session_creator, hooks=hooks) as session:\r\n  File \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 832, in __init__\r\n    stop_grace_period_secs=stop_grace_period_secs)\r\n  File \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 555, in __init__\r\n    self._sess = _RecoverableSession(self._coordinated_creator)\r\n  File \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1018, in __init__\r\n    _WrappedSession.__init__(self, self._create_session())\r\n  File \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1023, in _create_session\r\n    return self._sess_creator.create_session()\r\n  File \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 712, in create_session\r\n    self.tf_sess = self._session_creator.create_session()\r\n  File \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 483, in create_session\r\n    init_fn=self._scaffold.init_fn)\r\n  File \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/session_manager.py\", line 281, in prepare_session\r\n    config=config)\r\n  File \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/session_manager.py\", line 195, in _restore_checkpoint\r\n    saver.restore(sess, checkpoint_filename_with_path)\r\n  File \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/training/saver.py\", line 1727, in restore\r\n    {self.saver_def.filename_tensor_name: save_path})\r\n  File \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 886, in run\r\n    run_metadata_ptr)\r\n  File \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1109, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1281, in _do_run\r\n    run_metadata)\r\n  File \"/home/lijiaji/anaconda2/envs/Jet_env_3/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1300, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InternalError: Dst tensor is not initialized.\r\n\t [[Node: save/RestoreV2/_1311 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device_incarnation=1, tensor_name=\"edge_1315_save/RestoreV2\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"]()]]\r\n\t [[Node: save/RestoreV2/_1438 = _Send[T=DT_FLOAT, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device_incarnation=1, tensor_name=\"edge_1443_save/RestoreV2\", _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](save/RestoreV2:719)]]\r\n"}