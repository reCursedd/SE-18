{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7316", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7316/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7316/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7316/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/7316", "id": 205785967, "node_id": "MDU6SXNzdWUyMDU3ODU5Njc=", "number": 7316, "title": "Explicit device does not work with saved GraphDef?", "user": {"login": "D-X-Y", "id": 9547057, "node_id": "MDQ6VXNlcjk1NDcwNTc=", "avatar_url": "https://avatars0.githubusercontent.com/u/9547057?v=4", "gravatar_id": "", "url": "https://api.github.com/users/D-X-Y", "html_url": "https://github.com/D-X-Y", "followers_url": "https://api.github.com/users/D-X-Y/followers", "following_url": "https://api.github.com/users/D-X-Y/following{/other_user}", "gists_url": "https://api.github.com/users/D-X-Y/gists{/gist_id}", "starred_url": "https://api.github.com/users/D-X-Y/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/D-X-Y/subscriptions", "organizations_url": "https://api.github.com/users/D-X-Y/orgs", "repos_url": "https://api.github.com/users/D-X-Y/repos", "events_url": "https://api.github.com/users/D-X-Y/events{/privacy}", "received_events_url": "https://api.github.com/users/D-X-Y/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-02-07T04:50:31Z", "updated_at": "2017-02-07T05:09:37Z", "closed_at": "2017-02-07T05:09:37Z", "author_association": "NONE", "body_html": "<h3>explicit device seems not work with a saved GragphDef</h3>\n<p>I try <a href=\"https://github.com/tensorflow/models/blob/master/tutorials/image/imagenet/classify_image.py\">https://github.com/tensorflow/models/blob/master/tutorials/image/imagenet/classify_image.py</a><br>\nand want to use gpu to classify an image.</p>\n<p>I change the create-graph code</p>\n<pre><code>  with tf.device(\"/gpu:0\"):\n    with tf.gfile.FastGFile(os.path.join(\n      FLAGS.model_dir, 'classify_image_graph_def.pb'), 'rb') as f:\n      graph_def = tf.GraphDef()\n      graph_def.ParseFromString(f.read())\n      _ = tf.import_graph_def(graph_def, name='')\n\n  with tf.Session(config=tf.ConfigProto(\n      allow_soft_placement=True, log_device_placement=True)) as sess:\n</code></pre>\n<p>but from logs all operations are done on cpu not gpu.</p>\n<p>Is there anyone to help me use gpu with classify_image.py</p>\n<h3>Environment info</h3>\n<p>Operating System: Ubuntu 14.04 LTS, tensorflow 0.12.1<br>\nCUDA: 7.5.18<br>\ncuDNN: v5.1<br>\ninstalled via <code>sudo pip install tensorflow --upgrade</code></p>\n<h3>Logs</h3>\n<pre><code>conv_2/batchnorm/gamma: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_2/batchnorm/gamma: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv_2/batchnorm/beta: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_2/batchnorm/beta: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv_2/conv2d_params: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_2/conv2d_params: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv_1/batchnorm/moving_variance: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_1/batchnorm/moving_variance: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv_1/batchnorm/moving_mean: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_1/batchnorm/moving_mean: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv_1/batchnorm/gamma: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_1/batchnorm/gamma: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv_1/batchnorm/beta: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_1/batchnorm/beta: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv_1/conv2d_params: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_1/conv2d_params: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv/batchnorm/moving_variance: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv/batchnorm/moving_variance: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv/batchnorm/moving_mean: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv/batchnorm/moving_mean: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv/batchnorm/gamma: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv/batchnorm/gamma: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv/batchnorm/beta: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv/batchnorm/beta: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv/conv2d_params: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv/conv2d_params: (Const)/job:localhost/replica:0/task:0/cpu:0\nMul/y: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] Mul/y: (Const)/job:localhost/replica:0/task:0/cpu:0\nSub/y: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] Sub/y: (Const)/job:localhost/replica:0/task:0/cpu:0\nResizeBilinear/size: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] ResizeBilinear/size: (Const)/job:localhost/replica:0/task:0/cpu:0\nExpandDims/dim: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] ExpandDims/dim: (Const)/job:localhost/replica:0/task:0/cpu:0\nDecodeJpeg/contents: (Const): /job:localhost/replica:0/task:0/cpu:0\n</code></pre>", "body_text": "explicit device seems not work with a saved GragphDef\nI try https://github.com/tensorflow/models/blob/master/tutorials/image/imagenet/classify_image.py\nand want to use gpu to classify an image.\nI change the create-graph code\n  with tf.device(\"/gpu:0\"):\n    with tf.gfile.FastGFile(os.path.join(\n      FLAGS.model_dir, 'classify_image_graph_def.pb'), 'rb') as f:\n      graph_def = tf.GraphDef()\n      graph_def.ParseFromString(f.read())\n      _ = tf.import_graph_def(graph_def, name='')\n\n  with tf.Session(config=tf.ConfigProto(\n      allow_soft_placement=True, log_device_placement=True)) as sess:\n\nbut from logs all operations are done on cpu not gpu.\nIs there anyone to help me use gpu with classify_image.py\nEnvironment info\nOperating System: Ubuntu 14.04 LTS, tensorflow 0.12.1\nCUDA: 7.5.18\ncuDNN: v5.1\ninstalled via sudo pip install tensorflow --upgrade\nLogs\nconv_2/batchnorm/gamma: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_2/batchnorm/gamma: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv_2/batchnorm/beta: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_2/batchnorm/beta: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv_2/conv2d_params: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_2/conv2d_params: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv_1/batchnorm/moving_variance: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_1/batchnorm/moving_variance: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv_1/batchnorm/moving_mean: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_1/batchnorm/moving_mean: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv_1/batchnorm/gamma: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_1/batchnorm/gamma: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv_1/batchnorm/beta: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_1/batchnorm/beta: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv_1/conv2d_params: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_1/conv2d_params: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv/batchnorm/moving_variance: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv/batchnorm/moving_variance: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv/batchnorm/moving_mean: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv/batchnorm/moving_mean: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv/batchnorm/gamma: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv/batchnorm/gamma: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv/batchnorm/beta: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv/batchnorm/beta: (Const)/job:localhost/replica:0/task:0/cpu:0\nconv/conv2d_params: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv/conv2d_params: (Const)/job:localhost/replica:0/task:0/cpu:0\nMul/y: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] Mul/y: (Const)/job:localhost/replica:0/task:0/cpu:0\nSub/y: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] Sub/y: (Const)/job:localhost/replica:0/task:0/cpu:0\nResizeBilinear/size: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] ResizeBilinear/size: (Const)/job:localhost/replica:0/task:0/cpu:0\nExpandDims/dim: (Const): /job:localhost/replica:0/task:0/cpu:0\nI tensorflow/core/common_runtime/simple_placer.cc:827] ExpandDims/dim: (Const)/job:localhost/replica:0/task:0/cpu:0\nDecodeJpeg/contents: (Const): /job:localhost/replica:0/task:0/cpu:0", "body": "### explicit device seems not work with a saved GragphDef\r\nI try https://github.com/tensorflow/models/blob/master/tutorials/image/imagenet/classify_image.py\r\nand want to use gpu to classify an image.\r\n\r\nI change the create-graph code\r\n```\r\n  with tf.device(\"/gpu:0\"):\r\n    with tf.gfile.FastGFile(os.path.join(\r\n      FLAGS.model_dir, 'classify_image_graph_def.pb'), 'rb') as f:\r\n      graph_def = tf.GraphDef()\r\n      graph_def.ParseFromString(f.read())\r\n      _ = tf.import_graph_def(graph_def, name='')\r\n\r\n  with tf.Session(config=tf.ConfigProto(\r\n      allow_soft_placement=True, log_device_placement=True)) as sess:\r\n```\r\nbut from logs all operations are done on cpu not gpu.\r\n\r\nIs there anyone to help me use gpu with classify_image.py\r\n### Environment info\r\nOperating System: Ubuntu 14.04 LTS, tensorflow 0.12.1\r\nCUDA: 7.5.18 \r\ncuDNN: v5.1\r\ninstalled via `sudo pip install tensorflow --upgrade`\r\n\r\n### Logs\r\n```\r\nconv_2/batchnorm/gamma: (Const): /job:localhost/replica:0/task:0/cpu:0\r\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_2/batchnorm/gamma: (Const)/job:localhost/replica:0/task:0/cpu:0\r\nconv_2/batchnorm/beta: (Const): /job:localhost/replica:0/task:0/cpu:0\r\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_2/batchnorm/beta: (Const)/job:localhost/replica:0/task:0/cpu:0\r\nconv_2/conv2d_params: (Const): /job:localhost/replica:0/task:0/cpu:0\r\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_2/conv2d_params: (Const)/job:localhost/replica:0/task:0/cpu:0\r\nconv_1/batchnorm/moving_variance: (Const): /job:localhost/replica:0/task:0/cpu:0\r\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_1/batchnorm/moving_variance: (Const)/job:localhost/replica:0/task:0/cpu:0\r\nconv_1/batchnorm/moving_mean: (Const): /job:localhost/replica:0/task:0/cpu:0\r\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_1/batchnorm/moving_mean: (Const)/job:localhost/replica:0/task:0/cpu:0\r\nconv_1/batchnorm/gamma: (Const): /job:localhost/replica:0/task:0/cpu:0\r\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_1/batchnorm/gamma: (Const)/job:localhost/replica:0/task:0/cpu:0\r\nconv_1/batchnorm/beta: (Const): /job:localhost/replica:0/task:0/cpu:0\r\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_1/batchnorm/beta: (Const)/job:localhost/replica:0/task:0/cpu:0\r\nconv_1/conv2d_params: (Const): /job:localhost/replica:0/task:0/cpu:0\r\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv_1/conv2d_params: (Const)/job:localhost/replica:0/task:0/cpu:0\r\nconv/batchnorm/moving_variance: (Const): /job:localhost/replica:0/task:0/cpu:0\r\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv/batchnorm/moving_variance: (Const)/job:localhost/replica:0/task:0/cpu:0\r\nconv/batchnorm/moving_mean: (Const): /job:localhost/replica:0/task:0/cpu:0\r\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv/batchnorm/moving_mean: (Const)/job:localhost/replica:0/task:0/cpu:0\r\nconv/batchnorm/gamma: (Const): /job:localhost/replica:0/task:0/cpu:0\r\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv/batchnorm/gamma: (Const)/job:localhost/replica:0/task:0/cpu:0\r\nconv/batchnorm/beta: (Const): /job:localhost/replica:0/task:0/cpu:0\r\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv/batchnorm/beta: (Const)/job:localhost/replica:0/task:0/cpu:0\r\nconv/conv2d_params: (Const): /job:localhost/replica:0/task:0/cpu:0\r\nI tensorflow/core/common_runtime/simple_placer.cc:827] conv/conv2d_params: (Const)/job:localhost/replica:0/task:0/cpu:0\r\nMul/y: (Const): /job:localhost/replica:0/task:0/cpu:0\r\nI tensorflow/core/common_runtime/simple_placer.cc:827] Mul/y: (Const)/job:localhost/replica:0/task:0/cpu:0\r\nSub/y: (Const): /job:localhost/replica:0/task:0/cpu:0\r\nI tensorflow/core/common_runtime/simple_placer.cc:827] Sub/y: (Const)/job:localhost/replica:0/task:0/cpu:0\r\nResizeBilinear/size: (Const): /job:localhost/replica:0/task:0/cpu:0\r\nI tensorflow/core/common_runtime/simple_placer.cc:827] ResizeBilinear/size: (Const)/job:localhost/replica:0/task:0/cpu:0\r\nExpandDims/dim: (Const): /job:localhost/replica:0/task:0/cpu:0\r\nI tensorflow/core/common_runtime/simple_placer.cc:827] ExpandDims/dim: (Const)/job:localhost/replica:0/task:0/cpu:0\r\nDecodeJpeg/contents: (Const): /job:localhost/replica:0/task:0/cpu:0\r\n```"}