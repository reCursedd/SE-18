{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/346978877", "html_url": "https://github.com/tensorflow/tensorflow/issues/13161#issuecomment-346978877", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13161", "id": 346978877, "node_id": "MDEyOklzc3VlQ29tbWVudDM0Njk3ODg3Nw==", "user": {"login": "klydream", "id": 11780286, "node_id": "MDQ6VXNlcjExNzgwMjg2", "avatar_url": "https://avatars2.githubusercontent.com/u/11780286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klydream", "html_url": "https://github.com/klydream", "followers_url": "https://api.github.com/users/klydream/followers", "following_url": "https://api.github.com/users/klydream/following{/other_user}", "gists_url": "https://api.github.com/users/klydream/gists{/gist_id}", "starred_url": "https://api.github.com/users/klydream/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klydream/subscriptions", "organizations_url": "https://api.github.com/users/klydream/orgs", "repos_url": "https://api.github.com/users/klydream/repos", "events_url": "https://api.github.com/users/klydream/events{/privacy}", "received_events_url": "https://api.github.com/users/klydream/received_events", "type": "User", "site_admin": false}, "created_at": "2017-11-26T02:09:13Z", "updated_at": "2017-11-26T03:54:57Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=192142\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/mrry\">@mrry</a> I have struggle with this problem<br>\nfirst, when i deal with</p>\n<pre><code>    reshape = tf.reshape(pool2, [BATCH_SIZE, -1])\n    dim = reshape.get_shape()[1].value\n    weights = _variable_with_weight_decay('weights', shape=[dim, 384],\n                                          stddev=0.04, wd=0.004)\n    biases = _variable_on_cpu('biases', [384], tf.constant_initializer(0.1))\n    print(weights.get_shape(), reshape.get_shape(), biases.get_shape())\n    local3 = tf.nn.relu(\n        tf.matmul(reshape, pruning.apply_mask(weights, scope)) + biases,\n        name=scope.name)\n</code></pre>\n<p>I encounter error \"ValueError: Shape of a new variable (local3/weights) must be fully defined, but instead was (?, 384).\"</p>\n<p>so I add</p>\n<pre><code>    next_example.set_shape([batch_size, height, width, 3])\n    next_label.set_shape([batch_size])\n</code></pre>\n<p>to</p>\n<pre><code>    dataset = tf.data.Dataset.from_tensor_slices((data_dir, labels))\n    dataset = dataset.map(_parse_function_distorted)\n    dataset = dataset.shuffle(buffer_size=10000)\n    dataset = dataset.batch(batch_size)\n    dataset = dataset.repeat(num_epochs)\n    iterator = dataset.make_one_shot_iterator()\n\n    next_example, next_label = iterator.get_next()\n    #next_label.set_shape([batch_size, 1])\n    print(next_label.get_shape())\n    print(next_example.get_shape())\n    height = IMAGE_SIZE\n    width = IMAGE_SIZE\n    next_example.set_shape([batch_size, height, width, 3])\n    next_label.set_shape([batch_size])\n</code></pre>\n<p>and I got error<br>\n\"InvalidArgumentError (see above for traceback): Matrix size-incompatible: In[0]: [128,32], In[1]: [4096,384]<br>\n[[Node: local3/MatMul = MatMul[T=DT_FLOAT, transpose_a=false, transpose_b=false, _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"](local3/Reshape, local3/weights/masked_weight)]]\"</p>\n<p>and the value of dim should be changed, and in reality it doesn't.</p>\n<p>and how to fix it</p>", "body_text": "@mrry I have struggle with this problem\nfirst, when i deal with\n    reshape = tf.reshape(pool2, [BATCH_SIZE, -1])\n    dim = reshape.get_shape()[1].value\n    weights = _variable_with_weight_decay('weights', shape=[dim, 384],\n                                          stddev=0.04, wd=0.004)\n    biases = _variable_on_cpu('biases', [384], tf.constant_initializer(0.1))\n    print(weights.get_shape(), reshape.get_shape(), biases.get_shape())\n    local3 = tf.nn.relu(\n        tf.matmul(reshape, pruning.apply_mask(weights, scope)) + biases,\n        name=scope.name)\n\nI encounter error \"ValueError: Shape of a new variable (local3/weights) must be fully defined, but instead was (?, 384).\"\nso I add\n    next_example.set_shape([batch_size, height, width, 3])\n    next_label.set_shape([batch_size])\n\nto\n    dataset = tf.data.Dataset.from_tensor_slices((data_dir, labels))\n    dataset = dataset.map(_parse_function_distorted)\n    dataset = dataset.shuffle(buffer_size=10000)\n    dataset = dataset.batch(batch_size)\n    dataset = dataset.repeat(num_epochs)\n    iterator = dataset.make_one_shot_iterator()\n\n    next_example, next_label = iterator.get_next()\n    #next_label.set_shape([batch_size, 1])\n    print(next_label.get_shape())\n    print(next_example.get_shape())\n    height = IMAGE_SIZE\n    width = IMAGE_SIZE\n    next_example.set_shape([batch_size, height, width, 3])\n    next_label.set_shape([batch_size])\n\nand I got error\n\"InvalidArgumentError (see above for traceback): Matrix size-incompatible: In[0]: [128,32], In[1]: [4096,384]\n[[Node: local3/MatMul = MatMul[T=DT_FLOAT, transpose_a=false, transpose_b=false, _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"](local3/Reshape, local3/weights/masked_weight)]]\"\nand the value of dim should be changed, and in reality it doesn't.\nand how to fix it", "body": "@mrry I have struggle with this problem\r\nfirst, when i deal with \r\n```\r\n    reshape = tf.reshape(pool2, [BATCH_SIZE, -1])\r\n    dim = reshape.get_shape()[1].value\r\n    weights = _variable_with_weight_decay('weights', shape=[dim, 384],\r\n                                          stddev=0.04, wd=0.004)\r\n    biases = _variable_on_cpu('biases', [384], tf.constant_initializer(0.1))\r\n    print(weights.get_shape(), reshape.get_shape(), biases.get_shape())\r\n    local3 = tf.nn.relu(\r\n        tf.matmul(reshape, pruning.apply_mask(weights, scope)) + biases,\r\n        name=scope.name)\r\n```\r\nI encounter error \"ValueError: Shape of a new variable (local3/weights) must be fully defined, but instead was (?, 384).\"\r\n\r\nso I add \r\n```\r\n    next_example.set_shape([batch_size, height, width, 3])\r\n    next_label.set_shape([batch_size])\r\n```\r\nto \r\n\r\n```\r\n    dataset = tf.data.Dataset.from_tensor_slices((data_dir, labels))\r\n    dataset = dataset.map(_parse_function_distorted)\r\n    dataset = dataset.shuffle(buffer_size=10000)\r\n    dataset = dataset.batch(batch_size)\r\n    dataset = dataset.repeat(num_epochs)\r\n    iterator = dataset.make_one_shot_iterator()\r\n\r\n    next_example, next_label = iterator.get_next()\r\n    #next_label.set_shape([batch_size, 1])\r\n    print(next_label.get_shape())\r\n    print(next_example.get_shape())\r\n    height = IMAGE_SIZE\r\n    width = IMAGE_SIZE\r\n    next_example.set_shape([batch_size, height, width, 3])\r\n    next_label.set_shape([batch_size])\r\n```\r\n\r\nand I got error \r\n\"InvalidArgumentError (see above for traceback): Matrix size-incompatible: In[0]: [128,32], In[1]: [4096,384]\r\n\t [[Node: local3/MatMul = MatMul[T=DT_FLOAT, transpose_a=false, transpose_b=false, _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"](local3/Reshape, local3/weights/masked_weight)]]\"\r\n\r\nand the value of dim should be changed, and in reality it doesn't.\r\n\r\nand how to fix it"}