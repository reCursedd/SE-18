{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/422938097", "html_url": "https://github.com/tensorflow/tensorflow/issues/22190#issuecomment-422938097", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22190", "id": 422938097, "node_id": "MDEyOklzc3VlQ29tbWVudDQyMjkzODA5Nw==", "user": {"login": "yanboliang", "id": 1962026, "node_id": "MDQ6VXNlcjE5NjIwMjY=", "avatar_url": "https://avatars1.githubusercontent.com/u/1962026?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yanboliang", "html_url": "https://github.com/yanboliang", "followers_url": "https://api.github.com/users/yanboliang/followers", "following_url": "https://api.github.com/users/yanboliang/following{/other_user}", "gists_url": "https://api.github.com/users/yanboliang/gists{/gist_id}", "starred_url": "https://api.github.com/users/yanboliang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yanboliang/subscriptions", "organizations_url": "https://api.github.com/users/yanboliang/orgs", "repos_url": "https://api.github.com/users/yanboliang/repos", "events_url": "https://api.github.com/users/yanboliang/events{/privacy}", "received_events_url": "https://api.github.com/users/yanboliang/received_events", "type": "User", "site_admin": false}, "created_at": "2018-09-19T19:59:11Z", "updated_at": "2018-09-19T20:03:55Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=42271354\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/Efaq\">@Efaq</a><br>\nThis is caused by a bug in <code>tf.keras.metrics.sparse_categorical_accuracy</code>.</p>\n<ul>\n<li>Train with Numpy array, the shape of <code>y_true</code> is <code>(num_samples, 1)</code>. Because <code>y_true</code> is feed with a placeholder which is generated according the shape of <code>y_pred</code>, see <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/keras/engine/training.py#L580\">here</a>.</li>\n<li>Train with <code>tf.data</code>, the shape of <code>y_true</code> is <code>(num_samples,)</code>.</li>\n</ul>\n<p><code>tf.keras.metrics.sparse_categorical_accuracy</code> doesn't handle the latter case correctly, which leads the error output. I have sent <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"361902943\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/22392\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/22392/hovercard\" href=\"https://github.com/tensorflow/tensorflow/pull/22392\">#22392</a> to fix this, wish it can help you. Thanks.</p>", "body_text": "@Efaq\nThis is caused by a bug in tf.keras.metrics.sparse_categorical_accuracy.\n\nTrain with Numpy array, the shape of y_true is (num_samples, 1). Because y_true is feed with a placeholder which is generated according the shape of y_pred, see here.\nTrain with tf.data, the shape of y_true is (num_samples,).\n\ntf.keras.metrics.sparse_categorical_accuracy doesn't handle the latter case correctly, which leads the error output. I have sent #22392 to fix this, wish it can help you. Thanks.", "body": "@Efaq \r\nThis is caused by a bug in ```tf.keras.metrics.sparse_categorical_accuracy```.\r\n* Train with Numpy array, the shape of ```y_true``` is ```(num_samples, 1)```. Because ```y_true``` is feed with a placeholder which is generated according the shape of ```y_pred```, see [here](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/keras/engine/training.py#L580).\r\n* Train with ```tf.data```, the shape of ```y_true``` is ```(num_samples,)```.\r\n\r\n```tf.keras.metrics.sparse_categorical_accuracy``` doesn't handle the latter case correctly, which leads the error output. I have sent #22392 to fix this, wish it can help you. Thanks."}