{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/129212872", "pull_request_review_id": 51960550, "id": 129212872, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyOTIxMjg3Mg==", "diff_hunk": "@@ -80,6 +148,44 @@ __global__ void UnsortedSegmentSumCustomKernel(\n \n namespace functor {\n \n+template <typename T, typename Index>\n+void SegmentSumFunctor<T, Index>::operator()(\n+    OpKernelContext* ctx, const GPUDevice& d, const Index output_rows,\n+    const TensorShape& segment_ids_shape,\n+    typename TTypes<Index>::ConstFlat segment_ids, const Index data_size,\n+    const T* data, typename TTypes<T, 2>::Tensor output) {\n+  if (output.size() == 0) {\n+    return;\n+  }\n+  // Set 'output' to zeros.\n+  CudaLaunchConfig config = GetCudaLaunchConfig(output.size(), d);\n+  SetZero<<<config.block_count, config.thread_per_block, 0, d.stream()>>>(\n+      output.size(), output.data());\n+  if (data_size == 0 || segment_ids_shape.num_elements() == 0) {\n+    return;\n+  }\n+\n+  // Launch kernel to compute sorted segment sum.\n+  // Notes:\n+  // *) 'input_total_size' is the total number of elements to process.\n+  // *) 'segment_ids.shape' is a prefix of data's shape.\n+  // *) 'input_outer_dim_size' is the total number of segments to process.\n+  const Index input_total_size = data_size;\n+  const Index input_outer_dim_size = segment_ids.dimension(0);\n+  const Index input_inner_dim_size = input_total_size / input_outer_dim_size;\n+\n+  const Index input_outer_dim_num_strip =\n+      1 + (input_outer_dim_size - 1) / OUTER_DIM_TILE_SIZE;", "path": "tensorflow/core/kernels/segment_reduction_ops_gpu.cu.cc", "position": null, "original_position": 106, "commit_id": "50517c902261289b8163ded0979d5ac28bfe9c6d", "original_commit_id": "aba87c28d57d9fd16aacce476b405ebeed50263e", "user": {"login": "tjingrant", "id": 6410074, "node_id": "MDQ6VXNlcjY0MTAwNzQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/6410074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tjingrant", "html_url": "https://github.com/tjingrant", "followers_url": "https://api.github.com/users/tjingrant/followers", "following_url": "https://api.github.com/users/tjingrant/following{/other_user}", "gists_url": "https://api.github.com/users/tjingrant/gists{/gist_id}", "starred_url": "https://api.github.com/users/tjingrant/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tjingrant/subscriptions", "organizations_url": "https://api.github.com/users/tjingrant/orgs", "repos_url": "https://api.github.com/users/tjingrant/repos", "events_url": "https://api.github.com/users/tjingrant/events{/privacy}", "received_events_url": "https://api.github.com/users/tjingrant/received_events", "type": "User", "site_admin": false}, "body": "Will do.", "created_at": "2017-07-25T05:06:10Z", "updated_at": "2017-08-29T00:31:24Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/11630#discussion_r129212872", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/11630", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/129212872"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/11630#discussion_r129212872"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/11630"}}, "body_html": "<p>Will do.</p>", "body_text": "Will do.", "in_reply_to_id": 129196199}