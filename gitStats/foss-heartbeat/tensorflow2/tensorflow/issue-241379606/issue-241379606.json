{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11364", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11364/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11364/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11364/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/11364", "id": 241379606, "node_id": "MDU6SXNzdWUyNDEzNzk2MDY=", "number": 11364, "title": "Error on tf.contrib.training.stratified_sample", "user": {"login": "jrbtaylor", "id": 15191858, "node_id": "MDQ6VXNlcjE1MTkxODU4", "avatar_url": "https://avatars3.githubusercontent.com/u/15191858?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jrbtaylor", "html_url": "https://github.com/jrbtaylor", "followers_url": "https://api.github.com/users/jrbtaylor/followers", "following_url": "https://api.github.com/users/jrbtaylor/following{/other_user}", "gists_url": "https://api.github.com/users/jrbtaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/jrbtaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jrbtaylor/subscriptions", "organizations_url": "https://api.github.com/users/jrbtaylor/orgs", "repos_url": "https://api.github.com/users/jrbtaylor/repos", "events_url": "https://api.github.com/users/jrbtaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/jrbtaylor/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 284443156, "node_id": "MDU6TGFiZWwyODQ0NDMxNTY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:docs", "name": "type:docs", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "joel-shor", "id": 6020988, "node_id": "MDQ6VXNlcjYwMjA5ODg=", "avatar_url": "https://avatars1.githubusercontent.com/u/6020988?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joel-shor", "html_url": "https://github.com/joel-shor", "followers_url": "https://api.github.com/users/joel-shor/followers", "following_url": "https://api.github.com/users/joel-shor/following{/other_user}", "gists_url": "https://api.github.com/users/joel-shor/gists{/gist_id}", "starred_url": "https://api.github.com/users/joel-shor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joel-shor/subscriptions", "organizations_url": "https://api.github.com/users/joel-shor/orgs", "repos_url": "https://api.github.com/users/joel-shor/repos", "events_url": "https://api.github.com/users/joel-shor/events{/privacy}", "received_events_url": "https://api.github.com/users/joel-shor/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "joel-shor", "id": 6020988, "node_id": "MDQ6VXNlcjYwMjA5ODg=", "avatar_url": "https://avatars1.githubusercontent.com/u/6020988?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joel-shor", "html_url": "https://github.com/joel-shor", "followers_url": "https://api.github.com/users/joel-shor/followers", "following_url": "https://api.github.com/users/joel-shor/following{/other_user}", "gists_url": "https://api.github.com/users/joel-shor/gists{/gist_id}", "starred_url": "https://api.github.com/users/joel-shor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joel-shor/subscriptions", "organizations_url": "https://api.github.com/users/joel-shor/orgs", "repos_url": "https://api.github.com/users/joel-shor/repos", "events_url": "https://api.github.com/users/joel-shor/events{/privacy}", "received_events_url": "https://api.github.com/users/joel-shor/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2017-07-07T21:03:01Z", "updated_at": "2017-07-31T20:13:31Z", "closed_at": "2017-07-31T20:13:18Z", "author_association": "NONE", "body_html": "<p>I made a small example to illustrate, which makes some synthetic data with unbalanced classes and tries to take balanced samples from it:</p>\n<pre><code>import tensorflow as tf\nfrom tensorflow.python.framework import ops\nfrom tensorflow.python.framework import dtypes\n\nbatch_size = 10\ndata = ['a']*9990+['b']*10\nlabels = [1]*9990+[0]*10\ndata_tensor = ops.convert_to_tensor(data, dtype=dtypes.string)\nlabel_tensor = ops.convert_to_tensor(labels)\ntarget_probs = [0.5,0.5]\ndata_batch, label_batch = tf.contrib.training.stratified_sample(\n    data_tensor, label_tensor, target_probs, batch_size,\n    queue_capacity=2*batch_size)\n\nwith tf.Session() as sess:\n    d,l = sess.run(data_batch,label_batch)\nprint('percentage \"a\" = %.3f' % (np.sum(l)/len(l)))\n</code></pre>\n<p>This gives the error:</p>\n<pre><code>Traceback (most recent call last):\n  File \"/home/jason/code/scrap.py\", line 59, in &lt;module&gt;\n    test_stratified_sample()\n  File \"/home/jason/code/scrap.py\", line 50, in test_stratified_sample\n    label_tensor, target_probs, batch_size, queue_capacity=2*batch_size)\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/contrib/training/python/training/sampling_ops.py\", line 191, in stratified_sample\n    with ops.name_scope(name, 'stratified_sample', tensors + [labels]):\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/ops/math_ops.py\", line 829, in binary_op_wrapper\n    y = ops.convert_to_tensor(y, dtype=x.dtype.base_dtype, name=\"y\")\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/ops.py\", line 676, in convert_to_tensor\n    as_ref=False)\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/ops.py\", line 741, in internal_convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/constant_op.py\", line 113, in _constant_tensor_conversion_function\n    return constant(v, dtype=dtype, name=name)\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/constant_op.py\", line 102, in constant\n    tensor_util.make_tensor_proto(value, dtype=dtype, shape=shape, verify_shape=verify_shape))\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/tensor_util.py\", line 374, in make_tensor_proto\n    _AssertCompatible(values, dtype)\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/tensor_util.py\", line 302, in _AssertCompatible\n    (dtype.name, repr(mismatch), type(mismatch).__name__))\nTypeError: Expected string, got list containing Tensors of type '_Message' instead.\n</code></pre>\n<p>All the searching I did on this TypeError message returned legitimate bugs, not user errors, so I'm putting this here. For completeness:<br>\n<code>python -c \"import tensorflow as tf; print(tf.GIT_VERSION, tf.VERSION)\"</code> gives ('v1.2.0-0-g12f033d', '1.2.0')</p>", "body_text": "I made a small example to illustrate, which makes some synthetic data with unbalanced classes and tries to take balanced samples from it:\nimport tensorflow as tf\nfrom tensorflow.python.framework import ops\nfrom tensorflow.python.framework import dtypes\n\nbatch_size = 10\ndata = ['a']*9990+['b']*10\nlabels = [1]*9990+[0]*10\ndata_tensor = ops.convert_to_tensor(data, dtype=dtypes.string)\nlabel_tensor = ops.convert_to_tensor(labels)\ntarget_probs = [0.5,0.5]\ndata_batch, label_batch = tf.contrib.training.stratified_sample(\n    data_tensor, label_tensor, target_probs, batch_size,\n    queue_capacity=2*batch_size)\n\nwith tf.Session() as sess:\n    d,l = sess.run(data_batch,label_batch)\nprint('percentage \"a\" = %.3f' % (np.sum(l)/len(l)))\n\nThis gives the error:\nTraceback (most recent call last):\n  File \"/home/jason/code/scrap.py\", line 59, in <module>\n    test_stratified_sample()\n  File \"/home/jason/code/scrap.py\", line 50, in test_stratified_sample\n    label_tensor, target_probs, batch_size, queue_capacity=2*batch_size)\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/contrib/training/python/training/sampling_ops.py\", line 191, in stratified_sample\n    with ops.name_scope(name, 'stratified_sample', tensors + [labels]):\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/ops/math_ops.py\", line 829, in binary_op_wrapper\n    y = ops.convert_to_tensor(y, dtype=x.dtype.base_dtype, name=\"y\")\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/ops.py\", line 676, in convert_to_tensor\n    as_ref=False)\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/ops.py\", line 741, in internal_convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/constant_op.py\", line 113, in _constant_tensor_conversion_function\n    return constant(v, dtype=dtype, name=name)\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/constant_op.py\", line 102, in constant\n    tensor_util.make_tensor_proto(value, dtype=dtype, shape=shape, verify_shape=verify_shape))\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/tensor_util.py\", line 374, in make_tensor_proto\n    _AssertCompatible(values, dtype)\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/tensor_util.py\", line 302, in _AssertCompatible\n    (dtype.name, repr(mismatch), type(mismatch).__name__))\nTypeError: Expected string, got list containing Tensors of type '_Message' instead.\n\nAll the searching I did on this TypeError message returned legitimate bugs, not user errors, so I'm putting this here. For completeness:\npython -c \"import tensorflow as tf; print(tf.GIT_VERSION, tf.VERSION)\" gives ('v1.2.0-0-g12f033d', '1.2.0')", "body": "I made a small example to illustrate, which makes some synthetic data with unbalanced classes and tries to take balanced samples from it:\r\n```\r\nimport tensorflow as tf\r\nfrom tensorflow.python.framework import ops\r\nfrom tensorflow.python.framework import dtypes\r\n\r\nbatch_size = 10\r\ndata = ['a']*9990+['b']*10\r\nlabels = [1]*9990+[0]*10\r\ndata_tensor = ops.convert_to_tensor(data, dtype=dtypes.string)\r\nlabel_tensor = ops.convert_to_tensor(labels)\r\ntarget_probs = [0.5,0.5]\r\ndata_batch, label_batch = tf.contrib.training.stratified_sample(\r\n    data_tensor, label_tensor, target_probs, batch_size,\r\n    queue_capacity=2*batch_size)\r\n\r\nwith tf.Session() as sess:\r\n    d,l = sess.run(data_batch,label_batch)\r\nprint('percentage \"a\" = %.3f' % (np.sum(l)/len(l)))\r\n```\r\n\r\nThis gives the error:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/jason/code/scrap.py\", line 59, in <module>\r\n    test_stratified_sample()\r\n  File \"/home/jason/code/scrap.py\", line 50, in test_stratified_sample\r\n    label_tensor, target_probs, batch_size, queue_capacity=2*batch_size)\r\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/contrib/training/python/training/sampling_ops.py\", line 191, in stratified_sample\r\n    with ops.name_scope(name, 'stratified_sample', tensors + [labels]):\r\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/ops/math_ops.py\", line 829, in binary_op_wrapper\r\n    y = ops.convert_to_tensor(y, dtype=x.dtype.base_dtype, name=\"y\")\r\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/ops.py\", line 676, in convert_to_tensor\r\n    as_ref=False)\r\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/ops.py\", line 741, in internal_convert_to_tensor\r\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\r\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/constant_op.py\", line 113, in _constant_tensor_conversion_function\r\n    return constant(v, dtype=dtype, name=name)\r\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/constant_op.py\", line 102, in constant\r\n    tensor_util.make_tensor_proto(value, dtype=dtype, shape=shape, verify_shape=verify_shape))\r\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/tensor_util.py\", line 374, in make_tensor_proto\r\n    _AssertCompatible(values, dtype)\r\n  File \"/usr/local/lib/python3.4/dist-packages/tensorflow/python/framework/tensor_util.py\", line 302, in _AssertCompatible\r\n    (dtype.name, repr(mismatch), type(mismatch).__name__))\r\nTypeError: Expected string, got list containing Tensors of type '_Message' instead.\r\n```\r\n\r\nAll the searching I did on this TypeError message returned legitimate bugs, not user errors, so I'm putting this here. For completeness:\r\n`python -c \"import tensorflow as tf; print(tf.GIT_VERSION, tf.VERSION)\"` gives ('v1.2.0-0-g12f033d', '1.2.0')"}