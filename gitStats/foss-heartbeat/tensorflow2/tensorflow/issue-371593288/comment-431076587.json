{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/431076587", "html_url": "https://github.com/tensorflow/tensorflow/issues/23077#issuecomment-431076587", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23077", "id": 431076587, "node_id": "MDEyOklzc3VlQ29tbWVudDQzMTA3NjU4Nw==", "user": {"login": "kami93", "id": 20102, "node_id": "MDQ6VXNlcjIwMTAy", "avatar_url": "https://avatars0.githubusercontent.com/u/20102?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kami93", "html_url": "https://github.com/kami93", "followers_url": "https://api.github.com/users/kami93/followers", "following_url": "https://api.github.com/users/kami93/following{/other_user}", "gists_url": "https://api.github.com/users/kami93/gists{/gist_id}", "starred_url": "https://api.github.com/users/kami93/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kami93/subscriptions", "organizations_url": "https://api.github.com/users/kami93/orgs", "repos_url": "https://api.github.com/users/kami93/repos", "events_url": "https://api.github.com/users/kami93/events{/privacy}", "received_events_url": "https://api.github.com/users/kami93/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-18T16:32:10Z", "updated_at": "2018-10-18T19:36:54Z", "author_association": "NONE", "body_html": "<p>I tried tf.contrib.distribute.MirroredStrategy too.</p>\n<p>Firstly, the model raised the following ValueError with tf.contrib.distribute.MirroredStrategy being declared with the default arguments.</p>\n<pre><code>ValueError: Device /replica:0/task:0/device:CPU:0 not found in dict_keys(['/replica:0/task:0/device:GPU:0', '/replica:0/task:0/device:GPU:1', '/replica:0/task:0/device:GPU:2', '/replica:0/task:0/device:GPU:3']) (current device )\n</code></pre>\n<p>From <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"364205611\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/22550\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/22550/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/22550\">#22550</a>, The ValueError was resolved by specifying device list.</p>\n<pre><code>tf.contrib.distribute.MirroredStrategy(['/device:CPU:0', '/device:CPU:1', '/device:GPU:0', '/device:GPU:1', '/device:GPU:2', '/device:GPU:3'])\n</code></pre>\n<p>##################################################################################</p>\n<p>PredRNN.py gist<br>\n<a href=\"https://gist.github.com/kami93/4d4dc9a220e342c9a7710de26dfc34c5\">https://gist.github.com/kami93/4d4dc9a220e342c9a7710de26dfc34c5</a></p>\n<p>Setting model_creation_device == '/cpu:1'  raises the following errors.</p>\n<pre><code>InvalidArgumentError (see above for traceback): Could not colocate node with its resource and reference inputs; devices /replica:0/task:0/device:CPU:1 and /job:localhost/replica:0/task:0/device:GPU:0 are not compatible.\n\t [[{{node training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam}} = ResourceApplyAdam[T=DT_FLOAT, use_locking=false, use_nesterov=false, _device=\"/replica:0/task:0/device:CPU:1\"](stlst_m2d_1/kernel_x/replica_1, stlst_m2d_1/kernel_x/Adam/replica_1, stlst_m2d_1/kernel_x/Adam_1/replica_1, training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam/ReadVariableOp, training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam/ReadVariableOp_1, training/TFOptimizer/Adam/learning_rate, training/TFOptimizer/Adam/beta1, training/TFOptimizer/Adam/beta2, training/TFOptimizer/Adam/epsilon, training/TFOptimizer/Identity_1)]]\n\n</code></pre>\n<p>Traceback: <a href=\"https://pastebin.com/RzRdUMk1\" rel=\"nofollow\">https://pastebin.com/RzRdUMk1</a></p>\n<p>##################################################################################</p>\n<p>Setting the model_creation_device == '/gpu:1'  raises the following errors.</p>\n<pre><code>InvalidArgumentError (see above for traceback): Could not colocate node with its resource and reference inputs; devices /replica:0/task:0/device:CPU:1 and /job:localhost/replica:0/task:0/device:GPU:0 are not compatible.\n\t [[{{node training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam}} = ResourceApplyAdam[T=DT_FLOAT, use_locking=false, use_nesterov=false, _device=\"/replica:0/task:0/device:CPU:1\"](stlst_m2d_1/kernel_x/replica_1, stlst_m2d_1/kernel_x/Adam/replica_1, stlst_m2d_1/kernel_x/Adam_1/replica_1, training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam/ReadVariableOp, training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam/ReadVariableOp_1, training/TFOptimizer/Adam/learning_rate, training/TFOptimizer/Adam/beta1, training/TFOptimizer/Adam/beta2, training/TFOptimizer/Adam/epsilon, training/TFOptimizer/Identity_1)]]\n</code></pre>\n<p>Traceback: <a href=\"https://pastebin.com/bAkzrt31\" rel=\"nofollow\">https://pastebin.com/bAkzrt31</a></p>\n<p>##################################################################################<br>\nNot specifying the device context with model_creation_device raises the following errors.<br>\ngist: <a href=\"https://gist.github.com/kami93/4283471067c2e36fc48cf0f5d8604e8a\">https://gist.github.com/kami93/4283471067c2e36fc48cf0f5d8604e8a</a></p>\n<pre><code>InvalidArgumentError (see above for traceback): Could not colocate node with its resource and reference inputs; devices /replica:0/task:0/device:CPU:1 and /job:localhost/replica:0/task:0/device:GPU:0 are not compatible.\n\t [[{{node training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam}} = ResourceApplyAdam[T=DT_FLOAT, use_locking=false, use_nesterov=false, _device=\"/replica:0/task:0/device:CPU:1\"](stlst_m2d_1/kernel_x/replica_1, stlst_m2d_1/kernel_x/Adam/replica_1, stlst_m2d_1/kernel_x/Adam_1/replica_1, training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam/ReadVariableOp, training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam/ReadVariableOp_1, training/TFOptimizer/Adam/learning_rate, training/TFOptimizer/Adam/beta1, training/TFOptimizer/Adam/beta2, training/TFOptimizer/Adam/epsilon, training/TFOptimizer/Identity_1)]]\n</code></pre>\n<p>Traceback: <a href=\"https://pastebin.com/bF8DByeG\" rel=\"nofollow\">https://pastebin.com/bF8DByeG</a></p>", "body_text": "I tried tf.contrib.distribute.MirroredStrategy too.\nFirstly, the model raised the following ValueError with tf.contrib.distribute.MirroredStrategy being declared with the default arguments.\nValueError: Device /replica:0/task:0/device:CPU:0 not found in dict_keys(['/replica:0/task:0/device:GPU:0', '/replica:0/task:0/device:GPU:1', '/replica:0/task:0/device:GPU:2', '/replica:0/task:0/device:GPU:3']) (current device )\n\nFrom #22550, The ValueError was resolved by specifying device list.\ntf.contrib.distribute.MirroredStrategy(['/device:CPU:0', '/device:CPU:1', '/device:GPU:0', '/device:GPU:1', '/device:GPU:2', '/device:GPU:3'])\n\n##################################################################################\nPredRNN.py gist\nhttps://gist.github.com/kami93/4d4dc9a220e342c9a7710de26dfc34c5\nSetting model_creation_device == '/cpu:1'  raises the following errors.\nInvalidArgumentError (see above for traceback): Could not colocate node with its resource and reference inputs; devices /replica:0/task:0/device:CPU:1 and /job:localhost/replica:0/task:0/device:GPU:0 are not compatible.\n\t [[{{node training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam}} = ResourceApplyAdam[T=DT_FLOAT, use_locking=false, use_nesterov=false, _device=\"/replica:0/task:0/device:CPU:1\"](stlst_m2d_1/kernel_x/replica_1, stlst_m2d_1/kernel_x/Adam/replica_1, stlst_m2d_1/kernel_x/Adam_1/replica_1, training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam/ReadVariableOp, training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam/ReadVariableOp_1, training/TFOptimizer/Adam/learning_rate, training/TFOptimizer/Adam/beta1, training/TFOptimizer/Adam/beta2, training/TFOptimizer/Adam/epsilon, training/TFOptimizer/Identity_1)]]\n\n\nTraceback: https://pastebin.com/RzRdUMk1\n##################################################################################\nSetting the model_creation_device == '/gpu:1'  raises the following errors.\nInvalidArgumentError (see above for traceback): Could not colocate node with its resource and reference inputs; devices /replica:0/task:0/device:CPU:1 and /job:localhost/replica:0/task:0/device:GPU:0 are not compatible.\n\t [[{{node training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam}} = ResourceApplyAdam[T=DT_FLOAT, use_locking=false, use_nesterov=false, _device=\"/replica:0/task:0/device:CPU:1\"](stlst_m2d_1/kernel_x/replica_1, stlst_m2d_1/kernel_x/Adam/replica_1, stlst_m2d_1/kernel_x/Adam_1/replica_1, training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam/ReadVariableOp, training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam/ReadVariableOp_1, training/TFOptimizer/Adam/learning_rate, training/TFOptimizer/Adam/beta1, training/TFOptimizer/Adam/beta2, training/TFOptimizer/Adam/epsilon, training/TFOptimizer/Identity_1)]]\n\nTraceback: https://pastebin.com/bAkzrt31\n##################################################################################\nNot specifying the device context with model_creation_device raises the following errors.\ngist: https://gist.github.com/kami93/4283471067c2e36fc48cf0f5d8604e8a\nInvalidArgumentError (see above for traceback): Could not colocate node with its resource and reference inputs; devices /replica:0/task:0/device:CPU:1 and /job:localhost/replica:0/task:0/device:GPU:0 are not compatible.\n\t [[{{node training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam}} = ResourceApplyAdam[T=DT_FLOAT, use_locking=false, use_nesterov=false, _device=\"/replica:0/task:0/device:CPU:1\"](stlst_m2d_1/kernel_x/replica_1, stlst_m2d_1/kernel_x/Adam/replica_1, stlst_m2d_1/kernel_x/Adam_1/replica_1, training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam/ReadVariableOp, training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam/ReadVariableOp_1, training/TFOptimizer/Adam/learning_rate, training/TFOptimizer/Adam/beta1, training/TFOptimizer/Adam/beta2, training/TFOptimizer/Adam/epsilon, training/TFOptimizer/Identity_1)]]\n\nTraceback: https://pastebin.com/bF8DByeG", "body": "I tried tf.contrib.distribute.MirroredStrategy too.\r\n\r\nFirstly, the model raised the following ValueError with tf.contrib.distribute.MirroredStrategy being declared with the default arguments.\r\n```\r\nValueError: Device /replica:0/task:0/device:CPU:0 not found in dict_keys(['/replica:0/task:0/device:GPU:0', '/replica:0/task:0/device:GPU:1', '/replica:0/task:0/device:GPU:2', '/replica:0/task:0/device:GPU:3']) (current device )\r\n```\r\n\r\nFrom #22550, The ValueError was resolved by specifying device list.\r\n```\r\ntf.contrib.distribute.MirroredStrategy(['/device:CPU:0', '/device:CPU:1', '/device:GPU:0', '/device:GPU:1', '/device:GPU:2', '/device:GPU:3'])\r\n```\r\n\r\n##################################################################################\r\n\r\nPredRNN.py gist\r\nhttps://gist.github.com/kami93/4d4dc9a220e342c9a7710de26dfc34c5\r\n\r\nSetting model_creation_device == '/cpu:1'  raises the following errors.\r\n```\r\nInvalidArgumentError (see above for traceback): Could not colocate node with its resource and reference inputs; devices /replica:0/task:0/device:CPU:1 and /job:localhost/replica:0/task:0/device:GPU:0 are not compatible.\r\n\t [[{{node training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam}} = ResourceApplyAdam[T=DT_FLOAT, use_locking=false, use_nesterov=false, _device=\"/replica:0/task:0/device:CPU:1\"](stlst_m2d_1/kernel_x/replica_1, stlst_m2d_1/kernel_x/Adam/replica_1, stlst_m2d_1/kernel_x/Adam_1/replica_1, training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam/ReadVariableOp, training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam/ReadVariableOp_1, training/TFOptimizer/Adam/learning_rate, training/TFOptimizer/Adam/beta1, training/TFOptimizer/Adam/beta2, training/TFOptimizer/Adam/epsilon, training/TFOptimizer/Identity_1)]]\r\n\r\n```\r\nTraceback: https://pastebin.com/RzRdUMk1\r\n\r\n##################################################################################\r\n\r\nSetting the model_creation_device == '/gpu:1'  raises the following errors.\r\n```\r\nInvalidArgumentError (see above for traceback): Could not colocate node with its resource and reference inputs; devices /replica:0/task:0/device:CPU:1 and /job:localhost/replica:0/task:0/device:GPU:0 are not compatible.\r\n\t [[{{node training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam}} = ResourceApplyAdam[T=DT_FLOAT, use_locking=false, use_nesterov=false, _device=\"/replica:0/task:0/device:CPU:1\"](stlst_m2d_1/kernel_x/replica_1, stlst_m2d_1/kernel_x/Adam/replica_1, stlst_m2d_1/kernel_x/Adam_1/replica_1, training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam/ReadVariableOp, training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam/ReadVariableOp_1, training/TFOptimizer/Adam/learning_rate, training/TFOptimizer/Adam/beta1, training/TFOptimizer/Adam/beta2, training/TFOptimizer/Adam/epsilon, training/TFOptimizer/Identity_1)]]\r\n```\r\nTraceback: https://pastebin.com/bAkzrt31\r\n\r\n##################################################################################\r\nNot specifying the device context with model_creation_device raises the following errors.\r\ngist: https://gist.github.com/kami93/4283471067c2e36fc48cf0f5d8604e8a\r\n\r\n```\r\nInvalidArgumentError (see above for traceback): Could not colocate node with its resource and reference inputs; devices /replica:0/task:0/device:CPU:1 and /job:localhost/replica:0/task:0/device:GPU:0 are not compatible.\r\n\t [[{{node training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam}} = ResourceApplyAdam[T=DT_FLOAT, use_locking=false, use_nesterov=false, _device=\"/replica:0/task:0/device:CPU:1\"](stlst_m2d_1/kernel_x/replica_1, stlst_m2d_1/kernel_x/Adam/replica_1, stlst_m2d_1/kernel_x/Adam_1/replica_1, training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam/ReadVariableOp, training/TFOptimizer/Adam/update_1/update_stlst_m2d_1/kernel_x/replica_1/ResourceApplyAdam/ReadVariableOp_1, training/TFOptimizer/Adam/learning_rate, training/TFOptimizer/Adam/beta1, training/TFOptimizer/Adam/beta2, training/TFOptimizer/Adam/epsilon, training/TFOptimizer/Identity_1)]]\r\n```\r\nTraceback: https://pastebin.com/bF8DByeG"}