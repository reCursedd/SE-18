{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/167472359", "pull_request_review_id": 95694259, "id": 167472359, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2NzQ3MjM1OQ==", "diff_hunk": "@@ -572,9 +572,8 @@ def call(self, inputs, initial_state=None, dtype=None, sequence_length=None):\n \n   def _gather_states(self, data, indices, batch_size):\n     \"\"\"Produce `out`, s.t. out(i, j) = data(indices(i), i, j).\"\"\"\n-    mod_indices = indices * batch_size + math_ops.range(batch_size)\n-    return array_ops.gather(\n-        array_ops.reshape(data, [-1, self.num_units]), mod_indices)\n+    return array_ops.gather_nd(", "path": "tensorflow/contrib/rnn/python/ops/lstm_ops.py", "position": 7, "original_position": 7, "commit_id": "111e3b6c2ce3083bcc932fd04505805de552df6c", "original_commit_id": "f1fd0d503f91569b84a89196d524280af8e8364b", "user": {"login": "halleywj", "id": 11271621, "node_id": "MDQ6VXNlcjExMjcxNjIx", "avatar_url": "https://avatars0.githubusercontent.com/u/11271621?v=4", "gravatar_id": "", "url": "https://api.github.com/users/halleywj", "html_url": "https://github.com/halleywj", "followers_url": "https://api.github.com/users/halleywj/followers", "following_url": "https://api.github.com/users/halleywj/following{/other_user}", "gists_url": "https://api.github.com/users/halleywj/gists{/gist_id}", "starred_url": "https://api.github.com/users/halleywj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/halleywj/subscriptions", "organizations_url": "https://api.github.com/users/halleywj/orgs", "repos_url": "https://api.github.com/users/halleywj/repos", "events_url": "https://api.github.com/users/halleywj/events{/privacy}", "received_events_url": "https://api.github.com/users/halleywj/received_events", "type": "User", "site_admin": false}, "body": "Because _gather_states find out(i, j) = data(indices(i), i, j) when indices is a [batch_size] tensor . The origin method  reshape the 'data' to a 2-dim tensor and calculate the indices in the reshaped array . Use gather_nd can locate the 'indices' in the 3-dim tensor 'data' so no need for reshape . And in my experiment , gather may lead to a warning when data is a sparse tensor but use gather_nd with no warning . And use gather_nd can speed up a little .", "created_at": "2018-02-12T05:53:37Z", "updated_at": "2018-02-15T05:56:59Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/16484#discussion_r167472359", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/16484", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/167472359"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/16484#discussion_r167472359"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/16484"}}, "body_html": "<p>Because _gather_states find out(i, j) = data(indices(i), i, j) when indices is a [batch_size] tensor . The origin method  reshape the 'data' to a 2-dim tensor and calculate the indices in the reshaped array . Use gather_nd can locate the 'indices' in the 3-dim tensor 'data' so no need for reshape . And in my experiment , gather may lead to a warning when data is a sparse tensor but use gather_nd with no warning . And use gather_nd can speed up a little .</p>", "body_text": "Because _gather_states find out(i, j) = data(indices(i), i, j) when indices is a [batch_size] tensor . The origin method  reshape the 'data' to a 2-dim tensor and calculate the indices in the reshaped array . Use gather_nd can locate the 'indices' in the 3-dim tensor 'data' so no need for reshape . And in my experiment , gather may lead to a warning when data is a sparse tensor but use gather_nd with no warning . And use gather_nd can speed up a little .", "in_reply_to_id": 167466482}