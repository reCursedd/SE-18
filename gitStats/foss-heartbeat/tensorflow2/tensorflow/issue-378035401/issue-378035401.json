{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23566", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23566/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23566/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23566/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23566", "id": 378035401, "node_id": "MDU6SXNzdWUzNzgwMzU0MDE=", "number": 23566, "title": "tf.nn.embedding_lookup_sparse Converting sparse IndexedSlices Warning", "user": {"login": "davidenunes", "id": 5713750, "node_id": "MDQ6VXNlcjU3MTM3NTA=", "avatar_url": "https://avatars1.githubusercontent.com/u/5713750?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidenunes", "html_url": "https://github.com/davidenunes", "followers_url": "https://api.github.com/users/davidenunes/followers", "following_url": "https://api.github.com/users/davidenunes/following{/other_user}", "gists_url": "https://api.github.com/users/davidenunes/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidenunes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidenunes/subscriptions", "organizations_url": "https://api.github.com/users/davidenunes/orgs", "repos_url": "https://api.github.com/users/davidenunes/repos", "events_url": "https://api.github.com/users/davidenunes/events{/privacy}", "received_events_url": "https://api.github.com/users/davidenunes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1097547147, "node_id": "MDU6TGFiZWwxMDk3NTQ3MTQ3", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:ops", "name": "comp:ops", "color": "0052cc", "default": false}], "state": "open", "locked": false, "assignee": {"login": "drpngx", "id": 20959853, "node_id": "MDQ6VXNlcjIwOTU5ODUz", "avatar_url": "https://avatars1.githubusercontent.com/u/20959853?v=4", "gravatar_id": "", "url": "https://api.github.com/users/drpngx", "html_url": "https://github.com/drpngx", "followers_url": "https://api.github.com/users/drpngx/followers", "following_url": "https://api.github.com/users/drpngx/following{/other_user}", "gists_url": "https://api.github.com/users/drpngx/gists{/gist_id}", "starred_url": "https://api.github.com/users/drpngx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/drpngx/subscriptions", "organizations_url": "https://api.github.com/users/drpngx/orgs", "repos_url": "https://api.github.com/users/drpngx/repos", "events_url": "https://api.github.com/users/drpngx/events{/privacy}", "received_events_url": "https://api.github.com/users/drpngx/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "drpngx", "id": 20959853, "node_id": "MDQ6VXNlcjIwOTU5ODUz", "avatar_url": "https://avatars1.githubusercontent.com/u/20959853?v=4", "gravatar_id": "", "url": "https://api.github.com/users/drpngx", "html_url": "https://github.com/drpngx", "followers_url": "https://api.github.com/users/drpngx/followers", "following_url": "https://api.github.com/users/drpngx/following{/other_user}", "gists_url": "https://api.github.com/users/drpngx/gists{/gist_id}", "starred_url": "https://api.github.com/users/drpngx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/drpngx/subscriptions", "organizations_url": "https://api.github.com/users/drpngx/orgs", "repos_url": "https://api.github.com/users/drpngx/repos", "events_url": "https://api.github.com/users/drpngx/events{/privacy}", "received_events_url": "https://api.github.com/users/drpngx/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2018-11-06T21:13:14Z", "updated_at": "2018-11-22T12:44:08Z", "closed_at": null, "author_association": "NONE", "body_html": "<p><strong>System information</strong></p>\n<ul>\n<li>Have I written custom code (as opposed to using a stock example script provided in TensorFlow): no</li>\n<li>TensorFlow installed from (source or binary): source</li>\n<li>TensorFlow version (use command below): r1.11</li>\n<li>Python version: 3.6</li>\n<li>GCC/Compiler version (if compiling from source):</li>\n<li>CUDA/cuDNN version: 10/7.3</li>\n</ul>\n<p><strong>Describe the current behavior</strong><br>\nUsing embedding_lookup_sparse raises the following warning:</p>\n<blockquote>\n<p>UserWarning: Converting sparse IndexedSlices to a dense Tensor of unknown shape. This may consume a large amount of memory. \"Converting sparse IndexedSlices to a dense Tensor of unknown shape.\"</p>\n</blockquote>\n<p>Looking at embedding_lookup_sparse implementation, the issue comes from the gather after embedding lookup.</p>\n<pre><code>...\nids = sp_ids.values\nids, idx = array_ops.unique(ids)\n\nembeddings = embedding_lookup(params,ids,...)\n...\nembeddings = array_ops.gather(embeddings, idx)\n</code></pre>\n<p><strong>Describe the expected behavior</strong><br>\nI didn't expect the sparse gradients to be passed to an op that can't back-propagate them inside<br>\nembedding lookup sparse.</p>\n<p>Is there a reason this op does not call embedding_lookup on sp_ids.values directly? As opposed to<br>\nlooking up the unique ids and calling gather on those rows ?</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): no\nTensorFlow installed from (source or binary): source\nTensorFlow version (use command below): r1.11\nPython version: 3.6\nGCC/Compiler version (if compiling from source):\nCUDA/cuDNN version: 10/7.3\n\nDescribe the current behavior\nUsing embedding_lookup_sparse raises the following warning:\n\nUserWarning: Converting sparse IndexedSlices to a dense Tensor of unknown shape. This may consume a large amount of memory. \"Converting sparse IndexedSlices to a dense Tensor of unknown shape.\"\n\nLooking at embedding_lookup_sparse implementation, the issue comes from the gather after embedding lookup.\n...\nids = sp_ids.values\nids, idx = array_ops.unique(ids)\n\nembeddings = embedding_lookup(params,ids,...)\n...\nembeddings = array_ops.gather(embeddings, idx)\n\nDescribe the expected behavior\nI didn't expect the sparse gradients to be passed to an op that can't back-propagate them inside\nembedding lookup sparse.\nIs there a reason this op does not call embedding_lookup on sp_ids.values directly? As opposed to\nlooking up the unique ids and calling gather on those rows ?", "body": "**System information**\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow): no\r\n- TensorFlow installed from (source or binary): source\r\n- TensorFlow version (use command below): r1.11\r\n- Python version: 3.6\r\n- GCC/Compiler version (if compiling from source):\r\n- CUDA/cuDNN version: 10/7.3\r\n\r\n**Describe the current behavior**\r\nUsing embedding_lookup_sparse raises the following warning:\r\n\r\n> UserWarning: Converting sparse IndexedSlices to a dense Tensor of unknown shape. This may consume a large amount of memory. \"Converting sparse IndexedSlices to a dense Tensor of unknown shape.\"\r\n\r\nLooking at embedding_lookup_sparse implementation, the issue comes from the gather after embedding lookup.\r\n\r\n```\r\n...\r\nids = sp_ids.values\r\nids, idx = array_ops.unique(ids)\r\n\r\nembeddings = embedding_lookup(params,ids,...)\r\n...\r\nembeddings = array_ops.gather(embeddings, idx)\r\n```\r\n\r\n**Describe the expected behavior**\r\nI didn't expect the sparse gradients to be passed to an op that can't back-propagate them inside \r\nembedding lookup sparse.\r\n\r\nIs there a reason this op does not call embedding_lookup on sp_ids.values directly? As opposed to\r\nlooking up the unique ids and calling gather on those rows ?\r\n"}