{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6838", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6838/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6838/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6838/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/6838", "id": 200711890, "node_id": "MDU6SXNzdWUyMDA3MTE4OTA=", "number": 6838, "title": "Saver fails to restore on GCloud", "user": {"login": "optimality", "id": 1971981, "node_id": "MDQ6VXNlcjE5NzE5ODE=", "avatar_url": "https://avatars0.githubusercontent.com/u/1971981?v=4", "gravatar_id": "", "url": "https://api.github.com/users/optimality", "html_url": "https://github.com/optimality", "followers_url": "https://api.github.com/users/optimality/followers", "following_url": "https://api.github.com/users/optimality/following{/other_user}", "gists_url": "https://api.github.com/users/optimality/gists{/gist_id}", "starred_url": "https://api.github.com/users/optimality/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/optimality/subscriptions", "organizations_url": "https://api.github.com/users/optimality/orgs", "repos_url": "https://api.github.com/users/optimality/repos", "events_url": "https://api.github.com/users/optimality/events{/privacy}", "received_events_url": "https://api.github.com/users/optimality/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473184161, "node_id": "MDU6TGFiZWw0NzMxODQxNjE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:support", "name": "type:support", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-01-13T19:35:18Z", "updated_at": "2017-01-14T19:12:37Z", "closed_at": "2017-01-13T19:55:34Z", "author_association": "NONE", "body_html": "<p>You can demonstrate this with the distributed MNIST example code: <a href=\"https://cloud.google.com/ml/docs/quickstarts/training#train_on_the_cloud_distributed\" rel=\"nofollow\">https://cloud.google.com/ml/docs/quickstarts/training#train_on_the_cloud_distributed</a></p>\n<p>Running it on gcloud produces:</p>\n<pre lang=\"ERROR\" data-meta=\"2017-01-13 10:56:52 -0500\tmaster-replica-0\t\tTraceback (most recent call last):\"><code>ERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/lib/python2.7/runpy.py\", line 162, in _run_module_as_main\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    \"__main__\", fname, loader, pkg_name)\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/lib/python2.7/runpy.py\", line 72, in _run_code\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    exec code in run_globals\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 537, in &lt;module&gt;\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    tf.app.run()\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 43, in run\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    sys.exit(main(sys.argv[:1] + flags_passthrough))\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 307, in main\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    run(model, argv)\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 431, in run\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    dispatch(args, model, cluster, task)\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 472, in dispatch\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    Trainer(args, model, cluster, task).run_training()\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 243, in run_training\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    self.eval(session)\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 284, in eval\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    self.model.format_metric_values(self.train_evaluator.evaluate()),\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 75, in evaluate\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    self.sv.saver.restore(session, last_checkpoint)\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py\", line 1388, in restore\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    {self.saver_def.filename_tensor_name: save_path})\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 766, in run\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    run_metadata_ptr)\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 964, in _run\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    feed_dict_string, options, run_metadata)\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1014, in _do_run\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    target_list, options, run_metadata)\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1034, in _do_call\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    raise type(e)(node_def, op, message)\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\tInternalError: Unable to get element from the feed as bytes.\nINFO\t2017-01-13 10:56:52 -0500\tworker-replica-0\t\tTrain [worker/0], step 3195 (6.213 sec) 485.6 global steps/s, 170.5 local steps/s\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\tModule raised an exception Command '['python', '-m', u'trainer.task', u'--train_data_paths=gs://cloud-ml-data/mnist/train.tfr.gz', u'--eval_data_paths=gs://cloud-ml-data/mnist/eval.tfr/gz', u'--output_path=&lt;output path&gt;']' returned non-zero exit status 1.```\n\nA fairly minimal test case follows:\n\n```#!/usr/bin/python\nimport argparse\nimport json\nimport os\nimport tensorflow as tf\n\nparser = argparse.ArgumentParser()\nparser.add_argument('--output_path', type=str, default='/tmp/matrix_multiply')\nflags = parser.parse_args()\n\nmatrix1 = tf.placeholder_with_default([[3., 3.]], shape=(1, 2))\nmatrix2 = tf.placeholder_with_default([[2.], [2.]], shape=(2, 1))\nproduct = tf.Variable(tf.matmul(matrix1, matrix2))\n\ninputs = {'matrix1': matrix1.name, 'matrix2': matrix2.name}\ntf.add_to_collection('inputs', json.dumps(inputs))\n\noutputs = {'product': product.name}\ntf.add_to_collection('outputs', json.dumps(outputs))\n\nsaver = tf.train.Saver()\n\nwith tf.Session() as sess:\n\tsess.run(tf.global_variables_initializer())\n\tresult = sess.run(product)\n\tif not os.path.isdir(flags.output_path):\n\t\tos.makedirs(flags.output_path)\n\tsaver.save(sess, os.path.join(flags.output_path, \"export\"))\n\tprint result\n\nwith tf.Session() as sess:\n\tcheckpoint = tf.train.latest_checkpoint(flags.output_path)\n\tprint checkpoint\n\tsaver.restore(sess, checkpoint)\n\n\tfor v in tf.global_variables():\n\t\tprint(v.name, v.eval())```\n</code></pre>", "body_text": "You can demonstrate this with the distributed MNIST example code: https://cloud.google.com/ml/docs/quickstarts/training#train_on_the_cloud_distributed\nRunning it on gcloud produces:\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/lib/python2.7/runpy.py\", line 162, in _run_module_as_main\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    \"__main__\", fname, loader, pkg_name)\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/lib/python2.7/runpy.py\", line 72, in _run_code\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    exec code in run_globals\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 537, in <module>\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    tf.app.run()\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 43, in run\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    sys.exit(main(sys.argv[:1] + flags_passthrough))\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 307, in main\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    run(model, argv)\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 431, in run\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    dispatch(args, model, cluster, task)\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 472, in dispatch\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    Trainer(args, model, cluster, task).run_training()\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 243, in run_training\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    self.eval(session)\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 284, in eval\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    self.model.format_metric_values(self.train_evaluator.evaluate()),\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 75, in evaluate\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    self.sv.saver.restore(session, last_checkpoint)\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py\", line 1388, in restore\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    {self.saver_def.filename_tensor_name: save_path})\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 766, in run\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    run_metadata_ptr)\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 964, in _run\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    feed_dict_string, options, run_metadata)\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1014, in _do_run\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    target_list, options, run_metadata)\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1034, in _do_call\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    raise type(e)(node_def, op, message)\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\tInternalError: Unable to get element from the feed as bytes.\nINFO\t2017-01-13 10:56:52 -0500\tworker-replica-0\t\tTrain [worker/0], step 3195 (6.213 sec) 485.6 global steps/s, 170.5 local steps/s\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\tModule raised an exception Command '['python', '-m', u'trainer.task', u'--train_data_paths=gs://cloud-ml-data/mnist/train.tfr.gz', u'--eval_data_paths=gs://cloud-ml-data/mnist/eval.tfr/gz', u'--output_path=<output path>']' returned non-zero exit status 1.```\n\nA fairly minimal test case follows:\n\n```#!/usr/bin/python\nimport argparse\nimport json\nimport os\nimport tensorflow as tf\n\nparser = argparse.ArgumentParser()\nparser.add_argument('--output_path', type=str, default='/tmp/matrix_multiply')\nflags = parser.parse_args()\n\nmatrix1 = tf.placeholder_with_default([[3., 3.]], shape=(1, 2))\nmatrix2 = tf.placeholder_with_default([[2.], [2.]], shape=(2, 1))\nproduct = tf.Variable(tf.matmul(matrix1, matrix2))\n\ninputs = {'matrix1': matrix1.name, 'matrix2': matrix2.name}\ntf.add_to_collection('inputs', json.dumps(inputs))\n\noutputs = {'product': product.name}\ntf.add_to_collection('outputs', json.dumps(outputs))\n\nsaver = tf.train.Saver()\n\nwith tf.Session() as sess:\n\tsess.run(tf.global_variables_initializer())\n\tresult = sess.run(product)\n\tif not os.path.isdir(flags.output_path):\n\t\tos.makedirs(flags.output_path)\n\tsaver.save(sess, os.path.join(flags.output_path, \"export\"))\n\tprint result\n\nwith tf.Session() as sess:\n\tcheckpoint = tf.train.latest_checkpoint(flags.output_path)\n\tprint checkpoint\n\tsaver.restore(sess, checkpoint)\n\n\tfor v in tf.global_variables():\n\t\tprint(v.name, v.eval())```", "body": "You can demonstrate this with the distributed MNIST example code: https://cloud.google.com/ml/docs/quickstarts/training#train_on_the_cloud_distributed\r\n\r\nRunning it on gcloud produces:\r\n\r\n```ERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\tTraceback (most recent call last):\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/lib/python2.7/runpy.py\", line 162, in _run_module_as_main\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    \"__main__\", fname, loader, pkg_name)\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/lib/python2.7/runpy.py\", line 72, in _run_code\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    exec code in run_globals\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 537, in <module>\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    tf.app.run()\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 43, in run\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    sys.exit(main(sys.argv[:1] + flags_passthrough))\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 307, in main\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    run(model, argv)\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 431, in run\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    dispatch(args, model, cluster, task)\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 472, in dispatch\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    Trainer(args, model, cluster, task).run_training()\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 243, in run_training\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    self.eval(session)\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 284, in eval\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    self.model.format_metric_values(self.train_evaluator.evaluate()),\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/root/.local/lib/python2.7/site-packages/trainer/task.py\", line 75, in evaluate\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    self.sv.saver.restore(session, last_checkpoint)\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py\", line 1388, in restore\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    {self.saver_def.filename_tensor_name: save_path})\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 766, in run\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    run_metadata_ptr)\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 964, in _run\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    feed_dict_string, options, run_metadata)\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1014, in _do_run\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    target_list, options, run_metadata)\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1034, in _do_call\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\t    raise type(e)(node_def, op, message)\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\tInternalError: Unable to get element from the feed as bytes.\r\nINFO\t2017-01-13 10:56:52 -0500\tworker-replica-0\t\tTrain [worker/0], step 3195 (6.213 sec) 485.6 global steps/s, 170.5 local steps/s\r\nERROR\t2017-01-13 10:56:52 -0500\tmaster-replica-0\t\tModule raised an exception Command '['python', '-m', u'trainer.task', u'--train_data_paths=gs://cloud-ml-data/mnist/train.tfr.gz', u'--eval_data_paths=gs://cloud-ml-data/mnist/eval.tfr/gz', u'--output_path=<output path>']' returned non-zero exit status 1.```\r\n\r\nA fairly minimal test case follows:\r\n\r\n```#!/usr/bin/python\r\nimport argparse\r\nimport json\r\nimport os\r\nimport tensorflow as tf\r\n\r\nparser = argparse.ArgumentParser()\r\nparser.add_argument('--output_path', type=str, default='/tmp/matrix_multiply')\r\nflags = parser.parse_args()\r\n\r\nmatrix1 = tf.placeholder_with_default([[3., 3.]], shape=(1, 2))\r\nmatrix2 = tf.placeholder_with_default([[2.], [2.]], shape=(2, 1))\r\nproduct = tf.Variable(tf.matmul(matrix1, matrix2))\r\n\r\ninputs = {'matrix1': matrix1.name, 'matrix2': matrix2.name}\r\ntf.add_to_collection('inputs', json.dumps(inputs))\r\n\r\noutputs = {'product': product.name}\r\ntf.add_to_collection('outputs', json.dumps(outputs))\r\n\r\nsaver = tf.train.Saver()\r\n\r\nwith tf.Session() as sess:\r\n\tsess.run(tf.global_variables_initializer())\r\n\tresult = sess.run(product)\r\n\tif not os.path.isdir(flags.output_path):\r\n\t\tos.makedirs(flags.output_path)\r\n\tsaver.save(sess, os.path.join(flags.output_path, \"export\"))\r\n\tprint result\r\n\r\nwith tf.Session() as sess:\r\n\tcheckpoint = tf.train.latest_checkpoint(flags.output_path)\r\n\tprint checkpoint\r\n\tsaver.restore(sess, checkpoint)\r\n\r\n\tfor v in tf.global_variables():\r\n\t\tprint(v.name, v.eval())```"}