{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/287280629", "html_url": "https://github.com/tensorflow/tensorflow/issues/8478#issuecomment-287280629", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8478", "id": 287280629, "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzI4MDYyOQ==", "user": {"login": "samwhitlock", "id": 433170, "node_id": "MDQ6VXNlcjQzMzE3MA==", "avatar_url": "https://avatars3.githubusercontent.com/u/433170?v=4", "gravatar_id": "", "url": "https://api.github.com/users/samwhitlock", "html_url": "https://github.com/samwhitlock", "followers_url": "https://api.github.com/users/samwhitlock/followers", "following_url": "https://api.github.com/users/samwhitlock/following{/other_user}", "gists_url": "https://api.github.com/users/samwhitlock/gists{/gist_id}", "starred_url": "https://api.github.com/users/samwhitlock/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/samwhitlock/subscriptions", "organizations_url": "https://api.github.com/users/samwhitlock/orgs", "repos_url": "https://api.github.com/users/samwhitlock/repos", "events_url": "https://api.github.com/users/samwhitlock/events{/privacy}", "received_events_url": "https://api.github.com/users/samwhitlock/received_events", "type": "User", "site_admin": false}, "created_at": "2017-03-17T06:51:42Z", "updated_at": "2017-03-17T06:51:42Z", "author_association": "NONE", "body_html": "<blockquote>\n<p>I'd rather add to the optimizer of a session, similar to constant elimination, a pass to pre-heat small memmaped tensors. Does it look like a cleaner solution that solves your problem?</p>\n</blockquote>\n<p>I'm not quite sure how this works, as I am not knowledgeable about this part of the codebase. By \"pre-heat\" do you mean a for loop to touch every page (to trigger the page fault)? At least for my use case, I really need to call <code>mmap</code> with <code>MAP_POPULATE</code> in order to have Linux load all the pages in a single system call. I tried the \"for-loop-to-touch-every-page\" solution prior to this, but that didn't help so much. I read all the data in every file (either to decompress, or to scan if uncompressed) in my graphs / kernels where I use this file mapping.</p>", "body_text": "I'd rather add to the optimizer of a session, similar to constant elimination, a pass to pre-heat small memmaped tensors. Does it look like a cleaner solution that solves your problem?\n\nI'm not quite sure how this works, as I am not knowledgeable about this part of the codebase. By \"pre-heat\" do you mean a for loop to touch every page (to trigger the page fault)? At least for my use case, I really need to call mmap with MAP_POPULATE in order to have Linux load all the pages in a single system call. I tried the \"for-loop-to-touch-every-page\" solution prior to this, but that didn't help so much. I read all the data in every file (either to decompress, or to scan if uncompressed) in my graphs / kernels where I use this file mapping.", "body": "> I'd rather add to the optimizer of a session, similar to constant elimination, a pass to pre-heat small memmaped tensors. Does it look like a cleaner solution that solves your problem?\r\n\r\nI'm not quite sure how this works, as I am not knowledgeable about this part of the codebase. By \"pre-heat\" do you mean a for loop to touch every page (to trigger the page fault)? At least for my use case, I really need to call `mmap` with `MAP_POPULATE` in order to have Linux load all the pages in a single system call. I tried the \"for-loop-to-touch-every-page\" solution prior to this, but that didn't help so much. I read all the data in every file (either to decompress, or to scan if uncompressed) in my graphs / kernels where I use this file mapping."}