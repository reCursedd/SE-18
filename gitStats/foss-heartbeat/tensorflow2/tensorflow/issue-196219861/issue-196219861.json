{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6377", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6377/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6377/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6377/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/6377", "id": 196219861, "node_id": "MDU6SXNzdWUxOTYyMTk4NjE=", "number": 6377, "title": "error getting gradient of `tf.nn.crelu` (concat_v2 along axis -1)", "user": {"login": "mikowals", "id": 1331470, "node_id": "MDQ6VXNlcjEzMzE0NzA=", "avatar_url": "https://avatars0.githubusercontent.com/u/1331470?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikowals", "html_url": "https://github.com/mikowals", "followers_url": "https://api.github.com/users/mikowals/followers", "following_url": "https://api.github.com/users/mikowals/following{/other_user}", "gists_url": "https://api.github.com/users/mikowals/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikowals/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikowals/subscriptions", "organizations_url": "https://api.github.com/users/mikowals/orgs", "repos_url": "https://api.github.com/users/mikowals/repos", "events_url": "https://api.github.com/users/mikowals/events{/privacy}", "received_events_url": "https://api.github.com/users/mikowals/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "aselle", "id": 326106, "node_id": "MDQ6VXNlcjMyNjEwNg==", "avatar_url": "https://avatars1.githubusercontent.com/u/326106?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aselle", "html_url": "https://github.com/aselle", "followers_url": "https://api.github.com/users/aselle/followers", "following_url": "https://api.github.com/users/aselle/following{/other_user}", "gists_url": "https://api.github.com/users/aselle/gists{/gist_id}", "starred_url": "https://api.github.com/users/aselle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aselle/subscriptions", "organizations_url": "https://api.github.com/users/aselle/orgs", "repos_url": "https://api.github.com/users/aselle/repos", "events_url": "https://api.github.com/users/aselle/events{/privacy}", "received_events_url": "https://api.github.com/users/aselle/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "aselle", "id": 326106, "node_id": "MDQ6VXNlcjMyNjEwNg==", "avatar_url": "https://avatars1.githubusercontent.com/u/326106?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aselle", "html_url": "https://github.com/aselle", "followers_url": "https://api.github.com/users/aselle/followers", "following_url": "https://api.github.com/users/aselle/following{/other_user}", "gists_url": "https://api.github.com/users/aselle/gists{/gist_id}", "starred_url": "https://api.github.com/users/aselle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aselle/subscriptions", "organizations_url": "https://api.github.com/users/aselle/orgs", "repos_url": "https://api.github.com/users/aselle/repos", "events_url": "https://api.github.com/users/aselle/events{/privacy}", "received_events_url": "https://api.github.com/users/aselle/received_events", "type": "User", "site_admin": false}, {"login": "annarev", "id": 22060313, "node_id": "MDQ6VXNlcjIyMDYwMzEz", "avatar_url": "https://avatars0.githubusercontent.com/u/22060313?v=4", "gravatar_id": "", "url": "https://api.github.com/users/annarev", "html_url": "https://github.com/annarev", "followers_url": "https://api.github.com/users/annarev/followers", "following_url": "https://api.github.com/users/annarev/following{/other_user}", "gists_url": "https://api.github.com/users/annarev/gists{/gist_id}", "starred_url": "https://api.github.com/users/annarev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/annarev/subscriptions", "organizations_url": "https://api.github.com/users/annarev/orgs", "repos_url": "https://api.github.com/users/annarev/repos", "events_url": "https://api.github.com/users/annarev/events{/privacy}", "received_events_url": "https://api.github.com/users/annarev/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2016-12-17T12:32:38Z", "updated_at": "2017-01-23T20:20:39Z", "closed_at": "2017-01-23T20:20:39Z", "author_association": "CONTRIBUTOR", "body_html": "<p>I am on MacOS Sierra with CPU only nightly.<br>\ntf.<strong>git_version</strong> is 0.12.0-rc0-1156-g8c18a00-dirty.</p>\n<p>The error comes from the gradient calculation in concat_v2 when axis = -1 is used to get the last dimension.  I could not find axis=-1 documentation for concat_v2 but that is how crelu is implemented.</p>\n<p>Concat_v2 along last dimension as a positive int works fine.  The forward pass with axis = -1 also works fine, it is just getting a gradient that gives an error.</p>\n<p>Reproduce with:</p>\n<pre><code>import tensorflow as tf\n\ninputs = tf.random_normal([64, 32,32, 3])\ninputs2 = tf.random_normal([64, 32,32, 3])\nhidden = tf.concat_v2([inputs, inputs2], axis=-1)  # axis = 3 works fine\ngrad = tf.gradients(hidden, [inputs])\n\nwith tf.Session() as sess:\nprint( sess.run(grad))\n</code></pre>\n<p>Gives error:</p>\n<blockquote>\n<p>...which was originally created as op u'concat_v2', defined at:<br>\nFile \"crelu.py\", line 5, in <br>\nhidden = tf.concat_v2([inputs, inputs2], axis=-1)<br>\nFile \"/Users/mikowals/projects/tensorflow/lib/python2.7/site-packages/tensorflow/python/ops/array_ops.py\", line 1062, in concat_v2<br>\nname=name)<br>\nFile \"/Users/mikowals/projects/tensorflow/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 498, in _concat_v2<br>\nname=name)<br>\nFile \"/Users/mikowals/projects/tensorflow/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op<br>\nop_def=op_def)<br>\nFile \"/Users/mikowals/projects/tensorflow/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2389, in create_op<br>\noriginal_op=self._default_original_op, op_def=op_def)<br>\nFile \"/Users/mikowals/projects/tensorflow/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1264, in <strong>init</strong><br>\nself._traceback = _extract_stack()</p>\n</blockquote>\n<blockquote>\n<p>InvalidArgumentError (see above for traceback): Concat dim is out of range: -1 vs. 4<br>\n[[Node: gradients/concat_v2_grad/ConcatOffset = ConcatOffset[N=2, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](concat_v2/axis, gradients/concat_v2_grad/Shape, gradients/concat_v2_grad/Shape_1)]]</p>\n</blockquote>", "body_text": "I am on MacOS Sierra with CPU only nightly.\ntf.git_version is 0.12.0-rc0-1156-g8c18a00-dirty.\nThe error comes from the gradient calculation in concat_v2 when axis = -1 is used to get the last dimension.  I could not find axis=-1 documentation for concat_v2 but that is how crelu is implemented.\nConcat_v2 along last dimension as a positive int works fine.  The forward pass with axis = -1 also works fine, it is just getting a gradient that gives an error.\nReproduce with:\nimport tensorflow as tf\n\ninputs = tf.random_normal([64, 32,32, 3])\ninputs2 = tf.random_normal([64, 32,32, 3])\nhidden = tf.concat_v2([inputs, inputs2], axis=-1)  # axis = 3 works fine\ngrad = tf.gradients(hidden, [inputs])\n\nwith tf.Session() as sess:\nprint( sess.run(grad))\n\nGives error:\n\n...which was originally created as op u'concat_v2', defined at:\nFile \"crelu.py\", line 5, in \nhidden = tf.concat_v2([inputs, inputs2], axis=-1)\nFile \"/Users/mikowals/projects/tensorflow/lib/python2.7/site-packages/tensorflow/python/ops/array_ops.py\", line 1062, in concat_v2\nname=name)\nFile \"/Users/mikowals/projects/tensorflow/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 498, in _concat_v2\nname=name)\nFile \"/Users/mikowals/projects/tensorflow/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\nop_def=op_def)\nFile \"/Users/mikowals/projects/tensorflow/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2389, in create_op\noriginal_op=self._default_original_op, op_def=op_def)\nFile \"/Users/mikowals/projects/tensorflow/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1264, in init\nself._traceback = _extract_stack()\n\n\nInvalidArgumentError (see above for traceback): Concat dim is out of range: -1 vs. 4\n[[Node: gradients/concat_v2_grad/ConcatOffset = ConcatOffset[N=2, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](concat_v2/axis, gradients/concat_v2_grad/Shape, gradients/concat_v2_grad/Shape_1)]]", "body": "I am on MacOS Sierra with CPU only nightly. \r\ntf.__git_version__ is 0.12.0-rc0-1156-g8c18a00-dirty.\r\n\r\nThe error comes from the gradient calculation in concat_v2 when axis = -1 is used to get the last dimension.  I could not find axis=-1 documentation for concat_v2 but that is how crelu is implemented.  \r\n\r\nConcat_v2 along last dimension as a positive int works fine.  The forward pass with axis = -1 also works fine, it is just getting a gradient that gives an error.\r\n\r\nReproduce with:\r\n\r\n    import tensorflow as tf\r\n\r\n    inputs = tf.random_normal([64, 32,32, 3])\r\n    inputs2 = tf.random_normal([64, 32,32, 3])\r\n    hidden = tf.concat_v2([inputs, inputs2], axis=-1)  # axis = 3 works fine\r\n    grad = tf.gradients(hidden, [inputs])\r\n\r\n    with tf.Session() as sess:\r\n\tprint( sess.run(grad))\r\n\r\nGives error:\r\n\r\n> ...which was originally created as op u'concat_v2', defined at:\r\n  File \"crelu.py\", line 5, in <module>\r\n    hidden = tf.concat_v2([inputs, inputs2], axis=-1)\r\n  File \"/Users/mikowals/projects/tensorflow/lib/python2.7/site-packages/tensorflow/python/ops/array_ops.py\", line 1062, in concat_v2\r\n    name=name)\r\n  File \"/Users/mikowals/projects/tensorflow/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 498, in _concat_v2\r\n    name=name)\r\n  File \"/Users/mikowals/projects/tensorflow/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\r\n    op_def=op_def)\r\n  File \"/Users/mikowals/projects/tensorflow/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2389, in create_op\r\n    original_op=self._default_original_op, op_def=op_def)\r\n  File \"/Users/mikowals/projects/tensorflow/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\r\n    self._traceback = _extract_stack()\r\n\r\n>InvalidArgumentError (see above for traceback): Concat dim is out of range: -1 vs. 4\r\n\t [[Node: gradients/concat_v2_grad/ConcatOffset = ConcatOffset[N=2, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](concat_v2/axis, gradients/concat_v2_grad/Shape, gradients/concat_v2_grad/Shape_1)]]\r\n"}