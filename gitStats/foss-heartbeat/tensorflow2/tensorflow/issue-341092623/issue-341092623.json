{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20784", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20784/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20784/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20784/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/20784", "id": 341092623, "node_id": "MDU6SXNzdWUzNDEwOTI2MjM=", "number": 20784, "title": "BUG: Estimator training with tf.contrib.distribute fails under 1.9.0 but works under 1.8.0", "user": {"login": "ORippler", "id": 24656669, "node_id": "MDQ6VXNlcjI0NjU2NjY5", "avatar_url": "https://avatars0.githubusercontent.com/u/24656669?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ORippler", "html_url": "https://github.com/ORippler", "followers_url": "https://api.github.com/users/ORippler/followers", "following_url": "https://api.github.com/users/ORippler/following{/other_user}", "gists_url": "https://api.github.com/users/ORippler/gists{/gist_id}", "starred_url": "https://api.github.com/users/ORippler/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ORippler/subscriptions", "organizations_url": "https://api.github.com/users/ORippler/orgs", "repos_url": "https://api.github.com/users/ORippler/repos", "events_url": "https://api.github.com/users/ORippler/events{/privacy}", "received_events_url": "https://api.github.com/users/ORippler/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "robieta", "id": 13089297, "node_id": "MDQ6VXNlcjEzMDg5Mjk3", "avatar_url": "https://avatars0.githubusercontent.com/u/13089297?v=4", "gravatar_id": "", "url": "https://api.github.com/users/robieta", "html_url": "https://github.com/robieta", "followers_url": "https://api.github.com/users/robieta/followers", "following_url": "https://api.github.com/users/robieta/following{/other_user}", "gists_url": "https://api.github.com/users/robieta/gists{/gist_id}", "starred_url": "https://api.github.com/users/robieta/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/robieta/subscriptions", "organizations_url": "https://api.github.com/users/robieta/orgs", "repos_url": "https://api.github.com/users/robieta/repos", "events_url": "https://api.github.com/users/robieta/events{/privacy}", "received_events_url": "https://api.github.com/users/robieta/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "robieta", "id": 13089297, "node_id": "MDQ6VXNlcjEzMDg5Mjk3", "avatar_url": "https://avatars0.githubusercontent.com/u/13089297?v=4", "gravatar_id": "", "url": "https://api.github.com/users/robieta", "html_url": "https://github.com/robieta", "followers_url": "https://api.github.com/users/robieta/followers", "following_url": "https://api.github.com/users/robieta/following{/other_user}", "gists_url": "https://api.github.com/users/robieta/gists{/gist_id}", "starred_url": "https://api.github.com/users/robieta/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/robieta/subscriptions", "organizations_url": "https://api.github.com/users/robieta/orgs", "repos_url": "https://api.github.com/users/robieta/repos", "events_url": "https://api.github.com/users/robieta/events{/privacy}", "received_events_url": "https://api.github.com/users/robieta/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2018-07-13T17:03:27Z", "updated_at": "2018-07-15T15:19:22Z", "closed_at": "2018-07-15T15:19:22Z", "author_association": "NONE", "body_html": "<hr>\n<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:<br>\nYes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nLinux Ubuntu 16.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>:<br>\nbinary</li>\n<li><strong>TensorFlow version (use command below)</strong>:<br>\n1.9.0 and and v1.8.0-0-g93bc2e2072 1.8.0</li>\n<li><strong>Python version</strong>:<br>\n3.6.5</li>\n<li><strong>Bazel version (if compiling from source)</strong>:<br>\nN/A</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>:<br>\nN/A</li>\n<li><strong>CUDA/cuDNN version</strong>:<br>\n9.0</li>\n<li><strong>GPU model and memory</strong>:<br>\nTitan 1080 Ti 12GB</li>\n<li><strong>Exact command to reproduce</strong>:<br>\nSee description</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>Training Estimator single or multi-gpu with OneDeviceStrategy and MirroredStrategy respectively works under 1.8.0 but produces a graph assertion error under 1.9.0. I know of no breaking changes regarding this mentioned in the <a href=\"https://github.com/tensorflow/tensorflow/releases/tag/v1.9.0\">release notes</a>.</p>\n<h3>Source code / logs</h3>\n<p>I broke it down to the following MWE. Under 1.8.0, both versions work fine, whereas in 1.9.0, the commented out lines work fine and the marked line produces the error as outlined in the Traceback.</p>\n<pre><code>import tensorflow as tf\n\ndef model_fn(features, labels=None, mode=tf.estimator.ModeKeys.TRAIN, params=None):\n\n    train_images_batch = features\n    res = tf.layers.conv2d(inputs=train_images_batch, filters=3, kernel_size=3, strides=1, padding='same', data_format='channels_first')\n    loss = tf.reduce_mean((train_images_batch - res) ** 2)\n    optimizer = tf.train.AdamOptimizer().minimize(loss = loss)\n    return tf.estimator.EstimatorSpec(\n        mode=tf.estimator.ModeKeys.TRAIN,\n        loss=loss, train_op=optimizer)\n\nclass Dataset():\n    def __init__(self):\n        self.dataset = tf.data.Dataset.from_tensors(tf.ones([3,124,124]))\n\n    def map_func(self, entry):\n\n        return (tf.zeros([3,124,124]))\n      \n    def input_fn(self):\n\n        #dataset = tf.data.Dataset.from_tensors(np.ones(shape=(3,124,124)))\n        #dataset = dataset.apply(tf.contrib.data.shuffle_and_repeat(1, count=1))\n        dataset = self.dataset.apply(tf.contrib.data.shuffle_and_repeat(1, count=1)) # this line actually produces the error\n        dataset = dataset.apply(tf.contrib.data.map_and_batch(map_func= self.map_func, num_parallel_batches=1, batch_size=1))\n        dataset = dataset.prefetch(buffer_size = 1)\n\n        return dataset\n\ndset = Dataset()\n\nsingle_gpu = tf.contrib.distribute.OneDeviceStrategy(device='/gpu:0')\n\nrunconfig = tf.estimator.RunConfig(train_distribute=single_gpu)\n\nestimator = tf.estimator.Estimator(model_fn=model_fn,\n                                   config=runconfig)\n\nestimator.train(input_fn = lambda: dset.input_fn())\n</code></pre>\n<p>Traceback:</p>\n<pre><code>Traceback (most recent call last):\n  File \"/home/staff/rippel/TF_MSD/MWE.py\", line 40, in &lt;module&gt;\n    estimator.train(input_fn = lambda: dset.input_fn())\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 366, in train\n    loss = self._train_model(input_fn, hooks, saving_listeners)\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1117, in _train_model\n    return self._train_model_distributed(input_fn, hooks, saving_listeners)\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1145, in _train_model_distributed\n    input_fn, model_fn_lib.ModeKeys.TRAIN))\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 987, in _get_features_and_labels_from_input_fn\n    return estimator_util.parse_input_fn_result(result)\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/estimator/util.py\", line 104, in parse_input_fn_result\n    iterator = result.make_initializable_iterator()\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/values.py\", line 606, in make_initializable_iterator\n    dataset_iterator = self._dataset.make_initializable_iterator()\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/prefetching_ops_v2.py\", line 181, in make_initializable_iterator\n    shared_name=shared_name)\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/prefetching_ops_v2.py\", line 105, in __init__\n    self._input_dataset)\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/data/ops/iterator_ops.py\", line 311, in make_initializer\n    dataset._as_variant_tensor(), self._iterator_resource, name=name)  # pylint: disable=protected-access\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/data/ops/dataset_ops.py\", line 2082, in _as_variant_tensor\n    self._input_dataset._as_variant_tensor(),  # pylint: disable=protected-access\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/contrib/data/python/ops/batching.py\", line 485, in _as_variant_tensor\n    input_resource = self._input_dataset._as_variant_tensor()\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/contrib/data/python/ops/shuffle_ops.py\", line 62, in _as_variant_tensor\n    sparse.as_dense_shapes(self.output_shapes, self.output_classes)))\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/ops/gen_dataset_ops.py\", line 3554, in shuffle_and_repeat_dataset\n    output_types=output_types, output_shapes=output_shapes, name=name)\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 350, in _apply_op_helper\n    g = ops._get_graph_from_inputs(_Flatten(keywords.values()))\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 5663, in _get_graph_from_inputs\n    _assert_same_graph(original_graph_element, graph_element)\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 5599, in _assert_same_graph\n    original_item))\nValueError: Tensor(\"buffer_size:0\", shape=(), dtype=int64, device=/device:CPU:0) must be from the same graph as Tensor(\"TensorDataset:0\", shape=(), dtype=variant).\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nYes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nLinux Ubuntu 16.04\nTensorFlow installed from (source or binary):\nbinary\nTensorFlow version (use command below):\n1.9.0 and and v1.8.0-0-g93bc2e2072 1.8.0\nPython version:\n3.6.5\nBazel version (if compiling from source):\nN/A\nGCC/Compiler version (if compiling from source):\nN/A\nCUDA/cuDNN version:\n9.0\nGPU model and memory:\nTitan 1080 Ti 12GB\nExact command to reproduce:\nSee description\n\nDescribe the problem\nTraining Estimator single or multi-gpu with OneDeviceStrategy and MirroredStrategy respectively works under 1.8.0 but produces a graph assertion error under 1.9.0. I know of no breaking changes regarding this mentioned in the release notes.\nSource code / logs\nI broke it down to the following MWE. Under 1.8.0, both versions work fine, whereas in 1.9.0, the commented out lines work fine and the marked line produces the error as outlined in the Traceback.\nimport tensorflow as tf\n\ndef model_fn(features, labels=None, mode=tf.estimator.ModeKeys.TRAIN, params=None):\n\n    train_images_batch = features\n    res = tf.layers.conv2d(inputs=train_images_batch, filters=3, kernel_size=3, strides=1, padding='same', data_format='channels_first')\n    loss = tf.reduce_mean((train_images_batch - res) ** 2)\n    optimizer = tf.train.AdamOptimizer().minimize(loss = loss)\n    return tf.estimator.EstimatorSpec(\n        mode=tf.estimator.ModeKeys.TRAIN,\n        loss=loss, train_op=optimizer)\n\nclass Dataset():\n    def __init__(self):\n        self.dataset = tf.data.Dataset.from_tensors(tf.ones([3,124,124]))\n\n    def map_func(self, entry):\n\n        return (tf.zeros([3,124,124]))\n      \n    def input_fn(self):\n\n        #dataset = tf.data.Dataset.from_tensors(np.ones(shape=(3,124,124)))\n        #dataset = dataset.apply(tf.contrib.data.shuffle_and_repeat(1, count=1))\n        dataset = self.dataset.apply(tf.contrib.data.shuffle_and_repeat(1, count=1)) # this line actually produces the error\n        dataset = dataset.apply(tf.contrib.data.map_and_batch(map_func= self.map_func, num_parallel_batches=1, batch_size=1))\n        dataset = dataset.prefetch(buffer_size = 1)\n\n        return dataset\n\ndset = Dataset()\n\nsingle_gpu = tf.contrib.distribute.OneDeviceStrategy(device='/gpu:0')\n\nrunconfig = tf.estimator.RunConfig(train_distribute=single_gpu)\n\nestimator = tf.estimator.Estimator(model_fn=model_fn,\n                                   config=runconfig)\n\nestimator.train(input_fn = lambda: dset.input_fn())\n\nTraceback:\nTraceback (most recent call last):\n  File \"/home/staff/rippel/TF_MSD/MWE.py\", line 40, in <module>\n    estimator.train(input_fn = lambda: dset.input_fn())\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 366, in train\n    loss = self._train_model(input_fn, hooks, saving_listeners)\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1117, in _train_model\n    return self._train_model_distributed(input_fn, hooks, saving_listeners)\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1145, in _train_model_distributed\n    input_fn, model_fn_lib.ModeKeys.TRAIN))\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 987, in _get_features_and_labels_from_input_fn\n    return estimator_util.parse_input_fn_result(result)\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/estimator/util.py\", line 104, in parse_input_fn_result\n    iterator = result.make_initializable_iterator()\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/values.py\", line 606, in make_initializable_iterator\n    dataset_iterator = self._dataset.make_initializable_iterator()\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/prefetching_ops_v2.py\", line 181, in make_initializable_iterator\n    shared_name=shared_name)\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/prefetching_ops_v2.py\", line 105, in __init__\n    self._input_dataset)\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/data/ops/iterator_ops.py\", line 311, in make_initializer\n    dataset._as_variant_tensor(), self._iterator_resource, name=name)  # pylint: disable=protected-access\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/data/ops/dataset_ops.py\", line 2082, in _as_variant_tensor\n    self._input_dataset._as_variant_tensor(),  # pylint: disable=protected-access\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/contrib/data/python/ops/batching.py\", line 485, in _as_variant_tensor\n    input_resource = self._input_dataset._as_variant_tensor()\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/contrib/data/python/ops/shuffle_ops.py\", line 62, in _as_variant_tensor\n    sparse.as_dense_shapes(self.output_shapes, self.output_classes)))\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/ops/gen_dataset_ops.py\", line 3554, in shuffle_and_repeat_dataset\n    output_types=output_types, output_shapes=output_shapes, name=name)\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 350, in _apply_op_helper\n    g = ops._get_graph_from_inputs(_Flatten(keywords.values()))\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 5663, in _get_graph_from_inputs\n    _assert_same_graph(original_graph_element, graph_element)\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 5599, in _assert_same_graph\n    original_item))\nValueError: Tensor(\"buffer_size:0\", shape=(), dtype=int64, device=/device:CPU:0) must be from the same graph as Tensor(\"TensorDataset:0\", shape=(), dtype=variant).", "body": "------------------------\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\nYes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\nLinux Ubuntu 16.04\r\n- **TensorFlow installed from (source or binary)**:\r\nbinary\r\n- **TensorFlow version (use command below)**:\r\n1.9.0 and and v1.8.0-0-g93bc2e2072 1.8.0\r\n- **Python version**:\r\n3.6.5 \r\n- **Bazel version (if compiling from source)**:\r\nN/A\r\n- **GCC/Compiler version (if compiling from source)**:\r\nN/A\r\n- **CUDA/cuDNN version**:\r\n9.0\r\n- **GPU model and memory**:\r\nTitan 1080 Ti 12GB\r\n- **Exact command to reproduce**:\r\nSee description\r\n\r\n### Describe the problem\r\nTraining Estimator single or multi-gpu with OneDeviceStrategy and MirroredStrategy respectively works under 1.8.0 but produces a graph assertion error under 1.9.0. I know of no breaking changes regarding this mentioned in the [release notes](https://github.com/tensorflow/tensorflow/releases/tag/v1.9.0).\r\n\r\n### Source code / logs\r\n\r\nI broke it down to the following MWE. Under 1.8.0, both versions work fine, whereas in 1.9.0, the commented out lines work fine and the marked line produces the error as outlined in the Traceback.\r\n\r\n\r\n```\r\nimport tensorflow as tf\r\n\r\ndef model_fn(features, labels=None, mode=tf.estimator.ModeKeys.TRAIN, params=None):\r\n\r\n    train_images_batch = features\r\n    res = tf.layers.conv2d(inputs=train_images_batch, filters=3, kernel_size=3, strides=1, padding='same', data_format='channels_first')\r\n    loss = tf.reduce_mean((train_images_batch - res) ** 2)\r\n    optimizer = tf.train.AdamOptimizer().minimize(loss = loss)\r\n    return tf.estimator.EstimatorSpec(\r\n        mode=tf.estimator.ModeKeys.TRAIN,\r\n        loss=loss, train_op=optimizer)\r\n\r\nclass Dataset():\r\n    def __init__(self):\r\n        self.dataset = tf.data.Dataset.from_tensors(tf.ones([3,124,124]))\r\n\r\n    def map_func(self, entry):\r\n\r\n        return (tf.zeros([3,124,124]))\r\n      \r\n    def input_fn(self):\r\n\r\n        #dataset = tf.data.Dataset.from_tensors(np.ones(shape=(3,124,124)))\r\n        #dataset = dataset.apply(tf.contrib.data.shuffle_and_repeat(1, count=1))\r\n        dataset = self.dataset.apply(tf.contrib.data.shuffle_and_repeat(1, count=1)) # this line actually produces the error\r\n        dataset = dataset.apply(tf.contrib.data.map_and_batch(map_func= self.map_func, num_parallel_batches=1, batch_size=1))\r\n        dataset = dataset.prefetch(buffer_size = 1)\r\n\r\n        return dataset\r\n\r\ndset = Dataset()\r\n\r\nsingle_gpu = tf.contrib.distribute.OneDeviceStrategy(device='/gpu:0')\r\n\r\nrunconfig = tf.estimator.RunConfig(train_distribute=single_gpu)\r\n\r\nestimator = tf.estimator.Estimator(model_fn=model_fn,\r\n                                   config=runconfig)\r\n\r\nestimator.train(input_fn = lambda: dset.input_fn())\r\n```\r\n\r\nTraceback:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/staff/rippel/TF_MSD/MWE.py\", line 40, in <module>\r\n    estimator.train(input_fn = lambda: dset.input_fn())\r\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 366, in train\r\n    loss = self._train_model(input_fn, hooks, saving_listeners)\r\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1117, in _train_model\r\n    return self._train_model_distributed(input_fn, hooks, saving_listeners)\r\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1145, in _train_model_distributed\r\n    input_fn, model_fn_lib.ModeKeys.TRAIN))\r\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 987, in _get_features_and_labels_from_input_fn\r\n    return estimator_util.parse_input_fn_result(result)\r\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/estimator/util.py\", line 104, in parse_input_fn_result\r\n    iterator = result.make_initializable_iterator()\r\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/values.py\", line 606, in make_initializable_iterator\r\n    dataset_iterator = self._dataset.make_initializable_iterator()\r\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/prefetching_ops_v2.py\", line 181, in make_initializable_iterator\r\n    shared_name=shared_name)\r\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/prefetching_ops_v2.py\", line 105, in __init__\r\n    self._input_dataset)\r\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/data/ops/iterator_ops.py\", line 311, in make_initializer\r\n    dataset._as_variant_tensor(), self._iterator_resource, name=name)  # pylint: disable=protected-access\r\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/data/ops/dataset_ops.py\", line 2082, in _as_variant_tensor\r\n    self._input_dataset._as_variant_tensor(),  # pylint: disable=protected-access\r\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/contrib/data/python/ops/batching.py\", line 485, in _as_variant_tensor\r\n    input_resource = self._input_dataset._as_variant_tensor()\r\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/contrib/data/python/ops/shuffle_ops.py\", line 62, in _as_variant_tensor\r\n    sparse.as_dense_shapes(self.output_shapes, self.output_classes)))\r\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/ops/gen_dataset_ops.py\", line 3554, in shuffle_and_repeat_dataset\r\n    output_types=output_types, output_shapes=output_shapes, name=name)\r\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 350, in _apply_op_helper\r\n    g = ops._get_graph_from_inputs(_Flatten(keywords.values()))\r\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 5663, in _get_graph_from_inputs\r\n    _assert_same_graph(original_graph_element, graph_element)\r\n  File \"/home/staff/rippel/.conda/envs/rippel_tf/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 5599, in _assert_same_graph\r\n    original_item))\r\nValueError: Tensor(\"buffer_size:0\", shape=(), dtype=int64, device=/device:CPU:0) must be from the same graph as Tensor(\"TensorDataset:0\", shape=(), dtype=variant).\r\n```"}