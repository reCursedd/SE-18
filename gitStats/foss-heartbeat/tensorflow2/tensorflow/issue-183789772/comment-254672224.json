{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/254672224", "html_url": "https://github.com/tensorflow/tensorflow/issues/5048#issuecomment-254672224", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5048", "id": 254672224, "node_id": "MDEyOklzc3VlQ29tbWVudDI1NDY3MjIyNA==", "user": {"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}, "created_at": "2016-10-18T23:52:05Z", "updated_at": "2016-10-18T23:52:05Z", "author_association": "MEMBER", "body_html": "<p>Ah, I actually had a conversation with <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=463737\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/vrv\">@vrv</a> and have some more useful information for you.</p>\n<p>Short story: Can you re-run after setting the environment variable <code>TF_CUDNN_USE_AUTOTUNE=0</code>?</p>\n<p>Long story: For some ops, such as <code>Conv2D</code> (on GPUs), TensorFlow <a href=\"https://github.com/tensorflow/tensorflow/blob/5a566a7701381a5cf7f70fce397759483764e482/tensorflow/core/kernels/conv_ops.cc#L529\">supports \"auto-tuning\"</a>, which means that it profiles multiple algorithms for the operation before selecting one. This selection is cached based on the shapes of the tensors and some other parameters, but the first time new shapes are encountered, it has to re-profile. This is likely what is causing the slowdown when you provide arbitrary shapes and speeds things up after it has profiled the 10 predefined sizes you had provided.</p>\n<p>Disabling auto-tuning with the environment variable will mean that you might not end up using the best algorithm, but should get consistent results.</p>\n<p>Hope that helps, let us know. Thanks!</p>", "body_text": "Ah, I actually had a conversation with @vrv and have some more useful information for you.\nShort story: Can you re-run after setting the environment variable TF_CUDNN_USE_AUTOTUNE=0?\nLong story: For some ops, such as Conv2D (on GPUs), TensorFlow supports \"auto-tuning\", which means that it profiles multiple algorithms for the operation before selecting one. This selection is cached based on the shapes of the tensors and some other parameters, but the first time new shapes are encountered, it has to re-profile. This is likely what is causing the slowdown when you provide arbitrary shapes and speeds things up after it has profiled the 10 predefined sizes you had provided.\nDisabling auto-tuning with the environment variable will mean that you might not end up using the best algorithm, but should get consistent results.\nHope that helps, let us know. Thanks!", "body": "Ah, I actually had a conversation with @vrv and have some more useful information for you.\n\nShort story: Can you re-run after setting the environment variable `TF_CUDNN_USE_AUTOTUNE=0`?\n\nLong story: For some ops, such as `Conv2D` (on GPUs), TensorFlow [supports \"auto-tuning\"](https://github.com/tensorflow/tensorflow/blob/5a566a7701381a5cf7f70fce397759483764e482/tensorflow/core/kernels/conv_ops.cc#L529), which means that it profiles multiple algorithms for the operation before selecting one. This selection is cached based on the shapes of the tensors and some other parameters, but the first time new shapes are encountered, it has to re-profile. This is likely what is causing the slowdown when you provide arbitrary shapes and speeds things up after it has profiled the 10 predefined sizes you had provided.\n\nDisabling auto-tuning with the environment variable will mean that you might not end up using the best algorithm, but should get consistent results.\n\nHope that helps, let us know. Thanks!\n"}