{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3704", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3704/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3704/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3704/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/3704", "id": 170082231, "node_id": "MDU6SXNzdWUxNzAwODIyMzE=", "number": 3704, "title": "scalar_summary within map_fn hangs when run. ", "user": {"login": "liusiqi43", "id": 1165468, "node_id": "MDQ6VXNlcjExNjU0Njg=", "avatar_url": "https://avatars0.githubusercontent.com/u/1165468?v=4", "gravatar_id": "", "url": "https://api.github.com/users/liusiqi43", "html_url": "https://github.com/liusiqi43", "followers_url": "https://api.github.com/users/liusiqi43/followers", "following_url": "https://api.github.com/users/liusiqi43/following{/other_user}", "gists_url": "https://api.github.com/users/liusiqi43/gists{/gist_id}", "starred_url": "https://api.github.com/users/liusiqi43/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/liusiqi43/subscriptions", "organizations_url": "https://api.github.com/users/liusiqi43/orgs", "repos_url": "https://api.github.com/users/liusiqi43/repos", "events_url": "https://api.github.com/users/liusiqi43/events{/privacy}", "received_events_url": "https://api.github.com/users/liusiqi43/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-08-09T04:59:40Z", "updated_at": "2017-01-24T21:52:40Z", "closed_at": "2017-01-24T21:52:40Z", "author_association": "NONE", "body_html": "<p>On tf 0.9, it seems that I cannot collect summaries from within map_fn. The following code would reproduce the problem:</p>\n<pre><code>\nimport tensorflow as tf\n\nsummaries = []\ndef summarize_and_plus_one(inp):\n    summaries.append(tf.scalar_summary('inp_%s' % inp, inp))\n    inp += 1\n    return inp\n\na = tf.constant([1,2,3,4])\nb = tf.map_fn(summarize_and_plus_one, a)\n\nwith tf.Session() as sess:\n    print(sess.run(b))\n    sess.run(tf.merge_all_summaries()) # The code would hang here. \n\n</code></pre>\n<p>If I unpack first and apply the function without map_fn, the code finishes as expected:</p>\n<pre><code>\nimport tensorflow as tf\n\nsummaries = []\ndef summarize_and_plus_one(inp):\n    summaries.append(tf.scalar_summary('inp_%s' % inp, inp))\n    inp += 1\n    return inp\n\na = tf.constant([1,2,3,4])\n\nres = []\nfor x in tf.unpack(a):\n    res.append(summarize_and_plus_one(x))\nb = tf.pack(res)\n\nwith tf.Session() as sess:\n    print(sess.run(b))\n    sess.run(tf.merge_all_summaries())\n\n</code></pre>\n<p>Is this a known issue? It seems the problem is with map_fn (or while_loop).</p>", "body_text": "On tf 0.9, it seems that I cannot collect summaries from within map_fn. The following code would reproduce the problem:\n\nimport tensorflow as tf\n\nsummaries = []\ndef summarize_and_plus_one(inp):\n    summaries.append(tf.scalar_summary('inp_%s' % inp, inp))\n    inp += 1\n    return inp\n\na = tf.constant([1,2,3,4])\nb = tf.map_fn(summarize_and_plus_one, a)\n\nwith tf.Session() as sess:\n    print(sess.run(b))\n    sess.run(tf.merge_all_summaries()) # The code would hang here. \n\n\nIf I unpack first and apply the function without map_fn, the code finishes as expected:\n\nimport tensorflow as tf\n\nsummaries = []\ndef summarize_and_plus_one(inp):\n    summaries.append(tf.scalar_summary('inp_%s' % inp, inp))\n    inp += 1\n    return inp\n\na = tf.constant([1,2,3,4])\n\nres = []\nfor x in tf.unpack(a):\n    res.append(summarize_and_plus_one(x))\nb = tf.pack(res)\n\nwith tf.Session() as sess:\n    print(sess.run(b))\n    sess.run(tf.merge_all_summaries())\n\n\nIs this a known issue? It seems the problem is with map_fn (or while_loop).", "body": "On tf 0.9, it seems that I cannot collect summaries from within map_fn. The following code would reproduce the problem: \n\n```\n\nimport tensorflow as tf\n\nsummaries = []\ndef summarize_and_plus_one(inp):\n    summaries.append(tf.scalar_summary('inp_%s' % inp, inp))\n    inp += 1\n    return inp\n\na = tf.constant([1,2,3,4])\nb = tf.map_fn(summarize_and_plus_one, a)\n\nwith tf.Session() as sess:\n    print(sess.run(b))\n    sess.run(tf.merge_all_summaries()) # The code would hang here. \n\n```\n\nIf I unpack first and apply the function without map_fn, the code finishes as expected: \n\n```\n\nimport tensorflow as tf\n\nsummaries = []\ndef summarize_and_plus_one(inp):\n    summaries.append(tf.scalar_summary('inp_%s' % inp, inp))\n    inp += 1\n    return inp\n\na = tf.constant([1,2,3,4])\n\nres = []\nfor x in tf.unpack(a):\n    res.append(summarize_and_plus_one(x))\nb = tf.pack(res)\n\nwith tf.Session() as sess:\n    print(sess.run(b))\n    sess.run(tf.merge_all_summaries())\n\n```\n\nIs this a known issue? It seems the problem is with map_fn (or while_loop). \n"}