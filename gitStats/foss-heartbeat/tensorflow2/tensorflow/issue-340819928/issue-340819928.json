{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20753", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20753/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20753/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20753/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/20753", "id": 340819928, "node_id": "MDExOlB1bGxSZXF1ZXN0MjAxMTQyNTU2", "number": 20753, "title": "[tf.keras] Fix input shape for 1D output using tf.data.Dataset", "user": {"login": "lgeiger", "id": 13285808, "node_id": "MDQ6VXNlcjEzMjg1ODA4", "avatar_url": "https://avatars1.githubusercontent.com/u/13285808?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lgeiger", "html_url": "https://github.com/lgeiger", "followers_url": "https://api.github.com/users/lgeiger/followers", "following_url": "https://api.github.com/users/lgeiger/following{/other_user}", "gists_url": "https://api.github.com/users/lgeiger/gists{/gist_id}", "starred_url": "https://api.github.com/users/lgeiger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lgeiger/subscriptions", "organizations_url": "https://api.github.com/users/lgeiger/orgs", "repos_url": "https://api.github.com/users/lgeiger/repos", "events_url": "https://api.github.com/users/lgeiger/events{/privacy}", "received_events_url": "https://api.github.com/users/lgeiger/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 390482148, "node_id": "MDU6TGFiZWwzOTA0ODIxNDg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/awaiting%20review", "name": "awaiting review", "color": "fef2c0", "default": false}, {"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "qlzh727", "id": 5118881, "node_id": "MDQ6VXNlcjUxMTg4ODE=", "avatar_url": "https://avatars3.githubusercontent.com/u/5118881?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qlzh727", "html_url": "https://github.com/qlzh727", "followers_url": "https://api.github.com/users/qlzh727/followers", "following_url": "https://api.github.com/users/qlzh727/following{/other_user}", "gists_url": "https://api.github.com/users/qlzh727/gists{/gist_id}", "starred_url": "https://api.github.com/users/qlzh727/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qlzh727/subscriptions", "organizations_url": "https://api.github.com/users/qlzh727/orgs", "repos_url": "https://api.github.com/users/qlzh727/repos", "events_url": "https://api.github.com/users/qlzh727/events{/privacy}", "received_events_url": "https://api.github.com/users/qlzh727/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "qlzh727", "id": 5118881, "node_id": "MDQ6VXNlcjUxMTg4ODE=", "avatar_url": "https://avatars3.githubusercontent.com/u/5118881?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qlzh727", "html_url": "https://github.com/qlzh727", "followers_url": "https://api.github.com/users/qlzh727/followers", "following_url": "https://api.github.com/users/qlzh727/following{/other_user}", "gists_url": "https://api.github.com/users/qlzh727/gists{/gist_id}", "starred_url": "https://api.github.com/users/qlzh727/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qlzh727/subscriptions", "organizations_url": "https://api.github.com/users/qlzh727/orgs", "repos_url": "https://api.github.com/users/qlzh727/repos", "events_url": "https://api.github.com/users/qlzh727/events{/privacy}", "received_events_url": "https://api.github.com/users/qlzh727/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2018-07-12T22:27:14Z", "updated_at": "2018-11-14T21:46:23Z", "closed_at": "2018-11-14T21:46:18Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/20753", "html_url": "https://github.com/tensorflow/tensorflow/pull/20753", "diff_url": "https://github.com/tensorflow/tensorflow/pull/20753.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/20753.patch"}, "body_html": "<p>Using keras models with one dimensional output\u00a0together with the <code>tf.data.Dataset</code> API will fail due to the shape validation introduced in <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/677b4cf7539af0cf5741d12dfe7e142c586d4567/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/677b4cf7539af0cf5741d12dfe7e142c586d4567\"><tt>677b4cf</tt></a> since the dataset will have output shape <code>(None,)</code> but keras expects shape <code>(None, 1)</code>.</p>\n<p>Here is a small notebook describing the problem: <a href=\"https://colab.research.google.com/drive/1h3FUGBhVsXnj6oEE3JDnC0WRFF-Zu__c\" rel=\"nofollow\">https://colab.research.google.com/drive/1h3FUGBhVsXnj6oEE3JDnC0WRFF-Zu__c</a></p>\n<p>This PR fixes the bug by expanding the last dimension of the data tensors the same way it is done with numpy arrays. Alternatively we could loosen the input validation to account for this case.</p>\n<p>/cc <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=144114\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rohan100jain\">@rohan100jain</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=710255\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/fchollet\">@fchollet</a></p>\n<p><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #20698.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"340247849\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/20698\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/20698/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/20698\">#20698</a></p>\n<details>\n <summary><b>Traceback</b></summary>\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n in ()\n      3 \n      4 history = model.fit(dataset, epochs=300,\n----&gt; 5                     verbose=0, steps_per_epoch=len(train_data) // 32)\n<p>/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/engine/training.py in fit(self, x, y, batch_size, epochs, verbose, callbacks, validation_split, validation_data, shuffle, class_weight, sample_weight, initial_epoch, steps_per_epoch, validation_steps, **kwargs)<br>\n1261         steps_name='steps_per_epoch',<br>\n1262         steps=steps_per_epoch,<br>\n-&gt; 1263         validation_split=validation_split)<br>\n1264<br>\n1265     # Prepare validation data.</p>\n<p>/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/engine/training.py in _standardize_user_data(self, x, y, sample_weight, class_weight, batch_size, check_steps, steps_name, steps, validation_split)<br>\n905           feed_output_shapes,<br>\n906           check_batch_axis=False,  # Don't enforce the batch size.<br>\n--&gt; 907           exception_prefix='target')<br>\n908<br>\n909       # Generate sample-wise weight values given the <code>sample_weight</code> and</p>\n<p>/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/engine/training_utils.py in standardize_input_data(data, names, shapes, check_batch_axis, exception_prefix)<br>\n180                            ': expected ' + names[i] + ' to have ' +<br>\n181                            str(len(shape)) + ' dimensions, but got array '<br>\n--&gt; 182                            'with shape ' + str(data_shape))<br>\n183         if not check_batch_axis:<br>\n184           data_shape = data_shape[1:]</p>\n<p>ValueError: Error when checking target: expected dense_5 to have 2 dimensions, but got array with shape (None,)</p>\n</details>", "body_text": "Using keras models with one dimensional output\u00a0together with the tf.data.Dataset API will fail due to the shape validation introduced in 677b4cf since the dataset will have output shape (None,) but keras expects shape (None, 1).\nHere is a small notebook describing the problem: https://colab.research.google.com/drive/1h3FUGBhVsXnj6oEE3JDnC0WRFF-Zu__c\nThis PR fixes the bug by expanding the last dimension of the data tensors the same way it is done with numpy arrays. Alternatively we could loosen the input validation to account for this case.\n/cc @rohan100jain @fchollet\nFixes #20698\n\n Traceback\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n in ()\n      3 \n      4 history = model.fit(dataset, epochs=300,\n----> 5                     verbose=0, steps_per_epoch=len(train_data) // 32)\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/engine/training.py in fit(self, x, y, batch_size, epochs, verbose, callbacks, validation_split, validation_data, shuffle, class_weight, sample_weight, initial_epoch, steps_per_epoch, validation_steps, **kwargs)\n1261         steps_name='steps_per_epoch',\n1262         steps=steps_per_epoch,\n-> 1263         validation_split=validation_split)\n1264\n1265     # Prepare validation data.\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/engine/training.py in _standardize_user_data(self, x, y, sample_weight, class_weight, batch_size, check_steps, steps_name, steps, validation_split)\n905           feed_output_shapes,\n906           check_batch_axis=False,  # Don't enforce the batch size.\n--> 907           exception_prefix='target')\n908\n909       # Generate sample-wise weight values given the sample_weight and\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/engine/training_utils.py in standardize_input_data(data, names, shapes, check_batch_axis, exception_prefix)\n180                            ': expected ' + names[i] + ' to have ' +\n181                            str(len(shape)) + ' dimensions, but got array '\n--> 182                            'with shape ' + str(data_shape))\n183         if not check_batch_axis:\n184           data_shape = data_shape[1:]\nValueError: Error when checking target: expected dense_5 to have 2 dimensions, but got array with shape (None,)", "body": "Using keras models with one dimensional output\u00a0together with the `tf.data.Dataset` API will fail due to the shape validation introduced in 677b4cf7539af0cf5741d12dfe7e142c586d4567 since the dataset will have output shape `(None,)` but keras expects shape `(None, 1)`.\r\n\r\nHere is a small notebook describing the problem: https://colab.research.google.com/drive/1h3FUGBhVsXnj6oEE3JDnC0WRFF-Zu__c\r\n\r\nThis PR fixes the bug by expanding the last dimension of the data tensors the same way it is done with numpy arrays. Alternatively we could loosen the input validation to account for this case.\r\n\r\n/cc @rohan100jain @fchollet \r\n\r\nFixes #20698\r\n\r\n<details>\r\n <summary><b>Traceback</b></summary>\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-11-d79ea2a94b4d> in <module>()\r\n      3 \r\n      4 history = model.fit(dataset, epochs=300,\r\n----> 5                     verbose=0, steps_per_epoch=len(train_data) // 32)\r\n\r\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/engine/training.py in fit(self, x, y, batch_size, epochs, verbose, callbacks, validation_split, validation_data, shuffle, class_weight, sample_weight, initial_epoch, steps_per_epoch, validation_steps, **kwargs)\r\n   1261         steps_name='steps_per_epoch',\r\n   1262         steps=steps_per_epoch,\r\n-> 1263         validation_split=validation_split)\r\n   1264 \r\n   1265     # Prepare validation data.\r\n\r\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/engine/training.py in _standardize_user_data(self, x, y, sample_weight, class_weight, batch_size, check_steps, steps_name, steps, validation_split)\r\n    905           feed_output_shapes,\r\n    906           check_batch_axis=False,  # Don't enforce the batch size.\r\n--> 907           exception_prefix='target')\r\n    908 \r\n    909       # Generate sample-wise weight values given the `sample_weight` and\r\n\r\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/engine/training_utils.py in standardize_input_data(data, names, shapes, check_batch_axis, exception_prefix)\r\n    180                            ': expected ' + names[i] + ' to have ' +\r\n    181                            str(len(shape)) + ' dimensions, but got array '\r\n--> 182                            'with shape ' + str(data_shape))\r\n    183         if not check_batch_axis:\r\n    184           data_shape = data_shape[1:]\r\n\r\nValueError: Error when checking target: expected dense_5 to have 2 dimensions, but got array with shape (None,)\r\n</details>"}