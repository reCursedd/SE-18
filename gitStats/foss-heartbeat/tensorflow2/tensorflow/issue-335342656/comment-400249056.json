{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/400249056", "html_url": "https://github.com/tensorflow/tensorflow/issues/20272#issuecomment-400249056", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20272", "id": 400249056, "node_id": "MDEyOklzc3VlQ29tbWVudDQwMDI0OTA1Ng==", "user": {"login": "duplex143", "id": 24863030, "node_id": "MDQ6VXNlcjI0ODYzMDMw", "avatar_url": "https://avatars2.githubusercontent.com/u/24863030?v=4", "gravatar_id": "", "url": "https://api.github.com/users/duplex143", "html_url": "https://github.com/duplex143", "followers_url": "https://api.github.com/users/duplex143/followers", "following_url": "https://api.github.com/users/duplex143/following{/other_user}", "gists_url": "https://api.github.com/users/duplex143/gists{/gist_id}", "starred_url": "https://api.github.com/users/duplex143/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/duplex143/subscriptions", "organizations_url": "https://api.github.com/users/duplex143/orgs", "repos_url": "https://api.github.com/users/duplex143/repos", "events_url": "https://api.github.com/users/duplex143/events{/privacy}", "received_events_url": "https://api.github.com/users/duplex143/received_events", "type": "User", "site_admin": false}, "created_at": "2018-06-26T09:48:44Z", "updated_at": "2018-06-26T10:19:22Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1450614\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/suharshs\">@suharshs</a> I'm getting <code>-bash: ./bazel-bin/third_party/tensorflow/contrib/lite/toco/toco: No such file or directory</code> when I'm running the above command. So, I executed</p>\n<pre><code>bazel run --config=opt //tensorflow/contrib/lite/toco:toco \\\n  -- --input_file=retrained_graph_mobilenet_q_1_224.pb \\\n :\n :\n :\n</code></pre>\n<p>and the output is</p>\n<pre><code>2018-06-26 14:55:18.787325: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.789699: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.790247: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.790699: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.790985: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.791253: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.791542: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.791815: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.791967: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.792026: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.795307: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before Removing unused ops: 144 operators, 237 arrays (0 quantized)\n2018-06-26 14:55:18.798708: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before general graph transformations: 144 operators, 237 arrays (0 quantized)\n2018-06-26 14:55:18.801078: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After general graph transformations pass 1: 64 operators, 155 arrays (1 quantized)\n2018-06-26 14:55:18.802208: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After general graph transformations pass 2: 63 operators, 153 arrays (1 quantized)\n2018-06-26 14:55:18.803271: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After general graph transformations pass 3: 62 operators, 151 arrays (1 quantized)\n2018-06-26 14:55:18.804424: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before pre-quantization graph transformations: 62 operators, 151 arrays (1 quantized)\n2018-06-26 14:55:18.805219: F tensorflow/contrib/lite/toco/tooling_util.cc:1588] Array MobilenetV1/MobilenetV1/Conv2d_0/Relu6, which is an input to the DepthwiseConv operator producing the output array MobilenetV1/MobilenetV1/Conv2d_1_depthwise/Relu6, is lacking min/max data, which is necessary for quantization. Either target a non-quantized output format, or change the input graph to contain min/max information, or pass --default_ranges_min= and --default_ranges_max= if you do not care about the accuracy of results.\n</code></pre>\n<p>So, I added <code>'--default_ranges_min=0' '--default_ranges_max=6'</code> and the output is the following in place of the last line of above output</p>\n<pre><code>2018-06-26 15:08:24.056119: F tensorflow/contrib/lite/toco/graph_transformations/quantize.cc:456] Unimplemented: this graph contains an operator of type (Unsupported TensorFlow op: Dequantize) for which the quantized form is not yet implemented. Sorry, and patches welcome (that's a relatively fun patch to write, mostly providing the actual quantized arithmetic code for this op).\n</code></pre>\n<p>So, it boils down to implementing the custom op <code>Dequantize </code> I suppose.<br>\nSee <a href=\"https://github.com/tensorflow/tensorflow/issues/14606\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/14606/hovercard\">this</a>. Also, <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=25754898\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/andrehentz\">@andrehentz</a> said <a href=\"https://github.com/tensorflow/tensorflow/issues/15122#issuecomment-363126160\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/15122/hovercard\">here</a> that the following command works for converting .pb to .tflite</p>\n<pre><code>tensorflow/bazel-bin/tensorflow/contrib/lite/toco/toco \\                                           \n  --input_file=$TRAINING_DIR/retrained_graph.pb \\                                                  \n  --input_format=TENSORFLOW_GRAPHDEF \\                                                             \n  --output_format=TFLITE \\                                                                         \n  --output_file=/$TRAINING_DIR/${ARCHITECTURE}.tflite \\                                            \n  --inference_type=QUANTIZED_UINT8 \\                                                               \n  --input_array=Placeholder \\                                                                      \n  --output_array=final_result \\                                                                    \n  --input_shape=1,224,224,3 \\                                                                      \n  --mean_value=128 \\                                                                               \n  --std_value=128\n</code></pre>\n<p>But even for above command, I'm getting the same <code>Dequantize</code> error. Maybe toco changed after Feb 5?</p>", "body_text": "@suharshs I'm getting -bash: ./bazel-bin/third_party/tensorflow/contrib/lite/toco/toco: No such file or directory when I'm running the above command. So, I executed\nbazel run --config=opt //tensorflow/contrib/lite/toco:toco \\\n  -- --input_file=retrained_graph_mobilenet_q_1_224.pb \\\n :\n :\n :\n\nand the output is\n2018-06-26 14:55:18.787325: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.789699: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.790247: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.790699: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.790985: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.791253: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.791542: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.791815: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.791967: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.792026: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\n2018-06-26 14:55:18.795307: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before Removing unused ops: 144 operators, 237 arrays (0 quantized)\n2018-06-26 14:55:18.798708: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before general graph transformations: 144 operators, 237 arrays (0 quantized)\n2018-06-26 14:55:18.801078: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After general graph transformations pass 1: 64 operators, 155 arrays (1 quantized)\n2018-06-26 14:55:18.802208: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After general graph transformations pass 2: 63 operators, 153 arrays (1 quantized)\n2018-06-26 14:55:18.803271: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After general graph transformations pass 3: 62 operators, 151 arrays (1 quantized)\n2018-06-26 14:55:18.804424: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before pre-quantization graph transformations: 62 operators, 151 arrays (1 quantized)\n2018-06-26 14:55:18.805219: F tensorflow/contrib/lite/toco/tooling_util.cc:1588] Array MobilenetV1/MobilenetV1/Conv2d_0/Relu6, which is an input to the DepthwiseConv operator producing the output array MobilenetV1/MobilenetV1/Conv2d_1_depthwise/Relu6, is lacking min/max data, which is necessary for quantization. Either target a non-quantized output format, or change the input graph to contain min/max information, or pass --default_ranges_min= and --default_ranges_max= if you do not care about the accuracy of results.\n\nSo, I added '--default_ranges_min=0' '--default_ranges_max=6' and the output is the following in place of the last line of above output\n2018-06-26 15:08:24.056119: F tensorflow/contrib/lite/toco/graph_transformations/quantize.cc:456] Unimplemented: this graph contains an operator of type (Unsupported TensorFlow op: Dequantize) for which the quantized form is not yet implemented. Sorry, and patches welcome (that's a relatively fun patch to write, mostly providing the actual quantized arithmetic code for this op).\n\nSo, it boils down to implementing the custom op Dequantize  I suppose.\nSee this. Also, @andrehentz said here that the following command works for converting .pb to .tflite\ntensorflow/bazel-bin/tensorflow/contrib/lite/toco/toco \\                                           \n  --input_file=$TRAINING_DIR/retrained_graph.pb \\                                                  \n  --input_format=TENSORFLOW_GRAPHDEF \\                                                             \n  --output_format=TFLITE \\                                                                         \n  --output_file=/$TRAINING_DIR/${ARCHITECTURE}.tflite \\                                            \n  --inference_type=QUANTIZED_UINT8 \\                                                               \n  --input_array=Placeholder \\                                                                      \n  --output_array=final_result \\                                                                    \n  --input_shape=1,224,224,3 \\                                                                      \n  --mean_value=128 \\                                                                               \n  --std_value=128\n\nBut even for above command, I'm getting the same Dequantize error. Maybe toco changed after Feb 5?", "body": "@suharshs I'm getting `-bash: ./bazel-bin/third_party/tensorflow/contrib/lite/toco/toco: No such file or directory` when I'm running the above command. So, I executed\r\n```\r\nbazel run --config=opt //tensorflow/contrib/lite/toco:toco \\\r\n  -- --input_file=retrained_graph_mobilenet_q_1_224.pb \\\r\n :\r\n :\r\n :\r\n```\r\nand the output is \r\n```\r\n2018-06-26 14:55:18.787325: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\r\n2018-06-26 14:55:18.789699: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\r\n2018-06-26 14:55:18.790247: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\r\n2018-06-26 14:55:18.790699: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\r\n2018-06-26 14:55:18.790985: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\r\n2018-06-26 14:55:18.791253: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\r\n2018-06-26 14:55:18.791542: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\r\n2018-06-26 14:55:18.791815: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\r\n2018-06-26 14:55:18.791967: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\r\n2018-06-26 14:55:18.792026: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Dequantize\r\n2018-06-26 14:55:18.795307: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before Removing unused ops: 144 operators, 237 arrays (0 quantized)\r\n2018-06-26 14:55:18.798708: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before general graph transformations: 144 operators, 237 arrays (0 quantized)\r\n2018-06-26 14:55:18.801078: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After general graph transformations pass 1: 64 operators, 155 arrays (1 quantized)\r\n2018-06-26 14:55:18.802208: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After general graph transformations pass 2: 63 operators, 153 arrays (1 quantized)\r\n2018-06-26 14:55:18.803271: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After general graph transformations pass 3: 62 operators, 151 arrays (1 quantized)\r\n2018-06-26 14:55:18.804424: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before pre-quantization graph transformations: 62 operators, 151 arrays (1 quantized)\r\n2018-06-26 14:55:18.805219: F tensorflow/contrib/lite/toco/tooling_util.cc:1588] Array MobilenetV1/MobilenetV1/Conv2d_0/Relu6, which is an input to the DepthwiseConv operator producing the output array MobilenetV1/MobilenetV1/Conv2d_1_depthwise/Relu6, is lacking min/max data, which is necessary for quantization. Either target a non-quantized output format, or change the input graph to contain min/max information, or pass --default_ranges_min= and --default_ranges_max= if you do not care about the accuracy of results.\r\n```\r\nSo, I added `'--default_ranges_min=0' '--default_ranges_max=6'` and the output is the following in place of the last line of above output\r\n```\r\n2018-06-26 15:08:24.056119: F tensorflow/contrib/lite/toco/graph_transformations/quantize.cc:456] Unimplemented: this graph contains an operator of type (Unsupported TensorFlow op: Dequantize) for which the quantized form is not yet implemented. Sorry, and patches welcome (that's a relatively fun patch to write, mostly providing the actual quantized arithmetic code for this op).\r\n```\r\nSo, it boils down to implementing the custom op `Dequantize ` I suppose.\r\nSee [this](https://github.com/tensorflow/tensorflow/issues/14606). Also, @andrehentz said [here](https://github.com/tensorflow/tensorflow/issues/15122#issuecomment-363126160) that the following command works for converting .pb to .tflite\r\n```\r\ntensorflow/bazel-bin/tensorflow/contrib/lite/toco/toco \\                                           \r\n  --input_file=$TRAINING_DIR/retrained_graph.pb \\                                                  \r\n  --input_format=TENSORFLOW_GRAPHDEF \\                                                             \r\n  --output_format=TFLITE \\                                                                         \r\n  --output_file=/$TRAINING_DIR/${ARCHITECTURE}.tflite \\                                            \r\n  --inference_type=QUANTIZED_UINT8 \\                                                               \r\n  --input_array=Placeholder \\                                                                      \r\n  --output_array=final_result \\                                                                    \r\n  --input_shape=1,224,224,3 \\                                                                      \r\n  --mean_value=128 \\                                                                               \r\n  --std_value=128\r\n```\r\nBut even for above command, I'm getting the same `Dequantize` error. Maybe toco changed after Feb 5?"}