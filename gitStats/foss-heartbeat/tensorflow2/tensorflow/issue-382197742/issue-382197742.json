{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23853", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23853/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23853/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23853/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23853", "id": 382197742, "node_id": "MDU6SXNzdWUzODIxOTc3NDI=", "number": 23853, "title": "Graph optimized using tf.contrib.tensorrt is not loadable with TF_GraphImportGraphDef", "user": {"login": "yegord", "id": 1595829, "node_id": "MDQ6VXNlcjE1OTU4Mjk=", "avatar_url": "https://avatars1.githubusercontent.com/u/1595829?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yegord", "html_url": "https://github.com/yegord", "followers_url": "https://api.github.com/users/yegord/followers", "following_url": "https://api.github.com/users/yegord/following{/other_user}", "gists_url": "https://api.github.com/users/yegord/gists{/gist_id}", "starred_url": "https://api.github.com/users/yegord/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yegord/subscriptions", "organizations_url": "https://api.github.com/users/yegord/orgs", "repos_url": "https://api.github.com/users/yegord/repos", "events_url": "https://api.github.com/users/yegord/events{/privacy}", "received_events_url": "https://api.github.com/users/yegord/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-11-19T12:42:38Z", "updated_at": "2018-11-19T12:42:38Z", "closed_at": null, "author_association": "CONTRIBUTOR", "body_html": "<p><strong>System information</strong></p>\n<ul>\n<li>\n<p>Have I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes.</p>\n</li>\n<li>\n<p>OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 16.04</p>\n</li>\n<li>\n<p>Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:</p>\n</li>\n<li>\n<p>TensorFlow installed from (source or binary): Source.</p>\n</li>\n<li>\n<p>TensorFlow version (use command below): v1.12</p>\n</li>\n<li>\n<p>Python version: 2.7.12</p>\n</li>\n<li>\n<p>Bazel version (if compiling from source): 0.19.0</p>\n</li>\n<li>\n<p>GCC/Compiler version (if compiling from source): 5.4.0</p>\n</li>\n<li>\n<p>CUDA/cuDNN version: 9.0/7.0.5</p>\n</li>\n<li>\n<p>GPU model and memory: 1080 Ti</p>\n</li>\n</ul>\n<p><strong>Describe the current behavior</strong></p>\n<p>I optimize a TensorFlow graph with</p>\n<pre><code>    precision_mode = 'FP32'  # \"FP32\",\"FP16\" or \"INT8\"\n    graph_def = trt.create_inference_graph(\n        input_graph_def=graph_def,\n        outputs=output_node_names,\n        max_batch_size=num_cameras,\n        max_workspace_size_bytes=4*10**9,\n        precision_mode=precision_mode,\n        minimum_segment_size=10,  # minimum number of nodes in an engine,\n    )\n</code></pre>\n<p>, save the resulting graph, and try to load it in a C++ program using C API.</p>\n<p>First, I call</p>\n<pre><code>TF_LoadLibrary(\"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/tensorrt/python/ops/_trt_engine_op.so\", status)\n</code></pre>\n<p>and call <code>TF_GraphImportGraphDef</code> with the optimized graph.</p>\n<p>I get the following error:</p>\n<pre><code>TF_GraphImportGraphDef: No shape inference function exists for op 'TRTEngineOp', did you forget to define it?\n</code></pre>\n<p><strong>Describe the expected behavior</strong></p>\n<p>The call to <code>TF_GraphImportGraphDef</code> must succeed.</p>\n<p><strong>Code to reproduce the issue</strong></p>\n<p>It seems that the issue, although not in the bug tracker, should be already known to the authors: <a href=\"https://github.com/tensorflow/tensorflow/blob/v1.12.0/tensorflow/contrib/tensorrt/ops/trt_engine_op.cc#L46\">https://github.com/tensorflow/tensorflow/blob/v1.12.0/tensorflow/contrib/tensorrt/ops/trt_engine_op.cc#L46</a><br>\nHowever, I can make a minimal example to reproduce the problem on demand.</p>\n<p><strong>Other info / logs</strong></p>\n<p>It is a pain that a TRT-optimized graph cannot be used outside of python now.<br>\nI would be happy to know about a workaround, in case one exists.</p>", "body_text": "System information\n\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes.\n\n\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 16.04\n\n\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:\n\n\nTensorFlow installed from (source or binary): Source.\n\n\nTensorFlow version (use command below): v1.12\n\n\nPython version: 2.7.12\n\n\nBazel version (if compiling from source): 0.19.0\n\n\nGCC/Compiler version (if compiling from source): 5.4.0\n\n\nCUDA/cuDNN version: 9.0/7.0.5\n\n\nGPU model and memory: 1080 Ti\n\n\nDescribe the current behavior\nI optimize a TensorFlow graph with\n    precision_mode = 'FP32'  # \"FP32\",\"FP16\" or \"INT8\"\n    graph_def = trt.create_inference_graph(\n        input_graph_def=graph_def,\n        outputs=output_node_names,\n        max_batch_size=num_cameras,\n        max_workspace_size_bytes=4*10**9,\n        precision_mode=precision_mode,\n        minimum_segment_size=10,  # minimum number of nodes in an engine,\n    )\n\n, save the resulting graph, and try to load it in a C++ program using C API.\nFirst, I call\nTF_LoadLibrary(\"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/tensorrt/python/ops/_trt_engine_op.so\", status)\n\nand call TF_GraphImportGraphDef with the optimized graph.\nI get the following error:\nTF_GraphImportGraphDef: No shape inference function exists for op 'TRTEngineOp', did you forget to define it?\n\nDescribe the expected behavior\nThe call to TF_GraphImportGraphDef must succeed.\nCode to reproduce the issue\nIt seems that the issue, although not in the bug tracker, should be already known to the authors: https://github.com/tensorflow/tensorflow/blob/v1.12.0/tensorflow/contrib/tensorrt/ops/trt_engine_op.cc#L46\nHowever, I can make a minimal example to reproduce the problem on demand.\nOther info / logs\nIt is a pain that a TRT-optimized graph cannot be used outside of python now.\nI would be happy to know about a workaround, in case one exists.", "body": "**System information**\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes.\r\n\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 16.04\r\n\r\n- Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:\r\n- TensorFlow installed from (source or binary): Source.\r\n- TensorFlow version (use command below): v1.12\r\n- Python version: 2.7.12\r\n\r\n- Bazel version (if compiling from source): 0.19.0\r\n- GCC/Compiler version (if compiling from source): 5.4.0\r\n- CUDA/cuDNN version: 9.0/7.0.5\r\n- GPU model and memory: 1080 Ti\r\n\r\n**Describe the current behavior**\r\n\r\nI optimize a TensorFlow graph with\r\n```\r\n    precision_mode = 'FP32'  # \"FP32\",\"FP16\" or \"INT8\"\r\n    graph_def = trt.create_inference_graph(\r\n        input_graph_def=graph_def,\r\n        outputs=output_node_names,\r\n        max_batch_size=num_cameras,\r\n        max_workspace_size_bytes=4*10**9,\r\n        precision_mode=precision_mode,\r\n        minimum_segment_size=10,  # minimum number of nodes in an engine,\r\n    )\r\n```\r\n\r\n, save the resulting graph, and try to load it in a C++ program using C API.\r\n\r\nFirst, I call\r\n\r\n```\r\nTF_LoadLibrary(\"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/tensorrt/python/ops/_trt_engine_op.so\", status)\r\n```\r\n\r\nand call `TF_GraphImportGraphDef` with the optimized graph.\r\n\r\nI get the following error:\r\n\r\n```\r\nTF_GraphImportGraphDef: No shape inference function exists for op 'TRTEngineOp', did you forget to define it?\r\n```\r\n\r\n**Describe the expected behavior**\r\n\r\nThe call to `TF_GraphImportGraphDef` must succeed.\r\n\r\n**Code to reproduce the issue**\r\n\r\nIt seems that the issue, although not in the bug tracker, should be already known to the authors: https://github.com/tensorflow/tensorflow/blob/v1.12.0/tensorflow/contrib/tensorrt/ops/trt_engine_op.cc#L46\r\nHowever, I can make a minimal example to reproduce the problem on demand.\r\n\r\n**Other info / logs**\r\n\r\nIt is a pain that a TRT-optimized graph cannot be used outside of python now.\r\nI would be happy to know about a workaround, in case one exists.\r\n"}