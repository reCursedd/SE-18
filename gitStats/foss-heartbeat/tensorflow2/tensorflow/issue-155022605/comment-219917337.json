{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/219917337", "html_url": "https://github.com/tensorflow/tensorflow/issues/2386#issuecomment-219917337", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2386", "id": 219917337, "node_id": "MDEyOklzc3VlQ29tbWVudDIxOTkxNzMzNw==", "user": {"login": "smartcat2010", "id": 10429114, "node_id": "MDQ6VXNlcjEwNDI5MTE0", "avatar_url": "https://avatars1.githubusercontent.com/u/10429114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/smartcat2010", "html_url": "https://github.com/smartcat2010", "followers_url": "https://api.github.com/users/smartcat2010/followers", "following_url": "https://api.github.com/users/smartcat2010/following{/other_user}", "gists_url": "https://api.github.com/users/smartcat2010/gists{/gist_id}", "starred_url": "https://api.github.com/users/smartcat2010/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/smartcat2010/subscriptions", "organizations_url": "https://api.github.com/users/smartcat2010/orgs", "repos_url": "https://api.github.com/users/smartcat2010/repos", "events_url": "https://api.github.com/users/smartcat2010/events{/privacy}", "received_events_url": "https://api.github.com/users/smartcat2010/received_events", "type": "User", "site_admin": false}, "created_at": "2016-05-18T03:38:54Z", "updated_at": "2016-05-18T05:04:20Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=15792374\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jmchen-g\">@jmchen-g</a><br>\nThanks a lot for your help! I turn to <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/training/sync_replicas_optimizer.py\">sync_replicas_optimizer.py</a> and follow the \"Usage\". In order to simplify the code for you to see, I just use <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/tutorials/mnist/mnist_softmax.py\">mnist_softmax.py</a> as example and chane input from file data to random data.</p>\n<p>I start 1 ps and 2 workers in the same machine(it has 4 GPU cards). The worker 0 runs smoothly and print out many lines of \"accuracy=XXX\" as expected. But the worker 1 is crashed with the following error:</p>\n<p><code>I tensorflow/core/common_runtime/gpu/gpu_device.cc:755] Creating TensorFlow device (/gpu:0) -&gt; (device: 0, name: Tesla K40c, pci bus id: 0000:02:00.0) I tensorflow/core/common_runtime/gpu/gpu_device.cc:755] Creating TensorFlow device (/gpu:1) -&gt; (device: 1, name: Tesla K40c, pci bus id: 0000:04:00.0) I tensorflow/core/common_runtime/gpu/gpu_device.cc:755] Creating TensorFlow device (/gpu:2) -&gt; (device: 2, name: Tesla K40c, pci bus id: 0000:84:00.0) I tensorflow/core/common_runtime/gpu/gpu_device.cc:755] Creating TensorFlow device (/gpu:3) -&gt; (device: 3, name: Tesla K40c, pci bus id: 0000:85:00.0) I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:206] Initialize HostPortsGrpcChannelCache for job ps -&gt; {10.141.33.61:2222} I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:206] Initialize HostPortsGrpcChannelCache for job worker -&gt; {10.141.33.61:2223, localhost:2224} I tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:202] Started server with target: grpc://localhost:2224 Traceback (most recent call last): File \"./mnist_softmax.py\", line 87, in &lt;module&gt; tf.app.run() File \"/usr/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 30, in run sys.exit(main(sys.argv)) File \"./mnist_softmax.py\", line 84, in main run_training(server, cluster) File \"./mnist_softmax.py\", line 72, in run_training _, cost, acc, step = sess.run([train_step, cross_entropy, accuracy, global_step], feed_dict = { x: source_data, y_ : labels_one_hot }) File \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 340, in run run_metadata_ptr) File \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 564, in _run feed_dict_string, options, run_metadata) File \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 637, in _do_run target_list, options, run_metadata) File \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 659, in _do_call e.code) tensorflow.python.framework.errors.InternalError: No worker known as /job:worker/replica:0/task:1 [[Node: sync_replicas/cond/switch_f_S24 = _Recv[client_terminated=false, recv_device=\"/job:ps/replica:0/task:0/cpu:0\", send_device=\"/job:worker/replica:0/task:1/gpu:1\", send_device_incarnation=-240247217847712065, tensor_name=\"edge_42_sync_replicas/cond/switch_f\", tensor_type=DT_FLOAT, _device=\"/job:ps/replica:0/task:0/cpu:0\"]()]] </code></p>\n<p>The command line of worker1:<br>\n<code>python ./mnist_softmax.py --ps_hosts=10.141.33.61:2222 --worker_hosts=10.141.33.61:2223,10.141.33.61:2224 --job_name=worker --task_index=1 --gpu_cards=2</code></p>\n<p>All of my code:</p>\n<p><a href=\"https://github.com/tensorflow/tensorflow/files/269622/mnist_softmax_Sync.py.txt\">mnist_softmax_Sync.py.txt</a></p>", "body_text": "@jmchen-g\nThanks a lot for your help! I turn to sync_replicas_optimizer.py and follow the \"Usage\". In order to simplify the code for you to see, I just use mnist_softmax.py as example and chane input from file data to random data.\nI start 1 ps and 2 workers in the same machine(it has 4 GPU cards). The worker 0 runs smoothly and print out many lines of \"accuracy=XXX\" as expected. But the worker 1 is crashed with the following error:\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:755] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Tesla K40c, pci bus id: 0000:02:00.0) I tensorflow/core/common_runtime/gpu/gpu_device.cc:755] Creating TensorFlow device (/gpu:1) -> (device: 1, name: Tesla K40c, pci bus id: 0000:04:00.0) I tensorflow/core/common_runtime/gpu/gpu_device.cc:755] Creating TensorFlow device (/gpu:2) -> (device: 2, name: Tesla K40c, pci bus id: 0000:84:00.0) I tensorflow/core/common_runtime/gpu/gpu_device.cc:755] Creating TensorFlow device (/gpu:3) -> (device: 3, name: Tesla K40c, pci bus id: 0000:85:00.0) I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:206] Initialize HostPortsGrpcChannelCache for job ps -> {10.141.33.61:2222} I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:206] Initialize HostPortsGrpcChannelCache for job worker -> {10.141.33.61:2223, localhost:2224} I tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:202] Started server with target: grpc://localhost:2224 Traceback (most recent call last): File \"./mnist_softmax.py\", line 87, in <module> tf.app.run() File \"/usr/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 30, in run sys.exit(main(sys.argv)) File \"./mnist_softmax.py\", line 84, in main run_training(server, cluster) File \"./mnist_softmax.py\", line 72, in run_training _, cost, acc, step = sess.run([train_step, cross_entropy, accuracy, global_step], feed_dict = { x: source_data, y_ : labels_one_hot }) File \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 340, in run run_metadata_ptr) File \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 564, in _run feed_dict_string, options, run_metadata) File \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 637, in _do_run target_list, options, run_metadata) File \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 659, in _do_call e.code) tensorflow.python.framework.errors.InternalError: No worker known as /job:worker/replica:0/task:1 [[Node: sync_replicas/cond/switch_f_S24 = _Recv[client_terminated=false, recv_device=\"/job:ps/replica:0/task:0/cpu:0\", send_device=\"/job:worker/replica:0/task:1/gpu:1\", send_device_incarnation=-240247217847712065, tensor_name=\"edge_42_sync_replicas/cond/switch_f\", tensor_type=DT_FLOAT, _device=\"/job:ps/replica:0/task:0/cpu:0\"]()]] \nThe command line of worker1:\npython ./mnist_softmax.py --ps_hosts=10.141.33.61:2222 --worker_hosts=10.141.33.61:2223,10.141.33.61:2224 --job_name=worker --task_index=1 --gpu_cards=2\nAll of my code:\nmnist_softmax_Sync.py.txt", "body": "@jmchen-g \nThanks a lot for your help! I turn to [sync_replicas_optimizer.py](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/training/sync_replicas_optimizer.py) and follow the \"Usage\". In order to simplify the code for you to see, I just use [mnist_softmax.py](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/tutorials/mnist/mnist_softmax.py) as example and chane input from file data to random data. \n\nI start 1 ps and 2 workers in the same machine(it has 4 GPU cards). The worker 0 runs smoothly and print out many lines of \"accuracy=XXX\" as expected. But the worker 1 is crashed with the following error:\n\n`I tensorflow/core/common_runtime/gpu/gpu_device.cc:755] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Tesla K40c, pci bus id: 0000:02:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:755] Creating TensorFlow device (/gpu:1) -> (device: 1, name: Tesla K40c, pci bus id: 0000:04:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:755] Creating TensorFlow device (/gpu:2) -> (device: 2, name: Tesla K40c, pci bus id: 0000:84:00.0)\nI tensorflow/core/common_runtime/gpu/gpu_device.cc:755] Creating TensorFlow device (/gpu:3) -> (device: 3, name: Tesla K40c, pci bus id: 0000:85:00.0)\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:206] Initialize HostPortsGrpcChannelCache for job ps -> {10.141.33.61:2222}\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:206] Initialize HostPortsGrpcChannelCache for job worker -> {10.141.33.61:2223, localhost:2224}\nI tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:202] Started server with target: grpc://localhost:2224\nTraceback (most recent call last):\n  File \"./mnist_softmax.py\", line 87, in <module>\n    tf.app.run()\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv))\n  File \"./mnist_softmax.py\", line 84, in main\n    run_training(server, cluster)\n  File \"./mnist_softmax.py\", line 72, in run_training\n    _, cost, acc, step = sess.run([train_step, cross_entropy, accuracy, global_step], feed_dict = { x: source_data, y_ : labels_one_hot })\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 340, in run\n    run_metadata_ptr)\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 564, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 637, in _do_run\n    target_list, options, run_metadata)\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 659, in _do_call\n    e.code)\ntensorflow.python.framework.errors.InternalError: No worker known as /job:worker/replica:0/task:1\n     [[Node: sync_replicas/cond/switch_f_S24 = _Recv[client_terminated=false, recv_device=\"/job:ps/replica:0/task:0/cpu:0\", send_device=\"/job:worker/replica:0/task:1/gpu:1\", send_device_incarnation=-240247217847712065, tensor_name=\"edge_42_sync_replicas/cond/switch_f\", tensor_type=DT_FLOAT, _device=\"/job:ps/replica:0/task:0/cpu:0\"]()]]\n`\n\nThe command line of worker1:\n`python ./mnist_softmax.py --ps_hosts=10.141.33.61:2222 --worker_hosts=10.141.33.61:2223,10.141.33.61:2224 --job_name=worker --task_index=1 --gpu_cards=2`\n\nAll of my code:\n\n[mnist_softmax_Sync.py.txt](https://github.com/tensorflow/tensorflow/files/269622/mnist_softmax_Sync.py.txt)\n"}