{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/389637718", "html_url": "https://github.com/tensorflow/tensorflow/issues/19298#issuecomment-389637718", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19298", "id": 389637718, "node_id": "MDEyOklzc3VlQ29tbWVudDM4OTYzNzcxOA==", "user": {"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}, "created_at": "2018-05-16T19:28:25Z", "updated_at": "2018-05-16T19:28:25Z", "author_association": "MEMBER", "body_html": "<p>Thanks for the report. I'm not familiar with Scala or sbt enough, so I apologize for any ignorance demonstrated below.</p>\n<p>If I'm reading <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"319144779\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/spotify/scio/issues/1137\" data-hovercard-type=\"issue\" data-hovercard-url=\"/spotify/scio/issues/1137/hovercard?comment_id=387801270&amp;comment_type=issue_comment\" href=\"https://github.com/spotify/scio/issues/1137#issuecomment-387801270\">spotify/scio#1137 (comment)</a> right, it seems that the problem is that when the test is running in the same JVM as <code>sbt</code> (i.e., when <code>fork := true</code> is not set), then <code>org.tensorflow.NativeLibrary</code> is unable to correctly determine whether or not the shared library has already been loaded and ends up extracting the shared library to another location and loading it again, leading to the initialization conflict.</p>\n<p>Resolving  <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"313100268\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/18397\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/18397/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/18397\">#18397</a> would help with that, but it seems the underlying issue in this particular case is that <code>org.tensorflow.NativeLibrary.isLoaded()</code> isn't able to handle however <code>sbt</code> is managing class loading.</p>\n<p>I'll try to look into it, but any suggestions for a better implementation of <a href=\"https://github.com/tensorflow/tensorflow/blob/3176ba990070cdde62b7cdf81747d70107d2e032/tensorflow/java/src/main/java/org/tensorflow/NativeLibrary.java#L119\"><code>isLoaded</code></a> will be greatly appreciated.</p>", "body_text": "Thanks for the report. I'm not familiar with Scala or sbt enough, so I apologize for any ignorance demonstrated below.\nIf I'm reading spotify/scio#1137 (comment) right, it seems that the problem is that when the test is running in the same JVM as sbt (i.e., when fork := true is not set), then org.tensorflow.NativeLibrary is unable to correctly determine whether or not the shared library has already been loaded and ends up extracting the shared library to another location and loading it again, leading to the initialization conflict.\nResolving  #18397 would help with that, but it seems the underlying issue in this particular case is that org.tensorflow.NativeLibrary.isLoaded() isn't able to handle however sbt is managing class loading.\nI'll try to look into it, but any suggestions for a better implementation of isLoaded will be greatly appreciated.", "body": "Thanks for the report. I'm not familiar with Scala or sbt enough, so I apologize for any ignorance demonstrated below.\r\n\r\nIf I'm reading https://github.com/spotify/scio/issues/1137#issuecomment-387801270 right, it seems that the problem is that when the test is running in the same JVM as `sbt` (i.e., when `fork := true` is not set), then `org.tensorflow.NativeLibrary` is unable to correctly determine whether or not the shared library has already been loaded and ends up extracting the shared library to another location and loading it again, leading to the initialization conflict.\r\n\r\nResolving  #18397 would help with that, but it seems the underlying issue in this particular case is that `org.tensorflow.NativeLibrary.isLoaded()` isn't able to handle however `sbt` is managing class loading. \r\n\r\nI'll try to look into it, but any suggestions for a better implementation of [`isLoaded`](https://github.com/tensorflow/tensorflow/blob/3176ba990070cdde62b7cdf81747d70107d2e032/tensorflow/java/src/main/java/org/tensorflow/NativeLibrary.java#L119) will be greatly appreciated.\r\n"}