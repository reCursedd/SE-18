{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9441", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9441/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9441/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9441/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/9441", "id": 224182560, "node_id": "MDU6SXNzdWUyMjQxODI1NjA=", "number": 9441, "title": "Non deterministic behaviour of tf.train.batch in case the number of threads is higher than 1.", "user": {"login": "Netzeband", "id": 26524132, "node_id": "MDQ6VXNlcjI2NTI0MTMy", "avatar_url": "https://avatars2.githubusercontent.com/u/26524132?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Netzeband", "html_url": "https://github.com/Netzeband", "followers_url": "https://api.github.com/users/Netzeband/followers", "following_url": "https://api.github.com/users/Netzeband/following{/other_user}", "gists_url": "https://api.github.com/users/Netzeband/gists{/gist_id}", "starred_url": "https://api.github.com/users/Netzeband/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Netzeband/subscriptions", "organizations_url": "https://api.github.com/users/Netzeband/orgs", "repos_url": "https://api.github.com/users/Netzeband/repos", "events_url": "https://api.github.com/users/Netzeband/events{/privacy}", "received_events_url": "https://api.github.com/users/Netzeband/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 284443156, "node_id": "MDU6TGFiZWwyODQ0NDMxNTY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:docs", "name": "type:docs", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "girving", "id": 70511, "node_id": "MDQ6VXNlcjcwNTEx", "avatar_url": "https://avatars1.githubusercontent.com/u/70511?v=4", "gravatar_id": "", "url": "https://api.github.com/users/girving", "html_url": "https://github.com/girving", "followers_url": "https://api.github.com/users/girving/followers", "following_url": "https://api.github.com/users/girving/following{/other_user}", "gists_url": "https://api.github.com/users/girving/gists{/gist_id}", "starred_url": "https://api.github.com/users/girving/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/girving/subscriptions", "organizations_url": "https://api.github.com/users/girving/orgs", "repos_url": "https://api.github.com/users/girving/repos", "events_url": "https://api.github.com/users/girving/events{/privacy}", "received_events_url": "https://api.github.com/users/girving/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "girving", "id": 70511, "node_id": "MDQ6VXNlcjcwNTEx", "avatar_url": "https://avatars1.githubusercontent.com/u/70511?v=4", "gravatar_id": "", "url": "https://api.github.com/users/girving", "html_url": "https://github.com/girving", "followers_url": "https://api.github.com/users/girving/followers", "following_url": "https://api.github.com/users/girving/following{/other_user}", "gists_url": "https://api.github.com/users/girving/gists{/gist_id}", "starred_url": "https://api.github.com/users/girving/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/girving/subscriptions", "organizations_url": "https://api.github.com/users/girving/orgs", "repos_url": "https://api.github.com/users/girving/repos", "events_url": "https://api.github.com/users/girving/events{/privacy}", "received_events_url": "https://api.github.com/users/girving/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2017-04-25T15:38:51Z", "updated_at": "2017-05-01T16:22:27Z", "closed_at": "2017-05-01T16:22:27Z", "author_association": "CONTRIBUTOR", "body_html": "<p>This is related to the StackOverflow question: <a href=\"http://stackoverflow.com/questions/43612366/tf-train-batch-output-is-not-deterministic/43613376#43613376\" rel=\"nofollow\">http://stackoverflow.com/questions/43612366/tf-train-batch-output-is-not-deterministic/43613376#43613376</a></p>\n<p>The thread owner creates a batch with the following code:</p>\n<pre><code>BatchedInputs = tf.train.batch(\n  Inputs,\n  batch_size=64,\n  num_threads=8,\n  capacity=500 + 3 * 64)\n</code></pre>\n<p>And he noticed that created batches are not in every run the same. They are quite similar, but sometimes the inputs are mixed or some are missing.<br>\nAccording to the answer on StackOverflow reducing the number of pre-fetch threads to 1 is solving this issue.</p>\n<p>Since this could be an issue for test-set evaluation (where everyone would expect the exact same outcome for every run), I wonder if this is the intended behaviour?<br>\nIt should at least be added to the documentation for <code>tf.train.batch</code> that the generated batches can be non-deterministic.</p>\n<hr>\n<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:<br>\nYes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nWindows 10</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>:<br>\nBinary (pip3)</li>\n<li><strong>TensorFlow version (use command below)</strong>:<br>\n1.1.0</li>\n<li><strong>Bazel version (if compiling from source)</strong>:<br>\nnon</li>\n<li><strong>CUDA/cuDNN version</strong>:<br>\nCUDA 8.0, cuDNN 5.1</li>\n<li><strong>GPU model and memory</strong>:<br>\nGTX680</li>\n<li><strong>Exact command to reproduce</strong>:<br>\nSee above.</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>see above</p>\n<h3>Source code / logs</h3>\n<ul>\n<li></li>\n</ul>", "body_text": "This is related to the StackOverflow question: http://stackoverflow.com/questions/43612366/tf-train-batch-output-is-not-deterministic/43613376#43613376\nThe thread owner creates a batch with the following code:\nBatchedInputs = tf.train.batch(\n  Inputs,\n  batch_size=64,\n  num_threads=8,\n  capacity=500 + 3 * 64)\n\nAnd he noticed that created batches are not in every run the same. They are quite similar, but sometimes the inputs are mixed or some are missing.\nAccording to the answer on StackOverflow reducing the number of pre-fetch threads to 1 is solving this issue.\nSince this could be an issue for test-set evaluation (where everyone would expect the exact same outcome for every run), I wonder if this is the intended behaviour?\nIt should at least be added to the documentation for tf.train.batch that the generated batches can be non-deterministic.\n\nSystem information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nYes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nWindows 10\nTensorFlow installed from (source or binary):\nBinary (pip3)\nTensorFlow version (use command below):\n1.1.0\nBazel version (if compiling from source):\nnon\nCUDA/cuDNN version:\nCUDA 8.0, cuDNN 5.1\nGPU model and memory:\nGTX680\nExact command to reproduce:\nSee above.\n\nDescribe the problem\nsee above\nSource code / logs", "body": "This is related to the StackOverflow question: http://stackoverflow.com/questions/43612366/tf-train-batch-output-is-not-deterministic/43613376#43613376\r\n\r\nThe thread owner creates a batch with the following code:\r\n```\r\nBatchedInputs = tf.train.batch(\r\n  Inputs,\r\n  batch_size=64,\r\n  num_threads=8,\r\n  capacity=500 + 3 * 64)\r\n``` \r\n\r\nAnd he noticed that created batches are not in every run the same. They are quite similar, but sometimes the inputs are mixed or some are missing.\r\nAccording to the answer on StackOverflow reducing the number of pre-fetch threads to 1 is solving this issue.\r\n\r\nSince this could be an issue for test-set evaluation (where everyone would expect the exact same outcome for every run), I wonder if this is the intended behaviour?\r\nIt should at least be added to the documentation for `tf.train.batch` that the generated batches can be non-deterministic.\r\n\r\n------------------------\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\nYes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\nWindows 10\r\n- **TensorFlow installed from (source or binary)**:\r\nBinary (pip3)\r\n- **TensorFlow version (use command below)**:\r\n1.1.0\r\n- **Bazel version (if compiling from source)**:\r\nnon\r\n- **CUDA/cuDNN version**:\r\nCUDA 8.0, cuDNN 5.1\r\n- **GPU model and memory**:\r\nGTX680\r\n- **Exact command to reproduce**:\r\nSee above.\r\n\r\n### Describe the problem\r\nsee above\r\n\r\n### Source code / logs\r\n-"}