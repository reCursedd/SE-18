{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12631", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12631/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12631/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12631/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/12631", "id": 253163728, "node_id": "MDExOlB1bGxSZXF1ZXN0MTM3ODMzNjcy", "number": 12631, "title": "Make Dataset.map not unpack namedtuple", "user": {"login": "adaitche", "id": 25004501, "node_id": "MDQ6VXNlcjI1MDA0NTAx", "avatar_url": "https://avatars0.githubusercontent.com/u/25004501?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adaitche", "html_url": "https://github.com/adaitche", "followers_url": "https://api.github.com/users/adaitche/followers", "following_url": "https://api.github.com/users/adaitche/following{/other_user}", "gists_url": "https://api.github.com/users/adaitche/gists{/gist_id}", "starred_url": "https://api.github.com/users/adaitche/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adaitche/subscriptions", "organizations_url": "https://api.github.com/users/adaitche/orgs", "repos_url": "https://api.github.com/users/adaitche/repos", "events_url": "https://api.github.com/users/adaitche/events{/privacy}", "received_events_url": "https://api.github.com/users/adaitche/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2017-08-27T13:29:29Z", "updated_at": "2017-09-03T02:23:20Z", "closed_at": "2017-09-03T02:23:20Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12631", "html_url": "https://github.com/tensorflow/tensorflow/pull/12631", "diff_url": "https://github.com/tensorflow/tensorflow/pull/12631.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/12631.patch"}, "body_html": "<p>The map method of tf.contrib.data.Dataset unpacks iterables before passing them to the mapped function. This is quite convenient. However, currently this also happens for namedtuples, which IMHO is not what one would expect. Consider, for example, the following code:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n<span class=\"pl-k\">from</span> tensorflow.contrib.data <span class=\"pl-k\">import</span> Dataset\n<span class=\"pl-k\">from</span> collections <span class=\"pl-k\">import</span> namedtuple\n\nExample <span class=\"pl-k\">=</span> namedtuple(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Example<span class=\"pl-pds\">\"</span></span>, [<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>label<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>attributes<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>bounding_box<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>image<span class=\"pl-pds\">\"</span></span>])\n\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">read_example</span>(<span class=\"pl-smi\">serialized_example</span>):\n    <span class=\"pl-c\"><span class=\"pl-c\">#</span> parse example</span>\n    label <span class=\"pl-k\">=</span> <span class=\"pl-c1\">...</span>\n    attribute <span class=\"pl-k\">=</span> <span class=\"pl-c1\">...</span>\n    bounding_box <span class=\"pl-k\">=</span> <span class=\"pl-c1\">...</span>\n    image <span class=\"pl-k\">=</span> <span class=\"pl-c1\">...</span>\n    \n    <span class=\"pl-k\">return</span> Example(label, attribute, bounding_box, image)\n\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">preprocess_example</span>(<span class=\"pl-smi\">example</span>):\n    image <span class=\"pl-k\">=</span> some_function(example.image, example.bounding_box)\n    <span class=\"pl-k\">return</span> example._replace(<span class=\"pl-v\">image</span><span class=\"pl-k\">=</span>image)\n\n\ndataset <span class=\"pl-k\">=</span> tf.contrib.data.TFRecordDataset(filename)\ndataset <span class=\"pl-k\">=</span> dataset.map(read_example)\ndataset <span class=\"pl-k\">=</span> dataset.map(preprocess_example)</pre></div>\n<p>This does not work because the namedtuple instance is unpacked and its fields are passed as separate arguments to <code>preprocess_example</code>. So currently one has to reassemble the namedtuple manually. This is not a big deal, but it would be more convenient if namedtuples were not unpacked, as is also the case for dictionaries.</p>\n<p>This can be easily achieved by making <code>_should_unpack_args</code> return False for namedtuples, as is done in this pull request.</p>", "body_text": "The map method of tf.contrib.data.Dataset unpacks iterables before passing them to the mapped function. This is quite convenient. However, currently this also happens for namedtuples, which IMHO is not what one would expect. Consider, for example, the following code:\nimport tensorflow as tf\nfrom tensorflow.contrib.data import Dataset\nfrom collections import namedtuple\n\nExample = namedtuple(\"Example\", [\"label\", \"attributes\", \"bounding_box\", \"image\"])\n\n\ndef read_example(serialized_example):\n    # parse example\n    label = ...\n    attribute = ...\n    bounding_box = ...\n    image = ...\n    \n    return Example(label, attribute, bounding_box, image)\n\n\ndef preprocess_example(example):\n    image = some_function(example.image, example.bounding_box)\n    return example._replace(image=image)\n\n\ndataset = tf.contrib.data.TFRecordDataset(filename)\ndataset = dataset.map(read_example)\ndataset = dataset.map(preprocess_example)\nThis does not work because the namedtuple instance is unpacked and its fields are passed as separate arguments to preprocess_example. So currently one has to reassemble the namedtuple manually. This is not a big deal, but it would be more convenient if namedtuples were not unpacked, as is also the case for dictionaries.\nThis can be easily achieved by making _should_unpack_args return False for namedtuples, as is done in this pull request.", "body": "The map method of tf.contrib.data.Dataset unpacks iterables before passing them to the mapped function. This is quite convenient. However, currently this also happens for namedtuples, which IMHO is not what one would expect. Consider, for example, the following code:\r\n\r\n```python\r\nimport tensorflow as tf\r\nfrom tensorflow.contrib.data import Dataset\r\nfrom collections import namedtuple\r\n\r\nExample = namedtuple(\"Example\", [\"label\", \"attributes\", \"bounding_box\", \"image\"])\r\n\r\n\r\ndef read_example(serialized_example):\r\n    # parse example\r\n    label = ...\r\n    attribute = ...\r\n    bounding_box = ...\r\n    image = ...\r\n    \r\n    return Example(label, attribute, bounding_box, image)\r\n\r\n\r\ndef preprocess_example(example):\r\n    image = some_function(example.image, example.bounding_box)\r\n    return example._replace(image=image)\r\n\r\n\r\ndataset = tf.contrib.data.TFRecordDataset(filename)\r\ndataset = dataset.map(read_example)\r\ndataset = dataset.map(preprocess_example)\r\n```\r\n\r\nThis does not work because the namedtuple instance is unpacked and its fields are passed as separate arguments to `preprocess_example`. So currently one has to reassemble the namedtuple manually. This is not a big deal, but it would be more convenient if namedtuples were not unpacked, as is also the case for dictionaries.\r\n\r\nThis can be easily achieved by making `_should_unpack_args` return False for namedtuples, as is done in this pull request."}