{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11005", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11005/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11005/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11005/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/11005", "id": 238084285, "node_id": "MDU6SXNzdWUyMzgwODQyODU=", "number": 11005, "title": "[Bug] tf version 1.2 , dropout layer reject tensor type rate", "user": {"login": "abelxie", "id": 442849, "node_id": "MDQ6VXNlcjQ0Mjg0OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/442849?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abelxie", "html_url": "https://github.com/abelxie", "followers_url": "https://api.github.com/users/abelxie/followers", "following_url": "https://api.github.com/users/abelxie/following{/other_user}", "gists_url": "https://api.github.com/users/abelxie/gists{/gist_id}", "starred_url": "https://api.github.com/users/abelxie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abelxie/subscriptions", "organizations_url": "https://api.github.com/users/abelxie/orgs", "repos_url": "https://api.github.com/users/abelxie/repos", "events_url": "https://api.github.com/users/abelxie/events{/privacy}", "received_events_url": "https://api.github.com/users/abelxie/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2017-06-23T09:09:00Z", "updated_at": "2017-06-26T20:46:44Z", "closed_at": "2017-06-26T20:46:24Z", "author_association": "NONE", "body_html": "<p>version 1.2</p>\n<p>The following code:</p>\n<div class=\"highlight highlight-source-python\"><pre>tf.contrib.layers.dropout(tf.zeros((<span class=\"pl-c1\">100</span>,<span class=\"pl-c1\">10</span>)), <span class=\"pl-v\">keep_prob</span><span class=\"pl-k\">=</span>tf.placeholder_with_default(<span class=\"pl-c1\">0.9</span>,(),<span class=\"pl-s\"><span class=\"pl-pds\">'</span>dp<span class=\"pl-pds\">'</span></span>))</pre></div>\n<p>or</p>\n<div class=\"highlight highlight-source-python\"><pre>tf.layers.dropout(tf.zeros((<span class=\"pl-c1\">100</span>,<span class=\"pl-c1\">10</span>)), <span class=\"pl-c1\">1</span> <span class=\"pl-k\">-</span> tf.placeholder_with_default(<span class=\"pl-c1\">0.9</span>,(),<span class=\"pl-s\"><span class=\"pl-pds\">'</span>dp<span class=\"pl-pds\">'</span></span>))</pre></div>\n<p>will fail with following error:</p>\n<pre lang=\"txt\"><code>---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n&lt;ipython-input-3-e27328ef830a&gt; in &lt;module&gt;()\n----&gt; 1 tf.contrib.layers.dropout(tf.zeros((100,10)), keep_prob=tf.placeholder_with_default(0.9,(),'dp'))\n\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/contrib/framework/python/ops/arg_scope.py in func_with_args(*args, **kwargs)\n    179       current_args = current_scope[key_func].copy()\n    180       current_args.update(kwargs)\n--&gt; 181     return func(*args, **current_args)\n    182   _add_op(func)\n    183   setattr(func_with_args, '_key_op', _key_op(func))\n\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/contrib/layers/python/layers/layers.py in dropout(inputs, keep_prob, noise_shape, is_training, outputs_collections, scope)\n   1214                                 noise_shape=noise_shape,\n   1215                                 name=sc.name,\n-&gt; 1216                                 _scope=sc)\n   1217     outputs = layer.apply(inputs, training=is_training)\n   1218     return utils.collect_named_outputs(\n\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/python/layers/core.py in __init__(self, rate, noise_shape, seed, name, **kwargs)\n    245                **kwargs):\n    246     super(Dropout, self).__init__(name=name, **kwargs)\n--&gt; 247     self.rate = min(1., max(0., rate))\n    248     self.noise_shape = noise_shape\n    249     self.seed = seed\n\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in __bool__(self)\n    562       `TypeError`.\n    563     \"\"\"\n--&gt; 564     raise TypeError(\"Using a `tf.Tensor` as a Python `bool` is not allowed. \"\n    565                     \"Use `if t is not None:` instead of `if t:` to test if a \"\n    566                     \"tensor is defined, and use TensorFlow ops such as \"\n\nTypeError: Using a `tf.Tensor` as a Python `bool` is not allowed. Use `if t is not None:` instead of `if t:` to test if a tensor is defined, and use TensorFlow ops such as tf.cond to execute subgraphs conditioned on the value of a tensor.\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n&lt;ipython-input-3-e27328ef830a&gt; in &lt;module&gt;()\n----&gt; 1 tf.contrib.layers.dropout(tf.zeros((100,10)), keep_prob=tf.placeholder_with_default(0.9,(),'dp'))\n\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/contrib/framework/python/ops/arg_scope.py in func_with_args(*args, **kwargs)\n    179       current_args = current_scope[key_func].copy()\n    180       current_args.update(kwargs)\n--&gt; 181     return func(*args, **current_args)\n    182   _add_op(func)\n    183   setattr(func_with_args, '_key_op', _key_op(func))\n\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/contrib/layers/python/layers/layers.py in dropout(inputs, keep_prob, noise_shape, is_training, outputs_collections, scope)\n   1214                                 noise_shape=noise_shape,\n   1215                                 name=sc.name,\n-&gt; 1216                                 _scope=sc)\n   1217     outputs = layer.apply(inputs, training=is_training)\n   1218     return utils.collect_named_outputs(\n\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/python/layers/core.py in __init__(self, rate, noise_shape, seed, name, **kwargs)\n    245                **kwargs):\n    246     super(Dropout, self).__init__(name=name, **kwargs)\n--&gt; 247     self.rate = min(1., max(0., rate))\n    248     self.noise_shape = noise_shape\n    249     self.seed = seed\n\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in __bool__(self)\n    562       `TypeError`.\n    563     \"\"\"\n--&gt; 564     raise TypeError(\"Using a `tf.Tensor` as a Python `bool` is not allowed. \"\n    565                     \"Use `if t is not None:` instead of `if t:` to test if a \"\n    566                     \"tensor is defined, and use TensorFlow ops such as \"\n\nTypeError: Using a `tf.Tensor` as a Python `bool` is not allowed. Use `if t is not None:` instead of `if t:` to test if a tensor is defined, and use TensorFlow ops such as tf.cond to execute subgraphs conditioned on the value of a tensor.\n</code></pre>\n<p>The same code run successfully on tf version 1.1.0,</p>\n<p>I check the documents are not changed :<br>\n<a href=\"https://www.tensorflow.org/api_docs/python/tf/contrib/layers/dropout\" rel=\"nofollow\">https://www.tensorflow.org/api_docs/python/tf/contrib/layers/dropout</a></p>\n<pre><code>    keep_prob: A scalar Tensor with the same type as x. The probability that each element is kept.\n</code></pre>\n<p>It accepts tensor, so I guess this should be a bug.</p>", "body_text": "version 1.2\nThe following code:\ntf.contrib.layers.dropout(tf.zeros((100,10)), keep_prob=tf.placeholder_with_default(0.9,(),'dp'))\nor\ntf.layers.dropout(tf.zeros((100,10)), 1 - tf.placeholder_with_default(0.9,(),'dp'))\nwill fail with following error:\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-3-e27328ef830a> in <module>()\n----> 1 tf.contrib.layers.dropout(tf.zeros((100,10)), keep_prob=tf.placeholder_with_default(0.9,(),'dp'))\n\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/contrib/framework/python/ops/arg_scope.py in func_with_args(*args, **kwargs)\n    179       current_args = current_scope[key_func].copy()\n    180       current_args.update(kwargs)\n--> 181     return func(*args, **current_args)\n    182   _add_op(func)\n    183   setattr(func_with_args, '_key_op', _key_op(func))\n\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/contrib/layers/python/layers/layers.py in dropout(inputs, keep_prob, noise_shape, is_training, outputs_collections, scope)\n   1214                                 noise_shape=noise_shape,\n   1215                                 name=sc.name,\n-> 1216                                 _scope=sc)\n   1217     outputs = layer.apply(inputs, training=is_training)\n   1218     return utils.collect_named_outputs(\n\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/python/layers/core.py in __init__(self, rate, noise_shape, seed, name, **kwargs)\n    245                **kwargs):\n    246     super(Dropout, self).__init__(name=name, **kwargs)\n--> 247     self.rate = min(1., max(0., rate))\n    248     self.noise_shape = noise_shape\n    249     self.seed = seed\n\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in __bool__(self)\n    562       `TypeError`.\n    563     \"\"\"\n--> 564     raise TypeError(\"Using a `tf.Tensor` as a Python `bool` is not allowed. \"\n    565                     \"Use `if t is not None:` instead of `if t:` to test if a \"\n    566                     \"tensor is defined, and use TensorFlow ops such as \"\n\nTypeError: Using a `tf.Tensor` as a Python `bool` is not allowed. Use `if t is not None:` instead of `if t:` to test if a tensor is defined, and use TensorFlow ops such as tf.cond to execute subgraphs conditioned on the value of a tensor.\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-3-e27328ef830a> in <module>()\n----> 1 tf.contrib.layers.dropout(tf.zeros((100,10)), keep_prob=tf.placeholder_with_default(0.9,(),'dp'))\n\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/contrib/framework/python/ops/arg_scope.py in func_with_args(*args, **kwargs)\n    179       current_args = current_scope[key_func].copy()\n    180       current_args.update(kwargs)\n--> 181     return func(*args, **current_args)\n    182   _add_op(func)\n    183   setattr(func_with_args, '_key_op', _key_op(func))\n\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/contrib/layers/python/layers/layers.py in dropout(inputs, keep_prob, noise_shape, is_training, outputs_collections, scope)\n   1214                                 noise_shape=noise_shape,\n   1215                                 name=sc.name,\n-> 1216                                 _scope=sc)\n   1217     outputs = layer.apply(inputs, training=is_training)\n   1218     return utils.collect_named_outputs(\n\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/python/layers/core.py in __init__(self, rate, noise_shape, seed, name, **kwargs)\n    245                **kwargs):\n    246     super(Dropout, self).__init__(name=name, **kwargs)\n--> 247     self.rate = min(1., max(0., rate))\n    248     self.noise_shape = noise_shape\n    249     self.seed = seed\n\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in __bool__(self)\n    562       `TypeError`.\n    563     \"\"\"\n--> 564     raise TypeError(\"Using a `tf.Tensor` as a Python `bool` is not allowed. \"\n    565                     \"Use `if t is not None:` instead of `if t:` to test if a \"\n    566                     \"tensor is defined, and use TensorFlow ops such as \"\n\nTypeError: Using a `tf.Tensor` as a Python `bool` is not allowed. Use `if t is not None:` instead of `if t:` to test if a tensor is defined, and use TensorFlow ops such as tf.cond to execute subgraphs conditioned on the value of a tensor.\n\nThe same code run successfully on tf version 1.1.0,\nI check the documents are not changed :\nhttps://www.tensorflow.org/api_docs/python/tf/contrib/layers/dropout\n    keep_prob: A scalar Tensor with the same type as x. The probability that each element is kept.\n\nIt accepts tensor, so I guess this should be a bug.", "body": "version 1.2\r\n\r\nThe following code:\r\n\r\n```python\r\ntf.contrib.layers.dropout(tf.zeros((100,10)), keep_prob=tf.placeholder_with_default(0.9,(),'dp'))\r\n```\r\n\r\nor \r\n\r\n```python\r\ntf.layers.dropout(tf.zeros((100,10)), 1 - tf.placeholder_with_default(0.9,(),'dp'))\r\n```\r\n\r\nwill fail with following error:\r\n\r\n```txt\r\n---------------------------------------------------------------------------\r\nTypeError                                 Traceback (most recent call last)\r\n<ipython-input-3-e27328ef830a> in <module>()\r\n----> 1 tf.contrib.layers.dropout(tf.zeros((100,10)), keep_prob=tf.placeholder_with_default(0.9,(),'dp'))\r\n\r\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/contrib/framework/python/ops/arg_scope.py in func_with_args(*args, **kwargs)\r\n    179       current_args = current_scope[key_func].copy()\r\n    180       current_args.update(kwargs)\r\n--> 181     return func(*args, **current_args)\r\n    182   _add_op(func)\r\n    183   setattr(func_with_args, '_key_op', _key_op(func))\r\n\r\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/contrib/layers/python/layers/layers.py in dropout(inputs, keep_prob, noise_shape, is_training, outputs_collections, scope)\r\n   1214                                 noise_shape=noise_shape,\r\n   1215                                 name=sc.name,\r\n-> 1216                                 _scope=sc)\r\n   1217     outputs = layer.apply(inputs, training=is_training)\r\n   1218     return utils.collect_named_outputs(\r\n\r\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/python/layers/core.py in __init__(self, rate, noise_shape, seed, name, **kwargs)\r\n    245                **kwargs):\r\n    246     super(Dropout, self).__init__(name=name, **kwargs)\r\n--> 247     self.rate = min(1., max(0., rate))\r\n    248     self.noise_shape = noise_shape\r\n    249     self.seed = seed\r\n\r\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in __bool__(self)\r\n    562       `TypeError`.\r\n    563     \"\"\"\r\n--> 564     raise TypeError(\"Using a `tf.Tensor` as a Python `bool` is not allowed. \"\r\n    565                     \"Use `if t is not None:` instead of `if t:` to test if a \"\r\n    566                     \"tensor is defined, and use TensorFlow ops such as \"\r\n\r\nTypeError: Using a `tf.Tensor` as a Python `bool` is not allowed. Use `if t is not None:` instead of `if t:` to test if a tensor is defined, and use TensorFlow ops such as tf.cond to execute subgraphs conditioned on the value of a tensor.\r\n---------------------------------------------------------------------------\r\nTypeError                                 Traceback (most recent call last)\r\n<ipython-input-3-e27328ef830a> in <module>()\r\n----> 1 tf.contrib.layers.dropout(tf.zeros((100,10)), keep_prob=tf.placeholder_with_default(0.9,(),'dp'))\r\n\r\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/contrib/framework/python/ops/arg_scope.py in func_with_args(*args, **kwargs)\r\n    179       current_args = current_scope[key_func].copy()\r\n    180       current_args.update(kwargs)\r\n--> 181     return func(*args, **current_args)\r\n    182   _add_op(func)\r\n    183   setattr(func_with_args, '_key_op', _key_op(func))\r\n\r\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/contrib/layers/python/layers/layers.py in dropout(inputs, keep_prob, noise_shape, is_training, outputs_collections, scope)\r\n   1214                                 noise_shape=noise_shape,\r\n   1215                                 name=sc.name,\r\n-> 1216                                 _scope=sc)\r\n   1217     outputs = layer.apply(inputs, training=is_training)\r\n   1218     return utils.collect_named_outputs(\r\n\r\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/python/layers/core.py in __init__(self, rate, noise_shape, seed, name, **kwargs)\r\n    245                **kwargs):\r\n    246     super(Dropout, self).__init__(name=name, **kwargs)\r\n--> 247     self.rate = min(1., max(0., rate))\r\n    248     self.noise_shape = noise_shape\r\n    249     self.seed = seed\r\n\r\n~/miniconda3/envs/t12/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in __bool__(self)\r\n    562       `TypeError`.\r\n    563     \"\"\"\r\n--> 564     raise TypeError(\"Using a `tf.Tensor` as a Python `bool` is not allowed. \"\r\n    565                     \"Use `if t is not None:` instead of `if t:` to test if a \"\r\n    566                     \"tensor is defined, and use TensorFlow ops such as \"\r\n\r\nTypeError: Using a `tf.Tensor` as a Python `bool` is not allowed. Use `if t is not None:` instead of `if t:` to test if a tensor is defined, and use TensorFlow ops such as tf.cond to execute subgraphs conditioned on the value of a tensor.\r\n```\r\n\r\n\r\nThe same code run successfully on tf version 1.1.0,\r\n\r\nI check the documents are not changed : \r\n[https://www.tensorflow.org/api_docs/python/tf/contrib/layers/dropout](https://www.tensorflow.org/api_docs/python/tf/contrib/layers/dropout)\r\n\r\n        keep_prob: A scalar Tensor with the same type as x. The probability that each element is kept.\r\n\r\n\r\nIt accepts tensor, so I guess this should be a bug.\r\n\r\n\r\n\r\n"}