{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/404397495", "html_url": "https://github.com/tensorflow/tensorflow/issues/5680#issuecomment-404397495", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5680", "id": 404397495, "node_id": "MDEyOklzc3VlQ29tbWVudDQwNDM5NzQ5NQ==", "user": {"login": "ZhimingZhou", "id": 11959472, "node_id": "MDQ6VXNlcjExOTU5NDcy", "avatar_url": "https://avatars2.githubusercontent.com/u/11959472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ZhimingZhou", "html_url": "https://github.com/ZhimingZhou", "followers_url": "https://api.github.com/users/ZhimingZhou/followers", "following_url": "https://api.github.com/users/ZhimingZhou/following{/other_user}", "gists_url": "https://api.github.com/users/ZhimingZhou/gists{/gist_id}", "starred_url": "https://api.github.com/users/ZhimingZhou/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ZhimingZhou/subscriptions", "organizations_url": "https://api.github.com/users/ZhimingZhou/orgs", "repos_url": "https://api.github.com/users/ZhimingZhou/repos", "events_url": "https://api.github.com/users/ZhimingZhou/events{/privacy}", "received_events_url": "https://api.github.com/users/ZhimingZhou/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-12T05:52:42Z", "updated_at": "2018-07-12T05:57:51Z", "author_association": "NONE", "body_html": "<p>HI, I'm also facing a similar issue that requires to modify the static shape to None. But it cannot be handled by placeholder_with_default. I'm loading a pre-trained model/graph that has a static shape.</p>\n<p>The thing is that I'm using the Inception Score, which is a very important evaluation metric in generative models, especially the GANs community.</p>\n<p>It involves the pre-trained model <a href=\"http://download.tensorflow.org/models/image/imagenet/inception-2015-12-05.tgz\" rel=\"nofollow\">http://download.tensorflow.org/models/image/imagenet/inception-2015-12-05.tgz</a>. But it has a static batch size 1, which makes the inference extremely slow. It was used to be handled by the following code, i.e. changing the tensor shape via tensor._shape = new_shape.</p>\n<pre><code> ops = self.inception_graph.get_operations()\n        for op_idx, op in enumerate(ops):\n            for o in op.outputs:\n                shape = o.get_shape()\n                shape = [s.value for s in shape]\n                new_shape = []\n                for j, s in enumerate(shape):\n                    if s == 1 and j == 0:\n                        new_shape.append(None)\n                    else:\n                        new_shape.append(s)\n                # o._shape = tf.TensorShape(new_shape)\n</code></pre>\n<p>The above operation works for tensorflow 1.5 and earlier version. But for the latter version such as tensorflow 1.9, o._shape = tf.TensorShape(new_shape) is no longer allowed, and set_shape only merges shape, but not support modifying known to None.</p>\n<p>Resetting shape seems necessary here.  So I'm looking forward to a update_shape operation. I understand that \"there's deliberately no way to make a tensor's shape less-specific.\" But any idea to solve the above-mentioned problem, any help? The current forces me to use tensorflow up to version 1.5.</p>\n<p>Thanks a lot!</p>", "body_text": "HI, I'm also facing a similar issue that requires to modify the static shape to None. But it cannot be handled by placeholder_with_default. I'm loading a pre-trained model/graph that has a static shape.\nThe thing is that I'm using the Inception Score, which is a very important evaluation metric in generative models, especially the GANs community.\nIt involves the pre-trained model http://download.tensorflow.org/models/image/imagenet/inception-2015-12-05.tgz. But it has a static batch size 1, which makes the inference extremely slow. It was used to be handled by the following code, i.e. changing the tensor shape via tensor._shape = new_shape.\n ops = self.inception_graph.get_operations()\n        for op_idx, op in enumerate(ops):\n            for o in op.outputs:\n                shape = o.get_shape()\n                shape = [s.value for s in shape]\n                new_shape = []\n                for j, s in enumerate(shape):\n                    if s == 1 and j == 0:\n                        new_shape.append(None)\n                    else:\n                        new_shape.append(s)\n                # o._shape = tf.TensorShape(new_shape)\n\nThe above operation works for tensorflow 1.5 and earlier version. But for the latter version such as tensorflow 1.9, o._shape = tf.TensorShape(new_shape) is no longer allowed, and set_shape only merges shape, but not support modifying known to None.\nResetting shape seems necessary here.  So I'm looking forward to a update_shape operation. I understand that \"there's deliberately no way to make a tensor's shape less-specific.\" But any idea to solve the above-mentioned problem, any help? The current forces me to use tensorflow up to version 1.5.\nThanks a lot!", "body": "HI, I'm also facing a similar issue that requires to modify the static shape to None. But it cannot be handled by placeholder_with_default. I'm loading a pre-trained model/graph that has a static shape. \r\n\r\nThe thing is that I'm using the Inception Score, which is a very important evaluation metric in generative models, especially the GANs community.  \r\n\r\nIt involves the pre-trained model http://download.tensorflow.org/models/image/imagenet/inception-2015-12-05.tgz. But it has a static batch size 1, which makes the inference extremely slow. It was used to be handled by the following code, i.e. changing the tensor shape via tensor._shape = new_shape.\r\n\r\n```\r\n ops = self.inception_graph.get_operations()\r\n        for op_idx, op in enumerate(ops):\r\n            for o in op.outputs:\r\n                shape = o.get_shape()\r\n                shape = [s.value for s in shape]\r\n                new_shape = []\r\n                for j, s in enumerate(shape):\r\n                    if s == 1 and j == 0:\r\n                        new_shape.append(None)\r\n                    else:\r\n                        new_shape.append(s)\r\n                # o._shape = tf.TensorShape(new_shape)\r\n```\r\nThe above operation works for tensorflow 1.5 and earlier version. But for the latter version such as tensorflow 1.9, o._shape = tf.TensorShape(new_shape) is no longer allowed, and set_shape only merges shape, but not support modifying known to None.\r\n\r\nResetting shape seems necessary here.  So I'm looking forward to a update_shape operation. I understand that \"there's deliberately no way to make a tensor's shape less-specific.\" But any idea to solve the above-mentioned problem, any help? The current forces me to use tensorflow up to version 1.5.\r\n\r\nThanks a lot!"}