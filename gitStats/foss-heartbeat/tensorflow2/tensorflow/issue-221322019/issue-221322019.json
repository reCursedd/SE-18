{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9170", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9170/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9170/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9170/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/9170", "id": 221322019, "node_id": "MDU6SXNzdWUyMjEzMjIwMTk=", "number": 9170, "title": "[Windows] `import tensorflow` error messages are uninformative.", "user": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473173272, "node_id": "MDU6TGFiZWw0NzMxNzMyNzI=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:feature", "name": "type:feature", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2017-04-12T16:38:55Z", "updated_at": "2017-10-02T23:33:38Z", "closed_at": "2017-10-02T23:33:38Z", "author_association": "CONTRIBUTOR", "body_html": "<p>When a user runs <code>import tensorflow</code>, we attempt to dynamically load the DLL <code>_pywrap_tensorflow.pyd</code>. If this fails, the user gets an uninformative (perhaps downright misleading) message:</p>\n<pre><code>Traceback (most recent call last): \nFile \"C:\\...\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow.py\", line 18, in swig_import_helper\n    fp, pathname, description = imp.find_module('_pywrap_tensorflow', [dirname(file)])\nFile \"C:\\...\\lib\\imp.py\", line 296, in find_module\n    raise ImportError(_ERR_MSG.format(name), name=name)\nImportError: No module named '_pywrap_tensorflow'\n</code></pre>\n<p>This error can happen for several reasons:</p>\n<ul>\n<li>(Rare) The package has not been installed correctly, and the file <code>_pywrap_tensorflow.pyd</code> is not present in the expected location.</li>\n<li>The package has been installed for an incompatible version of Python (e.g. installed on Python 3.6, but built for 3.5, as in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"221288060\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/9167\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/9167/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/9167\">#9167</a>). I suspect this is because it fails to load <code>python35.dll</code>.</li>\n<li>The library has been installed correctly, but one or more of its native dependencies is missing. Common examples include:\n<ul>\n<li><code>MSVCP140.dll</code> (the Microsoft Visual C++ redistributable library). The compiled C++ code depends on this library being present, but it is not installed as standard, unless you use Anaconda. (See <a href=\"http://stackoverflow.com/a/42011114/3574081\" rel=\"nofollow\">this Stack Overflow question</a>, for example.)</li>\n<li>CUDA libraries. The user's <code>%PATH%</code> may not include the directory that contains the CUDA DLLs.</li>\n<li><code>cudnn64_5.dll</code>. This is typically installed in a different directory from the CUDA libraries, and must be added to the user's <code>%PATH%</code> explicitly.</li>\n</ul>\n</li>\n</ul>\n<p>It would be helpful if we could provide more information about the cause of an <code>ImportError</code>, and in particular we would like to show the name of the missing DLL to aid the user in diagnosing the problem. It's less clear to me how we achieve this, since the error is reported by <code>LoadLibrary()</code> of our compiled code before we have the chance to execute anything.</p>\n<p>A couple of thoughts spring to mind:</p>\n<ol>\n<li>Can we use <a href=\"https://msdn.microsoft.com/en-us/library/151kt790.aspx\" rel=\"nofollow\"><code>/DELAYLOAD</code></a> during the build process so that (at least) we have the chance to probe the CUDA-related libraries before using them? Are there any performance consequences to doing this?</li>\n<li>Alternatively, can we implement a sanity check in Python before we import <code>_pywrap_tensorflow.pyd</code> to ensure that the relevant files will be found?</li>\n</ol>\n<p>/cc <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=22941064\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/guschmue\">@guschmue</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=22799507\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/vit-stepanovs\">@vit-stepanovs</a> in case they have any smart ideas!</p>", "body_text": "When a user runs import tensorflow, we attempt to dynamically load the DLL _pywrap_tensorflow.pyd. If this fails, the user gets an uninformative (perhaps downright misleading) message:\nTraceback (most recent call last): \nFile \"C:\\...\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow.py\", line 18, in swig_import_helper\n    fp, pathname, description = imp.find_module('_pywrap_tensorflow', [dirname(file)])\nFile \"C:\\...\\lib\\imp.py\", line 296, in find_module\n    raise ImportError(_ERR_MSG.format(name), name=name)\nImportError: No module named '_pywrap_tensorflow'\n\nThis error can happen for several reasons:\n\n(Rare) The package has not been installed correctly, and the file _pywrap_tensorflow.pyd is not present in the expected location.\nThe package has been installed for an incompatible version of Python (e.g. installed on Python 3.6, but built for 3.5, as in #9167). I suspect this is because it fails to load python35.dll.\nThe library has been installed correctly, but one or more of its native dependencies is missing. Common examples include:\n\nMSVCP140.dll (the Microsoft Visual C++ redistributable library). The compiled C++ code depends on this library being present, but it is not installed as standard, unless you use Anaconda. (See this Stack Overflow question, for example.)\nCUDA libraries. The user's %PATH% may not include the directory that contains the CUDA DLLs.\ncudnn64_5.dll. This is typically installed in a different directory from the CUDA libraries, and must be added to the user's %PATH% explicitly.\n\n\n\nIt would be helpful if we could provide more information about the cause of an ImportError, and in particular we would like to show the name of the missing DLL to aid the user in diagnosing the problem. It's less clear to me how we achieve this, since the error is reported by LoadLibrary() of our compiled code before we have the chance to execute anything.\nA couple of thoughts spring to mind:\n\nCan we use /DELAYLOAD during the build process so that (at least) we have the chance to probe the CUDA-related libraries before using them? Are there any performance consequences to doing this?\nAlternatively, can we implement a sanity check in Python before we import _pywrap_tensorflow.pyd to ensure that the relevant files will be found?\n\n/cc @guschmue @vit-stepanovs in case they have any smart ideas!", "body": "When a user runs `import tensorflow`, we attempt to dynamically load the DLL `_pywrap_tensorflow.pyd`. If this fails, the user gets an uninformative (perhaps downright misleading) message:\r\n\r\n```\r\nTraceback (most recent call last): \r\nFile \"C:\\...\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow.py\", line 18, in swig_import_helper\r\n    fp, pathname, description = imp.find_module('_pywrap_tensorflow', [dirname(file)])\r\nFile \"C:\\...\\lib\\imp.py\", line 296, in find_module\r\n    raise ImportError(_ERR_MSG.format(name), name=name)\r\nImportError: No module named '_pywrap_tensorflow'\r\n```\r\n\r\nThis error can happen for several reasons:\r\n\r\n* (Rare) The package has not been installed correctly, and the file `_pywrap_tensorflow.pyd` is not present in the expected location.\r\n* The package has been installed for an incompatible version of Python (e.g. installed on Python 3.6, but built for 3.5, as in #9167). I suspect this is because it fails to load `python35.dll`.\r\n* The library has been installed correctly, but one or more of its native dependencies is missing. Common examples include:\r\n  * `MSVCP140.dll` (the Microsoft Visual C++ redistributable library). The compiled C++ code depends on this library being present, but it is not installed as standard, unless you use Anaconda. (See [this Stack Overflow question](http://stackoverflow.com/a/42011114/3574081), for example.)\r\n  * CUDA libraries. The user's `%PATH%` may not include the directory that contains the CUDA DLLs.\r\n  * `cudnn64_5.dll`. This is typically installed in a different directory from the CUDA libraries, and must be added to the user's `%PATH%` explicitly.\r\n\r\nIt would be helpful if we could provide more information about the cause of an `ImportError`, and in particular we would like to show the name of the missing DLL to aid the user in diagnosing the problem. It's less clear to me how we achieve this, since the error is reported by `LoadLibrary()` of our compiled code before we have the chance to execute anything.\r\n\r\nA couple of thoughts spring to mind:\r\n\r\n1. Can we use [`/DELAYLOAD`](https://msdn.microsoft.com/en-us/library/151kt790.aspx) during the build process so that (at least) we have the chance to probe the CUDA-related libraries before using them? Are there any performance consequences to doing this? \r\n2. Alternatively, can we implement a sanity check in Python before we import `_pywrap_tensorflow.pyd` to ensure that the relevant files will be found? \r\n\r\n/cc @guschmue @vit-stepanovs in case they have any smart ideas!"}