{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7610", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7610/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7610/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7610/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/7610", "id": 208345553, "node_id": "MDU6SXNzdWUyMDgzNDU1NTM=", "number": 7610, "title": "3D convolutions unnaturally slow on CPU", "user": {"login": "undertherain", "id": 1635907, "node_id": "MDQ6VXNlcjE2MzU5MDc=", "avatar_url": "https://avatars2.githubusercontent.com/u/1635907?v=4", "gravatar_id": "", "url": "https://api.github.com/users/undertherain", "html_url": "https://github.com/undertherain", "followers_url": "https://api.github.com/users/undertherain/followers", "following_url": "https://api.github.com/users/undertherain/following{/other_user}", "gists_url": "https://api.github.com/users/undertherain/gists{/gist_id}", "starred_url": "https://api.github.com/users/undertherain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/undertherain/subscriptions", "organizations_url": "https://api.github.com/users/undertherain/orgs", "repos_url": "https://api.github.com/users/undertherain/repos", "events_url": "https://api.github.com/users/undertherain/events{/privacy}", "received_events_url": "https://api.github.com/users/undertherain/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "mjanusz", "id": 328443, "node_id": "MDQ6VXNlcjMyODQ0Mw==", "avatar_url": "https://avatars2.githubusercontent.com/u/328443?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mjanusz", "html_url": "https://github.com/mjanusz", "followers_url": "https://api.github.com/users/mjanusz/followers", "following_url": "https://api.github.com/users/mjanusz/following{/other_user}", "gists_url": "https://api.github.com/users/mjanusz/gists{/gist_id}", "starred_url": "https://api.github.com/users/mjanusz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mjanusz/subscriptions", "organizations_url": "https://api.github.com/users/mjanusz/orgs", "repos_url": "https://api.github.com/users/mjanusz/repos", "events_url": "https://api.github.com/users/mjanusz/events{/privacy}", "received_events_url": "https://api.github.com/users/mjanusz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mjanusz", "id": 328443, "node_id": "MDQ6VXNlcjMyODQ0Mw==", "avatar_url": "https://avatars2.githubusercontent.com/u/328443?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mjanusz", "html_url": "https://github.com/mjanusz", "followers_url": "https://api.github.com/users/mjanusz/followers", "following_url": "https://api.github.com/users/mjanusz/following{/other_user}", "gists_url": "https://api.github.com/users/mjanusz/gists{/gist_id}", "starred_url": "https://api.github.com/users/mjanusz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mjanusz/subscriptions", "organizations_url": "https://api.github.com/users/mjanusz/orgs", "repos_url": "https://api.github.com/users/mjanusz/repos", "events_url": "https://api.github.com/users/mjanusz/events{/privacy}", "received_events_url": "https://api.github.com/users/mjanusz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 15, "created_at": "2017-02-17T06:05:16Z", "updated_at": "2018-02-22T19:21:15Z", "closed_at": "2018-02-22T19:21:15Z", "author_association": "NONE", "body_html": "<p>3D convolutions on CPU seem unnaturally slow.<br>\nI can't use GPU due to memory limit, so I'm looking at CPU execution.</p>\n<p>2D convolutions in TensorFlow seem to be well-optimized, all CPU cores are used, performance is just few times below GPU.</p>\n<p>With 3D convolutions - the difference is orders of magnitude.</p>\n<p>Also, I've compared with Theano. Theano 3D convolutions run on single core but still are 10 times faster.</p>\n<p>Strangely, TF uses all cores on CPU with 3Dconv,  so there must be some bug or extreme inefficiency in implementation.</p>\n<p>With the same small test model (just couple of 3d conv layers) I get 1 second epoch time on GPU (both TF and Theano, theano just a bit faster), 5 seconds on CPU Theano single threaded, and 50 seconds with (seemingly) multi-threded TF</p>\n<h3>Environment info</h3>\n<p>I've tried different TF versions from 0.12 to 1.00, installed from pip. Latest one from <a href=\"https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.0.0-cp35-cp35m-linux_x86_64.whl\" rel=\"nofollow\">https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.0.0-cp35-cp35m-linux_x86_64.whl</a></p>\n<p>The OS is CentOS Linux release 7.2.1511 (Core) , kernel 3.10.0-327.18.2.el7.x86_64</p>\n<p>I'm using Keras back-end, so I can't be 100% sure if the problem is not in the way Keras translates Convolution3D call into TF primitives, but it does not seem likely.</p>\n<p>cheers<br>\nAlex</p>", "body_text": "3D convolutions on CPU seem unnaturally slow.\nI can't use GPU due to memory limit, so I'm looking at CPU execution.\n2D convolutions in TensorFlow seem to be well-optimized, all CPU cores are used, performance is just few times below GPU.\nWith 3D convolutions - the difference is orders of magnitude.\nAlso, I've compared with Theano. Theano 3D convolutions run on single core but still are 10 times faster.\nStrangely, TF uses all cores on CPU with 3Dconv,  so there must be some bug or extreme inefficiency in implementation.\nWith the same small test model (just couple of 3d conv layers) I get 1 second epoch time on GPU (both TF and Theano, theano just a bit faster), 5 seconds on CPU Theano single threaded, and 50 seconds with (seemingly) multi-threded TF\nEnvironment info\nI've tried different TF versions from 0.12 to 1.00, installed from pip. Latest one from https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.0.0-cp35-cp35m-linux_x86_64.whl\nThe OS is CentOS Linux release 7.2.1511 (Core) , kernel 3.10.0-327.18.2.el7.x86_64\nI'm using Keras back-end, so I can't be 100% sure if the problem is not in the way Keras translates Convolution3D call into TF primitives, but it does not seem likely.\ncheers\nAlex", "body": "3D convolutions on CPU seem unnaturally slow. \r\nI can't use GPU due to memory limit, so I'm looking at CPU execution. \r\n\r\n2D convolutions in TensorFlow seem to be well-optimized, all CPU cores are used, performance is just few times below GPU.\r\n\r\nWith 3D convolutions - the difference is orders of magnitude. \r\n\r\nAlso, I've compared with Theano. Theano 3D convolutions run on single core but still are 10 times faster.\r\n\r\nStrangely, TF uses all cores on CPU with 3Dconv,  so there must be some bug or extreme inefficiency in implementation.\r\n\r\nWith the same small test model (just couple of 3d conv layers) I get 1 second epoch time on GPU (both TF and Theano, theano just a bit faster), 5 seconds on CPU Theano single threaded, and 50 seconds with (seemingly) multi-threded TF\r\n\r\n### Environment info\r\nI've tried different TF versions from 0.12 to 1.00, installed from pip. Latest one from https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.0.0-cp35-cp35m-linux_x86_64.whl\r\n\r\nThe OS is CentOS Linux release 7.2.1511 (Core) , kernel 3.10.0-327.18.2.el7.x86_64\r\n\r\nI'm using Keras back-end, so I can't be 100% sure if the problem is not in the way Keras translates Convolution3D call into TF primitives, but it does not seem likely. \r\n\r\ncheers\r\nAlex"}