{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14557", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14557/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14557/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14557/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/14557", "id": 273901577, "node_id": "MDExOlB1bGxSZXF1ZXN0MTUyNTg2NjQ3", "number": 14557, "title": "Improve SkipNBytes to RandomInputStream ", "user": {"login": "yongtang", "id": 6932348, "node_id": "MDQ6VXNlcjY5MzIzNDg=", "avatar_url": "https://avatars0.githubusercontent.com/u/6932348?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yongtang", "html_url": "https://github.com/yongtang", "followers_url": "https://api.github.com/users/yongtang/followers", "following_url": "https://api.github.com/users/yongtang/following{/other_user}", "gists_url": "https://api.github.com/users/yongtang/gists{/gist_id}", "starred_url": "https://api.github.com/users/yongtang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yongtang/subscriptions", "organizations_url": "https://api.github.com/users/yongtang/orgs", "repos_url": "https://api.github.com/users/yongtang/repos", "events_url": "https://api.github.com/users/yongtang/events{/privacy}", "received_events_url": "https://api.github.com/users/yongtang/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 390482148, "node_id": "MDU6TGFiZWwzOTA0ODIxNDg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/awaiting%20review", "name": "awaiting review", "color": "fef2c0", "default": false}, {"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}, {"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "jhseu", "id": 170179, "node_id": "MDQ6VXNlcjE3MDE3OQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/170179?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhseu", "html_url": "https://github.com/jhseu", "followers_url": "https://api.github.com/users/jhseu/followers", "following_url": "https://api.github.com/users/jhseu/following{/other_user}", "gists_url": "https://api.github.com/users/jhseu/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhseu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhseu/subscriptions", "organizations_url": "https://api.github.com/users/jhseu/orgs", "repos_url": "https://api.github.com/users/jhseu/repos", "events_url": "https://api.github.com/users/jhseu/events{/privacy}", "received_events_url": "https://api.github.com/users/jhseu/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jhseu", "id": 170179, "node_id": "MDQ6VXNlcjE3MDE3OQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/170179?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhseu", "html_url": "https://github.com/jhseu", "followers_url": "https://api.github.com/users/jhseu/followers", "following_url": "https://api.github.com/users/jhseu/following{/other_user}", "gists_url": "https://api.github.com/users/jhseu/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhseu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhseu/subscriptions", "organizations_url": "https://api.github.com/users/jhseu/orgs", "repos_url": "https://api.github.com/users/jhseu/repos", "events_url": "https://api.github.com/users/jhseu/events{/privacy}", "received_events_url": "https://api.github.com/users/jhseu/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2017-11-14T18:48:17Z", "updated_at": "2018-01-25T17:46:03Z", "closed_at": "2018-01-25T17:42:56Z", "author_association": "MEMBER", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/14557", "html_url": "https://github.com/tensorflow/tensorflow/pull/14557", "diff_url": "https://github.com/tensorflow/tensorflow/pull/14557.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/14557.patch"}, "body_html": "<p>This fix tries to address the issue raised in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"273327954\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/14512\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/14512/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/14512\">#14512</a> where SkipNBytes will takes a long time. In existing implementation, it needs to read through the file even though it is possible to random access the file itself.</p>\n<p>This fix convert SkipNBytes in InputStreamInterface to pure virtual so that it is possible to have different implementations based on the underlying file type (seekable vs. no seekable)</p>\n<p>This fix then have a specialized implementation in <code>RandomInputStream</code> so that</p>\n<ol>\n<li>The <code>SkipNBytes</code> will first try to read 1 bytes from <code>expected_pos - 1</code>, if completed, then return.</li>\n<li>If an out of range error returned from last step, then we don't know how far away we are from the EOF. We are forced to read through the file from the current pos all the way to <code>expected_pos</code>. This is similar to existing implementation.</li>\n</ol>\n<p>Note: Because <code>RandomAccessFile</code> only exposes <code>Read</code> (with start offset), not <code>SizeOfFile</code>, it is not possible to just move the position marker as we won't know where is the EOF.</p>\n<p>One potential improvement could be to expose a <code>SizeOfFile</code> in <code>RandomAccessFile</code>. That means adding additional changes. It could be added if it is agreed.</p>\n<p>This fix <span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #14512.\">fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"273327954\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/14512\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/14512/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/14512\">#14512</a>.</p>\n<p>Signed-off-by: Yong Tang <a href=\"mailto:yong.tang.github@outlook.com\">yong.tang.github@outlook.com</a></p>", "body_text": "This fix tries to address the issue raised in #14512 where SkipNBytes will takes a long time. In existing implementation, it needs to read through the file even though it is possible to random access the file itself.\nThis fix convert SkipNBytes in InputStreamInterface to pure virtual so that it is possible to have different implementations based on the underlying file type (seekable vs. no seekable)\nThis fix then have a specialized implementation in RandomInputStream so that\n\nThe SkipNBytes will first try to read 1 bytes from expected_pos - 1, if completed, then return.\nIf an out of range error returned from last step, then we don't know how far away we are from the EOF. We are forced to read through the file from the current pos all the way to expected_pos. This is similar to existing implementation.\n\nNote: Because RandomAccessFile only exposes Read (with start offset), not SizeOfFile, it is not possible to just move the position marker as we won't know where is the EOF.\nOne potential improvement could be to expose a SizeOfFile in RandomAccessFile. That means adding additional changes. It could be added if it is agreed.\nThis fix fixes #14512.\nSigned-off-by: Yong Tang yong.tang.github@outlook.com", "body": "This fix tries to address the issue raised in #14512 where SkipNBytes will takes a long time. In existing implementation, it needs to read through the file even though it is possible to random access the file itself.\r\n\r\nThis fix convert SkipNBytes in InputStreamInterface to pure virtual so that it is possible to have different implementations based on the underlying file type (seekable vs. no seekable)\r\n\r\nThis fix then have a specialized implementation in `RandomInputStream` so that\r\n1. The `SkipNBytes` will first try to read 1 bytes from `expected_pos - 1`, if completed, then return.\r\n2. If an out of range error returned from last step, then we don't know how far away we are from the EOF. We are forced to read through the file from the current pos all the way to `expected_pos`. This is similar to existing implementation.\r\n\r\nNote: Because `RandomAccessFile` only exposes `Read` (with start offset), not `SizeOfFile`, it is not possible to just move the position marker as we won't know where is the EOF.\r\n\r\nOne potential improvement could be to expose a `SizeOfFile` in `RandomAccessFile`. That means adding additional changes. It could be added if it is agreed.\r\n\r\nThis fix fixes #14512.\r\n\r\nSigned-off-by: Yong Tang <yong.tang.github@outlook.com>"}