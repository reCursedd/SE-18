{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19570", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19570/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19570/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19570/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/19570", "id": 326724438, "node_id": "MDU6SXNzdWUzMjY3MjQ0Mzg=", "number": 19570, "title": "[Bug] Very slow operation of Cumsum in tensorflow 1.6", "user": {"login": "jianlong-yuan", "id": 18137551, "node_id": "MDQ6VXNlcjE4MTM3NTUx", "avatar_url": "https://avatars0.githubusercontent.com/u/18137551?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jianlong-yuan", "html_url": "https://github.com/jianlong-yuan", "followers_url": "https://api.github.com/users/jianlong-yuan/followers", "following_url": "https://api.github.com/users/jianlong-yuan/following{/other_user}", "gists_url": "https://api.github.com/users/jianlong-yuan/gists{/gist_id}", "starred_url": "https://api.github.com/users/jianlong-yuan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jianlong-yuan/subscriptions", "organizations_url": "https://api.github.com/users/jianlong-yuan/orgs", "repos_url": "https://api.github.com/users/jianlong-yuan/repos", "events_url": "https://api.github.com/users/jianlong-yuan/events{/privacy}", "received_events_url": "https://api.github.com/users/jianlong-yuan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2018-05-26T09:27:35Z", "updated_at": "2018-11-17T05:33:40Z", "closed_at": "2018-08-25T03:37:15Z", "author_association": "NONE", "body_html": "<p>It seems in tensorflow the tf.cumsum operation is extremely slow on GPU, and takes a huge amount of time (~99% of the total time).</p>\n<p>In Pytorch, as expected, the sort operation is the one that takes the most time, cumsum is virtually instant on GPU.</p>\n<p>I give an issues on other\u2018s\u2019 gitHub, we get conclusion that is cumsum is very slow aginst pytorch.</p>\n<p>we issue is <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"323876987\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/bermanmaxim/LovaszSoftmax/issues/6\" data-hovercard-type=\"issue\" data-hovercard-url=\"/bermanmaxim/LovaszSoftmax/issues/6/hovercard\" href=\"https://github.com/bermanmaxim/LovaszSoftmax/issues/6\">bermanmaxim/LovaszSoftmax#6</a></p>\n<p>code is <a href=\"https://github.com/bermanmaxim/LovaszSoftmax/tree/master/tensorflow\">https://github.com/bermanmaxim/LovaszSoftmax/tree/master/tensorflow</a></p>\n<pre><code>def lovasz_grad(gt_sorted):\n    \"\"\"\n    Computes gradient of the Lovasz extension w.r.t sorted errors\n    See Alg. 1 in paper\n    \"\"\"\n    gts = tf.reduce_sum(gt_sorted)\n    **intersection = gts - tf.cumsum(gt_sorted)\n    union = gts + tf.cumsum(1. - gt_sorted)**\n    jaccard = 1. - intersection / union\n    jaccard = tf.concat((jaccard[0:1], jaccard[1:] - jaccard[:-1]), 0)\n    return jaccard\n</code></pre>", "body_text": "It seems in tensorflow the tf.cumsum operation is extremely slow on GPU, and takes a huge amount of time (~99% of the total time).\nIn Pytorch, as expected, the sort operation is the one that takes the most time, cumsum is virtually instant on GPU.\nI give an issues on other\u2018s\u2019 gitHub, we get conclusion that is cumsum is very slow aginst pytorch.\nwe issue is bermanmaxim/LovaszSoftmax#6\ncode is https://github.com/bermanmaxim/LovaszSoftmax/tree/master/tensorflow\ndef lovasz_grad(gt_sorted):\n    \"\"\"\n    Computes gradient of the Lovasz extension w.r.t sorted errors\n    See Alg. 1 in paper\n    \"\"\"\n    gts = tf.reduce_sum(gt_sorted)\n    **intersection = gts - tf.cumsum(gt_sorted)\n    union = gts + tf.cumsum(1. - gt_sorted)**\n    jaccard = 1. - intersection / union\n    jaccard = tf.concat((jaccard[0:1], jaccard[1:] - jaccard[:-1]), 0)\n    return jaccard", "body": "It seems in tensorflow the tf.cumsum operation is extremely slow on GPU, and takes a huge amount of time (~99% of the total time).\r\n\r\nIn Pytorch, as expected, the sort operation is the one that takes the most time, cumsum is virtually instant on GPU.\r\n\r\nI give an issues on other\u2018s\u2019 gitHub, we get conclusion that is cumsum is very slow aginst pytorch.\r\n \r\nwe issue is https://github.com/bermanmaxim/LovaszSoftmax/issues/6\r\n\r\ncode is https://github.com/bermanmaxim/LovaszSoftmax/tree/master/tensorflow\r\n\r\n```\r\ndef lovasz_grad(gt_sorted):\r\n    \"\"\"\r\n    Computes gradient of the Lovasz extension w.r.t sorted errors\r\n    See Alg. 1 in paper\r\n    \"\"\"\r\n    gts = tf.reduce_sum(gt_sorted)\r\n    **intersection = gts - tf.cumsum(gt_sorted)\r\n    union = gts + tf.cumsum(1. - gt_sorted)**\r\n    jaccard = 1. - intersection / union\r\n    jaccard = tf.concat((jaccard[0:1], jaccard[1:] - jaccard[:-1]), 0)\r\n    return jaccard\r\n```"}