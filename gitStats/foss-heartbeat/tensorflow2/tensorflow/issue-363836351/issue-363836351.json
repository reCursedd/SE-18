{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22516", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22516/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22516/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22516/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/22516", "id": 363836351, "node_id": "MDU6SXNzdWUzNjM4MzYzNTE=", "number": 22516, "title": "TF Lite QuantizationUtilTest failure/bug", "user": {"login": "alexfru", "id": 2862502, "node_id": "MDQ6VXNlcjI4NjI1MDI=", "avatar_url": "https://avatars2.githubusercontent.com/u/2862502?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexfru", "html_url": "https://github.com/alexfru", "followers_url": "https://api.github.com/users/alexfru/followers", "following_url": "https://api.github.com/users/alexfru/following{/other_user}", "gists_url": "https://api.github.com/users/alexfru/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexfru/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexfru/subscriptions", "organizations_url": "https://api.github.com/users/alexfru/orgs", "repos_url": "https://api.github.com/users/alexfru/repos", "events_url": "https://api.github.com/users/alexfru/events{/privacy}", "received_events_url": "https://api.github.com/users/alexfru/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 750616506, "node_id": "MDU6TGFiZWw3NTA2MTY1MDY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:lite", "name": "comp:lite", "color": "0052cc", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "alanchiao", "id": 4323109, "node_id": "MDQ6VXNlcjQzMjMxMDk=", "avatar_url": "https://avatars2.githubusercontent.com/u/4323109?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alanchiao", "html_url": "https://github.com/alanchiao", "followers_url": "https://api.github.com/users/alanchiao/followers", "following_url": "https://api.github.com/users/alanchiao/following{/other_user}", "gists_url": "https://api.github.com/users/alanchiao/gists{/gist_id}", "starred_url": "https://api.github.com/users/alanchiao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alanchiao/subscriptions", "organizations_url": "https://api.github.com/users/alanchiao/orgs", "repos_url": "https://api.github.com/users/alanchiao/repos", "events_url": "https://api.github.com/users/alanchiao/events{/privacy}", "received_events_url": "https://api.github.com/users/alanchiao/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "alanchiao", "id": 4323109, "node_id": "MDQ6VXNlcjQzMjMxMDk=", "avatar_url": "https://avatars2.githubusercontent.com/u/4323109?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alanchiao", "html_url": "https://github.com/alanchiao", "followers_url": "https://api.github.com/users/alanchiao/followers", "following_url": "https://api.github.com/users/alanchiao/following{/other_user}", "gists_url": "https://api.github.com/users/alanchiao/gists{/gist_id}", "starred_url": "https://api.github.com/users/alanchiao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alanchiao/subscriptions", "organizations_url": "https://api.github.com/users/alanchiao/orgs", "repos_url": "https://api.github.com/users/alanchiao/repos", "events_url": "https://api.github.com/users/alanchiao/events{/privacy}", "received_events_url": "https://api.github.com/users/alanchiao/received_events", "type": "User", "site_admin": false}, {"login": "wt-huang", "id": 42785337, "node_id": "MDQ6VXNlcjQyNzg1MzM3", "avatar_url": "https://avatars0.githubusercontent.com/u/42785337?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wt-huang", "html_url": "https://github.com/wt-huang", "followers_url": "https://api.github.com/users/wt-huang/followers", "following_url": "https://api.github.com/users/wt-huang/following{/other_user}", "gists_url": "https://api.github.com/users/wt-huang/gists{/gist_id}", "starred_url": "https://api.github.com/users/wt-huang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wt-huang/subscriptions", "organizations_url": "https://api.github.com/users/wt-huang/orgs", "repos_url": "https://api.github.com/users/wt-huang/repos", "events_url": "https://api.github.com/users/wt-huang/events{/privacy}", "received_events_url": "https://api.github.com/users/wt-huang/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2018-09-26T02:42:16Z", "updated_at": "2018-10-04T18:00:06Z", "closed_at": "2018-10-04T18:00:06Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: No</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: MIPS32 Linux</li>\n<li><strong>Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device</strong>: N/A</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: source</li>\n<li><strong>TensorFlow version (use command below)</strong>: SHA: <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/8c2159a10e53e5301ae26c739a3d09fa53d3352e/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/8c2159a10e53e5301ae26c739a3d09fa53d3352e\"><tt>8c2159a</tt></a></li>\n<li><strong>Python version</strong>: N/A</li>\n<li><strong>Bazel version (if compiling from source)</strong>: 0.16.1</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: mips-mti-linux-gnu-g++ (Codescape GNU Tools 2017.10-05 for MIPS MTI Linux) 6.3.0</li>\n<li><strong>CUDA/cuDNN version</strong>: N/A</li>\n<li><strong>GPU model and memory</strong>: N/A</li>\n<li><strong>Exact command to reproduce</strong>: Too complicated</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>TensorFlow Lite test quantization_util_test failure:</p>\n<pre><code>[==========] Running 17 tests from 1 test case.\n[----------] Global test environment set-up.\n[----------] 17 tests from QuantizationUtilTest\n[ RUN      ] QuantizationUtilTest.SafeCast\n[       OK ] QuantizationUtilTest.SafeCast (12 ms)\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParams\n[       OK ] QuantizationUtilTest.ChooseQuantizationParams (1 ms)\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParamsZeroPointOnMinBoundary\n[       OK ] QuantizationUtilTest.ChooseQuantizationParamsZeroPointOnMinBoundary (0 ms)\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParamsZeroNotInRange\n[       OK ] QuantizationUtilTest.ChooseQuantizationParamsZeroNotInRange (179 ms)\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParamsEmptyRangePositive\n[       OK ] QuantizationUtilTest.ChooseQuantizationParamsEmptyRangePositive (112 ms)\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParamsEmptyRangeZero\n[       OK ] QuantizationUtilTest.ChooseQuantizationParamsEmptyRangeZero (0 ms)\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParamsZeroPointOnMaxBoundary\n[       OK ] QuantizationUtilTest.ChooseQuantizationParamsZeroPointOnMaxBoundary (0 ms)\n[ RUN      ] QuantizationUtilTest.IntegerFrExp\n[       OK ] QuantizationUtilTest.IntegerFrExp (1 ms)\n[ RUN      ] QuantizationUtilTest.IntegerFrExpVersusDouble\ntensorflow/contrib/lite/kernels/internal/quantization_util_test.cc:262: Failure\nThe difference between result and (0.964453 * (1L &lt;&lt; 31)) is 4142294361.764544, which exceeds 1000, where\nresult evaluates to 2071147315,\n(0.964453 * (1L &lt;&lt; 31)) evaluates to -2071147046.764544, and\n1000 evaluates to 1000.\n[  FAILED  ] QuantizationUtilTest.IntegerFrExpVersusDouble (4 ms)\n[ RUN      ] QuantizationUtilTest.DoubleFromFractionAndShift\n[       OK ] QuantizationUtilTest.DoubleFromFractionAndShift (1 ms)\n[ RUN      ] QuantizationUtilTest.IntegerDoubleMultiply\n[       OK ] QuantizationUtilTest.IntegerDoubleMultiply (0 ms)\n[ RUN      ] QuantizationUtilTest.IntegerDoubleCompare\n[       OK ] QuantizationUtilTest.IntegerDoubleCompare (1 ms)\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParamsInvalidRange\n[       OK ] QuantizationUtilTest.ChooseQuantizationParamsInvalidRange (110 ms)\n[ RUN      ] QuantizationUtilTest.QuantizeMultiplierSmallerThanOneExp\n[       OK ] QuantizationUtilTest.QuantizeMultiplierSmallerThanOneExp (581 ms)\n[ RUN      ] QuantizationUtilTest.QuantizeMultiplierGreaterThanOne\n[       OK ] QuantizationUtilTest.QuantizeMultiplierGreaterThanOne (103 ms)\n[ RUN      ] QuantizationUtilTest.PreprocessSoftmaxScaling\n[       OK ] QuantizationUtilTest.PreprocessSoftmaxScaling (1 ms)\n[ RUN      ] QuantizationUtilTest.CalculateInputRadius\n[       OK ] QuantizationUtilTest.CalculateInputRadius (0 ms)\n[----------] 17 tests from QuantizationUtilTest (1106 ms total)\n\n[----------] Global test environment tear-down\n[==========] 17 tests from 1 test case ran. (1109 ms total)\n[  PASSED  ] 16 tests.\n[  FAILED  ] 1 test, listed below:\n[  FAILED  ] QuantizationUtilTest.IntegerFrExpVersusDouble\n\n 1 FAILED TEST\nTest quantization_util_test failed!\n</code></pre>\n<p>Looks like there's undefined behavior in the test. The test expects a 64-bit long, whereas it's 32-bit on MIPS32. Changing <code>1L</code> to <code>1LL</code> fixes the failure.</p>\n<h3>Source code / logs</h3>\n<p>See above.</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): No\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): MIPS32 Linux\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: N/A\nTensorFlow installed from (source or binary): source\nTensorFlow version (use command below): SHA: 8c2159a\nPython version: N/A\nBazel version (if compiling from source): 0.16.1\nGCC/Compiler version (if compiling from source): mips-mti-linux-gnu-g++ (Codescape GNU Tools 2017.10-05 for MIPS MTI Linux) 6.3.0\nCUDA/cuDNN version: N/A\nGPU model and memory: N/A\nExact command to reproduce: Too complicated\n\nDescribe the problem\nTensorFlow Lite test quantization_util_test failure:\n[==========] Running 17 tests from 1 test case.\n[----------] Global test environment set-up.\n[----------] 17 tests from QuantizationUtilTest\n[ RUN      ] QuantizationUtilTest.SafeCast\n[       OK ] QuantizationUtilTest.SafeCast (12 ms)\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParams\n[       OK ] QuantizationUtilTest.ChooseQuantizationParams (1 ms)\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParamsZeroPointOnMinBoundary\n[       OK ] QuantizationUtilTest.ChooseQuantizationParamsZeroPointOnMinBoundary (0 ms)\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParamsZeroNotInRange\n[       OK ] QuantizationUtilTest.ChooseQuantizationParamsZeroNotInRange (179 ms)\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParamsEmptyRangePositive\n[       OK ] QuantizationUtilTest.ChooseQuantizationParamsEmptyRangePositive (112 ms)\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParamsEmptyRangeZero\n[       OK ] QuantizationUtilTest.ChooseQuantizationParamsEmptyRangeZero (0 ms)\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParamsZeroPointOnMaxBoundary\n[       OK ] QuantizationUtilTest.ChooseQuantizationParamsZeroPointOnMaxBoundary (0 ms)\n[ RUN      ] QuantizationUtilTest.IntegerFrExp\n[       OK ] QuantizationUtilTest.IntegerFrExp (1 ms)\n[ RUN      ] QuantizationUtilTest.IntegerFrExpVersusDouble\ntensorflow/contrib/lite/kernels/internal/quantization_util_test.cc:262: Failure\nThe difference between result and (0.964453 * (1L << 31)) is 4142294361.764544, which exceeds 1000, where\nresult evaluates to 2071147315,\n(0.964453 * (1L << 31)) evaluates to -2071147046.764544, and\n1000 evaluates to 1000.\n[  FAILED  ] QuantizationUtilTest.IntegerFrExpVersusDouble (4 ms)\n[ RUN      ] QuantizationUtilTest.DoubleFromFractionAndShift\n[       OK ] QuantizationUtilTest.DoubleFromFractionAndShift (1 ms)\n[ RUN      ] QuantizationUtilTest.IntegerDoubleMultiply\n[       OK ] QuantizationUtilTest.IntegerDoubleMultiply (0 ms)\n[ RUN      ] QuantizationUtilTest.IntegerDoubleCompare\n[       OK ] QuantizationUtilTest.IntegerDoubleCompare (1 ms)\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParamsInvalidRange\n[       OK ] QuantizationUtilTest.ChooseQuantizationParamsInvalidRange (110 ms)\n[ RUN      ] QuantizationUtilTest.QuantizeMultiplierSmallerThanOneExp\n[       OK ] QuantizationUtilTest.QuantizeMultiplierSmallerThanOneExp (581 ms)\n[ RUN      ] QuantizationUtilTest.QuantizeMultiplierGreaterThanOne\n[       OK ] QuantizationUtilTest.QuantizeMultiplierGreaterThanOne (103 ms)\n[ RUN      ] QuantizationUtilTest.PreprocessSoftmaxScaling\n[       OK ] QuantizationUtilTest.PreprocessSoftmaxScaling (1 ms)\n[ RUN      ] QuantizationUtilTest.CalculateInputRadius\n[       OK ] QuantizationUtilTest.CalculateInputRadius (0 ms)\n[----------] 17 tests from QuantizationUtilTest (1106 ms total)\n\n[----------] Global test environment tear-down\n[==========] 17 tests from 1 test case ran. (1109 ms total)\n[  PASSED  ] 16 tests.\n[  FAILED  ] 1 test, listed below:\n[  FAILED  ] QuantizationUtilTest.IntegerFrExpVersusDouble\n\n 1 FAILED TEST\nTest quantization_util_test failed!\n\nLooks like there's undefined behavior in the test. The test expects a 64-bit long, whereas it's 32-bit on MIPS32. Changing 1L to 1LL fixes the failure.\nSource code / logs\nSee above.", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: MIPS32 Linux\r\n- **Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device**: N/A\r\n- **TensorFlow installed from (source or binary)**: source\r\n- **TensorFlow version (use command below)**: SHA: 8c2159a10e53e5301ae26c739a3d09fa53d3352e\r\n- **Python version**: N/A\r\n- **Bazel version (if compiling from source)**: 0.16.1\r\n- **GCC/Compiler version (if compiling from source)**: mips-mti-linux-gnu-g++ (Codescape GNU Tools 2017.10-05 for MIPS MTI Linux) 6.3.0\r\n- **CUDA/cuDNN version**: N/A\r\n- **GPU model and memory**: N/A\r\n- **Exact command to reproduce**: Too complicated\r\n\r\n### Describe the problem\r\nTensorFlow Lite test quantization_util_test failure:\r\n~~~\r\n[==========] Running 17 tests from 1 test case.\r\n[----------] Global test environment set-up.\r\n[----------] 17 tests from QuantizationUtilTest\r\n[ RUN      ] QuantizationUtilTest.SafeCast\r\n[       OK ] QuantizationUtilTest.SafeCast (12 ms)\r\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParams\r\n[       OK ] QuantizationUtilTest.ChooseQuantizationParams (1 ms)\r\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParamsZeroPointOnMinBoundary\r\n[       OK ] QuantizationUtilTest.ChooseQuantizationParamsZeroPointOnMinBoundary (0 ms)\r\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParamsZeroNotInRange\r\n[       OK ] QuantizationUtilTest.ChooseQuantizationParamsZeroNotInRange (179 ms)\r\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParamsEmptyRangePositive\r\n[       OK ] QuantizationUtilTest.ChooseQuantizationParamsEmptyRangePositive (112 ms)\r\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParamsEmptyRangeZero\r\n[       OK ] QuantizationUtilTest.ChooseQuantizationParamsEmptyRangeZero (0 ms)\r\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParamsZeroPointOnMaxBoundary\r\n[       OK ] QuantizationUtilTest.ChooseQuantizationParamsZeroPointOnMaxBoundary (0 ms)\r\n[ RUN      ] QuantizationUtilTest.IntegerFrExp\r\n[       OK ] QuantizationUtilTest.IntegerFrExp (1 ms)\r\n[ RUN      ] QuantizationUtilTest.IntegerFrExpVersusDouble\r\ntensorflow/contrib/lite/kernels/internal/quantization_util_test.cc:262: Failure\r\nThe difference between result and (0.964453 * (1L << 31)) is 4142294361.764544, which exceeds 1000, where\r\nresult evaluates to 2071147315,\r\n(0.964453 * (1L << 31)) evaluates to -2071147046.764544, and\r\n1000 evaluates to 1000.\r\n[  FAILED  ] QuantizationUtilTest.IntegerFrExpVersusDouble (4 ms)\r\n[ RUN      ] QuantizationUtilTest.DoubleFromFractionAndShift\r\n[       OK ] QuantizationUtilTest.DoubleFromFractionAndShift (1 ms)\r\n[ RUN      ] QuantizationUtilTest.IntegerDoubleMultiply\r\n[       OK ] QuantizationUtilTest.IntegerDoubleMultiply (0 ms)\r\n[ RUN      ] QuantizationUtilTest.IntegerDoubleCompare\r\n[       OK ] QuantizationUtilTest.IntegerDoubleCompare (1 ms)\r\n[ RUN      ] QuantizationUtilTest.ChooseQuantizationParamsInvalidRange\r\n[       OK ] QuantizationUtilTest.ChooseQuantizationParamsInvalidRange (110 ms)\r\n[ RUN      ] QuantizationUtilTest.QuantizeMultiplierSmallerThanOneExp\r\n[       OK ] QuantizationUtilTest.QuantizeMultiplierSmallerThanOneExp (581 ms)\r\n[ RUN      ] QuantizationUtilTest.QuantizeMultiplierGreaterThanOne\r\n[       OK ] QuantizationUtilTest.QuantizeMultiplierGreaterThanOne (103 ms)\r\n[ RUN      ] QuantizationUtilTest.PreprocessSoftmaxScaling\r\n[       OK ] QuantizationUtilTest.PreprocessSoftmaxScaling (1 ms)\r\n[ RUN      ] QuantizationUtilTest.CalculateInputRadius\r\n[       OK ] QuantizationUtilTest.CalculateInputRadius (0 ms)\r\n[----------] 17 tests from QuantizationUtilTest (1106 ms total)\r\n\r\n[----------] Global test environment tear-down\r\n[==========] 17 tests from 1 test case ran. (1109 ms total)\r\n[  PASSED  ] 16 tests.\r\n[  FAILED  ] 1 test, listed below:\r\n[  FAILED  ] QuantizationUtilTest.IntegerFrExpVersusDouble\r\n\r\n 1 FAILED TEST\r\nTest quantization_util_test failed!\r\n~~~\r\nLooks like there's undefined behavior in the test. The test expects a 64-bit long, whereas it's 32-bit on MIPS32. Changing `1L` to `1LL` fixes the failure.\r\n\r\n### Source code / logs\r\nSee above.\r\n"}