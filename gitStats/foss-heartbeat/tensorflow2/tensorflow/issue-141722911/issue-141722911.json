{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1535", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1535/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1535/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1535/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/1535", "id": 141722911, "node_id": "MDU6SXNzdWUxNDE3MjI5MTE=", "number": 1535, "title": "google.protobuf imports are resolving to /usr/local instead of TF's local copy", "user": {"login": "jlebar", "id": 150663, "node_id": "MDQ6VXNlcjE1MDY2Mw==", "avatar_url": "https://avatars1.githubusercontent.com/u/150663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jlebar", "html_url": "https://github.com/jlebar", "followers_url": "https://api.github.com/users/jlebar/followers", "following_url": "https://api.github.com/users/jlebar/following{/other_user}", "gists_url": "https://api.github.com/users/jlebar/gists{/gist_id}", "starred_url": "https://api.github.com/users/jlebar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jlebar/subscriptions", "organizations_url": "https://api.github.com/users/jlebar/orgs", "repos_url": "https://api.github.com/users/jlebar/repos", "events_url": "https://api.github.com/users/jlebar/events{/privacy}", "received_events_url": "https://api.github.com/users/jlebar/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "keveman", "id": 229914, "node_id": "MDQ6VXNlcjIyOTkxNA==", "avatar_url": "https://avatars1.githubusercontent.com/u/229914?v=4", "gravatar_id": "", "url": "https://api.github.com/users/keveman", "html_url": "https://github.com/keveman", "followers_url": "https://api.github.com/users/keveman/followers", "following_url": "https://api.github.com/users/keveman/following{/other_user}", "gists_url": "https://api.github.com/users/keveman/gists{/gist_id}", "starred_url": "https://api.github.com/users/keveman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/keveman/subscriptions", "organizations_url": "https://api.github.com/users/keveman/orgs", "repos_url": "https://api.github.com/users/keveman/repos", "events_url": "https://api.github.com/users/keveman/events{/privacy}", "received_events_url": "https://api.github.com/users/keveman/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "keveman", "id": 229914, "node_id": "MDQ6VXNlcjIyOTkxNA==", "avatar_url": "https://avatars1.githubusercontent.com/u/229914?v=4", "gravatar_id": "", "url": "https://api.github.com/users/keveman", "html_url": "https://github.com/keveman", "followers_url": "https://api.github.com/users/keveman/followers", "following_url": "https://api.github.com/users/keveman/following{/other_user}", "gists_url": "https://api.github.com/users/keveman/gists{/gist_id}", "starred_url": "https://api.github.com/users/keveman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/keveman/subscriptions", "organizations_url": "https://api.github.com/users/keveman/orgs", "repos_url": "https://api.github.com/users/keveman/repos", "events_url": "https://api.github.com/users/keveman/events{/privacy}", "received_events_url": "https://api.github.com/users/keveman/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2016-03-17T22:28:54Z", "updated_at": "2016-09-25T07:10:08Z", "closed_at": "2016-06-13T22:08:38Z", "author_association": "MEMBER", "body_html": "<h3>Environment info</h3>\n<p>Operating System: Current Goobuntu</p>\n<p>TF commit <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/945a4b4cd12df0fdf3f0cc24b128bb4ce66ebf88/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/945a4b4cd12df0fdf3f0cc24b128bb4ce66ebf88\"><tt>945a4b4</tt></a><br>\n<a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/protocolbuffers/protobuf/commit/fb714b3606bd663b823f6960a73d052f97283b74/hovercard\" href=\"https://github.com/protocolbuffers/protobuf/commit/fb714b3606bd663b823f6960a73d052f97283b74\">protocolbuffers/protobuf@<tt>fb714b3</tt></a></p>\n<h3>Steps to reproduce</h3>\n<pre><code>$ bazel run -c opt //tensorflow/python:default_platform__resource_loader_test\n</code></pre>\n<p>Results in</p>\n<pre><code>Traceback (most recent call last):\n  File \"/usr/local/google/home/jlebar/.cache/bazel/_bazel_jlebar/b1c0b5b92791600151e68af1e7d712c0/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/default_platform__resource_loader_test.runfiles/tensorflow/python/platform/default/_resource_loader_test.py\", line 20, in &lt;module&gt;\nfrom tensorflow.python.platform import googletest\n  File \"/usr/local/google/home/jlebar/.cache/bazel/_bazel_jlebar/b1c0b5b92791600151e68af1e7d712c0/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/default_platform__resource_loader_test.runfiles/tensorflow/__init__.py\", line 23, in &lt;module&gt;\nfrom tensorflow.python import *\n  File \"/usr/local/google/home/jlebar/.cache/bazel/_bazel_jlebar/b1c0b5b92791600151e68af1e7d712c0/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/default_platform__resource_loader_test.runfiles/tensorflow/python/__init__.py\", line 49, in &lt;module&gt;\nfrom tensorflow.core.framework.graph_pb2 import *\n  File \"/usr/local/google/home/jlebar/.cache/bazel/_bazel_jlebar/b1c0b5b92791600151e68af1e7d712c0/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/default_platform__resource_loader_test.runfiles/tensorflow/core/framework/graph_pb2.py\", line 9, in &lt;module&gt;\nfrom google.protobuf import symbol_database as _symbol_database\n  File \"/usr/local/google/home/jlebar/.cache/bazel/_bazel_jlebar/b1c0b5b92791600151e68af1e7d712c0/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/default_platform__resource_loader_test.runfiles/google/protobuf/symbol_database.py\", line 186, in &lt;module&gt;\n_DEFAULT = SymbolDatabase(pool=descriptor_pool.Default())\nAttributeError: 'module' object has no attribute 'Default'\n</code></pre>\n<p>With <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=3949752\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/Yhg1s\">@Yhg1s</a> help, I've traced this down some, but now I'm stuck.</p>\n<p>The issue seems to be that the descriptor_pool we import is not TF's local copy, but is instead the copy from /usr/lib/python2.7/dist-packages.</p>\n<p>TF's local copy of symbol_database.py imports google.protobuf.descriptor_pool, and when it does so, it has the correct sys.path.  Yet somehow we end up at the wrong descriptor_pool.</p>\n<p>Thomas's idea was that maybe we're importing google from the wrong path before this point, and that's what's causing us to find the wrong path to descriptor_pool.  Indeed, judging from a -vv log [1], this seems to be the case.</p>\n<p>Here we import TF's local copy of google, and then <em>reimport</em> it from /usr/lib.  Python doesn't normally do this, so Thomas's idea was that someone may be messing with sys.modules or performing other dark rituals.</p>\n<p>At this point I'm kind of lost.</p>\n<p>I suspect things will work fine if I use a virtualenv, and Thomas gave me enough of an idea of how to do this.  But the build should work without that, right?  (It's not even documented how to build within a virtualenv.)</p>\n<p>[1] <a href=\"http://pastebin.com/raw/M3PTCTfY\" rel=\"nofollow\">http://pastebin.com/raw/M3PTCTfY</a></p>\n<p>(Edit: Wrong twouters.)</p>", "body_text": "Environment info\nOperating System: Current Goobuntu\nTF commit 945a4b4\nprotocolbuffers/protobuf@fb714b3\nSteps to reproduce\n$ bazel run -c opt //tensorflow/python:default_platform__resource_loader_test\n\nResults in\nTraceback (most recent call last):\n  File \"/usr/local/google/home/jlebar/.cache/bazel/_bazel_jlebar/b1c0b5b92791600151e68af1e7d712c0/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/default_platform__resource_loader_test.runfiles/tensorflow/python/platform/default/_resource_loader_test.py\", line 20, in <module>\nfrom tensorflow.python.platform import googletest\n  File \"/usr/local/google/home/jlebar/.cache/bazel/_bazel_jlebar/b1c0b5b92791600151e68af1e7d712c0/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/default_platform__resource_loader_test.runfiles/tensorflow/__init__.py\", line 23, in <module>\nfrom tensorflow.python import *\n  File \"/usr/local/google/home/jlebar/.cache/bazel/_bazel_jlebar/b1c0b5b92791600151e68af1e7d712c0/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/default_platform__resource_loader_test.runfiles/tensorflow/python/__init__.py\", line 49, in <module>\nfrom tensorflow.core.framework.graph_pb2 import *\n  File \"/usr/local/google/home/jlebar/.cache/bazel/_bazel_jlebar/b1c0b5b92791600151e68af1e7d712c0/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/default_platform__resource_loader_test.runfiles/tensorflow/core/framework/graph_pb2.py\", line 9, in <module>\nfrom google.protobuf import symbol_database as _symbol_database\n  File \"/usr/local/google/home/jlebar/.cache/bazel/_bazel_jlebar/b1c0b5b92791600151e68af1e7d712c0/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/default_platform__resource_loader_test.runfiles/google/protobuf/symbol_database.py\", line 186, in <module>\n_DEFAULT = SymbolDatabase(pool=descriptor_pool.Default())\nAttributeError: 'module' object has no attribute 'Default'\n\nWith @Yhg1s help, I've traced this down some, but now I'm stuck.\nThe issue seems to be that the descriptor_pool we import is not TF's local copy, but is instead the copy from /usr/lib/python2.7/dist-packages.\nTF's local copy of symbol_database.py imports google.protobuf.descriptor_pool, and when it does so, it has the correct sys.path.  Yet somehow we end up at the wrong descriptor_pool.\nThomas's idea was that maybe we're importing google from the wrong path before this point, and that's what's causing us to find the wrong path to descriptor_pool.  Indeed, judging from a -vv log [1], this seems to be the case.\nHere we import TF's local copy of google, and then reimport it from /usr/lib.  Python doesn't normally do this, so Thomas's idea was that someone may be messing with sys.modules or performing other dark rituals.\nAt this point I'm kind of lost.\nI suspect things will work fine if I use a virtualenv, and Thomas gave me enough of an idea of how to do this.  But the build should work without that, right?  (It's not even documented how to build within a virtualenv.)\n[1] http://pastebin.com/raw/M3PTCTfY\n(Edit: Wrong twouters.)", "body": "### Environment info\n\nOperating System: Current Goobuntu\n\nTF commit 945a4b4cd12df0fdf3f0cc24b128bb4ce66ebf88\ngoogle/protobuf@fb714b3606bd663b823f6960a73d052f97283b74\n### Steps to reproduce\n\n```\n$ bazel run -c opt //tensorflow/python:default_platform__resource_loader_test\n```\n\nResults in\n\n```\nTraceback (most recent call last):\n  File \"/usr/local/google/home/jlebar/.cache/bazel/_bazel_jlebar/b1c0b5b92791600151e68af1e7d712c0/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/default_platform__resource_loader_test.runfiles/tensorflow/python/platform/default/_resource_loader_test.py\", line 20, in <module>\nfrom tensorflow.python.platform import googletest\n  File \"/usr/local/google/home/jlebar/.cache/bazel/_bazel_jlebar/b1c0b5b92791600151e68af1e7d712c0/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/default_platform__resource_loader_test.runfiles/tensorflow/__init__.py\", line 23, in <module>\nfrom tensorflow.python import *\n  File \"/usr/local/google/home/jlebar/.cache/bazel/_bazel_jlebar/b1c0b5b92791600151e68af1e7d712c0/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/default_platform__resource_loader_test.runfiles/tensorflow/python/__init__.py\", line 49, in <module>\nfrom tensorflow.core.framework.graph_pb2 import *\n  File \"/usr/local/google/home/jlebar/.cache/bazel/_bazel_jlebar/b1c0b5b92791600151e68af1e7d712c0/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/default_platform__resource_loader_test.runfiles/tensorflow/core/framework/graph_pb2.py\", line 9, in <module>\nfrom google.protobuf import symbol_database as _symbol_database\n  File \"/usr/local/google/home/jlebar/.cache/bazel/_bazel_jlebar/b1c0b5b92791600151e68af1e7d712c0/tensorflow/bazel-out/local_linux-opt/bin/tensorflow/python/default_platform__resource_loader_test.runfiles/google/protobuf/symbol_database.py\", line 186, in <module>\n_DEFAULT = SymbolDatabase(pool=descriptor_pool.Default())\nAttributeError: 'module' object has no attribute 'Default'\n```\n\nWith @Yhg1s help, I've traced this down some, but now I'm stuck.\n\nThe issue seems to be that the descriptor_pool we import is not TF's local copy, but is instead the copy from /usr/lib/python2.7/dist-packages.\n\nTF's local copy of symbol_database.py imports google.protobuf.descriptor_pool, and when it does so, it has the correct sys.path.  Yet somehow we end up at the wrong descriptor_pool.\n\nThomas's idea was that maybe we're importing google from the wrong path before this point, and that's what's causing us to find the wrong path to descriptor_pool.  Indeed, judging from a -vv log [1], this seems to be the case.\n\nHere we import TF's local copy of google, and then _reimport_ it from /usr/lib.  Python doesn't normally do this, so Thomas's idea was that someone may be messing with sys.modules or performing other dark rituals.\n\nAt this point I'm kind of lost.\n\nI suspect things will work fine if I use a virtualenv, and Thomas gave me enough of an idea of how to do this.  But the build should work without that, right?  (It's not even documented how to build within a virtualenv.)\n\n[1] http://pastebin.com/raw/M3PTCTfY\n\n(Edit: Wrong twouters.)\n"}