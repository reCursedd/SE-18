{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/437334520", "html_url": "https://github.com/tensorflow/tensorflow/issues/22595#issuecomment-437334520", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22595", "id": 437334520, "node_id": "MDEyOklzc3VlQ29tbWVudDQzNzMzNDUyMA==", "user": {"login": "Q82822", "id": 36806042, "node_id": "MDQ6VXNlcjM2ODA2MDQy", "avatar_url": "https://avatars2.githubusercontent.com/u/36806042?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Q82822", "html_url": "https://github.com/Q82822", "followers_url": "https://api.github.com/users/Q82822/followers", "following_url": "https://api.github.com/users/Q82822/following{/other_user}", "gists_url": "https://api.github.com/users/Q82822/gists{/gist_id}", "starred_url": "https://api.github.com/users/Q82822/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Q82822/subscriptions", "organizations_url": "https://api.github.com/users/Q82822/orgs", "repos_url": "https://api.github.com/users/Q82822/repos", "events_url": "https://api.github.com/users/Q82822/events{/privacy}", "received_events_url": "https://api.github.com/users/Q82822/received_events", "type": "User", "site_admin": false}, "created_at": "2018-11-09T11:37:14Z", "updated_at": "2018-11-09T14:02:40Z", "author_association": "NONE", "body_html": "<p>hi, this problem was figure out in new tensorflow 1.12 , but it stall have another problem.<br>\nIn this code will print error<br>\n<code> \"provided list of inputs contains objects other than 'EagerTensor'. Item 0 is Tensor\"</code><br>\nadd it happen in use Vgg16 model.</p>\n<p>This is the  code<a href=\"https://colab.research.google.com/github/tensorflow/tensorflow/blob/master/tensorflow/contrib/eager/python/examples/generative_examples/image_captioning_with_attention.ipynb#scrollTo=io7ws3ReRPGv\" rel=\"nofollow\"> here</a><br>\nchange the CNN model</p>\n<pre><code>img = tf.keras.applications.inception_v3.preprocess_input(img) ---&gt;img = tf.keras.applications.vgg16.preprocess_input(img)\n\nimage_model = tf.keras.applications.InceptionV3(include_top=False, weights='imagenet') ----&gt;image_model =tf.keras.applications.Vgg16(include_top=False, weights='imagenet')\n\n img = tf.image.resize_images(img, (299, 299))---&gt; img = tf.image.resize_images(img, (224, 224))\n\n</code></pre>\n<p>change the image features_shape &amp; attention_features_shape</p>\n<pre><code>features_shape = 2048 --&gt;512\nattention_features_shape = 64--&gt;81\n</code></pre>\n<p>problem code in here</p>\n<pre><code># captions on the validation set\nrid = np.random.randint(0, len(img_name_val))\nimage = img_name_val[rid]\nreal_caption = ' '.join([index_word[i] for i in cap_val[rid] if i not in [0]])\nresult, attention_plot = evaluate(image)\n\nprint ('Real Caption:', real_caption)\nprint ('Prediction Caption:', ' '.join(result))\nplot_attention(image, result, attention_plot)\n# opening the image\n`Image.open(img_name_val[rid])`\n</code></pre>\n<p>and error here</p>\n<pre><code>FallbackException                        Traceback (most recent call last)\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/ops/gen_array_ops.py in reshape(tensor, shape, name)\n   6494         _ctx._context_handle, _ctx._eager_context.device_name, \"Reshape\",\n-&gt; 6495         name, _ctx._post_execution_callbacks, tensor, shape)\n   6496       return _result\n\n_FallbackException: This function does not handle the case of the path where all inputs are not already EagerTensors.\n\nDuring handling of the above exception, another exception occurred:\n\nTypeError                                 Traceback (most recent call last)\n&lt;ipython-input-31-98d70c233c4f&gt; in &lt;module&gt;()\n      2 image = img_name_val[rid]\n      3 real_caption = ' '.join([index_word[i] for i in cap_val[rid] if i not in [0]])\n----&gt; 4 result, attention_plot = evaluate(image)\n      5 \n      6 print ('Real Caption:', real_caption)\n\n&lt;ipython-input-29-55980383ccd6&gt; in evaluate(image)\n      4     hidden = decoder.reset_state(batch_size=1)\n      5 \n----&gt; 6     temp_input = tf.expand_dims(load_image(image)[0], 0)\n      7     img_tensor_val = image_features_extract_model(temp_input)\n      8     img_tensor_val = tf.reshape(img_tensor_val, (img_tensor_val.shape[0], -1, img_tensor_val.shape[3]))\n\n&lt;ipython-input-5-28f690dfd033&gt; in load_image(image_path)\n      3     img = tf.image.decode_jpeg(img, channels=3)\n      4     img = tf.image.resize_images(img, (224, 224))\n----&gt; 5     img = tf.keras.applications.vgg16.preprocess_input(img)\n      6     return img, image_path\n\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/applications/__init__.py in wrapper(*args, **kwargs)\n     68       kwargs['models'] = models\n     69       kwargs['utils'] = utils\n---&gt; 70     return base_fun(*args, **kwargs)\n     71   return wrapper\n     72 \n\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/applications/vgg16.py in preprocess_input(*args, **kwargs)\n     42 @keras_modules_injection\n     43 def preprocess_input(*args, **kwargs):\n---&gt; 44   return vgg16.preprocess_input(*args, **kwargs)\n\n/usr/local/lib/python3.6/dist-packages/keras_applications/imagenet_utils.py in preprocess_input(x, data_format, mode, **kwargs)\n    193     else:\n    194         return _preprocess_symbolic_input(x, data_format=data_format,\n--&gt; 195                                           mode=mode, **kwargs)\n    196 \n    197 \n\n/usr/local/lib/python3.6/dist-packages/keras_applications/imagenet_utils.py in _preprocess_symbolic_input(x, data_format, mode, **kwargs)\n    149             data_format=data_format)\n    150     else:\n--&gt; 151         x = backend.bias_add(x, _IMAGENET_MEAN, data_format)\n    152     if std is not None:\n    153         x /= std\n\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/backend.py in bias_add(x, bias, data_format)\n   4595     elif data_format == 'channels_last':\n   4596       if len(bias_shape) == 1:\n-&gt; 4597         x = x + reshape(bias, (1, 1, bias_shape[0]))\n   4598       else:\n   4599         x = x + reshape(bias, (1,) + bias_shape)\n\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/backend.py in reshape(x, shape)\n   2279       A tensor.\n   2280   \"\"\"\n-&gt; 2281   return array_ops.reshape(x, shape)\n   2282 \n   2283 \n\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/ops/gen_array_ops.py in reshape(tensor, shape, name)\n   6497     except _core._FallbackException:\n   6498       return reshape_eager_fallback(\n-&gt; 6499           tensor, shape, name=name, ctx=_ctx)\n   6500     except _core._NotOkStatusException as e:\n   6501       if name is not None:\n\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/ops/gen_array_ops.py in reshape_eager_fallback(tensor, shape, name, ctx)\n   6516   _attrs = (\"T\", _attr_T, \"Tshape\", _attr_Tshape)\n   6517   _result = _execute.execute(b\"Reshape\", 1, inputs=_inputs_flat, attrs=_attrs,\n-&gt; 6518                              ctx=_ctx, name=name)\n   6519   _execute.record_gradient(\n   6520       \"Reshape\", _inputs_flat, _attrs, _result, name)\n\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/eager/execute.py in quick_execute(op_name, num_outputs, inputs, attrs, ctx, name)\n     58     tensors = pywrap_tensorflow.TFE_Py_Execute(ctx._handle, device_name,\n     59                                                op_name, inputs, attrs,\n---&gt; 60                                                num_outputs)\n     61   except core._NotOkStatusException as e:\n     62     if name is not None:\n\nTypeError: provided list of inputs contains objects other than 'EagerTensor'. Item 0 is Tensor\n</code></pre>\n<p>THX!!</p>", "body_text": "hi, this problem was figure out in new tensorflow 1.12 , but it stall have another problem.\nIn this code will print error\n \"provided list of inputs contains objects other than 'EagerTensor'. Item 0 is Tensor\"\nadd it happen in use Vgg16 model.\nThis is the  code here\nchange the CNN model\nimg = tf.keras.applications.inception_v3.preprocess_input(img) --->img = tf.keras.applications.vgg16.preprocess_input(img)\n\nimage_model = tf.keras.applications.InceptionV3(include_top=False, weights='imagenet') ---->image_model =tf.keras.applications.Vgg16(include_top=False, weights='imagenet')\n\n img = tf.image.resize_images(img, (299, 299))---> img = tf.image.resize_images(img, (224, 224))\n\n\nchange the image features_shape & attention_features_shape\nfeatures_shape = 2048 -->512\nattention_features_shape = 64-->81\n\nproblem code in here\n# captions on the validation set\nrid = np.random.randint(0, len(img_name_val))\nimage = img_name_val[rid]\nreal_caption = ' '.join([index_word[i] for i in cap_val[rid] if i not in [0]])\nresult, attention_plot = evaluate(image)\n\nprint ('Real Caption:', real_caption)\nprint ('Prediction Caption:', ' '.join(result))\nplot_attention(image, result, attention_plot)\n# opening the image\n`Image.open(img_name_val[rid])`\n\nand error here\nFallbackException                        Traceback (most recent call last)\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/ops/gen_array_ops.py in reshape(tensor, shape, name)\n   6494         _ctx._context_handle, _ctx._eager_context.device_name, \"Reshape\",\n-> 6495         name, _ctx._post_execution_callbacks, tensor, shape)\n   6496       return _result\n\n_FallbackException: This function does not handle the case of the path where all inputs are not already EagerTensors.\n\nDuring handling of the above exception, another exception occurred:\n\nTypeError                                 Traceback (most recent call last)\n<ipython-input-31-98d70c233c4f> in <module>()\n      2 image = img_name_val[rid]\n      3 real_caption = ' '.join([index_word[i] for i in cap_val[rid] if i not in [0]])\n----> 4 result, attention_plot = evaluate(image)\n      5 \n      6 print ('Real Caption:', real_caption)\n\n<ipython-input-29-55980383ccd6> in evaluate(image)\n      4     hidden = decoder.reset_state(batch_size=1)\n      5 \n----> 6     temp_input = tf.expand_dims(load_image(image)[0], 0)\n      7     img_tensor_val = image_features_extract_model(temp_input)\n      8     img_tensor_val = tf.reshape(img_tensor_val, (img_tensor_val.shape[0], -1, img_tensor_val.shape[3]))\n\n<ipython-input-5-28f690dfd033> in load_image(image_path)\n      3     img = tf.image.decode_jpeg(img, channels=3)\n      4     img = tf.image.resize_images(img, (224, 224))\n----> 5     img = tf.keras.applications.vgg16.preprocess_input(img)\n      6     return img, image_path\n\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/applications/__init__.py in wrapper(*args, **kwargs)\n     68       kwargs['models'] = models\n     69       kwargs['utils'] = utils\n---> 70     return base_fun(*args, **kwargs)\n     71   return wrapper\n     72 \n\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/applications/vgg16.py in preprocess_input(*args, **kwargs)\n     42 @keras_modules_injection\n     43 def preprocess_input(*args, **kwargs):\n---> 44   return vgg16.preprocess_input(*args, **kwargs)\n\n/usr/local/lib/python3.6/dist-packages/keras_applications/imagenet_utils.py in preprocess_input(x, data_format, mode, **kwargs)\n    193     else:\n    194         return _preprocess_symbolic_input(x, data_format=data_format,\n--> 195                                           mode=mode, **kwargs)\n    196 \n    197 \n\n/usr/local/lib/python3.6/dist-packages/keras_applications/imagenet_utils.py in _preprocess_symbolic_input(x, data_format, mode, **kwargs)\n    149             data_format=data_format)\n    150     else:\n--> 151         x = backend.bias_add(x, _IMAGENET_MEAN, data_format)\n    152     if std is not None:\n    153         x /= std\n\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/backend.py in bias_add(x, bias, data_format)\n   4595     elif data_format == 'channels_last':\n   4596       if len(bias_shape) == 1:\n-> 4597         x = x + reshape(bias, (1, 1, bias_shape[0]))\n   4598       else:\n   4599         x = x + reshape(bias, (1,) + bias_shape)\n\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/backend.py in reshape(x, shape)\n   2279       A tensor.\n   2280   \"\"\"\n-> 2281   return array_ops.reshape(x, shape)\n   2282 \n   2283 \n\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/ops/gen_array_ops.py in reshape(tensor, shape, name)\n   6497     except _core._FallbackException:\n   6498       return reshape_eager_fallback(\n-> 6499           tensor, shape, name=name, ctx=_ctx)\n   6500     except _core._NotOkStatusException as e:\n   6501       if name is not None:\n\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/ops/gen_array_ops.py in reshape_eager_fallback(tensor, shape, name, ctx)\n   6516   _attrs = (\"T\", _attr_T, \"Tshape\", _attr_Tshape)\n   6517   _result = _execute.execute(b\"Reshape\", 1, inputs=_inputs_flat, attrs=_attrs,\n-> 6518                              ctx=_ctx, name=name)\n   6519   _execute.record_gradient(\n   6520       \"Reshape\", _inputs_flat, _attrs, _result, name)\n\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/eager/execute.py in quick_execute(op_name, num_outputs, inputs, attrs, ctx, name)\n     58     tensors = pywrap_tensorflow.TFE_Py_Execute(ctx._handle, device_name,\n     59                                                op_name, inputs, attrs,\n---> 60                                                num_outputs)\n     61   except core._NotOkStatusException as e:\n     62     if name is not None:\n\nTypeError: provided list of inputs contains objects other than 'EagerTensor'. Item 0 is Tensor\n\nTHX!!", "body": "hi, this problem was figure out in new tensorflow 1.12 , but it stall have another problem.\r\nIn this code will print error\r\n` \"provided list of inputs contains objects other than 'EagerTensor'. Item 0 is Tensor\"`\r\nadd it happen in use Vgg16 model.\r\n\r\nThis is the  code[ here](https://colab.research.google.com/github/tensorflow/tensorflow/blob/master/tensorflow/contrib/eager/python/examples/generative_examples/image_captioning_with_attention.ipynb#scrollTo=io7ws3ReRPGv)\r\nchange the CNN model\r\n```\r\nimg = tf.keras.applications.inception_v3.preprocess_input(img) --->img = tf.keras.applications.vgg16.preprocess_input(img)\r\n\r\nimage_model = tf.keras.applications.InceptionV3(include_top=False, weights='imagenet') ---->image_model =tf.keras.applications.Vgg16(include_top=False, weights='imagenet')\r\n\r\n img = tf.image.resize_images(img, (299, 299))---> img = tf.image.resize_images(img, (224, 224))\r\n\r\n```\r\nchange the image features_shape & attention_features_shape\r\n```\r\nfeatures_shape = 2048 -->512\r\nattention_features_shape = 64-->81\r\n```\r\n\r\n\r\nproblem code in here\r\n```\r\n# captions on the validation set\r\nrid = np.random.randint(0, len(img_name_val))\r\nimage = img_name_val[rid]\r\nreal_caption = ' '.join([index_word[i] for i in cap_val[rid] if i not in [0]])\r\nresult, attention_plot = evaluate(image)\r\n\r\nprint ('Real Caption:', real_caption)\r\nprint ('Prediction Caption:', ' '.join(result))\r\nplot_attention(image, result, attention_plot)\r\n# opening the image\r\n`Image.open(img_name_val[rid])`\r\n```\r\n and error here\r\n\r\n```\r\nFallbackException                        Traceback (most recent call last)\r\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/ops/gen_array_ops.py in reshape(tensor, shape, name)\r\n   6494         _ctx._context_handle, _ctx._eager_context.device_name, \"Reshape\",\r\n-> 6495         name, _ctx._post_execution_callbacks, tensor, shape)\r\n   6496       return _result\r\n\r\n_FallbackException: This function does not handle the case of the path where all inputs are not already EagerTensors.\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTypeError                                 Traceback (most recent call last)\r\n<ipython-input-31-98d70c233c4f> in <module>()\r\n      2 image = img_name_val[rid]\r\n      3 real_caption = ' '.join([index_word[i] for i in cap_val[rid] if i not in [0]])\r\n----> 4 result, attention_plot = evaluate(image)\r\n      5 \r\n      6 print ('Real Caption:', real_caption)\r\n\r\n<ipython-input-29-55980383ccd6> in evaluate(image)\r\n      4     hidden = decoder.reset_state(batch_size=1)\r\n      5 \r\n----> 6     temp_input = tf.expand_dims(load_image(image)[0], 0)\r\n      7     img_tensor_val = image_features_extract_model(temp_input)\r\n      8     img_tensor_val = tf.reshape(img_tensor_val, (img_tensor_val.shape[0], -1, img_tensor_val.shape[3]))\r\n\r\n<ipython-input-5-28f690dfd033> in load_image(image_path)\r\n      3     img = tf.image.decode_jpeg(img, channels=3)\r\n      4     img = tf.image.resize_images(img, (224, 224))\r\n----> 5     img = tf.keras.applications.vgg16.preprocess_input(img)\r\n      6     return img, image_path\r\n\r\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/applications/__init__.py in wrapper(*args, **kwargs)\r\n     68       kwargs['models'] = models\r\n     69       kwargs['utils'] = utils\r\n---> 70     return base_fun(*args, **kwargs)\r\n     71   return wrapper\r\n     72 \r\n\r\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/applications/vgg16.py in preprocess_input(*args, **kwargs)\r\n     42 @keras_modules_injection\r\n     43 def preprocess_input(*args, **kwargs):\r\n---> 44   return vgg16.preprocess_input(*args, **kwargs)\r\n\r\n/usr/local/lib/python3.6/dist-packages/keras_applications/imagenet_utils.py in preprocess_input(x, data_format, mode, **kwargs)\r\n    193     else:\r\n    194         return _preprocess_symbolic_input(x, data_format=data_format,\r\n--> 195                                           mode=mode, **kwargs)\r\n    196 \r\n    197 \r\n\r\n/usr/local/lib/python3.6/dist-packages/keras_applications/imagenet_utils.py in _preprocess_symbolic_input(x, data_format, mode, **kwargs)\r\n    149             data_format=data_format)\r\n    150     else:\r\n--> 151         x = backend.bias_add(x, _IMAGENET_MEAN, data_format)\r\n    152     if std is not None:\r\n    153         x /= std\r\n\r\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/backend.py in bias_add(x, bias, data_format)\r\n   4595     elif data_format == 'channels_last':\r\n   4596       if len(bias_shape) == 1:\r\n-> 4597         x = x + reshape(bias, (1, 1, bias_shape[0]))\r\n   4598       else:\r\n   4599         x = x + reshape(bias, (1,) + bias_shape)\r\n\r\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/backend.py in reshape(x, shape)\r\n   2279       A tensor.\r\n   2280   \"\"\"\r\n-> 2281   return array_ops.reshape(x, shape)\r\n   2282 \r\n   2283 \r\n\r\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/ops/gen_array_ops.py in reshape(tensor, shape, name)\r\n   6497     except _core._FallbackException:\r\n   6498       return reshape_eager_fallback(\r\n-> 6499           tensor, shape, name=name, ctx=_ctx)\r\n   6500     except _core._NotOkStatusException as e:\r\n   6501       if name is not None:\r\n\r\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/ops/gen_array_ops.py in reshape_eager_fallback(tensor, shape, name, ctx)\r\n   6516   _attrs = (\"T\", _attr_T, \"Tshape\", _attr_Tshape)\r\n   6517   _result = _execute.execute(b\"Reshape\", 1, inputs=_inputs_flat, attrs=_attrs,\r\n-> 6518                              ctx=_ctx, name=name)\r\n   6519   _execute.record_gradient(\r\n   6520       \"Reshape\", _inputs_flat, _attrs, _result, name)\r\n\r\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/eager/execute.py in quick_execute(op_name, num_outputs, inputs, attrs, ctx, name)\r\n     58     tensors = pywrap_tensorflow.TFE_Py_Execute(ctx._handle, device_name,\r\n     59                                                op_name, inputs, attrs,\r\n---> 60                                                num_outputs)\r\n     61   except core._NotOkStatusException as e:\r\n     62     if name is not None:\r\n\r\nTypeError: provided list of inputs contains objects other than 'EagerTensor'. Item 0 is Tensor\r\n```\r\n\r\nTHX!!"}