{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/304626827", "html_url": "https://github.com/tensorflow/tensorflow/issues/8404#issuecomment-304626827", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8404", "id": 304626827, "node_id": "MDEyOklzc3VlQ29tbWVudDMwNDYyNjgyNw==", "user": {"login": "Lakedaemon", "id": 103175, "node_id": "MDQ6VXNlcjEwMzE3NQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/103175?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Lakedaemon", "html_url": "https://github.com/Lakedaemon", "followers_url": "https://api.github.com/users/Lakedaemon/followers", "following_url": "https://api.github.com/users/Lakedaemon/following{/other_user}", "gists_url": "https://api.github.com/users/Lakedaemon/gists{/gist_id}", "starred_url": "https://api.github.com/users/Lakedaemon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Lakedaemon/subscriptions", "organizations_url": "https://api.github.com/users/Lakedaemon/orgs", "repos_url": "https://api.github.com/users/Lakedaemon/repos", "events_url": "https://api.github.com/users/Lakedaemon/events{/privacy}", "received_events_url": "https://api.github.com/users/Lakedaemon/received_events", "type": "User", "site_admin": false}, "created_at": "2017-05-29T10:16:51Z", "updated_at": "2017-05-29T10:17:59Z", "author_association": "NONE", "body_html": "<p>I tried replacing a PlaceHolder node holding a boolean, namely<br>\n<code>node { name: \"dropout_1/keras_learning_phase\" op: \"Placeholder\" attr { key: \"dtype\" value { type: DT_BOOL } } attr { key: \"shape\" value { shape { } } } }</code></p>\n<p>with this node (not sure if it is correct)<br>\n<code>node { name: \"dropout_1/keras_learning_phase\" op: \"Const\" attr { key: \"dtype\" value { type: DT_BOOL } } attr { key: \"value\" value { tensor { dtype: DT_BOOL tensor_shape { } bool_val: false } } } }</code></p>\n<p>and then running it through</p>\n<p>`gd = tf.GraphDef()</p>\n<p>from google.protobuf import text_format<br>\nwith tf.gfile.FastGFile(self.exportPath+self.modelName+\"Constant.pbtxt\", \"r\") as f:<br>\ntext_format.Merge(f.read(), gd)</p>\n<pre><code>  tf.train.write_graph(gd,  self.exportPath,  self.modelName + \"Test.pbtxt\") \n  optimized_graph_def = optimize_for_inference(input_graph_def= gd,\n                     input_node_names=\"conv2d_1_input\".split(\",\"),# \\\n                    output_node_names=\"activation_6/Softmax\".split(\",\"),\n                        placeholder_type_enum=dtypes.float32.as_datatype_enum)\n  optimizedGraphPath = self.exportPath +  self.modelName + \"ConstantOptimized.pbtxt\"\n  tf.train.write_graph(optimized_graph_def,  self.exportPath,  self.modelName + \"ConstantOptimized.pbtxt\") \n  self.freeze(self.modelName + \"ConstantOptimized\", self.modelName + \"-\"+str(self.step))`\n</code></pre>\n<p>But, when freezing, I ended up with<br>\nValueError: graph_def is invalid at node u'dropout_1/cond/mul/y': More inputs specified ('dropout_1/cond/Switch:1') than the op expects..</p>\n<p>was my attempt correct ?</p>\n<p>Next I'm going to try to build tenserflow with basel...I really need those graph transform tools</p>", "body_text": "I tried replacing a PlaceHolder node holding a boolean, namely\nnode { name: \"dropout_1/keras_learning_phase\" op: \"Placeholder\" attr { key: \"dtype\" value { type: DT_BOOL } } attr { key: \"shape\" value { shape { } } } }\nwith this node (not sure if it is correct)\nnode { name: \"dropout_1/keras_learning_phase\" op: \"Const\" attr { key: \"dtype\" value { type: DT_BOOL } } attr { key: \"value\" value { tensor { dtype: DT_BOOL tensor_shape { } bool_val: false } } } }\nand then running it through\n`gd = tf.GraphDef()\nfrom google.protobuf import text_format\nwith tf.gfile.FastGFile(self.exportPath+self.modelName+\"Constant.pbtxt\", \"r\") as f:\ntext_format.Merge(f.read(), gd)\n  tf.train.write_graph(gd,  self.exportPath,  self.modelName + \"Test.pbtxt\") \n  optimized_graph_def = optimize_for_inference(input_graph_def= gd,\n                     input_node_names=\"conv2d_1_input\".split(\",\"),# \\\n                    output_node_names=\"activation_6/Softmax\".split(\",\"),\n                        placeholder_type_enum=dtypes.float32.as_datatype_enum)\n  optimizedGraphPath = self.exportPath +  self.modelName + \"ConstantOptimized.pbtxt\"\n  tf.train.write_graph(optimized_graph_def,  self.exportPath,  self.modelName + \"ConstantOptimized.pbtxt\") \n  self.freeze(self.modelName + \"ConstantOptimized\", self.modelName + \"-\"+str(self.step))`\n\nBut, when freezing, I ended up with\nValueError: graph_def is invalid at node u'dropout_1/cond/mul/y': More inputs specified ('dropout_1/cond/Switch:1') than the op expects..\nwas my attempt correct ?\nNext I'm going to try to build tenserflow with basel...I really need those graph transform tools", "body": "I tried replacing a PlaceHolder node holding a boolean, namely\r\n`node {\r\n  name: \"dropout_1/keras_learning_phase\"\r\n  op: \"Placeholder\"\r\n  attr {\r\n    key: \"dtype\"\r\n    value {\r\n      type: DT_BOOL\r\n    }\r\n  }\r\n  attr {\r\n    key: \"shape\"\r\n    value {\r\n      shape {\r\n      }\r\n    }\r\n  }\r\n}`\r\n\r\nwith this node (not sure if it is correct)\r\n`node {\r\n  name: \"dropout_1/keras_learning_phase\"\r\n  op: \"Const\"\r\n  attr {\r\n    key: \"dtype\"\r\n    value {\r\n      type: DT_BOOL\r\n    }\r\n  }\r\n  attr {\r\n    key: \"value\"\r\n    value {\r\n      tensor {\r\n        dtype: DT_BOOL\r\n        tensor_shape {\r\n        }\r\n        bool_val: false\r\n      }\r\n    }\r\n  }\r\n}`\r\n\r\n \r\nand then running it through\r\n\r\n`gd = tf.GraphDef()\r\n\r\nfrom google.protobuf import text_format\r\n      with tf.gfile.FastGFile(self.exportPath+self.modelName+\"Constant.pbtxt\", \"r\") as f:\r\n        text_format.Merge(f.read(), gd)\r\n\r\n      tf.train.write_graph(gd,  self.exportPath,  self.modelName + \"Test.pbtxt\") \r\n      optimized_graph_def = optimize_for_inference(input_graph_def= gd,\r\n                         input_node_names=\"conv2d_1_input\".split(\",\"),# \\\r\n                        output_node_names=\"activation_6/Softmax\".split(\",\"),\r\n                            placeholder_type_enum=dtypes.float32.as_datatype_enum)\r\n      optimizedGraphPath = self.exportPath +  self.modelName + \"ConstantOptimized.pbtxt\"\r\n      tf.train.write_graph(optimized_graph_def,  self.exportPath,  self.modelName + \"ConstantOptimized.pbtxt\") \r\n      self.freeze(self.modelName + \"ConstantOptimized\", self.modelName + \"-\"+str(self.step))`\r\n\r\nBut, when freezing, I ended up with \r\nValueError: graph_def is invalid at node u'dropout_1/cond/mul/y': More inputs specified ('dropout_1/cond/Switch:1') than the op expects..\r\n\r\n\r\nwas my attempt correct ? \r\n\r\nNext I'm going to try to build tenserflow with basel...I really need those graph transform tools"}