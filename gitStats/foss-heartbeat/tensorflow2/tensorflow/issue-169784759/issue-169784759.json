{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3684", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3684/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3684/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3684/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/3684", "id": 169784759, "node_id": "MDU6SXNzdWUxNjk3ODQ3NTk=", "number": 3684, "title": "ExponentialMovingAverage.variables_to_restore() treats all vars like they have averages", "user": {"login": "mikowals", "id": 1331470, "node_id": "MDQ6VXNlcjEzMzE0NzA=", "avatar_url": "https://avatars0.githubusercontent.com/u/1331470?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikowals", "html_url": "https://github.com/mikowals", "followers_url": "https://api.github.com/users/mikowals/followers", "following_url": "https://api.github.com/users/mikowals/following{/other_user}", "gists_url": "https://api.github.com/users/mikowals/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikowals/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikowals/subscriptions", "organizations_url": "https://api.github.com/users/mikowals/orgs", "repos_url": "https://api.github.com/users/mikowals/repos", "events_url": "https://api.github.com/users/mikowals/events{/privacy}", "received_events_url": "https://api.github.com/users/mikowals/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2016-08-07T07:42:38Z", "updated_at": "2017-06-05T03:07:31Z", "closed_at": "2017-01-24T21:52:24Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Use:</p>\n<pre><code>ema = tf.train.ExponentialMovingAverage(0.9)\ntest = tf.Variable(0.1)\nprint(ema.variables_to_restore([test])\n</code></pre>\n<p>outputs <code>{u'Variable/ExponentialMovingAverage': &lt;tensorflow.python.ops.variables.Variable object at 0x1139d1bd0&gt;}</code></p>\n<p>I expect <code>variables_to_restore</code> not to append <code>/ExponentialMovingAverage</code> to the names of variables that do not have averages tracked.</p>\n<p>I checked that <code>ema._averages</code> and <code>tf.get_collection(tf.GraphKeys.MOVING_AVERAGE_VARIABLES)</code> were indeed both empty.  Calling <code>ema.average_name(test)</code> produces the modified name and this appears to be done <a href=\"https://github.com/tensorflow/tensorflow/blob/73ced9d797056c7e67a06ed2098dd809d85ec44a/tensorflow/python/training/moving_averages.py#L344\">specifically</a> (perhaps for another reason).  So <code>variables_to_restore</code> incorrectly modifies the name because <a href=\"https://github.com/tensorflow/tensorflow/blob/73ced9d797056c7e67a06ed2098dd809d85ec44a/tensorflow/python/training/moving_averages.py#L387\">it uses</a> <code>average_name</code>.</p>", "body_text": "Use:\nema = tf.train.ExponentialMovingAverage(0.9)\ntest = tf.Variable(0.1)\nprint(ema.variables_to_restore([test])\n\noutputs {u'Variable/ExponentialMovingAverage': <tensorflow.python.ops.variables.Variable object at 0x1139d1bd0>}\nI expect variables_to_restore not to append /ExponentialMovingAverage to the names of variables that do not have averages tracked.\nI checked that ema._averages and tf.get_collection(tf.GraphKeys.MOVING_AVERAGE_VARIABLES) were indeed both empty.  Calling ema.average_name(test) produces the modified name and this appears to be done specifically (perhaps for another reason).  So variables_to_restore incorrectly modifies the name because it uses average_name.", "body": "Use:\n\n```\nema = tf.train.ExponentialMovingAverage(0.9)\ntest = tf.Variable(0.1)\nprint(ema.variables_to_restore([test])\n```\n\noutputs `{u'Variable/ExponentialMovingAverage': <tensorflow.python.ops.variables.Variable object at 0x1139d1bd0>}`\n\nI expect `variables_to_restore` not to append `/ExponentialMovingAverage` to the names of variables that do not have averages tracked.\n\nI checked that `ema._averages` and `tf.get_collection(tf.GraphKeys.MOVING_AVERAGE_VARIABLES)` were indeed both empty.  Calling `ema.average_name(test)` produces the modified name and this appears to be done [specifically](https://github.com/tensorflow/tensorflow/blob/73ced9d797056c7e67a06ed2098dd809d85ec44a/tensorflow/python/training/moving_averages.py#L344) (perhaps for another reason).  So `variables_to_restore` incorrectly modifies the name because [it uses](https://github.com/tensorflow/tensorflow/blob/73ced9d797056c7e67a06ed2098dd809d85ec44a/tensorflow/python/training/moving_averages.py#L387) `average_name`.\n"}