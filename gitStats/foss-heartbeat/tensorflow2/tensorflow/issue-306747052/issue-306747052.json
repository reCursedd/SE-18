{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17853", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17853/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17853/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17853/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/17853", "id": 306747052, "node_id": "MDU6SXNzdWUzMDY3NDcwNTI=", "number": 17853, "title": "cannot decode FixedLenFeature with decode_raw", "user": {"login": "AlexWang90", "id": 8745241, "node_id": "MDQ6VXNlcjg3NDUyNDE=", "avatar_url": "https://avatars0.githubusercontent.com/u/8745241?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AlexWang90", "html_url": "https://github.com/AlexWang90", "followers_url": "https://api.github.com/users/AlexWang90/followers", "following_url": "https://api.github.com/users/AlexWang90/following{/other_user}", "gists_url": "https://api.github.com/users/AlexWang90/gists{/gist_id}", "starred_url": "https://api.github.com/users/AlexWang90/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AlexWang90/subscriptions", "organizations_url": "https://api.github.com/users/AlexWang90/orgs", "repos_url": "https://api.github.com/users/AlexWang90/repos", "events_url": "https://api.github.com/users/AlexWang90/events{/privacy}", "received_events_url": "https://api.github.com/users/AlexWang90/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "tatatodd", "id": 5453737, "node_id": "MDQ6VXNlcjU0NTM3Mzc=", "avatar_url": "https://avatars3.githubusercontent.com/u/5453737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tatatodd", "html_url": "https://github.com/tatatodd", "followers_url": "https://api.github.com/users/tatatodd/followers", "following_url": "https://api.github.com/users/tatatodd/following{/other_user}", "gists_url": "https://api.github.com/users/tatatodd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tatatodd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tatatodd/subscriptions", "organizations_url": "https://api.github.com/users/tatatodd/orgs", "repos_url": "https://api.github.com/users/tatatodd/repos", "events_url": "https://api.github.com/users/tatatodd/events{/privacy}", "received_events_url": "https://api.github.com/users/tatatodd/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "tatatodd", "id": 5453737, "node_id": "MDQ6VXNlcjU0NTM3Mzc=", "avatar_url": "https://avatars3.githubusercontent.com/u/5453737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tatatodd", "html_url": "https://github.com/tatatodd", "followers_url": "https://api.github.com/users/tatatodd/followers", "following_url": "https://api.github.com/users/tatatodd/following{/other_user}", "gists_url": "https://api.github.com/users/tatatodd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tatatodd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tatatodd/subscriptions", "organizations_url": "https://api.github.com/users/tatatodd/orgs", "repos_url": "https://api.github.com/users/tatatodd/repos", "events_url": "https://api.github.com/users/tatatodd/events{/privacy}", "received_events_url": "https://api.github.com/users/tatatodd/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2018-03-20T06:47:41Z", "updated_at": "2018-04-11T09:33:10Z", "closed_at": "2018-03-21T14:20:53Z", "author_association": "NONE", "body_html": "<p>I try to parse data from tfrecord file with Dataset, and when I try to parse image with decode_raw, it throws an error.  I use tf1.6, the code is as following:</p>\n<pre><code>def _parse_tfrecords_func(record):\n    \"\"\"\n    :param record:\n    :return:\n    \"\"\"\n    features = {\"img\": tf.FixedLenFeature([],tf.string),\n                \"label\": tf.FixedLenFeature((), tf.int64, default_value=0),\n                \"width\": tf.FixedLenFeature((), tf.int64, default_value=0),\n                \"height\": tf.FixedLenFeature((), tf.int64, default_value=0),\n                \"channel\": tf.FixedLenFeature((), tf.int64, default_value=0)}\n    parsed_features = tf.parse_single_example(record, features)\n    for keys in parsed_features:\n        print(keys)\n\n    print(type(features['img']))\n    print(dir(features['img']))\n    img = tf.decode_raw(features['img'], tf.uint8)  # TODO: fix the error\n    img_reshape = tf.reshape(img, (parsed_features['width'], parsed_features['height'], parsed_features['channel']))\n    return img_reshape, parsed_features['label']\n\ndef dataset_tfrecords():\n    \"\"\"\n    Dataset\u8bfbtfrecords\n    :return:\n    \"\"\"\n    tfrecords_files = ['tfrecords_example']\n    dataset = tf.data.TFRecordDataset(tfrecords_files)\n    dataset = dataset.map(_parse_tfrecords_func)\n    dataset.repeat()\n\n    iterator = dataset.make_initializable_iterator()\n    next_elem = iterator.get_next()\n    sess = tf.Session()\n    sess.run(iterator.initializer)\n\n    for i in range(1):\n        next_elem = sess.run(next_elem)\n        print(type(next_elem))\n</code></pre>\n<p>label, width, height, channel are parsed succeed, however, decode image with decode_raw causes an error, error information is as following:</p>\n<pre><code>Traceback (most recent call last):\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 510, in _apply_op_helper\n    preferred_dtype=default_dtype)\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1036, in internal_convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\constant_op.py\", line 235, in _constant_tensor_conversion_function\n    return constant(v, dtype=dtype, name=name)\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\constant_op.py\", line 214, in constant\n    value, dtype=dtype, shape=shape, verify_shape=verify_shape))\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\tensor_util.py\", line 433, in make_tensor_proto\nimg\nchannel\nheight\nlabel\nwidth\n&lt;class 'tensorflow.python.ops.parsing_ops.FixedLenFeature'&gt;\n['__add__', '__class__', '__contains__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getitem__', '__getnewargs__', '__gt__', '__hash__', '__init__', '__iter__', '__le__', '__len__', '__lt__', '__module__', '__mul__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__rmul__', '__setattr__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '_asdict', '_fields', '_make', '_replace', '_source', '_tf_api_names', 'count', 'default_value', 'dtype', 'index', 'shape']\n    _AssertCompatible(values, dtype)\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\tensor_util.py\", line 344, in _AssertCompatible\n    (dtype.name, repr(mismatch), type(mismatch).__name__))\nTypeError: Expected string, got tf.string of type 'DType' instead.\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"test_dataset.py\", line 99, in &lt;module&gt;\n    dataset_tfrecords()\n  File \"test_dataset.py\", line 75, in dataset_tfrecords\n    dataset = dataset.map(_parse_tfrecords_func)\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\data\\ops\\dataset_ops.py\", line 790, in map\n    return MapDataset(self, map_func)\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\data\\ops\\dataset_ops.py\", line 1597, in __init__\n    self._map_func.add_to_graph(ops.get_default_graph())\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\function.py\", line 486, in add_to_graph\n    self._create_definition_if_needed()\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\function.py\", line 321, in _create_definition_if_needed\n    self._create_definition_if_needed_impl()\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\function.py\", line 338, in _create_definition_if_needed_impl\n    outputs = self._func(*inputs)\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\data\\ops\\dataset_ops.py\", line 1562, in tf_map_func\n    ret = map_func(nested_args)\n  File \"test_dataset.py\", line 64, in _parse_tfrecords_func\n    img = tf.decode_raw(features['img'], tf.uint8)  # TODO: fix the error\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\ops\\gen_parsing_ops.py\", line 214, in decode_raw\n    little_endian=little_endian, name=name)\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 519, in _apply_op_helper\n    repr(values), type(values).__name__))\nTypeError: Expected string passed to parameter 'bytes' of op 'DecodeRaw', got FixedLenFeature(shape=[], dtype=tf.string, default_value=None) of type 'FixedLenFeature' instead.\n</code></pre>", "body_text": "I try to parse data from tfrecord file with Dataset, and when I try to parse image with decode_raw, it throws an error.  I use tf1.6, the code is as following:\ndef _parse_tfrecords_func(record):\n    \"\"\"\n    :param record:\n    :return:\n    \"\"\"\n    features = {\"img\": tf.FixedLenFeature([],tf.string),\n                \"label\": tf.FixedLenFeature((), tf.int64, default_value=0),\n                \"width\": tf.FixedLenFeature((), tf.int64, default_value=0),\n                \"height\": tf.FixedLenFeature((), tf.int64, default_value=0),\n                \"channel\": tf.FixedLenFeature((), tf.int64, default_value=0)}\n    parsed_features = tf.parse_single_example(record, features)\n    for keys in parsed_features:\n        print(keys)\n\n    print(type(features['img']))\n    print(dir(features['img']))\n    img = tf.decode_raw(features['img'], tf.uint8)  # TODO: fix the error\n    img_reshape = tf.reshape(img, (parsed_features['width'], parsed_features['height'], parsed_features['channel']))\n    return img_reshape, parsed_features['label']\n\ndef dataset_tfrecords():\n    \"\"\"\n    Dataset\u8bfbtfrecords\n    :return:\n    \"\"\"\n    tfrecords_files = ['tfrecords_example']\n    dataset = tf.data.TFRecordDataset(tfrecords_files)\n    dataset = dataset.map(_parse_tfrecords_func)\n    dataset.repeat()\n\n    iterator = dataset.make_initializable_iterator()\n    next_elem = iterator.get_next()\n    sess = tf.Session()\n    sess.run(iterator.initializer)\n\n    for i in range(1):\n        next_elem = sess.run(next_elem)\n        print(type(next_elem))\n\nlabel, width, height, channel are parsed succeed, however, decode image with decode_raw causes an error, error information is as following:\nTraceback (most recent call last):\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 510, in _apply_op_helper\n    preferred_dtype=default_dtype)\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1036, in internal_convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\constant_op.py\", line 235, in _constant_tensor_conversion_function\n    return constant(v, dtype=dtype, name=name)\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\constant_op.py\", line 214, in constant\n    value, dtype=dtype, shape=shape, verify_shape=verify_shape))\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\tensor_util.py\", line 433, in make_tensor_proto\nimg\nchannel\nheight\nlabel\nwidth\n<class 'tensorflow.python.ops.parsing_ops.FixedLenFeature'>\n['__add__', '__class__', '__contains__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getitem__', '__getnewargs__', '__gt__', '__hash__', '__init__', '__iter__', '__le__', '__len__', '__lt__', '__module__', '__mul__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__rmul__', '__setattr__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '_asdict', '_fields', '_make', '_replace', '_source', '_tf_api_names', 'count', 'default_value', 'dtype', 'index', 'shape']\n    _AssertCompatible(values, dtype)\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\tensor_util.py\", line 344, in _AssertCompatible\n    (dtype.name, repr(mismatch), type(mismatch).__name__))\nTypeError: Expected string, got tf.string of type 'DType' instead.\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"test_dataset.py\", line 99, in <module>\n    dataset_tfrecords()\n  File \"test_dataset.py\", line 75, in dataset_tfrecords\n    dataset = dataset.map(_parse_tfrecords_func)\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\data\\ops\\dataset_ops.py\", line 790, in map\n    return MapDataset(self, map_func)\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\data\\ops\\dataset_ops.py\", line 1597, in __init__\n    self._map_func.add_to_graph(ops.get_default_graph())\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\function.py\", line 486, in add_to_graph\n    self._create_definition_if_needed()\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\function.py\", line 321, in _create_definition_if_needed\n    self._create_definition_if_needed_impl()\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\function.py\", line 338, in _create_definition_if_needed_impl\n    outputs = self._func(*inputs)\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\data\\ops\\dataset_ops.py\", line 1562, in tf_map_func\n    ret = map_func(nested_args)\n  File \"test_dataset.py\", line 64, in _parse_tfrecords_func\n    img = tf.decode_raw(features['img'], tf.uint8)  # TODO: fix the error\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\ops\\gen_parsing_ops.py\", line 214, in decode_raw\n    little_endian=little_endian, name=name)\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 519, in _apply_op_helper\n    repr(values), type(values).__name__))\nTypeError: Expected string passed to parameter 'bytes' of op 'DecodeRaw', got FixedLenFeature(shape=[], dtype=tf.string, default_value=None) of type 'FixedLenFeature' instead.", "body": "I try to parse data from tfrecord file with Dataset, and when I try to parse image with decode_raw, it throws an error.  I use tf1.6, the code is as following:\r\n\r\n```\r\ndef _parse_tfrecords_func(record):\r\n    \"\"\"\r\n    :param record:\r\n    :return:\r\n    \"\"\"\r\n    features = {\"img\": tf.FixedLenFeature([],tf.string),\r\n                \"label\": tf.FixedLenFeature((), tf.int64, default_value=0),\r\n                \"width\": tf.FixedLenFeature((), tf.int64, default_value=0),\r\n                \"height\": tf.FixedLenFeature((), tf.int64, default_value=0),\r\n                \"channel\": tf.FixedLenFeature((), tf.int64, default_value=0)}\r\n    parsed_features = tf.parse_single_example(record, features)\r\n    for keys in parsed_features:\r\n        print(keys)\r\n\r\n    print(type(features['img']))\r\n    print(dir(features['img']))\r\n    img = tf.decode_raw(features['img'], tf.uint8)  # TODO: fix the error\r\n    img_reshape = tf.reshape(img, (parsed_features['width'], parsed_features['height'], parsed_features['channel']))\r\n    return img_reshape, parsed_features['label']\r\n\r\ndef dataset_tfrecords():\r\n    \"\"\"\r\n    Dataset\u8bfbtfrecords\r\n    :return:\r\n    \"\"\"\r\n    tfrecords_files = ['tfrecords_example']\r\n    dataset = tf.data.TFRecordDataset(tfrecords_files)\r\n    dataset = dataset.map(_parse_tfrecords_func)\r\n    dataset.repeat()\r\n\r\n    iterator = dataset.make_initializable_iterator()\r\n    next_elem = iterator.get_next()\r\n    sess = tf.Session()\r\n    sess.run(iterator.initializer)\r\n\r\n    for i in range(1):\r\n        next_elem = sess.run(next_elem)\r\n        print(type(next_elem))\r\n```\r\nlabel, width, height, channel are parsed succeed, however, decode image with decode_raw causes an error, error information is as following:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 510, in _apply_op_helper\r\n    preferred_dtype=default_dtype)\r\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1036, in internal_convert_to_tensor\r\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\r\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\constant_op.py\", line 235, in _constant_tensor_conversion_function\r\n    return constant(v, dtype=dtype, name=name)\r\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\constant_op.py\", line 214, in constant\r\n    value, dtype=dtype, shape=shape, verify_shape=verify_shape))\r\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\tensor_util.py\", line 433, in make_tensor_proto\r\nimg\r\nchannel\r\nheight\r\nlabel\r\nwidth\r\n<class 'tensorflow.python.ops.parsing_ops.FixedLenFeature'>\r\n['__add__', '__class__', '__contains__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getitem__', '__getnewargs__', '__gt__', '__hash__', '__init__', '__iter__', '__le__', '__len__', '__lt__', '__module__', '__mul__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__rmul__', '__setattr__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '_asdict', '_fields', '_make', '_replace', '_source', '_tf_api_names', 'count', 'default_value', 'dtype', 'index', 'shape']\r\n    _AssertCompatible(values, dtype)\r\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\tensor_util.py\", line 344, in _AssertCompatible\r\n    (dtype.name, repr(mismatch), type(mismatch).__name__))\r\nTypeError: Expected string, got tf.string of type 'DType' instead.\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"test_dataset.py\", line 99, in <module>\r\n    dataset_tfrecords()\r\n  File \"test_dataset.py\", line 75, in dataset_tfrecords\r\n    dataset = dataset.map(_parse_tfrecords_func)\r\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\data\\ops\\dataset_ops.py\", line 790, in map\r\n    return MapDataset(self, map_func)\r\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\data\\ops\\dataset_ops.py\", line 1597, in __init__\r\n    self._map_func.add_to_graph(ops.get_default_graph())\r\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\function.py\", line 486, in add_to_graph\r\n    self._create_definition_if_needed()\r\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\function.py\", line 321, in _create_definition_if_needed\r\n    self._create_definition_if_needed_impl()\r\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\function.py\", line 338, in _create_definition_if_needed_impl\r\n    outputs = self._func(*inputs)\r\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\data\\ops\\dataset_ops.py\", line 1562, in tf_map_func\r\n    ret = map_func(nested_args)\r\n  File \"test_dataset.py\", line 64, in _parse_tfrecords_func\r\n    img = tf.decode_raw(features['img'], tf.uint8)  # TODO: fix the error\r\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\ops\\gen_parsing_ops.py\", line 214, in decode_raw\r\n    little_endian=little_endian, name=name)\r\n  File \"D:\\Anaconda\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 519, in _apply_op_helper\r\n    repr(values), type(values).__name__))\r\nTypeError: Expected string passed to parameter 'bytes' of op 'DecodeRaw', got FixedLenFeature(shape=[], dtype=tf.string, default_value=None) of type 'FixedLenFeature' instead.\r\n```\r\n"}