{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5921", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5921/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5921/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5921/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/5921", "id": 192173093, "node_id": "MDU6SXNzdWUxOTIxNzMwOTM=", "number": 5921, "title": "IOS - No OpKernel was registered to support Op \u2018SpaceToBatchND' with these attrs", "user": {"login": "PhilipZeratul", "id": 5869965, "node_id": "MDQ6VXNlcjU4Njk5NjU=", "avatar_url": "https://avatars2.githubusercontent.com/u/5869965?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PhilipZeratul", "html_url": "https://github.com/PhilipZeratul", "followers_url": "https://api.github.com/users/PhilipZeratul/followers", "following_url": "https://api.github.com/users/PhilipZeratul/following{/other_user}", "gists_url": "https://api.github.com/users/PhilipZeratul/gists{/gist_id}", "starred_url": "https://api.github.com/users/PhilipZeratul/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PhilipZeratul/subscriptions", "organizations_url": "https://api.github.com/users/PhilipZeratul/orgs", "repos_url": "https://api.github.com/users/PhilipZeratul/repos", "events_url": "https://api.github.com/users/PhilipZeratul/events{/privacy}", "received_events_url": "https://api.github.com/users/PhilipZeratul/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2016-11-29T02:39:10Z", "updated_at": "2017-02-09T22:02:01Z", "closed_at": "2017-01-16T08:12:42Z", "author_association": "NONE", "body_html": "<p>I am trying to use <code>tf.nn.atrous_conv2d</code> to solve a segmentation problem. It works on my mac but when I saved this graph using <code>convert_variables_to_constants</code> and <code>tf.train.write_graph</code> then read it in using C++ API trying to get it running on my iPad, I got this error:</p>\n<pre><code>Could not create TensorFlow Graph: Invalid argument: No OpKernel was registered to support Op 'SpaceToBatchND' with these attrs.  Registered devices: [CPU], Registered kernels:\n  &lt;no registered kernels&gt;\n\n\t [[Node: CCC/SpaceToBatchND = SpaceToBatchND[T=DT_FLOAT, Tblock_shape=DT_INT32, Tpaddings=DT_INT32](BBB, CCC/SpaceToBatchND/block_shape, CCC/SpaceToBatchND/paddings)]]\nF /workplace/testTensorFlow/testTensorFlowXcode/Classes/test_tensorflow.mm:162] test_tensorflow.mm : Couldn't load model: Invalid argument: No OpKernel was registered to support Op 'SpaceToBatchND' with these attrs.  Registered devices: [CPU], Registered kernels:\n  &lt;no registered kernels&gt;\n\n\t [[Node: CCC/SpaceToBatchND = SpaceToBatchND[T=DT_FLOAT, Tblock_shape=DT_INT32, Tpaddings=DT_INT32](BBB, CCC/SpaceToBatchND/block_shape, CCC/SpaceToBatchND/paddings)]]\n</code></pre>\n<h2>What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?</h2>\n<p><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"135957980\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/1269\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/1269/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/1269\">#1269</a><br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"158593397\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/2680\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/2680/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/2680\">#2680</a><br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"160894230\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/2929\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/2929/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/2929\">#2929</a></p>\n<h2>If possible, provide a minimal reproducible example</h2>\n<p>In Python:</p>\n<pre><code>import tensorflow as tf\nfrom tensorflow.python.framework.graph_util import convert_variables_to_constants\n\nflt = tf.Variable(tf.random_normal([3, 3, 3, 3], stddev=0.35), name='AAA')\ninputs = tf.placeholder(shape=(1, 224, 224, 3), dtype=tf.float32, name='BBB')\nconv = tf.nn.atrous_conv2d(value=inputs, filters=flt, rate=2, padding='SAME', name='CCC')\n\nsess = tf.Session(config=config)\ninit = tf.initialize_all_variables()\nsess.run(init)\n\nwith sess.as_default():\n    minimal_graph = convert_variables_to_constants(sess, sess.graph_def, [\"CCC\"])\n    tf.train.write_graph(minimal_graph, '.', 'rand_init_min_cpu.pb', as_text=False)\n</code></pre>\n<p>I can load and run graphs not using atrous_conv2d correctly, so I think my C++ code is ok.</p>\n<h2>What other attempted solutions have you tried?</h2>\n<p>Following the related issues above, I tried to add SpaceToBatchND kernel to</p>\n<p><code>tensorflow/contrib/makefile/tf_op_files.txt</code></p>\n<p>I found SpaceToBatchND in array_ops.cc (which has already been included in <code>tf_op_files.txt</code>)<br>\nand maybe in these two files:</p>\n<p><code>tensorflow/core/kernels/spacetobatch_op.cc</code><br>\n<code>tensorflow/core/kernels/batchtospace_op.cc</code></p>\n<p>So I added them to <code>tf_op_files.txt</code>, but then when I <code>./build_all_ios.sh</code>, I got these errors (short version, I can post them all out if you need):</p>\n<pre><code>Undefined symbols for architecture armv7:     \n\"tensorflow::functor::SpaceToBatchFunctor&lt;Eigen::ThreadPoolDevice, float, 4, $\nrue&gt;::operator()(Eigen::ThreadPoolDevice const&amp;, Eigen::TensorMap&lt;Eigen::Tensor$\nfloat, 6, 1, int&gt;, 16, Eigen::MakePointer&gt;, long long const*, long long const*, \nEigen::TensorMap&lt;Eigen::Tensor&lt;float const, 6, 1, int&gt;, 16, Eigen::MakePointer&gt;$\n\", referenced from: \n\n...\n\nvoid tensorflow::(anonymous namespace)::SpaceToBatchOpCompute&lt;Eigen::Threa\ndPoolDevice, int&gt;(tensorflow::OpKernelContext*, tensorflow::Tensor const&amp;, tenso\nrflow::Tensor const&amp;, tensorflow::Tensor const&amp;) in libtensorflow-core-armv7.a(s\npacetobatch_op.o)\nld: symbol(s) not found for architecture armv7\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\nmake: *** [workingspace/tensorflow/tensorflow/contrib/makefile/gen/b\nin/ios_ARMV7/benchmark] Error 1\n+ '[' 2 -ne 0 ']'\n+ echo 'armv7 compilation failed.'\narmv7 compilation failed.\n</code></pre>\n<h2>Environment info</h2>\n<p>Operating System:<br>\nmac: OSX 10.11.6<br>\niPad: IOS 10.1.1</p>\n<p>Installed version of CUDA and cuDNN:<br>\nNone</p>\n<p>Source:<br>\ncommit <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/d6b25985ac219a6e58d186a2beb74d5e8d9e4533/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/d6b25985ac219a6e58d186a2beb74d5e8d9e4533\"><tt>d6b2598</tt></a></p>\n<p>bazel version:<br>\n.................................................<br>\nBuild label: 0.4.0-homebrew<br>\nBuild target: bazel-out/local-opt/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar<br>\nBuild time: Wed Nov 2 19:15:37 2016 (1478114137)<br>\nBuild timestamp: 1478114137<br>\nBuild timestamp as int: 1478114137</p>", "body_text": "I am trying to use tf.nn.atrous_conv2d to solve a segmentation problem. It works on my mac but when I saved this graph using convert_variables_to_constants and tf.train.write_graph then read it in using C++ API trying to get it running on my iPad, I got this error:\nCould not create TensorFlow Graph: Invalid argument: No OpKernel was registered to support Op 'SpaceToBatchND' with these attrs.  Registered devices: [CPU], Registered kernels:\n  <no registered kernels>\n\n\t [[Node: CCC/SpaceToBatchND = SpaceToBatchND[T=DT_FLOAT, Tblock_shape=DT_INT32, Tpaddings=DT_INT32](BBB, CCC/SpaceToBatchND/block_shape, CCC/SpaceToBatchND/paddings)]]\nF /workplace/testTensorFlow/testTensorFlowXcode/Classes/test_tensorflow.mm:162] test_tensorflow.mm : Couldn't load model: Invalid argument: No OpKernel was registered to support Op 'SpaceToBatchND' with these attrs.  Registered devices: [CPU], Registered kernels:\n  <no registered kernels>\n\n\t [[Node: CCC/SpaceToBatchND = SpaceToBatchND[T=DT_FLOAT, Tblock_shape=DT_INT32, Tpaddings=DT_INT32](BBB, CCC/SpaceToBatchND/block_shape, CCC/SpaceToBatchND/paddings)]]\n\nWhat related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\n#1269\n#2680\n#2929\nIf possible, provide a minimal reproducible example\nIn Python:\nimport tensorflow as tf\nfrom tensorflow.python.framework.graph_util import convert_variables_to_constants\n\nflt = tf.Variable(tf.random_normal([3, 3, 3, 3], stddev=0.35), name='AAA')\ninputs = tf.placeholder(shape=(1, 224, 224, 3), dtype=tf.float32, name='BBB')\nconv = tf.nn.atrous_conv2d(value=inputs, filters=flt, rate=2, padding='SAME', name='CCC')\n\nsess = tf.Session(config=config)\ninit = tf.initialize_all_variables()\nsess.run(init)\n\nwith sess.as_default():\n    minimal_graph = convert_variables_to_constants(sess, sess.graph_def, [\"CCC\"])\n    tf.train.write_graph(minimal_graph, '.', 'rand_init_min_cpu.pb', as_text=False)\n\nI can load and run graphs not using atrous_conv2d correctly, so I think my C++ code is ok.\nWhat other attempted solutions have you tried?\nFollowing the related issues above, I tried to add SpaceToBatchND kernel to\ntensorflow/contrib/makefile/tf_op_files.txt\nI found SpaceToBatchND in array_ops.cc (which has already been included in tf_op_files.txt)\nand maybe in these two files:\ntensorflow/core/kernels/spacetobatch_op.cc\ntensorflow/core/kernels/batchtospace_op.cc\nSo I added them to tf_op_files.txt, but then when I ./build_all_ios.sh, I got these errors (short version, I can post them all out if you need):\nUndefined symbols for architecture armv7:     \n\"tensorflow::functor::SpaceToBatchFunctor<Eigen::ThreadPoolDevice, float, 4, $\nrue>::operator()(Eigen::ThreadPoolDevice const&, Eigen::TensorMap<Eigen::Tensor$\nfloat, 6, 1, int>, 16, Eigen::MakePointer>, long long const*, long long const*, \nEigen::TensorMap<Eigen::Tensor<float const, 6, 1, int>, 16, Eigen::MakePointer>$\n\", referenced from: \n\n...\n\nvoid tensorflow::(anonymous namespace)::SpaceToBatchOpCompute<Eigen::Threa\ndPoolDevice, int>(tensorflow::OpKernelContext*, tensorflow::Tensor const&, tenso\nrflow::Tensor const&, tensorflow::Tensor const&) in libtensorflow-core-armv7.a(s\npacetobatch_op.o)\nld: symbol(s) not found for architecture armv7\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\nmake: *** [workingspace/tensorflow/tensorflow/contrib/makefile/gen/b\nin/ios_ARMV7/benchmark] Error 1\n+ '[' 2 -ne 0 ']'\n+ echo 'armv7 compilation failed.'\narmv7 compilation failed.\n\nEnvironment info\nOperating System:\nmac: OSX 10.11.6\niPad: IOS 10.1.1\nInstalled version of CUDA and cuDNN:\nNone\nSource:\ncommit d6b2598\nbazel version:\n.................................................\nBuild label: 0.4.0-homebrew\nBuild target: bazel-out/local-opt/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Wed Nov 2 19:15:37 2016 (1478114137)\nBuild timestamp: 1478114137\nBuild timestamp as int: 1478114137", "body": "I am trying to use `tf.nn.atrous_conv2d` to solve a segmentation problem. It works on my mac but when I saved this graph using `convert_variables_to_constants` and `tf.train.write_graph` then read it in using C++ API trying to get it running on my iPad, I got this error:\r\n\r\n```\r\nCould not create TensorFlow Graph: Invalid argument: No OpKernel was registered to support Op 'SpaceToBatchND' with these attrs.  Registered devices: [CPU], Registered kernels:\r\n  <no registered kernels>\r\n\r\n\t [[Node: CCC/SpaceToBatchND = SpaceToBatchND[T=DT_FLOAT, Tblock_shape=DT_INT32, Tpaddings=DT_INT32](BBB, CCC/SpaceToBatchND/block_shape, CCC/SpaceToBatchND/paddings)]]\r\nF /workplace/testTensorFlow/testTensorFlowXcode/Classes/test_tensorflow.mm:162] test_tensorflow.mm : Couldn't load model: Invalid argument: No OpKernel was registered to support Op 'SpaceToBatchND' with these attrs.  Registered devices: [CPU], Registered kernels:\r\n  <no registered kernels>\r\n\r\n\t [[Node: CCC/SpaceToBatchND = SpaceToBatchND[T=DT_FLOAT, Tblock_shape=DT_INT32, Tpaddings=DT_INT32](BBB, CCC/SpaceToBatchND/block_shape, CCC/SpaceToBatchND/paddings)]]\r\n```\r\n\r\n## What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\r\n\r\nhttps://github.com/tensorflow/tensorflow/issues/1269\r\nhttps://github.com/tensorflow/tensorflow/issues/2680\r\nhttps://github.com/tensorflow/tensorflow/issues/2929\r\n\r\n## If possible, provide a minimal reproducible example\r\n\r\nIn Python:\r\n\r\n```\r\nimport tensorflow as tf\r\nfrom tensorflow.python.framework.graph_util import convert_variables_to_constants\r\n\r\nflt = tf.Variable(tf.random_normal([3, 3, 3, 3], stddev=0.35), name='AAA')\r\ninputs = tf.placeholder(shape=(1, 224, 224, 3), dtype=tf.float32, name='BBB')\r\nconv = tf.nn.atrous_conv2d(value=inputs, filters=flt, rate=2, padding='SAME', name='CCC')\r\n\r\nsess = tf.Session(config=config)\r\ninit = tf.initialize_all_variables()\r\nsess.run(init)\r\n\r\nwith sess.as_default():\r\n    minimal_graph = convert_variables_to_constants(sess, sess.graph_def, [\"CCC\"])\r\n    tf.train.write_graph(minimal_graph, '.', 'rand_init_min_cpu.pb', as_text=False)\r\n```\r\n\r\nI can load and run graphs not using atrous_conv2d correctly, so I think my C++ code is ok.\r\n \r\n## What other attempted solutions have you tried?\r\n\r\nFollowing the related issues above, I tried to add SpaceToBatchND kernel to \r\n\r\n`tensorflow/contrib/makefile/tf_op_files.txt`\r\n\r\nI found SpaceToBatchND in array_ops.cc (which has already been included in `tf_op_files.txt`)\r\nand maybe in these two files:\r\n\r\n`tensorflow/core/kernels/spacetobatch_op.cc`\r\n`tensorflow/core/kernels/batchtospace_op.cc`\r\n\r\nSo I added them to `tf_op_files.txt`, but then when I `./build_all_ios.sh`, I got these errors (short version, I can post them all out if you need):\r\n\r\n```\r\nUndefined symbols for architecture armv7:     \r\n\"tensorflow::functor::SpaceToBatchFunctor<Eigen::ThreadPoolDevice, float, 4, $\r\nrue>::operator()(Eigen::ThreadPoolDevice const&, Eigen::TensorMap<Eigen::Tensor$\r\nfloat, 6, 1, int>, 16, Eigen::MakePointer>, long long const*, long long const*, \r\nEigen::TensorMap<Eigen::Tensor<float const, 6, 1, int>, 16, Eigen::MakePointer>$\r\n\", referenced from: \r\n\r\n...\r\n\r\nvoid tensorflow::(anonymous namespace)::SpaceToBatchOpCompute<Eigen::Threa\r\ndPoolDevice, int>(tensorflow::OpKernelContext*, tensorflow::Tensor const&, tenso\r\nrflow::Tensor const&, tensorflow::Tensor const&) in libtensorflow-core-armv7.a(s\r\npacetobatch_op.o)\r\nld: symbol(s) not found for architecture armv7\r\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\r\nmake: *** [workingspace/tensorflow/tensorflow/contrib/makefile/gen/b\r\nin/ios_ARMV7/benchmark] Error 1\r\n+ '[' 2 -ne 0 ']'\r\n+ echo 'armv7 compilation failed.'\r\narmv7 compilation failed.\r\n```\r\n\r\n## Environment info\r\n\r\nOperating System:\r\nmac: OSX 10.11.6\r\niPad: IOS 10.1.1\r\n\r\nInstalled version of CUDA and cuDNN:\r\nNone\r\n\r\nSource:\r\ncommit d6b25985ac219a6e58d186a2beb74d5e8d9e4533\r\n\r\nbazel version:                                     \r\n.................................................\r\nBuild label: 0.4.0-homebrew\r\nBuild target: bazel-out/local-opt/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\r\nBuild time: Wed Nov 2 19:15:37 2016 (1478114137)\r\nBuild timestamp: 1478114137\r\nBuild timestamp as int: 1478114137\r\n"}