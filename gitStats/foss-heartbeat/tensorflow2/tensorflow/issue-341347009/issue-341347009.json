{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20819", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20819/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20819/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20819/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/20819", "id": 341347009, "node_id": "MDU6SXNzdWUzNDEzNDcwMDk=", "number": 20819, "title": "Tensorflow 1.9: android build of 'libtensorflow_cc.so' fails using android-ndk-r14b & android-ndk-r12b", "user": {"login": "ElderOrb", "id": 23638, "node_id": "MDQ6VXNlcjIzNjM4", "avatar_url": "https://avatars2.githubusercontent.com/u/23638?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ElderOrb", "html_url": "https://github.com/ElderOrb", "followers_url": "https://api.github.com/users/ElderOrb/followers", "following_url": "https://api.github.com/users/ElderOrb/following{/other_user}", "gists_url": "https://api.github.com/users/ElderOrb/gists{/gist_id}", "starred_url": "https://api.github.com/users/ElderOrb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ElderOrb/subscriptions", "organizations_url": "https://api.github.com/users/ElderOrb/orgs", "repos_url": "https://api.github.com/users/ElderOrb/repos", "events_url": "https://api.github.com/users/ElderOrb/events{/privacy}", "received_events_url": "https://api.github.com/users/ElderOrb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "cy89", "id": 29663194, "node_id": "MDQ6VXNlcjI5NjYzMTk0", "avatar_url": "https://avatars0.githubusercontent.com/u/29663194?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cy89", "html_url": "https://github.com/cy89", "followers_url": "https://api.github.com/users/cy89/followers", "following_url": "https://api.github.com/users/cy89/following{/other_user}", "gists_url": "https://api.github.com/users/cy89/gists{/gist_id}", "starred_url": "https://api.github.com/users/cy89/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cy89/subscriptions", "organizations_url": "https://api.github.com/users/cy89/orgs", "repos_url": "https://api.github.com/users/cy89/repos", "events_url": "https://api.github.com/users/cy89/events{/privacy}", "received_events_url": "https://api.github.com/users/cy89/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "cy89", "id": 29663194, "node_id": "MDQ6VXNlcjI5NjYzMTk0", "avatar_url": "https://avatars0.githubusercontent.com/u/29663194?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cy89", "html_url": "https://github.com/cy89", "followers_url": "https://api.github.com/users/cy89/followers", "following_url": "https://api.github.com/users/cy89/following{/other_user}", "gists_url": "https://api.github.com/users/cy89/gists{/gist_id}", "starred_url": "https://api.github.com/users/cy89/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cy89/subscriptions", "organizations_url": "https://api.github.com/users/cy89/orgs", "repos_url": "https://api.github.com/users/cy89/repos", "events_url": "https://api.github.com/users/cy89/events{/privacy}", "received_events_url": "https://api.github.com/users/cy89/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2018-07-15T19:49:57Z", "updated_at": "2018-10-26T21:18:54Z", "closed_at": "2018-10-26T21:18:53Z", "author_association": "NONE", "body_html": "<p>I'm trying to build tensorflow 1.9 for android but build always fails due to different reasons...</p>\n<p>For android-ndk-r14b I've tried the following:</p>\n<p><strong>bazel --output_user_root=/mnt/d/ai/.madman/bazel build -c opt //tensorflow:libtensorflow_cc.so --crosstool_top=//external:android/crosstool --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --cpu=armeabi-v7a --cxxopt=\"-std=c++11\" --cxxopt=\"-DTENSORFLOW_DISABLE_META\" --jobs 1</strong></p>\n<p><em>But got this:</em></p>\n<pre><code>INFO: Analysed target //tensorflow:libtensorflow_cc.so (0 packages loaded).\nINFO: Found 1 target...\nERROR: /mnt/d/ai/.madman/tensorflow_r1.9/tensorflow/core/distributed_runtime/rpc/BUILD:160:1: C++ compilation of rule '//tensorflow/core/distributed_runtime/rpc:grpc_worker_service' failed (Exit 1)\nIn file included from tensorflow/core/distributed_runtime/rpc/grpc_worker_service.cc:20:\nIn file included from external/grpc/include/grpc++/alarm.h:26:\nIn file included from external/grpc/include/grpcpp/alarm.h:25:\nIn file included from external/grpc/include/grpcpp/impl/codegen/completion_queue.h:37:\nIn file included from external/grpc/include/grpcpp/impl/codegen/core_codegen_interface.h:25:\nexternal/grpc/include/grpcpp/impl/codegen/config.h:37:12: error: no member named 'to_string' in namespace 'std'\nusing std::to_string;\n      ~~~~~^\n</code></pre>\n<p><em>... also tried to switch to llvm's STL like this:</em></p>\n<p><strong>bazel --output_user_root=/mnt/d/ai/.madman/bazel build -c opt //tensorflow:libtensorflow_cc.so --crosstool_top=@androidndk//:toolchain-libcpp --android_crosstool_top=@androidndk//:toolchain-libcpp --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --cpu=armeabi-v7a --cxxopt=\"-std=c++11\" --cxxopt=\"-DTENSORFLOW_DISABLE_META\" --jobs 1</strong></p>\n<p><em>... and got another issue:</em></p>\n<pre><code>WARNING: /mnt/d/ai/.madman/bazel/cd3928a854e918c00cc4e280f6815890/external/grpc/BUILD:1960:1: in srcs attribute of cc_library rule @grpc//:grpc_nanopb: please do not import '@grpc//third_party/nanopb:pb_encode.c' directly. You should either move the file to this package or depend on an appropriate rule there. Since this rule was created by the macro 'grpc_generate_one_off_targets', the error might have been caused by the macro implementation in /mnt/d/ai/.madman/bazel/cd3928a854e918c00cc4e280f6815890/external/grpc/bazel/grpc_build_system.bzl:172:12\nINFO: Analysed target //tensorflow:libtensorflow_cc.so (0 packages loaded).\nINFO: Found 1 target...\nERROR: /mnt/d/ai/.madman/tensorflow_r1.9/tensorflow/core/kernels/BUILD:340:1: C++ compilation of rule '//tensorflow/core/kernels:stage_op' failed (Exit 1)\nIn file included from tensorflow/core/kernels/stage_op.cc:22:\nIn file included from ./tensorflow/core/framework/op_kernel.h:23:\nIn file included from ./tensorflow/core/framework/allocator.h:23:\nIn file included from ./tensorflow/core/framework/numeric_types.h:19:\nIn file included from external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/complex:246:\nIn file included from external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/cmath:305:\nIn file included from external/androidndk/ndk/sources/android/support/include/math.h:31:\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:661:91: error: use of undeclared identifier 'acosl'\ninline _LIBCPP_INLINE_VISIBILITY long double acos(long double __lcpp_x) _NOEXCEPT {return acosl(__lcpp_x);}\n                                                                                          ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:673:91: error: use of undeclared identifier 'asinl'\ninline _LIBCPP_INLINE_VISIBILITY long double asin(long double __lcpp_x) _NOEXCEPT {return asinl(__lcpp_x);}\n                                                                                          ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:685:91: error: use of undeclared identifier 'atanl'\ninline _LIBCPP_INLINE_VISIBILITY long double atan(long double __lcpp_x) _NOEXCEPT {return atanl(__lcpp_x);}\n                                                                                          ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:697:114: error: use of undeclared identifier 'atan2l'\ninline _LIBCPP_INLINE_VISIBILITY long double atan2(long double __lcpp_y, long double __lcpp_x) _NOEXCEPT {return atan2l(__lcpp_y, __lcpp_x);}\n                                                                                                                 ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:732:90: error: use of undeclared identifier 'cosl'\ninline _LIBCPP_INLINE_VISIBILITY long double cos(long double __lcpp_x) _NOEXCEPT {return cosl(__lcpp_x);}\n                                                                                         ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:744:91: error: use of undeclared identifier 'coshl'\ninline _LIBCPP_INLINE_VISIBILITY long double cosh(long double __lcpp_x) _NOEXCEPT {return coshl(__lcpp_x);}\n                                                                                          ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:756:90: error: use of undeclared identifier 'expl'\ninline _LIBCPP_INLINE_VISIBILITY long double exp(long double __lcpp_x) _NOEXCEPT {return expl(__lcpp_x);}\n                                                                                         ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:792:113: error: use of undeclared identifier 'fmodl'\ninline _LIBCPP_INLINE_VISIBILITY long double fmod(long double __lcpp_x, long double __lcpp_y) _NOEXCEPT {return fmodl(__lcpp_x, __lcpp_y);}\n                                                                                                                ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:839:90: error: use of undeclared identifier 'logl'\ninline _LIBCPP_INLINE_VISIBILITY long double log(long double __lcpp_x) _NOEXCEPT {return logl(__lcpp_x);}\n                                                                                         ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:851:92: error: use of undeclared identifier 'log10l'\ninline _LIBCPP_INLINE_VISIBILITY long double log10(long double __lcpp_x) _NOEXCEPT {return log10l(__lcpp_x);}\n                                                                                           ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:863:114: error: use of undeclared identifier 'modfl'\ninline _LIBCPP_INLINE_VISIBILITY long double modf(long double __lcpp_x, long double* __lcpp_y) _NOEXCEPT {return modfl(__lcpp_x, __lcpp_y);}\n                                                                                                                 ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:870:112: error: use of undeclared identifier 'powl'\ninline _LIBCPP_INLINE_VISIBILITY long double pow(long double __lcpp_x, long double __lcpp_y) _NOEXCEPT {return powl(__lcpp_x, __lcpp_y);}\n                                                                                                               ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:893:90: error: use of undeclared identifier 'sinl'\ninline _LIBCPP_INLINE_VISIBILITY long double sin(long double __lcpp_x) _NOEXCEPT {return sinl(__lcpp_x);}\n                                                                                         ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:905:91: error: use of undeclared identifier 'sinhl'\ninline _LIBCPP_INLINE_VISIBILITY long double sinh(long double __lcpp_x) _NOEXCEPT {return sinhl(__lcpp_x);}\n                                                                                          ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:917:91: error: use of undeclared identifier 'sqrtl'\ninline _LIBCPP_INLINE_VISIBILITY long double sqrt(long double __lcpp_x) _NOEXCEPT {return sqrtl(__lcpp_x);}\n                                                                                          ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:931:90: error: use of undeclared identifier 'tanl'\ninline _LIBCPP_INLINE_VISIBILITY long double tan(long double __lcpp_x) _NOEXCEPT {return tanl(__lcpp_x);}\n                                                                                         ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:943:91: error: use of undeclared identifier 'tanhl'\ninline _LIBCPP_INLINE_VISIBILITY long double tanh(long double __lcpp_x) _NOEXCEPT {return tanhl(__lcpp_x);}\n                                                                                          ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:955:92: error: use of undeclared identifier 'acoshl'\ninline _LIBCPP_INLINE_VISIBILITY long double acosh(long double __lcpp_x) _NOEXCEPT {return acoshl(__lcpp_x);}\n                                                                                           ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:967:92: error: use of undeclared identifier 'asinhl'\ninline _LIBCPP_INLINE_VISIBILITY long double asinh(long double __lcpp_x) _NOEXCEPT {return asinhl(__lcpp_x);}\n                                                                                           ^\nfatal error: too many errors emitted, stopping now [-ferror-limit=]\n20 errors generated.\nTarget //tensorflow:libtensorflow_cc.so failed to build\nUse --verbose_failures to see the command lines of failed build steps.\nINFO: Elapsed time: 7.012s, Critical Path: 1.84s\nINFO: 0 processes.\nFAILED: Build did NOT complete successfully\n</code></pre>\n<p>So I've tried the same for android-ndk-r12b:</p>\n<p><em>first in this way:</em></p>\n<p><strong>bazel build -c opt //tensorflow/contrib/android:libtensorflow_inference.so --crosstool_top=//external:android/crosstool --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --cpu=armeabi-v7a  --jobs 1</strong></p>\n<p><em>... but got another issue:</em></p>\n<pre><code>ERROR: /mnt/d/ai/.madman/tensorflow_r1.9-gcc/tensorflow/core/BUILD:2891:1: C++ compilation of rule '//tensorflow/core:gpu_runtime_impl' failed (Exit 1)\ntensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc: In member function 'virtual void* tensorflow::GPUNanResetAllocator::AllocateRaw(size_t, size_t)':\ntensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:176:27: error: 'nanf' is not a member of 'std'\n                           std::nanf(\"\"));\n                           ^\ntensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:176:27: note: suggested alternative:\nIn file included from external/androidndk/ndk/sources/cxx-stl/gnu-libstdc++/4.9/include/cmath:44:0,\n                 from external/androidndk/ndk/sources/cxx-stl/gnu-libstdc++/4.9/include/complex:44,\n                 from ./tensorflow/core/framework/numeric_types.h:19,\n                 from ./tensorflow/core/framework/allocator.h:23,\n                 from ./tensorflow/core/common_runtime/visitable_allocator.h:20,\n                 from ./tensorflow/core/common_runtime/gpu/gpu_debug_allocator.h:24,\n                 from tensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:16:\nexternal/androidndk/ndk/platforms/android-14/arch-arm/usr/include/math.h:359:7: note:   'nanf'\n float nanf(const char *) __NDK_FPABI_MATH__ __pure2;\n       ^\ntensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc: In member function 'virtual void tensorflow::GPUNanResetAllocator::DeallocateRaw(void*)':\ntensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:191:29: error: 'nanf' is not a member of 'std'\n                             std::nanf(\"\"));\n                             ^\ntensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:191:29: note: suggested alternative:\nIn file included from external/androidndk/ndk/sources/cxx-stl/gnu-libstdc++/4.9/include/cmath:44:0,\n                 from external/androidndk/ndk/sources/cxx-stl/gnu-libstdc++/4.9/include/complex:44,\n                 from ./tensorflow/core/framework/numeric_types.h:19,\n                 from ./tensorflow/core/framework/allocator.h:23,\n                 from ./tensorflow/core/common_runtime/visitable_allocator.h:20,\n                 from ./tensorflow/core/common_runtime/gpu/gpu_debug_allocator.h:24,\n                 from tensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:16:\nexternal/androidndk/ndk/platforms/android-14/arch-arm/usr/include/math.h:359:7: note:   'nanf'\n float nanf(const char *) __NDK_FPABI_MATH__ __pure2;\n       ^\nTarget //tensorflow:libtensorflow_cc.so failed to build\n</code></pre>\n<p><em>... then again tried to switch to llvm:</em></p>\n<p><strong>bazel build tensorflow/core:android_tensorflow_lib --crosstool_top=//external:android/crosstool --cpu=armeabi-v7a --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --config monolithic</strong></p>\n<p><em>and again no luck:</em></p>\n<pre><code>ERROR: /mnt/d/ai/.madman/tensorflow_r1.9-gcc/tensorflow/core/BUILD:2014:1: C++ compilation of rule '//tensorflow/core:lib_internal_impl' failed (Exit 1)\nIn file included from external/androidndk/ndk/sources/cxx-stl/llvm-libc++/libcxx/include/memory:614:0,\n                 from external/androidndk/ndk/sources/cxx-stl/llvm-libc++/libcxx/include/functional:477,\n                 from ./tensorflow/core/lib/core/threadpool.h:19,\n                 from tensorflow/core/lib/core/threadpool.cc:16:\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/libcxx/include/atomic: In member function 'void Eigen::EventCount::CommitWait(Eigen::EventCount::Waiter*)':\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/libcxx/include/atomic:720:75: error: invalid failure memory model for '__atomic_compare_exchange'\n                                    __gcc_atomic::__to_gcc_order(__failure));\n                                                                           ^\nTarget //tensorflow:libtensorflow_cc.so failed to build\nUse --verbose_failures to see the command lines of failed build steps.\nINFO: Elapsed time: 617.731s, Critical Path: 11.03s\nINFO: 264 processes: 264 local.\nFAILED: Build did NOT complete successfully\n\n</code></pre>\n<p>What am I doing wrong?</p>\n<p>P.S. '--jobs 1' seems to be necessary for my environment, otherwise I'm getting different random build issues.</p>", "body_text": "I'm trying to build tensorflow 1.9 for android but build always fails due to different reasons...\nFor android-ndk-r14b I've tried the following:\nbazel --output_user_root=/mnt/d/ai/.madman/bazel build -c opt //tensorflow:libtensorflow_cc.so --crosstool_top=//external:android/crosstool --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --cpu=armeabi-v7a --cxxopt=\"-std=c++11\" --cxxopt=\"-DTENSORFLOW_DISABLE_META\" --jobs 1\nBut got this:\nINFO: Analysed target //tensorflow:libtensorflow_cc.so (0 packages loaded).\nINFO: Found 1 target...\nERROR: /mnt/d/ai/.madman/tensorflow_r1.9/tensorflow/core/distributed_runtime/rpc/BUILD:160:1: C++ compilation of rule '//tensorflow/core/distributed_runtime/rpc:grpc_worker_service' failed (Exit 1)\nIn file included from tensorflow/core/distributed_runtime/rpc/grpc_worker_service.cc:20:\nIn file included from external/grpc/include/grpc++/alarm.h:26:\nIn file included from external/grpc/include/grpcpp/alarm.h:25:\nIn file included from external/grpc/include/grpcpp/impl/codegen/completion_queue.h:37:\nIn file included from external/grpc/include/grpcpp/impl/codegen/core_codegen_interface.h:25:\nexternal/grpc/include/grpcpp/impl/codegen/config.h:37:12: error: no member named 'to_string' in namespace 'std'\nusing std::to_string;\n      ~~~~~^\n\n... also tried to switch to llvm's STL like this:\nbazel --output_user_root=/mnt/d/ai/.madman/bazel build -c opt //tensorflow:libtensorflow_cc.so --crosstool_top=@androidndk//:toolchain-libcpp --android_crosstool_top=@androidndk//:toolchain-libcpp --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --cpu=armeabi-v7a --cxxopt=\"-std=c++11\" --cxxopt=\"-DTENSORFLOW_DISABLE_META\" --jobs 1\n... and got another issue:\nWARNING: /mnt/d/ai/.madman/bazel/cd3928a854e918c00cc4e280f6815890/external/grpc/BUILD:1960:1: in srcs attribute of cc_library rule @grpc//:grpc_nanopb: please do not import '@grpc//third_party/nanopb:pb_encode.c' directly. You should either move the file to this package or depend on an appropriate rule there. Since this rule was created by the macro 'grpc_generate_one_off_targets', the error might have been caused by the macro implementation in /mnt/d/ai/.madman/bazel/cd3928a854e918c00cc4e280f6815890/external/grpc/bazel/grpc_build_system.bzl:172:12\nINFO: Analysed target //tensorflow:libtensorflow_cc.so (0 packages loaded).\nINFO: Found 1 target...\nERROR: /mnt/d/ai/.madman/tensorflow_r1.9/tensorflow/core/kernels/BUILD:340:1: C++ compilation of rule '//tensorflow/core/kernels:stage_op' failed (Exit 1)\nIn file included from tensorflow/core/kernels/stage_op.cc:22:\nIn file included from ./tensorflow/core/framework/op_kernel.h:23:\nIn file included from ./tensorflow/core/framework/allocator.h:23:\nIn file included from ./tensorflow/core/framework/numeric_types.h:19:\nIn file included from external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/complex:246:\nIn file included from external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/cmath:305:\nIn file included from external/androidndk/ndk/sources/android/support/include/math.h:31:\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:661:91: error: use of undeclared identifier 'acosl'\ninline _LIBCPP_INLINE_VISIBILITY long double acos(long double __lcpp_x) _NOEXCEPT {return acosl(__lcpp_x);}\n                                                                                          ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:673:91: error: use of undeclared identifier 'asinl'\ninline _LIBCPP_INLINE_VISIBILITY long double asin(long double __lcpp_x) _NOEXCEPT {return asinl(__lcpp_x);}\n                                                                                          ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:685:91: error: use of undeclared identifier 'atanl'\ninline _LIBCPP_INLINE_VISIBILITY long double atan(long double __lcpp_x) _NOEXCEPT {return atanl(__lcpp_x);}\n                                                                                          ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:697:114: error: use of undeclared identifier 'atan2l'\ninline _LIBCPP_INLINE_VISIBILITY long double atan2(long double __lcpp_y, long double __lcpp_x) _NOEXCEPT {return atan2l(__lcpp_y, __lcpp_x);}\n                                                                                                                 ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:732:90: error: use of undeclared identifier 'cosl'\ninline _LIBCPP_INLINE_VISIBILITY long double cos(long double __lcpp_x) _NOEXCEPT {return cosl(__lcpp_x);}\n                                                                                         ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:744:91: error: use of undeclared identifier 'coshl'\ninline _LIBCPP_INLINE_VISIBILITY long double cosh(long double __lcpp_x) _NOEXCEPT {return coshl(__lcpp_x);}\n                                                                                          ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:756:90: error: use of undeclared identifier 'expl'\ninline _LIBCPP_INLINE_VISIBILITY long double exp(long double __lcpp_x) _NOEXCEPT {return expl(__lcpp_x);}\n                                                                                         ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:792:113: error: use of undeclared identifier 'fmodl'\ninline _LIBCPP_INLINE_VISIBILITY long double fmod(long double __lcpp_x, long double __lcpp_y) _NOEXCEPT {return fmodl(__lcpp_x, __lcpp_y);}\n                                                                                                                ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:839:90: error: use of undeclared identifier 'logl'\ninline _LIBCPP_INLINE_VISIBILITY long double log(long double __lcpp_x) _NOEXCEPT {return logl(__lcpp_x);}\n                                                                                         ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:851:92: error: use of undeclared identifier 'log10l'\ninline _LIBCPP_INLINE_VISIBILITY long double log10(long double __lcpp_x) _NOEXCEPT {return log10l(__lcpp_x);}\n                                                                                           ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:863:114: error: use of undeclared identifier 'modfl'\ninline _LIBCPP_INLINE_VISIBILITY long double modf(long double __lcpp_x, long double* __lcpp_y) _NOEXCEPT {return modfl(__lcpp_x, __lcpp_y);}\n                                                                                                                 ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:870:112: error: use of undeclared identifier 'powl'\ninline _LIBCPP_INLINE_VISIBILITY long double pow(long double __lcpp_x, long double __lcpp_y) _NOEXCEPT {return powl(__lcpp_x, __lcpp_y);}\n                                                                                                               ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:893:90: error: use of undeclared identifier 'sinl'\ninline _LIBCPP_INLINE_VISIBILITY long double sin(long double __lcpp_x) _NOEXCEPT {return sinl(__lcpp_x);}\n                                                                                         ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:905:91: error: use of undeclared identifier 'sinhl'\ninline _LIBCPP_INLINE_VISIBILITY long double sinh(long double __lcpp_x) _NOEXCEPT {return sinhl(__lcpp_x);}\n                                                                                          ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:917:91: error: use of undeclared identifier 'sqrtl'\ninline _LIBCPP_INLINE_VISIBILITY long double sqrt(long double __lcpp_x) _NOEXCEPT {return sqrtl(__lcpp_x);}\n                                                                                          ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:931:90: error: use of undeclared identifier 'tanl'\ninline _LIBCPP_INLINE_VISIBILITY long double tan(long double __lcpp_x) _NOEXCEPT {return tanl(__lcpp_x);}\n                                                                                         ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:943:91: error: use of undeclared identifier 'tanhl'\ninline _LIBCPP_INLINE_VISIBILITY long double tanh(long double __lcpp_x) _NOEXCEPT {return tanhl(__lcpp_x);}\n                                                                                          ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:955:92: error: use of undeclared identifier 'acoshl'\ninline _LIBCPP_INLINE_VISIBILITY long double acosh(long double __lcpp_x) _NOEXCEPT {return acoshl(__lcpp_x);}\n                                                                                           ^\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:967:92: error: use of undeclared identifier 'asinhl'\ninline _LIBCPP_INLINE_VISIBILITY long double asinh(long double __lcpp_x) _NOEXCEPT {return asinhl(__lcpp_x);}\n                                                                                           ^\nfatal error: too many errors emitted, stopping now [-ferror-limit=]\n20 errors generated.\nTarget //tensorflow:libtensorflow_cc.so failed to build\nUse --verbose_failures to see the command lines of failed build steps.\nINFO: Elapsed time: 7.012s, Critical Path: 1.84s\nINFO: 0 processes.\nFAILED: Build did NOT complete successfully\n\nSo I've tried the same for android-ndk-r12b:\nfirst in this way:\nbazel build -c opt //tensorflow/contrib/android:libtensorflow_inference.so --crosstool_top=//external:android/crosstool --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --cpu=armeabi-v7a  --jobs 1\n... but got another issue:\nERROR: /mnt/d/ai/.madman/tensorflow_r1.9-gcc/tensorflow/core/BUILD:2891:1: C++ compilation of rule '//tensorflow/core:gpu_runtime_impl' failed (Exit 1)\ntensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc: In member function 'virtual void* tensorflow::GPUNanResetAllocator::AllocateRaw(size_t, size_t)':\ntensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:176:27: error: 'nanf' is not a member of 'std'\n                           std::nanf(\"\"));\n                           ^\ntensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:176:27: note: suggested alternative:\nIn file included from external/androidndk/ndk/sources/cxx-stl/gnu-libstdc++/4.9/include/cmath:44:0,\n                 from external/androidndk/ndk/sources/cxx-stl/gnu-libstdc++/4.9/include/complex:44,\n                 from ./tensorflow/core/framework/numeric_types.h:19,\n                 from ./tensorflow/core/framework/allocator.h:23,\n                 from ./tensorflow/core/common_runtime/visitable_allocator.h:20,\n                 from ./tensorflow/core/common_runtime/gpu/gpu_debug_allocator.h:24,\n                 from tensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:16:\nexternal/androidndk/ndk/platforms/android-14/arch-arm/usr/include/math.h:359:7: note:   'nanf'\n float nanf(const char *) __NDK_FPABI_MATH__ __pure2;\n       ^\ntensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc: In member function 'virtual void tensorflow::GPUNanResetAllocator::DeallocateRaw(void*)':\ntensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:191:29: error: 'nanf' is not a member of 'std'\n                             std::nanf(\"\"));\n                             ^\ntensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:191:29: note: suggested alternative:\nIn file included from external/androidndk/ndk/sources/cxx-stl/gnu-libstdc++/4.9/include/cmath:44:0,\n                 from external/androidndk/ndk/sources/cxx-stl/gnu-libstdc++/4.9/include/complex:44,\n                 from ./tensorflow/core/framework/numeric_types.h:19,\n                 from ./tensorflow/core/framework/allocator.h:23,\n                 from ./tensorflow/core/common_runtime/visitable_allocator.h:20,\n                 from ./tensorflow/core/common_runtime/gpu/gpu_debug_allocator.h:24,\n                 from tensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:16:\nexternal/androidndk/ndk/platforms/android-14/arch-arm/usr/include/math.h:359:7: note:   'nanf'\n float nanf(const char *) __NDK_FPABI_MATH__ __pure2;\n       ^\nTarget //tensorflow:libtensorflow_cc.so failed to build\n\n... then again tried to switch to llvm:\nbazel build tensorflow/core:android_tensorflow_lib --crosstool_top=//external:android/crosstool --cpu=armeabi-v7a --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --config monolithic\nand again no luck:\nERROR: /mnt/d/ai/.madman/tensorflow_r1.9-gcc/tensorflow/core/BUILD:2014:1: C++ compilation of rule '//tensorflow/core:lib_internal_impl' failed (Exit 1)\nIn file included from external/androidndk/ndk/sources/cxx-stl/llvm-libc++/libcxx/include/memory:614:0,\n                 from external/androidndk/ndk/sources/cxx-stl/llvm-libc++/libcxx/include/functional:477,\n                 from ./tensorflow/core/lib/core/threadpool.h:19,\n                 from tensorflow/core/lib/core/threadpool.cc:16:\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/libcxx/include/atomic: In member function 'void Eigen::EventCount::CommitWait(Eigen::EventCount::Waiter*)':\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/libcxx/include/atomic:720:75: error: invalid failure memory model for '__atomic_compare_exchange'\n                                    __gcc_atomic::__to_gcc_order(__failure));\n                                                                           ^\nTarget //tensorflow:libtensorflow_cc.so failed to build\nUse --verbose_failures to see the command lines of failed build steps.\nINFO: Elapsed time: 617.731s, Critical Path: 11.03s\nINFO: 264 processes: 264 local.\nFAILED: Build did NOT complete successfully\n\n\nWhat am I doing wrong?\nP.S. '--jobs 1' seems to be necessary for my environment, otherwise I'm getting different random build issues.", "body": "I'm trying to build tensorflow 1.9 for android but build always fails due to different reasons... \r\n\r\nFor android-ndk-r14b I've tried the following:\r\n\r\n**bazel --output_user_root=/mnt/d/ai/.madman/bazel build -c opt //tensorflow:libtensorflow_cc.so --crosstool_top=//external:android/crosstool --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --cpu=armeabi-v7a --cxxopt=\"-std=c++11\" --cxxopt=\"-DTENSORFLOW_DISABLE_META\" --jobs 1**\r\n\r\n_But got this:_ \r\n\r\n```\r\nINFO: Analysed target //tensorflow:libtensorflow_cc.so (0 packages loaded).\r\nINFO: Found 1 target...\r\nERROR: /mnt/d/ai/.madman/tensorflow_r1.9/tensorflow/core/distributed_runtime/rpc/BUILD:160:1: C++ compilation of rule '//tensorflow/core/distributed_runtime/rpc:grpc_worker_service' failed (Exit 1)\r\nIn file included from tensorflow/core/distributed_runtime/rpc/grpc_worker_service.cc:20:\r\nIn file included from external/grpc/include/grpc++/alarm.h:26:\r\nIn file included from external/grpc/include/grpcpp/alarm.h:25:\r\nIn file included from external/grpc/include/grpcpp/impl/codegen/completion_queue.h:37:\r\nIn file included from external/grpc/include/grpcpp/impl/codegen/core_codegen_interface.h:25:\r\nexternal/grpc/include/grpcpp/impl/codegen/config.h:37:12: error: no member named 'to_string' in namespace 'std'\r\nusing std::to_string;\r\n      ~~~~~^\r\n```\r\n\r\n_... also tried to switch to llvm's STL like this:_ \r\n\r\n**bazel --output_user_root=/mnt/d/ai/.madman/bazel build -c opt //tensorflow:libtensorflow_cc.so --crosstool_top=@androidndk//:toolchain-libcpp --android_crosstool_top=@androidndk//:toolchain-libcpp --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --cpu=armeabi-v7a --cxxopt=\"-std=c++11\" --cxxopt=\"-DTENSORFLOW_DISABLE_META\" --jobs 1**\r\n\r\n_... and got another issue:_ \r\n\r\n```\r\nWARNING: /mnt/d/ai/.madman/bazel/cd3928a854e918c00cc4e280f6815890/external/grpc/BUILD:1960:1: in srcs attribute of cc_library rule @grpc//:grpc_nanopb: please do not import '@grpc//third_party/nanopb:pb_encode.c' directly. You should either move the file to this package or depend on an appropriate rule there. Since this rule was created by the macro 'grpc_generate_one_off_targets', the error might have been caused by the macro implementation in /mnt/d/ai/.madman/bazel/cd3928a854e918c00cc4e280f6815890/external/grpc/bazel/grpc_build_system.bzl:172:12\r\nINFO: Analysed target //tensorflow:libtensorflow_cc.so (0 packages loaded).\r\nINFO: Found 1 target...\r\nERROR: /mnt/d/ai/.madman/tensorflow_r1.9/tensorflow/core/kernels/BUILD:340:1: C++ compilation of rule '//tensorflow/core/kernels:stage_op' failed (Exit 1)\r\nIn file included from tensorflow/core/kernels/stage_op.cc:22:\r\nIn file included from ./tensorflow/core/framework/op_kernel.h:23:\r\nIn file included from ./tensorflow/core/framework/allocator.h:23:\r\nIn file included from ./tensorflow/core/framework/numeric_types.h:19:\r\nIn file included from external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/complex:246:\r\nIn file included from external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/cmath:305:\r\nIn file included from external/androidndk/ndk/sources/android/support/include/math.h:31:\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:661:91: error: use of undeclared identifier 'acosl'\r\ninline _LIBCPP_INLINE_VISIBILITY long double acos(long double __lcpp_x) _NOEXCEPT {return acosl(__lcpp_x);}\r\n                                                                                          ^\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:673:91: error: use of undeclared identifier 'asinl'\r\ninline _LIBCPP_INLINE_VISIBILITY long double asin(long double __lcpp_x) _NOEXCEPT {return asinl(__lcpp_x);}\r\n                                                                                          ^\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:685:91: error: use of undeclared identifier 'atanl'\r\ninline _LIBCPP_INLINE_VISIBILITY long double atan(long double __lcpp_x) _NOEXCEPT {return atanl(__lcpp_x);}\r\n                                                                                          ^\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:697:114: error: use of undeclared identifier 'atan2l'\r\ninline _LIBCPP_INLINE_VISIBILITY long double atan2(long double __lcpp_y, long double __lcpp_x) _NOEXCEPT {return atan2l(__lcpp_y, __lcpp_x);}\r\n                                                                                                                 ^\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:732:90: error: use of undeclared identifier 'cosl'\r\ninline _LIBCPP_INLINE_VISIBILITY long double cos(long double __lcpp_x) _NOEXCEPT {return cosl(__lcpp_x);}\r\n                                                                                         ^\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:744:91: error: use of undeclared identifier 'coshl'\r\ninline _LIBCPP_INLINE_VISIBILITY long double cosh(long double __lcpp_x) _NOEXCEPT {return coshl(__lcpp_x);}\r\n                                                                                          ^\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:756:90: error: use of undeclared identifier 'expl'\r\ninline _LIBCPP_INLINE_VISIBILITY long double exp(long double __lcpp_x) _NOEXCEPT {return expl(__lcpp_x);}\r\n                                                                                         ^\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:792:113: error: use of undeclared identifier 'fmodl'\r\ninline _LIBCPP_INLINE_VISIBILITY long double fmod(long double __lcpp_x, long double __lcpp_y) _NOEXCEPT {return fmodl(__lcpp_x, __lcpp_y);}\r\n                                                                                                                ^\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:839:90: error: use of undeclared identifier 'logl'\r\ninline _LIBCPP_INLINE_VISIBILITY long double log(long double __lcpp_x) _NOEXCEPT {return logl(__lcpp_x);}\r\n                                                                                         ^\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:851:92: error: use of undeclared identifier 'log10l'\r\ninline _LIBCPP_INLINE_VISIBILITY long double log10(long double __lcpp_x) _NOEXCEPT {return log10l(__lcpp_x);}\r\n                                                                                           ^\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:863:114: error: use of undeclared identifier 'modfl'\r\ninline _LIBCPP_INLINE_VISIBILITY long double modf(long double __lcpp_x, long double* __lcpp_y) _NOEXCEPT {return modfl(__lcpp_x, __lcpp_y);}\r\n                                                                                                                 ^\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:870:112: error: use of undeclared identifier 'powl'\r\ninline _LIBCPP_INLINE_VISIBILITY long double pow(long double __lcpp_x, long double __lcpp_y) _NOEXCEPT {return powl(__lcpp_x, __lcpp_y);}\r\n                                                                                                               ^\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:893:90: error: use of undeclared identifier 'sinl'\r\ninline _LIBCPP_INLINE_VISIBILITY long double sin(long double __lcpp_x) _NOEXCEPT {return sinl(__lcpp_x);}\r\n                                                                                         ^\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:905:91: error: use of undeclared identifier 'sinhl'\r\ninline _LIBCPP_INLINE_VISIBILITY long double sinh(long double __lcpp_x) _NOEXCEPT {return sinhl(__lcpp_x);}\r\n                                                                                          ^\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:917:91: error: use of undeclared identifier 'sqrtl'\r\ninline _LIBCPP_INLINE_VISIBILITY long double sqrt(long double __lcpp_x) _NOEXCEPT {return sqrtl(__lcpp_x);}\r\n                                                                                          ^\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:931:90: error: use of undeclared identifier 'tanl'\r\ninline _LIBCPP_INLINE_VISIBILITY long double tan(long double __lcpp_x) _NOEXCEPT {return tanl(__lcpp_x);}\r\n                                                                                         ^\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:943:91: error: use of undeclared identifier 'tanhl'\r\ninline _LIBCPP_INLINE_VISIBILITY long double tanh(long double __lcpp_x) _NOEXCEPT {return tanhl(__lcpp_x);}\r\n                                                                                          ^\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:955:92: error: use of undeclared identifier 'acoshl'\r\ninline _LIBCPP_INLINE_VISIBILITY long double acosh(long double __lcpp_x) _NOEXCEPT {return acoshl(__lcpp_x);}\r\n                                                                                           ^\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:967:92: error: use of undeclared identifier 'asinhl'\r\ninline _LIBCPP_INLINE_VISIBILITY long double asinh(long double __lcpp_x) _NOEXCEPT {return asinhl(__lcpp_x);}\r\n                                                                                           ^\r\nfatal error: too many errors emitted, stopping now [-ferror-limit=]\r\n20 errors generated.\r\nTarget //tensorflow:libtensorflow_cc.so failed to build\r\nUse --verbose_failures to see the command lines of failed build steps.\r\nINFO: Elapsed time: 7.012s, Critical Path: 1.84s\r\nINFO: 0 processes.\r\nFAILED: Build did NOT complete successfully\r\n```\r\n\r\n\r\nSo I've tried the same for android-ndk-r12b:\r\n\r\n_first in this way:_ \r\n\r\n**bazel build -c opt //tensorflow/contrib/android:libtensorflow_inference.so --crosstool_top=//external:android/crosstool --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --cpu=armeabi-v7a  --jobs 1**\r\n\r\n_... but got another issue:_ \r\n\r\n```\r\nERROR: /mnt/d/ai/.madman/tensorflow_r1.9-gcc/tensorflow/core/BUILD:2891:1: C++ compilation of rule '//tensorflow/core:gpu_runtime_impl' failed (Exit 1)\r\ntensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc: In member function 'virtual void* tensorflow::GPUNanResetAllocator::AllocateRaw(size_t, size_t)':\r\ntensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:176:27: error: 'nanf' is not a member of 'std'\r\n                           std::nanf(\"\"));\r\n                           ^\r\ntensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:176:27: note: suggested alternative:\r\nIn file included from external/androidndk/ndk/sources/cxx-stl/gnu-libstdc++/4.9/include/cmath:44:0,\r\n                 from external/androidndk/ndk/sources/cxx-stl/gnu-libstdc++/4.9/include/complex:44,\r\n                 from ./tensorflow/core/framework/numeric_types.h:19,\r\n                 from ./tensorflow/core/framework/allocator.h:23,\r\n                 from ./tensorflow/core/common_runtime/visitable_allocator.h:20,\r\n                 from ./tensorflow/core/common_runtime/gpu/gpu_debug_allocator.h:24,\r\n                 from tensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:16:\r\nexternal/androidndk/ndk/platforms/android-14/arch-arm/usr/include/math.h:359:7: note:   'nanf'\r\n float nanf(const char *) __NDK_FPABI_MATH__ __pure2;\r\n       ^\r\ntensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc: In member function 'virtual void tensorflow::GPUNanResetAllocator::DeallocateRaw(void*)':\r\ntensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:191:29: error: 'nanf' is not a member of 'std'\r\n                             std::nanf(\"\"));\r\n                             ^\r\ntensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:191:29: note: suggested alternative:\r\nIn file included from external/androidndk/ndk/sources/cxx-stl/gnu-libstdc++/4.9/include/cmath:44:0,\r\n                 from external/androidndk/ndk/sources/cxx-stl/gnu-libstdc++/4.9/include/complex:44,\r\n                 from ./tensorflow/core/framework/numeric_types.h:19,\r\n                 from ./tensorflow/core/framework/allocator.h:23,\r\n                 from ./tensorflow/core/common_runtime/visitable_allocator.h:20,\r\n                 from ./tensorflow/core/common_runtime/gpu/gpu_debug_allocator.h:24,\r\n                 from tensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:16:\r\nexternal/androidndk/ndk/platforms/android-14/arch-arm/usr/include/math.h:359:7: note:   'nanf'\r\n float nanf(const char *) __NDK_FPABI_MATH__ __pure2;\r\n       ^\r\nTarget //tensorflow:libtensorflow_cc.so failed to build\r\n```\r\n\r\n\r\n_... then again tried to switch to llvm:_ \r\n\r\n**bazel build tensorflow/core:android_tensorflow_lib --crosstool_top=//external:android/crosstool --cpu=armeabi-v7a --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --config monolithic**\r\n\r\n_and again no luck:_ \r\n\r\n```\r\nERROR: /mnt/d/ai/.madman/tensorflow_r1.9-gcc/tensorflow/core/BUILD:2014:1: C++ compilation of rule '//tensorflow/core:lib_internal_impl' failed (Exit 1)\r\nIn file included from external/androidndk/ndk/sources/cxx-stl/llvm-libc++/libcxx/include/memory:614:0,\r\n                 from external/androidndk/ndk/sources/cxx-stl/llvm-libc++/libcxx/include/functional:477,\r\n                 from ./tensorflow/core/lib/core/threadpool.h:19,\r\n                 from tensorflow/core/lib/core/threadpool.cc:16:\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/libcxx/include/atomic: In member function 'void Eigen::EventCount::CommitWait(Eigen::EventCount::Waiter*)':\r\nexternal/androidndk/ndk/sources/cxx-stl/llvm-libc++/libcxx/include/atomic:720:75: error: invalid failure memory model for '__atomic_compare_exchange'\r\n                                    __gcc_atomic::__to_gcc_order(__failure));\r\n                                                                           ^\r\nTarget //tensorflow:libtensorflow_cc.so failed to build\r\nUse --verbose_failures to see the command lines of failed build steps.\r\nINFO: Elapsed time: 617.731s, Critical Path: 11.03s\r\nINFO: 264 processes: 264 local.\r\nFAILED: Build did NOT complete successfully\r\n\r\n```\r\nWhat am I doing wrong? \r\n\r\nP.S. '--jobs 1' seems to be necessary for my environment, otherwise I'm getting different random build issues."}