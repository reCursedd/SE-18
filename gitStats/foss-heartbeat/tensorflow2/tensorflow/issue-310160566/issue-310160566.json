{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18133", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18133/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18133/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18133/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/18133", "id": 310160566, "node_id": "MDU6SXNzdWUzMTAxNjA1NjY=", "number": 18133, "title": "Segmentation fault with TF 1.7 built from source with MKL support", "user": {"login": "zhiz21", "id": 26265105, "node_id": "MDQ6VXNlcjI2MjY1MTA1", "avatar_url": "https://avatars3.githubusercontent.com/u/26265105?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhiz21", "html_url": "https://github.com/zhiz21", "followers_url": "https://api.github.com/users/zhiz21/followers", "following_url": "https://api.github.com/users/zhiz21/following{/other_user}", "gists_url": "https://api.github.com/users/zhiz21/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhiz21/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhiz21/subscriptions", "organizations_url": "https://api.github.com/users/zhiz21/orgs", "repos_url": "https://api.github.com/users/zhiz21/repos", "events_url": "https://api.github.com/users/zhiz21/events{/privacy}", "received_events_url": "https://api.github.com/users/zhiz21/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "bignamehyp", "id": 3474655, "node_id": "MDQ6VXNlcjM0NzQ2NTU=", "avatar_url": "https://avatars2.githubusercontent.com/u/3474655?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bignamehyp", "html_url": "https://github.com/bignamehyp", "followers_url": "https://api.github.com/users/bignamehyp/followers", "following_url": "https://api.github.com/users/bignamehyp/following{/other_user}", "gists_url": "https://api.github.com/users/bignamehyp/gists{/gist_id}", "starred_url": "https://api.github.com/users/bignamehyp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bignamehyp/subscriptions", "organizations_url": "https://api.github.com/users/bignamehyp/orgs", "repos_url": "https://api.github.com/users/bignamehyp/repos", "events_url": "https://api.github.com/users/bignamehyp/events{/privacy}", "received_events_url": "https://api.github.com/users/bignamehyp/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "bignamehyp", "id": 3474655, "node_id": "MDQ6VXNlcjM0NzQ2NTU=", "avatar_url": "https://avatars2.githubusercontent.com/u/3474655?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bignamehyp", "html_url": "https://github.com/bignamehyp", "followers_url": "https://api.github.com/users/bignamehyp/followers", "following_url": "https://api.github.com/users/bignamehyp/following{/other_user}", "gists_url": "https://api.github.com/users/bignamehyp/gists{/gist_id}", "starred_url": "https://api.github.com/users/bignamehyp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bignamehyp/subscriptions", "organizations_url": "https://api.github.com/users/bignamehyp/orgs", "repos_url": "https://api.github.com/users/bignamehyp/repos", "events_url": "https://api.github.com/users/bignamehyp/events{/privacy}", "received_events_url": "https://api.github.com/users/bignamehyp/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 15, "created_at": "2018-03-30T20:25:29Z", "updated_at": "2018-07-12T19:06:44Z", "closed_at": "2018-07-12T19:04:21Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: NO</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:  Amazon Linux (Linux version 4.9.85-38.58.amzn1.x86_64)</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: source</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.7.0</li>\n<li><strong>Python version</strong>: 2.7</li>\n<li><strong>Bazel version (if compiling from source)</strong>: 0.11.1</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: 5.3.0</li>\n<li><strong>CUDA/cuDNN version</strong>: None</li>\n<li><strong>GPU model and memory</strong>: None</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<pre><code>git clone -b r1.7 https://github.com/tensorflow/tensorflow.git\ncd tensorflow\n./configure\nbazel build --jobs $(nproc) --config=opt --config=mkl --cxxopt=\"-D_GLIBCXX_USE_CXX11_ABI=0\" --copt=\"-DEIGEN_USE_VML\" //tensorflow/tools/pip_package:build_pip_package\n\ngit clone https://github.com/tensorflow/models.git\ncd models/tutorials/image/cifar10/\npython cifar10_train.py\n</code></pre>\n<p><strong>Result:</strong></p>\n<pre><code>[ec2-user@ip-xxx-xx-xx-xxx cifar10]$ python cifar10_train.py\nFilling queue with 20000 CIFAR images before starting to train. This will take a few minutes.\nSegmentation fault\n</code></pre>\n<h3>Describe the problem</h3>\n<p>I tried to compile TF 1.7 from source with MKL and AVX512 support on my AWS EC2 C5.18xlarge instance.<br>\nThis Segmentation fault appeared when running cifar10_train.py. This error appeared with TF1.5 as well and TF 1.6 fixed it, but now it appears again with 1.7.<br>\nI have tried to compile TF without AVX512 with following commands and this error didn't appear again:</p>\n<pre><code>bazel build --jobs $(nproc) --cxxopt=\"-D_GLIBCXX_USE_CXX11_ABI=0\" --config=mkl --copt=-msse4.1 --copt=-msse4.2 --copt=-mavx2 --copt=-mavx --copt=-mfma --copt=\"-DEIGEN_USE_VML\" //tensorflow/tools/pip_package:build_pip_package\n</code></pre>\n<p>So I'm guessing this issue is related with AVX512.</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): NO\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):  Amazon Linux (Linux version 4.9.85-38.58.amzn1.x86_64)\nTensorFlow installed from (source or binary): source\nTensorFlow version (use command below): 1.7.0\nPython version: 2.7\nBazel version (if compiling from source): 0.11.1\nGCC/Compiler version (if compiling from source): 5.3.0\nCUDA/cuDNN version: None\nGPU model and memory: None\nExact command to reproduce:\n\ngit clone -b r1.7 https://github.com/tensorflow/tensorflow.git\ncd tensorflow\n./configure\nbazel build --jobs $(nproc) --config=opt --config=mkl --cxxopt=\"-D_GLIBCXX_USE_CXX11_ABI=0\" --copt=\"-DEIGEN_USE_VML\" //tensorflow/tools/pip_package:build_pip_package\n\ngit clone https://github.com/tensorflow/models.git\ncd models/tutorials/image/cifar10/\npython cifar10_train.py\n\nResult:\n[ec2-user@ip-xxx-xx-xx-xxx cifar10]$ python cifar10_train.py\nFilling queue with 20000 CIFAR images before starting to train. This will take a few minutes.\nSegmentation fault\n\nDescribe the problem\nI tried to compile TF 1.7 from source with MKL and AVX512 support on my AWS EC2 C5.18xlarge instance.\nThis Segmentation fault appeared when running cifar10_train.py. This error appeared with TF1.5 as well and TF 1.6 fixed it, but now it appears again with 1.7.\nI have tried to compile TF without AVX512 with following commands and this error didn't appear again:\nbazel build --jobs $(nproc) --cxxopt=\"-D_GLIBCXX_USE_CXX11_ABI=0\" --config=mkl --copt=-msse4.1 --copt=-msse4.2 --copt=-mavx2 --copt=-mavx --copt=-mfma --copt=\"-DEIGEN_USE_VML\" //tensorflow/tools/pip_package:build_pip_package\n\nSo I'm guessing this issue is related with AVX512.", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: NO\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:  Amazon Linux (Linux version 4.9.85-38.58.amzn1.x86_64)\r\n- **TensorFlow installed from (source or binary)**: source\r\n- **TensorFlow version (use command below)**: 1.7.0\r\n- **Python version**: 2.7\r\n- **Bazel version (if compiling from source)**: 0.11.1\r\n- **GCC/Compiler version (if compiling from source)**: 5.3.0\r\n- **CUDA/cuDNN version**: None\r\n- **GPU model and memory**: None\r\n- **Exact command to reproduce**:\r\n```\r\ngit clone -b r1.7 https://github.com/tensorflow/tensorflow.git\r\ncd tensorflow\r\n./configure\r\nbazel build --jobs $(nproc) --config=opt --config=mkl --cxxopt=\"-D_GLIBCXX_USE_CXX11_ABI=0\" --copt=\"-DEIGEN_USE_VML\" //tensorflow/tools/pip_package:build_pip_package\r\n\r\ngit clone https://github.com/tensorflow/models.git\r\ncd models/tutorials/image/cifar10/\r\npython cifar10_train.py\r\n```\r\n**Result:**\r\n```\r\n[ec2-user@ip-xxx-xx-xx-xxx cifar10]$ python cifar10_train.py\r\nFilling queue with 20000 CIFAR images before starting to train. This will take a few minutes.\r\nSegmentation fault\r\n```\r\n\r\n### Describe the problem\r\nI tried to compile TF 1.7 from source with MKL and AVX512 support on my AWS EC2 C5.18xlarge instance. \r\nThis Segmentation fault appeared when running cifar10_train.py. This error appeared with TF1.5 as well and TF 1.6 fixed it, but now it appears again with 1.7. \r\nI have tried to compile TF without AVX512 with following commands and this error didn't appear again:\r\n```\r\nbazel build --jobs $(nproc) --cxxopt=\"-D_GLIBCXX_USE_CXX11_ABI=0\" --config=mkl --copt=-msse4.1 --copt=-msse4.2 --copt=-mavx2 --copt=-mavx --copt=-mfma --copt=\"-DEIGEN_USE_VML\" //tensorflow/tools/pip_package:build_pip_package\r\n```\r\nSo I'm guessing this issue is related with AVX512.\r\n"}