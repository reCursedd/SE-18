{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/369175634", "html_url": "https://github.com/tensorflow/tensorflow/issues/17013#issuecomment-369175634", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17013", "id": 369175634, "node_id": "MDEyOklzc3VlQ29tbWVudDM2OTE3NTYzNA==", "user": {"login": "jspark-cochlearai", "id": 35288275, "node_id": "MDQ6VXNlcjM1Mjg4Mjc1", "avatar_url": "https://avatars3.githubusercontent.com/u/35288275?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jspark-cochlearai", "html_url": "https://github.com/jspark-cochlearai", "followers_url": "https://api.github.com/users/jspark-cochlearai/followers", "following_url": "https://api.github.com/users/jspark-cochlearai/following{/other_user}", "gists_url": "https://api.github.com/users/jspark-cochlearai/gists{/gist_id}", "starred_url": "https://api.github.com/users/jspark-cochlearai/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jspark-cochlearai/subscriptions", "organizations_url": "https://api.github.com/users/jspark-cochlearai/orgs", "repos_url": "https://api.github.com/users/jspark-cochlearai/repos", "events_url": "https://api.github.com/users/jspark-cochlearai/events{/privacy}", "received_events_url": "https://api.github.com/users/jspark-cochlearai/received_events", "type": "User", "site_admin": false}, "created_at": "2018-02-28T09:26:56Z", "updated_at": "2018-02-28T09:30:54Z", "author_association": "NONE", "body_html": "<p>I am suffering from the same problem. I want to replace the model in the tensorflow for android demo app (<a href=\"https://github.com/tensorflow/tensorflow\">https://github.com/tensorflow/tensorflow</a>) with my custom model but I never succeeded. Below are what I have tried so far:</p>\n<ol>\n<li>\n<p>I replaced the <code>.pb</code> file and its corresponding labels. But it showed runtime error something like<br>\n<code>No OpKernel was registered to support Op 'ListDiff'</code><br>\nThis is because my model requires some additional tensorflow operations like <code>ListDiff</code> which are not included in <code>org.tensorflow:tensorflow-android</code>.</p>\n</li>\n<li>\n<p>I followed the instructions that I found by googling most of which mention rebuilding <code>libtensorflow_inference.so</code> with this command:<br>\n<code>bazel build -c opt --copt=\"-DSELECTIVE_REGISTRATION\" --copt=\"-DSUPPORT_SELECTIVE_REGISTRATION\" //tensorflow/contrib/android:libtensorflow_inference.so     --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --crosstool_top=//external:android/crosstool --cpu=armeabi-v7a --verbose_failures</code><br>\nAfter that I copied <code>libtensorflow_inference.so</code> to the <code>libs/armeabi-v7a</code> folder under my android example folder.<br>\nBut it also failed.</p>\n</li>\n<li>\n<p>I tried a number of options when building the <code>libtensorflow_inference.so</code> (like removing selective registration) and it failed. Supporting selective registration affected the file size of <code>libtensorflow_inference.so</code> from 13.7MB to 3.4MB but it seems that the operations used in my <code>.pb</code> file like <code>ListDiff</code> are excluded in the both cases.</p>\n</li>\n<li>\n<p>What is more interesting is that <code>ops_to_register.h</code> was properly generated. The <code>ListDiff</code> operation was included in the <code>ops_to_register.h</code>. Besides, when I tried to build the <code>libtensorflow_inference.so</code> without <code>ops_to_register.h</code> it gave an error as<br>\n<code>./tensorflow/core/framework/selective_registration.h:46:10: fatal error: 'ops_to_register.h' file not found</code><br>\nBut when I examined the <code>libtensorflow_inference.so</code> file with <code>nm -D libtensorflow_inference.so</code> command, I could not find the <code>ListDiff</code> operation in it.</p>\n</li>\n<li>\n<p>To avoid collisions of any kind, I commented out<br>\n<code>compile 'org.tensorflow:tensorflow-android:+'</code><br>\nand inserted<br>\n<code>compile fileTree(dir: 'libs', include: ['*.jar', '**/*.so'])</code><br>\nbut it did not solve the problem.</p>\n</li>\n<li>\n<p>I compressed the <code>.so</code> file after I put it into <code>lib</code> folder and changed the file extension from <code>zip</code> to <code>.jar</code>, but it did not help.<br>\nI guess this is because the operations are already missing in the <code>.so</code> file.</p>\n</li>\n<li>\n<p>As my phone uses 64-bit CPU, I changed <code>armeabi-v7a</code> to <code>arm64-v8a</code> when building the native library. However, it did notwork.<br>\n(This failure was expected in advance actually because <code>arm64-v8a</code> systems are compatible with <code>armeabi-v7a</code> libraries.)</p>\n</li>\n<li>\n<p>I do not remember the exact code but I have added scripts that import the native library to the <code>.java</code> file but it did not work.</p>\n</li>\n</ol>\n<p>I am using android ndk r14b  and sdk 26.0.1 (and 27.0.3) in Mac OS X and ubuntu 16.04.<br>\nDoes anyone have a solution?</p>", "body_text": "I am suffering from the same problem. I want to replace the model in the tensorflow for android demo app (https://github.com/tensorflow/tensorflow) with my custom model but I never succeeded. Below are what I have tried so far:\n\n\nI replaced the .pb file and its corresponding labels. But it showed runtime error something like\nNo OpKernel was registered to support Op 'ListDiff'\nThis is because my model requires some additional tensorflow operations like ListDiff which are not included in org.tensorflow:tensorflow-android.\n\n\nI followed the instructions that I found by googling most of which mention rebuilding libtensorflow_inference.so with this command:\nbazel build -c opt --copt=\"-DSELECTIVE_REGISTRATION\" --copt=\"-DSUPPORT_SELECTIVE_REGISTRATION\" //tensorflow/contrib/android:libtensorflow_inference.so     --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --crosstool_top=//external:android/crosstool --cpu=armeabi-v7a --verbose_failures\nAfter that I copied libtensorflow_inference.so to the libs/armeabi-v7a folder under my android example folder.\nBut it also failed.\n\n\nI tried a number of options when building the libtensorflow_inference.so (like removing selective registration) and it failed. Supporting selective registration affected the file size of libtensorflow_inference.so from 13.7MB to 3.4MB but it seems that the operations used in my .pb file like ListDiff are excluded in the both cases.\n\n\nWhat is more interesting is that ops_to_register.h was properly generated. The ListDiff operation was included in the ops_to_register.h. Besides, when I tried to build the libtensorflow_inference.so without ops_to_register.h it gave an error as\n./tensorflow/core/framework/selective_registration.h:46:10: fatal error: 'ops_to_register.h' file not found\nBut when I examined the libtensorflow_inference.so file with nm -D libtensorflow_inference.so command, I could not find the ListDiff operation in it.\n\n\nTo avoid collisions of any kind, I commented out\ncompile 'org.tensorflow:tensorflow-android:+'\nand inserted\ncompile fileTree(dir: 'libs', include: ['*.jar', '**/*.so'])\nbut it did not solve the problem.\n\n\nI compressed the .so file after I put it into lib folder and changed the file extension from zip to .jar, but it did not help.\nI guess this is because the operations are already missing in the .so file.\n\n\nAs my phone uses 64-bit CPU, I changed armeabi-v7a to arm64-v8a when building the native library. However, it did notwork.\n(This failure was expected in advance actually because arm64-v8a systems are compatible with armeabi-v7a libraries.)\n\n\nI do not remember the exact code but I have added scripts that import the native library to the .java file but it did not work.\n\n\nI am using android ndk r14b  and sdk 26.0.1 (and 27.0.3) in Mac OS X and ubuntu 16.04.\nDoes anyone have a solution?", "body": "I am suffering from the same problem. I want to replace the model in the tensorflow for android demo app (https://github.com/tensorflow/tensorflow) with my custom model but I never succeeded. Below are what I have tried so far:\r\n\r\n1. I replaced the `.pb` file and its corresponding labels. But it showed runtime error something like\r\n`No OpKernel was registered to support Op 'ListDiff'`\r\nThis is because my model requires some additional tensorflow operations like `ListDiff` which are not included in `org.tensorflow:tensorflow-android`.\r\n\r\n2. I followed the instructions that I found by googling most of which mention rebuilding `libtensorflow_inference.so` with this command:\r\n`bazel build -c opt --copt=\"-DSELECTIVE_REGISTRATION\" --copt=\"-DSUPPORT_SELECTIVE_REGISTRATION\" //tensorflow/contrib/android:libtensorflow_inference.so     --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --crosstool_top=//external:android/crosstool --cpu=armeabi-v7a --verbose_failures`\r\nAfter that I copied `libtensorflow_inference.so` to the `libs/armeabi-v7a` folder under my android example folder. \r\nBut it also failed.\r\n\r\n3. I tried a number of options when building the `libtensorflow_inference.so` (like removing selective registration) and it failed. Supporting selective registration affected the file size of `libtensorflow_inference.so` from 13.7MB to 3.4MB but it seems that the operations used in my `.pb` file like `ListDiff` are excluded in the both cases.\r\n\r\n4. What is more interesting is that `ops_to_register.h` was properly generated. The `ListDiff` operation was included in the `ops_to_register.h`. Besides, when I tried to build the `libtensorflow_inference.so` without `ops_to_register.h` it gave an error as\r\n`./tensorflow/core/framework/selective_registration.h:46:10: fatal error: 'ops_to_register.h' file not found`\r\nBut when I examined the `libtensorflow_inference.so` file with `nm -D libtensorflow_inference.so` command, I could not find the `ListDiff` operation in it.\r\n\r\n5. To avoid collisions of any kind, I commented out\r\n`compile 'org.tensorflow:tensorflow-android:+'`\r\nand inserted\r\n`compile fileTree(dir: 'libs', include: ['*.jar', '**/*.so'])`\r\nbut it did not solve the problem.\r\n\r\n6. I compressed the `.so` file after I put it into `lib` folder and changed the file extension from `zip` to `.jar`, but it did not help.\r\nI guess this is because the operations are already missing in the `.so` file.\r\n\r\n7. As my phone uses 64-bit CPU, I changed `armeabi-v7a` to `arm64-v8a` when building the native library. However, it did notwork.\r\n(This failure was expected in advance actually because `arm64-v8a` systems are compatible with `armeabi-v7a` libraries.)\r\n\r\n8. I do not remember the exact code but I have added scripts that import the native library to the `.java` file but it did not work.\r\n\r\n\r\nI am using android ndk r14b  and sdk 26.0.1 (and 27.0.3) in Mac OS X and ubuntu 16.04.\r\nDoes anyone have a solution?\r\n"}