{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2215", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2215/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2215/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2215/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/2215", "id": 152937284, "node_id": "MDU6SXNzdWUxNTI5MzcyODQ=", "number": 2215, "title": "How to classify an image with the trained cifar10 model?", "user": {"login": "yhlleo", "id": 13311630, "node_id": "MDQ6VXNlcjEzMzExNjMw", "avatar_url": "https://avatars0.githubusercontent.com/u/13311630?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yhlleo", "html_url": "https://github.com/yhlleo", "followers_url": "https://api.github.com/users/yhlleo/followers", "following_url": "https://api.github.com/users/yhlleo/following{/other_user}", "gists_url": "https://api.github.com/users/yhlleo/gists{/gist_id}", "starred_url": "https://api.github.com/users/yhlleo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yhlleo/subscriptions", "organizations_url": "https://api.github.com/users/yhlleo/orgs", "repos_url": "https://api.github.com/users/yhlleo/repos", "events_url": "https://api.github.com/users/yhlleo/events{/privacy}", "received_events_url": "https://api.github.com/users/yhlleo/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2016-05-04T06:13:54Z", "updated_at": "2017-07-26T14:13:48Z", "closed_at": "2016-06-07T06:00:18Z", "author_association": "NONE", "body_html": "<p>After trained a cifar10 model, I want to test the model with a image. There are some other people trying to make it, but it's still a confusing question. My test code is presented, as follows:</p>\n<pre><code>from datetime import datetime\nimport math\nimport time\n\nimport numpy as np\nimport tensorflow as tf\nimport cifar10\n\nFLAGS = tf.app.flags.FLAGS\n\ntf.app.flags.DEFINE_string('checkpoint_dir', 'cifar10_train/',\n                           \"\"\"Directory where to read model checkpoints.\"\"\")\n\n\ndef  evaluate_images(images):\n  logit = cifar10.inference(images)\n  load_trained_model(logit)\n\ndef load_trained_model(logits):\n  with tf.Session() as sess:\n    sess.run(tf.initialize_all_variables())\n    ckpt = tf.train.get_checkpoint_state(FLAGS.checkpoint_dir)\n    if ckpt and ckpt.model_checkpoint_path:\n      # Restores from checkpoint\n      saver.restore(sess, ckpt.model_checkpoint_path)\n    else:\n      print('No checkpoint file found')\n      return\n\n    predict = tf.argmax(logits,1)\n    print(predict.eval(), '\\n')\n\ndef img_read(filename):\n  if not tf.gfile.Exists(filename):\n    tf.logging.fatal('File does not exists %s', filename)\n  image_data = tf.gfile.FastGFile(filename, 'rb').read()\n  image = tf.cast(image_data, tf.float32)\n  return image\n\nfilename = '1.png'\nimages = img_read(filename)\nevaluate_images(images)\n</code></pre>\n<p>But it occurs the bug:</p>\n<pre><code>File \"/home/swoda/tensorflow/tensorflow/models/image/cifar10/cifar10.py\", line 192, in inference\n    conv = tf.nn.conv2d(images, kernel, [1, 1, 1, 1], padding='SAME')\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_nn_ops.py\", line 295, in conv2d\n    data_format=data_format, name=name)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/op_def_library.py\", line 655, in apply_op\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2156, in create_op\n    set_shapes_for_outputs(ret)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1612, in set_shapes_for_outputs\n    shapes = shape_func(op)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/common_shapes.py\", line 202, in conv2d_shape\n    input_shape = op.inputs[0].get_shape().with_rank(4)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/tensor_shape.py\", line 625, in with_rank\n    raise ValueError(\"Shape %s must have rank %d\" % (self, rank))\nValueError: Shape () must have rank 4\n</code></pre>\n<p>If you know how to fix this problem, please tell me. Thank you very much!</p>", "body_text": "After trained a cifar10 model, I want to test the model with a image. There are some other people trying to make it, but it's still a confusing question. My test code is presented, as follows:\nfrom datetime import datetime\nimport math\nimport time\n\nimport numpy as np\nimport tensorflow as tf\nimport cifar10\n\nFLAGS = tf.app.flags.FLAGS\n\ntf.app.flags.DEFINE_string('checkpoint_dir', 'cifar10_train/',\n                           \"\"\"Directory where to read model checkpoints.\"\"\")\n\n\ndef  evaluate_images(images):\n  logit = cifar10.inference(images)\n  load_trained_model(logit)\n\ndef load_trained_model(logits):\n  with tf.Session() as sess:\n    sess.run(tf.initialize_all_variables())\n    ckpt = tf.train.get_checkpoint_state(FLAGS.checkpoint_dir)\n    if ckpt and ckpt.model_checkpoint_path:\n      # Restores from checkpoint\n      saver.restore(sess, ckpt.model_checkpoint_path)\n    else:\n      print('No checkpoint file found')\n      return\n\n    predict = tf.argmax(logits,1)\n    print(predict.eval(), '\\n')\n\ndef img_read(filename):\n  if not tf.gfile.Exists(filename):\n    tf.logging.fatal('File does not exists %s', filename)\n  image_data = tf.gfile.FastGFile(filename, 'rb').read()\n  image = tf.cast(image_data, tf.float32)\n  return image\n\nfilename = '1.png'\nimages = img_read(filename)\nevaluate_images(images)\n\nBut it occurs the bug:\nFile \"/home/swoda/tensorflow/tensorflow/models/image/cifar10/cifar10.py\", line 192, in inference\n    conv = tf.nn.conv2d(images, kernel, [1, 1, 1, 1], padding='SAME')\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_nn_ops.py\", line 295, in conv2d\n    data_format=data_format, name=name)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/op_def_library.py\", line 655, in apply_op\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2156, in create_op\n    set_shapes_for_outputs(ret)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1612, in set_shapes_for_outputs\n    shapes = shape_func(op)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/common_shapes.py\", line 202, in conv2d_shape\n    input_shape = op.inputs[0].get_shape().with_rank(4)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/tensor_shape.py\", line 625, in with_rank\n    raise ValueError(\"Shape %s must have rank %d\" % (self, rank))\nValueError: Shape () must have rank 4\n\nIf you know how to fix this problem, please tell me. Thank you very much!", "body": "After trained a cifar10 model, I want to test the model with a image. There are some other people trying to make it, but it's still a confusing question. My test code is presented, as follows:\n\n```\nfrom datetime import datetime\nimport math\nimport time\n\nimport numpy as np\nimport tensorflow as tf\nimport cifar10\n\nFLAGS = tf.app.flags.FLAGS\n\ntf.app.flags.DEFINE_string('checkpoint_dir', 'cifar10_train/',\n                           \"\"\"Directory where to read model checkpoints.\"\"\")\n\n\ndef  evaluate_images(images):\n  logit = cifar10.inference(images)\n  load_trained_model(logit)\n\ndef load_trained_model(logits):\n  with tf.Session() as sess:\n    sess.run(tf.initialize_all_variables())\n    ckpt = tf.train.get_checkpoint_state(FLAGS.checkpoint_dir)\n    if ckpt and ckpt.model_checkpoint_path:\n      # Restores from checkpoint\n      saver.restore(sess, ckpt.model_checkpoint_path)\n    else:\n      print('No checkpoint file found')\n      return\n\n    predict = tf.argmax(logits,1)\n    print(predict.eval(), '\\n')\n\ndef img_read(filename):\n  if not tf.gfile.Exists(filename):\n    tf.logging.fatal('File does not exists %s', filename)\n  image_data = tf.gfile.FastGFile(filename, 'rb').read()\n  image = tf.cast(image_data, tf.float32)\n  return image\n\nfilename = '1.png'\nimages = img_read(filename)\nevaluate_images(images)\n```\n\nBut it occurs the bug: \n\n```\nFile \"/home/swoda/tensorflow/tensorflow/models/image/cifar10/cifar10.py\", line 192, in inference\n    conv = tf.nn.conv2d(images, kernel, [1, 1, 1, 1], padding='SAME')\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_nn_ops.py\", line 295, in conv2d\n    data_format=data_format, name=name)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/op_def_library.py\", line 655, in apply_op\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2156, in create_op\n    set_shapes_for_outputs(ret)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1612, in set_shapes_for_outputs\n    shapes = shape_func(op)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/common_shapes.py\", line 202, in conv2d_shape\n    input_shape = op.inputs[0].get_shape().with_rank(4)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/tensor_shape.py\", line 625, in with_rank\n    raise ValueError(\"Shape %s must have rank %d\" % (self, rank))\nValueError: Shape () must have rank 4\n```\n\nIf you know how to fix this problem, please tell me. Thank you very much!\n"}