{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/420017453", "html_url": "https://github.com/tensorflow/tensorflow/issues/15805#issuecomment-420017453", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15805", "id": 420017453, "node_id": "MDEyOklzc3VlQ29tbWVudDQyMDAxNzQ1Mw==", "user": {"login": "fzhu129", "id": 11604578, "node_id": "MDQ6VXNlcjExNjA0NTc4", "avatar_url": "https://avatars0.githubusercontent.com/u/11604578?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fzhu129", "html_url": "https://github.com/fzhu129", "followers_url": "https://api.github.com/users/fzhu129/followers", "following_url": "https://api.github.com/users/fzhu129/following{/other_user}", "gists_url": "https://api.github.com/users/fzhu129/gists{/gist_id}", "starred_url": "https://api.github.com/users/fzhu129/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fzhu129/subscriptions", "organizations_url": "https://api.github.com/users/fzhu129/orgs", "repos_url": "https://api.github.com/users/fzhu129/repos", "events_url": "https://api.github.com/users/fzhu129/events{/privacy}", "received_events_url": "https://api.github.com/users/fzhu129/received_events", "type": "User", "site_admin": false}, "created_at": "2018-09-10T18:40:17Z", "updated_at": "2018-09-10T20:19:38Z", "author_association": "NONE", "body_html": "<p><a href=\"https://github.com/tensorflow/tensorflow/files/2367966/freeze_tryout.zip\">freeze_tryout.zip</a><br>\nHi <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=12046469\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/xiaofansong\">@xiaofansong</a>: I have tried out the with attached freeze_tryout.zip with .pbtxt file but still fail to <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=7223627\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jyoungyun\">@jyoungyun</a>'s code.</p>\n<p>Use below command to run the code:<br>\npython mnist.py (result will be saved in save folder in current pwd)<br>\npython simple_freeze.py (savegraph.pbtxt will be saved in the folder save)</p>\n<p>bazel run tensorflow/contrib/lite/toco:toco -- <br>\n--input_file=/home/frankzhu/TestPrj/lstm_try/save/frozen_model_Sample_model.pb <br>\n--input_format=TENSORFLOW_GRAPHDEF <br>\n--output_format=TFLITE <br>\n--output_file=/home/frankzhu/TestPrj/lstm_try/save/lstm.tflite <br>\n--input_arrays=\"Placeholder\" <br>\n--input_shapes=1,28,28 <br>\n--output_arrays=\"output\" <br>\n--allow_custom_ops<br>\nthe lstm.tflite can be created.<br>\nINFO: Running command line: bazel-bin/tensorflow/contrib/lite/toco/toco '--input_file=/home/frankzhu/TestPrj/lstm_try/save/frozen_model_Sample_model.pb' '--input_format=TENSORFLOW_GRAPHDEF' '--output_format=TFLITE' '--output_file=/home/frankzhu/TestPrj/lstm_try/save/lstm.tflite' '--input_arrays=Placeholder' '--input_shapes=1,28,28' '--output_arrays=oINFO: Build completed successfully, 1 total action<br>\n2018-09-10 13:12:50.300403: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Unpack<br>\n2018-09-10 13:12:50.307606: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before Removing unused ops: 407 operators, 618 arrays (0 quantized)<br>\n2018-09-10 13:12:50.318362: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before general graph transformations: 407 operators, 618 arrays (0 quantized)<br>\n2018-09-10 13:12:50.348429: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After general graph transformations pass 1: 374 operators, 609 arrays (0 quantized)<br>\n2018-09-10 13:12:50.364372: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before dequantization graph transformations: 374 operators, 609 arrays (0 quantized)<br>\n2018-09-10 13:12:50.373883: I tensorflow/contrib/lite/toco/allocate_transient_arrays.cc:329] Total transient array allocated size: 0 bytes, theoretical optimal value: 0 bytes.<br>\n2018-09-10 13:12:50.377671: W tensorflow/contrib/lite/toco/tflite/operator.cc:879] Ignoring unsupported attribute type with key 'T'</p>\n<p>but when run below command for getting quantized int8 there is core dump.<br>\nbazel run tensorflow/contrib/lite/toco:toco -- <br>\n--input_file=/home/frankzhu/TestPrj/lstm_try/save/frozen_model_Sample_model.pb <br>\n--input_format=TENSORFLOW_GRAPHDEF <br>\n--output_format=TFLITE <br>\n--output_file=/home/frankzhu/TestPrj/lstm_try/save/lstm.tflite <br>\n--inference_type=QUANTIZED_UINT8 <br>\n--inference_input_type=QUANTIZED_UINT8 <br>\n--input_arrays=\"Placeholder\" <br>\n--input_shapes=1,28,28 <br>\n--output_arrays=\"output\" <br>\n--allow_custom_ops<br>\ncore dump for this one and unpack not supported.</p>\n<p>INFO: Build completed successfully, 1 total action<br>\n2018-09-10 13:15:10.565575: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Unpack<br>\n2018-09-10 13:15:10.572736: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before Removing unused ops: 407 operators, 618 arrays (0 quantized)<br>\n2018-09-10 13:15:10.582917: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before general graph transformations: 407 operators, 618 arrays (0 quantized)<br>\n2018-09-10 13:15:10.610551: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After general graph transformations pass 1: 375 operators, 610 arrays (1 quantized)<br>\n2018-09-10 13:15:10.626365: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before pre-quantization graph transformations: 375 operators, 610 arrays (1 quantized)<br>\n2018-09-10 13:15:10.634396: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before quantization graph transformations: 375 operators, 610 arrays (1 quantized)<br>\n2018-09-10 13:15:10.634417: F tensorflow/contrib/lite/toco/graph_transformations/quantize.cc:456] Unimplemented: this graph contains an operator of type (<strong>Unsupported TensorFlow op: Unpack) for which the quantized form is not yet implemented. Sorry, and patches welcome (that's a relatively fun patch to write, mostly providing the actual quantized arithmetic code for this op).</strong><br>\nAborted (core dumped)</p>\n<p>Any ideas?<br>\nAnybody can help?</p>\n<p>Thanks and best regards<br>\nFrank</p>", "body_text": "freeze_tryout.zip\nHi @xiaofansong: I have tried out the with attached freeze_tryout.zip with .pbtxt file but still fail to @jyoungyun's code.\nUse below command to run the code:\npython mnist.py (result will be saved in save folder in current pwd)\npython simple_freeze.py (savegraph.pbtxt will be saved in the folder save)\nbazel run tensorflow/contrib/lite/toco:toco -- \n--input_file=/home/frankzhu/TestPrj/lstm_try/save/frozen_model_Sample_model.pb \n--input_format=TENSORFLOW_GRAPHDEF \n--output_format=TFLITE \n--output_file=/home/frankzhu/TestPrj/lstm_try/save/lstm.tflite \n--input_arrays=\"Placeholder\" \n--input_shapes=1,28,28 \n--output_arrays=\"output\" \n--allow_custom_ops\nthe lstm.tflite can be created.\nINFO: Running command line: bazel-bin/tensorflow/contrib/lite/toco/toco '--input_file=/home/frankzhu/TestPrj/lstm_try/save/frozen_model_Sample_model.pb' '--input_format=TENSORFLOW_GRAPHDEF' '--output_format=TFLITE' '--output_file=/home/frankzhu/TestPrj/lstm_try/save/lstm.tflite' '--input_arrays=Placeholder' '--input_shapes=1,28,28' '--output_arrays=oINFO: Build completed successfully, 1 total action\n2018-09-10 13:12:50.300403: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Unpack\n2018-09-10 13:12:50.307606: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before Removing unused ops: 407 operators, 618 arrays (0 quantized)\n2018-09-10 13:12:50.318362: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before general graph transformations: 407 operators, 618 arrays (0 quantized)\n2018-09-10 13:12:50.348429: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After general graph transformations pass 1: 374 operators, 609 arrays (0 quantized)\n2018-09-10 13:12:50.364372: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before dequantization graph transformations: 374 operators, 609 arrays (0 quantized)\n2018-09-10 13:12:50.373883: I tensorflow/contrib/lite/toco/allocate_transient_arrays.cc:329] Total transient array allocated size: 0 bytes, theoretical optimal value: 0 bytes.\n2018-09-10 13:12:50.377671: W tensorflow/contrib/lite/toco/tflite/operator.cc:879] Ignoring unsupported attribute type with key 'T'\nbut when run below command for getting quantized int8 there is core dump.\nbazel run tensorflow/contrib/lite/toco:toco -- \n--input_file=/home/frankzhu/TestPrj/lstm_try/save/frozen_model_Sample_model.pb \n--input_format=TENSORFLOW_GRAPHDEF \n--output_format=TFLITE \n--output_file=/home/frankzhu/TestPrj/lstm_try/save/lstm.tflite \n--inference_type=QUANTIZED_UINT8 \n--inference_input_type=QUANTIZED_UINT8 \n--input_arrays=\"Placeholder\" \n--input_shapes=1,28,28 \n--output_arrays=\"output\" \n--allow_custom_ops\ncore dump for this one and unpack not supported.\nINFO: Build completed successfully, 1 total action\n2018-09-10 13:15:10.565575: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Unpack\n2018-09-10 13:15:10.572736: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before Removing unused ops: 407 operators, 618 arrays (0 quantized)\n2018-09-10 13:15:10.582917: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before general graph transformations: 407 operators, 618 arrays (0 quantized)\n2018-09-10 13:15:10.610551: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After general graph transformations pass 1: 375 operators, 610 arrays (1 quantized)\n2018-09-10 13:15:10.626365: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before pre-quantization graph transformations: 375 operators, 610 arrays (1 quantized)\n2018-09-10 13:15:10.634396: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before quantization graph transformations: 375 operators, 610 arrays (1 quantized)\n2018-09-10 13:15:10.634417: F tensorflow/contrib/lite/toco/graph_transformations/quantize.cc:456] Unimplemented: this graph contains an operator of type (Unsupported TensorFlow op: Unpack) for which the quantized form is not yet implemented. Sorry, and patches welcome (that's a relatively fun patch to write, mostly providing the actual quantized arithmetic code for this op).\nAborted (core dumped)\nAny ideas?\nAnybody can help?\nThanks and best regards\nFrank", "body": "[freeze_tryout.zip](https://github.com/tensorflow/tensorflow/files/2367966/freeze_tryout.zip)\r\nHi @xiaofansong: I have tried out the with attached freeze_tryout.zip with .pbtxt file but still fail to @jyoungyun's code.\r\n\r\nUse below command to run the code:\r\npython mnist.py (result will be saved in save folder in current pwd)\r\npython simple_freeze.py (savegraph.pbtxt will be saved in the folder save)\r\n\r\nbazel run tensorflow/contrib/lite/toco:toco -- \\\r\n--input_file=/home/frankzhu/TestPrj/lstm_try/save/frozen_model_Sample_model.pb \\\r\n--input_format=TENSORFLOW_GRAPHDEF \\\r\n--output_format=TFLITE \\\r\n--output_file=/home/frankzhu/TestPrj/lstm_try/save/lstm.tflite \\\r\n--input_arrays=\"Placeholder\" \\\r\n--input_shapes=1,28,28 \\\r\n--output_arrays=\"output\" \\\r\n--allow_custom_ops\r\nthe lstm.tflite can be created.\r\nINFO: Running command line: bazel-bin/tensorflow/contrib/lite/toco/toco '--input_file=/home/frankzhu/TestPrj/lstm_try/save/frozen_model_Sample_model.pb' '--input_format=TENSORFLOW_GRAPHDEF' '--output_format=TFLITE' '--output_file=/home/frankzhu/TestPrj/lstm_try/save/lstm.tflite' '--input_arrays=Placeholder' '--input_shapes=1,28,28' '--output_arrays=oINFO: Build completed successfully, 1 total action\r\n2018-09-10 13:12:50.300403: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Unpack\r\n2018-09-10 13:12:50.307606: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before Removing unused ops: 407 operators, 618 arrays (0 quantized)\r\n2018-09-10 13:12:50.318362: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before general graph transformations: 407 operators, 618 arrays (0 quantized)\r\n2018-09-10 13:12:50.348429: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After general graph transformations pass 1: 374 operators, 609 arrays (0 quantized)\r\n2018-09-10 13:12:50.364372: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before dequantization graph transformations: 374 operators, 609 arrays (0 quantized)\r\n2018-09-10 13:12:50.373883: I tensorflow/contrib/lite/toco/allocate_transient_arrays.cc:329] Total transient array allocated size: 0 bytes, theoretical optimal value: 0 bytes.\r\n2018-09-10 13:12:50.377671: W tensorflow/contrib/lite/toco/tflite/operator.cc:879] Ignoring unsupported attribute type with key 'T'\r\n\r\nbut when run below command for getting quantized int8 there is core dump.\r\nbazel run tensorflow/contrib/lite/toco:toco -- \\\r\n--input_file=/home/frankzhu/TestPrj/lstm_try/save/frozen_model_Sample_model.pb \\\r\n--input_format=TENSORFLOW_GRAPHDEF \\\r\n--output_format=TFLITE \\\r\n--output_file=/home/frankzhu/TestPrj/lstm_try/save/lstm.tflite \\\r\n--inference_type=QUANTIZED_UINT8 \\\r\n--inference_input_type=QUANTIZED_UINT8 \\\r\n--input_arrays=\"Placeholder\" \\\r\n--input_shapes=1,28,28 \\\r\n--output_arrays=\"output\" \\\r\n--allow_custom_ops\r\ncore dump for this one and unpack not supported.\r\n\r\nINFO: Build completed successfully, 1 total action\r\n2018-09-10 13:15:10.565575: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1366] Converting unsupported operation: Unpack\r\n2018-09-10 13:15:10.572736: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before Removing unused ops: 407 operators, 618 arrays (0 quantized)\r\n2018-09-10 13:15:10.582917: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before general graph transformations: 407 operators, 618 arrays (0 quantized)\r\n2018-09-10 13:15:10.610551: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After general graph transformations pass 1: 375 operators, 610 arrays (1 quantized)\r\n2018-09-10 13:15:10.626365: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before pre-quantization graph transformations: 375 operators, 610 arrays (1 quantized)\r\n2018-09-10 13:15:10.634396: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before quantization graph transformations: 375 operators, 610 arrays (1 quantized)\r\n2018-09-10 13:15:10.634417: F tensorflow/contrib/lite/toco/graph_transformations/quantize.cc:456] Unimplemented: this graph contains an operator of type (**Unsupported TensorFlow op: Unpack) for which the quantized form is not yet implemented. Sorry, and patches welcome (that's a relatively fun patch to write, mostly providing the actual quantized arithmetic code for this op).**\r\nAborted (core dumped)\r\n\r\nAny ideas?\r\nAnybody can help?\r\n\r\nThanks and best regards\r\nFrank\r\n\r\n\r\n"}