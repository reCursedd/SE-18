{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9831", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9831/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9831/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9831/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/9831", "id": 227904855, "node_id": "MDU6SXNzdWUyMjc5MDQ4NTU=", "number": 9831, "title": "gpu_memory_fraction for tf.contrib.lean Estimators stopped working in tensorflow 1.1.0", "user": {"login": "WolfgangGross", "id": 3263016, "node_id": "MDQ6VXNlcjMyNjMwMTY=", "avatar_url": "https://avatars3.githubusercontent.com/u/3263016?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WolfgangGross", "html_url": "https://github.com/WolfgangGross", "followers_url": "https://api.github.com/users/WolfgangGross/followers", "following_url": "https://api.github.com/users/WolfgangGross/following{/other_user}", "gists_url": "https://api.github.com/users/WolfgangGross/gists{/gist_id}", "starred_url": "https://api.github.com/users/WolfgangGross/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WolfgangGross/subscriptions", "organizations_url": "https://api.github.com/users/WolfgangGross/orgs", "repos_url": "https://api.github.com/users/WolfgangGross/repos", "events_url": "https://api.github.com/users/WolfgangGross/events{/privacy}", "received_events_url": "https://api.github.com/users/WolfgangGross/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "isaprykin", "id": 234070, "node_id": "MDQ6VXNlcjIzNDA3MA==", "avatar_url": "https://avatars1.githubusercontent.com/u/234070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/isaprykin", "html_url": "https://github.com/isaprykin", "followers_url": "https://api.github.com/users/isaprykin/followers", "following_url": "https://api.github.com/users/isaprykin/following{/other_user}", "gists_url": "https://api.github.com/users/isaprykin/gists{/gist_id}", "starred_url": "https://api.github.com/users/isaprykin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/isaprykin/subscriptions", "organizations_url": "https://api.github.com/users/isaprykin/orgs", "repos_url": "https://api.github.com/users/isaprykin/repos", "events_url": "https://api.github.com/users/isaprykin/events{/privacy}", "received_events_url": "https://api.github.com/users/isaprykin/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "isaprykin", "id": 234070, "node_id": "MDQ6VXNlcjIzNDA3MA==", "avatar_url": "https://avatars1.githubusercontent.com/u/234070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/isaprykin", "html_url": "https://github.com/isaprykin", "followers_url": "https://api.github.com/users/isaprykin/followers", "following_url": "https://api.github.com/users/isaprykin/following{/other_user}", "gists_url": "https://api.github.com/users/isaprykin/gists{/gist_id}", "starred_url": "https://api.github.com/users/isaprykin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/isaprykin/subscriptions", "organizations_url": "https://api.github.com/users/isaprykin/orgs", "repos_url": "https://api.github.com/users/isaprykin/repos", "events_url": "https://api.github.com/users/isaprykin/events{/privacy}", "received_events_url": "https://api.github.com/users/isaprykin/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 10, "created_at": "2017-05-11T07:45:33Z", "updated_at": "2018-01-17T21:28:14Z", "closed_at": "2018-01-17T21:28:14Z", "author_association": "NONE", "body_html": "<p>I was updating to Tensorflow 1.1.0 to use the tf.estimator API and I found, that I couldn't get it to use less than the full GPU RAM for one process.<br>\nI was trying to find out where the issue is and found, that also the tf.contrib.lean.Estimators had the same problem.</p>\n<p>Here a code snippet to reproduce the issue:</p>\n<pre><code>import tensorflow as tf\nimport numpy as np\nfrom tensorflow.contrib.learn import DNNClassifier\nimport os\n\ntf.logging.set_verbosity(tf.logging.INFO)\n\nfrom tensorflow.examples.tutorials.mnist import input_data\nmnist = input_data.read_data_sets('MNIST_data', one_hot=True)\n\nfeature_columns = [tf.contrib.layers.real_valued_column(\"x\", dimension=mnist.train.images.shape[1])]\nmodel = DNNClassifier(hidden_units=[10,10],\n                      feature_columns=feature_columns,\n                      n_classes=10,\n                      config=tf.contrib.learn.RunConfig(gpu_memory_fraction=0.1))\n\ninput_fn_train = tf.contrib.learn.io.numpy_input_fn(\n                                x={\"x\":mnist.train.images.reshape([-1,28,28,1]).astype(np.float32)[:1000]},\n                                y=np.argmax(mnist.train.labels[:1000],1).astype(np.int32),\n                                batch_size=50,\n                                num_epochs=50,\n                                )\n\n\nmodel.fit(input_fn=input_fn_train)\n\n</code></pre>\n<p>With tensorflow 1.0.1 it works as expected and only allocated 1/10 of the GPU RAM, but in tensorflow 1.1.0 it ignores this parameter.</p>\n<p>I also check with the code from the MNIST for ML beginners code  and used the GPUOptions when initializing the session:</p>\n<pre><code>gpu_options = tf.GPUOptions(per_process_gpu_memory_fraction=0.1)\nsess = tf.Session(config=tf.ConfigProto(gpu_options=gpu_options))\n</code></pre>\n<p>It works as expected in both verions.<br>\nSomehow this GPU options is not set correctly when using the tf.contib.learn.Estimator framework OR The gpu_memory is allocated before this call.</p>\n<p>I asked this before on the tensorflow discuss group and I was told that is is a bug.</p>", "body_text": "I was updating to Tensorflow 1.1.0 to use the tf.estimator API and I found, that I couldn't get it to use less than the full GPU RAM for one process.\nI was trying to find out where the issue is and found, that also the tf.contrib.lean.Estimators had the same problem.\nHere a code snippet to reproduce the issue:\nimport tensorflow as tf\nimport numpy as np\nfrom tensorflow.contrib.learn import DNNClassifier\nimport os\n\ntf.logging.set_verbosity(tf.logging.INFO)\n\nfrom tensorflow.examples.tutorials.mnist import input_data\nmnist = input_data.read_data_sets('MNIST_data', one_hot=True)\n\nfeature_columns = [tf.contrib.layers.real_valued_column(\"x\", dimension=mnist.train.images.shape[1])]\nmodel = DNNClassifier(hidden_units=[10,10],\n                      feature_columns=feature_columns,\n                      n_classes=10,\n                      config=tf.contrib.learn.RunConfig(gpu_memory_fraction=0.1))\n\ninput_fn_train = tf.contrib.learn.io.numpy_input_fn(\n                                x={\"x\":mnist.train.images.reshape([-1,28,28,1]).astype(np.float32)[:1000]},\n                                y=np.argmax(mnist.train.labels[:1000],1).astype(np.int32),\n                                batch_size=50,\n                                num_epochs=50,\n                                )\n\n\nmodel.fit(input_fn=input_fn_train)\n\n\nWith tensorflow 1.0.1 it works as expected and only allocated 1/10 of the GPU RAM, but in tensorflow 1.1.0 it ignores this parameter.\nI also check with the code from the MNIST for ML beginners code  and used the GPUOptions when initializing the session:\ngpu_options = tf.GPUOptions(per_process_gpu_memory_fraction=0.1)\nsess = tf.Session(config=tf.ConfigProto(gpu_options=gpu_options))\n\nIt works as expected in both verions.\nSomehow this GPU options is not set correctly when using the tf.contib.learn.Estimator framework OR The gpu_memory is allocated before this call.\nI asked this before on the tensorflow discuss group and I was told that is is a bug.", "body": "I was updating to Tensorflow 1.1.0 to use the tf.estimator API and I found, that I couldn't get it to use less than the full GPU RAM for one process.\r\nI was trying to find out where the issue is and found, that also the tf.contrib.lean.Estimators had the same problem. \r\n\r\nHere a code snippet to reproduce the issue:\r\n```\r\nimport tensorflow as tf\r\nimport numpy as np\r\nfrom tensorflow.contrib.learn import DNNClassifier\r\nimport os\r\n\r\ntf.logging.set_verbosity(tf.logging.INFO)\r\n\r\nfrom tensorflow.examples.tutorials.mnist import input_data\r\nmnist = input_data.read_data_sets('MNIST_data', one_hot=True)\r\n\r\nfeature_columns = [tf.contrib.layers.real_valued_column(\"x\", dimension=mnist.train.images.shape[1])]\r\nmodel = DNNClassifier(hidden_units=[10,10],\r\n                      feature_columns=feature_columns,\r\n                      n_classes=10,\r\n                      config=tf.contrib.learn.RunConfig(gpu_memory_fraction=0.1))\r\n\r\ninput_fn_train = tf.contrib.learn.io.numpy_input_fn(\r\n                                x={\"x\":mnist.train.images.reshape([-1,28,28,1]).astype(np.float32)[:1000]},\r\n                                y=np.argmax(mnist.train.labels[:1000],1).astype(np.int32),\r\n                                batch_size=50,\r\n                                num_epochs=50,\r\n                                )\r\n\r\n\r\nmodel.fit(input_fn=input_fn_train)\r\n\r\n```\r\n\r\nWith tensorflow 1.0.1 it works as expected and only allocated 1/10 of the GPU RAM, but in tensorflow 1.1.0 it ignores this parameter. \r\n\r\nI also check with the code from the MNIST for ML beginners code  and used the GPUOptions when initializing the session:\r\n```\r\ngpu_options = tf.GPUOptions(per_process_gpu_memory_fraction=0.1)\r\nsess = tf.Session(config=tf.ConfigProto(gpu_options=gpu_options))\r\n```\r\n\r\nIt works as expected in both verions. \r\nSomehow this GPU options is not set correctly when using the tf.contib.learn.Estimator framework OR The gpu_memory is allocated before this call.\r\n\r\nI asked this before on the tensorflow discuss group and I was told that is is a bug."}