{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2461", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2461/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2461/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2461/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/2461", "id": 156132575, "node_id": "MDU6SXNzdWUxNTYxMzI1NzU=", "number": 2461, "title": "Server restarts silently on kubernetes and variables reset after restart", "user": {"login": "perhapszzy", "id": 7953637, "node_id": "MDQ6VXNlcjc5NTM2Mzc=", "avatar_url": "https://avatars2.githubusercontent.com/u/7953637?v=4", "gravatar_id": "", "url": "https://api.github.com/users/perhapszzy", "html_url": "https://github.com/perhapszzy", "followers_url": "https://api.github.com/users/perhapszzy/followers", "following_url": "https://api.github.com/users/perhapszzy/following{/other_user}", "gists_url": "https://api.github.com/users/perhapszzy/gists{/gist_id}", "starred_url": "https://api.github.com/users/perhapszzy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/perhapszzy/subscriptions", "organizations_url": "https://api.github.com/users/perhapszzy/orgs", "repos_url": "https://api.github.com/users/perhapszzy/repos", "events_url": "https://api.github.com/users/perhapszzy/events{/privacy}", "received_events_url": "https://api.github.com/users/perhapszzy/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2016-05-22T03:20:00Z", "updated_at": "2016-06-06T22:14:11Z", "closed_at": "2016-06-06T22:14:11Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>Environment info</h3>\n<p>Operating System:<br>\nKubernetes with default images</p>\n<h3>Steps to reproduce</h3>\n<p>Hard to reproduce due to lack of log</p>\n<h3>Logs or other output that would be helpful</h3>\n<p>The kubernetes status:</p>\n<pre><code>NAME               READY     STATUS    RESTARTS   AGE\ntf-ps2-l2ka8       1/1       Running   0          3h\ntf-ps4-2jmuf       1/1       Running   1          3h\ntf-worker1-fm1t8   1/1       Running   1          3h\ntf-worker3-ujd7h   1/1       Running   0          3h\ntf-worker5-ymx71   1/1       Running   0          3h\n</code></pre>\n<p>The log regarding restarted parameter server:</p>\n<pre><code>zeyu@perhaps:~$ kubectl logs -p tf-ps4-2jmuf\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:206] Initialize HostPortsGrpcChannelCache for job worker -&gt; {tf-worker1:2222, tf-worker3:2222, tf-worker5:2222}\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:206] Initialize HostPortsGrpcChannelCache for job ps -&gt; {tf-ps2:2222, localhost:2222}\nI tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:202] Started server with target: grpc://localhost:2222\n</code></pre>\n<p>The log of current running server: (almost the same)</p>\n<pre><code>zeyu@perhaps:~$ kubectl logs  tf-ps4-2jmuf\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:206] Initialize HostPortsGrpcChannelCache for job worker -&gt; {tf-worker1:2222, tf-worker3:2222, tf-worker5:2222}\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:206] Initialize HostPortsGrpcChannelCache for job ps -&gt; {tf-ps2:2222, localhost:2222}\nI tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:202] Started server with target: grpc://localhost:2222\n</code></pre>\n<p>As the result of the restart, the global count  reset to 0 and the running log looks like:</p>\n<pre><code>Training step 269, global step 802\nTraining step 270, global step 805\nTraining step 271, global step 808\nTraining step 272, global step 810\nTraining step 273, global step 3\nTraining step 274, global step 6\nTraining step 275, global step 12\nTraining step 276, global step 19\nTraining step 277, global step 22\nTraining step 278, global step 27\nTraining step 279, global step 32\n</code></pre>\n<p>Is there any way that I can materialize the variables (like hostpath or persistent disk?) so that they won't be affected by restarts?</p>", "body_text": "Environment info\nOperating System:\nKubernetes with default images\nSteps to reproduce\nHard to reproduce due to lack of log\nLogs or other output that would be helpful\nThe kubernetes status:\nNAME               READY     STATUS    RESTARTS   AGE\ntf-ps2-l2ka8       1/1       Running   0          3h\ntf-ps4-2jmuf       1/1       Running   1          3h\ntf-worker1-fm1t8   1/1       Running   1          3h\ntf-worker3-ujd7h   1/1       Running   0          3h\ntf-worker5-ymx71   1/1       Running   0          3h\n\nThe log regarding restarted parameter server:\nzeyu@perhaps:~$ kubectl logs -p tf-ps4-2jmuf\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:206] Initialize HostPortsGrpcChannelCache for job worker -> {tf-worker1:2222, tf-worker3:2222, tf-worker5:2222}\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:206] Initialize HostPortsGrpcChannelCache for job ps -> {tf-ps2:2222, localhost:2222}\nI tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:202] Started server with target: grpc://localhost:2222\n\nThe log of current running server: (almost the same)\nzeyu@perhaps:~$ kubectl logs  tf-ps4-2jmuf\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:206] Initialize HostPortsGrpcChannelCache for job worker -> {tf-worker1:2222, tf-worker3:2222, tf-worker5:2222}\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:206] Initialize HostPortsGrpcChannelCache for job ps -> {tf-ps2:2222, localhost:2222}\nI tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:202] Started server with target: grpc://localhost:2222\n\nAs the result of the restart, the global count  reset to 0 and the running log looks like:\nTraining step 269, global step 802\nTraining step 270, global step 805\nTraining step 271, global step 808\nTraining step 272, global step 810\nTraining step 273, global step 3\nTraining step 274, global step 6\nTraining step 275, global step 12\nTraining step 276, global step 19\nTraining step 277, global step 22\nTraining step 278, global step 27\nTraining step 279, global step 32\n\nIs there any way that I can materialize the variables (like hostpath or persistent disk?) so that they won't be affected by restarts?", "body": "### Environment info\n\nOperating System:\nKubernetes with default images\n### Steps to reproduce\n\nHard to reproduce due to lack of log\n### Logs or other output that would be helpful\n\nThe kubernetes status:\n\n```\nNAME               READY     STATUS    RESTARTS   AGE\ntf-ps2-l2ka8       1/1       Running   0          3h\ntf-ps4-2jmuf       1/1       Running   1          3h\ntf-worker1-fm1t8   1/1       Running   1          3h\ntf-worker3-ujd7h   1/1       Running   0          3h\ntf-worker5-ymx71   1/1       Running   0          3h\n```\n\nThe log regarding restarted parameter server:\n\n```\nzeyu@perhaps:~$ kubectl logs -p tf-ps4-2jmuf\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:206] Initialize HostPortsGrpcChannelCache for job worker -> {tf-worker1:2222, tf-worker3:2222, tf-worker5:2222}\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:206] Initialize HostPortsGrpcChannelCache for job ps -> {tf-ps2:2222, localhost:2222}\nI tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:202] Started server with target: grpc://localhost:2222\n```\n\nThe log of current running server: (almost the same)\n\n```\nzeyu@perhaps:~$ kubectl logs  tf-ps4-2jmuf\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:206] Initialize HostPortsGrpcChannelCache for job worker -> {tf-worker1:2222, tf-worker3:2222, tf-worker5:2222}\nI tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:206] Initialize HostPortsGrpcChannelCache for job ps -> {tf-ps2:2222, localhost:2222}\nI tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:202] Started server with target: grpc://localhost:2222\n```\n\nAs the result of the restart, the global count  reset to 0 and the running log looks like:\n\n```\nTraining step 269, global step 802\nTraining step 270, global step 805\nTraining step 271, global step 808\nTraining step 272, global step 810\nTraining step 273, global step 3\nTraining step 274, global step 6\nTraining step 275, global step 12\nTraining step 276, global step 19\nTraining step 277, global step 22\nTraining step 278, global step 27\nTraining step 279, global step 32\n```\n\nIs there any way that I can materialize the variables (like hostpath or persistent disk?) so that they won't be affected by restarts?\n"}