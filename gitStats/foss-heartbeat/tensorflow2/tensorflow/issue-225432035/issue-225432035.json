{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9567", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9567/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9567/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9567/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/9567", "id": 225432035, "node_id": "MDU6SXNzdWUyMjU0MzIwMzU=", "number": 9567, "title": "Bazel error: building tensorflow 1.1 from source (CPU only)", "user": {"login": "hholst80", "id": 6200749, "node_id": "MDQ6VXNlcjYyMDA3NDk=", "avatar_url": "https://avatars0.githubusercontent.com/u/6200749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hholst80", "html_url": "https://github.com/hholst80", "followers_url": "https://api.github.com/users/hholst80/followers", "following_url": "https://api.github.com/users/hholst80/following{/other_user}", "gists_url": "https://api.github.com/users/hholst80/gists{/gist_id}", "starred_url": "https://api.github.com/users/hholst80/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hholst80/subscriptions", "organizations_url": "https://api.github.com/users/hholst80/orgs", "repos_url": "https://api.github.com/users/hholst80/repos", "events_url": "https://api.github.com/users/hholst80/events{/privacy}", "received_events_url": "https://api.github.com/users/hholst80/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473173351, "node_id": "MDU6TGFiZWw0NzMxNzMzNTE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:build/install", "name": "type:build/install", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2017-05-01T13:09:12Z", "updated_at": "2017-05-15T22:52:35Z", "closed_at": "2017-05-15T22:52:25Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>Problem description</h3>\n<p>The Docker build script below fails to build TensorFlow 1.1 from source with the following error messages:</p>\n<pre><code>ERROR: /tensorflow/WORKSPACE:3:1: //external:io_bazel_rules_closure: no such attribute 'urls' in 'http_archive' rule.\nERROR: /tensorflow/WORKSPACE:3:1: //external:io_bazel_rules_closure: missing value for mandatory attribute 'url' in 'http_archive' rule.\nERROR: com.google.devtools.build.lib.packages.BuildFileContainsErrorsException: error loading package '': Encountered error while reading extension file 'closure/defs.bzl': no such package '@io_bazel_rules_closure//closure': error loading package 'external': Could not load //external package.\n</code></pre>\n<p>Complete build log:</p>\n<pre><code>$ docker start tensorflow-builder\n$ docker attach tensorflow-builder\nroot@8eef137e3404:/tensorflow# git fetch -fapv\nFrom https://github.com/tensorflow/tensorflow\n = [up to date]      0.6.0      -&gt; origin/0.6.0\n = [up to date]      docs-republishing -&gt; origin/docs-republishing\n = [up to date]      estimator_windows -&gt; origin/estimator_windows\n = [up to date]      fix-makefile-build -&gt; origin/fix-makefile-build\n = [up to date]      master     -&gt; origin/master\n = [up to date]      r0.10      -&gt; origin/r0.10\n = [up to date]      r0.11      -&gt; origin/r0.11\n = [up to date]      r0.12      -&gt; origin/r0.12\n = [up to date]      r0.7       -&gt; origin/r0.7\n = [up to date]      r0.8       -&gt; origin/r0.8\n = [up to date]      r0.9       -&gt; origin/r0.9\n = [up to date]      r1.0       -&gt; origin/r1.0\n = [up to date]      r1.1       -&gt; origin/r1.1\n = [up to date]      rn_delete  -&gt; origin/rn_delete\nroot@8eef137e3404:/tensorflow# git checkout -b r1.1 origin/r1.1\nSwitched to a new branch 'r1.1'\nroot@8eef137e3404:/tensorflow# git pull\nAlready up-to-date.\nroot@8eef137e3404:/tensorflow# ./configure\nPlease specify the location of python. [Default is /usr/local/bin/python]: \nPlease specify optimization flags to use during compilation when bazel option \"--config=opt\" is specified [Default is -march=native]: \nDo you wish to use jemalloc as the malloc implementation? [Y/n] \njemalloc enabled\nDo you wish to build TensorFlow with Google Cloud Platform support? [y/N] \nNo Google Cloud Platform support will be enabled for TensorFlow\nDo you wish to build TensorFlow with Hadoop File System support? [y/N] \nNo Hadoop File System support will be enabled for TensorFlow\nDo you wish to build TensorFlow with the XLA just-in-time compiler (experimental)? [y/N] \nNo XLA support will be enabled for TensorFlow\nFound possible Python library paths:\n  /usr/lib/python3/dist-packages\n  /usr/local/lib/python3.5/dist-packages\nPlease input the desired Python library path to use.  Default is [/usr/lib/python3/dist-packages]\n\nUsing python library path: /usr/lib/python3/dist-packages\nDo you wish to build TensorFlow with OpenCL support? [y/N] \nNo OpenCL support will be enabled for TensorFlow\nDo you wish to build TensorFlow with CUDA support? [y/N] \nNo CUDA support will be enabled for TensorFlow\nConfiguration finished\n.\nINFO: Starting clean (this may take a while). Consider using --expunge_async if the clean takes more than several minutes.\n..........\nERROR: /tensorflow/WORKSPACE:3:1: //external:io_bazel_rules_closure: no such attribute 'urls' in 'http_archive' rule.\nERROR: /tensorflow/WORKSPACE:3:1: //external:io_bazel_rules_closure: missing value for mandatory attribute 'url' in 'http_archive' rule.\nERROR: com.google.devtools.build.lib.packages.BuildFileContainsErrorsException: error loading package '': Encountered error while reading extension file 'closure/defs.bzl': no such package '@io_bazel_rules_closure//closure': error loading package 'external': Could not load //external package.\n</code></pre>\n<h3>Dockerfile</h3>\n<pre><code>FROM ubuntu:16.04\n\n# https://github.com/kubernetes/test-infra/blob/master/images/pull-kubernetes-bazel/Dockerfile\n\nRUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends \\\n    build-essential \\\n    openjdk-8-jdk \\\n    pkg-config \\\n    zip \\\n    unzip \\\n    zlib1g-dev \\\n    bash-completion \\\n    git \\\n    wget \\\n    python &amp;&amp; \\\n    apt-get clean\n\nENV BAZEL_VERSION 0.3.2\nRUN wget \"https://github.com/bazelbuild/bazel/releases/download/${BAZEL_VERSION}/bazel_${BAZEL_VERSION}-linux-x86_64.deb\" &amp;&amp; \\\n    dpkg -i \"bazel_${BAZEL_VERSION}-linux-x86_64.deb\" &amp;&amp; \\\n    rm \"bazel_${BAZEL_VERSION}-linux-x86_64.deb\"\n\n# Fetch TensorFlow source code and build dependencies\n\nRUN apt-get install -y --no-install-recommends git python3-numpy swig python3-dev python3-wheel &amp;&amp; \\\n    apt-get install -y --no-install-recommends python3-setuptools rsync &amp;&amp; \\\n    apt-get clean &amp;&amp; \\\n    ln -s /usr/bin/python3 /usr/local/bin/python &amp;&amp; \\\n    git clone --quiet --recurse-submodules https://github.com/tensorflow/tensorflow.git /tensorflow\nWORKDIR /tensorflow\n\n# Steps to build:\n#\n# host$ docker build -t bazel .\n# host$ docker run -it --name bazel-builder bazel\n#\n# bazel-builder$ ./configure (press enter repeatedly)\n# bazel-builder$ bazel build -c opt --copt=-mavx2 //tensorflow/tools/pip_package:build_pip_package\n# bazel-builder$ bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg\n# bazel-builder$ exit\n#\n# host$ docker cp bazel-build:/tmp/tensorflow_pkg/tensorflow-0.11.0-py3-none-any.whl /tmp\n</code></pre>", "body_text": "Problem description\nThe Docker build script below fails to build TensorFlow 1.1 from source with the following error messages:\nERROR: /tensorflow/WORKSPACE:3:1: //external:io_bazel_rules_closure: no such attribute 'urls' in 'http_archive' rule.\nERROR: /tensorflow/WORKSPACE:3:1: //external:io_bazel_rules_closure: missing value for mandatory attribute 'url' in 'http_archive' rule.\nERROR: com.google.devtools.build.lib.packages.BuildFileContainsErrorsException: error loading package '': Encountered error while reading extension file 'closure/defs.bzl': no such package '@io_bazel_rules_closure//closure': error loading package 'external': Could not load //external package.\n\nComplete build log:\n$ docker start tensorflow-builder\n$ docker attach tensorflow-builder\nroot@8eef137e3404:/tensorflow# git fetch -fapv\nFrom https://github.com/tensorflow/tensorflow\n = [up to date]      0.6.0      -> origin/0.6.0\n = [up to date]      docs-republishing -> origin/docs-republishing\n = [up to date]      estimator_windows -> origin/estimator_windows\n = [up to date]      fix-makefile-build -> origin/fix-makefile-build\n = [up to date]      master     -> origin/master\n = [up to date]      r0.10      -> origin/r0.10\n = [up to date]      r0.11      -> origin/r0.11\n = [up to date]      r0.12      -> origin/r0.12\n = [up to date]      r0.7       -> origin/r0.7\n = [up to date]      r0.8       -> origin/r0.8\n = [up to date]      r0.9       -> origin/r0.9\n = [up to date]      r1.0       -> origin/r1.0\n = [up to date]      r1.1       -> origin/r1.1\n = [up to date]      rn_delete  -> origin/rn_delete\nroot@8eef137e3404:/tensorflow# git checkout -b r1.1 origin/r1.1\nSwitched to a new branch 'r1.1'\nroot@8eef137e3404:/tensorflow# git pull\nAlready up-to-date.\nroot@8eef137e3404:/tensorflow# ./configure\nPlease specify the location of python. [Default is /usr/local/bin/python]: \nPlease specify optimization flags to use during compilation when bazel option \"--config=opt\" is specified [Default is -march=native]: \nDo you wish to use jemalloc as the malloc implementation? [Y/n] \njemalloc enabled\nDo you wish to build TensorFlow with Google Cloud Platform support? [y/N] \nNo Google Cloud Platform support will be enabled for TensorFlow\nDo you wish to build TensorFlow with Hadoop File System support? [y/N] \nNo Hadoop File System support will be enabled for TensorFlow\nDo you wish to build TensorFlow with the XLA just-in-time compiler (experimental)? [y/N] \nNo XLA support will be enabled for TensorFlow\nFound possible Python library paths:\n  /usr/lib/python3/dist-packages\n  /usr/local/lib/python3.5/dist-packages\nPlease input the desired Python library path to use.  Default is [/usr/lib/python3/dist-packages]\n\nUsing python library path: /usr/lib/python3/dist-packages\nDo you wish to build TensorFlow with OpenCL support? [y/N] \nNo OpenCL support will be enabled for TensorFlow\nDo you wish to build TensorFlow with CUDA support? [y/N] \nNo CUDA support will be enabled for TensorFlow\nConfiguration finished\n.\nINFO: Starting clean (this may take a while). Consider using --expunge_async if the clean takes more than several minutes.\n..........\nERROR: /tensorflow/WORKSPACE:3:1: //external:io_bazel_rules_closure: no such attribute 'urls' in 'http_archive' rule.\nERROR: /tensorflow/WORKSPACE:3:1: //external:io_bazel_rules_closure: missing value for mandatory attribute 'url' in 'http_archive' rule.\nERROR: com.google.devtools.build.lib.packages.BuildFileContainsErrorsException: error loading package '': Encountered error while reading extension file 'closure/defs.bzl': no such package '@io_bazel_rules_closure//closure': error loading package 'external': Could not load //external package.\n\nDockerfile\nFROM ubuntu:16.04\n\n# https://github.com/kubernetes/test-infra/blob/master/images/pull-kubernetes-bazel/Dockerfile\n\nRUN apt-get update && apt-get install -y --no-install-recommends \\\n    build-essential \\\n    openjdk-8-jdk \\\n    pkg-config \\\n    zip \\\n    unzip \\\n    zlib1g-dev \\\n    bash-completion \\\n    git \\\n    wget \\\n    python && \\\n    apt-get clean\n\nENV BAZEL_VERSION 0.3.2\nRUN wget \"https://github.com/bazelbuild/bazel/releases/download/${BAZEL_VERSION}/bazel_${BAZEL_VERSION}-linux-x86_64.deb\" && \\\n    dpkg -i \"bazel_${BAZEL_VERSION}-linux-x86_64.deb\" && \\\n    rm \"bazel_${BAZEL_VERSION}-linux-x86_64.deb\"\n\n# Fetch TensorFlow source code and build dependencies\n\nRUN apt-get install -y --no-install-recommends git python3-numpy swig python3-dev python3-wheel && \\\n    apt-get install -y --no-install-recommends python3-setuptools rsync && \\\n    apt-get clean && \\\n    ln -s /usr/bin/python3 /usr/local/bin/python && \\\n    git clone --quiet --recurse-submodules https://github.com/tensorflow/tensorflow.git /tensorflow\nWORKDIR /tensorflow\n\n# Steps to build:\n#\n# host$ docker build -t bazel .\n# host$ docker run -it --name bazel-builder bazel\n#\n# bazel-builder$ ./configure (press enter repeatedly)\n# bazel-builder$ bazel build -c opt --copt=-mavx2 //tensorflow/tools/pip_package:build_pip_package\n# bazel-builder$ bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg\n# bazel-builder$ exit\n#\n# host$ docker cp bazel-build:/tmp/tensorflow_pkg/tensorflow-0.11.0-py3-none-any.whl /tmp", "body": "### Problem description\r\n\r\nThe Docker build script below fails to build TensorFlow 1.1 from source with the following error messages:\r\n\r\n```\r\nERROR: /tensorflow/WORKSPACE:3:1: //external:io_bazel_rules_closure: no such attribute 'urls' in 'http_archive' rule.\r\nERROR: /tensorflow/WORKSPACE:3:1: //external:io_bazel_rules_closure: missing value for mandatory attribute 'url' in 'http_archive' rule.\r\nERROR: com.google.devtools.build.lib.packages.BuildFileContainsErrorsException: error loading package '': Encountered error while reading extension file 'closure/defs.bzl': no such package '@io_bazel_rules_closure//closure': error loading package 'external': Could not load //external package.\r\n```\r\n\r\nComplete build log:\r\n\r\n```\r\n$ docker start tensorflow-builder\r\n$ docker attach tensorflow-builder\r\nroot@8eef137e3404:/tensorflow# git fetch -fapv\r\nFrom https://github.com/tensorflow/tensorflow\r\n = [up to date]      0.6.0      -> origin/0.6.0\r\n = [up to date]      docs-republishing -> origin/docs-republishing\r\n = [up to date]      estimator_windows -> origin/estimator_windows\r\n = [up to date]      fix-makefile-build -> origin/fix-makefile-build\r\n = [up to date]      master     -> origin/master\r\n = [up to date]      r0.10      -> origin/r0.10\r\n = [up to date]      r0.11      -> origin/r0.11\r\n = [up to date]      r0.12      -> origin/r0.12\r\n = [up to date]      r0.7       -> origin/r0.7\r\n = [up to date]      r0.8       -> origin/r0.8\r\n = [up to date]      r0.9       -> origin/r0.9\r\n = [up to date]      r1.0       -> origin/r1.0\r\n = [up to date]      r1.1       -> origin/r1.1\r\n = [up to date]      rn_delete  -> origin/rn_delete\r\nroot@8eef137e3404:/tensorflow# git checkout -b r1.1 origin/r1.1\r\nSwitched to a new branch 'r1.1'\r\nroot@8eef137e3404:/tensorflow# git pull\r\nAlready up-to-date.\r\nroot@8eef137e3404:/tensorflow# ./configure\r\nPlease specify the location of python. [Default is /usr/local/bin/python]: \r\nPlease specify optimization flags to use during compilation when bazel option \"--config=opt\" is specified [Default is -march=native]: \r\nDo you wish to use jemalloc as the malloc implementation? [Y/n] \r\njemalloc enabled\r\nDo you wish to build TensorFlow with Google Cloud Platform support? [y/N] \r\nNo Google Cloud Platform support will be enabled for TensorFlow\r\nDo you wish to build TensorFlow with Hadoop File System support? [y/N] \r\nNo Hadoop File System support will be enabled for TensorFlow\r\nDo you wish to build TensorFlow with the XLA just-in-time compiler (experimental)? [y/N] \r\nNo XLA support will be enabled for TensorFlow\r\nFound possible Python library paths:\r\n  /usr/lib/python3/dist-packages\r\n  /usr/local/lib/python3.5/dist-packages\r\nPlease input the desired Python library path to use.  Default is [/usr/lib/python3/dist-packages]\r\n\r\nUsing python library path: /usr/lib/python3/dist-packages\r\nDo you wish to build TensorFlow with OpenCL support? [y/N] \r\nNo OpenCL support will be enabled for TensorFlow\r\nDo you wish to build TensorFlow with CUDA support? [y/N] \r\nNo CUDA support will be enabled for TensorFlow\r\nConfiguration finished\r\n.\r\nINFO: Starting clean (this may take a while). Consider using --expunge_async if the clean takes more than several minutes.\r\n..........\r\nERROR: /tensorflow/WORKSPACE:3:1: //external:io_bazel_rules_closure: no such attribute 'urls' in 'http_archive' rule.\r\nERROR: /tensorflow/WORKSPACE:3:1: //external:io_bazel_rules_closure: missing value for mandatory attribute 'url' in 'http_archive' rule.\r\nERROR: com.google.devtools.build.lib.packages.BuildFileContainsErrorsException: error loading package '': Encountered error while reading extension file 'closure/defs.bzl': no such package '@io_bazel_rules_closure//closure': error loading package 'external': Could not load //external package.\r\n```\r\n\r\n### Dockerfile\r\n\r\n```\r\nFROM ubuntu:16.04\r\n\r\n# https://github.com/kubernetes/test-infra/blob/master/images/pull-kubernetes-bazel/Dockerfile\r\n\r\nRUN apt-get update && apt-get install -y --no-install-recommends \\\r\n    build-essential \\\r\n    openjdk-8-jdk \\\r\n    pkg-config \\\r\n    zip \\\r\n    unzip \\\r\n    zlib1g-dev \\\r\n    bash-completion \\\r\n    git \\\r\n    wget \\\r\n    python && \\\r\n    apt-get clean\r\n\r\nENV BAZEL_VERSION 0.3.2\r\nRUN wget \"https://github.com/bazelbuild/bazel/releases/download/${BAZEL_VERSION}/bazel_${BAZEL_VERSION}-linux-x86_64.deb\" && \\\r\n    dpkg -i \"bazel_${BAZEL_VERSION}-linux-x86_64.deb\" && \\\r\n    rm \"bazel_${BAZEL_VERSION}-linux-x86_64.deb\"\r\n\r\n# Fetch TensorFlow source code and build dependencies\r\n\r\nRUN apt-get install -y --no-install-recommends git python3-numpy swig python3-dev python3-wheel && \\\r\n    apt-get install -y --no-install-recommends python3-setuptools rsync && \\\r\n    apt-get clean && \\\r\n    ln -s /usr/bin/python3 /usr/local/bin/python && \\\r\n    git clone --quiet --recurse-submodules https://github.com/tensorflow/tensorflow.git /tensorflow\r\nWORKDIR /tensorflow\r\n\r\n# Steps to build:\r\n#\r\n# host$ docker build -t bazel .\r\n# host$ docker run -it --name bazel-builder bazel\r\n#\r\n# bazel-builder$ ./configure (press enter repeatedly)\r\n# bazel-builder$ bazel build -c opt --copt=-mavx2 //tensorflow/tools/pip_package:build_pip_package\r\n# bazel-builder$ bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg\r\n# bazel-builder$ exit\r\n#\r\n# host$ docker cp bazel-build:/tmp/tensorflow_pkg/tensorflow-0.11.0-py3-none-any.whl /tmp\r\n```"}