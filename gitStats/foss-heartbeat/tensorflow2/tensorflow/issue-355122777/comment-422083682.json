{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/422083682", "html_url": "https://github.com/tensorflow/tensorflow/pull/21945#issuecomment-422083682", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21945", "id": 422083682, "node_id": "MDEyOklzc3VlQ29tbWVudDQyMjA4MzY4Mg==", "user": {"login": "alextp", "id": 5061, "node_id": "MDQ6VXNlcjUwNjE=", "avatar_url": "https://avatars0.githubusercontent.com/u/5061?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alextp", "html_url": "https://github.com/alextp", "followers_url": "https://api.github.com/users/alextp/followers", "following_url": "https://api.github.com/users/alextp/following{/other_user}", "gists_url": "https://api.github.com/users/alextp/gists{/gist_id}", "starred_url": "https://api.github.com/users/alextp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alextp/subscriptions", "organizations_url": "https://api.github.com/users/alextp/orgs", "repos_url": "https://api.github.com/users/alextp/repos", "events_url": "https://api.github.com/users/alextp/events{/privacy}", "received_events_url": "https://api.github.com/users/alextp/received_events", "type": "User", "site_admin": false}, "created_at": "2018-09-17T16:33:32Z", "updated_at": "2018-09-17T16:33:32Z", "author_association": "MEMBER", "body_html": "<div class=\"email-fragment\">Can you fix this by doing perm = ops.convert_to_tensor((rank - 1) -\nnp.arange(rank, dtype=np.int32))?</div>\n<span class=\"email-hidden-toggle\"><a href=\"#\">\u2026</a></span><div class=\"email-hidden-reply\">\n<div class=\"email-quoted-reply\">On Mon, Sep 17, 2018 at 5:53 AM Edvard Fagerholm ***@***.***&gt; wrote:\n It looks like I've triggered a bug in TensorFlow (probably the grappler\n optimizer). The following code fails with the error in the message above:\n\n       a = ops.convert_to_tensor(a, name=\"a\")\n       if not a.get_shape().ndims:\n         rank = gen_array_ops.rank(a)\n         perm = (rank - 1) - gen_math_ops._range(0, rank, 1)\n       else:\n         rank = a.get_shape().ndims\n         perm = (rank - 1) - np.arange(rank, dtype=np.int32)\n\n However, if I simply add a tf.Print on the perm parameter it works, i.e.\n the following code passes unit tests:\n\n       a = ops.convert_to_tensor(a, name=\"a\")\n       if not a.get_shape().ndims:\n         rank = gen_array_ops.rank(a)\n         perm = (rank - 1) - gen_math_ops._range(0, rank, 1)\n       else:\n         rank = a.get_shape().ndims\n         perm = (rank - 1) - np.arange(rank, dtype=np.int32)\n         from tensorflow.python.ops import logging_ops\n         perm = logging_ops.Print(perm, [perm], \"sdfsdf\")\n\n \u2014\n You are receiving this because your review was requested.\n Reply to this email directly, view it on GitHub\n &lt;<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"355122777\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/21945\" href=\"https://github.com/tensorflow/tensorflow/pull/21945#issuecomment-422000334\">#21945 (comment)</a>&gt;,\n or mute the thread\n &lt;<a href=\"https://github.com/notifications/unsubscribe-auth/AAATxfHBtfO86QL9m4uClIzk828SluZRks5ub5tGgaJpZM4WRYE2\">https://github.com/notifications/unsubscribe-auth/AAATxfHBtfO86QL9m4uClIzk828SluZRks5ub5tGgaJpZM4WRYE2</a>&gt;\n .\n</div>\n<div class=\"email-fragment\"></div>\n<div class=\"email-signature-reply\">-- \n - Alex</div>\n</div>", "body_text": "Can you fix this by doing perm = ops.convert_to_tensor((rank - 1) -\nnp.arange(rank, dtype=np.int32))?\n\u2026\nOn Mon, Sep 17, 2018 at 5:53 AM Edvard Fagerholm ***@***.***> wrote:\n It looks like I've triggered a bug in TensorFlow (probably the grappler\n optimizer). The following code fails with the error in the message above:\n\n       a = ops.convert_to_tensor(a, name=\"a\")\n       if not a.get_shape().ndims:\n         rank = gen_array_ops.rank(a)\n         perm = (rank - 1) - gen_math_ops._range(0, rank, 1)\n       else:\n         rank = a.get_shape().ndims\n         perm = (rank - 1) - np.arange(rank, dtype=np.int32)\n\n However, if I simply add a tf.Print on the perm parameter it works, i.e.\n the following code passes unit tests:\n\n       a = ops.convert_to_tensor(a, name=\"a\")\n       if not a.get_shape().ndims:\n         rank = gen_array_ops.rank(a)\n         perm = (rank - 1) - gen_math_ops._range(0, rank, 1)\n       else:\n         rank = a.get_shape().ndims\n         perm = (rank - 1) - np.arange(rank, dtype=np.int32)\n         from tensorflow.python.ops import logging_ops\n         perm = logging_ops.Print(perm, [perm], \"sdfsdf\")\n\n \u2014\n You are receiving this because your review was requested.\n Reply to this email directly, view it on GitHub\n <#21945 (comment)>,\n or mute the thread\n <https://github.com/notifications/unsubscribe-auth/AAATxfHBtfO86QL9m4uClIzk828SluZRks5ub5tGgaJpZM4WRYE2>\n .\n\n\n-- \n - Alex", "body": "Can you fix this by doing perm = ops.convert_to_tensor((rank - 1) -\nnp.arange(rank, dtype=np.int32))?\n\nOn Mon, Sep 17, 2018 at 5:53 AM Edvard Fagerholm <notifications@github.com>\nwrote:\n\n> It looks like I've triggered a bug in TensorFlow (probably the grappler\n> optimizer). The following code fails with the error in the message above:\n>\n>       a = ops.convert_to_tensor(a, name=\"a\")\n>       if not a.get_shape().ndims:\n>         rank = gen_array_ops.rank(a)\n>         perm = (rank - 1) - gen_math_ops._range(0, rank, 1)\n>       else:\n>         rank = a.get_shape().ndims\n>         perm = (rank - 1) - np.arange(rank, dtype=np.int32)\n>\n> However, if I simply add a tf.Print on the perm parameter it works, i.e.\n> the following code passes unit tests:\n>\n>       a = ops.convert_to_tensor(a, name=\"a\")\n>       if not a.get_shape().ndims:\n>         rank = gen_array_ops.rank(a)\n>         perm = (rank - 1) - gen_math_ops._range(0, rank, 1)\n>       else:\n>         rank = a.get_shape().ndims\n>         perm = (rank - 1) - np.arange(rank, dtype=np.int32)\n>         from tensorflow.python.ops import logging_ops\n>         perm = logging_ops.Print(perm, [perm], \"sdfsdf\")\n>\n> \u2014\n> You are receiving this because your review was requested.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/tensorflow/tensorflow/pull/21945#issuecomment-422000334>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAATxfHBtfO86QL9m4uClIzk828SluZRks5ub5tGgaJpZM4WRYE2>\n> .\n>\n\n\n-- \n - Alex\n"}