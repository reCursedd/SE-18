{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/422000334", "html_url": "https://github.com/tensorflow/tensorflow/pull/21945#issuecomment-422000334", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21945", "id": 422000334, "node_id": "MDEyOklzc3VlQ29tbWVudDQyMjAwMDMzNA==", "user": {"login": "efagerho", "id": 2458944, "node_id": "MDQ6VXNlcjI0NTg5NDQ=", "avatar_url": "https://avatars3.githubusercontent.com/u/2458944?v=4", "gravatar_id": "", "url": "https://api.github.com/users/efagerho", "html_url": "https://github.com/efagerho", "followers_url": "https://api.github.com/users/efagerho/followers", "following_url": "https://api.github.com/users/efagerho/following{/other_user}", "gists_url": "https://api.github.com/users/efagerho/gists{/gist_id}", "starred_url": "https://api.github.com/users/efagerho/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/efagerho/subscriptions", "organizations_url": "https://api.github.com/users/efagerho/orgs", "repos_url": "https://api.github.com/users/efagerho/repos", "events_url": "https://api.github.com/users/efagerho/events{/privacy}", "received_events_url": "https://api.github.com/users/efagerho/received_events", "type": "User", "site_admin": false}, "created_at": "2018-09-17T12:45:36Z", "updated_at": "2018-09-17T12:45:36Z", "author_association": "CONTRIBUTOR", "body_html": "<p>It looks like I've triggered a bug in TensorFlow (probably the grappler optimizer). The following code fails with the error in the message above:</p>\n<pre><code>      a = ops.convert_to_tensor(a, name=\"a\") \n      if not a.get_shape().ndims: \n        rank = gen_array_ops.rank(a) \n        perm = (rank - 1) - gen_math_ops._range(0, rank, 1) \n      else: \n        rank = a.get_shape().ndims \n        perm = (rank - 1) - np.arange(rank, dtype=np.int32) \n</code></pre>\n<p>However, if I simply add a tf.Print on the perm parameter it works, i.e. the following code passes unit tests:</p>\n<pre><code>      a = ops.convert_to_tensor(a, name=\"a\") \n      if not a.get_shape().ndims: \n        rank = gen_array_ops.rank(a) \n        perm = (rank - 1) - gen_math_ops._range(0, rank, 1) \n      else: \n        rank = a.get_shape().ndims \n        perm = (rank - 1) - np.arange(rank, dtype=np.int32) \n        from tensorflow.python.ops import logging_ops \n        perm = logging_ops.Print(perm, [perm], \"sdfsdf\") \n</code></pre>", "body_text": "It looks like I've triggered a bug in TensorFlow (probably the grappler optimizer). The following code fails with the error in the message above:\n      a = ops.convert_to_tensor(a, name=\"a\") \n      if not a.get_shape().ndims: \n        rank = gen_array_ops.rank(a) \n        perm = (rank - 1) - gen_math_ops._range(0, rank, 1) \n      else: \n        rank = a.get_shape().ndims \n        perm = (rank - 1) - np.arange(rank, dtype=np.int32) \n\nHowever, if I simply add a tf.Print on the perm parameter it works, i.e. the following code passes unit tests:\n      a = ops.convert_to_tensor(a, name=\"a\") \n      if not a.get_shape().ndims: \n        rank = gen_array_ops.rank(a) \n        perm = (rank - 1) - gen_math_ops._range(0, rank, 1) \n      else: \n        rank = a.get_shape().ndims \n        perm = (rank - 1) - np.arange(rank, dtype=np.int32) \n        from tensorflow.python.ops import logging_ops \n        perm = logging_ops.Print(perm, [perm], \"sdfsdf\")", "body": "It looks like I've triggered a bug in TensorFlow (probably the grappler optimizer). The following code fails with the error in the message above:\r\n\r\n```\r\n      a = ops.convert_to_tensor(a, name=\"a\") \r\n      if not a.get_shape().ndims: \r\n        rank = gen_array_ops.rank(a) \r\n        perm = (rank - 1) - gen_math_ops._range(0, rank, 1) \r\n      else: \r\n        rank = a.get_shape().ndims \r\n        perm = (rank - 1) - np.arange(rank, dtype=np.int32) \r\n```\r\n\r\nHowever, if I simply add a tf.Print on the perm parameter it works, i.e. the following code passes unit tests:\r\n\r\n```\r\n      a = ops.convert_to_tensor(a, name=\"a\") \r\n      if not a.get_shape().ndims: \r\n        rank = gen_array_ops.rank(a) \r\n        perm = (rank - 1) - gen_math_ops._range(0, rank, 1) \r\n      else: \r\n        rank = a.get_shape().ndims \r\n        perm = (rank - 1) - np.arange(rank, dtype=np.int32) \r\n        from tensorflow.python.ops import logging_ops \r\n        perm = logging_ops.Print(perm, [perm], \"sdfsdf\") \r\n```\r\n\r\n"}