{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15546", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15546/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15546/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15546/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15546", "id": 283789243, "node_id": "MDU6SXNzdWUyODM3ODkyNDM=", "number": 15546, "title": "DIGITS tensorflow distributed problem \uff1aGraph is finalized and cannot be modified", "user": {"login": "shoneSolomon", "id": 12653056, "node_id": "MDQ6VXNlcjEyNjUzMDU2", "avatar_url": "https://avatars2.githubusercontent.com/u/12653056?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shoneSolomon", "html_url": "https://github.com/shoneSolomon", "followers_url": "https://api.github.com/users/shoneSolomon/followers", "following_url": "https://api.github.com/users/shoneSolomon/following{/other_user}", "gists_url": "https://api.github.com/users/shoneSolomon/gists{/gist_id}", "starred_url": "https://api.github.com/users/shoneSolomon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shoneSolomon/subscriptions", "organizations_url": "https://api.github.com/users/shoneSolomon/orgs", "repos_url": "https://api.github.com/users/shoneSolomon/repos", "events_url": "https://api.github.com/users/shoneSolomon/events{/privacy}", "received_events_url": "https://api.github.com/users/shoneSolomon/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-12-21T06:56:05Z", "updated_at": "2017-12-26T02:47:44Z", "closed_at": "2017-12-21T23:32:25Z", "author_association": "NONE", "body_html": "<p>I am a DIGITS novice, and I want to change the TensorFlow single machine from DIGITS to distributed\u3002The following is the code that I modified\u3002</p>\n<p>sv = tf.train.Supervisor(is_chief=(FLAGS.task_index == 0),<br>\nlogdir='/root/digits/digits/jobs/hello',<br>\nsaver=saver,<br>\ninit_op=init_op,<br>\n)</p>\n<p>with sv.prepare_or_wait_for_session(server.target) as sess:<br>\ninf_model.start_queue_runners(sess)<br>\nval_model.start_queue_runners(sess)<br>\ntrain_model.start_queue_runners(sess)<br>\ntry\uff1a<br>\nwhile not train_model.queue_coord.should_stop():<br>\n_, summary_str, step = sess.run                                 ([train_model.train,<br>\ntrain_model.summary,<br>\ntrain_model.global_step],<br>\nfeed_dict=feed_dict,<br>\noptions=run_options,<br>\nrun_metadata=run_metadata)</p>\n<p>and run it,but error:</p>\n<p>2017-12-19 06:56:23.696588: I tensorflow/core/distributed_runtime/master_session.cc:999] S<br>\ntart master session ad6a96f02b5d215f with config:<br>\nINFO:tensorflow:Starting standard services.<br>\n2017-12-19 06:56:23 [INFO] Starting standard services.<br>\nINFO:tensorflow:Starting queue runners.<br>\nINFO:tensorflow:Saving checkpoint to path /root/digits/digits/jobs/xwk/model.ckpt<br>\n2017-12-19 06:56:23 [INFO] Starting queue runners.<br>\n2017-12-19 06:56:23 [INFO] Saving checkpoint to path /root/digits/digits/jobs/xwk/model.ck<br>\nptINFO:tensorflow:Errorreported to Coordinator: , exceptions.KeyError: 'pyfunc_1'     [[Node: val/data/data_reader = PyFuncTin=[DT_STRING], Tout=[DT_STRING, DT_INT32,DT_INT64,DT_INT32],token=\"pyfunc_1\", _device=\"/job:ps/replica:0/task:0/cpu:0\"]]2017-12-19 06:56:23 [INFO] Error reported to Coordinator: , exceptions.KeyError: 'pyfunc_1'  [[Node: val/data/data_reader = PyFuncTin=[DT_STRING], Tout=[DT_STRING, DT_INT32,DT_INT64, DT_INT32],token=\"pyfunc_1\",_device=\"/job:ps/replica:0/task:0/cpu:0\"]]INFO:tensorflow:/root/digits/digits/jobs/xwk/model.ckpt is not in all_model_checkpoint_pat<br>\nhs. Manually adding it.2017-12-19 06:56:24 [INFO] /root/digits/digits/jobs/xwk/model.ckpt is not in all_model_che<br>\nckpoint_paths. Manually adding it.2017-12-19 06:56:24 [INFO] Starting queue runners (val)<br>\nTraceback (most recent call last):<br>\nFile \"/root/digits/digits/tools/tensorflow/main.py\", line 779, in<br>\ntf.app.run()<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 48<br>\n, in run    _sys.exit(main(_sys.argv[:1] + flags_passthrough))<br>\nFile \"/root/digits/digits/tools/tensorflow/main.py\", line 629, in main<br>\nval_model.start_queue_runners(sess)<br>\nFile \"/root/digits/digits/tools/tensorflow/model.py\", line 208, in start_queue_runners<br>\ntf.add_to_collection(digits.GraphKeys.QUEUE_RUNNERS, qr)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 4<br>\n248, in add_to_collection    get_default_graph().add_to_collection(name, value)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2<br>\n792, in add_to_collection    self._check_not_finalized()<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2<br>\n181, in _check_not_finalized    raise RuntimeError(\"Graph is finalized and cannot be modified.\")<br>\nRuntimeError: Graph is finalized and cannot be modified.</p>\n<p>Do you know what is the cause of the final problem?<br>\nIf you know, please tell me.<br>\nthx.</p>", "body_text": "I am a DIGITS novice, and I want to change the TensorFlow single machine from DIGITS to distributed\u3002The following is the code that I modified\u3002\nsv = tf.train.Supervisor(is_chief=(FLAGS.task_index == 0),\nlogdir='/root/digits/digits/jobs/hello',\nsaver=saver,\ninit_op=init_op,\n)\nwith sv.prepare_or_wait_for_session(server.target) as sess:\ninf_model.start_queue_runners(sess)\nval_model.start_queue_runners(sess)\ntrain_model.start_queue_runners(sess)\ntry\uff1a\nwhile not train_model.queue_coord.should_stop():\n_, summary_str, step = sess.run                                 ([train_model.train,\ntrain_model.summary,\ntrain_model.global_step],\nfeed_dict=feed_dict,\noptions=run_options,\nrun_metadata=run_metadata)\nand run it,but error:\n2017-12-19 06:56:23.696588: I tensorflow/core/distributed_runtime/master_session.cc:999] S\ntart master session ad6a96f02b5d215f with config:\nINFO:tensorflow:Starting standard services.\n2017-12-19 06:56:23 [INFO] Starting standard services.\nINFO:tensorflow:Starting queue runners.\nINFO:tensorflow:Saving checkpoint to path /root/digits/digits/jobs/xwk/model.ckpt\n2017-12-19 06:56:23 [INFO] Starting queue runners.\n2017-12-19 06:56:23 [INFO] Saving checkpoint to path /root/digits/digits/jobs/xwk/model.ck\nptINFO:tensorflow:Errorreported to Coordinator: , exceptions.KeyError: 'pyfunc_1'     [[Node: val/data/data_reader = PyFuncTin=[DT_STRING], Tout=[DT_STRING, DT_INT32,DT_INT64,DT_INT32],token=\"pyfunc_1\", _device=\"/job:ps/replica:0/task:0/cpu:0\"]]2017-12-19 06:56:23 [INFO] Error reported to Coordinator: , exceptions.KeyError: 'pyfunc_1'  [[Node: val/data/data_reader = PyFuncTin=[DT_STRING], Tout=[DT_STRING, DT_INT32,DT_INT64, DT_INT32],token=\"pyfunc_1\",_device=\"/job:ps/replica:0/task:0/cpu:0\"]]INFO:tensorflow:/root/digits/digits/jobs/xwk/model.ckpt is not in all_model_checkpoint_pat\nhs. Manually adding it.2017-12-19 06:56:24 [INFO] /root/digits/digits/jobs/xwk/model.ckpt is not in all_model_che\nckpoint_paths. Manually adding it.2017-12-19 06:56:24 [INFO] Starting queue runners (val)\nTraceback (most recent call last):\nFile \"/root/digits/digits/tools/tensorflow/main.py\", line 779, in\ntf.app.run()\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 48\n, in run    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\nFile \"/root/digits/digits/tools/tensorflow/main.py\", line 629, in main\nval_model.start_queue_runners(sess)\nFile \"/root/digits/digits/tools/tensorflow/model.py\", line 208, in start_queue_runners\ntf.add_to_collection(digits.GraphKeys.QUEUE_RUNNERS, qr)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 4\n248, in add_to_collection    get_default_graph().add_to_collection(name, value)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2\n792, in add_to_collection    self._check_not_finalized()\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2\n181, in _check_not_finalized    raise RuntimeError(\"Graph is finalized and cannot be modified.\")\nRuntimeError: Graph is finalized and cannot be modified.\nDo you know what is the cause of the final problem?\nIf you know, please tell me.\nthx.", "body": "\r\nI am a DIGITS novice, and I want to change the TensorFlow single machine from DIGITS to distributed\u3002The following is the code that I modified\u3002\r\n\r\nsv = tf.train.Supervisor(is_chief=(FLAGS.task_index == 0),\r\n            logdir='/root/digits/digits/jobs/hello',\r\n                        saver=saver,\r\n                        init_op=init_op,\r\n                        )\r\n\r\nwith sv.prepare_or_wait_for_session(server.target) as sess:\r\n    inf_model.start_queue_runners(sess)\r\n    val_model.start_queue_runners(sess)\r\n    train_model.start_queue_runners(sess)\r\n    try\uff1a\r\n         while not train_model.queue_coord.should_stop():\r\n            _, summary_str, step = sess.run                                 ([train_model.train,\r\n                                                                                        train_model.summary,\r\n                                                                                        train_model.global_step],\r\n                                                                                        feed_dict=feed_dict,\r\n                                                                                        options=run_options,\r\n                                                                                        run_metadata=run_metadata)\r\n\r\nand run it,but error:\r\n\r\n2017-12-19 06:56:23.696588: I tensorflow/core/distributed_runtime/master_session.cc:999] S\r\ntart master session ad6a96f02b5d215f with config: \r\nINFO:tensorflow:Starting standard services.\r\n2017-12-19 06:56:23 [INFO] Starting standard services.\r\nINFO:tensorflow:Starting queue runners.\r\nINFO:tensorflow:Saving checkpoint to path /root/digits/digits/jobs/xwk/model.ckpt\r\n2017-12-19 06:56:23 [INFO] Starting queue runners.\r\n2017-12-19 06:56:23 [INFO] Saving checkpoint to path /root/digits/digits/jobs/xwk/model.ck\r\nptINFO:tensorflow:Errorreported to Coordinator: , exceptions.KeyError: 'pyfunc_1'     [[Node: val/data/data_reader = PyFuncTin=[DT_STRING], Tout=[DT_STRING, DT_INT32,DT_INT64,DT_INT32],token=\"pyfunc_1\", _device=\"/job:ps/replica:0/task:0/cpu:0\"]]2017-12-19 06:56:23 [INFO] Error reported to Coordinator: , exceptions.KeyError: 'pyfunc_1'  [[Node: val/data/data_reader = PyFuncTin=[DT_STRING], Tout=[DT_STRING, DT_INT32,DT_INT64, DT_INT32],token=\"pyfunc_1\",_device=\"/job:ps/replica:0/task:0/cpu:0\"]]INFO:tensorflow:/root/digits/digits/jobs/xwk/model.ckpt is not in all_model_checkpoint_pat\r\nhs. Manually adding it.2017-12-19 06:56:24 [INFO] /root/digits/digits/jobs/xwk/model.ckpt is not in all_model_che\r\nckpoint_paths. Manually adding it.2017-12-19 06:56:24 [INFO] Starting queue runners (val)\r\nTraceback (most recent call last):\r\n  File \"/root/digits/digits/tools/tensorflow/main.py\", line 779, in \r\n    tf.app.run()\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 48\r\n, in run    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\r\n  File \"/root/digits/digits/tools/tensorflow/main.py\", line 629, in main\r\n    val_model.start_queue_runners(sess)\r\n  File \"/root/digits/digits/tools/tensorflow/model.py\", line 208, in start_queue_runners\r\n    tf.add_to_collection(digits.GraphKeys.QUEUE_RUNNERS, qr)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 4\r\n248, in add_to_collection    get_default_graph().add_to_collection(name, value)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2\r\n792, in add_to_collection    self._check_not_finalized()\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2\r\n181, in _check_not_finalized    raise RuntimeError(\"Graph is finalized and cannot be modified.\")\r\nRuntimeError: Graph is finalized and cannot be modified.\r\n\r\nDo you know what is the cause of the final problem?\r\nIf you know, please tell me.\r\nthx."}