{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13508", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13508/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13508/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13508/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/13508", "id": 263217682, "node_id": "MDU6SXNzdWUyNjMyMTc2ODI=", "number": 13508, "title": "Iterator.get_next() returning a tensor of shape ()", "user": {"login": "Bardeux", "id": 13334577, "node_id": "MDQ6VXNlcjEzMzM0NTc3", "avatar_url": "https://avatars1.githubusercontent.com/u/13334577?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Bardeux", "html_url": "https://github.com/Bardeux", "followers_url": "https://api.github.com/users/Bardeux/followers", "following_url": "https://api.github.com/users/Bardeux/following{/other_user}", "gists_url": "https://api.github.com/users/Bardeux/gists{/gist_id}", "starred_url": "https://api.github.com/users/Bardeux/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Bardeux/subscriptions", "organizations_url": "https://api.github.com/users/Bardeux/orgs", "repos_url": "https://api.github.com/users/Bardeux/repos", "events_url": "https://api.github.com/users/Bardeux/events{/privacy}", "received_events_url": "https://api.github.com/users/Bardeux/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-10-05T18:12:58Z", "updated_at": "2017-10-06T14:35:06Z", "closed_at": "2017-10-05T20:22:32Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code</strong>: Yes</li>\n<li><strong>OS Platform and Distribution</strong>: Windows 10 (also tested on Ubuntu 16.04)</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: b'unknown' 1.3.0</li>\n<li><strong>Python version</strong>: 3.5.3</li>\n<li><strong>CUDA/cuDNN version</strong>: 8.0/6.0</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>Hello,<br>\nI am currently trying to use the Dataset API with TFRecords. Using a (tested) dataset I made and refactoring working code, I wanted to switch from queues to Datasets. With the following code:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">def</span> <span class=\"pl-en\">parse_function</span>(<span class=\"pl-smi\">serialized_example</span>):\n\n    <span class=\"pl-c\"><span class=\"pl-c\">#</span> Context features</span>\n    context_features <span class=\"pl-k\">=</span> {\n         <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>label<span class=\"pl-pds\">\"</span></span>: tf.FixedLenFeature([], <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>tf.int64),\n    }\n\n    <span class=\"pl-c\"><span class=\"pl-c\">#</span> Sequence features</span>\n    sequence_features <span class=\"pl-k\">=</span> {\n         <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>positions<span class=\"pl-pds\">\"</span></span>: tf.FixedLenSequenceFeature([], <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>tf.string),\n    }\n\n    <span class=\"pl-c\"><span class=\"pl-c\">#</span> Parsing the TFRecord</span>\n    context_parsed, sequence_parsed <span class=\"pl-k\">=</span> tf.parse_single_sequence_example(\n        <span class=\"pl-v\">serialized</span><span class=\"pl-k\">=</span>serialized_example,\n        <span class=\"pl-v\">context_features</span><span class=\"pl-k\">=</span>context_features,\n        <span class=\"pl-v\">sequence_features</span><span class=\"pl-k\">=</span>sequence_features)\n\n    label <span class=\"pl-k\">=</span> tf.cast(context_parsed[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>label<span class=\"pl-pds\">'</span></span>], tf.int32)\n    sequence <span class=\"pl-k\">=</span> tf.decode_raw(sequence_parsed[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>positions<span class=\"pl-pds\">'</span></span>], tf.float32)\n\n    <span class=\"pl-k\">return</span> tf.reshape(sequence, [height, width, channels]), label\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">main</span>(<span class=\"pl-smi\">_</span>):\n    dataset <span class=\"pl-k\">=</span> tensorflow.contrib.data.TFRecordDataset(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>path<span class=\"pl-pds\">\"</span></span>)\n    dataset.map(parse_function)\n    dataset.batch(<span class=\"pl-c1\">64</span>)\n\n    iterator <span class=\"pl-k\">=</span> dataset.make_one_shot_iterator()\n    sequences, labels <span class=\"pl-k\">=</span> iterator.get_next()\n    <span class=\"pl-c1\">...</span>\n</pre></div>\n<p>the last line will raise a TypeError(\"'Tensor' object is not iterable.\"). iterator.get_next() returns in this case a tensor with shape (), but I believe it should return a tuple of batched sequences and labels, as defined in my parse_function. I tried with every iterator, in or out of a session, but no change.</p>\n<p>Is it a bug or am I doing something wrong? Examples from <a href=\"https://www.tensorflow.org/programmers_guide/datasets#decoding_image_data_and_resizing_it\" rel=\"nofollow\">https://www.tensorflow.org/programmers_guide/datasets#decoding_image_data_and_resizing_it</a><br>\nreally suggest this is the way to go.</p>\n<p>Thanks,<br>\nQuentin</p>", "body_text": "System information\n\nHave I written custom code: Yes\nOS Platform and Distribution: Windows 10 (also tested on Ubuntu 16.04)\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below): b'unknown' 1.3.0\nPython version: 3.5.3\nCUDA/cuDNN version: 8.0/6.0\n\nDescribe the problem\nHello,\nI am currently trying to use the Dataset API with TFRecords. Using a (tested) dataset I made and refactoring working code, I wanted to switch from queues to Datasets. With the following code:\ndef parse_function(serialized_example):\n\n    # Context features\n    context_features = {\n         \"label\": tf.FixedLenFeature([], dtype=tf.int64),\n    }\n\n    # Sequence features\n    sequence_features = {\n         \"positions\": tf.FixedLenSequenceFeature([], dtype=tf.string),\n    }\n\n    # Parsing the TFRecord\n    context_parsed, sequence_parsed = tf.parse_single_sequence_example(\n        serialized=serialized_example,\n        context_features=context_features,\n        sequence_features=sequence_features)\n\n    label = tf.cast(context_parsed['label'], tf.int32)\n    sequence = tf.decode_raw(sequence_parsed['positions'], tf.float32)\n\n    return tf.reshape(sequence, [height, width, channels]), label\n\ndef main(_):\n    dataset = tensorflow.contrib.data.TFRecordDataset(\"path\")\n    dataset.map(parse_function)\n    dataset.batch(64)\n\n    iterator = dataset.make_one_shot_iterator()\n    sequences, labels = iterator.get_next()\n    ...\n\nthe last line will raise a TypeError(\"'Tensor' object is not iterable.\"). iterator.get_next() returns in this case a tensor with shape (), but I believe it should return a tuple of batched sequences and labels, as defined in my parse_function. I tried with every iterator, in or out of a session, but no change.\nIs it a bug or am I doing something wrong? Examples from https://www.tensorflow.org/programmers_guide/datasets#decoding_image_data_and_resizing_it\nreally suggest this is the way to go.\nThanks,\nQuentin", "body": "### System information\r\n- **Have I written custom code**: Yes\r\n- **OS Platform and Distribution**: Windows 10 (also tested on Ubuntu 16.04)\r\n- **TensorFlow installed from (source or binary)**: binary\r\n- **TensorFlow version (use command below)**: b'unknown' 1.3.0\r\n- **Python version**: 3.5.3\r\n- **CUDA/cuDNN version**: 8.0/6.0\r\n\r\n### Describe the problem\r\nHello,\r\nI am currently trying to use the Dataset API with TFRecords. Using a (tested) dataset I made and refactoring working code, I wanted to switch from queues to Datasets. With the following code:\r\n \r\n```Python\r\ndef parse_function(serialized_example):\r\n\r\n    # Context features\r\n    context_features = {\r\n         \"label\": tf.FixedLenFeature([], dtype=tf.int64),\r\n    }\r\n\r\n    # Sequence features\r\n    sequence_features = {\r\n         \"positions\": tf.FixedLenSequenceFeature([], dtype=tf.string),\r\n    }\r\n\r\n    # Parsing the TFRecord\r\n    context_parsed, sequence_parsed = tf.parse_single_sequence_example(\r\n        serialized=serialized_example,\r\n        context_features=context_features,\r\n        sequence_features=sequence_features)\r\n\r\n    label = tf.cast(context_parsed['label'], tf.int32)\r\n    sequence = tf.decode_raw(sequence_parsed['positions'], tf.float32)\r\n\r\n    return tf.reshape(sequence, [height, width, channels]), label\r\n\r\ndef main(_):\r\n    dataset = tensorflow.contrib.data.TFRecordDataset(\"path\")\r\n    dataset.map(parse_function)\r\n    dataset.batch(64)\r\n\r\n    iterator = dataset.make_one_shot_iterator()\r\n    sequences, labels = iterator.get_next()\r\n    ...\r\n\r\n```\r\nthe last line will raise a TypeError(\"'Tensor' object is not iterable.\"). iterator.get_next() returns in this case a tensor with shape (), but I believe it should return a tuple of batched sequences and labels, as defined in my parse_function. I tried with every iterator, in or out of a session, but no change.\r\n\r\nIs it a bug or am I doing something wrong? Examples from https://www.tensorflow.org/programmers_guide/datasets#decoding_image_data_and_resizing_it\r\nreally suggest this is the way to go.\r\n\r\nThanks,\r\nQuentin"}