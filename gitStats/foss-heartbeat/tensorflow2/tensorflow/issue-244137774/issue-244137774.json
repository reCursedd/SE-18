{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11621", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11621/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11621/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11621/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/11621", "id": 244137774, "node_id": "MDU6SXNzdWUyNDQxMzc3NzQ=", "number": 11621, "title": "WARNING:tensorflow:Input graph does not contain a QueueRunner. That means predict yields forever. This is probably a mistake.", "user": {"login": "mari-linhares", "id": 8157164, "node_id": "MDQ6VXNlcjgxNTcxNjQ=", "avatar_url": "https://avatars3.githubusercontent.com/u/8157164?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mari-linhares", "html_url": "https://github.com/mari-linhares", "followers_url": "https://api.github.com/users/mari-linhares/followers", "following_url": "https://api.github.com/users/mari-linhares/following{/other_user}", "gists_url": "https://api.github.com/users/mari-linhares/gists{/gist_id}", "starred_url": "https://api.github.com/users/mari-linhares/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mari-linhares/subscriptions", "organizations_url": "https://api.github.com/users/mari-linhares/orgs", "repos_url": "https://api.github.com/users/mari-linhares/repos", "events_url": "https://api.github.com/users/mari-linhares/events{/privacy}", "received_events_url": "https://api.github.com/users/mari-linhares/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "xiejw", "id": 1184671, "node_id": "MDQ6VXNlcjExODQ2NzE=", "avatar_url": "https://avatars1.githubusercontent.com/u/1184671?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xiejw", "html_url": "https://github.com/xiejw", "followers_url": "https://api.github.com/users/xiejw/followers", "following_url": "https://api.github.com/users/xiejw/following{/other_user}", "gists_url": "https://api.github.com/users/xiejw/gists{/gist_id}", "starred_url": "https://api.github.com/users/xiejw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xiejw/subscriptions", "organizations_url": "https://api.github.com/users/xiejw/orgs", "repos_url": "https://api.github.com/users/xiejw/repos", "events_url": "https://api.github.com/users/xiejw/events{/privacy}", "received_events_url": "https://api.github.com/users/xiejw/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "xiejw", "id": 1184671, "node_id": "MDQ6VXNlcjExODQ2NzE=", "avatar_url": "https://avatars1.githubusercontent.com/u/1184671?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xiejw", "html_url": "https://github.com/xiejw", "followers_url": "https://api.github.com/users/xiejw/followers", "following_url": "https://api.github.com/users/xiejw/following{/other_user}", "gists_url": "https://api.github.com/users/xiejw/gists{/gist_id}", "starred_url": "https://api.github.com/users/xiejw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xiejw/subscriptions", "organizations_url": "https://api.github.com/users/xiejw/orgs", "repos_url": "https://api.github.com/users/xiejw/repos", "events_url": "https://api.github.com/users/xiejw/events{/privacy}", "received_events_url": "https://api.github.com/users/xiejw/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 10, "created_at": "2017-07-19T18:48:40Z", "updated_at": "2018-11-21T10:57:24Z", "closed_at": "2017-11-07T15:48:14Z", "author_association": "NONE", "body_html": "<p>I have built a Custom Estimator, and I created an input function using the <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/docs_src/programmers_guide/datasets.md\">Datasets API</a> when I call:</p>\n<p><code>estimator.predict(input_fn)</code></p>\n<p>I see the following Warning:<br>\nWARNING:tensorflow:Input graph does not contain a QueueRunner. That means predict yields forever. This is probably a mistake.</p>\n<p>The input function looks like this:</p>\n<pre><code>def get_input_fn(review, word_to_id):\n  \"\"\"Create a Input function for classify_sentiment_analysis.py.\n\n   Args:\n      review (str): review sentence\n      word_to_id (list): list with all words represented in the embedding.\n                         The index is the word index in the embedding.\n\n   Return: sequence of indexes that map that words to the embedding.\n\n  \"\"\"\n  def _word_to_index(sequence):\n    \"\"\"Convert a sequence of words into a sequence of integers.\"\"\"\n    id_sequence = []\n    UNK = 399999 # vector for unkown words\n    for word in sequence:\n      if word in word_to_id:\n        id_sequence.append(word_to_id.index(word))\n      else:\n        id_sequence.append(UNK)\n    return np.array(id_sequence)\n\n  def input_fn():\n    \"\"\"Input function.\"\"\"\n    # make review a sequence of words\n    review_split = review.split(' ')\n    # converting words to indexes\n    review_id = _word_to_index(review_split)\n    # calculates the length of the sequence\n    x_len = len(review_split)\n    # creates the dataset from in memory data\n    ds = tf.contrib.data.Dataset.from_tensors(review_id)\n    # the model expects a batch\n    ds = ds.batch(1)\n\n    # creates iterator\n    x = ds.make_one_shot_iterator().get_next()\n\n    dict_x = {'x': x, rnn_common.RNNKeys.SEQUENCE_LENGTH_KEY: [x_len]}\n    # no label needed since we're only using this input function for prediction\n    # if training make sure to return a label\n    return dict_x, None\n\n  return input_fn\n</code></pre>\n<p>Thank you!</p>", "body_text": "I have built a Custom Estimator, and I created an input function using the Datasets API when I call:\nestimator.predict(input_fn)\nI see the following Warning:\nWARNING:tensorflow:Input graph does not contain a QueueRunner. That means predict yields forever. This is probably a mistake.\nThe input function looks like this:\ndef get_input_fn(review, word_to_id):\n  \"\"\"Create a Input function for classify_sentiment_analysis.py.\n\n   Args:\n      review (str): review sentence\n      word_to_id (list): list with all words represented in the embedding.\n                         The index is the word index in the embedding.\n\n   Return: sequence of indexes that map that words to the embedding.\n\n  \"\"\"\n  def _word_to_index(sequence):\n    \"\"\"Convert a sequence of words into a sequence of integers.\"\"\"\n    id_sequence = []\n    UNK = 399999 # vector for unkown words\n    for word in sequence:\n      if word in word_to_id:\n        id_sequence.append(word_to_id.index(word))\n      else:\n        id_sequence.append(UNK)\n    return np.array(id_sequence)\n\n  def input_fn():\n    \"\"\"Input function.\"\"\"\n    # make review a sequence of words\n    review_split = review.split(' ')\n    # converting words to indexes\n    review_id = _word_to_index(review_split)\n    # calculates the length of the sequence\n    x_len = len(review_split)\n    # creates the dataset from in memory data\n    ds = tf.contrib.data.Dataset.from_tensors(review_id)\n    # the model expects a batch\n    ds = ds.batch(1)\n\n    # creates iterator\n    x = ds.make_one_shot_iterator().get_next()\n\n    dict_x = {'x': x, rnn_common.RNNKeys.SEQUENCE_LENGTH_KEY: [x_len]}\n    # no label needed since we're only using this input function for prediction\n    # if training make sure to return a label\n    return dict_x, None\n\n  return input_fn\n\nThank you!", "body": "I have built a Custom Estimator, and I created an input function using the [Datasets API](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/docs_src/programmers_guide/datasets.md) when I call:\r\n\r\n``` estimator.predict(input_fn) ```\r\n\r\nI see the following Warning:\r\nWARNING:tensorflow:Input graph does not contain a QueueRunner. That means predict yields forever. This is probably a mistake.\r\n\r\nThe input function looks like this:\r\n```\r\ndef get_input_fn(review, word_to_id):\r\n  \"\"\"Create a Input function for classify_sentiment_analysis.py.\r\n\r\n   Args:\r\n      review (str): review sentence\r\n      word_to_id (list): list with all words represented in the embedding.\r\n                         The index is the word index in the embedding.\r\n\r\n   Return: sequence of indexes that map that words to the embedding.\r\n\r\n  \"\"\"\r\n  def _word_to_index(sequence):\r\n    \"\"\"Convert a sequence of words into a sequence of integers.\"\"\"\r\n    id_sequence = []\r\n    UNK = 399999 # vector for unkown words\r\n    for word in sequence:\r\n      if word in word_to_id:\r\n        id_sequence.append(word_to_id.index(word))\r\n      else:\r\n        id_sequence.append(UNK)\r\n    return np.array(id_sequence)\r\n\r\n  def input_fn():\r\n    \"\"\"Input function.\"\"\"\r\n    # make review a sequence of words\r\n    review_split = review.split(' ')\r\n    # converting words to indexes\r\n    review_id = _word_to_index(review_split)\r\n    # calculates the length of the sequence\r\n    x_len = len(review_split)\r\n    # creates the dataset from in memory data\r\n    ds = tf.contrib.data.Dataset.from_tensors(review_id)\r\n    # the model expects a batch\r\n    ds = ds.batch(1)\r\n\r\n    # creates iterator\r\n    x = ds.make_one_shot_iterator().get_next()\r\n\r\n    dict_x = {'x': x, rnn_common.RNNKeys.SEQUENCE_LENGTH_KEY: [x_len]}\r\n    # no label needed since we're only using this input function for prediction\r\n    # if training make sure to return a label\r\n    return dict_x, None\r\n\r\n  return input_fn\r\n```\r\n\r\nThank you!"}