{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/404885106", "html_url": "https://github.com/tensorflow/tensorflow/issues/20521#issuecomment-404885106", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20521", "id": 404885106, "node_id": "MDEyOklzc3VlQ29tbWVudDQwNDg4NTEwNg==", "user": {"login": "lamsalab", "id": 23664489, "node_id": "MDQ6VXNlcjIzNjY0NDg5", "avatar_url": "https://avatars2.githubusercontent.com/u/23664489?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lamsalab", "html_url": "https://github.com/lamsalab", "followers_url": "https://api.github.com/users/lamsalab/followers", "following_url": "https://api.github.com/users/lamsalab/following{/other_user}", "gists_url": "https://api.github.com/users/lamsalab/gists{/gist_id}", "starred_url": "https://api.github.com/users/lamsalab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lamsalab/subscriptions", "organizations_url": "https://api.github.com/users/lamsalab/orgs", "repos_url": "https://api.github.com/users/lamsalab/repos", "events_url": "https://api.github.com/users/lamsalab/events{/privacy}", "received_events_url": "https://api.github.com/users/lamsalab/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-13T16:31:52Z", "updated_at": "2018-07-13T16:31:52Z", "author_association": "NONE", "body_html": "<p>Have I written custom code: yes<br>\nOS Platform and Distribution: Linux Ubuntu 14.04<br>\nTensorFlow installed from: source<br>\nTensorFlow version: 1.9<br>\nPython version: 2.7<br>\nBazel version: 0.12.0<br>\nGCC/Compiler version: 4.8.4<br>\nCUDA/cuDNN version: 9.1<br>\nGPU model and memory: Tesla K40, K80</p>\n<p>I have been getting a similar error when I use MirroredStrategy() for training across multiple devices. Here is the stack trace for it:</p>\n<p><strong>Stacktrace</strong><br>\n`  File \"train.py\", line 113, in <br>\ntf.app.run()<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 125, in run<br>\n_sys.exit(main(argv))<br>\nFile \"train.py\", line 110, in main<br>\nclassifier.train(input_fn=lambda: _get_input_stream())<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 376, in train<br>\nloss = self._train_model(input_fn, hooks, saving_listeners)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1141, in _train_model<br>\nreturn self._train_model_distributed(input_fn, hooks, saving_listeners)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1366, in _train_model_distributed<br>\nsaving_listeners)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1449, in _train_with_estimator_spec<br>\n_, loss = mon_sess.run([estimator_spec.train_op, estimator_spec.loss])<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 583, in run<br>\nrun_metadata=run_metadata)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1059, in run<br>\nrun_metadata=run_metadata)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1150, in run<br>\nraise six.reraise(*original_exc_info)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1135, in run<br>\nreturn self._sess.run(*args, **kwargs)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1207, in run<br>\nrun_metadata=run_metadata)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 987, in run<br>\nreturn self._sess.run(*args, **kwargs)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 877, in run<br>\nrun_metadata_ptr)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1100, in _run<br>\nfeed_dict_tensor, options, run_metadata)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1272, in _do_run<br>\nrun_metadata)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1291, in _do_call<br>\nraise type(e)(node_def, op, message)<br>\ntensorflow.python.framework.errors_impl.InternalError: No unary variant device copy function found for direction: 1 and Variant type_name: tensorflow::Tensor<br>\n[[Node: FunctionBufferingResourceGetNext = FunctionBufferingResourceGetNext<a href=\"FunctionBufferingResource\">output_types=[DT_FLOAT, DT_STRING, DT_INT32, DT_VARIANT], _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"</a>]]<br>\n[[Node: GroupCrossDeviceControlEdges_0/train/OptimizeLoss/global_norm/gradient_norm/tags/_766 = _Recv<a href=\"\">client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device_incarnation=1, tensor_name=\"edge_1235_..._norm/tags\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"</a>]]</p>\n<p>Caused by op u'FunctionBufferingResourceGetNext', defined at:<br>\nFile \"train.py\", line 113, in <br>\ntf.app.run()<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 125, in run<br>\n_sys.exit(main(argv))<br>\nFile \"train.py\", line 110, in main<br>\nclassifier.train(input_fn=lambda: _get_input_stream())<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 376, in train<br>\nloss = self._train_model(input_fn, hooks, saving_listeners)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1141, in _train_model<br>\nreturn self._train_model_distributed(input_fn, hooks, saving_listeners)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1241, in _train_model_distributed<br>\ninput_fn, model_fn_lib.ModeKeys.TRAIN))<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1011, in _get_features_and_labels_from_input_fn<br>\nreturn estimator_util.parse_input_fn_result(result)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/util.py\", line 111, in parse_input_fn_result<br>\nresult = iterator.get_next()<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/values.py\", line 619, in get_next<br>\ndata_list = self._iterator.get_next(name=name)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/prefetching_ops_v2.py\", line 124, in get_next<br>\nself.output_types, self.output_classes)), name=name)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/contrib/data/python/ops/gen_dataset_ops.py\", line 351, in function_buffering_resource_get_next<br>\noutput_types=output_types, name=name)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper<br>\nop_def=op_def)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/util/deprecation.py\", line 432, in new_func<br>\nreturn func(*args, **kwargs)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 3212, in create_op<br>\nop_def=op_def)<br>\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1702, in <strong>init</strong><br>\nself._traceback = self._graph._extract_stack()  # pylint: disable=protected-access</p>\n<p>InternalError (see above for traceback): No unary variant device copy function found for direction: 1 and Variant type_name: tensorflow::Tensor<br>\n[[Node: FunctionBufferingResourceGetNext = FunctionBufferingResourceGetNext<a href=\"FunctionBufferingResource\">output_types=[DT_FLOAT, DT_STRING, DT_INT32, DT_VARIANT], _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"</a>]]<br>\n[[Node: GroupCrossDeviceControlEdges_0/train/OptimizeLoss/global_norm/gradient_norm/tags/_766 = _Recv<a href=\"\">client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device_incarnation=1, tensor_name=\"edge_1235_..._norm/tags\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"</a>]]`<br>\n<strong>End of Stacktrace</strong></p>\n<p>My guess is that the underlying issue should be the same. I do not make any explicit calls to prefetch_to_device(<em>Insert GPU here</em>) with sparse tensors anywhere in my code. Hence, the issue probably lies with references to prefetching ops under the hood.</p>", "body_text": "Have I written custom code: yes\nOS Platform and Distribution: Linux Ubuntu 14.04\nTensorFlow installed from: source\nTensorFlow version: 1.9\nPython version: 2.7\nBazel version: 0.12.0\nGCC/Compiler version: 4.8.4\nCUDA/cuDNN version: 9.1\nGPU model and memory: Tesla K40, K80\nI have been getting a similar error when I use MirroredStrategy() for training across multiple devices. Here is the stack trace for it:\nStacktrace\n`  File \"train.py\", line 113, in \ntf.app.run()\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 125, in run\n_sys.exit(main(argv))\nFile \"train.py\", line 110, in main\nclassifier.train(input_fn=lambda: _get_input_stream())\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 376, in train\nloss = self._train_model(input_fn, hooks, saving_listeners)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1141, in _train_model\nreturn self._train_model_distributed(input_fn, hooks, saving_listeners)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1366, in _train_model_distributed\nsaving_listeners)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1449, in _train_with_estimator_spec\n_, loss = mon_sess.run([estimator_spec.train_op, estimator_spec.loss])\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 583, in run\nrun_metadata=run_metadata)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1059, in run\nrun_metadata=run_metadata)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1150, in run\nraise six.reraise(*original_exc_info)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1135, in run\nreturn self._sess.run(*args, **kwargs)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1207, in run\nrun_metadata=run_metadata)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 987, in run\nreturn self._sess.run(*args, **kwargs)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 877, in run\nrun_metadata_ptr)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1100, in _run\nfeed_dict_tensor, options, run_metadata)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1272, in _do_run\nrun_metadata)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1291, in _do_call\nraise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InternalError: No unary variant device copy function found for direction: 1 and Variant type_name: tensorflow::Tensor\n[[Node: FunctionBufferingResourceGetNext = FunctionBufferingResourceGetNextoutput_types=[DT_FLOAT, DT_STRING, DT_INT32, DT_VARIANT], _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"]]\n[[Node: GroupCrossDeviceControlEdges_0/train/OptimizeLoss/global_norm/gradient_norm/tags/_766 = _Recvclient_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device_incarnation=1, tensor_name=\"edge_1235_..._norm/tags\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"]]\nCaused by op u'FunctionBufferingResourceGetNext', defined at:\nFile \"train.py\", line 113, in \ntf.app.run()\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 125, in run\n_sys.exit(main(argv))\nFile \"train.py\", line 110, in main\nclassifier.train(input_fn=lambda: _get_input_stream())\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 376, in train\nloss = self._train_model(input_fn, hooks, saving_listeners)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1141, in _train_model\nreturn self._train_model_distributed(input_fn, hooks, saving_listeners)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1241, in _train_model_distributed\ninput_fn, model_fn_lib.ModeKeys.TRAIN))\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1011, in _get_features_and_labels_from_input_fn\nreturn estimator_util.parse_input_fn_result(result)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/util.py\", line 111, in parse_input_fn_result\nresult = iterator.get_next()\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/values.py\", line 619, in get_next\ndata_list = self._iterator.get_next(name=name)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/prefetching_ops_v2.py\", line 124, in get_next\nself.output_types, self.output_classes)), name=name)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/contrib/data/python/ops/gen_dataset_ops.py\", line 351, in function_buffering_resource_get_next\noutput_types=output_types, name=name)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\nop_def=op_def)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/util/deprecation.py\", line 432, in new_func\nreturn func(*args, **kwargs)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 3212, in create_op\nop_def=op_def)\nFile \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1702, in init\nself._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\nInternalError (see above for traceback): No unary variant device copy function found for direction: 1 and Variant type_name: tensorflow::Tensor\n[[Node: FunctionBufferingResourceGetNext = FunctionBufferingResourceGetNextoutput_types=[DT_FLOAT, DT_STRING, DT_INT32, DT_VARIANT], _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"]]\n[[Node: GroupCrossDeviceControlEdges_0/train/OptimizeLoss/global_norm/gradient_norm/tags/_766 = _Recvclient_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device_incarnation=1, tensor_name=\"edge_1235_..._norm/tags\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"]]`\nEnd of Stacktrace\nMy guess is that the underlying issue should be the same. I do not make any explicit calls to prefetch_to_device(Insert GPU here) with sparse tensors anywhere in my code. Hence, the issue probably lies with references to prefetching ops under the hood.", "body": "Have I written custom code: yes\r\nOS Platform and Distribution: Linux Ubuntu 14.04\r\nTensorFlow installed from: source\r\nTensorFlow version: 1.9\r\nPython version: 2.7\r\nBazel version: 0.12.0\r\nGCC/Compiler version: 4.8.4\r\nCUDA/cuDNN version: 9.1\r\nGPU model and memory: Tesla K40, K80\r\n\r\nI have been getting a similar error when I use MirroredStrategy() for training across multiple devices. Here is the stack trace for it:\r\n\r\n**Stacktrace**\r\n`  File \"train.py\", line 113, in <module>\r\n    tf.app.run()\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 125, in run\r\n    _sys.exit(main(argv))\r\n  File \"train.py\", line 110, in main\r\n    classifier.train(input_fn=lambda: _get_input_stream())\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 376, in train\r\n    loss = self._train_model(input_fn, hooks, saving_listeners)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1141, in _train_model\r\n    return self._train_model_distributed(input_fn, hooks, saving_listeners)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1366, in _train_model_distributed\r\n    saving_listeners)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1449, in _train_with_estimator_spec\r\n    _, loss = mon_sess.run([estimator_spec.train_op, estimator_spec.loss])\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 583, in run\r\n    run_metadata=run_metadata)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1059, in run\r\n    run_metadata=run_metadata)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1150, in run\r\n    raise six.reraise(*original_exc_info)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1135, in run\r\n    return self._sess.run(*args, **kwargs)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1207, in run\r\n    run_metadata=run_metadata)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/training/monitored_session.py\", line 987, in run\r\n    return self._sess.run(*args, **kwargs)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 877, in run\r\n    run_metadata_ptr)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1100, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1272, in _do_run\r\n    run_metadata)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1291, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InternalError: No unary variant device copy function found for direction: 1 and Variant type_name: tensorflow::Tensor\r\n         [[Node: FunctionBufferingResourceGetNext = FunctionBufferingResourceGetNext[output_types=[DT_FLOAT, DT_STRING, DT_INT32, DT_VARIANT], _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"](FunctionBufferingResource)]]\r\n         [[Node: GroupCrossDeviceControlEdges_0/train/OptimizeLoss/global_norm/gradient_norm/tags/_766 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device_incarnation=1, tensor_name=\"edge_1235_..._norm/tags\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"]()]]\r\n\r\nCaused by op u'FunctionBufferingResourceGetNext', defined at:\r\n  File \"train.py\", line 113, in <module>\r\n    tf.app.run()\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 125, in run\r\n    _sys.exit(main(argv))\r\n  File \"train.py\", line 110, in main\r\n    classifier.train(input_fn=lambda: _get_input_stream())\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 376, in train\r\n    loss = self._train_model(input_fn, hooks, saving_listeners)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1141, in _train_model\r\n    return self._train_model_distributed(input_fn, hooks, saving_listeners)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1241, in _train_model_distributed\r\n    input_fn, model_fn_lib.ModeKeys.TRAIN))\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1011, in _get_features_and_labels_from_input_fn\r\n    return estimator_util.parse_input_fn_result(result)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/estimator/util.py\", line 111, in parse_input_fn_result\r\n    result = iterator.get_next()\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/values.py\", line 619, in get_next\r\n    data_list = self._iterator.get_next(name=name)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/prefetching_ops_v2.py\", line 124, in get_next\r\n    self.output_types, self.output_classes)), name=name)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/contrib/data/python/ops/gen_dataset_ops.py\", line 351, in function_buffering_resource_get_next\r\n    output_types=output_types, name=name)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/util/deprecation.py\", line 432, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 3212, in create_op\r\n    op_def=op_def)\r\n  File \"/home/weinman/virtualenv/tf-b2fe2a874/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1702, in __init__\r\n    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\r\n\r\nInternalError (see above for traceback): No unary variant device copy function found for direction: 1 and Variant type_name: tensorflow::Tensor\r\n         [[Node: FunctionBufferingResourceGetNext = FunctionBufferingResourceGetNext[output_types=[DT_FLOAT, DT_STRING, DT_INT32, DT_VARIANT], _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"](FunctionBufferingResource)]]\r\n         [[Node: GroupCrossDeviceControlEdges_0/train/OptimizeLoss/global_norm/gradient_norm/tags/_766 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device_incarnation=1, tensor_name=\"edge_1235_..._norm/tags\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"]()]]`\r\n**End of Stacktrace**\r\n\r\nMy guess is that the underlying issue should be the same. I do not make any explicit calls to prefetch_to_device(*Insert GPU here*) with sparse tensors anywhere in my code. Hence, the issue probably lies with references to prefetching ops under the hood. \r\n"}