{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/348991399", "html_url": "https://github.com/tensorflow/tensorflow/issues/14719#issuecomment-348991399", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14719", "id": 348991399, "node_id": "MDEyOklzc3VlQ29tbWVudDM0ODk5MTM5OQ==", "user": {"login": "OdingdongO", "id": 17340179, "node_id": "MDQ6VXNlcjE3MzQwMTc5", "avatar_url": "https://avatars2.githubusercontent.com/u/17340179?v=4", "gravatar_id": "", "url": "https://api.github.com/users/OdingdongO", "html_url": "https://github.com/OdingdongO", "followers_url": "https://api.github.com/users/OdingdongO/followers", "following_url": "https://api.github.com/users/OdingdongO/following{/other_user}", "gists_url": "https://api.github.com/users/OdingdongO/gists{/gist_id}", "starred_url": "https://api.github.com/users/OdingdongO/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/OdingdongO/subscriptions", "organizations_url": "https://api.github.com/users/OdingdongO/orgs", "repos_url": "https://api.github.com/users/OdingdongO/repos", "events_url": "https://api.github.com/users/OdingdongO/events{/privacy}", "received_events_url": "https://api.github.com/users/OdingdongO/received_events", "type": "User", "site_admin": false}, "created_at": "2017-12-04T15:14:18Z", "updated_at": "2017-12-04T15:16:05Z", "author_association": "NONE", "body_html": "<p>After modifying ImageClassifier.java , I can run float model from <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/lite/g3doc/models.md\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/lite/g3doc/models.md</a>;<br>\ntest the Inception model(Inception V3 Slim 2016)and  Mobilenet model(Mobilenet 1.0 224 Float)<br>\nthe inceptionv3_slim_2016.tflite model inference time is 2260ms,<br>\nthe  mobilenet_v1_1.0_224.tflite model inference time is 500ms and mobilenet_quant_v1_224.tflite is 65ms.<br>\nadd:<br>\nprivate static final int IMAGE_MEAN = 128;<br>\nprivate static final float IMAGE_STD = 128.0f;<br>\nchange:<br>\nprivate byte[][] labelProbArray = null;<br>\n.............................................................<br>\nprivate float[][] labelProbArray = null;</p>\n<p>imgData = ByteBuffer.allocateDirect(<br>\nDIM_BATCH_SIZE * DIM_IMG_SIZE_X * DIM_IMG_SIZE_Y * DIM_PIXEL_SIZE);<br>\n................................................................<br>\nimgData = ByteBuffer.allocateDirect(<br>\n4*DIM_BATCH_SIZE * DIM_IMG_SIZE_X * DIM_IMG_SIZE_Y * DIM_PIXEL_SIZE);</p>\n<p>labelProbArray = new byte[1][labelList.size()];<br>\n.............................................................<br>\nlabelProbArray = new float[1][labelList.size()];</p>\n<p>imgData.put((byte) ((val &gt;&gt; 16) &amp; 0xFF));<br>\nimgData.put((byte) ((val &gt;&gt; 8) &amp; 0xFF));<br>\nimgData.put((byte) (val &amp; 0xFF));<br>\n.............................................................<br>\nimgData.putFloat((((val &gt;&gt; 16) &amp; 0xFF)-IMAGE_MEAN)/IMAGE_STD);<br>\nimgData.putFloat((((val &gt;&gt; 8) &amp; 0xFF)-IMAGE_MEAN)/IMAGE_STD);<br>\nimgData.putFloat(((val &amp; 0xFF)-IMAGE_MEAN)/IMAGE_STD);</p>\n<p>if use the inception model,modifying<br>\nstatic final int DIM_IMG_SIZE_X = 224;<br>\nstatic final int DIM_IMG_SIZE_Y = 224;<br>\n.............................................................<br>\nstatic final int DIM_IMG_SIZE_X  =  299;<br>\nstatic final int DIM_IMG_SIZE_Y  =  299;</p>", "body_text": "After modifying ImageClassifier.java , I can run float model from https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/lite/g3doc/models.md;\ntest the Inception model(Inception V3 Slim 2016)and  Mobilenet model(Mobilenet 1.0 224 Float)\nthe inceptionv3_slim_2016.tflite model inference time is 2260ms,\nthe  mobilenet_v1_1.0_224.tflite model inference time is 500ms and mobilenet_quant_v1_224.tflite is 65ms.\nadd:\nprivate static final int IMAGE_MEAN = 128;\nprivate static final float IMAGE_STD = 128.0f;\nchange:\nprivate byte[][] labelProbArray = null;\n.............................................................\nprivate float[][] labelProbArray = null;\nimgData = ByteBuffer.allocateDirect(\nDIM_BATCH_SIZE * DIM_IMG_SIZE_X * DIM_IMG_SIZE_Y * DIM_PIXEL_SIZE);\n................................................................\nimgData = ByteBuffer.allocateDirect(\n4*DIM_BATCH_SIZE * DIM_IMG_SIZE_X * DIM_IMG_SIZE_Y * DIM_PIXEL_SIZE);\nlabelProbArray = new byte[1][labelList.size()];\n.............................................................\nlabelProbArray = new float[1][labelList.size()];\nimgData.put((byte) ((val >> 16) & 0xFF));\nimgData.put((byte) ((val >> 8) & 0xFF));\nimgData.put((byte) (val & 0xFF));\n.............................................................\nimgData.putFloat((((val >> 16) & 0xFF)-IMAGE_MEAN)/IMAGE_STD);\nimgData.putFloat((((val >> 8) & 0xFF)-IMAGE_MEAN)/IMAGE_STD);\nimgData.putFloat(((val & 0xFF)-IMAGE_MEAN)/IMAGE_STD);\nif use the inception model,modifying\nstatic final int DIM_IMG_SIZE_X = 224;\nstatic final int DIM_IMG_SIZE_Y = 224;\n.............................................................\nstatic final int DIM_IMG_SIZE_X  =  299;\nstatic final int DIM_IMG_SIZE_Y  =  299;", "body": "After modifying ImageClassifier.java , I can run float model from https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/lite/g3doc/models.md;\r\ntest the Inception model(Inception V3 Slim 2016)and  Mobilenet model(Mobilenet 1.0 224 Float)\r\nthe inceptionv3_slim_2016.tflite model inference time is 2260ms,\r\nthe  mobilenet_v1_1.0_224.tflite model inference time is 500ms and mobilenet_quant_v1_224.tflite is 65ms.\r\n add:\r\n  private static final int IMAGE_MEAN = 128;\r\n  private static final float IMAGE_STD = 128.0f;\r\nchange:\r\n private byte[][] labelProbArray = null;\r\n.............................................................\r\n private float[][] labelProbArray = null;\r\n\r\nimgData = ByteBuffer.allocateDirect(\r\n            DIM_BATCH_SIZE * DIM_IMG_SIZE_X * DIM_IMG_SIZE_Y * DIM_PIXEL_SIZE);\r\n................................................................\r\nimgData = ByteBuffer.allocateDirect(\r\n            4*DIM_BATCH_SIZE * DIM_IMG_SIZE_X * DIM_IMG_SIZE_Y * DIM_PIXEL_SIZE);\r\n   \r\n labelProbArray = new byte[1][labelList.size()];\r\n.............................................................\r\n labelProbArray = new float[1][labelList.size()];\r\n\r\nimgData.put((byte) ((val >> 16) & 0xFF));\r\nimgData.put((byte) ((val >> 8) & 0xFF));\r\nimgData.put((byte) (val & 0xFF));\r\n.............................................................\r\n  imgData.putFloat((((val >> 16) & 0xFF)-IMAGE_MEAN)/IMAGE_STD);\r\n  imgData.putFloat((((val >> 8) & 0xFF)-IMAGE_MEAN)/IMAGE_STD);\r\n  imgData.putFloat(((val & 0xFF)-IMAGE_MEAN)/IMAGE_STD);\r\n\r\nif use the inception model,modifying\r\n static final int DIM_IMG_SIZE_X = 224;\r\n static final int DIM_IMG_SIZE_Y = 224;\r\n.............................................................\r\nstatic final int DIM_IMG_SIZE_X  =  299;\r\nstatic final int DIM_IMG_SIZE_Y  =  299;"}