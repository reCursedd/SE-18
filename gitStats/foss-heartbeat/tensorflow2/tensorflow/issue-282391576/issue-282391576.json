{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15391", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15391/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15391/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15391/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15391", "id": 282391576, "node_id": "MDU6SXNzdWUyODIzOTE1NzY=", "number": 15391, "title": "tf.nn.leaky_relu does not work with float64", "user": {"login": "jhzab", "id": 7429086, "node_id": "MDQ6VXNlcjc0MjkwODY=", "avatar_url": "https://avatars2.githubusercontent.com/u/7429086?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhzab", "html_url": "https://github.com/jhzab", "followers_url": "https://api.github.com/users/jhzab/followers", "following_url": "https://api.github.com/users/jhzab/following{/other_user}", "gists_url": "https://api.github.com/users/jhzab/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhzab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhzab/subscriptions", "organizations_url": "https://api.github.com/users/jhzab/orgs", "repos_url": "https://api.github.com/users/jhzab/repos", "events_url": "https://api.github.com/users/jhzab/events{/privacy}", "received_events_url": "https://api.github.com/users/jhzab/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}, {"id": 473173272, "node_id": "MDU6TGFiZWw0NzMxNzMyNzI=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:feature", "name": "type:feature", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-12-15T10:58:31Z", "updated_at": "2018-01-20T23:43:09Z", "closed_at": "2018-01-20T23:43:09Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: Yes, see below</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Fedora 26</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary, pip3 install tensorflow</li>\n<li><strong>TensorFlow version (use command below)</strong>: v1.4.0-19-ga52c8d9 1.4.1</li>\n<li><strong>Python version</strong>: Python 3.6.3</li>\n<li><strong>Bazel version (if compiling from source)</strong>:</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>:</li>\n<li><strong>CUDA/cuDNN version</strong>: None</li>\n<li><strong>GPU model and memory</strong>: Doesn't apply</li>\n<li><strong>Exact command to reproduce</strong>: See below</li>\n</ul>\n<h3>Describe the problem</h3>\n<p><code>tf.nn.leaky_relu</code> does not work with float64. It only seems to work with float32. I can't think of a reason why it should not work with float64, so I consider this a bug, your mileage might vary. I'm also not familiar enough with tf code to fix it myself without any help. :-)</p>\n<p>It seems at least <a href=\"https://github.com/tensorflow/tensorflow/blob/r1.4/tensorflow/python/framework/ops.py#L926\">ops.py#L926</a> should be in a <code>try</code> block just as <a href=\"https://github.com/tensorflow/tensorflow/blob/r1.4/tensorflow/python/framework/ops.py#L912\">ops.py#L912</a></p>\n<p>Also the unit tests only test float32.</p>\n<h3>Source code / logs</h3>\n<pre><code>In [1]: import tensorflow as tf\n/usr/lib64/python3.6/importlib/_bootstrap.py:219: RuntimeWarning: compiletime version 3.5 of module 'tensorflow.python.framework.fast_tensor_util' does not match runtime version 3.6\n  return f(*args, **kwds)\n\nIn [2]: c = tf.constant(5.0, dtype=tf.float32)\n\nIn [3]: lr = tf.nn.leaky_relu(c)\n\nIn [4]: c = tf.constant(5.0, dtype=tf.float64)\n\nIn [5]: lr = tf.nn.leaky_relu(c)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n&lt;ipython-input-5-71e83d060e7b&gt; in &lt;module&gt;()\n----&gt; 1 lr = tf.nn.leaky_relu(c)\n\n~/.emacs.d/.python-environments/jedi/lib/python3.6/site-packages/tensorflow/python/ops/nn_ops.py in leaky_relu(features, alpha, name)\n   1541     features = ops.convert_to_tensor(features, name=\"features\")\n   1542     alpha = ops.convert_to_tensor(alpha, name=\"alpha\")\n-&gt; 1543     return math_ops.maximum(alpha * features, features)\n   1544 \n   1545 \n\n~/.emacs.d/.python-environments/jedi/lib/python3.6/site-packages/tensorflow/python/ops/math_ops.py in binary_op_wrapper(x, y)\n    883       if not isinstance(y, sparse_tensor.SparseTensor):\n    884         try:\n--&gt; 885           y = ops.convert_to_tensor(y, dtype=x.dtype.base_dtype, name=\"y\")\n    886         except TypeError:\n    887           # If the RHS is not a tensor, it might be a tensor aware object\n\n~/.emacs.d/.python-environments/jedi/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in convert_to_tensor(value, dtype, name, preferred_dtype)\n    834       name=name,\n    835       preferred_dtype=preferred_dtype,\n--&gt; 836       as_ref=False)\n    837 \n    838 \n\n~/.emacs.d/.python-environments/jedi/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in internal_convert_to_tensor(value, dtype, name, as_ref, preferred_dtype, ctx)\n    924 \n    925     if ret is None:\n--&gt; 926       ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n    927 \n    928     if ret is NotImplemented:\n\n~/.emacs.d/.python-environments/jedi/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in _TensorTensorConversionFunction(t, dtype, name, as_ref)\n    772     raise ValueError(\n    773         \"Tensor conversion requested dtype %s for Tensor with dtype %s: %r\" %\n--&gt; 774         (dtype.name, t.dtype.name, str(t)))\n    775   return t\n    776 \n\nValueError: Tensor conversion requested dtype float32 for Tensor with dtype float64: 'Tensor(\"Const_1:0\", shape=(), dtype=float64)'\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes, see below\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Fedora 26\nTensorFlow installed from (source or binary): binary, pip3 install tensorflow\nTensorFlow version (use command below): v1.4.0-19-ga52c8d9 1.4.1\nPython version: Python 3.6.3\nBazel version (if compiling from source):\nGCC/Compiler version (if compiling from source):\nCUDA/cuDNN version: None\nGPU model and memory: Doesn't apply\nExact command to reproduce: See below\n\nDescribe the problem\ntf.nn.leaky_relu does not work with float64. It only seems to work with float32. I can't think of a reason why it should not work with float64, so I consider this a bug, your mileage might vary. I'm also not familiar enough with tf code to fix it myself without any help. :-)\nIt seems at least ops.py#L926 should be in a try block just as ops.py#L912\nAlso the unit tests only test float32.\nSource code / logs\nIn [1]: import tensorflow as tf\n/usr/lib64/python3.6/importlib/_bootstrap.py:219: RuntimeWarning: compiletime version 3.5 of module 'tensorflow.python.framework.fast_tensor_util' does not match runtime version 3.6\n  return f(*args, **kwds)\n\nIn [2]: c = tf.constant(5.0, dtype=tf.float32)\n\nIn [3]: lr = tf.nn.leaky_relu(c)\n\nIn [4]: c = tf.constant(5.0, dtype=tf.float64)\n\nIn [5]: lr = tf.nn.leaky_relu(c)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-5-71e83d060e7b> in <module>()\n----> 1 lr = tf.nn.leaky_relu(c)\n\n~/.emacs.d/.python-environments/jedi/lib/python3.6/site-packages/tensorflow/python/ops/nn_ops.py in leaky_relu(features, alpha, name)\n   1541     features = ops.convert_to_tensor(features, name=\"features\")\n   1542     alpha = ops.convert_to_tensor(alpha, name=\"alpha\")\n-> 1543     return math_ops.maximum(alpha * features, features)\n   1544 \n   1545 \n\n~/.emacs.d/.python-environments/jedi/lib/python3.6/site-packages/tensorflow/python/ops/math_ops.py in binary_op_wrapper(x, y)\n    883       if not isinstance(y, sparse_tensor.SparseTensor):\n    884         try:\n--> 885           y = ops.convert_to_tensor(y, dtype=x.dtype.base_dtype, name=\"y\")\n    886         except TypeError:\n    887           # If the RHS is not a tensor, it might be a tensor aware object\n\n~/.emacs.d/.python-environments/jedi/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in convert_to_tensor(value, dtype, name, preferred_dtype)\n    834       name=name,\n    835       preferred_dtype=preferred_dtype,\n--> 836       as_ref=False)\n    837 \n    838 \n\n~/.emacs.d/.python-environments/jedi/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in internal_convert_to_tensor(value, dtype, name, as_ref, preferred_dtype, ctx)\n    924 \n    925     if ret is None:\n--> 926       ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n    927 \n    928     if ret is NotImplemented:\n\n~/.emacs.d/.python-environments/jedi/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in _TensorTensorConversionFunction(t, dtype, name, as_ref)\n    772     raise ValueError(\n    773         \"Tensor conversion requested dtype %s for Tensor with dtype %s: %r\" %\n--> 774         (dtype.name, t.dtype.name, str(t)))\n    775   return t\n    776 \n\nValueError: Tensor conversion requested dtype float32 for Tensor with dtype float64: 'Tensor(\"Const_1:0\", shape=(), dtype=float64)'", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: Yes, see below\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Fedora 26\r\n- **TensorFlow installed from (source or binary)**: binary, pip3 install tensorflow\r\n- **TensorFlow version (use command below)**: v1.4.0-19-ga52c8d9 1.4.1\r\n- **Python version**: Python 3.6.3\r\n- **Bazel version (if compiling from source)**:\r\n- **GCC/Compiler version (if compiling from source)**:\r\n- **CUDA/cuDNN version**: None\r\n- **GPU model and memory**: Doesn't apply\r\n- **Exact command to reproduce**: See below\r\n\r\n### Describe the problem\r\n\r\n`tf.nn.leaky_relu` does not work with float64. It only seems to work with float32. I can't think of a reason why it should not work with float64, so I consider this a bug, your mileage might vary. I'm also not familiar enough with tf code to fix it myself without any help. :-)\r\n\r\nIt seems at least [ops.py#L926](https://github.com/tensorflow/tensorflow/blob/r1.4/tensorflow/python/framework/ops.py#L926) should be in a `try` block just as [ops.py#L912](https://github.com/tensorflow/tensorflow/blob/r1.4/tensorflow/python/framework/ops.py#L912)\r\n\r\nAlso the unit tests only test float32.\r\n\r\n### Source code / logs\r\n\r\n```\r\nIn [1]: import tensorflow as tf\r\n/usr/lib64/python3.6/importlib/_bootstrap.py:219: RuntimeWarning: compiletime version 3.5 of module 'tensorflow.python.framework.fast_tensor_util' does not match runtime version 3.6\r\n  return f(*args, **kwds)\r\n\r\nIn [2]: c = tf.constant(5.0, dtype=tf.float32)\r\n\r\nIn [3]: lr = tf.nn.leaky_relu(c)\r\n\r\nIn [4]: c = tf.constant(5.0, dtype=tf.float64)\r\n\r\nIn [5]: lr = tf.nn.leaky_relu(c)\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-5-71e83d060e7b> in <module>()\r\n----> 1 lr = tf.nn.leaky_relu(c)\r\n\r\n~/.emacs.d/.python-environments/jedi/lib/python3.6/site-packages/tensorflow/python/ops/nn_ops.py in leaky_relu(features, alpha, name)\r\n   1541     features = ops.convert_to_tensor(features, name=\"features\")\r\n   1542     alpha = ops.convert_to_tensor(alpha, name=\"alpha\")\r\n-> 1543     return math_ops.maximum(alpha * features, features)\r\n   1544 \r\n   1545 \r\n\r\n~/.emacs.d/.python-environments/jedi/lib/python3.6/site-packages/tensorflow/python/ops/math_ops.py in binary_op_wrapper(x, y)\r\n    883       if not isinstance(y, sparse_tensor.SparseTensor):\r\n    884         try:\r\n--> 885           y = ops.convert_to_tensor(y, dtype=x.dtype.base_dtype, name=\"y\")\r\n    886         except TypeError:\r\n    887           # If the RHS is not a tensor, it might be a tensor aware object\r\n\r\n~/.emacs.d/.python-environments/jedi/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in convert_to_tensor(value, dtype, name, preferred_dtype)\r\n    834       name=name,\r\n    835       preferred_dtype=preferred_dtype,\r\n--> 836       as_ref=False)\r\n    837 \r\n    838 \r\n\r\n~/.emacs.d/.python-environments/jedi/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in internal_convert_to_tensor(value, dtype, name, as_ref, preferred_dtype, ctx)\r\n    924 \r\n    925     if ret is None:\r\n--> 926       ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\r\n    927 \r\n    928     if ret is NotImplemented:\r\n\r\n~/.emacs.d/.python-environments/jedi/lib/python3.6/site-packages/tensorflow/python/framework/ops.py in _TensorTensorConversionFunction(t, dtype, name, as_ref)\r\n    772     raise ValueError(\r\n    773         \"Tensor conversion requested dtype %s for Tensor with dtype %s: %r\" %\r\n--> 774         (dtype.name, t.dtype.name, str(t)))\r\n    775   return t\r\n    776 \r\n\r\nValueError: Tensor conversion requested dtype float32 for Tensor with dtype float64: 'Tensor(\"Const_1:0\", shape=(), dtype=float64)'\r\n```"}