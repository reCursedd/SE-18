{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/289118578", "html_url": "https://github.com/tensorflow/tensorflow/issues/8536#issuecomment-289118578", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8536", "id": 289118578, "node_id": "MDEyOklzc3VlQ29tbWVudDI4OTExODU3OA==", "user": {"login": "kirk86", "id": 2902390, "node_id": "MDQ6VXNlcjI5MDIzOTA=", "avatar_url": "https://avatars0.githubusercontent.com/u/2902390?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kirk86", "html_url": "https://github.com/kirk86", "followers_url": "https://api.github.com/users/kirk86/followers", "following_url": "https://api.github.com/users/kirk86/following{/other_user}", "gists_url": "https://api.github.com/users/kirk86/gists{/gist_id}", "starred_url": "https://api.github.com/users/kirk86/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kirk86/subscriptions", "organizations_url": "https://api.github.com/users/kirk86/orgs", "repos_url": "https://api.github.com/users/kirk86/repos", "events_url": "https://api.github.com/users/kirk86/events{/privacy}", "received_events_url": "https://api.github.com/users/kirk86/received_events", "type": "User", "site_admin": false}, "created_at": "2017-03-24T19:13:23Z", "updated_at": "2017-03-24T19:13:23Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=88808\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/skye\">@skye</a> hello, so I've created a gist with an example <a href=\"https://gist.github.com/kirk86/99211bd0ea3489915738701285c58c30\">https://gist.github.com/kirk86/99211bd0ea3489915738701285c58c30</a>. The example works fine on cpu but on a gpu with 12GB ram it gives me error exhausted message even when I reduce the batch_size to 1.</p>\n<p>Here's the output message that I get:</p>\n<pre><code>ResourceExhaustedErrorTraceback (most recent call last)\n/output/run.py in &lt;module&gt;()\n     40     model.fit(trX, [np.expand_dims(trX_mask[:, :, :, 0], axis=3), trY], batch_size=1, nb_epoch=40,\n     41               shuffle=True, validation_data=(valX, [np.expand_dims(valX_mask[:, :, :, 0], axis=3), valY]),\n---&gt; 42               verbose=1)\n     43     # classes = {0: 'ALB', 1: 'BET', 2: 'DOL', 3: 'LAG', 4: 'NoF',\n     44     #            5: 'OTHER', 6: 'SHARK', 7: 'YFT'}\n\n/usr/local/lib/python2.7/site-packages/keras/engine/training.pyc in fit(self, x, y, batch_size, nb_epoch, verbose, callbacks, validation_split, validation_data, shuffle, class_weight, sample_weight, initial_epoch)\n   1194                               val_f=val_f, val_ins=val_ins, shuffle=shuffle,\n   1195                               callback_metrics=callback_metrics,\n-&gt; 1196                               initial_epoch=initial_epoch)\n   1197 \n   1198     def evaluate(self, x, y, batch_size=32, verbose=1, sample_weight=None):\n\n/usr/local/lib/python2.7/site-packages/keras/engine/training.pyc in _fit_loop(self, f, ins, out_labels, batch_size, nb_epoch, verbose, callbacks, val_f, val_ins, shuffle, callback_metrics, initial_epoch)\n    889                 batch_logs['size'] = len(batch_ids)\n    890                 callbacks.on_batch_begin(batch_index, batch_logs)\n--&gt; 891                 outs = f(ins_batch)\n    892                 if not isinstance(outs, list):\n    893                     outs = [outs]\n\n/usr/local/lib/python2.7/site-packages/keras/backend/tensorflow_backend.pyc in __call__(self, inputs)\n   1939                 value = (indices, sparse_coo.data, sparse_coo.shape)\n   1940             feed_dict[tensor] = value\n-&gt; 1941         session = get_session()\n   1942         updated = session.run(self.outputs + [self.updates_op],\n   1943                               feed_dict=feed_dict)\n\n/usr/local/lib/python2.7/site-packages/keras/backend/tensorflow_backend.pyc in get_session()\n    123         session = _SESSION\n    124     if not _MANUAL_VAR_INIT:\n--&gt; 125         _initialize_variables()\n    126     return session\n    127 \n\n/usr/local/lib/python2.7/site-packages/keras/backend/tensorflow_backend.pyc in _initialize_variables()\n    280         sess = get_session()\n    281         if hasattr(tf, 'variables_initializer'):\n--&gt; 282             sess.run(tf.variables_initializer(uninitialized_variables))\n    283         else:\n    284             sess.run(tf.initialize_variables(uninitialized_variables))\n\n/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in run(self, fetches, feed_dict, options, run_metadata)\n    765     try:\n    766       result = self._run(None, fetches, feed_dict, options_ptr,\n--&gt; 767                          run_metadata_ptr)\n    768       if run_metadata:\n    769         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)\n\n/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in _run(self, handle, fetches, feed_dict, options, run_metadata)\n    963     if final_fetches or final_targets:\n    964       results = self._do_run(handle, final_targets, final_fetches,\n--&gt; 965                              feed_dict_string, options, run_metadata)\n    966     else:\n    967       results = []\n\n/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)\n   1013     if handle is None:\n   1014       return self._do_call(_run_fn, self._session, feed_dict, fetch_list,\n-&gt; 1015                            target_list, options, run_metadata)\n   1016     else:\n   1017       return self._do_call(_prun_fn, self._session, handle, feed_dict,\n\n/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in _do_call(self, fn, *args)\n   1033         except KeyError:\n   1034           pass\n-&gt; 1035       raise type(e)(node_def, op, message)\n   1036 \n   1037   def _extend_graph(self):\n\nResourceExhaustedError: OOM when allocating tensor with shape[8388608,64]\n\t [[Node: random_uniform_28 = Add[T=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](random_uniform_28/mul, random_uniform_28/min)]]\n\nCaused by op u'random_uniform_28', defined at:\n  File \"/usr/local/lib/python2.7/runpy.py\", line 174, in _run_module_as_main\n    \"__main__\", fname, loader, pkg_name)\n  File \"/usr/local/lib/python2.7/runpy.py\", line 72, in _run_code\n    exec code in run_globals\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/__main__.py\", line 3, in &lt;module&gt;\n    app.launch_new_instance()\n  File \"/usr/local/lib/python2.7/site-packages/traitlets/config/application.py\", line 658, in launch_instance\n    app.start()\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/kernelapp.py\", line 474, in start\n    ioloop.IOLoop.instance().start()\n  File \"/usr/local/lib/python2.7/site-packages/zmq/eventloop/ioloop.py\", line 177, in start\n    super(ZMQIOLoop, self).start()\n  File \"/usr/local/lib/python2.7/site-packages/tornado/ioloop.py\", line 887, in start\n    handler_func(fd_obj, events)\n  File \"/usr/local/lib/python2.7/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\n    return fn(*args, **kwargs)\n  File \"/usr/local/lib/python2.7/site-packages/zmq/eventloop/zmqstream.py\", line 440, in _handle_events\n    self._handle_recv()\n  File \"/usr/local/lib/python2.7/site-packages/zmq/eventloop/zmqstream.py\", line 472, in _handle_recv\n    self._run_callback(callback, msg)\n  File \"/usr/local/lib/python2.7/site-packages/zmq/eventloop/zmqstream.py\", line 414, in _run_callback\n    callback(*args, **kwargs)\n  File \"/usr/local/lib/python2.7/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\n    return fn(*args, **kwargs)\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/kernelbase.py\", line 276, in dispatcher\n    return self.dispatch_shell(stream, msg)\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/kernelbase.py\", line 228, in dispatch_shell\n    handler(stream, idents, msg)\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/kernelbase.py\", line 390, in execute_request\n    user_expressions, allow_stdin)\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/ipkernel.py\", line 196, in do_execute\n    res = shell.run_cell(code, store_history=store_history, silent=silent)\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/zmqshell.py\", line 501, in run_cell\n    return super(ZMQInteractiveShell, self).run_cell(*args, **kwargs)\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2717, in run_cell\n    interactivity=interactivity, compiler=compiler, result=result)\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2827, in run_ast_nodes\n    if self.run_code(code, result):\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2881, in run_code\n    exec(code_obj, self.user_global_ns, self.user_ns)\n  File \"&lt;ipython-input-1-285366c3fbbf&gt;\", line 1, in &lt;module&gt;\n    get_ipython().magic(u'run -i run.py')\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2158, in magic\n    return self.run_line_magic(magic_name, magic_arg_s)\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2079, in run_line_magic\n    result = fn(*args,**kwargs)\n  File \"&lt;decorator-gen-57&gt;\", line 2, in run\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/magic.py\", line 188, in &lt;lambda&gt;\n    call = lambda f, *a, **k: f(*a, **k)\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/magics/execution.py\", line 742, in run\n    run()\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/magics/execution.py\", line 728, in run\n    exit_ignore=exit_ignore)\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2481, in safe_execfile\n    self.compile if kw['shell_futures'] else None)\n  File \"/usr/local/lib/python2.7/site-packages/IPython/utils/py3compat.py\", line 289, in execfile\n    builtin_mod.execfile(filename, *where)\n  File \"/output/run.py\", line 39, in &lt;module&gt;\n    model = unet((512, 512, 3))\n  File \"/output/unet.py\", line 203, in unet\n    dense1 = Dense(64, activation='relu', name='fc1')(flat)\n  File \"/usr/local/lib/python2.7/site-packages/keras/engine/topology.py\", line 546, in __call__\n    self.build(input_shapes[0])\n  File \"/usr/local/lib/python2.7/site-packages/keras/layers/core.py\", line 798, in build\n    constraint=self.W_constraint)\n  File \"/usr/local/lib/python2.7/site-packages/keras/engine/topology.py\", line 418, in add_weight\n    weight = initializer(shape, name=name)\n  File \"/usr/local/lib/python2.7/site-packages/keras/initializations.py\", line 66, in glorot_uniform\n    return uniform(shape, s, name=name)\n  File \"/usr/local/lib/python2.7/site-packages/keras/initializations.py\", line 33, in uniform\n    return K.random_uniform_variable(shape, -scale, scale, name=name)\n  File \"/usr/local/lib/python2.7/site-packages/keras/backend/tensorflow_backend.py\", line 634, in random_uniform_variable\n    low, high, dtype=tf_dtype, seed=seed)(shape)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/init_ops.py\", line 180, in __call__\n    dtype, seed=self.seed)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/random_ops.py\", line 246, in random_uniform\n    return math_ops.add(rnd * (maxval - minval), minval, name=name)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 73, in add\n    result = _op_def_lib.apply_op(\"Add\", x=x, y=y, name=name)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2395, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\n    self._traceback = _extract_stack()\n\nResourceExhaustedError (see above for traceback): OOM when allocating tensor with shape[8388608,64]\n\t [[Node: random_uniform_28 = Add[T=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](random_uniform_28/mul, random_uniform_28/min)]]\n</code></pre>", "body_text": "@skye hello, so I've created a gist with an example https://gist.github.com/kirk86/99211bd0ea3489915738701285c58c30. The example works fine on cpu but on a gpu with 12GB ram it gives me error exhausted message even when I reduce the batch_size to 1.\nHere's the output message that I get:\nResourceExhaustedErrorTraceback (most recent call last)\n/output/run.py in <module>()\n     40     model.fit(trX, [np.expand_dims(trX_mask[:, :, :, 0], axis=3), trY], batch_size=1, nb_epoch=40,\n     41               shuffle=True, validation_data=(valX, [np.expand_dims(valX_mask[:, :, :, 0], axis=3), valY]),\n---> 42               verbose=1)\n     43     # classes = {0: 'ALB', 1: 'BET', 2: 'DOL', 3: 'LAG', 4: 'NoF',\n     44     #            5: 'OTHER', 6: 'SHARK', 7: 'YFT'}\n\n/usr/local/lib/python2.7/site-packages/keras/engine/training.pyc in fit(self, x, y, batch_size, nb_epoch, verbose, callbacks, validation_split, validation_data, shuffle, class_weight, sample_weight, initial_epoch)\n   1194                               val_f=val_f, val_ins=val_ins, shuffle=shuffle,\n   1195                               callback_metrics=callback_metrics,\n-> 1196                               initial_epoch=initial_epoch)\n   1197 \n   1198     def evaluate(self, x, y, batch_size=32, verbose=1, sample_weight=None):\n\n/usr/local/lib/python2.7/site-packages/keras/engine/training.pyc in _fit_loop(self, f, ins, out_labels, batch_size, nb_epoch, verbose, callbacks, val_f, val_ins, shuffle, callback_metrics, initial_epoch)\n    889                 batch_logs['size'] = len(batch_ids)\n    890                 callbacks.on_batch_begin(batch_index, batch_logs)\n--> 891                 outs = f(ins_batch)\n    892                 if not isinstance(outs, list):\n    893                     outs = [outs]\n\n/usr/local/lib/python2.7/site-packages/keras/backend/tensorflow_backend.pyc in __call__(self, inputs)\n   1939                 value = (indices, sparse_coo.data, sparse_coo.shape)\n   1940             feed_dict[tensor] = value\n-> 1941         session = get_session()\n   1942         updated = session.run(self.outputs + [self.updates_op],\n   1943                               feed_dict=feed_dict)\n\n/usr/local/lib/python2.7/site-packages/keras/backend/tensorflow_backend.pyc in get_session()\n    123         session = _SESSION\n    124     if not _MANUAL_VAR_INIT:\n--> 125         _initialize_variables()\n    126     return session\n    127 \n\n/usr/local/lib/python2.7/site-packages/keras/backend/tensorflow_backend.pyc in _initialize_variables()\n    280         sess = get_session()\n    281         if hasattr(tf, 'variables_initializer'):\n--> 282             sess.run(tf.variables_initializer(uninitialized_variables))\n    283         else:\n    284             sess.run(tf.initialize_variables(uninitialized_variables))\n\n/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in run(self, fetches, feed_dict, options, run_metadata)\n    765     try:\n    766       result = self._run(None, fetches, feed_dict, options_ptr,\n--> 767                          run_metadata_ptr)\n    768       if run_metadata:\n    769         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)\n\n/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in _run(self, handle, fetches, feed_dict, options, run_metadata)\n    963     if final_fetches or final_targets:\n    964       results = self._do_run(handle, final_targets, final_fetches,\n--> 965                              feed_dict_string, options, run_metadata)\n    966     else:\n    967       results = []\n\n/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)\n   1013     if handle is None:\n   1014       return self._do_call(_run_fn, self._session, feed_dict, fetch_list,\n-> 1015                            target_list, options, run_metadata)\n   1016     else:\n   1017       return self._do_call(_prun_fn, self._session, handle, feed_dict,\n\n/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in _do_call(self, fn, *args)\n   1033         except KeyError:\n   1034           pass\n-> 1035       raise type(e)(node_def, op, message)\n   1036 \n   1037   def _extend_graph(self):\n\nResourceExhaustedError: OOM when allocating tensor with shape[8388608,64]\n\t [[Node: random_uniform_28 = Add[T=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](random_uniform_28/mul, random_uniform_28/min)]]\n\nCaused by op u'random_uniform_28', defined at:\n  File \"/usr/local/lib/python2.7/runpy.py\", line 174, in _run_module_as_main\n    \"__main__\", fname, loader, pkg_name)\n  File \"/usr/local/lib/python2.7/runpy.py\", line 72, in _run_code\n    exec code in run_globals\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/__main__.py\", line 3, in <module>\n    app.launch_new_instance()\n  File \"/usr/local/lib/python2.7/site-packages/traitlets/config/application.py\", line 658, in launch_instance\n    app.start()\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/kernelapp.py\", line 474, in start\n    ioloop.IOLoop.instance().start()\n  File \"/usr/local/lib/python2.7/site-packages/zmq/eventloop/ioloop.py\", line 177, in start\n    super(ZMQIOLoop, self).start()\n  File \"/usr/local/lib/python2.7/site-packages/tornado/ioloop.py\", line 887, in start\n    handler_func(fd_obj, events)\n  File \"/usr/local/lib/python2.7/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\n    return fn(*args, **kwargs)\n  File \"/usr/local/lib/python2.7/site-packages/zmq/eventloop/zmqstream.py\", line 440, in _handle_events\n    self._handle_recv()\n  File \"/usr/local/lib/python2.7/site-packages/zmq/eventloop/zmqstream.py\", line 472, in _handle_recv\n    self._run_callback(callback, msg)\n  File \"/usr/local/lib/python2.7/site-packages/zmq/eventloop/zmqstream.py\", line 414, in _run_callback\n    callback(*args, **kwargs)\n  File \"/usr/local/lib/python2.7/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\n    return fn(*args, **kwargs)\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/kernelbase.py\", line 276, in dispatcher\n    return self.dispatch_shell(stream, msg)\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/kernelbase.py\", line 228, in dispatch_shell\n    handler(stream, idents, msg)\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/kernelbase.py\", line 390, in execute_request\n    user_expressions, allow_stdin)\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/ipkernel.py\", line 196, in do_execute\n    res = shell.run_cell(code, store_history=store_history, silent=silent)\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/zmqshell.py\", line 501, in run_cell\n    return super(ZMQInteractiveShell, self).run_cell(*args, **kwargs)\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2717, in run_cell\n    interactivity=interactivity, compiler=compiler, result=result)\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2827, in run_ast_nodes\n    if self.run_code(code, result):\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2881, in run_code\n    exec(code_obj, self.user_global_ns, self.user_ns)\n  File \"<ipython-input-1-285366c3fbbf>\", line 1, in <module>\n    get_ipython().magic(u'run -i run.py')\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2158, in magic\n    return self.run_line_magic(magic_name, magic_arg_s)\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2079, in run_line_magic\n    result = fn(*args,**kwargs)\n  File \"<decorator-gen-57>\", line 2, in run\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/magic.py\", line 188, in <lambda>\n    call = lambda f, *a, **k: f(*a, **k)\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/magics/execution.py\", line 742, in run\n    run()\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/magics/execution.py\", line 728, in run\n    exit_ignore=exit_ignore)\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2481, in safe_execfile\n    self.compile if kw['shell_futures'] else None)\n  File \"/usr/local/lib/python2.7/site-packages/IPython/utils/py3compat.py\", line 289, in execfile\n    builtin_mod.execfile(filename, *where)\n  File \"/output/run.py\", line 39, in <module>\n    model = unet((512, 512, 3))\n  File \"/output/unet.py\", line 203, in unet\n    dense1 = Dense(64, activation='relu', name='fc1')(flat)\n  File \"/usr/local/lib/python2.7/site-packages/keras/engine/topology.py\", line 546, in __call__\n    self.build(input_shapes[0])\n  File \"/usr/local/lib/python2.7/site-packages/keras/layers/core.py\", line 798, in build\n    constraint=self.W_constraint)\n  File \"/usr/local/lib/python2.7/site-packages/keras/engine/topology.py\", line 418, in add_weight\n    weight = initializer(shape, name=name)\n  File \"/usr/local/lib/python2.7/site-packages/keras/initializations.py\", line 66, in glorot_uniform\n    return uniform(shape, s, name=name)\n  File \"/usr/local/lib/python2.7/site-packages/keras/initializations.py\", line 33, in uniform\n    return K.random_uniform_variable(shape, -scale, scale, name=name)\n  File \"/usr/local/lib/python2.7/site-packages/keras/backend/tensorflow_backend.py\", line 634, in random_uniform_variable\n    low, high, dtype=tf_dtype, seed=seed)(shape)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/init_ops.py\", line 180, in __call__\n    dtype, seed=self.seed)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/random_ops.py\", line 246, in random_uniform\n    return math_ops.add(rnd * (maxval - minval), minval, name=name)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 73, in add\n    result = _op_def_lib.apply_op(\"Add\", x=x, y=y, name=name)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2395, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\n    self._traceback = _extract_stack()\n\nResourceExhaustedError (see above for traceback): OOM when allocating tensor with shape[8388608,64]\n\t [[Node: random_uniform_28 = Add[T=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](random_uniform_28/mul, random_uniform_28/min)]]", "body": "@skye hello, so I've created a gist with an example https://gist.github.com/kirk86/99211bd0ea3489915738701285c58c30. The example works fine on cpu but on a gpu with 12GB ram it gives me error exhausted message even when I reduce the batch_size to 1.\r\n\r\nHere's the output message that I get:\r\n\r\n```\r\nResourceExhaustedErrorTraceback (most recent call last)\r\n/output/run.py in <module>()\r\n     40     model.fit(trX, [np.expand_dims(trX_mask[:, :, :, 0], axis=3), trY], batch_size=1, nb_epoch=40,\r\n     41               shuffle=True, validation_data=(valX, [np.expand_dims(valX_mask[:, :, :, 0], axis=3), valY]),\r\n---> 42               verbose=1)\r\n     43     # classes = {0: 'ALB', 1: 'BET', 2: 'DOL', 3: 'LAG', 4: 'NoF',\r\n     44     #            5: 'OTHER', 6: 'SHARK', 7: 'YFT'}\r\n\r\n/usr/local/lib/python2.7/site-packages/keras/engine/training.pyc in fit(self, x, y, batch_size, nb_epoch, verbose, callbacks, validation_split, validation_data, shuffle, class_weight, sample_weight, initial_epoch)\r\n   1194                               val_f=val_f, val_ins=val_ins, shuffle=shuffle,\r\n   1195                               callback_metrics=callback_metrics,\r\n-> 1196                               initial_epoch=initial_epoch)\r\n   1197 \r\n   1198     def evaluate(self, x, y, batch_size=32, verbose=1, sample_weight=None):\r\n\r\n/usr/local/lib/python2.7/site-packages/keras/engine/training.pyc in _fit_loop(self, f, ins, out_labels, batch_size, nb_epoch, verbose, callbacks, val_f, val_ins, shuffle, callback_metrics, initial_epoch)\r\n    889                 batch_logs['size'] = len(batch_ids)\r\n    890                 callbacks.on_batch_begin(batch_index, batch_logs)\r\n--> 891                 outs = f(ins_batch)\r\n    892                 if not isinstance(outs, list):\r\n    893                     outs = [outs]\r\n\r\n/usr/local/lib/python2.7/site-packages/keras/backend/tensorflow_backend.pyc in __call__(self, inputs)\r\n   1939                 value = (indices, sparse_coo.data, sparse_coo.shape)\r\n   1940             feed_dict[tensor] = value\r\n-> 1941         session = get_session()\r\n   1942         updated = session.run(self.outputs + [self.updates_op],\r\n   1943                               feed_dict=feed_dict)\r\n\r\n/usr/local/lib/python2.7/site-packages/keras/backend/tensorflow_backend.pyc in get_session()\r\n    123         session = _SESSION\r\n    124     if not _MANUAL_VAR_INIT:\r\n--> 125         _initialize_variables()\r\n    126     return session\r\n    127 \r\n\r\n/usr/local/lib/python2.7/site-packages/keras/backend/tensorflow_backend.pyc in _initialize_variables()\r\n    280         sess = get_session()\r\n    281         if hasattr(tf, 'variables_initializer'):\r\n--> 282             sess.run(tf.variables_initializer(uninitialized_variables))\r\n    283         else:\r\n    284             sess.run(tf.initialize_variables(uninitialized_variables))\r\n\r\n/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in run(self, fetches, feed_dict, options, run_metadata)\r\n    765     try:\r\n    766       result = self._run(None, fetches, feed_dict, options_ptr,\r\n--> 767                          run_metadata_ptr)\r\n    768       if run_metadata:\r\n    769         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)\r\n\r\n/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in _run(self, handle, fetches, feed_dict, options, run_metadata)\r\n    963     if final_fetches or final_targets:\r\n    964       results = self._do_run(handle, final_targets, final_fetches,\r\n--> 965                              feed_dict_string, options, run_metadata)\r\n    966     else:\r\n    967       results = []\r\n\r\n/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)\r\n   1013     if handle is None:\r\n   1014       return self._do_call(_run_fn, self._session, feed_dict, fetch_list,\r\n-> 1015                            target_list, options, run_metadata)\r\n   1016     else:\r\n   1017       return self._do_call(_prun_fn, self._session, handle, feed_dict,\r\n\r\n/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.pyc in _do_call(self, fn, *args)\r\n   1033         except KeyError:\r\n   1034           pass\r\n-> 1035       raise type(e)(node_def, op, message)\r\n   1036 \r\n   1037   def _extend_graph(self):\r\n\r\nResourceExhaustedError: OOM when allocating tensor with shape[8388608,64]\r\n\t [[Node: random_uniform_28 = Add[T=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](random_uniform_28/mul, random_uniform_28/min)]]\r\n\r\nCaused by op u'random_uniform_28', defined at:\r\n  File \"/usr/local/lib/python2.7/runpy.py\", line 174, in _run_module_as_main\r\n    \"__main__\", fname, loader, pkg_name)\r\n  File \"/usr/local/lib/python2.7/runpy.py\", line 72, in _run_code\r\n    exec code in run_globals\r\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/__main__.py\", line 3, in <module>\r\n    app.launch_new_instance()\r\n  File \"/usr/local/lib/python2.7/site-packages/traitlets/config/application.py\", line 658, in launch_instance\r\n    app.start()\r\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/kernelapp.py\", line 474, in start\r\n    ioloop.IOLoop.instance().start()\r\n  File \"/usr/local/lib/python2.7/site-packages/zmq/eventloop/ioloop.py\", line 177, in start\r\n    super(ZMQIOLoop, self).start()\r\n  File \"/usr/local/lib/python2.7/site-packages/tornado/ioloop.py\", line 887, in start\r\n    handler_func(fd_obj, events)\r\n  File \"/usr/local/lib/python2.7/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\r\n    return fn(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/zmq/eventloop/zmqstream.py\", line 440, in _handle_events\r\n    self._handle_recv()\r\n  File \"/usr/local/lib/python2.7/site-packages/zmq/eventloop/zmqstream.py\", line 472, in _handle_recv\r\n    self._run_callback(callback, msg)\r\n  File \"/usr/local/lib/python2.7/site-packages/zmq/eventloop/zmqstream.py\", line 414, in _run_callback\r\n    callback(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\r\n    return fn(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/kernelbase.py\", line 276, in dispatcher\r\n    return self.dispatch_shell(stream, msg)\r\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/kernelbase.py\", line 228, in dispatch_shell\r\n    handler(stream, idents, msg)\r\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/kernelbase.py\", line 390, in execute_request\r\n    user_expressions, allow_stdin)\r\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/ipkernel.py\", line 196, in do_execute\r\n    res = shell.run_cell(code, store_history=store_history, silent=silent)\r\n  File \"/usr/local/lib/python2.7/site-packages/ipykernel/zmqshell.py\", line 501, in run_cell\r\n    return super(ZMQInteractiveShell, self).run_cell(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2717, in run_cell\r\n    interactivity=interactivity, compiler=compiler, result=result)\r\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2827, in run_ast_nodes\r\n    if self.run_code(code, result):\r\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2881, in run_code\r\n    exec(code_obj, self.user_global_ns, self.user_ns)\r\n  File \"<ipython-input-1-285366c3fbbf>\", line 1, in <module>\r\n    get_ipython().magic(u'run -i run.py')\r\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2158, in magic\r\n    return self.run_line_magic(magic_name, magic_arg_s)\r\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2079, in run_line_magic\r\n    result = fn(*args,**kwargs)\r\n  File \"<decorator-gen-57>\", line 2, in run\r\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/magic.py\", line 188, in <lambda>\r\n    call = lambda f, *a, **k: f(*a, **k)\r\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/magics/execution.py\", line 742, in run\r\n    run()\r\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/magics/execution.py\", line 728, in run\r\n    exit_ignore=exit_ignore)\r\n  File \"/usr/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2481, in safe_execfile\r\n    self.compile if kw['shell_futures'] else None)\r\n  File \"/usr/local/lib/python2.7/site-packages/IPython/utils/py3compat.py\", line 289, in execfile\r\n    builtin_mod.execfile(filename, *where)\r\n  File \"/output/run.py\", line 39, in <module>\r\n    model = unet((512, 512, 3))\r\n  File \"/output/unet.py\", line 203, in unet\r\n    dense1 = Dense(64, activation='relu', name='fc1')(flat)\r\n  File \"/usr/local/lib/python2.7/site-packages/keras/engine/topology.py\", line 546, in __call__\r\n    self.build(input_shapes[0])\r\n  File \"/usr/local/lib/python2.7/site-packages/keras/layers/core.py\", line 798, in build\r\n    constraint=self.W_constraint)\r\n  File \"/usr/local/lib/python2.7/site-packages/keras/engine/topology.py\", line 418, in add_weight\r\n    weight = initializer(shape, name=name)\r\n  File \"/usr/local/lib/python2.7/site-packages/keras/initializations.py\", line 66, in glorot_uniform\r\n    return uniform(shape, s, name=name)\r\n  File \"/usr/local/lib/python2.7/site-packages/keras/initializations.py\", line 33, in uniform\r\n    return K.random_uniform_variable(shape, -scale, scale, name=name)\r\n  File \"/usr/local/lib/python2.7/site-packages/keras/backend/tensorflow_backend.py\", line 634, in random_uniform_variable\r\n    low, high, dtype=tf_dtype, seed=seed)(shape)\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/init_ops.py\", line 180, in __call__\r\n    dtype, seed=self.seed)\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/random_ops.py\", line 246, in random_uniform\r\n    return math_ops.add(rnd * (maxval - minval), minval, name=name)\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 73, in add\r\n    result = _op_def_lib.apply_op(\"Add\", x=x, y=y, name=name)\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\r\n    op_def=op_def)\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2395, in create_op\r\n    original_op=self._default_original_op, op_def=op_def)\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\r\n    self._traceback = _extract_stack()\r\n\r\nResourceExhaustedError (see above for traceback): OOM when allocating tensor with shape[8388608,64]\r\n\t [[Node: random_uniform_28 = Add[T=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](random_uniform_28/mul, random_uniform_28/min)]]\r\n```"}