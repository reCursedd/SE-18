{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8472", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8472/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8472/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8472/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/8472", "id": 214749656, "node_id": "MDU6SXNzdWUyMTQ3NDk2NTY=", "number": 8472, "title": "multi core cpu issue(server vs local)", "user": {"login": "deeptensorflow", "id": 25359442, "node_id": "MDQ6VXNlcjI1MzU5NDQy", "avatar_url": "https://avatars3.githubusercontent.com/u/25359442?v=4", "gravatar_id": "", "url": "https://api.github.com/users/deeptensorflow", "html_url": "https://github.com/deeptensorflow", "followers_url": "https://api.github.com/users/deeptensorflow/followers", "following_url": "https://api.github.com/users/deeptensorflow/following{/other_user}", "gists_url": "https://api.github.com/users/deeptensorflow/gists{/gist_id}", "starred_url": "https://api.github.com/users/deeptensorflow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/deeptensorflow/subscriptions", "organizations_url": "https://api.github.com/users/deeptensorflow/orgs", "repos_url": "https://api.github.com/users/deeptensorflow/repos", "events_url": "https://api.github.com/users/deeptensorflow/events{/privacy}", "received_events_url": "https://api.github.com/users/deeptensorflow/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-03-16T15:47:31Z", "updated_at": "2017-03-16T16:14:28Z", "closed_at": "2017-03-16T16:14:17Z", "author_association": "NONE", "body_html": "<p>My local computer is mac : i7 quad core 2.2GHz .  (2015 model)<br>\nMy server computer is centos7 : 120-core (8 sockets \u00d7 15cores) Intel Xeon E7-8870<br>\nMy tensorflow version : v1.0.1</p>\n<p>I build tensorflow source with this option :<br>\nbazel build -c opt --copt=-msse4.2 --copt=-msse4.1 --copt=-mavx --copt=-mavx2 --copt=-mfma --config=opt //tensorflow/tools/pip_package:build_pip_package</p>\n<p>With under simple code, my local computer time is 8 seconds and my server computer time is 22 second.<br>\n`<br>\nimport tensorflow as tf<br>\nfrom tensorflow.examples.tutorials.mnist import input_data<br>\nimport time</p>\n<p>mnist = input_data.read_data_sets(\"MNIST_data/\", one_hot=True)</p>\n<p>x = tf.placeholder(tf.float32, [None, 784]);<br>\ny_ = tf.placeholder(tf.float32, [None, 10]);</p>\n<p>W1 = tf.Variable(tf.random_normal([784,240], stddev=0.35));<br>\nW2 = tf.Variable(tf.random_normal([240,120], stddev=0.35));<br>\nW3 = tf.Variable(tf.random_normal([120,10], stddev=0.35));</p>\n<p>b1 = tf.Variable(tf.zeros([240]));<br>\nb2 = tf.Variable(tf.zeros([120]));<br>\nb3 = tf.Variable(tf.zeros([10]));</p>\n<p>y1 = tf.nn.sigmoid(tf.matmul(x,W1)+b1);<br>\ny2 = tf.nn.sigmoid(tf.matmul(y1,W2)+b2);<br>\ny = tf.nn.softmax(tf.matmul(y2,W3)+b3);</p>\n<p>cross_entropy = tf.reduce_mean(-tf.reduce_sum(y_*tf.log(y), reduction_indices=[1]))<br>\ntrain = tf.train.GradientDescentOptimizer(0.5).minimize(cross_entropy)</p>\n<p>NUM_THREADS = 100<br>\nsess = tf.InteractiveSession(config=tf.ConfigProto(intra_op_parallelism_threads=NUM_THREADS))</p>\n<p>tf.global_variables_initializer().run()</p>\n<p>start_time = time.time()</p>\n<p>for _ in range(3000):<br>\nbatch_xs, batch_ys = mnist.train.next_batch(100)<br>\nsess.run(train, feed_dict={x: batch_xs, y_: batch_ys})</p>\n<p>end_time = time.time()<br>\nprint (end_time - start_time)</p>\n<p>correct_prediction = tf.equal(tf.argmax(y, 1), tf.argmax(y_, 1))<br>\naccuracy = tf.reduce_mean(tf.cast(correct_prediction, tf.float32))<br>\nprint(sess.run(accuracy, feed_dict={x: mnist.test.images, y_: mnist.test.labels}))<br>\n`<br>\nI think it is impossible because my server computer have so many cores.<br>\nIsn't it multi-core issue?</p>", "body_text": "My local computer is mac : i7 quad core 2.2GHz .  (2015 model)\nMy server computer is centos7 : 120-core (8 sockets \u00d7 15cores) Intel Xeon E7-8870\nMy tensorflow version : v1.0.1\nI build tensorflow source with this option :\nbazel build -c opt --copt=-msse4.2 --copt=-msse4.1 --copt=-mavx --copt=-mavx2 --copt=-mfma --config=opt //tensorflow/tools/pip_package:build_pip_package\nWith under simple code, my local computer time is 8 seconds and my server computer time is 22 second.\n`\nimport tensorflow as tf\nfrom tensorflow.examples.tutorials.mnist import input_data\nimport time\nmnist = input_data.read_data_sets(\"MNIST_data/\", one_hot=True)\nx = tf.placeholder(tf.float32, [None, 784]);\ny_ = tf.placeholder(tf.float32, [None, 10]);\nW1 = tf.Variable(tf.random_normal([784,240], stddev=0.35));\nW2 = tf.Variable(tf.random_normal([240,120], stddev=0.35));\nW3 = tf.Variable(tf.random_normal([120,10], stddev=0.35));\nb1 = tf.Variable(tf.zeros([240]));\nb2 = tf.Variable(tf.zeros([120]));\nb3 = tf.Variable(tf.zeros([10]));\ny1 = tf.nn.sigmoid(tf.matmul(x,W1)+b1);\ny2 = tf.nn.sigmoid(tf.matmul(y1,W2)+b2);\ny = tf.nn.softmax(tf.matmul(y2,W3)+b3);\ncross_entropy = tf.reduce_mean(-tf.reduce_sum(y_*tf.log(y), reduction_indices=[1]))\ntrain = tf.train.GradientDescentOptimizer(0.5).minimize(cross_entropy)\nNUM_THREADS = 100\nsess = tf.InteractiveSession(config=tf.ConfigProto(intra_op_parallelism_threads=NUM_THREADS))\ntf.global_variables_initializer().run()\nstart_time = time.time()\nfor _ in range(3000):\nbatch_xs, batch_ys = mnist.train.next_batch(100)\nsess.run(train, feed_dict={x: batch_xs, y_: batch_ys})\nend_time = time.time()\nprint (end_time - start_time)\ncorrect_prediction = tf.equal(tf.argmax(y, 1), tf.argmax(y_, 1))\naccuracy = tf.reduce_mean(tf.cast(correct_prediction, tf.float32))\nprint(sess.run(accuracy, feed_dict={x: mnist.test.images, y_: mnist.test.labels}))\n`\nI think it is impossible because my server computer have so many cores.\nIsn't it multi-core issue?", "body": "My local computer is mac : i7 quad core 2.2GHz .  (2015 model)\r\nMy server computer is centos7 : 120-core (8 sockets \u00d7 15cores) Intel Xeon E7-8870\r\nMy tensorflow version : v1.0.1\r\n\r\nI build tensorflow source with this option :\r\nbazel build -c opt --copt=-msse4.2 --copt=-msse4.1 --copt=-mavx --copt=-mavx2 --copt=-mfma --config=opt //tensorflow/tools/pip_package:build_pip_package\r\n\r\nWith under simple code, my local computer time is 8 seconds and my server computer time is 22 second. \r\n`\r\nimport tensorflow as tf\r\nfrom tensorflow.examples.tutorials.mnist import input_data\r\nimport time\r\n\r\nmnist = input_data.read_data_sets(\"MNIST_data/\", one_hot=True)\r\n\r\nx = tf.placeholder(tf.float32, [None, 784]);\r\ny_ = tf.placeholder(tf.float32, [None, 10]);\r\n\r\nW1 = tf.Variable(tf.random_normal([784,240], stddev=0.35));\r\nW2 = tf.Variable(tf.random_normal([240,120], stddev=0.35));\r\nW3 = tf.Variable(tf.random_normal([120,10], stddev=0.35));\r\n\r\nb1 = tf.Variable(tf.zeros([240]));\r\nb2 = tf.Variable(tf.zeros([120]));\r\nb3 = tf.Variable(tf.zeros([10]));\r\n\r\ny1 = tf.nn.sigmoid(tf.matmul(x,W1)+b1);\r\ny2 = tf.nn.sigmoid(tf.matmul(y1,W2)+b2);\r\ny = tf.nn.softmax(tf.matmul(y2,W3)+b3);\r\n\r\ncross_entropy = tf.reduce_mean(-tf.reduce_sum(y_*tf.log(y), reduction_indices=[1]))\r\ntrain = tf.train.GradientDescentOptimizer(0.5).minimize(cross_entropy)\r\n\r\nNUM_THREADS = 100\r\nsess = tf.InteractiveSession(config=tf.ConfigProto(intra_op_parallelism_threads=NUM_THREADS))\r\n\r\ntf.global_variables_initializer().run()\r\n\r\nstart_time = time.time()\r\n\r\nfor _ in range(3000):\r\n    batch_xs, batch_ys = mnist.train.next_batch(100)\r\n    sess.run(train, feed_dict={x: batch_xs, y_: batch_ys})\r\n\r\nend_time = time.time()\r\nprint (end_time - start_time)\r\n\r\ncorrect_prediction = tf.equal(tf.argmax(y, 1), tf.argmax(y_, 1))\r\naccuracy = tf.reduce_mean(tf.cast(correct_prediction, tf.float32))\r\nprint(sess.run(accuracy, feed_dict={x: mnist.test.images, y_: mnist.test.labels}))\r\n`\r\nI think it is impossible because my server computer have so many cores.\r\nIsn't it multi-core issue?"}