{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23032", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23032/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23032/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23032/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23032", "id": 370858621, "node_id": "MDU6SXNzdWUzNzA4NTg2MjE=", "number": 23032, "title": "Multiple gpus (1080Ti) do not speed up training, test on cifar10_estimator code", "user": {"login": "zihuaweng", "id": 13395833, "node_id": "MDQ6VXNlcjEzMzk1ODMz", "avatar_url": "https://avatars3.githubusercontent.com/u/13395833?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zihuaweng", "html_url": "https://github.com/zihuaweng", "followers_url": "https://api.github.com/users/zihuaweng/followers", "following_url": "https://api.github.com/users/zihuaweng/following{/other_user}", "gists_url": "https://api.github.com/users/zihuaweng/gists{/gist_id}", "starred_url": "https://api.github.com/users/zihuaweng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zihuaweng/subscriptions", "organizations_url": "https://api.github.com/users/zihuaweng/orgs", "repos_url": "https://api.github.com/users/zihuaweng/repos", "events_url": "https://api.github.com/users/zihuaweng/events{/privacy}", "received_events_url": "https://api.github.com/users/zihuaweng/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "ymodak", "id": 42785357, "node_id": "MDQ6VXNlcjQyNzg1MzU3", "avatar_url": "https://avatars1.githubusercontent.com/u/42785357?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ymodak", "html_url": "https://github.com/ymodak", "followers_url": "https://api.github.com/users/ymodak/followers", "following_url": "https://api.github.com/users/ymodak/following{/other_user}", "gists_url": "https://api.github.com/users/ymodak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ymodak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ymodak/subscriptions", "organizations_url": "https://api.github.com/users/ymodak/orgs", "repos_url": "https://api.github.com/users/ymodak/repos", "events_url": "https://api.github.com/users/ymodak/events{/privacy}", "received_events_url": "https://api.github.com/users/ymodak/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ymodak", "id": 42785357, "node_id": "MDQ6VXNlcjQyNzg1MzU3", "avatar_url": "https://avatars1.githubusercontent.com/u/42785357?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ymodak", "html_url": "https://github.com/ymodak", "followers_url": "https://api.github.com/users/ymodak/followers", "following_url": "https://api.github.com/users/ymodak/following{/other_user}", "gists_url": "https://api.github.com/users/ymodak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ymodak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ymodak/subscriptions", "organizations_url": "https://api.github.com/users/ymodak/orgs", "repos_url": "https://api.github.com/users/ymodak/repos", "events_url": "https://api.github.com/users/ymodak/events{/privacy}", "received_events_url": "https://api.github.com/users/ymodak/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2018-10-17T01:10:35Z", "updated_at": "2018-10-18T05:59:40Z", "closed_at": "2018-10-18T05:59:40Z", "author_association": "NONE", "body_html": "<p>I was trying to test the performance of multi GPUs version of <a href=\"https://github.com/tensorflow/models/tree/master/tutorials/image/cifar10_estimator\">cifar10_estimator</a> on 2 or 3 1080Ti, but received no speed-up.</p>\n<p>I find some useful information about hardware <a href=\"https://github.com/rossumai/keras-multi-gpu/blob/master/blog/docs/hardware.md\">here</a>, but still confused how to solve it.</p>\n<p>My environment:</p>\n<ul>\n<li>docker image tensorflow/tensorflow:latest-gpu-py3</li>\n<li>Ubuntu VERSION=16.04.5 LTS</li>\n<li>Python3</li>\n<li>CUDA_VERSION=9.0.176</li>\n<li>tensorflow-gpu=1.11.0</li>\n</ul>\n<p>GPU info:</p>\n<pre><code>nvidia-smi topo -m\n\n\tGPU0\tGPU1\tGPU2\tGPU3\tGPU4\tGPU5\tGPU6\tGPU7\tCPU Affinity\nGPU0\t X \tPIX\tPHB\tPHB\tSYS\tSYS\tSYS\tSYS\t0-7\nGPU1\tPIX\t X \tPHB\tPHB\tSYS\tSYS\tSYS\tSYS\t0-7\nGPU2\tPHB\tPHB\t X \tPIX\tSYS\tSYS\tSYS\tSYS\t0-7\nGPU3\tPHB\tPHB\tPIX\t X \tSYS\tSYS\tSYS\tSYS\t0-7\nGPU4\tSYS\tSYS\tSYS\tSYS\t X \tPIX\tPHB\tPHB\t8-15\nGPU5\tSYS\tSYS\tSYS\tSYS\tPIX\t X \tPHB\tPHB\t8-15\nGPU6\tSYS\tSYS\tSYS\tSYS\tPHB\tPHB\t X \tPIX\t8-15\nGPU7\tSYS\tSYS\tSYS\tSYS\tPHB\tPHB\tPIX\t X \t8-15\n\nLegend:\n\n  X    = Self\n  SYS  = Connection traversing PCIe as well as the SMP interconnect between NUMA nodes (e.g., QPI/UPI)\n  NODE = Connection traversing PCIe as well as the interconnect between PCIe Host Bridges within a NUMA node\n  PHB  = Connection traversing PCIe as well as a PCIe Host Bridge (typically the CPU)\n  PXB  = Connection traversing multiple PCIe switches (without traversing the PCIe Host Bridge)\n  PIX  = Connection traversing a single PCIe switch\n  NV#  = Connection traversing a bonded set of # NVLinks\n</code></pre>\n<p>1 gpu bach_size=128</p>\n<pre><code>INFO:tensorflow:loss = 2.2576141, step = 200 (3.729 sec)\nINFO:tensorflow:learning_rate = 0.1, loss = 2.2576141 (3.729 sec)\nINFO:tensorflow:Average examples/sec: 2821.06 (2858.65), step = 200\nINFO:tensorflow:Average examples/sec: 2847.23 (3496.06), step = 210\nINFO:tensorflow:Average examples/sec: 2857.91 (3102.29), step = 220\nINFO:tensorflow:Average examples/sec: 2867.04 (3083.62), step = 230\nINFO:tensorflow:Average examples/sec: 2889.21 (3514.15), step = 240\nINFO:tensorflow:Average examples/sec: 2913.15 (3636.28), step = 250\nINFO:tensorflow:Average examples/sec: 2915.99 (2988.94), step = 260\nINFO:tensorflow:Average examples/sec: 2901.94 (2578.95), step = 270\nINFO:tensorflow:Average examples/sec: 2888.87 (2575.46), step = 280\nINFO:tensorflow:Average examples/sec: 2892.13 (2986.66), step = 290\nINFO:tensorflow:global_step/sec: 24.25\n</code></pre>\n<p>2 gpu bach_size=256</p>\n<pre><code>INFO:tensorflow:loss = 2.4630964, step = 200 (5.971 sec)\nINFO:tensorflow:learning_rate = 0.1, loss = 2.4630964 (5.971 sec)\nINFO:tensorflow:Average examples/sec: 3255.68 (4296.71), step = 200\nINFO:tensorflow:Average examples/sec: 3297.51 (4437.93), step = 210\nINFO:tensorflow:Average examples/sec: 3332.15 (4275.33), step = 220\nINFO:tensorflow:Average examples/sec: 3363.86 (4254.65), step = 230\nINFO:tensorflow:Average examples/sec: 3395.09 (4316.94), step = 240\nINFO:tensorflow:Average examples/sec: 3418.44 (4094.23), step = 250\nINFO:tensorflow:Average examples/sec: 3447.17 (4364.24), step = 260\nINFO:tensorflow:Average examples/sec: 3474.56 (4379.02), step = 270\nINFO:tensorflow:Average examples/sec: 3492.73 (4067.13), step = 280\nINFO:tensorflow:Average examples/sec: 3514.19 (4244.23), step = 290\nINFO:tensorflow:global_step/sec: 16.6026\n</code></pre>\n<p>3 gpu bach_size=384</p>\n<pre><code>INFO:tensorflow:loss = 2.0980535, step = 200 (9.329 sec)\nINFO:tensorflow:learning_rate = 0.1, loss = 2.0980535 (9.329 sec)\nINFO:tensorflow:Average examples/sec: 3214.65 (4165.7), step = 200\nINFO:tensorflow:Average examples/sec: 3272.85 (5130.99), step = 210\nINFO:tensorflow:Average examples/sec: 3324.15 (4955.13), step = 220\nINFO:tensorflow:Average examples/sec: 3376.65 (5174.76), step = 230\nINFO:tensorflow:Average examples/sec: 3425.48 (5132.15), step = 240\nINFO:tensorflow:Average examples/sec: 3468.29 (4954.35), step = 250\nINFO:tensorflow:Average examples/sec: 3509.91 (5014.23), step = 260\nINFO:tensorflow:Average examples/sec: 3544.29 (4755.56), step = 270\nINFO:tensorflow:Average examples/sec: 3579.69 (4901.39), step = 280\nINFO:tensorflow:Average examples/sec: 3617.84 (5156.66), step = 290\nINFO:tensorflow:global_step/sec: 13.1009\n</code></pre>\n<p><a href=\"https://i.stack.imgur.com/yqIZX.png\" rel=\"nofollow\"><img src=\"https://camo.githubusercontent.com/3f544d800b1c2cad3939b1aee103daee2c4cf9f2/68747470733a2f2f692e737461636b2e696d6775722e636f6d2f7971495a582e706e67\" alt=\"enter image description here\" data-canonical-src=\"https://i.stack.imgur.com/yqIZX.png\" style=\"max-width:100%;\"></a></p>", "body_text": "I was trying to test the performance of multi GPUs version of cifar10_estimator on 2 or 3 1080Ti, but received no speed-up.\nI find some useful information about hardware here, but still confused how to solve it.\nMy environment:\n\ndocker image tensorflow/tensorflow:latest-gpu-py3\nUbuntu VERSION=16.04.5 LTS\nPython3\nCUDA_VERSION=9.0.176\ntensorflow-gpu=1.11.0\n\nGPU info:\nnvidia-smi topo -m\n\n\tGPU0\tGPU1\tGPU2\tGPU3\tGPU4\tGPU5\tGPU6\tGPU7\tCPU Affinity\nGPU0\t X \tPIX\tPHB\tPHB\tSYS\tSYS\tSYS\tSYS\t0-7\nGPU1\tPIX\t X \tPHB\tPHB\tSYS\tSYS\tSYS\tSYS\t0-7\nGPU2\tPHB\tPHB\t X \tPIX\tSYS\tSYS\tSYS\tSYS\t0-7\nGPU3\tPHB\tPHB\tPIX\t X \tSYS\tSYS\tSYS\tSYS\t0-7\nGPU4\tSYS\tSYS\tSYS\tSYS\t X \tPIX\tPHB\tPHB\t8-15\nGPU5\tSYS\tSYS\tSYS\tSYS\tPIX\t X \tPHB\tPHB\t8-15\nGPU6\tSYS\tSYS\tSYS\tSYS\tPHB\tPHB\t X \tPIX\t8-15\nGPU7\tSYS\tSYS\tSYS\tSYS\tPHB\tPHB\tPIX\t X \t8-15\n\nLegend:\n\n  X    = Self\n  SYS  = Connection traversing PCIe as well as the SMP interconnect between NUMA nodes (e.g., QPI/UPI)\n  NODE = Connection traversing PCIe as well as the interconnect between PCIe Host Bridges within a NUMA node\n  PHB  = Connection traversing PCIe as well as a PCIe Host Bridge (typically the CPU)\n  PXB  = Connection traversing multiple PCIe switches (without traversing the PCIe Host Bridge)\n  PIX  = Connection traversing a single PCIe switch\n  NV#  = Connection traversing a bonded set of # NVLinks\n\n1 gpu bach_size=128\nINFO:tensorflow:loss = 2.2576141, step = 200 (3.729 sec)\nINFO:tensorflow:learning_rate = 0.1, loss = 2.2576141 (3.729 sec)\nINFO:tensorflow:Average examples/sec: 2821.06 (2858.65), step = 200\nINFO:tensorflow:Average examples/sec: 2847.23 (3496.06), step = 210\nINFO:tensorflow:Average examples/sec: 2857.91 (3102.29), step = 220\nINFO:tensorflow:Average examples/sec: 2867.04 (3083.62), step = 230\nINFO:tensorflow:Average examples/sec: 2889.21 (3514.15), step = 240\nINFO:tensorflow:Average examples/sec: 2913.15 (3636.28), step = 250\nINFO:tensorflow:Average examples/sec: 2915.99 (2988.94), step = 260\nINFO:tensorflow:Average examples/sec: 2901.94 (2578.95), step = 270\nINFO:tensorflow:Average examples/sec: 2888.87 (2575.46), step = 280\nINFO:tensorflow:Average examples/sec: 2892.13 (2986.66), step = 290\nINFO:tensorflow:global_step/sec: 24.25\n\n2 gpu bach_size=256\nINFO:tensorflow:loss = 2.4630964, step = 200 (5.971 sec)\nINFO:tensorflow:learning_rate = 0.1, loss = 2.4630964 (5.971 sec)\nINFO:tensorflow:Average examples/sec: 3255.68 (4296.71), step = 200\nINFO:tensorflow:Average examples/sec: 3297.51 (4437.93), step = 210\nINFO:tensorflow:Average examples/sec: 3332.15 (4275.33), step = 220\nINFO:tensorflow:Average examples/sec: 3363.86 (4254.65), step = 230\nINFO:tensorflow:Average examples/sec: 3395.09 (4316.94), step = 240\nINFO:tensorflow:Average examples/sec: 3418.44 (4094.23), step = 250\nINFO:tensorflow:Average examples/sec: 3447.17 (4364.24), step = 260\nINFO:tensorflow:Average examples/sec: 3474.56 (4379.02), step = 270\nINFO:tensorflow:Average examples/sec: 3492.73 (4067.13), step = 280\nINFO:tensorflow:Average examples/sec: 3514.19 (4244.23), step = 290\nINFO:tensorflow:global_step/sec: 16.6026\n\n3 gpu bach_size=384\nINFO:tensorflow:loss = 2.0980535, step = 200 (9.329 sec)\nINFO:tensorflow:learning_rate = 0.1, loss = 2.0980535 (9.329 sec)\nINFO:tensorflow:Average examples/sec: 3214.65 (4165.7), step = 200\nINFO:tensorflow:Average examples/sec: 3272.85 (5130.99), step = 210\nINFO:tensorflow:Average examples/sec: 3324.15 (4955.13), step = 220\nINFO:tensorflow:Average examples/sec: 3376.65 (5174.76), step = 230\nINFO:tensorflow:Average examples/sec: 3425.48 (5132.15), step = 240\nINFO:tensorflow:Average examples/sec: 3468.29 (4954.35), step = 250\nINFO:tensorflow:Average examples/sec: 3509.91 (5014.23), step = 260\nINFO:tensorflow:Average examples/sec: 3544.29 (4755.56), step = 270\nINFO:tensorflow:Average examples/sec: 3579.69 (4901.39), step = 280\nINFO:tensorflow:Average examples/sec: 3617.84 (5156.66), step = 290\nINFO:tensorflow:global_step/sec: 13.1009", "body": "I was trying to test the performance of multi GPUs version of [cifar10_estimator][1] on 2 or 3 1080Ti, but received no speed-up.\r\n\r\nI find some useful information about hardware [here][2], but still confused how to solve it.\r\n\r\nMy environment:\r\n - docker image tensorflow/tensorflow:latest-gpu-py3\r\n - Ubuntu VERSION=16.04.5 LTS\r\n - Python3\r\n - CUDA_VERSION=9.0.176\r\n - tensorflow-gpu=1.11.0\r\n\r\n\r\nGPU info:\r\n\r\n    nvidia-smi topo -m\r\n    \r\n    \tGPU0\tGPU1\tGPU2\tGPU3\tGPU4\tGPU5\tGPU6\tGPU7\tCPU Affinity\r\n    GPU0\t X \tPIX\tPHB\tPHB\tSYS\tSYS\tSYS\tSYS\t0-7\r\n    GPU1\tPIX\t X \tPHB\tPHB\tSYS\tSYS\tSYS\tSYS\t0-7\r\n    GPU2\tPHB\tPHB\t X \tPIX\tSYS\tSYS\tSYS\tSYS\t0-7\r\n    GPU3\tPHB\tPHB\tPIX\t X \tSYS\tSYS\tSYS\tSYS\t0-7\r\n    GPU4\tSYS\tSYS\tSYS\tSYS\t X \tPIX\tPHB\tPHB\t8-15\r\n    GPU5\tSYS\tSYS\tSYS\tSYS\tPIX\t X \tPHB\tPHB\t8-15\r\n    GPU6\tSYS\tSYS\tSYS\tSYS\tPHB\tPHB\t X \tPIX\t8-15\r\n    GPU7\tSYS\tSYS\tSYS\tSYS\tPHB\tPHB\tPIX\t X \t8-15\r\n\r\n    Legend:\r\n    \r\n      X    = Self\r\n      SYS  = Connection traversing PCIe as well as the SMP interconnect between NUMA nodes (e.g., QPI/UPI)\r\n      NODE = Connection traversing PCIe as well as the interconnect between PCIe Host Bridges within a NUMA node\r\n      PHB  = Connection traversing PCIe as well as a PCIe Host Bridge (typically the CPU)\r\n      PXB  = Connection traversing multiple PCIe switches (without traversing the PCIe Host Bridge)\r\n      PIX  = Connection traversing a single PCIe switch\r\n      NV#  = Connection traversing a bonded set of # NVLinks\r\n\r\n\r\n1 gpu bach_size=128\r\n\r\n    INFO:tensorflow:loss = 2.2576141, step = 200 (3.729 sec)\r\n    INFO:tensorflow:learning_rate = 0.1, loss = 2.2576141 (3.729 sec)\r\n    INFO:tensorflow:Average examples/sec: 2821.06 (2858.65), step = 200\r\n    INFO:tensorflow:Average examples/sec: 2847.23 (3496.06), step = 210\r\n    INFO:tensorflow:Average examples/sec: 2857.91 (3102.29), step = 220\r\n    INFO:tensorflow:Average examples/sec: 2867.04 (3083.62), step = 230\r\n    INFO:tensorflow:Average examples/sec: 2889.21 (3514.15), step = 240\r\n    INFO:tensorflow:Average examples/sec: 2913.15 (3636.28), step = 250\r\n    INFO:tensorflow:Average examples/sec: 2915.99 (2988.94), step = 260\r\n    INFO:tensorflow:Average examples/sec: 2901.94 (2578.95), step = 270\r\n    INFO:tensorflow:Average examples/sec: 2888.87 (2575.46), step = 280\r\n    INFO:tensorflow:Average examples/sec: 2892.13 (2986.66), step = 290\r\n    INFO:tensorflow:global_step/sec: 24.25\r\n\r\n2 gpu bach_size=256 \r\n\r\n    INFO:tensorflow:loss = 2.4630964, step = 200 (5.971 sec)\r\n    INFO:tensorflow:learning_rate = 0.1, loss = 2.4630964 (5.971 sec)\r\n    INFO:tensorflow:Average examples/sec: 3255.68 (4296.71), step = 200\r\n    INFO:tensorflow:Average examples/sec: 3297.51 (4437.93), step = 210\r\n    INFO:tensorflow:Average examples/sec: 3332.15 (4275.33), step = 220\r\n    INFO:tensorflow:Average examples/sec: 3363.86 (4254.65), step = 230\r\n    INFO:tensorflow:Average examples/sec: 3395.09 (4316.94), step = 240\r\n    INFO:tensorflow:Average examples/sec: 3418.44 (4094.23), step = 250\r\n    INFO:tensorflow:Average examples/sec: 3447.17 (4364.24), step = 260\r\n    INFO:tensorflow:Average examples/sec: 3474.56 (4379.02), step = 270\r\n    INFO:tensorflow:Average examples/sec: 3492.73 (4067.13), step = 280\r\n    INFO:tensorflow:Average examples/sec: 3514.19 (4244.23), step = 290\r\n    INFO:tensorflow:global_step/sec: 16.6026\r\n\r\n3 gpu bach_size=384\r\n\r\n    INFO:tensorflow:loss = 2.0980535, step = 200 (9.329 sec)\r\n    INFO:tensorflow:learning_rate = 0.1, loss = 2.0980535 (9.329 sec)\r\n    INFO:tensorflow:Average examples/sec: 3214.65 (4165.7), step = 200\r\n    INFO:tensorflow:Average examples/sec: 3272.85 (5130.99), step = 210\r\n    INFO:tensorflow:Average examples/sec: 3324.15 (4955.13), step = 220\r\n    INFO:tensorflow:Average examples/sec: 3376.65 (5174.76), step = 230\r\n    INFO:tensorflow:Average examples/sec: 3425.48 (5132.15), step = 240\r\n    INFO:tensorflow:Average examples/sec: 3468.29 (4954.35), step = 250\r\n    INFO:tensorflow:Average examples/sec: 3509.91 (5014.23), step = 260\r\n    INFO:tensorflow:Average examples/sec: 3544.29 (4755.56), step = 270\r\n    INFO:tensorflow:Average examples/sec: 3579.69 (4901.39), step = 280\r\n    INFO:tensorflow:Average examples/sec: 3617.84 (5156.66), step = 290\r\n    INFO:tensorflow:global_step/sec: 13.1009\r\n\r\n\r\n[![enter image description here][3]][3]\r\n\r\n\r\n  [1]: https://github.com/tensorflow/models/tree/master/tutorials/image/cifar10_estimator\r\n  [2]: https://github.com/rossumai/keras-multi-gpu/blob/master/blog/docs/hardware.md\r\n  [3]: https://i.stack.imgur.com/yqIZX.png"}