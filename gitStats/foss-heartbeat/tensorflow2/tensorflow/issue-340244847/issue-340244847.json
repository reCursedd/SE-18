{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20696", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20696/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20696/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20696/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/20696", "id": 340244847, "node_id": "MDU6SXNzdWUzNDAyNDQ4NDc=", "number": 20696, "title": "ValueError when loading multiple tf.contrib.keras models in the same scope at different times", "user": {"login": "Sergio0694", "id": 10199417, "node_id": "MDQ6VXNlcjEwMTk5NDE3", "avatar_url": "https://avatars3.githubusercontent.com/u/10199417?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Sergio0694", "html_url": "https://github.com/Sergio0694", "followers_url": "https://api.github.com/users/Sergio0694/followers", "following_url": "https://api.github.com/users/Sergio0694/following{/other_user}", "gists_url": "https://api.github.com/users/Sergio0694/gists{/gist_id}", "starred_url": "https://api.github.com/users/Sergio0694/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Sergio0694/subscriptions", "organizations_url": "https://api.github.com/users/Sergio0694/orgs", "repos_url": "https://api.github.com/users/Sergio0694/repos", "events_url": "https://api.github.com/users/Sergio0694/events{/privacy}", "received_events_url": "https://api.github.com/users/Sergio0694/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": {"login": "jart", "id": 49262, "node_id": "MDQ6VXNlcjQ5MjYy", "avatar_url": "https://avatars1.githubusercontent.com/u/49262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jart", "html_url": "https://github.com/jart", "followers_url": "https://api.github.com/users/jart/followers", "following_url": "https://api.github.com/users/jart/following{/other_user}", "gists_url": "https://api.github.com/users/jart/gists{/gist_id}", "starred_url": "https://api.github.com/users/jart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jart/subscriptions", "organizations_url": "https://api.github.com/users/jart/orgs", "repos_url": "https://api.github.com/users/jart/repos", "events_url": "https://api.github.com/users/jart/events{/privacy}", "received_events_url": "https://api.github.com/users/jart/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jart", "id": 49262, "node_id": "MDQ6VXNlcjQ5MjYy", "avatar_url": "https://avatars1.githubusercontent.com/u/49262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jart", "html_url": "https://github.com/jart", "followers_url": "https://api.github.com/users/jart/followers", "following_url": "https://api.github.com/users/jart/following{/other_user}", "gists_url": "https://api.github.com/users/jart/gists{/gist_id}", "starred_url": "https://api.github.com/users/jart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jart/subscriptions", "organizations_url": "https://api.github.com/users/jart/orgs", "repos_url": "https://api.github.com/users/jart/repos", "events_url": "https://api.github.com/users/jart/events{/privacy}", "received_events_url": "https://api.github.com/users/jart/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2018-07-11T13:35:13Z", "updated_at": "2018-11-15T19:02:50Z", "closed_at": null, "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: Yes</li>\n<li><strong>OS Platform and Distribution</strong>: Linux Ubuntu 16.04</li>\n<li><strong>TensorFlow installed from</strong>: binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.8.0</li>\n<li><strong>Python version</strong>: 3.5.2</li>\n<li><strong>Bazel version</strong>: N/A</li>\n<li><strong>CUDA/cuDNN version</strong>: CUDA 7.5, cuDNN 9.0</li>\n<li><strong>GPU model and memory</strong>: GTX1080 (8GB)</li>\n<li><strong>Exact command to reproduce</strong>: See <a href=\"https://gist.github.com/Sergio0694/aa36c7ed94091ce5503ad908b142aaf0\"><strong>this snippet</strong></a></li>\n</ul>\n<h3>Describe the problem</h3>\n<p>TensorFlow throws a <code>ValueError: You are trying to load a weight file containing 16 layers into a model with 0 layers</code> when trying to create multiple instances of a pretrained Keras model from within the same scope. This only happens if the instances are created one at a time, reopening the same scope multiple times, and works if all the instances are created consecutively, after opening the scope a single time.</p>\n<p>Of course, in a real world scenario these instances are created from different places and not all at the same time while building the model, so one would actually need to reopen that scope multiple times.<br>\nHope this helps and that the snippet is clear enough!</p>\n<h3>Source code / logs</h3>\n<p>See <a href=\"https://gist.github.com/Sergio0694/aa36c7ed94091ce5503ad908b142aaf0\"><strong>this snippet</strong></a>, same one posted under system information.</p>\n<p>Here's the stack trace for the snippet above:</p>\n<pre><code>Traceback (most recent call last):\n  File \"/home/sergio/Documents/code/keras_repro.py\", line 21, in &lt;module&gt;\n    vgg2 = load_vgg19(t)\n  File \"/home/sergio/Documents/code/keras_repro.py\", line 12, in load_vgg19\n    m = tf.contrib.keras.applications.VGG19(weights='imagenet', include_top=False, input_tensor=x)\n  File \"/home/sergio/.local/lib/python3.5/site-packages/tensorflow/python/keras/_impl/keras/applications/vgg19.py\", line 234, in VGG19\n    model.load_weights(weights_path)\n  File \"/home/sergio/.local/lib/python3.5/site-packages/tensorflow/python/keras/_impl/keras/engine/network.py\", line 1190, in load_weights\n    saving.load_weights_from_hdf5_group(f, self.layers)\n  File \"/home/sergio/.local/lib/python3.5/site-packages/tensorflow/python/keras/_impl/keras/engine/saving.py\", line 697, in load_weights_from_hdf5_group\n    ' layers.')\nValueError: You are trying to load a weight file containing 16 layers into a model with 0 layers.\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes\nOS Platform and Distribution: Linux Ubuntu 16.04\nTensorFlow installed from: binary\nTensorFlow version (use command below): 1.8.0\nPython version: 3.5.2\nBazel version: N/A\nCUDA/cuDNN version: CUDA 7.5, cuDNN 9.0\nGPU model and memory: GTX1080 (8GB)\nExact command to reproduce: See this snippet\n\nDescribe the problem\nTensorFlow throws a ValueError: You are trying to load a weight file containing 16 layers into a model with 0 layers when trying to create multiple instances of a pretrained Keras model from within the same scope. This only happens if the instances are created one at a time, reopening the same scope multiple times, and works if all the instances are created consecutively, after opening the scope a single time.\nOf course, in a real world scenario these instances are created from different places and not all at the same time while building the model, so one would actually need to reopen that scope multiple times.\nHope this helps and that the snippet is clear enough!\nSource code / logs\nSee this snippet, same one posted under system information.\nHere's the stack trace for the snippet above:\nTraceback (most recent call last):\n  File \"/home/sergio/Documents/code/keras_repro.py\", line 21, in <module>\n    vgg2 = load_vgg19(t)\n  File \"/home/sergio/Documents/code/keras_repro.py\", line 12, in load_vgg19\n    m = tf.contrib.keras.applications.VGG19(weights='imagenet', include_top=False, input_tensor=x)\n  File \"/home/sergio/.local/lib/python3.5/site-packages/tensorflow/python/keras/_impl/keras/applications/vgg19.py\", line 234, in VGG19\n    model.load_weights(weights_path)\n  File \"/home/sergio/.local/lib/python3.5/site-packages/tensorflow/python/keras/_impl/keras/engine/network.py\", line 1190, in load_weights\n    saving.load_weights_from_hdf5_group(f, self.layers)\n  File \"/home/sergio/.local/lib/python3.5/site-packages/tensorflow/python/keras/_impl/keras/engine/saving.py\", line 697, in load_weights_from_hdf5_group\n    ' layers.')\nValueError: You are trying to load a weight file containing 16 layers into a model with 0 layers.", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: Yes\r\n- **OS Platform and Distribution**: Linux Ubuntu 16.04\r\n- **TensorFlow installed from**: binary\r\n- **TensorFlow version (use command below)**: 1.8.0\r\n- **Python version**: 3.5.2\r\n- **Bazel version**: N/A\r\n- **CUDA/cuDNN version**: CUDA 7.5, cuDNN 9.0\r\n- **GPU model and memory**: GTX1080 (8GB)\r\n- **Exact command to reproduce**: See [**this snippet**](https://gist.github.com/Sergio0694/aa36c7ed94091ce5503ad908b142aaf0)\r\n\r\n### Describe the problem\r\nTensorFlow throws a `ValueError: You are trying to load a weight file containing 16 layers into a model with 0 layers` when trying to create multiple instances of a pretrained Keras model from within the same scope. This only happens if the instances are created one at a time, reopening the same scope multiple times, and works if all the instances are created consecutively, after opening the scope a single time.\r\n\r\nOf course, in a real world scenario these instances are created from different places and not all at the same time while building the model, so one would actually need to reopen that scope multiple times.\r\nHope this helps and that the snippet is clear enough!\r\n\r\n### Source code / logs\r\nSee [**this snippet**](https://gist.github.com/Sergio0694/aa36c7ed94091ce5503ad908b142aaf0), same one posted under system information.\r\n\r\nHere's the stack trace for the snippet above:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/sergio/Documents/code/keras_repro.py\", line 21, in <module>\r\n    vgg2 = load_vgg19(t)\r\n  File \"/home/sergio/Documents/code/keras_repro.py\", line 12, in load_vgg19\r\n    m = tf.contrib.keras.applications.VGG19(weights='imagenet', include_top=False, input_tensor=x)\r\n  File \"/home/sergio/.local/lib/python3.5/site-packages/tensorflow/python/keras/_impl/keras/applications/vgg19.py\", line 234, in VGG19\r\n    model.load_weights(weights_path)\r\n  File \"/home/sergio/.local/lib/python3.5/site-packages/tensorflow/python/keras/_impl/keras/engine/network.py\", line 1190, in load_weights\r\n    saving.load_weights_from_hdf5_group(f, self.layers)\r\n  File \"/home/sergio/.local/lib/python3.5/site-packages/tensorflow/python/keras/_impl/keras/engine/saving.py\", line 697, in load_weights_from_hdf5_group\r\n    ' layers.')\r\nValueError: You are trying to load a weight file containing 16 layers into a model with 0 layers."}