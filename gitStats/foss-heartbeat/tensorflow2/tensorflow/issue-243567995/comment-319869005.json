{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/319869005", "html_url": "https://github.com/tensorflow/tensorflow/issues/11564#issuecomment-319869005", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11564", "id": 319869005, "node_id": "MDEyOklzc3VlQ29tbWVudDMxOTg2OTAwNQ==", "user": {"login": "nurlonn", "id": 22808599, "node_id": "MDQ6VXNlcjIyODA4NTk5", "avatar_url": "https://avatars1.githubusercontent.com/u/22808599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nurlonn", "html_url": "https://github.com/nurlonn", "followers_url": "https://api.github.com/users/nurlonn/followers", "following_url": "https://api.github.com/users/nurlonn/following{/other_user}", "gists_url": "https://api.github.com/users/nurlonn/gists{/gist_id}", "starred_url": "https://api.github.com/users/nurlonn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nurlonn/subscriptions", "organizations_url": "https://api.github.com/users/nurlonn/orgs", "repos_url": "https://api.github.com/users/nurlonn/repos", "events_url": "https://api.github.com/users/nurlonn/events{/privacy}", "received_events_url": "https://api.github.com/users/nurlonn/received_events", "type": "User", "site_admin": false}, "created_at": "2017-08-03T05:07:33Z", "updated_at": "2017-08-03T06:10:58Z", "author_association": "NONE", "body_html": "<p>I tried adjusting some HLO optimization options to find the problems.</p>\n<p>I found that reshape-motion in HLO optimizer optimization is a problem.<br>\n(tensorflow/compiler/xla/service/reshape_mover.cc)<br>\n(I cannot be sure this optimization is always a problem. In some cases this seems to work well.)</p>\n<p>I used the parallel check option to compare the results of turning the reshape-motion optimization option on and off.</p>\n<p>Default - All HLO optimization is enabled<br>\nCommand<br>\n<code>TF_XLA_FLAGS=\"--tf_xla_parallel_checking=true --parallel_check_failfast=false\" bazel-bin/inception/imagenet_train --num_gpus=1 --batch_size=32 --train_dir=${TRAIN_DIR} --data_dir=${DATA_DIR} --max_steps=40040</code></p>\n<p>The results are recorded in the attached file.<br>\n<a href=\"https://github.com/tensorflow/tensorflow/files/1196029/inception_enable_all.txt\">inception_enable_all.txt</a></p>\n<p>Turn off reshape-motion optimization<br>\nCommand<br>\n<code>TF_XLA_FLAGS=\"--tf_xla_parallel_checking=true --parallel_check_failfast=false --xla_disable_hlo_passes=reshape-motion\" bazel-bin/inception/imagenet_train --num_gpus=1 --batch_size=32 --train_dir=${TRAIN_DIR} --data_dir=${DATA_DIR} --max_steps=40040</code></p>\n<p>The results are also recorded in the attached file.<br>\n<a href=\"https://github.com/tensorflow/tensorflow/files/1196028/inception_disable_reshape.txt\">inception_disable_reshape.txt</a></p>\n<p>You can see that the result is much closer to the original value.</p>\n<p>I checked the inception for 1epoch using the imagenet input, and confirmed that normal accuracy was obtained.</p>", "body_text": "I tried adjusting some HLO optimization options to find the problems.\nI found that reshape-motion in HLO optimizer optimization is a problem.\n(tensorflow/compiler/xla/service/reshape_mover.cc)\n(I cannot be sure this optimization is always a problem. In some cases this seems to work well.)\nI used the parallel check option to compare the results of turning the reshape-motion optimization option on and off.\nDefault - All HLO optimization is enabled\nCommand\nTF_XLA_FLAGS=\"--tf_xla_parallel_checking=true --parallel_check_failfast=false\" bazel-bin/inception/imagenet_train --num_gpus=1 --batch_size=32 --train_dir=${TRAIN_DIR} --data_dir=${DATA_DIR} --max_steps=40040\nThe results are recorded in the attached file.\ninception_enable_all.txt\nTurn off reshape-motion optimization\nCommand\nTF_XLA_FLAGS=\"--tf_xla_parallel_checking=true --parallel_check_failfast=false --xla_disable_hlo_passes=reshape-motion\" bazel-bin/inception/imagenet_train --num_gpus=1 --batch_size=32 --train_dir=${TRAIN_DIR} --data_dir=${DATA_DIR} --max_steps=40040\nThe results are also recorded in the attached file.\ninception_disable_reshape.txt\nYou can see that the result is much closer to the original value.\nI checked the inception for 1epoch using the imagenet input, and confirmed that normal accuracy was obtained.", "body": "I tried adjusting some HLO optimization options to find the problems.\r\n\r\nI found that reshape-motion in HLO optimizer optimization is a problem.\r\n(tensorflow/compiler/xla/service/reshape_mover.cc)\r\n(I cannot be sure this optimization is always a problem. In some cases this seems to work well.)\r\n\r\nI used the parallel check option to compare the results of turning the reshape-motion optimization option on and off.\r\n\r\nDefault - All HLO optimization is enabled\r\nCommand\r\n`TF_XLA_FLAGS=\"--tf_xla_parallel_checking=true --parallel_check_failfast=false\" bazel-bin/inception/imagenet_train --num_gpus=1 --batch_size=32 --train_dir=${TRAIN_DIR} --data_dir=${DATA_DIR} --max_steps=40040` \r\n\r\nThe results are recorded in the attached file.\r\n[inception_enable_all.txt](https://github.com/tensorflow/tensorflow/files/1196029/inception_enable_all.txt)\r\n\r\nTurn off reshape-motion optimization\r\nCommand\r\n`TF_XLA_FLAGS=\"--tf_xla_parallel_checking=true --parallel_check_failfast=false --xla_disable_hlo_passes=reshape-motion\" bazel-bin/inception/imagenet_train --num_gpus=1 --batch_size=32 --train_dir=${TRAIN_DIR} --data_dir=${DATA_DIR} --max_steps=40040` \r\n\r\nThe results are also recorded in the attached file.\r\n[inception_disable_reshape.txt](https://github.com/tensorflow/tensorflow/files/1196028/inception_disable_reshape.txt)\r\n\r\nYou can see that the result is much closer to the original value.\r\n\r\nI checked the inception for 1epoch using the imagenet input, and confirmed that normal accuracy was obtained."}