{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2855", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2855/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2855/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2855/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/2855", "id": 160230095, "node_id": "MDU6SXNzdWUxNjAyMzAwOTU=", "number": 2855, "title": "Jenkins test take dependencies from pip package instead of .runfiles directory", "user": {"login": "yaroslavvb", "id": 23068, "node_id": "MDQ6VXNlcjIzMDY4", "avatar_url": "https://avatars3.githubusercontent.com/u/23068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yaroslavvb", "html_url": "https://github.com/yaroslavvb", "followers_url": "https://api.github.com/users/yaroslavvb/followers", "following_url": "https://api.github.com/users/yaroslavvb/following{/other_user}", "gists_url": "https://api.github.com/users/yaroslavvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/yaroslavvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yaroslavvb/subscriptions", "organizations_url": "https://api.github.com/users/yaroslavvb/orgs", "repos_url": "https://api.github.com/users/yaroslavvb/repos", "events_url": "https://api.github.com/users/yaroslavvb/events{/privacy}", "received_events_url": "https://api.github.com/users/yaroslavvb/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "caisq", "id": 16824702, "node_id": "MDQ6VXNlcjE2ODI0NzAy", "avatar_url": "https://avatars2.githubusercontent.com/u/16824702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/caisq", "html_url": "https://github.com/caisq", "followers_url": "https://api.github.com/users/caisq/followers", "following_url": "https://api.github.com/users/caisq/following{/other_user}", "gists_url": "https://api.github.com/users/caisq/gists{/gist_id}", "starred_url": "https://api.github.com/users/caisq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/caisq/subscriptions", "organizations_url": "https://api.github.com/users/caisq/orgs", "repos_url": "https://api.github.com/users/caisq/repos", "events_url": "https://api.github.com/users/caisq/events{/privacy}", "received_events_url": "https://api.github.com/users/caisq/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "caisq", "id": 16824702, "node_id": "MDQ6VXNlcjE2ODI0NzAy", "avatar_url": "https://avatars2.githubusercontent.com/u/16824702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/caisq", "html_url": "https://github.com/caisq", "followers_url": "https://api.github.com/users/caisq/followers", "following_url": "https://api.github.com/users/caisq/following{/other_user}", "gists_url": "https://api.github.com/users/caisq/gists{/gist_id}", "starred_url": "https://api.github.com/users/caisq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/caisq/subscriptions", "organizations_url": "https://api.github.com/users/caisq/orgs", "repos_url": "https://api.github.com/users/caisq/repos", "events_url": "https://api.github.com/users/caisq/events{/privacy}", "received_events_url": "https://api.github.com/users/caisq/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2016-06-14T16:48:23Z", "updated_at": "2016-12-21T16:28:18Z", "closed_at": "2016-12-21T16:28:09Z", "author_association": "CONTRIBUTOR", "body_html": "<p>TLDR; Jenkins looks for dependencies in <code>python2.7/site-packages/tensorflow/..</code> but it should look for them in <code>bazel-bin/.../test.runfiles/...</code>. Possibly related to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"160083239\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/2844\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/2844/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/2844\">#2844</a></p>\n<p>I'm looking at a test failure in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"159318078\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/2747\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/2747/hovercard\" href=\"https://github.com/tensorflow/tensorflow/pull/2747\">#2747</a>, and it can't find a data dependency while running on Jenkins, meanwhile this test passes under <code>bazel test</code> in a fresh git clone.</p>\n<p>More specifically, <code>bazel test tensorflow/contrib/immediate/mnist_inference_test</code> copies all Python files and data dependencies to <code>bazel-bin/tensorflow/contrib/immediate/mnist_inference_test.runfiles/</code></p>\n<p>However, from the path of the error, it seems it's looking for dependencies in <code>python2.7/site-packages/tensorflow/</code> instead of <code>.runfiles</code> directory. The path to convolutional.py should look like this <code>bazel-bin/tensorflow/contrib/immediate/mnist_inference_test.runfiles/org_tensorflow/tensorflow/models/image/mnist/convolutional.py</code>, instead of <code>site-packages</code>. When dependencies are resolved to <code>site-packages</code>,  this case failure is be expected, because while Python files are included in the PIP package, but  data dependencies of tests will not be.</p>\n<pre><code>Traceback (most recent call last):\n  File \"/workspace/pip_test/tests/mnist_inference_test.py\", line 23, in testMnistInference\n    test_data = convolutional.extract_data(test_data_filename, 10000)\n  File \"/workspace/pip_test/venv/local/lib/python2.7/site-packages/tensorflow/models/image/mnist/convolutional.py\", line 83, in extract_data\n    with gzip.open(filename) as bytestream:\n  File \"/usr/lib/python2.7/gzip.py\", line 34, in open\n    return GzipFile(filename, mode, compresslevel)\n  File \"/usr/lib/python2.7/gzip.py\", line 94, in __init__\n    fileobj = self.myfileobj = __builtin__.open(filename, mode or 'rb')\nIOError: [Errno 2] No such file or directory: 'tensorflow/contrib/immediate/python/immediate/testdata/t10k-images-idx3-ubyte.gz'\n\n</code></pre>", "body_text": "TLDR; Jenkins looks for dependencies in python2.7/site-packages/tensorflow/.. but it should look for them in bazel-bin/.../test.runfiles/.... Possibly related to #2844\nI'm looking at a test failure in #2747, and it can't find a data dependency while running on Jenkins, meanwhile this test passes under bazel test in a fresh git clone.\nMore specifically, bazel test tensorflow/contrib/immediate/mnist_inference_test copies all Python files and data dependencies to bazel-bin/tensorflow/contrib/immediate/mnist_inference_test.runfiles/\nHowever, from the path of the error, it seems it's looking for dependencies in python2.7/site-packages/tensorflow/ instead of .runfiles directory. The path to convolutional.py should look like this bazel-bin/tensorflow/contrib/immediate/mnist_inference_test.runfiles/org_tensorflow/tensorflow/models/image/mnist/convolutional.py, instead of site-packages. When dependencies are resolved to site-packages,  this case failure is be expected, because while Python files are included in the PIP package, but  data dependencies of tests will not be.\nTraceback (most recent call last):\n  File \"/workspace/pip_test/tests/mnist_inference_test.py\", line 23, in testMnistInference\n    test_data = convolutional.extract_data(test_data_filename, 10000)\n  File \"/workspace/pip_test/venv/local/lib/python2.7/site-packages/tensorflow/models/image/mnist/convolutional.py\", line 83, in extract_data\n    with gzip.open(filename) as bytestream:\n  File \"/usr/lib/python2.7/gzip.py\", line 34, in open\n    return GzipFile(filename, mode, compresslevel)\n  File \"/usr/lib/python2.7/gzip.py\", line 94, in __init__\n    fileobj = self.myfileobj = __builtin__.open(filename, mode or 'rb')\nIOError: [Errno 2] No such file or directory: 'tensorflow/contrib/immediate/python/immediate/testdata/t10k-images-idx3-ubyte.gz'", "body": "TLDR; Jenkins looks for dependencies in `python2.7/site-packages/tensorflow/..` but it should look for them in `bazel-bin/.../test.runfiles/...`. Possibly related to https://github.com/tensorflow/tensorflow/issues/2844\n\nI'm looking at a test failure in https://github.com/tensorflow/tensorflow/pull/2747, and it can't find a data dependency while running on Jenkins, meanwhile this test passes under `bazel test` in a fresh git clone.\n\nMore specifically, `bazel test tensorflow/contrib/immediate/mnist_inference_test` copies all Python files and data dependencies to `bazel-bin/tensorflow/contrib/immediate/mnist_inference_test.runfiles/`\n\nHowever, from the path of the error, it seems it's looking for dependencies in `python2.7/site-packages/tensorflow/` instead of `.runfiles` directory. The path to convolutional.py should look like this `bazel-bin/tensorflow/contrib/immediate/mnist_inference_test.runfiles/org_tensorflow/tensorflow/models/image/mnist/convolutional.py`, instead of `site-packages`. When dependencies are resolved to `site-packages`,  this case failure is be expected, because while Python files are included in the PIP package, but  data dependencies of tests will not be.\n\n```\nTraceback (most recent call last):\n  File \"/workspace/pip_test/tests/mnist_inference_test.py\", line 23, in testMnistInference\n    test_data = convolutional.extract_data(test_data_filename, 10000)\n  File \"/workspace/pip_test/venv/local/lib/python2.7/site-packages/tensorflow/models/image/mnist/convolutional.py\", line 83, in extract_data\n    with gzip.open(filename) as bytestream:\n  File \"/usr/lib/python2.7/gzip.py\", line 34, in open\n    return GzipFile(filename, mode, compresslevel)\n  File \"/usr/lib/python2.7/gzip.py\", line 94, in __init__\n    fileobj = self.myfileobj = __builtin__.open(filename, mode or 'rb')\nIOError: [Errno 2] No such file or directory: 'tensorflow/contrib/immediate/python/immediate/testdata/t10k-images-idx3-ubyte.gz'\n\n```\n"}