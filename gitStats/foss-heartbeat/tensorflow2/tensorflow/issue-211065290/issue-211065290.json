{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7974", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7974/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7974/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7974/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/7974", "id": 211065290, "node_id": "MDU6SXNzdWUyMTEwNjUyOTA=", "number": 7974, "title": "InvalidArgumentError for tf.gather_nd() function", "user": {"login": "happygds", "id": 16026070, "node_id": "MDQ6VXNlcjE2MDI2MDcw", "avatar_url": "https://avatars1.githubusercontent.com/u/16026070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/happygds", "html_url": "https://github.com/happygds", "followers_url": "https://api.github.com/users/happygds/followers", "following_url": "https://api.github.com/users/happygds/following{/other_user}", "gists_url": "https://api.github.com/users/happygds/gists{/gist_id}", "starred_url": "https://api.github.com/users/happygds/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/happygds/subscriptions", "organizations_url": "https://api.github.com/users/happygds/orgs", "repos_url": "https://api.github.com/users/happygds/repos", "events_url": "https://api.github.com/users/happygds/events{/privacy}", "received_events_url": "https://api.github.com/users/happygds/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-03-01T12:19:37Z", "updated_at": "2017-03-25T13:03:54Z", "closed_at": "2017-03-02T22:54:32Z", "author_association": "NONE", "body_html": "<p>When I use <code>tf.gather_nd(im, idx)</code>, I encountered the following error:</p>\n<pre><code>  File \"model.py\", line 86, in &lt;module&gt;\n    num=len(up_outputs) - 1, pixels_count=pixels_count)(up_outputs)\n  File \"/home/dl/gds/dl_modules/keras/keras/engine/topology.py\", line 572, in __call__\n    self.add_inbound_node(inbound_layers, node_indices, tensor_indices)\n  File \"/home/dl/gds/dl_modules/keras/keras/engine/topology.py\", line 635, in add_inbound_node\n    Node.create_node(self, inbound_layers, node_indices, tensor_indices)\n  File \"/home/dl/gds/dl_modules/keras/keras/engine/topology.py\", line 172, in create_node\n    output_tensors = to_list(outbound_layer.call(input_tensors, mask=input_masks))\n  File \"/home/dl/gds/important/key_frame/frame_propagation/lib/layer_utils_tf.py\", line 101, in call\n    results.append(_interpolate(vects[i], ori_loc, stride=self.strides[i], ori_shp=self.ori_shp))\n  File \"/home/dl/gds/important/key_frame/frame_propagation/lib/layer_utils_tf.py\", line 65, in _interpolate\n    Id = tf.gather_nd(im, idx_d)\n  File \"/home/dl/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 1473, in gather_nd\n    name=name)\n  File \"/home/dl/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\n    op_def=op_def)\n  File \"/home/dl/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2395, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/dl/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\n    self._traceback = _extract_stack()\n\nInvalidArgumentError (see above for traceback): Must have updates.shape = indices.shape[:IXDIM] + params_shape[IXDIM:], got updates.shape [1,200,256], indices.shape [1,200,3], params_shape [1,128,128,256]\n\t [[Node: gradients/GatherNd_3_grad/ScatterNd = ScatterNd[T=DT_FLOAT, Tindices=DT_INT32, _class=[\"loc:@GatherNd_3\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](stack_3/_1441, gradients/mul_10_grad/Reshape_1/_1525, gradients/GatherNd_3_grad/Shape)]]\n</code></pre>\n<p>The shape of tensor <code>im</code> is <code>(batch, row, col, channel) (1, 128, 128, 256)</code>, and the shape of indices tensor <code>ind</code> is <code>(batch, 200, 3)</code>, of which the 3 values in the third dimension represent <code>(batch, row, col)</code>.<br>\nThus we get a tensor of shape <code>(1, 200, 256)</code>, however, why it said that:</p>\n<pre><code>Must have updates.shape = indices.shape[:IXDIM] + params_shape[IXDIM:], got updates.shape [1,200,256], indices.shape [1,200,3], params_shape [1,128,128,256]\n</code></pre>\n<p>It's weird, what does <code>IXDIM</code> represents here ? Anyone knows ?</p>", "body_text": "When I use tf.gather_nd(im, idx), I encountered the following error:\n  File \"model.py\", line 86, in <module>\n    num=len(up_outputs) - 1, pixels_count=pixels_count)(up_outputs)\n  File \"/home/dl/gds/dl_modules/keras/keras/engine/topology.py\", line 572, in __call__\n    self.add_inbound_node(inbound_layers, node_indices, tensor_indices)\n  File \"/home/dl/gds/dl_modules/keras/keras/engine/topology.py\", line 635, in add_inbound_node\n    Node.create_node(self, inbound_layers, node_indices, tensor_indices)\n  File \"/home/dl/gds/dl_modules/keras/keras/engine/topology.py\", line 172, in create_node\n    output_tensors = to_list(outbound_layer.call(input_tensors, mask=input_masks))\n  File \"/home/dl/gds/important/key_frame/frame_propagation/lib/layer_utils_tf.py\", line 101, in call\n    results.append(_interpolate(vects[i], ori_loc, stride=self.strides[i], ori_shp=self.ori_shp))\n  File \"/home/dl/gds/important/key_frame/frame_propagation/lib/layer_utils_tf.py\", line 65, in _interpolate\n    Id = tf.gather_nd(im, idx_d)\n  File \"/home/dl/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 1473, in gather_nd\n    name=name)\n  File \"/home/dl/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\n    op_def=op_def)\n  File \"/home/dl/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2395, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/dl/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\n    self._traceback = _extract_stack()\n\nInvalidArgumentError (see above for traceback): Must have updates.shape = indices.shape[:IXDIM] + params_shape[IXDIM:], got updates.shape [1,200,256], indices.shape [1,200,3], params_shape [1,128,128,256]\n\t [[Node: gradients/GatherNd_3_grad/ScatterNd = ScatterNd[T=DT_FLOAT, Tindices=DT_INT32, _class=[\"loc:@GatherNd_3\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](stack_3/_1441, gradients/mul_10_grad/Reshape_1/_1525, gradients/GatherNd_3_grad/Shape)]]\n\nThe shape of tensor im is (batch, row, col, channel) (1, 128, 128, 256), and the shape of indices tensor ind is (batch, 200, 3), of which the 3 values in the third dimension represent (batch, row, col).\nThus we get a tensor of shape (1, 200, 256), however, why it said that:\nMust have updates.shape = indices.shape[:IXDIM] + params_shape[IXDIM:], got updates.shape [1,200,256], indices.shape [1,200,3], params_shape [1,128,128,256]\n\nIt's weird, what does IXDIM represents here ? Anyone knows ?", "body": "When I use `tf.gather_nd(im, idx)`, I encountered the following error:\r\n```\r\n  File \"model.py\", line 86, in <module>\r\n    num=len(up_outputs) - 1, pixels_count=pixels_count)(up_outputs)\r\n  File \"/home/dl/gds/dl_modules/keras/keras/engine/topology.py\", line 572, in __call__\r\n    self.add_inbound_node(inbound_layers, node_indices, tensor_indices)\r\n  File \"/home/dl/gds/dl_modules/keras/keras/engine/topology.py\", line 635, in add_inbound_node\r\n    Node.create_node(self, inbound_layers, node_indices, tensor_indices)\r\n  File \"/home/dl/gds/dl_modules/keras/keras/engine/topology.py\", line 172, in create_node\r\n    output_tensors = to_list(outbound_layer.call(input_tensors, mask=input_masks))\r\n  File \"/home/dl/gds/important/key_frame/frame_propagation/lib/layer_utils_tf.py\", line 101, in call\r\n    results.append(_interpolate(vects[i], ori_loc, stride=self.strides[i], ori_shp=self.ori_shp))\r\n  File \"/home/dl/gds/important/key_frame/frame_propagation/lib/layer_utils_tf.py\", line 65, in _interpolate\r\n    Id = tf.gather_nd(im, idx_d)\r\n  File \"/home/dl/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 1473, in gather_nd\r\n    name=name)\r\n  File \"/home/dl/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\r\n    op_def=op_def)\r\n  File \"/home/dl/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2395, in create_op\r\n    original_op=self._default_original_op, op_def=op_def)\r\n  File \"/home/dl/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\r\n    self._traceback = _extract_stack()\r\n\r\nInvalidArgumentError (see above for traceback): Must have updates.shape = indices.shape[:IXDIM] + params_shape[IXDIM:], got updates.shape [1,200,256], indices.shape [1,200,3], params_shape [1,128,128,256]\r\n\t [[Node: gradients/GatherNd_3_grad/ScatterNd = ScatterNd[T=DT_FLOAT, Tindices=DT_INT32, _class=[\"loc:@GatherNd_3\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](stack_3/_1441, gradients/mul_10_grad/Reshape_1/_1525, gradients/GatherNd_3_grad/Shape)]]\r\n```\r\nThe shape of tensor `im` is `(batch, row, col, channel) (1, 128, 128, 256)`, and the shape of indices tensor `ind` is `(batch, 200, 3)`, of which the 3 values in the third dimension represent `(batch, row, col)`.\r\nThus we get a tensor of shape `(1, 200, 256)`, however, why it said that:\r\n```\r\nMust have updates.shape = indices.shape[:IXDIM] + params_shape[IXDIM:], got updates.shape [1,200,256], indices.shape [1,200,3], params_shape [1,128,128,256]\r\n```\r\nIt's weird, what does `IXDIM` represents here ? Anyone knows ?"}