{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22319", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22319/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22319/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22319/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/22319", "id": 360946501, "node_id": "MDU6SXNzdWUzNjA5NDY1MDE=", "number": 22319, "title": "Distributed training fails when I use FixedLengthRecordDataset", "user": {"login": "dmitrievanthony", "id": 1028969, "node_id": "MDQ6VXNlcjEwMjg5Njk=", "avatar_url": "https://avatars3.githubusercontent.com/u/1028969?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dmitrievanthony", "html_url": "https://github.com/dmitrievanthony", "followers_url": "https://api.github.com/users/dmitrievanthony/followers", "following_url": "https://api.github.com/users/dmitrievanthony/following{/other_user}", "gists_url": "https://api.github.com/users/dmitrievanthony/gists{/gist_id}", "starred_url": "https://api.github.com/users/dmitrievanthony/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dmitrievanthony/subscriptions", "organizations_url": "https://api.github.com/users/dmitrievanthony/orgs", "repos_url": "https://api.github.com/users/dmitrievanthony/repos", "events_url": "https://api.github.com/users/dmitrievanthony/events{/privacy}", "received_events_url": "https://api.github.com/users/dmitrievanthony/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 996845227, "node_id": "MDU6TGFiZWw5OTY4NDUyMjc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:dist-strat", "name": "comp:dist-strat", "color": "0052cc", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "yuefengz", "id": 1647833, "node_id": "MDQ6VXNlcjE2NDc4MzM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1647833?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuefengz", "html_url": "https://github.com/yuefengz", "followers_url": "https://api.github.com/users/yuefengz/followers", "following_url": "https://api.github.com/users/yuefengz/following{/other_user}", "gists_url": "https://api.github.com/users/yuefengz/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuefengz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuefengz/subscriptions", "organizations_url": "https://api.github.com/users/yuefengz/orgs", "repos_url": "https://api.github.com/users/yuefengz/repos", "events_url": "https://api.github.com/users/yuefengz/events{/privacy}", "received_events_url": "https://api.github.com/users/yuefengz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "yuefengz", "id": 1647833, "node_id": "MDQ6VXNlcjE2NDc4MzM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1647833?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuefengz", "html_url": "https://github.com/yuefengz", "followers_url": "https://api.github.com/users/yuefengz/followers", "following_url": "https://api.github.com/users/yuefengz/following{/other_user}", "gists_url": "https://api.github.com/users/yuefengz/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuefengz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuefengz/subscriptions", "organizations_url": "https://api.github.com/users/yuefengz/orgs", "repos_url": "https://api.github.com/users/yuefengz/repos", "events_url": "https://api.github.com/users/yuefengz/events{/privacy}", "received_events_url": "https://api.github.com/users/yuefengz/received_events", "type": "User", "site_admin": false}, {"login": "guptapriya", "id": 14104855, "node_id": "MDQ6VXNlcjE0MTA0ODU1", "avatar_url": "https://avatars1.githubusercontent.com/u/14104855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guptapriya", "html_url": "https://github.com/guptapriya", "followers_url": "https://api.github.com/users/guptapriya/followers", "following_url": "https://api.github.com/users/guptapriya/following{/other_user}", "gists_url": "https://api.github.com/users/guptapriya/gists{/gist_id}", "starred_url": "https://api.github.com/users/guptapriya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guptapriya/subscriptions", "organizations_url": "https://api.github.com/users/guptapriya/orgs", "repos_url": "https://api.github.com/users/guptapriya/repos", "events_url": "https://api.github.com/users/guptapriya/events{/privacy}", "received_events_url": "https://api.github.com/users/guptapriya/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2018-09-17T16:25:54Z", "updated_at": "2018-10-03T21:18:59Z", "closed_at": "2018-10-03T18:49:04Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>System information</h3>\n<ul>\n<li>\n<p><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:<br>\nI slightly updated <code>keras_model_to_estimator_client.py</code> example so that it uses FixedLengthRecordDataset. Updated version is <a href=\"https://github.com/dmitrievanthony/ecosystem/blob/ignite/distribution_strategy/keras_model_to_estimator_client.py\">here</a>.</p>\n</li>\n<li>\n<p><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nUbuntu 17.04</p>\n</li>\n<li>\n<p><strong>TensorFlow installed from (source or binary)</strong>:<br>\nBinary</p>\n</li>\n<li>\n<p><strong>TensorFlow version (use command below)</strong>:<br>\n1.11.0-dev20180917</p>\n</li>\n<li>\n<p><strong>Python version</strong>:<br>\n3.6.3</p>\n</li>\n<li>\n<p><strong>Exact command to reproduce</strong>:<br>\nSee <a href=\"https://github.com/dmitrievanthony/ecosystem/blob/ignite/distribution_strategy/keras_model_to_estimator_client.py\">updated example</a>.</p>\n</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>Hi,</p>\n<p>I'm investigating TensorFlow distributed training approaches with help of <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1647833\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/yuefengz\">@yuefengz</a> who kindly helps me. So far I updated <a href=\"https://github.com/tensorflow/ecosystem/blob/master/distribution_strategy/keras_model_to_estimator_client.py\">keras_model_to_estimator_client.py</a> example so that it uses FixedLengthRecordDataset, but as result the whole code fails.</p>\n<h3>Source code / logs</h3>\n<pre><code>Traceback (most recent call last):\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/ops/array_ops.py\", line 2667, in gather\n    return params.sparse_read(indices, name=name)\nAttributeError: 'Tensor' object has no attribute 'sparse_read'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1628, in _create_c_op\n    c_op = c_api.TF_FinishOperation(op_desc)\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Shape must be at least rank 1 but is rank 0 for 'GatherV2' (op: 'GatherV2') with input shapes: [], [1], [].\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"keras_model_to_estimator_client.py\", line 134, in &lt;module&gt;\n    tf.app.run(argv=sys.argv)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/platform/app.py\", line 125, in run\n    _sys.exit(main(argv))\n  File \"keras_model_to_estimator_client.py\", line 129, in main\n    eval_spec=tf.estimator.EvalSpec(input_fn=input_fn))\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/training.py\", line 462, in train_and_evaluate\n    estimator, train_spec, eval_spec, _TrainingExecutor)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/distribute/estimator_training.py\", line 264, in train_and_evaluate\n    session_config=run_config.session_config)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/distribute/distribute_coordinator.py\", line 798, in run_distribute_coordinator\n    session_config, rpc_layer)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/distribute/distribute_coordinator.py\", line 344, in _run_single_worker\n    worker_fn(strategy)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/distribute/estimator_training.py\", line 232, in _worker_fn\n    hooks=list(train_spec.hooks))\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 355, in train\n    loss = self._train_model(input_fn, hooks, saving_listeners)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1178, in _train_model\n    return self._train_model_distributed(input_fn, hooks, saving_listeners)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1246, in _train_model_distributed\n    input_fn, model_fn_lib.ModeKeys.TRAIN, self._train_distribution)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1037, in _get_iterator_from_input_fn\n    lambda: self._call_input_fn(input_fn, mode))\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/mirrored_strategy.py\", line 480, in distribute_dataset\n    self._prefetch_on_device)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/values.py\", line 814, in __init__\n    worker_input, len(worker_device_map), i)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/input_ops.py\", line 140, in auto_shard_dataset\n    return _auto_shard_impl(dataset=dataset, found_reader_op=False)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/input_ops.py\", line 107, in _auto_shard_impl\n    dataset._input_dataset, found_reader_op)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/input_ops.py\", line 107, in _auto_shard_impl\n    dataset._input_dataset, found_reader_op)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/input_ops.py\", line 107, in _auto_shard_impl\n    dataset._input_dataset, found_reader_op)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/input_ops.py\", line 67, in _auto_shard_impl\n    filenames_tensor, math_ops.range(index, num_files, num_shards))\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/ops/array_ops.py\", line 2669, in gather\n    return gen_array_ops.gather_v2(params, indices, axis, name=name)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 3232, in gather_v2\n    \"GatherV2\", params=params, indices=indices, axis=axis, name=name)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\n    op_def=op_def)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/util/deprecation.py\", line 488, in new_func\n    return func(*args, **kwargs)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 3274, in create_op\n    op_def=op_def)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1792, in __init__\n    control_input_ops)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1631, in _create_c_op\n    raise ValueError(str(e))\nValueError: Shape must be at least rank 1 but is rank 0 for 'GatherV2' (op: 'GatherV2') with input shapes: [], [1], [].\n</code></pre>\n<p>It looks like the exception happens in <code>input_ops.py</code> in <code>_auto_shard_impl</code> method when TensorFlow tries to shard file names. Unfortunately, I don't clearly understand this command to be honest:</p>\n<pre><code> sharded_filenames_tensor = array_ops.gather(\n            filenames_tensor, math_ops.range(index, num_files, num_shards))\n</code></pre>", "body_text": "System information\n\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nI slightly updated keras_model_to_estimator_client.py example so that it uses FixedLengthRecordDataset. Updated version is here.\n\n\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nUbuntu 17.04\n\n\nTensorFlow installed from (source or binary):\nBinary\n\n\nTensorFlow version (use command below):\n1.11.0-dev20180917\n\n\nPython version:\n3.6.3\n\n\nExact command to reproduce:\nSee updated example.\n\n\nDescribe the problem\nHi,\nI'm investigating TensorFlow distributed training approaches with help of @yuefengz who kindly helps me. So far I updated keras_model_to_estimator_client.py example so that it uses FixedLengthRecordDataset, but as result the whole code fails.\nSource code / logs\nTraceback (most recent call last):\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/ops/array_ops.py\", line 2667, in gather\n    return params.sparse_read(indices, name=name)\nAttributeError: 'Tensor' object has no attribute 'sparse_read'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1628, in _create_c_op\n    c_op = c_api.TF_FinishOperation(op_desc)\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Shape must be at least rank 1 but is rank 0 for 'GatherV2' (op: 'GatherV2') with input shapes: [], [1], [].\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"keras_model_to_estimator_client.py\", line 134, in <module>\n    tf.app.run(argv=sys.argv)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/platform/app.py\", line 125, in run\n    _sys.exit(main(argv))\n  File \"keras_model_to_estimator_client.py\", line 129, in main\n    eval_spec=tf.estimator.EvalSpec(input_fn=input_fn))\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/training.py\", line 462, in train_and_evaluate\n    estimator, train_spec, eval_spec, _TrainingExecutor)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/distribute/estimator_training.py\", line 264, in train_and_evaluate\n    session_config=run_config.session_config)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/distribute/distribute_coordinator.py\", line 798, in run_distribute_coordinator\n    session_config, rpc_layer)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/distribute/distribute_coordinator.py\", line 344, in _run_single_worker\n    worker_fn(strategy)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/distribute/estimator_training.py\", line 232, in _worker_fn\n    hooks=list(train_spec.hooks))\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 355, in train\n    loss = self._train_model(input_fn, hooks, saving_listeners)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1178, in _train_model\n    return self._train_model_distributed(input_fn, hooks, saving_listeners)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1246, in _train_model_distributed\n    input_fn, model_fn_lib.ModeKeys.TRAIN, self._train_distribution)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1037, in _get_iterator_from_input_fn\n    lambda: self._call_input_fn(input_fn, mode))\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/mirrored_strategy.py\", line 480, in distribute_dataset\n    self._prefetch_on_device)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/values.py\", line 814, in __init__\n    worker_input, len(worker_device_map), i)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/input_ops.py\", line 140, in auto_shard_dataset\n    return _auto_shard_impl(dataset=dataset, found_reader_op=False)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/input_ops.py\", line 107, in _auto_shard_impl\n    dataset._input_dataset, found_reader_op)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/input_ops.py\", line 107, in _auto_shard_impl\n    dataset._input_dataset, found_reader_op)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/input_ops.py\", line 107, in _auto_shard_impl\n    dataset._input_dataset, found_reader_op)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/input_ops.py\", line 67, in _auto_shard_impl\n    filenames_tensor, math_ops.range(index, num_files, num_shards))\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/ops/array_ops.py\", line 2669, in gather\n    return gen_array_ops.gather_v2(params, indices, axis, name=name)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 3232, in gather_v2\n    \"GatherV2\", params=params, indices=indices, axis=axis, name=name)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\n    op_def=op_def)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/util/deprecation.py\", line 488, in new_func\n    return func(*args, **kwargs)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 3274, in create_op\n    op_def=op_def)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1792, in __init__\n    control_input_ops)\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1631, in _create_c_op\n    raise ValueError(str(e))\nValueError: Shape must be at least rank 1 but is rank 0 for 'GatherV2' (op: 'GatherV2') with input shapes: [], [1], [].\n\nIt looks like the exception happens in input_ops.py in _auto_shard_impl method when TensorFlow tries to shard file names. Unfortunately, I don't clearly understand this command to be honest:\n sharded_filenames_tensor = array_ops.gather(\n            filenames_tensor, math_ops.range(index, num_files, num_shards))", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\nI slightly updated `keras_model_to_estimator_client.py` example so that it uses FixedLengthRecordDataset. Updated version is [here](https://github.com/dmitrievanthony/ecosystem/blob/ignite/distribution_strategy/keras_model_to_estimator_client.py).\r\n\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\nUbuntu 17.04\r\n\r\n- **TensorFlow installed from (source or binary)**:\r\nBinary\r\n\r\n- **TensorFlow version (use command below)**:\r\n1.11.0-dev20180917\r\n\r\n- **Python version**:\r\n3.6.3\r\n\r\n- **Exact command to reproduce**:\r\nSee [updated example](https://github.com/dmitrievanthony/ecosystem/blob/ignite/distribution_strategy/keras_model_to_estimator_client.py).\r\n\r\n### Describe the problem\r\nHi,\r\n\r\nI'm investigating TensorFlow distributed training approaches with help of @yuefengz who kindly helps me. So far I updated [keras_model_to_estimator_client.py](https://github.com/tensorflow/ecosystem/blob/master/distribution_strategy/keras_model_to_estimator_client.py) example so that it uses FixedLengthRecordDataset, but as result the whole code fails.\r\n\r\n### Source code / logs\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/ops/array_ops.py\", line 2667, in gather\r\n    return params.sparse_read(indices, name=name)\r\nAttributeError: 'Tensor' object has no attribute 'sparse_read'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1628, in _create_c_op\r\n    c_op = c_api.TF_FinishOperation(op_desc)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Shape must be at least rank 1 but is rank 0 for 'GatherV2' (op: 'GatherV2') with input shapes: [], [1], [].\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"keras_model_to_estimator_client.py\", line 134, in <module>\r\n    tf.app.run(argv=sys.argv)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/platform/app.py\", line 125, in run\r\n    _sys.exit(main(argv))\r\n  File \"keras_model_to_estimator_client.py\", line 129, in main\r\n    eval_spec=tf.estimator.EvalSpec(input_fn=input_fn))\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/training.py\", line 462, in train_and_evaluate\r\n    estimator, train_spec, eval_spec, _TrainingExecutor)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/distribute/estimator_training.py\", line 264, in train_and_evaluate\r\n    session_config=run_config.session_config)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/distribute/distribute_coordinator.py\", line 798, in run_distribute_coordinator\r\n    session_config, rpc_layer)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/distribute/distribute_coordinator.py\", line 344, in _run_single_worker\r\n    worker_fn(strategy)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/distribute/estimator_training.py\", line 232, in _worker_fn\r\n    hooks=list(train_spec.hooks))\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 355, in train\r\n    loss = self._train_model(input_fn, hooks, saving_listeners)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1178, in _train_model\r\n    return self._train_model_distributed(input_fn, hooks, saving_listeners)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1246, in _train_model_distributed\r\n    input_fn, model_fn_lib.ModeKeys.TRAIN, self._train_distribution)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1037, in _get_iterator_from_input_fn\r\n    lambda: self._call_input_fn(input_fn, mode))\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/mirrored_strategy.py\", line 480, in distribute_dataset\r\n    self._prefetch_on_device)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/values.py\", line 814, in __init__\r\n    worker_input, len(worker_device_map), i)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/input_ops.py\", line 140, in auto_shard_dataset\r\n    return _auto_shard_impl(dataset=dataset, found_reader_op=False)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/input_ops.py\", line 107, in _auto_shard_impl\r\n    dataset._input_dataset, found_reader_op)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/input_ops.py\", line 107, in _auto_shard_impl\r\n    dataset._input_dataset, found_reader_op)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/input_ops.py\", line 107, in _auto_shard_impl\r\n    dataset._input_dataset, found_reader_op)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/input_ops.py\", line 67, in _auto_shard_impl\r\n    filenames_tensor, math_ops.range(index, num_files, num_shards))\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/ops/array_ops.py\", line 2669, in gather\r\n    return gen_array_ops.gather_v2(params, indices, axis, name=name)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 3232, in gather_v2\r\n    \"GatherV2\", params=params, indices=indices, axis=axis, name=name)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/util/deprecation.py\", line 488, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 3274, in create_op\r\n    op_def=op_def)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1792, in __init__\r\n    control_input_ops)\r\n  File \"/home/gridgain/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1631, in _create_c_op\r\n    raise ValueError(str(e))\r\nValueError: Shape must be at least rank 1 but is rank 0 for 'GatherV2' (op: 'GatherV2') with input shapes: [], [1], [].\r\n```\r\nIt looks like the exception happens in `input_ops.py` in `_auto_shard_impl` method when TensorFlow tries to shard file names. Unfortunately, I don't clearly understand this command to be honest: \r\n\r\n```\r\n sharded_filenames_tensor = array_ops.gather(\r\n            filenames_tensor, math_ops.range(index, num_files, num_shards))\r\n```\r\n"}