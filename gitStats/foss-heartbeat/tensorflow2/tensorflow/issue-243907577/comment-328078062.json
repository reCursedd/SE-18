{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/328078062", "html_url": "https://github.com/tensorflow/tensorflow/issues/11598#issuecomment-328078062", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11598", "id": 328078062, "node_id": "MDEyOklzc3VlQ29tbWVudDMyODA3ODA2Mg==", "user": {"login": "lecun", "id": 29295985, "node_id": "MDQ6VXNlcjI5Mjk1OTg1", "avatar_url": "https://avatars2.githubusercontent.com/u/29295985?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lecun", "html_url": "https://github.com/lecun", "followers_url": "https://api.github.com/users/lecun/followers", "following_url": "https://api.github.com/users/lecun/following{/other_user}", "gists_url": "https://api.github.com/users/lecun/gists{/gist_id}", "starred_url": "https://api.github.com/users/lecun/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lecun/subscriptions", "organizations_url": "https://api.github.com/users/lecun/orgs", "repos_url": "https://api.github.com/users/lecun/repos", "events_url": "https://api.github.com/users/lecun/events{/privacy}", "received_events_url": "https://api.github.com/users/lecun/received_events", "type": "User", "site_admin": false}, "created_at": "2017-09-08T11:23:15Z", "updated_at": "2017-09-08T11:23:15Z", "author_association": "NONE", "body_html": "<blockquote>\n<p>zhedongzheng commented on Jul 30 \u2022 edited<br>\nokay, the key is to:</p>\n<p>tile the encoder state separately for LSTMStateTuple<br>\nmake sure impute_finished is False<br>\nthe complete code is:<br>\n<a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=16261331\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/zhedongzheng\">@zhedongzheng</a><br>\nHi, Here why  should we make sure impute_finished is False.? I encounter an Error when I use impute_finished \uff1dTrue with BeamSearchDecoder using dynamic_decode . False , will be right without bug .The error points the shape of finished corresponding the  line 265 in <a href=\"https://github.com/tensorflow/tensorflow/blob/r1.3/tensorflow/contrib/seq2seq/python/ops/decoder.py\">https://github.com/tensorflow/tensorflow/blob/r1.3/tensorflow/contrib/seq2seq/python/ops/decoder.py</a><br>\nmy verison of tensorflow is r1.3.<br>\nlog:Err : Shapes must be equal rank, but are 3 and 2. detail here:<br>\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 286, in dynamic_decode<br>\nswap_memory=swap_memory)<br>\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2775, in while_loop<br>\nresult = context.BuildLoop(cond, body, loop_vars, shape_invariants)<br>\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2604, in BuildLoop<br>\npred, body, original_loop_vars, loop_vars, shape_invariants)<br>\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2554, in _BuildLoop<br>\nbody_result = body(*packed_vars_for_body)<br>\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 269, in body<br>\n_maybe_copy_state, decoder_state, state)<br>\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/util/nest.py\", line 379, in map_structure<br>\nstructure[0], [func(*x) for x in entries])<br>\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 265, in _maybe_copy_state<br>\nreturn new if pass_through else array_ops.where(finished, cur, new)<br>\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/ops/array_ops.py\", line 2367, in where<br>\nreturn gen_math_ops._select(condition=condition, t=x, e=y, name=name)<br>\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 2255, in _select<br>\nname=name)<br>\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 767, in apply_op<br>\nop_def=op_def)<br>\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2632, in create_op<br>\nset_shapes_for_outputs(ret)<br>\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1911, in set_shapes_for_outputs<br>\nshapes = shape_func(op)<br>\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1861, in call_with_requiring<br>\nreturn call_cpp_shape_fn(op, require_shape_fn=True)<br>\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/framework/common_shapes.py\", line 595, in call_cpp_shape_fn<br>\nrequire_shape_fn)<br>\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/framework/common_shapes.py\", line 659, in _call_cpp_shape_fn_impl<br>\nraise ValueError(err.message)</p>\n</blockquote>", "body_text": "zhedongzheng commented on Jul 30 \u2022 edited\nokay, the key is to:\ntile the encoder state separately for LSTMStateTuple\nmake sure impute_finished is False\nthe complete code is:\n@zhedongzheng\nHi, Here why  should we make sure impute_finished is False.? I encounter an Error when I use impute_finished \uff1dTrue with BeamSearchDecoder using dynamic_decode . False , will be right without bug .The error points the shape of finished corresponding the  line 265 in https://github.com/tensorflow/tensorflow/blob/r1.3/tensorflow/contrib/seq2seq/python/ops/decoder.py\nmy verison of tensorflow is r1.3.\nlog:Err : Shapes must be equal rank, but are 3 and 2. detail here:\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 286, in dynamic_decode\nswap_memory=swap_memory)\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2775, in while_loop\nresult = context.BuildLoop(cond, body, loop_vars, shape_invariants)\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2604, in BuildLoop\npred, body, original_loop_vars, loop_vars, shape_invariants)\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2554, in _BuildLoop\nbody_result = body(*packed_vars_for_body)\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 269, in body\n_maybe_copy_state, decoder_state, state)\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/util/nest.py\", line 379, in map_structure\nstructure[0], [func(*x) for x in entries])\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 265, in _maybe_copy_state\nreturn new if pass_through else array_ops.where(finished, cur, new)\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/ops/array_ops.py\", line 2367, in where\nreturn gen_math_ops._select(condition=condition, t=x, e=y, name=name)\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 2255, in _select\nname=name)\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 767, in apply_op\nop_def=op_def)\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2632, in create_op\nset_shapes_for_outputs(ret)\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1911, in set_shapes_for_outputs\nshapes = shape_func(op)\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1861, in call_with_requiring\nreturn call_cpp_shape_fn(op, require_shape_fn=True)\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/framework/common_shapes.py\", line 595, in call_cpp_shape_fn\nrequire_shape_fn)\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/framework/common_shapes.py\", line 659, in _call_cpp_shape_fn_impl\nraise ValueError(err.message)", "body": "\r\n\r\n\r\n\r\n> zhedongzheng commented on Jul 30 \u2022 edited\r\n> okay, the key is to:\r\n> \r\n> tile the encoder state separately for LSTMStateTuple\r\n> make sure impute_finished is False\r\n> the complete code is:\r\n@zhedongzheng \r\nHi, Here why  should we make sure impute_finished is False.? I encounter an Error when I use impute_finished \uff1dTrue with BeamSearchDecoder using dynamic_decode . False , will be right without bug .The error points the shape of finished corresponding the  line 265 in https://github.com/tensorflow/tensorflow/blob/r1.3/tensorflow/contrib/seq2seq/python/ops/decoder.py\r\nmy verison of tensorflow is r1.3.\r\nlog:Err : Shapes must be equal rank, but are 3 and 2. detail here:\r\nFile \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 286, in dynamic_decode\r\n    swap_memory=swap_memory)\r\n  File \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2775, in while_loop\r\n    result = context.BuildLoop(cond, body, loop_vars, shape_invariants)\r\n  File \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2604, in BuildLoop\r\n    pred, body, original_loop_vars, loop_vars, shape_invariants)\r\n  File \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2554, in _BuildLoop\r\n    body_result = body(*packed_vars_for_body)\r\n  File \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 269, in body\r\n    _maybe_copy_state, decoder_state, state)\r\n  File \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/util/nest.py\", line 379, in map_structure\r\n    structure[0], [func(*x) for x in entries])\r\n  File \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 265, in _maybe_copy_state\r\n    return new if pass_through else array_ops.where(finished, cur, new)\r\n  File \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/ops/array_ops.py\", line 2367, in where\r\n    return gen_math_ops._select(condition=condition, t=x, e=y, name=name)\r\n  File \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 2255, in _select\r\n    name=name)\r\n  File \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 767, in apply_op\r\n    op_def=op_def)\r\n  File \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2632, in create_op\r\n    set_shapes_for_outputs(ret)\r\n  File \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1911, in set_shapes_for_outputs\r\n    shapes = shape_func(op)\r\n  File \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1861, in call_with_requiring\r\n    return call_cpp_shape_fn(op, require_shape_fn=True)\r\n  File \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/framework/common_shapes.py\", line 595, in call_cpp_shape_fn\r\n    require_shape_fn)\r\n  File \"/home/aisp/virtualenv/tensflow/local/lib/python2.7/site-packages/tensorflow/python/framework/common_shapes.py\", line 659, in _call_cpp_shape_fn_impl\r\n    raise ValueError(err.message)"}