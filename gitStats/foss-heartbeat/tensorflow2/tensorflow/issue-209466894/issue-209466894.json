{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7779", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7779/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7779/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7779/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/7779", "id": 209466894, "node_id": "MDU6SXNzdWUyMDk0NjY4OTQ=", "number": 7779, "title": "tensorflow custom op : user_ops", "user": {"login": "deeptensorflow", "id": 25359442, "node_id": "MDQ6VXNlcjI1MzU5NDQy", "avatar_url": "https://avatars3.githubusercontent.com/u/25359442?v=4", "gravatar_id": "", "url": "https://api.github.com/users/deeptensorflow", "html_url": "https://github.com/deeptensorflow", "followers_url": "https://api.github.com/users/deeptensorflow/followers", "following_url": "https://api.github.com/users/deeptensorflow/following{/other_user}", "gists_url": "https://api.github.com/users/deeptensorflow/gists{/gist_id}", "starred_url": "https://api.github.com/users/deeptensorflow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/deeptensorflow/subscriptions", "organizations_url": "https://api.github.com/users/deeptensorflow/orgs", "repos_url": "https://api.github.com/users/deeptensorflow/repos", "events_url": "https://api.github.com/users/deeptensorflow/events{/privacy}", "received_events_url": "https://api.github.com/users/deeptensorflow/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586558, "node_id": "MDU6TGFiZWw0MDQ1ODY1NTg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:community%20support", "name": "stat:community support", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-02-22T14:18:46Z", "updated_at": "2017-06-16T18:07:32Z", "closed_at": "2017-06-16T18:07:32Z", "author_association": "NONE", "body_html": "<p>I want to add my custom op.<br>\nso I read <a href=\"https://www.tensorflow.org/extend/adding_an_op\" rel=\"nofollow\">https://www.tensorflow.org/extend/adding_an_op</a>.<br>\nAnd then I tried to wirte down follow code with your tutorial.<br>\nfile name is zero_out.cc and path is ~/tensorflow/tensorflow/core/user_ops.</p>\n<pre><code>#include \"tensorflow/core/framework/op.h\"\n#include \"tensorflow/core/framework/shape_inference.h\"\n#include \"tensorflow/core/framework/op_kernel.h\"\n\nusing namespace tensorflow;\n\nREGISTER_OP(\"ZeroOut\")\n    .Input(\"to_zero: int32\")\n    .Output(\"zeroed: int32\")\n    .SetShapeFn([](::tensorflow::shape_inference::InferenceContext* c) {\n      c-&gt;set_output(0, c-&gt;input(0));\n      return Status::OK();\n    });\n\nclass ZeroOutOp : public OpKernel {\n public:\n  explicit ZeroOutOp(OpKernelConstruction* context) : OpKernel(context) {}\n  void Compute(OpKernelContext* context) override {\n    // Grab the input tensor\n    const Tensor&amp; input_tensor = context-&gt;input(0);\n    auto input = input_tensor.flat&lt;int32&gt;();\n\n    // Create an output tensor\n    Tensor* output_tensor = NULL;\n    OP_REQUIRES_OK(context, context-&gt;allocate_output(0, input_tensor.shape(),\n                                                     &amp;output_tensor));\n    auto output = output_tensor-&gt;flat&lt;int32&gt;();\n\n    // Set all but the first element of the output tensor to 0.\n    const int N = input.size();\n    for (int i = 1; i &lt; N; i++) {\n      output(i) = 0;\n    }\n\n    // Preserve the first input value if possible.\n    if (N &gt; 0) output(0) = input(0);\n  }\n};\n\nREGISTER_KERNEL_BUILDER(Name(\"ZeroOut\").Device(DEVICE_CPU), ZeroOutOp);\n</code></pre>\n<p>And I made BUILD file in same path.</p>\n<pre><code>load(\"//tensorflow:tensorflow.bzl\", \"tf_custom_op_library\")\n\ntf_custom_op_library(\n    name = \"zero_out.so\",\n    srcs = [\"zero_out.cc\"],\n)\n</code></pre>\n<p>And then, follow your tutorial, I build with bazel.<br>\nI wrote this command on ~/tensorflow.<br>\n<code>bazel build --config opt //tensorflow/core/user_ops:zero_out.so</code></p>\n<p>complete massage is here.<br>\n<code>Target //tensorflow/core/user_ops:zero_out.so up-to-date: bazel-bin/tensorflow/core/user_ops/zero_out.so</code></p>\n<p>and I put the exactly same tutorial code but it doesn't work.</p>\n<pre><code>import tensorflow as tf\nzero_out_module = tf.load_op_library('zero_out.so')\nwith tf.Session(''):\n  zero_out_module.zero_out([[1, 2], [3, 4]]).eval()\n</code></pre>\n<p>error massage is this.<br>\n<code>Traceback (most recent call last): File \"/Users/buginus/tf_installwithpip3/Study_TensorFlow/01 - LinearRegression/hi.py\", line 2, in &lt;module&gt; zero_out_module = tf.load_op_library('zero_out.so') File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/framework/load_library.py\", line 64, in load_op_library None, None, error_msg, error_code) tensorflow.python.framework.errors_impl.NotFoundError: dlopen(zero_out.so, 6): image not found</code></p>", "body_text": "I want to add my custom op.\nso I read https://www.tensorflow.org/extend/adding_an_op.\nAnd then I tried to wirte down follow code with your tutorial.\nfile name is zero_out.cc and path is ~/tensorflow/tensorflow/core/user_ops.\n#include \"tensorflow/core/framework/op.h\"\n#include \"tensorflow/core/framework/shape_inference.h\"\n#include \"tensorflow/core/framework/op_kernel.h\"\n\nusing namespace tensorflow;\n\nREGISTER_OP(\"ZeroOut\")\n    .Input(\"to_zero: int32\")\n    .Output(\"zeroed: int32\")\n    .SetShapeFn([](::tensorflow::shape_inference::InferenceContext* c) {\n      c->set_output(0, c->input(0));\n      return Status::OK();\n    });\n\nclass ZeroOutOp : public OpKernel {\n public:\n  explicit ZeroOutOp(OpKernelConstruction* context) : OpKernel(context) {}\n  void Compute(OpKernelContext* context) override {\n    // Grab the input tensor\n    const Tensor& input_tensor = context->input(0);\n    auto input = input_tensor.flat<int32>();\n\n    // Create an output tensor\n    Tensor* output_tensor = NULL;\n    OP_REQUIRES_OK(context, context->allocate_output(0, input_tensor.shape(),\n                                                     &output_tensor));\n    auto output = output_tensor->flat<int32>();\n\n    // Set all but the first element of the output tensor to 0.\n    const int N = input.size();\n    for (int i = 1; i < N; i++) {\n      output(i) = 0;\n    }\n\n    // Preserve the first input value if possible.\n    if (N > 0) output(0) = input(0);\n  }\n};\n\nREGISTER_KERNEL_BUILDER(Name(\"ZeroOut\").Device(DEVICE_CPU), ZeroOutOp);\n\nAnd I made BUILD file in same path.\nload(\"//tensorflow:tensorflow.bzl\", \"tf_custom_op_library\")\n\ntf_custom_op_library(\n    name = \"zero_out.so\",\n    srcs = [\"zero_out.cc\"],\n)\n\nAnd then, follow your tutorial, I build with bazel.\nI wrote this command on ~/tensorflow.\nbazel build --config opt //tensorflow/core/user_ops:zero_out.so\ncomplete massage is here.\nTarget //tensorflow/core/user_ops:zero_out.so up-to-date: bazel-bin/tensorflow/core/user_ops/zero_out.so\nand I put the exactly same tutorial code but it doesn't work.\nimport tensorflow as tf\nzero_out_module = tf.load_op_library('zero_out.so')\nwith tf.Session(''):\n  zero_out_module.zero_out([[1, 2], [3, 4]]).eval()\n\nerror massage is this.\nTraceback (most recent call last): File \"/Users/buginus/tf_installwithpip3/Study_TensorFlow/01 - LinearRegression/hi.py\", line 2, in <module> zero_out_module = tf.load_op_library('zero_out.so') File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/framework/load_library.py\", line 64, in load_op_library None, None, error_msg, error_code) tensorflow.python.framework.errors_impl.NotFoundError: dlopen(zero_out.so, 6): image not found", "body": "I want to add my custom op.\r\nso I read https://www.tensorflow.org/extend/adding_an_op.\r\nAnd then I tried to wirte down follow code with your tutorial.\r\nfile name is zero_out.cc and path is ~/tensorflow/tensorflow/core/user_ops.\r\n```\r\n#include \"tensorflow/core/framework/op.h\"\r\n#include \"tensorflow/core/framework/shape_inference.h\"\r\n#include \"tensorflow/core/framework/op_kernel.h\"\r\n\r\nusing namespace tensorflow;\r\n\r\nREGISTER_OP(\"ZeroOut\")\r\n    .Input(\"to_zero: int32\")\r\n    .Output(\"zeroed: int32\")\r\n    .SetShapeFn([](::tensorflow::shape_inference::InferenceContext* c) {\r\n      c->set_output(0, c->input(0));\r\n      return Status::OK();\r\n    });\r\n\r\nclass ZeroOutOp : public OpKernel {\r\n public:\r\n  explicit ZeroOutOp(OpKernelConstruction* context) : OpKernel(context) {}\r\n  void Compute(OpKernelContext* context) override {\r\n    // Grab the input tensor\r\n    const Tensor& input_tensor = context->input(0);\r\n    auto input = input_tensor.flat<int32>();\r\n\r\n    // Create an output tensor\r\n    Tensor* output_tensor = NULL;\r\n    OP_REQUIRES_OK(context, context->allocate_output(0, input_tensor.shape(),\r\n                                                     &output_tensor));\r\n    auto output = output_tensor->flat<int32>();\r\n\r\n    // Set all but the first element of the output tensor to 0.\r\n    const int N = input.size();\r\n    for (int i = 1; i < N; i++) {\r\n      output(i) = 0;\r\n    }\r\n\r\n    // Preserve the first input value if possible.\r\n    if (N > 0) output(0) = input(0);\r\n  }\r\n};\r\n\r\nREGISTER_KERNEL_BUILDER(Name(\"ZeroOut\").Device(DEVICE_CPU), ZeroOutOp);\r\n```\r\n\r\nAnd I made BUILD file in same path.\r\n```\r\nload(\"//tensorflow:tensorflow.bzl\", \"tf_custom_op_library\")\r\n\r\ntf_custom_op_library(\r\n    name = \"zero_out.so\",\r\n    srcs = [\"zero_out.cc\"],\r\n)\r\n```\r\n\r\n\r\nAnd then, follow your tutorial, I build with bazel.\r\nI wrote this command on ~/tensorflow.\r\n`bazel build --config opt //tensorflow/core/user_ops:zero_out.so`\r\n\r\ncomplete massage is here.\r\n`Target //tensorflow/core/user_ops:zero_out.so up-to-date:\r\n  bazel-bin/tensorflow/core/user_ops/zero_out.so`\r\n\r\nand I put the exactly same tutorial code but it doesn't work.\r\n```\r\nimport tensorflow as tf\r\nzero_out_module = tf.load_op_library('zero_out.so')\r\nwith tf.Session(''):\r\n  zero_out_module.zero_out([[1, 2], [3, 4]]).eval()\r\n```\r\n\r\n\r\nerror massage is this.\r\n`Traceback (most recent call last):\r\n  File \"/Users/buginus/tf_installwithpip3/Study_TensorFlow/01 - LinearRegression/hi.py\", line 2, in <module>\r\n    zero_out_module = tf.load_op_library('zero_out.so')\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/framework/load_library.py\", line 64, in load_op_library\r\n    None, None, error_msg, error_code)\r\ntensorflow.python.framework.errors_impl.NotFoundError: dlopen(zero_out.so, 6): image not found`"}