{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11961", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11961/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11961/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11961/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/11961", "id": 247281271, "node_id": "MDU6SXNzdWUyNDcyODEyNzE=", "number": 11961, "title": "timeout breaks FIFOQueue", "user": {"login": "liuquande", "id": 29408526, "node_id": "MDQ6VXNlcjI5NDA4NTI2", "avatar_url": "https://avatars1.githubusercontent.com/u/29408526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/liuquande", "html_url": "https://github.com/liuquande", "followers_url": "https://api.github.com/users/liuquande/followers", "following_url": "https://api.github.com/users/liuquande/following{/other_user}", "gists_url": "https://api.github.com/users/liuquande/gists{/gist_id}", "starred_url": "https://api.github.com/users/liuquande/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/liuquande/subscriptions", "organizations_url": "https://api.github.com/users/liuquande/orgs", "repos_url": "https://api.github.com/users/liuquande/repos", "events_url": "https://api.github.com/users/liuquande/events{/privacy}", "received_events_url": "https://api.github.com/users/liuquande/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-08-02T05:59:08Z", "updated_at": "2017-08-02T16:02:36Z", "closed_at": "2017-08-02T16:02:36Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li>Linux Ubuntu 14.04</li>\n<li>TensorFlow installed from <a href=\"https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.2.1-cp27-none-linux_x86_64.whl\" rel=\"nofollow\">https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.2.1-cp27-none-linux_x86_64.whl</a></li>\n<li>Tensorflow-gpu 1.2.1</li>\n<li>Python version 2.7</li>\n<li>CUDA 8.0 /cuDNN 5.1.10</li>\n<li>GPU - Nvidia GTX 1080</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>I use thread to add my training data to a FIFO Queue. There is always an thread error occurring in the process of my training.</p>\n<h3>Source code / logs</h3>\n<p>Here is my source code relevant to the error:</p>\n<div class=\"highlight highlight-source-js\"><pre><span class=\"pl-k\">with</span> <span class=\"pl-smi\">tf</span>.<span class=\"pl-en\">Session</span>() as sess<span class=\"pl-k\">:</span>\n    <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">q</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">tf</span>.<span class=\"pl-en\">FIFOQueue</span>(<span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">queue_capacity</span>, [<span class=\"pl-smi\">tf</span>.<span class=\"pl-smi\">float32</span>, <span class=\"pl-smi\">tf</span>.<span class=\"pl-smi\">float32</span>, train_label_dtype], shapes<span class=\"pl-k\">=</span>[(<span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_batch_size</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">im_height</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">im_width</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">num_tensor_channels</span>), (<span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_batch_size</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">pose_dim</span>), (<span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_batch_size</span>,)])\n    <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">enqueue_op</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">q</span>.<span class=\"pl-en\">enqueue</span>([<span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_data_batch</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_poses_batch</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_labels_batch</span>])\n    <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_labels_node</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">tf</span>.<span class=\"pl-en\">placeholder</span>(train_label_dtype, (<span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_batch_size</span>,))\n    <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">input_im_node</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">input_pose_node</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_labels_node</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">q</span>.<span class=\"pl-en\">dequeue</span>()\n\n    <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">queue_thread</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">threading</span>.<span class=\"pl-en\">Thread</span>(target<span class=\"pl-k\">=</span><span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">_load_and_enqueue</span>)\n    <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">queue_thread</span>.<span class=\"pl-c1\">start</span>()\n\n    <span class=\"pl-k\">for</span> step <span class=\"pl-k\">in</span> training_range<span class=\"pl-k\">:</span>\n    \t<span class=\"pl-smi\">self</span>.<span class=\"pl-en\">_check_dead_queue</span>()\n    \t<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-pds\">\"</span><span class=\"pl-pds\">\"</span>run optimization<span class=\"pl-pds\">\"</span><span class=\"pl-pds\">\"</span><span class=\"pl-pds\">\"</span></span>\n    \t_, l, lr, predictions, batch_labels, output, train_images, conv1_1W, conv1_1b, pose_node <span class=\"pl-k\">=</span> <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">sess</span>.<span class=\"pl-en\">run</span>(\n    \t\t[optimizer, loss, learning_rate, train_predictions, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_labels_node</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_net_output</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">input_im_node</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">weights</span>.<span class=\"pl-smi\">conv1_1W</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">weights</span>.<span class=\"pl-smi\">conv1_1b</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">input_pose_node</span>], options<span class=\"pl-k\">=</span><span class=\"pl-smi\">GeneralConstants</span>.<span class=\"pl-smi\">timeout_option</span>)\n\ndef <span class=\"pl-en\">_load_and_enqueue</span>(self)<span class=\"pl-k\">:</span>\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-pds\">\"</span><span class=\"pl-pds\">\"</span> Loads and Enqueues a batch of images for training <span class=\"pl-pds\">\"</span><span class=\"pl-pds\">\"</span><span class=\"pl-pds\">\"</span></span>\n\n        train_data <span class=\"pl-k\">=</span> <span class=\"pl-smi\">np</span>.<span class=\"pl-en\">zeros</span>(\n            [<span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_batch_size</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">im_height</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">im_width</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">num_tensor_channels</span>]).<span class=\"pl-en\">astype</span>(<span class=\"pl-smi\">np</span>.<span class=\"pl-smi\">float32</span>)\n        train_poses <span class=\"pl-k\">=</span> <span class=\"pl-smi\">np</span>.<span class=\"pl-en\">zeros</span>([<span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_batch_size</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">pose_dim</span>]).<span class=\"pl-en\">astype</span>(<span class=\"pl-smi\">np</span>.<span class=\"pl-smi\">float32</span>)\n        label_data <span class=\"pl-k\">=</span> <span class=\"pl-smi\">np</span>.<span class=\"pl-en\">zeros</span>(<span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_batch_size</span>).<span class=\"pl-en\">astype</span>(<span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">numpy_dtype</span>)\n\n        <span class=\"pl-k\">while</span> not <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">term_event</span>.<span class=\"pl-en\">is_set</span>()<span class=\"pl-k\">:</span>\n            <span class=\"pl-smi\">time</span>.<span class=\"pl-en\">sleep</span>(<span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">cfg</span>[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>queue_sleep<span class=\"pl-pds\">'</span></span>])\n\n            # Omit the code <span class=\"pl-k\">for</span> geeting data\n\n            # send data to queue\n            <span class=\"pl-k\">if</span> not <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">term_event</span>.<span class=\"pl-en\">is_set</span>()<span class=\"pl-k\">:</span>\n                try<span class=\"pl-k\">:</span>\n                    <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">sess</span>.<span class=\"pl-en\">run</span>(<span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">enqueue_op</span>, feed_dict<span class=\"pl-k\">=</span>{<span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_data_batch</span><span class=\"pl-k\">:</span> train_data,\n                                                              <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_poses_batch</span><span class=\"pl-k\">:</span> train_poses,\n                                                              <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_labels_batch</span><span class=\"pl-k\">:</span> label_data})\n                except<span class=\"pl-k\">:</span>\n                    pass\n        del train_data\n        del train_poses\n        del label_data\n        <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">dead_event</span>.<span class=\"pl-c1\">set</span>()\n        <span class=\"pl-smi\">logging</span>.<span class=\"pl-en\">info</span>(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>Queue Thread Exiting<span class=\"pl-pds\">'</span></span>)\n        <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">queue_thread_exited</span> <span class=\"pl-k\">=</span> True\n</pre></div>\n<p>When I train the model for some time, there will be an error:</p>\n<div class=\"highlight highlight-source-js\"><pre><span class=\"pl-c1\">INFO</span><span class=\"pl-k\">:</span>root<span class=\"pl-k\">:</span>Step <span class=\"pl-ii\">41817</span> (epoch <span class=\"pl-c1\">3.35</span>), <span class=\"pl-c1\">0.1</span> s\n<span class=\"pl-c1\">INFO</span><span class=\"pl-k\">:</span>root<span class=\"pl-k\">:</span>Minibatch loss<span class=\"pl-k\">:</span> <span class=\"pl-c1\">1.256</span>, learning rate<span class=\"pl-k\">:</span> <span class=\"pl-c1\">0.000857</span>\n<span class=\"pl-c1\">INFO</span><span class=\"pl-k\">:</span>root<span class=\"pl-k\">:</span>Minibatch error<span class=\"pl-k\">:</span> <span class=\"pl-c1\">26.562</span><span class=\"pl-k\">%</span>\n<span class=\"pl-c1\">INFO</span><span class=\"pl-k\">:</span>root<span class=\"pl-k\">:</span>Step <span class=\"pl-ii\">41818</span> (epoch <span class=\"pl-c1\">3.35</span>), <span class=\"pl-c1\">0.1</span> s\n<span class=\"pl-c1\">INFO</span><span class=\"pl-k\">:</span>root<span class=\"pl-k\">:</span>Minibatch loss<span class=\"pl-k\">:</span> <span class=\"pl-c1\">1.790</span>, learning rate<span class=\"pl-k\">:</span> <span class=\"pl-c1\">0.000857</span>\n<span class=\"pl-c1\">INFO</span><span class=\"pl-k\">:</span>root<span class=\"pl-k\">:</span>Minibatch error<span class=\"pl-k\">:</span> <span class=\"pl-c1\">59.375</span><span class=\"pl-k\">%</span>\n<span class=\"pl-c1\">INFO</span><span class=\"pl-k\">:</span>root<span class=\"pl-k\">:</span>Step <span class=\"pl-ii\">41819</span> (epoch <span class=\"pl-c1\">3.35</span>), <span class=\"pl-c1\">0.1</span> s\n<span class=\"pl-c1\">INFO</span><span class=\"pl-k\">:</span>root<span class=\"pl-k\">:</span>Minibatch loss<span class=\"pl-k\">:</span> <span class=\"pl-c1\">0.868</span>, learning rate<span class=\"pl-k\">:</span> <span class=\"pl-c1\">0.000857</span>\n<span class=\"pl-c1\">INFO</span><span class=\"pl-k\">:</span>root<span class=\"pl-k\">:</span>Minibatch error<span class=\"pl-k\">:</span> <span class=\"pl-c1\">3.125</span><span class=\"pl-k\">%</span>\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">08</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">02</span> <span class=\"pl-c1\">07</span><span class=\"pl-k\">:</span><span class=\"pl-c1\">26</span><span class=\"pl-k\">:</span><span class=\"pl-c1\">54.769345</span><span class=\"pl-k\">:</span> <span class=\"pl-c1\">W</span> tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span><span class=\"pl-smi\">queue_base</span>.<span class=\"pl-smi\">cc</span><span class=\"pl-k\">:</span><span class=\"pl-c1\">302</span>] _0_data_queue<span class=\"pl-k\">/</span>fifo_queue<span class=\"pl-k\">:</span> Skipping cancelled dequeue attempt <span class=\"pl-k\">with</span> queue not closed\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">08</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">02</span> <span class=\"pl-c1\">07</span><span class=\"pl-k\">:</span><span class=\"pl-c1\">26</span><span class=\"pl-k\">:</span><span class=\"pl-c1\">54.769537</span><span class=\"pl-k\">:</span> <span class=\"pl-c1\">W</span> tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>framework<span class=\"pl-k\">/</span><span class=\"pl-smi\">op_kernel</span>.<span class=\"pl-smi\">cc</span><span class=\"pl-k\">:</span><span class=\"pl-c1\">1158</span>] Cancelled<span class=\"pl-k\">:</span> Dequeue operation was cancelled\n\t [[<span class=\"pl-c1\">Node</span><span class=\"pl-k\">:</span> data_queue<span class=\"pl-k\">/</span>fifo_queue_Dequeue <span class=\"pl-k\">=</span> QueueDequeueV2[component_types<span class=\"pl-k\">=</span>[<span class=\"pl-c1\">DT_FLOAT</span>, <span class=\"pl-c1\">DT_FLOAT</span>, <span class=\"pl-c1\">DT_INT64</span>], timeout_ms<span class=\"pl-k\">=</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>, _device<span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/job:localhost/replica:0/task:0/cpu:0<span class=\"pl-pds\">\"</span></span>](data_queue<span class=\"pl-k\">/</span>fifo_queue)]]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">08</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">02</span> <span class=\"pl-c1\">07</span><span class=\"pl-k\">:</span><span class=\"pl-c1\">26</span><span class=\"pl-k\">:</span><span class=\"pl-c1\">54.769608</span><span class=\"pl-k\">:</span> <span class=\"pl-c1\">W</span> tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>framework<span class=\"pl-k\">/</span><span class=\"pl-smi\">op_kernel</span>.<span class=\"pl-smi\">cc</span><span class=\"pl-k\">:</span><span class=\"pl-c1\">1158</span>] Cancelled<span class=\"pl-k\">:</span> Dequeue operation was cancelled\n\t [[<span class=\"pl-c1\">Node</span><span class=\"pl-k\">:</span> data_queue<span class=\"pl-k\">/</span>fifo_queue_Dequeue <span class=\"pl-k\">=</span> QueueDequeueV2[component_types<span class=\"pl-k\">=</span>[<span class=\"pl-c1\">DT_FLOAT</span>, <span class=\"pl-c1\">DT_FLOAT</span>, <span class=\"pl-c1\">DT_INT64</span>], timeout_ms<span class=\"pl-k\">=</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>, _device<span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/job:localhost/replica:0/task:0/cpu:0<span class=\"pl-pds\">\"</span></span>](data_queue<span class=\"pl-k\">/</span>fifo_queue)]]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">08</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">02</span> <span class=\"pl-c1\">07</span><span class=\"pl-k\">:</span><span class=\"pl-c1\">26</span><span class=\"pl-k\">:</span><span class=\"pl-c1\">54.769715</span><span class=\"pl-k\">:</span> <span class=\"pl-c1\">W</span> tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>framework<span class=\"pl-k\">/</span><span class=\"pl-smi\">op_kernel</span>.<span class=\"pl-smi\">cc</span><span class=\"pl-k\">:</span><span class=\"pl-c1\">1158</span>] Cancelled<span class=\"pl-k\">:</span> Dequeue operation was cancelled\n\t [[<span class=\"pl-c1\">Node</span><span class=\"pl-k\">:</span> data_queue<span class=\"pl-k\">/</span>fifo_queue_Dequeue <span class=\"pl-k\">=</span> QueueDequeueV2[component_types<span class=\"pl-k\">=</span>[<span class=\"pl-c1\">DT_FLOAT</span>, <span class=\"pl-c1\">DT_FLOAT</span>, <span class=\"pl-c1\">DT_INT64</span>], timeout_ms<span class=\"pl-k\">=</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>, _device<span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/job:localhost/replica:0/task:0/cpu:0<span class=\"pl-pds\">\"</span></span>](data_queue<span class=\"pl-k\">/</span>fifo_queue)]]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">08</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">02</span> <span class=\"pl-c1\">07</span><span class=\"pl-k\">:</span><span class=\"pl-c1\">26</span><span class=\"pl-k\">:</span><span class=\"pl-c1\">54.769747</span><span class=\"pl-k\">:</span> <span class=\"pl-c1\">W</span> tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>framework<span class=\"pl-k\">/</span><span class=\"pl-smi\">op_kernel</span>.<span class=\"pl-smi\">cc</span><span class=\"pl-k\">:</span><span class=\"pl-c1\">1158</span>] Cancelled<span class=\"pl-k\">:</span> Dequeue operation was cancelled\n\t [[<span class=\"pl-c1\">Node</span><span class=\"pl-k\">:</span> data_queue<span class=\"pl-k\">/</span>fifo_queue_Dequeue <span class=\"pl-k\">=</span> QueueDequeueV2[component_types<span class=\"pl-k\">=</span>[<span class=\"pl-c1\">DT_FLOAT</span>, <span class=\"pl-c1\">DT_FLOAT</span>, <span class=\"pl-c1\">DT_INT64</span>], timeout_ms<span class=\"pl-k\">=</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>, _device<span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/job:localhost/replica:0/task:0/cpu:0<span class=\"pl-pds\">\"</span></span>](data_queue<span class=\"pl-k\">/</span>fifo_queue)]]\n<span class=\"pl-en\">Traceback</span> (most recent call last)<span class=\"pl-k\">:</span>\n  <span class=\"pl-c1\">File</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>training.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">269</span>, <span class=\"pl-k\">in</span> <span class=\"pl-k\">&lt;</span><span class=\"pl-c1\">module</span><span class=\"pl-k\">&gt;</span>\n    <span class=\"pl-smi\">sgdOptimizer</span>.<span class=\"pl-en\">optimize</span>()\n  <span class=\"pl-c1\">File</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/liuquande/Desktop/SenceTime/gqcnn/test/gqcnn/sgd_optimizer.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">254</span>, <span class=\"pl-k\">in</span> optimize\n    [optimizer, loss, learning_rate, train_predictions, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_labels_node</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">train_net_output</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">input_im_node</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">weights</span>.<span class=\"pl-smi\">conv1_1W</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">weights</span>.<span class=\"pl-smi\">conv1_1b</span>, <span class=\"pl-smi\">self</span>.<span class=\"pl-smi\">input_pose_node</span>], options<span class=\"pl-k\">=</span><span class=\"pl-smi\">GeneralConstants</span>.<span class=\"pl-smi\">timeout_option</span>)\n  <span class=\"pl-c1\">File</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">789</span>, <span class=\"pl-k\">in</span> run\n    run_metadata_ptr)\n  <span class=\"pl-c1\">File</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">997</span>, <span class=\"pl-k\">in</span> _run\n    feed_dict_string, options, run_metadata)\n  <span class=\"pl-c1\">File</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">1132</span>, <span class=\"pl-k\">in</span> _do_run\n    target_list, options, run_metadata)\n  <span class=\"pl-c1\">File</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">1152</span>, <span class=\"pl-k\">in</span> _do_call\n    raise <span class=\"pl-en\">type</span>(e)(node_def, op, message)\n<span class=\"pl-smi\">tensorflow</span>.<span class=\"pl-smi\">python</span>.<span class=\"pl-smi\">framework</span>.<span class=\"pl-smi\">errors_impl</span>.<span class=\"pl-smi\">DeadlineExceededError</span><span class=\"pl-k\">:</span> Timed out waiting <span class=\"pl-k\">for</span> notification\n<span class=\"pl-c1\">INFO</span><span class=\"pl-k\">:</span>root<span class=\"pl-k\">:</span>Queue Thread Exiting\n<span class=\"pl-c1\">INFO</span><span class=\"pl-k\">:</span><span class=\"pl-smi\">rospy</span>.<span class=\"pl-smi\">core</span><span class=\"pl-k\">:</span>signal_shutdown [atexit]</pre></div>", "body_text": "System information\n\nLinux Ubuntu 14.04\nTensorFlow installed from https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.2.1-cp27-none-linux_x86_64.whl\nTensorflow-gpu 1.2.1\nPython version 2.7\nCUDA 8.0 /cuDNN 5.1.10\nGPU - Nvidia GTX 1080\n\nDescribe the problem\nI use thread to add my training data to a FIFO Queue. There is always an thread error occurring in the process of my training.\nSource code / logs\nHere is my source code relevant to the error:\nwith tf.Session() as sess:\n    self.q = tf.FIFOQueue(self.queue_capacity, [tf.float32, tf.float32, train_label_dtype], shapes=[(self.train_batch_size, self.im_height, self.im_width, self.num_tensor_channels), (self.train_batch_size, self.pose_dim), (self.train_batch_size,)])\n    self.enqueue_op = self.q.enqueue([self.train_data_batch, self.train_poses_batch, self.train_labels_batch])\n    self.train_labels_node = tf.placeholder(train_label_dtype, (self.train_batch_size,))\n    self.input_im_node, self.input_pose_node, self.train_labels_node = self.q.dequeue()\n\n    self.queue_thread = threading.Thread(target=self._load_and_enqueue)\n    self.queue_thread.start()\n\n    for step in training_range:\n    \tself._check_dead_queue()\n    \t\"\"\"run optimization\"\"\"\n    \t_, l, lr, predictions, batch_labels, output, train_images, conv1_1W, conv1_1b, pose_node = self.sess.run(\n    \t\t[optimizer, loss, learning_rate, train_predictions, self.train_labels_node, self.train_net_output, self.input_im_node, self.weights.conv1_1W, self.weights.conv1_1b, self.input_pose_node], options=GeneralConstants.timeout_option)\n\ndef _load_and_enqueue(self):\n        \"\"\" Loads and Enqueues a batch of images for training \"\"\"\n\n        train_data = np.zeros(\n            [self.train_batch_size, self.im_height, self.im_width, self.num_tensor_channels]).astype(np.float32)\n        train_poses = np.zeros([self.train_batch_size, self.pose_dim]).astype(np.float32)\n        label_data = np.zeros(self.train_batch_size).astype(self.numpy_dtype)\n\n        while not self.term_event.is_set():\n            time.sleep(self.cfg['queue_sleep'])\n\n            # Omit the code for geeting data\n\n            # send data to queue\n            if not self.term_event.is_set():\n                try:\n                    self.sess.run(self.enqueue_op, feed_dict={self.train_data_batch: train_data,\n                                                              self.train_poses_batch: train_poses,\n                                                              self.train_labels_batch: label_data})\n                except:\n                    pass\n        del train_data\n        del train_poses\n        del label_data\n        self.dead_event.set()\n        logging.info('Queue Thread Exiting')\n        self.queue_thread_exited = True\n\nWhen I train the model for some time, there will be an error:\nINFO:root:Step 41817 (epoch 3.35), 0.1 s\nINFO:root:Minibatch loss: 1.256, learning rate: 0.000857\nINFO:root:Minibatch error: 26.562%\nINFO:root:Step 41818 (epoch 3.35), 0.1 s\nINFO:root:Minibatch loss: 1.790, learning rate: 0.000857\nINFO:root:Minibatch error: 59.375%\nINFO:root:Step 41819 (epoch 3.35), 0.1 s\nINFO:root:Minibatch loss: 0.868, learning rate: 0.000857\nINFO:root:Minibatch error: 3.125%\n2017-08-02 07:26:54.769345: W tensorflow/core/kernels/queue_base.cc:302] _0_data_queue/fifo_queue: Skipping cancelled dequeue attempt with queue not closed\n2017-08-02 07:26:54.769537: W tensorflow/core/framework/op_kernel.cc:1158] Cancelled: Dequeue operation was cancelled\n\t [[Node: data_queue/fifo_queue_Dequeue = QueueDequeueV2[component_types=[DT_FLOAT, DT_FLOAT, DT_INT64], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](data_queue/fifo_queue)]]\n2017-08-02 07:26:54.769608: W tensorflow/core/framework/op_kernel.cc:1158] Cancelled: Dequeue operation was cancelled\n\t [[Node: data_queue/fifo_queue_Dequeue = QueueDequeueV2[component_types=[DT_FLOAT, DT_FLOAT, DT_INT64], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](data_queue/fifo_queue)]]\n2017-08-02 07:26:54.769715: W tensorflow/core/framework/op_kernel.cc:1158] Cancelled: Dequeue operation was cancelled\n\t [[Node: data_queue/fifo_queue_Dequeue = QueueDequeueV2[component_types=[DT_FLOAT, DT_FLOAT, DT_INT64], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](data_queue/fifo_queue)]]\n2017-08-02 07:26:54.769747: W tensorflow/core/framework/op_kernel.cc:1158] Cancelled: Dequeue operation was cancelled\n\t [[Node: data_queue/fifo_queue_Dequeue = QueueDequeueV2[component_types=[DT_FLOAT, DT_FLOAT, DT_INT64], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](data_queue/fifo_queue)]]\nTraceback (most recent call last):\n  File \"training.py\", line 269, in <module>\n    sgdOptimizer.optimize()\n  File \"/home/liuquande/Desktop/SenceTime/gqcnn/test/gqcnn/sgd_optimizer.py\", line 254, in optimize\n    [optimizer, loss, learning_rate, train_predictions, self.train_labels_node, self.train_net_output, self.input_im_node, self.weights.conv1_1W, self.weights.conv1_1b, self.input_pose_node], options=GeneralConstants.timeout_option)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 789, in run\n    run_metadata_ptr)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 997, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1132, in _do_run\n    target_list, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1152, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.DeadlineExceededError: Timed out waiting for notification\nINFO:root:Queue Thread Exiting\nINFO:rospy.core:signal_shutdown [atexit]", "body": "### System information\r\n-  Linux Ubuntu 14.04\r\n-  TensorFlow installed from https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.2.1-cp27-none-linux_x86_64.whl\r\n-  Tensorflow-gpu 1.2.1\r\n-  Python version 2.7\r\n-  CUDA 8.0 /cuDNN 5.1.10\r\n-  GPU - Nvidia GTX 1080\r\n\r\n### Describe the problem\r\nI use thread to add my training data to a FIFO Queue. There is always an thread error occurring in the process of my training.\r\n\r\n### Source code / logs\r\nHere is my source code relevant to the error:\r\n```js\r\nwith tf.Session() as sess:\r\n    self.q = tf.FIFOQueue(self.queue_capacity, [tf.float32, tf.float32, train_label_dtype], shapes=[(self.train_batch_size, self.im_height, self.im_width, self.num_tensor_channels), (self.train_batch_size, self.pose_dim), (self.train_batch_size,)])\r\n    self.enqueue_op = self.q.enqueue([self.train_data_batch, self.train_poses_batch, self.train_labels_batch])\r\n    self.train_labels_node = tf.placeholder(train_label_dtype, (self.train_batch_size,))\r\n    self.input_im_node, self.input_pose_node, self.train_labels_node = self.q.dequeue()\r\n\r\n    self.queue_thread = threading.Thread(target=self._load_and_enqueue)\r\n    self.queue_thread.start()\r\n\r\n    for step in training_range:\r\n    \tself._check_dead_queue()\r\n    \t\"\"\"run optimization\"\"\"\r\n    \t_, l, lr, predictions, batch_labels, output, train_images, conv1_1W, conv1_1b, pose_node = self.sess.run(\r\n    \t\t[optimizer, loss, learning_rate, train_predictions, self.train_labels_node, self.train_net_output, self.input_im_node, self.weights.conv1_1W, self.weights.conv1_1b, self.input_pose_node], options=GeneralConstants.timeout_option)\r\n\r\ndef _load_and_enqueue(self):\r\n        \"\"\" Loads and Enqueues a batch of images for training \"\"\"\r\n\r\n        train_data = np.zeros(\r\n            [self.train_batch_size, self.im_height, self.im_width, self.num_tensor_channels]).astype(np.float32)\r\n        train_poses = np.zeros([self.train_batch_size, self.pose_dim]).astype(np.float32)\r\n        label_data = np.zeros(self.train_batch_size).astype(self.numpy_dtype)\r\n\r\n        while not self.term_event.is_set():\r\n            time.sleep(self.cfg['queue_sleep'])\r\n\r\n            # Omit the code for geeting data\r\n\r\n            # send data to queue\r\n            if not self.term_event.is_set():\r\n                try:\r\n                    self.sess.run(self.enqueue_op, feed_dict={self.train_data_batch: train_data,\r\n                                                              self.train_poses_batch: train_poses,\r\n                                                              self.train_labels_batch: label_data})\r\n                except:\r\n                    pass\r\n        del train_data\r\n        del train_poses\r\n        del label_data\r\n        self.dead_event.set()\r\n        logging.info('Queue Thread Exiting')\r\n        self.queue_thread_exited = True\r\n\r\n```\r\nWhen I train the model for some time, there will be an error:\r\n```js\r\nINFO:root:Step 41817 (epoch 3.35), 0.1 s\r\nINFO:root:Minibatch loss: 1.256, learning rate: 0.000857\r\nINFO:root:Minibatch error: 26.562%\r\nINFO:root:Step 41818 (epoch 3.35), 0.1 s\r\nINFO:root:Minibatch loss: 1.790, learning rate: 0.000857\r\nINFO:root:Minibatch error: 59.375%\r\nINFO:root:Step 41819 (epoch 3.35), 0.1 s\r\nINFO:root:Minibatch loss: 0.868, learning rate: 0.000857\r\nINFO:root:Minibatch error: 3.125%\r\n2017-08-02 07:26:54.769345: W tensorflow/core/kernels/queue_base.cc:302] _0_data_queue/fifo_queue: Skipping cancelled dequeue attempt with queue not closed\r\n2017-08-02 07:26:54.769537: W tensorflow/core/framework/op_kernel.cc:1158] Cancelled: Dequeue operation was cancelled\r\n\t [[Node: data_queue/fifo_queue_Dequeue = QueueDequeueV2[component_types=[DT_FLOAT, DT_FLOAT, DT_INT64], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](data_queue/fifo_queue)]]\r\n2017-08-02 07:26:54.769608: W tensorflow/core/framework/op_kernel.cc:1158] Cancelled: Dequeue operation was cancelled\r\n\t [[Node: data_queue/fifo_queue_Dequeue = QueueDequeueV2[component_types=[DT_FLOAT, DT_FLOAT, DT_INT64], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](data_queue/fifo_queue)]]\r\n2017-08-02 07:26:54.769715: W tensorflow/core/framework/op_kernel.cc:1158] Cancelled: Dequeue operation was cancelled\r\n\t [[Node: data_queue/fifo_queue_Dequeue = QueueDequeueV2[component_types=[DT_FLOAT, DT_FLOAT, DT_INT64], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](data_queue/fifo_queue)]]\r\n2017-08-02 07:26:54.769747: W tensorflow/core/framework/op_kernel.cc:1158] Cancelled: Dequeue operation was cancelled\r\n\t [[Node: data_queue/fifo_queue_Dequeue = QueueDequeueV2[component_types=[DT_FLOAT, DT_FLOAT, DT_INT64], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](data_queue/fifo_queue)]]\r\nTraceback (most recent call last):\r\n  File \"training.py\", line 269, in <module>\r\n    sgdOptimizer.optimize()\r\n  File \"/home/liuquande/Desktop/SenceTime/gqcnn/test/gqcnn/sgd_optimizer.py\", line 254, in optimize\r\n    [optimizer, loss, learning_rate, train_predictions, self.train_labels_node, self.train_net_output, self.input_im_node, self.weights.conv1_1W, self.weights.conv1_1b, self.input_pose_node], options=GeneralConstants.timeout_option)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 789, in run\r\n    run_metadata_ptr)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 997, in _run\r\n    feed_dict_string, options, run_metadata)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1132, in _do_run\r\n    target_list, options, run_metadata)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1152, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.DeadlineExceededError: Timed out waiting for notification\r\nINFO:root:Queue Thread Exiting\r\nINFO:rospy.core:signal_shutdown [atexit]\r\n```"}