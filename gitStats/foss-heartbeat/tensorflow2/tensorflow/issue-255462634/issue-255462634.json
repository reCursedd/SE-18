{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12836", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12836/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12836/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12836/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/12836", "id": 255462634, "node_id": "MDExOlB1bGxSZXF1ZXN0MTM5NDYwMDIx", "number": 12836, "title": "memory mapped file", "user": {"login": "cloudbank", "id": 2288294, "node_id": "MDQ6VXNlcjIyODgyOTQ=", "avatar_url": "https://avatars3.githubusercontent.com/u/2288294?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cloudbank", "html_url": "https://github.com/cloudbank", "followers_url": "https://api.github.com/users/cloudbank/followers", "following_url": "https://api.github.com/users/cloudbank/following{/other_user}", "gists_url": "https://api.github.com/users/cloudbank/gists{/gist_id}", "starred_url": "https://api.github.com/users/cloudbank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cloudbank/subscriptions", "organizations_url": "https://api.github.com/users/cloudbank/orgs", "repos_url": "https://api.github.com/users/cloudbank/repos", "events_url": "https://api.github.com/users/cloudbank/events{/privacy}", "received_events_url": "https://api.github.com/users/cloudbank/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}, {"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-09-06T02:34:26Z", "updated_at": "2017-09-07T03:01:17Z", "closed_at": "2017-09-07T03:01:17Z", "author_association": "NONE", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12836", "html_url": "https://github.com/tensorflow/tensorflow/pull/12836", "diff_url": "https://github.com/tensorflow/tensorflow/pull/12836.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/12836.patch"}, "body_html": "<p>This uses a FileChannel to map the model file for slightly faster IO. Because of the difficulty with assets in android, the files must be copied outside of the apk first and then read in.  I did not include that part, deciding it would be the onus of the parent application.   ctx.getFileStreamPath(model) is called in a static factory alongside what is already there for backward compatibility.  This means files must have been copied to the internal storage per ctx.getFilesDir().   Also it passed in the Application for context, taking care to recreate it as needed for reclaimed memory.<br>\nThis is a preliminary example of what could be changed.  I am disappointed that the mmap implementation in Java is very limited.  The byte[] of array() is not written to work with<br>\nMappedByteBuffer oddly, and asking for loaded state with load()  can kick off additional IO calls.<br>\nIt is working in my library but I will also continue to improve on it. I  also plan to add a native jni version as well which makes use of the mmap util to see which runs faster.<br>\nI backed out my static changes and will see if that works in another PR.</p>", "body_text": "This uses a FileChannel to map the model file for slightly faster IO. Because of the difficulty with assets in android, the files must be copied outside of the apk first and then read in.  I did not include that part, deciding it would be the onus of the parent application.   ctx.getFileStreamPath(model) is called in a static factory alongside what is already there for backward compatibility.  This means files must have been copied to the internal storage per ctx.getFilesDir().   Also it passed in the Application for context, taking care to recreate it as needed for reclaimed memory.\nThis is a preliminary example of what could be changed.  I am disappointed that the mmap implementation in Java is very limited.  The byte[] of array() is not written to work with\nMappedByteBuffer oddly, and asking for loaded state with load()  can kick off additional IO calls.\nIt is working in my library but I will also continue to improve on it. I  also plan to add a native jni version as well which makes use of the mmap util to see which runs faster.\nI backed out my static changes and will see if that works in another PR.", "body": "This uses a FileChannel to map the model file for slightly faster IO. Because of the difficulty with assets in android, the files must be copied outside of the apk first and then read in.  I did not include that part, deciding it would be the onus of the parent application.   ctx.getFileStreamPath(model) is called in a static factory alongside what is already there for backward compatibility.  This means files must have been copied to the internal storage per ctx.getFilesDir().   Also it passed in the Application for context, taking care to recreate it as needed for reclaimed memory.\r\nThis is a preliminary example of what could be changed.  I am disappointed that the mmap implementation in Java is very limited.  The byte[] of array() is not written to work with \r\nMappedByteBuffer oddly, and asking for loaded state with load()  can kick off additional IO calls.\r\nIt is working in my library but I will also continue to improve on it. I  also plan to add a native jni version as well which makes use of the mmap util to see which runs faster.\r\nI backed out my static changes and will see if that works in another PR."}