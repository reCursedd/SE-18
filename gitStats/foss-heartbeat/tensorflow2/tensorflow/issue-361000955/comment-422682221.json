{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/422682221", "html_url": "https://github.com/tensorflow/tensorflow/issues/22321#issuecomment-422682221", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22321", "id": 422682221, "node_id": "MDEyOklzc3VlQ29tbWVudDQyMjY4MjIyMQ==", "user": {"login": "dmitrievanthony", "id": 1028969, "node_id": "MDQ6VXNlcjEwMjg5Njk=", "avatar_url": "https://avatars3.githubusercontent.com/u/1028969?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dmitrievanthony", "html_url": "https://github.com/dmitrievanthony", "followers_url": "https://api.github.com/users/dmitrievanthony/followers", "following_url": "https://api.github.com/users/dmitrievanthony/following{/other_user}", "gists_url": "https://api.github.com/users/dmitrievanthony/gists{/gist_id}", "starred_url": "https://api.github.com/users/dmitrievanthony/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dmitrievanthony/subscriptions", "organizations_url": "https://api.github.com/users/dmitrievanthony/orgs", "repos_url": "https://api.github.com/users/dmitrievanthony/repos", "events_url": "https://api.github.com/users/dmitrievanthony/events{/privacy}", "received_events_url": "https://api.github.com/users/dmitrievanthony/received_events", "type": "User", "site_admin": false}, "created_at": "2018-09-19T07:07:10Z", "updated_at": "2018-09-19T07:07:28Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Looks like it would be better to make documentation or API more clear, but anyway... :)</p>\n<p>I tried the following approach:</p>\n<ol>\n<li>Set <code>export TF_CONFIG='{\"cluster\":{\"worker\":[\"localhost:1111\", \"localhost:1112\"],\"chief\":[\"localhost:1113\"]}, \"task\":{\"type\":\"worker\",\"index\":0}}'</code></li>\n<li>Start <a href=\"https://github.com/dmitrievanthony/ecosystem/blob/ignite-2/ignite/worker1.py\">worker1</a> (it's modified and now calls <code>run_standard_tensorflow_server</code>).</li>\n<li>Set <code>export TF_CONFIG='{\"cluster\":{\"worker\":[\"localhost:1111\", \"localhost:1112\"],\"chief\":[\"localhost:1113\"]}, \"task\":{\"type\":\"worker\",\"index\":1}}'</code></li>\n<li>Start <a href=\"https://github.com/dmitrievanthony/ecosystem/blob/ignite-2/ignite/worker2.py\">worker2</a> (it's modified and now calls <code>run_standard_tensorflow_server</code> and equal to <code>worker1.py</code> to be honest).</li>\n<li>Start <a href=\"https://github.com/dmitrievanthony/ecosystem/blob/ignite-2/distribution_strategy/keras_model_to_estimator_client.py#L106\">keras_model_to_estimator_client.py</a> with cluster specification passed via <code>remote_cluster</code>.</li>\n</ol>\n<p>Unfortunately, after all these actions I get the same exception:</p>\n<pre><code>INFO:tensorflow:Initializing RunConfig with distribution strategies.\nINFO:tensorflow:RunConfig initialized for Distribute Coordinator with STANDALONE_CLIENT mode\nINFO:tensorflow:Using the Keras model provided.\nTraceback (most recent call last):\n  File \"keras_model_to_estimator_client.py\", line 126, in &lt;module&gt;\n    tf.app.run(argv=sys.argv)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/site-packages/tensorflow/python/platform/app.py\", line 125, in run\n    _sys.exit(main(argv))\n  File \"keras_model_to_estimator_client.py\", line 114, in main\n    keras_model=model, config=run_config, model_dir=model_dir)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/keras.py\", line 412, in model_to_estimator\n    model_dir)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1591, in maybe_overwrite_model_dir_and_session_config\n    config = run_config.RunConfig.replace(config, session_config=session_config)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/run_config.py\", line 849, in replace\n    copy.deepcopy(self),\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 180, in deepcopy\n    y = _reconstruct(x, memo, *rv)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 280, in _reconstruct\n    state = deepcopy(state, memo)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 150, in deepcopy\n    y = copier(x, memo)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 240, in _deepcopy_dict\n    y[deepcopy(key, memo)] = deepcopy(value, memo)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 180, in deepcopy\n    y = _reconstruct(x, memo, *rv)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 280, in _reconstruct\n    state = deepcopy(state, memo)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 150, in deepcopy\n    y = copier(x, memo)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 240, in _deepcopy_dict\n    y[deepcopy(key, memo)] = deepcopy(value, memo)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 180, in deepcopy\n    y = _reconstruct(x, memo, *rv)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 280, in _reconstruct\n    state = deepcopy(state, memo)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 150, in deepcopy\n    y = copier(x, memo)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 240, in _deepcopy_dict\n    y[deepcopy(key, memo)] = deepcopy(value, memo)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 169, in deepcopy\n    rv = reductor(4)\nTypeError: can't pickle _thread._local objects\n</code></pre>", "body_text": "Looks like it would be better to make documentation or API more clear, but anyway... :)\nI tried the following approach:\n\nSet export TF_CONFIG='{\"cluster\":{\"worker\":[\"localhost:1111\", \"localhost:1112\"],\"chief\":[\"localhost:1113\"]}, \"task\":{\"type\":\"worker\",\"index\":0}}'\nStart worker1 (it's modified and now calls run_standard_tensorflow_server).\nSet export TF_CONFIG='{\"cluster\":{\"worker\":[\"localhost:1111\", \"localhost:1112\"],\"chief\":[\"localhost:1113\"]}, \"task\":{\"type\":\"worker\",\"index\":1}}'\nStart worker2 (it's modified and now calls run_standard_tensorflow_server and equal to worker1.py to be honest).\nStart keras_model_to_estimator_client.py with cluster specification passed via remote_cluster.\n\nUnfortunately, after all these actions I get the same exception:\nINFO:tensorflow:Initializing RunConfig with distribution strategies.\nINFO:tensorflow:RunConfig initialized for Distribute Coordinator with STANDALONE_CLIENT mode\nINFO:tensorflow:Using the Keras model provided.\nTraceback (most recent call last):\n  File \"keras_model_to_estimator_client.py\", line 126, in <module>\n    tf.app.run(argv=sys.argv)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/site-packages/tensorflow/python/platform/app.py\", line 125, in run\n    _sys.exit(main(argv))\n  File \"keras_model_to_estimator_client.py\", line 114, in main\n    keras_model=model, config=run_config, model_dir=model_dir)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/keras.py\", line 412, in model_to_estimator\n    model_dir)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1591, in maybe_overwrite_model_dir_and_session_config\n    config = run_config.RunConfig.replace(config, session_config=session_config)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/run_config.py\", line 849, in replace\n    copy.deepcopy(self),\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 180, in deepcopy\n    y = _reconstruct(x, memo, *rv)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 280, in _reconstruct\n    state = deepcopy(state, memo)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 150, in deepcopy\n    y = copier(x, memo)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 240, in _deepcopy_dict\n    y[deepcopy(key, memo)] = deepcopy(value, memo)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 180, in deepcopy\n    y = _reconstruct(x, memo, *rv)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 280, in _reconstruct\n    state = deepcopy(state, memo)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 150, in deepcopy\n    y = copier(x, memo)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 240, in _deepcopy_dict\n    y[deepcopy(key, memo)] = deepcopy(value, memo)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 180, in deepcopy\n    y = _reconstruct(x, memo, *rv)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 280, in _reconstruct\n    state = deepcopy(state, memo)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 150, in deepcopy\n    y = copier(x, memo)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 240, in _deepcopy_dict\n    y[deepcopy(key, memo)] = deepcopy(value, memo)\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 169, in deepcopy\n    rv = reductor(4)\nTypeError: can't pickle _thread._local objects", "body": "Looks like it would be better to make documentation or API more clear, but anyway... :)\r\n\r\nI tried the following approach:\r\n1. Set `export TF_CONFIG='{\"cluster\":{\"worker\":[\"localhost:1111\", \"localhost:1112\"],\"chief\":[\"localhost:1113\"]}, \"task\":{\"type\":\"worker\",\"index\":0}}'`\r\n2. Start [worker1](https://github.com/dmitrievanthony/ecosystem/blob/ignite-2/ignite/worker1.py) (it's modified and now calls `run_standard_tensorflow_server`).\r\n3. Set `export TF_CONFIG='{\"cluster\":{\"worker\":[\"localhost:1111\", \"localhost:1112\"],\"chief\":[\"localhost:1113\"]}, \"task\":{\"type\":\"worker\",\"index\":1}}'`\r\n4. Start [worker2](https://github.com/dmitrievanthony/ecosystem/blob/ignite-2/ignite/worker2.py) (it's modified and now calls `run_standard_tensorflow_server` and equal to `worker1.py` to be honest).\r\n5. Start [keras_model_to_estimator_client.py](https://github.com/dmitrievanthony/ecosystem/blob/ignite-2/distribution_strategy/keras_model_to_estimator_client.py#L106) with cluster specification passed via `remote_cluster`.\r\n\r\nUnfortunately, after all these actions I get the same exception:\r\n\r\n```\r\nINFO:tensorflow:Initializing RunConfig with distribution strategies.\r\nINFO:tensorflow:RunConfig initialized for Distribute Coordinator with STANDALONE_CLIENT mode\r\nINFO:tensorflow:Using the Keras model provided.\r\nTraceback (most recent call last):\r\n  File \"keras_model_to_estimator_client.py\", line 126, in <module>\r\n    tf.app.run(argv=sys.argv)\r\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/site-packages/tensorflow/python/platform/app.py\", line 125, in run\r\n    _sys.exit(main(argv))\r\n  File \"keras_model_to_estimator_client.py\", line 114, in main\r\n    keras_model=model, config=run_config, model_dir=model_dir)\r\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/keras.py\", line 412, in model_to_estimator\r\n    model_dir)\r\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1591, in maybe_overwrite_model_dir_and_session_config\r\n    config = run_config.RunConfig.replace(config, session_config=session_config)\r\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/site-packages/tensorflow/python/estimator/run_config.py\", line 849, in replace\r\n    copy.deepcopy(self),\r\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 180, in deepcopy\r\n    y = _reconstruct(x, memo, *rv)\r\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 280, in _reconstruct\r\n    state = deepcopy(state, memo)\r\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 150, in deepcopy\r\n    y = copier(x, memo)\r\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 240, in _deepcopy_dict\r\n    y[deepcopy(key, memo)] = deepcopy(value, memo)\r\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 180, in deepcopy\r\n    y = _reconstruct(x, memo, *rv)\r\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 280, in _reconstruct\r\n    state = deepcopy(state, memo)\r\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 150, in deepcopy\r\n    y = copier(x, memo)\r\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 240, in _deepcopy_dict\r\n    y[deepcopy(key, memo)] = deepcopy(value, memo)\r\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 180, in deepcopy\r\n    y = _reconstruct(x, memo, *rv)\r\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 280, in _reconstruct\r\n    state = deepcopy(state, memo)\r\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 150, in deepcopy\r\n    y = copier(x, memo)\r\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 240, in _deepcopy_dict\r\n    y[deepcopy(key, memo)] = deepcopy(value, memo)\r\n  File \"/Users/antondmitriev/anaconda3/lib/python3.6/copy.py\", line 169, in deepcopy\r\n    rv = reductor(4)\r\nTypeError: can't pickle _thread._local objects\r\n````"}