{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11132", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11132/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11132/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11132/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/11132", "id": 239407449, "node_id": "MDU6SXNzdWUyMzk0MDc0NDk=", "number": 11132, "title": "Go: SIGABRT when executing the same node more than once", "user": {"login": "galeone", "id": 8427788, "node_id": "MDQ6VXNlcjg0Mjc3ODg=", "avatar_url": "https://avatars1.githubusercontent.com/u/8427788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/galeone", "html_url": "https://github.com/galeone", "followers_url": "https://api.github.com/users/galeone/followers", "following_url": "https://api.github.com/users/galeone/following{/other_user}", "gists_url": "https://api.github.com/users/galeone/gists{/gist_id}", "starred_url": "https://api.github.com/users/galeone/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/galeone/subscriptions", "organizations_url": "https://api.github.com/users/galeone/orgs", "repos_url": "https://api.github.com/users/galeone/repos", "events_url": "https://api.github.com/users/galeone/events{/privacy}", "received_events_url": "https://api.github.com/users/galeone/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2017-06-29T08:49:31Z", "updated_at": "2017-07-07T01:10:24Z", "closed_at": "2017-07-07T01:10:24Z", "author_association": "NONE", "body_html": "<h2>Problem</h2>\n<p>In Go, when we pass the same node to the <code>fetches</code> list more then once SIGABRT is raised.</p>\n<h3>Source code / logs</h3>\n<div class=\"highlight highlight-source-go\"><pre><span class=\"pl-k\">package</span> poc_test\n\n<span class=\"pl-k\">import</span> (\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>fmt<span class=\"pl-pds\">\"</span></span>\n        tf <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>github.com/tensorflow/tensorflow/tensorflow/go<span class=\"pl-pds\">\"</span></span>\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>github.com/tensorflow/tensorflow/tensorflow/go/op<span class=\"pl-pds\">\"</span></span>\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>testing<span class=\"pl-pds\">\"</span></span>\n)\n\n<span class=\"pl-k\">func</span> <span class=\"pl-en\">TestFunc</span>(<span class=\"pl-v\">t</span> *<span class=\"pl-v\">testing</span>.<span class=\"pl-v\">T</span>) {\n        <span class=\"pl-c\"><span class=\"pl-c\">//</span> Create root scope</span>\n        <span class=\"pl-smi\">root</span> <span class=\"pl-k\">:=</span> op.<span class=\"pl-c1\">NewScope</span>()\n\n        <span class=\"pl-c\"><span class=\"pl-c\">//</span> Define graph</span>\n\n        <span class=\"pl-c\"><span class=\"pl-c\">//</span> Create a constant matrix</span>\n        <span class=\"pl-smi\">A</span> <span class=\"pl-k\">:=</span> op.<span class=\"pl-c1\">Const</span>(root.<span class=\"pl-c1\">SubScope</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>A<span class=\"pl-pds\">\"</span></span>), [<span class=\"pl-c1\">2</span>][<span class=\"pl-c1\">2</span>]<span class=\"pl-k\">int32</span>{{<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">2</span>}, {-<span class=\"pl-c1\">1</span>, -<span class=\"pl-c1\">2</span>}})\n        <span class=\"pl-c\"><span class=\"pl-c\">//</span> Create a constant column vector</span>\n        <span class=\"pl-smi\">b</span> <span class=\"pl-k\">:=</span> op.<span class=\"pl-c1\">Const</span>(root.<span class=\"pl-c1\">SubScope</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>b<span class=\"pl-pds\">\"</span></span>), [<span class=\"pl-c1\">2</span>][<span class=\"pl-c1\">1</span>]<span class=\"pl-k\">int32</span>{{<span class=\"pl-c1\">10</span>}, {<span class=\"pl-c1\">100</span>}})\n        <span class=\"pl-c\"><span class=\"pl-c\">//</span> Create a matmul operation</span>\n        <span class=\"pl-smi\">mul</span> <span class=\"pl-k\">:=</span> op.<span class=\"pl-c1\">MatMul</span>(root.<span class=\"pl-c1\">SubScope</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>MatMul<span class=\"pl-pds\">\"</span></span>), A, b)\n\n        <span class=\"pl-c\"><span class=\"pl-c\">//</span> Finalize the graph</span>\n        <span class=\"pl-smi\">graph</span>, <span class=\"pl-smi\">_</span> <span class=\"pl-k\">:=</span> root.<span class=\"pl-c1\">Finalize</span>()\n\n        <span class=\"pl-c\"><span class=\"pl-c\">//</span> Create the session</span>\n        <span class=\"pl-k\">var</span> <span class=\"pl-smi\">sess</span> *tf.<span class=\"pl-smi\">Session</span>\n        sess, _ = tf.<span class=\"pl-c1\">NewSession</span>(graph, &amp;tf.<span class=\"pl-smi\">SessionOptions</span>{})\n        <span class=\"pl-c\"><span class=\"pl-c\">//</span> Run</span>\n        <span class=\"pl-k\">var</span> <span class=\"pl-smi\">results</span> []*tf.<span class=\"pl-smi\">Tensor</span>\n        <span class=\"pl-k\">var</span> <span class=\"pl-smi\">err</span> <span class=\"pl-k\">error</span>\n        <span class=\"pl-k\">if</span> results, err = sess.<span class=\"pl-c1\">Run</span>(<span class=\"pl-c1\">nil</span>, []tf.<span class=\"pl-smi\">Output</span>{mul, mul}, <span class=\"pl-c1\">nil</span>); err != <span class=\"pl-c1\">nil</span> {\n                t.<span class=\"pl-c1\">Errorf</span>(err.<span class=\"pl-c1\">Error</span>())\n        }\n        fmt.<span class=\"pl-c1\">Println</span>(results[<span class=\"pl-c1\">0</span>].<span class=\"pl-c1\">Value</span>())\n}</pre></div>\n<p>Here's the output:</p>\n<pre lang=\"out\"><code>go test poc_test.go \n2017-06-29 10:46:09.154744: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:893] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2017-06-29 10:46:09.155330: I tensorflow/core/common_runtime/gpu/gpu_device.cc:938] Found device 0 with properties: \nname: GeForce GTX 1080 Ti\nmajor: 6 minor: 1 memoryClockRate (GHz) 1.582\npciBusID 0000:03:00.0\nTotal memory: 10.91GiB\nFree memory: 249.38MiB\n2017-06-29 10:46:09.267778: W tensorflow/stream_executor/cuda/cuda_driver.cc:523] A non-primary context 0x1f22910 exists before initializing the StreamExecutor. We haven't verified StreamExecutor works with that.\n2017-06-29 10:46:09.268001: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:893] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2017-06-29 10:46:09.268357: I tensorflow/core/common_runtime/gpu/gpu_device.cc:938] Found device 1 with properties: \nname: GeForce GTX 1060 6GB\nmajor: 6 minor: 1 memoryClockRate (GHz) 1.7845\npciBusID 0000:01:00.0\nTotal memory: 5.93GiB\nFree memory: 5.34GiB\n2017-06-29 10:46:09.268390: I tensorflow/core/common_runtime/gpu/gpu_device.cc:830] Peer access not supported between device ordinals 0 and 1\n2017-06-29 10:46:09.268399: I tensorflow/core/common_runtime/gpu/gpu_device.cc:830] Peer access not supported between device ordinals 1 and 0\n2017-06-29 10:46:09.268409: I tensorflow/core/common_runtime/gpu/gpu_device.cc:959] DMA: 0 1 \n2017-06-29 10:46:09.268415: I tensorflow/core/common_runtime/gpu/gpu_device.cc:969] 0:   Y N \n2017-06-29 10:46:09.268421: I tensorflow/core/common_runtime/gpu/gpu_device.cc:969] 1:   N Y \n2017-06-29 10:46:09.268433: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1028] Creating TensorFlow device (/gpu:0) -&gt; (device: 0, name: GeForce GTX 1080 Ti, pci bus id: 0000:03:00.0)\n2017-06-29 10:46:09.268440: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1028] Creating TensorFlow device (/gpu:1) -&gt; (device: 1, name: GeForce GTX 1060 6GB, pci bus id: 0000:01:00.0)\n2017-06-29 10:46:09.290295: F tensorflow/c/c_api.cc:488] Check failed: nelems == 0 (2 vs. 0)\nSIGABRT: abort\nPC=0x7fa8684dc670 m=0 sigcode=18446744073709551610\nsignal arrived during cgo execution\n\ngoroutine 5 [syscall, locked to thread]:\nruntime.cgocall(0x50d580, 0xc420043d68, 0x530100)\n        /usr/lib/go/src/runtime/cgocall.go:131 +0xe2 fp=0xc420043d20 sp=0xc420043ce0\ngithub.com/tensorflow/tensorflow/tensorflow/go._Cfunc_TF_SessionRun(0x2beb8a0, 0x0, 0x0, 0x0, 0x0, 0xc42000ce40, 0xc420011040, 0xc400000002, 0x0, 0x0, ...)\n        github.com/tensorflow/tensorflow/tensorflow/go/_obj/_cgo_gotypes.go:703 +0x45 fp=0xc420043d68 sp=0xc420043d20\ngithub.com/tensorflow/tensorflow/tensorflow/go.(*Session).Run.func1(0x2beb8a0, 0x0, 0x0, 0x0, 0x0, 0xc42000ce40, 0xc420011040, 0xc400000002, 0x0, 0x0, ...)\n        /home/pgaleone/projects/go/src/github.com/tensorflow/tensorflow/tensorflow/go/session.go:87 +0x23a fp=0xc420043dd8 sp=0xc420043d68\ngithub.com/tensorflow/tensorflow/tensorflow/go.(*Session).Run(0xc42000ce20, 0x0, 0xc420043f50, 0x2, 0x2, 0x0, 0x0, 0x0, 0x0, 0x0, ...)\n        /home/pgaleone/projects/go/src/github.com/tensorflow/tensorflow/tensorflow/go/session.go:91 +0x243 fp=0xc420043e70 sp=0xc420043dd8\ncommand-line-arguments_test.TestFunc(0xc4200665b0)\n        /home/pgaleone/projects/go/src/github.com/galeone/asd/poc_test.go:32 +0x35d fp=0xc420043fa8 sp=0xc420043e70\ntesting.tRunner(0xc4200665b0, 0x562278)\n        /usr/lib/go/src/testing/testing.go:657 +0x96 fp=0xc420043fd0 sp=0xc420043fa8\nruntime.goexit()\n        /usr/lib/go/src/runtime/asm_amd64.s:2197 +0x1 fp=0xc420043fd8 sp=0xc420043fd0\ncreated by testing.(*T).Run\n        /usr/lib/go/src/testing/testing.go:697 +0x2ca\n\ngoroutine 1 [chan receive]:\ntesting.(*T).Run(0xc4200664e0, 0x559659, 0x8, 0x562278, 0xc420053d20)\n        /usr/lib/go/src/testing/testing.go:698 +0x2f4\ntesting.runTests.func1(0xc4200664e0)\n        /usr/lib/go/src/testing/testing.go:882 +0x67\ntesting.tRunner(0xc4200664e0, 0xc420053de0)\n        /usr/lib/go/src/testing/testing.go:657 +0x96\ntesting.runTests(0xc42000cd80, 0x7ecf80, 0x1, 0x1, 0x4131ac)\n        /usr/lib/go/src/testing/testing.go:888 +0x2c1\ntesting.(*M).Run(0xc420053f20, 0xc420053f20)\n        /usr/lib/go/src/testing/testing.go:822 +0xfc\nmain.main()\n        command-line-arguments/_test/_testmain.go:42 +0xf7\n\ngoroutine 17 [syscall, locked to thread]:\nruntime.goexit()\n        /usr/lib/go/src/runtime/asm_amd64.s:2197 +0x1\n\nrax    0x0\nrbx    0x6\nrcx    0x7fa8684dc670\nrdx    0x0\nrdi    0x2\nrsi    0x7ffe4515bf50\nrbp    0x7ffe4515c1a0\nrsp    0x7ffe4515bf50\nr8     0x0\nr9     0x7ffe4515bf50\nr10    0x8\nr11    0x246\nr12    0x2\nr13    0x2\nr14    0x2bf8160\nr15    0x20\nrip    0x7fa8684dc670\nrflags 0x246\ncs     0x33\nfs     0x0\ngs     0x0\nFAIL    command-line-arguments  0.544s\n</code></pre>\n<p>The same logic,  in python, works without any issue:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\nA <span class=\"pl-k\">=</span> tf.constant([[<span class=\"pl-c1\">1</span>,<span class=\"pl-c1\">2</span>], [<span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>, <span class=\"pl-k\">-</span><span class=\"pl-c1\">2</span>]])\nb <span class=\"pl-k\">=</span> tf.constant([[<span class=\"pl-c1\">10</span>], [<span class=\"pl-c1\">100</span>]])\n\nmul <span class=\"pl-k\">=</span> tf.matmul(A, b)\n\n<span class=\"pl-k\">with</span> tf.Session() <span class=\"pl-k\">as</span> sess:\n    <span class=\"pl-c1\">print</span>(sess.run([mul, mul]))\n</pre></div>\n<p>outputs</p>\n<pre lang=\"out\"><code>[array([[ 210],\n       [-210]], dtype=int32), array([[ 210],\n       [-210]], dtype=int32)]\n</code></pre>\n<p>as expected.</p>\n<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Archlinux</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: source</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.2.0</li>\n<li><strong>Bazel version (if compiling from source)</strong>: 0.5.1</li>\n<li><strong>CUDA/cuDNN version</strong>: cuda 8, cudnn 5.1</li>\n<li><strong>GPU model and memory</strong>:  GeForce GTX 1080</li>\n<li><strong>Exact command to reproduce</strong>: <code>go test</code></li>\n</ul>", "body_text": "Problem\nIn Go, when we pass the same node to the fetches list more then once SIGABRT is raised.\nSource code / logs\npackage poc_test\n\nimport (\n        \"fmt\"\n        tf \"github.com/tensorflow/tensorflow/tensorflow/go\"\n        \"github.com/tensorflow/tensorflow/tensorflow/go/op\"\n        \"testing\"\n)\n\nfunc TestFunc(t *testing.T) {\n        // Create root scope\n        root := op.NewScope()\n\n        // Define graph\n\n        // Create a constant matrix\n        A := op.Const(root.SubScope(\"A\"), [2][2]int32{{1, 2}, {-1, -2}})\n        // Create a constant column vector\n        b := op.Const(root.SubScope(\"b\"), [2][1]int32{{10}, {100}})\n        // Create a matmul operation\n        mul := op.MatMul(root.SubScope(\"MatMul\"), A, b)\n\n        // Finalize the graph\n        graph, _ := root.Finalize()\n\n        // Create the session\n        var sess *tf.Session\n        sess, _ = tf.NewSession(graph, &tf.SessionOptions{})\n        // Run\n        var results []*tf.Tensor\n        var err error\n        if results, err = sess.Run(nil, []tf.Output{mul, mul}, nil); err != nil {\n                t.Errorf(err.Error())\n        }\n        fmt.Println(results[0].Value())\n}\nHere's the output:\ngo test poc_test.go \n2017-06-29 10:46:09.154744: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:893] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2017-06-29 10:46:09.155330: I tensorflow/core/common_runtime/gpu/gpu_device.cc:938] Found device 0 with properties: \nname: GeForce GTX 1080 Ti\nmajor: 6 minor: 1 memoryClockRate (GHz) 1.582\npciBusID 0000:03:00.0\nTotal memory: 10.91GiB\nFree memory: 249.38MiB\n2017-06-29 10:46:09.267778: W tensorflow/stream_executor/cuda/cuda_driver.cc:523] A non-primary context 0x1f22910 exists before initializing the StreamExecutor. We haven't verified StreamExecutor works with that.\n2017-06-29 10:46:09.268001: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:893] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2017-06-29 10:46:09.268357: I tensorflow/core/common_runtime/gpu/gpu_device.cc:938] Found device 1 with properties: \nname: GeForce GTX 1060 6GB\nmajor: 6 minor: 1 memoryClockRate (GHz) 1.7845\npciBusID 0000:01:00.0\nTotal memory: 5.93GiB\nFree memory: 5.34GiB\n2017-06-29 10:46:09.268390: I tensorflow/core/common_runtime/gpu/gpu_device.cc:830] Peer access not supported between device ordinals 0 and 1\n2017-06-29 10:46:09.268399: I tensorflow/core/common_runtime/gpu/gpu_device.cc:830] Peer access not supported between device ordinals 1 and 0\n2017-06-29 10:46:09.268409: I tensorflow/core/common_runtime/gpu/gpu_device.cc:959] DMA: 0 1 \n2017-06-29 10:46:09.268415: I tensorflow/core/common_runtime/gpu/gpu_device.cc:969] 0:   Y N \n2017-06-29 10:46:09.268421: I tensorflow/core/common_runtime/gpu/gpu_device.cc:969] 1:   N Y \n2017-06-29 10:46:09.268433: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1028] Creating TensorFlow device (/gpu:0) -> (device: 0, name: GeForce GTX 1080 Ti, pci bus id: 0000:03:00.0)\n2017-06-29 10:46:09.268440: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1028] Creating TensorFlow device (/gpu:1) -> (device: 1, name: GeForce GTX 1060 6GB, pci bus id: 0000:01:00.0)\n2017-06-29 10:46:09.290295: F tensorflow/c/c_api.cc:488] Check failed: nelems == 0 (2 vs. 0)\nSIGABRT: abort\nPC=0x7fa8684dc670 m=0 sigcode=18446744073709551610\nsignal arrived during cgo execution\n\ngoroutine 5 [syscall, locked to thread]:\nruntime.cgocall(0x50d580, 0xc420043d68, 0x530100)\n        /usr/lib/go/src/runtime/cgocall.go:131 +0xe2 fp=0xc420043d20 sp=0xc420043ce0\ngithub.com/tensorflow/tensorflow/tensorflow/go._Cfunc_TF_SessionRun(0x2beb8a0, 0x0, 0x0, 0x0, 0x0, 0xc42000ce40, 0xc420011040, 0xc400000002, 0x0, 0x0, ...)\n        github.com/tensorflow/tensorflow/tensorflow/go/_obj/_cgo_gotypes.go:703 +0x45 fp=0xc420043d68 sp=0xc420043d20\ngithub.com/tensorflow/tensorflow/tensorflow/go.(*Session).Run.func1(0x2beb8a0, 0x0, 0x0, 0x0, 0x0, 0xc42000ce40, 0xc420011040, 0xc400000002, 0x0, 0x0, ...)\n        /home/pgaleone/projects/go/src/github.com/tensorflow/tensorflow/tensorflow/go/session.go:87 +0x23a fp=0xc420043dd8 sp=0xc420043d68\ngithub.com/tensorflow/tensorflow/tensorflow/go.(*Session).Run(0xc42000ce20, 0x0, 0xc420043f50, 0x2, 0x2, 0x0, 0x0, 0x0, 0x0, 0x0, ...)\n        /home/pgaleone/projects/go/src/github.com/tensorflow/tensorflow/tensorflow/go/session.go:91 +0x243 fp=0xc420043e70 sp=0xc420043dd8\ncommand-line-arguments_test.TestFunc(0xc4200665b0)\n        /home/pgaleone/projects/go/src/github.com/galeone/asd/poc_test.go:32 +0x35d fp=0xc420043fa8 sp=0xc420043e70\ntesting.tRunner(0xc4200665b0, 0x562278)\n        /usr/lib/go/src/testing/testing.go:657 +0x96 fp=0xc420043fd0 sp=0xc420043fa8\nruntime.goexit()\n        /usr/lib/go/src/runtime/asm_amd64.s:2197 +0x1 fp=0xc420043fd8 sp=0xc420043fd0\ncreated by testing.(*T).Run\n        /usr/lib/go/src/testing/testing.go:697 +0x2ca\n\ngoroutine 1 [chan receive]:\ntesting.(*T).Run(0xc4200664e0, 0x559659, 0x8, 0x562278, 0xc420053d20)\n        /usr/lib/go/src/testing/testing.go:698 +0x2f4\ntesting.runTests.func1(0xc4200664e0)\n        /usr/lib/go/src/testing/testing.go:882 +0x67\ntesting.tRunner(0xc4200664e0, 0xc420053de0)\n        /usr/lib/go/src/testing/testing.go:657 +0x96\ntesting.runTests(0xc42000cd80, 0x7ecf80, 0x1, 0x1, 0x4131ac)\n        /usr/lib/go/src/testing/testing.go:888 +0x2c1\ntesting.(*M).Run(0xc420053f20, 0xc420053f20)\n        /usr/lib/go/src/testing/testing.go:822 +0xfc\nmain.main()\n        command-line-arguments/_test/_testmain.go:42 +0xf7\n\ngoroutine 17 [syscall, locked to thread]:\nruntime.goexit()\n        /usr/lib/go/src/runtime/asm_amd64.s:2197 +0x1\n\nrax    0x0\nrbx    0x6\nrcx    0x7fa8684dc670\nrdx    0x0\nrdi    0x2\nrsi    0x7ffe4515bf50\nrbp    0x7ffe4515c1a0\nrsp    0x7ffe4515bf50\nr8     0x0\nr9     0x7ffe4515bf50\nr10    0x8\nr11    0x246\nr12    0x2\nr13    0x2\nr14    0x2bf8160\nr15    0x20\nrip    0x7fa8684dc670\nrflags 0x246\ncs     0x33\nfs     0x0\ngs     0x0\nFAIL    command-line-arguments  0.544s\n\nThe same logic,  in python, works without any issue:\nimport tensorflow as tf\n\nA = tf.constant([[1,2], [-1, -2]])\nb = tf.constant([[10], [100]])\n\nmul = tf.matmul(A, b)\n\nwith tf.Session() as sess:\n    print(sess.run([mul, mul]))\n\noutputs\n[array([[ 210],\n       [-210]], dtype=int32), array([[ 210],\n       [-210]], dtype=int32)]\n\nas expected.\nSystem information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Archlinux\nTensorFlow installed from (source or binary): source\nTensorFlow version (use command below): 1.2.0\nBazel version (if compiling from source): 0.5.1\nCUDA/cuDNN version: cuda 8, cudnn 5.1\nGPU model and memory:  GeForce GTX 1080\nExact command to reproduce: go test", "body": "## Problem\r\n\r\nIn Go, when we pass the same node to the `fetches` list more then once SIGABRT is raised.\r\n\r\n### Source code / logs\r\n\r\n```go\r\npackage poc_test\r\n\r\nimport (\r\n        \"fmt\"\r\n        tf \"github.com/tensorflow/tensorflow/tensorflow/go\"\r\n        \"github.com/tensorflow/tensorflow/tensorflow/go/op\"\r\n        \"testing\"\r\n)\r\n\r\nfunc TestFunc(t *testing.T) {\r\n        // Create root scope\r\n        root := op.NewScope()\r\n\r\n        // Define graph\r\n\r\n        // Create a constant matrix\r\n        A := op.Const(root.SubScope(\"A\"), [2][2]int32{{1, 2}, {-1, -2}})\r\n        // Create a constant column vector\r\n        b := op.Const(root.SubScope(\"b\"), [2][1]int32{{10}, {100}})\r\n        // Create a matmul operation\r\n        mul := op.MatMul(root.SubScope(\"MatMul\"), A, b)\r\n\r\n        // Finalize the graph\r\n        graph, _ := root.Finalize()\r\n\r\n        // Create the session\r\n        var sess *tf.Session\r\n        sess, _ = tf.NewSession(graph, &tf.SessionOptions{})\r\n        // Run\r\n        var results []*tf.Tensor\r\n        var err error\r\n        if results, err = sess.Run(nil, []tf.Output{mul, mul}, nil); err != nil {\r\n                t.Errorf(err.Error())\r\n        }\r\n        fmt.Println(results[0].Value())\r\n}\r\n```\r\n\r\nHere's the output:\r\n\r\n```out\r\ngo test poc_test.go \r\n2017-06-29 10:46:09.154744: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:893] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2017-06-29 10:46:09.155330: I tensorflow/core/common_runtime/gpu/gpu_device.cc:938] Found device 0 with properties: \r\nname: GeForce GTX 1080 Ti\r\nmajor: 6 minor: 1 memoryClockRate (GHz) 1.582\r\npciBusID 0000:03:00.0\r\nTotal memory: 10.91GiB\r\nFree memory: 249.38MiB\r\n2017-06-29 10:46:09.267778: W tensorflow/stream_executor/cuda/cuda_driver.cc:523] A non-primary context 0x1f22910 exists before initializing the StreamExecutor. We haven't verified StreamExecutor works with that.\r\n2017-06-29 10:46:09.268001: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:893] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2017-06-29 10:46:09.268357: I tensorflow/core/common_runtime/gpu/gpu_device.cc:938] Found device 1 with properties: \r\nname: GeForce GTX 1060 6GB\r\nmajor: 6 minor: 1 memoryClockRate (GHz) 1.7845\r\npciBusID 0000:01:00.0\r\nTotal memory: 5.93GiB\r\nFree memory: 5.34GiB\r\n2017-06-29 10:46:09.268390: I tensorflow/core/common_runtime/gpu/gpu_device.cc:830] Peer access not supported between device ordinals 0 and 1\r\n2017-06-29 10:46:09.268399: I tensorflow/core/common_runtime/gpu/gpu_device.cc:830] Peer access not supported between device ordinals 1 and 0\r\n2017-06-29 10:46:09.268409: I tensorflow/core/common_runtime/gpu/gpu_device.cc:959] DMA: 0 1 \r\n2017-06-29 10:46:09.268415: I tensorflow/core/common_runtime/gpu/gpu_device.cc:969] 0:   Y N \r\n2017-06-29 10:46:09.268421: I tensorflow/core/common_runtime/gpu/gpu_device.cc:969] 1:   N Y \r\n2017-06-29 10:46:09.268433: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1028] Creating TensorFlow device (/gpu:0) -> (device: 0, name: GeForce GTX 1080 Ti, pci bus id: 0000:03:00.0)\r\n2017-06-29 10:46:09.268440: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1028] Creating TensorFlow device (/gpu:1) -> (device: 1, name: GeForce GTX 1060 6GB, pci bus id: 0000:01:00.0)\r\n2017-06-29 10:46:09.290295: F tensorflow/c/c_api.cc:488] Check failed: nelems == 0 (2 vs. 0)\r\nSIGABRT: abort\r\nPC=0x7fa8684dc670 m=0 sigcode=18446744073709551610\r\nsignal arrived during cgo execution\r\n\r\ngoroutine 5 [syscall, locked to thread]:\r\nruntime.cgocall(0x50d580, 0xc420043d68, 0x530100)\r\n        /usr/lib/go/src/runtime/cgocall.go:131 +0xe2 fp=0xc420043d20 sp=0xc420043ce0\r\ngithub.com/tensorflow/tensorflow/tensorflow/go._Cfunc_TF_SessionRun(0x2beb8a0, 0x0, 0x0, 0x0, 0x0, 0xc42000ce40, 0xc420011040, 0xc400000002, 0x0, 0x0, ...)\r\n        github.com/tensorflow/tensorflow/tensorflow/go/_obj/_cgo_gotypes.go:703 +0x45 fp=0xc420043d68 sp=0xc420043d20\r\ngithub.com/tensorflow/tensorflow/tensorflow/go.(*Session).Run.func1(0x2beb8a0, 0x0, 0x0, 0x0, 0x0, 0xc42000ce40, 0xc420011040, 0xc400000002, 0x0, 0x0, ...)\r\n        /home/pgaleone/projects/go/src/github.com/tensorflow/tensorflow/tensorflow/go/session.go:87 +0x23a fp=0xc420043dd8 sp=0xc420043d68\r\ngithub.com/tensorflow/tensorflow/tensorflow/go.(*Session).Run(0xc42000ce20, 0x0, 0xc420043f50, 0x2, 0x2, 0x0, 0x0, 0x0, 0x0, 0x0, ...)\r\n        /home/pgaleone/projects/go/src/github.com/tensorflow/tensorflow/tensorflow/go/session.go:91 +0x243 fp=0xc420043e70 sp=0xc420043dd8\r\ncommand-line-arguments_test.TestFunc(0xc4200665b0)\r\n        /home/pgaleone/projects/go/src/github.com/galeone/asd/poc_test.go:32 +0x35d fp=0xc420043fa8 sp=0xc420043e70\r\ntesting.tRunner(0xc4200665b0, 0x562278)\r\n        /usr/lib/go/src/testing/testing.go:657 +0x96 fp=0xc420043fd0 sp=0xc420043fa8\r\nruntime.goexit()\r\n        /usr/lib/go/src/runtime/asm_amd64.s:2197 +0x1 fp=0xc420043fd8 sp=0xc420043fd0\r\ncreated by testing.(*T).Run\r\n        /usr/lib/go/src/testing/testing.go:697 +0x2ca\r\n\r\ngoroutine 1 [chan receive]:\r\ntesting.(*T).Run(0xc4200664e0, 0x559659, 0x8, 0x562278, 0xc420053d20)\r\n        /usr/lib/go/src/testing/testing.go:698 +0x2f4\r\ntesting.runTests.func1(0xc4200664e0)\r\n        /usr/lib/go/src/testing/testing.go:882 +0x67\r\ntesting.tRunner(0xc4200664e0, 0xc420053de0)\r\n        /usr/lib/go/src/testing/testing.go:657 +0x96\r\ntesting.runTests(0xc42000cd80, 0x7ecf80, 0x1, 0x1, 0x4131ac)\r\n        /usr/lib/go/src/testing/testing.go:888 +0x2c1\r\ntesting.(*M).Run(0xc420053f20, 0xc420053f20)\r\n        /usr/lib/go/src/testing/testing.go:822 +0xfc\r\nmain.main()\r\n        command-line-arguments/_test/_testmain.go:42 +0xf7\r\n\r\ngoroutine 17 [syscall, locked to thread]:\r\nruntime.goexit()\r\n        /usr/lib/go/src/runtime/asm_amd64.s:2197 +0x1\r\n\r\nrax    0x0\r\nrbx    0x6\r\nrcx    0x7fa8684dc670\r\nrdx    0x0\r\nrdi    0x2\r\nrsi    0x7ffe4515bf50\r\nrbp    0x7ffe4515c1a0\r\nrsp    0x7ffe4515bf50\r\nr8     0x0\r\nr9     0x7ffe4515bf50\r\nr10    0x8\r\nr11    0x246\r\nr12    0x2\r\nr13    0x2\r\nr14    0x2bf8160\r\nr15    0x20\r\nrip    0x7fa8684dc670\r\nrflags 0x246\r\ncs     0x33\r\nfs     0x0\r\ngs     0x0\r\nFAIL    command-line-arguments  0.544s\r\n```\r\n\r\nThe same logic,  in python, works without any issue:\r\n\r\n```python\r\nimport tensorflow as tf\r\n\r\nA = tf.constant([[1,2], [-1, -2]])\r\nb = tf.constant([[10], [100]])\r\n\r\nmul = tf.matmul(A, b)\r\n\r\nwith tf.Session() as sess:\r\n    print(sess.run([mul, mul]))\r\n\r\n```\r\noutputs\r\n```out\r\n[array([[ 210],\r\n       [-210]], dtype=int32), array([[ 210],\r\n       [-210]], dtype=int32)]\r\n```\r\n\r\nas expected.\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Archlinux\r\n- **TensorFlow installed from (source or binary)**: source\r\n- **TensorFlow version (use command below)**: 1.2.0\r\n- **Bazel version (if compiling from source)**: 0.5.1\r\n- **CUDA/cuDNN version**: cuda 8, cudnn 5.1\r\n- **GPU model and memory**:  GeForce GTX 1080\r\n- **Exact command to reproduce**: `go test`\r\n"}