{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13647", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13647/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13647/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13647/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/13647", "id": 264775152, "node_id": "MDU6SXNzdWUyNjQ3NzUxNTI=", "number": 13647, "title": "Extracting weight values from output_graph.pb", "user": {"login": "Moondra", "id": 22944856, "node_id": "MDQ6VXNlcjIyOTQ0ODU2", "avatar_url": "https://avatars2.githubusercontent.com/u/22944856?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Moondra", "html_url": "https://github.com/Moondra", "followers_url": "https://api.github.com/users/Moondra/followers", "following_url": "https://api.github.com/users/Moondra/following{/other_user}", "gists_url": "https://api.github.com/users/Moondra/gists{/gist_id}", "starred_url": "https://api.github.com/users/Moondra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Moondra/subscriptions", "organizations_url": "https://api.github.com/users/Moondra/orgs", "repos_url": "https://api.github.com/users/Moondra/repos", "events_url": "https://api.github.com/users/Moondra/events{/privacy}", "received_events_url": "https://api.github.com/users/Moondra/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-10-12T00:13:18Z", "updated_at": "2018-08-22T17:26:09Z", "closed_at": "2017-10-12T00:56:00Z", "author_association": "NONE", "body_html": "<p>Hi, this isn't a bug more of request for a tutorial or guidance -  I have asked this question multiple times on Stackoverflow  and can't seem to get any responses nor views. My past questions on tensorflow also didn't get much views on Stackoverflow -- I think this is because tensorflow is still relatively new and it's hard to find knowledgeable people.</p>\n<p>I'm sorry to post, here but I don't know where else to ask -- I've been at it for a few days and looked<br>\nthe tutorials on the official site but I couldn't find any.</p>\n<p>I used inceptionV-3 for transfer learning  and now I have a output_graph.pb.<br>\nI want to extract all the weights and biases for each layer, but I can't seem to find a way to do this.</p>\n<p>I've gone over most the tutorials in tensorflow:<br>\n<a href=\"https://www.tensorflow.org/programmers_guide/saved_model#models\" rel=\"nofollow\">https://www.tensorflow.org/programmers_guide/saved_model#models</a></p>\n<p>And most blogs or stackoverflows posts show how to deal with 'meta<code>and</code>ckpt` graphs.</p>\n<p>but not on <code>pb</code> graphs.</p>\n<p>I've attempted this:</p>\n<p><a href=\"https://stackoverflow.com/questions/46696859/tf-graphkeys-trainable-variables-on-output-graph-pb-resulting-in-empty-list\" rel=\"nofollow\">https://stackoverflow.com/questions/46696859/tf-graphkeys-trainable-variables-on-output-graph-pb-resulting-in-empty-list</a></p>\n<pre><code>def create_graph(modelFullPath):\n    \"\"\"Creates a graph from saved GraphDef file and returns a saver.\"\"\"\n    # Creates graph from saved graph_def.pb.\n    with tf.gfile.FastGFile(modelFullPath, 'rb') as f:\n        graph_def = tf.GraphDef()\n        graph_def.ParseFromString(f.read())\n        tf.import_graph_def(graph_def, name='')\n\nGRAPH_DIR = r'C:\\tmp\\output_graph.pb'\ncreate_graph(GRAPH_DIR)\n\n\nwith tf.Session() as sess:\n    all_vars = tf.get_collection(tf.GraphKeys.TRAINABLE_VARIABLES)\n    print (len(all_vars))\n</code></pre>\n<p>But I'm getting a value of 0 -- so empty return.</p>\n<p>I've also attempted using <code>freeze_graph.py</code>  after cloning tensorflow repository but couldn't understand all of the arguments (created a stackoverflow question on this as well)</p>\n<p>--input_graph    = path to the graph I want to extract.</p>\n<p>I'm assuming the above arugument is all I need to use?</p>\n<p>However when running this command:</p>\n<p><code>python3.6 C:\\Users\\Moondra\\tensorflow\\tensorflow\\python\\tools\\freeze_graph.py --input-graph=C:\\tmp\\output_graph.pb</code></p>\n<p>I'm getting a import error which is confusing me as well:</p>\n<pre><code>from tensorflow.python.tools import saved_model_util\n     importError: cannot import name 'saved_model_utils'\n</code></pre>\n<p>I've cloned the repository properly and the saved_model_utils is within the tools folder, so not sure<br>\nwhy I\"m getting an import error.</p>\n<p>Any help would be appreciated, and once again, sorry for posting here.  :(</p>", "body_text": "Hi, this isn't a bug more of request for a tutorial or guidance -  I have asked this question multiple times on Stackoverflow  and can't seem to get any responses nor views. My past questions on tensorflow also didn't get much views on Stackoverflow -- I think this is because tensorflow is still relatively new and it's hard to find knowledgeable people.\nI'm sorry to post, here but I don't know where else to ask -- I've been at it for a few days and looked\nthe tutorials on the official site but I couldn't find any.\nI used inceptionV-3 for transfer learning  and now I have a output_graph.pb.\nI want to extract all the weights and biases for each layer, but I can't seem to find a way to do this.\nI've gone over most the tutorials in tensorflow:\nhttps://www.tensorflow.org/programmers_guide/saved_model#models\nAnd most blogs or stackoverflows posts show how to deal with 'metaandckpt` graphs.\nbut not on pb graphs.\nI've attempted this:\nhttps://stackoverflow.com/questions/46696859/tf-graphkeys-trainable-variables-on-output-graph-pb-resulting-in-empty-list\ndef create_graph(modelFullPath):\n    \"\"\"Creates a graph from saved GraphDef file and returns a saver.\"\"\"\n    # Creates graph from saved graph_def.pb.\n    with tf.gfile.FastGFile(modelFullPath, 'rb') as f:\n        graph_def = tf.GraphDef()\n        graph_def.ParseFromString(f.read())\n        tf.import_graph_def(graph_def, name='')\n\nGRAPH_DIR = r'C:\\tmp\\output_graph.pb'\ncreate_graph(GRAPH_DIR)\n\n\nwith tf.Session() as sess:\n    all_vars = tf.get_collection(tf.GraphKeys.TRAINABLE_VARIABLES)\n    print (len(all_vars))\n\nBut I'm getting a value of 0 -- so empty return.\nI've also attempted using freeze_graph.py  after cloning tensorflow repository but couldn't understand all of the arguments (created a stackoverflow question on this as well)\n--input_graph    = path to the graph I want to extract.\nI'm assuming the above arugument is all I need to use?\nHowever when running this command:\npython3.6 C:\\Users\\Moondra\\tensorflow\\tensorflow\\python\\tools\\freeze_graph.py --input-graph=C:\\tmp\\output_graph.pb\nI'm getting a import error which is confusing me as well:\nfrom tensorflow.python.tools import saved_model_util\n     importError: cannot import name 'saved_model_utils'\n\nI've cloned the repository properly and the saved_model_utils is within the tools folder, so not sure\nwhy I\"m getting an import error.\nAny help would be appreciated, and once again, sorry for posting here.  :(", "body": "Hi, this isn't a bug more of request for a tutorial or guidance -  I have asked this question multiple times on Stackoverflow  and can't seem to get any responses nor views. My past questions on tensorflow also didn't get much views on Stackoverflow -- I think this is because tensorflow is still relatively new and it's hard to find knowledgeable people.\r\n\r\nI'm sorry to post, here but I don't know where else to ask -- I've been at it for a few days and looked \r\nthe tutorials on the official site but I couldn't find any. \r\n\r\nI used inceptionV-3 for transfer learning  and now I have a output_graph.pb.\r\nI want to extract all the weights and biases for each layer, but I can't seem to find a way to do this. \r\n\r\nI've gone over most the tutorials in tensorflow:\r\nhttps://www.tensorflow.org/programmers_guide/saved_model#models\r\n\r\nAnd most blogs or stackoverflows posts show how to deal with 'meta` and `ckpt` graphs.\r\n\r\nbut not on `pb` graphs.  \r\n\r\nI've attempted this:\r\n\r\nhttps://stackoverflow.com/questions/46696859/tf-graphkeys-trainable-variables-on-output-graph-pb-resulting-in-empty-list\r\n\r\n\r\n```\r\ndef create_graph(modelFullPath):\r\n    \"\"\"Creates a graph from saved GraphDef file and returns a saver.\"\"\"\r\n    # Creates graph from saved graph_def.pb.\r\n    with tf.gfile.FastGFile(modelFullPath, 'rb') as f:\r\n        graph_def = tf.GraphDef()\r\n        graph_def.ParseFromString(f.read())\r\n        tf.import_graph_def(graph_def, name='')\r\n\r\nGRAPH_DIR = r'C:\\tmp\\output_graph.pb'\r\ncreate_graph(GRAPH_DIR)\r\n\r\n\r\nwith tf.Session() as sess:\r\n    all_vars = tf.get_collection(tf.GraphKeys.TRAINABLE_VARIABLES)\r\n    print (len(all_vars))\r\n```\r\n\r\nBut I'm getting a value of 0 -- so empty return. \r\n\r\n\r\nI've also attempted using `freeze_graph.py`  after cloning tensorflow repository but couldn't understand all of the arguments (created a stackoverflow question on this as well)\r\n\r\n--input_graph    = path to the graph I want to extract.\r\n\r\nI'm assuming the above arugument is all I need to use?\r\n\r\nHowever when running this command:\r\n\r\n`python3.6 C:\\Users\\Moondra\\tensorflow\\tensorflow\\python\\tools\\freeze_graph.py --input-graph=C:\\tmp\\output_graph.pb`\r\n\r\nI'm getting a import error which is confusing me as well:\r\n\r\n```\r\nfrom tensorflow.python.tools import saved_model_util\r\n     importError: cannot import name 'saved_model_utils'\r\n```\r\n\r\n\r\nI've cloned the repository properly and the saved_model_utils is within the tools folder, so not sure \r\nwhy I\"m getting an import error.  \r\n\r\nAny help would be appreciated, and once again, sorry for posting here.  :(\r\n\r\n\r\n"}