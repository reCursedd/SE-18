{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/299669705", "html_url": "https://github.com/tensorflow/tensorflow/issues/675#issuecomment-299669705", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/675", "id": 299669705, "node_id": "MDEyOklzc3VlQ29tbWVudDI5OTY2OTcwNQ==", "user": {"login": "shoyer", "id": 1217238, "node_id": "MDQ6VXNlcjEyMTcyMzg=", "avatar_url": "https://avatars2.githubusercontent.com/u/1217238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shoyer", "html_url": "https://github.com/shoyer", "followers_url": "https://api.github.com/users/shoyer/followers", "following_url": "https://api.github.com/users/shoyer/following{/other_user}", "gists_url": "https://api.github.com/users/shoyer/gists{/gist_id}", "starred_url": "https://api.github.com/users/shoyer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shoyer/subscriptions", "organizations_url": "https://api.github.com/users/shoyer/orgs", "repos_url": "https://api.github.com/users/shoyer/repos", "events_url": "https://api.github.com/users/shoyer/events{/privacy}", "received_events_url": "https://api.github.com/users/shoyer/received_events", "type": "User", "site_admin": false}, "created_at": "2017-05-06T22:28:10Z", "updated_at": "2017-05-07T19:54:55Z", "author_association": "MEMBER", "body_html": "<p>I'm reopening this issue since I think it's still a valid feature request -- <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=2342391\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/yuanbyu\">@yuanbyu</a>'s comment <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"124740366\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/675\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/675/hovercard?comment_id=241961454&amp;comment_type=issue_comment\" href=\"https://github.com/tensorflow/tensorflow/issues/675#issuecomment-241961454\">#675 (comment)</a> from last year closing it seems to be talking about something else.</p>\n<p>One simple way to implement this in TensorFlow -- though possibly not the most efficient -- is with <code>tf.reshape</code>, <code>tf.map_fn</code> and <code>tf.gradients</code>:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">def</span> <span class=\"pl-en\">jacobian</span>(<span class=\"pl-smi\">y</span>, <span class=\"pl-smi\">x</span>):\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">fn</span>(<span class=\"pl-smi\">y_i</span>):\n    (result,) <span class=\"pl-k\">=</span> tf.gradients(y_i, x)\n    <span class=\"pl-k\">return</span> result\n  y_flat <span class=\"pl-k\">=</span> tf.reshape(y, (<span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>,))\n  jacobian_flat <span class=\"pl-k\">=</span> tf.map_fn(fn, y_flat)\n  <span class=\"pl-k\">return</span> tf.reshape(jacobian_flat, y.shape.concatenate(x.shape))</pre></div>\n<p><strong>EDIT: This doesn't work, see <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=5112840\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/harpone\">@harpone</a>'s comment below for a version that works</strong></p>\n<p>Example usage:</p>\n<pre><code>&gt;&gt;&gt; x = tf.ones((3,))\n&gt;&gt;&gt; y = x ** 2\n&gt;&gt;&gt; jacobian(y, x)\n&lt;tf.Tensor 'Reshape_6:0' shape=(3, 3) dtype=float32&gt;\n</code></pre>\n<p>Could we simply add <code>tf.jacobian</code> to the TensorFlow API and keep <code>tf.gradients</code> unchanged?</p>", "body_text": "I'm reopening this issue since I think it's still a valid feature request -- @yuanbyu's comment #675 (comment) from last year closing it seems to be talking about something else.\nOne simple way to implement this in TensorFlow -- though possibly not the most efficient -- is with tf.reshape, tf.map_fn and tf.gradients:\ndef jacobian(y, x):\n  def fn(y_i):\n    (result,) = tf.gradients(y_i, x)\n    return result\n  y_flat = tf.reshape(y, (-1,))\n  jacobian_flat = tf.map_fn(fn, y_flat)\n  return tf.reshape(jacobian_flat, y.shape.concatenate(x.shape))\nEDIT: This doesn't work, see @harpone's comment below for a version that works\nExample usage:\n>>> x = tf.ones((3,))\n>>> y = x ** 2\n>>> jacobian(y, x)\n<tf.Tensor 'Reshape_6:0' shape=(3, 3) dtype=float32>\n\nCould we simply add tf.jacobian to the TensorFlow API and keep tf.gradients unchanged?", "body": "I'm reopening this issue since I think it's still a valid feature request -- @yuanbyu's comment https://github.com/tensorflow/tensorflow/issues/675#issuecomment-241961454 from last year closing it seems to be talking about something else.\r\n\r\nOne simple way to implement this in TensorFlow -- though possibly not the most efficient -- is with `tf.reshape`, `tf.map_fn` and `tf.gradients`:\r\n```python\r\ndef jacobian(y, x):\r\n  def fn(y_i):\r\n    (result,) = tf.gradients(y_i, x)\r\n    return result\r\n  y_flat = tf.reshape(y, (-1,))\r\n  jacobian_flat = tf.map_fn(fn, y_flat)\r\n  return tf.reshape(jacobian_flat, y.shape.concatenate(x.shape))\r\n```\r\n**EDIT: This doesn't work, see @harpone's comment below for a version that works**\r\n\r\nExample usage:\r\n```\r\n>>> x = tf.ones((3,))\r\n>>> y = x ** 2\r\n>>> jacobian(y, x)\r\n<tf.Tensor 'Reshape_6:0' shape=(3, 3) dtype=float32>\r\n```\r\n\r\nCould we simply add `tf.jacobian` to the TensorFlow API and keep `tf.gradients` unchanged?"}