{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8754", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8754/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8754/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8754/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/8754", "id": 217276440, "node_id": "MDU6SXNzdWUyMTcyNzY0NDA=", "number": 8754, "title": "tf.nn.max_pool works incorrectly with option:  data_format=\"NCHW\" on GPU", "user": {"login": "Yozey", "id": 12587390, "node_id": "MDQ6VXNlcjEyNTg3Mzkw", "avatar_url": "https://avatars2.githubusercontent.com/u/12587390?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Yozey", "html_url": "https://github.com/Yozey", "followers_url": "https://api.github.com/users/Yozey/followers", "following_url": "https://api.github.com/users/Yozey/following{/other_user}", "gists_url": "https://api.github.com/users/Yozey/gists{/gist_id}", "starred_url": "https://api.github.com/users/Yozey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Yozey/subscriptions", "organizations_url": "https://api.github.com/users/Yozey/orgs", "repos_url": "https://api.github.com/users/Yozey/repos", "events_url": "https://api.github.com/users/Yozey/events{/privacy}", "received_events_url": "https://api.github.com/users/Yozey/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-03-27T15:04:43Z", "updated_at": "2017-03-27T15:09:20Z", "closed_at": "2017-03-27T15:08:32Z", "author_association": "NONE", "body_html": "<p>The max_pooling operation seems to be ignorant of the data_format option of \"NCHW\" and treat the input data as \"NHWC\"</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>with tf.device('/gpu:0'):<br>\n...     a=tf.zeros((100,3,224,224))<br>\n...     b=tf.nn.max_pool(a, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1],padding=\"SAME\",data_format=\"NCHW\")<br>\n...<br>\nb<br>\n&lt;tf.Tensor 'MaxPool:0' shape=(100, 2, 112, 224) dtype=float32&gt;</p>\n</blockquote>\n</blockquote>\n</blockquote>\n<p>I think the shape of the 'b' variable should be (100,3,112,112) instead of (100, 2, 112, 224). The max pooling operations seems to operate on the wrong axis.</p>\n<h3>What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?</h3>\n<p>None</p>\n<h3>Environment info</h3>\n<p>Operating System:<br>\nUbuntu LTS 16.04</p>\n<p>Installed version of CUDA and cuDNN:<br>\n(please attach the output of <code>ls -l /path/to/cuda/lib/libcud*</code>):<br>\n-rw-r--r-- 1 root root   558720 sept. 15  2016 /usr/local/cuda-8.0/lib64/libcudadevrt.a<br>\nlrwxrwxrwx 1 root root       16 sept. 15  2016 /usr/local/cuda-8.0/lib64/libcudart.so -&gt; libcudart.so.8.0<br>\nlrwxrwxrwx 1 root root       19 sept. 15  2016 /usr/local/cuda-8.0/lib64/libcudart.so.8.0 -&gt; libcudart.so.8.0.44<br>\n-rw-r--r-- 1 root root   415432 sept. 15  2016 /usr/local/cuda-8.0/lib64/libcudart.so.8.0.44<br>\n-rw-r--r-- 1 root root   775162 sept. 15  2016 /usr/local/cuda-8.0/lib64/libcudart_static.a<br>\nlrwxrwxrwx 1 root root       13 oct.   5 10:46 /usr/local/cuda-8.0/lib64/libcudnn.so -&gt; libcudnn.so.5<br>\nlrwxrwxrwx 1 root root       17 oct.   5 10:46 /usr/local/cuda-8.0/lib64/libcudnn.so.5 -&gt; libcudnn.so.5.1.5<br>\n-rwxr-xr-x 1 root root 79337624 oct.   5 10:46 /usr/local/cuda-8.0/lib64/libcudnn.so.5.1.5<br>\n-rw-r--r-- 1 root root 69756172 oct.   5 10:46 /usr/local/cuda-8.0/lib64/libcudnn_static.a</p>\n<p>If installed from binary pip package, provide:</p>\n<ol>\n<li>A link to the pip package you installed: <a href=\"https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.0.1-cp35-cp35m-linux_x86_64.whl\" rel=\"nofollow\">https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.0.1-cp35-cp35m-linux_x86_64.whl</a></li>\n<li>The output from <code>python -c \"import tensorflow; print(tensorflow.__version__)\"</code>.<br>\n1.0.1</li>\n</ol>\n<h3>If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)</h3>\n<p>with tf.device('/gpu:0'):<br>\n...     a=tf.zeros((100,3,224,224))<br>\n...     b=tf.nn.max_pool(a, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1],padding=\"SAME\",data_format=\"NCHW\")<br>\n...<br>\nb<br>\n&lt;tf.Tensor 'MaxPool:0' shape=(100, 2, 112, 224) dtype=float32&gt;</p>\n<h3>What other attempted solutions have you tried?</h3>\n<p>None</p>\n<h3>Logs or other output that would be helpful</h3>\n<p>(If logs are large, please upload as attachment or provide link).</p>", "body_text": "The max_pooling operation seems to be ignorant of the data_format option of \"NCHW\" and treat the input data as \"NHWC\"\n\n\n\nwith tf.device('/gpu:0'):\n...     a=tf.zeros((100,3,224,224))\n...     b=tf.nn.max_pool(a, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1],padding=\"SAME\",data_format=\"NCHW\")\n...\nb\n<tf.Tensor 'MaxPool:0' shape=(100, 2, 112, 224) dtype=float32>\n\n\n\nI think the shape of the 'b' variable should be (100,3,112,112) instead of (100, 2, 112, 224). The max pooling operations seems to operate on the wrong axis.\nWhat related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\nNone\nEnvironment info\nOperating System:\nUbuntu LTS 16.04\nInstalled version of CUDA and cuDNN:\n(please attach the output of ls -l /path/to/cuda/lib/libcud*):\n-rw-r--r-- 1 root root   558720 sept. 15  2016 /usr/local/cuda-8.0/lib64/libcudadevrt.a\nlrwxrwxrwx 1 root root       16 sept. 15  2016 /usr/local/cuda-8.0/lib64/libcudart.so -> libcudart.so.8.0\nlrwxrwxrwx 1 root root       19 sept. 15  2016 /usr/local/cuda-8.0/lib64/libcudart.so.8.0 -> libcudart.so.8.0.44\n-rw-r--r-- 1 root root   415432 sept. 15  2016 /usr/local/cuda-8.0/lib64/libcudart.so.8.0.44\n-rw-r--r-- 1 root root   775162 sept. 15  2016 /usr/local/cuda-8.0/lib64/libcudart_static.a\nlrwxrwxrwx 1 root root       13 oct.   5 10:46 /usr/local/cuda-8.0/lib64/libcudnn.so -> libcudnn.so.5\nlrwxrwxrwx 1 root root       17 oct.   5 10:46 /usr/local/cuda-8.0/lib64/libcudnn.so.5 -> libcudnn.so.5.1.5\n-rwxr-xr-x 1 root root 79337624 oct.   5 10:46 /usr/local/cuda-8.0/lib64/libcudnn.so.5.1.5\n-rw-r--r-- 1 root root 69756172 oct.   5 10:46 /usr/local/cuda-8.0/lib64/libcudnn_static.a\nIf installed from binary pip package, provide:\n\nA link to the pip package you installed: https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.0.1-cp35-cp35m-linux_x86_64.whl\nThe output from python -c \"import tensorflow; print(tensorflow.__version__)\".\n1.0.1\n\nIf possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\nwith tf.device('/gpu:0'):\n...     a=tf.zeros((100,3,224,224))\n...     b=tf.nn.max_pool(a, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1],padding=\"SAME\",data_format=\"NCHW\")\n...\nb\n<tf.Tensor 'MaxPool:0' shape=(100, 2, 112, 224) dtype=float32>\nWhat other attempted solutions have you tried?\nNone\nLogs or other output that would be helpful\n(If logs are large, please upload as attachment or provide link).", "body": "The max_pooling operation seems to be ignorant of the data_format option of \"NCHW\" and treat the input data as \"NHWC\"\r\n\r\n>>> with tf.device('/gpu:0'):\r\n...     a=tf.zeros((100,3,224,224))\r\n...     b=tf.nn.max_pool(a, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1],padding=\"SAME\",data_format=\"NCHW\")\r\n... \r\n>>> b\r\n<tf.Tensor 'MaxPool:0' shape=(100, 2, 112, 224) dtype=float32>\r\n\r\nI think the shape of the 'b' variable should be (100,3,112,112) instead of (100, 2, 112, 224). The max pooling operations seems to operate on the wrong axis.\r\n\r\n### What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\r\nNone \r\n### Environment info\r\nOperating System:\r\nUbuntu LTS 16.04\r\n\r\nInstalled version of CUDA and cuDNN: \r\n(please attach the output of `ls -l /path/to/cuda/lib/libcud*`):\r\n-rw-r--r-- 1 root root   558720 sept. 15  2016 /usr/local/cuda-8.0/lib64/libcudadevrt.a\r\nlrwxrwxrwx 1 root root       16 sept. 15  2016 /usr/local/cuda-8.0/lib64/libcudart.so -> libcudart.so.8.0\r\nlrwxrwxrwx 1 root root       19 sept. 15  2016 /usr/local/cuda-8.0/lib64/libcudart.so.8.0 -> libcudart.so.8.0.44\r\n-rw-r--r-- 1 root root   415432 sept. 15  2016 /usr/local/cuda-8.0/lib64/libcudart.so.8.0.44\r\n-rw-r--r-- 1 root root   775162 sept. 15  2016 /usr/local/cuda-8.0/lib64/libcudart_static.a\r\nlrwxrwxrwx 1 root root       13 oct.   5 10:46 /usr/local/cuda-8.0/lib64/libcudnn.so -> libcudnn.so.5\r\nlrwxrwxrwx 1 root root       17 oct.   5 10:46 /usr/local/cuda-8.0/lib64/libcudnn.so.5 -> libcudnn.so.5.1.5\r\n-rwxr-xr-x 1 root root 79337624 oct.   5 10:46 /usr/local/cuda-8.0/lib64/libcudnn.so.5.1.5\r\n-rw-r--r-- 1 root root 69756172 oct.   5 10:46 /usr/local/cuda-8.0/lib64/libcudnn_static.a\r\n\r\n\r\nIf installed from binary pip package, provide:\r\n\r\n1. A link to the pip package you installed: https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.0.1-cp35-cp35m-linux_x86_64.whl\r\n2. The output from `python -c \"import tensorflow; print(tensorflow.__version__)\"`.\r\n1.0.1\r\n\r\n\r\n### If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\r\nwith tf.device('/gpu:0'):\r\n...     a=tf.zeros((100,3,224,224))\r\n...     b=tf.nn.max_pool(a, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1],padding=\"SAME\",data_format=\"NCHW\")\r\n... \r\nb\r\n<tf.Tensor 'MaxPool:0' shape=(100, 2, 112, 224) dtype=float32>\r\n\r\n### What other attempted solutions have you tried?\r\nNone\r\n\r\n### Logs or other output that would be helpful\r\n(If logs are large, please upload as attachment or provide link).\r\n"}