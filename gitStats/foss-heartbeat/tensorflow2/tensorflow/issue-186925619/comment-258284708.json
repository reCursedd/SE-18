{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/258284708", "html_url": "https://github.com/tensorflow/tensorflow/issues/5362#issuecomment-258284708", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5362", "id": 258284708, "node_id": "MDEyOklzc3VlQ29tbWVudDI1ODI4NDcwOA==", "user": {"login": "alexatknit", "id": 15474222, "node_id": "MDQ6VXNlcjE1NDc0MjIy", "avatar_url": "https://avatars2.githubusercontent.com/u/15474222?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexatknit", "html_url": "https://github.com/alexatknit", "followers_url": "https://api.github.com/users/alexatknit/followers", "following_url": "https://api.github.com/users/alexatknit/following{/other_user}", "gists_url": "https://api.github.com/users/alexatknit/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexatknit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexatknit/subscriptions", "organizations_url": "https://api.github.com/users/alexatknit/orgs", "repos_url": "https://api.github.com/users/alexatknit/repos", "events_url": "https://api.github.com/users/alexatknit/events{/privacy}", "received_events_url": "https://api.github.com/users/alexatknit/received_events", "type": "User", "site_admin": false}, "created_at": "2016-11-03T21:49:58Z", "updated_at": "2016-11-03T23:28:52Z", "author_association": "NONE", "body_html": "<p>My cluster is launched remotely, I set the environment variable in python, my workers and parameter server are launched from a python process listening to a specific port. It looks like the separate processes all have their own environment variables, so unless those need to be set before importing tensorflow in the first place they should be set based on:</p>\n<div class=\"highlight highlight-source-python\"><pre>gpu_devices <span class=\"pl-k\">=</span> [device.split(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>:<span class=\"pl-pds\">'</span></span>)[<span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>] <span class=\"pl-k\">for</span> device <span class=\"pl-k\">in</span> devices <span class=\"pl-k\">if</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>gpu<span class=\"pl-pds\">'</span></span> <span class=\"pl-k\">in</span> device]\n<span class=\"pl-k\">if</span> <span class=\"pl-c1\">len</span>(gpu_devices) <span class=\"pl-k\">&gt;</span> <span class=\"pl-c1\">0</span>:\n  environ[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>CUDA_VISIBLE_DEVICES<span class=\"pl-pds\">'</span></span>] <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>,<span class=\"pl-pds\">'</span></span>.join(gpu_devices)</pre></div>", "body_text": "My cluster is launched remotely, I set the environment variable in python, my workers and parameter server are launched from a python process listening to a specific port. It looks like the separate processes all have their own environment variables, so unless those need to be set before importing tensorflow in the first place they should be set based on:\ngpu_devices = [device.split(':')[-1] for device in devices if 'gpu' in device]\nif len(gpu_devices) > 0:\n  environ['CUDA_VISIBLE_DEVICES'] = ','.join(gpu_devices)", "body": "My cluster is launched remotely, I set the environment variable in python, my workers and parameter server are launched from a python process listening to a specific port. It looks like the separate processes all have their own environment variables, so unless those need to be set before importing tensorflow in the first place they should be set based on:\n\n``` python\ngpu_devices = [device.split(':')[-1] for device in devices if 'gpu' in device]\nif len(gpu_devices) > 0:\n  environ['CUDA_VISIBLE_DEVICES'] = ','.join(gpu_devices)\n```\n"}