{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/183191029", "pull_request_review_id": 114152763, "id": 183191029, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4MzE5MTAyOQ==", "diff_hunk": "@@ -0,0 +1,1630 @@\n+#include <avro.h>\n+#include <vector>\n+#include <algorithm>\n+#include <iterator>\n+#include \"tensorflow/core/lib/gtl/inlined_vector.h\"\n+#include \"tensorflow/core/framework/common_shape_fns.h\"\n+#include \"tensorflow/core/framework/shape_inference.h\"\n+#include \"tensorflow/core/framework/op.h\"\n+#include \"tensorflow/core/framework/op_kernel.h\"\n+#include \"tensorflow/core/framework/tensor.h\"\n+#include \"tensorflow/core/framework/tensor_shape.h\"\n+#include \"tensorflow/core/framework/types.h\"\n+#include \"tensorflow/core/lib/core/errors.h\"\n+#include \"tensorflow/core/lib/strings/numbers.h\"\n+#include \"tensorflow/core/platform/logging.h\"\n+#include \"avro_helper.h\"\n+\n+using namespace tensorflow;\n+using ::tensorflow::shape_inference::ShapeHandle;\n+\n+template <typename T>\n+using SmallVector = gtl::InlinedVector<T, 4>; // Up to 4 items are stored without allocating heap memory\n+\n+// Register the parse function when building the shared library\n+// For the op I used as boiler plate: tensorflow/core/ops/parsing_ops.cc and there 'ParseExample'\n+// For the op kernel I used as boiler plate: tensorflow/core/kernels/example_parsing_ops.cc and there 'ExampleParserOp'\n+// For the compute method I used as boiler plate: tensorflow/core/util/example_proto_fast_parsing.cc and there the\n+//   method 'FastParseExample'\n+\n+REGISTER_OP(\"ParseAvroRecord\")\n+    .Input(\"serialized: string\")\n+    .Input(\"sparse_keys: Nsparse * string\")\n+    .Input(\"dense_keys: Ndense * string\")\n+    .Input(\"dense_defaults: Tdense\")\n+    .Output(\"sparse_indices: Nsparse * int64\")\n+    .Output(\"sparse_values: sparse_types\")\n+    .Output(\"sparse_shapes: Nsparse * int64\")\n+    .Output(\"dense_values: Tdense\")\n+    .Attr(\"Nsparse: int >= 0\")  // Inferred from sparse_keys\n+    .Attr(\"Ndense: int >= 0\")   // Inferred from dense_keys\n+    .Attr(\"sparse_types: list({float,double,int64,int32,string,bool}) >= 0\")\n+    .Attr(\"Tdense: list({float,double,int64,int32,string,bool}) >= 0\")\n+    .Attr(\"dense_shapes: list(shape) >= 0\")\n+    .Attr(\"schema: string\")\n+    .SetShapeFn([](::tensorflow::shape_inference::InferenceContext* c) {\n+\n+      ParseAvroAttrs attrs;\n+      TF_RETURN_IF_ERROR(attrs.Init(c));\n+\n+      // Get the batch size and load it into input\n+      ShapeHandle input;\n+      TF_RETURN_IF_ERROR(c->WithRank(c->input(0), 1, &input));\n+\n+      string schema;\n+      avro_schema_t reader_schema;\n+\n+      // Parse schema\n+      TF_RETURN_IF_ERROR(c->GetAttr(\"schema\", &schema));\n+      TF_RETURN_IF_ERROR(avro_schema_from_json_length(schema.c_str(), schema.length(), &reader_schema) == 0 ?\n+        Status::OK() : errors::InvalidArgument(\"The provided json schema is invalid. \", avro_strerror()));", "path": "tensorflow/contrib/avro/ops/parse_avro_record.cc", "position": null, "original_position": 60, "commit_id": "bdf790d5c888e59d593230286edaaf5314daaee5", "original_commit_id": "abf605ba22c95f52116b765c90f889b9f17692c1", "user": {"login": "fraudies", "id": 1770877, "node_id": "MDQ6VXNlcjE3NzA4Nzc=", "avatar_url": "https://avatars0.githubusercontent.com/u/1770877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fraudies", "html_url": "https://github.com/fraudies", "followers_url": "https://api.github.com/users/fraudies/followers", "following_url": "https://api.github.com/users/fraudies/following{/other_user}", "gists_url": "https://api.github.com/users/fraudies/gists{/gist_id}", "starred_url": "https://api.github.com/users/fraudies/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fraudies/subscriptions", "organizations_url": "https://api.github.com/users/fraudies/orgs", "repos_url": "https://api.github.com/users/fraudies/repos", "events_url": "https://api.github.com/users/fraudies/events{/privacy}", "received_events_url": "https://api.github.com/users/fraudies/received_events", "type": "User", "site_admin": false}, "body": "Changed logic. Logging schema at level \"INFO\".  There does not seem to be a DEBUG level for the logger; see https://github.com/tensorflow/tensorflow/blob/352142267a1a151b04c6198de83b40b7e979d1d8/tensorflow/core/platform/default/logging.cc", "created_at": "2018-04-20T23:53:05Z", "updated_at": "2018-10-22T21:28:38Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/18224#discussion_r183191029", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/18224", "author_association": "NONE", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/183191029"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/18224#discussion_r183191029"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/18224"}}, "body_html": "<p>Changed logic. Logging schema at level \"INFO\".  There does not seem to be a DEBUG level for the logger; see <a href=\"https://github.com/tensorflow/tensorflow/blob/352142267a1a151b04c6198de83b40b7e979d1d8/tensorflow/core/platform/default/logging.cc\">https://github.com/tensorflow/tensorflow/blob/352142267a1a151b04c6198de83b40b7e979d1d8/tensorflow/core/platform/default/logging.cc</a></p>", "body_text": "Changed logic. Logging schema at level \"INFO\".  There does not seem to be a DEBUG level for the logger; see https://github.com/tensorflow/tensorflow/blob/352142267a1a151b04c6198de83b40b7e979d1d8/tensorflow/core/platform/default/logging.cc", "in_reply_to_id": 180931011}