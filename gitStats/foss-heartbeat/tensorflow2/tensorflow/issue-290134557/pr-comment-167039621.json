{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/167039621", "pull_request_review_id": 95199190, "id": 167039621, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2NzAzOTYyMQ==", "diff_hunk": "@@ -1128,18 +1128,8 @@ tensorflow::Status ConvertConst(Converter& ctx,\n   } else if (!weights_tensor.tensor_content().empty()) {\n     VLOG(2) << \"TENSOR!!!\" << node_def.name();\n     const auto& content = weights_tensor.tensor_content();\n-\n-    std::vector<char> values;", "path": "tensorflow/contrib/tensorrt/convert/convert_nodes.cc", "position": null, "original_position": 5, "commit_id": "1e4b5b8c0cc1675b9ecac3569c91563a2a4f9984", "original_commit_id": "bbe79073d63f610ec6f3448d616fe8d72c2502d4", "user": {"login": "jjsjann123", "id": 3709243, "node_id": "MDQ6VXNlcjM3MDkyNDM=", "avatar_url": "https://avatars3.githubusercontent.com/u/3709243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jjsjann123", "html_url": "https://github.com/jjsjann123", "followers_url": "https://api.github.com/users/jjsjann123/followers", "following_url": "https://api.github.com/users/jjsjann123/following{/other_user}", "gists_url": "https://api.github.com/users/jjsjann123/gists{/gist_id}", "starred_url": "https://api.github.com/users/jjsjann123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jjsjann123/subscriptions", "organizations_url": "https://api.github.com/users/jjsjann123/orgs", "repos_url": "https://api.github.com/users/jjsjann123/repos", "events_url": "https://api.github.com/users/jjsjann123/events{/privacy}", "received_events_url": "https://api.github.com/users/jjsjann123/received_events", "type": "User", "site_admin": false}, "body": "There's some memory issue with the owned_value_. Data gets corrupted among many copies there. Moreover, we shouldn't need to make more than one copy of each weight anyway.\r\nWe allocate temporary memory per weight during the whole scope of the conversion. And pass pointers around.\r\n\r\nRemoved the std::vector for that part and port::CopyToArray throw data into our temporary memory. Please let me know if it makes internal build happy :)\r\n\r\nNext PR will remove owned_value and clean it up.", "created_at": "2018-02-08T19:17:25Z", "updated_at": "2018-02-12T23:36:57Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/16253#discussion_r167039621", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/16253", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/167039621"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/16253#discussion_r167039621"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/16253"}}, "body_html": "<p>There's some memory issue with the owned_value_. Data gets corrupted among many copies there. Moreover, we shouldn't need to make more than one copy of each weight anyway.<br>\nWe allocate temporary memory per weight during the whole scope of the conversion. And pass pointers around.</p>\n<p>Removed the std::vector for that part and port::CopyToArray throw data into our temporary memory. Please let me know if it makes internal build happy :)</p>\n<p>Next PR will remove owned_value and clean it up.</p>", "body_text": "There's some memory issue with the owned_value_. Data gets corrupted among many copies there. Moreover, we shouldn't need to make more than one copy of each weight anyway.\nWe allocate temporary memory per weight during the whole scope of the conversion. And pass pointers around.\nRemoved the std::vector for that part and port::CopyToArray throw data into our temporary memory. Please let me know if it makes internal build happy :)\nNext PR will remove owned_value and clean it up.", "in_reply_to_id": 166836844}