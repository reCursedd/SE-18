{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/312594227", "html_url": "https://github.com/tensorflow/tensorflow/issues/11144#issuecomment-312594227", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11144", "id": 312594227, "node_id": "MDEyOklzc3VlQ29tbWVudDMxMjU5NDIyNw==", "user": {"login": "julj", "id": 23333384, "node_id": "MDQ6VXNlcjIzMzMzMzg0", "avatar_url": "https://avatars3.githubusercontent.com/u/23333384?v=4", "gravatar_id": "", "url": "https://api.github.com/users/julj", "html_url": "https://github.com/julj", "followers_url": "https://api.github.com/users/julj/followers", "following_url": "https://api.github.com/users/julj/following{/other_user}", "gists_url": "https://api.github.com/users/julj/gists{/gist_id}", "starred_url": "https://api.github.com/users/julj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/julj/subscriptions", "organizations_url": "https://api.github.com/users/julj/orgs", "repos_url": "https://api.github.com/users/julj/repos", "events_url": "https://api.github.com/users/julj/events{/privacy}", "received_events_url": "https://api.github.com/users/julj/received_events", "type": "User", "site_admin": false}, "created_at": "2017-07-03T09:19:11Z", "updated_at": "2017-07-03T09:19:11Z", "author_association": "NONE", "body_html": "<p>Sure.</p>\n<p>For the reason explained in my first description of the issue, stacking PhasedLSTMCells with MultiRNNCell, e.g.</p>\n<pre><code>inputs = tf.placeholder(tf.float32, shape=(batch_size, max_seq_len, 1))            \ntimes = tf.placeholder(tf.float32, shape=(batch_size, max_seq_len, 1))\n\ntargets = tf.placeholder(tf.float32, [batch_size, n_classes])\n\n# Stacking rnn cells\ncells = []\nfor i in range(n_layers):            \n    cells.append(tf.contrib.rnn.PhasedLSTMCell(n_hidden))\n        \nstack = tf.nn.rnn_cell.MultiRNNCell(cells, state_is_tuple=True)\noutputs, _ = tf.nn.dynamic_rnn(stack, (times, inputs), seq_len, dtype=tf.float32)\n</code></pre>\n<p>raises the following error :</p>\n<pre><code>File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/ops/rnn.py\", line 206, in _rnn_step\n   new_output, new_state = call_cell()\n File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/ops/rnn.py\", line 708, in &lt;lambda&gt;\n   call_cell = lambda: cell(input_t, state)\n File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/ops/rnn_cell_impl.py\", line 180, in __call__\n   return super(RNNCell, self).__call__(inputs, state)\n File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/layers/base.py\", line 441, in __call__\n   outputs = self.call(inputs, *args, **kwargs)\n File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/ops/rnn_cell_impl.py\", line 916, in call\n   cur_inp, new_state = cell(cur_inp, cur_state)\n File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/ops/rnn_cell_impl.py\", line 180, in __call__\n   return super(RNNCell, self).__call__(inputs, state)\n File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/layers/base.py\", line 441, in __call__\n   outputs = self.call(inputs, *args, **kwargs)\n File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/contrib/rnn/python/ops/rnn_cell.py\", line 1867, in call\n   (time, x) = inputs\n File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 541, in __iter__\n   raise TypeError(\"'Tensor' object is not iterable.\")\nTypeError: 'Tensor' object is not iterable.\n</code></pre>\n<p>A (maybe not very elegant) option to solve this issue is to write a dedicated MultiPhasedLSTMCell with the patch I provided.</p>", "body_text": "Sure.\nFor the reason explained in my first description of the issue, stacking PhasedLSTMCells with MultiRNNCell, e.g.\ninputs = tf.placeholder(tf.float32, shape=(batch_size, max_seq_len, 1))            \ntimes = tf.placeholder(tf.float32, shape=(batch_size, max_seq_len, 1))\n\ntargets = tf.placeholder(tf.float32, [batch_size, n_classes])\n\n# Stacking rnn cells\ncells = []\nfor i in range(n_layers):            \n    cells.append(tf.contrib.rnn.PhasedLSTMCell(n_hidden))\n        \nstack = tf.nn.rnn_cell.MultiRNNCell(cells, state_is_tuple=True)\noutputs, _ = tf.nn.dynamic_rnn(stack, (times, inputs), seq_len, dtype=tf.float32)\n\nraises the following error :\nFile \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/ops/rnn.py\", line 206, in _rnn_step\n   new_output, new_state = call_cell()\n File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/ops/rnn.py\", line 708, in <lambda>\n   call_cell = lambda: cell(input_t, state)\n File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/ops/rnn_cell_impl.py\", line 180, in __call__\n   return super(RNNCell, self).__call__(inputs, state)\n File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/layers/base.py\", line 441, in __call__\n   outputs = self.call(inputs, *args, **kwargs)\n File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/ops/rnn_cell_impl.py\", line 916, in call\n   cur_inp, new_state = cell(cur_inp, cur_state)\n File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/ops/rnn_cell_impl.py\", line 180, in __call__\n   return super(RNNCell, self).__call__(inputs, state)\n File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/layers/base.py\", line 441, in __call__\n   outputs = self.call(inputs, *args, **kwargs)\n File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/contrib/rnn/python/ops/rnn_cell.py\", line 1867, in call\n   (time, x) = inputs\n File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 541, in __iter__\n   raise TypeError(\"'Tensor' object is not iterable.\")\nTypeError: 'Tensor' object is not iterable.\n\nA (maybe not very elegant) option to solve this issue is to write a dedicated MultiPhasedLSTMCell with the patch I provided.", "body": "Sure.\r\n\r\nFor the reason explained in my first description of the issue, stacking PhasedLSTMCells with MultiRNNCell, e.g.\r\n\r\n```\r\ninputs = tf.placeholder(tf.float32, shape=(batch_size, max_seq_len, 1))            \r\ntimes = tf.placeholder(tf.float32, shape=(batch_size, max_seq_len, 1))\r\n\r\ntargets = tf.placeholder(tf.float32, [batch_size, n_classes])\r\n\r\n# Stacking rnn cells\r\ncells = []\r\nfor i in range(n_layers):            \r\n    cells.append(tf.contrib.rnn.PhasedLSTMCell(n_hidden))\r\n        \r\nstack = tf.nn.rnn_cell.MultiRNNCell(cells, state_is_tuple=True)\r\noutputs, _ = tf.nn.dynamic_rnn(stack, (times, inputs), seq_len, dtype=tf.float32)\r\n```\r\n\r\n\r\n\r\n\r\n raises the following error : \r\n\r\n ```\r\nFile \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/ops/rnn.py\", line 206, in _rnn_step\r\n    new_output, new_state = call_cell()\r\n  File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/ops/rnn.py\", line 708, in <lambda>\r\n    call_cell = lambda: cell(input_t, state)\r\n  File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/ops/rnn_cell_impl.py\", line 180, in __call__\r\n    return super(RNNCell, self).__call__(inputs, state)\r\n  File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/layers/base.py\", line 441, in __call__\r\n    outputs = self.call(inputs, *args, **kwargs)\r\n  File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/ops/rnn_cell_impl.py\", line 916, in call\r\n    cur_inp, new_state = cell(cur_inp, cur_state)\r\n  File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/ops/rnn_cell_impl.py\", line 180, in __call__\r\n    return super(RNNCell, self).__call__(inputs, state)\r\n  File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/layers/base.py\", line 441, in __call__\r\n    outputs = self.call(inputs, *args, **kwargs)\r\n  File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/contrib/rnn/python/ops/rnn_cell.py\", line 1867, in call\r\n    (time, x) = inputs\r\n  File \"/home/jul/.miniconda3/envs/plstm/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 541, in __iter__\r\n    raise TypeError(\"'Tensor' object is not iterable.\")\r\nTypeError: 'Tensor' object is not iterable.\r\n```\r\n\r\nA (maybe not very elegant) option to solve this issue is to write a dedicated MultiPhasedLSTMCell with the patch I provided."}