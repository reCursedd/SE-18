{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/364582294", "html_url": "https://github.com/tensorflow/tensorflow/issues/15840#issuecomment-364582294", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15840", "id": 364582294, "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDU4MjI5NA==", "user": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "created_at": "2018-02-09T22:03:27Z", "updated_at": "2018-02-09T22:03:27Z", "author_association": "CONTRIBUTOR", "body_html": "<p>I'm guessing this occurred when you tried to build that library in a directory that contained artifacts from a previous build, perhaps based on a different version of the source.</p>\n<p>We only maintain the CMake build in a state where it can build from a clean repository (as part of the CI and release processes), and this is intended to be a temporary state of affairs until we can switch to using Bazel. I'd recommend cleaning out your build directory before each build, to avoid this kind of issue.</p>\n<p>We'd welcome contributions to improve the CMake build so that it doesn't fail in other scenarios, which I expect would involve changes to this part of the build script:</p>\n<p><div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/926fc13f7378d14fa7980963c4fe774e5922e336/tensorflow/contrib/cmake/tf_python.cmake#L544-L557\">tensorflow/tensorflow/contrib/cmake/tf_python.cmake</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n        Lines 544 to 557\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/926fc13f7378d14fa7980963c4fe774e5922e336\">926fc13</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L544\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"544\"></td>\n          <td id=\"LC544\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-k\">if</span>(<span class=\"pl-smi\">${CMAKE_GENERATOR}</span> <span class=\"pl-k\">MATCHES</span> <span class=\"pl-s\">\"Visual Studio.*\"</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L545\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"545\"></td>\n          <td id=\"LC545\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">     <span class=\"pl-c1\">set</span>(pywrap_tensorflow_deffile <span class=\"pl-s\">\"<span class=\"pl-smi\">${CMAKE_CURRENT_BINARY_DIR}</span>/<span class=\"pl-smi\">${CMAKE_BUILD_TYPE}</span>/pywrap_tensorflow.def\"</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L546\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"546\"></td>\n          <td id=\"LC546\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-k\">else</span>() </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L547\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"547\"></td>\n          <td id=\"LC547\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">     <span class=\"pl-c1\">set</span>(pywrap_tensorflow_deffile <span class=\"pl-s\">\"<span class=\"pl-smi\">${CMAKE_CURRENT_BINARY_DIR}</span>/pywrap_tensorflow.def\"</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L548\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"548\"></td>\n          <td id=\"LC548\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-k\">endif</span>() </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L549\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"549\"></td>\n          <td id=\"LC549\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-c1\">set_source_files_properties</span>(<span class=\"pl-smi\">${pywrap_tensorflow_deffile}</span> <span class=\"pl-k\">PROPERTIES</span> GENERATED TRUE) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L550\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"550\"></td>\n          <td id=\"LC550\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L551\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"551\"></td>\n          <td id=\"LC551\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-c1\">add_custom_command</span>(<span class=\"pl-k\">TARGET</span> pywrap_tensorflow_internal_static <span class=\"pl-k\">POST_BUILD</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L552\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"552\"></td>\n          <td id=\"LC552\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">     <span class=\"pl-k\">COMMAND</span> <span class=\"pl-smi\">${PYTHON_EXECUTABLE}</span> <span class=\"pl-smi\">${CMAKE_CURRENT_SOURCE_DIR}</span>/tools/create_def_file.py </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L553\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"553\"></td>\n          <td id=\"LC553\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">         --input <span class=\"pl-s\">\"<span class=\"pl-smi\">${pywrap_tensorflow_internal_static_dependencies}</span>\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L554\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"554\"></td>\n          <td id=\"LC554\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">         --output <span class=\"pl-s\">\"<span class=\"pl-smi\">${pywrap_tensorflow_deffile}</span>\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L555\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"555\"></td>\n          <td id=\"LC555\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">         --target _pywrap_tensorflow_internal.pyd </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L556\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"556\"></td>\n          <td id=\"LC556\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">     <span class=\"pl-k\">BYPRODUCTS</span> <span class=\"pl-smi\">${pywrap_tensorflow_deffile}</span> <span class=\"pl-c\"><span class=\"pl-c\">#</span> Required for Ninja</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L557\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"557\"></td>\n          <td id=\"LC557\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> ) </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>\n<p>/cc <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=22941064\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/guschmue\">@guschmue</a> in case you have an idea about how to regenerate the <code>.def</code> file at the appropriate time, or know another workaround for this problem.<br>\n/cc <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=9475\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ewilderj\">@ewilderj</a> FYI, another CMake issue that might be relevant to the tf-distribute SIG.</p>", "body_text": "I'm guessing this occurred when you tried to build that library in a directory that contained artifacts from a previous build, perhaps based on a different version of the source.\nWe only maintain the CMake build in a state where it can build from a clean repository (as part of the CI and release processes), and this is intended to be a temporary state of affairs until we can switch to using Bazel. I'd recommend cleaning out your build directory before each build, to avoid this kind of issue.\nWe'd welcome contributions to improve the CMake build so that it doesn't fail in other scenarios, which I expect would involve changes to this part of the build script:\n\n  \n    \n      tensorflow/tensorflow/contrib/cmake/tf_python.cmake\n    \n    \n        Lines 544 to 557\n      in\n      926fc13\n    \n    \n    \n    \n\n        \n          \n           if(${CMAKE_GENERATOR} MATCHES \"Visual Studio.*\") \n        \n\n        \n          \n               set(pywrap_tensorflow_deffile \"${CMAKE_CURRENT_BINARY_DIR}/${CMAKE_BUILD_TYPE}/pywrap_tensorflow.def\") \n        \n\n        \n          \n           else() \n        \n\n        \n          \n               set(pywrap_tensorflow_deffile \"${CMAKE_CURRENT_BINARY_DIR}/pywrap_tensorflow.def\") \n        \n\n        \n          \n           endif() \n        \n\n        \n          \n           set_source_files_properties(${pywrap_tensorflow_deffile} PROPERTIES GENERATED TRUE) \n        \n\n        \n          \n            \n        \n\n        \n          \n           add_custom_command(TARGET pywrap_tensorflow_internal_static POST_BUILD \n        \n\n        \n          \n               COMMAND ${PYTHON_EXECUTABLE} ${CMAKE_CURRENT_SOURCE_DIR}/tools/create_def_file.py \n        \n\n        \n          \n                   --input \"${pywrap_tensorflow_internal_static_dependencies}\" \n        \n\n        \n          \n                   --output \"${pywrap_tensorflow_deffile}\" \n        \n\n        \n          \n                   --target _pywrap_tensorflow_internal.pyd \n        \n\n        \n          \n               BYPRODUCTS ${pywrap_tensorflow_deffile} # Required for Ninja \n        \n\n        \n          \n           ) \n        \n    \n  \n\n\n/cc @guschmue in case you have an idea about how to regenerate the .def file at the appropriate time, or know another workaround for this problem.\n/cc @ewilderj FYI, another CMake issue that might be relevant to the tf-distribute SIG.", "body": "I'm guessing this occurred when you tried to build that library in a directory that contained artifacts from a previous build, perhaps based on a different version of the source.\r\n\r\nWe only maintain the CMake build in a state where it can build from a clean repository (as part of the CI and release processes), and this is intended to be a temporary state of affairs until we can switch to using Bazel. I'd recommend cleaning out your build directory before each build, to avoid this kind of issue.\r\n\r\nWe'd welcome contributions to improve the CMake build so that it doesn't fail in other scenarios, which I expect would involve changes to this part of the build script:\r\n\r\nhttps://github.com/tensorflow/tensorflow/blob/926fc13f7378d14fa7980963c4fe774e5922e336/tensorflow/contrib/cmake/tf_python.cmake#L544-L557\r\n\r\n/cc @guschmue in case you have an idea about how to regenerate the `.def` file at the appropriate time, or know another workaround for this problem.\r\n/cc @ewilderj FYI, another CMake issue that might be relevant to the tf-distribute SIG."}