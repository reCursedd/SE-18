{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20094", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20094/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20094/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20094/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/20094", "id": 333257622, "node_id": "MDU6SXNzdWUzMzMyNTc2MjI=", "number": 20094, "title": "Wrong Results for tf.matmul(X,Y) with X.shape[0]>2^21", "user": {"login": "jopege", "id": 40358486, "node_id": "MDQ6VXNlcjQwMzU4NDg2", "avatar_url": "https://avatars0.githubusercontent.com/u/40358486?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jopege", "html_url": "https://github.com/jopege", "followers_url": "https://api.github.com/users/jopege/followers", "following_url": "https://api.github.com/users/jopege/following{/other_user}", "gists_url": "https://api.github.com/users/jopege/gists{/gist_id}", "starred_url": "https://api.github.com/users/jopege/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jopege/subscriptions", "organizations_url": "https://api.github.com/users/jopege/orgs", "repos_url": "https://api.github.com/users/jopege/repos", "events_url": "https://api.github.com/users/jopege/events{/privacy}", "received_events_url": "https://api.github.com/users/jopege/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "chsigg", "id": 7523982, "node_id": "MDQ6VXNlcjc1MjM5ODI=", "avatar_url": "https://avatars3.githubusercontent.com/u/7523982?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chsigg", "html_url": "https://github.com/chsigg", "followers_url": "https://api.github.com/users/chsigg/followers", "following_url": "https://api.github.com/users/chsigg/following{/other_user}", "gists_url": "https://api.github.com/users/chsigg/gists{/gist_id}", "starred_url": "https://api.github.com/users/chsigg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chsigg/subscriptions", "organizations_url": "https://api.github.com/users/chsigg/orgs", "repos_url": "https://api.github.com/users/chsigg/repos", "events_url": "https://api.github.com/users/chsigg/events{/privacy}", "received_events_url": "https://api.github.com/users/chsigg/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "chsigg", "id": 7523982, "node_id": "MDQ6VXNlcjc1MjM5ODI=", "avatar_url": "https://avatars3.githubusercontent.com/u/7523982?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chsigg", "html_url": "https://github.com/chsigg", "followers_url": "https://api.github.com/users/chsigg/followers", "following_url": "https://api.github.com/users/chsigg/following{/other_user}", "gists_url": "https://api.github.com/users/chsigg/gists{/gist_id}", "starred_url": "https://api.github.com/users/chsigg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chsigg/subscriptions", "organizations_url": "https://api.github.com/users/chsigg/orgs", "repos_url": "https://api.github.com/users/chsigg/repos", "events_url": "https://api.github.com/users/chsigg/events{/privacy}", "received_events_url": "https://api.github.com/users/chsigg/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2018-06-18T12:55:58Z", "updated_at": "2018-11-12T20:47:09Z", "closed_at": "2018-11-12T20:47:08Z", "author_association": "NONE", "body_html": "<hr>\n<h3>System information</h3>\n<ul>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Win 10, 64bit</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: source</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.8.0 (same issue with 1.5.x)</li>\n<li><strong>Python version</strong>: 3.5.3</li>\n<li><strong>GPU model and memory</strong>: GTX 1080</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>When using <code>tf.matmul(X,Y)</code> with <code>X.shape==[n,2]</code> ,<code>Y.shape==[2,2]</code> <strong>AND</strong> <code>n&gt;2^21 #=2097152</code> only the first <code>[0:2^21 , : ]</code> results are correct</p>\n<ul>\n<li>Does only occur on GPU</li>\n<li>Does not occur if Y==tf.eye(2)</li>\n<li>it is possible to circumvent the problem by splitting the operation into chunks of <code>n&lt;=2**21</code></li>\n</ul>\n<p>-&gt; i guess a solution would be to automaticaly split the operation or warn the user</p>\n<h3>Source code</h3>\n<p><code>import tensorflow as tf</code></p>\n<p><code>X=tf.ones([10+2**21,2],dtype=tf.float32)</code><br>\n<code>Y=tf.constant([[1,0],[0.01,1]],dtype=tf.float32)</code><br>\n<code>mul=tf.matmul(X,Y)</code></p>\n<p><code>sess=tf.Session()</code><br>\n<code>sess.run(tf.global_variables_initializer())</code><br>\n<code>result=sess.run(mul)</code><br>\n<code>sess.close()</code></p>\n<p><code>print(\"These are ok: \" + str(result[2**21-2:2**21,:]))</code></p>\n<p><code>print(\"These are wrong: \" + str(result[2**21:2**21+2,:]))</code></p>\n<h3>Output Log</h3>\n<p><em>2018-06-18 14:49:53.627009: I T:\\src\\github\\tensorflow\\tensorflow\\core\\platform\\cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2<br>\n2018-06-18 14:49:53.868050: I T:\\src\\github\\tensorflow\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1356] Found device 0 with properties:<br>\nname: GeForce GTX 1080 major: 6 minor: 1 memoryClockRate(GHz): 1.7715<br>\npciBusID: 0000:03:00.0<br>\ntotalMemory: 8.00GiB freeMemory: 6.61GiB<br>\n2018-06-18 14:49:53.868514: I T:\\src\\github\\tensorflow\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1435] Adding visible gpu devices: 0<br>\n2018-06-18 14:49:54.450846: I T:\\src\\github\\tensorflow\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:923] Device interconnect StreamExecutor with strength 1 edge matrix:<br>\n2018-06-18 14:49:54.451158: I T:\\src\\github\\tensorflow\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:929]      0<br>\n2018-06-18 14:49:54.451346: I T:\\src\\github\\tensorflow\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:942] 0:   N<br>\n2018-06-18 14:49:54.451641: I T:\\src\\github\\tensorflow\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1053] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 6384 MB memory) -&gt; physical GPU (device: 0, name: GeForce GTX 1080, pci bus id: 0000:03:00.0, compute capability: 6.1)</em></p>\n<p>These are ok: [[1.01 1.  ]<br>\n[1.01 1.  ]]<br>\nThese are wrong: [[0. 0.]<br>\n[0. 0.]]</p>", "body_text": "System information\n\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Win 10, 64bit\nTensorFlow installed from (source or binary): source\nTensorFlow version (use command below): 1.8.0 (same issue with 1.5.x)\nPython version: 3.5.3\nGPU model and memory: GTX 1080\n\nDescribe the problem\nWhen using tf.matmul(X,Y) with X.shape==[n,2] ,Y.shape==[2,2] AND n>2^21 #=2097152 only the first [0:2^21 , : ] results are correct\n\nDoes only occur on GPU\nDoes not occur if Y==tf.eye(2)\nit is possible to circumvent the problem by splitting the operation into chunks of n<=2**21\n\n-> i guess a solution would be to automaticaly split the operation or warn the user\nSource code\nimport tensorflow as tf\nX=tf.ones([10+2**21,2],dtype=tf.float32)\nY=tf.constant([[1,0],[0.01,1]],dtype=tf.float32)\nmul=tf.matmul(X,Y)\nsess=tf.Session()\nsess.run(tf.global_variables_initializer())\nresult=sess.run(mul)\nsess.close()\nprint(\"These are ok: \" + str(result[2**21-2:2**21,:]))\nprint(\"These are wrong: \" + str(result[2**21:2**21+2,:]))\nOutput Log\n2018-06-18 14:49:53.627009: I T:\\src\\github\\tensorflow\\tensorflow\\core\\platform\\cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2\n2018-06-18 14:49:53.868050: I T:\\src\\github\\tensorflow\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1356] Found device 0 with properties:\nname: GeForce GTX 1080 major: 6 minor: 1 memoryClockRate(GHz): 1.7715\npciBusID: 0000:03:00.0\ntotalMemory: 8.00GiB freeMemory: 6.61GiB\n2018-06-18 14:49:53.868514: I T:\\src\\github\\tensorflow\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1435] Adding visible gpu devices: 0\n2018-06-18 14:49:54.450846: I T:\\src\\github\\tensorflow\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:923] Device interconnect StreamExecutor with strength 1 edge matrix:\n2018-06-18 14:49:54.451158: I T:\\src\\github\\tensorflow\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:929]      0\n2018-06-18 14:49:54.451346: I T:\\src\\github\\tensorflow\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:942] 0:   N\n2018-06-18 14:49:54.451641: I T:\\src\\github\\tensorflow\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1053] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 6384 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1080, pci bus id: 0000:03:00.0, compute capability: 6.1)\nThese are ok: [[1.01 1.  ]\n[1.01 1.  ]]\nThese are wrong: [[0. 0.]\n[0. 0.]]", "body": "\r\n\r\n------------------------\r\n\r\n### System information\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Win 10, 64bit\r\n- **TensorFlow installed from (source or binary)**: source\r\n- **TensorFlow version (use command below)**: 1.8.0 (same issue with 1.5.x)\r\n- **Python version**: 3.5.3\r\n- **GPU model and memory**: GTX 1080 \r\n\r\n\r\n### Describe the problem\r\nWhen using `tf.matmul(X,Y)` with `X.shape==[n,2]` ,`Y.shape==[2,2]` **AND** `n>2^21 #=2097152` only the first `[0:2^21 , : ]` results are correct\r\n\r\n- Does only occur on GPU\r\n- Does not occur if Y==tf.eye(2)\r\n- it is possible to circumvent the problem by splitting the operation into chunks of `n<=2**21`\r\n\r\n-> i guess a solution would be to automaticaly split the operation or warn the user \r\n\r\n### Source code\r\n`import tensorflow as tf`\r\n\r\n`X=tf.ones([10+2**21,2],dtype=tf.float32)`\r\n`Y=tf.constant([[1,0],[0.01,1]],dtype=tf.float32)`\r\n`mul=tf.matmul(X,Y)`\r\n\r\n`sess=tf.Session()`\r\n`sess.run(tf.global_variables_initializer())`\r\n`result=sess.run(mul)`\r\n`sess.close()`\r\n\r\n`print(\"These are ok: \" + str(result[2**21-2:2**21,:]))`\r\n\r\n`print(\"These are wrong: \" + str(result[2**21:2**21+2,:]))`\r\n\r\n\r\n### Output Log\r\n\r\n_2018-06-18 14:49:53.627009: I T:\\src\\github\\tensorflow\\tensorflow\\core\\platform\\cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2\r\n2018-06-18 14:49:53.868050: I T:\\src\\github\\tensorflow\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1356] Found device 0 with properties: \r\nname: GeForce GTX 1080 major: 6 minor: 1 memoryClockRate(GHz): 1.7715\r\npciBusID: 0000:03:00.0\r\ntotalMemory: 8.00GiB freeMemory: 6.61GiB\r\n2018-06-18 14:49:53.868514: I T:\\src\\github\\tensorflow\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1435] Adding visible gpu devices: 0\r\n2018-06-18 14:49:54.450846: I T:\\src\\github\\tensorflow\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:923] Device interconnect StreamExecutor with strength 1 edge matrix:\r\n2018-06-18 14:49:54.451158: I T:\\src\\github\\tensorflow\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:929]      0 \r\n2018-06-18 14:49:54.451346: I T:\\src\\github\\tensorflow\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:942] 0:   N \r\n2018-06-18 14:49:54.451641: I T:\\src\\github\\tensorflow\\tensorflow\\core\\common_runtime\\gpu\\gpu_device.cc:1053] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 6384 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1080, pci bus id: 0000:03:00.0, compute capability: 6.1)_\r\n\r\nThese are ok: [[1.01 1.  ]\r\n [1.01 1.  ]]\r\nThese are wrong: [[0. 0.]\r\n [0. 0.]]\r\n"}