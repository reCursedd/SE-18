{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2587", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2587/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2587/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2587/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/2587", "id": 157560509, "node_id": "MDU6SXNzdWUxNTc1NjA1MDk=", "number": 2587, "title": "session_ops should not place Placeholder(<string>) onto GPU", "user": {"login": "yaroslavvb", "id": 23068, "node_id": "MDQ6VXNlcjIzMDY4", "avatar_url": "https://avatars3.githubusercontent.com/u/23068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yaroslavvb", "html_url": "https://github.com/yaroslavvb", "followers_url": "https://api.github.com/users/yaroslavvb/followers", "following_url": "https://api.github.com/users/yaroslavvb/following{/other_user}", "gists_url": "https://api.github.com/users/yaroslavvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/yaroslavvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yaroslavvb/subscriptions", "organizations_url": "https://api.github.com/users/yaroslavvb/orgs", "repos_url": "https://api.github.com/users/yaroslavvb/repos", "events_url": "https://api.github.com/users/yaroslavvb/events{/privacy}", "received_events_url": "https://api.github.com/users/yaroslavvb/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "yuanbyu", "id": 2342391, "node_id": "MDQ6VXNlcjIzNDIzOTE=", "avatar_url": "https://avatars1.githubusercontent.com/u/2342391?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuanbyu", "html_url": "https://github.com/yuanbyu", "followers_url": "https://api.github.com/users/yuanbyu/followers", "following_url": "https://api.github.com/users/yuanbyu/following{/other_user}", "gists_url": "https://api.github.com/users/yuanbyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuanbyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuanbyu/subscriptions", "organizations_url": "https://api.github.com/users/yuanbyu/orgs", "repos_url": "https://api.github.com/users/yuanbyu/repos", "events_url": "https://api.github.com/users/yuanbyu/events{/privacy}", "received_events_url": "https://api.github.com/users/yuanbyu/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "yuanbyu", "id": 2342391, "node_id": "MDQ6VXNlcjIzNDIzOTE=", "avatar_url": "https://avatars1.githubusercontent.com/u/2342391?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuanbyu", "html_url": "https://github.com/yuanbyu", "followers_url": "https://api.github.com/users/yuanbyu/followers", "following_url": "https://api.github.com/users/yuanbyu/following{/other_user}", "gists_url": "https://api.github.com/users/yuanbyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuanbyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuanbyu/subscriptions", "organizations_url": "https://api.github.com/users/yuanbyu/orgs", "repos_url": "https://api.github.com/users/yuanbyu/repos", "events_url": "https://api.github.com/users/yuanbyu/events{/privacy}", "received_events_url": "https://api.github.com/users/yuanbyu/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2016-05-30T21:57:21Z", "updated_at": "2016-06-03T20:20:38Z", "closed_at": "2016-06-03T01:04:25Z", "author_association": "CONTRIBUTOR", "body_html": "<p>TLDR; session ops should be changed to always place string handle Placeholder on CPU. Currently it places it on the same device as corresponding <code>GetSessionTensor</code> op, which fails when data lives on GPU.</p>\n<p>Session ops like <code>get_session_tensor</code> consist of string <code>Placeholder</code> and <code>GetSessionTensor</code> ops. They are created with tf.device(None), and then moved to the same device as the input handle. If input_handle represents tensor on GPU, it will try to move both <code>Placeholder</code> and <code>GetSessionTensor</code> on the GPU.<br>\nHowever, since there's no implementation of string Placeholder on GPU, this fails with <code>Could not satisfy explicit device specification</code>. Since <code>Placeholder</code> is meant for reading string through <code>feed_dict</code>, the data comes from CPU originally, and there's no performance benefit in using GPU implementation of string placeholder, so it should be pinned to CPU.</p>\n<p>Test below fails with <code>InvalidArgumentError: Cannot assign a device to node 'Placeholder_1': Could not satisfy explicit device specification '/job:localhost/replica:0/task:0/device:GPU:0' because no supported kernel for GPU devices is available.</code></p>\n<pre><code>import tensorflow as tf\n\nclass HandleTest(tf.test.TestCase):\n\n  def testHandle(self):\n    config = tf.ConfigProto(log_device_placement=True)\n    with self.test_session(config=config) as sess:\n      dtype=tf.float32\n      with tf.device(\"/gpu:0\"):\n        a = tf.constant(1, dtype)\n\n      a_handle = sess.run(tf.get_session_handle(a))\n      b_holder, b_tensor = tf.get_session_tensor(dtype)\n      print(sess.run(b_tensor, feed_dict={b_holder:\n                                          a_handle.handle}))\n\n\nif __name__ == \"__main__\":\n  tf.test.main()\n\n</code></pre>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=2342391\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/yuanbyu\">@yuanbyu</a></p>", "body_text": "TLDR; session ops should be changed to always place string handle Placeholder on CPU. Currently it places it on the same device as corresponding GetSessionTensor op, which fails when data lives on GPU.\nSession ops like get_session_tensor consist of string Placeholder and GetSessionTensor ops. They are created with tf.device(None), and then moved to the same device as the input handle. If input_handle represents tensor on GPU, it will try to move both Placeholder and GetSessionTensor on the GPU.\nHowever, since there's no implementation of string Placeholder on GPU, this fails with Could not satisfy explicit device specification. Since Placeholder is meant for reading string through feed_dict, the data comes from CPU originally, and there's no performance benefit in using GPU implementation of string placeholder, so it should be pinned to CPU.\nTest below fails with InvalidArgumentError: Cannot assign a device to node 'Placeholder_1': Could not satisfy explicit device specification '/job:localhost/replica:0/task:0/device:GPU:0' because no supported kernel for GPU devices is available.\nimport tensorflow as tf\n\nclass HandleTest(tf.test.TestCase):\n\n  def testHandle(self):\n    config = tf.ConfigProto(log_device_placement=True)\n    with self.test_session(config=config) as sess:\n      dtype=tf.float32\n      with tf.device(\"/gpu:0\"):\n        a = tf.constant(1, dtype)\n\n      a_handle = sess.run(tf.get_session_handle(a))\n      b_holder, b_tensor = tf.get_session_tensor(dtype)\n      print(sess.run(b_tensor, feed_dict={b_holder:\n                                          a_handle.handle}))\n\n\nif __name__ == \"__main__\":\n  tf.test.main()\n\n\n@yuanbyu", "body": "TLDR; session ops should be changed to always place string handle Placeholder on CPU. Currently it places it on the same device as corresponding `GetSessionTensor` op, which fails when data lives on GPU.\n\nSession ops like `get_session_tensor` consist of string `Placeholder` and `GetSessionTensor` ops. They are created with tf.device(None), and then moved to the same device as the input handle. If input_handle represents tensor on GPU, it will try to move both `Placeholder` and `GetSessionTensor` on the GPU.\nHowever, since there's no implementation of string Placeholder on GPU, this fails with `Could not satisfy explicit device specification`. Since `Placeholder` is meant for reading string through `feed_dict`, the data comes from CPU originally, and there's no performance benefit in using GPU implementation of string placeholder, so it should be pinned to CPU.\n\nTest below fails with `InvalidArgumentError: Cannot assign a device to node 'Placeholder_1': Could not satisfy explicit device specification '/job:localhost/replica:0/task:0/device:GPU:0' because no supported kernel for GPU devices is available.`\n\n```\nimport tensorflow as tf\n\nclass HandleTest(tf.test.TestCase):\n\n  def testHandle(self):\n    config = tf.ConfigProto(log_device_placement=True)\n    with self.test_session(config=config) as sess:\n      dtype=tf.float32\n      with tf.device(\"/gpu:0\"):\n        a = tf.constant(1, dtype)\n\n      a_handle = sess.run(tf.get_session_handle(a))\n      b_holder, b_tensor = tf.get_session_tensor(dtype)\n      print(sess.run(b_tensor, feed_dict={b_holder:\n                                          a_handle.handle}))\n\n\nif __name__ == \"__main__\":\n  tf.test.main()\n\n```\n\n@yuanbyu \n"}