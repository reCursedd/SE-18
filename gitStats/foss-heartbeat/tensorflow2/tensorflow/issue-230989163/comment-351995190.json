{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/351995190", "html_url": "https://github.com/tensorflow/tensorflow/issues/10155#issuecomment-351995190", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10155", "id": 351995190, "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTk5NTE5MA==", "user": {"login": "Tauranis", "id": 9088856, "node_id": "MDQ6VXNlcjkwODg4NTY=", "avatar_url": "https://avatars3.githubusercontent.com/u/9088856?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Tauranis", "html_url": "https://github.com/Tauranis", "followers_url": "https://api.github.com/users/Tauranis/followers", "following_url": "https://api.github.com/users/Tauranis/following{/other_user}", "gists_url": "https://api.github.com/users/Tauranis/gists{/gist_id}", "starred_url": "https://api.github.com/users/Tauranis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Tauranis/subscriptions", "organizations_url": "https://api.github.com/users/Tauranis/orgs", "repos_url": "https://api.github.com/users/Tauranis/repos", "events_url": "https://api.github.com/users/Tauranis/events{/privacy}", "received_events_url": "https://api.github.com/users/Tauranis/received_events", "type": "User", "site_admin": false}, "created_at": "2017-12-15T12:34:22Z", "updated_at": "2017-12-15T12:36:17Z", "author_association": "NONE", "body_html": "<p>I've managed to use <code>init_from_checkpoint</code>, but until there I've made some mistakes.<br>\nFirst created a hook object (instance of a class that inherits from <code>tf.train.SessionRunHook</code> ) to load pretrained weights after a session is created ( on <code>after_create_session</code> method). But for some reason the string \"Adam\" was appended at the end of each variable name and then the variables could not be found in the checkpoint file. Yes, \"Adam\" due to the optimizer being used.</p>\n<p>As my second attempt, I tried to execute <code>init_from_checkpoint</code> right after my network architecture is defined on <code>model_fn</code> and it seems to work. The following is the snippet I'm currently using:</p>\n<pre><code>def model_fn(features, labels, mode, params):\n    is_training = mode == ModeKeys.TRAIN\n    logits = cnn_architecture(features, is_training=is_training)  # Architecture is defined here\n    tf.train.init_from_checkpoint(FLAGS.checkpoint_path,{\"InceptionV4/\":\"InceptionV4/\"})\n    ...\n</code></pre>\n<p>When the training starts the following appears on my console:</p>\n<pre><code>...\nINFO:tensorflow:Initialize variable InceptionV4/Mixed_5c/Branch_2/Conv2d_0a_1x1/weights from checkpoint ../checkpoint_models/inception_v4.ckpt with InceptionV4/Mixed_5c/Branch_2/Conv2d_0a_1x1/weights\nINFO:tensorflow:Initialize variable InceptionV4/Mixed_7c/Branch_1/Conv2d_0c_3x1/BatchNorm/moving_mean from checkpoint ../checkpoint_models/inception_v4.ckpt with InceptionV4/Mixed_7c/Branch_1/Conv2d_0c_3x1/BatchNorm/moving_mean\n...\n</code></pre>\n<p>OBS: I'm using TF-1.4<br>\nI hope it helps you</p>", "body_text": "I've managed to use init_from_checkpoint, but until there I've made some mistakes.\nFirst created a hook object (instance of a class that inherits from tf.train.SessionRunHook ) to load pretrained weights after a session is created ( on after_create_session method). But for some reason the string \"Adam\" was appended at the end of each variable name and then the variables could not be found in the checkpoint file. Yes, \"Adam\" due to the optimizer being used.\nAs my second attempt, I tried to execute init_from_checkpoint right after my network architecture is defined on model_fn and it seems to work. The following is the snippet I'm currently using:\ndef model_fn(features, labels, mode, params):\n    is_training = mode == ModeKeys.TRAIN\n    logits = cnn_architecture(features, is_training=is_training)  # Architecture is defined here\n    tf.train.init_from_checkpoint(FLAGS.checkpoint_path,{\"InceptionV4/\":\"InceptionV4/\"})\n    ...\n\nWhen the training starts the following appears on my console:\n...\nINFO:tensorflow:Initialize variable InceptionV4/Mixed_5c/Branch_2/Conv2d_0a_1x1/weights from checkpoint ../checkpoint_models/inception_v4.ckpt with InceptionV4/Mixed_5c/Branch_2/Conv2d_0a_1x1/weights\nINFO:tensorflow:Initialize variable InceptionV4/Mixed_7c/Branch_1/Conv2d_0c_3x1/BatchNorm/moving_mean from checkpoint ../checkpoint_models/inception_v4.ckpt with InceptionV4/Mixed_7c/Branch_1/Conv2d_0c_3x1/BatchNorm/moving_mean\n...\n\nOBS: I'm using TF-1.4\nI hope it helps you", "body": "I've managed to use `init_from_checkpoint`, but until there I've made some mistakes.\r\nFirst created a hook object (instance of a class that inherits from `tf.train.SessionRunHook` ) to load pretrained weights after a session is created ( on `after_create_session` method). But for some reason the string \"Adam\" was appended at the end of each variable name and then the variables could not be found in the checkpoint file. Yes, \"Adam\" due to the optimizer being used. \r\n\r\nAs my second attempt, I tried to execute `init_from_checkpoint` right after my network architecture is defined on `model_fn` and it seems to work. The following is the snippet I'm currently using:\r\n\r\n```\r\ndef model_fn(features, labels, mode, params):\r\n    is_training = mode == ModeKeys.TRAIN\r\n    logits = cnn_architecture(features, is_training=is_training)  # Architecture is defined here\r\n    tf.train.init_from_checkpoint(FLAGS.checkpoint_path,{\"InceptionV4/\":\"InceptionV4/\"})\r\n    ...\r\n```\r\n\r\nWhen the training starts the following appears on my console:\r\n\r\n```\r\n...\r\nINFO:tensorflow:Initialize variable InceptionV4/Mixed_5c/Branch_2/Conv2d_0a_1x1/weights from checkpoint ../checkpoint_models/inception_v4.ckpt with InceptionV4/Mixed_5c/Branch_2/Conv2d_0a_1x1/weights\r\nINFO:tensorflow:Initialize variable InceptionV4/Mixed_7c/Branch_1/Conv2d_0c_3x1/BatchNorm/moving_mean from checkpoint ../checkpoint_models/inception_v4.ckpt with InceptionV4/Mixed_7c/Branch_1/Conv2d_0c_3x1/BatchNorm/moving_mean\r\n...\r\n```\r\nOBS: I'm using TF-1.4\r\nI hope it helps you"}