{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8024", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8024/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8024/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8024/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/8024", "id": 211486807, "node_id": "MDU6SXNzdWUyMTE0ODY4MDc=", "number": 8024, "title": "Building with XLA throws 'error: non-constant-expression cannot be narrowed from type 'std::vector<se::DeviceMemoryBase>::size_type' (aka 'unsigned long') to 'long long' in initializer list'", "user": {"login": "lobachevzky", "id": 10344742, "node_id": "MDQ6VXNlcjEwMzQ0NzQy", "avatar_url": "https://avatars2.githubusercontent.com/u/10344742?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lobachevzky", "html_url": "https://github.com/lobachevzky", "followers_url": "https://api.github.com/users/lobachevzky/followers", "following_url": "https://api.github.com/users/lobachevzky/following{/other_user}", "gists_url": "https://api.github.com/users/lobachevzky/gists{/gist_id}", "starred_url": "https://api.github.com/users/lobachevzky/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lobachevzky/subscriptions", "organizations_url": "https://api.github.com/users/lobachevzky/orgs", "repos_url": "https://api.github.com/users/lobachevzky/repos", "events_url": "https://api.github.com/users/lobachevzky/events{/privacy}", "received_events_url": "https://api.github.com/users/lobachevzky/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-03-02T19:06:55Z", "updated_at": "2017-03-29T12:43:52Z", "closed_at": "2017-03-06T14:37:19Z", "author_association": "NONE", "body_html": "<h3>What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?</h3>\n<p><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"184664768\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/5143\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/5143/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/5143\">#5143</a><br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"116675852\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/bazelbuild/bazel/issues/596\" data-hovercard-type=\"issue\" data-hovercard-url=\"/bazelbuild/bazel/issues/596/hovercard\" href=\"https://github.com/bazelbuild/bazel/issues/596\">bazelbuild/bazel#596</a><br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"174071641\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/4103\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/4103/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/4103\">#4103</a><br>\n<a href=\"http://stackoverflow.com/questions/39157631/tensorflow-build-error-with-bazel\" rel=\"nofollow\">http://stackoverflow.com/questions/39157631/tensorflow-build-error-with-bazel</a><br>\n<a href=\"http://stackoverflow.com/questions/37313212/tensorflow-bazel-build-failing\" rel=\"nofollow\">http://stackoverflow.com/questions/37313212/tensorflow-bazel-build-failing</a><br>\n<a href=\"http://stackoverflow.com/questions/34941620/unable-to-build-tensorflow-from-source-with-bazel-22nd-january-2016\" rel=\"nofollow\">http://stackoverflow.com/questions/34941620/unable-to-build-tensorflow-from-source-with-bazel-22nd-january-2016</a><br>\n<a href=\"http://stackoverflow.com/questions/38603017/tensorflow-install-bazel-build-error-failed-package-loads\" rel=\"nofollow\">http://stackoverflow.com/questions/38603017/tensorflow-install-bazel-build-error-failed-package-loads</a></p>\n<p>Unfortunately none of these posts report similar errors.</p>\n<h3>Environment info</h3>\n<p>Operating System:<br>\nMac OSX Sierra</p>\n<p>Installed version of CUDA and cuDNN:<br>\n(please attach the output of <code>ls -l /path/to/cuda/lib/libcud*</code>):<br>\nNeither are installed on my system:</p>\n<pre><code>~/tensorflow master*\n\u276f ls -l /path/to/cuda/lib/libcud*\nls: /path/to/cuda/lib/libcud*: No such file or directory\n</code></pre>\n<p>If installed from binary pip package, provide:</p>\n<ol>\n<li>A link to the pip package you installed:</li>\n<li>The output from <code>python -c \"import tensorflow; print(tensorflow.__version__)\"</code>.</li>\n</ol>\n<p>If installed from source, provide</p>\n<ol>\n<li>The commit hash (<code>git rev-parse HEAD</code>)</li>\n</ol>\n<pre><code>~/tensorflow master*\n\u276f git rev-parse HEAD\n8cac382a5425d64f3083cb5adec525baa163e18e\n</code></pre>\n<ol start=\"2\">\n<li>The output of <code>bazel version</code></li>\n</ol>\n<pre><code>~/tensorflow master*\n\u276f bazel version\nWarning: ignoring LD_PRELOAD in environment.\n............\nBuild label: 0.4.4-homebrew\nBuild target: bazel-out/local-opt/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Thu Feb 2 01:05:15 2017 (1485997515)\nBuild timestamp: 1485997515\nBuild timestamp as int: 1485997515\n</code></pre>\n<h3>If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)</h3>\n<p>I simply followed <a href=\"https://www.tensorflow.org/install/install_sources\" rel=\"nofollow\">these instructions</a>. This was my interaction with the <code>configure</code> script:</p>\n<pre><code>~/tensorflow master* 4m 13s\n\u276f ./configure\nPlease specify the location of python. [Default is /usr/local/bin/python]: \nPlease specify optimization flags to use during compilation when bazel option \"--config=opt\" is specified [Default is -march=native]: \nDo you wish to build TensorFlow with Google Cloud Platform support? [y/N] n\nNo Google Cloud Platform support will be enabled for TensorFlow\nDo you wish to build TensorFlow with Hadoop File System support? [y/N] n\nNo Hadoop File System support will be enabled for TensorFlow\nDo you wish to build TensorFlow with the XLA just-in-time compiler (experimental)? [y/N] y\nXLA JIT support will be enabled for TensorFlow\nFound possible Python library paths:\n  /usr/local/Cellar/python/2.7.13/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages\nPlease input the desired Python library path to use.  Default is [/usr/local/Cellar/python/2.7.13/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages]\n\nUsing python library path: /usr/local/Cellar/python/2.7.13/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages\nDo you wish to build TensorFlow with OpenCL support? [y/N] n\nNo OpenCL support will be enabled for TensorFlow\nDo you wish to build TensorFlow with CUDA support? [y/N] n\nNo CUDA support will be enabled for TensorFlow\nConfiguration finished\nWarning: ignoring LD_PRELOAD in environment.\nExtracting Bazel installation...\n..........................................................\nINFO: Starting clean (this may take a while). Consider using --expunge_async if the clean takes more than several minutes.\nWarning: ignoring LD_PRELOAD in environment.\n..........................................................\nINFO: All external dependencies fetched successfully.\n</code></pre>\n<p>I then ran</p>\n<pre><code>~/tensorflow master* 1m 35s\n\u276f bazel build --config=opt //tensorflow/tools/pip_package:build_pip_package\n</code></pre>\n<p>and got the following error</p>\n<pre><code>ERROR: /Users/ethan/tensorflow/tensorflow/compiler/xla/service/BUILD:406:1: C++ compilation of rule '//tensorflow/compiler/xla/service:allocation_tracker' failed: cc_wrapper.sh failed: error executing command external/local_config_cc/cc_wrapper.sh -U_FORTIFY_SOURCE -fstack-protector -Wall -Wthread-safety -Wself-assign -fcolor-diagnostics -fno-omit-frame-pointer -g0 -O2 '-D_FORTIFY_SOURCE=1' -DNDEBUG ... (remaining 105 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\ntensorflow/compiler/xla/service/allocation_tracker.cc:178:54: error: non-constant-expression cannot be narrowed from type 'std::vector&lt;se::DeviceMemoryBase&gt;::size_type' (aka 'unsigned long') to 'long long' in initializer list [-Wc++11-narrowing]\n        ShapeUtil::GetSubshape(allocation-&gt;shape(), {i}),\n                                                     ^\ntensorflow/compiler/xla/service/allocation_tracker.cc:178:54: note: insert an explicit cast to silence this issue\n        ShapeUtil::GetSubshape(allocation-&gt;shape(), {i}),\n                                                     ^\n                                                     static_cast&lt;long long&gt;( )\n1 error generated.\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\n</code></pre>\n<h3>What other attempted solutions have you tried?</h3>\n<p>Because XLA seemed to be causing the error, I tried building without it and the build was successful.</p>\n<h3>Logs or other output that would be helpful</h3>\n<p>(If logs are large, please upload as attachment or provide link).</p>\n<ul>\n<li>\n<p>It does look like bazel is recording a log but I couldn't find it.</p>\n</li>\n<li>\n<p>I posted the full output of <code>bazel build</code> in <a href=\"https://gist.github.com/lobachevzky/3bcd214e747613d4d0aaaafda2f48f4c\">this gist</a>.</p>\n</li>\n</ul>", "body_text": "What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\n#5143\nbazelbuild/bazel#596\n#4103\nhttp://stackoverflow.com/questions/39157631/tensorflow-build-error-with-bazel\nhttp://stackoverflow.com/questions/37313212/tensorflow-bazel-build-failing\nhttp://stackoverflow.com/questions/34941620/unable-to-build-tensorflow-from-source-with-bazel-22nd-january-2016\nhttp://stackoverflow.com/questions/38603017/tensorflow-install-bazel-build-error-failed-package-loads\nUnfortunately none of these posts report similar errors.\nEnvironment info\nOperating System:\nMac OSX Sierra\nInstalled version of CUDA and cuDNN:\n(please attach the output of ls -l /path/to/cuda/lib/libcud*):\nNeither are installed on my system:\n~/tensorflow master*\n\u276f ls -l /path/to/cuda/lib/libcud*\nls: /path/to/cuda/lib/libcud*: No such file or directory\n\nIf installed from binary pip package, provide:\n\nA link to the pip package you installed:\nThe output from python -c \"import tensorflow; print(tensorflow.__version__)\".\n\nIf installed from source, provide\n\nThe commit hash (git rev-parse HEAD)\n\n~/tensorflow master*\n\u276f git rev-parse HEAD\n8cac382a5425d64f3083cb5adec525baa163e18e\n\n\nThe output of bazel version\n\n~/tensorflow master*\n\u276f bazel version\nWarning: ignoring LD_PRELOAD in environment.\n............\nBuild label: 0.4.4-homebrew\nBuild target: bazel-out/local-opt/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Thu Feb 2 01:05:15 2017 (1485997515)\nBuild timestamp: 1485997515\nBuild timestamp as int: 1485997515\n\nIf possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\nI simply followed these instructions. This was my interaction with the configure script:\n~/tensorflow master* 4m 13s\n\u276f ./configure\nPlease specify the location of python. [Default is /usr/local/bin/python]: \nPlease specify optimization flags to use during compilation when bazel option \"--config=opt\" is specified [Default is -march=native]: \nDo you wish to build TensorFlow with Google Cloud Platform support? [y/N] n\nNo Google Cloud Platform support will be enabled for TensorFlow\nDo you wish to build TensorFlow with Hadoop File System support? [y/N] n\nNo Hadoop File System support will be enabled for TensorFlow\nDo you wish to build TensorFlow with the XLA just-in-time compiler (experimental)? [y/N] y\nXLA JIT support will be enabled for TensorFlow\nFound possible Python library paths:\n  /usr/local/Cellar/python/2.7.13/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages\nPlease input the desired Python library path to use.  Default is [/usr/local/Cellar/python/2.7.13/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages]\n\nUsing python library path: /usr/local/Cellar/python/2.7.13/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages\nDo you wish to build TensorFlow with OpenCL support? [y/N] n\nNo OpenCL support will be enabled for TensorFlow\nDo you wish to build TensorFlow with CUDA support? [y/N] n\nNo CUDA support will be enabled for TensorFlow\nConfiguration finished\nWarning: ignoring LD_PRELOAD in environment.\nExtracting Bazel installation...\n..........................................................\nINFO: Starting clean (this may take a while). Consider using --expunge_async if the clean takes more than several minutes.\nWarning: ignoring LD_PRELOAD in environment.\n..........................................................\nINFO: All external dependencies fetched successfully.\n\nI then ran\n~/tensorflow master* 1m 35s\n\u276f bazel build --config=opt //tensorflow/tools/pip_package:build_pip_package\n\nand got the following error\nERROR: /Users/ethan/tensorflow/tensorflow/compiler/xla/service/BUILD:406:1: C++ compilation of rule '//tensorflow/compiler/xla/service:allocation_tracker' failed: cc_wrapper.sh failed: error executing command external/local_config_cc/cc_wrapper.sh -U_FORTIFY_SOURCE -fstack-protector -Wall -Wthread-safety -Wself-assign -fcolor-diagnostics -fno-omit-frame-pointer -g0 -O2 '-D_FORTIFY_SOURCE=1' -DNDEBUG ... (remaining 105 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\ntensorflow/compiler/xla/service/allocation_tracker.cc:178:54: error: non-constant-expression cannot be narrowed from type 'std::vector<se::DeviceMemoryBase>::size_type' (aka 'unsigned long') to 'long long' in initializer list [-Wc++11-narrowing]\n        ShapeUtil::GetSubshape(allocation->shape(), {i}),\n                                                     ^\ntensorflow/compiler/xla/service/allocation_tracker.cc:178:54: note: insert an explicit cast to silence this issue\n        ShapeUtil::GetSubshape(allocation->shape(), {i}),\n                                                     ^\n                                                     static_cast<long long>( )\n1 error generated.\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\n\nWhat other attempted solutions have you tried?\nBecause XLA seemed to be causing the error, I tried building without it and the build was successful.\nLogs or other output that would be helpful\n(If logs are large, please upload as attachment or provide link).\n\n\nIt does look like bazel is recording a log but I couldn't find it.\n\n\nI posted the full output of bazel build in this gist.", "body": "### What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\r\nhttps://github.com/tensorflow/tensorflow/issues/5143\r\nhttps://github.com/bazelbuild/bazel/issues/596\r\nhttps://github.com/tensorflow/tensorflow/issues/4103\r\nhttp://stackoverflow.com/questions/39157631/tensorflow-build-error-with-bazel\r\nhttp://stackoverflow.com/questions/37313212/tensorflow-bazel-build-failing\r\nhttp://stackoverflow.com/questions/34941620/unable-to-build-tensorflow-from-source-with-bazel-22nd-january-2016\r\nhttp://stackoverflow.com/questions/38603017/tensorflow-install-bazel-build-error-failed-package-loads\r\n\r\nUnfortunately none of these posts report similar errors.\r\n\r\n\r\n### Environment info\r\nOperating System:\r\nMac OSX Sierra\r\n\r\nInstalled version of CUDA and cuDNN: \r\n(please attach the output of `ls -l /path/to/cuda/lib/libcud*`):\r\nNeither are installed on my system:\r\n```\r\n~/tensorflow master*\r\n\u276f ls -l /path/to/cuda/lib/libcud*\r\nls: /path/to/cuda/lib/libcud*: No such file or directory\r\n```\r\n\r\nIf installed from binary pip package, provide:\r\n\r\n1. A link to the pip package you installed:\r\n2. The output from `python -c \"import tensorflow; print(tensorflow.__version__)\"`.\r\n\r\nIf installed from source, provide \r\n\r\n1. The commit hash (`git rev-parse HEAD`)\r\n```\r\n~/tensorflow master*\r\n\u276f git rev-parse HEAD\r\n8cac382a5425d64f3083cb5adec525baa163e18e\r\n```\r\n2. The output of `bazel version`\r\n```\r\n~/tensorflow master*\r\n\u276f bazel version\r\nWarning: ignoring LD_PRELOAD in environment.\r\n............\r\nBuild label: 0.4.4-homebrew\r\nBuild target: bazel-out/local-opt/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\r\nBuild time: Thu Feb 2 01:05:15 2017 (1485997515)\r\nBuild timestamp: 1485997515\r\nBuild timestamp as int: 1485997515\r\n```\r\n\r\n### If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\r\nI simply followed [these instructions](https://www.tensorflow.org/install/install_sources). This was my interaction with the `configure` script:\r\n```\r\n~/tensorflow master* 4m 13s\r\n\u276f ./configure\r\nPlease specify the location of python. [Default is /usr/local/bin/python]: \r\nPlease specify optimization flags to use during compilation when bazel option \"--config=opt\" is specified [Default is -march=native]: \r\nDo you wish to build TensorFlow with Google Cloud Platform support? [y/N] n\r\nNo Google Cloud Platform support will be enabled for TensorFlow\r\nDo you wish to build TensorFlow with Hadoop File System support? [y/N] n\r\nNo Hadoop File System support will be enabled for TensorFlow\r\nDo you wish to build TensorFlow with the XLA just-in-time compiler (experimental)? [y/N] y\r\nXLA JIT support will be enabled for TensorFlow\r\nFound possible Python library paths:\r\n  /usr/local/Cellar/python/2.7.13/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages\r\nPlease input the desired Python library path to use.  Default is [/usr/local/Cellar/python/2.7.13/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages]\r\n\r\nUsing python library path: /usr/local/Cellar/python/2.7.13/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages\r\nDo you wish to build TensorFlow with OpenCL support? [y/N] n\r\nNo OpenCL support will be enabled for TensorFlow\r\nDo you wish to build TensorFlow with CUDA support? [y/N] n\r\nNo CUDA support will be enabled for TensorFlow\r\nConfiguration finished\r\nWarning: ignoring LD_PRELOAD in environment.\r\nExtracting Bazel installation...\r\n..........................................................\r\nINFO: Starting clean (this may take a while). Consider using --expunge_async if the clean takes more than several minutes.\r\nWarning: ignoring LD_PRELOAD in environment.\r\n..........................................................\r\nINFO: All external dependencies fetched successfully.\r\n```\r\n\r\nI then ran\r\n```\r\n~/tensorflow master* 1m 35s\r\n\u276f bazel build --config=opt //tensorflow/tools/pip_package:build_pip_package\r\n```\r\nand got the following error\r\n\r\n```\r\nERROR: /Users/ethan/tensorflow/tensorflow/compiler/xla/service/BUILD:406:1: C++ compilation of rule '//tensorflow/compiler/xla/service:allocation_tracker' failed: cc_wrapper.sh failed: error executing command external/local_config_cc/cc_wrapper.sh -U_FORTIFY_SOURCE -fstack-protector -Wall -Wthread-safety -Wself-assign -fcolor-diagnostics -fno-omit-frame-pointer -g0 -O2 '-D_FORTIFY_SOURCE=1' -DNDEBUG ... (remaining 105 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\r\ntensorflow/compiler/xla/service/allocation_tracker.cc:178:54: error: non-constant-expression cannot be narrowed from type 'std::vector<se::DeviceMemoryBase>::size_type' (aka 'unsigned long') to 'long long' in initializer list [-Wc++11-narrowing]\r\n        ShapeUtil::GetSubshape(allocation->shape(), {i}),\r\n                                                     ^\r\ntensorflow/compiler/xla/service/allocation_tracker.cc:178:54: note: insert an explicit cast to silence this issue\r\n        ShapeUtil::GetSubshape(allocation->shape(), {i}),\r\n                                                     ^\r\n                                                     static_cast<long long>( )\r\n1 error generated.\r\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\r\n```\r\n\r\n### What other attempted solutions have you tried?\r\n\r\nBecause XLA seemed to be causing the error, I tried building without it and the build was successful.\r\n\r\n### Logs or other output that would be helpful\r\n(If logs are large, please upload as attachment or provide link).\r\n\r\n- It does look like bazel is recording a log but I couldn't find it.\r\n\r\n- I posted the full output of `bazel build` in [this gist](https://gist.github.com/lobachevzky/3bcd214e747613d4d0aaaafda2f48f4c).\r\n\r\n"}