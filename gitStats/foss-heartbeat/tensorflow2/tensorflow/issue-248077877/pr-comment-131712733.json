{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/131712733", "pull_request_review_id": 54718766, "id": 131712733, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzMTcxMjczMw==", "diff_hunk": "@@ -1087,15 +1067,13 @@ void MklLayoutRewritePass::GetNodeProducingMklTensor(std::unique_ptr<Graph>* g,\n   CHECK_NOTNULL(n);\n   CHECK_NOTNULL(mkl_node);\n   CHECK_NOTNULL(mkl_node_output_slot);\n-  if (IsRewrittenNode(n)) {\n-    // If we have visited this node and rewritten it, then it will generate\n-    // an edge that will receive Mkl tensor from a node.\n-    // First, let's assert that this op is Mkl layer.\n-    DataType T;\n-    TF_CHECK_OK(GetNodeAttr(n->def(), \"T\", &T));\n-    // If this op has been rewritten, then its name must have been same as\n-    // Mkl op.\n-    CHECK_EQ(mkl_op_registry::IsMklOp(n->type_string(), T), true);\n+\n+  // If this is an MKL op, then it will create extra output for MKL layout.\n+  DataType T;\n+  if (GetNodeAttr(n->def(), \"T\", &T).ok() &&\n+      mkl_op_registry::IsMklOp(n->type_string(), T)) {", "path": "tensorflow/core/graph/mkl_layout_pass.cc", "position": 45, "original_position": 45, "commit_id": "b35b3d1c5b234426d7b830a7137c20bf0ac5ce69", "original_commit_id": "b35b3d1c5b234426d7b830a7137c20bf0ac5ce69", "user": {"login": "rmlarsen", "id": 16907534, "node_id": "MDQ6VXNlcjE2OTA3NTM0", "avatar_url": "https://avatars2.githubusercontent.com/u/16907534?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rmlarsen", "html_url": "https://github.com/rmlarsen", "followers_url": "https://api.github.com/users/rmlarsen/followers", "following_url": "https://api.github.com/users/rmlarsen/following{/other_user}", "gists_url": "https://api.github.com/users/rmlarsen/gists{/gist_id}", "starred_url": "https://api.github.com/users/rmlarsen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rmlarsen/subscriptions", "organizations_url": "https://api.github.com/users/rmlarsen/orgs", "repos_url": "https://api.github.com/users/rmlarsen/repos", "events_url": "https://api.github.com/users/rmlarsen/events{/privacy}", "received_events_url": "https://api.github.com/users/rmlarsen/received_events", "type": "User", "site_admin": false}, "body": "Is there a potential performance hit here? Was the hash table there to compensate for IsMklOp being slow? If not, this is obviously fine.", "created_at": "2017-08-07T17:17:43Z", "updated_at": "2017-08-07T17:17:51Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/12044#discussion_r131712733", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12044", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/131712733"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/12044#discussion_r131712733"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12044"}}, "body_html": "<p>Is there a potential performance hit here? Was the hash table there to compensate for IsMklOp being slow? If not, this is obviously fine.</p>", "body_text": "Is there a potential performance hit here? Was the hash table there to compensate for IsMklOp being slow? If not, this is obviously fine."}