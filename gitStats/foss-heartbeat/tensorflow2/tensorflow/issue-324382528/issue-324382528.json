{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19378", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19378/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19378/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19378/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/19378", "id": 324382528, "node_id": "MDU6SXNzdWUzMjQzODI1Mjg=", "number": 19378, "title": "tf.gfile.Glob returns wrong values on Windows systems", "user": {"login": "canut", "id": 4560150, "node_id": "MDQ6VXNlcjQ1NjAxNTA=", "avatar_url": "https://avatars0.githubusercontent.com/u/4560150?v=4", "gravatar_id": "", "url": "https://api.github.com/users/canut", "html_url": "https://github.com/canut", "followers_url": "https://api.github.com/users/canut/followers", "following_url": "https://api.github.com/users/canut/following{/other_user}", "gists_url": "https://api.github.com/users/canut/gists{/gist_id}", "starred_url": "https://api.github.com/users/canut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/canut/subscriptions", "organizations_url": "https://api.github.com/users/canut/orgs", "repos_url": "https://api.github.com/users/canut/repos", "events_url": "https://api.github.com/users/canut/events{/privacy}", "received_events_url": "https://api.github.com/users/canut/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2018-05-18T11:59:37Z", "updated_at": "2018-08-14T06:19:20Z", "closed_at": null, "author_association": "NONE", "body_html": "<h3>System information</h3>\n<p>Environment:</p>\n<ul>\n<li>\n<p><strong>Python 3.6.2</strong></p>\n</li>\n<li>\n<p><strong>Tensorflow 'v1.8.0-0-g93bc2e2072' 1.8.0</strong></p>\n</li>\n<li>\n<p><strong>OS : Windows 7</strong></p>\n</li>\n<li>\n<p><strong>Exact command to reproduce</strong>:</p>\n</li>\n</ul>\n<pre><code> &gt; ls -R\n.:\nexample/\n\n./example:\nsubdir/\n\n./example/subdir:\nfile1  file2\n\n\n&gt; python\nPython 3.6.2 (v3.6.2:5fd33b5, Jul  8 2017, 04:57:36) [MSC v.1900 64 bit (AMD64)] on win32\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n&gt;&gt;&gt; import tensorflow as tf\n&gt;&gt;&gt; tf.gfile.Glob(\"example/*\")\n['example\\\\subdir', 'example\\\\subdir\\\\file1', 'example\\\\subdir\\\\file2']\n\n</code></pre>\n<h3>Describe the problem</h3>\n<p>Behaviour of <em>tf.gfile.Glob</em> is different on Windows and Linux-based (POSIX) systems.<br>\nOn Windows, the result includes all files and sub-directories of the matching pattern (=&gt; recursive)<br>\nOn Linux, the result includes only files and directories matched by the pattern (=&gt; not recursive)</p>\n<p>As an example, given the directory structure above, I have the following result:</p>\n<ul>\n<li>Windows</li>\n</ul>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">&gt;&gt;</span><span class=\"pl-k\">&gt;</span> tf.gfile.Glob(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>example/*<span class=\"pl-pds\">\"</span></span>)\n[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>example<span class=\"pl-cce\">\\\\</span>subdir<span class=\"pl-pds\">'</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">'</span>example<span class=\"pl-cce\">\\\\</span>subdir<span class=\"pl-cce\">\\\\</span>file1<span class=\"pl-pds\">'</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">'</span>example<span class=\"pl-cce\">\\\\</span>subdir<span class=\"pl-cce\">\\\\</span>file2<span class=\"pl-pds\">'</span></span>]</pre></div>\n<ul>\n<li>Linux-based systems</li>\n</ul>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">&gt;&gt;</span><span class=\"pl-k\">&gt;</span> tf.gfile.Glob(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>example/*<span class=\"pl-pds\">\"</span></span>)\n[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>example/subdir<span class=\"pl-pds\">'</span></span>]</pre></div>\n<p>The result returned on Windows platform is clearly wrong.</p>\n<p>This has an impact on my application because I do something like <code>[my_list]=tf.gfile.Glob(pattern)</code> and it doesn't work on Windows whereas it works on Linux.<br>\nError on Windows is <code>ValueError: too many values to unpack </code></p>\n<h3>Source code</h3>\n<p>I tracked down the issue in TF code and it is related to how <em>GetMatchingPaths</em> works. See difference between <a href=\"https://github.com/tensorflow/tensorflow/blob/e7f158858479400f17a1b6351e9827e3aa83e7ff/tensorflow/core/platform/windows/windows_file_system.cc\">Windows implementation</a> and <a href=\"https://github.com/tensorflow/tensorflow/blob/e7f158858479400f17a1b6351e9827e3aa83e7ff/tensorflow/core/platform/posix/posix_file_system.cc\">POSIX implementation</a>.<br>\nBoth of them refer to <a href=\"https://github.com/tensorflow/tensorflow/blob/6ba9573a702ea9e1290517cce4e5f73a14552ad9/tensorflow/core/platform/file_system_helper.cc\">internal::GetMatchingPaths</a> which seems to be the root cause of the issue.</p>", "body_text": "System information\nEnvironment:\n\n\nPython 3.6.2\n\n\nTensorflow 'v1.8.0-0-g93bc2e2072' 1.8.0\n\n\nOS : Windows 7\n\n\nExact command to reproduce:\n\n\n > ls -R\n.:\nexample/\n\n./example:\nsubdir/\n\n./example/subdir:\nfile1  file2\n\n\n> python\nPython 3.6.2 (v3.6.2:5fd33b5, Jul  8 2017, 04:57:36) [MSC v.1900 64 bit (AMD64)] on win32\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import tensorflow as tf\n>>> tf.gfile.Glob(\"example/*\")\n['example\\\\subdir', 'example\\\\subdir\\\\file1', 'example\\\\subdir\\\\file2']\n\n\nDescribe the problem\nBehaviour of tf.gfile.Glob is different on Windows and Linux-based (POSIX) systems.\nOn Windows, the result includes all files and sub-directories of the matching pattern (=> recursive)\nOn Linux, the result includes only files and directories matched by the pattern (=> not recursive)\nAs an example, given the directory structure above, I have the following result:\n\nWindows\n\n>>> tf.gfile.Glob(\"example/*\")\n['example\\\\subdir', 'example\\\\subdir\\\\file1', 'example\\\\subdir\\\\file2']\n\nLinux-based systems\n\n>>> tf.gfile.Glob(\"example/*\")\n['example/subdir']\nThe result returned on Windows platform is clearly wrong.\nThis has an impact on my application because I do something like [my_list]=tf.gfile.Glob(pattern) and it doesn't work on Windows whereas it works on Linux.\nError on Windows is ValueError: too many values to unpack \nSource code\nI tracked down the issue in TF code and it is related to how GetMatchingPaths works. See difference between Windows implementation and POSIX implementation.\nBoth of them refer to internal::GetMatchingPaths which seems to be the root cause of the issue.", "body": "### System information\r\nEnvironment:\r\n- **Python 3.6.2**\r\n- **Tensorflow 'v1.8.0-0-g93bc2e2072' 1.8.0**\r\n- **OS : Windows 7**\r\n\r\n- **Exact command to reproduce**:\r\n\r\n```\r\n > ls -R\r\n.:\r\nexample/\r\n\r\n./example:\r\nsubdir/\r\n\r\n./example/subdir:\r\nfile1  file2\r\n\r\n\r\n> python\r\nPython 3.6.2 (v3.6.2:5fd33b5, Jul  8 2017, 04:57:36) [MSC v.1900 64 bit (AMD64)] on win32\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import tensorflow as tf\r\n>>> tf.gfile.Glob(\"example/*\")\r\n['example\\\\subdir', 'example\\\\subdir\\\\file1', 'example\\\\subdir\\\\file2']\r\n\r\n```\r\n\r\n### Describe the problem\r\nBehaviour of _tf.gfile.Glob_ is different on Windows and Linux-based (POSIX) systems.\r\nOn Windows, the result includes all files and sub-directories of the matching pattern (=> recursive)\r\nOn Linux, the result includes only files and directories matched by the pattern (=> not recursive)\r\n\r\nAs an example, given the directory structure above, I have the following result:\r\n\r\n* Windows\r\n```python\r\n>>> tf.gfile.Glob(\"example/*\")\r\n['example\\\\subdir', 'example\\\\subdir\\\\file1', 'example\\\\subdir\\\\file2']\r\n```\r\n\r\n* Linux-based systems\r\n```python\r\n>>> tf.gfile.Glob(\"example/*\")\r\n['example/subdir']\r\n```\r\n\r\nThe result returned on Windows platform is clearly wrong.\r\n\r\nThis has an impact on my application because I do something like `[my_list]=tf.gfile.Glob(pattern)` and it doesn't work on Windows whereas it works on Linux.\r\nError on Windows is `ValueError: too many values to unpack `\r\n\r\n\r\n### Source code\r\nI tracked down the issue in TF code and it is related to how _GetMatchingPaths_ works. See difference between [Windows implementation](https://github.com/tensorflow/tensorflow/blob/e7f158858479400f17a1b6351e9827e3aa83e7ff/tensorflow/core/platform/windows/windows_file_system.cc) and [POSIX implementation](https://github.com/tensorflow/tensorflow/blob/e7f158858479400f17a1b6351e9827e3aa83e7ff/tensorflow/core/platform/posix/posix_file_system.cc).\r\nBoth of them refer to [internal::GetMatchingPaths](https://github.com/tensorflow/tensorflow/blob/6ba9573a702ea9e1290517cce4e5f73a14552ad9/tensorflow/core/platform/file_system_helper.cc) which seems to be the root cause of the issue.\r\n\r\n\r\n"}