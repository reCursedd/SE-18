{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3708", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3708/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3708/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3708/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/3708", "id": 170153675, "node_id": "MDU6SXNzdWUxNzAxNTM2NzU=", "number": 3708, "title": "Can not access GPU when run python script with bazel", "user": {"login": "tobegit3hub", "id": 2715000, "node_id": "MDQ6VXNlcjI3MTUwMDA=", "avatar_url": "https://avatars0.githubusercontent.com/u/2715000?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tobegit3hub", "html_url": "https://github.com/tobegit3hub", "followers_url": "https://api.github.com/users/tobegit3hub/followers", "following_url": "https://api.github.com/users/tobegit3hub/following{/other_user}", "gists_url": "https://api.github.com/users/tobegit3hub/gists{/gist_id}", "starred_url": "https://api.github.com/users/tobegit3hub/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tobegit3hub/subscriptions", "organizations_url": "https://api.github.com/users/tobegit3hub/orgs", "repos_url": "https://api.github.com/users/tobegit3hub/repos", "events_url": "https://api.github.com/users/tobegit3hub/events{/privacy}", "received_events_url": "https://api.github.com/users/tobegit3hub/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-08-09T12:28:56Z", "updated_at": "2016-08-10T02:24:27Z", "closed_at": "2016-08-10T02:22:42Z", "author_association": "CONTRIBUTOR", "body_html": "<p>When we're using TensorFlow serving to train our model, we have found that the program is not able to access all the GPUs in that machine. This can be 100% reproduced and we add the following code for testing.</p>\n<pre><code>from tensorflow.python.client import device_lib\n\ndef get_available_gpus():\n    local_device_protos = device_lib.list_local_devices()\n    return [x.name for x in local_device_protos if x.device_type == 'GPU']\n\nprint(get_available_gpus())\n</code></pre>\n<p>If we run the script with <code>python</code>, it prints all the GPUs normally. If we run with <code>bazel build</code> and <code>bazel run</code> for the same script, it prints the empty list.</p>\n<h3>Environment info</h3>\n<p>Operating System: Ubuntu 14.04</p>\n<p>Installed version of CUDA and cuDNN:<br>\nCUDA 7.5 and cuDNN 4.0</p>\n<p>If installed from binary pip package, provide:<br>\nTensorFlow 0.9.0</p>\n<h3>Steps to reproduce</h3>\n<ol>\n<li><code>git clone https://github.com/tensorflow/tensorflow &amp;&amp; cd tensorflow/</code></li>\n<li>Add the code to print GPUs or placements of the operations in mnist_with_summaries.py</li>\n<li><code>python tensorflow/examples/tutorials/mnist/mnist_with_summaries.py</code> and we can see all the GPUs in this server.</li>\n<li><code>bazel build //tensorflow/examples/tutorials/mnist:mnist_with_summaries</code></li>\n<li><code>bazel-bin/tensorflow/examples/tutorials/mnist/mnist_with_summaries</code> and it use CPU only and print nothing about GPUs.</li>\n</ol>", "body_text": "When we're using TensorFlow serving to train our model, we have found that the program is not able to access all the GPUs in that machine. This can be 100% reproduced and we add the following code for testing.\nfrom tensorflow.python.client import device_lib\n\ndef get_available_gpus():\n    local_device_protos = device_lib.list_local_devices()\n    return [x.name for x in local_device_protos if x.device_type == 'GPU']\n\nprint(get_available_gpus())\n\nIf we run the script with python, it prints all the GPUs normally. If we run with bazel build and bazel run for the same script, it prints the empty list.\nEnvironment info\nOperating System: Ubuntu 14.04\nInstalled version of CUDA and cuDNN:\nCUDA 7.5 and cuDNN 4.0\nIf installed from binary pip package, provide:\nTensorFlow 0.9.0\nSteps to reproduce\n\ngit clone https://github.com/tensorflow/tensorflow && cd tensorflow/\nAdd the code to print GPUs or placements of the operations in mnist_with_summaries.py\npython tensorflow/examples/tutorials/mnist/mnist_with_summaries.py and we can see all the GPUs in this server.\nbazel build //tensorflow/examples/tutorials/mnist:mnist_with_summaries\nbazel-bin/tensorflow/examples/tutorials/mnist/mnist_with_summaries and it use CPU only and print nothing about GPUs.", "body": "When we're using TensorFlow serving to train our model, we have found that the program is not able to access all the GPUs in that machine. This can be 100% reproduced and we add the following code for testing.\n\n```\nfrom tensorflow.python.client import device_lib\n\ndef get_available_gpus():\n    local_device_protos = device_lib.list_local_devices()\n    return [x.name for x in local_device_protos if x.device_type == 'GPU']\n\nprint(get_available_gpus())\n```\n\nIf we run the script with `python`, it prints all the GPUs normally. If we run with `bazel build` and `bazel run` for the same script, it prints the empty list.\n### Environment info\n\nOperating System: Ubuntu 14.04\n\nInstalled version of CUDA and cuDNN: \nCUDA 7.5 and cuDNN 4.0\n\nIf installed from binary pip package, provide:\nTensorFlow 0.9.0\n### Steps to reproduce\n1. `git clone https://github.com/tensorflow/tensorflow && cd tensorflow/`\n2. Add the code to print GPUs or placements of the operations in mnist_with_summaries.py\n3. `python tensorflow/examples/tutorials/mnist/mnist_with_summaries.py` and we can see all the GPUs in this server.\n4. `bazel build //tensorflow/examples/tutorials/mnist:mnist_with_summaries`\n5. `bazel-bin/tensorflow/examples/tutorials/mnist/mnist_with_summaries` and it use CPU only and print nothing about GPUs.\n"}