{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/337289603", "html_url": "https://github.com/tensorflow/tensorflow/issues/13716#issuecomment-337289603", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13716", "id": 337289603, "node_id": "MDEyOklzc3VlQ29tbWVudDMzNzI4OTYwMw==", "user": {"login": "schloegl", "id": 1644245, "node_id": "MDQ6VXNlcjE2NDQyNDU=", "avatar_url": "https://avatars1.githubusercontent.com/u/1644245?v=4", "gravatar_id": "", "url": "https://api.github.com/users/schloegl", "html_url": "https://github.com/schloegl", "followers_url": "https://api.github.com/users/schloegl/followers", "following_url": "https://api.github.com/users/schloegl/following{/other_user}", "gists_url": "https://api.github.com/users/schloegl/gists{/gist_id}", "starred_url": "https://api.github.com/users/schloegl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/schloegl/subscriptions", "organizations_url": "https://api.github.com/users/schloegl/orgs", "repos_url": "https://api.github.com/users/schloegl/repos", "events_url": "https://api.github.com/users/schloegl/events{/privacy}", "received_events_url": "https://api.github.com/users/schloegl/received_events", "type": "User", "site_admin": false}, "created_at": "2017-10-17T16:32:57Z", "updated_at": "2017-10-17T16:32:57Z", "author_association": "NONE", "body_html": "<p>I can confirm this bug report, when using pre-compiled tensorflow 1.3.0 on python 3.5.3.</p>\n<p>The problem seems to occur only on these quad-socket machines, dual socket machines do not seem to be affected. debugging the problem with strace, one can see that the process runs into a deadlock and is waiting for a futex</p>\n<p><code>futex(0x55fbd967e864, FUTEX_WAKE_OP_PRIVATE, 1, 1, 0x55fbd967e860, FUTEX_OP_SET&lt;&lt;28|0&lt;&lt;12|FUTEX_OP_CMP_GT&lt;&lt;24|0x1) = 1 futex(0x7fffece5828c, FUTEX_WAIT_PRIVATE, 1, NULL</code><br>\nand does not proceed anymore.</p>\n<p>Doing further tests, the problem seems to go away when the thread affinity is set to the cores of a single cpu, e.g.<br>\n<code>taskset 0x000000ff python job001.py</code><br>\n(job001.py contains the example from the original test report. ). Trying to run the job on more than one cpu<br>\n<code>taskset 0x0000ffff python job001.py </code><br>\nleads to the problem described above.</p>", "body_text": "I can confirm this bug report, when using pre-compiled tensorflow 1.3.0 on python 3.5.3.\nThe problem seems to occur only on these quad-socket machines, dual socket machines do not seem to be affected. debugging the problem with strace, one can see that the process runs into a deadlock and is waiting for a futex\nfutex(0x55fbd967e864, FUTEX_WAKE_OP_PRIVATE, 1, 1, 0x55fbd967e860, FUTEX_OP_SET<<28|0<<12|FUTEX_OP_CMP_GT<<24|0x1) = 1 futex(0x7fffece5828c, FUTEX_WAIT_PRIVATE, 1, NULL\nand does not proceed anymore.\nDoing further tests, the problem seems to go away when the thread affinity is set to the cores of a single cpu, e.g.\ntaskset 0x000000ff python job001.py\n(job001.py contains the example from the original test report. ). Trying to run the job on more than one cpu\ntaskset 0x0000ffff python job001.py \nleads to the problem described above.", "body": "I can confirm this bug report, when using pre-compiled tensorflow 1.3.0 on python 3.5.3.  \r\n\r\nThe problem seems to occur only on these quad-socket machines, dual socket machines do not seem to be affected. debugging the problem with strace, one can see that the process runs into a deadlock and is waiting for a futex \r\n\r\n`\r\nfutex(0x55fbd967e864, FUTEX_WAKE_OP_PRIVATE, 1, 1, 0x55fbd967e860,\r\nFUTEX_OP_SET<<28|0<<12|FUTEX_OP_CMP_GT<<24|0x1) = 1\r\nfutex(0x7fffece5828c, FUTEX_WAIT_PRIVATE, 1, NULL\r\n`\r\nand does not proceed anymore. \r\n\r\nDoing further tests, the problem seems to go away when the thread affinity is set to the cores of a single cpu, e.g. \r\n` taskset 0x000000ff python job001.py\r\n`\r\n(job001.py contains the example from the original test report. ). Trying to run the job on more than one cpu \r\n`taskset 0x0000ffff python job001.py\r\n`\r\nleads to the problem described above. \r\n\r\n"}