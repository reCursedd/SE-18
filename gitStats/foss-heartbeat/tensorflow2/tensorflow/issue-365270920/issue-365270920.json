{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22638", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22638/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22638/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22638/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/22638", "id": 365270920, "node_id": "MDU6SXNzdWUzNjUyNzA5MjA=", "number": 22638, "title": "[BUG] tf.batch_gather error when feeding int64 indices", "user": {"login": "wwt17", "id": 10792281, "node_id": "MDQ6VXNlcjEwNzkyMjgx", "avatar_url": "https://avatars0.githubusercontent.com/u/10792281?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wwt17", "html_url": "https://github.com/wwt17", "followers_url": "https://api.github.com/users/wwt17/followers", "following_url": "https://api.github.com/users/wwt17/following{/other_user}", "gists_url": "https://api.github.com/users/wwt17/gists{/gist_id}", "starred_url": "https://api.github.com/users/wwt17/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wwt17/subscriptions", "organizations_url": "https://api.github.com/users/wwt17/orgs", "repos_url": "https://api.github.com/users/wwt17/repos", "events_url": "https://api.github.com/users/wwt17/events{/privacy}", "received_events_url": "https://api.github.com/users/wwt17/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "alextp", "id": 5061, "node_id": "MDQ6VXNlcjUwNjE=", "avatar_url": "https://avatars0.githubusercontent.com/u/5061?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alextp", "html_url": "https://github.com/alextp", "followers_url": "https://api.github.com/users/alextp/followers", "following_url": "https://api.github.com/users/alextp/following{/other_user}", "gists_url": "https://api.github.com/users/alextp/gists{/gist_id}", "starred_url": "https://api.github.com/users/alextp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alextp/subscriptions", "organizations_url": "https://api.github.com/users/alextp/orgs", "repos_url": "https://api.github.com/users/alextp/repos", "events_url": "https://api.github.com/users/alextp/events{/privacy}", "received_events_url": "https://api.github.com/users/alextp/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "alextp", "id": 5061, "node_id": "MDQ6VXNlcjUwNjE=", "avatar_url": "https://avatars0.githubusercontent.com/u/5061?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alextp", "html_url": "https://github.com/alextp", "followers_url": "https://api.github.com/users/alextp/followers", "following_url": "https://api.github.com/users/alextp/following{/other_user}", "gists_url": "https://api.github.com/users/alextp/gists{/gist_id}", "starred_url": "https://api.github.com/users/alextp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alextp/subscriptions", "organizations_url": "https://api.github.com/users/alextp/orgs", "repos_url": "https://api.github.com/users/alextp/repos", "events_url": "https://api.github.com/users/alextp/events{/privacy}", "received_events_url": "https://api.github.com/users/alextp/received_events", "type": "User", "site_admin": false}, {"login": "harshini-gadige", "id": 42781361, "node_id": "MDQ6VXNlcjQyNzgxMzYx", "avatar_url": "https://avatars1.githubusercontent.com/u/42781361?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harshini-gadige", "html_url": "https://github.com/harshini-gadige", "followers_url": "https://api.github.com/users/harshini-gadige/followers", "following_url": "https://api.github.com/users/harshini-gadige/following{/other_user}", "gists_url": "https://api.github.com/users/harshini-gadige/gists{/gist_id}", "starred_url": "https://api.github.com/users/harshini-gadige/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harshini-gadige/subscriptions", "organizations_url": "https://api.github.com/users/harshini-gadige/orgs", "repos_url": "https://api.github.com/users/harshini-gadige/repos", "events_url": "https://api.github.com/users/harshini-gadige/events{/privacy}", "received_events_url": "https://api.github.com/users/harshini-gadige/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2018-09-30T23:07:56Z", "updated_at": "2018-10-06T20:02:43Z", "closed_at": "2018-10-06T20:02:43Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Linux Ubuntu 16.04</li>\n<li><strong>Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device</strong>:</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.11.0</li>\n<li><strong>Python version</strong>: 3.5.2</li>\n<li><strong>Bazel version (if compiling from source)</strong>:</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>:</li>\n<li><strong>CUDA/cuDNN version</strong>: using CPU</li>\n<li><strong>GPU model and memory</strong>: using CPU</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<pre><code>import tensorflow as tf\nx = [[0, 1, 2], [3, 4, 5]]\ny = tf.convert_to_tensor([[1, 2, 0], [2, 0, 1]], dtype=tf.int64)\ntf.batch_gather(x, y)\n</code></pre>\n<h3>Describe the problem</h3>\n<p>When feeding an int64 Tensor as <code>indices</code> to <code>tf.batch_gather</code>, an error occurs.</p>\n<h3>Source code / logs</h3>\n<pre><code>Traceback (most recent call last):\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/op_def_library.py\", line 510, in _apply_op_helper\n    preferred_dtype=default_dtype)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 1144, in internal_convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 981, in _TensorTensorConversionFunction\n    (dtype.name, t.dtype.name, str(t)))\nValueError: Tensor conversion requested dtype int64 for Tensor with dtype int32: 'Tensor(\"Reshape:0\", shape=(2, 1), dtype=int32)'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"a.py\", line 4, in &lt;module&gt;\n    tf.batch_gather(x, y)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/ops/array_ops.py\", line 2726, in batch_gather\n    batch_indices += reshape(dim_indices, dim_shape)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/ops/math_ops.py\", line 862, in binary_op_wrapper\n    return func(x, y, name=name)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/ops/gen_math_ops.py\", line 301, in add\n    \"Add\", x=x, y=y, name=name)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/op_def_library.py\", line 546, in _apply_op_helper\n    inferred_from[input_arg.type_attr]))\nTypeError: Input 'y' of 'Add' Op has type int32 that does not match type int64 of argument 'x'.\n</code></pre>\n<p>The error occurs <a href=\"https://github.com/tensorflow/tensorflow/blob/5fa4e1ac928b0512b28e955c588c5a7eab2ea046/tensorflow/python/ops/array_ops.py#L2726\">here</a> at the first <code>for</code> iteration. I found <code>batch_indices</code> is an int64 Tensor, while <code>dim_indices</code> is an int32 Tensor.<br>\nObviously, a simple fix is to cast <code>dim_indices</code> to the dtype of the input <code>indices</code>. I wonder if I can directly send a pull request.</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 16.04\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below): 1.11.0\nPython version: 3.5.2\nBazel version (if compiling from source):\nGCC/Compiler version (if compiling from source):\nCUDA/cuDNN version: using CPU\nGPU model and memory: using CPU\nExact command to reproduce:\n\nimport tensorflow as tf\nx = [[0, 1, 2], [3, 4, 5]]\ny = tf.convert_to_tensor([[1, 2, 0], [2, 0, 1]], dtype=tf.int64)\ntf.batch_gather(x, y)\n\nDescribe the problem\nWhen feeding an int64 Tensor as indices to tf.batch_gather, an error occurs.\nSource code / logs\nTraceback (most recent call last):\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/op_def_library.py\", line 510, in _apply_op_helper\n    preferred_dtype=default_dtype)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 1144, in internal_convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 981, in _TensorTensorConversionFunction\n    (dtype.name, t.dtype.name, str(t)))\nValueError: Tensor conversion requested dtype int64 for Tensor with dtype int32: 'Tensor(\"Reshape:0\", shape=(2, 1), dtype=int32)'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"a.py\", line 4, in <module>\n    tf.batch_gather(x, y)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/ops/array_ops.py\", line 2726, in batch_gather\n    batch_indices += reshape(dim_indices, dim_shape)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/ops/math_ops.py\", line 862, in binary_op_wrapper\n    return func(x, y, name=name)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/ops/gen_math_ops.py\", line 301, in add\n    \"Add\", x=x, y=y, name=name)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/op_def_library.py\", line 546, in _apply_op_helper\n    inferred_from[input_arg.type_attr]))\nTypeError: Input 'y' of 'Add' Op has type int32 that does not match type int64 of argument 'x'.\n\nThe error occurs here at the first for iteration. I found batch_indices is an int64 Tensor, while dim_indices is an int32 Tensor.\nObviously, a simple fix is to cast dim_indices to the dtype of the input indices. I wonder if I can directly send a pull request.", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Ubuntu 16.04\r\n- **Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device**:\r\n- **TensorFlow installed from (source or binary)**: binary\r\n- **TensorFlow version (use command below)**: 1.11.0\r\n- **Python version**: 3.5.2\r\n- **Bazel version (if compiling from source)**:\r\n- **GCC/Compiler version (if compiling from source)**:\r\n- **CUDA/cuDNN version**: using CPU\r\n- **GPU model and memory**: using CPU\r\n- **Exact command to reproduce**:\r\n```\r\nimport tensorflow as tf\r\nx = [[0, 1, 2], [3, 4, 5]]\r\ny = tf.convert_to_tensor([[1, 2, 0], [2, 0, 1]], dtype=tf.int64)\r\ntf.batch_gather(x, y)\r\n```\r\n### Describe the problem\r\nWhen feeding an int64 Tensor as `indices` to `tf.batch_gather`, an error occurs.\r\n\r\n### Source code / logs\r\n```\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/op_def_library.py\", line 510, in _apply_op_helper\r\n    preferred_dtype=default_dtype)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 1144, in internal_convert_to_tensor\r\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 981, in _TensorTensorConversionFunction\r\n    (dtype.name, t.dtype.name, str(t)))\r\nValueError: Tensor conversion requested dtype int64 for Tensor with dtype int32: 'Tensor(\"Reshape:0\", shape=(2, 1), dtype=int32)'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"a.py\", line 4, in <module>\r\n    tf.batch_gather(x, y)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/ops/array_ops.py\", line 2726, in batch_gather\r\n    batch_indices += reshape(dim_indices, dim_shape)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/ops/math_ops.py\", line 862, in binary_op_wrapper\r\n    return func(x, y, name=name)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/ops/gen_math_ops.py\", line 301, in add\r\n    \"Add\", x=x, y=y, name=name)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/op_def_library.py\", line 546, in _apply_op_helper\r\n    inferred_from[input_arg.type_attr]))\r\nTypeError: Input 'y' of 'Add' Op has type int32 that does not match type int64 of argument 'x'.\r\n```\r\n\r\nThe error occurs [here](https://github.com/tensorflow/tensorflow/blob/5fa4e1ac928b0512b28e955c588c5a7eab2ea046/tensorflow/python/ops/array_ops.py#L2726) at the first `for` iteration. I found `batch_indices` is an int64 Tensor, while `dim_indices` is an int32 Tensor.\r\nObviously, a simple fix is to cast `dim_indices` to the dtype of the input `indices`. I wonder if I can directly send a pull request."}