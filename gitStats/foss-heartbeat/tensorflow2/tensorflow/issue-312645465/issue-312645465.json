{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18353", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18353/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18353/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18353/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/18353", "id": 312645465, "node_id": "MDU6SXNzdWUzMTI2NDU0NjU=", "number": 18353, "title": "InvalidArgumentError in tensorflow reduce_sum gradient when compiling from sources (still a problem in TF 1.7)", "user": {"login": "hccheng", "id": 1667281, "node_id": "MDQ6VXNlcjE2NjcyODE=", "avatar_url": "https://avatars3.githubusercontent.com/u/1667281?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hccheng", "html_url": "https://github.com/hccheng", "followers_url": "https://api.github.com/users/hccheng/followers", "following_url": "https://api.github.com/users/hccheng/following{/other_user}", "gists_url": "https://api.github.com/users/hccheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/hccheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hccheng/subscriptions", "organizations_url": "https://api.github.com/users/hccheng/orgs", "repos_url": "https://api.github.com/users/hccheng/repos", "events_url": "https://api.github.com/users/hccheng/events{/privacy}", "received_events_url": "https://api.github.com/users/hccheng/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2018-04-09T18:53:24Z", "updated_at": "2018-11-22T18:55:30Z", "closed_at": null, "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: Yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Windows 10</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: source, without AVX support</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.7.0</li>\n<li><strong>Python version</strong>: 3.5.4</li>\n<li><strong>Bazel version (if compiling from source)</strong>: CMake 3.10.3</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: MSVC 2017</li>\n<li><strong>CUDA/cuDNN version</strong>: CPU only</li>\n<li><strong>GPU model and memory</strong>: CPU only</li>\n<li><strong>Exact command to reproduce</strong>:<br>\nUsing the same example provided in <a href=\"https://github.com/tensorflow/tensorflow/issues/12177\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/12177/hovercard\">#12177</a> and following the suggestions in the comment:</li>\n</ul>\n<pre><code>import tensorflow as tf\nimport numpy as np\n\nx = tf.placeholder(tf.float32, [2,3])\ny = tf.placeholder(tf.float32, [2,3])\nW = tf.Variable(tf.random_normal([3,3], stddev=0.01))\n\nz = tf.matmul(x, W)\n# works when removing the reduce_sum op\nz = tf.reduce_sum(tf.multiply(z, y), axis=1, keep_dims=True)\n\noptimizer = tf.train.AdamOptimizer()\ntrain_op = optimizer.minimize(z)\n\nXdata = np.array([[1,2,3],[4,5,6]])\nYdata = np.array([[2,3,4],[3,4,5]])\n\nop = tf.get_default_graph().get_operation_by_name(\"gradients/Sum_grad/Reshape\")\nwith tf.Session() as sess:\n    for input_ in op.inputs:\n        print(input_, sess.run(input_, feed_dict={x: Xdata, y: Ydata}))\n    sess.run(tf.global_variables_initializer())\n    sess.run(train_op, feed_dict={ x: Xdata, y: Ydata })\n    print('done')\n</code></pre>\n<p>Results:</p>\n<ul>\n<li>Build from source</li>\n</ul>\n<pre><code>Tensor(\"gradients/Fill:0\", shape=(2, 1), dtype=float32) [[1.]\n [1.]]\nTensor(\"gradients/Sum_grad/DynamicStitch:0\", shape=(?,), dtype=int32) [2 1 0 ... 0 0 0]\n2018-04-09 14:59:09.801431: F C:\\Users\\hcheng\\tensorflow\\tensorflow\\core\\framework\\tensor_shape.cc:243] Check failed: ndims_byte() &lt; MaxDimensions() (unsigned char value 254 vs. 254)Too many dimensions in tensor\n</code></pre>\n<ul>\n<li>Precompiled binary</li>\n</ul>\n<pre><code>Tensor(\"gradients/Fill:0\", shape=(2, 1), dtype=float32) [[1.]\n [1.]]\nTensor(\"gradients/Sum_grad/DynamicStitch:0\", shape=(?,), dtype=int32) [2 1]\ndone\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Windows 10\nTensorFlow installed from (source or binary): source, without AVX support\nTensorFlow version (use command below): 1.7.0\nPython version: 3.5.4\nBazel version (if compiling from source): CMake 3.10.3\nGCC/Compiler version (if compiling from source): MSVC 2017\nCUDA/cuDNN version: CPU only\nGPU model and memory: CPU only\nExact command to reproduce:\nUsing the same example provided in #12177 and following the suggestions in the comment:\n\nimport tensorflow as tf\nimport numpy as np\n\nx = tf.placeholder(tf.float32, [2,3])\ny = tf.placeholder(tf.float32, [2,3])\nW = tf.Variable(tf.random_normal([3,3], stddev=0.01))\n\nz = tf.matmul(x, W)\n# works when removing the reduce_sum op\nz = tf.reduce_sum(tf.multiply(z, y), axis=1, keep_dims=True)\n\noptimizer = tf.train.AdamOptimizer()\ntrain_op = optimizer.minimize(z)\n\nXdata = np.array([[1,2,3],[4,5,6]])\nYdata = np.array([[2,3,4],[3,4,5]])\n\nop = tf.get_default_graph().get_operation_by_name(\"gradients/Sum_grad/Reshape\")\nwith tf.Session() as sess:\n    for input_ in op.inputs:\n        print(input_, sess.run(input_, feed_dict={x: Xdata, y: Ydata}))\n    sess.run(tf.global_variables_initializer())\n    sess.run(train_op, feed_dict={ x: Xdata, y: Ydata })\n    print('done')\n\nResults:\n\nBuild from source\n\nTensor(\"gradients/Fill:0\", shape=(2, 1), dtype=float32) [[1.]\n [1.]]\nTensor(\"gradients/Sum_grad/DynamicStitch:0\", shape=(?,), dtype=int32) [2 1 0 ... 0 0 0]\n2018-04-09 14:59:09.801431: F C:\\Users\\hcheng\\tensorflow\\tensorflow\\core\\framework\\tensor_shape.cc:243] Check failed: ndims_byte() < MaxDimensions() (unsigned char value 254 vs. 254)Too many dimensions in tensor\n\n\nPrecompiled binary\n\nTensor(\"gradients/Fill:0\", shape=(2, 1), dtype=float32) [[1.]\n [1.]]\nTensor(\"gradients/Sum_grad/DynamicStitch:0\", shape=(?,), dtype=int32) [2 1]\ndone", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: Yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Windows 10\r\n- **TensorFlow installed from (source or binary)**: source, without AVX support\r\n- **TensorFlow version (use command below)**: 1.7.0\r\n- **Python version**: 3.5.4\r\n- **Bazel version (if compiling from source)**: CMake 3.10.3\r\n- **GCC/Compiler version (if compiling from source)**: MSVC 2017\r\n- **CUDA/cuDNN version**: CPU only\r\n- **GPU model and memory**: CPU only\r\n- **Exact command to reproduce**:\r\nUsing the same example provided in [#12177](https://github.com/tensorflow/tensorflow/issues/12177) and following the suggestions in the comment:\r\n```\r\nimport tensorflow as tf\r\nimport numpy as np\r\n\r\nx = tf.placeholder(tf.float32, [2,3])\r\ny = tf.placeholder(tf.float32, [2,3])\r\nW = tf.Variable(tf.random_normal([3,3], stddev=0.01))\r\n\r\nz = tf.matmul(x, W)\r\n# works when removing the reduce_sum op\r\nz = tf.reduce_sum(tf.multiply(z, y), axis=1, keep_dims=True)\r\n\r\noptimizer = tf.train.AdamOptimizer()\r\ntrain_op = optimizer.minimize(z)\r\n\r\nXdata = np.array([[1,2,3],[4,5,6]])\r\nYdata = np.array([[2,3,4],[3,4,5]])\r\n\r\nop = tf.get_default_graph().get_operation_by_name(\"gradients/Sum_grad/Reshape\")\r\nwith tf.Session() as sess:\r\n    for input_ in op.inputs:\r\n        print(input_, sess.run(input_, feed_dict={x: Xdata, y: Ydata}))\r\n    sess.run(tf.global_variables_initializer())\r\n    sess.run(train_op, feed_dict={ x: Xdata, y: Ydata })\r\n    print('done')\r\n```\r\nResults:\r\n- Build from source\r\n```\r\nTensor(\"gradients/Fill:0\", shape=(2, 1), dtype=float32) [[1.]\r\n [1.]]\r\nTensor(\"gradients/Sum_grad/DynamicStitch:0\", shape=(?,), dtype=int32) [2 1 0 ... 0 0 0]\r\n2018-04-09 14:59:09.801431: F C:\\Users\\hcheng\\tensorflow\\tensorflow\\core\\framework\\tensor_shape.cc:243] Check failed: ndims_byte() < MaxDimensions() (unsigned char value 254 vs. 254)Too many dimensions in tensor\r\n```\r\n- Precompiled binary\r\n```\r\nTensor(\"gradients/Fill:0\", shape=(2, 1), dtype=float32) [[1.]\r\n [1.]]\r\nTensor(\"gradients/Sum_grad/DynamicStitch:0\", shape=(?,), dtype=int32) [2 1]\r\ndone\r\n```\r\n\r\n"}