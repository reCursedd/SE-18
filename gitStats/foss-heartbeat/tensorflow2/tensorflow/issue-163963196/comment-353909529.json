{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/353909529", "html_url": "https://github.com/tensorflow/tensorflow/issues/3198#issuecomment-353909529", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3198", "id": 353909529, "node_id": "MDEyOklzc3VlQ29tbWVudDM1MzkwOTUyOQ==", "user": {"login": "kaizhigaosu", "id": 25855710, "node_id": "MDQ6VXNlcjI1ODU1NzEw", "avatar_url": "https://avatars1.githubusercontent.com/u/25855710?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kaizhigaosu", "html_url": "https://github.com/kaizhigaosu", "followers_url": "https://api.github.com/users/kaizhigaosu/followers", "following_url": "https://api.github.com/users/kaizhigaosu/following{/other_user}", "gists_url": "https://api.github.com/users/kaizhigaosu/gists{/gist_id}", "starred_url": "https://api.github.com/users/kaizhigaosu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kaizhigaosu/subscriptions", "organizations_url": "https://api.github.com/users/kaizhigaosu/orgs", "repos_url": "https://api.github.com/users/kaizhigaosu/repos", "events_url": "https://api.github.com/users/kaizhigaosu/events{/privacy}", "received_events_url": "https://api.github.com/users/kaizhigaosu/received_events", "type": "User", "site_admin": false}, "created_at": "2017-12-26T03:04:52Z", "updated_at": "2017-12-26T03:04:52Z", "author_association": "NONE", "body_html": "<p>The similar problem occurs again in TF 1.4. My distributed tf codes work fine for TF 1.2,  when I update TF to version 1.4, below errors are reported for some codes, take seq2seq as example:</p>\n<hr>\n<p>2017-12-25 11:00:50.946656: I tensorflow/core/distributed_runtime/master_session.cc:1004] Start master session 8f2200ccca936616 with config: allow_soft_placement: true<br>\nINFO:tensorflow:Error reported to Coordinator: &lt;class 'tensorflow.python.framework.errors_impl.InvalidArgumentError'&gt;, Cannot colocate nodes 'tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/read_tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases_0' and 'embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/RMSProp_1: Cannot merge devices with incompatible jobs: '/job:worker/task:1/device:CPU:0' and '/job:ps/task:0/device:CPU:0'<br>\n[[Node: tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/read_tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases_0 = Identity<a href=\"tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/cond/Merge\">T=DT_FLOAT, _class=[\"loc:@embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases\"], _device=\"/job:ps/task:0/device:CPU:0\"</a>]]</p>\n<p>Caused by op u'tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/read_tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases_0', defined at:<br>\nFile \"/home/peng/letrain/applications/letrain.py\", line 241, in <br>\ntf.app.run()<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 48, in run<br>\n_sys.exit(main(_sys.argv[:1] + flags_passthrough))<br>\nFile \"/home/peng/letrain/applications/letrain.py\", line 238, in main<br>\nLeTrain().model_train(user_mode)<br>\nFile \"/home/peng/letrain/platform/base_train.py\", line 1046, in model_train<br>\ntvars_ps, acc_grads = self._gen_ps_model_and_acc_grads(variables_to_train, deploy_config)<br>\nFile \"/home/peng/letrain/platform/base_train.py\", line 679, in _gen_ps_model_and_acc_grads<br>\ntrainable=False)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variable_scope.py\", line 1203, in get_variable<br>\nconstraint=constraint)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variable_scope.py\", line 1092, in get_variable<br>\nconstraint=constraint)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variable_scope.py\", line 425, in get_variable<br>\nconstraint=constraint)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variable_scope.py\", line 394, in _true_getter<br>\nuse_resource=use_resource, constraint=constraint)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variable_scope.py\", line 805, in _get_single_variable<br>\nconstraint=constraint)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 213, in <strong>init</strong><br>\nconstraint=constraint)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 345, in _init_from_args<br>\nself._build_initializer_expr(self._initial_value),<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 777, in _build_initializer_expr<br>\nnew_op = self._build_initializer_expr(initial_value.op)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 813, in _build_initializer_expr<br>\nattrs=initial_value.node_def.attr)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2956, in create_op<br>\nop_def=op_def)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1470, in <strong>init</strong><br>\nself._traceback = self._graph._extract_stack()  # pylint: disable=protected-access</p>\n<p>InvalidArgumentError (see above for traceback): Cannot colocate nodes 'tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/read_tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases_0' and 'embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/RMSProp_1: Cannot merge devices with incompatible jobs: '/job:worker/task:1/device:CPU:0' and '/job:ps/task:0/device:CPU:0'<br>\n[[Node: tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/read_tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases_0 = Identity<a href=\"tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/cond/Merge\">T=DT_FLOAT, _class=[\"loc:@embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases\"], _device=\"/job:ps/task:0/device:CPU:0\"</a>]]</p>", "body_text": "The similar problem occurs again in TF 1.4. My distributed tf codes work fine for TF 1.2,  when I update TF to version 1.4, below errors are reported for some codes, take seq2seq as example:\n\n2017-12-25 11:00:50.946656: I tensorflow/core/distributed_runtime/master_session.cc:1004] Start master session 8f2200ccca936616 with config: allow_soft_placement: true\nINFO:tensorflow:Error reported to Coordinator: <class 'tensorflow.python.framework.errors_impl.InvalidArgumentError'>, Cannot colocate nodes 'tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/read_tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases_0' and 'embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/RMSProp_1: Cannot merge devices with incompatible jobs: '/job:worker/task:1/device:CPU:0' and '/job:ps/task:0/device:CPU:0'\n[[Node: tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/read_tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases_0 = IdentityT=DT_FLOAT, _class=[\"loc:@embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases\"], _device=\"/job:ps/task:0/device:CPU:0\"]]\nCaused by op u'tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/read_tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases_0', defined at:\nFile \"/home/peng/letrain/applications/letrain.py\", line 241, in \ntf.app.run()\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 48, in run\n_sys.exit(main(_sys.argv[:1] + flags_passthrough))\nFile \"/home/peng/letrain/applications/letrain.py\", line 238, in main\nLeTrain().model_train(user_mode)\nFile \"/home/peng/letrain/platform/base_train.py\", line 1046, in model_train\ntvars_ps, acc_grads = self._gen_ps_model_and_acc_grads(variables_to_train, deploy_config)\nFile \"/home/peng/letrain/platform/base_train.py\", line 679, in _gen_ps_model_and_acc_grads\ntrainable=False)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variable_scope.py\", line 1203, in get_variable\nconstraint=constraint)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variable_scope.py\", line 1092, in get_variable\nconstraint=constraint)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variable_scope.py\", line 425, in get_variable\nconstraint=constraint)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variable_scope.py\", line 394, in _true_getter\nuse_resource=use_resource, constraint=constraint)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variable_scope.py\", line 805, in _get_single_variable\nconstraint=constraint)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 213, in init\nconstraint=constraint)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 345, in _init_from_args\nself._build_initializer_expr(self._initial_value),\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 777, in _build_initializer_expr\nnew_op = self._build_initializer_expr(initial_value.op)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 813, in _build_initializer_expr\nattrs=initial_value.node_def.attr)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2956, in create_op\nop_def=op_def)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1470, in init\nself._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\nInvalidArgumentError (see above for traceback): Cannot colocate nodes 'tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/read_tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases_0' and 'embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/RMSProp_1: Cannot merge devices with incompatible jobs: '/job:worker/task:1/device:CPU:0' and '/job:ps/task:0/device:CPU:0'\n[[Node: tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/read_tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases_0 = IdentityT=DT_FLOAT, _class=[\"loc:@embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases\"], _device=\"/job:ps/task:0/device:CPU:0\"]]", "body": "The similar problem occurs again in TF 1.4. My distributed tf codes work fine for TF 1.2,  when I update TF to version 1.4, below errors are reported for some codes, take seq2seq as example:\r\n\r\n------------------------------------------\r\n2017-12-25 11:00:50.946656: I tensorflow/core/distributed_runtime/master_session.cc:1004] Start master session 8f2200ccca936616 with config: allow_soft_placement: true\r\nINFO:tensorflow:Error reported to Coordinator: <class 'tensorflow.python.framework.errors_impl.InvalidArgumentError'>, Cannot colocate nodes 'tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/read_tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases_0' and 'embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/RMSProp_1: Cannot merge devices with incompatible jobs: '/job:worker/task:1/device:CPU:0' and '/job:ps/task:0/device:CPU:0'\r\n\t [[Node: tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/read_tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases_0 = Identity[T=DT_FLOAT, _class=[\"loc:@embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases\"], _device=\"/job:ps/task:0/device:CPU:0\"](tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/cond/Merge)]]\r\n\r\nCaused by op u'tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/read_tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases_0', defined at:\r\n  File \"/home/peng/letrain/applications/letrain.py\", line 241, in <module>\r\n    tf.app.run()\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 48, in run\r\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\r\n  File \"/home/peng/letrain/applications/letrain.py\", line 238, in main\r\n    LeTrain().model_train(user_mode)\r\n  File \"/home/peng/letrain/platform/base_train.py\", line 1046, in model_train\r\n    tvars_ps, acc_grads = self._gen_ps_model_and_acc_grads(variables_to_train, deploy_config)\r\n  File \"/home/peng/letrain/platform/base_train.py\", line 679, in _gen_ps_model_and_acc_grads\r\n    trainable=False)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variable_scope.py\", line 1203, in get_variable\r\n    constraint=constraint)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variable_scope.py\", line 1092, in get_variable\r\n    constraint=constraint)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variable_scope.py\", line 425, in get_variable\r\n    constraint=constraint)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variable_scope.py\", line 394, in _true_getter\r\n    use_resource=use_resource, constraint=constraint)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variable_scope.py\", line 805, in _get_single_variable\r\n    constraint=constraint)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 213, in __init__\r\n    constraint=constraint)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 345, in _init_from_args\r\n    self._build_initializer_expr(self._initial_value),\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 777, in _build_initializer_expr\r\n    new_op = self._build_initializer_expr(initial_value.op)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 813, in _build_initializer_expr\r\n    attrs=initial_value.node_def.attr)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2956, in create_op\r\n    op_def=op_def)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1470, in __init__\r\n    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\r\n\r\nInvalidArgumentError (see above for traceback): Cannot colocate nodes 'tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/read_tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases_0' and 'embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/RMSProp_1: Cannot merge devices with incompatible jobs: '/job:worker/task:1/device:CPU:0' and '/job:ps/task:0/device:CPU:0'\r\n\t [[Node: tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases/read_tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases_0 = Identity[T=DT_FLOAT, _class=[\"loc:@embedding_attention_seq2seq/embedding_attention_decoder/attention_decoder/AttnOutputProjection/biases\"], _device=\"/job:ps/task:0/device:CPU:0\"](tvars_ps35_embedding_attention_seq2seq_embedding_attention_decoder_attention_decoder_AttnOutputProjection_biases/cond/Merge)]]\r\n\r\n\r\n\r\n"}