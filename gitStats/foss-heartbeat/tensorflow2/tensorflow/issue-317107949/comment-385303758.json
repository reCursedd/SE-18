{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/385303758", "html_url": "https://github.com/tensorflow/tensorflow/issues/18822#issuecomment-385303758", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18822", "id": 385303758, "node_id": "MDEyOklzc3VlQ29tbWVudDM4NTMwMzc1OA==", "user": {"login": "ChiFang", "id": 16358320, "node_id": "MDQ6VXNlcjE2MzU4MzIw", "avatar_url": "https://avatars3.githubusercontent.com/u/16358320?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChiFang", "html_url": "https://github.com/ChiFang", "followers_url": "https://api.github.com/users/ChiFang/followers", "following_url": "https://api.github.com/users/ChiFang/following{/other_user}", "gists_url": "https://api.github.com/users/ChiFang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChiFang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChiFang/subscriptions", "organizations_url": "https://api.github.com/users/ChiFang/orgs", "repos_url": "https://api.github.com/users/ChiFang/repos", "events_url": "https://api.github.com/users/ChiFang/events{/privacy}", "received_events_url": "https://api.github.com/users/ChiFang/received_events", "type": "User", "site_admin": false}, "created_at": "2018-04-30T02:42:19Z", "updated_at": "2018-04-30T02:46:00Z", "author_association": "NONE", "body_html": "<p>hi <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=49262\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jart\">@jart</a><br>\nI think it might be a bug.  Because once tensorflow be active. it will make every cuda code crash even I use \"sess.close()\"...<br>\nThe case mentioned above is run on specific NVIDIA driver to make it don't crash.</p>\n<p>The following code it a simple example cuda code run by <a href=\"https://documen.tician.de/pycuda/\" rel=\"nofollow\">pycuda</a>.<br>\nonce I add <code>sess = tf.Session()</code> .  My cuda code crash. It work fine without <code>sess = tf.Session()</code>.</p>\n<pre><code>import tensorflow as tf\nimport pycuda.autoinit\nimport pycuda.driver as drv\nimport numpy\nfrom pycuda.compiler import SourceModule\nmod = SourceModule(\"\"\"\n__global__ void multiply_them(float *dest, float *a, float *b)\n{\n  const int i = threadIdx.x;\n  dest[i] = a[i] * b[i];\n}\n\"\"\")\n## tensorflow will make any other cuda code crash................................\nsess = tf.Session()\nsess.close()\nmultiply_them = mod.get_function(\"multiply_them\")\na = numpy.random.randn(400).astype(numpy.float32)\nb = numpy.random.randn(400).astype(numpy.float32)\ndest = numpy.zeros_like(a)\nmultiply_them(drv.Out(dest), drv.In(a), drv.In(b), block=(400,1,1), grid=(1,1))\nprint (dest-a*b)\nprint(\"finish\")\n</code></pre>\n<p>It would be wonderful if tensorflow could allow other cuda code</p>", "body_text": "hi @jart\nI think it might be a bug.  Because once tensorflow be active. it will make every cuda code crash even I use \"sess.close()\"...\nThe case mentioned above is run on specific NVIDIA driver to make it don't crash.\nThe following code it a simple example cuda code run by pycuda.\nonce I add sess = tf.Session() .  My cuda code crash. It work fine without sess = tf.Session().\nimport tensorflow as tf\nimport pycuda.autoinit\nimport pycuda.driver as drv\nimport numpy\nfrom pycuda.compiler import SourceModule\nmod = SourceModule(\"\"\"\n__global__ void multiply_them(float *dest, float *a, float *b)\n{\n  const int i = threadIdx.x;\n  dest[i] = a[i] * b[i];\n}\n\"\"\")\n## tensorflow will make any other cuda code crash................................\nsess = tf.Session()\nsess.close()\nmultiply_them = mod.get_function(\"multiply_them\")\na = numpy.random.randn(400).astype(numpy.float32)\nb = numpy.random.randn(400).astype(numpy.float32)\ndest = numpy.zeros_like(a)\nmultiply_them(drv.Out(dest), drv.In(a), drv.In(b), block=(400,1,1), grid=(1,1))\nprint (dest-a*b)\nprint(\"finish\")\n\nIt would be wonderful if tensorflow could allow other cuda code", "body": "hi @jart \r\nI think it might be a bug.  Because once tensorflow be active. it will make every cuda code crash even I use \"sess.close()\"...\r\nThe case mentioned above is run on specific NVIDIA driver to make it don't crash.\r\n\r\nThe following code it a simple example cuda code run by [pycuda](https://documen.tician.de/pycuda/).\r\nonce I add `sess = tf.Session()` .  My cuda code crash. It work fine without `sess = tf.Session()`.\r\n\r\n```\r\nimport tensorflow as tf\r\nimport pycuda.autoinit\r\nimport pycuda.driver as drv\r\nimport numpy\r\nfrom pycuda.compiler import SourceModule\r\nmod = SourceModule(\"\"\"\r\n__global__ void multiply_them(float *dest, float *a, float *b)\r\n{\r\n  const int i = threadIdx.x;\r\n  dest[i] = a[i] * b[i];\r\n}\r\n\"\"\")\r\n## tensorflow will make any other cuda code crash................................\r\nsess = tf.Session()\r\nsess.close()\r\nmultiply_them = mod.get_function(\"multiply_them\")\r\na = numpy.random.randn(400).astype(numpy.float32)\r\nb = numpy.random.randn(400).astype(numpy.float32)\r\ndest = numpy.zeros_like(a)\r\nmultiply_them(drv.Out(dest), drv.In(a), drv.In(b), block=(400,1,1), grid=(1,1))\r\nprint (dest-a*b)\r\nprint(\"finish\")\r\n```\r\n\r\nIt would be wonderful if tensorflow could allow other cuda code "}