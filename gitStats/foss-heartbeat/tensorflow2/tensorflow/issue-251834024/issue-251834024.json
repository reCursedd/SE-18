{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12474", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12474/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12474/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12474/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/12474", "id": 251834024, "node_id": "MDU6SXNzdWUyNTE4MzQwMjQ=", "number": 12474, "title": "CUDA 9RC + cuDNN7", "user": {"login": "tfboyd", "id": 23486130, "node_id": "MDQ6VXNlcjIzNDg2MTMw", "avatar_url": "https://avatars1.githubusercontent.com/u/23486130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tfboyd", "html_url": "https://github.com/tfboyd", "followers_url": "https://api.github.com/users/tfboyd/followers", "following_url": "https://api.github.com/users/tfboyd/following{/other_user}", "gists_url": "https://api.github.com/users/tfboyd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tfboyd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tfboyd/subscriptions", "organizations_url": "https://api.github.com/users/tfboyd/orgs", "repos_url": "https://api.github.com/users/tfboyd/repos", "events_url": "https://api.github.com/users/tfboyd/events{/privacy}", "received_events_url": "https://api.github.com/users/tfboyd/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473173272, "node_id": "MDU6TGFiZWw0NzMxNzMyNzI=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:feature", "name": "type:feature", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "tfboyd", "id": 23486130, "node_id": "MDQ6VXNlcjIzNDg2MTMw", "avatar_url": "https://avatars1.githubusercontent.com/u/23486130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tfboyd", "html_url": "https://github.com/tfboyd", "followers_url": "https://api.github.com/users/tfboyd/followers", "following_url": "https://api.github.com/users/tfboyd/following{/other_user}", "gists_url": "https://api.github.com/users/tfboyd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tfboyd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tfboyd/subscriptions", "organizations_url": "https://api.github.com/users/tfboyd/orgs", "repos_url": "https://api.github.com/users/tfboyd/repos", "events_url": "https://api.github.com/users/tfboyd/events{/privacy}", "received_events_url": "https://api.github.com/users/tfboyd/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "tfboyd", "id": 23486130, "node_id": "MDQ6VXNlcjIzNDg2MTMw", "avatar_url": "https://avatars1.githubusercontent.com/u/23486130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tfboyd", "html_url": "https://github.com/tfboyd", "followers_url": "https://api.github.com/users/tfboyd/followers", "following_url": "https://api.github.com/users/tfboyd/following{/other_user}", "gists_url": "https://api.github.com/users/tfboyd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tfboyd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tfboyd/subscriptions", "organizations_url": "https://api.github.com/users/tfboyd/orgs", "repos_url": "https://api.github.com/users/tfboyd/repos", "events_url": "https://api.github.com/users/tfboyd/events{/privacy}", "received_events_url": "https://api.github.com/users/tfboyd/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 44, "created_at": "2017-08-22T04:20:42Z", "updated_at": "2017-12-14T18:41:59Z", "closed_at": "2017-10-20T20:07:12Z", "author_association": "MEMBER", "body_html": "<p>Things have moved forward.  I strongly suggest building from head with CUDA 9 and cuDNN 7.  All of the necessary codes <strong>should</strong> be in the TF 1.4 tag but given we are still working on new features for FP16, I would build from head if that is of interest.  I do not like to share anything I have not personally tested as I know how frustrating trying to get things to compile can be.</p>\n<p><strong>Everything below this line is OUT DATED as of 19-OCT</strong></p>\n<p>This is an <strong>unofficial</strong> and <strong>very</strong> not supported patch to make it possible to compile TensorFlow with CUDA9RC and cuDNN 7 or CUDA8 + cuDNN 7.</p>\n<p>During testing on V100 (Volta) and ResNet-50 FP32  using CUDA 9RC + cuDNN 7 was significantly faster than CUDA 8 + cuDNN 6, which was not a surprise.  I am about to test on P100s.  I am sharing this patch informally so those that are interested can play with cuDNN 7 as well as CUDA 9RC before we have the official release.  As we have more interesting code, e.g FP16 models, I will share it in this issue.   I expect NVIDIA will start to submit official cuDNN 7 patches very soon.</p>\n<p><strong>Note:</strong>  This patch may work on more recent versions of TensorFlow but it will likely bit rot so keep that in mind.  Apply the cuDNN 7 patch and then fast-forwarding the branch might be the best approach.  My git skills are not strong so do what you think is best.</p>\n<ol>\n<li>Download the patches</li>\n</ol>\n<ul>\n<li><a href=\"https://storage.googleapis.com/tf-performance/public/cuda9rc_patch/0001-CUDA-9.0-and-cuDNN-7.0-support.patch\" rel=\"nofollow\">0001-CUDA-9.0-and-cuDNN-7.0-support.patch</a></li>\n<li><a href=\"https://storage.googleapis.com/tf-performance/public/cuda9rc_patch/eigen.f3a22f35b044.cuda9.diff\" rel=\"nofollow\">eigen.f3a22f35b044.cuda9.diff</a></li>\n</ul>\n<ol start=\"2\">\n<li>\n<p>Clone the tensorflow repo<br>\n<code>https://github.com/tensorflow/tensorflow.git</code></p>\n</li>\n<li>\n<p>Checkout the revision that the TensorFlow patch can apply to:<br>\n<code>git checkout db596594b5653b43fcb558a4753b39904bb62cbd~</code></p>\n</li>\n<li>\n<p>Apply the TensorFlow patch:<br>\n<code>git apply ~/Downloads/0001-CUDA-9.0-and-cuDNN-7.0-support.patch</code></p>\n</li>\n<li>\n<p>Run ./configure. When it asks for the CUDA version, put 9.0 (or 8). When it asks for the cudnn version, put 7.0.1 (Entering '7' worked fine for me). Make sure you put the paths to the right Cuda and cudnn versions and have your ldconfig or LD_LIBARY_PATH set to point to the CUDA 9 folder.<br>\n<code>./configure</code></p>\n</li>\n<li>\n<p>Attempt to build TensorFlow, so that Eigen is downloaded. <strong>This build will fail if building for CUDA9RC but will succeed for CUDA8</strong><br>\n<code>bazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package</code></p>\n</li>\n<li>\n<p>Apply the Eigen patch:</p>\n</li>\n</ol>\n<div class=\"highlight highlight-source-shell\"><pre>    <span class=\"pl-c1\">cd</span> -P bazel-out/../../../external/eigen_archive\n    patch -p1 <span class=\"pl-k\">&lt;</span> <span class=\"pl-k\">~</span>/Downloads/eigen.f3a22f35b044.cuda9.diff</pre></div>\n<ol start=\"8\">\n<li>Build TensorFlow successfully</li>\n</ol>\n<div class=\"highlight highlight-source-shell\"><pre>    <span class=\"pl-c1\">cd</span> -\n    bazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package</pre></div>\n<p>I have run this process myself on Ubuntu 14.04 with Python 2.7.</p>\n<p>Thank for NVIDIA for the early patch and <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=6510203\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/reedwm\">@reedwm</a> who created most of these instructions.</p>\n<p>If you are using Python 2.7 and gcc 4.8+ here is a <a href=\"https://storage.googleapis.com/tf-performance/tf_binary/gcc4_8/tensorflow-1.4.HEAD.b9ac2d7eb.AUG_1.CUDA9rc-cp27-none-linux_x86_64.whl\" rel=\"nofollow\">.whl</a> where I followed the instructions above and <a href=\"https://storage.googleapis.com/tf-performance/tf_binary/gcc4_8/tensorflow-1.4.HEAD.b9ac2d7eb.AUG_1.CUDA8_cuDNN7-cp27-none-linux_x86_64.whl\" rel=\"nofollow\">one with CUDA 8 and cuDNN 7</a> which I have yet to test.  Stress again, this was created by me and not the TensorFlow build team.  My/our goal is to engage with anyone that wants to try this out and try to have a little fun.  :-)</p>", "body_text": "Things have moved forward.  I strongly suggest building from head with CUDA 9 and cuDNN 7.  All of the necessary codes should be in the TF 1.4 tag but given we are still working on new features for FP16, I would build from head if that is of interest.  I do not like to share anything I have not personally tested as I know how frustrating trying to get things to compile can be.\nEverything below this line is OUT DATED as of 19-OCT\nThis is an unofficial and very not supported patch to make it possible to compile TensorFlow with CUDA9RC and cuDNN 7 or CUDA8 + cuDNN 7.\nDuring testing on V100 (Volta) and ResNet-50 FP32  using CUDA 9RC + cuDNN 7 was significantly faster than CUDA 8 + cuDNN 6, which was not a surprise.  I am about to test on P100s.  I am sharing this patch informally so those that are interested can play with cuDNN 7 as well as CUDA 9RC before we have the official release.  As we have more interesting code, e.g FP16 models, I will share it in this issue.   I expect NVIDIA will start to submit official cuDNN 7 patches very soon.\nNote:  This patch may work on more recent versions of TensorFlow but it will likely bit rot so keep that in mind.  Apply the cuDNN 7 patch and then fast-forwarding the branch might be the best approach.  My git skills are not strong so do what you think is best.\n\nDownload the patches\n\n\n0001-CUDA-9.0-and-cuDNN-7.0-support.patch\neigen.f3a22f35b044.cuda9.diff\n\n\n\nClone the tensorflow repo\nhttps://github.com/tensorflow/tensorflow.git\n\n\nCheckout the revision that the TensorFlow patch can apply to:\ngit checkout db596594b5653b43fcb558a4753b39904bb62cbd~\n\n\nApply the TensorFlow patch:\ngit apply ~/Downloads/0001-CUDA-9.0-and-cuDNN-7.0-support.patch\n\n\nRun ./configure. When it asks for the CUDA version, put 9.0 (or 8). When it asks for the cudnn version, put 7.0.1 (Entering '7' worked fine for me). Make sure you put the paths to the right Cuda and cudnn versions and have your ldconfig or LD_LIBARY_PATH set to point to the CUDA 9 folder.\n./configure\n\n\nAttempt to build TensorFlow, so that Eigen is downloaded. This build will fail if building for CUDA9RC but will succeed for CUDA8\nbazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package\n\n\nApply the Eigen patch:\n\n\n    cd -P bazel-out/../../../external/eigen_archive\n    patch -p1 < ~/Downloads/eigen.f3a22f35b044.cuda9.diff\n\nBuild TensorFlow successfully\n\n    cd -\n    bazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package\nI have run this process myself on Ubuntu 14.04 with Python 2.7.\nThank for NVIDIA for the early patch and @reedwm who created most of these instructions.\nIf you are using Python 2.7 and gcc 4.8+ here is a .whl where I followed the instructions above and one with CUDA 8 and cuDNN 7 which I have yet to test.  Stress again, this was created by me and not the TensorFlow build team.  My/our goal is to engage with anyone that wants to try this out and try to have a little fun.  :-)", "body": "Things have moved forward.  I strongly suggest building from head with CUDA 9 and cuDNN 7.  All of the necessary codes **should** be in the TF 1.4 tag but given we are still working on new features for FP16, I would build from head if that is of interest.  I do not like to share anything I have not personally tested as I know how frustrating trying to get things to compile can be.\r\n\r\n\r\n**Everything below this line is OUT DATED as of 19-OCT**\r\n\r\nThis is an **unofficial** and **very** not supported patch to make it possible to compile TensorFlow with CUDA9RC and cuDNN 7 or CUDA8 + cuDNN 7.\r\n\r\nDuring testing on V100 (Volta) and ResNet-50 FP32  using CUDA 9RC + cuDNN 7 was significantly faster than CUDA 8 + cuDNN 6, which was not a surprise.  I am about to test on P100s.  I am sharing this patch informally so those that are interested can play with cuDNN 7 as well as CUDA 9RC before we have the official release.  As we have more interesting code, e.g FP16 models, I will share it in this issue.   I expect NVIDIA will start to submit official cuDNN 7 patches very soon.  \r\n\r\n**Note:**  This patch may work on more recent versions of TensorFlow but it will likely bit rot so keep that in mind.  Apply the cuDNN 7 patch and then fast-forwarding the branch might be the best approach.  My git skills are not strong so do what you think is best.  \r\n\r\n1. Download the patches\r\n- [0001-CUDA-9.0-and-cuDNN-7.0-support.patch](https://storage.googleapis.com/tf-performance/public/cuda9rc_patch/0001-CUDA-9.0-and-cuDNN-7.0-support.patch)\r\n- [eigen.f3a22f35b044.cuda9.diff](https://storage.googleapis.com/tf-performance/public/cuda9rc_patch/eigen.f3a22f35b044.cuda9.diff)\r\n\r\n2. Clone the tensorflow repo\r\n```https://github.com/tensorflow/tensorflow.git```\r\n\r\n3. Checkout the revision that the TensorFlow patch can apply to:\r\n```git checkout db596594b5653b43fcb558a4753b39904bb62cbd~```\r\n\r\n4. Apply the TensorFlow patch:\r\n```git apply ~/Downloads/0001-CUDA-9.0-and-cuDNN-7.0-support.patch```\r\n\r\n5. Run ./configure. When it asks for the CUDA version, put 9.0 (or 8). When it asks for the cudnn version, put 7.0.1 (Entering '7' worked fine for me). Make sure you put the paths to the right Cuda and cudnn versions and have your ldconfig or LD_LIBARY_PATH set to point to the CUDA 9 folder.\r\n```./configure```\r\n\r\n6. Attempt to build TensorFlow, so that Eigen is downloaded. **This build will fail if building for CUDA9RC but will succeed for CUDA8**\r\n ```bazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package```\r\n\r\n7. Apply the Eigen patch:\r\n```bash\r\n    cd -P bazel-out/../../../external/eigen_archive\r\n    patch -p1 < ~/Downloads/eigen.f3a22f35b044.cuda9.diff\r\n```\r\n\r\n8. Build TensorFlow successfully\r\n```bash\r\n    cd -\r\n    bazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package\r\n```\r\n\r\nI have run this process myself on Ubuntu 14.04 with Python 2.7.\r\n\r\nThank for NVIDIA for the early patch and @reedwm who created most of these instructions.  \r\n\r\nIf you are using Python 2.7 and gcc 4.8+ here is a [.whl](https://storage.googleapis.com/tf-performance/tf_binary/gcc4_8/tensorflow-1.4.HEAD.b9ac2d7eb.AUG_1.CUDA9rc-cp27-none-linux_x86_64.whl) where I followed the instructions above and [one with CUDA 8 and cuDNN 7](https://storage.googleapis.com/tf-performance/tf_binary/gcc4_8/tensorflow-1.4.HEAD.b9ac2d7eb.AUG_1.CUDA8_cuDNN7-cp27-none-linux_x86_64.whl) which I have yet to test.  Stress again, this was created by me and not the TensorFlow build team.  My/our goal is to engage with anyone that wants to try this out and try to have a little fun.  :-)\r\n"}