{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/226462431", "html_url": "https://github.com/tensorflow/tensorflow/issues/2788#issuecomment-226462431", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2788", "id": 226462431, "node_id": "MDEyOklzc3VlQ29tbWVudDIyNjQ2MjQzMQ==", "user": {"login": "dvyukov", "id": 1095328, "node_id": "MDQ6VXNlcjEwOTUzMjg=", "avatar_url": "https://avatars3.githubusercontent.com/u/1095328?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dvyukov", "html_url": "https://github.com/dvyukov", "followers_url": "https://api.github.com/users/dvyukov/followers", "following_url": "https://api.github.com/users/dvyukov/following{/other_user}", "gists_url": "https://api.github.com/users/dvyukov/gists{/gist_id}", "starred_url": "https://api.github.com/users/dvyukov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dvyukov/subscriptions", "organizations_url": "https://api.github.com/users/dvyukov/orgs", "repos_url": "https://api.github.com/users/dvyukov/repos", "events_url": "https://api.github.com/users/dvyukov/events{/privacy}", "received_events_url": "https://api.github.com/users/dvyukov/received_events", "type": "User", "site_admin": false}, "created_at": "2016-06-16T11:46:57Z", "updated_at": "2016-06-16T11:46:57Z", "author_association": "NONE", "body_html": "<p>It seems that all worker threads except one are in some kind of livelock, while one thread is working. And that livelocked threads additionally slowdown the working threads (due to contention in kernel or memory bus contention).</p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=15474222\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/alexatknit\">@alexatknit</a>, you said that \"Pausing and continuing the process using gdb will make it continue immediately\". Is it true most of the time?<br>\nIt seems that the pause/resume perturbates timings and threads exit from the livelock.</p>\n<p>You are running on a physical machine with i7-5930K processor. No VMs involved. Right?</p>\n<p>What OS do you use? <code>uname -a</code> on linux. I wonder if you use an old kernel.</p>\n<p>You said that the program hangs, but also that it completes successfully over night. Does it just become slower? By how much? Is it like 10x? 100x?</p>\n<p>In all stacks I see TensorContractionOp. I wonder if it submits super tiny tasks (due to cost over-estimation? <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=6969686\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/benoitsteiner\">@benoitsteiner</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=16907534\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rmlarsen\">@rmlarsen</a>).<br>\nI did the following experiment: submit a taks that merely submits another task, than that task submit another task again, and so on (infinite chain of tasks). I see up to 10x slowdown due to contention for other threads on my machine (playing with number of threads and affinity).<br>\nIt may be possible that during the hang it experiences, say, 100x slowdown may be due to a different OS.</p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=15474222\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/alexatknit\">@alexatknit</a> What model do you use? Can you provide a reproducer? Does it use contraction with some unusual rhs/lhs operands?</p>", "body_text": "It seems that all worker threads except one are in some kind of livelock, while one thread is working. And that livelocked threads additionally slowdown the working threads (due to contention in kernel or memory bus contention).\n@alexatknit, you said that \"Pausing and continuing the process using gdb will make it continue immediately\". Is it true most of the time?\nIt seems that the pause/resume perturbates timings and threads exit from the livelock.\nYou are running on a physical machine with i7-5930K processor. No VMs involved. Right?\nWhat OS do you use? uname -a on linux. I wonder if you use an old kernel.\nYou said that the program hangs, but also that it completes successfully over night. Does it just become slower? By how much? Is it like 10x? 100x?\nIn all stacks I see TensorContractionOp. I wonder if it submits super tiny tasks (due to cost over-estimation? @benoitsteiner @rmlarsen).\nI did the following experiment: submit a taks that merely submits another task, than that task submit another task again, and so on (infinite chain of tasks). I see up to 10x slowdown due to contention for other threads on my machine (playing with number of threads and affinity).\nIt may be possible that during the hang it experiences, say, 100x slowdown may be due to a different OS.\n@alexatknit What model do you use? Can you provide a reproducer? Does it use contraction with some unusual rhs/lhs operands?", "body": "It seems that all worker threads except one are in some kind of livelock, while one thread is working. And that livelocked threads additionally slowdown the working threads (due to contention in kernel or memory bus contention).\n\n@alexatknit, you said that \"Pausing and continuing the process using gdb will make it continue immediately\". Is it true most of the time?\nIt seems that the pause/resume perturbates timings and threads exit from the livelock.\n\nYou are running on a physical machine with i7-5930K processor. No VMs involved. Right?\n\nWhat OS do you use? `uname -a` on linux. I wonder if you use an old kernel.\n\nYou said that the program hangs, but also that it completes successfully over night. Does it just become slower? By how much? Is it like 10x? 100x?\n\nIn all stacks I see TensorContractionOp. I wonder if it submits super tiny tasks (due to cost over-estimation? @benoitsteiner @rmlarsen).\nI did the following experiment: submit a taks that merely submits another task, than that task submit another task again, and so on (infinite chain of tasks). I see up to 10x slowdown due to contention for other threads on my machine (playing with number of threads and affinity).\nIt may be possible that during the hang it experiences, say, 100x slowdown may be due to a different OS.\n\n@alexatknit What model do you use? Can you provide a reproducer? Does it use contraction with some unusual rhs/lhs operands?\n"}