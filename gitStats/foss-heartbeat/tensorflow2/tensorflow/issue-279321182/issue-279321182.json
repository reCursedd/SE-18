{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15122", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15122/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15122/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15122/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15122", "id": 279321182, "node_id": "MDU6SXNzdWUyNzkzMjExODI=", "number": 15122, "title": "tensorflow lite: error when convert frozen model to lite format", "user": {"login": "imxboards", "id": 11689850, "node_id": "MDQ6VXNlcjExNjg5ODUw", "avatar_url": "https://avatars3.githubusercontent.com/u/11689850?v=4", "gravatar_id": "", "url": "https://api.github.com/users/imxboards", "html_url": "https://github.com/imxboards", "followers_url": "https://api.github.com/users/imxboards/followers", "following_url": "https://api.github.com/users/imxboards/following{/other_user}", "gists_url": "https://api.github.com/users/imxboards/gists{/gist_id}", "starred_url": "https://api.github.com/users/imxboards/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/imxboards/subscriptions", "organizations_url": "https://api.github.com/users/imxboards/orgs", "repos_url": "https://api.github.com/users/imxboards/repos", "events_url": "https://api.github.com/users/imxboards/events{/privacy}", "received_events_url": "https://api.github.com/users/imxboards/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 750616506, "node_id": "MDU6TGFiZWw3NTA2MTY1MDY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:lite", "name": "comp:lite", "color": "0052cc", "default": false}, {"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 24, "created_at": "2017-12-05T10:24:56Z", "updated_at": "2018-10-04T02:28:31Z", "closed_at": "2018-01-19T00:57:43Z", "author_association": "NONE", "body_html": "<p>Hi,<br>\nI build the freeze .pb with the guide at <a href=\"https://github.com/tensorflow/models/tree/master/research/slim\">https://github.com/tensorflow/models/tree/master/research/slim</a><br>\nwith the below step:</p>\n<p>python train_image_classifier.py <br>\n--train_dir /home/ubuntu/train/ <br>\n--dataset_dir /home/ubuntu/vegetables/ <br>\n--dataset_name=vegetables <br>\n--dataset_split_name=train  <br>\n--num_clones=2 <br>\n--clone_on_cpu=True <br>\n--checkpoint_path=/home/ubuntu/check_point/mobilenet_v1_1.0_224.ckpt <br>\n--max_number_of_steps=10 <br>\n--checkpoint_exclude_scopes=MobilenetV1/Logits,MobilenetV1/AuxLogits <br>\n--model_name=mobilenet_v1</p>\n<p>python tensorflow/python/tools/freeze_graph.py <br>\n--input_graph=/home/ubuntu/train/mobilenet_v1_224.pb <br>\n--input_checkpoint=/home/ubuntu/check_point/mobilenet_v1_1.0_224.ckpt <br>\n--input_binary=true <br>\n--output_graph=/home/ubuntu/train/frozen_mobilenet_v1_224.pb <br>\n--output_node_names=MobilenetV1/Predictions/Reshape_1</p>\n<p>NOTE: I download mobilenet_v1_1.0_224.ckpt from <a href=\"http://download.tensorflow.org/models/mobilenet_v1_1.0_224_2017_06_14.tar.gz\" rel=\"nofollow\">http://download.tensorflow.org/models/mobilenet_v1_1.0_224_2017_06_14.tar.gz</a></p>\n<p>But when I convert to lite mode with</p>\n<p>ubuntu@ip-172-31-27-248:~/tensorflow$ bazel-bin/tensorflow/contrib/lite/toco/toco <br>\n--input_format=TENSORFLOW_GRAPHDEF <br>\n--input_format=TENSORFLOW_GRAPHDEF <br>\n--input_file=/home/ubuntu/mobilenet_v1_1.0_224/frozen_mobilenet_v1_224.pb <br>\n--output_format=TFLITE <br>\n--output_file=/tmp/mobilenet_v1_1.0_224.lite --inference_type=FLOAT <br>\n--inference_input_type=FLOAT <br>\n--input_arrays=input <br>\n--output_arrays=MobilenetV1/Predictions/Reshape_1 --input_shapes=1,224,224,3</p>\n<p>2017-12-05 09:53:56.604720: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before general graph transformations: 336 operators, 502 arrays (0 quantized)<br>\n2017-12-05 09:53:56.627922: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After general graph transformations pass 1: 31 operators, 88 arrays (0 quantized)<br>\n2017-12-05 09:53:56.628156: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before dequantization graph transformations: 31 operators, 88 arrays (0 quantized)<br>\n2017-12-05 09:53:56.628327: I tensorflow/contrib/lite/toco/allocate_transient_arrays.cc:312] Total transient array allocated size: <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/642252829cccf56627749c3c3b8dc65cc0099893/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/642252829cccf56627749c3c3b8dc65cc0099893\"><tt>6422528</tt></a> bytes, theoretical optimal value: 4816896 bytes.<br>\n2017-12-05 09:53:56.628487: I tensorflow/contrib/lite/toco/toco_tooling.cc:268] Estimated count of arithmetic ops: 1.14264 billion (note that a multiply-add is counted as 2 ops).<br>\n2017-12-05 09:53:56.628653: F tensorflow/contrib/lite/toco/tflite/export.cc:192] Unsupported operator: Squeeze<br>\nAborted (core dumped)</p>\n<p>Pls help me!</p>\n<p>my other question is when I download the pretrain freeze pb from <a href=\"https://storage.googleapis.com/download.tensorflow.org/models/tflite/mobilenet_v1_1.0_224_float_2017_11_08.zip\" rel=\"nofollow\">https://storage.googleapis.com/download.tensorflow.org/models/tflite/mobilenet_v1_1.0_224_float_2017_11_08.zip</a><br>\nIt's work when I use toco tools. where I can find guide which generate these freeze pb.</p>\n<p>Pls Help!</p>", "body_text": "Hi,\nI build the freeze .pb with the guide at https://github.com/tensorflow/models/tree/master/research/slim\nwith the below step:\npython train_image_classifier.py \n--train_dir /home/ubuntu/train/ \n--dataset_dir /home/ubuntu/vegetables/ \n--dataset_name=vegetables \n--dataset_split_name=train  \n--num_clones=2 \n--clone_on_cpu=True \n--checkpoint_path=/home/ubuntu/check_point/mobilenet_v1_1.0_224.ckpt \n--max_number_of_steps=10 \n--checkpoint_exclude_scopes=MobilenetV1/Logits,MobilenetV1/AuxLogits \n--model_name=mobilenet_v1\npython tensorflow/python/tools/freeze_graph.py \n--input_graph=/home/ubuntu/train/mobilenet_v1_224.pb \n--input_checkpoint=/home/ubuntu/check_point/mobilenet_v1_1.0_224.ckpt \n--input_binary=true \n--output_graph=/home/ubuntu/train/frozen_mobilenet_v1_224.pb \n--output_node_names=MobilenetV1/Predictions/Reshape_1\nNOTE: I download mobilenet_v1_1.0_224.ckpt from http://download.tensorflow.org/models/mobilenet_v1_1.0_224_2017_06_14.tar.gz\nBut when I convert to lite mode with\nubuntu@ip-172-31-27-248:~/tensorflow$ bazel-bin/tensorflow/contrib/lite/toco/toco \n--input_format=TENSORFLOW_GRAPHDEF \n--input_format=TENSORFLOW_GRAPHDEF \n--input_file=/home/ubuntu/mobilenet_v1_1.0_224/frozen_mobilenet_v1_224.pb \n--output_format=TFLITE \n--output_file=/tmp/mobilenet_v1_1.0_224.lite --inference_type=FLOAT \n--inference_input_type=FLOAT \n--input_arrays=input \n--output_arrays=MobilenetV1/Predictions/Reshape_1 --input_shapes=1,224,224,3\n2017-12-05 09:53:56.604720: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before general graph transformations: 336 operators, 502 arrays (0 quantized)\n2017-12-05 09:53:56.627922: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After general graph transformations pass 1: 31 operators, 88 arrays (0 quantized)\n2017-12-05 09:53:56.628156: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before dequantization graph transformations: 31 operators, 88 arrays (0 quantized)\n2017-12-05 09:53:56.628327: I tensorflow/contrib/lite/toco/allocate_transient_arrays.cc:312] Total transient array allocated size: 6422528 bytes, theoretical optimal value: 4816896 bytes.\n2017-12-05 09:53:56.628487: I tensorflow/contrib/lite/toco/toco_tooling.cc:268] Estimated count of arithmetic ops: 1.14264 billion (note that a multiply-add is counted as 2 ops).\n2017-12-05 09:53:56.628653: F tensorflow/contrib/lite/toco/tflite/export.cc:192] Unsupported operator: Squeeze\nAborted (core dumped)\nPls help me!\nmy other question is when I download the pretrain freeze pb from https://storage.googleapis.com/download.tensorflow.org/models/tflite/mobilenet_v1_1.0_224_float_2017_11_08.zip\nIt's work when I use toco tools. where I can find guide which generate these freeze pb.\nPls Help!", "body": "Hi,\r\nI build the freeze .pb with the guide at https://github.com/tensorflow/models/tree/master/research/slim \r\nwith the below step:\r\n \r\npython train_image_classifier.py \\\r\n--train_dir /home/ubuntu/train/ \\\r\n--dataset_dir /home/ubuntu/vegetables/ \\\r\n--dataset_name=vegetables \\\r\n--dataset_split_name=train  \\\r\n--num_clones=2 \\\r\n--clone_on_cpu=True \\\r\n--checkpoint_path=/home/ubuntu/check_point/mobilenet_v1_1.0_224.ckpt \\\r\n--max_number_of_steps=10 \\\r\n--checkpoint_exclude_scopes=MobilenetV1/Logits,MobilenetV1/AuxLogits \\\r\n--model_name=mobilenet_v1\r\n\r\n\r\npython tensorflow/python/tools/freeze_graph.py \\\r\n    --input_graph=/home/ubuntu/train/mobilenet_v1_224.pb \\\r\n    --input_checkpoint=/home/ubuntu/check_point/mobilenet_v1_1.0_224.ckpt \\\r\n    --input_binary=true \\\r\n    --output_graph=/home/ubuntu/train/frozen_mobilenet_v1_224.pb \\\r\n    --output_node_names=MobilenetV1/Predictions/Reshape_1\r\n\r\nNOTE: I download mobilenet_v1_1.0_224.ckpt from http://download.tensorflow.org/models/mobilenet_v1_1.0_224_2017_06_14.tar.gz\r\n\r\nBut when I convert to lite mode with \r\n\r\nubuntu@ip-172-31-27-248:~/tensorflow$ bazel-bin/tensorflow/contrib/lite/toco/toco \\\r\n  --input_format=TENSORFLOW_GRAPHDEF \\\r\n   --input_format=TENSORFLOW_GRAPHDEF \\\r\n   --input_file=/home/ubuntu/mobilenet_v1_1.0_224/frozen_mobilenet_v1_224.pb \\\r\n   --output_format=TFLITE \\\r\n   --output_file=/tmp/mobilenet_v1_1.0_224.lite --inference_type=FLOAT \\\r\n   --inference_input_type=FLOAT \\\r\n   --input_arrays=input \\\r\n   --output_arrays=MobilenetV1/Predictions/Reshape_1 --input_shapes=1,224,224,3\r\n \r\n2017-12-05 09:53:56.604720: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before general graph transformations: 336 operators, 502 arrays (0 quantized)\r\n2017-12-05 09:53:56.627922: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After general graph transformations pass 1: 31 operators, 88 arrays (0 quantized)\r\n2017-12-05 09:53:56.628156: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before dequantization graph transformations: 31 operators, 88 arrays (0 quantized)\r\n2017-12-05 09:53:56.628327: I tensorflow/contrib/lite/toco/allocate_transient_arrays.cc:312] Total transient array allocated size: 6422528 bytes, theoretical optimal value: 4816896 bytes.\r\n2017-12-05 09:53:56.628487: I tensorflow/contrib/lite/toco/toco_tooling.cc:268] Estimated count of arithmetic ops: 1.14264 billion (note that a multiply-add is counted as 2 ops).\r\n2017-12-05 09:53:56.628653: F tensorflow/contrib/lite/toco/tflite/export.cc:192] Unsupported operator: Squeeze\r\nAborted (core dumped)\r\n\r\nPls help me! \r\n\r\nmy other question is when I download the pretrain freeze pb from https://storage.googleapis.com/download.tensorflow.org/models/tflite/mobilenet_v1_1.0_224_float_2017_11_08.zip \r\nIt's work when I use toco tools. where I can find guide which generate these freeze pb.\r\n\r\n\r\nPls Help! \r\n\r\n\r\n \r\n\r\n\r\n\r\n\r\n\r\n"}