{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7150", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7150/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7150/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7150/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/7150", "id": 204112322, "node_id": "MDU6SXNzdWUyMDQxMTIzMjI=", "number": 7150, "title": "Quantization:quantize_graph produces corrupted graph", "user": {"login": "bazinac", "id": 19685528, "node_id": "MDQ6VXNlcjE5Njg1NTI4", "avatar_url": "https://avatars0.githubusercontent.com/u/19685528?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bazinac", "html_url": "https://github.com/bazinac", "followers_url": "https://api.github.com/users/bazinac/followers", "following_url": "https://api.github.com/users/bazinac/following{/other_user}", "gists_url": "https://api.github.com/users/bazinac/gists{/gist_id}", "starred_url": "https://api.github.com/users/bazinac/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bazinac/subscriptions", "organizations_url": "https://api.github.com/users/bazinac/orgs", "repos_url": "https://api.github.com/users/bazinac/repos", "events_url": "https://api.github.com/users/bazinac/events{/privacy}", "received_events_url": "https://api.github.com/users/bazinac/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 54, "created_at": "2017-01-30T19:53:40Z", "updated_at": "2017-06-30T09:58:02Z", "closed_at": "2017-02-27T22:45:44Z", "author_association": "NONE", "body_html": "<p>Hi,<br>\nsorry to bother again. In order to save some space I would like to quantize my graph, but everytime I run quantize_graph, it becomes unusable in android app later on. I would like to generally ask, how is this facility meant to be used. What I have done:</p>\n<ol>\n<li>retrained graph (works fine)</li>\n<li>optimized it using optimize_for_inference (works fine)</li>\n<li>bazel-bin/tensorflow/tools/quantization/quantize_graph <br>\n--input=/tmp/optimized.pb <br>\n--output=/tmp/eightbit.pb <br>\n--output_node_names=\"final_result_a,final_result_b\" <br>\n--mode=eightbit</li>\n</ol>\n<p>Then it threws on android following (excerpt):</p>\n<p><code>I/native: tensorflow_inference_jni.cc:85 Creating new session variables for 635cce3c13fa1ff4 I/native: tensorflow_inference_jni.cc:113 Loading Tensorflow. I/native: tensorflow_inference_jni.cc:120 Session created. I/native: tensorflow_inference_jni.cc:126 Acquired AssetManager. I/native: tensorflow_inference_jni.cc:128 Reading file to proto: file:///android_asset/eightbit.pb I/native: jni_utils.cc:111 Opening asset eightbit.pb from disk with zero-copy. I/native: tensorflow_inference_jni.cc:132 GraphDef loaded from file:///android_asset/eightbit.pb with 1345 nodes. I/native: stat_summarizer.cc:38 StatSummarizer found 1345 nodes I/native: tensorflow_inference_jni.cc:139 Creating TensorFlow graph from GraphDef. I/native: tensorflow_inference_jni.cc:151 Initialization done in 234.141ms </code><br>\nWhich I suppose is correct</p>\n<p>But then:</p>\n<p><code>I/native: tensorflow_inference_jni.cc:228 End computing. Ran in 2665ms (2665ms avg over 1 runs) A/libc: Fatal signal 11 (SIGSEGV), code 1, fault addr 0xb95eb000 in tid 31217 (inference) Application terminated.</code><br>\nWould you please once again help? Thanks</p>", "body_text": "Hi,\nsorry to bother again. In order to save some space I would like to quantize my graph, but everytime I run quantize_graph, it becomes unusable in android app later on. I would like to generally ask, how is this facility meant to be used. What I have done:\n\nretrained graph (works fine)\noptimized it using optimize_for_inference (works fine)\nbazel-bin/tensorflow/tools/quantization/quantize_graph \n--input=/tmp/optimized.pb \n--output=/tmp/eightbit.pb \n--output_node_names=\"final_result_a,final_result_b\" \n--mode=eightbit\n\nThen it threws on android following (excerpt):\nI/native: tensorflow_inference_jni.cc:85 Creating new session variables for 635cce3c13fa1ff4 I/native: tensorflow_inference_jni.cc:113 Loading Tensorflow. I/native: tensorflow_inference_jni.cc:120 Session created. I/native: tensorflow_inference_jni.cc:126 Acquired AssetManager. I/native: tensorflow_inference_jni.cc:128 Reading file to proto: file:///android_asset/eightbit.pb I/native: jni_utils.cc:111 Opening asset eightbit.pb from disk with zero-copy. I/native: tensorflow_inference_jni.cc:132 GraphDef loaded from file:///android_asset/eightbit.pb with 1345 nodes. I/native: stat_summarizer.cc:38 StatSummarizer found 1345 nodes I/native: tensorflow_inference_jni.cc:139 Creating TensorFlow graph from GraphDef. I/native: tensorflow_inference_jni.cc:151 Initialization done in 234.141ms \nWhich I suppose is correct\nBut then:\nI/native: tensorflow_inference_jni.cc:228 End computing. Ran in 2665ms (2665ms avg over 1 runs) A/libc: Fatal signal 11 (SIGSEGV), code 1, fault addr 0xb95eb000 in tid 31217 (inference) Application terminated.\nWould you please once again help? Thanks", "body": "Hi,\r\nsorry to bother again. In order to save some space I would like to quantize my graph, but everytime I run quantize_graph, it becomes unusable in android app later on. I would like to generally ask, how is this facility meant to be used. What I have done:\r\n\r\n\r\n1. retrained graph (works fine)\r\n2. optimized it using optimize_for_inference (works fine)\r\n3. bazel-bin/tensorflow/tools/quantization/quantize_graph \\\r\n--input=/tmp/optimized.pb \\\r\n--output=/tmp/eightbit.pb \\\r\n--output_node_names=\"final_result_a,final_result_b\" \\\r\n--mode=eightbit\r\n\r\nThen it threws on android following (excerpt):\r\n\r\n`I/native: tensorflow_inference_jni.cc:85 Creating new session variables for 635cce3c13fa1ff4\r\nI/native: tensorflow_inference_jni.cc:113 Loading Tensorflow.\r\nI/native: tensorflow_inference_jni.cc:120 Session created.\r\nI/native: tensorflow_inference_jni.cc:126 Acquired AssetManager.\r\nI/native: tensorflow_inference_jni.cc:128 Reading file to proto: file:///android_asset/eightbit.pb\r\nI/native: jni_utils.cc:111 Opening asset eightbit.pb from disk with zero-copy.\r\nI/native: tensorflow_inference_jni.cc:132 GraphDef loaded from file:///android_asset/eightbit.pb with 1345 nodes.\r\nI/native: stat_summarizer.cc:38 StatSummarizer found 1345 nodes\r\nI/native: tensorflow_inference_jni.cc:139 Creating TensorFlow graph from GraphDef.\r\nI/native: tensorflow_inference_jni.cc:151 Initialization done in 234.141ms\r\n`\r\nWhich I suppose is correct\r\n\r\nBut then:\r\n\r\n`\r\nI/native: tensorflow_inference_jni.cc:228 End computing. Ran in 2665ms (2665ms avg over 1 runs)\r\nA/libc: Fatal signal 11 (SIGSEGV), code 1, fault addr 0xb95eb000 in tid 31217 (inference)\r\nApplication terminated.\r\n`\r\nWould you please once again help? Thanks\r\n\r\n"}