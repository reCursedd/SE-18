{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/384220177", "html_url": "https://github.com/tensorflow/tensorflow/issues/18317#issuecomment-384220177", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18317", "id": 384220177, "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDIyMDE3Nw==", "user": {"login": "yiheng", "id": 1297418, "node_id": "MDQ6VXNlcjEyOTc0MTg=", "avatar_url": "https://avatars3.githubusercontent.com/u/1297418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yiheng", "html_url": "https://github.com/yiheng", "followers_url": "https://api.github.com/users/yiheng/followers", "following_url": "https://api.github.com/users/yiheng/following{/other_user}", "gists_url": "https://api.github.com/users/yiheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/yiheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yiheng/subscriptions", "organizations_url": "https://api.github.com/users/yiheng/orgs", "repos_url": "https://api.github.com/users/yiheng/repos", "events_url": "https://api.github.com/users/yiheng/events{/privacy}", "received_events_url": "https://api.github.com/users/yiheng/received_events", "type": "User", "site_admin": false}, "created_at": "2018-04-25T09:17:28Z", "updated_at": "2018-04-25T09:17:28Z", "author_association": "NONE", "body_html": "<p>The root cause is when <a href=\"https://github.com/tensorflow/tensorflow/blob/15a9de7763aa736e97d7e636d9487c0dde372d4b/tensorflow/core/kernels/training_ops.cc#L217\">this line</a> or <a href=\"https://github.com/tensorflow/tensorflow/blob/15a9de7763aa736e97d7e636d9487c0dde372d4b/tensorflow/core/kernels/training_ops.cc#L224\">this line</a> update<code>var</code> value, the <code>grad_with_shrinkage</code> is also changed, although it is defined before those lines. So when update accum, the accum_new is not the expected one.</p>\n<p>From <a href=\"https://www.eecs.tufts.edu/~dsculley/papers/ad-click-prediction.pdf\" rel=\"nofollow\">this paper</a>, the <code>accum</code> should be the sum of gradient square in equation (2). So looks like the update of the <code>accum_new</code> is not correct.</p>", "body_text": "The root cause is when this line or this line updatevar value, the grad_with_shrinkage is also changed, although it is defined before those lines. So when update accum, the accum_new is not the expected one.\nFrom this paper, the accum should be the sum of gradient square in equation (2). So looks like the update of the accum_new is not correct.", "body": "The root cause is when [this line](https://github.com/tensorflow/tensorflow/blob/15a9de7763aa736e97d7e636d9487c0dde372d4b/tensorflow/core/kernels/training_ops.cc#L217) or [this line](https://github.com/tensorflow/tensorflow/blob/15a9de7763aa736e97d7e636d9487c0dde372d4b/tensorflow/core/kernels/training_ops.cc#L224) update```var``` value, the ```grad_with_shrinkage``` is also changed, although it is defined before those lines. So when update accum, the accum_new is not the expected one.\r\n\r\nFrom [this paper](https://www.eecs.tufts.edu/~dsculley/papers/ad-click-prediction.pdf), the ```accum``` should be the sum of gradient square in equation (2). So looks like the update of the ```accum_new``` is not correct.\r\n"}