{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/239658192", "html_url": "https://github.com/tensorflow/tensorflow/issues/3800#issuecomment-239658192", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3800", "id": 239658192, "node_id": "MDEyOklzc3VlQ29tbWVudDIzOTY1ODE5Mg==", "user": {"login": "sahiliitm", "id": 5723372, "node_id": "MDQ6VXNlcjU3MjMzNzI=", "avatar_url": "https://avatars0.githubusercontent.com/u/5723372?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sahiliitm", "html_url": "https://github.com/sahiliitm", "followers_url": "https://api.github.com/users/sahiliitm/followers", "following_url": "https://api.github.com/users/sahiliitm/following{/other_user}", "gists_url": "https://api.github.com/users/sahiliitm/gists{/gist_id}", "starred_url": "https://api.github.com/users/sahiliitm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sahiliitm/subscriptions", "organizations_url": "https://api.github.com/users/sahiliitm/orgs", "repos_url": "https://api.github.com/users/sahiliitm/repos", "events_url": "https://api.github.com/users/sahiliitm/events{/privacy}", "received_events_url": "https://api.github.com/users/sahiliitm/received_events", "type": "User", "site_admin": false}, "created_at": "2016-08-14T06:18:53Z", "updated_at": "2016-08-14T06:52:50Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Another thing I've noticed is that this problem only arises when the <code>forward_only</code> parameter in the <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/models/rnn/translate/seq2seq_model.py#L58\">constructor</a> of Seq2Seq_model is set.<br>\nTo verify this:</p>\n<ol>\n<li>add the code</li>\n</ol>\n<pre><code>print(output_logits[0].shape)\n</code></pre>\n<p>after <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/models/rnn/translate/translate.py#L248\">this line</a> in translate.py</p>\n<ol start=\"2\">\n<li>Next run the code as <code>python translate.py --decode</code> twice.<br>\n2.1) In the first run, set the second argument in <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/models/rnn/translate/translate.py#L222\">this line</a> to <code>True</code> as in the original case. In this case the output of our print statement is:</li>\n</ol>\n<pre><code>(1, 40000)\n</code></pre>\n<p>2.2 In the second run, set the second argument in <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/models/rnn/translate/translate.py#L222\">this line</a> to <code>False</code>. This mimics  training. In this case the output of our print statement is:</p>\n<pre><code>(1, 1024)\n</code></pre>\n<p>EDIT:<br>\nI think I found the source of this problem. The <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/models/rnn/translate/seq2seq_model.py#L161\">TF  operations</a> for converting from dense-representation to probability distribution over output tokens are only added when <code>forward_only</code> is set. This seems reasonable given that we do not wish to do extra operations during training time. However, this would be necessary to track other performance measures such as BLEU score, which give a better evaluation of the translation model.</p>\n<p>In any case, I think the <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/seq2seq.py#L1086\">documentation</a> has to be changed to reflect that what model_with_buckets returns is a dense representation and not a probability distribution over the sparse one. I'll probably submit a PR with documentation updated.</p>", "body_text": "Another thing I've noticed is that this problem only arises when the forward_only parameter in the constructor of Seq2Seq_model is set.\nTo verify this:\n\nadd the code\n\nprint(output_logits[0].shape)\n\nafter this line in translate.py\n\nNext run the code as python translate.py --decode twice.\n2.1) In the first run, set the second argument in this line to True as in the original case. In this case the output of our print statement is:\n\n(1, 40000)\n\n2.2 In the second run, set the second argument in this line to False. This mimics  training. In this case the output of our print statement is:\n(1, 1024)\n\nEDIT:\nI think I found the source of this problem. The TF  operations for converting from dense-representation to probability distribution over output tokens are only added when forward_only is set. This seems reasonable given that we do not wish to do extra operations during training time. However, this would be necessary to track other performance measures such as BLEU score, which give a better evaluation of the translation model.\nIn any case, I think the documentation has to be changed to reflect that what model_with_buckets returns is a dense representation and not a probability distribution over the sparse one. I'll probably submit a PR with documentation updated.", "body": "Another thing I've noticed is that this problem only arises when the `forward_only` parameter in the [constructor](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/models/rnn/translate/seq2seq_model.py#L58) of Seq2Seq_model is set. \nTo verify this:\n1) add the code\n\n```\nprint(output_logits[0].shape)\n```\n\nafter [this line](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/models/rnn/translate/translate.py#L248) in translate.py\n\n2) Next run the code as `python translate.py --decode` twice. \n2.1) In the first run, set the second argument in [this line](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/models/rnn/translate/translate.py#L222) to `True` as in the original case. In this case the output of our print statement is:\n\n```\n(1, 40000)\n```\n\n2.2 In the second run, set the second argument in [this line](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/models/rnn/translate/translate.py#L222) to `False`. This mimics  training. In this case the output of our print statement is:\n\n```\n(1, 1024)\n```\n\nEDIT:\nI think I found the source of this problem. The [TF  operations](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/models/rnn/translate/seq2seq_model.py#L161) for converting from dense-representation to probability distribution over output tokens are only added when `forward_only` is set. This seems reasonable given that we do not wish to do extra operations during training time. However, this would be necessary to track other performance measures such as BLEU score, which give a better evaluation of the translation model.\n\nIn any case, I think the [documentation](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/seq2seq.py#L1086) has to be changed to reflect that what model_with_buckets returns is a dense representation and not a probability distribution over the sparse one. I'll probably submit a PR with documentation updated. \n"}