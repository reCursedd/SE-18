{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2626", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2626/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2626/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2626/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/2626", "id": 158230114, "node_id": "MDU6SXNzdWUxNTgyMzAxMTQ=", "number": 2626, "title": "Profiling: libcupti.so cannot be loaded", "user": {"login": "wookayin", "id": 1009873, "node_id": "MDQ6VXNlcjEwMDk4NzM=", "avatar_url": "https://avatars3.githubusercontent.com/u/1009873?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wookayin", "html_url": "https://github.com/wookayin", "followers_url": "https://api.github.com/users/wookayin/followers", "following_url": "https://api.github.com/users/wookayin/following{/other_user}", "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}", "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions", "organizations_url": "https://api.github.com/users/wookayin/orgs", "repos_url": "https://api.github.com/users/wookayin/repos", "events_url": "https://api.github.com/users/wookayin/events{/privacy}", "received_events_url": "https://api.github.com/users/wookayin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 20, "created_at": "2016-06-02T20:18:12Z", "updated_at": "2018-03-19T03:14:17Z", "closed_at": "2016-06-20T16:37:20Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>Environment info</h3>\n<p>Operating System: Linux Ubuntu 14.04 LTS (64bit)</p>\n<p>Installed version of CUDA and cuDNN: CUDA 7.5.18 and CUDNN 4.0.7<br>\n(please attach the output of <code>ls -l /path/to/cuda/lib/libcud*</code>):</p>\n<pre><code>\u276f\u276f\u276f ls -l /usr/local/cuda-7.5/lib/libcud*\n-rw----r-- 1 root root 189170  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib/libcudadevrt.a\nlrwxrwxrwx 1 root root     16  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib/libcudart.so -&gt; libcudart.so.7.5\nlrwxrwxrwx 1 root root     19  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib/libcudart.so.7.5 -&gt; libcudart.so.7.5.18\n-rwx---r-x 1 root root 311596  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib/libcudart.so.7.5.18\n-rw----r-- 1 root root 558020  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib/libcudart_static.a\n</code></pre>\n<pre><code>\u276f\u276f\u276f ls -l /usr/local/cuda-7.5/lib64/libcud*\n-rw----r-- 1 root root   322936  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib64/libcudadevrt.a\nlrwxrwxrwx 1 root root       16  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib64/libcudart.so -&gt; libcudart.so.7.5\nlrwxrwxrwx 1 root root       19  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib64/libcudart.so.7.5 -&gt; libcudart.so.7.5.18\n-rwx---r-x 1 root root   383336  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib64/libcudart.so.7.5.18\n-rw----r-- 1 root root   720192  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib64/libcudart_static.a\nlrwxrwxrwx 1 root root       13  3\uc6d4  3 03:30 /usr/local/cuda-7.5/lib64/libcudnn.so -&gt; libcudnn.so.4\nlrwxrwxrwx 1 root root       17  3\uc6d4  3 03:30 /usr/local/cuda-7.5/lib64/libcudnn.so.4 -&gt; libcudnn.so.4.0.7\n-rwxr-xr-x 1 root root 61453024  3\uc6d4  3 03:30 /usr/local/cuda-7.5/lib64/libcudnn.so.4.0.7\n</code></pre>\n<p>If installed from binary pip package, provide:</p>\n<ol>\n<li>Which pip package you installed : <strong>Tensorflow 0.8.0 Nightly</strong> Python2.7 Linux (GPU) e.g. <a href=\"http://ci.tensorflow.org/view/Nightly/job/nigntly-matrix-linux-gpu/TF_BUILD_CONTAINER_TYPE=GPU,TF_BUILD_IS_OPT=OPT,TF_BUILD_IS_PIP=PIP,TF_BUILD_PYTHON_VERSION=PYTHON2,label=gpu-linux/118/\" rel=\"nofollow\">Build 118</a></li>\n<li>The output from python -c \"import tensorflow; print(tensorflow.<strong>version</strong>)\". : 0.8.0</li>\n</ol>\n<p>If installed from sources, provide the commit hash:</p>\n<h3>Steps to reproduce</h3>\n<p>Although it is experimental, I am using the GPU profiling functionality with CUPTI.</p>\n<ol>\n<li>Run any tensorflow code that uses CUPTI or <code>tf.RunOptions.FULL_TRACE</code>.</li>\n<li>The following error (segfault) occurs.</li>\n</ol>\n<pre><code>I tensorflow/stream_executor/dso_loader.cc:102] Couldn't open CUDA library libcupti.so. LD_LIBRARY_PATH:\nF tensorflow/core/common_runtime/gpu/cupti_wrapper.cc:57] Check failed: f != nullptr could not find cuptiActivityRegisterCallbacksin libcupti DSO; dlerror: /home/wookayin/.virtualenvs/tfdebug/local/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so: undefined symbol: cuptiActivityRegisterCallbacks\n[1]    82604 abort (core dumped)  python 19-mnist-profiling.py\n</code></pre>\n<p>Any TF code that invokes loading of <code>libcupti.so</code> will face the same error, but for convenience I will share a code that can run standalone: <a href=\"https://gist.github.com/wookayin/06631c68bb48fc1d0a4eee77cbbba5f1\">19-mnist-profiling.py</a></p>\n<h3>What have you tried?</h3>\n<p>The problem is that the shared library <code>libcupti.so</code> cannot be loaded. However, in some older nightly version (such as <a href=\"http://ci.tensorflow.org/view/Nightly/job/nigntly-matrix-linux-gpu/TF_BUILD_CONTAINER_TYPE=GPU,TF_BUILD_IS_OPT=OPT,TF_BUILD_IS_PIP=PIP,TF_BUILD_PYTHON_VERSION=PYTHON2,label=gpu-linux/103/\" rel=\"nofollow\">Build 103</a>) it worked.</p>\n<p>UPD: I binary-searched to find the changeset to be blamed. Build 103 works, but <a href=\"http://ci.tensorflow.org/view/Nightly/job/nigntly-matrix-linux-gpu/TF_BUILD_CONTAINER_TYPE=GPU,TF_BUILD_IS_OPT=OPT,TF_BUILD_IS_PIP=PIP,TF_BUILD_PYTHON_VERSION=PYTHON2,label=gpu-linux/104/\" rel=\"nofollow\">Build 104</a> (Failed) and <a href=\"http://ci.tensorflow.org/view/Nightly/job/nigntly-matrix-linux-gpu/TF_BUILD_CONTAINER_TYPE=GPU,TF_BUILD_IS_OPT=OPT,TF_BUILD_IS_PIP=PIP,TF_BUILD_PYTHON_VERSION=PYTHON2,label=gpu-linux/105/\" rel=\"nofollow\">Build 105</a> does not work.<br>\nI highly suspect that this regression is since commit <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/6bd964c1717dca18c938f2dd9845864f103a7cdf/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/6bd964c1717dca18c938f2dd9845864f103a7cdf\"><tt>6bd964c</tt></a> (but not sure):</p>\n<ul>\n<li>The path to <code>libcupti.so</code> would be <code>/usr/local/cuda/extras/CUPTI/lib64/libcupti.so</code>.</li>\n<li>After this commit, it seems that path to <code>libcupti.so</code> goes wrong. (but why?)</li>\n</ul>\n<p>A strange thing to me is that tensorflow already has <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/client/timeline_test.py\">a unit test</a> for CUPTI and GPU tracing functionalities, so CI must have run this test as well. This bug might be happening in some environments only (like nightly build I installed via <code>pip</code>), or it can be a a bazel-related problem (when generating packages).</p>\n<p>I have not investigated into this problem in detail; it looks that after some troubleshooting I can figure out what the cause is.</p>\n<p>Thanks!</p>\n<h3>Logs or other output that would be helpful</h3>\n<p>N/A</p>", "body_text": "Environment info\nOperating System: Linux Ubuntu 14.04 LTS (64bit)\nInstalled version of CUDA and cuDNN: CUDA 7.5.18 and CUDNN 4.0.7\n(please attach the output of ls -l /path/to/cuda/lib/libcud*):\n\u276f\u276f\u276f ls -l /usr/local/cuda-7.5/lib/libcud*\n-rw----r-- 1 root root 189170  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib/libcudadevrt.a\nlrwxrwxrwx 1 root root     16  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib/libcudart.so -> libcudart.so.7.5\nlrwxrwxrwx 1 root root     19  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib/libcudart.so.7.5 -> libcudart.so.7.5.18\n-rwx---r-x 1 root root 311596  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib/libcudart.so.7.5.18\n-rw----r-- 1 root root 558020  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib/libcudart_static.a\n\n\u276f\u276f\u276f ls -l /usr/local/cuda-7.5/lib64/libcud*\n-rw----r-- 1 root root   322936  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib64/libcudadevrt.a\nlrwxrwxrwx 1 root root       16  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib64/libcudart.so -> libcudart.so.7.5\nlrwxrwxrwx 1 root root       19  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib64/libcudart.so.7.5 -> libcudart.so.7.5.18\n-rwx---r-x 1 root root   383336  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib64/libcudart.so.7.5.18\n-rw----r-- 1 root root   720192  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib64/libcudart_static.a\nlrwxrwxrwx 1 root root       13  3\uc6d4  3 03:30 /usr/local/cuda-7.5/lib64/libcudnn.so -> libcudnn.so.4\nlrwxrwxrwx 1 root root       17  3\uc6d4  3 03:30 /usr/local/cuda-7.5/lib64/libcudnn.so.4 -> libcudnn.so.4.0.7\n-rwxr-xr-x 1 root root 61453024  3\uc6d4  3 03:30 /usr/local/cuda-7.5/lib64/libcudnn.so.4.0.7\n\nIf installed from binary pip package, provide:\n\nWhich pip package you installed : Tensorflow 0.8.0 Nightly Python2.7 Linux (GPU) e.g. Build 118\nThe output from python -c \"import tensorflow; print(tensorflow.version)\". : 0.8.0\n\nIf installed from sources, provide the commit hash:\nSteps to reproduce\nAlthough it is experimental, I am using the GPU profiling functionality with CUPTI.\n\nRun any tensorflow code that uses CUPTI or tf.RunOptions.FULL_TRACE.\nThe following error (segfault) occurs.\n\nI tensorflow/stream_executor/dso_loader.cc:102] Couldn't open CUDA library libcupti.so. LD_LIBRARY_PATH:\nF tensorflow/core/common_runtime/gpu/cupti_wrapper.cc:57] Check failed: f != nullptr could not find cuptiActivityRegisterCallbacksin libcupti DSO; dlerror: /home/wookayin/.virtualenvs/tfdebug/local/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so: undefined symbol: cuptiActivityRegisterCallbacks\n[1]    82604 abort (core dumped)  python 19-mnist-profiling.py\n\nAny TF code that invokes loading of libcupti.so will face the same error, but for convenience I will share a code that can run standalone: 19-mnist-profiling.py\nWhat have you tried?\nThe problem is that the shared library libcupti.so cannot be loaded. However, in some older nightly version (such as Build 103) it worked.\nUPD: I binary-searched to find the changeset to be blamed. Build 103 works, but Build 104 (Failed) and Build 105 does not work.\nI highly suspect that this regression is since commit 6bd964c (but not sure):\n\nThe path to libcupti.so would be /usr/local/cuda/extras/CUPTI/lib64/libcupti.so.\nAfter this commit, it seems that path to libcupti.so goes wrong. (but why?)\n\nA strange thing to me is that tensorflow already has a unit test for CUPTI and GPU tracing functionalities, so CI must have run this test as well. This bug might be happening in some environments only (like nightly build I installed via pip), or it can be a a bazel-related problem (when generating packages).\nI have not investigated into this problem in detail; it looks that after some troubleshooting I can figure out what the cause is.\nThanks!\nLogs or other output that would be helpful\nN/A", "body": "### Environment info\n\nOperating System: Linux Ubuntu 14.04 LTS (64bit)\n\nInstalled version of CUDA and cuDNN: CUDA 7.5.18 and CUDNN 4.0.7\n(please attach the output of `ls -l /path/to/cuda/lib/libcud*`):\n\n```\n\u276f\u276f\u276f ls -l /usr/local/cuda-7.5/lib/libcud*\n-rw----r-- 1 root root 189170  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib/libcudadevrt.a\nlrwxrwxrwx 1 root root     16  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib/libcudart.so -> libcudart.so.7.5\nlrwxrwxrwx 1 root root     19  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib/libcudart.so.7.5 -> libcudart.so.7.5.18\n-rwx---r-x 1 root root 311596  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib/libcudart.so.7.5.18\n-rw----r-- 1 root root 558020  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib/libcudart_static.a\n```\n\n```\n\u276f\u276f\u276f ls -l /usr/local/cuda-7.5/lib64/libcud*\n-rw----r-- 1 root root   322936  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib64/libcudadevrt.a\nlrwxrwxrwx 1 root root       16  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib64/libcudart.so -> libcudart.so.7.5\nlrwxrwxrwx 1 root root       19  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib64/libcudart.so.7.5 -> libcudart.so.7.5.18\n-rwx---r-x 1 root root   383336  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib64/libcudart.so.7.5.18\n-rw----r-- 1 root root   720192  2\uc6d4 24 18:12 /usr/local/cuda-7.5/lib64/libcudart_static.a\nlrwxrwxrwx 1 root root       13  3\uc6d4  3 03:30 /usr/local/cuda-7.5/lib64/libcudnn.so -> libcudnn.so.4\nlrwxrwxrwx 1 root root       17  3\uc6d4  3 03:30 /usr/local/cuda-7.5/lib64/libcudnn.so.4 -> libcudnn.so.4.0.7\n-rwxr-xr-x 1 root root 61453024  3\uc6d4  3 03:30 /usr/local/cuda-7.5/lib64/libcudnn.so.4.0.7\n```\n\nIf installed from binary pip package, provide:\n1. Which pip package you installed : **Tensorflow 0.8.0 Nightly** Python2.7 Linux (GPU) e.g. [Build 118](http://ci.tensorflow.org/view/Nightly/job/nigntly-matrix-linux-gpu/TF_BUILD_CONTAINER_TYPE=GPU,TF_BUILD_IS_OPT=OPT,TF_BUILD_IS_PIP=PIP,TF_BUILD_PYTHON_VERSION=PYTHON2,label=gpu-linux/118/)\n2. The output from python -c \"import tensorflow; print(tensorflow.**version**)\". : 0.8.0\n\nIf installed from sources, provide the commit hash:\n### Steps to reproduce\n\nAlthough it is experimental, I am using the GPU profiling functionality with CUPTI. \n1. Run any tensorflow code that uses CUPTI or `tf.RunOptions.FULL_TRACE`.\n2. The following error (segfault) occurs.\n\n```\nI tensorflow/stream_executor/dso_loader.cc:102] Couldn't open CUDA library libcupti.so. LD_LIBRARY_PATH:\nF tensorflow/core/common_runtime/gpu/cupti_wrapper.cc:57] Check failed: f != nullptr could not find cuptiActivityRegisterCallbacksin libcupti DSO; dlerror: /home/wookayin/.virtualenvs/tfdebug/local/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so: undefined symbol: cuptiActivityRegisterCallbacks\n[1]    82604 abort (core dumped)  python 19-mnist-profiling.py\n```\n\nAny TF code that invokes loading of `libcupti.so` will face the same error, but for convenience I will share a code that can run standalone: [19-mnist-profiling.py](https://gist.github.com/wookayin/06631c68bb48fc1d0a4eee77cbbba5f1)\n### What have you tried?\n\nThe problem is that the shared library `libcupti.so` cannot be loaded. However, in some older nightly version (such as [Build 103](http://ci.tensorflow.org/view/Nightly/job/nigntly-matrix-linux-gpu/TF_BUILD_CONTAINER_TYPE=GPU,TF_BUILD_IS_OPT=OPT,TF_BUILD_IS_PIP=PIP,TF_BUILD_PYTHON_VERSION=PYTHON2,label=gpu-linux/103/)) it worked.\n\nUPD: I binary-searched to find the changeset to be blamed. Build 103 works, but [Build 104](http://ci.tensorflow.org/view/Nightly/job/nigntly-matrix-linux-gpu/TF_BUILD_CONTAINER_TYPE=GPU,TF_BUILD_IS_OPT=OPT,TF_BUILD_IS_PIP=PIP,TF_BUILD_PYTHON_VERSION=PYTHON2,label=gpu-linux/104/) (Failed) and [Build 105](http://ci.tensorflow.org/view/Nightly/job/nigntly-matrix-linux-gpu/TF_BUILD_CONTAINER_TYPE=GPU,TF_BUILD_IS_OPT=OPT,TF_BUILD_IS_PIP=PIP,TF_BUILD_PYTHON_VERSION=PYTHON2,label=gpu-linux/105/) does not work.\nI highly suspect that this regression is since commit 6bd964c (but not sure):\n- The path to `libcupti.so` would be `/usr/local/cuda/extras/CUPTI/lib64/libcupti.so`.\n- After this commit, it seems that path to `libcupti.so` goes wrong. (but why?)\n\nA strange thing to me is that tensorflow already has [a unit test](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/client/timeline_test.py) for CUPTI and GPU tracing functionalities, so CI must have run this test as well. This bug might be happening in some environments only (like nightly build I installed via `pip`), or it can be a a bazel-related problem (when generating packages).\n\nI have not investigated into this problem in detail; it looks that after some troubleshooting I can figure out what the cause is.\n\nThanks!\n### Logs or other output that would be helpful\n\nN/A\n"}