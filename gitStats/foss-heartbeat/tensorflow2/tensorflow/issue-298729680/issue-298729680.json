{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17156", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17156/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17156/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17156/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/17156", "id": 298729680, "node_id": "MDU6SXNzdWUyOTg3Mjk2ODA=", "number": 17156, "title": "LookupError: gradient registry has no entry for: Svd", "user": {"login": "nbansal90", "id": 12581965, "node_id": "MDQ6VXNlcjEyNTgxOTY1", "avatar_url": "https://avatars2.githubusercontent.com/u/12581965?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nbansal90", "html_url": "https://github.com/nbansal90", "followers_url": "https://api.github.com/users/nbansal90/followers", "following_url": "https://api.github.com/users/nbansal90/following{/other_user}", "gists_url": "https://api.github.com/users/nbansal90/gists{/gist_id}", "starred_url": "https://api.github.com/users/nbansal90/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nbansal90/subscriptions", "organizations_url": "https://api.github.com/users/nbansal90/orgs", "repos_url": "https://api.github.com/users/nbansal90/repos", "events_url": "https://api.github.com/users/nbansal90/events{/privacy}", "received_events_url": "https://api.github.com/users/nbansal90/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}, {"id": 473184161, "node_id": "MDU6TGFiZWw0NzMxODQxNjE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:support", "name": "type:support", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-02-20T20:03:32Z", "updated_at": "2018-03-09T00:35:08Z", "closed_at": "2018-03-09T00:35:08Z", "author_association": "NONE", "body_html": "<p>Hello All,</p>\n<p>I am using singular values of the weights at each convolution layer as a regularizer and adding it in kernel_regularizer=self.l2_reg(). Where l2_reg is the function which return that.</p>\n<pre><code>\n        def l2_reg(weights):\n                \"\"\" Reshaping the matrxi in to 2D tensor for enforcing orthogonality\"\"\"\n                w = tf.identity(weights)\n\n                \"\"\"Calculating the Loss Obtained\"\"\"\n                s1 = tf.linalg.svd(reg, full_matrices=True,compute_uv=False)\n                ortho_loss = tf.nn.l2_loss(s1)\n                return ortho_loss\n</code></pre>\n<p>Error I am getting is:</p>\n<pre><code>raceback (most recent call last):\n  File \"/usr/local/keras-python3/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 551, in gradients\n    grad_fn = ops.get_gradient_function(op)\n  File \"/usr/local/keras-python3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2134, in get_gradient_function\n    return _gradient_registry.lookup(op_type)\n  File \"/usr/local/keras-python3/lib/python3.5/site-packages/tensorflow/python/framework/registry.py\", line 93, in lookup\n    \"%s registry has no entry for: %s\" % (self._name, name))\nLookupError: gradient registry has no entry for: Svd\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"run_dense_net.py\", line 142, in &lt;module&gt;\n    model = DenseNet(data_provider=data_provider, **model_params)\n  File \"/home/bansa01/densenet_final/tmp_spectral/models/dense_net.py\", line 85, in __init__\n    self._build_graph()\n  File \"/home/bansa01/densenet_final/tmp_spectral/models/dense_net.py\", line 461, in _build_graph\n    cross_entropy + l2_loss_total + reg_loss_total)\n  File \"/usr/local/keras-python3/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 343, in minimize\n    grad_loss=grad_loss)\n  File \"/usr/local/keras-python3/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 414, in compute_gradients\n    colocate_gradients_with_ops=colocate_gradients_with_ops)\n  File \"/usr/local/keras-python3/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 555, in gradients\n    (op.name, op.type))\nLookupError: No gradient defined for operation 'Initial_convolution/conv2d/kernel/Regularizer/Svd' (op type: Svd)\n</code></pre>\n<p>I Understand that this is due to not able to calculate the gradient for SVD operation, but then how do I remove this issue.<br>\nNitin</p>", "body_text": "Hello All,\nI am using singular values of the weights at each convolution layer as a regularizer and adding it in kernel_regularizer=self.l2_reg(). Where l2_reg is the function which return that.\n\n        def l2_reg(weights):\n                \"\"\" Reshaping the matrxi in to 2D tensor for enforcing orthogonality\"\"\"\n                w = tf.identity(weights)\n\n                \"\"\"Calculating the Loss Obtained\"\"\"\n                s1 = tf.linalg.svd(reg, full_matrices=True,compute_uv=False)\n                ortho_loss = tf.nn.l2_loss(s1)\n                return ortho_loss\n\nError I am getting is:\nraceback (most recent call last):\n  File \"/usr/local/keras-python3/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 551, in gradients\n    grad_fn = ops.get_gradient_function(op)\n  File \"/usr/local/keras-python3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2134, in get_gradient_function\n    return _gradient_registry.lookup(op_type)\n  File \"/usr/local/keras-python3/lib/python3.5/site-packages/tensorflow/python/framework/registry.py\", line 93, in lookup\n    \"%s registry has no entry for: %s\" % (self._name, name))\nLookupError: gradient registry has no entry for: Svd\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"run_dense_net.py\", line 142, in <module>\n    model = DenseNet(data_provider=data_provider, **model_params)\n  File \"/home/bansa01/densenet_final/tmp_spectral/models/dense_net.py\", line 85, in __init__\n    self._build_graph()\n  File \"/home/bansa01/densenet_final/tmp_spectral/models/dense_net.py\", line 461, in _build_graph\n    cross_entropy + l2_loss_total + reg_loss_total)\n  File \"/usr/local/keras-python3/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 343, in minimize\n    grad_loss=grad_loss)\n  File \"/usr/local/keras-python3/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 414, in compute_gradients\n    colocate_gradients_with_ops=colocate_gradients_with_ops)\n  File \"/usr/local/keras-python3/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 555, in gradients\n    (op.name, op.type))\nLookupError: No gradient defined for operation 'Initial_convolution/conv2d/kernel/Regularizer/Svd' (op type: Svd)\n\nI Understand that this is due to not able to calculate the gradient for SVD operation, but then how do I remove this issue.\nNitin", "body": " Hello All,\r\n\r\nI am using singular values of the weights at each convolution layer as a regularizer and adding it in kernel_regularizer=self.l2_reg(). Where l2_reg is the function which return that.\r\n```\r\n\r\n        def l2_reg(weights):\r\n                \"\"\" Reshaping the matrxi in to 2D tensor for enforcing orthogonality\"\"\"\r\n                w = tf.identity(weights)\r\n\r\n                \"\"\"Calculating the Loss Obtained\"\"\"\r\n                s1 = tf.linalg.svd(reg, full_matrices=True,compute_uv=False)\r\n                ortho_loss = tf.nn.l2_loss(s1)\r\n                return ortho_loss\r\n```\r\nError I am getting is:\r\n```\r\nraceback (most recent call last):\r\n  File \"/usr/local/keras-python3/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 551, in gradients\r\n    grad_fn = ops.get_gradient_function(op)\r\n  File \"/usr/local/keras-python3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2134, in get_gradient_function\r\n    return _gradient_registry.lookup(op_type)\r\n  File \"/usr/local/keras-python3/lib/python3.5/site-packages/tensorflow/python/framework/registry.py\", line 93, in lookup\r\n    \"%s registry has no entry for: %s\" % (self._name, name))\r\nLookupError: gradient registry has no entry for: Svd\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"run_dense_net.py\", line 142, in <module>\r\n    model = DenseNet(data_provider=data_provider, **model_params)\r\n  File \"/home/bansa01/densenet_final/tmp_spectral/models/dense_net.py\", line 85, in __init__\r\n    self._build_graph()\r\n  File \"/home/bansa01/densenet_final/tmp_spectral/models/dense_net.py\", line 461, in _build_graph\r\n    cross_entropy + l2_loss_total + reg_loss_total)\r\n  File \"/usr/local/keras-python3/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 343, in minimize\r\n    grad_loss=grad_loss)\r\n  File \"/usr/local/keras-python3/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 414, in compute_gradients\r\n    colocate_gradients_with_ops=colocate_gradients_with_ops)\r\n  File \"/usr/local/keras-python3/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 555, in gradients\r\n    (op.name, op.type))\r\nLookupError: No gradient defined for operation 'Initial_convolution/conv2d/kernel/Regularizer/Svd' (op type: Svd)\r\n```\r\nI Understand that this is due to not able to calculate the gradient for SVD operation, but then how do I remove this issue.\r\nNitin"}