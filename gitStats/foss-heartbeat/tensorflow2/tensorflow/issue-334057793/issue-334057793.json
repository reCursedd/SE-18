{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20146", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20146/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20146/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20146/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/20146", "id": 334057793, "node_id": "MDU6SXNzdWUzMzQwNTc3OTM=", "number": 20146, "title": "tf.extract_image_patches() gradient very slow at graph construction time", "user": {"login": "dbbert", "id": 3367974, "node_id": "MDQ6VXNlcjMzNjc5NzQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/3367974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dbbert", "html_url": "https://github.com/dbbert", "followers_url": "https://api.github.com/users/dbbert/followers", "following_url": "https://api.github.com/users/dbbert/following{/other_user}", "gists_url": "https://api.github.com/users/dbbert/gists{/gist_id}", "starred_url": "https://api.github.com/users/dbbert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dbbert/subscriptions", "organizations_url": "https://api.github.com/users/dbbert/orgs", "repos_url": "https://api.github.com/users/dbbert/repos", "events_url": "https://api.github.com/users/dbbert/events{/privacy}", "received_events_url": "https://api.github.com/users/dbbert/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 9, "created_at": "2018-06-20T12:37:50Z", "updated_at": "2018-08-25T00:00:57Z", "closed_at": "2018-08-25T00:00:57Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code</strong>: yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Linux Fedora 28</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: v1.8.0-1-g8753e2e</li>\n<li><strong>Python version</strong>: 3.5</li>\n<li><strong>Bazel version</strong>: N/A</li>\n<li><strong>CUDA/cuDNN version</strong>: N/A</li>\n<li><strong>GPU model and memory</strong>: N/A</li>\n<li><strong>Exact command to reproduce</strong>: see below</li>\n</ul>\n<h3>Problem</h3>\n<p>When building the graph, taking the gradient with respect to the input of <code>tf.extract_image_patches</code> is unusually slow (see minimal example below, where it takes ~2min).</p>\n<h3>How to reproduce</h3>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\ntf.reset_default_graph()\n\nbatch_size <span class=\"pl-k\">=</span> <span class=\"pl-c1\">4</span>\nheight <span class=\"pl-k\">=</span> width <span class=\"pl-k\">=</span> <span class=\"pl-c1\">1024</span>\nksize <span class=\"pl-k\">=</span> <span class=\"pl-c1\">5</span>\n\ninputs <span class=\"pl-k\">=</span> tf.get_variable(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>inputs<span class=\"pl-pds\">'</span></span>, (batch_size, height, width, <span class=\"pl-c1\">1</span>))\npatches <span class=\"pl-k\">=</span> tf.extract_image_patches(inputs, \n                                   <span class=\"pl-v\">ksizes</span><span class=\"pl-k\">=</span>[<span class=\"pl-c1\">1</span>,ksize,ksize,<span class=\"pl-c1\">1</span>], \n                                   <span class=\"pl-v\">strides</span><span class=\"pl-k\">=</span>[<span class=\"pl-c1\">1</span>,<span class=\"pl-c1\">1</span>,<span class=\"pl-c1\">1</span>,<span class=\"pl-c1\">1</span>], \n                                   <span class=\"pl-v\">rates</span><span class=\"pl-k\">=</span>[<span class=\"pl-c1\">1</span>,<span class=\"pl-c1\">1</span>,<span class=\"pl-c1\">1</span>,<span class=\"pl-c1\">1</span>], \n                                   <span class=\"pl-v\">padding</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>SAME<span class=\"pl-pds\">'</span></span>)\n<span class=\"pl-c1\">print</span>(patches.shape)\n<span class=\"pl-k\">%</span>time gradients <span class=\"pl-k\">=</span> tf.gradients(patches, inputs)</pre></div>\n<p>Result:</p>\n<pre><code>(4, 1024, 1024, 25)\nCPU times: user 1min 42s, sys: 2.07 s, total: 1min 44s\nWall time: 1min 44s\n</code></pre>", "body_text": "System information\n\nHave I written custom code: yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Fedora 28\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below): v1.8.0-1-g8753e2e\nPython version: 3.5\nBazel version: N/A\nCUDA/cuDNN version: N/A\nGPU model and memory: N/A\nExact command to reproduce: see below\n\nProblem\nWhen building the graph, taking the gradient with respect to the input of tf.extract_image_patches is unusually slow (see minimal example below, where it takes ~2min).\nHow to reproduce\nimport tensorflow as tf\n\ntf.reset_default_graph()\n\nbatch_size = 4\nheight = width = 1024\nksize = 5\n\ninputs = tf.get_variable('inputs', (batch_size, height, width, 1))\npatches = tf.extract_image_patches(inputs, \n                                   ksizes=[1,ksize,ksize,1], \n                                   strides=[1,1,1,1], \n                                   rates=[1,1,1,1], \n                                   padding='SAME')\nprint(patches.shape)\n%time gradients = tf.gradients(patches, inputs)\nResult:\n(4, 1024, 1024, 25)\nCPU times: user 1min 42s, sys: 2.07 s, total: 1min 44s\nWall time: 1min 44s", "body": "### System information\r\n- **Have I written custom code**: yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Fedora 28\r\n- **TensorFlow installed from (source or binary)**: binary\r\n- **TensorFlow version (use command below)**: v1.8.0-1-g8753e2e\r\n- **Python version**: 3.5\r\n- **Bazel version**: N/A\r\n- **CUDA/cuDNN version**: N/A\r\n- **GPU model and memory**: N/A\r\n- **Exact command to reproduce**: see below\r\n\r\n### Problem\r\nWhen building the graph, taking the gradient with respect to the input of `tf.extract_image_patches` is unusually slow (see minimal example below, where it takes ~2min). \r\n\r\n### How to reproduce\r\n```python\r\nimport tensorflow as tf\r\n\r\ntf.reset_default_graph()\r\n\r\nbatch_size = 4\r\nheight = width = 1024\r\nksize = 5\r\n\r\ninputs = tf.get_variable('inputs', (batch_size, height, width, 1))\r\npatches = tf.extract_image_patches(inputs, \r\n                                   ksizes=[1,ksize,ksize,1], \r\n                                   strides=[1,1,1,1], \r\n                                   rates=[1,1,1,1], \r\n                                   padding='SAME')\r\nprint(patches.shape)\r\n%time gradients = tf.gradients(patches, inputs)\r\n```\r\nResult:\r\n```\r\n(4, 1024, 1024, 25)\r\nCPU times: user 1min 42s, sys: 2.07 s, total: 1min 44s\r\nWall time: 1min 44s\r\n```\r\n"}