{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/352679167", "html_url": "https://github.com/tensorflow/tensorflow/issues/14777#issuecomment-352679167", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14777", "id": 352679167, "node_id": "MDEyOklzc3VlQ29tbWVudDM1MjY3OTE2Nw==", "user": {"login": "offbye", "id": 836403, "node_id": "MDQ6VXNlcjgzNjQwMw==", "avatar_url": "https://avatars2.githubusercontent.com/u/836403?v=4", "gravatar_id": "", "url": "https://api.github.com/users/offbye", "html_url": "https://github.com/offbye", "followers_url": "https://api.github.com/users/offbye/followers", "following_url": "https://api.github.com/users/offbye/following{/other_user}", "gists_url": "https://api.github.com/users/offbye/gists{/gist_id}", "starred_url": "https://api.github.com/users/offbye/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/offbye/subscriptions", "organizations_url": "https://api.github.com/users/offbye/orgs", "repos_url": "https://api.github.com/users/offbye/repos", "events_url": "https://api.github.com/users/offbye/events{/privacy}", "received_events_url": "https://api.github.com/users/offbye/received_events", "type": "User", "site_admin": false}, "created_at": "2017-12-19T08:54:31Z", "updated_at": "2017-12-19T09:22:51Z", "author_association": "NONE", "body_html": "<p>I use the lastest code in master , and I quantized the    <code>assets/ssd_mobilenet_v1_android_export.pb</code>\uff0c then I change the <code>tensorflow\\examples\\android\\src\\org\\tensorflow\\demo\\DetectorActivity.java</code> ,use the quantized ssd_mobilenet_v1_android_quantized.pb\uff0c and  I met errors:</p>\n<pre><code>12-19 16:39:49.231 23831-23855/? E/TensorFlowInferenceInterface: Failed to run TensorFlow inference with inputs:[image_tensor], outputs:[detection_boxes, detection_scores, detection_classes, num_detections]\n12-19 16:39:49.231 23831-23855/? E/AndroidRuntime: FATAL EXCEPTION: inference\n                                                   Process: org.tensorflow.demo, PID: 23831\n                                                   java.lang.IllegalArgumentException: The node 'Postprocessor/BatchMultiClassNonMaxSuppression/map/while/TensorArrayWrite/TensorArrayWriteV3' has inputs from different frames. The input 'Postprocessor/BatchMultiClassNonMaxSuppression/map/while/PadOrClipBoxList/cond/Merge' is in frame ''. The input 'Postprocessor/BatchMultiClassNonMaxSuppression/map/while/TensorArrayWrite/TensorArrayWriteV3/Enter' is in frame 'Postprocessor/BatchMultiClassNonMaxSuppression/map/while/while_context'.\n                                                       at org.tensorflow.Session.run(Native Method)\n                                                       at org.tensorflow.Session.access$100(Session.java:48)\n                                                       at org.tensorflow.Session$Runner.runHelper(Session.java:298)\n                                                       at org.tensorflow.Session$Runner.run(Session.java:248)\n                                                       at org.tensorflow.contrib.android.TensorFlowInferenceInterface.run(TensorFlowInferenceInterface.java:218)\n                                                       at org.tensorflow.demo.TensorFlowObjectDetectionAPIModel.recognizeImage(TensorFlowObjectDetectionAPIModel.java:158)\n                                                       at org.tensorflow.demo.DetectorActivity$3.run(DetectorActivity.java:289)\n                                                       at android.os.Handler.handleCallback(Handler.java:743)\n                                                       at android.os.Handler.dispatchMessage(Handler.java:95)\n                                                       at android.os.Looper.loop(Looper.java:150)\n                                                       at android.os.HandlerThread.run(HandlerThread.java:61)\n</code></pre>\n<p>I used below command quantized pb</p>\n<pre><code>  bazel-bin/tensorflow/tools/quantization/quantize_graph --input=/tmp/assets/ssd_mobilenet_v1_android_export.pb  --output_node_names=detection_boxes,detection_scores,detection_classes,num_detections --print_nodes --output=/tmp/assets/ssd_mobilenet_v1_android_quantized.pb  --mode=weights --logtostderr\n</code></pre>\n<p>Before quantized the ssd_mobilenet_v1_android_export.pb,  the android Detect Demo is ok on my phone.</p>\n<p>Then I tried use graph_transforms to quantized</p>\n<pre><code>  bazel-bin/tensorflow/tools/graph_transforms/transform_graph     --in_graph=/data5/zxt/coco_log/export/frozen_inference_graph.pb  --out_graph=/tmp/ssd2.pb --inputs='image_tensor' --outputs='detection_boxes,detection_scores,num_detections,detection_classes' --transforms='\n    add_default_attributes\n    strip_unused_nodes(type=float, shape=\"-1,-1,-1,3\")\n    remove_nodes(op=Identity, op=CheckNumerics)\n    fold_batch_norms\n    fold_old_batch_norms\n    quantize_weights\n    sort_by_execution_order'\n</code></pre>\n<p>I use the new ssd2.pb,<br>\nreinstall and run  android  detect demo log errors:</p>\n<pre><code>\n12-19 17:12:07.592 27113-27138/org.tensorflow.demo E/TensorFlowInferenceInterface: Failed to run TensorFlow inference with inputs:[image_tensor], outputs:[detection_boxes, detection_scores, detection_classes, num_detections]\n12-19 17:12:07.592 27113-27138/org.tensorflow.demo E/AndroidRuntime: FATAL EXCEPTION: inference\n                                                                     Process: org.tensorflow.demo, PID: 27113\n                                                                     java.lang.IllegalArgumentException: Retval[0] does not have value\n                                                                         at org.tensorflow.Session.run(Native Method)\n                                                                         at org.tensorflow.Session.access$100(Session.java:48)\n                                                                         at org.tensorflow.Session$Runner.runHelper(Session.java:298)\n                                                                         at org.tensorflow.Session$Runner.run(Session.java:248)\n                                                                         at org.tensorflow.contrib.android.TensorFlowInferenceInterface.run(TensorFlowInferenceInterface.java:218)\n                                                                         at org.tensorflow.demo.TensorFlowObjectDetectionAPIModel.recognizeImage(TensorFlowObjectDetectionAPIModel.java:158)\n                                                                         at org.tensorflow.demo.DetectorActivity$3.run(DetectorActivity.java:289)\n                                                                         at android.os.Handler.handleCallback(Handler.java:743)\n                                                                         at android.os.Handler.dispatchMessage(Handler.java:95)\n                                                                         at android.os.Looper.loop(Looper.java:150)\n                                                                         at android.os.HandlerThread.run(HandlerThread.java:61)\n</code></pre>", "body_text": "I use the lastest code in master , and I quantized the    assets/ssd_mobilenet_v1_android_export.pb\uff0c then I change the tensorflow\\examples\\android\\src\\org\\tensorflow\\demo\\DetectorActivity.java ,use the quantized ssd_mobilenet_v1_android_quantized.pb\uff0c and  I met errors:\n12-19 16:39:49.231 23831-23855/? E/TensorFlowInferenceInterface: Failed to run TensorFlow inference with inputs:[image_tensor], outputs:[detection_boxes, detection_scores, detection_classes, num_detections]\n12-19 16:39:49.231 23831-23855/? E/AndroidRuntime: FATAL EXCEPTION: inference\n                                                   Process: org.tensorflow.demo, PID: 23831\n                                                   java.lang.IllegalArgumentException: The node 'Postprocessor/BatchMultiClassNonMaxSuppression/map/while/TensorArrayWrite/TensorArrayWriteV3' has inputs from different frames. The input 'Postprocessor/BatchMultiClassNonMaxSuppression/map/while/PadOrClipBoxList/cond/Merge' is in frame ''. The input 'Postprocessor/BatchMultiClassNonMaxSuppression/map/while/TensorArrayWrite/TensorArrayWriteV3/Enter' is in frame 'Postprocessor/BatchMultiClassNonMaxSuppression/map/while/while_context'.\n                                                       at org.tensorflow.Session.run(Native Method)\n                                                       at org.tensorflow.Session.access$100(Session.java:48)\n                                                       at org.tensorflow.Session$Runner.runHelper(Session.java:298)\n                                                       at org.tensorflow.Session$Runner.run(Session.java:248)\n                                                       at org.tensorflow.contrib.android.TensorFlowInferenceInterface.run(TensorFlowInferenceInterface.java:218)\n                                                       at org.tensorflow.demo.TensorFlowObjectDetectionAPIModel.recognizeImage(TensorFlowObjectDetectionAPIModel.java:158)\n                                                       at org.tensorflow.demo.DetectorActivity$3.run(DetectorActivity.java:289)\n                                                       at android.os.Handler.handleCallback(Handler.java:743)\n                                                       at android.os.Handler.dispatchMessage(Handler.java:95)\n                                                       at android.os.Looper.loop(Looper.java:150)\n                                                       at android.os.HandlerThread.run(HandlerThread.java:61)\n\nI used below command quantized pb\n  bazel-bin/tensorflow/tools/quantization/quantize_graph --input=/tmp/assets/ssd_mobilenet_v1_android_export.pb  --output_node_names=detection_boxes,detection_scores,detection_classes,num_detections --print_nodes --output=/tmp/assets/ssd_mobilenet_v1_android_quantized.pb  --mode=weights --logtostderr\n\nBefore quantized the ssd_mobilenet_v1_android_export.pb,  the android Detect Demo is ok on my phone.\nThen I tried use graph_transforms to quantized\n  bazel-bin/tensorflow/tools/graph_transforms/transform_graph     --in_graph=/data5/zxt/coco_log/export/frozen_inference_graph.pb  --out_graph=/tmp/ssd2.pb --inputs='image_tensor' --outputs='detection_boxes,detection_scores,num_detections,detection_classes' --transforms='\n    add_default_attributes\n    strip_unused_nodes(type=float, shape=\"-1,-1,-1,3\")\n    remove_nodes(op=Identity, op=CheckNumerics)\n    fold_batch_norms\n    fold_old_batch_norms\n    quantize_weights\n    sort_by_execution_order'\n\nI use the new ssd2.pb,\nreinstall and run  android  detect demo log errors:\n\n12-19 17:12:07.592 27113-27138/org.tensorflow.demo E/TensorFlowInferenceInterface: Failed to run TensorFlow inference with inputs:[image_tensor], outputs:[detection_boxes, detection_scores, detection_classes, num_detections]\n12-19 17:12:07.592 27113-27138/org.tensorflow.demo E/AndroidRuntime: FATAL EXCEPTION: inference\n                                                                     Process: org.tensorflow.demo, PID: 27113\n                                                                     java.lang.IllegalArgumentException: Retval[0] does not have value\n                                                                         at org.tensorflow.Session.run(Native Method)\n                                                                         at org.tensorflow.Session.access$100(Session.java:48)\n                                                                         at org.tensorflow.Session$Runner.runHelper(Session.java:298)\n                                                                         at org.tensorflow.Session$Runner.run(Session.java:248)\n                                                                         at org.tensorflow.contrib.android.TensorFlowInferenceInterface.run(TensorFlowInferenceInterface.java:218)\n                                                                         at org.tensorflow.demo.TensorFlowObjectDetectionAPIModel.recognizeImage(TensorFlowObjectDetectionAPIModel.java:158)\n                                                                         at org.tensorflow.demo.DetectorActivity$3.run(DetectorActivity.java:289)\n                                                                         at android.os.Handler.handleCallback(Handler.java:743)\n                                                                         at android.os.Handler.dispatchMessage(Handler.java:95)\n                                                                         at android.os.Looper.loop(Looper.java:150)\n                                                                         at android.os.HandlerThread.run(HandlerThread.java:61)", "body": "I use the lastest code in master , and I quantized the    `assets/ssd_mobilenet_v1_android_export.pb`\uff0c then I change the `tensorflow\\examples\\android\\src\\org\\tensorflow\\demo\\DetectorActivity.java` ,use the quantized ssd_mobilenet_v1_android_quantized.pb\uff0c and  I met errors:\r\n\r\n```\r\n12-19 16:39:49.231 23831-23855/? E/TensorFlowInferenceInterface: Failed to run TensorFlow inference with inputs:[image_tensor], outputs:[detection_boxes, detection_scores, detection_classes, num_detections]\r\n12-19 16:39:49.231 23831-23855/? E/AndroidRuntime: FATAL EXCEPTION: inference\r\n                                                   Process: org.tensorflow.demo, PID: 23831\r\n                                                   java.lang.IllegalArgumentException: The node 'Postprocessor/BatchMultiClassNonMaxSuppression/map/while/TensorArrayWrite/TensorArrayWriteV3' has inputs from different frames. The input 'Postprocessor/BatchMultiClassNonMaxSuppression/map/while/PadOrClipBoxList/cond/Merge' is in frame ''. The input 'Postprocessor/BatchMultiClassNonMaxSuppression/map/while/TensorArrayWrite/TensorArrayWriteV3/Enter' is in frame 'Postprocessor/BatchMultiClassNonMaxSuppression/map/while/while_context'.\r\n                                                       at org.tensorflow.Session.run(Native Method)\r\n                                                       at org.tensorflow.Session.access$100(Session.java:48)\r\n                                                       at org.tensorflow.Session$Runner.runHelper(Session.java:298)\r\n                                                       at org.tensorflow.Session$Runner.run(Session.java:248)\r\n                                                       at org.tensorflow.contrib.android.TensorFlowInferenceInterface.run(TensorFlowInferenceInterface.java:218)\r\n                                                       at org.tensorflow.demo.TensorFlowObjectDetectionAPIModel.recognizeImage(TensorFlowObjectDetectionAPIModel.java:158)\r\n                                                       at org.tensorflow.demo.DetectorActivity$3.run(DetectorActivity.java:289)\r\n                                                       at android.os.Handler.handleCallback(Handler.java:743)\r\n                                                       at android.os.Handler.dispatchMessage(Handler.java:95)\r\n                                                       at android.os.Looper.loop(Looper.java:150)\r\n                                                       at android.os.HandlerThread.run(HandlerThread.java:61)\r\n```\r\n\r\nI used below command quantized pb \r\n```\r\n  bazel-bin/tensorflow/tools/quantization/quantize_graph --input=/tmp/assets/ssd_mobilenet_v1_android_export.pb  --output_node_names=detection_boxes,detection_scores,detection_classes,num_detections --print_nodes --output=/tmp/assets/ssd_mobilenet_v1_android_quantized.pb  --mode=weights --logtostderr\r\n```\r\n\r\n\r\nBefore quantized the ssd_mobilenet_v1_android_export.pb,  the android Detect Demo is ok on my phone.\r\n\r\nThen I tried use graph_transforms to quantized \r\n```\r\n  bazel-bin/tensorflow/tools/graph_transforms/transform_graph     --in_graph=/data5/zxt/coco_log/export/frozen_inference_graph.pb  --out_graph=/tmp/ssd2.pb --inputs='image_tensor' --outputs='detection_boxes,detection_scores,num_detections,detection_classes' --transforms='\r\n    add_default_attributes\r\n    strip_unused_nodes(type=float, shape=\"-1,-1,-1,3\")\r\n    remove_nodes(op=Identity, op=CheckNumerics)\r\n    fold_batch_norms\r\n    fold_old_batch_norms\r\n    quantize_weights\r\n    sort_by_execution_order'\r\n```\r\nI use the new ssd2.pb, \r\nreinstall and run  android  detect demo log errors:\r\n\r\n```\r\n\r\n12-19 17:12:07.592 27113-27138/org.tensorflow.demo E/TensorFlowInferenceInterface: Failed to run TensorFlow inference with inputs:[image_tensor], outputs:[detection_boxes, detection_scores, detection_classes, num_detections]\r\n12-19 17:12:07.592 27113-27138/org.tensorflow.demo E/AndroidRuntime: FATAL EXCEPTION: inference\r\n                                                                     Process: org.tensorflow.demo, PID: 27113\r\n                                                                     java.lang.IllegalArgumentException: Retval[0] does not have value\r\n                                                                         at org.tensorflow.Session.run(Native Method)\r\n                                                                         at org.tensorflow.Session.access$100(Session.java:48)\r\n                                                                         at org.tensorflow.Session$Runner.runHelper(Session.java:298)\r\n                                                                         at org.tensorflow.Session$Runner.run(Session.java:248)\r\n                                                                         at org.tensorflow.contrib.android.TensorFlowInferenceInterface.run(TensorFlowInferenceInterface.java:218)\r\n                                                                         at org.tensorflow.demo.TensorFlowObjectDetectionAPIModel.recognizeImage(TensorFlowObjectDetectionAPIModel.java:158)\r\n                                                                         at org.tensorflow.demo.DetectorActivity$3.run(DetectorActivity.java:289)\r\n                                                                         at android.os.Handler.handleCallback(Handler.java:743)\r\n                                                                         at android.os.Handler.dispatchMessage(Handler.java:95)\r\n                                                                         at android.os.Looper.loop(Looper.java:150)\r\n                                                                         at android.os.HandlerThread.run(HandlerThread.java:61)\r\n```\r\n"}