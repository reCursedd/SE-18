{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21395", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21395/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21395/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21395/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/21395", "id": 347762917, "node_id": "MDU6SXNzdWUzNDc3NjI5MTc=", "number": 21395, "title": "import_meta_graph + load model, then fail to model_export with signature", "user": {"login": "baobao7766", "id": 10491686, "node_id": "MDQ6VXNlcjEwNDkxNjg2", "avatar_url": "https://avatars3.githubusercontent.com/u/10491686?v=4", "gravatar_id": "", "url": "https://api.github.com/users/baobao7766", "html_url": "https://github.com/baobao7766", "followers_url": "https://api.github.com/users/baobao7766/followers", "following_url": "https://api.github.com/users/baobao7766/following{/other_user}", "gists_url": "https://api.github.com/users/baobao7766/gists{/gist_id}", "starred_url": "https://api.github.com/users/baobao7766/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/baobao7766/subscriptions", "organizations_url": "https://api.github.com/users/baobao7766/orgs", "repos_url": "https://api.github.com/users/baobao7766/repos", "events_url": "https://api.github.com/users/baobao7766/events{/privacy}", "received_events_url": "https://api.github.com/users/baobao7766/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "angersson", "id": 32465472, "node_id": "MDQ6VXNlcjMyNDY1NDcy", "avatar_url": "https://avatars2.githubusercontent.com/u/32465472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/angersson", "html_url": "https://github.com/angersson", "followers_url": "https://api.github.com/users/angersson/followers", "following_url": "https://api.github.com/users/angersson/following{/other_user}", "gists_url": "https://api.github.com/users/angersson/gists{/gist_id}", "starred_url": "https://api.github.com/users/angersson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/angersson/subscriptions", "organizations_url": "https://api.github.com/users/angersson/orgs", "repos_url": "https://api.github.com/users/angersson/repos", "events_url": "https://api.github.com/users/angersson/events{/privacy}", "received_events_url": "https://api.github.com/users/angersson/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "angersson", "id": 32465472, "node_id": "MDQ6VXNlcjMyNDY1NDcy", "avatar_url": "https://avatars2.githubusercontent.com/u/32465472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/angersson", "html_url": "https://github.com/angersson", "followers_url": "https://api.github.com/users/angersson/followers", "following_url": "https://api.github.com/users/angersson/following{/other_user}", "gists_url": "https://api.github.com/users/angersson/gists{/gist_id}", "starred_url": "https://api.github.com/users/angersson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/angersson/subscriptions", "organizations_url": "https://api.github.com/users/angersson/orgs", "repos_url": "https://api.github.com/users/angersson/repos", "events_url": "https://api.github.com/users/angersson/events{/privacy}", "received_events_url": "https://api.github.com/users/angersson/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2018-08-06T03:01:33Z", "updated_at": "2018-08-07T23:36:24Z", "closed_at": "2018-08-07T23:36:24Z", "author_association": "NONE", "body_html": "<p>I was fail to export model for tf-serving, and this is my error message, but i hava no idea about it:</p>\n<pre><code>TypeError: Can't convert Operation 'in_table' to Tensor (target dtype=None, name=None, as_ref=True)\n</code></pre>\n<p>And those are part of my code:</p>\n<pre><code>        self.symbol2index = tf.contrib.lookup.MutableHashTable(\n            key_dtype=tf.string,\n            value_dtype=tf.int64,\n            default_value=self.UNK_ID,\n            shared_name=\"in_table_share\",\n            name=\"in_table\",\n            checkpoint=True)\n\n        self.index2symbol = tf.contrib.lookup.MutableHashTable(\n            key_dtype=tf.int64,\n            value_dtype=tf.string,\n            default_value=self.UNK,\n            shared_name=\"out_table_share\",\n            name=\"out_table\",\n            checkpoint=True)\n</code></pre>\n<p>Save model with:</p>\n<pre><code>self.saver.save(sess, \"%s/model.ckpt\" % ckpt_dir, global_step=global_step)\n</code></pre>\n<p>Load with:</p>\n<pre><code>ckpt = tf.train.latest_checkpoint(checkpoint_dir=tfFLAGS.train_dir)\ngraph_from_meta=ckpt + \".meta\"\nself.saver = tf.train.import_meta_graph(graph_from_meta)\nself.saver.restore(sess, tf.train.latest_checkpoint(ckpt_dir))\n</code></pre>\n<p>model export with:</p>\n<pre><code>        prediction_signature = tf.saved_model.signature_def_utils.build_signature_def(\n            inputs={\n                'question': question_placeholder,\n                'answer': answer_placeholder,\n                'question_len': qes_len_placeholder,\n                'answer_len': ans_len_placeholder,\n            },\n            outputs={'output': out_infers},\n            method_name=tf.saved_model.signature_constants.PREDICT_METHOD_NAME)\n\n        # legacy_init_op = tf.group(tf.tables_initializer(), name='legacy_init_op')\n        builder.add_meta_graph_and_variables(\n            sess,\n            tags=[tf.saved_model.tag_constants.SERVING],\n            signature_def_map={'prediction': prediction_signature},\n        )\n        builder.save()\n\n</code></pre>\n<p>I have try to rebuild graph with the same parameters instead load them with <code>import_meta_graph</code>, it works, but it not convenient.</p>\n<p>Hope anyone can help me, thanks!</p>", "body_text": "I was fail to export model for tf-serving, and this is my error message, but i hava no idea about it:\nTypeError: Can't convert Operation 'in_table' to Tensor (target dtype=None, name=None, as_ref=True)\n\nAnd those are part of my code:\n        self.symbol2index = tf.contrib.lookup.MutableHashTable(\n            key_dtype=tf.string,\n            value_dtype=tf.int64,\n            default_value=self.UNK_ID,\n            shared_name=\"in_table_share\",\n            name=\"in_table\",\n            checkpoint=True)\n\n        self.index2symbol = tf.contrib.lookup.MutableHashTable(\n            key_dtype=tf.int64,\n            value_dtype=tf.string,\n            default_value=self.UNK,\n            shared_name=\"out_table_share\",\n            name=\"out_table\",\n            checkpoint=True)\n\nSave model with:\nself.saver.save(sess, \"%s/model.ckpt\" % ckpt_dir, global_step=global_step)\n\nLoad with:\nckpt = tf.train.latest_checkpoint(checkpoint_dir=tfFLAGS.train_dir)\ngraph_from_meta=ckpt + \".meta\"\nself.saver = tf.train.import_meta_graph(graph_from_meta)\nself.saver.restore(sess, tf.train.latest_checkpoint(ckpt_dir))\n\nmodel export with:\n        prediction_signature = tf.saved_model.signature_def_utils.build_signature_def(\n            inputs={\n                'question': question_placeholder,\n                'answer': answer_placeholder,\n                'question_len': qes_len_placeholder,\n                'answer_len': ans_len_placeholder,\n            },\n            outputs={'output': out_infers},\n            method_name=tf.saved_model.signature_constants.PREDICT_METHOD_NAME)\n\n        # legacy_init_op = tf.group(tf.tables_initializer(), name='legacy_init_op')\n        builder.add_meta_graph_and_variables(\n            sess,\n            tags=[tf.saved_model.tag_constants.SERVING],\n            signature_def_map={'prediction': prediction_signature},\n        )\n        builder.save()\n\n\nI have try to rebuild graph with the same parameters instead load them with import_meta_graph, it works, but it not convenient.\nHope anyone can help me, thanks!", "body": "I was fail to export model for tf-serving, and this is my error message, but i hava no idea about it:\r\n```\r\nTypeError: Can't convert Operation 'in_table' to Tensor (target dtype=None, name=None, as_ref=True)\r\n```\r\nAnd those are part of my code:\r\n```\r\n        self.symbol2index = tf.contrib.lookup.MutableHashTable(\r\n            key_dtype=tf.string,\r\n            value_dtype=tf.int64,\r\n            default_value=self.UNK_ID,\r\n            shared_name=\"in_table_share\",\r\n            name=\"in_table\",\r\n            checkpoint=True)\r\n\r\n        self.index2symbol = tf.contrib.lookup.MutableHashTable(\r\n            key_dtype=tf.int64,\r\n            value_dtype=tf.string,\r\n            default_value=self.UNK,\r\n            shared_name=\"out_table_share\",\r\n            name=\"out_table\",\r\n            checkpoint=True)\r\n```\r\nSave model with:\r\n```\r\nself.saver.save(sess, \"%s/model.ckpt\" % ckpt_dir, global_step=global_step)\r\n```\r\nLoad with:\r\n```\r\nckpt = tf.train.latest_checkpoint(checkpoint_dir=tfFLAGS.train_dir)\r\ngraph_from_meta=ckpt + \".meta\"\r\nself.saver = tf.train.import_meta_graph(graph_from_meta)\r\nself.saver.restore(sess, tf.train.latest_checkpoint(ckpt_dir))\r\n```\r\nmodel export with:\r\n```\r\n        prediction_signature = tf.saved_model.signature_def_utils.build_signature_def(\r\n            inputs={\r\n                'question': question_placeholder,\r\n                'answer': answer_placeholder,\r\n                'question_len': qes_len_placeholder,\r\n                'answer_len': ans_len_placeholder,\r\n            },\r\n            outputs={'output': out_infers},\r\n            method_name=tf.saved_model.signature_constants.PREDICT_METHOD_NAME)\r\n\r\n        # legacy_init_op = tf.group(tf.tables_initializer(), name='legacy_init_op')\r\n        builder.add_meta_graph_and_variables(\r\n            sess,\r\n            tags=[tf.saved_model.tag_constants.SERVING],\r\n            signature_def_map={'prediction': prediction_signature},\r\n        )\r\n        builder.save()\r\n\r\n```\r\n\r\nI have try to rebuild graph with the same parameters instead load them with `import_meta_graph`, it works, but it not convenient. \r\n\r\nHope anyone can help me, thanks!"}