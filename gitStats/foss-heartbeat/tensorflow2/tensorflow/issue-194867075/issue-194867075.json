{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6256", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6256/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6256/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6256/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/6256", "id": 194867075, "node_id": "MDU6SXNzdWUxOTQ4NjcwNzU=", "number": 6256, "title": "grpc worker->client fetch tops out at 120 MB/s", "user": {"login": "yaroslavvb", "id": 23068, "node_id": "MDQ6VXNlcjIzMDY4", "avatar_url": "https://avatars3.githubusercontent.com/u/23068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yaroslavvb", "html_url": "https://github.com/yaroslavvb", "followers_url": "https://api.github.com/users/yaroslavvb/followers", "following_url": "https://api.github.com/users/yaroslavvb/following{/other_user}", "gists_url": "https://api.github.com/users/yaroslavvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/yaroslavvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yaroslavvb/subscriptions", "organizations_url": "https://api.github.com/users/yaroslavvb/orgs", "repos_url": "https://api.github.com/users/yaroslavvb/repos", "events_url": "https://api.github.com/users/yaroslavvb/events{/privacy}", "received_events_url": "https://api.github.com/users/yaroslavvb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 18, "created_at": "2016-12-11T23:57:28Z", "updated_at": "2017-06-20T23:04:15Z", "closed_at": "2017-06-20T23:04:15Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Fetching data as numpy arrays is slow for grpc sessions. Evaluating 128MB variable repeatedly from <code>Session(\"grpc://localhost..\")</code> only gets me 116 MB/s, compared to 5150MB/s for <code>Session()</code></p>\n<p><a href=\"https://gist.github.com/yaroslavvb/59bc8d3d635e1027306486cc418b26aa\">https://gist.github.com/yaroslavvb/59bc8d3d635e1027306486cc418b26aa</a></p>\n<pre><code>python client_transfer_benchmark.py --profile\n5150.04 MB per second\n116.70 MB per second\n\n</code></pre>\n<p>Attached are CPU profiles for worker and for client. Worker uses 2x CPU and both of them are spending majority of the time in in gRPC code, specifically doing <code>strcmp</code> (reported as <a href=\"https://github.com/gperftools/gperftools/issues/1\" data-hovercard-type=\"issue\" data-hovercard-url=\"/gperftools/gperftools/issues/1/hovercard\">__nss_hosts_lookup</a>).</p>\n<p><a href=\"https://github.com/tensorflow/tensorflow/files/644905/profile.client.pdf\">profile.client.pdf</a><br>\n<a href=\"https://github.com/tensorflow/tensorflow/files/644906/profile.worker.pdf\">profile.worker.pdf</a></p>\n<p>This is related but slightly different from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"193706605\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/6116\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/6116/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/6116\">#6116</a> -- that issue looks at worker-&gt;worker transfer which hits 520 MB/second for the same message size (degrading below 100 MB/second for larger messages)</p>\n<p><a href=\"https://gist.github.com/yaroslavvb/e196107b5e0afc834652bd3153030c42\">https://gist.github.com/yaroslavvb/e196107b5e0afc834652bd3153030c42</a></p>\n<pre><code>python benchmark_grpc_recv.py --data_mb=128\nLocal rate:       15214.63 MB/s\nDistributed rate: 569.27 MB/s\n\n\n</code></pre>", "body_text": "Fetching data as numpy arrays is slow for grpc sessions. Evaluating 128MB variable repeatedly from Session(\"grpc://localhost..\") only gets me 116 MB/s, compared to 5150MB/s for Session()\nhttps://gist.github.com/yaroslavvb/59bc8d3d635e1027306486cc418b26aa\npython client_transfer_benchmark.py --profile\n5150.04 MB per second\n116.70 MB per second\n\n\nAttached are CPU profiles for worker and for client. Worker uses 2x CPU and both of them are spending majority of the time in in gRPC code, specifically doing strcmp (reported as __nss_hosts_lookup).\nprofile.client.pdf\nprofile.worker.pdf\nThis is related but slightly different from #6116 -- that issue looks at worker->worker transfer which hits 520 MB/second for the same message size (degrading below 100 MB/second for larger messages)\nhttps://gist.github.com/yaroslavvb/e196107b5e0afc834652bd3153030c42\npython benchmark_grpc_recv.py --data_mb=128\nLocal rate:       15214.63 MB/s\nDistributed rate: 569.27 MB/s", "body": "Fetching data as numpy arrays is slow for grpc sessions. Evaluating 128MB variable repeatedly from `Session(\"grpc://localhost..\")` only gets me 116 MB/s, compared to 5150MB/s for `Session()`\r\n\r\nhttps://gist.github.com/yaroslavvb/59bc8d3d635e1027306486cc418b26aa\r\n```\r\npython client_transfer_benchmark.py --profile\r\n5150.04 MB per second\r\n116.70 MB per second\r\n\r\n```\r\nAttached are CPU profiles for worker and for client. Worker uses 2x CPU and both of them are spending majority of the time in in gRPC code, specifically doing `strcmp` (reported as [__nss_hosts_lookup](https://github.com/gperftools/gperftools/issues/1)). \r\n\r\n[profile.client.pdf](https://github.com/tensorflow/tensorflow/files/644905/profile.client.pdf)\r\n[profile.worker.pdf](https://github.com/tensorflow/tensorflow/files/644906/profile.worker.pdf)\r\n\r\n\r\nThis is related but slightly different from https://github.com/tensorflow/tensorflow/issues/6116 -- that issue looks at worker->worker transfer which hits 520 MB/second for the same message size (degrading below 100 MB/second for larger messages)\r\n\r\nhttps://gist.github.com/yaroslavvb/e196107b5e0afc834652bd3153030c42\r\n```\r\npython benchmark_grpc_recv.py --data_mb=128\r\nLocal rate:       15214.63 MB/s\r\nDistributed rate: 569.27 MB/s\r\n\r\n\r\n```\r\n"}