{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/321204867", "html_url": "https://github.com/tensorflow/tensorflow/issues/9837#issuecomment-321204867", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9837", "id": 321204867, "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTIwNDg2Nw==", "user": {"login": "dguerra", "id": 5977844, "node_id": "MDQ6VXNlcjU5Nzc4NDQ=", "avatar_url": "https://avatars2.githubusercontent.com/u/5977844?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dguerra", "html_url": "https://github.com/dguerra", "followers_url": "https://api.github.com/users/dguerra/followers", "following_url": "https://api.github.com/users/dguerra/following{/other_user}", "gists_url": "https://api.github.com/users/dguerra/gists{/gist_id}", "starred_url": "https://api.github.com/users/dguerra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dguerra/subscriptions", "organizations_url": "https://api.github.com/users/dguerra/orgs", "repos_url": "https://api.github.com/users/dguerra/repos", "events_url": "https://api.github.com/users/dguerra/events{/privacy}", "received_events_url": "https://api.github.com/users/dguerra/received_events", "type": "User", "site_admin": false}, "created_at": "2017-08-09T09:33:31Z", "updated_at": "2017-08-09T09:33:31Z", "author_association": "NONE", "body_html": "<p>So how can it be possible to add gradients manually now to a graph?</p>\n<p>I can run and train a linear regression graph when I compute the gradients myself.</p>\n<pre><code>#include \"tensorflow/cc/client/client_session.h\"\n#include \"tensorflow/cc/ops/standard_ops.h\"\n#include \"tensorflow/cc/framework/gradients.h\"\n#include \"tensorflow/core/framework/tensor.h\"\n\nint main()\n{\n  using namespace tensorflow;\n  using namespace tensorflow::ops;\n  Scope root = Scope::NewRootScope();\n  \n  auto W = Variable(root.WithOpName(\"W\"), {3,1}, DT_DOUBLE);\n\n  auto x = Placeholder(root.WithOpName(\"x\"), DT_DOUBLE);\n  auto y = Placeholder(root.WithOpName(\"y\"), DT_DOUBLE);\n\n  auto m = MatMul(root, x, W);\n  auto dd = Subtract(root, y, m);\n  \n //compute loss\n  auto loss = MatMul(root, MatMul(root, dd, dd, MatMul::TransposeA(true)), {0.5}); \n  double learning_rate = 0.1;\n \n\n  std::vector&lt;Output&gt; grad_outputs;\n  TF_CHECK_OK(AddSymbolicGradients(root, {loss}, {m}, &amp;grad_outputs));\n  //Compute gradients with formula\n  //  auto grad_W = Subtract(root, MatMul(root, MatMul(root, x, x, MatMul::TransposeA(true)), W), MatMul(root, x, y,  MatMul::TransposeA(true)));\n\n  auto apply_grad_W = ApplyGradientDescent(root, W, learning_rate,  grad_outputs[0]);\n\n  //Initialize variables\n  auto init_W = Assign(root, W, {{1.0},{1.0},{1.0}});\n\n  std::vector&lt;Tensor&gt; outputs;\n  ClientSession session(root);\n\n  //Run variable initializers\n  session.Run({init_W}, &amp;outputs);\n\n  for(unsigned int i=0;i&lt;200;++i)\n  {\n    TF_CHECK_OK(session.Run( { {x,{{1.0,-1.0,3.0}, {1.0,2.0,1.0}, {1.0,-2.0,-2.0}, {1.0,0.0,2.0}}}, {y,{{14.0}, {15.0}, {-9.0}, {13.0}}} } , {loss, apply_grad_W}, &amp;outputs));\n    std::cout &lt;&lt; std::string(\"loss: \") &lt;&lt; outputs[0].scalar&lt;double&gt;() &lt;&lt; std::endl &lt;&lt; std::string(\"weights: \")&lt;&lt; outputs[1].matrix&lt;double&gt;() &lt;&lt; std::endl;\n  }\n  return 0;\n}\n\n</code></pre>\n<p>But when I try to get the gradients with AddSymbolicGradients and despite MatMulGrad been already defined in math_grad.cc, I got this error message:</p>\n<p>\"Not found: No gradient defined for op: MatMul. Please see <a href=\"https://www.tensorflow.org/code/tensorflow/cc/gradients/README.md\" rel=\"nofollow\">https://www.tensorflow.org/code/tensorflow/cc/gradients/README.md</a> for instructions on how to add C++ gradients.\"</p>", "body_text": "So how can it be possible to add gradients manually now to a graph?\nI can run and train a linear regression graph when I compute the gradients myself.\n#include \"tensorflow/cc/client/client_session.h\"\n#include \"tensorflow/cc/ops/standard_ops.h\"\n#include \"tensorflow/cc/framework/gradients.h\"\n#include \"tensorflow/core/framework/tensor.h\"\n\nint main()\n{\n  using namespace tensorflow;\n  using namespace tensorflow::ops;\n  Scope root = Scope::NewRootScope();\n  \n  auto W = Variable(root.WithOpName(\"W\"), {3,1}, DT_DOUBLE);\n\n  auto x = Placeholder(root.WithOpName(\"x\"), DT_DOUBLE);\n  auto y = Placeholder(root.WithOpName(\"y\"), DT_DOUBLE);\n\n  auto m = MatMul(root, x, W);\n  auto dd = Subtract(root, y, m);\n  \n //compute loss\n  auto loss = MatMul(root, MatMul(root, dd, dd, MatMul::TransposeA(true)), {0.5}); \n  double learning_rate = 0.1;\n \n\n  std::vector<Output> grad_outputs;\n  TF_CHECK_OK(AddSymbolicGradients(root, {loss}, {m}, &grad_outputs));\n  //Compute gradients with formula\n  //  auto grad_W = Subtract(root, MatMul(root, MatMul(root, x, x, MatMul::TransposeA(true)), W), MatMul(root, x, y,  MatMul::TransposeA(true)));\n\n  auto apply_grad_W = ApplyGradientDescent(root, W, learning_rate,  grad_outputs[0]);\n\n  //Initialize variables\n  auto init_W = Assign(root, W, {{1.0},{1.0},{1.0}});\n\n  std::vector<Tensor> outputs;\n  ClientSession session(root);\n\n  //Run variable initializers\n  session.Run({init_W}, &outputs);\n\n  for(unsigned int i=0;i<200;++i)\n  {\n    TF_CHECK_OK(session.Run( { {x,{{1.0,-1.0,3.0}, {1.0,2.0,1.0}, {1.0,-2.0,-2.0}, {1.0,0.0,2.0}}}, {y,{{14.0}, {15.0}, {-9.0}, {13.0}}} } , {loss, apply_grad_W}, &outputs));\n    std::cout << std::string(\"loss: \") << outputs[0].scalar<double>() << std::endl << std::string(\"weights: \")<< outputs[1].matrix<double>() << std::endl;\n  }\n  return 0;\n}\n\n\nBut when I try to get the gradients with AddSymbolicGradients and despite MatMulGrad been already defined in math_grad.cc, I got this error message:\n\"Not found: No gradient defined for op: MatMul. Please see https://www.tensorflow.org/code/tensorflow/cc/gradients/README.md for instructions on how to add C++ gradients.\"", "body": "So how can it be possible to add gradients manually now to a graph?\r\n\r\nI can run and train a linear regression graph when I compute the gradients myself.\r\n\r\n```\r\n#include \"tensorflow/cc/client/client_session.h\"\r\n#include \"tensorflow/cc/ops/standard_ops.h\"\r\n#include \"tensorflow/cc/framework/gradients.h\"\r\n#include \"tensorflow/core/framework/tensor.h\"\r\n\r\nint main()\r\n{\r\n  using namespace tensorflow;\r\n  using namespace tensorflow::ops;\r\n  Scope root = Scope::NewRootScope();\r\n  \r\n  auto W = Variable(root.WithOpName(\"W\"), {3,1}, DT_DOUBLE);\r\n\r\n  auto x = Placeholder(root.WithOpName(\"x\"), DT_DOUBLE);\r\n  auto y = Placeholder(root.WithOpName(\"y\"), DT_DOUBLE);\r\n\r\n  auto m = MatMul(root, x, W);\r\n  auto dd = Subtract(root, y, m);\r\n  \r\n //compute loss\r\n  auto loss = MatMul(root, MatMul(root, dd, dd, MatMul::TransposeA(true)), {0.5}); \r\n  double learning_rate = 0.1;\r\n \r\n\r\n  std::vector<Output> grad_outputs;\r\n  TF_CHECK_OK(AddSymbolicGradients(root, {loss}, {m}, &grad_outputs));\r\n  //Compute gradients with formula\r\n  //  auto grad_W = Subtract(root, MatMul(root, MatMul(root, x, x, MatMul::TransposeA(true)), W), MatMul(root, x, y,  MatMul::TransposeA(true)));\r\n\r\n  auto apply_grad_W = ApplyGradientDescent(root, W, learning_rate,  grad_outputs[0]);\r\n\r\n  //Initialize variables\r\n  auto init_W = Assign(root, W, {{1.0},{1.0},{1.0}});\r\n\r\n  std::vector<Tensor> outputs;\r\n  ClientSession session(root);\r\n\r\n  //Run variable initializers\r\n  session.Run({init_W}, &outputs);\r\n\r\n  for(unsigned int i=0;i<200;++i)\r\n  {\r\n    TF_CHECK_OK(session.Run( { {x,{{1.0,-1.0,3.0}, {1.0,2.0,1.0}, {1.0,-2.0,-2.0}, {1.0,0.0,2.0}}}, {y,{{14.0}, {15.0}, {-9.0}, {13.0}}} } , {loss, apply_grad_W}, &outputs));\r\n    std::cout << std::string(\"loss: \") << outputs[0].scalar<double>() << std::endl << std::string(\"weights: \")<< outputs[1].matrix<double>() << std::endl;\r\n  }\r\n  return 0;\r\n}\r\n\r\n```\r\n\r\nBut when I try to get the gradients with AddSymbolicGradients and despite MatMulGrad been already defined in math_grad.cc, I got this error message:\r\n\r\n\"Not found: No gradient defined for op: MatMul. Please see https://www.tensorflow.org/code/tensorflow/cc/gradients/README.md for instructions on how to add C++ gradients.\"\r\n\r\n"}