{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12754", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12754/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12754/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12754/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/12754", "id": 254723967, "node_id": "MDU6SXNzdWUyNTQ3MjM5Njc=", "number": 12754, "title": "Issue with tf.py_func, tf.Tensor.set_shape and tf.Queues", "user": {"login": "3rd3", "id": 2372391, "node_id": "MDQ6VXNlcjIzNzIzOTE=", "avatar_url": "https://avatars0.githubusercontent.com/u/2372391?v=4", "gravatar_id": "", "url": "https://api.github.com/users/3rd3", "html_url": "https://github.com/3rd3", "followers_url": "https://api.github.com/users/3rd3/followers", "following_url": "https://api.github.com/users/3rd3/following{/other_user}", "gists_url": "https://api.github.com/users/3rd3/gists{/gist_id}", "starred_url": "https://api.github.com/users/3rd3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/3rd3/subscriptions", "organizations_url": "https://api.github.com/users/3rd3/orgs", "repos_url": "https://api.github.com/users/3rd3/repos", "events_url": "https://api.github.com/users/3rd3/events{/privacy}", "received_events_url": "https://api.github.com/users/3rd3/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-09-01T18:53:18Z", "updated_at": "2017-09-01T22:11:54Z", "closed_at": "2017-09-01T22:11:53Z", "author_association": "NONE", "body_html": "<p>This works fine:</p>\n<pre><code>import tensorflow as tf\nx = tf.py_func(lambda: 42, [], tf.int64)\nx = reshape(x, [1])\nsess = tf.Session()\ny = tf.train.shuffle_batch([x], 32, 64, 32)\ncoord = tf.train.Coordinator()\nthreads = tf.train.start_queue_runners(sess=sess, coord=coord)\nsess.run(y)\n</code></pre>\n<p>But simply setting the shape with <code>tf.Tensor.set_shape</code> instead of reshaping does not work:</p>\n<pre><code>import tensorflow as tf\nx = tf.py_func(lambda: 42, [], tf.int64)\nx.set_shape([1])\nsess = tf.Session()\ny = tf.train.shuffle_batch([x], 32, 64, 32)\ncoord = tf.train.Coordinator()\nthreads = tf.train.start_queue_runners(sess=sess, coord=coord)  # Fails here.\nsess.run(y)\n\n2017-09-01 20:46:12.585027: W tensorflow/core/framework/op_kernel.cc:1192] Invalid argument: Shape mismatch in tuple component 0. Expected [1], got []\n2017-09-01 20:46:12.585264: W tensorflow/core/framework/op_kernel.cc:1192] Invalid argument: Shape mismatch in tuple component 0. Expected [1], got []\nINFO:tensorflow:Error reported to Coordinator: &lt;class 'tensorflow.python.framework.errors_impl.InvalidArgumentError'&gt;, Shape mismatch in tuple component 0. Expected [1], got []\n\t [[Node: shuffle_batch/random_shuffle_queue_enqueue = QueueEnqueueV2[Tcomponents=[DT_INT64], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, PyFunc)]]\n</code></pre>\n<p>Even though this works fine:</p>\n<pre><code>import tensorflow as tf\nx = tf.py_func(lambda: 42, [], tf.int64)\nx.set_shape([1])\nsess.run(x)\n</code></pre>", "body_text": "This works fine:\nimport tensorflow as tf\nx = tf.py_func(lambda: 42, [], tf.int64)\nx = reshape(x, [1])\nsess = tf.Session()\ny = tf.train.shuffle_batch([x], 32, 64, 32)\ncoord = tf.train.Coordinator()\nthreads = tf.train.start_queue_runners(sess=sess, coord=coord)\nsess.run(y)\n\nBut simply setting the shape with tf.Tensor.set_shape instead of reshaping does not work:\nimport tensorflow as tf\nx = tf.py_func(lambda: 42, [], tf.int64)\nx.set_shape([1])\nsess = tf.Session()\ny = tf.train.shuffle_batch([x], 32, 64, 32)\ncoord = tf.train.Coordinator()\nthreads = tf.train.start_queue_runners(sess=sess, coord=coord)  # Fails here.\nsess.run(y)\n\n2017-09-01 20:46:12.585027: W tensorflow/core/framework/op_kernel.cc:1192] Invalid argument: Shape mismatch in tuple component 0. Expected [1], got []\n2017-09-01 20:46:12.585264: W tensorflow/core/framework/op_kernel.cc:1192] Invalid argument: Shape mismatch in tuple component 0. Expected [1], got []\nINFO:tensorflow:Error reported to Coordinator: <class 'tensorflow.python.framework.errors_impl.InvalidArgumentError'>, Shape mismatch in tuple component 0. Expected [1], got []\n\t [[Node: shuffle_batch/random_shuffle_queue_enqueue = QueueEnqueueV2[Tcomponents=[DT_INT64], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, PyFunc)]]\n\nEven though this works fine:\nimport tensorflow as tf\nx = tf.py_func(lambda: 42, [], tf.int64)\nx.set_shape([1])\nsess.run(x)", "body": "This works fine:\r\n```\r\nimport tensorflow as tf\r\nx = tf.py_func(lambda: 42, [], tf.int64)\r\nx = reshape(x, [1])\r\nsess = tf.Session()\r\ny = tf.train.shuffle_batch([x], 32, 64, 32)\r\ncoord = tf.train.Coordinator()\r\nthreads = tf.train.start_queue_runners(sess=sess, coord=coord)\r\nsess.run(y)\r\n```\r\n\r\nBut simply setting the shape with `tf.Tensor.set_shape` instead of reshaping does not work:\r\n\r\n```\r\nimport tensorflow as tf\r\nx = tf.py_func(lambda: 42, [], tf.int64)\r\nx.set_shape([1])\r\nsess = tf.Session()\r\ny = tf.train.shuffle_batch([x], 32, 64, 32)\r\ncoord = tf.train.Coordinator()\r\nthreads = tf.train.start_queue_runners(sess=sess, coord=coord)  # Fails here.\r\nsess.run(y)\r\n\r\n2017-09-01 20:46:12.585027: W tensorflow/core/framework/op_kernel.cc:1192] Invalid argument: Shape mismatch in tuple component 0. Expected [1], got []\r\n2017-09-01 20:46:12.585264: W tensorflow/core/framework/op_kernel.cc:1192] Invalid argument: Shape mismatch in tuple component 0. Expected [1], got []\r\nINFO:tensorflow:Error reported to Coordinator: <class 'tensorflow.python.framework.errors_impl.InvalidArgumentError'>, Shape mismatch in tuple component 0. Expected [1], got []\r\n\t [[Node: shuffle_batch/random_shuffle_queue_enqueue = QueueEnqueueV2[Tcomponents=[DT_INT64], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, PyFunc)]]\r\n```\r\n\r\nEven though this works fine:\r\n\r\n```\r\nimport tensorflow as tf\r\nx = tf.py_func(lambda: 42, [], tf.int64)\r\nx.set_shape([1])\r\nsess.run(x)\r\n```"}