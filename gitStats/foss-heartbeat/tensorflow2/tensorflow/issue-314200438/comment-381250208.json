{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/381250208", "html_url": "https://github.com/tensorflow/tensorflow/pull/18501#issuecomment-381250208", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18501", "id": 381250208, "node_id": "MDEyOklzc3VlQ29tbWVudDM4MTI1MDIwOA==", "user": {"login": "linusmartensson", "id": 452169, "node_id": "MDQ6VXNlcjQ1MjE2OQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/452169?v=4", "gravatar_id": "", "url": "https://api.github.com/users/linusmartensson", "html_url": "https://github.com/linusmartensson", "followers_url": "https://api.github.com/users/linusmartensson/followers", "following_url": "https://api.github.com/users/linusmartensson/following{/other_user}", "gists_url": "https://api.github.com/users/linusmartensson/gists{/gist_id}", "starred_url": "https://api.github.com/users/linusmartensson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/linusmartensson/subscriptions", "organizations_url": "https://api.github.com/users/linusmartensson/orgs", "repos_url": "https://api.github.com/users/linusmartensson/repos", "events_url": "https://api.github.com/users/linusmartensson/events{/privacy}", "received_events_url": "https://api.github.com/users/linusmartensson/received_events", "type": "User", "site_admin": false}, "created_at": "2018-04-13T20:18:43Z", "updated_at": "2018-04-13T20:18:43Z", "author_association": "NONE", "body_html": "<p>If building for c++_shared using ndk r14b+, consider this:</p>\n<p>setup workspace<br>\n./configure<br>\nbazel build<br>\ncd bazel-tensorflow/external/androidndk/ndk/sources/cxx-stl/<br>\ncp llvm-libc++ libcxx &amp;&amp; mv libcxx llvm-libc++/libcxx<br>\ncp llvm-libc++abi libcxxabi &amp;&amp; mv libcxxabi llvm-libc++/libcxxabi</p>\n<p>This is because llvm-libc++ include paths have changed, leaving bazel-tensorflow/external/androidndk/BUILD.bazel in a bad state.<br>\nInforming bazel devs as well, but this is a sufficient workaround.</p>\n<p>Then modify your build command:<br>\nbazel build --config=monolithic --crosstool_top=@androidndk//:toolchain-libcpp --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --cpu=armeabi-v7a //tensorflow:libtensorflow_cc.so --cxxopt=\"-std=c++11\" --copt=\"-DMDB_USE_ROBUST=0\" --cxxopt=\"-DTENSORFLOW_DISABLE_META\" --cxxopt=\"-DEIGEN_HAS_C99_MATH\" --cxxopt=\"-Wno-c++11-narrowing\" --verbose_failures --copt=\"-DS_IREAD=00400\" --copt=\"-DS_IWRITE=00200\"</p>\n<p>S_IREAD and S_IWRITE are used by the gif library, but not included in c++_shared, and flags __HAS_BSD or __HAS_GNU to override may have other side effects.</p>\n<p>Some other changes in the PR may be superfluous as c++_shared is a more complete c++11 implementation compared to the bazel default.</p>", "body_text": "If building for c++_shared using ndk r14b+, consider this:\nsetup workspace\n./configure\nbazel build\ncd bazel-tensorflow/external/androidndk/ndk/sources/cxx-stl/\ncp llvm-libc++ libcxx && mv libcxx llvm-libc++/libcxx\ncp llvm-libc++abi libcxxabi && mv libcxxabi llvm-libc++/libcxxabi\nThis is because llvm-libc++ include paths have changed, leaving bazel-tensorflow/external/androidndk/BUILD.bazel in a bad state.\nInforming bazel devs as well, but this is a sufficient workaround.\nThen modify your build command:\nbazel build --config=monolithic --crosstool_top=@androidndk//:toolchain-libcpp --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --cpu=armeabi-v7a //tensorflow:libtensorflow_cc.so --cxxopt=\"-std=c++11\" --copt=\"-DMDB_USE_ROBUST=0\" --cxxopt=\"-DTENSORFLOW_DISABLE_META\" --cxxopt=\"-DEIGEN_HAS_C99_MATH\" --cxxopt=\"-Wno-c++11-narrowing\" --verbose_failures --copt=\"-DS_IREAD=00400\" --copt=\"-DS_IWRITE=00200\"\nS_IREAD and S_IWRITE are used by the gif library, but not included in c++_shared, and flags __HAS_BSD or __HAS_GNU to override may have other side effects.\nSome other changes in the PR may be superfluous as c++_shared is a more complete c++11 implementation compared to the bazel default.", "body": "If building for c++_shared using ndk r14b+, consider this:\r\n\r\nsetup workspace\r\n./configure\r\nbazel build\r\ncd bazel-tensorflow/external/androidndk/ndk/sources/cxx-stl/\r\ncp llvm-libc++ libcxx && mv libcxx llvm-libc++/libcxx\r\ncp llvm-libc++abi libcxxabi && mv libcxxabi llvm-libc++/libcxxabi\r\n\r\nThis is because llvm-libc++ include paths have changed, leaving bazel-tensorflow/external/androidndk/BUILD.bazel in a bad state. \r\nInforming bazel devs as well, but this is a sufficient workaround.\r\n\r\nThen modify your build command:\r\nbazel build --config=monolithic --crosstool_top=@androidndk//:toolchain-libcpp --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --cpu=armeabi-v7a //tensorflow:libtensorflow_cc.so --cxxopt=\"-std=c++11\" --copt=\"-DMDB_USE_ROBUST=0\" --cxxopt=\"-DTENSORFLOW_DISABLE_META\" --cxxopt=\"-DEIGEN_HAS_C99_MATH\" --cxxopt=\"-Wno-c++11-narrowing\" --verbose_failures --copt=\"-DS_IREAD=00400\" --copt=\"-DS_IWRITE=00200\"\r\n\r\nS_IREAD and S_IWRITE are used by the gif library, but not included in c++_shared, and flags __HAS_BSD or __HAS_GNU to override may have other side effects.\r\n\r\nSome other changes in the PR may be superfluous as c++_shared is a more complete c++11 implementation compared to the bazel default."}