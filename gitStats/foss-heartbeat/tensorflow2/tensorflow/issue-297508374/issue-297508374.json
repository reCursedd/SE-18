{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17048", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17048/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17048/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17048/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/17048", "id": 297508374, "node_id": "MDU6SXNzdWUyOTc1MDgzNzQ=", "number": 17048, "title": "Tensorflow or cuda not giving back gpu memory after session closes", "user": {"login": "ahsteven", "id": 10161343, "node_id": "MDQ6VXNlcjEwMTYxMzQz", "avatar_url": "https://avatars2.githubusercontent.com/u/10161343?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ahsteven", "html_url": "https://github.com/ahsteven", "followers_url": "https://api.github.com/users/ahsteven/followers", "following_url": "https://api.github.com/users/ahsteven/following{/other_user}", "gists_url": "https://api.github.com/users/ahsteven/gists{/gist_id}", "starred_url": "https://api.github.com/users/ahsteven/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ahsteven/subscriptions", "organizations_url": "https://api.github.com/users/ahsteven/orgs", "repos_url": "https://api.github.com/users/ahsteven/repos", "events_url": "https://api.github.com/users/ahsteven/events{/privacy}", "received_events_url": "https://api.github.com/users/ahsteven/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}, {"id": 473184161, "node_id": "MDU6TGFiZWw0NzMxODQxNjE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:support", "name": "type:support", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 16, "created_at": "2018-02-15T16:24:18Z", "updated_at": "2018-11-23T04:44:31Z", "closed_at": "2018-02-23T23:45:33Z", "author_association": "NONE", "body_html": "<p>I am tying to install tensorflow correctly and I am getting memory allocation erros.<br>\nI am using:</p>\n<p>Ubuntu 16.04<br>\ntf = 1.5.0 from pip install tensorflow-gpu<br>\nCUDA 9.0<br>\nCUDNN 7.0.5</p>\n<p>starting python in a command terminal and running the following commands:<br>\nimport tensorflow as tf<br>\nsess = tf.Session()<br>\nsess.close()</p>\n<p>If I start a session it is fine the first time it says total memory: 7.72Gib free Memory: 7.50GiB</p>\n<p>The next time in the same terminal I start python again ti says freeMemory: 279.44MiB</p>\n<p>and finally if I start again it says:</p>\n<p>freeMemory 122.50MiB</p>\n<p>failed to allocate 72.50M from device: CUDA_ERROR_OUT_OF_MEMORY</p>\n<p>What can I do to fix this?</p>\n<p>I have pasted the entire sequence below:</p>\n<p>teves@teves:~$ python<br>\nPython 2.7.12 (default, Dec  4 2017, 14:50:18)<br>\n[GCC 5.4.0 20160609] on linux2<br>\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>import tensorflow<br>\nimport tensorflow as tf<br>\nsess = tf.Session()<br>\n2018-02-15 11:06:55.708721: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA<br>\n2018-02-15 11:06:55.846202: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:895] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br>\n2018-02-15 11:06:55.846656: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1105] Found device 0 with properties:<br>\nname: GeForce GTX 1070 major: 6 minor: 1 memoryClockRate(GHz): 1.695<br>\npciBusID: 0000:01:00.0<br>\ntotalMemory: 7.92GiB freeMemory: 7.50GiB<br>\n2018-02-15 11:06:55.846685: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1195] Creating TensorFlow device (/device:GPU:0) -&gt; (device: 0, name: GeForce GTX 1070, pci bus id: 0000:01:00.0, compute capability: 6.1)<br>\nsess.close()</p>\n</blockquote>\n</blockquote>\n</blockquote>\n<p>[1]+  Stopped                 python<br>\nteves@teves:~$ python<br>\nPython 2.7.12 (default, Dec  4 2017, 14:50:18)<br>\n[GCC 5.4.0 20160609] on linux2<br>\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>import tensorflow as tf<br>\nsess = tf.Session()<br>\n2018-02-15 11:07:34.144528: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA<br>\n2018-02-15 11:07:34.351426: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:895] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br>\n2018-02-15 11:07:34.351699: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1105] Found device 0 with properties:<br>\nname: GeForce GTX 1070 major: 6 minor: 1 memoryClockRate(GHz): 1.695<br>\npciBusID: 0000:01:00.0<br>\ntotalMemory: 7.92GiB freeMemory: 279.44MiB<br>\n2018-02-15 11:07:34.351732: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1195] Creating TensorFlow device (/device:GPU:0) -&gt; (device: 0, name: GeForce GTX 1070, pci bus id: 0000:01:00.0, compute capability: 6.1)<br>\nsess.close()</p>\n</blockquote>\n</blockquote>\n</blockquote>\n<p>[2]+  Stopped                 python<br>\nteves@teves:~$ python<br>\nPython 2.7.12 (default, Dec  4 2017, 14:50:18)<br>\n[GCC 5.4.0 20160609] on linux2<br>\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>import tensorflow as tf<br>\nsess = tf.Session()<br>\n2018-02-15 11:08:43.527818: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA<br>\n2018-02-15 11:08:43.877301: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:895] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br>\n2018-02-15 11:08:43.877577: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1105] Found device 0 with properties:<br>\nname: GeForce GTX 1070 major: 6 minor: 1 memoryClockRate(GHz): 1.695<br>\npciBusID: 0000:01:00.0<br>\ntotalMemory: 7.92GiB freeMemory: 122.50MiB<br>\n2018-02-15 11:08:43.877610: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1195] Creating TensorFlow device (/device:GPU:0) -&gt; (device: 0, name: GeForce GTX 1070, pci bus id: 0000:01:00.0, compute capability: 6.1)<br>\n2018-02-15 11:08:44.047980: E tensorflow/stream_executor/cuda/cuda_driver.cc:936] failed to allocate 72.50M (76021760 bytes) from device: CUDA_ERROR_OUT_OF_MEMORY<br>\ntf.<strong>version</strong><br>\n'1.5.0'</p>\n</blockquote>\n</blockquote>\n</blockquote>", "body_text": "I am tying to install tensorflow correctly and I am getting memory allocation erros.\nI am using:\nUbuntu 16.04\ntf = 1.5.0 from pip install tensorflow-gpu\nCUDA 9.0\nCUDNN 7.0.5\nstarting python in a command terminal and running the following commands:\nimport tensorflow as tf\nsess = tf.Session()\nsess.close()\nIf I start a session it is fine the first time it says total memory: 7.72Gib free Memory: 7.50GiB\nThe next time in the same terminal I start python again ti says freeMemory: 279.44MiB\nand finally if I start again it says:\nfreeMemory 122.50MiB\nfailed to allocate 72.50M from device: CUDA_ERROR_OUT_OF_MEMORY\nWhat can I do to fix this?\nI have pasted the entire sequence below:\nteves@teves:~$ python\nPython 2.7.12 (default, Dec  4 2017, 14:50:18)\n[GCC 5.4.0 20160609] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n\n\n\nimport tensorflow\nimport tensorflow as tf\nsess = tf.Session()\n2018-02-15 11:06:55.708721: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\n2018-02-15 11:06:55.846202: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:895] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2018-02-15 11:06:55.846656: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1105] Found device 0 with properties:\nname: GeForce GTX 1070 major: 6 minor: 1 memoryClockRate(GHz): 1.695\npciBusID: 0000:01:00.0\ntotalMemory: 7.92GiB freeMemory: 7.50GiB\n2018-02-15 11:06:55.846685: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1195] Creating TensorFlow device (/device:GPU:0) -> (device: 0, name: GeForce GTX 1070, pci bus id: 0000:01:00.0, compute capability: 6.1)\nsess.close()\n\n\n\n[1]+  Stopped                 python\nteves@teves:~$ python\nPython 2.7.12 (default, Dec  4 2017, 14:50:18)\n[GCC 5.4.0 20160609] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n\n\n\nimport tensorflow as tf\nsess = tf.Session()\n2018-02-15 11:07:34.144528: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\n2018-02-15 11:07:34.351426: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:895] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2018-02-15 11:07:34.351699: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1105] Found device 0 with properties:\nname: GeForce GTX 1070 major: 6 minor: 1 memoryClockRate(GHz): 1.695\npciBusID: 0000:01:00.0\ntotalMemory: 7.92GiB freeMemory: 279.44MiB\n2018-02-15 11:07:34.351732: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1195] Creating TensorFlow device (/device:GPU:0) -> (device: 0, name: GeForce GTX 1070, pci bus id: 0000:01:00.0, compute capability: 6.1)\nsess.close()\n\n\n\n[2]+  Stopped                 python\nteves@teves:~$ python\nPython 2.7.12 (default, Dec  4 2017, 14:50:18)\n[GCC 5.4.0 20160609] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n\n\n\nimport tensorflow as tf\nsess = tf.Session()\n2018-02-15 11:08:43.527818: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\n2018-02-15 11:08:43.877301: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:895] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2018-02-15 11:08:43.877577: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1105] Found device 0 with properties:\nname: GeForce GTX 1070 major: 6 minor: 1 memoryClockRate(GHz): 1.695\npciBusID: 0000:01:00.0\ntotalMemory: 7.92GiB freeMemory: 122.50MiB\n2018-02-15 11:08:43.877610: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1195] Creating TensorFlow device (/device:GPU:0) -> (device: 0, name: GeForce GTX 1070, pci bus id: 0000:01:00.0, compute capability: 6.1)\n2018-02-15 11:08:44.047980: E tensorflow/stream_executor/cuda/cuda_driver.cc:936] failed to allocate 72.50M (76021760 bytes) from device: CUDA_ERROR_OUT_OF_MEMORY\ntf.version\n'1.5.0'", "body": "I am tying to install tensorflow correctly and I am getting memory allocation erros.\r\nI am using:\r\n\r\nUbuntu 16.04\r\ntf = 1.5.0 from pip install tensorflow-gpu\r\nCUDA 9.0\r\nCUDNN 7.0.5\r\n\r\nstarting python in a command terminal and running the following commands:\r\nimport tensorflow as tf\r\nsess = tf.Session()\r\nsess.close()\r\n\r\nIf I start a session it is fine the first time it says total memory: 7.72Gib free Memory: 7.50GiB\r\n\r\nThe next time in the same terminal I start python again ti says freeMemory: 279.44MiB\r\n\r\nand finally if I start again it says:\r\n\r\nfreeMemory 122.50MiB\r\n\r\nfailed to allocate 72.50M from device: CUDA_ERROR_OUT_OF_MEMORY\r\n\r\nWhat can I do to fix this? \r\n\r\nI have pasted the entire sequence below:\r\n\r\nteves@teves:~$ python\r\nPython 2.7.12 (default, Dec  4 2017, 14:50:18) \r\n[GCC 5.4.0 20160609] on linux2\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import tensorflow\r\n>>> import tensorflow as tf\r\n>>> sess = tf.Session()\r\n2018-02-15 11:06:55.708721: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\r\n2018-02-15 11:06:55.846202: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:895] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2018-02-15 11:06:55.846656: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1105] Found device 0 with properties: \r\nname: GeForce GTX 1070 major: 6 minor: 1 memoryClockRate(GHz): 1.695\r\npciBusID: 0000:01:00.0\r\ntotalMemory: 7.92GiB freeMemory: 7.50GiB\r\n2018-02-15 11:06:55.846685: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1195] Creating TensorFlow device (/device:GPU:0) -> (device: 0, name: GeForce GTX 1070, pci bus id: 0000:01:00.0, compute capability: 6.1)\r\n>>> sess.close()\r\n>>> \r\n[1]+  Stopped                 python\r\nteves@teves:~$ python\r\nPython 2.7.12 (default, Dec  4 2017, 14:50:18) \r\n[GCC 5.4.0 20160609] on linux2\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import tensorflow as tf\r\n>>> sess = tf.Session()\r\n2018-02-15 11:07:34.144528: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\r\n2018-02-15 11:07:34.351426: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:895] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2018-02-15 11:07:34.351699: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1105] Found device 0 with properties: \r\nname: GeForce GTX 1070 major: 6 minor: 1 memoryClockRate(GHz): 1.695\r\npciBusID: 0000:01:00.0\r\ntotalMemory: 7.92GiB freeMemory: 279.44MiB\r\n2018-02-15 11:07:34.351732: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1195] Creating TensorFlow device (/device:GPU:0) -> (device: 0, name: GeForce GTX 1070, pci bus id: 0000:01:00.0, compute capability: 6.1)\r\n>>> sess.close()\r\n>>> \r\n[2]+  Stopped                 python\r\nteves@teves:~$ python\r\nPython 2.7.12 (default, Dec  4 2017, 14:50:18) \r\n[GCC 5.4.0 20160609] on linux2\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import tensorflow as tf\r\n>>> sess = tf.Session()\r\n2018-02-15 11:08:43.527818: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\r\n2018-02-15 11:08:43.877301: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:895] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2018-02-15 11:08:43.877577: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1105] Found device 0 with properties: \r\nname: GeForce GTX 1070 major: 6 minor: 1 memoryClockRate(GHz): 1.695\r\npciBusID: 0000:01:00.0\r\ntotalMemory: 7.92GiB freeMemory: 122.50MiB\r\n2018-02-15 11:08:43.877610: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1195] Creating TensorFlow device (/device:GPU:0) -> (device: 0, name: GeForce GTX 1070, pci bus id: 0000:01:00.0, compute capability: 6.1)\r\n2018-02-15 11:08:44.047980: E tensorflow/stream_executor/cuda/cuda_driver.cc:936] failed to allocate 72.50M (76021760 bytes) from device: CUDA_ERROR_OUT_OF_MEMORY\r\n>>> tf.__version__\r\n'1.5.0'\r\n>>> \r\n"}