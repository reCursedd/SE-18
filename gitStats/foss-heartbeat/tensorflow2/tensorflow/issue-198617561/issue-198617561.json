{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6624", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6624/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6624/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6624/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/6624", "id": 198617561, "node_id": "MDU6SXNzdWUxOTg2MTc1NjE=", "number": 6624, "title": "Fail with error (rather than hanging) when init_op requires starting queues (ManagedSesssion etc)", "user": {"login": "elibixby", "id": 6596957, "node_id": "MDQ6VXNlcjY1OTY5NTc=", "avatar_url": "https://avatars0.githubusercontent.com/u/6596957?v=4", "gravatar_id": "", "url": "https://api.github.com/users/elibixby", "html_url": "https://github.com/elibixby", "followers_url": "https://api.github.com/users/elibixby/followers", "following_url": "https://api.github.com/users/elibixby/following{/other_user}", "gists_url": "https://api.github.com/users/elibixby/gists{/gist_id}", "starred_url": "https://api.github.com/users/elibixby/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/elibixby/subscriptions", "organizations_url": "https://api.github.com/users/elibixby/orgs", "repos_url": "https://api.github.com/users/elibixby/repos", "events_url": "https://api.github.com/users/elibixby/events{/privacy}", "received_events_url": "https://api.github.com/users/elibixby/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 17, "created_at": "2017-01-04T02:32:48Z", "updated_at": "2018-02-07T23:51:32Z", "closed_at": "2018-02-07T23:51:31Z", "author_association": "NONE", "body_html": "<p>In 0.12 and in master</p>\n<p><code>MonitoredSession</code> wraps the original <code>SessionCreator</code> in a <code>_CoordinatedSessionCreator</code> in an attempt to ensure queue runners are started before the session is run, however the original session has to be created first (as it is an argument to start_queue_runner). In the case of <code>ChiefSessionCreator</code>, <code>ChiefSessionCreator.create_session</code> calls <code>ChiefSessionCreator._get_session_manager</code><br>\nwhich instantiates a new <code>SessionManager</code> and returns it. Then <code>ChiefSessionCreator.create_session</code> calls <code>SessionManager.prepare_session</code> which calls <code>sess.run(init_op)</code>. Thus resulting in <code>sess.run(init_op)</code> being run before <code>start_queue_runner</code> is called.</p>\n<p>This makes it impossible to initialize variables from queues. Even if this is intended behavior, it causes the initialization of <code>MonitoredSession</code> to stall without any logging output, and not respond to SIGTERM.</p>\n<p>It seems that <code>prepare_session</code> may need to be split into two calls for this use case.</p>", "body_text": "In 0.12 and in master\nMonitoredSession wraps the original SessionCreator in a _CoordinatedSessionCreator in an attempt to ensure queue runners are started before the session is run, however the original session has to be created first (as it is an argument to start_queue_runner). In the case of ChiefSessionCreator, ChiefSessionCreator.create_session calls ChiefSessionCreator._get_session_manager\nwhich instantiates a new SessionManager and returns it. Then ChiefSessionCreator.create_session calls SessionManager.prepare_session which calls sess.run(init_op). Thus resulting in sess.run(init_op) being run before start_queue_runner is called.\nThis makes it impossible to initialize variables from queues. Even if this is intended behavior, it causes the initialization of MonitoredSession to stall without any logging output, and not respond to SIGTERM.\nIt seems that prepare_session may need to be split into two calls for this use case.", "body": "In 0.12 and in master\r\n\r\n`MonitoredSession` wraps the original `SessionCreator` in a `_CoordinatedSessionCreator` in an attempt to ensure queue runners are started before the session is run, however the original session has to be created first (as it is an argument to start_queue_runner). In the case of `ChiefSessionCreator`, `ChiefSessionCreator.create_session` calls `ChiefSessionCreator._get_session_manager`\r\nwhich instantiates a new `SessionManager` and returns it. Then `ChiefSessionCreator.create_session` calls `SessionManager.prepare_session` which calls `sess.run(init_op)`. Thus resulting in `sess.run(init_op)` being run before `start_queue_runner` is called. \r\n\r\nThis makes it impossible to initialize variables from queues. Even if this is intended behavior, it causes the initialization of `MonitoredSession` to stall without any logging output, and not respond to SIGTERM.\r\n\r\nIt seems that `prepare_session` may need to be split into two calls for this use case. "}