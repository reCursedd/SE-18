{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/329929038", "html_url": "https://github.com/tensorflow/tensorflow/issues/12293#issuecomment-329929038", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12293", "id": 329929038, "node_id": "MDEyOklzc3VlQ29tbWVudDMyOTkyOTAzOA==", "user": {"login": "yzhwang", "id": 1002405, "node_id": "MDQ6VXNlcjEwMDI0MDU=", "avatar_url": "https://avatars1.githubusercontent.com/u/1002405?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yzhwang", "html_url": "https://github.com/yzhwang", "followers_url": "https://api.github.com/users/yzhwang/followers", "following_url": "https://api.github.com/users/yzhwang/following{/other_user}", "gists_url": "https://api.github.com/users/yzhwang/gists{/gist_id}", "starred_url": "https://api.github.com/users/yzhwang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yzhwang/subscriptions", "organizations_url": "https://api.github.com/users/yzhwang/orgs", "repos_url": "https://api.github.com/users/yzhwang/repos", "events_url": "https://api.github.com/users/yzhwang/events{/privacy}", "received_events_url": "https://api.github.com/users/yzhwang/received_events", "type": "User", "site_admin": false}, "created_at": "2017-09-15T23:56:07Z", "updated_at": "2017-09-15T23:56:07Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Some update: I've confirmed that this is an Eigen GPU bug. When data format is NHWC and tensors are located on the GPU, tensorflow will choose Eigen for its consistently better performance than average pooling in cudnn:<br>\n<a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/avgpooling_op.cc#L162\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/avgpooling_op.cc#L162</a><br>\nFor a quick workaround, you can disable the SpatialAvgPooling() call and force tensorflow to always use cudnn. This may cause some performance regression.<br>\nI'm currently debugging Eigen's GPU avg pooling implementation.</p>", "body_text": "Some update: I've confirmed that this is an Eigen GPU bug. When data format is NHWC and tensors are located on the GPU, tensorflow will choose Eigen for its consistently better performance than average pooling in cudnn:\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/avgpooling_op.cc#L162\nFor a quick workaround, you can disable the SpatialAvgPooling() call and force tensorflow to always use cudnn. This may cause some performance regression.\nI'm currently debugging Eigen's GPU avg pooling implementation.", "body": "Some update: I've confirmed that this is an Eigen GPU bug. When data format is NHWC and tensors are located on the GPU, tensorflow will choose Eigen for its consistently better performance than average pooling in cudnn:\r\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/avgpooling_op.cc#L162\r\nFor a quick workaround, you can disable the SpatialAvgPooling() call and force tensorflow to always use cudnn. This may cause some performance regression.\r\nI'm currently debugging Eigen's GPU avg pooling implementation."}