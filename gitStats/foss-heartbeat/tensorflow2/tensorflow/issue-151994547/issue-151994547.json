{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2171", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2171/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2171/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2171/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/2171", "id": 151994547, "node_id": "MDU6SXNzdWUxNTE5OTQ1NDc=", "number": 2171, "title": "TF-Learn early stopping monitor doesn't disable dropout", "user": {"login": "waleedka", "id": 106472, "node_id": "MDQ6VXNlcjEwNjQ3Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/106472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/waleedka", "html_url": "https://github.com/waleedka", "followers_url": "https://api.github.com/users/waleedka/followers", "following_url": "https://api.github.com/users/waleedka/following{/other_user}", "gists_url": "https://api.github.com/users/waleedka/gists{/gist_id}", "starred_url": "https://api.github.com/users/waleedka/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/waleedka/subscriptions", "organizations_url": "https://api.github.com/users/waleedka/orgs", "repos_url": "https://api.github.com/users/waleedka/repos", "events_url": "https://api.github.com/users/waleedka/events{/privacy}", "received_events_url": "https://api.github.com/users/waleedka/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "ilblackdragon", "id": 175486, "node_id": "MDQ6VXNlcjE3NTQ4Ng==", "avatar_url": "https://avatars2.githubusercontent.com/u/175486?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ilblackdragon", "html_url": "https://github.com/ilblackdragon", "followers_url": "https://api.github.com/users/ilblackdragon/followers", "following_url": "https://api.github.com/users/ilblackdragon/following{/other_user}", "gists_url": "https://api.github.com/users/ilblackdragon/gists{/gist_id}", "starred_url": "https://api.github.com/users/ilblackdragon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ilblackdragon/subscriptions", "organizations_url": "https://api.github.com/users/ilblackdragon/orgs", "repos_url": "https://api.github.com/users/ilblackdragon/repos", "events_url": "https://api.github.com/users/ilblackdragon/events{/privacy}", "received_events_url": "https://api.github.com/users/ilblackdragon/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ilblackdragon", "id": 175486, "node_id": "MDQ6VXNlcjE3NTQ4Ng==", "avatar_url": "https://avatars2.githubusercontent.com/u/175486?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ilblackdragon", "html_url": "https://github.com/ilblackdragon", "followers_url": "https://api.github.com/users/ilblackdragon/followers", "following_url": "https://api.github.com/users/ilblackdragon/following{/other_user}", "gists_url": "https://api.github.com/users/ilblackdragon/gists{/gist_id}", "starred_url": "https://api.github.com/users/ilblackdragon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ilblackdragon/subscriptions", "organizations_url": "https://api.github.com/users/ilblackdragon/orgs", "repos_url": "https://api.github.com/users/ilblackdragon/repos", "events_url": "https://api.github.com/users/ilblackdragon/events{/privacy}", "received_events_url": "https://api.github.com/users/ilblackdragon/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2016-04-30T00:42:36Z", "updated_at": "2016-06-28T13:45:59Z", "closed_at": "2016-06-28T13:45:59Z", "author_association": "CONTRIBUTOR", "body_html": "<p>I'm training a custom CNN model that uses dropout for regularization. I'm using tf-learn r0.8 (skflow)  ValidationMonitor as follows.</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">from</span> tensorflow.contrib.learn.python.learn <span class=\"pl-k\">import</span> monitors\nm <span class=\"pl-k\">=</span> monitors.ValidationMonitor(X_validate, Y_validate, <span class=\"pl-c1\">0</span>, <span class=\"pl-v\">print_steps</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">100</span>, \n    <span class=\"pl-v\">early_stopping_rounds</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">500</span>)\nregressor.fit(X_train, Y_train, <span class=\"pl-v\">monitor</span><span class=\"pl-k\">=</span>monitor)</pre></div>\n<p>I noticed that after early stopping is triggered, the validation error I calculate on the final model is significantly different from what the ValidationMonitor reports as the best validation error. To narrow the problem I set <code>early_stopping_rounds = 1</code> but even then the difference between the \"best\" validation error and the one calculated on the final model was too large. Large enough to make the early stopping feature unusable for my case.</p>\n<p>I tracked the issue down to the fact that ValidationMonitor calculates the validation error without disabling dropouts, which is why the results were so different from what you'd get from calling model.predict(). I implemented a fix here.</p>\n<p>I'd appreciate it if one of the maintainers reviews it and confirms that it's the right fix. If so, I'll create a pull request.</p>\n<p><a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/waleedka/tensorflow/commit/ee095f83ffedf2e2cefff126b76191ab691d5097/hovercard\" href=\"https://github.com/waleedka/tensorflow/commit/ee095f83ffedf2e2cefff126b76191ab691d5097\">waleedka@<tt>ee095f8</tt></a></p>", "body_text": "I'm training a custom CNN model that uses dropout for regularization. I'm using tf-learn r0.8 (skflow)  ValidationMonitor as follows.\nfrom tensorflow.contrib.learn.python.learn import monitors\nm = monitors.ValidationMonitor(X_validate, Y_validate, 0, print_steps=100, \n    early_stopping_rounds=500)\nregressor.fit(X_train, Y_train, monitor=monitor)\nI noticed that after early stopping is triggered, the validation error I calculate on the final model is significantly different from what the ValidationMonitor reports as the best validation error. To narrow the problem I set early_stopping_rounds = 1 but even then the difference between the \"best\" validation error and the one calculated on the final model was too large. Large enough to make the early stopping feature unusable for my case.\nI tracked the issue down to the fact that ValidationMonitor calculates the validation error without disabling dropouts, which is why the results were so different from what you'd get from calling model.predict(). I implemented a fix here.\nI'd appreciate it if one of the maintainers reviews it and confirms that it's the right fix. If so, I'll create a pull request.\nwaleedka@ee095f8", "body": "I'm training a custom CNN model that uses dropout for regularization. I'm using tf-learn r0.8 (skflow)  ValidationMonitor as follows.\n\n``` Python\nfrom tensorflow.contrib.learn.python.learn import monitors\nm = monitors.ValidationMonitor(X_validate, Y_validate, 0, print_steps=100, \n    early_stopping_rounds=500)\nregressor.fit(X_train, Y_train, monitor=monitor)\n```\n\nI noticed that after early stopping is triggered, the validation error I calculate on the final model is significantly different from what the ValidationMonitor reports as the best validation error. To narrow the problem I set `early_stopping_rounds = 1` but even then the difference between the \"best\" validation error and the one calculated on the final model was too large. Large enough to make the early stopping feature unusable for my case.\n\nI tracked the issue down to the fact that ValidationMonitor calculates the validation error without disabling dropouts, which is why the results were so different from what you'd get from calling model.predict(). I implemented a fix here. \n\nI'd appreciate it if one of the maintainers reviews it and confirms that it's the right fix. If so, I'll create a pull request. \n\nhttps://github.com/waleedka/tensorflow/commit/ee095f83ffedf2e2cefff126b76191ab691d5097\n"}