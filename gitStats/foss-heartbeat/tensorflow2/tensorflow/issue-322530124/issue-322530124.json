{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19250", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19250/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19250/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19250/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/19250", "id": 322530124, "node_id": "MDU6SXNzdWUzMjI1MzAxMjQ=", "number": 19250, "title": "In eager model, tfe.Checkpoint does not restore Variables that are not instance properties of tf.keras.Model instance", "user": {"login": "hujunxianligong", "id": 3381345, "node_id": "MDQ6VXNlcjMzODEzNDU=", "avatar_url": "https://avatars0.githubusercontent.com/u/3381345?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hujunxianligong", "html_url": "https://github.com/hujunxianligong", "followers_url": "https://api.github.com/users/hujunxianligong/followers", "following_url": "https://api.github.com/users/hujunxianligong/following{/other_user}", "gists_url": "https://api.github.com/users/hujunxianligong/gists{/gist_id}", "starred_url": "https://api.github.com/users/hujunxianligong/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hujunxianligong/subscriptions", "organizations_url": "https://api.github.com/users/hujunxianligong/orgs", "repos_url": "https://api.github.com/users/hujunxianligong/repos", "events_url": "https://api.github.com/users/hujunxianligong/events{/privacy}", "received_events_url": "https://api.github.com/users/hujunxianligong/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "allenlavoie", "id": 3731025, "node_id": "MDQ6VXNlcjM3MzEwMjU=", "avatar_url": "https://avatars3.githubusercontent.com/u/3731025?v=4", "gravatar_id": "", "url": "https://api.github.com/users/allenlavoie", "html_url": "https://github.com/allenlavoie", "followers_url": "https://api.github.com/users/allenlavoie/followers", "following_url": "https://api.github.com/users/allenlavoie/following{/other_user}", "gists_url": "https://api.github.com/users/allenlavoie/gists{/gist_id}", "starred_url": "https://api.github.com/users/allenlavoie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/allenlavoie/subscriptions", "organizations_url": "https://api.github.com/users/allenlavoie/orgs", "repos_url": "https://api.github.com/users/allenlavoie/repos", "events_url": "https://api.github.com/users/allenlavoie/events{/privacy}", "received_events_url": "https://api.github.com/users/allenlavoie/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "allenlavoie", "id": 3731025, "node_id": "MDQ6VXNlcjM3MzEwMjU=", "avatar_url": "https://avatars3.githubusercontent.com/u/3731025?v=4", "gravatar_id": "", "url": "https://api.github.com/users/allenlavoie", "html_url": "https://github.com/allenlavoie", "followers_url": "https://api.github.com/users/allenlavoie/followers", "following_url": "https://api.github.com/users/allenlavoie/following{/other_user}", "gists_url": "https://api.github.com/users/allenlavoie/gists{/gist_id}", "starred_url": "https://api.github.com/users/allenlavoie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/allenlavoie/subscriptions", "organizations_url": "https://api.github.com/users/allenlavoie/orgs", "repos_url": "https://api.github.com/users/allenlavoie/repos", "events_url": "https://api.github.com/users/allenlavoie/events{/privacy}", "received_events_url": "https://api.github.com/users/allenlavoie/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2018-05-12T17:50:32Z", "updated_at": "2018-05-30T21:59:32Z", "closed_at": "2018-05-30T21:59:32Z", "author_association": "NONE", "body_html": "<h2>System information</h2>\n<ul>\n<li>Have I written custom code : Yes</li>\n<li>OS Platform and Distribution: Win7 X64</li>\n<li>TensorFlow installed from (source or binary): binary</li>\n<li>TensorFlow version (use command below): 1.8.0.dev20180329</li>\n<li>Python version: 3.5</li>\n<li>Bazel version (if compiling from source): N/A</li>\n<li>GCC/Compiler version (if compiling from source):N/A</li>\n<li>CUDA/cuDNN version: N/A</li>\n<li>GPU model and memory: N/A</li>\n<li>Exact command to reproduce: N/A</li>\n</ul>\n<h2>Problem</h2>\n<p>I wrote a Text CNN in eager model:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">class</span> <span class=\"pl-en\">TextCnn</span>(<span class=\"pl-e\">tf</span>.<span class=\"pl-e\">keras</span>.<span class=\"pl-e\">Model</span>):\n    <span class=\"pl-k\">def</span> <span class=\"pl-c1\">__init__</span>(<span class=\"pl-smi\"><span class=\"pl-smi\">self</span></span>):\n        <span class=\"pl-c1\">......</span>\n        <span class=\"pl-c1\">self</span>.conv_funcs <span class=\"pl-k\">=</span> [tf.layers.Conv2D(filter_num,\n                                            [filter_size, embedding_size],\n                                            <span class=\"pl-v\">activation</span><span class=\"pl-k\">=</span>tf.nn.relu,\n                                            <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>conv_<span class=\"pl-c1\">{}</span><span class=\"pl-pds\">'</span></span>.format(filter_size))\n                           <span class=\"pl-k\">for</span> filter_size, filter_num <span class=\"pl-k\">in</span> filter_size_num_list]\n</pre></div>\n<p>I set the list of Conv2D layers as an instance property(self.conv_funcs), and when I restore the model by tfe.Checkpoint, the weights of the Conv2D layers are not restored.</p>\n<p>However, I add the following code and the tfe.Checkpoint successfully restore the weights of the Conv2D layers:</p>\n<div class=\"highlight highlight-source-python\"><pre>        <span class=\"pl-c1\">self</span>.conv_2 <span class=\"pl-k\">=</span> <span class=\"pl-c1\">self</span>.conv_funcs[<span class=\"pl-c1\">0</span>]\n        <span class=\"pl-c1\">self</span>.conv_3 <span class=\"pl-k\">=</span> <span class=\"pl-c1\">self</span>.conv_funcs[<span class=\"pl-c1\">1</span>] </pre></div>\n<p>Is it a bug that tfe.Checkpoint only restore the weights of instance properties of tf.keras.Model?</p>", "body_text": "System information\n\nHave I written custom code : Yes\nOS Platform and Distribution: Win7 X64\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below): 1.8.0.dev20180329\nPython version: 3.5\nBazel version (if compiling from source): N/A\nGCC/Compiler version (if compiling from source):N/A\nCUDA/cuDNN version: N/A\nGPU model and memory: N/A\nExact command to reproduce: N/A\n\nProblem\nI wrote a Text CNN in eager model:\nclass TextCnn(tf.keras.Model):\n    def __init__(self):\n        ......\n        self.conv_funcs = [tf.layers.Conv2D(filter_num,\n                                            [filter_size, embedding_size],\n                                            activation=tf.nn.relu,\n                                            name='conv_{}'.format(filter_size))\n                           for filter_size, filter_num in filter_size_num_list]\n\nI set the list of Conv2D layers as an instance property(self.conv_funcs), and when I restore the model by tfe.Checkpoint, the weights of the Conv2D layers are not restored.\nHowever, I add the following code and the tfe.Checkpoint successfully restore the weights of the Conv2D layers:\n        self.conv_2 = self.conv_funcs[0]\n        self.conv_3 = self.conv_funcs[1] \nIs it a bug that tfe.Checkpoint only restore the weights of instance properties of tf.keras.Model?", "body": "## System information\r\n\r\n+ Have I written custom code : Yes\r\n+ OS Platform and Distribution: Win7 X64\r\n+ TensorFlow installed from (source or binary): binary\r\n+ TensorFlow version (use command below): 1.8.0.dev20180329\r\n+ Python version: 3.5\r\n+ Bazel version (if compiling from source): N/A\r\n+ GCC/Compiler version (if compiling from source):N/A\r\n+ CUDA/cuDNN version: N/A\r\n+ GPU model and memory: N/A\r\n+ Exact command to reproduce: N/A \r\n\r\n\r\n## Problem\r\n\r\nI wrote a Text CNN in eager model:\r\n```python\r\nclass TextCnn(tf.keras.Model):\r\n    def __init__(self):\r\n        ......\r\n        self.conv_funcs = [tf.layers.Conv2D(filter_num,\r\n                                            [filter_size, embedding_size],\r\n                                            activation=tf.nn.relu,\r\n                                            name='conv_{}'.format(filter_size))\r\n                           for filter_size, filter_num in filter_size_num_list]\r\n\r\n```\r\nI set the list of Conv2D layers as an instance property(self.conv_funcs), and when I restore the model by tfe.Checkpoint, the weights of the Conv2D layers are not restored.\r\n\r\nHowever, I add the following code and the tfe.Checkpoint successfully restore the weights of the Conv2D layers:\r\n```python\r\n        self.conv_2 = self.conv_funcs[0]\r\n        self.conv_3 = self.conv_funcs[1] \r\n```\r\n\r\nIs it a bug that tfe.Checkpoint only restore the weights of instance properties of tf.keras.Model?\r\n"}