{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17983", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17983/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17983/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17983/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/17983", "id": 308332222, "node_id": "MDU6SXNzdWUzMDgzMzIyMjI=", "number": 17983, "title": "OpKernel   for unknown op: HashTable  And   incompatible with expected float_ref", "user": {"login": "jw2100", "id": 25952087, "node_id": "MDQ6VXNlcjI1OTUyMDg3", "avatar_url": "https://avatars0.githubusercontent.com/u/25952087?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jw2100", "html_url": "https://github.com/jw2100", "followers_url": "https://api.github.com/users/jw2100/followers", "following_url": "https://api.github.com/users/jw2100/following{/other_user}", "gists_url": "https://api.github.com/users/jw2100/gists{/gist_id}", "starred_url": "https://api.github.com/users/jw2100/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jw2100/subscriptions", "organizations_url": "https://api.github.com/users/jw2100/orgs", "repos_url": "https://api.github.com/users/jw2100/repos", "events_url": "https://api.github.com/users/jw2100/events{/privacy}", "received_events_url": "https://api.github.com/users/jw2100/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "tatatodd", "id": 5453737, "node_id": "MDQ6VXNlcjU0NTM3Mzc=", "avatar_url": "https://avatars3.githubusercontent.com/u/5453737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tatatodd", "html_url": "https://github.com/tatatodd", "followers_url": "https://api.github.com/users/tatatodd/followers", "following_url": "https://api.github.com/users/tatatodd/following{/other_user}", "gists_url": "https://api.github.com/users/tatatodd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tatatodd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tatatodd/subscriptions", "organizations_url": "https://api.github.com/users/tatatodd/orgs", "repos_url": "https://api.github.com/users/tatatodd/repos", "events_url": "https://api.github.com/users/tatatodd/events{/privacy}", "received_events_url": "https://api.github.com/users/tatatodd/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "tatatodd", "id": 5453737, "node_id": "MDQ6VXNlcjU0NTM3Mzc=", "avatar_url": "https://avatars3.githubusercontent.com/u/5453737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tatatodd", "html_url": "https://github.com/tatatodd", "followers_url": "https://api.github.com/users/tatatodd/followers", "following_url": "https://api.github.com/users/tatatodd/following{/other_user}", "gists_url": "https://api.github.com/users/tatatodd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tatatodd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tatatodd/subscriptions", "organizations_url": "https://api.github.com/users/tatatodd/orgs", "repos_url": "https://api.github.com/users/tatatodd/repos", "events_url": "https://api.github.com/users/tatatodd/events{/privacy}", "received_events_url": "https://api.github.com/users/tatatodd/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2018-03-25T08:32:45Z", "updated_at": "2018-04-01T10:23:29Z", "closed_at": "2018-04-01T10:23:29Z", "author_association": "NONE", "body_html": "<p>OS Platform : Cestos7<br>\npython:2.7<br>\ngcc:4.8<br>\nTensorFlow installed from source<br>\ntf version :  ('v1.4.0-19-ga52c8d9', '1.4.1')<br>\nBazel version:N/A<br>\nCUDA Version 8.0.61<br>\nCUDNN_MAJOR  : 6<br>\nGPU model and memory: 22912MiB*4<br>\nExact command to reproduce:</p>\n<p>freeze:CUDA_VISIBLE_DEVICES=\"1\" python freeze_graph.py --checkpoint_dir='./models/dpner/checkpoints/' --graph_pb='./models/dpner/checkpoints/graph.pb' --output_node_names='forward/unary_scores/shape,forward/unary_scores,loss/transitions,loss/transitions/Assign,loss/transitions/read' --output_dir='./models'</p>\n<hr>\n<p>2018-03-25 07:49:05.497590: E tensorflow/core/framework/op_kernel.cc:1197] OpKernel ('op: \"LeftShift\" device_type: \"CPU\" constraint { name: \"T\" allowed_values { list { type: DT_INT8 } } }') for unknown op: LeftShift<br>\n2018-03-25 07:49:05.497623: E tensorflow/core/framework/op_kernel.cc:1197] OpKernel ('op: \"LookupTableInsert\" device_type: \"CPU\"') for unknown op: LookupTableInsert<br>\n2018-03-25 07:49:05.497679: E tensorflow/core/framework/op_kernel.cc:1197] OpKernel ('op: \"HashTable\" device_type: \"CPU\" constraint { name: \"key_dtype\" allowed_values { list { type: DT_INT32 } } } constraint { name: \"value_dtype\" allowed_values { list { type: DT_INT32 } } }') for unknown op: HashTable</p>\n<hr>\n<p>Invalid argument: Input 0 of node loss/transitions/Assign was passed float from loss/transitions:0 incompatible with expected float_ref.</p>\n<hr>\n<p><strong>In my model</strong>:</p>\n<p>all variable is similar</p>\n<p>`with tf.variable_scope(\"softmax\") as scope:<br>\nself.W = tf.get_variable(<br>\nshape=[hidden_dim * 2, num_classes],<br>\ninitializer=tf.truncated_normal_initializer(stddev=0.01),<br>\nname=\"weights\",<br>\nregularizer=tf.contrib.layers.l2_regularizer(self.l2_reg_lambda))</p>\n<p>saver = tf.train.Saver(tf.global_variables())</p>\n<p>saver.save(sess, checkpoint_prefix, global_step=current_step)<br>\n`</p>\n<p><strong>In freeze</strong>,<br>\n<a href=\"https://github.com/tensorflow/tensorflow/files/1845141/freeze_graph.py.log\">freeze_graph.py.log</a></p>\n<p>and <em><strong>in c++</strong></em> is :<br>\n`<br>\nSession* session;</p>\n<p>Status status = NewSession(SessionOptions(), &amp;session);</p>\n<p>GraphDef graph_def;</p>\n<p>status = ReadBinaryProto(Env::Default(),  path, &amp;graph_def);</p>\n<p>status = session-&gt;Create(graph_def);<br>\n`</p>\n<hr>", "body_text": "OS Platform : Cestos7\npython:2.7\ngcc:4.8\nTensorFlow installed from source\ntf version :  ('v1.4.0-19-ga52c8d9', '1.4.1')\nBazel version:N/A\nCUDA Version 8.0.61\nCUDNN_MAJOR  : 6\nGPU model and memory: 22912MiB*4\nExact command to reproduce:\nfreeze:CUDA_VISIBLE_DEVICES=\"1\" python freeze_graph.py --checkpoint_dir='./models/dpner/checkpoints/' --graph_pb='./models/dpner/checkpoints/graph.pb' --output_node_names='forward/unary_scores/shape,forward/unary_scores,loss/transitions,loss/transitions/Assign,loss/transitions/read' --output_dir='./models'\n\n2018-03-25 07:49:05.497590: E tensorflow/core/framework/op_kernel.cc:1197] OpKernel ('op: \"LeftShift\" device_type: \"CPU\" constraint { name: \"T\" allowed_values { list { type: DT_INT8 } } }') for unknown op: LeftShift\n2018-03-25 07:49:05.497623: E tensorflow/core/framework/op_kernel.cc:1197] OpKernel ('op: \"LookupTableInsert\" device_type: \"CPU\"') for unknown op: LookupTableInsert\n2018-03-25 07:49:05.497679: E tensorflow/core/framework/op_kernel.cc:1197] OpKernel ('op: \"HashTable\" device_type: \"CPU\" constraint { name: \"key_dtype\" allowed_values { list { type: DT_INT32 } } } constraint { name: \"value_dtype\" allowed_values { list { type: DT_INT32 } } }') for unknown op: HashTable\n\nInvalid argument: Input 0 of node loss/transitions/Assign was passed float from loss/transitions:0 incompatible with expected float_ref.\n\nIn my model:\nall variable is similar\n`with tf.variable_scope(\"softmax\") as scope:\nself.W = tf.get_variable(\nshape=[hidden_dim * 2, num_classes],\ninitializer=tf.truncated_normal_initializer(stddev=0.01),\nname=\"weights\",\nregularizer=tf.contrib.layers.l2_regularizer(self.l2_reg_lambda))\nsaver = tf.train.Saver(tf.global_variables())\nsaver.save(sess, checkpoint_prefix, global_step=current_step)\n`\nIn freeze,\nfreeze_graph.py.log\nand in c++ is :\n`\nSession* session;\nStatus status = NewSession(SessionOptions(), &session);\nGraphDef graph_def;\nstatus = ReadBinaryProto(Env::Default(),  path, &graph_def);\nstatus = session->Create(graph_def);\n`", "body": "OS Platform : Cestos7\r\npython:2.7\r\ngcc:4.8\r\nTensorFlow installed from source \r\ntf version :  ('v1.4.0-19-ga52c8d9', '1.4.1')\r\nBazel version:N/A\r\nCUDA Version 8.0.61\r\nCUDNN_MAJOR  : 6\r\nGPU model and memory: 22912MiB*4\r\nExact command to reproduce:\r\n\r\nfreeze:CUDA_VISIBLE_DEVICES=\"1\" python freeze_graph.py --checkpoint_dir='./models/dpner/checkpoints/' --graph_pb='./models/dpner/checkpoints/graph.pb' --output_node_names='forward/unary_scores/shape,forward/unary_scores,loss/transitions,loss/transitions/Assign,loss/transitions/read' --output_dir='./models'\r\n\r\n-----------------------------------------------\r\n\r\n2018-03-25 07:49:05.497590: E tensorflow/core/framework/op_kernel.cc:1197] OpKernel ('op: \"LeftShift\" device_type: \"CPU\" constraint { name: \"T\" allowed_values { list { type: DT_INT8 } } }') for unknown op: LeftShift\r\n2018-03-25 07:49:05.497623: E tensorflow/core/framework/op_kernel.cc:1197] OpKernel ('op: \"LookupTableInsert\" device_type: \"CPU\"') for unknown op: LookupTableInsert\r\n2018-03-25 07:49:05.497679: E tensorflow/core/framework/op_kernel.cc:1197] OpKernel ('op: \"HashTable\" device_type: \"CPU\" constraint { name: \"key_dtype\" allowed_values { list { type: DT_INT32 } } } constraint { name: \"value_dtype\" allowed_values { list { type: DT_INT32 } } }') for unknown op: HashTable\r\n\r\n\r\n---------------------------------------------\r\n\r\n\r\nInvalid argument: Input 0 of node loss/transitions/Assign was passed float from loss/transitions:0 incompatible with expected float_ref.\r\n\r\n\r\n---------------------------------------------\r\n\r\n**In my model**: \r\n\r\nall variable is similar\r\n\r\n`with tf.variable_scope(\"softmax\") as scope:\r\n            self.W = tf.get_variable(\r\n                shape=[hidden_dim * 2, num_classes], \r\n                initializer=tf.truncated_normal_initializer(stddev=0.01), \r\n                name=\"weights\",\r\n                regularizer=tf.contrib.layers.l2_regularizer(self.l2_reg_lambda))\r\n\r\nsaver = tf.train.Saver(tf.global_variables())\r\n\r\nsaver.save(sess, checkpoint_prefix, global_step=current_step)\r\n`\r\n\r\n**In freeze**, \r\n[freeze_graph.py.log](https://github.com/tensorflow/tensorflow/files/1845141/freeze_graph.py.log)\r\n\r\nand _**in c++**_ is :\r\n`\r\nSession* session;\r\n\r\nStatus status = NewSession(SessionOptions(), &session);\r\n\r\nGraphDef graph_def;\r\n\r\nstatus = ReadBinaryProto(Env::Default(),  path, &graph_def);\r\n\r\nstatus = session->Create(graph_def);\r\n`\r\n\r\n\r\n----------------------------------------------------\r\n\r\n"}