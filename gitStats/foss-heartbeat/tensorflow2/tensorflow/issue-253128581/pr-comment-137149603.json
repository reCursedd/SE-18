{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/137149603", "pull_request_review_id": 60705185, "id": 137149603, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzNzE0OTYwMw==", "diff_hunk": "@@ -98,6 +98,60 @@ public static void saveBitmap(final Bitmap bitmap, final String filename) {\n   // Always prefer the native implementation if available.\n   private static boolean useNativeConversion = true;\n \n+  public static void convertYUV420SPToARGB8888(\n+      byte[] input,\n+      int[] output,\n+      int width,\n+      int height) {\n+\n+    if (useNativeConversion) {\n+      try {\n+        ImageUtils.convertYUV420SPToARGB8888(input, output, width, height, false);\n+        return;\n+      } catch (UnsatisfiedLinkError e) {\n+        LOGGER.w(\"Native YUV420SP -> RGB implementation not found, falling back to Java implementation\");\n+        useNativeConversion = false;\n+      }\n+    }\n+\n+    // Java implementation of YUV420SP to ARGB8888 converting\n+    final int frameSize = width * height;\n+    for (int j = 0, yp = 0; j < height; j++) {\n+      int uvp = frameSize + (j >> 1) * width, u = 0, v = 0;\n+      for (int i = 0; i < width; i++, yp++) {\n+        int y = (0xff & ((int) input[yp])) - 16;\n+        if (y < 0)\n+          y = 0;\n+        if ((i & 1) == 0) {\n+          v = (0xff & input[uvp++]) - 128;\n+          u = (0xff & input[uvp++]) - 128;\n+        }\n+\n+        int y1192 = 1192 * y;", "path": "tensorflow/examples/android/src/org/tensorflow/demo/env/ImageUtils.java", "position": null, "original_position": 33, "commit_id": "0e2b975c9e112dd10a5739a84c49362921b57176", "original_commit_id": "88ce1937ee201ce816791f390d149d6d202a0a3a", "user": {"login": "andrewharp", "id": 3376817, "node_id": "MDQ6VXNlcjMzNzY4MTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/3376817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewharp", "html_url": "https://github.com/andrewharp", "followers_url": "https://api.github.com/users/andrewharp/followers", "following_url": "https://api.github.com/users/andrewharp/following{/other_user}", "gists_url": "https://api.github.com/users/andrewharp/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewharp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewharp/subscriptions", "organizations_url": "https://api.github.com/users/andrewharp/orgs", "repos_url": "https://api.github.com/users/andrewharp/repos", "events_url": "https://api.github.com/users/andrewharp/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewharp/received_events", "type": "User", "site_admin": false}, "body": "It seems like everything from here to the bottom of the loop can be shared between both conversion functions in a common helper method. The only difference between the two conversion types should be how it initializes the y,u,v variables per output pixel.", "created_at": "2017-09-06T00:50:26Z", "updated_at": "2017-09-06T21:07:38Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/12622#discussion_r137149603", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12622", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/137149603"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/12622#discussion_r137149603"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12622"}}, "body_html": "<p>It seems like everything from here to the bottom of the loop can be shared between both conversion functions in a common helper method. The only difference between the two conversion types should be how it initializes the y,u,v variables per output pixel.</p>", "body_text": "It seems like everything from here to the bottom of the loop can be shared between both conversion functions in a common helper method. The only difference between the two conversion types should be how it initializes the y,u,v variables per output pixel."}