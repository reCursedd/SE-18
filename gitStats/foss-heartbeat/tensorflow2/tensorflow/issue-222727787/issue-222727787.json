{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9310", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9310/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9310/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9310/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/9310", "id": 222727787, "node_id": "MDU6SXNzdWUyMjI3Mjc3ODc=", "number": 9310, "title": "Is tf.train.import_meta_graph() contextual with tf.global[local]_variables_initializer() ?", "user": {"login": "MaeThird", "id": 14851411, "node_id": "MDQ6VXNlcjE0ODUxNDEx", "avatar_url": "https://avatars2.githubusercontent.com/u/14851411?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MaeThird", "html_url": "https://github.com/MaeThird", "followers_url": "https://api.github.com/users/MaeThird/followers", "following_url": "https://api.github.com/users/MaeThird/following{/other_user}", "gists_url": "https://api.github.com/users/MaeThird/gists{/gist_id}", "starred_url": "https://api.github.com/users/MaeThird/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MaeThird/subscriptions", "organizations_url": "https://api.github.com/users/MaeThird/orgs", "repos_url": "https://api.github.com/users/MaeThird/repos", "events_url": "https://api.github.com/users/MaeThird/events{/privacy}", "received_events_url": "https://api.github.com/users/MaeThird/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-04-19T12:51:38Z", "updated_at": "2017-04-22T14:08:29Z", "closed_at": "2017-04-22T14:08:29Z", "author_association": "NONE", "body_html": "<p><strong>I can use these pieces of codes to continue my training with pre-trained model</strong>:</p>\n<pre><code> tf.reset_default_graph() \n new_saver = tf.train.import_meta_graph(\"xxx.meta\")\n new_saver.restore(sess, \"xxx.ckpt-yyy\")\n</code></pre>\n<p>Here the 'tf.reset_default_graph() is necessary'  to solve the 'redefine of ops' issues.But,<strong>when I  launched  forward pass(in another .py file) like</strong> :</p>\n<pre><code> tf.reset_default_graph() \n new_saver = tf.train.import_meta_graph(\"xxx.meta\")\n new_saver.restore(sess, \"xxx.ckpt-yyy\")\n images_placeholder = tf.get_default_graph().get_tensor_by_name(\"image_batch:0\")\n embeddings = tf.get_default_graph().get_tensor_by_name(\"embeddings:0\")\n</code></pre>\n<p><strong>with 'tf.reset_default_graph()' I got</strong> :<br>\n\"Cannot interpret feed_dict key as Tensor: The name 'save/Const:0' refers to a Tensor which does not exist. The operation, 'save/Const', does not exist in the graph\"<br>\n<strong>without 'tf.reset_default_graph()'  and with 'tf.global[local]_variables_initializer()' before or without it</strong> like:</p>\n<pre><code>sess.run(tf.global_variables_initializer())\nsess.run(tf.local_variables_initializer())\n new_saver = tf.train.import_meta_graph(\"xxx.meta\")\n new_saver.restore(sess, \"xxx.ckpt-yyy\")\n images_placeholder = tf.get_default_graph().get_tensor_by_name(\"image_batch:0\")\n embeddings = tf.get_default_graph().get_tensor_by_name(\"embeddings:0\")\n</code></pre>\n<p>#Without initializer<br>\n#sess.run(tf.global_variables_initializer())<br>\n#sess.run(tf.local_variables_initializer())<br>\nnew_saver = tf.train.import_meta_graph(\"xxx.meta\")<br>\nnew_saver.restore(sess, \"xxx.ckpt-yyy\")<br>\nimages_placeholder = tf.get_default_graph().get_tensor_by_name(\"image_batch:0\")<br>\nembeddings = tf.get_default_graph().get_tensor_by_name(\"embeddings:0\")</p>\n<p>I got : \"<strong>FailedPreconditionError: Attempting to use uninitialized value...</strong>\".But like:<br>\nnew_saver = tf.train.import_meta_graph(\"xxx.meta\")<br>\nnew_saver.restore(sess, \"xxx.ckpt-yyy\")<br>\nsess.run(tf.global_variables_initializer())<br>\nsess.run(tf.local_variables_initializer())<br>\nimages_placeholder = tf.get_default_graph().get_tensor_by_name(\"image_batch:0\")<br>\nembeddings = tf.get_default_graph().get_tensor_by_name(\"embeddings:0\")<br>\nI got neither warnings nor errors info,but the result is all features of embeddings is 0.Maybe 'tf.global[local]<em>variables_initializer()' has cleared the loaded weights ?<br>\nAfter that I <strong>used the  frozen graph which was produced by pre-trained model to launch forward,like</strong>:<br>\nwith tf.Graph().as_default():<br>\ngraph_def</em> = graph_pb2.GraphDef()<br>\nprint('Model directory: %s' % os.path.expanduser(args.modelpb_file))<br>\nwith open(os.path.expanduser(args.modelpb_file),'rb') as f:<br>\ngraph_def_.ParseFromString(f.read())<br>\n_ = importer.import_graph_def(graph_def_,name=\"\")<br>\nwith tf.Session() as sess:<br>\nimages_placeholder = tf.get_default_graph().get_tensor_by_name(\"image_batch:0\")<br>\nembeddings = tf.get_default_graph().get_tensor_by_name(\"embeddings:0\")<br>\nI still got the \"<strong>FailedPreconditionError: Attempting to use uninitialized value...</strong>\" issues.<br>\nReally confusing,who can help ?</p>", "body_text": "I can use these pieces of codes to continue my training with pre-trained model:\n tf.reset_default_graph() \n new_saver = tf.train.import_meta_graph(\"xxx.meta\")\n new_saver.restore(sess, \"xxx.ckpt-yyy\")\n\nHere the 'tf.reset_default_graph() is necessary'  to solve the 'redefine of ops' issues.But,when I  launched  forward pass(in another .py file) like :\n tf.reset_default_graph() \n new_saver = tf.train.import_meta_graph(\"xxx.meta\")\n new_saver.restore(sess, \"xxx.ckpt-yyy\")\n images_placeholder = tf.get_default_graph().get_tensor_by_name(\"image_batch:0\")\n embeddings = tf.get_default_graph().get_tensor_by_name(\"embeddings:0\")\n\nwith 'tf.reset_default_graph()' I got :\n\"Cannot interpret feed_dict key as Tensor: The name 'save/Const:0' refers to a Tensor which does not exist. The operation, 'save/Const', does not exist in the graph\"\nwithout 'tf.reset_default_graph()'  and with 'tf.global[local]_variables_initializer()' before or without it like:\nsess.run(tf.global_variables_initializer())\nsess.run(tf.local_variables_initializer())\n new_saver = tf.train.import_meta_graph(\"xxx.meta\")\n new_saver.restore(sess, \"xxx.ckpt-yyy\")\n images_placeholder = tf.get_default_graph().get_tensor_by_name(\"image_batch:0\")\n embeddings = tf.get_default_graph().get_tensor_by_name(\"embeddings:0\")\n\n#Without initializer\n#sess.run(tf.global_variables_initializer())\n#sess.run(tf.local_variables_initializer())\nnew_saver = tf.train.import_meta_graph(\"xxx.meta\")\nnew_saver.restore(sess, \"xxx.ckpt-yyy\")\nimages_placeholder = tf.get_default_graph().get_tensor_by_name(\"image_batch:0\")\nembeddings = tf.get_default_graph().get_tensor_by_name(\"embeddings:0\")\nI got : \"FailedPreconditionError: Attempting to use uninitialized value...\".But like:\nnew_saver = tf.train.import_meta_graph(\"xxx.meta\")\nnew_saver.restore(sess, \"xxx.ckpt-yyy\")\nsess.run(tf.global_variables_initializer())\nsess.run(tf.local_variables_initializer())\nimages_placeholder = tf.get_default_graph().get_tensor_by_name(\"image_batch:0\")\nembeddings = tf.get_default_graph().get_tensor_by_name(\"embeddings:0\")\nI got neither warnings nor errors info,but the result is all features of embeddings is 0.Maybe 'tf.global[local]variables_initializer()' has cleared the loaded weights ?\nAfter that I used the  frozen graph which was produced by pre-trained model to launch forward,like:\nwith tf.Graph().as_default():\ngraph_def = graph_pb2.GraphDef()\nprint('Model directory: %s' % os.path.expanduser(args.modelpb_file))\nwith open(os.path.expanduser(args.modelpb_file),'rb') as f:\ngraph_def_.ParseFromString(f.read())\n_ = importer.import_graph_def(graph_def_,name=\"\")\nwith tf.Session() as sess:\nimages_placeholder = tf.get_default_graph().get_tensor_by_name(\"image_batch:0\")\nembeddings = tf.get_default_graph().get_tensor_by_name(\"embeddings:0\")\nI still got the \"FailedPreconditionError: Attempting to use uninitialized value...\" issues.\nReally confusing,who can help ?", "body": "**I can use these pieces of codes to continue my training with pre-trained model**:\r\n\r\n     tf.reset_default_graph() \r\n     new_saver = tf.train.import_meta_graph(\"xxx.meta\")\r\n     new_saver.restore(sess, \"xxx.ckpt-yyy\")\r\n\r\nHere the 'tf.reset_default_graph() is necessary'  to solve the 'redefine of ops' issues.But,**when I  launched  forward pass(in another .py file) like** :\r\n\r\n     tf.reset_default_graph() \r\n     new_saver = tf.train.import_meta_graph(\"xxx.meta\")\r\n     new_saver.restore(sess, \"xxx.ckpt-yyy\")\r\n     images_placeholder = tf.get_default_graph().get_tensor_by_name(\"image_batch:0\")\r\n     embeddings = tf.get_default_graph().get_tensor_by_name(\"embeddings:0\")\r\n\r\n**with 'tf.reset_default_graph()' I got** :\r\n\"Cannot interpret feed_dict key as Tensor: The name 'save/Const:0' refers to a Tensor which does not exist. The operation, 'save/Const', does not exist in the graph\"\r\n**without 'tf.reset_default_graph()'  and with 'tf.global[local]_variables_initializer()' before or without it** like:\r\n\r\n    sess.run(tf.global_variables_initializer())\r\n    sess.run(tf.local_variables_initializer())\r\n     new_saver = tf.train.import_meta_graph(\"xxx.meta\")\r\n     new_saver.restore(sess, \"xxx.ckpt-yyy\")\r\n     images_placeholder = tf.get_default_graph().get_tensor_by_name(\"image_batch:0\")\r\n     embeddings = tf.get_default_graph().get_tensor_by_name(\"embeddings:0\")\r\n #Without initializer\r\n #sess.run(tf.global_variables_initializer())\r\n #sess.run(tf.local_variables_initializer())\r\n     new_saver = tf.train.import_meta_graph(\"xxx.meta\")\r\n     new_saver.restore(sess, \"xxx.ckpt-yyy\")\r\n     images_placeholder = tf.get_default_graph().get_tensor_by_name(\"image_batch:0\")\r\n     embeddings = tf.get_default_graph().get_tensor_by_name(\"embeddings:0\")\r\n\r\nI got : \"**FailedPreconditionError: Attempting to use uninitialized value...**\".But like:\r\n   new_saver = tf.train.import_meta_graph(\"xxx.meta\")\r\n   new_saver.restore(sess, \"xxx.ckpt-yyy\")\r\n    sess.run(tf.global_variables_initializer())\r\n    sess.run(tf.local_variables_initializer())\r\n   images_placeholder = tf.get_default_graph().get_tensor_by_name(\"image_batch:0\")\r\n   embeddings = tf.get_default_graph().get_tensor_by_name(\"embeddings:0\")\r\nI got neither warnings nor errors info,but the result is all features of embeddings is 0.Maybe 'tf.global[local]_variables_initializer()' has cleared the loaded weights ?\r\nAfter that I **used the  frozen graph which was produced by pre-trained model to launch forward,like**:\r\n with tf.Graph().as_default():\r\n        graph_def_ = graph_pb2.GraphDef()\r\n        print('Model directory: %s' % os.path.expanduser(args.modelpb_file))\r\n        with open(os.path.expanduser(args.modelpb_file),'rb') as f:\r\n             graph_def_.ParseFromString(f.read())\r\n             _ = importer.import_graph_def(graph_def_,name=\"\")\r\n        with tf.Session() as sess:         \r\n            images_placeholder = tf.get_default_graph().get_tensor_by_name(\"image_batch:0\")\r\n            embeddings = tf.get_default_graph().get_tensor_by_name(\"embeddings:0\")\r\nI still got the \"**FailedPreconditionError: Attempting to use uninitialized value...**\" issues.\r\nReally confusing,who can help ?\r\n\r\n\r\n"}