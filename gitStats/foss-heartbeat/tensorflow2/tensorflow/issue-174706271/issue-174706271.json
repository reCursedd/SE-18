{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4171", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4171/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4171/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4171/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/4171", "id": 174706271, "node_id": "MDU6SXNzdWUxNzQ3MDYyNzE=", "number": 4171, "title": "distribute tensorflow read data problem", "user": {"login": "haibarasiao", "id": 21122045, "node_id": "MDQ6VXNlcjIxMTIyMDQ1", "avatar_url": "https://avatars0.githubusercontent.com/u/21122045?v=4", "gravatar_id": "", "url": "https://api.github.com/users/haibarasiao", "html_url": "https://github.com/haibarasiao", "followers_url": "https://api.github.com/users/haibarasiao/followers", "following_url": "https://api.github.com/users/haibarasiao/following{/other_user}", "gists_url": "https://api.github.com/users/haibarasiao/gists{/gist_id}", "starred_url": "https://api.github.com/users/haibarasiao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/haibarasiao/subscriptions", "organizations_url": "https://api.github.com/users/haibarasiao/orgs", "repos_url": "https://api.github.com/users/haibarasiao/repos", "events_url": "https://api.github.com/users/haibarasiao/events{/privacy}", "received_events_url": "https://api.github.com/users/haibarasiao/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-09-02T08:24:14Z", "updated_at": "2016-09-05T08:19:41Z", "closed_at": "2016-09-05T08:19:41Z", "author_association": "NONE", "body_html": "<p>Hi,<br>\nwhen I want to build a distribute model with cifar-10  (<a href=\"https://tensorflow.googlesource.com/tensorflow/+/master/tensorflow/models/image/cifar10/\" rel=\"nofollow\">https://tensorflow.googlesource.com/tensorflow/+/master/tensorflow/models/image/cifar10/</a>),<br>\nit hanged at sess.run , I think it is the input queue problem. It can not read image and label from file.<br>\nBut when run with no distribute, everything is OK.<br>\nAny suggestions?</p>\n<p>in train():<br>\nimages, labels = model.distorted_inputs()</p>\n<p>in model.py:<br>\ndef distorted_inputs():<br>\nbatch_size=FLAGS.batch_size)<br>\nif not FLAGS.data_dir:<br>\nraise ValueError('Please supply a data_dir')<br>\ndata_dir = os.path.join(FLAGS.data_dir, '')<br>\nreturn model_input.distorted_inputs(data_dir=data_dir,<br>\nbatch_size=FLAGS.batch_size)</p>\n<p>in model_input.py:<br>\ndef distorted_inputs(data_dir, batch_size):<br>\nfilenames = [os.path.join(data_dir, '%d.bin' % i)<br>\nfor i in xrange(1, 5)]<br>\nfor f in filenames:<br>\nif not gfile.Exists(f):<br>\nraise ValueError('Failed to find file: ' + f)<br>\nfilename_queue = tf.train.string_input_producer(filenames)<br>\nread_input = read_cifar10(filename_queue)<br>\nreshaped_image = tf.cast(read_input.uint8image, tf.float32)<br>\nreshaped_image = tf.Print(reshaped_image, [reshaped_image], 'this is float image')<br>\nmin_fraction_of_examples_in_queue = 0.4<br>\nmin_queue_examples = int(NUM_EXAMPLES_PER_EPOCH_FOR_TRAIN *<br>\nmin_fraction_of_examples_in_queue)<br>\nprint ('Filling queue with %d CIFAR images before starting to train. '<br>\n'This will take a few minutes.' % min_queue_examples)<br>\nreturn _generate_image_and_label_batch(reshaped_image, read_input.label,<br>\nmin_queue_examples, batch_size,test)</p>\n<p>def _generate_image_and_label_batch(image, label, min_queue_examples,<br>\nbatch_size,test):<br>\nnum_preprocess_threads = 16<br>\nimages, label_batch = tf.train.shuffle_batch(<br>\n[image, label],<br>\nbatch_size=batch_size,<br>\nnum_threads=num_preprocess_threads,<br>\ncapacity=min_queue_examples + 3 * batch_size,<br>\nmin_after_dequeue=min_queue_examples)<br>\nreturn images, tf.reshape(label_batch, [batch_size])</p>", "body_text": "Hi,\nwhen I want to build a distribute model with cifar-10  (https://tensorflow.googlesource.com/tensorflow/+/master/tensorflow/models/image/cifar10/),\nit hanged at sess.run , I think it is the input queue problem. It can not read image and label from file.\nBut when run with no distribute, everything is OK.\nAny suggestions?\nin train():\nimages, labels = model.distorted_inputs()\nin model.py:\ndef distorted_inputs():\nbatch_size=FLAGS.batch_size)\nif not FLAGS.data_dir:\nraise ValueError('Please supply a data_dir')\ndata_dir = os.path.join(FLAGS.data_dir, '')\nreturn model_input.distorted_inputs(data_dir=data_dir,\nbatch_size=FLAGS.batch_size)\nin model_input.py:\ndef distorted_inputs(data_dir, batch_size):\nfilenames = [os.path.join(data_dir, '%d.bin' % i)\nfor i in xrange(1, 5)]\nfor f in filenames:\nif not gfile.Exists(f):\nraise ValueError('Failed to find file: ' + f)\nfilename_queue = tf.train.string_input_producer(filenames)\nread_input = read_cifar10(filename_queue)\nreshaped_image = tf.cast(read_input.uint8image, tf.float32)\nreshaped_image = tf.Print(reshaped_image, [reshaped_image], 'this is float image')\nmin_fraction_of_examples_in_queue = 0.4\nmin_queue_examples = int(NUM_EXAMPLES_PER_EPOCH_FOR_TRAIN *\nmin_fraction_of_examples_in_queue)\nprint ('Filling queue with %d CIFAR images before starting to train. '\n'This will take a few minutes.' % min_queue_examples)\nreturn _generate_image_and_label_batch(reshaped_image, read_input.label,\nmin_queue_examples, batch_size,test)\ndef _generate_image_and_label_batch(image, label, min_queue_examples,\nbatch_size,test):\nnum_preprocess_threads = 16\nimages, label_batch = tf.train.shuffle_batch(\n[image, label],\nbatch_size=batch_size,\nnum_threads=num_preprocess_threads,\ncapacity=min_queue_examples + 3 * batch_size,\nmin_after_dequeue=min_queue_examples)\nreturn images, tf.reshape(label_batch, [batch_size])", "body": "Hi,\nwhen I want to build a distribute model with cifar-10  (https://tensorflow.googlesource.com/tensorflow/+/master/tensorflow/models/image/cifar10/),\nit hanged at sess.run , I think it is the input queue problem. It can not read image and label from file.\nBut when run with no distribute, everything is OK.\nAny suggestions?\n\nin train():\nimages, labels = model.distorted_inputs()\n\nin model.py:\ndef distorted_inputs():\n  batch_size=FLAGS.batch_size)\n  if not FLAGS.data_dir:\n    raise ValueError('Please supply a data_dir')\n  data_dir = os.path.join(FLAGS.data_dir, '')\n  return model_input.distorted_inputs(data_dir=data_dir,\n                                        batch_size=FLAGS.batch_size)\n\nin model_input.py:\ndef distorted_inputs(data_dir, batch_size):\n  filenames = [os.path.join(data_dir, '%d.bin' % i)\n               for i in xrange(1, 5)]\n  for f in filenames:\n    if not gfile.Exists(f):\n      raise ValueError('Failed to find file: ' + f)\n  filename_queue = tf.train.string_input_producer(filenames)\n  read_input = read_cifar10(filename_queue)\n  reshaped_image = tf.cast(read_input.uint8image, tf.float32)\n  reshaped_image = tf.Print(reshaped_image, [reshaped_image], 'this is float image')\n  min_fraction_of_examples_in_queue = 0.4\n  min_queue_examples = int(NUM_EXAMPLES_PER_EPOCH_FOR_TRAIN *\n                           min_fraction_of_examples_in_queue)\n  print ('Filling queue with %d CIFAR images before starting to train. '\n         'This will take a few minutes.' % min_queue_examples)\n  return _generate_image_and_label_batch(reshaped_image, read_input.label,\n                                         min_queue_examples, batch_size,test)\n\ndef _generate_image_and_label_batch(image, label, min_queue_examples,\n                                    batch_size,test):\n  num_preprocess_threads = 16\n  images, label_batch = tf.train.shuffle_batch(\n      [image, label],\n      batch_size=batch_size,\n      num_threads=num_preprocess_threads,\n      capacity=min_queue_examples + 3 \\* batch_size,\n      min_after_dequeue=min_queue_examples)\n  return images, tf.reshape(label_batch, [batch_size])\n"}