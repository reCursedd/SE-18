{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2661", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2661/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2661/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2661/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/2661", "id": 158525431, "node_id": "MDU6SXNzdWUxNTg1MjU0MzE=", "number": 2661, "title": "Map/Scan/Fold cannot be nested.", "user": {"login": "KnHuq", "id": 18214937, "node_id": "MDQ6VXNlcjE4MjE0OTM3", "avatar_url": "https://avatars3.githubusercontent.com/u/18214937?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KnHuq", "html_url": "https://github.com/KnHuq", "followers_url": "https://api.github.com/users/KnHuq/followers", "following_url": "https://api.github.com/users/KnHuq/following{/other_user}", "gists_url": "https://api.github.com/users/KnHuq/gists{/gist_id}", "starred_url": "https://api.github.com/users/KnHuq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KnHuq/subscriptions", "organizations_url": "https://api.github.com/users/KnHuq/orgs", "repos_url": "https://api.github.com/users/KnHuq/repos", "events_url": "https://api.github.com/users/KnHuq/events{/privacy}", "received_events_url": "https://api.github.com/users/KnHuq/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473173272, "node_id": "MDU6TGFiZWw0NzMxNzMyNzI=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:feature", "name": "type:feature", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2016-06-04T21:40:33Z", "updated_at": "2017-02-09T22:37:13Z", "closed_at": "2016-06-21T22:44:08Z", "author_association": "NONE", "body_html": "<p>import tensorflow as tf<br>\na=tf.constant([[[1,2,3],[10,20,30]],[[1,2,3],[10,20,30]],[[1,2,3],[10,20,30]],[[1,2,3],[10,20,30]]])</p>\n<p>sess=tf.InteractiveSession()<br>\nprint sess.run(tf.map_fn(lambda x: tf.scan(lambda y,z:tf.add(y,z),x),a))</p>\n<p>ERROR:</p>\n<p>AlreadyExistsError: Resource _tensor_arrays/map_10/while/scan/TensorArray/N10tensorflow11TensorArrayE<br>\n[[Node: map_10/while/scan/TensorArray = TensorArray[clear_after_read=true, dtype=DT_INT32, dynamic_size=false, tensor_array_name=\"\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](map_10/while/scan/Squeeze/_72, ^_cloopmap_10/while/scan/TensorArrayWrite/index/_19)]]<br>\n[[Node: map_10/while/scan/while/Identity/_73 = _HostSend<a href=\"map_10/while/scan/while/Identity\">T=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device_incarnation=1, tensor_name=\"edge_190_map_10/while/scan/while/Identity\", _device=\"/job:localhost/replica:0/task:0/gpu:0\"</a>]]<br>\nCaused by op u'map_10/while/scan/TensorArray', defined at:<br>\nFile \"/usr/lib/python2.7/runpy.py\", line 162, in _run_module_as_main<br>\n\"<strong>main</strong>\", fname, loader, pkg_name)<br>\nFile \"/usr/lib/python2.7/runpy.py\", line 72, in _run_code<br>\nexec code in run_globals<br>\nFile \"/usr/local/lib/python2.7/dist-packages/ipykernel/<strong>main</strong>.py\", line 3, in <br>\napp.launch_new_instance()<br>\nFile \"/usr/local/lib/python2.7/dist-packages/traitlets/config/application.py\", line 589, in launch_instance<br>\napp.start()<br>\nFile \"/usr/local/lib/python2.7/dist-packages/ipykernel/kernelapp.py\", line 405, in start<br>\nioloop.IOLoop.instance().start()<br>\nFile \"/usr/local/lib/python2.7/dist-packages/zmq/eventloop/ioloop.py\", line 162, in start<br>\nsuper(ZMQIOLoop, self).start()<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py\", line 840, in start<br>\nhandler_func(fd_obj, events)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tornado/stack_context.py\", line 275, in null_wrapper<br>\nreturn fn(_args, *_kwargs)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 440, in _handle_events<br>\nself._handle_recv()<br>\nFile \"/usr/local/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 472, in _handle_recv<br>\nself._run_callback(callback, msg)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 414, in _run_callback<br>\ncallback(_args, *_kwargs)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tornado/stack_context.py\", line 275, in null_wrapper<br>\nreturn fn(_args, *_kwargs)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/ipykernel/kernelbase.py\", line 260, in dispatcher<br>\nreturn self.dispatch_shell(stream, msg)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/ipykernel/kernelbase.py\", line 212, in dispatch_shell<br>\nhandler(stream, idents, msg)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/ipykernel/kernelbase.py\", line 370, in execute_request<br>\nuser_expressions, allow_stdin)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/ipykernel/ipkernel.py\", line 175, in do_execute<br>\nshell.run_cell(code, store_history=store_history, silent=silent)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/IPython/core/interactiveshell.py\", line 2723, in run_cell<br>\ninteractivity=interactivity, compiler=compiler, result=result)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/IPython/core/interactiveshell.py\", line 2825, in run_ast_nodes<br>\nif self.run_code(code, result):<br>\nFile \"/usr/local/lib/python2.7/dist-packages/IPython/core/interactiveshell.py\", line 2885, in run_code<br>\nexec(code_obj, self.user_global_ns, self.user_ns)<br>\nFile \"\", line 2, in <br>\nprint sess.run(tf.map_fn(lambda x: tf.scan(lambda y,z:tf.add(y,z),x),a))<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/functional_ops.py\", line 259, in map_fn<br>\nswap_memory=swap_memory)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/control_flow_ops.py\", line 1671, in while_loop<br>\nresult = context.BuildLoop(cond, body, loop_vars)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/control_flow_ops.py\", line 1572, in BuildLoop<br>\nbody_result = body(*vars_for_body_with_tensor_arrays)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/functional_ops.py\", line 253, in compute<br>\nta = ta.write(i, fn(elems_ta.read(i)))<br>\nFile \"\", line 2, in <br>\nprint sess.run(tf.map_fn(lambda x: tf.scan(lambda y,z:tf.add(y,z),x),a))<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/functional_ops.py\", line 319, in scan<br>\ninfer_shape=True)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/tensor_array_ops.py\", line 126, in <strong>init</strong><br>\ntensor_array_name=tensor_array_name, name=scope)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 659, in _tensor_array<br>\ntensor_array_name=tensor_array_name, name=name)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/op_def_library.py\", line 694, in apply_op<br>\nop_def=op_def)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2153, in create_op<br>\noriginal_op=self._default_original_op, op_def=op_def)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1153, in <strong>init</strong><br>\nself._traceback = _extract_stack()</p>", "body_text": "import tensorflow as tf\na=tf.constant([[[1,2,3],[10,20,30]],[[1,2,3],[10,20,30]],[[1,2,3],[10,20,30]],[[1,2,3],[10,20,30]]])\nsess=tf.InteractiveSession()\nprint sess.run(tf.map_fn(lambda x: tf.scan(lambda y,z:tf.add(y,z),x),a))\nERROR:\nAlreadyExistsError: Resource _tensor_arrays/map_10/while/scan/TensorArray/N10tensorflow11TensorArrayE\n[[Node: map_10/while/scan/TensorArray = TensorArray[clear_after_read=true, dtype=DT_INT32, dynamic_size=false, tensor_array_name=\"\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](map_10/while/scan/Squeeze/_72, ^_cloopmap_10/while/scan/TensorArrayWrite/index/_19)]]\n[[Node: map_10/while/scan/while/Identity/_73 = _HostSendT=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device_incarnation=1, tensor_name=\"edge_190_map_10/while/scan/while/Identity\", _device=\"/job:localhost/replica:0/task:0/gpu:0\"]]\nCaused by op u'map_10/while/scan/TensorArray', defined at:\nFile \"/usr/lib/python2.7/runpy.py\", line 162, in _run_module_as_main\n\"main\", fname, loader, pkg_name)\nFile \"/usr/lib/python2.7/runpy.py\", line 72, in _run_code\nexec code in run_globals\nFile \"/usr/local/lib/python2.7/dist-packages/ipykernel/main.py\", line 3, in \napp.launch_new_instance()\nFile \"/usr/local/lib/python2.7/dist-packages/traitlets/config/application.py\", line 589, in launch_instance\napp.start()\nFile \"/usr/local/lib/python2.7/dist-packages/ipykernel/kernelapp.py\", line 405, in start\nioloop.IOLoop.instance().start()\nFile \"/usr/local/lib/python2.7/dist-packages/zmq/eventloop/ioloop.py\", line 162, in start\nsuper(ZMQIOLoop, self).start()\nFile \"/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py\", line 840, in start\nhandler_func(fd_obj, events)\nFile \"/usr/local/lib/python2.7/dist-packages/tornado/stack_context.py\", line 275, in null_wrapper\nreturn fn(_args, *_kwargs)\nFile \"/usr/local/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 440, in _handle_events\nself._handle_recv()\nFile \"/usr/local/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 472, in _handle_recv\nself._run_callback(callback, msg)\nFile \"/usr/local/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 414, in _run_callback\ncallback(_args, *_kwargs)\nFile \"/usr/local/lib/python2.7/dist-packages/tornado/stack_context.py\", line 275, in null_wrapper\nreturn fn(_args, *_kwargs)\nFile \"/usr/local/lib/python2.7/dist-packages/ipykernel/kernelbase.py\", line 260, in dispatcher\nreturn self.dispatch_shell(stream, msg)\nFile \"/usr/local/lib/python2.7/dist-packages/ipykernel/kernelbase.py\", line 212, in dispatch_shell\nhandler(stream, idents, msg)\nFile \"/usr/local/lib/python2.7/dist-packages/ipykernel/kernelbase.py\", line 370, in execute_request\nuser_expressions, allow_stdin)\nFile \"/usr/local/lib/python2.7/dist-packages/ipykernel/ipkernel.py\", line 175, in do_execute\nshell.run_cell(code, store_history=store_history, silent=silent)\nFile \"/usr/local/lib/python2.7/dist-packages/IPython/core/interactiveshell.py\", line 2723, in run_cell\ninteractivity=interactivity, compiler=compiler, result=result)\nFile \"/usr/local/lib/python2.7/dist-packages/IPython/core/interactiveshell.py\", line 2825, in run_ast_nodes\nif self.run_code(code, result):\nFile \"/usr/local/lib/python2.7/dist-packages/IPython/core/interactiveshell.py\", line 2885, in run_code\nexec(code_obj, self.user_global_ns, self.user_ns)\nFile \"\", line 2, in \nprint sess.run(tf.map_fn(lambda x: tf.scan(lambda y,z:tf.add(y,z),x),a))\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/functional_ops.py\", line 259, in map_fn\nswap_memory=swap_memory)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/control_flow_ops.py\", line 1671, in while_loop\nresult = context.BuildLoop(cond, body, loop_vars)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/control_flow_ops.py\", line 1572, in BuildLoop\nbody_result = body(*vars_for_body_with_tensor_arrays)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/functional_ops.py\", line 253, in compute\nta = ta.write(i, fn(elems_ta.read(i)))\nFile \"\", line 2, in \nprint sess.run(tf.map_fn(lambda x: tf.scan(lambda y,z:tf.add(y,z),x),a))\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/functional_ops.py\", line 319, in scan\ninfer_shape=True)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/tensor_array_ops.py\", line 126, in init\ntensor_array_name=tensor_array_name, name=scope)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 659, in _tensor_array\ntensor_array_name=tensor_array_name, name=name)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/op_def_library.py\", line 694, in apply_op\nop_def=op_def)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2153, in create_op\noriginal_op=self._default_original_op, op_def=op_def)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1153, in init\nself._traceback = _extract_stack()", "body": "import tensorflow as tf\na=tf.constant([[[1,2,3],[10,20,30]],[[1,2,3],[10,20,30]],[[1,2,3],[10,20,30]],[[1,2,3],[10,20,30]]])\n\nsess=tf.InteractiveSession()\nprint sess.run(tf.map_fn(lambda x: tf.scan(lambda y,z:tf.add(y,z),x),a))\n\nERROR:\n\nAlreadyExistsError: Resource _tensor_arrays/map_10/while/scan/TensorArray/N10tensorflow11TensorArrayE\n     [[Node: map_10/while/scan/TensorArray = TensorArray[clear_after_read=true, dtype=DT_INT32, dynamic_size=false, tensor_array_name=\"\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](map_10/while/scan/Squeeze/_72, ^_cloopmap_10/while/scan/TensorArrayWrite/index/_19)]]\n     [[Node: map_10/while/scan/while/Identity/_73 = _HostSend[T=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device_incarnation=1, tensor_name=\"edge_190_map_10/while/scan/while/Identity\", _device=\"/job:localhost/replica:0/task:0/gpu:0\"](map_10/while/scan/while/Identity)]]\nCaused by op u'map_10/while/scan/TensorArray', defined at:\n  File \"/usr/lib/python2.7/runpy.py\", line 162, in _run_module_as_main\n    \"__main__\", fname, loader, pkg_name)\n  File \"/usr/lib/python2.7/runpy.py\", line 72, in _run_code\n    exec code in run_globals\n  File \"/usr/local/lib/python2.7/dist-packages/ipykernel/__main__.py\", line 3, in <module>\n    app.launch_new_instance()\n  File \"/usr/local/lib/python2.7/dist-packages/traitlets/config/application.py\", line 589, in launch_instance\n    app.start()\n  File \"/usr/local/lib/python2.7/dist-packages/ipykernel/kernelapp.py\", line 405, in start\n    ioloop.IOLoop.instance().start()\n  File \"/usr/local/lib/python2.7/dist-packages/zmq/eventloop/ioloop.py\", line 162, in start\n    super(ZMQIOLoop, self).start()\n  File \"/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py\", line 840, in start\n    handler_func(fd_obj, events)\n  File \"/usr/local/lib/python2.7/dist-packages/tornado/stack_context.py\", line 275, in null_wrapper\n    return fn(_args, *_kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 440, in _handle_events\n    self._handle_recv()\n  File \"/usr/local/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 472, in _handle_recv\n    self._run_callback(callback, msg)\n  File \"/usr/local/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 414, in _run_callback\n    callback(_args, *_kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/tornado/stack_context.py\", line 275, in null_wrapper\n    return fn(_args, *_kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/ipykernel/kernelbase.py\", line 260, in dispatcher\n    return self.dispatch_shell(stream, msg)\n  File \"/usr/local/lib/python2.7/dist-packages/ipykernel/kernelbase.py\", line 212, in dispatch_shell\n    handler(stream, idents, msg)\n  File \"/usr/local/lib/python2.7/dist-packages/ipykernel/kernelbase.py\", line 370, in execute_request\n    user_expressions, allow_stdin)\n  File \"/usr/local/lib/python2.7/dist-packages/ipykernel/ipkernel.py\", line 175, in do_execute\n    shell.run_cell(code, store_history=store_history, silent=silent)\n  File \"/usr/local/lib/python2.7/dist-packages/IPython/core/interactiveshell.py\", line 2723, in run_cell\n    interactivity=interactivity, compiler=compiler, result=result)\n  File \"/usr/local/lib/python2.7/dist-packages/IPython/core/interactiveshell.py\", line 2825, in run_ast_nodes\n    if self.run_code(code, result):\n  File \"/usr/local/lib/python2.7/dist-packages/IPython/core/interactiveshell.py\", line 2885, in run_code\n    exec(code_obj, self.user_global_ns, self.user_ns)\n  File \"<ipython-input-26-ae3c447b43e3>\", line 2, in <module>\n    print sess.run(tf.map_fn(lambda x: tf.scan(lambda y,z:tf.add(y,z),x),a))\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/functional_ops.py\", line 259, in map_fn\n    swap_memory=swap_memory)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/control_flow_ops.py\", line 1671, in while_loop\n    result = context.BuildLoop(cond, body, loop_vars)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/control_flow_ops.py\", line 1572, in BuildLoop\n    body_result = body(*vars_for_body_with_tensor_arrays)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/functional_ops.py\", line 253, in compute\n    ta = ta.write(i, fn(elems_ta.read(i)))\n  File \"<ipython-input-26-ae3c447b43e3>\", line 2, in <lambda>\n    print sess.run(tf.map_fn(lambda x: tf.scan(lambda y,z:tf.add(y,z),x),a))\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/functional_ops.py\", line 319, in scan\n    infer_shape=True)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/tensor_array_ops.py\", line 126, in __init__\n    tensor_array_name=tensor_array_name, name=scope)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 659, in _tensor_array\n    tensor_array_name=tensor_array_name, name=name)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/op_def_library.py\", line 694, in apply_op\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2153, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1153, in __init__\n    self._traceback = _extract_stack()\n"}