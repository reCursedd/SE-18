{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/378006736", "html_url": "https://github.com/tensorflow/tensorflow/issues/17494#issuecomment-378006736", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17494", "id": 378006736, "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODAwNjczNg==", "user": {"login": "mas-dse-greina", "id": 22306322, "node_id": "MDQ6VXNlcjIyMzA2MzIy", "avatar_url": "https://avatars0.githubusercontent.com/u/22306322?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mas-dse-greina", "html_url": "https://github.com/mas-dse-greina", "followers_url": "https://api.github.com/users/mas-dse-greina/followers", "following_url": "https://api.github.com/users/mas-dse-greina/following{/other_user}", "gists_url": "https://api.github.com/users/mas-dse-greina/gists{/gist_id}", "starred_url": "https://api.github.com/users/mas-dse-greina/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mas-dse-greina/subscriptions", "organizations_url": "https://api.github.com/users/mas-dse-greina/orgs", "repos_url": "https://api.github.com/users/mas-dse-greina/repos", "events_url": "https://api.github.com/users/mas-dse-greina/events{/privacy}", "received_events_url": "https://api.github.com/users/mas-dse-greina/received_events", "type": "User", "site_admin": false}, "created_at": "2018-04-02T18:42:33Z", "updated_at": "2018-04-02T18:42:33Z", "author_association": "NONE", "body_html": "<div class=\"email-fragment\">Please see the new test benchmark script which shows the issue:\n<a href=\"https://github.com/NervanaSystems/topologies/tree/master/memory_benchmarking\">https://github.com/NervanaSystems/topologies/tree/master/memory_benchmarking</a>\n\nI created a test bench with random data that will show the same issue. Note\nthat I am using the Intel-built TensorFlow MKL wheel and only using CPU to\ntrain. The issue seems to be in the concatenation of step.\n\nJust run the command `python benchmark_model.py --num_datapoints=10 --D2\n--dim_length=128` and it should show the error in TF1.6 MKL.\n\nError:\n\n(tf) [user@node17 memory_benchmarking]$ python benchmark_model.py\n--num_datapoints=10 --D2 --dim_length=128\nUsing TensorFlow backend.\n\nArgs = Namespace(D2=True, blocktime=0, bz=1, dim_length=128, epochs=3,\ninterop_threads=2, intraop_threads=67, lr=0.001, mkl_verbose=False,\nnum_channels=1, num_datapoints=10, num_outputs=1, print_model=False,\nsingle_class_output=False, use_upsampling=False)\n2D U-Net Segmentation\n  0%|\n                                                                          |\n0/10 [00:00&lt;?, ?it/s]Traceback (most recent call last):\n  File \"benchmark_model.py\", line 208, in &lt;module&gt;\n    options=run_options, run_metadata=run_metadata)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/client/session.py\",\nline 905, in run\n    run_metadata_ptr)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/client/session.py\",\nline 1137, in _run\n    feed_dict_tensor, options, run_metadata)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/client/session.py\",\nline 1355, in _do_run\n    options, run_metadata)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/client/session.py\",\nline 1374, in _do_call\n    raise type(e)(node_def, op, message)\n*tensorflow.python.framework.errors_impl.AbortedError: Operation received\nan exception:Status: 3, message: could not create a concat primitive\ndescriptor, in file tensorflow/core/kernels/mkl_concat_op.cc:777*\n* [[Node: concatenate_1/concat = _MklConcatV2[N=2, T=DT_FLOAT,\nTidx=DT_INT32, _kernel=\"MklOp\",\n_device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](transConv6/BiasAdd,\nconv4b/Relu, concatenate_1/concat/axis, DMT/_29, conv4b/Relu:1, DMT/_30)]]*\n\nCaused by op u'concatenate_1/concat', defined at:\n  File \"benchmark_model.py\", line 161, in &lt;module&gt;\n    print_summary=args.print_model, n_out=args.num_outputs)\n  File \"/home/user/topologies/memory_benchmarking/model.py\", line 177, in\nunet2D\n    kernel_size=(2, 2), strides=(2, 2), padding=\"same\")(conv5), conv4],\naxis=concat_axis)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/keras/layers/merge.py\",\nline 627, in concatenate\n    return Concatenate(axis=axis, **kwargs)(inputs)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/keras/engine/topology.py\",\nline 603, in __call__\n    output = self.call(inputs, **kwargs)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/keras/layers/merge.py\",\nline 347, in call\n    return K.concatenate(inputs, axis=self.axis)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/keras/backend/tensorflow_backend.py\",\nline 1768, in concatenate\n    return tf.concat([to_dense(x) for x in tensors], axis)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/ops/array_ops.py\",\nline 1175, in concat\n    return gen_array_ops._concat_v2(values=values, axis=axis, name=name)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\",\nline 625, in _concat_v2\n    \"ConcatV2\", values=values, axis=axis, name=name)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\",\nline 787, in _apply_op_helper\n    op_def=op_def)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\",\nline 3271, in create_op\n    op_def=op_def)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\",\nline 1650, in __init__\n    self._traceback = self._graph._extract_stack()  # pylint:\ndisable=protected-access\n\nAbortedError (see above for traceback): Operation received an\nexception:Status: 3, message: could not create a concat primitive\ndescriptor, in file tensorflow/core/kernels/mkl_concat_op.cc:777\n*[[Node: concatenate_1/concat = _MklConcatV2[N=2, T=DT_FLOAT,\nTidx=DT_INT32, _kernel=\"MklOp\",\n_device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](transConv6/BiasAdd,\nconv4b/Relu, concatenate_1/concat/axis, DMT/_29, conv4b/Relu:1, DMT/_30)]]*\n\n\nThanks.\n-Tony</div>\n<span class=\"email-hidden-toggle\"><a href=\"#\">\u2026</a></span><div class=\"email-hidden-reply\">\n<div class=\"email-quoted-reply\">On Mon, Apr 2, 2018 at 9:53 AM, Guozhong Zhuang ***@***.***&gt; wrote:\n Need to access \"data\" to reproduce the issue with \"train.py\".\n\n \u2014\n You are receiving this because you authored the thread.\n Reply to this email directly, view it on GitHub\n &lt;<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"302902460\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/17494\" href=\"https://github.com/tensorflow/tensorflow/issues/17494#issuecomment-377975784\">#17494 (comment)</a>&gt;,\n or mute the thread\n &lt;<a href=\"https://github.com/notifications/unsubscribe-auth/AVReEuyEkeXVAmp32gD60zuld3gtLOfxks5tkld7gaJpZM4SflsQ\">https://github.com/notifications/unsubscribe-auth/AVReEuyEkeXVAmp32gD60zuld3gtLOfxks5tkld7gaJpZM4SflsQ</a>&gt;\n .\n</div>\n<div class=\"email-fragment\"></div>\n</div>", "body_text": "Please see the new test benchmark script which shows the issue:\nhttps://github.com/NervanaSystems/topologies/tree/master/memory_benchmarking\n\nI created a test bench with random data that will show the same issue. Note\nthat I am using the Intel-built TensorFlow MKL wheel and only using CPU to\ntrain. The issue seems to be in the concatenation of step.\n\nJust run the command `python benchmark_model.py --num_datapoints=10 --D2\n--dim_length=128` and it should show the error in TF1.6 MKL.\n\nError:\n\n(tf) [user@node17 memory_benchmarking]$ python benchmark_model.py\n--num_datapoints=10 --D2 --dim_length=128\nUsing TensorFlow backend.\n\nArgs = Namespace(D2=True, blocktime=0, bz=1, dim_length=128, epochs=3,\ninterop_threads=2, intraop_threads=67, lr=0.001, mkl_verbose=False,\nnum_channels=1, num_datapoints=10, num_outputs=1, print_model=False,\nsingle_class_output=False, use_upsampling=False)\n2D U-Net Segmentation\n  0%|\n                                                                          |\n0/10 [00:00<?, ?it/s]Traceback (most recent call last):\n  File \"benchmark_model.py\", line 208, in <module>\n    options=run_options, run_metadata=run_metadata)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/client/session.py\",\nline 905, in run\n    run_metadata_ptr)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/client/session.py\",\nline 1137, in _run\n    feed_dict_tensor, options, run_metadata)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/client/session.py\",\nline 1355, in _do_run\n    options, run_metadata)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/client/session.py\",\nline 1374, in _do_call\n    raise type(e)(node_def, op, message)\n*tensorflow.python.framework.errors_impl.AbortedError: Operation received\nan exception:Status: 3, message: could not create a concat primitive\ndescriptor, in file tensorflow/core/kernels/mkl_concat_op.cc:777*\n* [[Node: concatenate_1/concat = _MklConcatV2[N=2, T=DT_FLOAT,\nTidx=DT_INT32, _kernel=\"MklOp\",\n_device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](transConv6/BiasAdd,\nconv4b/Relu, concatenate_1/concat/axis, DMT/_29, conv4b/Relu:1, DMT/_30)]]*\n\nCaused by op u'concatenate_1/concat', defined at:\n  File \"benchmark_model.py\", line 161, in <module>\n    print_summary=args.print_model, n_out=args.num_outputs)\n  File \"/home/user/topologies/memory_benchmarking/model.py\", line 177, in\nunet2D\n    kernel_size=(2, 2), strides=(2, 2), padding=\"same\")(conv5), conv4],\naxis=concat_axis)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/keras/layers/merge.py\",\nline 627, in concatenate\n    return Concatenate(axis=axis, **kwargs)(inputs)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/keras/engine/topology.py\",\nline 603, in __call__\n    output = self.call(inputs, **kwargs)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/keras/layers/merge.py\",\nline 347, in call\n    return K.concatenate(inputs, axis=self.axis)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/keras/backend/tensorflow_backend.py\",\nline 1768, in concatenate\n    return tf.concat([to_dense(x) for x in tensors], axis)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/ops/array_ops.py\",\nline 1175, in concat\n    return gen_array_ops._concat_v2(values=values, axis=axis, name=name)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\",\nline 625, in _concat_v2\n    \"ConcatV2\", values=values, axis=axis, name=name)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\",\nline 787, in _apply_op_helper\n    op_def=op_def)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\",\nline 3271, in create_op\n    op_def=op_def)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\",\nline 1650, in __init__\n    self._traceback = self._graph._extract_stack()  # pylint:\ndisable=protected-access\n\nAbortedError (see above for traceback): Operation received an\nexception:Status: 3, message: could not create a concat primitive\ndescriptor, in file tensorflow/core/kernels/mkl_concat_op.cc:777\n*[[Node: concatenate_1/concat = _MklConcatV2[N=2, T=DT_FLOAT,\nTidx=DT_INT32, _kernel=\"MklOp\",\n_device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](transConv6/BiasAdd,\nconv4b/Relu, concatenate_1/concat/axis, DMT/_29, conv4b/Relu:1, DMT/_30)]]*\n\n\nThanks.\n-Tony\n\u2026\nOn Mon, Apr 2, 2018 at 9:53 AM, Guozhong Zhuang ***@***.***> wrote:\n Need to access \"data\" to reproduce the issue with \"train.py\".\n\n \u2014\n You are receiving this because you authored the thread.\n Reply to this email directly, view it on GitHub\n <#17494 (comment)>,\n or mute the thread\n <https://github.com/notifications/unsubscribe-auth/AVReEuyEkeXVAmp32gD60zuld3gtLOfxks5tkld7gaJpZM4SflsQ>\n .", "body": "Please see the new test benchmark script which shows the issue:\nhttps://github.com/NervanaSystems/topologies/tree/master/memory_benchmarking\n\nI created a test bench with random data that will show the same issue. Note\nthat I am using the Intel-built TensorFlow MKL wheel and only using CPU to\ntrain. The issue seems to be in the concatenation of step.\n\nJust run the command `python benchmark_model.py --num_datapoints=10 --D2\n--dim_length=128` and it should show the error in TF1.6 MKL.\n\nError:\n\n(tf) [user@node17 memory_benchmarking]$ python benchmark_model.py\n--num_datapoints=10 --D2 --dim_length=128\nUsing TensorFlow backend.\n\nArgs = Namespace(D2=True, blocktime=0, bz=1, dim_length=128, epochs=3,\ninterop_threads=2, intraop_threads=67, lr=0.001, mkl_verbose=False,\nnum_channels=1, num_datapoints=10, num_outputs=1, print_model=False,\nsingle_class_output=False, use_upsampling=False)\n2D U-Net Segmentation\n  0%|\n                                                                          |\n0/10 [00:00<?, ?it/s]Traceback (most recent call last):\n  File \"benchmark_model.py\", line 208, in <module>\n    options=run_options, run_metadata=run_metadata)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/client/session.py\",\nline 905, in run\n    run_metadata_ptr)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/client/session.py\",\nline 1137, in _run\n    feed_dict_tensor, options, run_metadata)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/client/session.py\",\nline 1355, in _do_run\n    options, run_metadata)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/client/session.py\",\nline 1374, in _do_call\n    raise type(e)(node_def, op, message)\n*tensorflow.python.framework.errors_impl.AbortedError: Operation received\nan exception:Status: 3, message: could not create a concat primitive\ndescriptor, in file tensorflow/core/kernels/mkl_concat_op.cc:777*\n* [[Node: concatenate_1/concat = _MklConcatV2[N=2, T=DT_FLOAT,\nTidx=DT_INT32, _kernel=\"MklOp\",\n_device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](transConv6/BiasAdd,\nconv4b/Relu, concatenate_1/concat/axis, DMT/_29, conv4b/Relu:1, DMT/_30)]]*\n\nCaused by op u'concatenate_1/concat', defined at:\n  File \"benchmark_model.py\", line 161, in <module>\n    print_summary=args.print_model, n_out=args.num_outputs)\n  File \"/home/user/topologies/memory_benchmarking/model.py\", line 177, in\nunet2D\n    kernel_size=(2, 2), strides=(2, 2), padding=\"same\")(conv5), conv4],\naxis=concat_axis)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/keras/layers/merge.py\",\nline 627, in concatenate\n    return Concatenate(axis=axis, **kwargs)(inputs)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/keras/engine/topology.py\",\nline 603, in __call__\n    output = self.call(inputs, **kwargs)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/keras/layers/merge.py\",\nline 347, in call\n    return K.concatenate(inputs, axis=self.axis)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/keras/backend/tensorflow_backend.py\",\nline 1768, in concatenate\n    return tf.concat([to_dense(x) for x in tensors], axis)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/ops/array_ops.py\",\nline 1175, in concat\n    return gen_array_ops._concat_v2(values=values, axis=axis, name=name)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\",\nline 625, in _concat_v2\n    \"ConcatV2\", values=values, axis=axis, name=name)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\",\nline 787, in _apply_op_helper\n    op_def=op_def)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\",\nline 3271, in create_op\n    op_def=op_def)\n  File\n\"/home/user/miniconda2/envs/tf/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\",\nline 1650, in __init__\n    self._traceback = self._graph._extract_stack()  # pylint:\ndisable=protected-access\n\nAbortedError (see above for traceback): Operation received an\nexception:Status: 3, message: could not create a concat primitive\ndescriptor, in file tensorflow/core/kernels/mkl_concat_op.cc:777\n*[[Node: concatenate_1/concat = _MklConcatV2[N=2, T=DT_FLOAT,\nTidx=DT_INT32, _kernel=\"MklOp\",\n_device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](transConv6/BiasAdd,\nconv4b/Relu, concatenate_1/concat/axis, DMT/_29, conv4b/Relu:1, DMT/_30)]]*\n\n\nThanks.\n-Tony\n\n\nOn Mon, Apr 2, 2018 at 9:53 AM, Guozhong Zhuang <notifications@github.com>\nwrote:\n\n> Need to access \"data\" to reproduce the issue with \"train.py\".\n>\n> \u2014\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/tensorflow/tensorflow/issues/17494#issuecomment-377975784>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AVReEuyEkeXVAmp32gD60zuld3gtLOfxks5tkld7gaJpZM4SflsQ>\n> .\n>\n"}