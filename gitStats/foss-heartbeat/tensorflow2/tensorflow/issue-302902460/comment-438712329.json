{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/438712329", "html_url": "https://github.com/tensorflow/tensorflow/issues/17494#issuecomment-438712329", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17494", "id": 438712329, "node_id": "MDEyOklzc3VlQ29tbWVudDQzODcxMjMyOQ==", "user": {"login": "eLvErDe", "id": 1586757, "node_id": "MDQ6VXNlcjE1ODY3NTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/1586757?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eLvErDe", "html_url": "https://github.com/eLvErDe", "followers_url": "https://api.github.com/users/eLvErDe/followers", "following_url": "https://api.github.com/users/eLvErDe/following{/other_user}", "gists_url": "https://api.github.com/users/eLvErDe/gists{/gist_id}", "starred_url": "https://api.github.com/users/eLvErDe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eLvErDe/subscriptions", "organizations_url": "https://api.github.com/users/eLvErDe/orgs", "repos_url": "https://api.github.com/users/eLvErDe/repos", "events_url": "https://api.github.com/users/eLvErDe/events{/privacy}", "received_events_url": "https://api.github.com/users/eLvErDe/received_events", "type": "User", "site_admin": false}, "created_at": "2018-11-14T15:54:08Z", "updated_at": "2018-11-14T15:54:08Z", "author_association": "NONE", "body_html": "<p><a href=\"https://github.com/tensorflow/tensorflow/files/2581462/mkl_conv_ops_cc_mkl_bug.zip\">mkl_conv_ops_cc_mkl_bug.zip</a></p>\n<p>Hello,</p>\n<p>The error message is:</p>\n<pre><code>2018-11-14 16:42:55.167116: I tensorflow/core/common_runtime/process_util.cc:63] Creating new thread pool with default inter op setting: 2. Tune using inter_op_parallelism_threads for best performance.\n2018-11-14 16:43:00.480740: W tensorflow/core/framework/op_kernel.cc:1318] OP_REQUIRES failed at mkl_conv_ops.cc:697 : Aborted: Operation received an exception:Status: 5, message: could not initialize a memory descriptor, in file tensorflow/core/kernels/mkl_conv_ops.cc:694\nTraceback (most recent call last):\n  File \"/usr/lib/python3/dist-packages/tensorflow/python/client/session.py\", line 1322, in _do_call\n    return fn(*args)\n  File \"/usr/lib/python3/dist-packages/tensorflow/python/client/session.py\", line 1307, in _run_fn\n    options, feed_dict, fetch_list, target_list, run_metadata)\n  File \"/usr/lib/python3/dist-packages/tensorflow/python/client/session.py\", line 1409, in _call_tf_sessionrun\n    run_metadata)\ntensorflow.python.framework.errors_impl.AbortedError: Operation received an exception:Status: 5, message: could not initialize a memory descriptor, in file tensorflow/core/kernels/mkl_conv_ops.cc:694\n\t [[Node: FeatureExtractor/InceptionV2/InceptionV2/Conv2d_1a_7x7/BatchNorm/FusedBatchNorm = _MklConv2DWithBias[T=DT_FLOAT, _kernel=\"MklOp\", data_format=\"NHWC\", dilations=[1, 1, 1, 1], padding=\"VALID\", strides=[1, 1, 1, 1], use_cudnn_on_gpu=true, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](FeatureExtractor/InceptionV2/InceptionV2/Conv2d_1a_7x7/separable_conv2d/depthwise, FeatureExtractor/InceptionV2/Conv2d_1a_7x7/pointwise_weights/read/_94__cf__97, FeatureExtractor/InceptionV2/InceptionV2/Conv2d_1a_7x7/separable_conv2d_bn_offset, DMT/_61, DMT/_62, DMT/_63)]]\n</code></pre>\n<p>Attached ZIP file contain a few line script reproducing the error (i'll care itself downloading a model) and a test image for inference.<br>\nRunning it with my MKL build fails, with a non MKL build it works fine.</p>\n<p>I'm actually thinking this is related to MKL-DNN version <em>at build time</em> because my  1.5.1 were build using 0.13 I guess and newer with 0.16. I'm pretty confident building new TF with old MKL-DNN will make it work....</p>\n<p>Thanks for your help,</p>\n<p>Adam.</p>", "body_text": "mkl_conv_ops_cc_mkl_bug.zip\nHello,\nThe error message is:\n2018-11-14 16:42:55.167116: I tensorflow/core/common_runtime/process_util.cc:63] Creating new thread pool with default inter op setting: 2. Tune using inter_op_parallelism_threads for best performance.\n2018-11-14 16:43:00.480740: W tensorflow/core/framework/op_kernel.cc:1318] OP_REQUIRES failed at mkl_conv_ops.cc:697 : Aborted: Operation received an exception:Status: 5, message: could not initialize a memory descriptor, in file tensorflow/core/kernels/mkl_conv_ops.cc:694\nTraceback (most recent call last):\n  File \"/usr/lib/python3/dist-packages/tensorflow/python/client/session.py\", line 1322, in _do_call\n    return fn(*args)\n  File \"/usr/lib/python3/dist-packages/tensorflow/python/client/session.py\", line 1307, in _run_fn\n    options, feed_dict, fetch_list, target_list, run_metadata)\n  File \"/usr/lib/python3/dist-packages/tensorflow/python/client/session.py\", line 1409, in _call_tf_sessionrun\n    run_metadata)\ntensorflow.python.framework.errors_impl.AbortedError: Operation received an exception:Status: 5, message: could not initialize a memory descriptor, in file tensorflow/core/kernels/mkl_conv_ops.cc:694\n\t [[Node: FeatureExtractor/InceptionV2/InceptionV2/Conv2d_1a_7x7/BatchNorm/FusedBatchNorm = _MklConv2DWithBias[T=DT_FLOAT, _kernel=\"MklOp\", data_format=\"NHWC\", dilations=[1, 1, 1, 1], padding=\"VALID\", strides=[1, 1, 1, 1], use_cudnn_on_gpu=true, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](FeatureExtractor/InceptionV2/InceptionV2/Conv2d_1a_7x7/separable_conv2d/depthwise, FeatureExtractor/InceptionV2/Conv2d_1a_7x7/pointwise_weights/read/_94__cf__97, FeatureExtractor/InceptionV2/InceptionV2/Conv2d_1a_7x7/separable_conv2d_bn_offset, DMT/_61, DMT/_62, DMT/_63)]]\n\nAttached ZIP file contain a few line script reproducing the error (i'll care itself downloading a model) and a test image for inference.\nRunning it with my MKL build fails, with a non MKL build it works fine.\nI'm actually thinking this is related to MKL-DNN version at build time because my  1.5.1 were build using 0.13 I guess and newer with 0.16. I'm pretty confident building new TF with old MKL-DNN will make it work....\nThanks for your help,\nAdam.", "body": "[mkl_conv_ops_cc_mkl_bug.zip](https://github.com/tensorflow/tensorflow/files/2581462/mkl_conv_ops_cc_mkl_bug.zip)\r\n\r\nHello,\r\n\r\nThe error message is:\r\n```\r\n2018-11-14 16:42:55.167116: I tensorflow/core/common_runtime/process_util.cc:63] Creating new thread pool with default inter op setting: 2. Tune using inter_op_parallelism_threads for best performance.\r\n2018-11-14 16:43:00.480740: W tensorflow/core/framework/op_kernel.cc:1318] OP_REQUIRES failed at mkl_conv_ops.cc:697 : Aborted: Operation received an exception:Status: 5, message: could not initialize a memory descriptor, in file tensorflow/core/kernels/mkl_conv_ops.cc:694\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3/dist-packages/tensorflow/python/client/session.py\", line 1322, in _do_call\r\n    return fn(*args)\r\n  File \"/usr/lib/python3/dist-packages/tensorflow/python/client/session.py\", line 1307, in _run_fn\r\n    options, feed_dict, fetch_list, target_list, run_metadata)\r\n  File \"/usr/lib/python3/dist-packages/tensorflow/python/client/session.py\", line 1409, in _call_tf_sessionrun\r\n    run_metadata)\r\ntensorflow.python.framework.errors_impl.AbortedError: Operation received an exception:Status: 5, message: could not initialize a memory descriptor, in file tensorflow/core/kernels/mkl_conv_ops.cc:694\r\n\t [[Node: FeatureExtractor/InceptionV2/InceptionV2/Conv2d_1a_7x7/BatchNorm/FusedBatchNorm = _MklConv2DWithBias[T=DT_FLOAT, _kernel=\"MklOp\", data_format=\"NHWC\", dilations=[1, 1, 1, 1], padding=\"VALID\", strides=[1, 1, 1, 1], use_cudnn_on_gpu=true, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](FeatureExtractor/InceptionV2/InceptionV2/Conv2d_1a_7x7/separable_conv2d/depthwise, FeatureExtractor/InceptionV2/Conv2d_1a_7x7/pointwise_weights/read/_94__cf__97, FeatureExtractor/InceptionV2/InceptionV2/Conv2d_1a_7x7/separable_conv2d_bn_offset, DMT/_61, DMT/_62, DMT/_63)]]\r\n```\r\n\r\nAttached ZIP file contain a few line script reproducing the error (i'll care itself downloading a model) and a test image for inference.\r\nRunning it with my MKL build fails, with a non MKL build it works fine.\r\n\r\nI'm actually thinking this is related to MKL-DNN version *at build time* because my  1.5.1 were build using 0.13 I guess and newer with 0.16. I'm pretty confident building new TF with old MKL-DNN will make it work....\r\n\r\nThanks for your help,\r\n\r\nAdam."}