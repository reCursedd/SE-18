{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/305704724", "html_url": "https://github.com/tensorflow/tensorflow/issues/10288#issuecomment-305704724", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10288", "id": 305704724, "node_id": "MDEyOklzc3VlQ29tbWVudDMwNTcwNDcyNA==", "user": {"login": "annanay25", "id": 10982987, "node_id": "MDQ6VXNlcjEwOTgyOTg3", "avatar_url": "https://avatars2.githubusercontent.com/u/10982987?v=4", "gravatar_id": "", "url": "https://api.github.com/users/annanay25", "html_url": "https://github.com/annanay25", "followers_url": "https://api.github.com/users/annanay25/followers", "following_url": "https://api.github.com/users/annanay25/following{/other_user}", "gists_url": "https://api.github.com/users/annanay25/gists{/gist_id}", "starred_url": "https://api.github.com/users/annanay25/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/annanay25/subscriptions", "organizations_url": "https://api.github.com/users/annanay25/orgs", "repos_url": "https://api.github.com/users/annanay25/repos", "events_url": "https://api.github.com/users/annanay25/events{/privacy}", "received_events_url": "https://api.github.com/users/annanay25/received_events", "type": "User", "site_admin": false}, "created_at": "2017-06-02T06:49:34Z", "updated_at": "2017-06-04T20:37:08Z", "author_association": "NONE", "body_html": "<p>Hi <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=18471401\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/brianretford\">@brianretford</a>,<br>\nThanks for this.</p>\n<p>These are the steps to reproduce my state right now:</p>\n<ul>\n<li>Clone my tensorflow <a href=\"https://gitlab.com/annanay25/tensorflow\" rel=\"nofollow\">repository</a> or\n<ol>\n<li>copy the llvm build <a href=\"https://gitlab.com/annanay25/tensorflow/blob/master/third_party/llvm/llvm.BUILD\" rel=\"nofollow\">file</a></li>\n<li>edit the xla build file to add <a href=\"https://gitlab.com/annanay25/tensorflow/blob/master/tensorflow/compiler/xla/service/BUILD#L1110\" rel=\"nofollow\">this line</a> to your local tensorflow repository.</li>\n</ol>\n</li>\n<li>Clone this version of <a href=\"https://gitlab.com/annanay25/llvm-tensorflow\" rel=\"nofollow\">llvm</a> - it is rolled back to the required commit and has polly checked out as well.</li>\n<li>Modify the <code>tensorflow/tensorflow/workspace.bzl</code> file and change the <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/workspace.bzl#L496-L508\">llvm rule</a> by replacing it with this:</li>\n</ul>\n<pre><code>  native.new_local_repository (\n       name = \"llvm\",\n       path = \"&lt;path to llvm clone&gt;\",\n       build_file = str(Label(\"//third_party/llvm:llvm.BUILD\")),\n   )\n</code></pre>\n<ul>\n<li>\n<p>Run <code>bazel build --verbose_failures -c opt //tensorflow/tools/pip_package:build_pip_package</code> and <code> bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg</code><br>\nin the tensorflow root folder.</p>\n</li>\n<li>\n<p>Navigate to a folder with a python file that uses tensorflow.<br>\nRun <code>TF_XLA_FLAGS=\"--xla_cpu_llvm_cl_opts=-disable-inlined-alloca-merging\"  python &lt;filename.py&gt; --xla=true</code>. It should run without any errors.<br>\nRun<br>\n<code>TF_XLA_FLAGS=\"--xla_cpu_llvm_cl_opts=-polly\"  python &lt;filename.py&gt; --xla=true</code>. The command should fail with \"unrecognized flag -polly\".</p>\n</li>\n</ul>\n<p>Thanks.</p>", "body_text": "Hi @brianretford,\nThanks for this.\nThese are the steps to reproduce my state right now:\n\nClone my tensorflow repository or\n\ncopy the llvm build file\nedit the xla build file to add this line to your local tensorflow repository.\n\n\nClone this version of llvm - it is rolled back to the required commit and has polly checked out as well.\nModify the tensorflow/tensorflow/workspace.bzl file and change the llvm rule by replacing it with this:\n\n  native.new_local_repository (\n       name = \"llvm\",\n       path = \"<path to llvm clone>\",\n       build_file = str(Label(\"//third_party/llvm:llvm.BUILD\")),\n   )\n\n\n\nRun bazel build --verbose_failures -c opt //tensorflow/tools/pip_package:build_pip_package and  bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg\nin the tensorflow root folder.\n\n\nNavigate to a folder with a python file that uses tensorflow.\nRun TF_XLA_FLAGS=\"--xla_cpu_llvm_cl_opts=-disable-inlined-alloca-merging\"  python <filename.py> --xla=true. It should run without any errors.\nRun\nTF_XLA_FLAGS=\"--xla_cpu_llvm_cl_opts=-polly\"  python <filename.py> --xla=true. The command should fail with \"unrecognized flag -polly\".\n\n\nThanks.", "body": "Hi @brianretford,\r\nThanks for this.\r\n\r\nThese are the steps to reproduce my state right now:\r\n- Clone my tensorflow [repository](https://gitlab.com/annanay25/tensorflow) or \r\n  1. copy the llvm build [file](https://gitlab.com/annanay25/tensorflow/blob/master/third_party/llvm/llvm.BUILD) \r\n  2. edit the xla build file to add [this line](https://gitlab.com/annanay25/tensorflow/blob/master/tensorflow/compiler/xla/service/BUILD#L1110) to your local tensorflow repository.\r\n- Clone this version of [llvm](https://gitlab.com/annanay25/llvm-tensorflow) - it is rolled back to the required commit and has polly checked out as well.\r\n- Modify the ```tensorflow/tensorflow/workspace.bzl``` file and change the [llvm rule](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/workspace.bzl#L496-L508) by replacing it with this:\r\n\r\n```\r\n  native.new_local_repository (\r\n       name = \"llvm\",\r\n       path = \"<path to llvm clone>\",\r\n       build_file = str(Label(\"//third_party/llvm:llvm.BUILD\")),\r\n   )\r\n```\r\n- Run ```bazel build --verbose_failures -c opt //tensorflow/tools/pip_package:build_pip_package``` and ``` bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg```\r\n in the tensorflow root folder. \r\n\r\n- Navigate to a folder with a python file that uses tensorflow. \r\n  Run ```TF_XLA_FLAGS=\"--xla_cpu_llvm_cl_opts=-disable-inlined-alloca-merging\"  python <filename.py> --xla=true```. It should run without any errors.\r\n  Run \r\n```TF_XLA_FLAGS=\"--xla_cpu_llvm_cl_opts=-polly\"  python <filename.py> --xla=true```. The command should fail with \"unrecognized flag -polly\".\r\n\r\n\r\nThanks.\r\n"}