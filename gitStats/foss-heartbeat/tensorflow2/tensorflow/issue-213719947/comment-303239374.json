{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/303239374", "html_url": "https://github.com/tensorflow/tensorflow/issues/8347#issuecomment-303239374", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8347", "id": 303239374, "node_id": "MDEyOklzc3VlQ29tbWVudDMwMzIzOTM3NA==", "user": {"login": "mddrill", "id": 20046178, "node_id": "MDQ6VXNlcjIwMDQ2MTc4", "avatar_url": "https://avatars1.githubusercontent.com/u/20046178?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mddrill", "html_url": "https://github.com/mddrill", "followers_url": "https://api.github.com/users/mddrill/followers", "following_url": "https://api.github.com/users/mddrill/following{/other_user}", "gists_url": "https://api.github.com/users/mddrill/gists{/gist_id}", "starred_url": "https://api.github.com/users/mddrill/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mddrill/subscriptions", "organizations_url": "https://api.github.com/users/mddrill/orgs", "repos_url": "https://api.github.com/users/mddrill/repos", "events_url": "https://api.github.com/users/mddrill/events{/privacy}", "received_events_url": "https://api.github.com/users/mddrill/received_events", "type": "User", "site_admin": false}, "created_at": "2017-05-22T22:39:57Z", "updated_at": "2017-05-22T22:39:57Z", "author_association": "NONE", "body_html": "<p>I figured out the source of the error. I was using <code>tf.identity</code> ops to name my output tensors. The call to <code>graph_util.remove_training_nodes</code> on line 413 in <code>quantize_graph.py</code> removes all identity ops from the graph causing a KeyError. Apparently,</p>\n<blockquote>\n<p>\"There are nodes like Identity and CheckNumerics that are only useful<br>\nduring training, and can be removed in graphs that will be used for<br>\nnothing but inference. Here we identify and remove them, returning an<br>\nequivalent graph. To be specific, CheckNumerics nodes are always removed, and<br>\nIdentity nodes that aren't involved in control edges are spliced out so that<br>\ntheir input and outputs are directly connected.\"</p>\n</blockquote>\n<p>from the comment on tensorflow/python/framework/graph_util_impl.py</p>\n<p>I don't know what the best workaround would be, for now I'm just going to change line 417 from <code>self.set_input_graph(graph_util.remove_training_nodes(self.input_graph))</code> to <code>self.set_input_graph(self.input_graph)</code></p>\n<p>As far as I know there are no CheckNumeric ops in my network and the only identity calls are the output nodes, so hopefully this won't affect much.</p>", "body_text": "I figured out the source of the error. I was using tf.identity ops to name my output tensors. The call to graph_util.remove_training_nodes on line 413 in quantize_graph.py removes all identity ops from the graph causing a KeyError. Apparently,\n\n\"There are nodes like Identity and CheckNumerics that are only useful\nduring training, and can be removed in graphs that will be used for\nnothing but inference. Here we identify and remove them, returning an\nequivalent graph. To be specific, CheckNumerics nodes are always removed, and\nIdentity nodes that aren't involved in control edges are spliced out so that\ntheir input and outputs are directly connected.\"\n\nfrom the comment on tensorflow/python/framework/graph_util_impl.py\nI don't know what the best workaround would be, for now I'm just going to change line 417 from self.set_input_graph(graph_util.remove_training_nodes(self.input_graph)) to self.set_input_graph(self.input_graph)\nAs far as I know there are no CheckNumeric ops in my network and the only identity calls are the output nodes, so hopefully this won't affect much.", "body": "I figured out the source of the error. I was using `tf.identity` ops to name my output tensors. The call to `graph_util.remove_training_nodes` on line 413 in `quantize_graph.py` removes all identity ops from the graph causing a KeyError. Apparently,\r\n\r\n> \"There are nodes like Identity and CheckNumerics that are only useful\r\n>   during training, and can be removed in graphs that will be used for\r\n>   nothing but inference. Here we identify and remove them, returning an\r\n>   equivalent graph. To be specific, CheckNumerics nodes are always removed, and\r\n>   Identity nodes that aren't involved in control edges are spliced out so that\r\n>   their input and outputs are directly connected.\"\r\n\r\nfrom the comment on tensorflow/python/framework/graph_util_impl.py\r\n\r\nI don't know what the best workaround would be, for now I'm just going to change line 417 from `self.set_input_graph(graph_util.remove_training_nodes(self.input_graph))` to `self.set_input_graph(self.input_graph)`\r\n\r\nAs far as I know there are no CheckNumeric ops in my network and the only identity calls are the output nodes, so hopefully this won't affect much.\r\n"}