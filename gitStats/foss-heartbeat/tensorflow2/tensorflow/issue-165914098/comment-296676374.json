{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/296676374", "html_url": "https://github.com/tensorflow/tensorflow/issues/3340#issuecomment-296676374", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3340", "id": 296676374, "node_id": "MDEyOklzc3VlQ29tbWVudDI5NjY3NjM3NA==", "user": {"login": "rjpg", "id": 22857941, "node_id": "MDQ6VXNlcjIyODU3OTQx", "avatar_url": "https://avatars1.githubusercontent.com/u/22857941?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rjpg", "html_url": "https://github.com/rjpg", "followers_url": "https://api.github.com/users/rjpg/followers", "following_url": "https://api.github.com/users/rjpg/following{/other_user}", "gists_url": "https://api.github.com/users/rjpg/gists{/gist_id}", "starred_url": "https://api.github.com/users/rjpg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rjpg/subscriptions", "organizations_url": "https://api.github.com/users/rjpg/orgs", "repos_url": "https://api.github.com/users/rjpg/repos", "events_url": "https://api.github.com/users/rjpg/events{/privacy}", "received_events_url": "https://api.github.com/users/rjpg/received_events", "type": "User", "site_admin": false}, "created_at": "2017-04-24T13:56:33Z", "updated_at": "2017-04-24T13:59:39Z", "author_association": "NONE", "body_html": "<p>hello,</p>\n<p>the problem using export method is understanding what serving_input_fn is and how to define it.</p>\n<p>I still dont know what it is (if there is some documentation about it I would be  grateful).</p>\n<p>I mange to use export using the following lines (dont know for sure is that is correct ...) :<br>\n`<br>\ntfrecord_serving_input_fn = tf.contrib.learn.build_parsing_serving_input_fn(layers.create_feature_spec_for_parsing(feature_columns))</p>\n<p>classifier.export_savedmodel(export_dir_base=\"test\", serving_input_fn = tfrecord_serving_input_fn,as_text=True)<br>\n`</p>\n<p>Now the model_saved.pbtxt is loaded in java.</p>\n<p>using :</p>\n<p><code>SavedModelBundle bundle= SavedModelBundle.load(\"/java/workspace/APIJavaSampleCode/tfModels/dnn/ModelSave\",\"serve\");</code></p>\n<p>Then I had another problem ... to execute the model we need to pass strings to say what is the input and output \"operation\".</p>\n<p>Someone told me (on youtube) they are \"input_example_tensor\" and ouput \"dnn/multi_class_head/predictions/probabilities\". Dont know how they discover this (?).<br>\n(again if there is some documentation about it I would be  grateful)<br>\nSo the code I have in java for the moment is this :</p>\n<p>`<br>\nSavedModelBundle bundle=SavedModelBundle.load(\"/java/workspace/APIJavaSampleCode/tfModels/dnn/ModelSave\",\"serve\");<br>\nSession s = bundle.session();</p>\n<pre><code>\tdouble[] inputDouble = {1.0,0.7982741870963959,1.0,-0.46270838239235024,0.040320274521029376,0.443451913224413,-1.0,1.0,1.0,-1.0,0.36689718911339564,-0.13577379160035796,-0.5162916256414466,-0.03373651520104648,1.0,1.0,1.0,1.0,0.786999801054777,-0.43856035121103853,-0.8199093927945158,1.0,-1.0,-1.0,-0.1134921695894473,-1.0,0.6420892436196663,0.7871737734493178,1.0,0.6501788845358409,1.0,1.0,1.0,-0.17586627413625022,0.8817194210401085};\n\tfloat [] inputfloat=new float[inputDouble.length];\n\tfor(int i=0;i&lt;inputfloat.length;i++)\n\t{\n\t\tinputfloat[i]=(float)inputDouble[i];\n\t}\n\tTensor inputTensor = Tensor.create(new long[] {35}, FloatBuffer.wrap(inputfloat) );\n\t\n\tTensor result = s.runner()\n            .feed(\"input_example_tensor\", inputTensor)\n            .fetch(\"dnn/multi_class_head/predictions/probabilities\")\n            .run().get(0);\n</code></pre>\n<p>`</p>\n<p>Now  I have the following error on java side :</p>\n<p><code>Exception in thread \"main\" org.tensorflow.TensorFlowException: Output 0 of type float does not match declared output type string for node _recv_input_example_tensor_0 = _Recv[_output_shapes=[[-1]], client_terminated=true, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=-5952653602839817343, tensor_name=\"input_example_tensor:0\", tensor_type=DT_STRING, _device=\"/job:localhost/replica:0/task:0/cpu:0\"]() at org.tensorflow.Session.run(Native Method) at org.tensorflow.Session.access$100(Session.java:48) at org.tensorflow.Session$Runner.runHelper(Session.java:285) at org.tensorflow.Session$Runner.run(Session.java:235) ...</code></p>\n<p>Any suggestion to overcame this error (I hope the last challenging problem to execute a  DNNClassifier, made in python, in java )  ?</p>\n<p>thanks in advance</p>", "body_text": "hello,\nthe problem using export method is understanding what serving_input_fn is and how to define it.\nI still dont know what it is (if there is some documentation about it I would be  grateful).\nI mange to use export using the following lines (dont know for sure is that is correct ...) :\n`\ntfrecord_serving_input_fn = tf.contrib.learn.build_parsing_serving_input_fn(layers.create_feature_spec_for_parsing(feature_columns))\nclassifier.export_savedmodel(export_dir_base=\"test\", serving_input_fn = tfrecord_serving_input_fn,as_text=True)\n`\nNow the model_saved.pbtxt is loaded in java.\nusing :\nSavedModelBundle bundle= SavedModelBundle.load(\"/java/workspace/APIJavaSampleCode/tfModels/dnn/ModelSave\",\"serve\");\nThen I had another problem ... to execute the model we need to pass strings to say what is the input and output \"operation\".\nSomeone told me (on youtube) they are \"input_example_tensor\" and ouput \"dnn/multi_class_head/predictions/probabilities\". Dont know how they discover this (?).\n(again if there is some documentation about it I would be  grateful)\nSo the code I have in java for the moment is this :\n`\nSavedModelBundle bundle=SavedModelBundle.load(\"/java/workspace/APIJavaSampleCode/tfModels/dnn/ModelSave\",\"serve\");\nSession s = bundle.session();\n\tdouble[] inputDouble = {1.0,0.7982741870963959,1.0,-0.46270838239235024,0.040320274521029376,0.443451913224413,-1.0,1.0,1.0,-1.0,0.36689718911339564,-0.13577379160035796,-0.5162916256414466,-0.03373651520104648,1.0,1.0,1.0,1.0,0.786999801054777,-0.43856035121103853,-0.8199093927945158,1.0,-1.0,-1.0,-0.1134921695894473,-1.0,0.6420892436196663,0.7871737734493178,1.0,0.6501788845358409,1.0,1.0,1.0,-0.17586627413625022,0.8817194210401085};\n\tfloat [] inputfloat=new float[inputDouble.length];\n\tfor(int i=0;i<inputfloat.length;i++)\n\t{\n\t\tinputfloat[i]=(float)inputDouble[i];\n\t}\n\tTensor inputTensor = Tensor.create(new long[] {35}, FloatBuffer.wrap(inputfloat) );\n\t\n\tTensor result = s.runner()\n            .feed(\"input_example_tensor\", inputTensor)\n            .fetch(\"dnn/multi_class_head/predictions/probabilities\")\n            .run().get(0);\n\n`\nNow  I have the following error on java side :\nException in thread \"main\" org.tensorflow.TensorFlowException: Output 0 of type float does not match declared output type string for node _recv_input_example_tensor_0 = _Recv[_output_shapes=[[-1]], client_terminated=true, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=-5952653602839817343, tensor_name=\"input_example_tensor:0\", tensor_type=DT_STRING, _device=\"/job:localhost/replica:0/task:0/cpu:0\"]() at org.tensorflow.Session.run(Native Method) at org.tensorflow.Session.access$100(Session.java:48) at org.tensorflow.Session$Runner.runHelper(Session.java:285) at org.tensorflow.Session$Runner.run(Session.java:235) ...\nAny suggestion to overcame this error (I hope the last challenging problem to execute a  DNNClassifier, made in python, in java )  ?\nthanks in advance", "body": "hello,\r\n\r\nthe problem using export method is understanding what serving_input_fn is and how to define it.\r\n\r\nI still dont know what it is (if there is some documentation about it I would be  grateful).\r\n\r\nI mange to use export using the following lines (dont know for sure is that is correct ...) :\r\n`\r\ntfrecord_serving_input_fn = tf.contrib.learn.build_parsing_serving_input_fn(layers.create_feature_spec_for_parsing(feature_columns))  \r\n\r\nclassifier.export_savedmodel(export_dir_base=\"test\", serving_input_fn = tfrecord_serving_input_fn,as_text=True)\r\n`\r\n\r\nNow the model_saved.pbtxt is loaded in java.\r\n\r\nusing :\r\n\r\n`SavedModelBundle bundle= SavedModelBundle.load(\"/java/workspace/APIJavaSampleCode/tfModels/dnn/ModelSave\",\"serve\");`\r\n\r\nThen I had another problem ... to execute the model we need to pass strings to say what is the input and output \"operation\". \r\n\r\nSomeone told me (on youtube) they are \"input_example_tensor\" and ouput \"dnn/multi_class_head/predictions/probabilities\". Dont know how they discover this (?).\r\n(again if there is some documentation about it I would be  grateful)\r\nSo the code I have in java for the moment is this :\r\n\r\n`\r\n\tSavedModelBundle bundle=SavedModelBundle.load(\"/java/workspace/APIJavaSampleCode/tfModels/dnn/ModelSave\",\"serve\");\r\n\t\tSession s = bundle.session();\r\n\t\t\r\n\t\tdouble[] inputDouble = {1.0,0.7982741870963959,1.0,-0.46270838239235024,0.040320274521029376,0.443451913224413,-1.0,1.0,1.0,-1.0,0.36689718911339564,-0.13577379160035796,-0.5162916256414466,-0.03373651520104648,1.0,1.0,1.0,1.0,0.786999801054777,-0.43856035121103853,-0.8199093927945158,1.0,-1.0,-1.0,-0.1134921695894473,-1.0,0.6420892436196663,0.7871737734493178,1.0,0.6501788845358409,1.0,1.0,1.0,-0.17586627413625022,0.8817194210401085};\r\n\t\tfloat [] inputfloat=new float[inputDouble.length];\r\n\t\tfor(int i=0;i<inputfloat.length;i++)\r\n\t\t{\r\n\t\t\tinputfloat[i]=(float)inputDouble[i];\r\n\t\t}\r\n\t\tTensor inputTensor = Tensor.create(new long[] {35}, FloatBuffer.wrap(inputfloat) );\r\n\t\t\r\n\t\tTensor result = s.runner()\r\n\t            .feed(\"input_example_tensor\", inputTensor)\r\n\t            .fetch(\"dnn/multi_class_head/predictions/probabilities\")\r\n\t            .run().get(0);\r\n\t\t\r\n`\r\n\r\nNow  I have the following error on java side :\r\n\r\n`\r\nException in thread \"main\" org.tensorflow.TensorFlowException: Output 0 of type float does not match declared output type string for node _recv_input_example_tensor_0 = _Recv[_output_shapes=[[-1]], client_terminated=true, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=-5952653602839817343, tensor_name=\"input_example_tensor:0\", tensor_type=DT_STRING, _device=\"/job:localhost/replica:0/task:0/cpu:0\"]()\r\n\tat org.tensorflow.Session.run(Native Method)\r\n\tat org.tensorflow.Session.access$100(Session.java:48)\r\n\tat org.tensorflow.Session$Runner.runHelper(Session.java:285)\r\n\tat org.tensorflow.Session$Runner.run(Session.java:235)\r\n...\r\n`\r\n\r\nAny suggestion to overcame this error (I hope the last challenging problem to execute a  DNNClassifier, made in python, in java )  ?\r\n\r\nthanks in advance \r\n"}