{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/62436867", "pull_request_review_id": null, "id": 62436867, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNDM2ODY3", "diff_hunk": "@@ -505,5 +507,89 @@ def _feed_dict_fn():\n       encoded_out[np.arange(out.size), out] = 1\n       return {input_placeholder.name: inp,\n               output_placeholder.name: encoded_out}\n+    return _feed_dict_fn\n+\n+\n+class HDF5DataFeeder(object):\n+  \"\"\"Data feeder for TF trainer that reads data from HDF5 format.\n+\n+  HDF5 is a popular format to store complicated datasets (alternative to proto files).\n+  This data feeder performs random samples on hdf5 data.\n+\n+  Parameters:\n+    X: iterator that returns for each element, returns features.\n+    y: iterator that returns for each element, returns 1 or many classes /\n+      regression values.\n+    n_classes: indicator of how many classes the target has.\n+    batch_size: Mini batch size to accumulate.\n+    random_state: random state for RNG. Note that it will mutate so use a\n+      int value for this if you want consistent sized batches.\n+\n+  Attributes:\n+    X: input features.\n+    y: input target.\n+    n_classes: number of classes.\n+    batch_size: mini batch size to accumulate.\n+    input_shape: shape of the input.\n+    output_shape: shape of the output.\n+    input_dtype: dtype of input.\n+    output_dtype: dtype of output.\n+  \"\"\"\n+  def __init__(self, X, y, n_classes, batch_size, random_state=None):\n+    # TODO(terrytangyuan): make this compatible for unsupervised approaches\n+    self.X = X\n+    self.y = y\n+    # TODO(terrytangyuan): save column names\n+    self.n_classes = n_classes\n+\n+    X_shape = X.shape\n+    y_shape = y.shape\n+    self.input_shape, self.output_shape = _get_in_out_shape(X_shape, y_shape,\n+                                                            n_classes,\n+                                                            batch_size)\n+    self.input_dtype, self.output_dtype = np.float32, np.float32\n+    if random_state is None:\n+      self.random_state = 66\n+    else:\n+      self.random_state = random_state\n+    self.batch_size = batch_size\n+\n+  def get_feed_params(self):\n+    \"\"\"Function returns a dict with data feed params while training.\n+\n+    Returns:\n+      A dict with data feed params while training.\n+    \"\"\"\n+    return {'batch_size': self.batch_size}\n+\n+  def get_feed_dict_fn(self, input_placeholder, output_placeholder):\n+    \"\"\"Returns a function, that will sample data and provide it to placeholders.\n+\n+    Args:\n+      input_placeholder: tf.Placeholder for input features mini batch.\n+      output_placeholder: tf.Placeholder for output targets.\n \n+    Returns:\n+      A function that when called samples a random subset of batch size\n+      from X and y.\n+    \"\"\"\n+    def _feed_dict_fn():\n+      sample_indices = np.random.randint(0, self.input_shape[0], self.batch_size)", "path": "tensorflow/contrib/learn/python/learn/io/data_feeder.py", "position": null, "original_position": 141, "commit_id": "01b8ec7cde284b1b629cfa26e41f7b9ee02b06b1", "original_commit_id": "6befe768be46c5264bdacaba0645d0e205cd7052", "user": {"login": "ilblackdragon", "id": 175486, "node_id": "MDQ6VXNlcjE3NTQ4Ng==", "avatar_url": "https://avatars2.githubusercontent.com/u/175486?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ilblackdragon", "html_url": "https://github.com/ilblackdragon", "followers_url": "https://api.github.com/users/ilblackdragon/followers", "following_url": "https://api.github.com/users/ilblackdragon/following{/other_user}", "gists_url": "https://api.github.com/users/ilblackdragon/gists{/gist_id}", "starred_url": "https://api.github.com/users/ilblackdragon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ilblackdragon/subscriptions", "organizations_url": "https://api.github.com/users/ilblackdragon/orgs", "repos_url": "https://api.github.com/users/ilblackdragon/repos", "events_url": "https://api.github.com/users/ilblackdragon/events{/privacy}", "received_events_url": "https://api.github.com/users/ilblackdragon/received_events", "type": "User", "site_admin": false}, "body": "this code seems similar to regular data feed, I wonder if we can pull out a function or two.\n", "created_at": "2016-05-08T19:18:55Z", "updated_at": "2016-05-10T03:09:15Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/2274#discussion_r62436867", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/2274", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/62436867"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/2274#discussion_r62436867"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/2274"}}, "body_html": "<p>this code seems similar to regular data feed, I wonder if we can pull out a function or two.</p>", "body_text": "this code seems similar to regular data feed, I wonder if we can pull out a function or two."}