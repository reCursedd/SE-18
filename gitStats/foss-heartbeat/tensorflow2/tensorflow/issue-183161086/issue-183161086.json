{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4974", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4974/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4974/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4974/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/4974", "id": 183161086, "node_id": "MDU6SXNzdWUxODMxNjEwODY=", "number": 4974, "title": "Hermetically seal the protobuf build", "user": {"login": "jart", "id": 49262, "node_id": "MDQ6VXNlcjQ5MjYy", "avatar_url": "https://avatars1.githubusercontent.com/u/49262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jart", "html_url": "https://github.com/jart", "followers_url": "https://api.github.com/users/jart/followers", "following_url": "https://api.github.com/users/jart/following{/other_user}", "gists_url": "https://api.github.com/users/jart/gists{/gist_id}", "starred_url": "https://api.github.com/users/jart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jart/subscriptions", "organizations_url": "https://api.github.com/users/jart/orgs", "repos_url": "https://api.github.com/users/jart/repos", "events_url": "https://api.github.com/users/jart/events{/privacy}", "received_events_url": "https://api.github.com/users/jart/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473173351, "node_id": "MDU6TGFiZWw0NzMxNzMzNTE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:build/install", "name": "type:build/install", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "jart", "id": 49262, "node_id": "MDQ6VXNlcjQ5MjYy", "avatar_url": "https://avatars1.githubusercontent.com/u/49262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jart", "html_url": "https://github.com/jart", "followers_url": "https://api.github.com/users/jart/followers", "following_url": "https://api.github.com/users/jart/following{/other_user}", "gists_url": "https://api.github.com/users/jart/gists{/gist_id}", "starred_url": "https://api.github.com/users/jart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jart/subscriptions", "organizations_url": "https://api.github.com/users/jart/orgs", "repos_url": "https://api.github.com/users/jart/repos", "events_url": "https://api.github.com/users/jart/events{/privacy}", "received_events_url": "https://api.github.com/users/jart/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jart", "id": 49262, "node_id": "MDQ6VXNlcjQ5MjYy", "avatar_url": "https://avatars1.githubusercontent.com/u/49262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jart", "html_url": "https://github.com/jart", "followers_url": "https://api.github.com/users/jart/followers", "following_url": "https://api.github.com/users/jart/following{/other_user}", "gists_url": "https://api.github.com/users/jart/gists{/gist_id}", "starred_url": "https://api.github.com/users/jart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jart/subscriptions", "organizations_url": "https://api.github.com/users/jart/orgs", "repos_url": "https://api.github.com/users/jart/repos", "events_url": "https://api.github.com/users/jart/events{/privacy}", "received_events_url": "https://api.github.com/users/jart/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2016-10-14T22:09:03Z", "updated_at": "2017-06-16T18:19:48Z", "closed_at": "2017-06-16T18:19:48Z", "author_association": "MEMBER", "body_html": "<p>Our protobuf rules don't always compile if sandboxing is enabled in <code>~/.bazelrc</code>. For example:</p>\n<pre><code>build --worker_sandboxing=true  \nbuild --spawn_strategy=sandboxed  \nbuild --genrule_strategy=sandboxed\ntest --spawn_strategy=sandboxed\n</code></pre>\n<p>We end up with errors like this when compiling things like <code>bazel build tensorflow/python/tools:strip_unused</code>.</p>\n<pre><code>INFO: From ProtoCompile tensorflow/python/training/checkpoint_state_pb2.py:\nexternal/protobuf/python: warning: directory does not exist.\nINFO: From ProtoCompile tensorflow/contrib/session_bundle/manifest_pb2.py:\nexternal/protobuf/python: warning: directory does not exist.\nINFO: From ProtoCompile tensorflow/contrib/tensorboard/plugins/projector/projector_config_pb2.py:\nexternal/protobuf/python: warning: directory does not exist.\nERROR: /usr/local/google/home/jart/code/tensorflow-clean/tensorflow/contrib/tfprof/tools/tfprof/BUILD:42:1: null failed: linux-sandbox failed: error executing command \n  (cd /usr/local/google/home/jart/.cache/bazel/_bazel_jart/534cc9069a4bd39f8bace6b1039c6506/bazel-sandbox/978fc997-2a45-4494-836a-df35eb0b4705-842/execroot/tensorflow-clean &amp;&amp; \\\n  exec env - \\\n  /usr/local/google/home/jart/.cache/bazel/_bazel_jart/534cc9069a4bd39f8bace6b1039c6506/execroot/tensorflow-clean/_bin/linux-sandbox @/usr/local/google/home/jart/.cache/bazel/_bazel_jart/534cc9069a4bd39f8bace6b1039c6506/bazel-sandbox/978fc997-2a45-4494-836a-df35eb0b4705-842/linux-sandbox.params -- bazel-out/host/bin/external/protobuf/protoc '--python_out=bazel-out/local-fastbuild/genfiles/' -I. -Iexternal/protobuf/python -Ibazel-out/local-fastbuild/genfiles/external/protobuf/python tensorflow/contrib/tfprof/tools/tfprof/tfprof_log.proto tensorflow/contrib/tfprof/tools/tfprof/tfprof_output.proto).\nexternal/protobuf/python: warning: directory does not exist.\ntensorflow/core/framework/tensor_shape.proto: File not found.\ntensorflow/core/framework/types.proto: File not found.\ntensorflow/contrib/tfprof/tools/tfprof/tfprof_output.proto: Import \"tensorflow/core/framework/tensor_shape.proto\" was not found or had errors.\ntensorflow/contrib/tfprof/tools/tfprof/tfprof_output.proto: Import \"tensorflow/core/framework/types.proto\" was not found or had errors.\ntensorflow/contrib/tfprof/tools/tfprof/tfprof_output.proto:9:12: \"DataType\" is not defined.\ntensorflow/contrib/tfprof/tools/tfprof/tfprof_output.proto:45:12: \"TensorShapeProto\" is not defined.\nTarget //tensorflow/python/tools:strip_unused failed to build\nINFO: Elapsed time: 53.186s, Critical Path: 40.69s\n</code></pre>\n<p>We might want to rewrite the protobuf rules so they can have well defined relationships.</p>", "body_text": "Our protobuf rules don't always compile if sandboxing is enabled in ~/.bazelrc. For example:\nbuild --worker_sandboxing=true  \nbuild --spawn_strategy=sandboxed  \nbuild --genrule_strategy=sandboxed\ntest --spawn_strategy=sandboxed\n\nWe end up with errors like this when compiling things like bazel build tensorflow/python/tools:strip_unused.\nINFO: From ProtoCompile tensorflow/python/training/checkpoint_state_pb2.py:\nexternal/protobuf/python: warning: directory does not exist.\nINFO: From ProtoCompile tensorflow/contrib/session_bundle/manifest_pb2.py:\nexternal/protobuf/python: warning: directory does not exist.\nINFO: From ProtoCompile tensorflow/contrib/tensorboard/plugins/projector/projector_config_pb2.py:\nexternal/protobuf/python: warning: directory does not exist.\nERROR: /usr/local/google/home/jart/code/tensorflow-clean/tensorflow/contrib/tfprof/tools/tfprof/BUILD:42:1: null failed: linux-sandbox failed: error executing command \n  (cd /usr/local/google/home/jart/.cache/bazel/_bazel_jart/534cc9069a4bd39f8bace6b1039c6506/bazel-sandbox/978fc997-2a45-4494-836a-df35eb0b4705-842/execroot/tensorflow-clean && \\\n  exec env - \\\n  /usr/local/google/home/jart/.cache/bazel/_bazel_jart/534cc9069a4bd39f8bace6b1039c6506/execroot/tensorflow-clean/_bin/linux-sandbox @/usr/local/google/home/jart/.cache/bazel/_bazel_jart/534cc9069a4bd39f8bace6b1039c6506/bazel-sandbox/978fc997-2a45-4494-836a-df35eb0b4705-842/linux-sandbox.params -- bazel-out/host/bin/external/protobuf/protoc '--python_out=bazel-out/local-fastbuild/genfiles/' -I. -Iexternal/protobuf/python -Ibazel-out/local-fastbuild/genfiles/external/protobuf/python tensorflow/contrib/tfprof/tools/tfprof/tfprof_log.proto tensorflow/contrib/tfprof/tools/tfprof/tfprof_output.proto).\nexternal/protobuf/python: warning: directory does not exist.\ntensorflow/core/framework/tensor_shape.proto: File not found.\ntensorflow/core/framework/types.proto: File not found.\ntensorflow/contrib/tfprof/tools/tfprof/tfprof_output.proto: Import \"tensorflow/core/framework/tensor_shape.proto\" was not found or had errors.\ntensorflow/contrib/tfprof/tools/tfprof/tfprof_output.proto: Import \"tensorflow/core/framework/types.proto\" was not found or had errors.\ntensorflow/contrib/tfprof/tools/tfprof/tfprof_output.proto:9:12: \"DataType\" is not defined.\ntensorflow/contrib/tfprof/tools/tfprof/tfprof_output.proto:45:12: \"TensorShapeProto\" is not defined.\nTarget //tensorflow/python/tools:strip_unused failed to build\nINFO: Elapsed time: 53.186s, Critical Path: 40.69s\n\nWe might want to rewrite the protobuf rules so they can have well defined relationships.", "body": "Our protobuf rules don't always compile if sandboxing is enabled in `~/.bazelrc`. For example:\n\n```\nbuild --worker_sandboxing=true  \nbuild --spawn_strategy=sandboxed  \nbuild --genrule_strategy=sandboxed\ntest --spawn_strategy=sandboxed\n```\n\nWe end up with errors like this when compiling things like `bazel build tensorflow/python/tools:strip_unused`.\n\n```\nINFO: From ProtoCompile tensorflow/python/training/checkpoint_state_pb2.py:\nexternal/protobuf/python: warning: directory does not exist.\nINFO: From ProtoCompile tensorflow/contrib/session_bundle/manifest_pb2.py:\nexternal/protobuf/python: warning: directory does not exist.\nINFO: From ProtoCompile tensorflow/contrib/tensorboard/plugins/projector/projector_config_pb2.py:\nexternal/protobuf/python: warning: directory does not exist.\nERROR: /usr/local/google/home/jart/code/tensorflow-clean/tensorflow/contrib/tfprof/tools/tfprof/BUILD:42:1: null failed: linux-sandbox failed: error executing command \n  (cd /usr/local/google/home/jart/.cache/bazel/_bazel_jart/534cc9069a4bd39f8bace6b1039c6506/bazel-sandbox/978fc997-2a45-4494-836a-df35eb0b4705-842/execroot/tensorflow-clean && \\\n  exec env - \\\n  /usr/local/google/home/jart/.cache/bazel/_bazel_jart/534cc9069a4bd39f8bace6b1039c6506/execroot/tensorflow-clean/_bin/linux-sandbox @/usr/local/google/home/jart/.cache/bazel/_bazel_jart/534cc9069a4bd39f8bace6b1039c6506/bazel-sandbox/978fc997-2a45-4494-836a-df35eb0b4705-842/linux-sandbox.params -- bazel-out/host/bin/external/protobuf/protoc '--python_out=bazel-out/local-fastbuild/genfiles/' -I. -Iexternal/protobuf/python -Ibazel-out/local-fastbuild/genfiles/external/protobuf/python tensorflow/contrib/tfprof/tools/tfprof/tfprof_log.proto tensorflow/contrib/tfprof/tools/tfprof/tfprof_output.proto).\nexternal/protobuf/python: warning: directory does not exist.\ntensorflow/core/framework/tensor_shape.proto: File not found.\ntensorflow/core/framework/types.proto: File not found.\ntensorflow/contrib/tfprof/tools/tfprof/tfprof_output.proto: Import \"tensorflow/core/framework/tensor_shape.proto\" was not found or had errors.\ntensorflow/contrib/tfprof/tools/tfprof/tfprof_output.proto: Import \"tensorflow/core/framework/types.proto\" was not found or had errors.\ntensorflow/contrib/tfprof/tools/tfprof/tfprof_output.proto:9:12: \"DataType\" is not defined.\ntensorflow/contrib/tfprof/tools/tfprof/tfprof_output.proto:45:12: \"TensorShapeProto\" is not defined.\nTarget //tensorflow/python/tools:strip_unused failed to build\nINFO: Elapsed time: 53.186s, Critical Path: 40.69s\n```\n\nWe might want to rewrite the protobuf rules so they can have well defined relationships.\n"}