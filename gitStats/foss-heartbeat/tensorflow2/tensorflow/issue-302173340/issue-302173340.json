{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17423", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17423/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17423/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17423/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/17423", "id": 302173340, "node_id": "MDU6SXNzdWUzMDIxNzMzNDA=", "number": 17423, "title": "image_retraining example does not work", "user": {"login": "tushuhei", "id": 734905, "node_id": "MDQ6VXNlcjczNDkwNQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/734905?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tushuhei", "html_url": "https://github.com/tushuhei", "followers_url": "https://api.github.com/users/tushuhei/followers", "following_url": "https://api.github.com/users/tushuhei/following{/other_user}", "gists_url": "https://api.github.com/users/tushuhei/gists{/gist_id}", "starred_url": "https://api.github.com/users/tushuhei/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tushuhei/subscriptions", "organizations_url": "https://api.github.com/users/tushuhei/orgs", "repos_url": "https://api.github.com/users/tushuhei/repos", "events_url": "https://api.github.com/users/tushuhei/events{/privacy}", "received_events_url": "https://api.github.com/users/tushuhei/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "suharshs", "id": 1450614, "node_id": "MDQ6VXNlcjE0NTA2MTQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/1450614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/suharshs", "html_url": "https://github.com/suharshs", "followers_url": "https://api.github.com/users/suharshs/followers", "following_url": "https://api.github.com/users/suharshs/following{/other_user}", "gists_url": "https://api.github.com/users/suharshs/gists{/gist_id}", "starred_url": "https://api.github.com/users/suharshs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/suharshs/subscriptions", "organizations_url": "https://api.github.com/users/suharshs/orgs", "repos_url": "https://api.github.com/users/suharshs/repos", "events_url": "https://api.github.com/users/suharshs/events{/privacy}", "received_events_url": "https://api.github.com/users/suharshs/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "suharshs", "id": 1450614, "node_id": "MDQ6VXNlcjE0NTA2MTQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/1450614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/suharshs", "html_url": "https://github.com/suharshs", "followers_url": "https://api.github.com/users/suharshs/followers", "following_url": "https://api.github.com/users/suharshs/following{/other_user}", "gists_url": "https://api.github.com/users/suharshs/gists{/gist_id}", "starred_url": "https://api.github.com/users/suharshs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/suharshs/subscriptions", "organizations_url": "https://api.github.com/users/suharshs/orgs", "repos_url": "https://api.github.com/users/suharshs/repos", "events_url": "https://api.github.com/users/suharshs/events{/privacy}", "received_events_url": "https://api.github.com/users/suharshs/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2018-03-05T05:09:12Z", "updated_at": "2018-06-30T17:56:43Z", "closed_at": "2018-04-06T21:25:38Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: No</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: macOS 10.13.3</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: v1.5.0-0-g37aa430d84 1.5.0</li>\n<li><strong>Python version</strong>: 3.6.4</li>\n<li><strong>Exact command to reproduce</strong>:<br>\npython3 tensorflow/examples/image_retraining/retrain.py <br>\n--image_dir ~/Resources/tf-retrain-images/ <br>\n--learning_rate=0.0001 <br>\n--testing_percentage=10 <br>\n--validation_percentage=10 <br>\n--train_batch_size=32 <br>\n--validation_batch_size=-1 <br>\n--flip_left_right True <br>\n--random_scale=30 <br>\n--random_brightness=30 <br>\n--eval_step_interval=100 <br>\n--how_many_training_steps=500 <br>\n--architecture mobilenet_0.25_224</li>\n</ul>\n<h3>Describe the problem</h3>\n<p><code>retrain.py</code> fails with the error below when it starts to create bottleneck files for testing datasets after training is done. Looks like something wrong with making bottleneck files for test images.<br>\nFYI, it works when I checkout <code>retrain.py</code> back to commit <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/dce9a49c19f406ba45919e8c94474e55dc5ccd54/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/dce9a49c19f406ba45919e8c94474e55dc5ccd54\"><tt>dce9a49</tt></a>.</p>\n<h3>Source code / logs</h3>\n<p>...<br>\nINFO:tensorflow:2018-03-05 13:31:17.056049: Step 90: Validation accuracy = 89.0% (N=73)<br>\nINFO:tensorflow:2018-03-05 13:31:25.350794: Step 99: Train accuracy = 96.9%<br>\nINFO:tensorflow:2018-03-05 13:31:25.350940: Step 99: Cross entropy = 0.198750<br>\nINFO:tensorflow:2018-03-05 13:31:25.398267: Step 99: Validation accuracy = 89.0% (N=73)<br>\nModel path:  /tmp/imagenet/mobilenet_v1_0.25_224_frozen.pb<br>\nINFO:tensorflow:Restoring parameters from /tmp/_retrain_checkpoint<br>\nINFO:tensorflow:Creating bottleneck at /tmp/bottleneck/cat/cat.1.jpg_mobilenet_0.25_224.txt<br>\nTraceback (most recent call last):<br>\nFile \"/Users/tushuhei/py3env/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1070, in _run<br>\nallow_operation=False)<br>\nFile \"/Users/tushuhei/py3env/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 3323, in as_graph_element<br>\nreturn self._as_graph_element_locked(obj, allow_tensor, allow_operation)<br>\nFile \"/Users/tushuhei/py3env/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 3402, in _as_graph_element_locked<br>\nraise ValueError(\"Tensor %s is not an element of this graph.\" % obj)<br>\nValueError: Tensor Tensor(\"DecodeJPGInput:0\", dtype=string) is not an element of this graph.</p>\n<p>During handling of the above exception, another exception occurred:</p>\n<p>Traceback (most recent call last):<br>\nFile \"tensorflow/examples/image_retraining/retrain.py\", line 394, in create_bottleneck_file<br>\nresized_input_tensor, bottleneck_tensor)<br>\nFile \"tensorflow/examples/image_retraining/retrain.py\", line 326, in run_bottleneck_on_image<br>\n{image_data_tensor: image_data})<br>\nFile \"/Users/tushuhei/py3env/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 895, in run<br>\nrun_metadata_ptr)<br>\nFile \"/Users/tushuhei/py3env/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1073, in _run<br>\n+ e.args[0])<br>\nTypeError: Cannot interpret feed_dict key as Tensor: Tensor Tensor(\"DecodeJPGInput:0\", dtype=string) is not an element of this graph.</p>\n<p>During handling of the above exception, another exception occurred:</p>\n<p>Traceback (most recent call last):<br>\nFile \"tensorflow/examples/image_retraining/retrain.py\", line 1486, in <br>\ntf.app.run(main=main, argv=[sys.argv[0]] + unparsed)<br>\nFile \"/Users/tushuhei/py3env/lib/python3.6/site-packages/tensorflow/python/platform/app.py\", line 124, in run<br>\n_sys.exit(main(argv))<br>\nFile \"tensorflow/examples/image_retraining/retrain.py\", line 1286, in main<br>\nbottleneck_tensor)<br>\nFile \"tensorflow/examples/image_retraining/retrain.py\", line 881, in run_final_eval<br>\nbottleneck_tensor, FLAGS.architecture))<br>\nFile \"tensorflow/examples/image_retraining/retrain.py\", line 567, in get_random_cached_bottlenecks<br>\nresized_input_tensor, bottleneck_tensor, architecture)<br>\nFile \"tensorflow/examples/image_retraining/retrain.py\", line 442, in get_or_create_bottleneck<br>\nbottleneck_tensor)<br>\nFile \"tensorflow/examples/image_retraining/retrain.py\", line 397, in create_bottleneck_file<br>\nstr(e)))<br>\nRuntimeError: Error during processing file /Users/tushuhei/Resources/tf-retrain-images/cat/cat.1.jpg (Cannot interpret feed_dict key as Tensor: Tensor Tensor(\"DecodeJPGInput:0\", dtype=string) is not an element of this graph.)</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): No\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): macOS 10.13.3\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below): v1.5.0-0-g37aa430d84 1.5.0\nPython version: 3.6.4\nExact command to reproduce:\npython3 tensorflow/examples/image_retraining/retrain.py \n--image_dir ~/Resources/tf-retrain-images/ \n--learning_rate=0.0001 \n--testing_percentage=10 \n--validation_percentage=10 \n--train_batch_size=32 \n--validation_batch_size=-1 \n--flip_left_right True \n--random_scale=30 \n--random_brightness=30 \n--eval_step_interval=100 \n--how_many_training_steps=500 \n--architecture mobilenet_0.25_224\n\nDescribe the problem\nretrain.py fails with the error below when it starts to create bottleneck files for testing datasets after training is done. Looks like something wrong with making bottleneck files for test images.\nFYI, it works when I checkout retrain.py back to commit dce9a49.\nSource code / logs\n...\nINFO:tensorflow:2018-03-05 13:31:17.056049: Step 90: Validation accuracy = 89.0% (N=73)\nINFO:tensorflow:2018-03-05 13:31:25.350794: Step 99: Train accuracy = 96.9%\nINFO:tensorflow:2018-03-05 13:31:25.350940: Step 99: Cross entropy = 0.198750\nINFO:tensorflow:2018-03-05 13:31:25.398267: Step 99: Validation accuracy = 89.0% (N=73)\nModel path:  /tmp/imagenet/mobilenet_v1_0.25_224_frozen.pb\nINFO:tensorflow:Restoring parameters from /tmp/_retrain_checkpoint\nINFO:tensorflow:Creating bottleneck at /tmp/bottleneck/cat/cat.1.jpg_mobilenet_0.25_224.txt\nTraceback (most recent call last):\nFile \"/Users/tushuhei/py3env/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1070, in _run\nallow_operation=False)\nFile \"/Users/tushuhei/py3env/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 3323, in as_graph_element\nreturn self._as_graph_element_locked(obj, allow_tensor, allow_operation)\nFile \"/Users/tushuhei/py3env/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 3402, in _as_graph_element_locked\nraise ValueError(\"Tensor %s is not an element of this graph.\" % obj)\nValueError: Tensor Tensor(\"DecodeJPGInput:0\", dtype=string) is not an element of this graph.\nDuring handling of the above exception, another exception occurred:\nTraceback (most recent call last):\nFile \"tensorflow/examples/image_retraining/retrain.py\", line 394, in create_bottleneck_file\nresized_input_tensor, bottleneck_tensor)\nFile \"tensorflow/examples/image_retraining/retrain.py\", line 326, in run_bottleneck_on_image\n{image_data_tensor: image_data})\nFile \"/Users/tushuhei/py3env/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 895, in run\nrun_metadata_ptr)\nFile \"/Users/tushuhei/py3env/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1073, in _run\n+ e.args[0])\nTypeError: Cannot interpret feed_dict key as Tensor: Tensor Tensor(\"DecodeJPGInput:0\", dtype=string) is not an element of this graph.\nDuring handling of the above exception, another exception occurred:\nTraceback (most recent call last):\nFile \"tensorflow/examples/image_retraining/retrain.py\", line 1486, in \ntf.app.run(main=main, argv=[sys.argv[0]] + unparsed)\nFile \"/Users/tushuhei/py3env/lib/python3.6/site-packages/tensorflow/python/platform/app.py\", line 124, in run\n_sys.exit(main(argv))\nFile \"tensorflow/examples/image_retraining/retrain.py\", line 1286, in main\nbottleneck_tensor)\nFile \"tensorflow/examples/image_retraining/retrain.py\", line 881, in run_final_eval\nbottleneck_tensor, FLAGS.architecture))\nFile \"tensorflow/examples/image_retraining/retrain.py\", line 567, in get_random_cached_bottlenecks\nresized_input_tensor, bottleneck_tensor, architecture)\nFile \"tensorflow/examples/image_retraining/retrain.py\", line 442, in get_or_create_bottleneck\nbottleneck_tensor)\nFile \"tensorflow/examples/image_retraining/retrain.py\", line 397, in create_bottleneck_file\nstr(e)))\nRuntimeError: Error during processing file /Users/tushuhei/Resources/tf-retrain-images/cat/cat.1.jpg (Cannot interpret feed_dict key as Tensor: Tensor Tensor(\"DecodeJPGInput:0\", dtype=string) is not an element of this graph.)", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: macOS 10.13.3\r\n- **TensorFlow installed from (source or binary)**: binary\r\n- **TensorFlow version (use command below)**: v1.5.0-0-g37aa430d84 1.5.0\r\n- **Python version**: 3.6.4\r\n- **Exact command to reproduce**:\r\n      python3 tensorflow/examples/image_retraining/retrain.py \\\r\n      --image_dir ~/Resources/tf-retrain-images/ \\\r\n      --learning_rate=0.0001 \\\r\n      --testing_percentage=10 \\\r\n      --validation_percentage=10 \\\r\n      --train_batch_size=32 \\\r\n      --validation_batch_size=-1 \\\r\n      --flip_left_right True \\\r\n      --random_scale=30 \\\r\n      --random_brightness=30 \\\r\n      --eval_step_interval=100 \\\r\n      --how_many_training_steps=500 \\\r\n      --architecture mobilenet_0.25_224\r\n\r\n### Describe the problem\r\n`retrain.py` fails with the error below when it starts to create bottleneck files for testing datasets after training is done. Looks like something wrong with making bottleneck files for test images.\r\nFYI, it works when I checkout `retrain.py` back to commit dce9a49c.\r\n\r\n### Source code / logs\r\n...\r\nINFO:tensorflow:2018-03-05 13:31:17.056049: Step 90: Validation accuracy = 89.0% (N=73)\r\nINFO:tensorflow:2018-03-05 13:31:25.350794: Step 99: Train accuracy = 96.9%\r\nINFO:tensorflow:2018-03-05 13:31:25.350940: Step 99: Cross entropy = 0.198750\r\nINFO:tensorflow:2018-03-05 13:31:25.398267: Step 99: Validation accuracy = 89.0% (N=73)\r\nModel path:  /tmp/imagenet/mobilenet_v1_0.25_224_frozen.pb\r\nINFO:tensorflow:Restoring parameters from /tmp/_retrain_checkpoint\r\nINFO:tensorflow:Creating bottleneck at /tmp/bottleneck/cat/cat.1.jpg_mobilenet_0.25_224.txt\r\nTraceback (most recent call last):\r\n  File \"/Users/tushuhei/py3env/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1070, in _run\r\n    allow_operation=False)\r\n  File \"/Users/tushuhei/py3env/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 3323, in as_graph_element\r\n    return self._as_graph_element_locked(obj, allow_tensor, allow_operation)\r\n  File \"/Users/tushuhei/py3env/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 3402, in _as_graph_element_locked\r\n    raise ValueError(\"Tensor %s is not an element of this graph.\" % obj)\r\nValueError: Tensor Tensor(\"DecodeJPGInput:0\", dtype=string) is not an element of this graph.\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"tensorflow/examples/image_retraining/retrain.py\", line 394, in create_bottleneck_file\r\n    resized_input_tensor, bottleneck_tensor)\r\n  File \"tensorflow/examples/image_retraining/retrain.py\", line 326, in run_bottleneck_on_image\r\n    {image_data_tensor: image_data})\r\n  File \"/Users/tushuhei/py3env/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 895, in run\r\n    run_metadata_ptr)\r\n  File \"/Users/tushuhei/py3env/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1073, in _run\r\n    + e.args[0])\r\nTypeError: Cannot interpret feed_dict key as Tensor: Tensor Tensor(\"DecodeJPGInput:0\", dtype=string) is not an element of this graph.\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"tensorflow/examples/image_retraining/retrain.py\", line 1486, in <module>\r\n    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)\r\n  File \"/Users/tushuhei/py3env/lib/python3.6/site-packages/tensorflow/python/platform/app.py\", line 124, in run\r\n    _sys.exit(main(argv))\r\n  File \"tensorflow/examples/image_retraining/retrain.py\", line 1286, in main\r\n    bottleneck_tensor)\r\n  File \"tensorflow/examples/image_retraining/retrain.py\", line 881, in run_final_eval\r\n    bottleneck_tensor, FLAGS.architecture))\r\n  File \"tensorflow/examples/image_retraining/retrain.py\", line 567, in get_random_cached_bottlenecks\r\n    resized_input_tensor, bottleneck_tensor, architecture)\r\n  File \"tensorflow/examples/image_retraining/retrain.py\", line 442, in get_or_create_bottleneck\r\n    bottleneck_tensor)\r\n  File \"tensorflow/examples/image_retraining/retrain.py\", line 397, in create_bottleneck_file\r\n    str(e)))\r\nRuntimeError: Error during processing file /Users/tushuhei/Resources/tf-retrain-images/cat/cat.1.jpg (Cannot interpret feed_dict key as Tensor: Tensor Tensor(\"DecodeJPGInput:0\", dtype=string) is not an element of this graph.)\r\n"}