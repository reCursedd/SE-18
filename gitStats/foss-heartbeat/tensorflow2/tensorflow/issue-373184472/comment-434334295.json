{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/434334295", "html_url": "https://github.com/tensorflow/tensorflow/issues/23195#issuecomment-434334295", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23195", "id": 434334295, "node_id": "MDEyOklzc3VlQ29tbWVudDQzNDMzNDI5NQ==", "user": {"login": "brianmartin", "id": 130559, "node_id": "MDQ6VXNlcjEzMDU1OQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/130559?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brianmartin", "html_url": "https://github.com/brianmartin", "followers_url": "https://api.github.com/users/brianmartin/followers", "following_url": "https://api.github.com/users/brianmartin/following{/other_user}", "gists_url": "https://api.github.com/users/brianmartin/gists{/gist_id}", "starred_url": "https://api.github.com/users/brianmartin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brianmartin/subscriptions", "organizations_url": "https://api.github.com/users/brianmartin/orgs", "repos_url": "https://api.github.com/users/brianmartin/repos", "events_url": "https://api.github.com/users/brianmartin/events{/privacy}", "received_events_url": "https://api.github.com/users/brianmartin/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-30T14:56:30Z", "updated_at": "2018-10-30T14:56:30Z", "author_association": "NONE", "body_html": "<p>I've dug in a bit more. For a FixedLenFeature, this test case still succeeds on the first read and fails on the second read -- no change there. But it fails with an exception rather than the segfault we see with VarLenFeature.</p>\n<p>I've updated the gist to reproduce in tensorflow&gt;=1.11.0 here: <a href=\"https://gist.github.com/brianmartin/4f221eb838dce8099342f829fb13253d\">https://gist.github.com/brianmartin/4f221eb838dce8099342f829fb13253d</a></p>\n<p>The exception on the second, failing read (after seeing the first read succeed):</p>\n<pre><code>Attempting first read..\n2018-10-30 10:53:26.766551: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\n{'f0': &lt;tf.Tensor: id=26, shape=(1, 1), dtype=int64, numpy=array([[1]])&gt;}\nAttempting second identical read..\nTraceback (most recent call last):\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/scratch.py\", line 109, in &lt;module&gt;\n    main()\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/scratch.py\", line 104, in main\n    run(make_it_fail, read_fn, var_len=var_len)\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/scratch.py\", line 79, in run\n    _print_first(read_fn(data_file, feature_spec))\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/scratch.py\", line 35, in _print_first\n    print next(xs.__iter__())\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/tensorflow/python/data/ops/dataset_ops.py\", line 139, in __iter__\n    return iterator_ops.EagerIterator(self)\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/tensorflow/python/data/ops/iterator_ops.py\", line 521, in __init__\n    ds_variant = dataset._as_variant_tensor()  # pylint: disable=protected-access\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/tensorflow/contrib/data/python/ops/parsing_ops.py\", line 90, in _as_variant_tensor\n    **dataset_ops.flat_structure(self))\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/tensorflow/python/ops/gen_dataset_ops.py\", line 3963, in parse_example_dataset\n    ctx=_ctx)\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/tensorflow/python/ops/gen_dataset_ops.py\", line 4015, in parse_example_dataset_eager_fallback\n    attrs=_attrs, ctx=_ctx, name=name)\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/tensorflow/python/eager/execute.py\", line 66, in quick_execute\n    six.raise_from(core._status_to_exception(e.code, message), None)\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/six.py\", line 737, in raise_from\n    raise value\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Expected len(dense_defaults) == len(dense_keys) but got: 1 vs. 0 [Op:ParseExampleDataset]\n</code></pre>", "body_text": "I've dug in a bit more. For a FixedLenFeature, this test case still succeeds on the first read and fails on the second read -- no change there. But it fails with an exception rather than the segfault we see with VarLenFeature.\nI've updated the gist to reproduce in tensorflow>=1.11.0 here: https://gist.github.com/brianmartin/4f221eb838dce8099342f829fb13253d\nThe exception on the second, failing read (after seeing the first read succeed):\nAttempting first read..\n2018-10-30 10:53:26.766551: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\n{'f0': <tf.Tensor: id=26, shape=(1, 1), dtype=int64, numpy=array([[1]])>}\nAttempting second identical read..\nTraceback (most recent call last):\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/scratch.py\", line 109, in <module>\n    main()\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/scratch.py\", line 104, in main\n    run(make_it_fail, read_fn, var_len=var_len)\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/scratch.py\", line 79, in run\n    _print_first(read_fn(data_file, feature_spec))\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/scratch.py\", line 35, in _print_first\n    print next(xs.__iter__())\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/tensorflow/python/data/ops/dataset_ops.py\", line 139, in __iter__\n    return iterator_ops.EagerIterator(self)\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/tensorflow/python/data/ops/iterator_ops.py\", line 521, in __init__\n    ds_variant = dataset._as_variant_tensor()  # pylint: disable=protected-access\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/tensorflow/contrib/data/python/ops/parsing_ops.py\", line 90, in _as_variant_tensor\n    **dataset_ops.flat_structure(self))\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/tensorflow/python/ops/gen_dataset_ops.py\", line 3963, in parse_example_dataset\n    ctx=_ctx)\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/tensorflow/python/ops/gen_dataset_ops.py\", line 4015, in parse_example_dataset_eager_fallback\n    attrs=_attrs, ctx=_ctx, name=name)\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/tensorflow/python/eager/execute.py\", line 66, in quick_execute\n    six.raise_from(core._status_to_exception(e.code, message), None)\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/six.py\", line 737, in raise_from\n    raise value\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Expected len(dense_defaults) == len(dense_keys) but got: 1 vs. 0 [Op:ParseExampleDataset]", "body": "I've dug in a bit more. For a FixedLenFeature, this test case still succeeds on the first read and fails on the second read -- no change there. But it fails with an exception rather than the segfault we see with VarLenFeature.\r\n\r\nI've updated the gist to reproduce in tensorflow>=1.11.0 here: https://gist.github.com/brianmartin/4f221eb838dce8099342f829fb13253d\r\n\r\nThe exception on the second, failing read (after seeing the first read succeed):\r\n\r\n```\r\nAttempting first read..\r\n2018-10-30 10:53:26.766551: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\r\n{'f0': <tf.Tensor: id=26, shape=(1, 1), dtype=int64, numpy=array([[1]])>}\r\nAttempting second identical read..\r\nTraceback (most recent call last):\r\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/scratch.py\", line 109, in <module>\r\n    main()\r\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/scratch.py\", line 104, in main\r\n    run(make_it_fail, read_fn, var_len=var_len)\r\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/scratch.py\", line 79, in run\r\n    _print_first(read_fn(data_file, feature_spec))\r\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/scratch.py\", line 35, in _print_first\r\n    print next(xs.__iter__())\r\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/tensorflow/python/data/ops/dataset_ops.py\", line 139, in __iter__\r\n    return iterator_ops.EagerIterator(self)\r\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/tensorflow/python/data/ops/iterator_ops.py\", line 521, in __init__\r\n    ds_variant = dataset._as_variant_tensor()  # pylint: disable=protected-access\r\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/tensorflow/contrib/data/python/ops/parsing_ops.py\", line 90, in _as_variant_tensor\r\n    **dataset_ops.flat_structure(self))\r\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/tensorflow/python/ops/gen_dataset_ops.py\", line 3963, in parse_example_dataset\r\n    ctx=_ctx)\r\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/tensorflow/python/ops/gen_dataset_ops.py\", line 4015, in parse_example_dataset_eager_fallback\r\n    attrs=_attrs, ctx=_ctx, name=name)\r\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/tensorflow/python/eager/execute.py\", line 66, in quick_execute\r\n    six.raise_from(core._status_to_exception(e.code, message), None)\r\n  File \"/Users/brianm/wrk/spotify-tensorflow-brianmartin/venv/lib/python2.7/site-packages/six.py\", line 737, in raise_from\r\n    raise value\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Expected len(dense_defaults) == len(dense_keys) but got: 1 vs. 0 [Op:ParseExampleDataset]\r\n```\r\n"}