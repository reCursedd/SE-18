{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17695", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17695/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17695/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17695/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/17695", "id": 304963879, "node_id": "MDU6SXNzdWUzMDQ5NjM4Nzk=", "number": 17695, "title": "tf.gfile doesn't understand NTFS Unicode filenames on Windows", "user": {"login": "nfelt", "id": 710113, "node_id": "MDQ6VXNlcjcxMDExMw==", "avatar_url": "https://avatars0.githubusercontent.com/u/710113?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nfelt", "html_url": "https://github.com/nfelt", "followers_url": "https://api.github.com/users/nfelt/followers", "following_url": "https://api.github.com/users/nfelt/following{/other_user}", "gists_url": "https://api.github.com/users/nfelt/gists{/gist_id}", "starred_url": "https://api.github.com/users/nfelt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nfelt/subscriptions", "organizations_url": "https://api.github.com/users/nfelt/orgs", "repos_url": "https://api.github.com/users/nfelt/repos", "events_url": "https://api.github.com/users/nfelt/events{/privacy}", "received_events_url": "https://api.github.com/users/nfelt/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-03-13T22:52:15Z", "updated_at": "2018-03-14T05:13:39Z", "closed_at": "2018-03-14T05:13:39Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: no</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Windows Server 2016 Datacenter, 64-bit, installed on a GCE VM</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary pip package</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.6.0</li>\n<li><strong>Python version</strong>: 3.6</li>\n<li><strong>Bazel version (if compiling from source)</strong>: N/A</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: N/A</li>\n<li><strong>CUDA/cuDNN version</strong>: N/A</li>\n<li><strong>GPU model and memory</strong>: N/A</li>\n<li><strong>Exact command to reproduce</strong>: <code>python -c \"dir = '/tmp/tftest/\\u8c37\\u6b4c'; import tensorflow as tf; import os; os.makedirs(dir); print(os.path.exists(dir), tf.gfile.Exists(dir))\"</code></li>\n</ul>\n<h3>Describe the problem</h3>\n<p>The tf.gfile functions that involve file paths appear not to understand Windows with NTFS filenames that contain Unicode characters, such as \u8c37\u6b4c (\"Google\" in Chinese).  It seems like something about the name isn't translated in a way that actually results in successful lookups, so everything behaves as if those files didn't exist.</p>\n<p>Command to repro:</p>\n<pre><code>python -c \"dir = '/tmp/tftest/\\u8c37\\u6b4c'; import tensorflow as tf; import os; os.makedirs(dir); print(os.path.exists(dir), tf.gfile.Exists(dir))\"\n</code></pre>\n<p>This command run in Windows PowerShell prints \"True False\" i.e. <code>os.path.exists()</code> returns a different result than <code>tf.gfile.Exists()</code>.  This is true even for different ways of formulating that path -<br>\nin addition to <code>/tmp/tftest/\\u8c37\\u6b4c</code> I tested <code>C:/tmp/tftest/\\u8c37\\u6b4c</code> and <code>C:\\\\tmp\\\\tftest\\\\\\u8c37\\u6b4c</code> (double backslashes for the path separators to escape within a python string) and they both produce the same result.  If you remove the unicode characters from the path, it prints \"True True\" as expected.</p>\n<p>In contrast, on my gLinux workstation this prints \"True True\" all the time, i.e. the results are the same.</p>\n<p>I tested this with Exists(), IsDirectory(), and ListDirectory() but I'm assuming it applies generally to all the tf.gfile functions that take a path argument.  Note however that ListDirectory() will <em>return</em> the Unicode name just fine if run in the parent directory, the same as <code>os.listdir()</code>.</p>\n<p>We've gotten a report about this for TensorBoard: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"286554557\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorboard/issues/861\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorboard/issues/861/hovercard\" href=\"https://github.com/tensorflow/tensorboard/issues/861\">tensorflow/tensorboard#861</a></p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): no\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Windows Server 2016 Datacenter, 64-bit, installed on a GCE VM\nTensorFlow installed from (source or binary): binary pip package\nTensorFlow version (use command below): 1.6.0\nPython version: 3.6\nBazel version (if compiling from source): N/A\nGCC/Compiler version (if compiling from source): N/A\nCUDA/cuDNN version: N/A\nGPU model and memory: N/A\nExact command to reproduce: python -c \"dir = '/tmp/tftest/\\u8c37\\u6b4c'; import tensorflow as tf; import os; os.makedirs(dir); print(os.path.exists(dir), tf.gfile.Exists(dir))\"\n\nDescribe the problem\nThe tf.gfile functions that involve file paths appear not to understand Windows with NTFS filenames that contain Unicode characters, such as \u8c37\u6b4c (\"Google\" in Chinese).  It seems like something about the name isn't translated in a way that actually results in successful lookups, so everything behaves as if those files didn't exist.\nCommand to repro:\npython -c \"dir = '/tmp/tftest/\\u8c37\\u6b4c'; import tensorflow as tf; import os; os.makedirs(dir); print(os.path.exists(dir), tf.gfile.Exists(dir))\"\n\nThis command run in Windows PowerShell prints \"True False\" i.e. os.path.exists() returns a different result than tf.gfile.Exists().  This is true even for different ways of formulating that path -\nin addition to /tmp/tftest/\\u8c37\\u6b4c I tested C:/tmp/tftest/\\u8c37\\u6b4c and C:\\\\tmp\\\\tftest\\\\\\u8c37\\u6b4c (double backslashes for the path separators to escape within a python string) and they both produce the same result.  If you remove the unicode characters from the path, it prints \"True True\" as expected.\nIn contrast, on my gLinux workstation this prints \"True True\" all the time, i.e. the results are the same.\nI tested this with Exists(), IsDirectory(), and ListDirectory() but I'm assuming it applies generally to all the tf.gfile functions that take a path argument.  Note however that ListDirectory() will return the Unicode name just fine if run in the parent directory, the same as os.listdir().\nWe've gotten a report about this for TensorBoard: tensorflow/tensorboard#861", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: no\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Windows Server 2016 Datacenter, 64-bit, installed on a GCE VM\r\n- **TensorFlow installed from (source or binary)**: binary pip package\r\n- **TensorFlow version (use command below)**: 1.6.0\r\n- **Python version**: 3.6\r\n- **Bazel version (if compiling from source)**: N/A\r\n- **GCC/Compiler version (if compiling from source)**: N/A\r\n- **CUDA/cuDNN version**: N/A\r\n- **GPU model and memory**: N/A\r\n- **Exact command to reproduce**: `python -c \"dir = '/tmp/tftest/\\u8c37\\u6b4c'; import tensorflow as tf; import os; os.makedirs(dir); print(os.path.exists(dir), tf.gfile.Exists(dir))\"`\r\n\r\n### Describe the problem\r\nThe tf.gfile functions that involve file paths appear not to understand Windows with NTFS filenames that contain Unicode characters, such as \u8c37\u6b4c (\"Google\" in Chinese).  It seems like something about the name isn't translated in a way that actually results in successful lookups, so everything behaves as if those files didn't exist.\r\n\r\nCommand to repro:\r\n```\r\npython -c \"dir = '/tmp/tftest/\\u8c37\\u6b4c'; import tensorflow as tf; import os; os.makedirs(dir); print(os.path.exists(dir), tf.gfile.Exists(dir))\"\r\n```\r\n\r\nThis command run in Windows PowerShell prints \"True False\" i.e. `os.path.exists()` returns a different result than `tf.gfile.Exists()`.  This is true even for different ways of formulating that path -\r\n in addition to `/tmp/tftest/\\u8c37\\u6b4c` I tested `C:/tmp/tftest/\\u8c37\\u6b4c` and `C:\\\\tmp\\\\tftest\\\\\\u8c37\\u6b4c` (double backslashes for the path separators to escape within a python string) and they both produce the same result.  If you remove the unicode characters from the path, it prints \"True True\" as expected.\r\n\r\nIn contrast, on my gLinux workstation this prints \"True True\" all the time, i.e. the results are the same.\r\n\r\nI tested this with Exists(), IsDirectory(), and ListDirectory() but I'm assuming it applies generally to all the tf.gfile functions that take a path argument.  Note however that ListDirectory() will *return* the Unicode name just fine if run in the parent directory, the same as `os.listdir()`.\r\n\r\nWe've gotten a report about this for TensorBoard: https://github.com/tensorflow/tensorboard/issues/861\r\n"}