{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/150394199", "pull_request_review_id": 75942700, "id": 150394199, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1MDM5NDE5OQ==", "diff_hunk": "@@ -0,0 +1,127 @@\n+FROM ubuntu\n+\n+LABEL maintainer=\"Clayne Robison<clayne.b.robison@intel.com>\"\n+\n+# It is possible to override these for releases.\n+ARG TF_BRANCH=r1.4\n+ARG BAZEL_VERSION=0.7.0\n+ARG WHL_DIR=/whl\n+\n+RUN apt-get update && apt-get install -y --no-install-recommends \\\n+        build-essential \\\n+        curl \\\n+        git \\\n+        golang \\\n+        libcurl3-dev \\\n+        libfreetype6-dev \\\n+        libzmq3-dev \\\n+        pkg-config \\\n+        python-dev \\\n+        python-pip \\\n+        rsync \\\n+        software-properties-common \\\n+        unzip \\\n+        zip \\\n+        zlib1g-dev \\\n+        openjdk-8-jdk \\\n+        openjdk-8-jre-headless \\\n+        wget \\\n+\tlocate \\\n+\tvim \\\n+        && \\\n+    apt-get clean && \\\n+    rm -rf /var/lib/apt/lists/*\n+\n+RUN pip --no-cache-dir install --upgrade \\\n+        pip setuptools\n+\n+RUN pip --no-cache-dir install \\\n+        ipykernel \\\n+        matplotlib \\\n+        numpy \\\n+        scipy \\\n+        sklearn \\\n+        pandas \\\n+        wheel \\\n+        && \\\n+    python -m ipykernel.kernelspec\n+\n+# Set up Bazel.\n+\n+# Running bazel inside a `docker build` command causes trouble, cf:\n+#   https://github.com/bazelbuild/bazel/issues/134\n+# The easiest solution is to set up a bazelrc file forcing --batch.\n+RUN echo \"startup --batch\" >>/etc/bazel.bazelrc\n+# Similarly, we need to workaround sandboxing issues:\n+#   https://github.com/bazelbuild/bazel/issues/418\n+RUN echo \"build --spawn_strategy=standalone --genrule_strategy=standalone\" \\\n+    >>/etc/bazel.bazelrc\n+WORKDIR /\n+RUN mkdir /bazel && \\\n+    cd /bazel && \\\n+    wget --quiet https://github.com/bazelbuild/bazel/releases/download/$BAZEL_VERSION/bazel-$BAZEL_VERSION-installer-linux-x86_64.sh && \\\n+    wget --quiet https://raw.githubusercontent.com/bazelbuild/bazel/master/LICENSE && \\\n+    chmod +x bazel-*.sh && \\\n+    ./bazel-$BAZEL_VERSION-installer-linux-x86_64.sh && \\\n+    rm -f /bazel/bazel-$BAZEL_VERSION-installer-linux-x86_64.sh\n+\n+# Download and build TensorFlow.\n+WORKDIR /\n+RUN git clone https://github.com/tensorflow/tensorflow.git && \\\n+    cd tensorflow && \\\n+    git checkout ${TF_BRANCH}\n+WORKDIR /tensorflow\n+\n+# Configure the build for CPU with MKL by accepting default build options and\n+# setting library locations\n+ENV CI_BUILD_PYTHON=python \\\n+   LD_LIBRARY_PATH=${LD_LIBRARY_PATH} \\\n+    PYTHON_BIN_PATH=/usr/bin/python \\\n+    PYTHON_LIB_PATH=/usr/local/lib/python2.7/dist-packages \\\n+    CC_OPT_FLAGS='-march=native' \\\n+    TF_NEED_JEMALLOC=0 \\\n+    TF_NEED_GCP=0 \\\n+    TF_NEED_CUDA=0 \\\n+    TF_NEED_HDFS=0 \\\n+    TF_NEED_S3=0 \\\n+    TF_NEED_OPENCL=0 \\\n+    TF_NEED_GDR=0 \\\n+    TF_ENABLE_XLA=0 \\\n+    TF_NEED_VERBS=0 \\\n+    TF_NEED_MPI=0\n+RUN ./configure; exit 0 # ./configure whines unnecessarily\n+\n+# Build and Install TensorFlow.\n+RUN LD_LIBRARY_PATH=${LD_LIBRARY_PATH} \\\n+    bazel build --config=mkl \\\n+                --copt=\"-mfma\" \\\n+                --copt=\"-mavx2\" \\\n+\t\t--config=\"opt\" \\\n+               --copt=\"-march=native\" \\\n+                --copt=\"-O3\" \\\n+                //tensorflow/tools/pip_package:build_pip_package && \\\n+    mkdir ${WHL_DIR} && \\\n+    bazel-bin/tensorflow/tools/pip_package/build_pip_package ${WHL_DIR}\n+\n+# Clean up Bazel cache when done, but leave the whl.\n+RUN pip --no-cache-dir install --upgrade ${WHL_DIR}/tensorflow-*.whl && \\\n+    rm -rf /root/.cache\n+\n+WORKDIR /root\n+\n+#add welcome message with instructions\n+\n+RUN echo '[ ! -z \"$TERM\" -a -r /etc/motd ] && cat /etc/issue && cat /etc/motd' \\\n+\t>> /etc/bash.bashrc \\\n+\t; echo \"\\\n+||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||\\n\\\n+|\t\t\t\t\t\t\t\t\\n\\\n+| Docker container running Ubuntu\t\t\t\t\\n\\\n+| with TensorFlow ${TF_BRANCH} optimized for CPU\t\t\\n\\\n+| with Intel(R) MKL\t\t\t\t\t\t\\n\\", "path": "tensorflow/tools/docker/Dockerfile.devel-cpu-mkl", "position": 79, "original_position": 121, "commit_id": "526802e472b371c8e68f4fdf97bfe41b97c84801", "original_commit_id": "c17dba09a90771aaa5f3273e7c54c67aa0206579", "user": {"login": "inc0", "id": 697528, "node_id": "MDQ6VXNlcjY5NzUyOA==", "avatar_url": "https://avatars3.githubusercontent.com/u/697528?v=4", "gravatar_id": "", "url": "https://api.github.com/users/inc0", "html_url": "https://github.com/inc0", "followers_url": "https://api.github.com/users/inc0/followers", "following_url": "https://api.github.com/users/inc0/following{/other_user}", "gists_url": "https://api.github.com/users/inc0/gists{/gist_id}", "starred_url": "https://api.github.com/users/inc0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/inc0/subscriptions", "organizations_url": "https://api.github.com/users/inc0/orgs", "repos_url": "https://api.github.com/users/inc0/repos", "events_url": "https://api.github.com/users/inc0/events{/privacy}", "received_events_url": "https://api.github.com/users/inc0/received_events", "type": "User", "site_admin": true}, "body": "besides the point a bit, but can we re-use some existing Dockerfile and FROM it to avoid duplication?", "created_at": "2017-11-11T21:42:21Z", "updated_at": "2017-11-21T17:26:52Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/14468#discussion_r150394199", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/14468", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/150394199"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/14468#discussion_r150394199"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/14468"}}, "body_html": "<p>besides the point a bit, but can we re-use some existing Dockerfile and FROM it to avoid duplication?</p>", "body_text": "besides the point a bit, but can we re-use some existing Dockerfile and FROM it to avoid duplication?"}