{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/337955732", "html_url": "https://github.com/tensorflow/tensorflow/issues/13802#issuecomment-337955732", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13802", "id": 337955732, "node_id": "MDEyOklzc3VlQ29tbWVudDMzNzk1NTczMg==", "user": {"login": "albertz", "id": 59132, "node_id": "MDQ6VXNlcjU5MTMy", "avatar_url": "https://avatars0.githubusercontent.com/u/59132?v=4", "gravatar_id": "", "url": "https://api.github.com/users/albertz", "html_url": "https://github.com/albertz", "followers_url": "https://api.github.com/users/albertz/followers", "following_url": "https://api.github.com/users/albertz/following{/other_user}", "gists_url": "https://api.github.com/users/albertz/gists{/gist_id}", "starred_url": "https://api.github.com/users/albertz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/albertz/subscriptions", "organizations_url": "https://api.github.com/users/albertz/orgs", "repos_url": "https://api.github.com/users/albertz/repos", "events_url": "https://api.github.com/users/albertz/events{/privacy}", "received_events_url": "https://api.github.com/users/albertz/received_events", "type": "User", "site_admin": false}, "created_at": "2017-10-19T16:03:29Z", "updated_at": "2017-10-19T16:03:29Z", "author_association": "NONE", "body_html": "<p>In case anyone else stumbles here, what I do now, and remember that I just need fork+exec to work, not fork without exec. I have this simple C code and compile it as a lib <code>patch_atfork.so</code>:</p>\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint pthread_atfork(void (*prepare)(void), void (*parent)(void), void (*child)(void)) {\n  printf(\"Ignoring pthread_atfork call!\\\\n\");\n  fflush(stdout);\n  return 0;\n}\n</code></pre>\n<p>Then I load it via <code>LD_PRELOAD=patch_atfork.so</code> before running my script. That will probably make the forked-environment useless for some cases but exec will work now.</p>", "body_text": "In case anyone else stumbles here, what I do now, and remember that I just need fork+exec to work, not fork without exec. I have this simple C code and compile it as a lib patch_atfork.so:\n#include <stdio.h>\n#include <stdlib.h>\n\nint pthread_atfork(void (*prepare)(void), void (*parent)(void), void (*child)(void)) {\n  printf(\"Ignoring pthread_atfork call!\\\\n\");\n  fflush(stdout);\n  return 0;\n}\n\nThen I load it via LD_PRELOAD=patch_atfork.so before running my script. That will probably make the forked-environment useless for some cases but exec will work now.", "body": "In case anyone else stumbles here, what I do now, and remember that I just need fork+exec to work, not fork without exec. I have this simple C code and compile it as a lib `patch_atfork.so`:\r\n\r\n```\r\n#include <stdio.h>\r\n#include <stdlib.h>\r\n\r\nint pthread_atfork(void (*prepare)(void), void (*parent)(void), void (*child)(void)) {\r\n  printf(\"Ignoring pthread_atfork call!\\\\n\");\r\n  fflush(stdout);\r\n  return 0;\r\n}\r\n```\r\n\r\nThen I load it via `LD_PRELOAD=patch_atfork.so` before running my script. That will probably make the forked-environment useless for some cases but exec will work now.\r\n"}