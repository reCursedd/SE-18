{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/337813487", "html_url": "https://github.com/tensorflow/tensorflow/issues/13802#issuecomment-337813487", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13802", "id": 337813487, "node_id": "MDEyOklzc3VlQ29tbWVudDMzNzgxMzQ4Nw==", "user": {"login": "albertz", "id": 59132, "node_id": "MDQ6VXNlcjU5MTMy", "avatar_url": "https://avatars0.githubusercontent.com/u/59132?v=4", "gravatar_id": "", "url": "https://api.github.com/users/albertz", "html_url": "https://github.com/albertz", "followers_url": "https://api.github.com/users/albertz/followers", "following_url": "https://api.github.com/users/albertz/following{/other_user}", "gists_url": "https://api.github.com/users/albertz/gists{/gist_id}", "starred_url": "https://api.github.com/users/albertz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/albertz/subscriptions", "organizations_url": "https://api.github.com/users/albertz/orgs", "repos_url": "https://api.github.com/users/albertz/repos", "events_url": "https://api.github.com/users/albertz/events{/privacy}", "received_events_url": "https://api.github.com/users/albertz/received_events", "type": "User", "site_admin": false}, "created_at": "2017-10-19T06:38:07Z", "updated_at": "2017-10-19T06:38:07Z", "author_association": "NONE", "body_html": "<p>Actually, in my case, I just want to start a subprocess (via <code>subprocess.Popen</code>, or any other way), so I just need that fork+exec works, or maybe that I can use an alternative, like vfork+exec or posix_spawn, which probably does not have this issue, as it would not execute the atfork handlers.</p>\n<p>As I read and thought more about this now, I don't think that there is anything on the TF side which can/should be done about this. A safe subprocess_fork_exec can be done on the CPython side, and the issue itself maybe should be fixed on the OpenBlas side. So maybe we can close this issue here.</p>\n<p>Note that it's not trivial in all cases to avoid any subprocess creation at all. Even the <code>audioread</code> package e.g. can trigger this, via <code>ctypes.util.find_library</code>, which will use some external tool. Consider this stacktrace (where it hangs):</p>\n<pre><code>  File \"/u/zeyer/.linuxbrew/Cellar/python3/3.6.1/lib/python3.6/subprocess.py\", line 1260 in _execute_child\n  File \"/u/zeyer/.linuxbrew/Cellar/python3/3.6.1/lib/python3.6/subprocess.py\", line 707 in __init__\n  File \"/u/zeyer/.linuxbrew/Cellar/python3/3.6.1/lib/python3.6/ctypes/util.py\", line 271 in _findSoname_ldconfig\n  File \"/u/zeyer/.linuxbrew/Cellar/python3/3.6.1/lib/python3.6/ctypes/util.py\", line 302 in find_library\n  File \"/u/zeyer/.local/lib/python3.6/site-packages/audioread/__init__.py\", line 59 in _ca_available\n  File \"/u/zeyer/.local/lib/python3.6/site-packages/audioread/__init__.py\", line 85 in audio_open\n  File \"/u/zeyer/.local/lib/python3.6/site-packages/librosa/core/audio.py\", line 107 in load\n</code></pre>", "body_text": "Actually, in my case, I just want to start a subprocess (via subprocess.Popen, or any other way), so I just need that fork+exec works, or maybe that I can use an alternative, like vfork+exec or posix_spawn, which probably does not have this issue, as it would not execute the atfork handlers.\nAs I read and thought more about this now, I don't think that there is anything on the TF side which can/should be done about this. A safe subprocess_fork_exec can be done on the CPython side, and the issue itself maybe should be fixed on the OpenBlas side. So maybe we can close this issue here.\nNote that it's not trivial in all cases to avoid any subprocess creation at all. Even the audioread package e.g. can trigger this, via ctypes.util.find_library, which will use some external tool. Consider this stacktrace (where it hangs):\n  File \"/u/zeyer/.linuxbrew/Cellar/python3/3.6.1/lib/python3.6/subprocess.py\", line 1260 in _execute_child\n  File \"/u/zeyer/.linuxbrew/Cellar/python3/3.6.1/lib/python3.6/subprocess.py\", line 707 in __init__\n  File \"/u/zeyer/.linuxbrew/Cellar/python3/3.6.1/lib/python3.6/ctypes/util.py\", line 271 in _findSoname_ldconfig\n  File \"/u/zeyer/.linuxbrew/Cellar/python3/3.6.1/lib/python3.6/ctypes/util.py\", line 302 in find_library\n  File \"/u/zeyer/.local/lib/python3.6/site-packages/audioread/__init__.py\", line 59 in _ca_available\n  File \"/u/zeyer/.local/lib/python3.6/site-packages/audioread/__init__.py\", line 85 in audio_open\n  File \"/u/zeyer/.local/lib/python3.6/site-packages/librosa/core/audio.py\", line 107 in load", "body": "Actually, in my case, I just want to start a subprocess (via `subprocess.Popen`, or any other way), so I just need that fork+exec works, or maybe that I can use an alternative, like vfork+exec or posix_spawn, which probably does not have this issue, as it would not execute the atfork handlers.\r\n\r\nAs I read and thought more about this now, I don't think that there is anything on the TF side which can/should be done about this. A safe subprocess_fork_exec can be done on the CPython side, and the issue itself maybe should be fixed on the OpenBlas side. So maybe we can close this issue here.\r\n\r\nNote that it's not trivial in all cases to avoid any subprocess creation at all. Even the `audioread` package e.g. can trigger this, via `ctypes.util.find_library`, which will use some external tool. Consider this stacktrace (where it hangs):\r\n```\r\n  File \"/u/zeyer/.linuxbrew/Cellar/python3/3.6.1/lib/python3.6/subprocess.py\", line 1260 in _execute_child\r\n  File \"/u/zeyer/.linuxbrew/Cellar/python3/3.6.1/lib/python3.6/subprocess.py\", line 707 in __init__\r\n  File \"/u/zeyer/.linuxbrew/Cellar/python3/3.6.1/lib/python3.6/ctypes/util.py\", line 271 in _findSoname_ldconfig\r\n  File \"/u/zeyer/.linuxbrew/Cellar/python3/3.6.1/lib/python3.6/ctypes/util.py\", line 302 in find_library\r\n  File \"/u/zeyer/.local/lib/python3.6/site-packages/audioread/__init__.py\", line 59 in _ca_available\r\n  File \"/u/zeyer/.local/lib/python3.6/site-packages/audioread/__init__.py\", line 85 in audio_open\r\n  File \"/u/zeyer/.local/lib/python3.6/site-packages/librosa/core/audio.py\", line 107 in load\r\n```\r\n"}