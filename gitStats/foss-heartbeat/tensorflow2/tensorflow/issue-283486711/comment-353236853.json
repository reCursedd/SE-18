{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/353236853", "html_url": "https://github.com/tensorflow/tensorflow/pull/15515#issuecomment-353236853", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15515", "id": 353236853, "node_id": "MDEyOklzc3VlQ29tbWVudDM1MzIzNjg1Mw==", "user": {"login": "tatatodd", "id": 5453737, "node_id": "MDQ6VXNlcjU0NTM3Mzc=", "avatar_url": "https://avatars3.githubusercontent.com/u/5453737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tatatodd", "html_url": "https://github.com/tatatodd", "followers_url": "https://api.github.com/users/tatatodd/followers", "following_url": "https://api.github.com/users/tatatodd/following{/other_user}", "gists_url": "https://api.github.com/users/tatatodd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tatatodd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tatatodd/subscriptions", "organizations_url": "https://api.github.com/users/tatatodd/orgs", "repos_url": "https://api.github.com/users/tatatodd/repos", "events_url": "https://api.github.com/users/tatatodd/events{/privacy}", "received_events_url": "https://api.github.com/users/tatatodd/received_events", "type": "User", "site_admin": false}, "created_at": "2017-12-21T02:01:13Z", "updated_at": "2017-12-21T02:01:13Z", "author_association": "MEMBER", "body_html": "<p>I looked into this a bit more.</p>\n<p>I think you're right that the original code was relying on non-standard empty <code>__VA_ARGS__</code> behavior.  Which means that another possible fix would be to add a dummy arg to the invocation of TF_STATUS_MACRO_GET_VARIADIC_IMPL:</p>\n<pre><code>// Trailing 0 is a dummy value.\n#define TF_ASSIGN_OR_RETURN(...) \\\n  TF_STATUS_MACRO_GET_VARIADIC_IMPL(__VA_ARGS__, TF_ASSIGN_OR_RETURN_IMPL_3, \\\n                                    TF_ASSIGN_OR_RETURN_IMPL_2, 0) \\\n</code></pre>\n<p>Note that the internal version that this is based on was written to deal with an optional 3rd argument to TF_ASSIGN_OR_RETURN.  But when it was ported to XLA, the optional 3rd argument was removed, but the underlying machinery was retained.  Except that it no longer accepts the optional 3rd argument at all.</p>\n<p>Tagging <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1130906\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/eliben\">@eliben</a> since I believe he originally ported this bit of logic.</p>\n<p>To summarize, I think your PR should work fine and makes things simpler.  So thanks, and let's get this merged!  :)</p>", "body_text": "I looked into this a bit more.\nI think you're right that the original code was relying on non-standard empty __VA_ARGS__ behavior.  Which means that another possible fix would be to add a dummy arg to the invocation of TF_STATUS_MACRO_GET_VARIADIC_IMPL:\n// Trailing 0 is a dummy value.\n#define TF_ASSIGN_OR_RETURN(...) \\\n  TF_STATUS_MACRO_GET_VARIADIC_IMPL(__VA_ARGS__, TF_ASSIGN_OR_RETURN_IMPL_3, \\\n                                    TF_ASSIGN_OR_RETURN_IMPL_2, 0) \\\n\nNote that the internal version that this is based on was written to deal with an optional 3rd argument to TF_ASSIGN_OR_RETURN.  But when it was ported to XLA, the optional 3rd argument was removed, but the underlying machinery was retained.  Except that it no longer accepts the optional 3rd argument at all.\nTagging @eliben since I believe he originally ported this bit of logic.\nTo summarize, I think your PR should work fine and makes things simpler.  So thanks, and let's get this merged!  :)", "body": "I looked into this a bit more.\r\n\r\nI think you're right that the original code was relying on non-standard empty `__VA_ARGS__` behavior.  Which means that another possible fix would be to add a dummy arg to the invocation of TF_STATUS_MACRO_GET_VARIADIC_IMPL:\r\n\r\n```\r\n// Trailing 0 is a dummy value.\r\n#define TF_ASSIGN_OR_RETURN(...) \\\r\n  TF_STATUS_MACRO_GET_VARIADIC_IMPL(__VA_ARGS__, TF_ASSIGN_OR_RETURN_IMPL_3, \\\r\n                                    TF_ASSIGN_OR_RETURN_IMPL_2, 0) \\\r\n```\r\n\r\nNote that the internal version that this is based on was written to deal with an optional 3rd argument to TF_ASSIGN_OR_RETURN.  But when it was ported to XLA, the optional 3rd argument was removed, but the underlying machinery was retained.  Except that it no longer accepts the optional 3rd argument at all.\r\n\r\nTagging @eliben since I believe he originally ported this bit of logic.\r\n\r\nTo summarize, I think your PR should work fine and makes things simpler.  So thanks, and let's get this merged!  :)"}