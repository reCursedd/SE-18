{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/272437840", "html_url": "https://github.com/tensorflow/tensorflow/issues/152#issuecomment-272437840", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/152", "id": 272437840, "node_id": "MDEyOklzc3VlQ29tbWVudDI3MjQzNzg0MA==", "user": {"login": "casiciaco", "id": 2345400, "node_id": "MDQ6VXNlcjIzNDU0MDA=", "avatar_url": "https://avatars2.githubusercontent.com/u/2345400?v=4", "gravatar_id": "", "url": "https://api.github.com/users/casiciaco", "html_url": "https://github.com/casiciaco", "followers_url": "https://api.github.com/users/casiciaco/followers", "following_url": "https://api.github.com/users/casiciaco/following{/other_user}", "gists_url": "https://api.github.com/users/casiciaco/gists{/gist_id}", "starred_url": "https://api.github.com/users/casiciaco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/casiciaco/subscriptions", "organizations_url": "https://api.github.com/users/casiciaco/orgs", "repos_url": "https://api.github.com/users/casiciaco/repos", "events_url": "https://api.github.com/users/casiciaco/events{/privacy}", "received_events_url": "https://api.github.com/users/casiciaco/received_events", "type": "User", "site_admin": false}, "created_at": "2017-01-13T13:00:30Z", "updated_at": "2017-01-13T13:00:30Z", "author_association": "NONE", "body_html": "<p>Hi,<br>\nI am still observing problems w/ GPU reservation in a 16 GPU node. For some GPUs, when reserving the GPU with CUDA_VISIBLE_DEVICES, it fails to reserver the node. In TF 0.10 it generated a coredump. In TF 0.12 it complains about not being able to start the tf.Session.</p>\n<p>The node status is this:</p>\n<pre><code>+-----------------------------------------------------------------------------+\n| Processes:                                                       GPU Memory |\n|  GPU       PID  Type  Process name                               Usage      |\n|=============================================================================|\n|    0     46690    C   /usr/bin/python2.7                            2326MiB |\n|    2     13781    C   python                                        3456MiB |\n|    3     26767    C   python                                         282MiB |\n|    4     53525    C   /usr/bin/python2.7                             740MiB |\n|    5     13782    C   python                                        3456MiB |\n|    6      9427    C   /usr/bin/python2.7                            3455MiB |\n|    9     53527    C   /usr/bin/python2.7                             740MiB |\n|   10     53222    C   /usr/bin/python2.7                             740MiB |\n|   11     53526    C   /usr/bin/python2.7                             740MiB |\n|   12     54930    C   /usr/bin/python2.7                            1085MiB |\n|   13     54926    C   /usr/bin/python2.7                             785MiB |\n|   14     54927    C   /usr/bin/python2.7                             785MiB |\n+-----------------------------------------------------------------------------+\n</code></pre>\n<p>And when I use CUDA_VISIBLE_DEVICES=1 , which is free:</p>\n<pre><code>Before reservation the free GPUs  [1, 7, 8, 15]\nSetting CUDA_VISIBLE_DEVICES=1\nE tensorflow/core/common_runtime/direct_session.cc:135] Internal: failed initializing StreamExecutor for CUDA device ordinal 0: Internal: failed call to cuDevicePrimaryCtxRetain: CUDA_ERROR_INVALID_DEVICE\nTraceback (most recent call last):\n...\n File \"PATH/run.py\", line 138, in reserveGPUs\n    with  tf.Session() as session:\n  File \"PATH/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1186, in __init__\n    super(Session, self).__init__(target, graph, config=config)\n  File \"PATH/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 551, in __init__\n    self._session = tf_session.TF_NewDeprecatedSession(opts, status)\n  File \"PATH/lib/python2.7/contextlib.py\", line 24, in __exit__\n    self.gen.next()\n  File \"/amr/tools/tensorflow/0.12-cuda7.5/lib/python2.7/site-packages/tensorflow/python/framework/errors_impl.py\", line 469, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors_impl.InternalError: Failed to create session.\n</code></pre>", "body_text": "Hi,\nI am still observing problems w/ GPU reservation in a 16 GPU node. For some GPUs, when reserving the GPU with CUDA_VISIBLE_DEVICES, it fails to reserver the node. In TF 0.10 it generated a coredump. In TF 0.12 it complains about not being able to start the tf.Session.\nThe node status is this:\n+-----------------------------------------------------------------------------+\n| Processes:                                                       GPU Memory |\n|  GPU       PID  Type  Process name                               Usage      |\n|=============================================================================|\n|    0     46690    C   /usr/bin/python2.7                            2326MiB |\n|    2     13781    C   python                                        3456MiB |\n|    3     26767    C   python                                         282MiB |\n|    4     53525    C   /usr/bin/python2.7                             740MiB |\n|    5     13782    C   python                                        3456MiB |\n|    6      9427    C   /usr/bin/python2.7                            3455MiB |\n|    9     53527    C   /usr/bin/python2.7                             740MiB |\n|   10     53222    C   /usr/bin/python2.7                             740MiB |\n|   11     53526    C   /usr/bin/python2.7                             740MiB |\n|   12     54930    C   /usr/bin/python2.7                            1085MiB |\n|   13     54926    C   /usr/bin/python2.7                             785MiB |\n|   14     54927    C   /usr/bin/python2.7                             785MiB |\n+-----------------------------------------------------------------------------+\n\nAnd when I use CUDA_VISIBLE_DEVICES=1 , which is free:\nBefore reservation the free GPUs  [1, 7, 8, 15]\nSetting CUDA_VISIBLE_DEVICES=1\nE tensorflow/core/common_runtime/direct_session.cc:135] Internal: failed initializing StreamExecutor for CUDA device ordinal 0: Internal: failed call to cuDevicePrimaryCtxRetain: CUDA_ERROR_INVALID_DEVICE\nTraceback (most recent call last):\n...\n File \"PATH/run.py\", line 138, in reserveGPUs\n    with  tf.Session() as session:\n  File \"PATH/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1186, in __init__\n    super(Session, self).__init__(target, graph, config=config)\n  File \"PATH/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 551, in __init__\n    self._session = tf_session.TF_NewDeprecatedSession(opts, status)\n  File \"PATH/lib/python2.7/contextlib.py\", line 24, in __exit__\n    self.gen.next()\n  File \"/amr/tools/tensorflow/0.12-cuda7.5/lib/python2.7/site-packages/tensorflow/python/framework/errors_impl.py\", line 469, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors_impl.InternalError: Failed to create session.", "body": "Hi,\r\nI am still observing problems w/ GPU reservation in a 16 GPU node. For some GPUs, when reserving the GPU with CUDA_VISIBLE_DEVICES, it fails to reserver the node. In TF 0.10 it generated a coredump. In TF 0.12 it complains about not being able to start the tf.Session.\r\n\r\nThe node status is this:\r\n```\r\n+-----------------------------------------------------------------------------+\r\n| Processes:                                                       GPU Memory |\r\n|  GPU       PID  Type  Process name                               Usage      |\r\n|=============================================================================|\r\n|    0     46690    C   /usr/bin/python2.7                            2326MiB |\r\n|    2     13781    C   python                                        3456MiB |\r\n|    3     26767    C   python                                         282MiB |\r\n|    4     53525    C   /usr/bin/python2.7                             740MiB |\r\n|    5     13782    C   python                                        3456MiB |\r\n|    6      9427    C   /usr/bin/python2.7                            3455MiB |\r\n|    9     53527    C   /usr/bin/python2.7                             740MiB |\r\n|   10     53222    C   /usr/bin/python2.7                             740MiB |\r\n|   11     53526    C   /usr/bin/python2.7                             740MiB |\r\n|   12     54930    C   /usr/bin/python2.7                            1085MiB |\r\n|   13     54926    C   /usr/bin/python2.7                             785MiB |\r\n|   14     54927    C   /usr/bin/python2.7                             785MiB |\r\n+-----------------------------------------------------------------------------+\r\n```\r\nAnd when I use CUDA_VISIBLE_DEVICES=1 , which is free:\r\n```\r\nBefore reservation the free GPUs  [1, 7, 8, 15]\r\nSetting CUDA_VISIBLE_DEVICES=1\r\nE tensorflow/core/common_runtime/direct_session.cc:135] Internal: failed initializing StreamExecutor for CUDA device ordinal 0: Internal: failed call to cuDevicePrimaryCtxRetain: CUDA_ERROR_INVALID_DEVICE\r\nTraceback (most recent call last):\r\n...\r\n File \"PATH/run.py\", line 138, in reserveGPUs\r\n    with  tf.Session() as session:\r\n  File \"PATH/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1186, in __init__\r\n    super(Session, self).__init__(target, graph, config=config)\r\n  File \"PATH/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 551, in __init__\r\n    self._session = tf_session.TF_NewDeprecatedSession(opts, status)\r\n  File \"PATH/lib/python2.7/contextlib.py\", line 24, in __exit__\r\n    self.gen.next()\r\n  File \"/amr/tools/tensorflow/0.12-cuda7.5/lib/python2.7/site-packages/tensorflow/python/framework/errors_impl.py\", line 469, in raise_exception_on_not_ok_status\r\n    pywrap_tensorflow.TF_GetCode(status))\r\ntensorflow.python.framework.errors_impl.InternalError: Failed to create session."}