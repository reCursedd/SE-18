{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10755", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10755/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10755/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10755/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/10755", "id": 236404590, "node_id": "MDU6SXNzdWUyMzY0MDQ1OTA=", "number": 10755, "title": "Weird behavior of tf.train.Saver", "user": {"login": "mklopp", "id": 25434844, "node_id": "MDQ6VXNlcjI1NDM0ODQ0", "avatar_url": "https://avatars1.githubusercontent.com/u/25434844?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mklopp", "html_url": "https://github.com/mklopp", "followers_url": "https://api.github.com/users/mklopp/followers", "following_url": "https://api.github.com/users/mklopp/following{/other_user}", "gists_url": "https://api.github.com/users/mklopp/gists{/gist_id}", "starred_url": "https://api.github.com/users/mklopp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mklopp/subscriptions", "organizations_url": "https://api.github.com/users/mklopp/orgs", "repos_url": "https://api.github.com/users/mklopp/repos", "events_url": "https://api.github.com/users/mklopp/events{/privacy}", "received_events_url": "https://api.github.com/users/mklopp/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2017-06-16T07:40:02Z", "updated_at": "2018-01-05T02:10:37Z", "closed_at": "2018-01-05T02:10:37Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li>Linux Ubuntu 14.04</li>\n<li>TensorFlow installed from binary:</li>\n<li>TensorFlow version v1.0.0-rc2:</li>\n<li>CUDA: 8.0, CuDNN: 5.1</li>\n<li>Tesla K80, 12GB</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>I have a problem with the tf.train.Saver, specifically with the 'max_to_keep' argument. If I create a Saver with 'max_to_keep' set to let's say 3 and use the saver.save function to save my model in the current directory it keeps all files and doesn't delete the old ones after 3 or more are created. If I set the path where to save the model to a different location it works just fine.</p>\n<p>See also my <a href=\"https://stackoverflow.com/questions/44458947/tensorflow-keeps-all-files-how-to-prevent-that\" rel=\"nofollow\">stackoverflow question</a></p>\n<h3>Source code / logs</h3>\n<p>Creates for the numbers 1 to 10 each 3 files:</p>\n<ul>\n<li>testfile-1.data-00000-of-00001</li>\n<li>testfile-1.index</li>\n<li>testfile-1.meta</li>\n</ul>\n<pre><code>import tensorflow as tf\n\na = tf.Variable(name='a', initial_value=0)\naddops = a+1\n\nsaver = tf.train.Saver(max_to_keep=3)\nconfig = tf.ConfigProto()\nconfig.gpu_options.allow_growth = True\nsess = tf.Session(config=config)\nsess.run(tf.global_variables_initializer())\nfor i in range(10):\n    sess.run(addops)\n    save_path = saver.save(sess, 'testfile', global_step=i+1)\n\nsess.close()\n</code></pre>\n<p>This code works as expected and deletes all the old files and I only end up with the numbers 8 to 10:</p>\n<pre><code>import tensorflow as tf\n\na = tf.Variable(name='a', initial_value=0)\naddops = a+1\n\nsaver = tf.train.Saver(max_to_keep=3)\nconfig = tf.ConfigProto()\nconfig.gpu_options.allow_growth = True\nsess = tf.Session(config=config)\nsess.run(tf.global_variables_initializer())\nfor i in range(10):\n    sess.run(addops)\n    save_path = saver.save(sess, 'test/testfile', global_step=i+1)\n\nsess.close()\n</code></pre>", "body_text": "System information\n\nLinux Ubuntu 14.04\nTensorFlow installed from binary:\nTensorFlow version v1.0.0-rc2:\nCUDA: 8.0, CuDNN: 5.1\nTesla K80, 12GB\n\nDescribe the problem\nI have a problem with the tf.train.Saver, specifically with the 'max_to_keep' argument. If I create a Saver with 'max_to_keep' set to let's say 3 and use the saver.save function to save my model in the current directory it keeps all files and doesn't delete the old ones after 3 or more are created. If I set the path where to save the model to a different location it works just fine.\nSee also my stackoverflow question\nSource code / logs\nCreates for the numbers 1 to 10 each 3 files:\n\ntestfile-1.data-00000-of-00001\ntestfile-1.index\ntestfile-1.meta\n\nimport tensorflow as tf\n\na = tf.Variable(name='a', initial_value=0)\naddops = a+1\n\nsaver = tf.train.Saver(max_to_keep=3)\nconfig = tf.ConfigProto()\nconfig.gpu_options.allow_growth = True\nsess = tf.Session(config=config)\nsess.run(tf.global_variables_initializer())\nfor i in range(10):\n    sess.run(addops)\n    save_path = saver.save(sess, 'testfile', global_step=i+1)\n\nsess.close()\n\nThis code works as expected and deletes all the old files and I only end up with the numbers 8 to 10:\nimport tensorflow as tf\n\na = tf.Variable(name='a', initial_value=0)\naddops = a+1\n\nsaver = tf.train.Saver(max_to_keep=3)\nconfig = tf.ConfigProto()\nconfig.gpu_options.allow_growth = True\nsess = tf.Session(config=config)\nsess.run(tf.global_variables_initializer())\nfor i in range(10):\n    sess.run(addops)\n    save_path = saver.save(sess, 'test/testfile', global_step=i+1)\n\nsess.close()", "body": "### System information\r\n- Linux Ubuntu 14.04\r\n- TensorFlow installed from binary:\r\n- TensorFlow version v1.0.0-rc2:\r\n- CUDA: 8.0, CuDNN: 5.1\r\n- Tesla K80, 12GB\r\n\r\n### Describe the problem\r\nI have a problem with the tf.train.Saver, specifically with the 'max_to_keep' argument. If I create a Saver with 'max_to_keep' set to let's say 3 and use the saver.save function to save my model in the current directory it keeps all files and doesn't delete the old ones after 3 or more are created. If I set the path where to save the model to a different location it works just fine.\r\n\r\nSee also my [stackoverflow question](https://stackoverflow.com/questions/44458947/tensorflow-keeps-all-files-how-to-prevent-that)\r\n\r\n### Source code / logs\r\nCreates for the numbers 1 to 10 each 3 files:\r\n\r\n- testfile-1.data-00000-of-00001\r\n- testfile-1.index\r\n- testfile-1.meta\r\n\r\n```\r\nimport tensorflow as tf\r\n\r\na = tf.Variable(name='a', initial_value=0)\r\naddops = a+1\r\n\r\nsaver = tf.train.Saver(max_to_keep=3)\r\nconfig = tf.ConfigProto()\r\nconfig.gpu_options.allow_growth = True\r\nsess = tf.Session(config=config)\r\nsess.run(tf.global_variables_initializer())\r\nfor i in range(10):\r\n    sess.run(addops)\r\n    save_path = saver.save(sess, 'testfile', global_step=i+1)\r\n\r\nsess.close()\r\n```\r\n\r\nThis code works as expected and deletes all the old files and I only end up with the numbers 8 to 10:\r\n\r\n```\r\nimport tensorflow as tf\r\n\r\na = tf.Variable(name='a', initial_value=0)\r\naddops = a+1\r\n\r\nsaver = tf.train.Saver(max_to_keep=3)\r\nconfig = tf.ConfigProto()\r\nconfig.gpu_options.allow_growth = True\r\nsess = tf.Session(config=config)\r\nsess.run(tf.global_variables_initializer())\r\nfor i in range(10):\r\n    sess.run(addops)\r\n    save_path = saver.save(sess, 'test/testfile', global_step=i+1)\r\n\r\nsess.close()\r\n```"}