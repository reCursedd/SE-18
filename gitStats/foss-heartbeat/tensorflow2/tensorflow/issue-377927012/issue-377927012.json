{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23558", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23558/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23558/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23558/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23558", "id": 377927012, "node_id": "MDU6SXNzdWUzNzc5MjcwMTI=", "number": 23558, "title": "tf.nn.embedding_lookup_sparse Converting sparse IndexedSlices Warning", "user": {"login": "davidenunes", "id": 5713750, "node_id": "MDQ6VXNlcjU3MTM3NTA=", "avatar_url": "https://avatars1.githubusercontent.com/u/5713750?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidenunes", "html_url": "https://github.com/davidenunes", "followers_url": "https://api.github.com/users/davidenunes/followers", "following_url": "https://api.github.com/users/davidenunes/following{/other_user}", "gists_url": "https://api.github.com/users/davidenunes/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidenunes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidenunes/subscriptions", "organizations_url": "https://api.github.com/users/davidenunes/orgs", "repos_url": "https://api.github.com/users/davidenunes/repos", "events_url": "https://api.github.com/users/davidenunes/events{/privacy}", "received_events_url": "https://api.github.com/users/davidenunes/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "harshini-gadige", "id": 42781361, "node_id": "MDQ6VXNlcjQyNzgxMzYx", "avatar_url": "https://avatars1.githubusercontent.com/u/42781361?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harshini-gadige", "html_url": "https://github.com/harshini-gadige", "followers_url": "https://api.github.com/users/harshini-gadige/followers", "following_url": "https://api.github.com/users/harshini-gadige/following{/other_user}", "gists_url": "https://api.github.com/users/harshini-gadige/gists{/gist_id}", "starred_url": "https://api.github.com/users/harshini-gadige/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harshini-gadige/subscriptions", "organizations_url": "https://api.github.com/users/harshini-gadige/orgs", "repos_url": "https://api.github.com/users/harshini-gadige/repos", "events_url": "https://api.github.com/users/harshini-gadige/events{/privacy}", "received_events_url": "https://api.github.com/users/harshini-gadige/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "harshini-gadige", "id": 42781361, "node_id": "MDQ6VXNlcjQyNzgxMzYx", "avatar_url": "https://avatars1.githubusercontent.com/u/42781361?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harshini-gadige", "html_url": "https://github.com/harshini-gadige", "followers_url": "https://api.github.com/users/harshini-gadige/followers", "following_url": "https://api.github.com/users/harshini-gadige/following{/other_user}", "gists_url": "https://api.github.com/users/harshini-gadige/gists{/gist_id}", "starred_url": "https://api.github.com/users/harshini-gadige/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harshini-gadige/subscriptions", "organizations_url": "https://api.github.com/users/harshini-gadige/orgs", "repos_url": "https://api.github.com/users/harshini-gadige/repos", "events_url": "https://api.github.com/users/harshini-gadige/events{/privacy}", "received_events_url": "https://api.github.com/users/harshini-gadige/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2018-11-06T16:26:26Z", "updated_at": "2018-11-06T20:05:54Z", "closed_at": "2018-11-06T20:05:54Z", "author_association": "NONE", "body_html": "<p>Using embedding_lookup_sparse raises the following warning:</p>\n<p><code>UserWarning: Converting sparse IndexedSlices to a dense Tensor of unknown shape. This may consume a large amount of memory. \"Converting sparse IndexedSlices to a dense Tensor of unknown shape.\"</code></p>\n<p>Looking at embedding_lookup_sparse implementation, I suspect the issue comes from the <code>gather</code> after embedding lookup.</p>\n<pre><code>ids = sp_ids.values\nids, idx = array_ops.unique(ids)\n\nembeddings = embedding_lookup(...)\n...\nembeddings = array_ops.gather(embeddings, idx)\n</code></pre>\n<p>Is there a reason this op does not call <code>embedding_lookup</code> on <code>sp_ids.values</code> directly? As opposed to<br>\nlooking up the unique ids and calling gather on those rows ?</p>", "body_text": "Using embedding_lookup_sparse raises the following warning:\nUserWarning: Converting sparse IndexedSlices to a dense Tensor of unknown shape. This may consume a large amount of memory. \"Converting sparse IndexedSlices to a dense Tensor of unknown shape.\"\nLooking at embedding_lookup_sparse implementation, I suspect the issue comes from the gather after embedding lookup.\nids = sp_ids.values\nids, idx = array_ops.unique(ids)\n\nembeddings = embedding_lookup(...)\n...\nembeddings = array_ops.gather(embeddings, idx)\n\nIs there a reason this op does not call embedding_lookup on sp_ids.values directly? As opposed to\nlooking up the unique ids and calling gather on those rows ?", "body": "Using embedding_lookup_sparse raises the following warning:\r\n\r\n`UserWarning: Converting sparse IndexedSlices to a dense Tensor of unknown shape. This may consume a large amount of memory. \"Converting sparse IndexedSlices to a dense Tensor of unknown shape.\"`\r\n\r\nLooking at embedding_lookup_sparse implementation, I suspect the issue comes from the `gather` after embedding lookup. \r\n\r\n```\r\nids = sp_ids.values\r\nids, idx = array_ops.unique(ids)\r\n\r\nembeddings = embedding_lookup(...)\r\n...\r\nembeddings = array_ops.gather(embeddings, idx)\r\n```\r\nIs there a reason this op does not call `embedding_lookup` on `sp_ids.values` directly? As opposed to \r\nlooking up the unique ids and calling gather on those rows ? \r\n"}