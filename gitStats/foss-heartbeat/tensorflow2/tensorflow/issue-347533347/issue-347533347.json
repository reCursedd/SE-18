{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21367", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21367/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21367/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21367/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/21367", "id": 347533347, "node_id": "MDU6SXNzdWUzNDc1MzMzNDc=", "number": 21367, "title": "[tf 1.8.0] tf.nn.swish would have issue when restoring using tf.saved_model.loader.load", "user": {"login": "pswpswpsw", "id": 7966776, "node_id": "MDQ6VXNlcjc5NjY3NzY=", "avatar_url": "https://avatars1.githubusercontent.com/u/7966776?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pswpswpsw", "html_url": "https://github.com/pswpswpsw", "followers_url": "https://api.github.com/users/pswpswpsw/followers", "following_url": "https://api.github.com/users/pswpswpsw/following{/other_user}", "gists_url": "https://api.github.com/users/pswpswpsw/gists{/gist_id}", "starred_url": "https://api.github.com/users/pswpswpsw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pswpswpsw/subscriptions", "organizations_url": "https://api.github.com/users/pswpswpsw/orgs", "repos_url": "https://api.github.com/users/pswpswpsw/repos", "events_url": "https://api.github.com/users/pswpswpsw/events{/privacy}", "received_events_url": "https://api.github.com/users/pswpswpsw/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "allenlavoie", "id": 3731025, "node_id": "MDQ6VXNlcjM3MzEwMjU=", "avatar_url": "https://avatars3.githubusercontent.com/u/3731025?v=4", "gravatar_id": "", "url": "https://api.github.com/users/allenlavoie", "html_url": "https://github.com/allenlavoie", "followers_url": "https://api.github.com/users/allenlavoie/followers", "following_url": "https://api.github.com/users/allenlavoie/following{/other_user}", "gists_url": "https://api.github.com/users/allenlavoie/gists{/gist_id}", "starred_url": "https://api.github.com/users/allenlavoie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/allenlavoie/subscriptions", "organizations_url": "https://api.github.com/users/allenlavoie/orgs", "repos_url": "https://api.github.com/users/allenlavoie/repos", "events_url": "https://api.github.com/users/allenlavoie/events{/privacy}", "received_events_url": "https://api.github.com/users/allenlavoie/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "allenlavoie", "id": 3731025, "node_id": "MDQ6VXNlcjM3MzEwMjU=", "avatar_url": "https://avatars3.githubusercontent.com/u/3731025?v=4", "gravatar_id": "", "url": "https://api.github.com/users/allenlavoie", "html_url": "https://github.com/allenlavoie", "followers_url": "https://api.github.com/users/allenlavoie/followers", "following_url": "https://api.github.com/users/allenlavoie/following{/other_user}", "gists_url": "https://api.github.com/users/allenlavoie/gists{/gist_id}", "starred_url": "https://api.github.com/users/allenlavoie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/allenlavoie/subscriptions", "organizations_url": "https://api.github.com/users/allenlavoie/orgs", "repos_url": "https://api.github.com/users/allenlavoie/repos", "events_url": "https://api.github.com/users/allenlavoie/events{/privacy}", "received_events_url": "https://api.github.com/users/allenlavoie/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2018-08-03T20:54:56Z", "updated_at": "2018-10-12T22:45:18Z", "closed_at": "2018-10-12T22:00:01Z", "author_association": "NONE", "body_html": "<p>Hi,</p>\n<p>I found an error for tf.nn.swish for tensorflow version <strong>1.8.0</strong><br>\nFirst, I save the model using tf.saved_model API, then I restore the model using the same API.</p>\n<p>It turns out to have the following error:</p>\n<hr>\n<p>FailedPreconditionError                   Traceback (most recent call last)<br>\n in ()<br>\n1 sess = tf.Session(graph=tf.Graph())<br>\n----&gt; 2 zzz = tf.saved_model.loader.load(sess, [tf.saved_model.tag_constants.SERVING], 'model_saved')</p>\n<p>/usr/local/lib/python2.7/dist-packages/tensorflow/python/saved_model/loader_impl.pyc in load(sess, tags, export_dir, **saver_kwargs)<br>\n217<br>\n218     # Build a saver by importing the meta graph def to load.<br>\n--&gt; 219     saver = tf_saver.import_meta_graph(meta_graph_def_to_load, **saver_kwargs)<br>\n220<br>\n221     if saver:</p>\n<p>/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.pyc in import_meta_graph(meta_graph_or_file, clear_devices, import_scope, **kwargs)<br>\n1953       clear_devices=clear_devices,<br>\n1954       import_scope=import_scope,<br>\n-&gt; 1955       **kwargs)<br>\n1956<br>\n1957   if meta_graph_def.HasField(\"saver_def\"):</p>\n<p>/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/meta_graph.pyc in import_scoped_meta_graph(meta_graph_or_file, clear_devices, graph, import_scope, input_map, unbound_inputs_col_name, restore_collections_predicate)<br>\n741         name=(import_scope or scope_to_prepend_to_names),<br>\n742         input_map=input_map,<br>\n--&gt; 743         producer_op_list=producer_op_list)<br>\n744<br>\n745     # Restores all the other collections.</p>\n<p>/usr/local/lib/python2.7/dist-packages/tensorflow/python/util/deprecation.pyc in new_func(*args, **kwargs)<br>\n430                 'in a future version' if date is None else ('after %s' % date),<br>\n431                 instructions)<br>\n--&gt; 432       return func(*args, **kwargs)<br>\n433     return tf_decorator.make_decorator(func, new_func, 'deprecated',<br>\n434                                        _add_deprecated_arg_notice_to_docstring(</p>\n<p>/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/importer.pyc in import_graph_def(graph_def, input_map, return_elements, name, op_dict, producer_op_list)<br>\n487         try:<br>\n488           results = c_api.TF_GraphImportGraphDefWithResults(<br>\n--&gt; 489               graph._c_graph, serialized, options)  # pylint: disable=protected-access<br>\n490           results = c_api_util.ScopedTFImportGraphDefResults(results)<br>\n491         except errors.InvalidArgumentError as e:</p>\n<p>FailedPreconditionError: Input 0 ('swish_f32') for 'MatMul_1' was not previously added to ShapeRefiner.</p>\n<h1>my solution</h1>\n<p>def myswish_beta(x):<br>\n\"\"\"<br>\nSwish with beta not-traininable!<br>\n\"\"\"<br>\nbeta=tf.Variable(initial_value=1.0,trainable=False,name='swish_beta')<br>\nreturn x<em>tf.nn.sigmoid(beta</em>x)<br>\nactivation_fun = myswish_beta</p>", "body_text": "Hi,\nI found an error for tf.nn.swish for tensorflow version 1.8.0\nFirst, I save the model using tf.saved_model API, then I restore the model using the same API.\nIt turns out to have the following error:\n\nFailedPreconditionError                   Traceback (most recent call last)\n in ()\n1 sess = tf.Session(graph=tf.Graph())\n----> 2 zzz = tf.saved_model.loader.load(sess, [tf.saved_model.tag_constants.SERVING], 'model_saved')\n/usr/local/lib/python2.7/dist-packages/tensorflow/python/saved_model/loader_impl.pyc in load(sess, tags, export_dir, **saver_kwargs)\n217\n218     # Build a saver by importing the meta graph def to load.\n--> 219     saver = tf_saver.import_meta_graph(meta_graph_def_to_load, **saver_kwargs)\n220\n221     if saver:\n/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.pyc in import_meta_graph(meta_graph_or_file, clear_devices, import_scope, **kwargs)\n1953       clear_devices=clear_devices,\n1954       import_scope=import_scope,\n-> 1955       **kwargs)\n1956\n1957   if meta_graph_def.HasField(\"saver_def\"):\n/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/meta_graph.pyc in import_scoped_meta_graph(meta_graph_or_file, clear_devices, graph, import_scope, input_map, unbound_inputs_col_name, restore_collections_predicate)\n741         name=(import_scope or scope_to_prepend_to_names),\n742         input_map=input_map,\n--> 743         producer_op_list=producer_op_list)\n744\n745     # Restores all the other collections.\n/usr/local/lib/python2.7/dist-packages/tensorflow/python/util/deprecation.pyc in new_func(*args, **kwargs)\n430                 'in a future version' if date is None else ('after %s' % date),\n431                 instructions)\n--> 432       return func(*args, **kwargs)\n433     return tf_decorator.make_decorator(func, new_func, 'deprecated',\n434                                        _add_deprecated_arg_notice_to_docstring(\n/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/importer.pyc in import_graph_def(graph_def, input_map, return_elements, name, op_dict, producer_op_list)\n487         try:\n488           results = c_api.TF_GraphImportGraphDefWithResults(\n--> 489               graph._c_graph, serialized, options)  # pylint: disable=protected-access\n490           results = c_api_util.ScopedTFImportGraphDefResults(results)\n491         except errors.InvalidArgumentError as e:\nFailedPreconditionError: Input 0 ('swish_f32') for 'MatMul_1' was not previously added to ShapeRefiner.\nmy solution\ndef myswish_beta(x):\n\"\"\"\nSwish with beta not-traininable!\n\"\"\"\nbeta=tf.Variable(initial_value=1.0,trainable=False,name='swish_beta')\nreturn xtf.nn.sigmoid(betax)\nactivation_fun = myswish_beta", "body": "Hi,\r\n\r\nI found an error for tf.nn.swish for tensorflow version **1.8.0**\r\nFirst, I save the model using tf.saved_model API, then I restore the model using the same API. \r\n\r\nIt turns out to have the following error:\r\n\r\n---------------------------------------------------------------------------\r\nFailedPreconditionError                   Traceback (most recent call last)\r\n<ipython-input-3-a18708547b00> in <module>()\r\n      1 sess = tf.Session(graph=tf.Graph())\r\n----> 2 zzz = tf.saved_model.loader.load(sess, [tf.saved_model.tag_constants.SERVING], 'model_saved')\r\n\r\n/usr/local/lib/python2.7/dist-packages/tensorflow/python/saved_model/loader_impl.pyc in load(sess, tags, export_dir, **saver_kwargs)\r\n    217 \r\n    218     # Build a saver by importing the meta graph def to load.\r\n--> 219     saver = tf_saver.import_meta_graph(meta_graph_def_to_load, **saver_kwargs)\r\n    220 \r\n    221     if saver:\r\n\r\n/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.pyc in import_meta_graph(meta_graph_or_file, clear_devices, import_scope, **kwargs)\r\n   1953       clear_devices=clear_devices,\r\n   1954       import_scope=import_scope,\r\n-> 1955       **kwargs)\r\n   1956 \r\n   1957   if meta_graph_def.HasField(\"saver_def\"):\r\n\r\n/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/meta_graph.pyc in import_scoped_meta_graph(meta_graph_or_file, clear_devices, graph, import_scope, input_map, unbound_inputs_col_name, restore_collections_predicate)\r\n    741         name=(import_scope or scope_to_prepend_to_names),\r\n    742         input_map=input_map,\r\n--> 743         producer_op_list=producer_op_list)\r\n    744 \r\n    745     # Restores all the other collections.\r\n\r\n/usr/local/lib/python2.7/dist-packages/tensorflow/python/util/deprecation.pyc in new_func(*args, **kwargs)\r\n    430                 'in a future version' if date is None else ('after %s' % date),\r\n    431                 instructions)\r\n--> 432       return func(*args, **kwargs)\r\n    433     return tf_decorator.make_decorator(func, new_func, 'deprecated',\r\n    434                                        _add_deprecated_arg_notice_to_docstring(\r\n\r\n/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/importer.pyc in import_graph_def(graph_def, input_map, return_elements, name, op_dict, producer_op_list)\r\n    487         try:\r\n    488           results = c_api.TF_GraphImportGraphDefWithResults(\r\n--> 489               graph._c_graph, serialized, options)  # pylint: disable=protected-access\r\n    490           results = c_api_util.ScopedTFImportGraphDefResults(results)\r\n    491         except errors.InvalidArgumentError as e:\r\n\r\nFailedPreconditionError: Input 0 ('swish_f32') for 'MatMul_1' was not previously added to ShapeRefiner.\r\n\r\n# my solution\r\n\r\ndef myswish_beta(x):\r\n    \"\"\"\r\n    Swish with beta not-traininable!\r\n    \"\"\"\r\n    beta=tf.Variable(initial_value=1.0,trainable=False,name='swish_beta')\r\n    return x*tf.nn.sigmoid(beta*x)\r\nactivation_fun = myswish_beta"}