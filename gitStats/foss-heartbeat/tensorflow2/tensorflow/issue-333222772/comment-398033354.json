{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/398033354", "html_url": "https://github.com/tensorflow/tensorflow/issues/20091#issuecomment-398033354", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20091", "id": 398033354, "node_id": "MDEyOklzc3VlQ29tbWVudDM5ODAzMzM1NA==", "user": {"login": "facaiy", "id": 1112263, "node_id": "MDQ6VXNlcjExMTIyNjM=", "avatar_url": "https://avatars3.githubusercontent.com/u/1112263?v=4", "gravatar_id": "", "url": "https://api.github.com/users/facaiy", "html_url": "https://github.com/facaiy", "followers_url": "https://api.github.com/users/facaiy/followers", "following_url": "https://api.github.com/users/facaiy/following{/other_user}", "gists_url": "https://api.github.com/users/facaiy/gists{/gist_id}", "starred_url": "https://api.github.com/users/facaiy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/facaiy/subscriptions", "organizations_url": "https://api.github.com/users/facaiy/orgs", "repos_url": "https://api.github.com/users/facaiy/repos", "events_url": "https://api.github.com/users/facaiy/events{/privacy}", "received_events_url": "https://api.github.com/users/facaiy/received_events", "type": "User", "site_admin": false}, "created_at": "2018-06-18T12:11:15Z", "updated_at": "2018-06-18T12:11:58Z", "author_association": "MEMBER", "body_html": "<p>I agree that the issue is duplication of <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"157280822\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/2540\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/2540/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/2540\">#2540</a>, do you try the workaround below suggested by <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=3526486\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/anishathalye\">@anishathalye</a> ?</p>\n<div class=\"highlight highlight-source-python\"><pre>x <span class=\"pl-k\">=</span> tf.placeholder(tf.float32)\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> y = tf.where(x &gt; 0, 0., tf.exp(x))</span>\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> trick: we're not using the result of safe_exp when x &gt; 0, so we can</span>\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> substitute a safe value for x in that case</span>\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> it doesn't really matter what we put in here, as long as the backward pass</span>\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> returns some finite value</span>\nsafe_exp <span class=\"pl-k\">=</span> tf.exp(tf.where(x <span class=\"pl-k\">&gt;</span> <span class=\"pl-c1\">0</span>, <span class=\"pl-c1\">1.0</span>, x))\ny <span class=\"pl-k\">=</span> tf.where(x <span class=\"pl-k\">&gt;</span> <span class=\"pl-c1\">0</span>, <span class=\"pl-c1\">0</span>., safe_exp)</pre></div>\n<p>I think it should solve your problem.</p>\n<p>In fact, I also propose to implement a new op <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"285028203\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/15706\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/15706/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/15706\">#15706</a> to fix the issue totally, unfortunately, google tensorflow don't reply to it.</p>", "body_text": "I agree that the issue is duplication of #2540, do you try the workaround below suggested by @anishathalye ?\nx = tf.placeholder(tf.float32)\n# y = tf.where(x > 0, 0., tf.exp(x))\n\n# trick: we're not using the result of safe_exp when x > 0, so we can\n# substitute a safe value for x in that case\n# it doesn't really matter what we put in here, as long as the backward pass\n# returns some finite value\nsafe_exp = tf.exp(tf.where(x > 0, 1.0, x))\ny = tf.where(x > 0, 0., safe_exp)\nI think it should solve your problem.\nIn fact, I also propose to implement a new op #15706 to fix the issue totally, unfortunately, google tensorflow don't reply to it.", "body": "I agree that the issue is duplication of #2540, do you try the workaround below suggested by @anishathalye ? \r\n\r\n```python\r\nx = tf.placeholder(tf.float32)\r\n# y = tf.where(x > 0, 0., tf.exp(x))\r\n\r\n# trick: we're not using the result of safe_exp when x > 0, so we can\r\n# substitute a safe value for x in that case\r\n# it doesn't really matter what we put in here, as long as the backward pass\r\n# returns some finite value\r\nsafe_exp = tf.exp(tf.where(x > 0, 1.0, x))\r\ny = tf.where(x > 0, 0., safe_exp)\r\n```\r\n\r\nI think it should solve your problem. \r\n\r\nIn fact, I also propose to implement a new op #15706 to fix the issue totally, unfortunately, google tensorflow don't reply to it."}