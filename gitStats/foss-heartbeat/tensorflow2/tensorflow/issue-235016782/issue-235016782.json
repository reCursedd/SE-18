{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10614", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10614/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10614/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10614/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/10614", "id": 235016782, "node_id": "MDU6SXNzdWUyMzUwMTY3ODI=", "number": 10614, "title": "Issue adding external Library (OpenCL)", "user": {"login": "ashokbugude", "id": 10016848, "node_id": "MDQ6VXNlcjEwMDE2ODQ4", "avatar_url": "https://avatars3.githubusercontent.com/u/10016848?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ashokbugude", "html_url": "https://github.com/ashokbugude", "followers_url": "https://api.github.com/users/ashokbugude/followers", "following_url": "https://api.github.com/users/ashokbugude/following{/other_user}", "gists_url": "https://api.github.com/users/ashokbugude/gists{/gist_id}", "starred_url": "https://api.github.com/users/ashokbugude/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ashokbugude/subscriptions", "organizations_url": "https://api.github.com/users/ashokbugude/orgs", "repos_url": "https://api.github.com/users/ashokbugude/repos", "events_url": "https://api.github.com/users/ashokbugude/events{/privacy}", "received_events_url": "https://api.github.com/users/ashokbugude/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-06-10T17:43:34Z", "updated_at": "2017-06-12T09:05:34Z", "closed_at": "2017-06-11T16:10:57Z", "author_association": "NONE", "body_html": "<p>Description of the problem / feature request / question:</p>\n<p>I am trying to use bazel to build TensorFlow Library. It builds fine.</p>\n<p>Additional Feature :<br>\nI would like to add OpenCL code in one of the files of TensorFlow. Added all the required code<br>\nAND added the following in one of the build files (tensorflow/core/BUILD), considering 'opencl' as the root directory of opencl.</p>\n<p>cc_library(<br>\nname = \"opencl\",<br>\nhdrs=glob([\"opencl/include/CL/*h\"]),<br>\nvisibility =[\"//visibility:public\"],<br>\n)</p>\n<p>cc_library(<br>\nname=\"all_kernels\" ,<br>\nvisibility= [\"//visibility:public\"],<br>\ncopts=tf_copts() + [\"-Ithird_party/opencl/include\"],<br>\ndeps= [<br>\n\"//third_party/opencl\",<br>\n],</p>\n<p>If possible, provide a minimal example to reproduce the problem:</p>\n<p>By running<br>\nbazel build //tensorflow/examples/android:tensorflow_demo --fat_apk_cpu=armeabi-v7a --copt=\"-Ithird_party/opencl/include\"</p>\n<p>Issues Faced while building :<br>\nerror: undefined reference to 'clEnqueueReadBuffer'<br>\nerror: undefined reference to 'clReleaseMemObject'<br>\nerror: undefined reference to 'clReleaseMemObject'</p>\n<p>etc</p>\n<p>Environment info</p>\n<p>Operating System: Ubuntu 17.04</p>\n<p>Bazel version (output of bazel info release): release 0.5.1</p>\n<p>Have you found anything relevant by searching the web?</p>\n<p><a href=\"https://stackoverflow.com/questions/37761469/how-to-add-external-header-files-during-bazel-tensorflow-build/37844376\" rel=\"nofollow\">https://stackoverflow.com/questions/37761469/how-to-add-external-header-files-during-bazel-tensorflow-build/37844376</a></p>\n<p>Anything else, information or logs or outputs that would be helpful?</p>\n<p>bazel-out/android-arm-linux-androideabi-4.9-v7a-gnu-libstdcpp-fastbuild/bin/tensorflow/core/kernels/libandroid_tensorflow_kernels.lo(conv_ops.o):conv_ops.cc:function matrixMul(float*, float*, int, int, int, int, int, int): error: undefined reference to 'clGetPlatformIDs'<br>\nbazel-out/android-arm-linux-androideabi-4.9-v7a-gnu-libstdcpp-fastbuild/bin/tensorflow/core/kernels/libandroid_tensorflow_kernels.lo(conv_ops.o):conv_ops.cc:function matrixMul(float*, float*, int, int, int, int, int, int): error: undefined reference to 'clGetDeviceIDs'<br>\nbazel-out/android-arm-linux-androideabi-4.9-v7a-gnu-libstdcpp-fastbuild/bin/tensorflow/core/kernels/libandroid_tensorflow_kernels.lo(conv_ops.o):conv_ops.cc:function matrixMul(float*, float*, int, int, int, int, int, int): error: undefined reference to 'clCreateContext'</p>\n<p>I tried linking directly to libOpenCL.so as shown below by referring <a href=\"https://bazel.build/versions/master/docs/tutorial/cpp.html#adding-dependencies-on-precompiled-libraries\" rel=\"nofollow\">https://bazel.build/versions/master/docs/tutorial/cpp.html#adding-dependencies-on-precompiled-libraries</a><br>\n, but still same issue</p>\n<p>cc_library(<br>\nname = \"opencl\",<br>\nsrcs = glob([\"lib/x86_64/<em>.so\"]),<br>\nhdrs = glob([\"include/CL/</em>.h\"]),<br>\nvisibility = [\"//visibility:public\"],<br>\n)</p>\n<p>Please help me in resolving the issuee</p>", "body_text": "Description of the problem / feature request / question:\nI am trying to use bazel to build TensorFlow Library. It builds fine.\nAdditional Feature :\nI would like to add OpenCL code in one of the files of TensorFlow. Added all the required code\nAND added the following in one of the build files (tensorflow/core/BUILD), considering 'opencl' as the root directory of opencl.\ncc_library(\nname = \"opencl\",\nhdrs=glob([\"opencl/include/CL/*h\"]),\nvisibility =[\"//visibility:public\"],\n)\ncc_library(\nname=\"all_kernels\" ,\nvisibility= [\"//visibility:public\"],\ncopts=tf_copts() + [\"-Ithird_party/opencl/include\"],\ndeps= [\n\"//third_party/opencl\",\n],\nIf possible, provide a minimal example to reproduce the problem:\nBy running\nbazel build //tensorflow/examples/android:tensorflow_demo --fat_apk_cpu=armeabi-v7a --copt=\"-Ithird_party/opencl/include\"\nIssues Faced while building :\nerror: undefined reference to 'clEnqueueReadBuffer'\nerror: undefined reference to 'clReleaseMemObject'\nerror: undefined reference to 'clReleaseMemObject'\netc\nEnvironment info\nOperating System: Ubuntu 17.04\nBazel version (output of bazel info release): release 0.5.1\nHave you found anything relevant by searching the web?\nhttps://stackoverflow.com/questions/37761469/how-to-add-external-header-files-during-bazel-tensorflow-build/37844376\nAnything else, information or logs or outputs that would be helpful?\nbazel-out/android-arm-linux-androideabi-4.9-v7a-gnu-libstdcpp-fastbuild/bin/tensorflow/core/kernels/libandroid_tensorflow_kernels.lo(conv_ops.o):conv_ops.cc:function matrixMul(float*, float*, int, int, int, int, int, int): error: undefined reference to 'clGetPlatformIDs'\nbazel-out/android-arm-linux-androideabi-4.9-v7a-gnu-libstdcpp-fastbuild/bin/tensorflow/core/kernels/libandroid_tensorflow_kernels.lo(conv_ops.o):conv_ops.cc:function matrixMul(float*, float*, int, int, int, int, int, int): error: undefined reference to 'clGetDeviceIDs'\nbazel-out/android-arm-linux-androideabi-4.9-v7a-gnu-libstdcpp-fastbuild/bin/tensorflow/core/kernels/libandroid_tensorflow_kernels.lo(conv_ops.o):conv_ops.cc:function matrixMul(float*, float*, int, int, int, int, int, int): error: undefined reference to 'clCreateContext'\nI tried linking directly to libOpenCL.so as shown below by referring https://bazel.build/versions/master/docs/tutorial/cpp.html#adding-dependencies-on-precompiled-libraries\n, but still same issue\ncc_library(\nname = \"opencl\",\nsrcs = glob([\"lib/x86_64/.so\"]),\nhdrs = glob([\"include/CL/.h\"]),\nvisibility = [\"//visibility:public\"],\n)\nPlease help me in resolving the issuee", "body": "Description of the problem / feature request / question:\r\n\r\nI am trying to use bazel to build TensorFlow Library. It builds fine.\r\n\r\nAdditional Feature :\r\nI would like to add OpenCL code in one of the files of TensorFlow. Added all the required code\r\nAND added the following in one of the build files (tensorflow/core/BUILD), considering 'opencl' as the root directory of opencl.\r\n\r\ncc_library(\r\nname = \"opencl\",\r\nhdrs=glob([\"opencl/include/CL/*h\"]),\r\nvisibility =[\"//visibility:public\"],\r\n)\r\n\r\ncc_library(\r\nname=\"all_kernels\" ,\r\nvisibility= [\"//visibility:public\"],\r\ncopts=tf_copts() + [\"-Ithird_party/opencl/include\"],\r\ndeps= [\r\n\"//third_party/opencl\",\r\n],\r\n\r\nIf possible, provide a minimal example to reproduce the problem:\r\n\r\nBy running\r\nbazel build //tensorflow/examples/android:tensorflow_demo --fat_apk_cpu=armeabi-v7a --copt=\"-Ithird_party/opencl/include\"\r\n\r\nIssues Faced while building :\r\nerror: undefined reference to 'clEnqueueReadBuffer'\r\nerror: undefined reference to 'clReleaseMemObject'\r\nerror: undefined reference to 'clReleaseMemObject'\r\n\r\netc\r\n\r\nEnvironment info\r\n\r\nOperating System: Ubuntu 17.04\r\n\r\nBazel version (output of bazel info release): release 0.5.1\r\n\r\nHave you found anything relevant by searching the web?\r\n\r\nhttps://stackoverflow.com/questions/37761469/how-to-add-external-header-files-during-bazel-tensorflow-build/37844376\r\n\r\nAnything else, information or logs or outputs that would be helpful?\r\n\r\nbazel-out/android-arm-linux-androideabi-4.9-v7a-gnu-libstdcpp-fastbuild/bin/tensorflow/core/kernels/libandroid_tensorflow_kernels.lo(conv_ops.o):conv_ops.cc:function matrixMul(float*, float*, int, int, int, int, int, int): error: undefined reference to 'clGetPlatformIDs'\r\nbazel-out/android-arm-linux-androideabi-4.9-v7a-gnu-libstdcpp-fastbuild/bin/tensorflow/core/kernels/libandroid_tensorflow_kernels.lo(conv_ops.o):conv_ops.cc:function matrixMul(float*, float*, int, int, int, int, int, int): error: undefined reference to 'clGetDeviceIDs'\r\nbazel-out/android-arm-linux-androideabi-4.9-v7a-gnu-libstdcpp-fastbuild/bin/tensorflow/core/kernels/libandroid_tensorflow_kernels.lo(conv_ops.o):conv_ops.cc:function matrixMul(float*, float*, int, int, int, int, int, int): error: undefined reference to 'clCreateContext'\r\n\r\nI tried linking directly to libOpenCL.so as shown below by referring https://bazel.build/versions/master/docs/tutorial/cpp.html#adding-dependencies-on-precompiled-libraries\r\n, but still same issue\r\n\r\ncc_library(\r\n    name = \"opencl\",\r\n    srcs = glob([\"lib/x86_64/*.so\"]),\r\n    hdrs = glob([\"include/CL/*.h\"]),\r\nvisibility = [\"//visibility:public\"],\r\n)\r\n\r\nPlease help me in resolving the issuee"}