{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17456", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17456/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17456/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17456/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/17456", "id": 302518867, "node_id": "MDU6SXNzdWUzMDI1MTg4Njc=", "number": 17456, "title": "TensorForestEstimator with TensorFlow v1.4 \"No attribute model_fn\"", "user": {"login": "mikeymezher", "id": 5401052, "node_id": "MDQ6VXNlcjU0MDEwNTI=", "avatar_url": "https://avatars2.githubusercontent.com/u/5401052?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikeymezher", "html_url": "https://github.com/mikeymezher", "followers_url": "https://api.github.com/users/mikeymezher/followers", "following_url": "https://api.github.com/users/mikeymezher/following{/other_user}", "gists_url": "https://api.github.com/users/mikeymezher/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikeymezher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikeymezher/subscriptions", "organizations_url": "https://api.github.com/users/mikeymezher/orgs", "repos_url": "https://api.github.com/users/mikeymezher/repos", "events_url": "https://api.github.com/users/mikeymezher/events{/privacy}", "received_events_url": "https://api.github.com/users/mikeymezher/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "reedwm", "id": 6510203, "node_id": "MDQ6VXNlcjY1MTAyMDM=", "avatar_url": "https://avatars2.githubusercontent.com/u/6510203?v=4", "gravatar_id": "", "url": "https://api.github.com/users/reedwm", "html_url": "https://github.com/reedwm", "followers_url": "https://api.github.com/users/reedwm/followers", "following_url": "https://api.github.com/users/reedwm/following{/other_user}", "gists_url": "https://api.github.com/users/reedwm/gists{/gist_id}", "starred_url": "https://api.github.com/users/reedwm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/reedwm/subscriptions", "organizations_url": "https://api.github.com/users/reedwm/orgs", "repos_url": "https://api.github.com/users/reedwm/repos", "events_url": "https://api.github.com/users/reedwm/events{/privacy}", "received_events_url": "https://api.github.com/users/reedwm/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "reedwm", "id": 6510203, "node_id": "MDQ6VXNlcjY1MTAyMDM=", "avatar_url": "https://avatars2.githubusercontent.com/u/6510203?v=4", "gravatar_id": "", "url": "https://api.github.com/users/reedwm", "html_url": "https://github.com/reedwm", "followers_url": "https://api.github.com/users/reedwm/followers", "following_url": "https://api.github.com/users/reedwm/following{/other_user}", "gists_url": "https://api.github.com/users/reedwm/gists{/gist_id}", "starred_url": "https://api.github.com/users/reedwm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/reedwm/subscriptions", "organizations_url": "https://api.github.com/users/reedwm/orgs", "repos_url": "https://api.github.com/users/reedwm/repos", "events_url": "https://api.github.com/users/reedwm/events{/privacy}", "received_events_url": "https://api.github.com/users/reedwm/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2018-03-06T00:36:48Z", "updated_at": "2018-06-17T18:36:27Z", "closed_at": "2018-06-17T18:30:57Z", "author_association": "NONE", "body_html": "<p>Setting up a TensorForestEstimator on CloudML running TensorFlow version 1.4.<br>\nThe setup is identical to a working DNNClassifier estimator (of course, swapping the parameters within the Random Forest), however, an error occurs when the TensorForestEstimator has its model_fn called.<br>\nThis seems to be a bug, since the model_fn attribute is defined during initialization <a href=\"url\">https://github.com/tensorflow/tensorflow/blob/r1.4/tensorflow/contrib/tensor_forest/client/random_forest.py</a></p>\n<p>Here's the relevant parts of the code:<br>\n`  # Build an estimator.</p>\n<p>graph_builder_class = tensor_forest.RandomForestGraphs</p>\n<p>params = tf.contrib.tensor_forest.python.tensor_forest.ForestHParams(num_classes=10, num_features=100, num_trees=200, max_nodes=1000)<br>\nrfClf=random_forest.TensorForestEstimator(params=params,feature_columns=TF_INPUT_COLUMNS,config=config,graph_builder_class = graph_builder_class,keys_column='key2')</p>\n<p>rfClf2 = tf.contrib.estimator.forward_features(rfClf, ['key1',key2', 'key3'])`</p>\n<p>Below is the error traceback I get from the CloudML runner.</p>\n<blockquote>\n<p>Traceback (most recent call last): File \"/usr/lib/python2.7/runpy.py\", line 174, in _run_module_as_main \"<strong>main</strong>\", fname, loader, pkg_name) File \"/usr/lib/python2.7/runpy.py\", line 72, in _run_code exec code in run_globals File \"/root/.local/lib/python2.7/site-packages/RF_Model/RF_task_tf14.py\", line 201, in  run_experiment(hparams) File \"/root/.local/lib/python2.7/site-packages/RF_Model/RF_task_tf14.py\", line 88, in run_experiment eval_spec) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/training.py\", line 464, in train_and_evaluate getattr(executor, task_to_run)() File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/training.py\", line 562, in run_master self._start_distributed_training(saving_listeners=saving_listeners) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/training.py\", line 687, in _start_distributed_training saving_listeners=saving_listeners) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 302, in train loss = self._train_model(input_fn, hooks, saving_listeners) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 711, in _train_model features, labels, model_fn_lib.ModeKeys.TRAIN, self.config) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 694, in _call_model_fn model_fn_results = self._model_fn(features=features, **kwargs) File \"/root/.local/lib/python2.7/site-packages/RF_Model/model1.py\", line 286, in _model_fn features=features, labels=labels, mode=mode, config=estimator.config) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 694, in _call_model_fn model_fn_results = self._model_fn(features=features, **kwargs) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/estimator/python/estimator/extenders.py\", line 222, in new_model_fn spec = estimator.model_fn(features, labels, mode, config) AttributeError: 'TensorForestEstimator' object has no attribute 'model_fn'</p>\n</blockquote>\n<p>I'm attempting to use tf.contrib.estimator.forward_features to past a list of keys through to the prediction output (this is reflected in the traceback when new_model_fn tries to call the TensorForestEstimator's \"model_fn attribute\") <a href=\"url\">https://github.com/tensorflow/tensorflow/blob/r1.4/tensorflow/contrib/estimator/python/estimator/extenders.py</a></p>\n<p>It's also probably worth mentioning that the model_fn call within contrib.estimator.forward_features passes 4 parameters, whereas the model function defined within TensorForestEstimator only accepts 3 (see line 392 in the first link).</p>\n<p>-OS Platform: (N/A - CloudML (likely Debian workers?))<br>\n-Tensorflow running v1.4<br>\n-Relevant code mentioned above.</p>", "body_text": "Setting up a TensorForestEstimator on CloudML running TensorFlow version 1.4.\nThe setup is identical to a working DNNClassifier estimator (of course, swapping the parameters within the Random Forest), however, an error occurs when the TensorForestEstimator has its model_fn called.\nThis seems to be a bug, since the model_fn attribute is defined during initialization https://github.com/tensorflow/tensorflow/blob/r1.4/tensorflow/contrib/tensor_forest/client/random_forest.py\nHere's the relevant parts of the code:\n`  # Build an estimator.\ngraph_builder_class = tensor_forest.RandomForestGraphs\nparams = tf.contrib.tensor_forest.python.tensor_forest.ForestHParams(num_classes=10, num_features=100, num_trees=200, max_nodes=1000)\nrfClf=random_forest.TensorForestEstimator(params=params,feature_columns=TF_INPUT_COLUMNS,config=config,graph_builder_class = graph_builder_class,keys_column='key2')\nrfClf2 = tf.contrib.estimator.forward_features(rfClf, ['key1',key2', 'key3'])`\nBelow is the error traceback I get from the CloudML runner.\n\nTraceback (most recent call last): File \"/usr/lib/python2.7/runpy.py\", line 174, in _run_module_as_main \"main\", fname, loader, pkg_name) File \"/usr/lib/python2.7/runpy.py\", line 72, in _run_code exec code in run_globals File \"/root/.local/lib/python2.7/site-packages/RF_Model/RF_task_tf14.py\", line 201, in  run_experiment(hparams) File \"/root/.local/lib/python2.7/site-packages/RF_Model/RF_task_tf14.py\", line 88, in run_experiment eval_spec) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/training.py\", line 464, in train_and_evaluate getattr(executor, task_to_run)() File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/training.py\", line 562, in run_master self._start_distributed_training(saving_listeners=saving_listeners) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/training.py\", line 687, in _start_distributed_training saving_listeners=saving_listeners) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 302, in train loss = self._train_model(input_fn, hooks, saving_listeners) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 711, in _train_model features, labels, model_fn_lib.ModeKeys.TRAIN, self.config) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 694, in _call_model_fn model_fn_results = self._model_fn(features=features, **kwargs) File \"/root/.local/lib/python2.7/site-packages/RF_Model/model1.py\", line 286, in _model_fn features=features, labels=labels, mode=mode, config=estimator.config) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 694, in _call_model_fn model_fn_results = self._model_fn(features=features, **kwargs) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/estimator/python/estimator/extenders.py\", line 222, in new_model_fn spec = estimator.model_fn(features, labels, mode, config) AttributeError: 'TensorForestEstimator' object has no attribute 'model_fn'\n\nI'm attempting to use tf.contrib.estimator.forward_features to past a list of keys through to the prediction output (this is reflected in the traceback when new_model_fn tries to call the TensorForestEstimator's \"model_fn attribute\") https://github.com/tensorflow/tensorflow/blob/r1.4/tensorflow/contrib/estimator/python/estimator/extenders.py\nIt's also probably worth mentioning that the model_fn call within contrib.estimator.forward_features passes 4 parameters, whereas the model function defined within TensorForestEstimator only accepts 3 (see line 392 in the first link).\n-OS Platform: (N/A - CloudML (likely Debian workers?))\n-Tensorflow running v1.4\n-Relevant code mentioned above.", "body": "Setting up a TensorForestEstimator on CloudML running TensorFlow version 1.4. \r\nThe setup is identical to a working DNNClassifier estimator (of course, swapping the parameters within the Random Forest), however, an error occurs when the TensorForestEstimator has its model_fn called.\r\nThis seems to be a bug, since the model_fn attribute is defined during initialization [https://github.com/tensorflow/tensorflow/blob/r1.4/tensorflow/contrib/tensor_forest/client/random_forest.py](url)\r\n\r\nHere's the relevant parts of the code:\r\n`  # Build an estimator.\r\n    \r\ngraph_builder_class = tensor_forest.RandomForestGraphs\r\n    \r\nparams = tf.contrib.tensor_forest.python.tensor_forest.ForestHParams(num_classes=10, num_features=100, num_trees=200, max_nodes=1000)\r\n    rfClf=random_forest.TensorForestEstimator(params=params,feature_columns=TF_INPUT_COLUMNS,config=config,graph_builder_class = graph_builder_class,keys_column='key2')\r\n    \r\nrfClf2 = tf.contrib.estimator.forward_features(rfClf, ['key1',key2', 'key3'])`\r\n\r\n\r\nBelow is the error traceback I get from the CloudML runner.\r\n\r\n> Traceback (most recent call last): File \"/usr/lib/python2.7/runpy.py\", line 174, in _run_module_as_main \"__main__\", fname, loader, pkg_name) File \"/usr/lib/python2.7/runpy.py\", line 72, in _run_code exec code in run_globals File \"/root/.local/lib/python2.7/site-packages/RF_Model/RF_task_tf14.py\", line 201, in <module> run_experiment(hparams) File \"/root/.local/lib/python2.7/site-packages/RF_Model/RF_task_tf14.py\", line 88, in run_experiment eval_spec) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/training.py\", line 464, in train_and_evaluate getattr(executor, task_to_run)() File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/training.py\", line 562, in run_master self._start_distributed_training(saving_listeners=saving_listeners) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/training.py\", line 687, in _start_distributed_training saving_listeners=saving_listeners) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 302, in train loss = self._train_model(input_fn, hooks, saving_listeners) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 711, in _train_model features, labels, model_fn_lib.ModeKeys.TRAIN, self.config) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 694, in _call_model_fn model_fn_results = self._model_fn(features=features, **kwargs) File \"/root/.local/lib/python2.7/site-packages/RF_Model/model1.py\", line 286, in _model_fn features=features, labels=labels, mode=mode, config=estimator.config) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 694, in _call_model_fn model_fn_results = self._model_fn(features=features, **kwargs) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/estimator/python/estimator/extenders.py\", line 222, in new_model_fn spec = estimator.model_fn(features, labels, mode, config) AttributeError: 'TensorForestEstimator' object has no attribute 'model_fn'\r\n\r\nI'm attempting to use tf.contrib.estimator.forward_features to past a list of keys through to the prediction output (this is reflected in the traceback when new_model_fn tries to call the TensorForestEstimator's \"model_fn attribute\") [https://github.com/tensorflow/tensorflow/blob/r1.4/tensorflow/contrib/estimator/python/estimator/extenders.py](url)\r\n\r\nIt's also probably worth mentioning that the model_fn call within contrib.estimator.forward_features passes 4 parameters, whereas the model function defined within TensorForestEstimator only accepts 3 (see line 392 in the first link). \r\n\r\n-OS Platform: (N/A - CloudML (likely Debian workers?))\r\n-Tensorflow running v1.4\r\n-Relevant code mentioned above.\r\n\r\n"}