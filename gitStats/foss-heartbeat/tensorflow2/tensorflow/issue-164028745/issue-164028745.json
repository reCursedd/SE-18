{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3202", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3202/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3202/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3202/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/3202", "id": 164028745, "node_id": "MDU6SXNzdWUxNjQwMjg3NDU=", "number": 3202, "title": "genrule //tensorflow/contrib/session_bundle/example:half_plus_two ignores bazels TEST_TMPDIR and uses uses /tmp/", "user": {"login": "Robin-des-Bois", "id": 6424472, "node_id": "MDQ6VXNlcjY0MjQ0NzI=", "avatar_url": "https://avatars1.githubusercontent.com/u/6424472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Robin-des-Bois", "html_url": "https://github.com/Robin-des-Bois", "followers_url": "https://api.github.com/users/Robin-des-Bois/followers", "following_url": "https://api.github.com/users/Robin-des-Bois/following{/other_user}", "gists_url": "https://api.github.com/users/Robin-des-Bois/gists{/gist_id}", "starred_url": "https://api.github.com/users/Robin-des-Bois/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Robin-des-Bois/subscriptions", "organizations_url": "https://api.github.com/users/Robin-des-Bois/orgs", "repos_url": "https://api.github.com/users/Robin-des-Bois/repos", "events_url": "https://api.github.com/users/Robin-des-Bois/events{/privacy}", "received_events_url": "https://api.github.com/users/Robin-des-Bois/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-07-06T08:54:35Z", "updated_at": "2017-01-04T05:59:38Z", "closed_at": "2017-01-04T05:59:38Z", "author_association": "CONTRIBUTOR", "body_html": "<p>I am trying to build tensorflow 0.9.0 on a cray cluster using bazel 0.3. Becuase I have limited space in my home directory I set TEST_TMPDIR to some scratch space.</p>\n<p>Somehow the /tmp directory already contains a folder half_plus_two created by another user of the system. Therefore I don't have write access and the build fails:</p>\n<pre><code>bazel  build  --linkopt '-lrt' --config=cuda --verbose_failures -c opt //tensorflow/tools/pip_package:build_pip_package\nINFO: $TEST_TMPDIR defined: output root default is '/scratch/daint/user_name/bazelout'.\nExtracting Bazel installation...\n.\nINFO: Waiting for response from Bazel server (pid 9772)...\nWARNING: Sandboxed execution is not supported on your system and thus hermeticity of actions cannot be guaranteed. See http://bazel.io/docs/bazel-user-manual.html#sandboxing for more information. You can turn off this warning via --ignore_unsupported_sandboxing.\nWARNING: /scratch/daint/user_name/bazelout/_bazel_user_name/e48b2676a5a6481d625353bc3f790885/external/protobuf/WORKSPACE:1: Workspace name in /scratch/daint/user_name/bazelout/_bazel_user_name/e48b2676a5a6481d625353bc3f790885/external/protobuf/WORKSPACE (@__main__) does not match the name given in the repository's definition (@protobuf); this will cause a build error in future versions.\nWARNING: /users/user_name/tensorflow-cray/util/python/BUILD:11:16: in includes attribute of cc_library rule //util/python:python_headers: 'python_include' resolves to 'util/python/python_include' not in 'third_party'. This will be an error in the future.\nWARNING: /scratch/daint/user_name/bazelout/_bazel_user_name/e48b2676a5a6481d625353bc3f790885/external/highwayhash/WORKSPACE:1: Workspace name in /scratch/daint/user_name/bazelout/_bazel_user_name/e48b2676a5a6481d625353bc3f790885/external/highwayhash/WORKSPACE (@__main__) does not match the name given in the repository's definition (@highwayhash); this will cause a build error in future versions.\nWARNING: /scratch/daint/user_name/bazelout/_bazel_user_name/e48b2676a5a6481d625353bc3f790885/external/re2/WORKSPACE:1: Workspace name in /scratch/daint/user_name/bazelout/_bazel_user_name/e48b2676a5a6481d625353bc3f790885/external/re2/WORKSPACE (@__main__) does not match the name given in the repository's definition (@re2); this will cause a build error in future versions.\nINFO: Found 1 target...\n[removed output...]\nERROR: /users/user_name/tensorflow-cray/tensorflow/contrib/session_bundle/example/BUILD:38:1: Executing genrule //tensorflow/contrib/session_bundle/example:half_plus_two failed: bash failed: error executing command \n  (cd /scratch/daint/user_name/bazelout/e48b2676a5a6481d625353bc3f790885/execroot/tensorflow-cray &amp;&amp; \\\n  exec env - \\\n    PATH=/users/user_name/tf_cray_env/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/Python/3.5.1-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/Tk/8.6.4-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/SQLite/3.9.2-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/Tcl/8.6.4-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/freetype/2.5.5-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/libpng/1.6.16-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/libreadline/6.3-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/ncurses/6.0-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/bzip2/1.0.6-CrayGNU-2016.03/bin:/opt/cray/rca/1.0.0-2.0502.60530.1.62.ari/bin:/opt/cray/alps/5.2.4-2.0502.9822.32.1.ari/sbin:/opt/cray/dvs/2.5_0.9.0-1.0502.2188.1.116.ari/bin:/opt/cray/xpmem/0.1-2.0502.64982.5.3.ari/bin:/opt/cray/pmi/5.0.10-1.0000.11050.0.0.ari/bin:/opt/cray/ugni/6.0-1.0502.10863.8.29.ari/bin:/opt/cray/udreg/2.3.2-1.0502.10518.2.17.ari/bin:/opt/toolworks/totalview.8.11.0-0/bin:/opt/totalview-support/1.1.4/bin:/opt/gcc/4.9.3/bin:/opt/nvidia/cudatoolkit7.0/7.0.28-1.0502.10742.5.1/bin:/opt/nvidia/cudatoolkit7.0/7.0.28-1.0502.10742.5.1/libnvvp:/opt/java/jdk1.8.0_51/bin:/apps/common/UES/SLES11/ddt/6.0.6/libexec:/apps/common/UES/SLES11/ddt/6.0.6/bin:/opt/cray/mpt/7.3.2/gni/bin:/apps/daint/munge/default/bin:/apps/daint/slurm/default/bin:/opt/slurm/default/bin:/opt/cray/craype/2.4.0/bin:/opt/cray/switch/1.0-1.0502.60522.1.61.ari/bin:/opt/cray/eslogin/eswrap/1.1.0-1.020200.1231.0/bin:/opt/modules/3.2.10.3/bin:/users/user_name/bin:/usr/local/bin:/usr/bin:/bin:/usr/bin/X11:/usr/X11R6/bin:/usr/games:/usr/lib/mit/bin:/usr/lib/mit/sbin:/sbin:/usr/sbin:.:/usr/lib/qt3/bin:/opt/cray/bin:/apps/ela/system/bin:/apps/common/system/bin:/apps/daint/system/bin:/apps/ela/system/bin:/apps/common/system/bin:/apps/daint/system/bin \\\n  /bin/bash -c 'source external/bazel_tools/tools/genrule/genrule-setup.sh; rm -rf /tmp/half_plus_two; /users/user_name/tf_cray_env/bin/python bazel-out/host/bin/tensorflow/contrib/session_bundle/example/export_half_plus_two; cp -r /tmp/half_plus_two/* bazel-out/local_linux-py3-opt/genfiles/tensorflow/contrib/session_bundle/example/half_plus_two'): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\nrm: cannot remove `/tmp/half_plus_two/00000123/assets': Permission denied\nrm: cannot remove `/tmp/half_plus_two/00000123/export-00000-of-00001': Permission denied\nrm: cannot remove `/tmp/half_plus_two/00000123/export.meta': Permission denied\nrm: cannot remove `/tmp/half_plus_two/00000123/checkpoint': Permission denied\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\nINFO: Elapsed time: 1912.489s, Critical Path: 975.47s\n</code></pre>\n<p>Wouldn't it make sense if the genrule half_plus_two would also use TEST_TMPDIR or is there some reason that it does not.</p>\n<p>Where do I have to make changes to hardcode the directory used by the genrule?</p>\n<p>Thanks for whatever support you are able to provide.</p>", "body_text": "I am trying to build tensorflow 0.9.0 on a cray cluster using bazel 0.3. Becuase I have limited space in my home directory I set TEST_TMPDIR to some scratch space.\nSomehow the /tmp directory already contains a folder half_plus_two created by another user of the system. Therefore I don't have write access and the build fails:\nbazel  build  --linkopt '-lrt' --config=cuda --verbose_failures -c opt //tensorflow/tools/pip_package:build_pip_package\nINFO: $TEST_TMPDIR defined: output root default is '/scratch/daint/user_name/bazelout'.\nExtracting Bazel installation...\n.\nINFO: Waiting for response from Bazel server (pid 9772)...\nWARNING: Sandboxed execution is not supported on your system and thus hermeticity of actions cannot be guaranteed. See http://bazel.io/docs/bazel-user-manual.html#sandboxing for more information. You can turn off this warning via --ignore_unsupported_sandboxing.\nWARNING: /scratch/daint/user_name/bazelout/_bazel_user_name/e48b2676a5a6481d625353bc3f790885/external/protobuf/WORKSPACE:1: Workspace name in /scratch/daint/user_name/bazelout/_bazel_user_name/e48b2676a5a6481d625353bc3f790885/external/protobuf/WORKSPACE (@__main__) does not match the name given in the repository's definition (@protobuf); this will cause a build error in future versions.\nWARNING: /users/user_name/tensorflow-cray/util/python/BUILD:11:16: in includes attribute of cc_library rule //util/python:python_headers: 'python_include' resolves to 'util/python/python_include' not in 'third_party'. This will be an error in the future.\nWARNING: /scratch/daint/user_name/bazelout/_bazel_user_name/e48b2676a5a6481d625353bc3f790885/external/highwayhash/WORKSPACE:1: Workspace name in /scratch/daint/user_name/bazelout/_bazel_user_name/e48b2676a5a6481d625353bc3f790885/external/highwayhash/WORKSPACE (@__main__) does not match the name given in the repository's definition (@highwayhash); this will cause a build error in future versions.\nWARNING: /scratch/daint/user_name/bazelout/_bazel_user_name/e48b2676a5a6481d625353bc3f790885/external/re2/WORKSPACE:1: Workspace name in /scratch/daint/user_name/bazelout/_bazel_user_name/e48b2676a5a6481d625353bc3f790885/external/re2/WORKSPACE (@__main__) does not match the name given in the repository's definition (@re2); this will cause a build error in future versions.\nINFO: Found 1 target...\n[removed output...]\nERROR: /users/user_name/tensorflow-cray/tensorflow/contrib/session_bundle/example/BUILD:38:1: Executing genrule //tensorflow/contrib/session_bundle/example:half_plus_two failed: bash failed: error executing command \n  (cd /scratch/daint/user_name/bazelout/e48b2676a5a6481d625353bc3f790885/execroot/tensorflow-cray && \\\n  exec env - \\\n    PATH=/users/user_name/tf_cray_env/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/Python/3.5.1-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/Tk/8.6.4-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/SQLite/3.9.2-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/Tcl/8.6.4-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/freetype/2.5.5-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/libpng/1.6.16-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/libreadline/6.3-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/ncurses/6.0-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/bzip2/1.0.6-CrayGNU-2016.03/bin:/opt/cray/rca/1.0.0-2.0502.60530.1.62.ari/bin:/opt/cray/alps/5.2.4-2.0502.9822.32.1.ari/sbin:/opt/cray/dvs/2.5_0.9.0-1.0502.2188.1.116.ari/bin:/opt/cray/xpmem/0.1-2.0502.64982.5.3.ari/bin:/opt/cray/pmi/5.0.10-1.0000.11050.0.0.ari/bin:/opt/cray/ugni/6.0-1.0502.10863.8.29.ari/bin:/opt/cray/udreg/2.3.2-1.0502.10518.2.17.ari/bin:/opt/toolworks/totalview.8.11.0-0/bin:/opt/totalview-support/1.1.4/bin:/opt/gcc/4.9.3/bin:/opt/nvidia/cudatoolkit7.0/7.0.28-1.0502.10742.5.1/bin:/opt/nvidia/cudatoolkit7.0/7.0.28-1.0502.10742.5.1/libnvvp:/opt/java/jdk1.8.0_51/bin:/apps/common/UES/SLES11/ddt/6.0.6/libexec:/apps/common/UES/SLES11/ddt/6.0.6/bin:/opt/cray/mpt/7.3.2/gni/bin:/apps/daint/munge/default/bin:/apps/daint/slurm/default/bin:/opt/slurm/default/bin:/opt/cray/craype/2.4.0/bin:/opt/cray/switch/1.0-1.0502.60522.1.61.ari/bin:/opt/cray/eslogin/eswrap/1.1.0-1.020200.1231.0/bin:/opt/modules/3.2.10.3/bin:/users/user_name/bin:/usr/local/bin:/usr/bin:/bin:/usr/bin/X11:/usr/X11R6/bin:/usr/games:/usr/lib/mit/bin:/usr/lib/mit/sbin:/sbin:/usr/sbin:.:/usr/lib/qt3/bin:/opt/cray/bin:/apps/ela/system/bin:/apps/common/system/bin:/apps/daint/system/bin:/apps/ela/system/bin:/apps/common/system/bin:/apps/daint/system/bin \\\n  /bin/bash -c 'source external/bazel_tools/tools/genrule/genrule-setup.sh; rm -rf /tmp/half_plus_two; /users/user_name/tf_cray_env/bin/python bazel-out/host/bin/tensorflow/contrib/session_bundle/example/export_half_plus_two; cp -r /tmp/half_plus_two/* bazel-out/local_linux-py3-opt/genfiles/tensorflow/contrib/session_bundle/example/half_plus_two'): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\nrm: cannot remove `/tmp/half_plus_two/00000123/assets': Permission denied\nrm: cannot remove `/tmp/half_plus_two/00000123/export-00000-of-00001': Permission denied\nrm: cannot remove `/tmp/half_plus_two/00000123/export.meta': Permission denied\nrm: cannot remove `/tmp/half_plus_two/00000123/checkpoint': Permission denied\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\nINFO: Elapsed time: 1912.489s, Critical Path: 975.47s\n\nWouldn't it make sense if the genrule half_plus_two would also use TEST_TMPDIR or is there some reason that it does not.\nWhere do I have to make changes to hardcode the directory used by the genrule?\nThanks for whatever support you are able to provide.", "body": "I am trying to build tensorflow 0.9.0 on a cray cluster using bazel 0.3. Becuase I have limited space in my home directory I set TEST_TMPDIR to some scratch space.\n\nSomehow the /tmp directory already contains a folder half_plus_two created by another user of the system. Therefore I don't have write access and the build fails: \n\n```\nbazel  build  --linkopt '-lrt' --config=cuda --verbose_failures -c opt //tensorflow/tools/pip_package:build_pip_package\nINFO: $TEST_TMPDIR defined: output root default is '/scratch/daint/user_name/bazelout'.\nExtracting Bazel installation...\n.\nINFO: Waiting for response from Bazel server (pid 9772)...\nWARNING: Sandboxed execution is not supported on your system and thus hermeticity of actions cannot be guaranteed. See http://bazel.io/docs/bazel-user-manual.html#sandboxing for more information. You can turn off this warning via --ignore_unsupported_sandboxing.\nWARNING: /scratch/daint/user_name/bazelout/_bazel_user_name/e48b2676a5a6481d625353bc3f790885/external/protobuf/WORKSPACE:1: Workspace name in /scratch/daint/user_name/bazelout/_bazel_user_name/e48b2676a5a6481d625353bc3f790885/external/protobuf/WORKSPACE (@__main__) does not match the name given in the repository's definition (@protobuf); this will cause a build error in future versions.\nWARNING: /users/user_name/tensorflow-cray/util/python/BUILD:11:16: in includes attribute of cc_library rule //util/python:python_headers: 'python_include' resolves to 'util/python/python_include' not in 'third_party'. This will be an error in the future.\nWARNING: /scratch/daint/user_name/bazelout/_bazel_user_name/e48b2676a5a6481d625353bc3f790885/external/highwayhash/WORKSPACE:1: Workspace name in /scratch/daint/user_name/bazelout/_bazel_user_name/e48b2676a5a6481d625353bc3f790885/external/highwayhash/WORKSPACE (@__main__) does not match the name given in the repository's definition (@highwayhash); this will cause a build error in future versions.\nWARNING: /scratch/daint/user_name/bazelout/_bazel_user_name/e48b2676a5a6481d625353bc3f790885/external/re2/WORKSPACE:1: Workspace name in /scratch/daint/user_name/bazelout/_bazel_user_name/e48b2676a5a6481d625353bc3f790885/external/re2/WORKSPACE (@__main__) does not match the name given in the repository's definition (@re2); this will cause a build error in future versions.\nINFO: Found 1 target...\n[removed output...]\nERROR: /users/user_name/tensorflow-cray/tensorflow/contrib/session_bundle/example/BUILD:38:1: Executing genrule //tensorflow/contrib/session_bundle/example:half_plus_two failed: bash failed: error executing command \n  (cd /scratch/daint/user_name/bazelout/e48b2676a5a6481d625353bc3f790885/execroot/tensorflow-cray && \\\n  exec env - \\\n    PATH=/users/user_name/tf_cray_env/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/Python/3.5.1-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/Tk/8.6.4-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/SQLite/3.9.2-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/Tcl/8.6.4-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/freetype/2.5.5-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/libpng/1.6.16-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/libreadline/6.3-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/ncurses/6.0-CrayGNU-2016.03/bin:/apps/daint/UES/jenkins/5.2.UP04/easybuild/software/bzip2/1.0.6-CrayGNU-2016.03/bin:/opt/cray/rca/1.0.0-2.0502.60530.1.62.ari/bin:/opt/cray/alps/5.2.4-2.0502.9822.32.1.ari/sbin:/opt/cray/dvs/2.5_0.9.0-1.0502.2188.1.116.ari/bin:/opt/cray/xpmem/0.1-2.0502.64982.5.3.ari/bin:/opt/cray/pmi/5.0.10-1.0000.11050.0.0.ari/bin:/opt/cray/ugni/6.0-1.0502.10863.8.29.ari/bin:/opt/cray/udreg/2.3.2-1.0502.10518.2.17.ari/bin:/opt/toolworks/totalview.8.11.0-0/bin:/opt/totalview-support/1.1.4/bin:/opt/gcc/4.9.3/bin:/opt/nvidia/cudatoolkit7.0/7.0.28-1.0502.10742.5.1/bin:/opt/nvidia/cudatoolkit7.0/7.0.28-1.0502.10742.5.1/libnvvp:/opt/java/jdk1.8.0_51/bin:/apps/common/UES/SLES11/ddt/6.0.6/libexec:/apps/common/UES/SLES11/ddt/6.0.6/bin:/opt/cray/mpt/7.3.2/gni/bin:/apps/daint/munge/default/bin:/apps/daint/slurm/default/bin:/opt/slurm/default/bin:/opt/cray/craype/2.4.0/bin:/opt/cray/switch/1.0-1.0502.60522.1.61.ari/bin:/opt/cray/eslogin/eswrap/1.1.0-1.020200.1231.0/bin:/opt/modules/3.2.10.3/bin:/users/user_name/bin:/usr/local/bin:/usr/bin:/bin:/usr/bin/X11:/usr/X11R6/bin:/usr/games:/usr/lib/mit/bin:/usr/lib/mit/sbin:/sbin:/usr/sbin:.:/usr/lib/qt3/bin:/opt/cray/bin:/apps/ela/system/bin:/apps/common/system/bin:/apps/daint/system/bin:/apps/ela/system/bin:/apps/common/system/bin:/apps/daint/system/bin \\\n  /bin/bash -c 'source external/bazel_tools/tools/genrule/genrule-setup.sh; rm -rf /tmp/half_plus_two; /users/user_name/tf_cray_env/bin/python bazel-out/host/bin/tensorflow/contrib/session_bundle/example/export_half_plus_two; cp -r /tmp/half_plus_two/* bazel-out/local_linux-py3-opt/genfiles/tensorflow/contrib/session_bundle/example/half_plus_two'): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\nrm: cannot remove `/tmp/half_plus_two/00000123/assets': Permission denied\nrm: cannot remove `/tmp/half_plus_two/00000123/export-00000-of-00001': Permission denied\nrm: cannot remove `/tmp/half_plus_two/00000123/export.meta': Permission denied\nrm: cannot remove `/tmp/half_plus_two/00000123/checkpoint': Permission denied\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\nINFO: Elapsed time: 1912.489s, Critical Path: 975.47s\n```\n\nWouldn't it make sense if the genrule half_plus_two would also use TEST_TMPDIR or is there some reason that it does not. \n\nWhere do I have to make changes to hardcode the directory used by the genrule?\n\nThanks for whatever support you are able to provide.\n"}