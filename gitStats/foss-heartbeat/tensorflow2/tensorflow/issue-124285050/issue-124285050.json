{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/649", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/649/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/649/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/649/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/649", "id": 124285050, "node_id": "MDU6SXNzdWUxMjQyODUwNTA=", "number": 649, "title": "translate.py - empty _buckets sets will crash", "user": {"login": "marcotrombetti", "id": 9898003, "node_id": "MDQ6VXNlcjk4OTgwMDM=", "avatar_url": "https://avatars0.githubusercontent.com/u/9898003?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marcotrombetti", "html_url": "https://github.com/marcotrombetti", "followers_url": "https://api.github.com/users/marcotrombetti/followers", "following_url": "https://api.github.com/users/marcotrombetti/following{/other_user}", "gists_url": "https://api.github.com/users/marcotrombetti/gists{/gist_id}", "starred_url": "https://api.github.com/users/marcotrombetti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marcotrombetti/subscriptions", "organizations_url": "https://api.github.com/users/marcotrombetti/orgs", "repos_url": "https://api.github.com/users/marcotrombetti/repos", "events_url": "https://api.github.com/users/marcotrombetti/events{/privacy}", "received_events_url": "https://api.github.com/users/marcotrombetti/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2015-12-30T00:04:12Z", "updated_at": "2017-02-09T22:02:24Z", "closed_at": "2017-01-19T23:07:21Z", "author_association": "NONE", "body_html": "<p>If the dev_set does not contain all the string related to all the _buckets<br>\nthe script will crash.<br>\nEg. If the dev set does not contain a string between 20 and 25 words, the script will crash.</p>\n<p>translate.py, around line 178</p>\n<div class=\"highlight highlight-source-python\"><pre>encoder_inputs, decoder_inputs, target_weights <span class=\"pl-k\">=</span> model.get_batch(\n              dev_set, bucket_id)\n<span class=\"pl-c1\">...</span></pre></div>\n<p>I think that before that line you should had add an if to avoid that</p>\n<div class=\"highlight highlight-source-python\"><pre>     <span class=\"pl-k\">if</span> <span class=\"pl-c1\">len</span>(dev_set[bucket_id])<span class=\"pl-k\">&gt;</span><span class=\"pl-c1\">0</span>:\n           encoder_inputs, decoder_inputs, target_weights <span class=\"pl-k\">=</span> model.get_batch(\n              dev_set, bucket_id)\n           _, eval_loss, _ <span class=\"pl-k\">=</span> model.step(sess, encoder_inputs, decoder_inputs,\n                                       target_weights, bucket_id, <span class=\"pl-c1\">True</span>)\n           eval_ppx <span class=\"pl-k\">=</span> math.exp(eval_loss) <span class=\"pl-k\">if</span> eval_loss <span class=\"pl-k\">&lt;</span> <span class=\"pl-c1\">300</span> <span class=\"pl-k\">else</span> <span class=\"pl-c1\">float</span>(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>inf<span class=\"pl-pds\">'</span></span>)\n           <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>  eval: bucket <span class=\"pl-c1\">%d</span> perplexity <span class=\"pl-c1\">%.2f</span><span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">%</span> (bucket_id, eval_px))</pre></div>", "body_text": "If the dev_set does not contain all the string related to all the _buckets\nthe script will crash.\nEg. If the dev set does not contain a string between 20 and 25 words, the script will crash.\ntranslate.py, around line 178\nencoder_inputs, decoder_inputs, target_weights = model.get_batch(\n              dev_set, bucket_id)\n...\nI think that before that line you should had add an if to avoid that\n     if len(dev_set[bucket_id])>0:\n           encoder_inputs, decoder_inputs, target_weights = model.get_batch(\n              dev_set, bucket_id)\n           _, eval_loss, _ = model.step(sess, encoder_inputs, decoder_inputs,\n                                       target_weights, bucket_id, True)\n           eval_ppx = math.exp(eval_loss) if eval_loss < 300 else float('inf')\n           print(\"  eval: bucket %d perplexity %.2f\" % (bucket_id, eval_px))", "body": "If the dev_set does not contain all the string related to all the _buckets \nthe script will crash.\nEg. If the dev set does not contain a string between 20 and 25 words, the script will crash.\n\ntranslate.py, around line 178\n\n``` python\nencoder_inputs, decoder_inputs, target_weights = model.get_batch(\n              dev_set, bucket_id)\n...\n```\n\nI think that before that line you should had add an if to avoid that\n\n``` python\n     if len(dev_set[bucket_id])>0:\n           encoder_inputs, decoder_inputs, target_weights = model.get_batch(\n              dev_set, bucket_id)\n           _, eval_loss, _ = model.step(sess, encoder_inputs, decoder_inputs,\n                                       target_weights, bucket_id, True)\n           eval_ppx = math.exp(eval_loss) if eval_loss < 300 else float('inf')\n           print(\"  eval: bucket %d perplexity %.2f\" % (bucket_id, eval_px))\n```\n"}