{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14891", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14891/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14891/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14891/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/14891", "id": 276866370, "node_id": "MDU6SXNzdWUyNzY4NjYzNzA=", "number": 14891, "title": "`panic: runtime error: cgo argument has Go pointer to Go pointer` when using FIFOQueueV2 with non scalar shapes", "user": {"login": "is8ac", "id": 8010041, "node_id": "MDQ6VXNlcjgwMTAwNDE=", "avatar_url": "https://avatars3.githubusercontent.com/u/8010041?v=4", "gravatar_id": "", "url": "https://api.github.com/users/is8ac", "html_url": "https://github.com/is8ac", "followers_url": "https://api.github.com/users/is8ac/followers", "following_url": "https://api.github.com/users/is8ac/following{/other_user}", "gists_url": "https://api.github.com/users/is8ac/gists{/gist_id}", "starred_url": "https://api.github.com/users/is8ac/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/is8ac/subscriptions", "organizations_url": "https://api.github.com/users/is8ac/orgs", "repos_url": "https://api.github.com/users/is8ac/repos", "events_url": "https://api.github.com/users/is8ac/events{/privacy}", "received_events_url": "https://api.github.com/users/is8ac/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2017-11-26T23:18:56Z", "updated_at": "2017-12-02T09:39:46Z", "closed_at": "2017-12-02T09:39:46Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: Yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Arch Linux</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: Binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.4.0</li>\n<li><strong>Python version</strong>: NA, using go bindings</li>\n<li><strong>Bazel version (if compiling from source)</strong>:</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>:</li>\n<li><strong>CUDA/cuDNN version</strong>:</li>\n<li><strong>GPU model and memory</strong>: NA, using CPU</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>When using <code>op.FIFOQueueV2()</code> from the go bindings and passing it only scalar shapes in <code>op.FIFOQueueV2Shapes</code>, the OP works as expected. However when using multi dimensional shapes, it panics with <code>panic: runtime error: cgo argument has Go pointer to Go pointer</code>.</p>\n<h3>Source code / logs</h3>\n<p>For a working example with scalar shapes, replace the <code>dataShapes</code> and <code>data</code> lines with the commented versions below them.</p>\n<pre><code>package main\n\nimport (\n\t\"fmt\"\n\n\ttf \"github.com/tensorflow/tensorflow/tensorflow/go\"\n\t\"github.com/tensorflow/tensorflow/tensorflow/go/op\"\n)\n\nfunc main() {\n\ts := op.NewScope()\n\tdataType := []tf.DataType{tf.Int32}\n\n\tdataShapes := []tf.Shape{tf.MakeShape(2)} // Panics\n\t//dataShapes := []tf.Shape{tf.ScalarShape()} // Works\n\n\tdata := op.Const(s, []int32{3, 4}) // Panics\n\t//data := op.Const(s, int32(3)) // Works\n\n\tqueue := op.FIFOQueueV2(s, dataType, op.FIFOQueueV2Shapes(dataShapes))\n\tenqueue := op.QueueEnqueueV2(s, queue, []tf.Output{data})\n\tcomponents := op.QueueDequeueV2(s, queue, dataType)\n\tgraph, err := s.Finalize()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tsess, err := tf.NewSession(graph, nil)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\t_, err = sess.Run(nil, nil, []*tf.Operation{enqueue})\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tresults, err := sess.Run(nil, components, nil)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tfmt.Println(results[0].Value())\n}\n</code></pre>\n<pre><code>[isaac@d6-arch tfes]$ go run queue_shape_error.go \n2017-11-26 14:51:13.523481: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\npanic: runtime error: cgo argument has Go pointer to Go pointer\n\ngoroutine 1 [running]:\ngithub.com/tensorflow/tensorflow/tensorflow/go.setAttr.func21(0xc42000e040, 0x1, 0x1, 0xe4a9c0, 0xc714a0, 0xc42000e040, 0xc42001614c, 0x1)\n\t/home/isaac/go/src/github.com/tensorflow/tensorflow/tensorflow/go/graph.go:308 +0x100\ngithub.com/tensorflow/tensorflow/tensorflow/go.setAttr(0xe4a9c0, 0xc42000e038, 0x4dc10a, 0x6, 0x4b6e00, 0xc42000c100, 0x0, 0x0)\n\t/home/isaac/go/src/github.com/tensorflow/tensorflow/tensorflow/go/graph.go:309 +0x9b0\ngithub.com/tensorflow/tensorflow/tensorflow/go.(*Graph).AddOperation(0xc42000e028, 0x4dcaa4, 0xb, 0x4dcaa4, 0xb, 0x0, 0x0, 0x0, 0xc42007c1e0, 0xc42008e1b8, ...)\n\t/home/isaac/go/src/github.com/tensorflow/tensorflow/tensorflow/go/graph.go:176 +0x4a0\ngithub.com/tensorflow/tensorflow/tensorflow/go/op.(*Scope).AddOperation(0xc42007c180, 0x4dcaa4, 0xb, 0x4dcaa4, 0xb, 0x0, 0x0, 0x0, 0xc42007c1e0, 0x7f05e202e000)\n\t/home/isaac/go/src/github.com/tensorflow/tensorflow/tensorflow/go/op/scope.go:83 +0xa0\ngithub.com/tensorflow/tensorflow/tensorflow/go/op.FIFOQueueV2(0xc42007c180, 0xc4200160e8, 0x1, 0x1, 0xc420057f40, 0x1, 0x1, 0x0, 0x7f05e20322f8)\n\t/home/isaac/go/src/github.com/tensorflow/tensorflow/tensorflow/go/op/wrappers.go:5136 +0x1ea\nmain.main()\n\t/home/isaac/go/src/github.com/is8ac/tfes/queue_shape_error.go:20 +0x238\nexit status 2\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Arch Linux\nTensorFlow installed from (source or binary): Binary\nTensorFlow version (use command below): 1.4.0\nPython version: NA, using go bindings\nBazel version (if compiling from source):\nGCC/Compiler version (if compiling from source):\nCUDA/cuDNN version:\nGPU model and memory: NA, using CPU\nExact command to reproduce:\n\nDescribe the problem\nWhen using op.FIFOQueueV2() from the go bindings and passing it only scalar shapes in op.FIFOQueueV2Shapes, the OP works as expected. However when using multi dimensional shapes, it panics with panic: runtime error: cgo argument has Go pointer to Go pointer.\nSource code / logs\nFor a working example with scalar shapes, replace the dataShapes and data lines with the commented versions below them.\npackage main\n\nimport (\n\t\"fmt\"\n\n\ttf \"github.com/tensorflow/tensorflow/tensorflow/go\"\n\t\"github.com/tensorflow/tensorflow/tensorflow/go/op\"\n)\n\nfunc main() {\n\ts := op.NewScope()\n\tdataType := []tf.DataType{tf.Int32}\n\n\tdataShapes := []tf.Shape{tf.MakeShape(2)} // Panics\n\t//dataShapes := []tf.Shape{tf.ScalarShape()} // Works\n\n\tdata := op.Const(s, []int32{3, 4}) // Panics\n\t//data := op.Const(s, int32(3)) // Works\n\n\tqueue := op.FIFOQueueV2(s, dataType, op.FIFOQueueV2Shapes(dataShapes))\n\tenqueue := op.QueueEnqueueV2(s, queue, []tf.Output{data})\n\tcomponents := op.QueueDequeueV2(s, queue, dataType)\n\tgraph, err := s.Finalize()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tsess, err := tf.NewSession(graph, nil)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\t_, err = sess.Run(nil, nil, []*tf.Operation{enqueue})\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tresults, err := sess.Run(nil, components, nil)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tfmt.Println(results[0].Value())\n}\n\n[isaac@d6-arch tfes]$ go run queue_shape_error.go \n2017-11-26 14:51:13.523481: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\npanic: runtime error: cgo argument has Go pointer to Go pointer\n\ngoroutine 1 [running]:\ngithub.com/tensorflow/tensorflow/tensorflow/go.setAttr.func21(0xc42000e040, 0x1, 0x1, 0xe4a9c0, 0xc714a0, 0xc42000e040, 0xc42001614c, 0x1)\n\t/home/isaac/go/src/github.com/tensorflow/tensorflow/tensorflow/go/graph.go:308 +0x100\ngithub.com/tensorflow/tensorflow/tensorflow/go.setAttr(0xe4a9c0, 0xc42000e038, 0x4dc10a, 0x6, 0x4b6e00, 0xc42000c100, 0x0, 0x0)\n\t/home/isaac/go/src/github.com/tensorflow/tensorflow/tensorflow/go/graph.go:309 +0x9b0\ngithub.com/tensorflow/tensorflow/tensorflow/go.(*Graph).AddOperation(0xc42000e028, 0x4dcaa4, 0xb, 0x4dcaa4, 0xb, 0x0, 0x0, 0x0, 0xc42007c1e0, 0xc42008e1b8, ...)\n\t/home/isaac/go/src/github.com/tensorflow/tensorflow/tensorflow/go/graph.go:176 +0x4a0\ngithub.com/tensorflow/tensorflow/tensorflow/go/op.(*Scope).AddOperation(0xc42007c180, 0x4dcaa4, 0xb, 0x4dcaa4, 0xb, 0x0, 0x0, 0x0, 0xc42007c1e0, 0x7f05e202e000)\n\t/home/isaac/go/src/github.com/tensorflow/tensorflow/tensorflow/go/op/scope.go:83 +0xa0\ngithub.com/tensorflow/tensorflow/tensorflow/go/op.FIFOQueueV2(0xc42007c180, 0xc4200160e8, 0x1, 0x1, 0xc420057f40, 0x1, 0x1, 0x0, 0x7f05e20322f8)\n\t/home/isaac/go/src/github.com/tensorflow/tensorflow/tensorflow/go/op/wrappers.go:5136 +0x1ea\nmain.main()\n\t/home/isaac/go/src/github.com/is8ac/tfes/queue_shape_error.go:20 +0x238\nexit status 2", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: Yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Arch Linux\r\n- **TensorFlow installed from (source or binary)**: Binary\r\n- **TensorFlow version (use command below)**: 1.4.0\r\n- **Python version**: NA, using go bindings\r\n- **Bazel version (if compiling from source)**:\r\n- **GCC/Compiler version (if compiling from source)**:\r\n- **CUDA/cuDNN version**:\r\n- **GPU model and memory**: NA, using CPU\r\n- **Exact command to reproduce**:\r\n\r\n### Describe the problem\r\nWhen using `op.FIFOQueueV2()` from the go bindings and passing it only scalar shapes in `op.FIFOQueueV2Shapes`, the OP works as expected. However when using multi dimensional shapes, it panics with `panic: runtime error: cgo argument has Go pointer to Go pointer`.\r\n\r\n### Source code / logs\r\nFor a working example with scalar shapes, replace the `dataShapes` and `data` lines with the commented versions below them.\r\n```\r\npackage main\r\n\r\nimport (\r\n\t\"fmt\"\r\n\r\n\ttf \"github.com/tensorflow/tensorflow/tensorflow/go\"\r\n\t\"github.com/tensorflow/tensorflow/tensorflow/go/op\"\r\n)\r\n\r\nfunc main() {\r\n\ts := op.NewScope()\r\n\tdataType := []tf.DataType{tf.Int32}\r\n\r\n\tdataShapes := []tf.Shape{tf.MakeShape(2)} // Panics\r\n\t//dataShapes := []tf.Shape{tf.ScalarShape()} // Works\r\n\r\n\tdata := op.Const(s, []int32{3, 4}) // Panics\r\n\t//data := op.Const(s, int32(3)) // Works\r\n\r\n\tqueue := op.FIFOQueueV2(s, dataType, op.FIFOQueueV2Shapes(dataShapes))\r\n\tenqueue := op.QueueEnqueueV2(s, queue, []tf.Output{data})\r\n\tcomponents := op.QueueDequeueV2(s, queue, dataType)\r\n\tgraph, err := s.Finalize()\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\tsess, err := tf.NewSession(graph, nil)\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\t_, err = sess.Run(nil, nil, []*tf.Operation{enqueue})\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\tresults, err := sess.Run(nil, components, nil)\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\tfmt.Println(results[0].Value())\r\n}\r\n```\r\n```\r\n[isaac@d6-arch tfes]$ go run queue_shape_error.go \r\n2017-11-26 14:51:13.523481: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\r\npanic: runtime error: cgo argument has Go pointer to Go pointer\r\n\r\ngoroutine 1 [running]:\r\ngithub.com/tensorflow/tensorflow/tensorflow/go.setAttr.func21(0xc42000e040, 0x1, 0x1, 0xe4a9c0, 0xc714a0, 0xc42000e040, 0xc42001614c, 0x1)\r\n\t/home/isaac/go/src/github.com/tensorflow/tensorflow/tensorflow/go/graph.go:308 +0x100\r\ngithub.com/tensorflow/tensorflow/tensorflow/go.setAttr(0xe4a9c0, 0xc42000e038, 0x4dc10a, 0x6, 0x4b6e00, 0xc42000c100, 0x0, 0x0)\r\n\t/home/isaac/go/src/github.com/tensorflow/tensorflow/tensorflow/go/graph.go:309 +0x9b0\r\ngithub.com/tensorflow/tensorflow/tensorflow/go.(*Graph).AddOperation(0xc42000e028, 0x4dcaa4, 0xb, 0x4dcaa4, 0xb, 0x0, 0x0, 0x0, 0xc42007c1e0, 0xc42008e1b8, ...)\r\n\t/home/isaac/go/src/github.com/tensorflow/tensorflow/tensorflow/go/graph.go:176 +0x4a0\r\ngithub.com/tensorflow/tensorflow/tensorflow/go/op.(*Scope).AddOperation(0xc42007c180, 0x4dcaa4, 0xb, 0x4dcaa4, 0xb, 0x0, 0x0, 0x0, 0xc42007c1e0, 0x7f05e202e000)\r\n\t/home/isaac/go/src/github.com/tensorflow/tensorflow/tensorflow/go/op/scope.go:83 +0xa0\r\ngithub.com/tensorflow/tensorflow/tensorflow/go/op.FIFOQueueV2(0xc42007c180, 0xc4200160e8, 0x1, 0x1, 0xc420057f40, 0x1, 0x1, 0x0, 0x7f05e20322f8)\r\n\t/home/isaac/go/src/github.com/tensorflow/tensorflow/tensorflow/go/op/wrappers.go:5136 +0x1ea\r\nmain.main()\r\n\t/home/isaac/go/src/github.com/is8ac/tfes/queue_shape_error.go:20 +0x238\r\nexit status 2\r\n```"}