{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22396", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22396/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22396/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22396/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/22396", "id": 361954749, "node_id": "MDU6SXNzdWUzNjE5NTQ3NDk=", "number": 22396, "title": "[Feature Request]:Assign the name to SaprseTensor when build_tensor_info of it", "user": {"login": "haotianteng", "id": 11155295, "node_id": "MDQ6VXNlcjExMTU1Mjk1", "avatar_url": "https://avatars3.githubusercontent.com/u/11155295?v=4", "gravatar_id": "", "url": "https://api.github.com/users/haotianteng", "html_url": "https://github.com/haotianteng", "followers_url": "https://api.github.com/users/haotianteng/followers", "following_url": "https://api.github.com/users/haotianteng/following{/other_user}", "gists_url": "https://api.github.com/users/haotianteng/gists{/gist_id}", "starred_url": "https://api.github.com/users/haotianteng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/haotianteng/subscriptions", "organizations_url": "https://api.github.com/users/haotianteng/orgs", "repos_url": "https://api.github.com/users/haotianteng/repos", "events_url": "https://api.github.com/users/haotianteng/events{/privacy}", "received_events_url": "https://api.github.com/users/haotianteng/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": {"login": "karmel", "id": 667809, "node_id": "MDQ6VXNlcjY2NzgwOQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/667809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/karmel", "html_url": "https://github.com/karmel", "followers_url": "https://api.github.com/users/karmel/followers", "following_url": "https://api.github.com/users/karmel/following{/other_user}", "gists_url": "https://api.github.com/users/karmel/gists{/gist_id}", "starred_url": "https://api.github.com/users/karmel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/karmel/subscriptions", "organizations_url": "https://api.github.com/users/karmel/orgs", "repos_url": "https://api.github.com/users/karmel/repos", "events_url": "https://api.github.com/users/karmel/events{/privacy}", "received_events_url": "https://api.github.com/users/karmel/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "karmel", "id": 667809, "node_id": "MDQ6VXNlcjY2NzgwOQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/667809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/karmel", "html_url": "https://github.com/karmel", "followers_url": "https://api.github.com/users/karmel/followers", "following_url": "https://api.github.com/users/karmel/following{/other_user}", "gists_url": "https://api.github.com/users/karmel/gists{/gist_id}", "starred_url": "https://api.github.com/users/karmel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/karmel/subscriptions", "organizations_url": "https://api.github.com/users/karmel/orgs", "repos_url": "https://api.github.com/users/karmel/repos", "events_url": "https://api.github.com/users/karmel/events{/privacy}", "received_events_url": "https://api.github.com/users/karmel/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2018-09-19T22:42:23Z", "updated_at": "2018-11-09T18:53:44Z", "closed_at": null, "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Linux Ubuntu 16.04</li>\n<li><strong>Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device</strong>: N.A.</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: source</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.10.1</li>\n<li><strong>Python version</strong>: 3.6</li>\n<li><strong>Bazel version (if compiling from source)</strong>: 0.16.1</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: gcc version 5.4.0 20160609</li>\n<li><strong>CUDA/cuDNN version</strong>: 9.0/7.0</li>\n<li><strong>GPU model and memory</strong>: Tesla P100 16GB</li>\n<li><strong>Exact command to reproduce</strong>:<br>\nA minimum reproduce example:</li>\n</ul>\n<pre><code>a = tf.constant([[[1.0]]])\nb = tf.constant([1])\noutput,prob = tf.nn.ctc_beam_search_decoder(a,b)\na_tensor_proto = tf.saved_model.utils.build_tensor_info(a)\noutput_tensor_proto = tf.saved_model.utils.build_tensor_info(output[0]) \n</code></pre>\n<h3>Describe the problem</h3>\n<p>A normal Tensor has a name:</p>\n<pre><code>a_tensor_proto\nname: \"Const_15:0\"\ndtype: DT_FLOAT\ntensor_shape {\n  dim {\n    size: 1\n  }\n  dim {\n    size: 1\n  }\n  dim {\n    size: 1\n  }\n}\n\n</code></pre>\n<p>while the SparseTensor from the ctc Beam_Search_Decoder does not has a name:</p>\n<pre><code>output_tensor_proto\ndtype: DT_INT64\ntensor_shape {\n  dim {\n    size: -1\n  }\n  dim {\n    size: -1\n  }\n}\ncoo_sparse {\n  values_tensor_name: \"CTCBeamSearchDecoder_12:1\"\n  indices_tensor_name: \"CTCBeamSearchDecoder_12:0\"\n  dense_shape_tensor_name: \"CTCBeamSearchDecoder_12:2\"\n}\n</code></pre>\n<p>Which cause the error when predict:</p>\n<pre><code>import tensorflow as tf\nfrom tensorflow.contrib import predictor\nfrom tensorflow.contrib.saved_model.python.saved_model import reader\nfrom tensorflow.contrib.saved_model.python.saved_model import signature_def_utils\nfrom tensorflow.python.tools import saved_model_utils\n\nexp_dir = MY_EXPORT_DIRECTORY\nmetagraph_def = saved_model_utils.get_meta_graph_def(exp_dir,'serve')\nsignature_def = signature_def_utils.get_signature_def_by_key(\n        metagraph_def,\n        'predicted_sequences')\noutput_names = {k: v.name for k, v in signature_def.outputs.items()}\nprint(output_names)\npredict_fn = predictor.from_saved_model(exp_dir)\nseq_len = np.asarray([[4]])\ncombined_input = np.concatenate((batch_x,seq_len),axis = 1)\npredictions = predict_fn({'inputs':combined_input})\n</code></pre>\n<p>ValueError: The name '' looks like an (invalid) Operation name, not a Tensor. Tensor names must be of the form \"&lt;op_name&gt;:&lt;output_index&gt;\".<br>\nand  also the above error, when export it into a saved_model and request it.</p>\n<p>The reason is when building a TensorProto for the SaprseTensor, no name is assigned to it:<br>\n<a href=\"https://github.com/tensorflow/tensorflow/blob/r1.10/tensorflow/python/saved_model/utils_impl.py#L46\">https://github.com/tensorflow/tensorflow/blob/r1.10/tensorflow/python/saved_model/utils_impl.py#L46</a></p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 16.04\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: N.A.\nTensorFlow installed from (source or binary): source\nTensorFlow version (use command below): 1.10.1\nPython version: 3.6\nBazel version (if compiling from source): 0.16.1\nGCC/Compiler version (if compiling from source): gcc version 5.4.0 20160609\nCUDA/cuDNN version: 9.0/7.0\nGPU model and memory: Tesla P100 16GB\nExact command to reproduce:\nA minimum reproduce example:\n\na = tf.constant([[[1.0]]])\nb = tf.constant([1])\noutput,prob = tf.nn.ctc_beam_search_decoder(a,b)\na_tensor_proto = tf.saved_model.utils.build_tensor_info(a)\noutput_tensor_proto = tf.saved_model.utils.build_tensor_info(output[0]) \n\nDescribe the problem\nA normal Tensor has a name:\na_tensor_proto\nname: \"Const_15:0\"\ndtype: DT_FLOAT\ntensor_shape {\n  dim {\n    size: 1\n  }\n  dim {\n    size: 1\n  }\n  dim {\n    size: 1\n  }\n}\n\n\nwhile the SparseTensor from the ctc Beam_Search_Decoder does not has a name:\noutput_tensor_proto\ndtype: DT_INT64\ntensor_shape {\n  dim {\n    size: -1\n  }\n  dim {\n    size: -1\n  }\n}\ncoo_sparse {\n  values_tensor_name: \"CTCBeamSearchDecoder_12:1\"\n  indices_tensor_name: \"CTCBeamSearchDecoder_12:0\"\n  dense_shape_tensor_name: \"CTCBeamSearchDecoder_12:2\"\n}\n\nWhich cause the error when predict:\nimport tensorflow as tf\nfrom tensorflow.contrib import predictor\nfrom tensorflow.contrib.saved_model.python.saved_model import reader\nfrom tensorflow.contrib.saved_model.python.saved_model import signature_def_utils\nfrom tensorflow.python.tools import saved_model_utils\n\nexp_dir = MY_EXPORT_DIRECTORY\nmetagraph_def = saved_model_utils.get_meta_graph_def(exp_dir,'serve')\nsignature_def = signature_def_utils.get_signature_def_by_key(\n        metagraph_def,\n        'predicted_sequences')\noutput_names = {k: v.name for k, v in signature_def.outputs.items()}\nprint(output_names)\npredict_fn = predictor.from_saved_model(exp_dir)\nseq_len = np.asarray([[4]])\ncombined_input = np.concatenate((batch_x,seq_len),axis = 1)\npredictions = predict_fn({'inputs':combined_input})\n\nValueError: The name '' looks like an (invalid) Operation name, not a Tensor. Tensor names must be of the form \"<op_name>:<output_index>\".\nand  also the above error, when export it into a saved_model and request it.\nThe reason is when building a TensorProto for the SaprseTensor, no name is assigned to it:\nhttps://github.com/tensorflow/tensorflow/blob/r1.10/tensorflow/python/saved_model/utils_impl.py#L46", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Ubuntu 16.04\r\n- **Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device**: N.A.\r\n- **TensorFlow installed from (source or binary)**: source\r\n- **TensorFlow version (use command below)**: 1.10.1\r\n- **Python version**: 3.6\r\n- **Bazel version (if compiling from source)**: 0.16.1\r\n- **GCC/Compiler version (if compiling from source)**: gcc version 5.4.0 20160609\r\n- **CUDA/cuDNN version**: 9.0/7.0\r\n- **GPU model and memory**: Tesla P100 16GB\r\n- **Exact command to reproduce**:\r\nA minimum reproduce example:\r\n```\r\na = tf.constant([[[1.0]]])\r\nb = tf.constant([1])\r\noutput,prob = tf.nn.ctc_beam_search_decoder(a,b)\r\na_tensor_proto = tf.saved_model.utils.build_tensor_info(a)\r\noutput_tensor_proto = tf.saved_model.utils.build_tensor_info(output[0]) \r\n```\r\n### Describe the problem\r\nA normal Tensor has a name:\r\n```\r\na_tensor_proto\r\nname: \"Const_15:0\"\r\ndtype: DT_FLOAT\r\ntensor_shape {\r\n  dim {\r\n    size: 1\r\n  }\r\n  dim {\r\n    size: 1\r\n  }\r\n  dim {\r\n    size: 1\r\n  }\r\n}\r\n\r\n```\r\nwhile the SparseTensor from the ctc Beam_Search_Decoder does not has a name:\r\n```\r\noutput_tensor_proto\r\ndtype: DT_INT64\r\ntensor_shape {\r\n  dim {\r\n    size: -1\r\n  }\r\n  dim {\r\n    size: -1\r\n  }\r\n}\r\ncoo_sparse {\r\n  values_tensor_name: \"CTCBeamSearchDecoder_12:1\"\r\n  indices_tensor_name: \"CTCBeamSearchDecoder_12:0\"\r\n  dense_shape_tensor_name: \"CTCBeamSearchDecoder_12:2\"\r\n}\r\n```\r\nWhich cause the error when predict:\r\n\r\n```\r\nimport tensorflow as tf\r\nfrom tensorflow.contrib import predictor\r\nfrom tensorflow.contrib.saved_model.python.saved_model import reader\r\nfrom tensorflow.contrib.saved_model.python.saved_model import signature_def_utils\r\nfrom tensorflow.python.tools import saved_model_utils\r\n\r\nexp_dir = MY_EXPORT_DIRECTORY\r\nmetagraph_def = saved_model_utils.get_meta_graph_def(exp_dir,'serve')\r\nsignature_def = signature_def_utils.get_signature_def_by_key(\r\n        metagraph_def,\r\n        'predicted_sequences')\r\noutput_names = {k: v.name for k, v in signature_def.outputs.items()}\r\nprint(output_names)\r\npredict_fn = predictor.from_saved_model(exp_dir)\r\nseq_len = np.asarray([[4]])\r\ncombined_input = np.concatenate((batch_x,seq_len),axis = 1)\r\npredictions = predict_fn({'inputs':combined_input})\r\n```\r\nValueError: The name '' looks like an (invalid) Operation name, not a Tensor. Tensor names must be of the form \"<op_name>:<output_index>\".\r\nand  also the above error, when export it into a saved_model and request it.\r\n\r\nThe reason is when building a TensorProto for the SaprseTensor, no name is assigned to it:\r\nhttps://github.com/tensorflow/tensorflow/blob/r1.10/tensorflow/python/saved_model/utils_impl.py#L46\r\n\r\n"}