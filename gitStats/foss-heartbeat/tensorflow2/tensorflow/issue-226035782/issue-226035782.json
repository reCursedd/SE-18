{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9634", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9634/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9634/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9634/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/9634", "id": 226035782, "node_id": "MDU6SXNzdWUyMjYwMzU3ODI=", "number": 9634, "title": "cuda_configure.bzl makes bad symlink for: cuda/include/cudnn.h --> cuda/include/include/cudnn.h", "user": {"login": "momeara", "id": 129072, "node_id": "MDQ6VXNlcjEyOTA3Mg==", "avatar_url": "https://avatars0.githubusercontent.com/u/129072?v=4", "gravatar_id": "", "url": "https://api.github.com/users/momeara", "html_url": "https://github.com/momeara", "followers_url": "https://api.github.com/users/momeara/followers", "following_url": "https://api.github.com/users/momeara/following{/other_user}", "gists_url": "https://api.github.com/users/momeara/gists{/gist_id}", "starred_url": "https://api.github.com/users/momeara/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/momeara/subscriptions", "organizations_url": "https://api.github.com/users/momeara/orgs", "repos_url": "https://api.github.com/users/momeara/repos", "events_url": "https://api.github.com/users/momeara/events{/privacy}", "received_events_url": "https://api.github.com/users/momeara/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473173351, "node_id": "MDU6TGFiZWw0NzMxNzMzNTE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:build/install", "name": "type:build/install", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "jart", "id": 49262, "node_id": "MDQ6VXNlcjQ5MjYy", "avatar_url": "https://avatars1.githubusercontent.com/u/49262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jart", "html_url": "https://github.com/jart", "followers_url": "https://api.github.com/users/jart/followers", "following_url": "https://api.github.com/users/jart/following{/other_user}", "gists_url": "https://api.github.com/users/jart/gists{/gist_id}", "starred_url": "https://api.github.com/users/jart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jart/subscriptions", "organizations_url": "https://api.github.com/users/jart/orgs", "repos_url": "https://api.github.com/users/jart/repos", "events_url": "https://api.github.com/users/jart/events{/privacy}", "received_events_url": "https://api.github.com/users/jart/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jart", "id": 49262, "node_id": "MDQ6VXNlcjQ5MjYy", "avatar_url": "https://avatars1.githubusercontent.com/u/49262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jart", "html_url": "https://github.com/jart", "followers_url": "https://api.github.com/users/jart/followers", "following_url": "https://api.github.com/users/jart/following{/other_user}", "gists_url": "https://api.github.com/users/jart/gists{/gist_id}", "starred_url": "https://api.github.com/users/jart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jart/subscriptions", "organizations_url": "https://api.github.com/users/jart/orgs", "repos_url": "https://api.github.com/users/jart/repos", "events_url": "https://api.github.com/users/jart/events{/privacy}", "received_events_url": "https://api.github.com/users/jart/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 13, "created_at": "2017-05-03T16:02:11Z", "updated_at": "2017-12-22T21:28:09Z", "closed_at": "2017-12-22T21:28:09Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: NO</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: CentOS release 6.7 (Final) x86_64</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>:  source</li>\n<li><strong>TensorFlow version (use command below)</strong>: master: git version <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/550df413158b32645ca5df4dcaabc67f1a48964d/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/550df413158b32645ca5df4dcaabc67f1a48964d\"><tt>550df41</tt></a> (checked out May 3rd 2017)</li>\n<li><strong>Bazel version (if compiling from source)</strong>: bazel-0.4.5</li>\n<li><strong>CUDA/cuDNN version</strong>: 7.5/5.1.3</li>\n<li><strong>GPU model and memory</strong>: Quadro K600 1GB DDR3</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<pre><code>setenv CC '/mnt/nfs/home/momeara/opt/bin/gcc'\nsetenv CXX '/mnt/nfs/home/momeara/opt/bin/g++'\nsetenv EXTRA_BAZEL_ARGS '--verbose_failures --jobs=1'\nsetenv CPLUS_INCLUDE_PATH '/mnt/nfs/home/momeara/opt/include'\nsetenv C_INCLUDE_PATH '/mnt/nfs/home/momeara/opt/include'\nsetenv LIBRARY_PATH '/mnt/nfs/home/momeara/opt/lib:/mnt/nfs/home/momeara/opt/lib64'\nsetenv LD_LIBRARY_PATH /mnt/nfs/work/momeara/sea/DeepSEA/cuda/lib64:/usr/local/cuda-7.5/lib64:/mnt/nfs/home/momeara/opt/lib:/mnt/nfs/home/momeara/opt/lib64:/usr/local/cuda-7.5/extras/CUPTI/lib64:$LD_LIBR\\\nARY_PATH\nsetenv PATH /usr/local/cuda-7.5/bin:/mnt/nfs/work/momeara/sea/DeepSEA/tensorflow/bazel-0.4.5/output:$PATH\n\n./configure\nPlease specify the location of python. [Default is /mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/bin/python]:\nFound possible Python library paths:\n  /mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/lib/python2.7/site-packages\nPlease input the desired Python library path to use.  Default is [/mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/lib/python2.7/site-packages]\n\nUsing python library path: /mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/lib/python2.7/site-packages\nPlease specify optimization flags to use during compilation when bazel option \"--config=opt\" is specified [Default is -march=native]:\nDo you wish to use jemalloc as the malloc implementation? [Y/n] n\njemalloc disabled\nDo you wish to build TensorFlow with Google Cloud Platform support? [y/N] n\nNo Google Cloud Platform support will be enabled for TensorFlow\nDo you wish to build TensorFlow with Hadoop File System support? [y/N] n\nNo Hadoop File System support will be enabled for TensorFlow\nDo you wish to build TensorFlow with the XLA just-in-time compiler (experimental)? [y/N] y\nXLA JIT support will be enabled for TensorFlow\nDo you wish to build TensorFlow with VERBS support? [y/N] y\nVERBS support will be enabled for TensorFlow\nDo you wish to build TensorFlow with OpenCL support? [y/N] n\nNo OpenCL support will be enabled for TensorFlow\nDo you wish to build TensorFlow with CUDA support? [y/N] y\nCUDA support will be enabled for TensorFlow\nDo you want to use clang as CUDA compiler? [y/N] n\nnvcc will be used as CUDA compiler\nPlease specify the CUDA SDK version you want to use, e.g. 7.0. [Leave empty to use system default]: 7.5\nPlease specify the location where CUDA 7.5 toolkit is installed. Refer to README.md for more details. [Default is /usr/local/cuda]:\nPlease specify which gcc should be used by nvcc as the host compiler. [Default is /mnt/nfs/home/momeara/opt/bin/gcc]:\nPlease specify the cuDNN version you want to use. [Leave empty to use system default]: 5.1.3\nPlease specify the location where cuDNN 5.1.3 library is installed. Refer to README.md for more details. [Default is /usr/local/cuda]: /mnt/nfs/work/momeara/sea/DeepSEA/cuda\nPlease specify a list of comma-separated Cuda compute capabilities you want to build with.\nYou can find the compute capability of your device at: https://developer.nvidia.com/cuda-gpus.\nPlease note that each additional compute capability significantly increases your build time and binary size.\n[Default is: \"3.5,5.2\"]: 5.2\nWARNING: Output base '/mnt/nfs/home/momeara/.cache/bazel/_bazel_momeara/ef8339021629a8146b3e301bb7dc3099' is on NFS. This may lead to surprising failures and undetermined behavior.\n................................................................................\n____Starting clean (this may take a while). Consider using --async if the clean takes more than several minutes.\nConfiguration finished\n\nbazel --output_user_root=/scratch/momeara/.cache/baze build -c opt --config=cuda //tensorflow/tools/pip_package:build_pip_package --verbose_failures --jobs=1\n</code></pre>\n<h3>Describe the problem</h3>\n<p>During configure, it tries to make a symlink</p>\n<pre><code>ln -s /mnt/nfs/work/momeara/sea/DeepSEA/cuda/include/cudnn.h /scratch/momeara/.cache/baze/ef8339021629a8146b3e301bb7dc3099/execroot/tensorflow/bazel-out/host/genfiles/external/local_config_cuda/cuda/include/include/cudnn.h\n</code></pre>\n<p>but this fails because the directory <code>/scratch/momeara/.cache/baze/ef8339021629a8146b3e301bb7dc3099/execroot/tensorflow/bazel-out/host/genfiles/external/local_config_cuda/cuda/include/include</code> does not exist</p>\n<p>notice that it has <code>include/include</code> at the end.</p>\n<p>If I change this line: <a href=\"https://github.com/tensorflow/tensorflow/blob/master/third_party/gpus/cuda_configure.bzl#L877\">https://github.com/tensorflow/tensorflow/blob/master/third_party/gpus/cuda_configure.bzl#L877</a></p>\n<pre><code>genrules.append(_symlink_genrule_for_dir(repository_ctx, None, \"\",\n        \"cudnn-include\", [cudnn_header_dir + \"/cudnn.h\"], [\"include/cudnn.h\"]))\n</code></pre>\n<p>to</p>\n<pre><code>genrules.append(_symlink_genrule_for_dir(repository_ctx, None, \"\",\n        \"cudnn-include\", [cudnn_header_dir + \"/cudnn.h\"], [\"cudnn.h\"]))\n</code></pre>\n<p>the build proceeds without error</p>\n<h3>Source code / logs</h3>\n<p>____[107 / 393] Writing script external/local_config_cuda/cuda/cuda-include.genrule_script.sh [for host]<br>\nERROR: /scratch/momeara/.cache/baze/ef8339021629a8146b3e301bb7dc3099/external/local_config_cuda/cuda/BUILD:1309:1: Executing genrule @local_config_cuda//cuda:cudnn-include failed: bash failed: error exec<br>\nuting command<br>\n(cd /scratch/momeara/.cache/baze/ef8339021629a8146b3e301bb7dc3099/execroot/tensorflow &amp;&amp; <br>\nexec env - <br>\nLD_LIBRARY_PATH=/mnt/nfs/work/momeara/sea/DeepSEA/cuda/lib64:/usr/local/cuda-7.5/lib64:/mnt/nfs/home/momeara/opt/lib:/mnt/nfs/home/momeara/opt/lib64:/usr/local/cuda-7.5/extras/CUPTI/lib64:/mnt/nfs/ho<br>\nme/momeara/opt/lib:/mnt/nfs/home/momeara/opt/lib64 <br>\nPATH=/usr/local/cuda-7.5/bin:/mnt/nfs/work/momeara/sea/DeepSEA/tensorflow/tensorflow/bazel-0.4.5/output:/mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/bin:/mnt/nfs/work/momeara/tools/anaconda2/bin:<br>\n/mnt/nfs/home/momeara/.local/bin:/mnt/nfs/home/momeara/opt/node-v4.5.0-linux-x64/bin:/mnt/nfs/home/momeara/opt/bin:/mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/bin:/mnt/nfs/work/momeara/tools/anacond<br>\na2/bin:/mnt/nfs/home/momeara/.local/bin:/mnt/nfs/home/momeara/opt/node-v4.5.0-linux-x64/bin:/mnt/nfs/home/momeara/opt/bin:/mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/bin:/mnt/nfs/work/momeara/tools/<br>\nanaconda2/bin:/mnt/nfs/home/momeara/.local/bin:/mnt/nfs/home/momeara/opt/node-v4.5.0-linux-x64/bin:/mnt/nfs/home/momeara/opt/bin:/usr/lib64/qt-3.3/bin:/usr/kerberos/sbin:/usr/kerberos/bin:/usr/local/bin:<br>\n/bin:/usr/bin <br>\n/bin/bash -c 'source external/bazel_tools/tools/genrule/genrule-setup.sh;<br>\nln -s /mnt/nfs/work/momeara/sea/DeepSEA/cuda/include/cudnn.h bazel-out/host/genfiles/external/local_config_cuda/cuda/include/include/cudnn.h    '): com.google.devtools.build.lib.shell.BadExitStatusExcept<br>\nion: Process exited with status 1.<br>\nln: creating symbolic link <code>bazel-out/host/genfiles/external/local_config_cuda/cuda/include/include/cudnn.h': No such file or directory blaze: Leaving directory </code>/scratch/momeara/.cache/baze/ef8339021629a8146b3e301bb7dc3099/execroot/tensorflow/'<br>\n____Building complete.<br>\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build<br>\n____Elapsed time: 75.364s, Critical Path: 3.99s</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): NO\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): CentOS release 6.7 (Final) x86_64\nTensorFlow installed from (source or binary):  source\nTensorFlow version (use command below): master: git version 550df41 (checked out May 3rd 2017)\nBazel version (if compiling from source): bazel-0.4.5\nCUDA/cuDNN version: 7.5/5.1.3\nGPU model and memory: Quadro K600 1GB DDR3\nExact command to reproduce:\n\nsetenv CC '/mnt/nfs/home/momeara/opt/bin/gcc'\nsetenv CXX '/mnt/nfs/home/momeara/opt/bin/g++'\nsetenv EXTRA_BAZEL_ARGS '--verbose_failures --jobs=1'\nsetenv CPLUS_INCLUDE_PATH '/mnt/nfs/home/momeara/opt/include'\nsetenv C_INCLUDE_PATH '/mnt/nfs/home/momeara/opt/include'\nsetenv LIBRARY_PATH '/mnt/nfs/home/momeara/opt/lib:/mnt/nfs/home/momeara/opt/lib64'\nsetenv LD_LIBRARY_PATH /mnt/nfs/work/momeara/sea/DeepSEA/cuda/lib64:/usr/local/cuda-7.5/lib64:/mnt/nfs/home/momeara/opt/lib:/mnt/nfs/home/momeara/opt/lib64:/usr/local/cuda-7.5/extras/CUPTI/lib64:$LD_LIBR\\\nARY_PATH\nsetenv PATH /usr/local/cuda-7.5/bin:/mnt/nfs/work/momeara/sea/DeepSEA/tensorflow/bazel-0.4.5/output:$PATH\n\n./configure\nPlease specify the location of python. [Default is /mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/bin/python]:\nFound possible Python library paths:\n  /mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/lib/python2.7/site-packages\nPlease input the desired Python library path to use.  Default is [/mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/lib/python2.7/site-packages]\n\nUsing python library path: /mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/lib/python2.7/site-packages\nPlease specify optimization flags to use during compilation when bazel option \"--config=opt\" is specified [Default is -march=native]:\nDo you wish to use jemalloc as the malloc implementation? [Y/n] n\njemalloc disabled\nDo you wish to build TensorFlow with Google Cloud Platform support? [y/N] n\nNo Google Cloud Platform support will be enabled for TensorFlow\nDo you wish to build TensorFlow with Hadoop File System support? [y/N] n\nNo Hadoop File System support will be enabled for TensorFlow\nDo you wish to build TensorFlow with the XLA just-in-time compiler (experimental)? [y/N] y\nXLA JIT support will be enabled for TensorFlow\nDo you wish to build TensorFlow with VERBS support? [y/N] y\nVERBS support will be enabled for TensorFlow\nDo you wish to build TensorFlow with OpenCL support? [y/N] n\nNo OpenCL support will be enabled for TensorFlow\nDo you wish to build TensorFlow with CUDA support? [y/N] y\nCUDA support will be enabled for TensorFlow\nDo you want to use clang as CUDA compiler? [y/N] n\nnvcc will be used as CUDA compiler\nPlease specify the CUDA SDK version you want to use, e.g. 7.0. [Leave empty to use system default]: 7.5\nPlease specify the location where CUDA 7.5 toolkit is installed. Refer to README.md for more details. [Default is /usr/local/cuda]:\nPlease specify which gcc should be used by nvcc as the host compiler. [Default is /mnt/nfs/home/momeara/opt/bin/gcc]:\nPlease specify the cuDNN version you want to use. [Leave empty to use system default]: 5.1.3\nPlease specify the location where cuDNN 5.1.3 library is installed. Refer to README.md for more details. [Default is /usr/local/cuda]: /mnt/nfs/work/momeara/sea/DeepSEA/cuda\nPlease specify a list of comma-separated Cuda compute capabilities you want to build with.\nYou can find the compute capability of your device at: https://developer.nvidia.com/cuda-gpus.\nPlease note that each additional compute capability significantly increases your build time and binary size.\n[Default is: \"3.5,5.2\"]: 5.2\nWARNING: Output base '/mnt/nfs/home/momeara/.cache/bazel/_bazel_momeara/ef8339021629a8146b3e301bb7dc3099' is on NFS. This may lead to surprising failures and undetermined behavior.\n................................................................................\n____Starting clean (this may take a while). Consider using --async if the clean takes more than several minutes.\nConfiguration finished\n\nbazel --output_user_root=/scratch/momeara/.cache/baze build -c opt --config=cuda //tensorflow/tools/pip_package:build_pip_package --verbose_failures --jobs=1\n\nDescribe the problem\nDuring configure, it tries to make a symlink\nln -s /mnt/nfs/work/momeara/sea/DeepSEA/cuda/include/cudnn.h /scratch/momeara/.cache/baze/ef8339021629a8146b3e301bb7dc3099/execroot/tensorflow/bazel-out/host/genfiles/external/local_config_cuda/cuda/include/include/cudnn.h\n\nbut this fails because the directory /scratch/momeara/.cache/baze/ef8339021629a8146b3e301bb7dc3099/execroot/tensorflow/bazel-out/host/genfiles/external/local_config_cuda/cuda/include/include does not exist\nnotice that it has include/include at the end.\nIf I change this line: https://github.com/tensorflow/tensorflow/blob/master/third_party/gpus/cuda_configure.bzl#L877\ngenrules.append(_symlink_genrule_for_dir(repository_ctx, None, \"\",\n        \"cudnn-include\", [cudnn_header_dir + \"/cudnn.h\"], [\"include/cudnn.h\"]))\n\nto\ngenrules.append(_symlink_genrule_for_dir(repository_ctx, None, \"\",\n        \"cudnn-include\", [cudnn_header_dir + \"/cudnn.h\"], [\"cudnn.h\"]))\n\nthe build proceeds without error\nSource code / logs\n____[107 / 393] Writing script external/local_config_cuda/cuda/cuda-include.genrule_script.sh [for host]\nERROR: /scratch/momeara/.cache/baze/ef8339021629a8146b3e301bb7dc3099/external/local_config_cuda/cuda/BUILD:1309:1: Executing genrule @local_config_cuda//cuda:cudnn-include failed: bash failed: error exec\nuting command\n(cd /scratch/momeara/.cache/baze/ef8339021629a8146b3e301bb7dc3099/execroot/tensorflow && \nexec env - \nLD_LIBRARY_PATH=/mnt/nfs/work/momeara/sea/DeepSEA/cuda/lib64:/usr/local/cuda-7.5/lib64:/mnt/nfs/home/momeara/opt/lib:/mnt/nfs/home/momeara/opt/lib64:/usr/local/cuda-7.5/extras/CUPTI/lib64:/mnt/nfs/ho\nme/momeara/opt/lib:/mnt/nfs/home/momeara/opt/lib64 \nPATH=/usr/local/cuda-7.5/bin:/mnt/nfs/work/momeara/sea/DeepSEA/tensorflow/tensorflow/bazel-0.4.5/output:/mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/bin:/mnt/nfs/work/momeara/tools/anaconda2/bin:\n/mnt/nfs/home/momeara/.local/bin:/mnt/nfs/home/momeara/opt/node-v4.5.0-linux-x64/bin:/mnt/nfs/home/momeara/opt/bin:/mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/bin:/mnt/nfs/work/momeara/tools/anacond\na2/bin:/mnt/nfs/home/momeara/.local/bin:/mnt/nfs/home/momeara/opt/node-v4.5.0-linux-x64/bin:/mnt/nfs/home/momeara/opt/bin:/mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/bin:/mnt/nfs/work/momeara/tools/\nanaconda2/bin:/mnt/nfs/home/momeara/.local/bin:/mnt/nfs/home/momeara/opt/node-v4.5.0-linux-x64/bin:/mnt/nfs/home/momeara/opt/bin:/usr/lib64/qt-3.3/bin:/usr/kerberos/sbin:/usr/kerberos/bin:/usr/local/bin:\n/bin:/usr/bin \n/bin/bash -c 'source external/bazel_tools/tools/genrule/genrule-setup.sh;\nln -s /mnt/nfs/work/momeara/sea/DeepSEA/cuda/include/cudnn.h bazel-out/host/genfiles/external/local_config_cuda/cuda/include/include/cudnn.h    '): com.google.devtools.build.lib.shell.BadExitStatusExcept\nion: Process exited with status 1.\nln: creating symbolic link bazel-out/host/genfiles/external/local_config_cuda/cuda/include/include/cudnn.h': No such file or directory blaze: Leaving directory /scratch/momeara/.cache/baze/ef8339021629a8146b3e301bb7dc3099/execroot/tensorflow/'\n____Building complete.\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\n____Elapsed time: 75.364s, Critical Path: 3.99s", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: NO\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: CentOS release 6.7 (Final) x86_64\r\n- **TensorFlow installed from (source or binary)**:  source\r\n- **TensorFlow version (use command below)**: master: git version 550df413158b32645ca5df4dcaabc67f1a48964d (checked out May 3rd 2017)\r\n- **Bazel version (if compiling from source)**: bazel-0.4.5\r\n- **CUDA/cuDNN version**: 7.5/5.1.3\r\n- **GPU model and memory**: Quadro K600 1GB DDR3\r\n- **Exact command to reproduce**:\r\n\r\n```\r\nsetenv CC '/mnt/nfs/home/momeara/opt/bin/gcc'\r\nsetenv CXX '/mnt/nfs/home/momeara/opt/bin/g++'\r\nsetenv EXTRA_BAZEL_ARGS '--verbose_failures --jobs=1'\r\nsetenv CPLUS_INCLUDE_PATH '/mnt/nfs/home/momeara/opt/include'\r\nsetenv C_INCLUDE_PATH '/mnt/nfs/home/momeara/opt/include'\r\nsetenv LIBRARY_PATH '/mnt/nfs/home/momeara/opt/lib:/mnt/nfs/home/momeara/opt/lib64'\r\nsetenv LD_LIBRARY_PATH /mnt/nfs/work/momeara/sea/DeepSEA/cuda/lib64:/usr/local/cuda-7.5/lib64:/mnt/nfs/home/momeara/opt/lib:/mnt/nfs/home/momeara/opt/lib64:/usr/local/cuda-7.5/extras/CUPTI/lib64:$LD_LIBR\\\r\nARY_PATH\r\nsetenv PATH /usr/local/cuda-7.5/bin:/mnt/nfs/work/momeara/sea/DeepSEA/tensorflow/bazel-0.4.5/output:$PATH\r\n\r\n./configure\r\nPlease specify the location of python. [Default is /mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/bin/python]:\r\nFound possible Python library paths:\r\n  /mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/lib/python2.7/site-packages\r\nPlease input the desired Python library path to use.  Default is [/mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/lib/python2.7/site-packages]\r\n\r\nUsing python library path: /mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/lib/python2.7/site-packages\r\nPlease specify optimization flags to use during compilation when bazel option \"--config=opt\" is specified [Default is -march=native]:\r\nDo you wish to use jemalloc as the malloc implementation? [Y/n] n\r\njemalloc disabled\r\nDo you wish to build TensorFlow with Google Cloud Platform support? [y/N] n\r\nNo Google Cloud Platform support will be enabled for TensorFlow\r\nDo you wish to build TensorFlow with Hadoop File System support? [y/N] n\r\nNo Hadoop File System support will be enabled for TensorFlow\r\nDo you wish to build TensorFlow with the XLA just-in-time compiler (experimental)? [y/N] y\r\nXLA JIT support will be enabled for TensorFlow\r\nDo you wish to build TensorFlow with VERBS support? [y/N] y\r\nVERBS support will be enabled for TensorFlow\r\nDo you wish to build TensorFlow with OpenCL support? [y/N] n\r\nNo OpenCL support will be enabled for TensorFlow\r\nDo you wish to build TensorFlow with CUDA support? [y/N] y\r\nCUDA support will be enabled for TensorFlow\r\nDo you want to use clang as CUDA compiler? [y/N] n\r\nnvcc will be used as CUDA compiler\r\nPlease specify the CUDA SDK version you want to use, e.g. 7.0. [Leave empty to use system default]: 7.5\r\nPlease specify the location where CUDA 7.5 toolkit is installed. Refer to README.md for more details. [Default is /usr/local/cuda]:\r\nPlease specify which gcc should be used by nvcc as the host compiler. [Default is /mnt/nfs/home/momeara/opt/bin/gcc]:\r\nPlease specify the cuDNN version you want to use. [Leave empty to use system default]: 5.1.3\r\nPlease specify the location where cuDNN 5.1.3 library is installed. Refer to README.md for more details. [Default is /usr/local/cuda]: /mnt/nfs/work/momeara/sea/DeepSEA/cuda\r\nPlease specify a list of comma-separated Cuda compute capabilities you want to build with.\r\nYou can find the compute capability of your device at: https://developer.nvidia.com/cuda-gpus.\r\nPlease note that each additional compute capability significantly increases your build time and binary size.\r\n[Default is: \"3.5,5.2\"]: 5.2\r\nWARNING: Output base '/mnt/nfs/home/momeara/.cache/bazel/_bazel_momeara/ef8339021629a8146b3e301bb7dc3099' is on NFS. This may lead to surprising failures and undetermined behavior.\r\n................................................................................\r\n____Starting clean (this may take a while). Consider using --async if the clean takes more than several minutes.\r\nConfiguration finished\r\n\r\nbazel --output_user_root=/scratch/momeara/.cache/baze build -c opt --config=cuda //tensorflow/tools/pip_package:build_pip_package --verbose_failures --jobs=1\r\n```\r\n\r\n### Describe the problem\r\nDuring configure, it tries to make a symlink\r\n\r\n    ln -s /mnt/nfs/work/momeara/sea/DeepSEA/cuda/include/cudnn.h /scratch/momeara/.cache/baze/ef8339021629a8146b3e301bb7dc3099/execroot/tensorflow/bazel-out/host/genfiles/external/local_config_cuda/cuda/include/include/cudnn.h\r\n\r\nbut this fails because the directory `/scratch/momeara/.cache/baze/ef8339021629a8146b3e301bb7dc3099/execroot/tensorflow/bazel-out/host/genfiles/external/local_config_cuda/cuda/include/include` does not exist\r\n\r\nnotice that it has `include/include` at the end.\r\n\r\nIf I change this line: https://github.com/tensorflow/tensorflow/blob/master/third_party/gpus/cuda_configure.bzl#L877\r\n\r\n    genrules.append(_symlink_genrule_for_dir(repository_ctx, None, \"\",\r\n            \"cudnn-include\", [cudnn_header_dir + \"/cudnn.h\"], [\"include/cudnn.h\"]))\r\n\r\nto \r\n\r\n    genrules.append(_symlink_genrule_for_dir(repository_ctx, None, \"\",\r\n            \"cudnn-include\", [cudnn_header_dir + \"/cudnn.h\"], [\"cudnn.h\"]))\r\n\r\nthe build proceeds without error\r\n\r\n\r\n### Source code / logs\r\n\r\n____[107 / 393] Writing script external/local_config_cuda/cuda/cuda-include.genrule_script.sh [for host]\r\nERROR: /scratch/momeara/.cache/baze/ef8339021629a8146b3e301bb7dc3099/external/local_config_cuda/cuda/BUILD:1309:1: Executing genrule @local_config_cuda//cuda:cudnn-include failed: bash failed: error exec\\\r\nuting command\r\n  (cd /scratch/momeara/.cache/baze/ef8339021629a8146b3e301bb7dc3099/execroot/tensorflow && \\\r\n  exec env - \\\r\n    LD_LIBRARY_PATH=/mnt/nfs/work/momeara/sea/DeepSEA/cuda/lib64:/usr/local/cuda-7.5/lib64:/mnt/nfs/home/momeara/opt/lib:/mnt/nfs/home/momeara/opt/lib64:/usr/local/cuda-7.5/extras/CUPTI/lib64:/mnt/nfs/ho\\\r\nme/momeara/opt/lib:/mnt/nfs/home/momeara/opt/lib64 \\\r\n    PATH=/usr/local/cuda-7.5/bin:/mnt/nfs/work/momeara/sea/DeepSEA/tensorflow/tensorflow/bazel-0.4.5/output:/mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/bin:/mnt/nfs/work/momeara/tools/anaconda2/bin:\\\r\n/mnt/nfs/home/momeara/.local/bin:/mnt/nfs/home/momeara/opt/node-v4.5.0-linux-x64/bin:/mnt/nfs/home/momeara/opt/bin:/mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/bin:/mnt/nfs/work/momeara/tools/anacond\\\r\na2/bin:/mnt/nfs/home/momeara/.local/bin:/mnt/nfs/home/momeara/opt/node-v4.5.0-linux-x64/bin:/mnt/nfs/home/momeara/opt/bin:/mnt/nfs/work/momeara/tools/anaconda2/envs/sea16/bin:/mnt/nfs/work/momeara/tools/\\\r\nanaconda2/bin:/mnt/nfs/home/momeara/.local/bin:/mnt/nfs/home/momeara/opt/node-v4.5.0-linux-x64/bin:/mnt/nfs/home/momeara/opt/bin:/usr/lib64/qt-3.3/bin:/usr/kerberos/sbin:/usr/kerberos/bin:/usr/local/bin:\\\r\n/bin:/usr/bin \\\r\n  /bin/bash -c 'source external/bazel_tools/tools/genrule/genrule-setup.sh;\r\nln -s /mnt/nfs/work/momeara/sea/DeepSEA/cuda/include/cudnn.h bazel-out/host/genfiles/external/local_config_cuda/cuda/include/include/cudnn.h    '): com.google.devtools.build.lib.shell.BadExitStatusExcept\\\r\nion: Process exited with status 1.\r\nln: creating symbolic link `bazel-out/host/genfiles/external/local_config_cuda/cuda/include/include/cudnn.h': No such file or directory\r\nblaze: Leaving directory `/scratch/momeara/.cache/baze/ef8339021629a8146b3e301bb7dc3099/execroot/tensorflow/'\r\n____Building complete.\r\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\r\n____Elapsed time: 75.364s, Critical Path: 3.99s\r\n\r\n"}