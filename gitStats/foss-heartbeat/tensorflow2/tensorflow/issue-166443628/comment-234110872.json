{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/234110872", "html_url": "https://github.com/tensorflow/tensorflow/issues/3397#issuecomment-234110872", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3397", "id": 234110872, "node_id": "MDEyOklzc3VlQ29tbWVudDIzNDExMDg3Mg==", "user": {"login": "concretevitamin", "id": 592670, "node_id": "MDQ6VXNlcjU5MjY3MA==", "avatar_url": "https://avatars3.githubusercontent.com/u/592670?v=4", "gravatar_id": "", "url": "https://api.github.com/users/concretevitamin", "html_url": "https://github.com/concretevitamin", "followers_url": "https://api.github.com/users/concretevitamin/followers", "following_url": "https://api.github.com/users/concretevitamin/following{/other_user}", "gists_url": "https://api.github.com/users/concretevitamin/gists{/gist_id}", "starred_url": "https://api.github.com/users/concretevitamin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/concretevitamin/subscriptions", "organizations_url": "https://api.github.com/users/concretevitamin/orgs", "repos_url": "https://api.github.com/users/concretevitamin/repos", "events_url": "https://api.github.com/users/concretevitamin/events{/privacy}", "received_events_url": "https://api.github.com/users/concretevitamin/received_events", "type": "User", "site_admin": false}, "created_at": "2016-07-20T23:05:55Z", "updated_at": "2016-07-20T23:05:55Z", "author_association": "CONTRIBUTOR", "body_html": "<p>The call stack is as such: <code>tf.nn.moments()</code> calls <code>sufficient_statistics()</code>, which contains <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/nn.py#L695\">this part</a>:</p>\n<div class=\"highlight highlight-source-python\"><pre>    <span class=\"pl-k\">if</span> x_shape.is_fully_defined():\n        <span class=\"pl-k\">&lt;</span>some code<span class=\"pl-k\">&gt;</span>\n    <span class=\"pl-k\">else</span>:  <span class=\"pl-c\"><span class=\"pl-c\">#</span> shape needs to be inferred at runtime.</span>\n      x_shape <span class=\"pl-k\">=</span> array_ops.shape(x)\n      select_axes <span class=\"pl-k\">=</span> sparse_ops.sparse_to_dense(axes, array_ops.shape(x_shape),\n                                               <span class=\"pl-c1\">True</span>, <span class=\"pl-c1\">False</span>)</pre></div>\n<p>Since the shape contains <code>None</code> the else branch is taken.  Lastly, the <code>SparseToDense</code> op only has a CPU kernel, not a GPU one.  Hence the failure.</p>\n<p>Possible fixes:</p>\n<ul>\n<li>Somehow change the <code>tf.nn.moments()</code> code path, so that <code>sparse_to_dense()</code> is avoided.</li>\n<li>Or, implement a SparseToDense GPU kernel.</li>\n</ul>\n<p>Marking as contribution welcome, since we're not likely to work on this in the near future.</p>", "body_text": "The call stack is as such: tf.nn.moments() calls sufficient_statistics(), which contains this part:\n    if x_shape.is_fully_defined():\n        <some code>\n    else:  # shape needs to be inferred at runtime.\n      x_shape = array_ops.shape(x)\n      select_axes = sparse_ops.sparse_to_dense(axes, array_ops.shape(x_shape),\n                                               True, False)\nSince the shape contains None the else branch is taken.  Lastly, the SparseToDense op only has a CPU kernel, not a GPU one.  Hence the failure.\nPossible fixes:\n\nSomehow change the tf.nn.moments() code path, so that sparse_to_dense() is avoided.\nOr, implement a SparseToDense GPU kernel.\n\nMarking as contribution welcome, since we're not likely to work on this in the near future.", "body": "The call stack is as such: `tf.nn.moments()` calls `sufficient_statistics()`, which contains [this part](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/nn.py#L695):\n\n``` python\n    if x_shape.is_fully_defined():\n        <some code>\n    else:  # shape needs to be inferred at runtime.\n      x_shape = array_ops.shape(x)\n      select_axes = sparse_ops.sparse_to_dense(axes, array_ops.shape(x_shape),\n                                               True, False)\n```\n\nSince the shape contains `None` the else branch is taken.  Lastly, the `SparseToDense` op only has a CPU kernel, not a GPU one.  Hence the failure.\n\nPossible fixes:\n- Somehow change the `tf.nn.moments()` code path, so that `sparse_to_dense()` is avoided.\n- Or, implement a SparseToDense GPU kernel.\n\nMarking as contribution welcome, since we're not likely to work on this in the near future.\n"}