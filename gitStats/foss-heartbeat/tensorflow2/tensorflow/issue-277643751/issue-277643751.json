{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14964", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14964/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14964/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14964/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/14964", "id": 277643751, "node_id": "MDU6SXNzdWUyNzc2NDM3NTE=", "number": 14964, "title": "Has anybody ever written a gradient for the operator 'SparseReduceSumSparse' ?", "user": {"login": "chaihua483", "id": 8024096, "node_id": "MDQ6VXNlcjgwMjQwOTY=", "avatar_url": "https://avatars2.githubusercontent.com/u/8024096?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chaihua483", "html_url": "https://github.com/chaihua483", "followers_url": "https://api.github.com/users/chaihua483/followers", "following_url": "https://api.github.com/users/chaihua483/following{/other_user}", "gists_url": "https://api.github.com/users/chaihua483/gists{/gist_id}", "starred_url": "https://api.github.com/users/chaihua483/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chaihua483/subscriptions", "organizations_url": "https://api.github.com/users/chaihua483/orgs", "repos_url": "https://api.github.com/users/chaihua483/repos", "events_url": "https://api.github.com/users/chaihua483/events{/privacy}", "received_events_url": "https://api.github.com/users/chaihua483/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586558, "node_id": "MDU6TGFiZWw0MDQ1ODY1NTg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:community%20support", "name": "stat:community support", "color": "f4b400", "default": false}, {"id": 473173272, "node_id": "MDU6TGFiZWw0NzMxNzMyNzI=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:feature", "name": "type:feature", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2017-11-29T06:28:35Z", "updated_at": "2018-10-24T21:15:28Z", "closed_at": "2018-10-24T21:15:28Z", "author_association": "NONE", "body_html": "<p>I could only find a gradient for <code>SparseReduceSum</code>.</p>\n<pre><code>@ops.RegisterGradient(\"SparseReduceSum\")\ndef _SparseReduceSumGrad(op, out_grad):\n  \"\"\"Similar to gradient for the Sum Op (i.e. tf.reduce_sum()).\"\"\"\n  sp_indices = op.inputs[0]\n  sp_shape = op.inputs[2]\n  output_shape_kept_dims = math_ops.reduced_shape(sp_shape, op.inputs[3])\n  out_grad_reshaped = array_ops.reshape(out_grad, output_shape_kept_dims)\n  scale = sp_shape // math_ops.to_int64(output_shape_kept_dims)\n  # (sparse_indices, sparse_values, sparse_shape, reduction_axes)\n  return (None, array_ops.gather_nd(out_grad_reshaped, sp_indices // scale),\n          None, None)\n</code></pre>\n<p>It seems uneasy to write a similar gradient for operator <code>SparseReduceSumSparse</code>.<br>\nCould anyone give me a hand? Thanks.</p>", "body_text": "I could only find a gradient for SparseReduceSum.\n@ops.RegisterGradient(\"SparseReduceSum\")\ndef _SparseReduceSumGrad(op, out_grad):\n  \"\"\"Similar to gradient for the Sum Op (i.e. tf.reduce_sum()).\"\"\"\n  sp_indices = op.inputs[0]\n  sp_shape = op.inputs[2]\n  output_shape_kept_dims = math_ops.reduced_shape(sp_shape, op.inputs[3])\n  out_grad_reshaped = array_ops.reshape(out_grad, output_shape_kept_dims)\n  scale = sp_shape // math_ops.to_int64(output_shape_kept_dims)\n  # (sparse_indices, sparse_values, sparse_shape, reduction_axes)\n  return (None, array_ops.gather_nd(out_grad_reshaped, sp_indices // scale),\n          None, None)\n\nIt seems uneasy to write a similar gradient for operator SparseReduceSumSparse.\nCould anyone give me a hand? Thanks.", "body": "I could only find a gradient for `SparseReduceSum`.\r\n\r\n```\r\n@ops.RegisterGradient(\"SparseReduceSum\")\r\ndef _SparseReduceSumGrad(op, out_grad):\r\n  \"\"\"Similar to gradient for the Sum Op (i.e. tf.reduce_sum()).\"\"\"\r\n  sp_indices = op.inputs[0]\r\n  sp_shape = op.inputs[2]\r\n  output_shape_kept_dims = math_ops.reduced_shape(sp_shape, op.inputs[3])\r\n  out_grad_reshaped = array_ops.reshape(out_grad, output_shape_kept_dims)\r\n  scale = sp_shape // math_ops.to_int64(output_shape_kept_dims)\r\n  # (sparse_indices, sparse_values, sparse_shape, reduction_axes)\r\n  return (None, array_ops.gather_nd(out_grad_reshaped, sp_indices // scale),\r\n          None, None)\r\n```\r\n\r\nIt seems uneasy to write a similar gradient for operator `SparseReduceSumSparse`.\r\nCould anyone give me a hand? Thanks."}