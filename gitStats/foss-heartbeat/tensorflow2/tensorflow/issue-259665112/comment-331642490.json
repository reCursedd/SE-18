{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/331642490", "html_url": "https://github.com/tensorflow/tensorflow/issues/13222#issuecomment-331642490", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13222", "id": 331642490, "node_id": "MDEyOklzc3VlQ29tbWVudDMzMTY0MjQ5MA==", "user": {"login": "yaroslavvb", "id": 23068, "node_id": "MDQ6VXNlcjIzMDY4", "avatar_url": "https://avatars3.githubusercontent.com/u/23068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yaroslavvb", "html_url": "https://github.com/yaroslavvb", "followers_url": "https://api.github.com/users/yaroslavvb/followers", "following_url": "https://api.github.com/users/yaroslavvb/following{/other_user}", "gists_url": "https://api.github.com/users/yaroslavvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/yaroslavvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yaroslavvb/subscriptions", "organizations_url": "https://api.github.com/users/yaroslavvb/orgs", "repos_url": "https://api.github.com/users/yaroslavvb/repos", "events_url": "https://api.github.com/users/yaroslavvb/events{/privacy}", "received_events_url": "https://api.github.com/users/yaroslavvb/received_events", "type": "User", "site_admin": false}, "created_at": "2017-09-23T15:23:47Z", "updated_at": "2017-09-23T21:44:55Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Actually I think the difference here is the algorithm, data copies are O(n^2), while SVD is O(n^3), so transfers become negligible for large enough computation. You can get rid of transfers by changing key line to this:</p>\n<pre><code>[d, e1, e2]  = sess.run([D2.op, E1.op,  E2.op]);\n</code></pre>\n<p>Here's an updated benchmark that avoids data transfers <a href=\"https://github.com/yaroslavvb/stuff/blob/master/gpu_svd_bench.py\">https://github.com/yaroslavvb/stuff/blob/master/gpu_svd_bench.py</a></p>\n<p>On head Tensorflow vs. MKL-enabled numpy on I7/GTX 1080 it gives following:</p>\n<pre><code>numpy default        min:   243.52, median:   246.42, mean:   259.49\nnumpy gesvd          min:  1294.13, median:  1296.60, mean:  1298.93\nnumpy gesdd          min:   242.36, median:   242.80, mean:   245.32\nTF CPU               min:   950.77, median:  1080.64, mean:  1050.79\nTF GPU               min:  5483.26, median:  5520.19, mean:  5571.15\n</code></pre>\n<p>Numpy/scipy uses divide-and-conquer gesdd algorithm by default, but it seems even gesvd is faster than GPU version.</p>\n<p>cc <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1458824\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/mattjj\">@mattjj</a> since KFAC needs fast SVDs</p>", "body_text": "Actually I think the difference here is the algorithm, data copies are O(n^2), while SVD is O(n^3), so transfers become negligible for large enough computation. You can get rid of transfers by changing key line to this:\n[d, e1, e2]  = sess.run([D2.op, E1.op,  E2.op]);\n\nHere's an updated benchmark that avoids data transfers https://github.com/yaroslavvb/stuff/blob/master/gpu_svd_bench.py\nOn head Tensorflow vs. MKL-enabled numpy on I7/GTX 1080 it gives following:\nnumpy default        min:   243.52, median:   246.42, mean:   259.49\nnumpy gesvd          min:  1294.13, median:  1296.60, mean:  1298.93\nnumpy gesdd          min:   242.36, median:   242.80, mean:   245.32\nTF CPU               min:   950.77, median:  1080.64, mean:  1050.79\nTF GPU               min:  5483.26, median:  5520.19, mean:  5571.15\n\nNumpy/scipy uses divide-and-conquer gesdd algorithm by default, but it seems even gesvd is faster than GPU version.\ncc @mattjj since KFAC needs fast SVDs", "body": "Actually I think the difference here is the algorithm, data copies are O(n^2), while SVD is O(n^3), so transfers become negligible for large enough computation. You can get rid of transfers by changing key line to this:\r\n\r\n    [d, e1, e2]  = sess.run([D2.op, E1.op,  E2.op]);\r\n\r\nHere's an updated benchmark that avoids data transfers https://github.com/yaroslavvb/stuff/blob/master/gpu_svd_bench.py\r\n\r\nOn head Tensorflow vs. MKL-enabled numpy on I7/GTX 1080 it gives following:\r\n```\r\nnumpy default        min:   243.52, median:   246.42, mean:   259.49\r\nnumpy gesvd          min:  1294.13, median:  1296.60, mean:  1298.93\r\nnumpy gesdd          min:   242.36, median:   242.80, mean:   245.32\r\nTF CPU               min:   950.77, median:  1080.64, mean:  1050.79\r\nTF GPU               min:  5483.26, median:  5520.19, mean:  5571.15\r\n```\r\n\r\nNumpy/scipy uses divide-and-conquer gesdd algorithm by default, but it seems even gesvd is faster than GPU version.\r\n\r\ncc @mattjj since KFAC needs fast SVDs"}