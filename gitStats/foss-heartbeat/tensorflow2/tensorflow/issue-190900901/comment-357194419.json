{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/357194419", "html_url": "https://github.com/tensorflow/tensorflow/issues/5773#issuecomment-357194419", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5773", "id": 357194419, "node_id": "MDEyOklzc3VlQ29tbWVudDM1NzE5NDQxOQ==", "user": {"login": "mzur", "id": 2457311, "node_id": "MDQ6VXNlcjI0NTczMTE=", "avatar_url": "https://avatars2.githubusercontent.com/u/2457311?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mzur", "html_url": "https://github.com/mzur", "followers_url": "https://api.github.com/users/mzur/followers", "following_url": "https://api.github.com/users/mzur/following{/other_user}", "gists_url": "https://api.github.com/users/mzur/gists{/gist_id}", "starred_url": "https://api.github.com/users/mzur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mzur/subscriptions", "organizations_url": "https://api.github.com/users/mzur/orgs", "repos_url": "https://api.github.com/users/mzur/repos", "events_url": "https://api.github.com/users/mzur/events{/privacy}", "received_events_url": "https://api.github.com/users/mzur/received_events", "type": "User", "site_admin": false}, "created_at": "2018-01-12T09:57:50Z", "updated_at": "2018-01-12T09:57:50Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=6425077\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/sid-kap\">@sid-kap</a> <code>SAME</code> padding may cause zeros at the borders (as described <a href=\"https://stackoverflow.com/a/39371113/1796523\" rel=\"nofollow\">here</a>). But this issue is about zeroing out, i.e. the image is not \"finished\".</p>\n<p>Let me illustrate this with a <a href=\"https://commons.wikimedia.org/wiki/File:101_Raven.jpg\" rel=\"nofollow\">large picture</a> (scaled down to 4876x7000 pixels). I run this code, which reads the picture, splits it into patches, then merges the patches back together and writes it to a file:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\nN <span class=\"pl-k\">=</span> <span class=\"pl-c1\">13</span>\nimg <span class=\"pl-k\">=</span> [tf.image.decode_jpeg(tf.read_file(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>101_Raven.jpg<span class=\"pl-pds\">'</span></span>), <span class=\"pl-c1\">1</span>)]\npatches <span class=\"pl-k\">=</span> tf.extract_image_patches(img, <span class=\"pl-v\">ksizes</span><span class=\"pl-k\">=</span>[<span class=\"pl-c1\">1</span>, N, N, <span class=\"pl-c1\">1</span>], <span class=\"pl-v\">strides</span><span class=\"pl-k\">=</span>[<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">1</span>], <span class=\"pl-v\">rates</span><span class=\"pl-k\">=</span>[<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">1</span>], <span class=\"pl-v\">padding</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>SAME<span class=\"pl-pds\">'</span></span>)\nencode_image <span class=\"pl-k\">=</span> tf.image.encode_jpeg(patches[<span class=\"pl-c1\">0</span>, :, :, <span class=\"pl-c1\">0</span>:<span class=\"pl-c1\">1</span>])\nwrite_file <span class=\"pl-k\">=</span> tf.write_file(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>output.jpg<span class=\"pl-pds\">'</span></span>, encode_image)\ntf.Session().run(write_file)</pre></div>\n<p>This results in the following image (note the black border due to <code>SAME</code> padding):</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/2457311/34869128-42ce5172-f786-11e7-9c05-622a706832b4.jpg\"><img src=\"https://user-images.githubusercontent.com/2457311/34869128-42ce5172-f786-11e7-9c05-622a706832b4.jpg\" alt=\"output\" style=\"max-width:100%;\"></a></p>\n<p>The bottom part of the image is missing. If I increase the stride to <code>[1, 2, 2, 1]</code>, I get the <a href=\"https://user-images.githubusercontent.com/2457311/34869317-cee28070-f786-11e7-8d8c-085e6d0b0657.jpg\" rel=\"nofollow\">correct result</a>. The behavior is the same for <code>VALID</code> padding.</p>", "body_text": "@sid-kap SAME padding may cause zeros at the borders (as described here). But this issue is about zeroing out, i.e. the image is not \"finished\".\nLet me illustrate this with a large picture (scaled down to 4876x7000 pixels). I run this code, which reads the picture, splits it into patches, then merges the patches back together and writes it to a file:\nimport tensorflow as tf\n\nN = 13\nimg = [tf.image.decode_jpeg(tf.read_file('101_Raven.jpg'), 1)]\npatches = tf.extract_image_patches(img, ksizes=[1, N, N, 1], strides=[1, 1, 1, 1], rates=[1, 1, 1, 1], padding='SAME')\nencode_image = tf.image.encode_jpeg(patches[0, :, :, 0:1])\nwrite_file = tf.write_file('output.jpg', encode_image)\ntf.Session().run(write_file)\nThis results in the following image (note the black border due to SAME padding):\n\nThe bottom part of the image is missing. If I increase the stride to [1, 2, 2, 1], I get the correct result. The behavior is the same for VALID padding.", "body": "@sid-kap `SAME` padding may cause zeros at the borders (as described [here](https://stackoverflow.com/a/39371113/1796523)). But this issue is about zeroing out, i.e. the image is not \"finished\".\r\n\r\nLet me illustrate this with a [large picture](https://commons.wikimedia.org/wiki/File:101_Raven.jpg) (scaled down to 4876x7000 pixels). I run this code, which reads the picture, splits it into patches, then merges the patches back together and writes it to a file:\r\n\r\n```python\r\nimport tensorflow as tf\r\n\r\nN = 13\r\nimg = [tf.image.decode_jpeg(tf.read_file('101_Raven.jpg'), 1)]\r\npatches = tf.extract_image_patches(img, ksizes=[1, N, N, 1], strides=[1, 1, 1, 1], rates=[1, 1, 1, 1], padding='SAME')\r\nencode_image = tf.image.encode_jpeg(patches[0, :, :, 0:1])\r\nwrite_file = tf.write_file('output.jpg', encode_image)\r\ntf.Session().run(write_file)\r\n```\r\n\r\nThis results in the following image (note the black border due to `SAME` padding):\r\n\r\n![output](https://user-images.githubusercontent.com/2457311/34869128-42ce5172-f786-11e7-9c05-622a706832b4.jpg)\r\n\r\nThe bottom part of the image is missing. If I increase the stride to `[1, 2, 2, 1]`, I get the [correct result](https://user-images.githubusercontent.com/2457311/34869317-cee28070-f786-11e7-8d8c-085e6d0b0657.jpg). The behavior is the same for `VALID` padding.\r\n"}