{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23466", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23466/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23466/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23466/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23466", "id": 376965563, "node_id": "MDU6SXNzdWUzNzY5NjU1NjM=", "number": 23466, "title": "Segmentation Fault When Running Multiple Sessios In a Row", "user": {"login": "RoboEvangelist", "id": 3664583, "node_id": "MDQ6VXNlcjM2NjQ1ODM=", "avatar_url": "https://avatars3.githubusercontent.com/u/3664583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RoboEvangelist", "html_url": "https://github.com/RoboEvangelist", "followers_url": "https://api.github.com/users/RoboEvangelist/followers", "following_url": "https://api.github.com/users/RoboEvangelist/following{/other_user}", "gists_url": "https://api.github.com/users/RoboEvangelist/gists{/gist_id}", "starred_url": "https://api.github.com/users/RoboEvangelist/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RoboEvangelist/subscriptions", "organizations_url": "https://api.github.com/users/RoboEvangelist/orgs", "repos_url": "https://api.github.com/users/RoboEvangelist/repos", "events_url": "https://api.github.com/users/RoboEvangelist/events{/privacy}", "received_events_url": "https://api.github.com/users/RoboEvangelist/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "open", "locked": false, "assignee": {"login": "azaks2", "id": 40365382, "node_id": "MDQ6VXNlcjQwMzY1Mzgy", "avatar_url": "https://avatars2.githubusercontent.com/u/40365382?v=4", "gravatar_id": "", "url": "https://api.github.com/users/azaks2", "html_url": "https://github.com/azaks2", "followers_url": "https://api.github.com/users/azaks2/followers", "following_url": "https://api.github.com/users/azaks2/following{/other_user}", "gists_url": "https://api.github.com/users/azaks2/gists{/gist_id}", "starred_url": "https://api.github.com/users/azaks2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/azaks2/subscriptions", "organizations_url": "https://api.github.com/users/azaks2/orgs", "repos_url": "https://api.github.com/users/azaks2/repos", "events_url": "https://api.github.com/users/azaks2/events{/privacy}", "received_events_url": "https://api.github.com/users/azaks2/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "azaks2", "id": 40365382, "node_id": "MDQ6VXNlcjQwMzY1Mzgy", "avatar_url": "https://avatars2.githubusercontent.com/u/40365382?v=4", "gravatar_id": "", "url": "https://api.github.com/users/azaks2", "html_url": "https://github.com/azaks2", "followers_url": "https://api.github.com/users/azaks2/followers", "following_url": "https://api.github.com/users/azaks2/following{/other_user}", "gists_url": "https://api.github.com/users/azaks2/gists{/gist_id}", "starred_url": "https://api.github.com/users/azaks2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/azaks2/subscriptions", "organizations_url": "https://api.github.com/users/azaks2/orgs", "repos_url": "https://api.github.com/users/azaks2/repos", "events_url": "https://api.github.com/users/azaks2/events{/privacy}", "received_events_url": "https://api.github.com/users/azaks2/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2018-11-02T20:58:22Z", "updated_at": "2018-11-12T18:02:22Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>Please go to Stack Overflow for help and support:</p>\n<p><a href=\"https://stackoverflow.com/questions/tagged/tensorflow\" rel=\"nofollow\">https://stackoverflow.com/questions/tagged/tensorflow</a></p>\n<p>If you open a GitHub issue, here is our policy:</p>\n<ol>\n<li>It must be a bug, a feature request, or a significant problem with documentation (for small docs fixes please send a PR instead).</li>\n<li>The form below must be filled out.</li>\n<li>It shouldn't be a TensorBoard issue. Those go <a href=\"https://github.com/tensorflow/tensorboard/issues\">here</a>.</li>\n</ol>\n<p><strong>Here's why we have that policy</strong>: TensorFlow developers respond to issues. We want to focus on work that benefits the whole community, e.g., fixing bugs and adding features. Support only helps individuals. GitHub also notifies thousands of people when issues are filed. We want them to see you communicating an interesting problem, rather than being redirected to Stack Overflow.</p>\n<hr>\n<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Ubuntu 16.04</li>\n<li><strong>Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device</strong>:</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: source</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.4.1</li>\n<li><strong>Python version</strong>: 1.4.1</li>\n<li><strong>Bazel version (if compiling from source)</strong>: 0.6.0</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: 5</li>\n<li><strong>CUDA/cuDNN version</strong>: 8.0</li>\n<li><strong>GPU model and memory</strong>: GTX 1080 TI</li>\n<li><strong>Exact command to reproduce</strong>: session_one-&gt;Run(<br>\n{{INPUT_LAYER, input_tensor}},<br>\n{OUTPUT_LAYER}, {}, &amp;outputs_tensor);<br>\nRun the above method twice in a row</li>\n</ul>\n<p>You can collect some of this information using our environment capture script:</p>\n<p><a href=\"https://github.com/tensorflow/tensorflow/tree/master/tools/tf_env_collect.sh\">https://github.com/tensorflow/tensorflow/tree/master/tools/tf_env_collect.sh</a></p>\n<h3>Describe the problem</h3>\n<p>It appears that multiple sessions cannot be ran right after the other, otherwise I get segmentation fault. There is gotta be a delay in between Run() methods (such as extra computations)</p>\n<h3>Source code / logs</h3>\n<p>For instance, the following code makes my program have a segmentation fault:</p>\n<pre><code>Status run_session_one_status = session_ONE-&gt;Run(\n          {{THIS_GRAPH_input_layer, input_tensor_one}},\n          {THIS_GRAPH_output_layer}, {}, &amp;output_tensor_one);\n  if (!run_session_one_status.ok()) {\n      LOG(ERROR) &lt;&lt;\n                 \"run_session_one_status failed.\" &lt;&lt; run_session_one_status;\n  }\n  Status run_session_two_status = session_TWO-&gt;Run(\n          {{DIFFERENT_GRAPH_input_layer, input_tensor_two}},\n          {DIFFERENT_GRAPH_output_layer}, {}, &amp;output_tensor_two);\n  if (!run_session_two_status.ok()) {\n      LOG(ERROR) &lt;&lt;\n                 \"run_session_two_status failed.\" &lt;&lt; run_session_two_status;\n  }\n</code></pre>\n<p>Whereas the following code stops the segmentation fault from happening:</p>\n<pre><code>Status run_session_one_status = session_ONE-&gt;Run(\n          {{THIS_GRAPH_input_layer, input_tensor_one}},\n          {THIS_GRAPH_output_layer}, {}, &amp;output_tensor_one);\n  if (!run_session_one_status.ok()) {\n      LOG(ERROR) &lt;&lt;\n                 \"run_session_one_status failed.\" &lt;&lt; run_session_one_status;\n  }\n\n  /// adding extra operations just to give GPU a break\n  feature_vector.clear();\n  for (uint32_t i = 0; i &lt; output_tensor_one[0].NumElements(); ++i) {\n      feature_vector.push_back(output_tensor_one[0].flat&lt;float&gt;()(i));\n  }\n\n  Status run_session_two_status = session_TWO-&gt;Run(\n          {{DIFFERENT_GRAPH_input_layer, input_tensor_two}},\n          {DIFFERENT_GRAPH_output_layer}, {}, &amp;output_tensor_two);\n  if (!run_session_two_status.ok()) {\n      LOG(ERROR) &lt;&lt;\n                 \"run_session_two_status failed.\" &lt;&lt; run_session_two_status;\n  }\n</code></pre>\n<p>I have plenty of GPU memory, and each session only needs 0.5% of my GPU's total memory. And, yes, I tried giving each session more memory (e.g., 50% per session, etc.).</p>\n<p>Even though I found a work around, I still wanted to throw the bug out there for the TensorFlow team to be aware of it.</p>", "body_text": "Please go to Stack Overflow for help and support:\nhttps://stackoverflow.com/questions/tagged/tensorflow\nIf you open a GitHub issue, here is our policy:\n\nIt must be a bug, a feature request, or a significant problem with documentation (for small docs fixes please send a PR instead).\nThe form below must be filled out.\nIt shouldn't be a TensorBoard issue. Those go here.\n\nHere's why we have that policy: TensorFlow developers respond to issues. We want to focus on work that benefits the whole community, e.g., fixing bugs and adding features. Support only helps individuals. GitHub also notifies thousands of people when issues are filed. We want them to see you communicating an interesting problem, rather than being redirected to Stack Overflow.\n\nSystem information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Ubuntu 16.04\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:\nTensorFlow installed from (source or binary): source\nTensorFlow version (use command below): 1.4.1\nPython version: 1.4.1\nBazel version (if compiling from source): 0.6.0\nGCC/Compiler version (if compiling from source): 5\nCUDA/cuDNN version: 8.0\nGPU model and memory: GTX 1080 TI\nExact command to reproduce: session_one->Run(\n{{INPUT_LAYER, input_tensor}},\n{OUTPUT_LAYER}, {}, &outputs_tensor);\nRun the above method twice in a row\n\nYou can collect some of this information using our environment capture script:\nhttps://github.com/tensorflow/tensorflow/tree/master/tools/tf_env_collect.sh\nDescribe the problem\nIt appears that multiple sessions cannot be ran right after the other, otherwise I get segmentation fault. There is gotta be a delay in between Run() methods (such as extra computations)\nSource code / logs\nFor instance, the following code makes my program have a segmentation fault:\nStatus run_session_one_status = session_ONE->Run(\n          {{THIS_GRAPH_input_layer, input_tensor_one}},\n          {THIS_GRAPH_output_layer}, {}, &output_tensor_one);\n  if (!run_session_one_status.ok()) {\n      LOG(ERROR) <<\n                 \"run_session_one_status failed.\" << run_session_one_status;\n  }\n  Status run_session_two_status = session_TWO->Run(\n          {{DIFFERENT_GRAPH_input_layer, input_tensor_two}},\n          {DIFFERENT_GRAPH_output_layer}, {}, &output_tensor_two);\n  if (!run_session_two_status.ok()) {\n      LOG(ERROR) <<\n                 \"run_session_two_status failed.\" << run_session_two_status;\n  }\n\nWhereas the following code stops the segmentation fault from happening:\nStatus run_session_one_status = session_ONE->Run(\n          {{THIS_GRAPH_input_layer, input_tensor_one}},\n          {THIS_GRAPH_output_layer}, {}, &output_tensor_one);\n  if (!run_session_one_status.ok()) {\n      LOG(ERROR) <<\n                 \"run_session_one_status failed.\" << run_session_one_status;\n  }\n\n  /// adding extra operations just to give GPU a break\n  feature_vector.clear();\n  for (uint32_t i = 0; i < output_tensor_one[0].NumElements(); ++i) {\n      feature_vector.push_back(output_tensor_one[0].flat<float>()(i));\n  }\n\n  Status run_session_two_status = session_TWO->Run(\n          {{DIFFERENT_GRAPH_input_layer, input_tensor_two}},\n          {DIFFERENT_GRAPH_output_layer}, {}, &output_tensor_two);\n  if (!run_session_two_status.ok()) {\n      LOG(ERROR) <<\n                 \"run_session_two_status failed.\" << run_session_two_status;\n  }\n\nI have plenty of GPU memory, and each session only needs 0.5% of my GPU's total memory. And, yes, I tried giving each session more memory (e.g., 50% per session, etc.).\nEven though I found a work around, I still wanted to throw the bug out there for the TensorFlow team to be aware of it.", "body": "Please go to Stack Overflow for help and support:\r\n\r\nhttps://stackoverflow.com/questions/tagged/tensorflow\r\n\r\nIf you open a GitHub issue, here is our policy:\r\n\r\n1. It must be a bug, a feature request, or a significant problem with documentation (for small docs fixes please send a PR instead).\r\n2. The form below must be filled out.\r\n3. It shouldn't be a TensorBoard issue. Those go [here](https://github.com/tensorflow/tensorboard/issues).\r\n\r\n**Here's why we have that policy**: TensorFlow developers respond to issues. We want to focus on work that benefits the whole community, e.g., fixing bugs and adding features. Support only helps individuals. GitHub also notifies thousands of people when issues are filed. We want them to see you communicating an interesting problem, rather than being redirected to Stack Overflow.\r\n\r\n------------------------\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Ubuntu 16.04\r\n- **Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device**:\r\n- **TensorFlow installed from (source or binary)**: source\r\n- **TensorFlow version (use command below)**: 1.4.1\r\n- **Python version**: 1.4.1\r\n- **Bazel version (if compiling from source)**: 0.6.0\r\n- **GCC/Compiler version (if compiling from source)**: 5\r\n- **CUDA/cuDNN version**: 8.0\r\n- **GPU model and memory**: GTX 1080 TI\r\n- **Exact command to reproduce**: session_one->Run(\r\n          {{INPUT_LAYER, input_tensor}},\r\n          {OUTPUT_LAYER}, {}, &outputs_tensor);\r\nRun the above method twice in a row\r\n\r\nYou can collect some of this information using our environment capture script:\r\n\r\nhttps://github.com/tensorflow/tensorflow/tree/master/tools/tf_env_collect.sh\r\n\r\n### Describe the problem\r\nIt appears that multiple sessions cannot be ran right after the other, otherwise I get segmentation fault. There is gotta be a delay in between Run() methods (such as extra computations)\r\n\r\n### Source code / logs\r\nFor instance, the following code makes my program have a segmentation fault:\r\n```\r\nStatus run_session_one_status = session_ONE->Run(\r\n          {{THIS_GRAPH_input_layer, input_tensor_one}},\r\n          {THIS_GRAPH_output_layer}, {}, &output_tensor_one);\r\n  if (!run_session_one_status.ok()) {\r\n      LOG(ERROR) <<\r\n                 \"run_session_one_status failed.\" << run_session_one_status;\r\n  }\r\n  Status run_session_two_status = session_TWO->Run(\r\n          {{DIFFERENT_GRAPH_input_layer, input_tensor_two}},\r\n          {DIFFERENT_GRAPH_output_layer}, {}, &output_tensor_two);\r\n  if (!run_session_two_status.ok()) {\r\n      LOG(ERROR) <<\r\n                 \"run_session_two_status failed.\" << run_session_two_status;\r\n  }\r\n```\r\n\r\nWhereas the following code stops the segmentation fault from happening:\r\n\r\n```\r\nStatus run_session_one_status = session_ONE->Run(\r\n          {{THIS_GRAPH_input_layer, input_tensor_one}},\r\n          {THIS_GRAPH_output_layer}, {}, &output_tensor_one);\r\n  if (!run_session_one_status.ok()) {\r\n      LOG(ERROR) <<\r\n                 \"run_session_one_status failed.\" << run_session_one_status;\r\n  }\r\n\r\n  /// adding extra operations just to give GPU a break\r\n  feature_vector.clear();\r\n  for (uint32_t i = 0; i < output_tensor_one[0].NumElements(); ++i) {\r\n      feature_vector.push_back(output_tensor_one[0].flat<float>()(i));\r\n  }\r\n\r\n  Status run_session_two_status = session_TWO->Run(\r\n          {{DIFFERENT_GRAPH_input_layer, input_tensor_two}},\r\n          {DIFFERENT_GRAPH_output_layer}, {}, &output_tensor_two);\r\n  if (!run_session_two_status.ok()) {\r\n      LOG(ERROR) <<\r\n                 \"run_session_two_status failed.\" << run_session_two_status;\r\n  }\r\n```\r\n\r\nI have plenty of GPU memory, and each session only needs 0.5% of my GPU's total memory. And, yes, I tried giving each session more memory (e.g., 50% per session, etc.).\r\n\r\nEven though I found a work around, I still wanted to throw the bug out there for the TensorFlow team to be aware of it.\r\n\r\n"}