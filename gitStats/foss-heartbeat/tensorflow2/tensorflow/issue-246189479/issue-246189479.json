{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11830", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11830/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11830/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11830/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/11830", "id": 246189479, "node_id": "MDExOlB1bGxSZXF1ZXN0MTMyODYwODM5", "number": 11830, "title": "Fixes #11829: Faster to import tensorflow.contrib on Python 3", "user": {"login": "patrikerdes", "id": 3019149, "node_id": "MDQ6VXNlcjMwMTkxNDk=", "avatar_url": "https://avatars1.githubusercontent.com/u/3019149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/patrikerdes", "html_url": "https://github.com/patrikerdes", "followers_url": "https://api.github.com/users/patrikerdes/followers", "following_url": "https://api.github.com/users/patrikerdes/following{/other_user}", "gists_url": "https://api.github.com/users/patrikerdes/gists{/gist_id}", "starred_url": "https://api.github.com/users/patrikerdes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/patrikerdes/subscriptions", "organizations_url": "https://api.github.com/users/patrikerdes/orgs", "repos_url": "https://api.github.com/users/patrikerdes/repos", "events_url": "https://api.github.com/users/patrikerdes/events{/privacy}", "received_events_url": "https://api.github.com/users/patrikerdes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 419840263, "node_id": "MDU6TGFiZWw0MTk4NDAyNjM=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/awaiting%20testing%20(then%20merge)", "name": "awaiting testing (then merge)", "color": "c2e0c6", "default": false}, {"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "jart", "id": 49262, "node_id": "MDQ6VXNlcjQ5MjYy", "avatar_url": "https://avatars1.githubusercontent.com/u/49262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jart", "html_url": "https://github.com/jart", "followers_url": "https://api.github.com/users/jart/followers", "following_url": "https://api.github.com/users/jart/following{/other_user}", "gists_url": "https://api.github.com/users/jart/gists{/gist_id}", "starred_url": "https://api.github.com/users/jart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jart/subscriptions", "organizations_url": "https://api.github.com/users/jart/orgs", "repos_url": "https://api.github.com/users/jart/repos", "events_url": "https://api.github.com/users/jart/events{/privacy}", "received_events_url": "https://api.github.com/users/jart/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jart", "id": 49262, "node_id": "MDQ6VXNlcjQ5MjYy", "avatar_url": "https://avatars1.githubusercontent.com/u/49262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jart", "html_url": "https://github.com/jart", "followers_url": "https://api.github.com/users/jart/followers", "following_url": "https://api.github.com/users/jart/following{/other_user}", "gists_url": "https://api.github.com/users/jart/gists{/gist_id}", "starred_url": "https://api.github.com/users/jart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jart/subscriptions", "organizations_url": "https://api.github.com/users/jart/orgs", "repos_url": "https://api.github.com/users/jart/repos", "events_url": "https://api.github.com/users/jart/events{/privacy}", "received_events_url": "https://api.github.com/users/jart/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2017-07-27T22:38:12Z", "updated_at": "2017-09-17T20:38:12Z", "closed_at": "2017-09-17T20:38:11Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/11830", "html_url": "https://github.com/tensorflow/tensorflow/pull/11830", "diff_url": "https://github.com/tensorflow/tensorflow/pull/11830.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/11830.patch"}, "body_html": "<p>As described in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"246186523\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/11829\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/11829/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/11829\">#11829</a>, a lot of time is spent doing <code>inspect.stack()</code> when importing <code>import tensorflow.contrib</code> with Python 3. (There does not seem to be any issue with Python 2.)</p>\n<p>By replacing <code>_inspect.stack()</code> with only getting the current and previous frame and then getting the frame info for just the previous frame, this unnecessary overhead is removed.</p>\n<p>The time to import tensorflow.contrib, as reported by <code>time python2/3 -c \"import tensorflow.contrib\"</code> before and after my commit:</p>\n<table>\n<thead>\n<tr>\n<th>When</th>\n<th>Python 2.7.13</th>\n<th>Python 3.6.2</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>before</td>\n<td>3.2</td>\n<td>7.5</td>\n</tr>\n<tr>\n<td>after</td>\n<td>3.1</td>\n<td>3.3</td>\n</tr>\n</tbody>\n</table>\n<p>There are unit tests that would catch if the <code>decorator_name</code> would be incorrect after my change, specifically these tests:</p>\n<ul>\n<li>testSetsDecoratorNameToFunctionThatCallsMakeDecoratorIfAbsent</li>\n<li>testUnwrapReturnsDecoratorListFromOutermostToInnermost</li>\n<li>testUnwrapBoundMethods</li>\n</ul>\n<p>All Python unit tests passed (in Docker). I didn't find any issues when linting the changed file.</p>", "body_text": "As described in #11829, a lot of time is spent doing inspect.stack() when importing import tensorflow.contrib with Python 3. (There does not seem to be any issue with Python 2.)\nBy replacing _inspect.stack() with only getting the current and previous frame and then getting the frame info for just the previous frame, this unnecessary overhead is removed.\nThe time to import tensorflow.contrib, as reported by time python2/3 -c \"import tensorflow.contrib\" before and after my commit:\n\n\n\nWhen\nPython 2.7.13\nPython 3.6.2\n\n\n\n\nbefore\n3.2\n7.5\n\n\nafter\n3.1\n3.3\n\n\n\nThere are unit tests that would catch if the decorator_name would be incorrect after my change, specifically these tests:\n\ntestSetsDecoratorNameToFunctionThatCallsMakeDecoratorIfAbsent\ntestUnwrapReturnsDecoratorListFromOutermostToInnermost\ntestUnwrapBoundMethods\n\nAll Python unit tests passed (in Docker). I didn't find any issues when linting the changed file.", "body": "As described in #11829, a lot of time is spent doing `inspect.stack()` when importing `import tensorflow.contrib` with Python 3. (There does not seem to be any issue with Python 2.)\r\n\r\nBy replacing `_inspect.stack()` with only getting the current and previous frame and then getting the frame info for just the previous frame, this unnecessary overhead is removed.\r\n\r\nThe time to import tensorflow.contrib, as reported by `time python2/3 -c \"import tensorflow.contrib\"` before and after my commit:\r\n\r\nWhen|Python 2.7.13|Python 3.6.2|\r\n------|-------------|-------------|\r\nbefore|3.2|7.5|\r\nafter|3.1|3.3|\r\n\r\nThere are unit tests that would catch if the `decorator_name` would be incorrect after my change, specifically these tests:\r\n* testSetsDecoratorNameToFunctionThatCallsMakeDecoratorIfAbsent\r\n* testUnwrapReturnsDecoratorListFromOutermostToInnermost\r\n* testUnwrapBoundMethods\r\n\r\nAll Python unit tests passed (in Docker). I didn't find any issues when linting the changed file."}