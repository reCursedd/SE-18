{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16033", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16033/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16033/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16033/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/16033", "id": 287737496, "node_id": "MDU6SXNzdWUyODc3Mzc0OTY=", "number": 16033, "title": "NNAPI/libneuralnetwors.so does not work for other models than default mobilenet_quant_v1_224.tflite", "user": {"login": "benshi001", "id": 24586233, "node_id": "MDQ6VXNlcjI0NTg2MjMz", "avatar_url": "https://avatars1.githubusercontent.com/u/24586233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/benshi001", "html_url": "https://github.com/benshi001", "followers_url": "https://api.github.com/users/benshi001/followers", "following_url": "https://api.github.com/users/benshi001/following{/other_user}", "gists_url": "https://api.github.com/users/benshi001/gists{/gist_id}", "starred_url": "https://api.github.com/users/benshi001/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/benshi001/subscriptions", "organizations_url": "https://api.github.com/users/benshi001/orgs", "repos_url": "https://api.github.com/users/benshi001/repos", "events_url": "https://api.github.com/users/benshi001/events{/privacy}", "received_events_url": "https://api.github.com/users/benshi001/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 750616506, "node_id": "MDU6TGFiZWw3NTA2MTY1MDY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:lite", "name": "comp:lite", "color": "0052cc", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-01-11T10:35:06Z", "updated_at": "2018-01-12T02:50:35Z", "closed_at": "2018-01-12T02:50:35Z", "author_association": "NONE", "body_html": "<p>I have made changes to tensorflowlite to force it use nnapi on my android 8.1 phone, and the nnapi only worked normally for the default default mobilenet_quant_v1_224.tflite.</p>\n<p>The nnapi/libneuralnetworks.so did not work for the tensorflow_inception_graph.tflite inside the attached asserts.zip, which was built by toco, from tensorflow_inception_graph.pb of <a href=\"https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android\">https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android</a></p>\n<p>My steps,</p>\n<ol>\n<li>generated tensorflow_inception_graph.tflite from tensorflow_inception_graph.pb by toco</li>\n<li>add 7 extra lines to labels.txt \"a\\nb\\nc\\nd\\ne\\ng\\ng\"</li>\n<li>copy new labels.txt and tensorflow_inception_graph.tflite to my bazel cache</li>\n<li>apply the attached patch a.txt to tensorflow</li>\n<li>bazel build --cxxopt=--std=c++11 //tensorflow/contrib/lite/java/demo/app/src/main:TfLiteCameraDemo --config=android_arm64 --cpu=arm64-v8a --fat_apk_cpu=arm64-v8a</li>\n<li>adb install -r &lt;apk_file&gt;</li>\n</ol>\n<p>If the nnapi is not forced to use, then the apk run normally, though the results are wrong. But if I forced it to use nnapi, then the apk crashed.</p>\n<p>I guess the tensorflow_inception_graph.tflite contained some operators which were not supported by nnapi/libneuralnetwors.so. How can I confirm it?</p>\n<p>Thank you.</p>\n<p><a href=\"https://github.com/tensorflow/tensorflow/files/1622153/a.txt\">a.txt</a><br>\n<a href=\"https://github.com/tensorflow/tensorflow/files/1622067/assets.zip\">assets.zip</a></p>", "body_text": "I have made changes to tensorflowlite to force it use nnapi on my android 8.1 phone, and the nnapi only worked normally for the default default mobilenet_quant_v1_224.tflite.\nThe nnapi/libneuralnetworks.so did not work for the tensorflow_inception_graph.tflite inside the attached asserts.zip, which was built by toco, from tensorflow_inception_graph.pb of https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android\nMy steps,\n\ngenerated tensorflow_inception_graph.tflite from tensorflow_inception_graph.pb by toco\nadd 7 extra lines to labels.txt \"a\\nb\\nc\\nd\\ne\\ng\\ng\"\ncopy new labels.txt and tensorflow_inception_graph.tflite to my bazel cache\napply the attached patch a.txt to tensorflow\nbazel build --cxxopt=--std=c++11 //tensorflow/contrib/lite/java/demo/app/src/main:TfLiteCameraDemo --config=android_arm64 --cpu=arm64-v8a --fat_apk_cpu=arm64-v8a\nadb install -r <apk_file>\n\nIf the nnapi is not forced to use, then the apk run normally, though the results are wrong. But if I forced it to use nnapi, then the apk crashed.\nI guess the tensorflow_inception_graph.tflite contained some operators which were not supported by nnapi/libneuralnetwors.so. How can I confirm it?\nThank you.\na.txt\nassets.zip", "body": "I have made changes to tensorflowlite to force it use nnapi on my android 8.1 phone, and the nnapi only worked normally for the default default mobilenet_quant_v1_224.tflite.\r\n\r\nThe nnapi/libneuralnetworks.so did not work for the tensorflow_inception_graph.tflite inside the attached asserts.zip, which was built by toco, from tensorflow_inception_graph.pb of https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android\r\n\r\nMy steps,\r\n1. generated tensorflow_inception_graph.tflite from tensorflow_inception_graph.pb by toco\r\n2. add 7 extra lines to labels.txt \"a\\nb\\nc\\nd\\ne\\ng\\ng\"\r\n3. copy new labels.txt and tensorflow_inception_graph.tflite to my bazel cache\r\n4. apply the attached patch a.txt to tensorflow\r\n5.  bazel build --cxxopt=--std=c++11 //tensorflow/contrib/lite/java/demo/app/src/main:TfLiteCameraDemo --config=android_arm64 --cpu=arm64-v8a --fat_apk_cpu=arm64-v8a\r\n6. adb install -r <apk_file>\r\n\r\nIf the nnapi is not forced to use, then the apk run normally, though the results are wrong. But if I forced it to use nnapi, then the apk crashed.\r\n\r\nI guess the tensorflow_inception_graph.tflite contained some operators which were not supported by nnapi/libneuralnetwors.so. How can I confirm it?\r\n\r\nThank you.\r\n\r\n[a.txt](https://github.com/tensorflow/tensorflow/files/1622153/a.txt)\r\n[assets.zip](https://github.com/tensorflow/tensorflow/files/1622067/assets.zip)\r\n"}