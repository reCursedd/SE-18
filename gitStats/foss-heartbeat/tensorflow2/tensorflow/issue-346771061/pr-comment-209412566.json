{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/209412566", "pull_request_review_id": 145432062, "id": 209412566, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwOTQxMjU2Ng==", "diff_hunk": "@@ -937,13 +963,53 @@ class MklConv2DOp : public OpKernel {\n         errors::Aborted(\"Operation received an exception:\", error_msg));\n     }\n   }\n+  \n+  void PadWithConvFusion(OpKernelContext* context, memory::dims &padding_left,\n+                         memory::dims &padding_right){\n+    const Tensor& paddings_tf = MklGetInput(context, 2);\n+    OP_REQUIRES(context, paddings_tf.dims() == 2,\n+                errors::InvalidArgument(\"paddings must be 2-dimensional: \",\n+                                        paddings_tf.shape().DebugString()));\n+    Tpadding* paddings = nullptr;\n+    // To get individual pad, need to flatten the tensor\n+    paddings = static_cast<Tpadding*>(const_cast<Tpadding*>\n+                                     (paddings_tf.flat<Tpadding>().data())); \n+    // For NHWC format:\n+    // paddings[0], paddings[1], paddings[6], paddings[7] should be zero \n+    // if the paddings_tf is [ [0, 0] [1,2] [3,4] [0,0] ]\n+    // paddings = {0, 0, 1, 2, 3, 4, 0, 0} ; flat method is row major\n+    // then, values are: top = 1, bottom =2, left=3, right=4\n+    // For NCHW format, \n+    // paddings[0], paddings[1], paddings[2], paddings[3] should be zero \n+    // similar explanation as NHWC format will apply.\n+    string data_format = ToString(data_format_);\n+    if(data_format == \"NHWC\"){\n+      pad_top = paddings[2]; \n+      pad_bottom = paddings[3]; \n+      pad_left = paddings[4]; \n+      pad_right = paddings[5]; \n+    }\n+    else if (data_format == \"NCHW\"){\n+      pad_top = paddings[4]; \n+      pad_bottom = paddings[5]; \n+      pad_left = paddings[6]; \n+      pad_right = paddings[7]; \n+    }\n+    // Create padding arrays for MKL DNN convolutions.\n+    // MKL-DNN uses asymetric padding.\n+    padding_left = {static_cast<int>(pad_top), static_cast<int>(pad_left)};\n+    padding_right = {static_cast<int>(pad_bottom), static_cast<int>(pad_right)};\n+  }\n \n  private:\n   std::vector<int32> strides_;\n   std::vector<int32> dilations_;\n+  int64 pad_top, pad_left; ", "path": "tensorflow/core/kernels/mkl_conv_ops.cc", "position": null, "original_position": 107, "commit_id": "48809b87793882266f01b7b40bc9e4a6e0f18f57", "original_commit_id": "dd63093a599081accfe2a2d2ca8c029d413a15d7", "user": {"login": "ashraf-bhuiyan", "id": 8062406, "node_id": "MDQ6VXNlcjgwNjI0MDY=", "avatar_url": "https://avatars2.githubusercontent.com/u/8062406?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ashraf-bhuiyan", "html_url": "https://github.com/ashraf-bhuiyan", "followers_url": "https://api.github.com/users/ashraf-bhuiyan/followers", "following_url": "https://api.github.com/users/ashraf-bhuiyan/following{/other_user}", "gists_url": "https://api.github.com/users/ashraf-bhuiyan/gists{/gist_id}", "starred_url": "https://api.github.com/users/ashraf-bhuiyan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ashraf-bhuiyan/subscriptions", "organizations_url": "https://api.github.com/users/ashraf-bhuiyan/orgs", "repos_url": "https://api.github.com/users/ashraf-bhuiyan/repos", "events_url": "https://api.github.com/users/ashraf-bhuiyan/events{/privacy}", "received_events_url": "https://api.github.com/users/ashraf-bhuiyan/received_events", "type": "User", "site_admin": false}, "body": "Yes not required as class member. I moved them to the PadWithConvFusion method.", "created_at": "2018-08-11T01:28:46Z", "updated_at": "2018-11-23T19:46:17Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/21318#discussion_r209412566", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/21318", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/209412566"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/21318#discussion_r209412566"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/21318"}}, "body_html": "<p>Yes not required as class member. I moved them to the PadWithConvFusion method.</p>", "body_text": "Yes not required as class member. I moved them to the PadWithConvFusion method.", "in_reply_to_id": 208469536}