{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/414012576", "html_url": "https://github.com/tensorflow/tensorflow/pull/21318#issuecomment-414012576", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21318", "id": 414012576, "node_id": "MDEyOklzc3VlQ29tbWVudDQxNDAxMjU3Ng==", "user": {"login": "ashraf-bhuiyan", "id": 8062406, "node_id": "MDQ6VXNlcjgwNjI0MDY=", "avatar_url": "https://avatars2.githubusercontent.com/u/8062406?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ashraf-bhuiyan", "html_url": "https://github.com/ashraf-bhuiyan", "followers_url": "https://api.github.com/users/ashraf-bhuiyan/followers", "following_url": "https://api.github.com/users/ashraf-bhuiyan/following{/other_user}", "gists_url": "https://api.github.com/users/ashraf-bhuiyan/gists{/gist_id}", "starred_url": "https://api.github.com/users/ashraf-bhuiyan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ashraf-bhuiyan/subscriptions", "organizations_url": "https://api.github.com/users/ashraf-bhuiyan/orgs", "repos_url": "https://api.github.com/users/ashraf-bhuiyan/repos", "events_url": "https://api.github.com/users/ashraf-bhuiyan/events{/privacy}", "received_events_url": "https://api.github.com/users/ashraf-bhuiyan/received_events", "type": "User", "site_admin": false}, "created_at": "2018-08-17T23:34:08Z", "updated_at": "2018-08-17T23:38:01Z", "author_association": "CONTRIBUTOR", "body_html": "<blockquote>\n<p>Could you please add a test case (some node pointing to Pad and Conv2D and some node that both Pad and Conv2D both point to) for this as well?</p>\n</blockquote>\n<p>Sure, I have added actually two unit tests, which seemed required.<br>\na) one test for one node pointing to Pad and conv2d. The test name is : (MklLayoutPassTest, NodeMerge_PadWithConv2D_Common_Input)<br>\nb) The other test (MklLayoutPassTest, NodeMerge_PadWithConv2D_Common_InOutput) is common input for pad and conv2d and output from both pad and conv2d go to one node (Output2).  In this case pad and conv2d were not fused correctly, as checked and explained in <a href=\"https://github.com/Intel-tensorflow/tensorflow/blob/f6c9e054a042bf0f518a740380f3f96a28e8c5be/tensorflow/core/graph/mkl_layout_pass.cc#L4144\">https://github.com/Intel-tensorflow/tensorflow/blob/f6c9e054a042bf0f518a740380f3f96a28e8c5be/tensorflow/core/graph/mkl_layout_pass.cc#L4144</a>. In short, if pad output is going to another node other than conv2d, then if we merge, we lost that pad output. the unit test successfully test this scenario.</p>", "body_text": "Could you please add a test case (some node pointing to Pad and Conv2D and some node that both Pad and Conv2D both point to) for this as well?\n\nSure, I have added actually two unit tests, which seemed required.\na) one test for one node pointing to Pad and conv2d. The test name is : (MklLayoutPassTest, NodeMerge_PadWithConv2D_Common_Input)\nb) The other test (MklLayoutPassTest, NodeMerge_PadWithConv2D_Common_InOutput) is common input for pad and conv2d and output from both pad and conv2d go to one node (Output2).  In this case pad and conv2d were not fused correctly, as checked and explained in https://github.com/Intel-tensorflow/tensorflow/blob/f6c9e054a042bf0f518a740380f3f96a28e8c5be/tensorflow/core/graph/mkl_layout_pass.cc#L4144. In short, if pad output is going to another node other than conv2d, then if we merge, we lost that pad output. the unit test successfully test this scenario.", "body": "> Could you please add a test case (some node pointing to Pad and Conv2D and some node that both Pad and Conv2D both point to) for this as well?\r\n\r\nSure, I have added actually two unit tests, which seemed required.\r\na) one test for one node pointing to Pad and conv2d. The test name is : (MklLayoutPassTest, NodeMerge_PadWithConv2D_Common_Input)\r\nb) The other test (MklLayoutPassTest, NodeMerge_PadWithConv2D_Common_InOutput) is common input for pad and conv2d and output from both pad and conv2d go to one node (Output2).  In this case pad and conv2d were not fused correctly, as checked and explained in https://github.com/Intel-tensorflow/tensorflow/blob/f6c9e054a042bf0f518a740380f3f96a28e8c5be/tensorflow/core/graph/mkl_layout_pass.cc#L4144. In short, if pad output is going to another node other than conv2d, then if we merge, we lost that pad output. the unit test successfully test this scenario.\r\n  "}