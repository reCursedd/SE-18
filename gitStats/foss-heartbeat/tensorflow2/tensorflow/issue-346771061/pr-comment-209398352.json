{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/209398352", "pull_request_review_id": 145414939, "id": 209398352, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwOTM5ODM1Mg==", "diff_hunk": "@@ -2508,6 +2511,8 @@ class MklLayoutRewritePass : public GraphOptimizationPass {\n     rinfo_.push_back({csinfo_.mul,\n                       mkl_op_registry::GetMklOpName(csinfo_.mul),\n                       CopyAttrsDataType, AlwaysRewrite});\n+    rinfo_.push_back({csinfo_.pad_with_conv2d, csinfo_.mkl_pad_with_conv2d,", "path": "tensorflow/core/graph/mkl_layout_pass.cc", "position": 14, "original_position": 14, "commit_id": "48809b87793882266f01b7b40bc9e4a6e0f18f57", "original_commit_id": "dd63093a599081accfe2a2d2ca8c029d413a15d7", "user": {"login": "ashraf-bhuiyan", "id": 8062406, "node_id": "MDQ6VXNlcjgwNjI0MDY=", "avatar_url": "https://avatars2.githubusercontent.com/u/8062406?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ashraf-bhuiyan", "html_url": "https://github.com/ashraf-bhuiyan", "followers_url": "https://api.github.com/users/ashraf-bhuiyan/followers", "following_url": "https://api.github.com/users/ashraf-bhuiyan/following{/other_user}", "gists_url": "https://api.github.com/users/ashraf-bhuiyan/gists{/gist_id}", "starred_url": "https://api.github.com/users/ashraf-bhuiyan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ashraf-bhuiyan/subscriptions", "organizations_url": "https://api.github.com/users/ashraf-bhuiyan/orgs", "repos_url": "https://api.github.com/users/ashraf-bhuiyan/repos", "events_url": "https://api.github.com/users/ashraf-bhuiyan/events{/privacy}", "received_events_url": "https://api.github.com/users/ashraf-bhuiyan/received_events", "type": "User", "site_admin": false}, "body": "Actually I used csinfo._pad_with_conv2d for __MklDummyPadWithConv2D, and csinfo._mkl_pad_with_conv2d for _MklPadWithConv2D. Here, we have a dummy Mkl node (__MklDummyPadWithConv2D) when we merge pad and conv2d nodes. Then this dummy Mkl node is replaced by actual Mkl merged node _MklPadWithConv2D. This dummy node is needed only for merged node. Unmerged node does not need dummy node. If we try to use mkl_op_registry::GetMklOpName(csinfo_.mkl_pad_with_conv2d), then it will produce node name as _Mkl__MklPadWithConv2D, which is not intended. We here follow the same convention as the merging of conv2d+Bias as seen: https://github.com/Intel-tensorflow/tensorflow/blob/dd63093a599081accfe2a2d2ca8c029d413a15d7/tensorflow/core/graph/mkl_layout_pass.cc#L2475 ", "created_at": "2018-08-10T22:26:58Z", "updated_at": "2018-11-23T19:46:17Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/21318#discussion_r209398352", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/21318", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/209398352"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/21318#discussion_r209398352"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/21318"}}, "body_html": "<p>Actually I used csinfo._pad_with_conv2d for __MklDummyPadWithConv2D, and csinfo._mkl_pad_with_conv2d for _MklPadWithConv2D. Here, we have a dummy Mkl node (__MklDummyPadWithConv2D) when we merge pad and conv2d nodes. Then this dummy Mkl node is replaced by actual Mkl merged node <em>MklPadWithConv2D. This dummy node is needed only for merged node. Unmerged node does not need dummy node. If we try to use mkl_op_registry::GetMklOpName(csinfo</em>.mkl_pad_with_conv2d), then it will produce node name as _Mkl__MklPadWithConv2D, which is not intended. We here follow the same convention as the merging of conv2d+Bias as seen: <a href=\"https://github.com/Intel-tensorflow/tensorflow/blob/dd63093a599081accfe2a2d2ca8c029d413a15d7/tensorflow/core/graph/mkl_layout_pass.cc#L2475\">https://github.com/Intel-tensorflow/tensorflow/blob/dd63093a599081accfe2a2d2ca8c029d413a15d7/tensorflow/core/graph/mkl_layout_pass.cc#L2475</a></p>", "body_text": "Actually I used csinfo._pad_with_conv2d for __MklDummyPadWithConv2D, and csinfo._mkl_pad_with_conv2d for _MklPadWithConv2D. Here, we have a dummy Mkl node (__MklDummyPadWithConv2D) when we merge pad and conv2d nodes. Then this dummy Mkl node is replaced by actual Mkl merged node MklPadWithConv2D. This dummy node is needed only for merged node. Unmerged node does not need dummy node. If we try to use mkl_op_registry::GetMklOpName(csinfo.mkl_pad_with_conv2d), then it will produce node name as _Mkl__MklPadWithConv2D, which is not intended. We here follow the same convention as the merging of conv2d+Bias as seen: https://github.com/Intel-tensorflow/tensorflow/blob/dd63093a599081accfe2a2d2ca8c029d413a15d7/tensorflow/core/graph/mkl_layout_pass.cc#L2475", "in_reply_to_id": 207693564}