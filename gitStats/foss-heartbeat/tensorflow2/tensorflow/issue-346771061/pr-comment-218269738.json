{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/218269738", "pull_request_review_id": 156164852, "id": 218269738, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxODI2OTczOA==", "diff_hunk": "@@ -2359,6 +2369,107 @@ TEST_F(MklLayoutPassTest, NodeMerge_PadWithConv2D_Positive) {\n             \"A:control->DMT/_2:control;B->E:2;D->E:1;DMT/_0->E:3;DMT/_1->E:4;\"\n             \"DMT/_2->E:5;E->Z;Y->Z:1\");\n }\n+// Test if input control edges do not duplicate after merge.\n+// If both the merging ops have input control edge from a common op\n+// then, the merged op will have only one control edge from that \n+// common op.\n+// padding is VALID type\n+// A = input(image), A1 = input, B = input(paddings), \n+// C= Pad = input of conv2D,\n+// D=input(filter), E = Conv2D, Z = Zeta\n+// C=Pad(A,B); E=Conv2D(C,D); Z=Zeta(E,Y)\n+// C:control->A1:control\n+// E:control->A1:control\n+// After layout pass\n+// _MklPadWithConv2D(A, D, B, DMT/_0, DMT/_1, DMT/_2)\n+// A1:control->E:control\n+TEST_F(MklLayoutPassTest, Input_ControlEdge_PadWithConv2D_Positive) {\n+  CHECK_EQ(kTensorOrdering, MklTfTensorOrdering::TENSORS_CONTIGUOUS);\n+  InitGraph(\n+      \"node { name: 'A1' op: 'Input'}\"\n+      \"node { name: 'A' op: 'Input'}\"\n+      \"node { name: 'B' op: 'Int32Input'}\"\n+      \"node { name: 'C' op: 'Pad'\"\n+      \" attr { key: 'T'                value { type: DT_FLOAT } }\"\n+      \" attr { key: 'Tpaddings'        value { type: DT_INT32 } }\"\n+      \" input: ['A', 'B']}\"\n+      \"node { name: 'D' op: 'Input'}\"\n+      \"node { name: 'E' op: 'Conv2D'\"\n+      \" attr { key: 'T'                value { type: DT_FLOAT } }\"\n+      \" attr { key: 'data_format'      value { s: 'NHWC' } }\"\n+      \" attr { key: 'use_cudnn_on_gpu' value { b: false } }\"\n+      \" attr { key: 'strides'          value { list: {i: 1, i:1, i:1, i:1} } }\"\n+      \" attr { key: 'padding'          value { s: 'VALID' } }\"\n+      \" attr { key: 'dilations'        value { list: {i: 1, i:1, i:1, i:1} } }\"\n+      \" input: ['C', 'D'] }\"\n+      \"node { name: 'Y' op: 'Input'}\"\n+      \"node { name: 'Z' op: 'Zeta'\"\n+      \" attr {key: 'T'                 value { type: DT_FLOAT } }\"\n+      \" input: ['E', 'Y']}\");\n+  Node* a1 = FindNode(\"A1\");\n+  Node* c = FindNode(\"C\");\n+  Node* e = FindNode(\"E\");\n+  const Edge* edge = graph_.AddControlEdge(a1, c);\n+  const Edge* edge_1 = graph_.AddControlEdge(a1, e);\n+  ASSERT_TRUE(edge != nullptr);\n+  ASSERT_TRUE(edge_1 != nullptr);", "path": "tensorflow/core/graph/mkl_layout_pass_test.cc", "position": null, "original_position": 71, "commit_id": "48809b87793882266f01b7b40bc9e4a6e0f18f57", "original_commit_id": "4e140eed6b4f6722b94cf85432d4519b8c5ce0bf", "user": {"login": "penpornk", "id": 38085909, "node_id": "MDQ6VXNlcjM4MDg1OTA5", "avatar_url": "https://avatars3.githubusercontent.com/u/38085909?v=4", "gravatar_id": "", "url": "https://api.github.com/users/penpornk", "html_url": "https://github.com/penpornk", "followers_url": "https://api.github.com/users/penpornk/followers", "following_url": "https://api.github.com/users/penpornk/following{/other_user}", "gists_url": "https://api.github.com/users/penpornk/gists{/gist_id}", "starred_url": "https://api.github.com/users/penpornk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/penpornk/subscriptions", "organizations_url": "https://api.github.com/users/penpornk/orgs", "repos_url": "https://api.github.com/users/penpornk/repos", "events_url": "https://api.github.com/users/penpornk/events{/privacy}", "received_events_url": "https://api.github.com/users/penpornk/received_events", "type": "User", "site_admin": false}, "body": "Please use `ASSERT_NE`.", "created_at": "2018-09-18T00:36:05Z", "updated_at": "2018-11-23T19:46:17Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/21318#discussion_r218269738", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/21318", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/218269738"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/21318#discussion_r218269738"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/21318"}}, "body_html": "<p>Please use <code>ASSERT_NE</code>.</p>", "body_text": "Please use ASSERT_NE."}