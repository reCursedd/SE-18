{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/103517628", "pull_request_review_id": 24306976, "id": 103517628, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEwMzUxNzYyOA==", "diff_hunk": "@@ -321,21 +321,24 @@ def _BroadcastMul(vec, mat):\n \n \n @ops.RegisterGradient(\"SoftmaxCrossEntropyWithLogits\")\n-def _SoftmaxCrossEntropyWithLogitsGrad(op, grad_0, _):\n+def _SoftmaxCrossEntropyWithLogitsGrad(op, grad_0, grad_1):\n   \"\"\"Gradient function for SoftmaxCrossEntropyWithLogits.\"\"\"\n   # grad_0 is the backprop for cost, and we multiply it with the gradients\n   # (which is output[1])\n+  # grad_1 is the backprop for softmax gradient.\n   # There is no gradient for the labels\n   #\n-  # Currently there is no way to take the second derivative of this op\n-  # due to the fused implementation's interaction with tf.gradients(),\n-  # so we make sure we prevent silently incorrect results by raising\n-  # an error if the second derivative is requested via prevent_gradient.\n-  softmax_grad_without_gradient = array_ops.prevent_gradient(\n-      op.outputs[1], message=\"Currently there is no way to take the second \"\n-      \"derivative of softmax_cross_entropy_with_logits due to the fused \"\n-      \" implementation's interaction with tf.gradients()\")\n-  return _BroadcastMul(grad_0, softmax_grad_without_gradient), None\n+  # Second derivative is just softmax derivative w.r.t. logits.\n+  softmax_grad = op.outputs[1]\n+  grad = _BroadcastMul(grad_0, softmax_grad)\n+\n+  if grad_1.op.type not in ('ZerosLike', 'Zeros'):  # or `in ('Zeros', 'ZerosLike')`", "path": "tensorflow/python/ops/nn_grad.py", "position": null, "original_position": 25, "commit_id": "b1a0d86b9673ee06fe670b4c0cef312b801860a2", "original_commit_id": "686cb56edec6e2f3762ede90076b9e58323a7c58", "user": {"login": "girving", "id": 70511, "node_id": "MDQ6VXNlcjcwNTEx", "avatar_url": "https://avatars1.githubusercontent.com/u/70511?v=4", "gravatar_id": "", "url": "https://api.github.com/users/girving", "html_url": "https://github.com/girving", "followers_url": "https://api.github.com/users/girving/followers", "following_url": "https://api.github.com/users/girving/following{/other_user}", "gists_url": "https://api.github.com/users/girving/gists{/gist_id}", "starred_url": "https://api.github.com/users/girving/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/girving/subscriptions", "organizations_url": "https://api.github.com/users/girving/orgs", "repos_url": "https://api.github.com/users/girving/repos", "events_url": "https://api.github.com/users/girving/events{/privacy}", "received_events_url": "https://api.github.com/users/girving/received_events", "type": "User", "site_admin": false}, "body": "Remove the obsolete comment.", "created_at": "2017-02-28T18:09:43Z", "updated_at": "2017-03-01T07:35:51Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/7948#discussion_r103517628", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/7948", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/103517628"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/7948#discussion_r103517628"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/7948"}}, "body_html": "<p>Remove the obsolete comment.</p>", "body_text": "Remove the obsolete comment."}