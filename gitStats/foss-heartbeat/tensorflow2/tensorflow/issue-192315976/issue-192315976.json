{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5938", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5938/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5938/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5938/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/5938", "id": 192315976, "node_id": "MDU6SXNzdWUxOTIzMTU5NzY=", "number": 5938, "title": "Saved model by TensorForestEstimator can not be freezed", "user": {"login": "ManSoSec", "id": 10654684, "node_id": "MDQ6VXNlcjEwNjU0Njg0", "avatar_url": "https://avatars2.githubusercontent.com/u/10654684?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ManSoSec", "html_url": "https://github.com/ManSoSec", "followers_url": "https://api.github.com/users/ManSoSec/followers", "following_url": "https://api.github.com/users/ManSoSec/following{/other_user}", "gists_url": "https://api.github.com/users/ManSoSec/gists{/gist_id}", "starred_url": "https://api.github.com/users/ManSoSec/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ManSoSec/subscriptions", "organizations_url": "https://api.github.com/users/ManSoSec/orgs", "repos_url": "https://api.github.com/users/ManSoSec/repos", "events_url": "https://api.github.com/users/ManSoSec/events{/privacy}", "received_events_url": "https://api.github.com/users/ManSoSec/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 14, "created_at": "2016-11-29T15:40:16Z", "updated_at": "2018-01-29T22:38:43Z", "closed_at": "2018-01-29T22:38:43Z", "author_association": "NONE", "body_html": "<h3>What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?</h3>\n<p>I asked a question in stackoverflow, but I guess it is a bug or inconsistency in tensorflow.</p>\n<p><a href=\"http://stackoverflow.com/questions/40849477/error-in-saving-and-using-model-of-tensorforestestimator-for-android\" rel=\"nofollow\">http://stackoverflow.com/questions/40849477/error-in-saving-and-using-model-of-tensorforestestimator-for-android</a></p>\n<h3>Environment info</h3>\n<p>Operating System:</p>\n<p>Mac OSX 10.10.2<br>\nPython 2.7.12</p>\n<p>If installed from binary pip package, provide:</p>\n<ol>\n<li>A link to the pip package you installed: <a href=\"https://storage.googleapis.com/tensorflow/mac/cpu/tensorflow-0.12.0rc0-py2-none-any.whl\" rel=\"nofollow\">https://storage.googleapis.com/tensorflow/mac/cpu/tensorflow-0.12.0rc0-py2-none-any.whl</a></li>\n<li>The output from <code>python -c \"import tensorflow; print(tensorflow.__version__)\"</code>. Version: 0.12.0-rc0</li>\n</ol>\n<h3>If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)</h3>\n<p>import tensorflow as tf<br>\nimport numpy as np<br>\nfrom freeze_graph import freeze_graph<br>\nimport os<br>\nfrom tensorflow.contrib.learn.python.learn.estimators.random_forest import TensorForestEstimator</p>\n<h1>Creating the model and saving:</h1>\n<p>hparams = tf.contrib.tensor_forest.python.tensor_forest.ForestHParams(<br>\nnum_trees=3, max_nodes=1000, num_classes=3, num_features=4)<br>\nclassifier = TensorForestEstimator(hparams, model_dir='test/')<br>\niris = tf.contrib.learn.datasets.load_iris()<br>\ndata = iris.data.astype(np.float32)<br>\ntarget = iris.target.astype(np.float32)<br>\nclassifier.fit(x=data, y=target, steps=100)</p>\n<h1>Freezing the model:</h1>\n<p>model_name = 'test/'<br>\ncheckpoint_state_name = \"checkpoint\"<br>\ninput_graph_name = \"graph.pbtxt\"<br>\noutput_graph_name = \"newgraph.pb\"<br>\ninput_graph_path = os.path.join(model_name, input_graph_name)<br>\ninput_saver_def_path = model_name<br>\ninput_binary = False<br>\ninput_checkpoint_path = os.path.join(model_name, checkpoint_state_name)<br>\noutput_node_names = \"sample\"<br>\nrestore_op_name = \"save/restore_all\"<br>\nfilename_tensor_name = \"save/Const:0\"<br>\noutput_graph_path = os.path.join(model_name, output_graph_name)<br>\nclear_devices = True<br>\nfreeze_graph(input_graph_path, input_saver_def_path,<br>\ninput_binary, input_checkpoint_path,<br>\noutput_node_names, restore_op_name,<br>\nfilename_tensor_name, output_graph_path,<br>\nclear_devices, \"\")</p>\n<h3>Logs or other output that would be helpful</h3>\n<p>(If logs are large, please upload as attachment or provide link).</p>\n<p>The code can create and save the model perfectly (I can open the graph by tensorboard), but I get the following error for freezing the graph:</p>\n<p>Traceback (most recent call last):<br>\nFile \"/XXXXX/model/test.py\", line 41, in <br>\nclear_devices, \"\")<br>\nFile \"/XXXXX/model/freeze_graph.py\", line 99, in freeze_graph<br>\n_ = tf.import_graph_def(input_graph_def, name=\"\")<br>\nFile \"/XXXXX/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 258, in import_graph_def<br>\nop_def = op_dict[node.op]<br>\nKeyError: u'TreePredictions'</p>\n<p>When I am building the model, I get the following warning:</p>\n<p>Estimator is decoupled from Scikit Learn interface by moving into<br>\nseparate class SKCompat. Arguments x, y and batch_size are only<br>\navailable in the SKCompat class, Estimator will only accept input_fn.<br>\nExample conversion:<br>\nest = Estimator(...) -&gt; est = SKCompat(Estimator(...))<br>\nWARNING:tensorflow:*******************************************************<br>\nWARNING:tensorflow:TensorFlow's V1 checkpoint format has been deprecated.<br>\nWARNING:tensorflow:Consider switching to the more efficient V2 format:<br>\nWARNING:tensorflow:   <code>tf.train.Saver(write_version=tf.train.SaverDef.V2)</code><br>\nWARNING:tensorflow:now on by default.<br>\nWARNING:tensorflow:*******************************************************<br>\nWARNING:tensorflow:*******************************************************<br>\nWARNING:tensorflow:TensorFlow's V1 checkpoint format has been deprecated.<br>\nWARNING:tensorflow:Consider switching to the more efficient V2 format:<br>\nWARNING:tensorflow:   <code>tf.train.Saver(write_version=tf.train.SaverDef.V2)</code><br>\nWARNING:tensorflow:now on by default.<br>\nWARNING:tensorflow:*******************************************************</p>", "body_text": "What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\nI asked a question in stackoverflow, but I guess it is a bug or inconsistency in tensorflow.\nhttp://stackoverflow.com/questions/40849477/error-in-saving-and-using-model-of-tensorforestestimator-for-android\nEnvironment info\nOperating System:\nMac OSX 10.10.2\nPython 2.7.12\nIf installed from binary pip package, provide:\n\nA link to the pip package you installed: https://storage.googleapis.com/tensorflow/mac/cpu/tensorflow-0.12.0rc0-py2-none-any.whl\nThe output from python -c \"import tensorflow; print(tensorflow.__version__)\". Version: 0.12.0-rc0\n\nIf possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\nimport tensorflow as tf\nimport numpy as np\nfrom freeze_graph import freeze_graph\nimport os\nfrom tensorflow.contrib.learn.python.learn.estimators.random_forest import TensorForestEstimator\nCreating the model and saving:\nhparams = tf.contrib.tensor_forest.python.tensor_forest.ForestHParams(\nnum_trees=3, max_nodes=1000, num_classes=3, num_features=4)\nclassifier = TensorForestEstimator(hparams, model_dir='test/')\niris = tf.contrib.learn.datasets.load_iris()\ndata = iris.data.astype(np.float32)\ntarget = iris.target.astype(np.float32)\nclassifier.fit(x=data, y=target, steps=100)\nFreezing the model:\nmodel_name = 'test/'\ncheckpoint_state_name = \"checkpoint\"\ninput_graph_name = \"graph.pbtxt\"\noutput_graph_name = \"newgraph.pb\"\ninput_graph_path = os.path.join(model_name, input_graph_name)\ninput_saver_def_path = model_name\ninput_binary = False\ninput_checkpoint_path = os.path.join(model_name, checkpoint_state_name)\noutput_node_names = \"sample\"\nrestore_op_name = \"save/restore_all\"\nfilename_tensor_name = \"save/Const:0\"\noutput_graph_path = os.path.join(model_name, output_graph_name)\nclear_devices = True\nfreeze_graph(input_graph_path, input_saver_def_path,\ninput_binary, input_checkpoint_path,\noutput_node_names, restore_op_name,\nfilename_tensor_name, output_graph_path,\nclear_devices, \"\")\nLogs or other output that would be helpful\n(If logs are large, please upload as attachment or provide link).\nThe code can create and save the model perfectly (I can open the graph by tensorboard), but I get the following error for freezing the graph:\nTraceback (most recent call last):\nFile \"/XXXXX/model/test.py\", line 41, in \nclear_devices, \"\")\nFile \"/XXXXX/model/freeze_graph.py\", line 99, in freeze_graph\n_ = tf.import_graph_def(input_graph_def, name=\"\")\nFile \"/XXXXX/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 258, in import_graph_def\nop_def = op_dict[node.op]\nKeyError: u'TreePredictions'\nWhen I am building the model, I get the following warning:\nEstimator is decoupled from Scikit Learn interface by moving into\nseparate class SKCompat. Arguments x, y and batch_size are only\navailable in the SKCompat class, Estimator will only accept input_fn.\nExample conversion:\nest = Estimator(...) -> est = SKCompat(Estimator(...))\nWARNING:tensorflow:*******************************************************\nWARNING:tensorflow:TensorFlow's V1 checkpoint format has been deprecated.\nWARNING:tensorflow:Consider switching to the more efficient V2 format:\nWARNING:tensorflow:   tf.train.Saver(write_version=tf.train.SaverDef.V2)\nWARNING:tensorflow:now on by default.\nWARNING:tensorflow:*******************************************************\nWARNING:tensorflow:*******************************************************\nWARNING:tensorflow:TensorFlow's V1 checkpoint format has been deprecated.\nWARNING:tensorflow:Consider switching to the more efficient V2 format:\nWARNING:tensorflow:   tf.train.Saver(write_version=tf.train.SaverDef.V2)\nWARNING:tensorflow:now on by default.\nWARNING:tensorflow:*******************************************************", "body": "### What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\r\nI asked a question in stackoverflow, but I guess it is a bug or inconsistency in tensorflow.\r\n\r\nhttp://stackoverflow.com/questions/40849477/error-in-saving-and-using-model-of-tensorforestestimator-for-android\r\n\r\n### Environment info\r\nOperating System:\r\n\r\nMac OSX 10.10.2\r\nPython 2.7.12\r\n\r\nIf installed from binary pip package, provide:\r\n\r\n1. A link to the pip package you installed: https://storage.googleapis.com/tensorflow/mac/cpu/tensorflow-0.12.0rc0-py2-none-any.whl\r\n2. The output from `python -c \"import tensorflow; print(tensorflow.__version__)\"`. Version: 0.12.0-rc0\r\n\r\n### If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\r\n\r\nimport tensorflow as tf\r\nimport numpy as np\r\nfrom freeze_graph import freeze_graph\r\nimport os\r\nfrom tensorflow.contrib.learn.python.learn.estimators.random_forest import TensorForestEstimator\r\n\r\nCreating the model and saving:\r\n=========================\r\nhparams = tf.contrib.tensor_forest.python.tensor_forest.ForestHParams(\r\n        num_trees=3, max_nodes=1000, num_classes=3, num_features=4)\r\nclassifier = TensorForestEstimator(hparams, model_dir='test/')\r\niris = tf.contrib.learn.datasets.load_iris()\r\ndata = iris.data.astype(np.float32)\r\ntarget = iris.target.astype(np.float32)\r\nclassifier.fit(x=data, y=target, steps=100)\r\n\r\nFreezing the model:\r\n=========================\r\nmodel_name = 'test/'\r\ncheckpoint_state_name = \"checkpoint\"\r\ninput_graph_name = \"graph.pbtxt\"\r\noutput_graph_name = \"newgraph.pb\"\r\ninput_graph_path = os.path.join(model_name, input_graph_name)\r\ninput_saver_def_path = model_name\r\ninput_binary = False\r\ninput_checkpoint_path = os.path.join(model_name, checkpoint_state_name)\r\noutput_node_names = \"sample\"\r\nrestore_op_name = \"save/restore_all\"\r\nfilename_tensor_name = \"save/Const:0\"\r\noutput_graph_path = os.path.join(model_name, output_graph_name)\r\nclear_devices = True\r\nfreeze_graph(input_graph_path, input_saver_def_path,\r\n                          input_binary, input_checkpoint_path,\r\n                          output_node_names, restore_op_name,\r\n                          filename_tensor_name, output_graph_path,\r\n                          clear_devices, \"\")\r\n\r\n### Logs or other output that would be helpful\r\n(If logs are large, please upload as attachment or provide link).\r\n\r\nThe code can create and save the model perfectly (I can open the graph by tensorboard), but I get the following error for freezing the graph:\r\n\r\nTraceback (most recent call last):\r\n  File \"/XXXXX/model/test.py\", line 41, in <module>\r\n    clear_devices, \"\")\r\n  File \"/XXXXX/model/freeze_graph.py\", line 99, in freeze_graph\r\n    _ = tf.import_graph_def(input_graph_def, name=\"\")\r\n  File \"/XXXXX/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 258, in import_graph_def\r\n    op_def = op_dict[node.op]\r\nKeyError: u'TreePredictions'\r\n\r\nWhen I am building the model, I get the following warning:\r\n\r\nEstimator is decoupled from Scikit Learn interface by moving into\r\nseparate class SKCompat. Arguments x, y and batch_size are only\r\navailable in the SKCompat class, Estimator will only accept input_fn.\r\nExample conversion:\r\n  est = Estimator(...) -> est = SKCompat(Estimator(...))\r\nWARNING:tensorflow:*******************************************************\r\nWARNING:tensorflow:TensorFlow's V1 checkpoint format has been deprecated.\r\nWARNING:tensorflow:Consider switching to the more efficient V2 format:\r\nWARNING:tensorflow:   `tf.train.Saver(write_version=tf.train.SaverDef.V2)`\r\nWARNING:tensorflow:now on by default.\r\nWARNING:tensorflow:*******************************************************\r\nWARNING:tensorflow:*******************************************************\r\nWARNING:tensorflow:TensorFlow's V1 checkpoint format has been deprecated.\r\nWARNING:tensorflow:Consider switching to the more efficient V2 format:\r\nWARNING:tensorflow:   `tf.train.Saver(write_version=tf.train.SaverDef.V2)`\r\nWARNING:tensorflow:now on by default.\r\nWARNING:tensorflow:*******************************************************\r\n\r\n\r\n"}