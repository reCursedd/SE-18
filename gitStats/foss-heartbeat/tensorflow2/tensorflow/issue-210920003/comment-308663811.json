{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/308663811", "html_url": "https://github.com/tensorflow/tensorflow/issues/7951#issuecomment-308663811", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7951", "id": 308663811, "node_id": "MDEyOklzc3VlQ29tbWVudDMwODY2MzgxMQ==", "user": {"login": "EdeMeijer", "id": 5758565, "node_id": "MDQ6VXNlcjU3NTg1NjU=", "avatar_url": "https://avatars0.githubusercontent.com/u/5758565?v=4", "gravatar_id": "", "url": "https://api.github.com/users/EdeMeijer", "html_url": "https://github.com/EdeMeijer", "followers_url": "https://api.github.com/users/EdeMeijer/followers", "following_url": "https://api.github.com/users/EdeMeijer/following{/other_user}", "gists_url": "https://api.github.com/users/EdeMeijer/gists{/gist_id}", "starred_url": "https://api.github.com/users/EdeMeijer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/EdeMeijer/subscriptions", "organizations_url": "https://api.github.com/users/EdeMeijer/orgs", "repos_url": "https://api.github.com/users/EdeMeijer/repos", "events_url": "https://api.github.com/users/EdeMeijer/events{/privacy}", "received_events_url": "https://api.github.com/users/EdeMeijer/received_events", "type": "User", "site_admin": false}, "created_at": "2017-06-15T08:23:22Z", "updated_at": "2017-06-15T08:23:22Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=10807796\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/winston-li\">@winston-li</a> seeing \"?\" as shape is because at that point you're looking at the 'static' shape of the tensor, which isn't always defined (the graph doesn't know in advance how many examples there will be). However, <code>tf.shape()</code> evaluates the dynamic, real-time shape of a tensor, so I thought this should work.</p>\n<p>Anyway, I tried creating a minimal example, but I'm getting internal kernel errors when my filter excludes any element, so for starters I opened <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"236112059\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/10725\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/10725/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/10725\">#10725</a>. However, what I <strong>did</strong> find was that, obviously, we should use Tensorflow ops instead of standard comparisons since the result of <code>tf.shape()</code> is a tensor and not a normal array.</p>\n<p>My tf version's filter is broken, but if yours works could you try this instead?</p>\n<div class=\"highlight highlight-source-python\"><pre>dataset <span class=\"pl-k\">=</span> dataset.filter(<span class=\"pl-k\">lambda</span> <span class=\"pl-smi\">imgs</span>, <span class=\"pl-smi\">lbls</span>: tf.equal(tf.shape(imgs)[<span class=\"pl-c1\">0</span>], <span class=\"pl-c1\">BATCH_SIZE</span>))</pre></div>", "body_text": "@winston-li seeing \"?\" as shape is because at that point you're looking at the 'static' shape of the tensor, which isn't always defined (the graph doesn't know in advance how many examples there will be). However, tf.shape() evaluates the dynamic, real-time shape of a tensor, so I thought this should work.\nAnyway, I tried creating a minimal example, but I'm getting internal kernel errors when my filter excludes any element, so for starters I opened #10725. However, what I did find was that, obviously, we should use Tensorflow ops instead of standard comparisons since the result of tf.shape() is a tensor and not a normal array.\nMy tf version's filter is broken, but if yours works could you try this instead?\ndataset = dataset.filter(lambda imgs, lbls: tf.equal(tf.shape(imgs)[0], BATCH_SIZE))", "body": "@winston-li seeing \"?\" as shape is because at that point you're looking at the 'static' shape of the tensor, which isn't always defined (the graph doesn't know in advance how many examples there will be). However, `tf.shape()` evaluates the dynamic, real-time shape of a tensor, so I thought this should work.\r\n\r\nAnyway, I tried creating a minimal example, but I'm getting internal kernel errors when my filter excludes any element, so for starters I opened https://github.com/tensorflow/tensorflow/issues/10725. However, what I **did** find was that, obviously, we should use Tensorflow ops instead of standard comparisons since the result of `tf.shape()` is a tensor and not a normal array.\r\n\r\nMy tf version's filter is broken, but if yours works could you try this instead?\r\n\r\n```python\r\ndataset = dataset.filter(lambda imgs, lbls: tf.equal(tf.shape(imgs)[0], BATCH_SIZE))\r\n```"}