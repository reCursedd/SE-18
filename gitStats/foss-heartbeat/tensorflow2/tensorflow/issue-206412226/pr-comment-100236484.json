{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/100236484", "pull_request_review_id": 20935789, "id": 100236484, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEwMDIzNjQ4NA==", "diff_hunk": "@@ -1243,6 +1243,31 @@ TEST_F(BufferAssignmentTest, OneTempAllocation) {\n   }\n }\n \n+// TODO(b/34669761): Remove this test when buffers are allowed to share\n+// allocations.\n+TEST_F(BufferAssignmentTest, TupleBufferNotReused) {\n+  // Test a computation that returns a tuple parameter.\n+  auto builder = HloComputation::Builder(TestName());\n+  auto scalar_shape = ShapeUtil::MakeShape(F32, {});\n+  auto param = builder.AddInstruction(\n+      HloInstruction::CreateParameter(0, scalar_shape, \"param0\"));\n+  auto tuple = builder.AddInstruction(HloInstruction::CreateTuple({param}));\n+  auto tuple_element = builder.AddInstruction(\n+      HloInstruction::CreateGetTupleElement(scalar_shape, tuple, 0));\n+  auto copy = builder.AddInstruction(HloInstruction::CreateUnary(\n+      scalar_shape, HloOpcode::kCopy, tuple_element));\n+\n+  auto module = MakeUnique<HloModule>(TestName());\n+  module->AddEntryComputation(builder.Build());\n+  auto assignment = RunBufferAssignment(module.get());\n+\n+  // There should be no buffer reuse. The copy should not reuse the tuple\n+  // buffer.\n+  EXPECT_EQ(3, assignment->Allocations().size());\n+  EXPECT_NE(GetTopLevelAllocation(*assignment, tuple),\n+            GetTopLevelAllocation(*assignment, copy));\n+}\n+", "path": "tensorflow/compiler/xla/service/buffer_assignment_test.cc", "position": null, "original_position": 28, "commit_id": "a5b7c0359301612ae8b65b7e211c553c74565f4f", "original_commit_id": "9b203959f33570a2e8618f6a486b874f882de10b", "user": {"login": "tatatodd", "id": 5453737, "node_id": "MDQ6VXNlcjU0NTM3Mzc=", "avatar_url": "https://avatars3.githubusercontent.com/u/5453737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tatatodd", "html_url": "https://github.com/tatatodd", "followers_url": "https://api.github.com/users/tatatodd/followers", "following_url": "https://api.github.com/users/tatatodd/following{/other_user}", "gists_url": "https://api.github.com/users/tatatodd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tatatodd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tatatodd/subscriptions", "organizations_url": "https://api.github.com/users/tatatodd/orgs", "repos_url": "https://api.github.com/users/tatatodd/repos", "events_url": "https://api.github.com/users/tatatodd/events{/privacy}", "received_events_url": "https://api.github.com/users/tatatodd/received_events", "type": "User", "site_admin": false}, "body": "The addition of this block of code isn't right.  It's duplicating the existing code in lines 1153-1176", "created_at": "2017-02-09T06:10:45Z", "updated_at": "2017-02-09T07:15:45Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/7377#discussion_r100236484", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/7377", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/100236484"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/7377#discussion_r100236484"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/7377"}}, "body_html": "<p>The addition of this block of code isn't right.  It's duplicating the existing code in lines 1153-1176</p>", "body_text": "The addition of this block of code isn't right.  It's duplicating the existing code in lines 1153-1176"}