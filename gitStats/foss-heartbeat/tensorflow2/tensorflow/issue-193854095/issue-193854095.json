{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6124", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6124/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6124/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6124/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/6124", "id": 193854095, "node_id": "MDU6SXNzdWUxOTM4NTQwOTU=", "number": 6124, "title": "Using Boolean Placeholder for is_training Causes Problems when Loading on iOS", "user": {"login": "cancan101", "id": 51059, "node_id": "MDQ6VXNlcjUxMDU5", "avatar_url": "https://avatars1.githubusercontent.com/u/51059?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cancan101", "html_url": "https://github.com/cancan101", "followers_url": "https://api.github.com/users/cancan101/followers", "following_url": "https://api.github.com/users/cancan101/following{/other_user}", "gists_url": "https://api.github.com/users/cancan101/gists{/gist_id}", "starred_url": "https://api.github.com/users/cancan101/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cancan101/subscriptions", "organizations_url": "https://api.github.com/users/cancan101/orgs", "repos_url": "https://api.github.com/users/cancan101/repos", "events_url": "https://api.github.com/users/cancan101/events{/privacy}", "received_events_url": "https://api.github.com/users/cancan101/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473184161, "node_id": "MDU6TGFiZWw0NzMxODQxNjE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:support", "name": "type:support", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2016-12-06T18:52:47Z", "updated_at": "2018-05-10T18:03:43Z", "closed_at": "2017-06-16T20:27:07Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Currently I am training a model that uses Batch Normalization and Dropout. Because of this I build the model to take a placeholder, <code>is_training</code>, that I can feed_dict true or false depending on whether the graph is being used for training or validation.</p>\n<p>I take the trained model and export using <code>tensorflow.contrib.session_bundle.exporter</code> however when I try to load this graph on iOS, I run into problems (see <a href=\"http://stackoverflow.com/questions/40855271/no-opkernel-was-registered-to-support-op-switch-with-these-attrs-on-ios\" rel=\"nofollow\">SO</a>):</p>\n<pre><code>No OpKernel was registered to support Op 'Switch' with these attrs.\n</code></pre>\n<p>I have tried removing the placeholder and injecting the actual value of <code>False</code> for <code>is_training</code> (see <a href=\"http://stackoverflow.com/questions/40852729/permanently-inject-constant-into-tensorflow-graph-for-inference\" rel=\"nofollow\">SO</a> and <a href=\"https://github.com/tensorflow/tensorflow/issues/5919\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/5919/hovercard\">GH</a>), however the model still does not load (see <a href=\"http://stackoverflow.com/questions/40852729/permanently-inject-constant-into-tensorflow-graph-for-inference\" rel=\"nofollow\">SO</a> post):</p>\n<pre><code>Input 0 of node dropout6/cond/dropout/random_uniform/max was passed bool from dropout6/cond/Switch:1 incompatible with expected INVALID.\n</code></pre>\n<p>It seems like something is missing to clean up / recompile the graph, stripping out the training part of the graph because the <a href=\"https://github.com/tensorflow/tensorflow/issues/5919\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/5919/hovercard\">inject</a> does not seem like enough. This was one idea to solve the problem: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"192148821\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/5919\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/5919/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/5919\">#5919</a>.</p>\n<p>Right now, I can instead of using placeholder for <code>is_training</code> use constants and create the model twice, sharing weights, and then export just the validation subgraph and then load this into iOS, but the downside is that I need to instantiate the model twice into the graph.</p>\n<p>EDIT: Would be nice to not have to resort to compiling iOS with switch: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"158593397\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/2680\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/2680/hovercard?comment_id=237483554&amp;comment_type=issue_comment\" href=\"https://github.com/tensorflow/tensorflow/issues/2680#issuecomment-237483554\">#2680 (comment)</a> since that node shouldn't even be needed in the final graph. It would be nice to fully remove it from the saved graph.</p>", "body_text": "Currently I am training a model that uses Batch Normalization and Dropout. Because of this I build the model to take a placeholder, is_training, that I can feed_dict true or false depending on whether the graph is being used for training or validation.\nI take the trained model and export using tensorflow.contrib.session_bundle.exporter however when I try to load this graph on iOS, I run into problems (see SO):\nNo OpKernel was registered to support Op 'Switch' with these attrs.\n\nI have tried removing the placeholder and injecting the actual value of False for is_training (see SO and GH), however the model still does not load (see SO post):\nInput 0 of node dropout6/cond/dropout/random_uniform/max was passed bool from dropout6/cond/Switch:1 incompatible with expected INVALID.\n\nIt seems like something is missing to clean up / recompile the graph, stripping out the training part of the graph because the inject does not seem like enough. This was one idea to solve the problem: #5919.\nRight now, I can instead of using placeholder for is_training use constants and create the model twice, sharing weights, and then export just the validation subgraph and then load this into iOS, but the downside is that I need to instantiate the model twice into the graph.\nEDIT: Would be nice to not have to resort to compiling iOS with switch: #2680 (comment) since that node shouldn't even be needed in the final graph. It would be nice to fully remove it from the saved graph.", "body": "Currently I am training a model that uses Batch Normalization and Dropout. Because of this I build the model to take a placeholder, `is_training`, that I can feed_dict true or false depending on whether the graph is being used for training or validation.\r\n\r\nI take the trained model and export using `tensorflow.contrib.session_bundle.exporter` however when I try to load this graph on iOS, I run into problems (see [SO](http://stackoverflow.com/questions/40855271/no-opkernel-was-registered-to-support-op-switch-with-these-attrs-on-ios)):\r\n```\r\nNo OpKernel was registered to support Op 'Switch' with these attrs.\r\n```\r\nI have tried removing the placeholder and injecting the actual value of `False` for `is_training` (see [SO](http://stackoverflow.com/questions/40852729/permanently-inject-constant-into-tensorflow-graph-for-inference) and [GH](https://github.com/tensorflow/tensorflow/issues/5919)), however the model still does not load (see [SO](http://stackoverflow.com/questions/40852729/permanently-inject-constant-into-tensorflow-graph-for-inference) post):\r\n```\r\nInput 0 of node dropout6/cond/dropout/random_uniform/max was passed bool from dropout6/cond/Switch:1 incompatible with expected INVALID.\r\n```\r\n\r\nIt seems like something is missing to clean up / recompile the graph, stripping out the training part of the graph because the [inject](https://github.com/tensorflow/tensorflow/issues/5919) does not seem like enough. This was one idea to solve the problem: https://github.com/tensorflow/tensorflow/issues/5919.\r\n\r\nRight now, I can instead of using placeholder for `is_training` use constants and create the model twice, sharing weights, and then export just the validation subgraph and then load this into iOS, but the downside is that I need to instantiate the model twice into the graph.\r\n\r\nEDIT: Would be nice to not have to resort to compiling iOS with switch: https://github.com/tensorflow/tensorflow/issues/2680#issuecomment-237483554 since that node shouldn't even be needed in the final graph. It would be nice to fully remove it from the saved graph."}