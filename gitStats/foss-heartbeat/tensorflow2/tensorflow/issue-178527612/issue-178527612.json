{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4529", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4529/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4529/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4529/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/4529", "id": 178527612, "node_id": "MDU6SXNzdWUxNzg1Mjc2MTI=", "number": 4529, "title": "can't bazel build benchmark_model with quantization deps due to -lpthread linking error", "user": {"login": "dwightcrow", "id": 145631, "node_id": "MDQ6VXNlcjE0NTYzMQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/145631?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dwightcrow", "html_url": "https://github.com/dwightcrow", "followers_url": "https://api.github.com/users/dwightcrow/followers", "following_url": "https://api.github.com/users/dwightcrow/following{/other_user}", "gists_url": "https://api.github.com/users/dwightcrow/gists{/gist_id}", "starred_url": "https://api.github.com/users/dwightcrow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dwightcrow/subscriptions", "organizations_url": "https://api.github.com/users/dwightcrow/orgs", "repos_url": "https://api.github.com/users/dwightcrow/repos", "events_url": "https://api.github.com/users/dwightcrow/events{/privacy}", "received_events_url": "https://api.github.com/users/dwightcrow/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "andrewharp", "id": 3376817, "node_id": "MDQ6VXNlcjMzNzY4MTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/3376817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewharp", "html_url": "https://github.com/andrewharp", "followers_url": "https://api.github.com/users/andrewharp/followers", "following_url": "https://api.github.com/users/andrewharp/following{/other_user}", "gists_url": "https://api.github.com/users/andrewharp/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewharp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewharp/subscriptions", "organizations_url": "https://api.github.com/users/andrewharp/orgs", "repos_url": "https://api.github.com/users/andrewharp/repos", "events_url": "https://api.github.com/users/andrewharp/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewharp/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "andrewharp", "id": 3376817, "node_id": "MDQ6VXNlcjMzNzY4MTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/3376817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewharp", "html_url": "https://github.com/andrewharp", "followers_url": "https://api.github.com/users/andrewharp/followers", "following_url": "https://api.github.com/users/andrewharp/following{/other_user}", "gists_url": "https://api.github.com/users/andrewharp/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewharp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewharp/subscriptions", "organizations_url": "https://api.github.com/users/andrewharp/orgs", "repos_url": "https://api.github.com/users/andrewharp/repos", "events_url": "https://api.github.com/users/andrewharp/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewharp/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2016-09-22T05:48:49Z", "updated_at": "2016-09-23T04:40:45Z", "closed_at": "2016-09-23T04:40:45Z", "author_association": "NONE", "body_html": "<p>Trying to build //tensorflow/tools/benchmark:benchmark_model per instructions at this stackoveflow post <a href=\"http://stackoverflow.com/questions/37953369/tensorflow-quantized-graph-for-android\" rel=\"nofollow\">http://stackoverflow.com/questions/37953369/tensorflow-quantized-graph-for-android</a>. Am getting error that cannot find -lpthread despite my belief that lib is unneeded and best efforts to remove it.</p>\n<pre><code>external/androidndk/ndk/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin/../lib/gcc/arm-linux-androideabi/4.9/../../../../arm-linux-androideabi/bin/ld: error: cannot find -lpthread\ncollect2: error: ld returned 1 exit status\n</code></pre>\n<p>//tensorflow/tools/benchmark/BUILD cc_binary</p>\n<pre><code>deps = [\":benchmark_model_lib\",\n        \"//tensorflow/contrib/quantization/kernels:quantized_ops\",\n            ],\n</code></pre>\n<p>//tensorflow/contrib/quantization/kernels/BUILD:</p>\n<pre><code>deps = [\n    \"//tensorflow/contrib/quantization:cc_array_ops\",\n    \"//tensorflow/contrib/quantization:cc_math_ops\",\n    \"//tensorflow/contrib/quantization:cc_nn_ops\",\n    #\"//tensorflow/core\",\n    #\"//tensorflow/core:framework\",\n    #\"//tensorflow/core:lib\",\n    #\"//tensorflow/core/kernels:concat_lib_hdrs\",\n    #\"//tensorflow/core/kernels:conv_ops\",\n    #\"//tensorflow/core/kernels:eigen_helpers\",\n    #\"//tensorflow/core/kernels:ops_util\",\n    #\"//tensorflow/core/kernels:pooling_ops\",\n    \"//third_party/eigen3\",\n    \"@gemmlowp//:eight_bit_int_gemm\",\n],\n</code></pre>\n<p>Then run:<br>\n<code>bazel build -c opt --cxxopt='-std=gnu++11'--crosstool_top=//external:android/crosstool --cpu=armeabi-v7a --host_crosstool_top=@bazel_tools//tools/cpp:toolchain tensorflow/tools/benchmark:benchmark_model --verbose_failures</code></p>\n<p>Which (with following all other instructions in linked post) succeeds with the exception that it fails to link against pthread.</p>\n<p>I've tried removing -lpthread in <code>tensorflow/tensorflow.bzl</code>,  <code>tensorflow/tools/proto_text/BUILD</code>, <code>tensorflow/tools/proto_text/BUILD</code>, and <code>tensorflow/cc/BUILD</code> but this still results in -lpthread being linked to in final compilation.</p>\n<p>I've also looked at the fixes such as this one <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"120591969\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/419\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/419/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/419\">#419</a> which either remove -lpthread from google protobuf or link to the dummy lib but these seem to only apply to earlier versions of TensorFlow.</p>\n<p>Apologies if this is a basic config error, I'm new to Bazel and am pretty stuck. benchmark_model and quantize_graph both compile well independently but not yet for me when combined.</p>\n<h3>What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?</h3>\n<p><a href=\"http://stackoverflow.com/questions/37953369/tensorflow-quantized-graph-for-android\" rel=\"nofollow\">http://stackoverflow.com/questions/37953369/tensorflow-quantized-graph-for-android</a><br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"120591969\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/419\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/419/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/419\">#419</a><br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"145087956\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/protocolbuffers/protobuf/issues/1373\" data-hovercard-type=\"issue\" data-hovercard-url=\"/protocolbuffers/protobuf/issues/1373/hovercard\" href=\"https://github.com/protocolbuffers/protobuf/issues/1373\">protocolbuffers/protobuf#1373</a></p>\n<h3>Environment info</h3>\n<p>Operating System: Ubuntu 14.04</p>\n<p>Installed version of CUDA and cuDNN:<br>\n(ml) socialh@socialh:~$ echo $LD_LIBRARY_PATH<br>\n/home/socialh/cuda/lib64:/usr/local/cuda/lib64:</p>\n<p>(ml) socialh@socialh:~/otf$ ll /usr/local/cuda/lib/libcud*<br>\n-rw-r--r-- 1 root root 189170 Aug 31 15:22 /usr/local/cuda/lib/libcudadevrt.a<br>\nlrwxrwxrwx 1 root root     16 Aug 31 15:22 /usr/local/cuda/lib/libcudart.so -&gt; libcudart.so.7.5*<br>\nlrwxrwxrwx 1 root root     19 Aug 31 15:22 /usr/local/cuda/lib/libcudart.so.7.5 -&gt; libcudart.so.7.5.18*<br>\n-rwxr-xr-x 1 root root 311596 Aug 31 15:22 /usr/local/cuda/lib/libcudart.so.7.5.18*<br>\n-rw-r--r-- 1 root root 558020 Aug 31 15:22 /usr/local/cuda/lib/libcudart_static.a</p>\n<p>(ml) socialh@socialh:~$ ll /home/socialh/cuda/lib64/<br>\nlrwxrwxrwx 1 socialh socialh       13 Jun 10 01:20 libcudnn.so -&gt; libcudnn.so.5*<br>\nlrwxrwxrwx 1 socialh socialh       17 Jun 10 01:20 libcudnn.so.5 -&gt; libcudnn.so.5.1.3*<br>\n-rwxr-xr-x 1 socialh socialh 60696704 Jun 10 01:18 libcudnn.so.5.1.3*<br>\n-rw-r--r-- 1 socialh socialh 59715990 Jun 10 01:18 libcudnn_static.a</p>\n<p>If installed from source, provide<br>\n<code>git rev-parse head</code><br>\n<a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/640353d5d1db50d6601f9410b9d06462a8a71ce4/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/640353d5d1db50d6601f9410b9d06462a8a71ce4\"><tt>640353d</tt></a><br>\n<code>bazel version</code><br>\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar<br>\nBuild time: Thu Jan 01 00:00:00 1970 (0)<br>\nBuild timestamp: Thu Jan 01 00:00:00 1970 (0)<br>\nBuild timestamp as int: 0</p>\n<h3>If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)</h3>\n<p><code>bazel build -c opt --cxxopt '-std=gnu++11' --crosstool_top=//external:android/crosstool --cpu=armeabi-v7a --host_crosstool_top=@bazel_tools//tools/cpp:toolchain   tensorflow/tools/benchmark:benchmark_model --verbose_failures </code><br>\nwith other steps taken in first StackOverflow example</p>\n<h3>What other attempted solutions have you tried?</h3>\n<p>Tried removing all -lpthreads references, also tried removing lpthreads in bazel-out files but did not help.</p>\n<h3>Logs or other output that would be helpful</h3>\n<p>(If logs are large, please upload as attachment or provide link).</p>", "body_text": "Trying to build //tensorflow/tools/benchmark:benchmark_model per instructions at this stackoveflow post http://stackoverflow.com/questions/37953369/tensorflow-quantized-graph-for-android. Am getting error that cannot find -lpthread despite my belief that lib is unneeded and best efforts to remove it.\nexternal/androidndk/ndk/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin/../lib/gcc/arm-linux-androideabi/4.9/../../../../arm-linux-androideabi/bin/ld: error: cannot find -lpthread\ncollect2: error: ld returned 1 exit status\n\n//tensorflow/tools/benchmark/BUILD cc_binary\ndeps = [\":benchmark_model_lib\",\n        \"//tensorflow/contrib/quantization/kernels:quantized_ops\",\n            ],\n\n//tensorflow/contrib/quantization/kernels/BUILD:\ndeps = [\n    \"//tensorflow/contrib/quantization:cc_array_ops\",\n    \"//tensorflow/contrib/quantization:cc_math_ops\",\n    \"//tensorflow/contrib/quantization:cc_nn_ops\",\n    #\"//tensorflow/core\",\n    #\"//tensorflow/core:framework\",\n    #\"//tensorflow/core:lib\",\n    #\"//tensorflow/core/kernels:concat_lib_hdrs\",\n    #\"//tensorflow/core/kernels:conv_ops\",\n    #\"//tensorflow/core/kernels:eigen_helpers\",\n    #\"//tensorflow/core/kernels:ops_util\",\n    #\"//tensorflow/core/kernels:pooling_ops\",\n    \"//third_party/eigen3\",\n    \"@gemmlowp//:eight_bit_int_gemm\",\n],\n\nThen run:\nbazel build -c opt --cxxopt='-std=gnu++11'--crosstool_top=//external:android/crosstool --cpu=armeabi-v7a --host_crosstool_top=@bazel_tools//tools/cpp:toolchain tensorflow/tools/benchmark:benchmark_model --verbose_failures\nWhich (with following all other instructions in linked post) succeeds with the exception that it fails to link against pthread.\nI've tried removing -lpthread in tensorflow/tensorflow.bzl,  tensorflow/tools/proto_text/BUILD, tensorflow/tools/proto_text/BUILD, and tensorflow/cc/BUILD but this still results in -lpthread being linked to in final compilation.\nI've also looked at the fixes such as this one #419 which either remove -lpthread from google protobuf or link to the dummy lib but these seem to only apply to earlier versions of TensorFlow.\nApologies if this is a basic config error, I'm new to Bazel and am pretty stuck. benchmark_model and quantize_graph both compile well independently but not yet for me when combined.\nWhat related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\nhttp://stackoverflow.com/questions/37953369/tensorflow-quantized-graph-for-android\n#419\nprotocolbuffers/protobuf#1373\nEnvironment info\nOperating System: Ubuntu 14.04\nInstalled version of CUDA and cuDNN:\n(ml) socialh@socialh:~$ echo $LD_LIBRARY_PATH\n/home/socialh/cuda/lib64:/usr/local/cuda/lib64:\n(ml) socialh@socialh:~/otf$ ll /usr/local/cuda/lib/libcud*\n-rw-r--r-- 1 root root 189170 Aug 31 15:22 /usr/local/cuda/lib/libcudadevrt.a\nlrwxrwxrwx 1 root root     16 Aug 31 15:22 /usr/local/cuda/lib/libcudart.so -> libcudart.so.7.5*\nlrwxrwxrwx 1 root root     19 Aug 31 15:22 /usr/local/cuda/lib/libcudart.so.7.5 -> libcudart.so.7.5.18*\n-rwxr-xr-x 1 root root 311596 Aug 31 15:22 /usr/local/cuda/lib/libcudart.so.7.5.18*\n-rw-r--r-- 1 root root 558020 Aug 31 15:22 /usr/local/cuda/lib/libcudart_static.a\n(ml) socialh@socialh:~$ ll /home/socialh/cuda/lib64/\nlrwxrwxrwx 1 socialh socialh       13 Jun 10 01:20 libcudnn.so -> libcudnn.so.5*\nlrwxrwxrwx 1 socialh socialh       17 Jun 10 01:20 libcudnn.so.5 -> libcudnn.so.5.1.3*\n-rwxr-xr-x 1 socialh socialh 60696704 Jun 10 01:18 libcudnn.so.5.1.3*\n-rw-r--r-- 1 socialh socialh 59715990 Jun 10 01:18 libcudnn_static.a\nIf installed from source, provide\ngit rev-parse head\n640353d\nbazel version\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Thu Jan 01 00:00:00 1970 (0)\nBuild timestamp: Thu Jan 01 00:00:00 1970 (0)\nBuild timestamp as int: 0\nIf possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\nbazel build -c opt --cxxopt '-std=gnu++11' --crosstool_top=//external:android/crosstool --cpu=armeabi-v7a --host_crosstool_top=@bazel_tools//tools/cpp:toolchain   tensorflow/tools/benchmark:benchmark_model --verbose_failures \nwith other steps taken in first StackOverflow example\nWhat other attempted solutions have you tried?\nTried removing all -lpthreads references, also tried removing lpthreads in bazel-out files but did not help.\nLogs or other output that would be helpful\n(If logs are large, please upload as attachment or provide link).", "body": "Trying to build //tensorflow/tools/benchmark:benchmark_model per instructions at this stackoveflow post http://stackoverflow.com/questions/37953369/tensorflow-quantized-graph-for-android. Am getting error that cannot find -lpthread despite my belief that lib is unneeded and best efforts to remove it.\n\n```\nexternal/androidndk/ndk/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin/../lib/gcc/arm-linux-androideabi/4.9/../../../../arm-linux-androideabi/bin/ld: error: cannot find -lpthread\ncollect2: error: ld returned 1 exit status\n```\n\n//tensorflow/tools/benchmark/BUILD cc_binary\n\n```\ndeps = [\":benchmark_model_lib\",\n        \"//tensorflow/contrib/quantization/kernels:quantized_ops\",\n            ],\n```\n\n//tensorflow/contrib/quantization/kernels/BUILD:\n\n```\ndeps = [\n    \"//tensorflow/contrib/quantization:cc_array_ops\",\n    \"//tensorflow/contrib/quantization:cc_math_ops\",\n    \"//tensorflow/contrib/quantization:cc_nn_ops\",\n    #\"//tensorflow/core\",\n    #\"//tensorflow/core:framework\",\n    #\"//tensorflow/core:lib\",\n    #\"//tensorflow/core/kernels:concat_lib_hdrs\",\n    #\"//tensorflow/core/kernels:conv_ops\",\n    #\"//tensorflow/core/kernels:eigen_helpers\",\n    #\"//tensorflow/core/kernels:ops_util\",\n    #\"//tensorflow/core/kernels:pooling_ops\",\n    \"//third_party/eigen3\",\n    \"@gemmlowp//:eight_bit_int_gemm\",\n],\n```\n\nThen run:\n`bazel build -c opt --cxxopt='-std=gnu++11'--crosstool_top=//external:android/crosstool --cpu=armeabi-v7a --host_crosstool_top=@bazel_tools//tools/cpp:toolchain tensorflow/tools/benchmark:benchmark_model --verbose_failures`\n\nWhich (with following all other instructions in linked post) succeeds with the exception that it fails to link against pthread.\n\nI've tried removing -lpthread in `tensorflow/tensorflow.bzl`,  `tensorflow/tools/proto_text/BUILD`, `tensorflow/tools/proto_text/BUILD`, and `tensorflow/cc/BUILD` but this still results in -lpthread being linked to in final compilation. \n\nI've also looked at the fixes such as this one https://github.com/tensorflow/tensorflow/issues/419 which either remove -lpthread from google protobuf or link to the dummy lib but these seem to only apply to earlier versions of TensorFlow.\n\nApologies if this is a basic config error, I'm new to Bazel and am pretty stuck. benchmark_model and quantize_graph both compile well independently but not yet for me when combined.\n### What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\n\nhttp://stackoverflow.com/questions/37953369/tensorflow-quantized-graph-for-android\nhttps://github.com/tensorflow/tensorflow/issues/419\nhttps://github.com/google/protobuf/issues/1373\n### Environment info\n\nOperating System: Ubuntu 14.04\n\nInstalled version of CUDA and cuDNN: \n(ml) socialh@socialh:~$ echo $LD_LIBRARY_PATH\n/home/socialh/cuda/lib64:/usr/local/cuda/lib64:\n\n(ml) socialh@socialh:~/otf$ ll /usr/local/cuda/lib/libcud*\n-rw-r--r-- 1 root root 189170 Aug 31 15:22 /usr/local/cuda/lib/libcudadevrt.a\nlrwxrwxrwx 1 root root     16 Aug 31 15:22 /usr/local/cuda/lib/libcudart.so -> libcudart.so.7.5*\nlrwxrwxrwx 1 root root     19 Aug 31 15:22 /usr/local/cuda/lib/libcudart.so.7.5 -> libcudart.so.7.5.18*\n-rwxr-xr-x 1 root root 311596 Aug 31 15:22 /usr/local/cuda/lib/libcudart.so.7.5.18*\n-rw-r--r-- 1 root root 558020 Aug 31 15:22 /usr/local/cuda/lib/libcudart_static.a\n\n(ml) socialh@socialh:~$ ll /home/socialh/cuda/lib64/\nlrwxrwxrwx 1 socialh socialh       13 Jun 10 01:20 libcudnn.so -> libcudnn.so.5*\nlrwxrwxrwx 1 socialh socialh       17 Jun 10 01:20 libcudnn.so.5 -> libcudnn.so.5.1.3*\n-rwxr-xr-x 1 socialh socialh 60696704 Jun 10 01:18 libcudnn.so.5.1.3*\n-rw-r--r-- 1 socialh socialh 59715990 Jun 10 01:18 libcudnn_static.a\n\nIf installed from source, provide \n`git rev-parse head`\n640353d5d1db50d6601f9410b9d06462a8a71ce4\n`bazel version`\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Thu Jan 01 00:00:00 1970 (0)\nBuild timestamp: Thu Jan 01 00:00:00 1970 (0)\nBuild timestamp as int: 0\n### If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\n\n`bazel build -c opt --cxxopt '-std=gnu++11' --crosstool_top=//external:android/crosstool --cpu=armeabi-v7a --host_crosstool_top=@bazel_tools//tools/cpp:toolchain   tensorflow/tools/benchmark:benchmark_model --verbose_failures\n`\nwith other steps taken in first StackOverflow example\n### What other attempted solutions have you tried?\n\nTried removing all -lpthreads references, also tried removing lpthreads in bazel-out files but did not help. \n### Logs or other output that would be helpful\n\n(If logs are large, please upload as attachment or provide link).\n"}