{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/421465428", "html_url": "https://github.com/tensorflow/tensorflow/issues/19491#issuecomment-421465428", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19491", "id": 421465428, "node_id": "MDEyOklzc3VlQ29tbWVudDQyMTQ2NTQyOA==", "user": {"login": "ezhulenev", "id": 1174378, "node_id": "MDQ6VXNlcjExNzQzNzg=", "avatar_url": "https://avatars2.githubusercontent.com/u/1174378?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ezhulenev", "html_url": "https://github.com/ezhulenev", "followers_url": "https://api.github.com/users/ezhulenev/followers", "following_url": "https://api.github.com/users/ezhulenev/following{/other_user}", "gists_url": "https://api.github.com/users/ezhulenev/gists{/gist_id}", "starred_url": "https://api.github.com/users/ezhulenev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ezhulenev/subscriptions", "organizations_url": "https://api.github.com/users/ezhulenev/orgs", "repos_url": "https://api.github.com/users/ezhulenev/repos", "events_url": "https://api.github.com/users/ezhulenev/events{/privacy}", "received_events_url": "https://api.github.com/users/ezhulenev/received_events", "type": "User", "site_admin": false}, "created_at": "2018-09-14T19:46:02Z", "updated_at": "2018-09-14T19:46:02Z", "author_association": "CONTRIBUTOR", "body_html": "<p>No, these changes are for CPU only, GPU kernels are the same cudnn base code as before.</p>\n<p>Can you upload the graph def that you are executing on CPU, TF CPU convolutions require NDHWC* data format, and from your code I see that Keras is using channels_first. I guess there might be some unnecessary layout conversions. Also I don't have a good representative Conv3D dimensions for benchmarks: <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/eigen_benchmark_cpu_test.cc#L403\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/eigen_benchmark_cpu_test.cc#L403</a></p>\n<p>*) Channels first works best for GPU (aka NCDHW).</p>", "body_text": "No, these changes are for CPU only, GPU kernels are the same cudnn base code as before.\nCan you upload the graph def that you are executing on CPU, TF CPU convolutions require NDHWC* data format, and from your code I see that Keras is using channels_first. I guess there might be some unnecessary layout conversions. Also I don't have a good representative Conv3D dimensions for benchmarks: https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/eigen_benchmark_cpu_test.cc#L403\n*) Channels first works best for GPU (aka NCDHW).", "body": "No, these changes are for CPU only, GPU kernels are the same cudnn base code as before.\r\n\r\nCan you upload the graph def that you are executing on CPU, TF CPU convolutions require NDHWC* data format, and from your code I see that Keras is using channels_first. I guess there might be some unnecessary layout conversions. Also I don't have a good representative Conv3D dimensions for benchmarks: https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/eigen_benchmark_cpu_test.cc#L403\r\n\r\n*) Channels first works best for GPU (aka NCDHW)."}