{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/186600299", "pull_request_review_id": 118209529, "id": 186600299, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NjYwMDI5OQ==", "diff_hunk": "@@ -113,26 +113,43 @@ JNIEXPORT jlong JNICALL Java_org_tensorflow_Session_allocate2(\n     throwException(env, kNullPointerException, \"Graph has been close()d\");\n     return 0;\n   }\n-  TF_Graph* graph = reinterpret_cast<TF_Graph*>(graph_handle);\n+", "path": "tensorflow/java/src/main/native/session_jni.cc", "position": 5, "original_position": 5, "commit_id": "f7a303f148e6b225110635d0298ee2f651968826", "original_commit_id": "f8a7579d35e93d31eca002f43633f41e47d3d15d", "user": {"login": "raintung", "id": 4536087, "node_id": "MDQ6VXNlcjQ1MzYwODc=", "avatar_url": "https://avatars2.githubusercontent.com/u/4536087?v=4", "gravatar_id": "", "url": "https://api.github.com/users/raintung", "html_url": "https://github.com/raintung", "followers_url": "https://api.github.com/users/raintung/followers", "following_url": "https://api.github.com/users/raintung/following{/other_user}", "gists_url": "https://api.github.com/users/raintung/gists{/gist_id}", "starred_url": "https://api.github.com/users/raintung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/raintung/subscriptions", "organizations_url": "https://api.github.com/users/raintung/orgs", "repos_url": "https://api.github.com/users/raintung/repos", "events_url": "https://api.github.com/users/raintung/events{/privacy}", "received_events_url": "https://api.github.com/users/raintung/received_events", "type": "User", "site_admin": false}, "body": "Yes, it look simple but I have some reasons as blow.\r\n1.  Keep the code same, please take a look for saved_model_bundle_jni.cc code for run_options logic\r\n`  if (run_options != nullptr) {\r\n    size_t sz = env->GetArrayLength(run_options);\r\n    if (sz > 0) {\r\n      jbyte* run_options_data = env->GetByteArrayElements(run_options, nullptr);\r\n      crun_options =\r\n          TF_NewBufferFromString(static_cast<void*>(run_options_data), sz);\r\n      env->ReleaseByteArrayElements(run_options, run_options_data, JNI_ABORT);\r\n    }\r\n  }`\r\n2. I concern for method TF_SetConfig `options.config.ParseFromArray(proto, proto_len)`. It is protocol buffer logic,  I am not sure it use or copy the proto bytearray into options.config. The last logic will delete options, the proto bytearray should be released in java garbage collect.\r\n\r\n\r\n", "created_at": "2018-05-08T02:06:56Z", "updated_at": "2018-05-08T02:44:49Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/18716#discussion_r186600299", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/18716", "author_association": "NONE", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/186600299"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/18716#discussion_r186600299"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/18716"}}, "body_html": "<p>Yes, it look simple but I have some reasons as blow.</p>\n<ol>\n<li>Keep the code same, please take a look for saved_model_bundle_jni.cc code for run_options logic<br>\n<code>  if (run_options != nullptr) { size_t sz = env-&gt;GetArrayLength(run_options); if (sz &gt; 0) { jbyte* run_options_data = env-&gt;GetByteArrayElements(run_options, nullptr); crun_options = TF_NewBufferFromString(static_cast&lt;void*&gt;(run_options_data), sz); env-&gt;ReleaseByteArrayElements(run_options, run_options_data, JNI_ABORT); }   }</code></li>\n<li>I concern for method TF_SetConfig <code>options.config.ParseFromArray(proto, proto_len)</code>. It is protocol buffer logic,  I am not sure it use or copy the proto bytearray into options.config. The last logic will delete options, the proto bytearray should be released in java garbage collect.</li>\n</ol>", "body_text": "Yes, it look simple but I have some reasons as blow.\n\nKeep the code same, please take a look for saved_model_bundle_jni.cc code for run_options logic\n  if (run_options != nullptr) { size_t sz = env->GetArrayLength(run_options); if (sz > 0) { jbyte* run_options_data = env->GetByteArrayElements(run_options, nullptr); crun_options = TF_NewBufferFromString(static_cast<void*>(run_options_data), sz); env->ReleaseByteArrayElements(run_options, run_options_data, JNI_ABORT); }   }\nI concern for method TF_SetConfig options.config.ParseFromArray(proto, proto_len). It is protocol buffer logic,  I am not sure it use or copy the proto bytearray into options.config. The last logic will delete options, the proto bytearray should be released in java garbage collect.", "in_reply_to_id": 183226736}