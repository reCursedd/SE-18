{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/183226666", "pull_request_review_id": 114190456, "id": 183226666, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4MzIyNjY2Ng==", "diff_hunk": "@@ -20,14 +20,36 @@ limitations under the License.\n #include \"tensorflow/java/src/main/native/exception_jni.h\"\n #include \"tensorflow/java/src/main/native/saved_model_bundle_jni.h\"\n \n+\n JNIEXPORT jobject JNICALL Java_org_tensorflow_SavedModelBundle_load(\n     JNIEnv* env, jclass clazz, jstring export_dir, jobjectArray tags,\n-    jbyteArray run_options) {\n+    jbyteArray run_options, jbyteArray session_options) {\n   TF_Status* status = TF_NewStatus();\n   jobject bundle = nullptr;\n \n   // allocate parameters for TF_LoadSessionFromSavedModel\n   TF_SessionOptions* opts = TF_NewSessionOptions();\n+\n+\n+  TF_Buffer* csession_options = nullptr;\n+  if (session_options != nullptr) {\n+\t  size_t sz = env->GetArrayLength(session_options);\n+\t  if(sz > 0){\n+\t\t  jbyte* sconfigbyte = env->GetByteArrayElements(session_options, nullptr);\n+\t\t  csession_options =\n+\t\t           TF_NewBufferFromString(static_cast<void*>(sconfigbyte), sz);\n+\t\t  env->ReleaseByteArrayElements(session_options, sconfigbyte, JNI_ABORT);\n+\t      TF_SetConfig(opts, csession_options->data,\n+\t\t\t\t\t  \t  \t  \t  \t  csession_options->length, status);\n+\t      if (!throwExceptionIfNotOK(env, status)) {\n+\t    \t   \t   TF_DeleteSessionOptions(opts);\n+\t           TF_DeleteStatus(status);\n+\t           TF_DeleteBuffer(csession_options);", "path": "tensorflow/java/src/main/native/saved_model_bundle_jni.cc", "position": 29, "original_position": 29, "commit_id": "f7a303f148e6b225110635d0298ee2f651968826", "original_commit_id": "f8a7579d35e93d31eca002f43633f41e47d3d15d", "user": {"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}, "body": "You should be able to unconditionally call `TF_DeleteBuffer` after calling `TF_SetConfig`.", "created_at": "2018-04-22T06:22:34Z", "updated_at": "2018-04-23T03:12:30Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/18716#discussion_r183226666", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/18716", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/183226666"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/18716#discussion_r183226666"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/18716"}}, "body_html": "<p>You should be able to unconditionally call <code>TF_DeleteBuffer</code> after calling <code>TF_SetConfig</code>.</p>", "body_text": "You should be able to unconditionally call TF_DeleteBuffer after calling TF_SetConfig."}