{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/183268476", "pull_request_review_id": 114223850, "id": 183268476, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4MzI2ODQ3Ng==", "diff_hunk": "@@ -20,14 +20,36 @@ limitations under the License.\n #include \"tensorflow/java/src/main/native/exception_jni.h\"\n #include \"tensorflow/java/src/main/native/saved_model_bundle_jni.h\"\n \n+\n JNIEXPORT jobject JNICALL Java_org_tensorflow_SavedModelBundle_load(\n     JNIEnv* env, jclass clazz, jstring export_dir, jobjectArray tags,\n-    jbyteArray run_options) {\n+    jbyteArray run_options, jbyteArray session_options) {\n   TF_Status* status = TF_NewStatus();\n   jobject bundle = nullptr;\n \n   // allocate parameters for TF_LoadSessionFromSavedModel\n   TF_SessionOptions* opts = TF_NewSessionOptions();\n+\n+\n+  TF_Buffer* csession_options = nullptr;\n+  if (session_options != nullptr) {\n+\t  size_t sz = env->GetArrayLength(session_options);\n+\t  if(sz > 0){\n+\t\t  jbyte* sconfigbyte = env->GetByteArrayElements(session_options, nullptr);\n+\t\t  csession_options =\n+\t\t           TF_NewBufferFromString(static_cast<void*>(sconfigbyte), sz);\n+\t\t  env->ReleaseByteArrayElements(session_options, sconfigbyte, JNI_ABORT);\n+\t      TF_SetConfig(opts, csession_options->data,\n+\t\t\t\t\t  \t  \t  \t  \t  csession_options->length, status);\n+\t      if (!throwExceptionIfNotOK(env, status)) {\n+\t    \t   \t   TF_DeleteSessionOptions(opts);\n+\t           TF_DeleteStatus(status);\n+\t           TF_DeleteBuffer(csession_options);", "path": "tensorflow/java/src/main/native/saved_model_bundle_jni.cc", "position": 29, "original_position": 29, "commit_id": "f7a303f148e6b225110635d0298ee2f651968826", "original_commit_id": "f8a7579d35e93d31eca002f43633f41e47d3d15d", "user": {"login": "raintung", "id": 4536087, "node_id": "MDQ6VXNlcjQ1MzYwODc=", "avatar_url": "https://avatars2.githubusercontent.com/u/4536087?v=4", "gravatar_id": "", "url": "https://api.github.com/users/raintung", "html_url": "https://github.com/raintung", "followers_url": "https://api.github.com/users/raintung/followers", "following_url": "https://api.github.com/users/raintung/following{/other_user}", "gists_url": "https://api.github.com/users/raintung/gists{/gist_id}", "starred_url": "https://api.github.com/users/raintung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/raintung/subscriptions", "organizations_url": "https://api.github.com/users/raintung/orgs", "repos_url": "https://api.github.com/users/raintung/repos", "events_url": "https://api.github.com/users/raintung/events{/privacy}", "received_events_url": "https://api.github.com/users/raintung/received_events", "type": "User", "site_admin": false}, "body": "TF_DeleteBuffer has been called after throw exception and release after delete the sessionoptions\r\n\r\n  TF_DeleteSessionOptions(opts);\r\n  if (crun_options != nullptr) {\r\n    TF_DeleteBuffer(crun_options);\r\n  }\r\n  if (csession_options != nullptr) {\r\n      TF_DeleteBuffer(csession_options);\r\n  }", "created_at": "2018-04-23T03:07:46Z", "updated_at": "2018-04-28T07:44:43Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/18716#discussion_r183268476", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/18716", "author_association": "NONE", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/183268476"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/18716#discussion_r183268476"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/18716"}}, "body_html": "<p>TF_DeleteBuffer has been called after throw exception and release after delete the sessionoptions</p>\n<p>TF_DeleteSessionOptions(opts);<br>\nif (crun_options != nullptr) {<br>\nTF_DeleteBuffer(crun_options);<br>\n}<br>\nif (csession_options != nullptr) {<br>\nTF_DeleteBuffer(csession_options);<br>\n}</p>", "body_text": "TF_DeleteBuffer has been called after throw exception and release after delete the sessionoptions\nTF_DeleteSessionOptions(opts);\nif (crun_options != nullptr) {\nTF_DeleteBuffer(crun_options);\n}\nif (csession_options != nullptr) {\nTF_DeleteBuffer(csession_options);\n}", "in_reply_to_id": 183226666}