{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/380129928", "html_url": "https://github.com/tensorflow/tensorflow/issues/16898#issuecomment-380129928", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16898", "id": 380129928, "node_id": "MDEyOklzc3VlQ29tbWVudDM4MDEyOTkyOA==", "user": {"login": "ikizhvatov", "id": 91335, "node_id": "MDQ6VXNlcjkxMzM1", "avatar_url": "https://avatars0.githubusercontent.com/u/91335?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ikizhvatov", "html_url": "https://github.com/ikizhvatov", "followers_url": "https://api.github.com/users/ikizhvatov/followers", "following_url": "https://api.github.com/users/ikizhvatov/following{/other_user}", "gists_url": "https://api.github.com/users/ikizhvatov/gists{/gist_id}", "starred_url": "https://api.github.com/users/ikizhvatov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ikizhvatov/subscriptions", "organizations_url": "https://api.github.com/users/ikizhvatov/orgs", "repos_url": "https://api.github.com/users/ikizhvatov/repos", "events_url": "https://api.github.com/users/ikizhvatov/events{/privacy}", "received_events_url": "https://api.github.com/users/ikizhvatov/received_events", "type": "User", "site_admin": false}, "created_at": "2018-04-10T14:51:57Z", "updated_at": "2018-04-10T14:51:57Z", "author_association": "NONE", "body_html": "<p>Thanks Wei <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=22306846\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/wei-v-wang\">@wei-v-wang</a> for looking into it. With the commit you specified (<a href=\"https://github.com/tensorflow/tensorflow/commit/abccb5d3cb45da0d8703b526776883df2f575c87\">abccb5d</a>), I still observe the problem.</p>\n<p>However, a very recent commit I tried (<a href=\"https://github.com/tensorflow/tensorflow/commit/dfbacef32d1fdafe71caad4c99ce8c4b648e6397\">dfbacef</a>) does not have the problem any more. The speedup achieved by tuning the MKL parameters (as described in <a href=\"https://www.tensorflow.org/performance/performance_guide#tensorflow_with_intel_mkl_dnn\" rel=\"nofollow\">the guide</a>) comes with plausible numerical output. For reference, in my original test case I observe the following timings with this commit:</p>\n<ul>\n<li>without any MKL parameter tuning: 45 s/epoch (consistent with the non-MKL build)</li>\n<li>with MKL parameter tuning as in the guide: 26 s/epoch</li>\n<li>with alternative MKL parameter tuning <a href=\"https://stackoverflow.com/questions/48662799/tensorflow-mkl-dnn-build-in-ubuntu-silently-produces-erroneus-results\" rel=\"nofollow\">as proposed on Stackoverflow</a>: 35 s /epoch</li>\n</ul>", "body_text": "Thanks Wei @wei-v-wang for looking into it. With the commit you specified (abccb5d), I still observe the problem.\nHowever, a very recent commit I tried (dfbacef) does not have the problem any more. The speedup achieved by tuning the MKL parameters (as described in the guide) comes with plausible numerical output. For reference, in my original test case I observe the following timings with this commit:\n\nwithout any MKL parameter tuning: 45 s/epoch (consistent with the non-MKL build)\nwith MKL parameter tuning as in the guide: 26 s/epoch\nwith alternative MKL parameter tuning as proposed on Stackoverflow: 35 s /epoch", "body": "Thanks Wei @wei-v-wang for looking into it. With the commit you specified ([abccb5d](https://github.com/tensorflow/tensorflow/commit/abccb5d3cb45da0d8703b526776883df2f575c87)), I still observe the problem. \r\n\r\nHowever, a very recent commit I tried ([dfbacef](https://github.com/tensorflow/tensorflow/commit/dfbacef32d1fdafe71caad4c99ce8c4b648e6397)) does not have the problem any more. The speedup achieved by tuning the MKL parameters (as described in [the guide](https://www.tensorflow.org/performance/performance_guide#tensorflow_with_intel_mkl_dnn)) comes with plausible numerical output. For reference, in my original test case I observe the following timings with this commit:\r\n- without any MKL parameter tuning: 45 s/epoch (consistent with the non-MKL build)\r\n- with MKL parameter tuning as in the guide: 26 s/epoch\r\n- with alternative MKL parameter tuning [as proposed on Stackoverflow](https://stackoverflow.com/questions/48662799/tensorflow-mkl-dnn-build-in-ubuntu-silently-produces-erroneus-results): 35 s /epoch"}