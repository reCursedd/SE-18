{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/433268840", "html_url": "https://github.com/tensorflow/tensorflow/issues/23170#issuecomment-433268840", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23170", "id": 433268840, "node_id": "MDEyOklzc3VlQ29tbWVudDQzMzI2ODg0MA==", "user": {"login": "IMBurbank", "id": 21133719, "node_id": "MDQ6VXNlcjIxMTMzNzE5", "avatar_url": "https://avatars1.githubusercontent.com/u/21133719?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IMBurbank", "html_url": "https://github.com/IMBurbank", "followers_url": "https://api.github.com/users/IMBurbank/followers", "following_url": "https://api.github.com/users/IMBurbank/following{/other_user}", "gists_url": "https://api.github.com/users/IMBurbank/gists{/gist_id}", "starred_url": "https://api.github.com/users/IMBurbank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IMBurbank/subscriptions", "organizations_url": "https://api.github.com/users/IMBurbank/orgs", "repos_url": "https://api.github.com/users/IMBurbank/repos", "events_url": "https://api.github.com/users/IMBurbank/events{/privacy}", "received_events_url": "https://api.github.com/users/IMBurbank/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-26T02:48:29Z", "updated_at": "2018-10-26T02:48:29Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Since you'll be looking at this over the new few weeks, I modified my <a href=\"https://github.com/IMBurbank/tensorflow/tree/host_new_dockerfiles\"><code>host_new_dockerfiles</code></a> branch to demonstrate this new proposed change. It only slightly modifies <code>assembler.py</code> to copy <code>bashrc</code> into the <code>dockerfiles</code> directory when created.</p>\n<p>I moved the undid the previous changes, and changed the following in <code>assembler.py</code></p>\n<ul>\n<li>Add <code>FLAG.bashrc_file</code></li>\n</ul>\n<div class=\"highlight highlight-source-python\"><pre>flags.DEFINE_string(\n    <span class=\"pl-s\"><span class=\"pl-pds\">'</span>bashrc_file<span class=\"pl-pds\">'</span></span>,\n    <span class=\"pl-s\"><span class=\"pl-pds\">'</span>./bashrc<span class=\"pl-pds\">'</span></span>,\n    <span class=\"pl-s\"><span class=\"pl-pds\">'</span>Path to image bashrc file<span class=\"pl-pds\">'</span></span>,\n    <span class=\"pl-v\">short_name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>b<span class=\"pl-pds\">'</span></span>)</pre></div>\n<ul>\n<li>Add test to ensure <code>FLAG.bashrc_file</code> path exists</li>\n</ul>\n<div class=\"highlight highlight-source-python\"><pre>  <span class=\"pl-c\"><span class=\"pl-c\">#</span> Abort if bashrc path is invalid</span>\n  <span class=\"pl-k\">if</span> <span class=\"pl-k\">not</span> os.path.exists(<span class=\"pl-c1\">FLAGS</span>.bashrc_file):\n    <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>&gt;&gt; ERROR: <span class=\"pl-c1\">{}</span> is an invalid bashrc path!<span class=\"pl-pds\">'</span></span>.format(<span class=\"pl-c1\">FLAGS</span>.bashrc_file))\n    <span class=\"pl-c1\">exit</span>(<span class=\"pl-c1\">1</span>)</pre></div>\n<ul>\n<li>Copy <code>bashrc</code> to <code>dockerfiles</code> directory when created</li>\n</ul>\n<div class=\"highlight highlight-source-diff\"><pre>  # Write each completed Dockerfile\n  if not FLAGS.dry_run:\n    print('&gt;&gt; Emptying destination dir \"{}\"'.format(FLAGS.output_dir))\n    shutil.rmtree(FLAGS.output_dir, ignore_errors=True)\n    mkdir_p(FLAGS.output_dir)\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>   shutil.copy(FLAGS.bashrc_file, FLAGS.output_dir)</span>\n  else:</pre></div>\n<p>Then I followed instructions and ran <code>assembler.py</code> to recreate the <code>dockerfiles</code> directory with <code>bashrc</code> included.</p>\n<p>The forked branch is up to date and the images are available at <a href=\"https://hub.docker.com/r/imburbank/tensorflow/\" rel=\"nofollow\"><code>imburbank/tensorflow</code></a>. I'll keep the branch updated with upsteam/master for current image builds at least through November.</p>\n<p>The images are available with my original proposed tag scheme:</p>\n<table>\n<thead>\n<tr>\n<th>Dockerfile Location</th>\n<th>Docker Tag Name</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>tools/dockerfiles/dockerfiles/cpu.Dockerfile</code></td>\n<td>latest</td>\n</tr>\n<tr>\n<td><code>tools/dockerfiles/dockerfiles/cpu-devel.Dockerfile</code></td>\n<td>latest-devel</td>\n</tr>\n<tr>\n<td><code>tools/dockerfiles/dockerfiles/cpu-jupyter.Dockerfile</code></td>\n<td>latest-jupyter</td>\n</tr>\n<tr>\n<td><code>tools/dockerfiles/dockerfiles/cpu-devel-jupyter.Dockerfile</code></td>\n<td>latest-devel-jupyter</td>\n</tr>\n<tr>\n<td><code>tools/dockerfiles/dockerfiles/nvidia.Dockerfile</code></td>\n<td>latest-gpu</td>\n</tr>\n<tr>\n<td><code>tools/dockerfiles/dockerfiles/nvidia-devel.Dockerfile</code></td>\n<td>latest-gpu-devel</td>\n</tr>\n<tr>\n<td><code>tools/dockerfiles/dockerfiles/nvidia-jupyter.Dockerfile</code></td>\n<td>latest-gpu-jupyter</td>\n</tr>\n<tr>\n<td><code>tools/dockerfiles/dockerfiles/nvidia-devel-jupyter.Dockerfile</code></td>\n<td>latest-gpu-devel-jupyter</td>\n</tr>\n</tbody>\n</table>\n<p>And can be used as proposed:</p>\n<div class=\"highlight highlight-source-shell\"><pre>docker run --user <span class=\"pl-s\"><span class=\"pl-pds\">$(</span>id -u<span class=\"pl-pds\">)</span></span>:<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>id -g<span class=\"pl-pds\">)</span></span> -p 8888:8888 -v <span class=\"pl-s\"><span class=\"pl-pds\">$(</span>pwd<span class=\"pl-pds\">)</span></span>:/notebooks -it imburbank/tensorflow:latest-jupyter</pre></div>", "body_text": "Since you'll be looking at this over the new few weeks, I modified my host_new_dockerfiles branch to demonstrate this new proposed change. It only slightly modifies assembler.py to copy bashrc into the dockerfiles directory when created.\nI moved the undid the previous changes, and changed the following in assembler.py\n\nAdd FLAG.bashrc_file\n\nflags.DEFINE_string(\n    'bashrc_file',\n    './bashrc',\n    'Path to image bashrc file',\n    short_name='b')\n\nAdd test to ensure FLAG.bashrc_file path exists\n\n  # Abort if bashrc path is invalid\n  if not os.path.exists(FLAGS.bashrc_file):\n    print('>> ERROR: {} is an invalid bashrc path!'.format(FLAGS.bashrc_file))\n    exit(1)\n\nCopy bashrc to dockerfiles directory when created\n\n  # Write each completed Dockerfile\n  if not FLAGS.dry_run:\n    print('>> Emptying destination dir \"{}\"'.format(FLAGS.output_dir))\n    shutil.rmtree(FLAGS.output_dir, ignore_errors=True)\n    mkdir_p(FLAGS.output_dir)\n+   shutil.copy(FLAGS.bashrc_file, FLAGS.output_dir)\n  else:\nThen I followed instructions and ran assembler.py to recreate the dockerfiles directory with bashrc included.\nThe forked branch is up to date and the images are available at imburbank/tensorflow. I'll keep the branch updated with upsteam/master for current image builds at least through November.\nThe images are available with my original proposed tag scheme:\n\n\n\nDockerfile Location\nDocker Tag Name\n\n\n\n\ntools/dockerfiles/dockerfiles/cpu.Dockerfile\nlatest\n\n\ntools/dockerfiles/dockerfiles/cpu-devel.Dockerfile\nlatest-devel\n\n\ntools/dockerfiles/dockerfiles/cpu-jupyter.Dockerfile\nlatest-jupyter\n\n\ntools/dockerfiles/dockerfiles/cpu-devel-jupyter.Dockerfile\nlatest-devel-jupyter\n\n\ntools/dockerfiles/dockerfiles/nvidia.Dockerfile\nlatest-gpu\n\n\ntools/dockerfiles/dockerfiles/nvidia-devel.Dockerfile\nlatest-gpu-devel\n\n\ntools/dockerfiles/dockerfiles/nvidia-jupyter.Dockerfile\nlatest-gpu-jupyter\n\n\ntools/dockerfiles/dockerfiles/nvidia-devel-jupyter.Dockerfile\nlatest-gpu-devel-jupyter\n\n\n\nAnd can be used as proposed:\ndocker run --user $(id -u):$(id -g) -p 8888:8888 -v $(pwd):/notebooks -it imburbank/tensorflow:latest-jupyter", "body": "Since you'll be looking at this over the new few weeks, I modified my [`host_new_dockerfiles`](https://github.com/IMBurbank/tensorflow/tree/host_new_dockerfiles) branch to demonstrate this new proposed change. It only slightly modifies `assembler.py` to copy `bashrc` into the `dockerfiles` directory when created.\r\n \r\nI moved the undid the previous changes, and changed the following in `assembler.py`\r\n\r\n- Add `FLAG.bashrc_file`\r\n```python\r\nflags.DEFINE_string(\r\n    'bashrc_file',\r\n    './bashrc',\r\n    'Path to image bashrc file',\r\n    short_name='b')\r\n```\r\n\r\n- Add test to ensure `FLAG.bashrc_file` path exists\r\n```python\r\n  # Abort if bashrc path is invalid\r\n  if not os.path.exists(FLAGS.bashrc_file):\r\n    print('>> ERROR: {} is an invalid bashrc path!'.format(FLAGS.bashrc_file))\r\n    exit(1)\r\n```\r\n\r\n- Copy `bashrc` to `dockerfiles` directory when created\r\n```diff\r\n  # Write each completed Dockerfile\r\n  if not FLAGS.dry_run:\r\n    print('>> Emptying destination dir \"{}\"'.format(FLAGS.output_dir))\r\n    shutil.rmtree(FLAGS.output_dir, ignore_errors=True)\r\n    mkdir_p(FLAGS.output_dir)\r\n+   shutil.copy(FLAGS.bashrc_file, FLAGS.output_dir)\r\n  else:\r\n```\r\n\r\nThen I followed instructions and ran `assembler.py` to recreate the `dockerfiles` directory with `bashrc` included.\r\n\r\nThe forked branch is up to date and the images are available at [`imburbank/tensorflow`](https://hub.docker.com/r/imburbank/tensorflow/). I'll keep the branch updated with upsteam/master for current image builds at least through November.\r\n\r\nThe images are available with my original proposed tag scheme:\r\n\r\n| Dockerfile Location                                                                          |  Docker Tag Name          |\r\n|----------------------------------------------------------------------------------------|----------------------------------|\r\n| `tools/dockerfiles/dockerfiles/cpu.Dockerfile`                                  | latest                               |\r\n| `tools/dockerfiles/dockerfiles/cpu-devel.Dockerfile`                        | latest-devel                      |\r\n| `tools/dockerfiles/dockerfiles/cpu-jupyter.Dockerfile`                      | latest-jupyter                    |\r\n| `tools/dockerfiles/dockerfiles/cpu-devel-jupyter.Dockerfile`            | latest-devel-jupyter          |\r\n| `tools/dockerfiles/dockerfiles/nvidia.Dockerfile`                              | latest-gpu                        |\r\n| `tools/dockerfiles/dockerfiles/nvidia-devel.Dockerfile`                    | latest-gpu-devel               |\r\n| `tools/dockerfiles/dockerfiles/nvidia-jupyter.Dockerfile`                  | latest-gpu-jupyter             |\r\n| `tools/dockerfiles/dockerfiles/nvidia-devel-jupyter.Dockerfile`        | latest-gpu-devel-jupyter   |\r\n\r\nAnd can be used as proposed:\r\n\r\n```bash\r\ndocker run --user $(id -u):$(id -g) -p 8888:8888 -v $(pwd):/notebooks -it imburbank/tensorflow:latest-jupyter\r\n```"}