{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23170", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23170/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23170/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23170/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23170", "id": 372651821, "node_id": "MDU6SXNzdWUzNzI2NTE4MjE=", "number": 23170, "title": "Switch from Deprecated to Current Docker Images on Docker Hub", "user": {"login": "IMBurbank", "id": 21133719, "node_id": "MDQ6VXNlcjIxMTMzNzE5", "avatar_url": "https://avatars1.githubusercontent.com/u/21133719?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IMBurbank", "html_url": "https://github.com/IMBurbank", "followers_url": "https://api.github.com/users/IMBurbank/followers", "following_url": "https://api.github.com/users/IMBurbank/following{/other_user}", "gists_url": "https://api.github.com/users/IMBurbank/gists{/gist_id}", "starred_url": "https://api.github.com/users/IMBurbank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IMBurbank/subscriptions", "organizations_url": "https://api.github.com/users/IMBurbank/orgs", "repos_url": "https://api.github.com/users/IMBurbank/repos", "events_url": "https://api.github.com/users/IMBurbank/events{/privacy}", "received_events_url": "https://api.github.com/users/IMBurbank/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473173351, "node_id": "MDU6TGFiZWw0NzMxNzMzNTE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:build/install", "name": "type:build/install", "color": "159b2e", "default": false}], "state": "open", "locked": false, "assignee": {"login": "angersson", "id": 32465472, "node_id": "MDQ6VXNlcjMyNDY1NDcy", "avatar_url": "https://avatars2.githubusercontent.com/u/32465472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/angersson", "html_url": "https://github.com/angersson", "followers_url": "https://api.github.com/users/angersson/followers", "following_url": "https://api.github.com/users/angersson/following{/other_user}", "gists_url": "https://api.github.com/users/angersson/gists{/gist_id}", "starred_url": "https://api.github.com/users/angersson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/angersson/subscriptions", "organizations_url": "https://api.github.com/users/angersson/orgs", "repos_url": "https://api.github.com/users/angersson/repos", "events_url": "https://api.github.com/users/angersson/events{/privacy}", "received_events_url": "https://api.github.com/users/angersson/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "angersson", "id": 32465472, "node_id": "MDQ6VXNlcjMyNDY1NDcy", "avatar_url": "https://avatars2.githubusercontent.com/u/32465472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/angersson", "html_url": "https://github.com/angersson", "followers_url": "https://api.github.com/users/angersson/followers", "following_url": "https://api.github.com/users/angersson/following{/other_user}", "gists_url": "https://api.github.com/users/angersson/gists{/gist_id}", "starred_url": "https://api.github.com/users/angersson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/angersson/subscriptions", "organizations_url": "https://api.github.com/users/angersson/orgs", "repos_url": "https://api.github.com/users/angersson/repos", "events_url": "https://api.github.com/users/angersson/events{/privacy}", "received_events_url": "https://api.github.com/users/angersson/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 9, "created_at": "2018-10-22T18:56:39Z", "updated_at": "2018-11-20T07:51:02Z", "closed_at": null, "author_association": "CONTRIBUTOR", "body_html": "<p>Tensorflow Dockerfiles are <a href=\"https://github.com/tensorflow/tensorflow/tree/master/tensorflow/tools/dockerfiles/dockerfiles\">currently located</a> at <code>tensorflow/tensorflow/tools/dockerfiles/dockerfiles/</code>. The parent directory (<code>tensorflow/tensorflow/tools/dockerfiles/</code>) includes instructions to build the images from that directory. This is done so the Dockerfiles have the <code>bashrc</code> file in their build context to <code>COPY</code> into containers at runtime.</p>\n<p>There are another set of Dockerfiles at <code>tensorflow/tensorflow/tools/docker/</code> which are marked deprecated/for-deletion. These deprecated Dockerfiles are the ones currently hosted on <a href=\"https://hub.docker.com/r/tensorflow/tensorflow/\" rel=\"nofollow\">Docker Hub</a>.</p>\n<p>I propose Tensorflow switch their publicly available Docker images from the deprecated set to current ones. With minimal upfront effort, all eight current images could be hosted on Docker Hub and automatically rebuilt with each repo update.</p>\n<p>This transition could be achieved in two main steps:</p>\n<p>1 Move <code>tensorflow/tensorflow/tools/dockerfiles/bashrc</code> into the <code>dockerfiles</code> child directory at <code>tensorflow/tensorflow/tools/dockerfiles/dockerfiles/</code> to give the Dockerfiles access to the file in their default build context.</p>\n<ul>\n<li>This will require a few minor relative path updates, such as changing the <code>COPY</code> path in <code>tensorflow/tensorflow/tools/dockerfiles/assembler.Dockerfile</code></li>\n</ul>\n<div class=\"highlight highlight-source-diff\"><pre><span class=\"pl-md\"><span class=\"pl-md\">-</span> COPY  bashrc /etc/bash.bashrc</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span> COPY dockerfiles/bashrc /etc/bash.bashrc</span></pre></div>\n<p>2 Now, Docker Hub can be easily configured to link to the Tensorflow account, host the current Docker images and rebuild them whenever they're changed. Using this Docker Hub Build Setting image for context:</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/21133719/47311058-03f72600-d5f6-11e8-8827-8411c2fb641b.png\"><img src=\"https://user-images.githubusercontent.com/21133719/47311058-03f72600-d5f6-11e8-8827-8411c2fb641b.png\" alt=\"graph_nets_dockerhub_build_settings\" style=\"max-width:100%;\"></a></p>\n<p>I recommend Tensorflow set up Docker Hub automatic build settings to the <code>tensorflow/tensorflow</code> repo with the following location:tag pairs:</p>\n<table>\n<thead>\n<tr>\n<th>Dockerfile Location</th>\n<th>Docker Tag Name</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>tools/dockerfiles/dockerfiles/cpu.Dockerfile</code></td>\n<td>latest</td>\n</tr>\n<tr>\n<td><code>tools/dockerfiles/dockerfiles/cpu-devel.Dockerfile</code></td>\n<td>latest-devel</td>\n</tr>\n<tr>\n<td><code>tools/dockerfiles/dockerfiles/cpu-jupyter.Dockerfile</code></td>\n<td>latest-jupyter</td>\n</tr>\n<tr>\n<td><code>tools/dockerfiles/dockerfiles/cpu-devel-jupyter.Dockerfile</code></td>\n<td>latest-devel-jupyter</td>\n</tr>\n<tr>\n<td><code>tools/dockerfiles/dockerfiles/nvidia.Dockerfile</code></td>\n<td>latest-gpu</td>\n</tr>\n<tr>\n<td><code>tools/dockerfiles/dockerfiles/nvidia-devel.Dockerfile</code></td>\n<td>latest-gpu-devel</td>\n</tr>\n<tr>\n<td><code>tools/dockerfiles/dockerfiles/nvidia-jupyter.Dockerfile</code></td>\n<td>latest-gpu-jupyter</td>\n</tr>\n<tr>\n<td><code>tools/dockerfiles/dockerfiles/nvidia-devel-jupyter.Dockerfile</code></td>\n<td>latest-gpu-devel-jupyter</td>\n</tr>\n</tbody>\n</table>\n<p>I have already signed the individual CLA for a previous commit and would be happy to implement these code changes -- someone with access to Tensorflow's Docker Hub account would have to enter the automated build settings.</p>", "body_text": "Tensorflow Dockerfiles are currently located at tensorflow/tensorflow/tools/dockerfiles/dockerfiles/. The parent directory (tensorflow/tensorflow/tools/dockerfiles/) includes instructions to build the images from that directory. This is done so the Dockerfiles have the bashrc file in their build context to COPY into containers at runtime.\nThere are another set of Dockerfiles at tensorflow/tensorflow/tools/docker/ which are marked deprecated/for-deletion. These deprecated Dockerfiles are the ones currently hosted on Docker Hub.\nI propose Tensorflow switch their publicly available Docker images from the deprecated set to current ones. With minimal upfront effort, all eight current images could be hosted on Docker Hub and automatically rebuilt with each repo update.\nThis transition could be achieved in two main steps:\n1 Move tensorflow/tensorflow/tools/dockerfiles/bashrc into the dockerfiles child directory at tensorflow/tensorflow/tools/dockerfiles/dockerfiles/ to give the Dockerfiles access to the file in their default build context.\n\nThis will require a few minor relative path updates, such as changing the COPY path in tensorflow/tensorflow/tools/dockerfiles/assembler.Dockerfile\n\n- COPY  bashrc /etc/bash.bashrc\n+ COPY dockerfiles/bashrc /etc/bash.bashrc\n2 Now, Docker Hub can be easily configured to link to the Tensorflow account, host the current Docker images and rebuild them whenever they're changed. Using this Docker Hub Build Setting image for context:\n\nI recommend Tensorflow set up Docker Hub automatic build settings to the tensorflow/tensorflow repo with the following location:tag pairs:\n\n\n\nDockerfile Location\nDocker Tag Name\n\n\n\n\ntools/dockerfiles/dockerfiles/cpu.Dockerfile\nlatest\n\n\ntools/dockerfiles/dockerfiles/cpu-devel.Dockerfile\nlatest-devel\n\n\ntools/dockerfiles/dockerfiles/cpu-jupyter.Dockerfile\nlatest-jupyter\n\n\ntools/dockerfiles/dockerfiles/cpu-devel-jupyter.Dockerfile\nlatest-devel-jupyter\n\n\ntools/dockerfiles/dockerfiles/nvidia.Dockerfile\nlatest-gpu\n\n\ntools/dockerfiles/dockerfiles/nvidia-devel.Dockerfile\nlatest-gpu-devel\n\n\ntools/dockerfiles/dockerfiles/nvidia-jupyter.Dockerfile\nlatest-gpu-jupyter\n\n\ntools/dockerfiles/dockerfiles/nvidia-devel-jupyter.Dockerfile\nlatest-gpu-devel-jupyter\n\n\n\nI have already signed the individual CLA for a previous commit and would be happy to implement these code changes -- someone with access to Tensorflow's Docker Hub account would have to enter the automated build settings.", "body": "Tensorflow Dockerfiles are [currently located](https://github.com/tensorflow/tensorflow/tree/master/tensorflow/tools/dockerfiles/dockerfiles) at `tensorflow/tensorflow/tools/dockerfiles/dockerfiles/`. The parent directory (`tensorflow/tensorflow/tools/dockerfiles/`) includes instructions to build the images from that directory. This is done so the Dockerfiles have the `bashrc` file in their build context to `COPY` into containers at runtime. \r\n\r\nThere are another set of Dockerfiles at `tensorflow/tensorflow/tools/docker/` which are marked deprecated/for-deletion. These deprecated Dockerfiles are the ones currently hosted on [Docker Hub](https://hub.docker.com/r/tensorflow/tensorflow/).\r\n\r\nI propose Tensorflow switch their publicly available Docker images from the deprecated set to current ones. With minimal upfront effort, all eight current images could be hosted on Docker Hub and automatically rebuilt with each repo update.\r\n\r\nThis transition could be achieved in two main steps:\r\n\r\n1 Move `tensorflow/tensorflow/tools/dockerfiles/bashrc` into the `dockerfiles` child directory at `tensorflow/tensorflow/tools/dockerfiles/dockerfiles/` to give the Dockerfiles access to the file in their default build context.\r\n - This will require a few minor relative path updates, such as changing the `COPY` path in `tensorflow/tensorflow/tools/dockerfiles/assembler.Dockerfile`\r\n\r\n```diff\r\n- COPY  bashrc /etc/bash.bashrc\r\n+ COPY dockerfiles/bashrc /etc/bash.bashrc\r\n```\r\n\r\n2 Now, Docker Hub can be easily configured to link to the Tensorflow account, host the current Docker images and rebuild them whenever they're changed. Using this Docker Hub Build Setting image for context:\r\n\r\n![graph_nets_dockerhub_build_settings](https://user-images.githubusercontent.com/21133719/47311058-03f72600-d5f6-11e8-8827-8411c2fb641b.png)\r\n\r\nI recommend Tensorflow set up Docker Hub automatic build settings to the `tensorflow/tensorflow` repo with the following location:tag pairs:\r\n\r\n| Dockerfile Location                                                                          |  Docker Tag Name          |\r\n|----------------------------------------------------------------------------------------|----------------------------------|\r\n| `tools/dockerfiles/dockerfiles/cpu.Dockerfile`                                  | latest                               |\r\n| `tools/dockerfiles/dockerfiles/cpu-devel.Dockerfile`                        | latest-devel                      |\r\n| `tools/dockerfiles/dockerfiles/cpu-jupyter.Dockerfile`                      | latest-jupyter                    |\r\n| `tools/dockerfiles/dockerfiles/cpu-devel-jupyter.Dockerfile`            | latest-devel-jupyter          |\r\n| `tools/dockerfiles/dockerfiles/nvidia.Dockerfile`                              | latest-gpu                        |\r\n| `tools/dockerfiles/dockerfiles/nvidia-devel.Dockerfile`                    | latest-gpu-devel               |\r\n| `tools/dockerfiles/dockerfiles/nvidia-jupyter.Dockerfile`                  | latest-gpu-jupyter             |\r\n| `tools/dockerfiles/dockerfiles/nvidia-devel-jupyter.Dockerfile`        | latest-gpu-devel-jupyter   |\r\n\r\nI have already signed the individual CLA for a previous commit and would be happy to implement these code changes -- someone with access to Tensorflow's Docker Hub account would have to enter the automated build settings."}