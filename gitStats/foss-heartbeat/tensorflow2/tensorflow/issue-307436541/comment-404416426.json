{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/404416426", "html_url": "https://github.com/tensorflow/tensorflow/issues/17908#issuecomment-404416426", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17908", "id": 404416426, "node_id": "MDEyOklzc3VlQ29tbWVudDQwNDQxNjQyNg==", "user": {"login": "EFanZh", "id": 2160692, "node_id": "MDQ6VXNlcjIxNjA2OTI=", "avatar_url": "https://avatars0.githubusercontent.com/u/2160692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/EFanZh", "html_url": "https://github.com/EFanZh", "followers_url": "https://api.github.com/users/EFanZh/followers", "following_url": "https://api.github.com/users/EFanZh/following{/other_user}", "gists_url": "https://api.github.com/users/EFanZh/gists{/gist_id}", "starred_url": "https://api.github.com/users/EFanZh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/EFanZh/subscriptions", "organizations_url": "https://api.github.com/users/EFanZh/orgs", "repos_url": "https://api.github.com/users/EFanZh/repos", "events_url": "https://api.github.com/users/EFanZh/events{/privacy}", "received_events_url": "https://api.github.com/users/EFanZh/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-12T07:28:20Z", "updated_at": "2018-07-12T10:55:19Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Analysis: graph optimization is implemented in <a href=\"https://github.com/tensorflow/tensorflow/blob/v1.9.0/tensorflow/contrib/nccl/kernels/nccl_rewrite.cc\"><code>tensorflow/contrib/nccl/kernels/nccl_rewrite.cc</code></a>. The only bazel target that compiles that file is <a href=\"https://github.com/tensorflow/tensorflow/blob/v1.9.0/tensorflow/contrib/nccl/BUILD#L74\"><code>//tensorflow/contrib/nccl:nccl_kernels</code></a>. I found two other targets that seem to depend on <code>//tensorflow/contrib/nccl:nccl_kernels</code>: <a href=\"https://github.com/tensorflow/tensorflow/blob/v1.9.0/tensorflow/contrib/BUILD#L149\"><code>//tensorflow/contrib:contrib_kernels</code></a> and <a href=\"https://github.com/tensorflow/tensorflow/blob/v1.9.0/tensorflow/contrib/nccl/BUILD#L107\"><code>//tensorflow/contrib/nccl:nccl_py</code></a>.</p>\n<p>For the first target <code>//tensorflow/contrib:contrib_kernels</code>, I could not find any targets that depend on this one. And for the target <code>//tensorflow/contrib/nccl:nccl_py</code>, it uses <code>tf_custom_op_py_library</code> to define a target, where the dependency is passed as <code>kernels</code> argument. But in the definition of <code>tf_custom_op_py_library</code>, the <code>kernels</code> argument <a href=\"https://github.com/tensorflow/tensorflow/blob/v1.9.0/tensorflow/tensorflow.bzl#L1342\">is ignored</a>. So it seems that in no way the final python package would include the <code>nccl_rewrite.cc</code> file. So it is impossible for TensorFlow to run NCCL graph optimization pass.</p>", "body_text": "Analysis: graph optimization is implemented in tensorflow/contrib/nccl/kernels/nccl_rewrite.cc. The only bazel target that compiles that file is //tensorflow/contrib/nccl:nccl_kernels. I found two other targets that seem to depend on //tensorflow/contrib/nccl:nccl_kernels: //tensorflow/contrib:contrib_kernels and //tensorflow/contrib/nccl:nccl_py.\nFor the first target //tensorflow/contrib:contrib_kernels, I could not find any targets that depend on this one. And for the target //tensorflow/contrib/nccl:nccl_py, it uses tf_custom_op_py_library to define a target, where the dependency is passed as kernels argument. But in the definition of tf_custom_op_py_library, the kernels argument is ignored. So it seems that in no way the final python package would include the nccl_rewrite.cc file. So it is impossible for TensorFlow to run NCCL graph optimization pass.", "body": "Analysis: graph optimization is implemented in [`tensorflow/contrib/nccl/kernels/nccl_rewrite.cc`](https://github.com/tensorflow/tensorflow/blob/v1.9.0/tensorflow/contrib/nccl/kernels/nccl_rewrite.cc). The only bazel target that compiles that file is [`//tensorflow/contrib/nccl:nccl_kernels`](https://github.com/tensorflow/tensorflow/blob/v1.9.0/tensorflow/contrib/nccl/BUILD#L74). I found two other targets that seem to depend on `//tensorflow/contrib/nccl:nccl_kernels`: [`//tensorflow/contrib:contrib_kernels`](https://github.com/tensorflow/tensorflow/blob/v1.9.0/tensorflow/contrib/BUILD#L149) and [`//tensorflow/contrib/nccl:nccl_py`](https://github.com/tensorflow/tensorflow/blob/v1.9.0/tensorflow/contrib/nccl/BUILD#L107).\r\n\r\nFor the first target `//tensorflow/contrib:contrib_kernels`, I could not find any targets that depend on this one. And for the target `//tensorflow/contrib/nccl:nccl_py`, it uses `tf_custom_op_py_library` to define a target, where the dependency is passed as `kernels` argument. But in the definition of `tf_custom_op_py_library`, the `kernels` argument [is ignored](https://github.com/tensorflow/tensorflow/blob/v1.9.0/tensorflow/tensorflow.bzl#L1342). So it seems that in no way the final python package would include the `nccl_rewrite.cc` file. So it is impossible for TensorFlow to run NCCL graph optimization pass."}