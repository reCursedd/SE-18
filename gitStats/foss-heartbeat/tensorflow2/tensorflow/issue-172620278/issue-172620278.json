{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3978", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3978/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3978/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3978/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/3978", "id": 172620278, "node_id": "MDU6SXNzdWUxNzI2MjAyNzg=", "number": 3978, "title": "Tensorflow hangs when enqueueing with session timeout specified", "user": {"login": "sygi", "id": 495380, "node_id": "MDQ6VXNlcjQ5NTM4MA==", "avatar_url": "https://avatars2.githubusercontent.com/u/495380?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sygi", "html_url": "https://github.com/sygi", "followers_url": "https://api.github.com/users/sygi/followers", "following_url": "https://api.github.com/users/sygi/following{/other_user}", "gists_url": "https://api.github.com/users/sygi/gists{/gist_id}", "starred_url": "https://api.github.com/users/sygi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sygi/subscriptions", "organizations_url": "https://api.github.com/users/sygi/orgs", "repos_url": "https://api.github.com/users/sygi/repos", "events_url": "https://api.github.com/users/sygi/events{/privacy}", "received_events_url": "https://api.github.com/users/sygi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2016-08-23T06:15:30Z", "updated_at": "2017-02-09T22:02:09Z", "closed_at": "2016-08-26T15:22:31Z", "author_association": "NONE", "body_html": "<p>I am creating a simple <code>FIFOQueue</code> and enqueueing elements to it. Everything works fine when the session timeout is not specified (code as below, with timeout commented out):</p>\n<pre><code>$ time python ex.py\nenqueue\nenqueue\nenqueue\nenqueue\nenqueue\n1.56user 0.24system 0:01.70elapsed 105%CPU \n</code></pre>\n<p>Everything finishes correctly. But when I run the same code with timeout specified (to 60 seconds):</p>\n<pre><code>import tensorflow as tf\nimport numpy as np\n\ntf.reset_default_graph()\ndata = np.array([1, 2])\nnum_epochs = 5\nqueue1 = tf.FIFOQueue(capacity=50, dtypes=[tf.int32], shapes=[()])\n\ndef create_session():\n    config = tf.ConfigProto()\n    config.operation_timeout_in_ms=60000\n    return tf.InteractiveSession(config=config)\n\nenqueue_op = queue1.enqueue_many(data)\nsess = create_session()\ntf.train.start_queue_runners()\nfor i in range(num_epochs):\n    print(\"enqueue\")\n    sess.run(enqueue_op)\n</code></pre>\n<pre><code>$ time python ex.py\nenqueue\nenqueue\nE tensorflow/core/client/tensor_c_api.cc:485] Timed out waiting for notification\nTraceback (most recent call last):\n  File \"ex.py\", line 21, in &lt;module&gt;\n    sess.run(enqueue_op)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 382, in run\n    run_metadata_ptr)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 655, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 723, in _do_run\n    target_list, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 743, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors.DeadlineExceededError: Timed out waiting for notification\nCommand exited with non-zero status 1\n1.57user 0.24system 1:01.71elapsed 2%CPU\n</code></pre>\n<p>The number of \"enqueue\"s is not deterministic, but the code never finishes. Note that with timeout specified the code didn't manage to finish in a minute (in comparison to less than 2 seconds with no timeout).</p>\n<h3>Environment info</h3>\n<p>Operating System: lubuntu 14.04, kernel 3.13.0-32-generic</p>\n<p>Installed version of CUDA and cuDNN: no CUDA, using just CPU<br>\nIf installed from binary pip package, provide:</p>\n<ol>\n<li>Which pip package you installed: <a href=\"https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.10.0rc0-cp27-none-linux_x86_64.whl\" rel=\"nofollow\">https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.10.0rc0-cp27-none-linux_x86_64.whl</a></li>\n<li>The output from <code>python -c \"import tensorflow; print(tensorflow.__version__)\"</code>: 0.10.0rc0</li>\n</ol>", "body_text": "I am creating a simple FIFOQueue and enqueueing elements to it. Everything works fine when the session timeout is not specified (code as below, with timeout commented out):\n$ time python ex.py\nenqueue\nenqueue\nenqueue\nenqueue\nenqueue\n1.56user 0.24system 0:01.70elapsed 105%CPU \n\nEverything finishes correctly. But when I run the same code with timeout specified (to 60 seconds):\nimport tensorflow as tf\nimport numpy as np\n\ntf.reset_default_graph()\ndata = np.array([1, 2])\nnum_epochs = 5\nqueue1 = tf.FIFOQueue(capacity=50, dtypes=[tf.int32], shapes=[()])\n\ndef create_session():\n    config = tf.ConfigProto()\n    config.operation_timeout_in_ms=60000\n    return tf.InteractiveSession(config=config)\n\nenqueue_op = queue1.enqueue_many(data)\nsess = create_session()\ntf.train.start_queue_runners()\nfor i in range(num_epochs):\n    print(\"enqueue\")\n    sess.run(enqueue_op)\n\n$ time python ex.py\nenqueue\nenqueue\nE tensorflow/core/client/tensor_c_api.cc:485] Timed out waiting for notification\nTraceback (most recent call last):\n  File \"ex.py\", line 21, in <module>\n    sess.run(enqueue_op)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 382, in run\n    run_metadata_ptr)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 655, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 723, in _do_run\n    target_list, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 743, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors.DeadlineExceededError: Timed out waiting for notification\nCommand exited with non-zero status 1\n1.57user 0.24system 1:01.71elapsed 2%CPU\n\nThe number of \"enqueue\"s is not deterministic, but the code never finishes. Note that with timeout specified the code didn't manage to finish in a minute (in comparison to less than 2 seconds with no timeout).\nEnvironment info\nOperating System: lubuntu 14.04, kernel 3.13.0-32-generic\nInstalled version of CUDA and cuDNN: no CUDA, using just CPU\nIf installed from binary pip package, provide:\n\nWhich pip package you installed: https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.10.0rc0-cp27-none-linux_x86_64.whl\nThe output from python -c \"import tensorflow; print(tensorflow.__version__)\": 0.10.0rc0", "body": "I am creating a simple `FIFOQueue` and enqueueing elements to it. Everything works fine when the session timeout is not specified (code as below, with timeout commented out):\n\n```\n$ time python ex.py\nenqueue\nenqueue\nenqueue\nenqueue\nenqueue\n1.56user 0.24system 0:01.70elapsed 105%CPU \n```\n\nEverything finishes correctly. But when I run the same code with timeout specified (to 60 seconds):\n\n```\nimport tensorflow as tf\nimport numpy as np\n\ntf.reset_default_graph()\ndata = np.array([1, 2])\nnum_epochs = 5\nqueue1 = tf.FIFOQueue(capacity=50, dtypes=[tf.int32], shapes=[()])\n\ndef create_session():\n    config = tf.ConfigProto()\n    config.operation_timeout_in_ms=60000\n    return tf.InteractiveSession(config=config)\n\nenqueue_op = queue1.enqueue_many(data)\nsess = create_session()\ntf.train.start_queue_runners()\nfor i in range(num_epochs):\n    print(\"enqueue\")\n    sess.run(enqueue_op)\n```\n\n```\n$ time python ex.py\nenqueue\nenqueue\nE tensorflow/core/client/tensor_c_api.cc:485] Timed out waiting for notification\nTraceback (most recent call last):\n  File \"ex.py\", line 21, in <module>\n    sess.run(enqueue_op)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 382, in run\n    run_metadata_ptr)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 655, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 723, in _do_run\n    target_list, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 743, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors.DeadlineExceededError: Timed out waiting for notification\nCommand exited with non-zero status 1\n1.57user 0.24system 1:01.71elapsed 2%CPU\n```\n\nThe number of \"enqueue\"s is not deterministic, but the code never finishes. Note that with timeout specified the code didn't manage to finish in a minute (in comparison to less than 2 seconds with no timeout).\n### Environment info\n\nOperating System: lubuntu 14.04, kernel 3.13.0-32-generic\n\nInstalled version of CUDA and cuDNN: no CUDA, using just CPU\nIf installed from binary pip package, provide:\n1. Which pip package you installed: https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.10.0rc0-cp27-none-linux_x86_64.whl\n2. The output from `python -c \"import tensorflow; print(tensorflow.__version__)\"`: 0.10.0rc0\n"}