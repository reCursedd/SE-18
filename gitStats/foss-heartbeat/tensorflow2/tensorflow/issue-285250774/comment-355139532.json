{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/355139532", "html_url": "https://github.com/tensorflow/tensorflow/issues/15752#issuecomment-355139532", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15752", "id": 355139532, "node_id": "MDEyOklzc3VlQ29tbWVudDM1NTEzOTUzMg==", "user": {"login": "allenlavoie", "id": 3731025, "node_id": "MDQ6VXNlcjM3MzEwMjU=", "avatar_url": "https://avatars3.githubusercontent.com/u/3731025?v=4", "gravatar_id": "", "url": "https://api.github.com/users/allenlavoie", "html_url": "https://github.com/allenlavoie", "followers_url": "https://api.github.com/users/allenlavoie/followers", "following_url": "https://api.github.com/users/allenlavoie/following{/other_user}", "gists_url": "https://api.github.com/users/allenlavoie/gists{/gist_id}", "starred_url": "https://api.github.com/users/allenlavoie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/allenlavoie/subscriptions", "organizations_url": "https://api.github.com/users/allenlavoie/orgs", "repos_url": "https://api.github.com/users/allenlavoie/repos", "events_url": "https://api.github.com/users/allenlavoie/events{/privacy}", "received_events_url": "https://api.github.com/users/allenlavoie/received_events", "type": "User", "site_admin": false}, "created_at": "2018-01-03T21:59:23Z", "updated_at": "2018-01-03T21:59:23Z", "author_association": "MEMBER", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=5061\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/alextp\">@alextp</a>, looks like this is due to kernel caching rather than variable sharing. This also reproduces the issue:</p>\n<pre><code>import tensorflow as tf\nimport tensorflow.contrib.eager as tfe\ntfe.enable_eager_execution()\nwith tf.device(\"gpu:0\"):\n  tf.contrib.cudnn_rnn.CudnnGRU(1, 100)(tf.zeros([28, 100, 28]))\n  tf.contrib.cudnn_rnn.CudnnGRU(1, 100)(tf.zeros([28, 100, 100]))\n</code></pre>\n<p>The kernel <a href=\"https://github.com/tensorflow/tensorflow/blob/020001e1e38d99e1b7b49c26fc808201da22bc06/tensorflow/contrib/cudnn_rnn/kernels/cudnn_rnn_ops.cc#L902\">holds on to its input shape</a> for error checking. I've verified that it works when executing eagerly with kernel caching disabled.</p>\n<p>So I think the right fix is to make the kernel non-stateful (maybe use an attribute). Shouldn't be a terrible fix; I'll give it a shot.</p>", "body_text": "@alextp, looks like this is due to kernel caching rather than variable sharing. This also reproduces the issue:\nimport tensorflow as tf\nimport tensorflow.contrib.eager as tfe\ntfe.enable_eager_execution()\nwith tf.device(\"gpu:0\"):\n  tf.contrib.cudnn_rnn.CudnnGRU(1, 100)(tf.zeros([28, 100, 28]))\n  tf.contrib.cudnn_rnn.CudnnGRU(1, 100)(tf.zeros([28, 100, 100]))\n\nThe kernel holds on to its input shape for error checking. I've verified that it works when executing eagerly with kernel caching disabled.\nSo I think the right fix is to make the kernel non-stateful (maybe use an attribute). Shouldn't be a terrible fix; I'll give it a shot.", "body": "@alextp, looks like this is due to kernel caching rather than variable sharing. This also reproduces the issue:\r\n\r\n```\r\nimport tensorflow as tf\r\nimport tensorflow.contrib.eager as tfe\r\ntfe.enable_eager_execution()\r\nwith tf.device(\"gpu:0\"):\r\n  tf.contrib.cudnn_rnn.CudnnGRU(1, 100)(tf.zeros([28, 100, 28]))\r\n  tf.contrib.cudnn_rnn.CudnnGRU(1, 100)(tf.zeros([28, 100, 100]))\r\n```\r\n\r\nThe kernel [holds on to its input shape](https://github.com/tensorflow/tensorflow/blob/020001e1e38d99e1b7b49c26fc808201da22bc06/tensorflow/contrib/cudnn_rnn/kernels/cudnn_rnn_ops.cc#L902) for error checking. I've verified that it works when executing eagerly with kernel caching disabled.\r\n\r\nSo I think the right fix is to make the kernel non-stateful (maybe use an attribute). Shouldn't be a terrible fix; I'll give it a shot."}