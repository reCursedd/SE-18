{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/293258539", "html_url": "https://github.com/tensorflow/tensorflow/issues/7108#issuecomment-293258539", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7108", "id": 293258539, "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzI1ODUzOQ==", "user": {"login": "ratzinho87", "id": 765073, "node_id": "MDQ6VXNlcjc2NTA3Mw==", "avatar_url": "https://avatars0.githubusercontent.com/u/765073?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ratzinho87", "html_url": "https://github.com/ratzinho87", "followers_url": "https://api.github.com/users/ratzinho87/followers", "following_url": "https://api.github.com/users/ratzinho87/following{/other_user}", "gists_url": "https://api.github.com/users/ratzinho87/gists{/gist_id}", "starred_url": "https://api.github.com/users/ratzinho87/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ratzinho87/subscriptions", "organizations_url": "https://api.github.com/users/ratzinho87/orgs", "repos_url": "https://api.github.com/users/ratzinho87/repos", "events_url": "https://api.github.com/users/ratzinho87/events{/privacy}", "received_events_url": "https://api.github.com/users/ratzinho87/received_events", "type": "User", "site_admin": false}, "created_at": "2017-04-11T13:17:36Z", "updated_at": "2017-04-11T13:19:55Z", "author_association": "NONE", "body_html": "<p>@AndreaPisoni I have solved my problem by setting inter_op_parallelism_threads and intra_op_parallelism_threads to 1. This would make Tensorflow not use parallelism at all. My session creation code looks like this:</p>\n<div class=\"highlight highlight-source-c++\"><pre>    tensorflow::SessionOptions options;\n    options.config.mutable_graph_options()\n        -&gt;<span class=\"pl-en\">mutable_optimizer_options</span>()\n        -&gt;set_opt_level(::tensorflow::OptimizerOptions::L0);\n    options.config.set_inter_op_parallelism_threads(<span class=\"pl-c1\">1</span>);\n    options.config.set_intra_op_parallelism_threads(<span class=\"pl-c1\">1</span>);\n    options.env = memmapped_env-&gt;<span class=\"pl-en\">get</span>();\n    tensorflow::Session* session_pointer = <span class=\"pl-c1\">nullptr</span>;\n    tensorflow::Status session_status = tensorflow::NewSession(options, &amp;session_pointer);\n    <span class=\"pl-k\">if</span> (!session_status.ok()) {\n        <span class=\"pl-c1\">LOG</span>(ERROR) &lt;&lt; <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Could not create TensorFlow Session: <span class=\"pl-pds\">\"</span></span> &lt;&lt; session_status;\n        <span class=\"pl-k\">return</span> session_status;\n    }</pre></div>\n<p>Setting just inter_op_parallelism_threads to 1, as suggested by <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=161459\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/petewarden\">@petewarden</a> was not enough for me.</p>", "body_text": "@AndreaPisoni I have solved my problem by setting inter_op_parallelism_threads and intra_op_parallelism_threads to 1. This would make Tensorflow not use parallelism at all. My session creation code looks like this:\n    tensorflow::SessionOptions options;\n    options.config.mutable_graph_options()\n        ->mutable_optimizer_options()\n        ->set_opt_level(::tensorflow::OptimizerOptions::L0);\n    options.config.set_inter_op_parallelism_threads(1);\n    options.config.set_intra_op_parallelism_threads(1);\n    options.env = memmapped_env->get();\n    tensorflow::Session* session_pointer = nullptr;\n    tensorflow::Status session_status = tensorflow::NewSession(options, &session_pointer);\n    if (!session_status.ok()) {\n        LOG(ERROR) << \"Could not create TensorFlow Session: \" << session_status;\n        return session_status;\n    }\nSetting just inter_op_parallelism_threads to 1, as suggested by @petewarden was not enough for me.", "body": "@AndreaPisoni I have solved my problem by setting inter_op_parallelism_threads and intra_op_parallelism_threads to 1. This would make Tensorflow not use parallelism at all. My session creation code looks like this:\r\n\r\n```C++\r\n\r\n    tensorflow::SessionOptions options;\r\n    options.config.mutable_graph_options()\r\n        ->mutable_optimizer_options()\r\n        ->set_opt_level(::tensorflow::OptimizerOptions::L0);\r\n    options.config.set_inter_op_parallelism_threads(1);\r\n    options.config.set_intra_op_parallelism_threads(1);\r\n    options.env = memmapped_env->get();\r\n    tensorflow::Session* session_pointer = nullptr;\r\n    tensorflow::Status session_status = tensorflow::NewSession(options, &session_pointer);\r\n    if (!session_status.ok()) {\r\n        LOG(ERROR) << \"Could not create TensorFlow Session: \" << session_status;\r\n        return session_status;\r\n    }\r\n```\r\nSetting just inter_op_parallelism_threads to 1, as suggested by @petewarden was not enough for me."}