{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23405", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23405/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23405/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23405/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23405", "id": 375986420, "node_id": "MDU6SXNzdWUzNzU5ODY0MjA=", "number": 23405, "title": "build with default cuda options fails with \"/bin/bash: CUDA_TOOLKIT_PATH: unbound variable\"", "user": {"login": "wdirons", "id": 22967383, "node_id": "MDQ6VXNlcjIyOTY3Mzgz", "avatar_url": "https://avatars3.githubusercontent.com/u/22967383?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wdirons", "html_url": "https://github.com/wdirons", "followers_url": "https://api.github.com/users/wdirons/followers", "following_url": "https://api.github.com/users/wdirons/following{/other_user}", "gists_url": "https://api.github.com/users/wdirons/gists{/gist_id}", "starred_url": "https://api.github.com/users/wdirons/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wdirons/subscriptions", "organizations_url": "https://api.github.com/users/wdirons/orgs", "repos_url": "https://api.github.com/users/wdirons/repos", "events_url": "https://api.github.com/users/wdirons/events{/privacy}", "received_events_url": "https://api.github.com/users/wdirons/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473173351, "node_id": "MDU6TGFiZWw0NzMxNzMzNTE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:build/install", "name": "type:build/install", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "harshini-gadige", "id": 42781361, "node_id": "MDQ6VXNlcjQyNzgxMzYx", "avatar_url": "https://avatars1.githubusercontent.com/u/42781361?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harshini-gadige", "html_url": "https://github.com/harshini-gadige", "followers_url": "https://api.github.com/users/harshini-gadige/followers", "following_url": "https://api.github.com/users/harshini-gadige/following{/other_user}", "gists_url": "https://api.github.com/users/harshini-gadige/gists{/gist_id}", "starred_url": "https://api.github.com/users/harshini-gadige/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harshini-gadige/subscriptions", "organizations_url": "https://api.github.com/users/harshini-gadige/orgs", "repos_url": "https://api.github.com/users/harshini-gadige/repos", "events_url": "https://api.github.com/users/harshini-gadige/events{/privacy}", "received_events_url": "https://api.github.com/users/harshini-gadige/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "harshini-gadige", "id": 42781361, "node_id": "MDQ6VXNlcjQyNzgxMzYx", "avatar_url": "https://avatars1.githubusercontent.com/u/42781361?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harshini-gadige", "html_url": "https://github.com/harshini-gadige", "followers_url": "https://api.github.com/users/harshini-gadige/followers", "following_url": "https://api.github.com/users/harshini-gadige/following{/other_user}", "gists_url": "https://api.github.com/users/harshini-gadige/gists{/gist_id}", "starred_url": "https://api.github.com/users/harshini-gadige/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harshini-gadige/subscriptions", "organizations_url": "https://api.github.com/users/harshini-gadige/orgs", "repos_url": "https://api.github.com/users/harshini-gadige/repos", "events_url": "https://api.github.com/users/harshini-gadige/events{/privacy}", "received_events_url": "https://api.github.com/users/harshini-gadige/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2018-10-31T14:21:16Z", "updated_at": "2018-11-02T16:19:29Z", "closed_at": "2018-11-02T16:19:29Z", "author_association": "CONTRIBUTOR", "body_html": "<p><strong>System information</strong></p>\n<ul>\n<li>Have I written custom code (as opposed to using a stock example script provided in TensorFlow): No</li>\n<li>OS Platform and Distribution (e.g., Linux Ubuntu 16.04):  Linux Ubuntu 16.04.5  x86_64</li>\n<li>Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: N/A</li>\n<li>TensorFlow installed from (source or binary): source</li>\n<li>TensorFlow version (use command below): master branch from 10/31/18 -</li>\n<li>Python version:</li>\n<li>Bazel version (if compiling from source): 0.18.0</li>\n<li>GCC/Compiler version (if compiling from source): 5.4.0 20160609</li>\n<li>CUDA/cuDNN version: 9.0/7</li>\n<li>GPU model and memory: 2x Tesla P100 16 GB</li>\n</ul>\n<p><strong>Describe the current behavior</strong><br>\nConfiguring TF to build with CUDA support and choosing all the default option for all the other questions in ./configure including the default for NCCL \"Please specify the locally installed NCCL version you want to use. [Default is to use https://github.com/nvidia/nccl]:\", the build fails with \"/bin/bash: CUDA_TOOLKIT_PATH: unbound variable\"</p>\n<p>This has been broken since this commit:<br>\n<a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/fc6cd33c334f88759ce637e29e1586733076e094/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/fc6cd33c334f88759ce637e29e1586733076e094\"><tt>fc6cd33</tt></a></p>\n<p>Running in the docker container: nvidia/cuda:9.0-cudnn7-devel (for ease of setup)<br>\nexport TF_NEED_CUDA=1<br>\n\"\" | ./configure<br>\nbazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package</p>\n<p>failed with:<br>\nERROR: /root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/external/nccl_archive/BUILD.bazel:139:1: Executing genrule @nccl_archive//:device_code_fatbin_h failed (Exit 1)<br>\n/bin/bash: CUDA_TOOLKIT_PATH: unbound variable<br>\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build<br>\nUse --verbose_failures to see the command lines of failed build steps.<br>\nINFO: Elapsed time: 267.057s, Critical Path: 93.66s<br>\nINFO: 3606 processes: 3606 local.<br>\nFAILED: Build did NOT complete successfully</p>\n<p><strong>Describe the expected behavior</strong><br>\nBuild should succeed.</p>\n<p><strong>Code to reproduce the issue</strong><br>\nexport TF_NEED_CUDA=1<br>\n\"\" | ./configure<br>\nbazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package</p>\n<p><strong>Other info / logs</strong><br>\nFails on both x86 and ppc64le, tried with both bazel 0.15.0 and 0.18.0</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): No\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):  Linux Ubuntu 16.04.5  x86_64\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: N/A\nTensorFlow installed from (source or binary): source\nTensorFlow version (use command below): master branch from 10/31/18 -\nPython version:\nBazel version (if compiling from source): 0.18.0\nGCC/Compiler version (if compiling from source): 5.4.0 20160609\nCUDA/cuDNN version: 9.0/7\nGPU model and memory: 2x Tesla P100 16 GB\n\nDescribe the current behavior\nConfiguring TF to build with CUDA support and choosing all the default option for all the other questions in ./configure including the default for NCCL \"Please specify the locally installed NCCL version you want to use. [Default is to use https://github.com/nvidia/nccl]:\", the build fails with \"/bin/bash: CUDA_TOOLKIT_PATH: unbound variable\"\nThis has been broken since this commit:\nfc6cd33\nRunning in the docker container: nvidia/cuda:9.0-cudnn7-devel (for ease of setup)\nexport TF_NEED_CUDA=1\n\"\" | ./configure\nbazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package\nfailed with:\nERROR: /root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/external/nccl_archive/BUILD.bazel:139:1: Executing genrule @nccl_archive//:device_code_fatbin_h failed (Exit 1)\n/bin/bash: CUDA_TOOLKIT_PATH: unbound variable\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\nUse --verbose_failures to see the command lines of failed build steps.\nINFO: Elapsed time: 267.057s, Critical Path: 93.66s\nINFO: 3606 processes: 3606 local.\nFAILED: Build did NOT complete successfully\nDescribe the expected behavior\nBuild should succeed.\nCode to reproduce the issue\nexport TF_NEED_CUDA=1\n\"\" | ./configure\nbazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package\nOther info / logs\nFails on both x86 and ppc64le, tried with both bazel 0.15.0 and 0.18.0", "body": "**System information**\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow): No\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 16.04):  Linux Ubuntu 16.04.5  x86_64\r\n- Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: N/A\r\n- TensorFlow installed from (source or binary): source\r\n- TensorFlow version (use command below): master branch from 10/31/18 - \r\n- Python version:\r\n- Bazel version (if compiling from source): 0.18.0\r\n- GCC/Compiler version (if compiling from source): 5.4.0 20160609\r\n- CUDA/cuDNN version: 9.0/7\r\n- GPU model and memory: 2x Tesla P100 16 GB\r\n\r\n**Describe the current behavior**\r\nConfiguring TF to build with CUDA support and choosing all the default option for all the other questions in ./configure including the default for NCCL \"Please specify the locally installed NCCL version you want to use. [Default is to use https://github.com/nvidia/nccl]:\", the build fails with \"/bin/bash: CUDA_TOOLKIT_PATH: unbound variable\"\r\n\r\nThis has been broken since this commit:\r\nhttps://github.com/tensorflow/tensorflow/commit/fc6cd33c334f88759ce637e29e1586733076e094\r\n\r\nRunning in the docker container: nvidia/cuda:9.0-cudnn7-devel (for ease of setup)\r\nexport TF_NEED_CUDA=1\r\n\"\" | ./configure\r\nbazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package\r\n\r\nfailed with:\r\nERROR: /root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/external/nccl_archive/BUILD.bazel:139:1: Executing genrule @nccl_archive//:device_code_fatbin_h failed (Exit 1)\r\n/bin/bash: CUDA_TOOLKIT_PATH: unbound variable\r\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\r\nUse --verbose_failures to see the command lines of failed build steps.\r\nINFO: Elapsed time: 267.057s, Critical Path: 93.66s\r\nINFO: 3606 processes: 3606 local.\r\nFAILED: Build did NOT complete successfully\r\n\r\n\r\n**Describe the expected behavior**\r\nBuild should succeed. \r\n\r\n**Code to reproduce the issue**\r\nexport TF_NEED_CUDA=1\r\n\"\" | ./configure\r\nbazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package\r\n\r\n**Other info / logs**\r\nFails on both x86 and ppc64le, tried with both bazel 0.15.0 and 0.18.0\r\n"}