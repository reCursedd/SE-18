{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7700", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7700/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7700/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7700/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/7700", "id": 208904868, "node_id": "MDU6SXNzdWUyMDg5MDQ4Njg=", "number": 7700, "title": "Can't enforce shape invariants with TensorArrays in while_loop", "user": {"login": "aliosmanulusoy", "id": 1033593, "node_id": "MDQ6VXNlcjEwMzM1OTM=", "avatar_url": "https://avatars2.githubusercontent.com/u/1033593?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aliosmanulusoy", "html_url": "https://github.com/aliosmanulusoy", "followers_url": "https://api.github.com/users/aliosmanulusoy/followers", "following_url": "https://api.github.com/users/aliosmanulusoy/following{/other_user}", "gists_url": "https://api.github.com/users/aliosmanulusoy/gists{/gist_id}", "starred_url": "https://api.github.com/users/aliosmanulusoy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aliosmanulusoy/subscriptions", "organizations_url": "https://api.github.com/users/aliosmanulusoy/orgs", "repos_url": "https://api.github.com/users/aliosmanulusoy/repos", "events_url": "https://api.github.com/users/aliosmanulusoy/events{/privacy}", "received_events_url": "https://api.github.com/users/aliosmanulusoy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 284443156, "node_id": "MDU6TGFiZWwyODQ0NDMxNTY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:docs", "name": "type:docs", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 19, "created_at": "2017-02-20T15:03:51Z", "updated_at": "2018-06-27T23:51:58Z", "closed_at": "2018-06-27T23:51:58Z", "author_association": "NONE", "body_html": "<p>I can't enforce shape invariants in a while_loop if one of the inputs is a TensorArray. Here's a minimal example:</p>\n<pre><code>import tensorflow as tf\n\ndef body(i,ta):\n    ta = ta.write(i,1.0)\n    return (i+1,ta)\n\narr_size = 10\nta = tf.TensorArray(tf.float32, size=arr_size)\n\ni = tf.constant(0,tf.int32)\ninput = (i,ta)\ncond = lambda i,_ : i &lt; arr_size\noutput = tf.while_loop(cond, body,input,shape_invariants=(i.get_shape(),tf.TensorShape(arr_size)))\n\n#works fine without shape_invariants:\n#output = tf.while_loop(cond, body,input)\n\nmat = output[1].stack()\nsess = tf.InteractiveSession()\nprint(mat.eval())\n</code></pre>\n<p>The code above works fine if the while_loop is not fed shape_invariants. Using shape_invariants though, I get the following error:</p>\n<pre><code>ValueError: The shape invariant specified for TensorArray:1 is not compatible with the initial shape of the loop variable. It enters the loop with shape &lt;unknown&gt;, but the specified shape invariant is (10,).\n</code></pre>\n<p>Am I doing something wrong or is this a bug?</p>\n<p>Thanks!</p>", "body_text": "I can't enforce shape invariants in a while_loop if one of the inputs is a TensorArray. Here's a minimal example:\nimport tensorflow as tf\n\ndef body(i,ta):\n    ta = ta.write(i,1.0)\n    return (i+1,ta)\n\narr_size = 10\nta = tf.TensorArray(tf.float32, size=arr_size)\n\ni = tf.constant(0,tf.int32)\ninput = (i,ta)\ncond = lambda i,_ : i < arr_size\noutput = tf.while_loop(cond, body,input,shape_invariants=(i.get_shape(),tf.TensorShape(arr_size)))\n\n#works fine without shape_invariants:\n#output = tf.while_loop(cond, body,input)\n\nmat = output[1].stack()\nsess = tf.InteractiveSession()\nprint(mat.eval())\n\nThe code above works fine if the while_loop is not fed shape_invariants. Using shape_invariants though, I get the following error:\nValueError: The shape invariant specified for TensorArray:1 is not compatible with the initial shape of the loop variable. It enters the loop with shape <unknown>, but the specified shape invariant is (10,).\n\nAm I doing something wrong or is this a bug?\nThanks!", "body": "I can't enforce shape invariants in a while_loop if one of the inputs is a TensorArray. Here's a minimal example: \r\n```\r\nimport tensorflow as tf\r\n\r\ndef body(i,ta):\r\n    ta = ta.write(i,1.0)\r\n    return (i+1,ta)\r\n\r\narr_size = 10\r\nta = tf.TensorArray(tf.float32, size=arr_size)\r\n\r\ni = tf.constant(0,tf.int32)\r\ninput = (i,ta)\r\ncond = lambda i,_ : i < arr_size\r\noutput = tf.while_loop(cond, body,input,shape_invariants=(i.get_shape(),tf.TensorShape(arr_size)))\r\n\r\n#works fine without shape_invariants:\r\n#output = tf.while_loop(cond, body,input)\r\n\r\nmat = output[1].stack()\r\nsess = tf.InteractiveSession()\r\nprint(mat.eval())\r\n```\r\n\r\nThe code above works fine if the while_loop is not fed shape_invariants. Using shape_invariants though, I get the following error: \r\n```\r\nValueError: The shape invariant specified for TensorArray:1 is not compatible with the initial shape of the loop variable. It enters the loop with shape <unknown>, but the specified shape invariant is (10,).\r\n```\r\n\r\nAm I doing something wrong or is this a bug?\r\n\r\nThanks! "}