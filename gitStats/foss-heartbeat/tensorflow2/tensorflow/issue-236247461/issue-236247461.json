{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10736", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10736/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10736/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10736/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/10736", "id": 236247461, "node_id": "MDU6SXNzdWUyMzYyNDc0NjE=", "number": 10736, "title": "seq2seq.BasicDecoder incompatible with seq2seq.ScheduledOutputTrainingHelper", "user": {"login": "woodshop", "id": 4654379, "node_id": "MDQ6VXNlcjQ2NTQzNzk=", "avatar_url": "https://avatars3.githubusercontent.com/u/4654379?v=4", "gravatar_id": "", "url": "https://api.github.com/users/woodshop", "html_url": "https://github.com/woodshop", "followers_url": "https://api.github.com/users/woodshop/followers", "following_url": "https://api.github.com/users/woodshop/following{/other_user}", "gists_url": "https://api.github.com/users/woodshop/gists{/gist_id}", "starred_url": "https://api.github.com/users/woodshop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/woodshop/subscriptions", "organizations_url": "https://api.github.com/users/woodshop/orgs", "repos_url": "https://api.github.com/users/woodshop/repos", "events_url": "https://api.github.com/users/woodshop/events{/privacy}", "received_events_url": "https://api.github.com/users/woodshop/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-06-15T16:30:52Z", "updated_at": "2017-06-22T16:25:03Z", "closed_at": "2017-06-22T16:25:03Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Ubuntu 16.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: source</li>\n<li><strong>TensorFlow version (use command below)</strong>:  b'v1.1.0-0-g1ec6ed5' 1.1.0</li>\n<li><strong>Bazel version (if compiling from source)</strong>: 0.5.1</li>\n<li><strong>CUDA/cuDNN version</strong>: 5.1.3</li>\n<li><strong>GPU model and memory</strong>: TitanX 12GB</li>\n<li><strong>Exact command to reproduce</strong>: See script below</li>\n</ul>\n<h3>Describe the problem</h3>\n<p><code>seq2seq.ScheduledOutputTrainingHelper.sample(...)</code> outputs a <code>tf.bool</code> tensor but <code>seq2seq.BasicDecoder.output_dtype</code> assumes <code>tf.int32</code> output.</p>\n<h3>Source code / logs</h3>\n<p>Minimal case script:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n<span class=\"pl-k\">with</span> tf.Graph().as_default():\n    batch_size <span class=\"pl-k\">=</span> <span class=\"pl-c1\">32</span>\n    nsteps <span class=\"pl-k\">=</span> <span class=\"pl-c1\">100</span>\n    ndims <span class=\"pl-k\">=</span> <span class=\"pl-c1\">5</span>\n    sequence_length <span class=\"pl-k\">=</span> [nsteps] <span class=\"pl-k\">*</span> batch_size\n    sampling_probability <span class=\"pl-k\">=</span> <span class=\"pl-c1\">0.5</span>\n    num_units <span class=\"pl-k\">=</span> <span class=\"pl-c1\">20</span>\n\n    cell <span class=\"pl-k\">=</span> tf.contrib.rnn.BasicRNNCell(\n        num_units,\n    )\n\n    inputs <span class=\"pl-k\">=</span> tf.random_uniform((batch_size, nsteps, ndims))\n\n    output, state <span class=\"pl-k\">=</span> tf.nn.dynamic_rnn(\n        cell,\n        inputs,\n        <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>tf.float32,\n    )\n\n    cell <span class=\"pl-k\">=</span> tf.contrib.rnn.BasicRNNCell(\n        num_units,\n    )\n\n    helper <span class=\"pl-k\">=</span> tf.contrib.seq2seq.ScheduledOutputTrainingHelper(\n        output,\n        sequence_length,\n        sampling_probability,\n    )\n\n    initial_state <span class=\"pl-k\">=</span> tf.zeros((batch_size, num_units))\n    decoder <span class=\"pl-k\">=</span> tf.contrib.seq2seq.BasicDecoder(\n        cell,\n        helper,\n        initial_state,\n    )\n\n    decoded <span class=\"pl-k\">=</span> tf.contrib.seq2seq.dynamic_decode(\n        decoder,\n    )\n\n    run_ops <span class=\"pl-k\">=</span> {<span class=\"pl-s\"><span class=\"pl-pds\">'</span>decoded<span class=\"pl-pds\">'</span></span>: decoded}\n    <span class=\"pl-k\">with</span> tf.Session() <span class=\"pl-k\">as</span> sess:\n        sess.run(tf.global_variables_initializer())\n        ret <span class=\"pl-k\">=</span> sess.run(run_ops)</pre></div>\n<p>Output:</p>\n<div class=\"highlight highlight-source-shell\"><pre>2017-06-15 12:28:39.868640: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn<span class=\"pl-s\"><span class=\"pl-pds\">'</span>t compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.</span>\n<span class=\"pl-s\">2017-06-15 12:28:39.868659: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn<span class=\"pl-pds\">'</span></span>t compiled to use AVX2 instructions, but these are available on your machine and could speed up CPU computations.\n2017-06-15 12:28:39.868664: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn<span class=\"pl-s\"><span class=\"pl-pds\">'</span>t compiled to use FMA instructions, but these are available on your machine and could speed up CPU computations.</span>\n<span class=\"pl-s\">2017-06-15 12:28:40.234562: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:901] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero</span>\n<span class=\"pl-s\">2017-06-15 12:28:40.234768: I tensorflow/core/common_runtime/gpu/gpu_device.cc:887] Found device 0 with properties:</span>\n<span class=\"pl-s\">name: GeForce GTX TITAN X</span>\n<span class=\"pl-s\">major: 5 minor: 2 memoryClockRate (GHz) 1.076</span>\n<span class=\"pl-s\">pciBusID 0000:01:00.0</span>\n<span class=\"pl-s\">Total memory: 11.92GiB</span>\n<span class=\"pl-s\">Free memory: 384.19MiB</span>\n<span class=\"pl-s\">2017-06-15 12:28:40.234817: W tensorflow/stream_executor/cuda/cuda_driver.cc:485] creating context when one is currently active; existing: 0x31b49d0</span>\n<span class=\"pl-s\">2017-06-15 12:28:40.315855: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:901] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero</span>\n<span class=\"pl-s\">2017-06-15 12:28:40.316063: I tensorflow/core/common_runtime/gpu/gpu_device.cc:887] Found device 1 with properties:</span>\n<span class=\"pl-s\">name: GeForce GTX TITAN X</span>\n<span class=\"pl-s\">major: 5 minor: 2 memoryClockRate (GHz) 1.076</span>\n<span class=\"pl-s\">pciBusID 0000:02:00.0</span>\n<span class=\"pl-s\">Total memory: 11.92GiB</span>\n<span class=\"pl-s\">Free memory: 384.19MiB</span>\n<span class=\"pl-s\">2017-06-15 12:28:40.318076: I tensorflow/core/common_runtime/gpu/gpu_device.cc:908] DMA: 0 1</span>\n<span class=\"pl-s\">2017-06-15 12:28:40.318084: I tensorflow/core/common_runtime/gpu/gpu_device.cc:918] 0:   Y Y</span>\n<span class=\"pl-s\">2017-06-15 12:28:40.318088: I tensorflow/core/common_runtime/gpu/gpu_device.cc:918] 1:   Y Y</span>\n<span class=\"pl-s\">2017-06-15 12:28:40.318093: I tensorflow/core/common_runtime/gpu/gpu_device.cc:977] Creating TensorFlow device (/gpu:0) -&gt; (device: 0, name: GeForce GTX TITAN X, pci bus id: 0000:01:00.0)</span>\n<span class=\"pl-s\">2017-06-15 12:28:40.318098: I tensorflow/core/common_runtime/gpu/gpu_device.cc:977] Creating TensorFlow device (/gpu:1) -&gt; (device: 1, name: GeForce GTX TITAN X, pci bus id: 0000:02:00.0)</span>\n<span class=\"pl-s\">2017-06-15 12:28:40.927295: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.</span>\n<span class=\"pl-s\">\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]</span>\n<span class=\"pl-s\">2017-06-15 12:28:40.927295: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.</span>\n<span class=\"pl-s\">\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]</span>\n<span class=\"pl-s\">2017-06-15 12:28:40.927369: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.</span>\n<span class=\"pl-s\">\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]</span>\n<span class=\"pl-s\">2017-06-15 12:28:40.927384: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.</span>\n<span class=\"pl-s\">\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]</span>\n<span class=\"pl-s\">2017-06-15 12:28:40.927443: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.</span>\n<span class=\"pl-s\">\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]</span>\n<span class=\"pl-s\">2017-06-15 12:28:40.927469: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.</span>\n<span class=\"pl-s\">\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]</span>\n<span class=\"pl-s\">2017-06-15 12:28:41.647498: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.</span>\n<span class=\"pl-s\">\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]</span>\n<span class=\"pl-s\">Traceback (most recent call last):</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1039, in _do_call</span>\n<span class=\"pl-s\">    return fn(*args)</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1021, in _run_fn</span>\n<span class=\"pl-s\">    status, run_metadata)</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/contextlib.py\", line 89, in __exit__</span>\n<span class=\"pl-s\">    next(self.gen)</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/framework/errors_impl.py\", line 466, in raise_exception_on_not_ok_status</span>\n<span class=\"pl-s\">    pywrap_tensorflow.TF_GetCode(status))</span>\n<span class=\"pl-s\">tensorflow.python.framework.errors_impl.InvalidArgumentError: TensorArray dtype is int32 but Op is trying to write dtype bool.</span>\n<span class=\"pl-s\">\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]</span>\n<span class=\"pl-s\"></span>\n<span class=\"pl-s\">During handling of the above exception, another exception occurred:</span>\n<span class=\"pl-s\"></span>\n<span class=\"pl-s\">Traceback (most recent call last):</span>\n<span class=\"pl-s\">  File \"tmp/scratch2.py\", line 46, in &lt;module&gt;</span>\n<span class=\"pl-s\">    ret = sess.run(run_ops)</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 778, in run</span>\n<span class=\"pl-s\">    run_metadata_ptr)</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 982, in _run</span>\n<span class=\"pl-s\">    feed_dict_string, options, run_metadata)</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1032, in _do_run</span>\n<span class=\"pl-s\">    target_list, options, run_metadata)</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1052, in _do_call</span>\n<span class=\"pl-s\">    raise type(e)(node_def, op, message)</span>\n<span class=\"pl-s\">tensorflow.python.framework.errors_impl.InvalidArgumentError: TensorArray dtype is int32 but Op is trying to write dtype bool.</span>\n<span class=\"pl-s\">\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]</span>\n<span class=\"pl-s\"></span>\n<span class=\"pl-s\">Caused by op <span class=\"pl-pds\">'</span></span>decoder/while/TensorArrayWrite_1/TensorArrayWriteV3<span class=\"pl-s\"><span class=\"pl-pds\">'</span>, defined at:</span>\n<span class=\"pl-s\">  File \"tmp/scratch2.py\", line 40, in &lt;module&gt;</span>\n<span class=\"pl-s\">    decoder,</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 278, in dynamic_decode</span>\n<span class=\"pl-s\">    swap_memory=swap_memory)</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2623, in while_loop</span>\n<span class=\"pl-s\">    result = context.BuildLoop(cond, body, loop_vars, shape_invariants)</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2456, in BuildLoop</span>\n<span class=\"pl-s\">    pred, body, original_loop_vars, loop_vars, shape_invariants)</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2406, in _BuildLoop</span>\n<span class=\"pl-s\">    body_result = body(*packed_vars_for_body)</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 267, in body</span>\n<span class=\"pl-s\">    outputs_ta, emit)</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/util/nest.py\", line 305, in map_structure</span>\n<span class=\"pl-s\">    structure[0], [func(*x) for x in entries])</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/util/nest.py\", line 305, in &lt;listcomp&gt;</span>\n<span class=\"pl-s\">    structure[0], [func(*x) for x in entries])</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 266, in &lt;lambda&gt;</span>\n<span class=\"pl-s\">    outputs_ta = nest.map_structure(lambda ta, out: ta.write(time, out),</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 279, in write</span>\n<span class=\"pl-s\">    name=name)</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 2823, in _tensor_array_write_v3</span>\n<span class=\"pl-s\">    name=name)</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 768, in apply_op</span>\n<span class=\"pl-s\">    op_def=op_def)</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 2336, in create_op</span>\n<span class=\"pl-s\">    original_op=self._default_original_op, op_def=op_def)</span>\n<span class=\"pl-s\">  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1228, in __init__</span>\n<span class=\"pl-s\">    self._traceback = _extract_stack()</span>\n<span class=\"pl-s\"></span>\n<span class=\"pl-s\">InvalidArgumentError (see above for traceback): TensorArray dtype is int32 but Op is trying to write dtype bool.</span>\n<span class=\"pl-s\">\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]</span></pre></div>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Ubuntu 16.04\nTensorFlow installed from (source or binary): source\nTensorFlow version (use command below):  b'v1.1.0-0-g1ec6ed5' 1.1.0\nBazel version (if compiling from source): 0.5.1\nCUDA/cuDNN version: 5.1.3\nGPU model and memory: TitanX 12GB\nExact command to reproduce: See script below\n\nDescribe the problem\nseq2seq.ScheduledOutputTrainingHelper.sample(...) outputs a tf.bool tensor but seq2seq.BasicDecoder.output_dtype assumes tf.int32 output.\nSource code / logs\nMinimal case script:\nimport tensorflow as tf\nwith tf.Graph().as_default():\n    batch_size = 32\n    nsteps = 100\n    ndims = 5\n    sequence_length = [nsteps] * batch_size\n    sampling_probability = 0.5\n    num_units = 20\n\n    cell = tf.contrib.rnn.BasicRNNCell(\n        num_units,\n    )\n\n    inputs = tf.random_uniform((batch_size, nsteps, ndims))\n\n    output, state = tf.nn.dynamic_rnn(\n        cell,\n        inputs,\n        dtype=tf.float32,\n    )\n\n    cell = tf.contrib.rnn.BasicRNNCell(\n        num_units,\n    )\n\n    helper = tf.contrib.seq2seq.ScheduledOutputTrainingHelper(\n        output,\n        sequence_length,\n        sampling_probability,\n    )\n\n    initial_state = tf.zeros((batch_size, num_units))\n    decoder = tf.contrib.seq2seq.BasicDecoder(\n        cell,\n        helper,\n        initial_state,\n    )\n\n    decoded = tf.contrib.seq2seq.dynamic_decode(\n        decoder,\n    )\n\n    run_ops = {'decoded': decoded}\n    with tf.Session() as sess:\n        sess.run(tf.global_variables_initializer())\n        ret = sess.run(run_ops)\nOutput:\n2017-06-15 12:28:39.868640: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.\n2017-06-15 12:28:39.868659: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX2 instructions, but these are available on your machine and could speed up CPU computations.\n2017-06-15 12:28:39.868664: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use FMA instructions, but these are available on your machine and could speed up CPU computations.\n2017-06-15 12:28:40.234562: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:901] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2017-06-15 12:28:40.234768: I tensorflow/core/common_runtime/gpu/gpu_device.cc:887] Found device 0 with properties:\nname: GeForce GTX TITAN X\nmajor: 5 minor: 2 memoryClockRate (GHz) 1.076\npciBusID 0000:01:00.0\nTotal memory: 11.92GiB\nFree memory: 384.19MiB\n2017-06-15 12:28:40.234817: W tensorflow/stream_executor/cuda/cuda_driver.cc:485] creating context when one is currently active; existing: 0x31b49d0\n2017-06-15 12:28:40.315855: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:901] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2017-06-15 12:28:40.316063: I tensorflow/core/common_runtime/gpu/gpu_device.cc:887] Found device 1 with properties:\nname: GeForce GTX TITAN X\nmajor: 5 minor: 2 memoryClockRate (GHz) 1.076\npciBusID 0000:02:00.0\nTotal memory: 11.92GiB\nFree memory: 384.19MiB\n2017-06-15 12:28:40.318076: I tensorflow/core/common_runtime/gpu/gpu_device.cc:908] DMA: 0 1\n2017-06-15 12:28:40.318084: I tensorflow/core/common_runtime/gpu/gpu_device.cc:918] 0:   Y Y\n2017-06-15 12:28:40.318088: I tensorflow/core/common_runtime/gpu/gpu_device.cc:918] 1:   Y Y\n2017-06-15 12:28:40.318093: I tensorflow/core/common_runtime/gpu/gpu_device.cc:977] Creating TensorFlow device (/gpu:0) -> (device: 0, name: GeForce GTX TITAN X, pci bus id: 0000:01:00.0)\n2017-06-15 12:28:40.318098: I tensorflow/core/common_runtime/gpu/gpu_device.cc:977] Creating TensorFlow device (/gpu:1) -> (device: 1, name: GeForce GTX TITAN X, pci bus id: 0000:02:00.0)\n2017-06-15 12:28:40.927295: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\n2017-06-15 12:28:40.927295: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\n2017-06-15 12:28:40.927369: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\n2017-06-15 12:28:40.927384: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\n2017-06-15 12:28:40.927443: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\n2017-06-15 12:28:40.927469: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\n2017-06-15 12:28:41.647498: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\nTraceback (most recent call last):\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1039, in _do_call\n    return fn(*args)\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1021, in _run_fn\n    status, run_metadata)\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/contextlib.py\", line 89, in __exit__\n    next(self.gen)\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/framework/errors_impl.py\", line 466, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors_impl.InvalidArgumentError: TensorArray dtype is int32 but Op is trying to write dtype bool.\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"tmp/scratch2.py\", line 46, in <module>\n    ret = sess.run(run_ops)\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 778, in run\n    run_metadata_ptr)\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 982, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1032, in _do_run\n    target_list, options, run_metadata)\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1052, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InvalidArgumentError: TensorArray dtype is int32 but Op is trying to write dtype bool.\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\n\nCaused by op 'decoder/while/TensorArrayWrite_1/TensorArrayWriteV3', defined at:\n  File \"tmp/scratch2.py\", line 40, in <module>\n    decoder,\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 278, in dynamic_decode\n    swap_memory=swap_memory)\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2623, in while_loop\n    result = context.BuildLoop(cond, body, loop_vars, shape_invariants)\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2456, in BuildLoop\n    pred, body, original_loop_vars, loop_vars, shape_invariants)\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2406, in _BuildLoop\n    body_result = body(*packed_vars_for_body)\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 267, in body\n    outputs_ta, emit)\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/util/nest.py\", line 305, in map_structure\n    structure[0], [func(*x) for x in entries])\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/util/nest.py\", line 305, in <listcomp>\n    structure[0], [func(*x) for x in entries])\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 266, in <lambda>\n    outputs_ta = nest.map_structure(lambda ta, out: ta.write(time, out),\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 279, in write\n    name=name)\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 2823, in _tensor_array_write_v3\n    name=name)\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 768, in apply_op\n    op_def=op_def)\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 2336, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1228, in __init__\n    self._traceback = _extract_stack()\n\nInvalidArgumentError (see above for traceback): TensorArray dtype is int32 but Op is trying to write dtype bool.\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Ubuntu 16.04\r\n- **TensorFlow installed from (source or binary)**: source \r\n- **TensorFlow version (use command below)**:  b'v1.1.0-0-g1ec6ed5' 1.1.0\r\n- **Bazel version (if compiling from source)**: 0.5.1\r\n- **CUDA/cuDNN version**: 5.1.3\r\n- **GPU model and memory**: TitanX 12GB\r\n- **Exact command to reproduce**: See script below\r\n\r\n### Describe the problem\r\n`seq2seq.ScheduledOutputTrainingHelper.sample(...)` outputs a `tf.bool` tensor but `seq2seq.BasicDecoder.output_dtype` assumes `tf.int32` output.\r\n\r\n### Source code / logs\r\nMinimal case script:\r\n```python\r\nimport tensorflow as tf\r\nwith tf.Graph().as_default():\r\n    batch_size = 32\r\n    nsteps = 100\r\n    ndims = 5\r\n    sequence_length = [nsteps] * batch_size\r\n    sampling_probability = 0.5\r\n    num_units = 20\r\n\r\n    cell = tf.contrib.rnn.BasicRNNCell(\r\n        num_units,\r\n    )\r\n\r\n    inputs = tf.random_uniform((batch_size, nsteps, ndims))\r\n\r\n    output, state = tf.nn.dynamic_rnn(\r\n        cell,\r\n        inputs,\r\n        dtype=tf.float32,\r\n    )\r\n\r\n    cell = tf.contrib.rnn.BasicRNNCell(\r\n        num_units,\r\n    )\r\n\r\n    helper = tf.contrib.seq2seq.ScheduledOutputTrainingHelper(\r\n        output,\r\n        sequence_length,\r\n        sampling_probability,\r\n    )\r\n\r\n    initial_state = tf.zeros((batch_size, num_units))\r\n    decoder = tf.contrib.seq2seq.BasicDecoder(\r\n        cell,\r\n        helper,\r\n        initial_state,\r\n    )\r\n\r\n    decoded = tf.contrib.seq2seq.dynamic_decode(\r\n        decoder,\r\n    )\r\n\r\n    run_ops = {'decoded': decoded}\r\n    with tf.Session() as sess:\r\n        sess.run(tf.global_variables_initializer())\r\n        ret = sess.run(run_ops)\r\n```\r\nOutput:\r\n```bash\r\n2017-06-15 12:28:39.868640: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.\r\n2017-06-15 12:28:39.868659: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX2 instructions, but these are available on your machine and could speed up CPU computations.\r\n2017-06-15 12:28:39.868664: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use FMA instructions, but these are available on your machine and could speed up CPU computations.\r\n2017-06-15 12:28:40.234562: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:901] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2017-06-15 12:28:40.234768: I tensorflow/core/common_runtime/gpu/gpu_device.cc:887] Found device 0 with properties:\r\nname: GeForce GTX TITAN X\r\nmajor: 5 minor: 2 memoryClockRate (GHz) 1.076\r\npciBusID 0000:01:00.0\r\nTotal memory: 11.92GiB\r\nFree memory: 384.19MiB\r\n2017-06-15 12:28:40.234817: W tensorflow/stream_executor/cuda/cuda_driver.cc:485] creating context when one is currently active; existing: 0x31b49d0\r\n2017-06-15 12:28:40.315855: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:901] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2017-06-15 12:28:40.316063: I tensorflow/core/common_runtime/gpu/gpu_device.cc:887] Found device 1 with properties:\r\nname: GeForce GTX TITAN X\r\nmajor: 5 minor: 2 memoryClockRate (GHz) 1.076\r\npciBusID 0000:02:00.0\r\nTotal memory: 11.92GiB\r\nFree memory: 384.19MiB\r\n2017-06-15 12:28:40.318076: I tensorflow/core/common_runtime/gpu/gpu_device.cc:908] DMA: 0 1\r\n2017-06-15 12:28:40.318084: I tensorflow/core/common_runtime/gpu/gpu_device.cc:918] 0:   Y Y\r\n2017-06-15 12:28:40.318088: I tensorflow/core/common_runtime/gpu/gpu_device.cc:918] 1:   Y Y\r\n2017-06-15 12:28:40.318093: I tensorflow/core/common_runtime/gpu/gpu_device.cc:977] Creating TensorFlow device (/gpu:0) -> (device: 0, name: GeForce GTX TITAN X, pci bus id: 0000:01:00.0)\r\n2017-06-15 12:28:40.318098: I tensorflow/core/common_runtime/gpu/gpu_device.cc:977] Creating TensorFlow device (/gpu:1) -> (device: 1, name: GeForce GTX TITAN X, pci bus id: 0000:02:00.0)\r\n2017-06-15 12:28:40.927295: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.\r\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\r\n2017-06-15 12:28:40.927295: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.\r\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\r\n2017-06-15 12:28:40.927369: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.\r\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\r\n2017-06-15 12:28:40.927384: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.\r\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\r\n2017-06-15 12:28:40.927443: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.\r\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\r\n2017-06-15 12:28:40.927469: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.\r\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\r\n2017-06-15 12:28:41.647498: W tensorflow/core/framework/op_kernel.cc:1152] Invalid argument: TensorArray dtype is int32 but Op is trying to write dtype bool.\r\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\r\nTraceback (most recent call last):\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1039, in _do_call\r\n    return fn(*args)\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1021, in _run_fn\r\n    status, run_metadata)\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/contextlib.py\", line 89, in __exit__\r\n    next(self.gen)\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/framework/errors_impl.py\", line 466, in raise_exception_on_not_ok_status\r\n    pywrap_tensorflow.TF_GetCode(status))\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: TensorArray dtype is int32 but Op is trying to write dtype bool.\r\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"tmp/scratch2.py\", line 46, in <module>\r\n    ret = sess.run(run_ops)\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 778, in run\r\n    run_metadata_ptr)\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 982, in _run\r\n    feed_dict_string, options, run_metadata)\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1032, in _do_run\r\n    target_list, options, run_metadata)\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1052, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: TensorArray dtype is int32 but Op is trying to write dtype bool.\r\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\r\n\r\nCaused by op 'decoder/while/TensorArrayWrite_1/TensorArrayWriteV3', defined at:\r\n  File \"tmp/scratch2.py\", line 40, in <module>\r\n    decoder,\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 278, in dynamic_decode\r\n    swap_memory=swap_memory)\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2623, in while_loop\r\n    result = context.BuildLoop(cond, body, loop_vars, shape_invariants)\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2456, in BuildLoop\r\n    pred, body, original_loop_vars, loop_vars, shape_invariants)\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2406, in _BuildLoop\r\n    body_result = body(*packed_vars_for_body)\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 267, in body\r\n    outputs_ta, emit)\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/util/nest.py\", line 305, in map_structure\r\n    structure[0], [func(*x) for x in entries])\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/util/nest.py\", line 305, in <listcomp>\r\n    structure[0], [func(*x) for x in entries])\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 266, in <lambda>\r\n    outputs_ta = nest.map_structure(lambda ta, out: ta.write(time, out),\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 279, in write\r\n    name=name)\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 2823, in _tensor_array_write_v3\r\n    name=name)\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 768, in apply_op\r\n    op_def=op_def)\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 2336, in create_op\r\n    original_op=self._default_original_op, op_def=op_def)\r\n  File \"/home/sarroff/anaconda2/envs/py3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1228, in __init__\r\n    self._traceback = _extract_stack()\r\n\r\nInvalidArgumentError (see above for traceback): TensorArray dtype is int32 but Op is trying to write dtype bool.\r\n\t [[Node: decoder/while/TensorArrayWrite_1/TensorArrayWriteV3 = TensorArrayWriteV3[T=DT_BOOL, _class=[\"loc:@decoder/TensorArray_1\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](decoder/while/TensorArrayWrite_1/TensorArrayWriteV3/Enter, decoder/while/Identity/_47, decoder/while/BasicDecoderStep/ScheduledOutputTrainingHelperSample/Cast/_49, decoder/while/Identity_2/_51)]]\r\n```\r\n"}