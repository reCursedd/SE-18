{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11163", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11163/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11163/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11163/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/11163", "id": 239671764, "node_id": "MDU6SXNzdWUyMzk2NzE3NjQ=", "number": 11163, "title": "Expected one attr with name u'T' in name: \"swap_out_d_0\"", "user": {"login": "abenmao", "id": 29789552, "node_id": "MDQ6VXNlcjI5Nzg5NTUy", "avatar_url": "https://avatars0.githubusercontent.com/u/29789552?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abenmao", "html_url": "https://github.com/abenmao", "followers_url": "https://api.github.com/users/abenmao/followers", "following_url": "https://api.github.com/users/abenmao/following{/other_user}", "gists_url": "https://api.github.com/users/abenmao/gists{/gist_id}", "starred_url": "https://api.github.com/users/abenmao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abenmao/subscriptions", "organizations_url": "https://api.github.com/users/abenmao/orgs", "repos_url": "https://api.github.com/users/abenmao/repos", "events_url": "https://api.github.com/users/abenmao/events{/privacy}", "received_events_url": "https://api.github.com/users/abenmao/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2017-06-30T04:00:46Z", "updated_at": "2018-01-25T01:59:15Z", "closed_at": "2018-01-25T01:59:15Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: Yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Linux</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: source</li>\n<li><strong>TensorFlow version (use command below)</strong>: r1.2</li>\n<li><strong>Python version</strong>: 2.7</li>\n<li><strong>Bazel version (if compiling from source)</strong>: 0.4.5</li>\n<li><strong>CUDA/cuDNN version</strong>: CUDA8.0</li>\n<li><strong>GPU model and memory</strong>:  Tesla P100, 16GB</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>I used OptimizeGraph API in Grappler for inserting \"swap_to_host\" nodes in my graph. When I import the new graph_def generated from this API, I got error mesage: \"Expected one attr with name u'T' in swap_out_d_0.\" I think the new graph_def misses some attribute information.<br>\nI am following this bug and handing on fixing it.</p>\n<h3>Source code / logs</h3>\n<p>source code:</p>\n<div class=\"highlight highlight-source-python\"><pre>d.op.node_def.attr[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>_swap_to_host<span class=\"pl-pds\">'</span></span>].i <span class=\"pl-k\">=</span> <span class=\"pl-c1\">0</span>\nmg <span class=\"pl-k\">=</span> meta_graph.create_meta_graph_def(<span class=\"pl-v\">graph</span><span class=\"pl-k\">=</span>ops.get_default_graph())\ngraph <span class=\"pl-k\">=</span> tf_optimizer.OptimizeGraph(rewriter_config, mg)\ntf.import_graph_def(graph)</pre></div>\n<p>log:</p>\n<div class=\"highlight highlight-source-python\"><pre>Traceback (most recent call last):\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>memory_optimizer_test.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">62</span>, <span class=\"pl-k\">in</span> testSimpleSwap\n    tf.import_graph_def(graph)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/importer.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">307</span>, <span class=\"pl-k\">in</span> import_graph_def\n    output_types <span class=\"pl-k\">=</span> _OutputTypes(node, op_dict)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/importer.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">83</span>, <span class=\"pl-k\">in</span> _OutputTypes\n    <span class=\"pl-k\">return</span> _ArgsToTypes(node_def, op_def.output_arg)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/importer.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">72</span>, <span class=\"pl-k\">in</span> _ArgsToTypes\n    types.extend(_SingleArgToTypes(node_def, arg_def))\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/importer.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">63</span>, <span class=\"pl-k\">in</span> _SingleArgToTypes\n    types <span class=\"pl-k\">=</span> _ArgToTypesNoRef(node_def, arg_def)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/importer.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">54</span>, <span class=\"pl-k\">in</span> _ArgToTypesNoRef\n    <span class=\"pl-k\">return</span> [_GetNodeAttr(node_def, arg_def.type_attr).type]\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/importer.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">40</span>, <span class=\"pl-k\">in</span> _GetNodeAttr\n    <span class=\"pl-k\">%</span> (attr_name, <span class=\"pl-c1\">str</span>(node_def)))\n<span class=\"pl-c1\">ValueError</span>: Expected one attr <span class=\"pl-k\">with</span> name <span class=\"pl-s\"><span class=\"pl-k\">u</span><span class=\"pl-pds\">'</span>T<span class=\"pl-pds\">'</span></span> <span class=\"pl-k\">in</span> name: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>swap_out_d_0<span class=\"pl-pds\">\"</span></span>\nop: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Identity<span class=\"pl-pds\">\"</span></span>\n<span class=\"pl-c1\">input</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>b<span class=\"pl-pds\">\"</span></span>\ndevice: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/CPU<span class=\"pl-pds\">\"</span></span>\n.</pre></div>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux\nTensorFlow installed from (source or binary): source\nTensorFlow version (use command below): r1.2\nPython version: 2.7\nBazel version (if compiling from source): 0.4.5\nCUDA/cuDNN version: CUDA8.0\nGPU model and memory:  Tesla P100, 16GB\n\nDescribe the problem\nI used OptimizeGraph API in Grappler for inserting \"swap_to_host\" nodes in my graph. When I import the new graph_def generated from this API, I got error mesage: \"Expected one attr with name u'T' in swap_out_d_0.\" I think the new graph_def misses some attribute information.\nI am following this bug and handing on fixing it.\nSource code / logs\nsource code:\nd.op.node_def.attr['_swap_to_host'].i = 0\nmg = meta_graph.create_meta_graph_def(graph=ops.get_default_graph())\ngraph = tf_optimizer.OptimizeGraph(rewriter_config, mg)\ntf.import_graph_def(graph)\nlog:\nTraceback (most recent call last):\n  File \"memory_optimizer_test.py\", line 62, in testSimpleSwap\n    tf.import_graph_def(graph)\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 307, in import_graph_def\n    output_types = _OutputTypes(node, op_dict)\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 83, in _OutputTypes\n    return _ArgsToTypes(node_def, op_def.output_arg)\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 72, in _ArgsToTypes\n    types.extend(_SingleArgToTypes(node_def, arg_def))\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 63, in _SingleArgToTypes\n    types = _ArgToTypesNoRef(node_def, arg_def)\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 54, in _ArgToTypesNoRef\n    return [_GetNodeAttr(node_def, arg_def.type_attr).type]\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 40, in _GetNodeAttr\n    % (attr_name, str(node_def)))\nValueError: Expected one attr with name u'T' in name: \"swap_out_d_0\"\nop: \"Identity\"\ninput: \"b\"\ndevice: \"/CPU\"\n.", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: Yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux\r\n- **TensorFlow installed from (source or binary)**: source\r\n- **TensorFlow version (use command below)**: r1.2\r\n- **Python version**: 2.7\r\n- **Bazel version (if compiling from source)**: 0.4.5\r\n- **CUDA/cuDNN version**: CUDA8.0\r\n- **GPU model and memory**:  Tesla P100, 16GB\r\n\r\n### Describe the problem\r\nI used OptimizeGraph API in Grappler for inserting \"swap_to_host\" nodes in my graph. When I import the new graph_def generated from this API, I got error mesage: \"Expected one attr with name u'T' in swap_out_d_0.\" I think the new graph_def misses some attribute information.\r\nI am following this bug and handing on fixing it.\r\n\r\n### Source code / logs\r\nsource code:\r\n\r\n```python\r\nd.op.node_def.attr['_swap_to_host'].i = 0\r\nmg = meta_graph.create_meta_graph_def(graph=ops.get_default_graph())\r\ngraph = tf_optimizer.OptimizeGraph(rewriter_config, mg)\r\ntf.import_graph_def(graph)\r\n```\r\nlog:\r\n\r\n```python\r\nTraceback (most recent call last):\r\n  File \"memory_optimizer_test.py\", line 62, in testSimpleSwap\r\n    tf.import_graph_def(graph)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 307, in import_graph_def\r\n    output_types = _OutputTypes(node, op_dict)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 83, in _OutputTypes\r\n    return _ArgsToTypes(node_def, op_def.output_arg)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 72, in _ArgsToTypes\r\n    types.extend(_SingleArgToTypes(node_def, arg_def))\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 63, in _SingleArgToTypes\r\n    types = _ArgToTypesNoRef(node_def, arg_def)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 54, in _ArgToTypesNoRef\r\n    return [_GetNodeAttr(node_def, arg_def.type_attr).type]\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 40, in _GetNodeAttr\r\n    % (attr_name, str(node_def)))\r\nValueError: Expected one attr with name u'T' in name: \"swap_out_d_0\"\r\nop: \"Identity\"\r\ninput: \"b\"\r\ndevice: \"/CPU\"\r\n.\r\n```\r\n\r\n\r\n"}