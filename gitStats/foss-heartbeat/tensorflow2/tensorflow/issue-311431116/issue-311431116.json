{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18249", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18249/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18249/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18249/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/18249", "id": 311431116, "node_id": "MDExOlB1bGxSZXF1ZXN0MTc5NTQyOTc1", "number": 18249, "title": "Allow deletion of multiple checkpoints at once", "user": {"login": "frreiss", "id": 12436991, "node_id": "MDQ6VXNlcjEyNDM2OTkx", "avatar_url": "https://avatars1.githubusercontent.com/u/12436991?v=4", "gravatar_id": "", "url": "https://api.github.com/users/frreiss", "html_url": "https://github.com/frreiss", "followers_url": "https://api.github.com/users/frreiss/followers", "following_url": "https://api.github.com/users/frreiss/following{/other_user}", "gists_url": "https://api.github.com/users/frreiss/gists{/gist_id}", "starred_url": "https://api.github.com/users/frreiss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/frreiss/subscriptions", "organizations_url": "https://api.github.com/users/frreiss/orgs", "repos_url": "https://api.github.com/users/frreiss/repos", "events_url": "https://api.github.com/users/frreiss/events{/privacy}", "received_events_url": "https://api.github.com/users/frreiss/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 390482148, "node_id": "MDU6TGFiZWwzOTA0ODIxNDg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/awaiting%20review", "name": "awaiting review", "color": "fef2c0", "default": false}, {"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "andrewharp", "id": 3376817, "node_id": "MDQ6VXNlcjMzNzY4MTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/3376817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewharp", "html_url": "https://github.com/andrewharp", "followers_url": "https://api.github.com/users/andrewharp/followers", "following_url": "https://api.github.com/users/andrewharp/following{/other_user}", "gists_url": "https://api.github.com/users/andrewharp/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewharp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewharp/subscriptions", "organizations_url": "https://api.github.com/users/andrewharp/orgs", "repos_url": "https://api.github.com/users/andrewharp/repos", "events_url": "https://api.github.com/users/andrewharp/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewharp/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "andrewharp", "id": 3376817, "node_id": "MDQ6VXNlcjMzNzY4MTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/3376817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewharp", "html_url": "https://github.com/andrewharp", "followers_url": "https://api.github.com/users/andrewharp/followers", "following_url": "https://api.github.com/users/andrewharp/following{/other_user}", "gists_url": "https://api.github.com/users/andrewharp/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewharp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewharp/subscriptions", "organizations_url": "https://api.github.com/users/andrewharp/orgs", "repos_url": "https://api.github.com/users/andrewharp/repos", "events_url": "https://api.github.com/users/andrewharp/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewharp/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2018-04-05T00:02:12Z", "updated_at": "2018-10-31T18:02:06Z", "closed_at": "2018-10-31T18:02:06Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/18249", "html_url": "https://github.com/tensorflow/tensorflow/pull/18249", "diff_url": "https://github.com/tensorflow/tensorflow/pull/18249.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/18249.patch"}, "body_html": "<p>The code in <code>saver.py</code> that enforces the <code>max_to_keep</code> parameter (AKA <code>keep_checkpoint_max</code>) is written in such a way that it deletes at most one checkpoint when saving a new checkpoint. If a Saver gets into a state where the number of checkpoints in the checkpoints file is greater than <code>max_to_keep</code>, the Saver will never delete enough checkpoints to bring the number down to <code>max_to_keep</code>.</p>\n<p>I ran into this issue when my VM ran low disk space due to a large number of checkpoints. I killed my running training job, set <code>max_to_keep</code> to a smaller number, and restarted. Nothing happened.</p>\n<p>This PR adjusts the deletion logic so that the Saver will delete multiple checkpoints if necessary to bring the number of checkpoints down to the current value of <code>max_to_keep</code>.</p>", "body_text": "The code in saver.py that enforces the max_to_keep parameter (AKA keep_checkpoint_max) is written in such a way that it deletes at most one checkpoint when saving a new checkpoint. If a Saver gets into a state where the number of checkpoints in the checkpoints file is greater than max_to_keep, the Saver will never delete enough checkpoints to bring the number down to max_to_keep.\nI ran into this issue when my VM ran low disk space due to a large number of checkpoints. I killed my running training job, set max_to_keep to a smaller number, and restarted. Nothing happened.\nThis PR adjusts the deletion logic so that the Saver will delete multiple checkpoints if necessary to bring the number of checkpoints down to the current value of max_to_keep.", "body": "The code in `saver.py` that enforces the `max_to_keep` parameter (AKA `keep_checkpoint_max`) is written in such a way that it deletes at most one checkpoint when saving a new checkpoint. If a Saver gets into a state where the number of checkpoints in the checkpoints file is greater than `max_to_keep`, the Saver will never delete enough checkpoints to bring the number down to `max_to_keep`.\r\n\r\nI ran into this issue when my VM ran low disk space due to a large number of checkpoints. I killed my running training job, set `max_to_keep` to a smaller number, and restarted. Nothing happened.\r\n\r\nThis PR adjusts the deletion logic so that the Saver will delete multiple checkpoints if necessary to bring the number of checkpoints down to the current value of `max_to_keep`."}