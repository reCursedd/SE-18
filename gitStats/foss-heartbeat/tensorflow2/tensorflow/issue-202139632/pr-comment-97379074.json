{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/97379074", "pull_request_review_id": 17986464, "id": 97379074, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDk3Mzc5MDc0", "diff_hunk": "@@ -243,16 +244,44 @@ struct UnsortedSegmentSumFunctor<CPUDevice, T, Index> {\n     }\n   }\n };\n-\n+// UnsortedSegmentMaxFunctor implementation for CPUDevice.\n+template <typename T, typename Index>\n+struct UnsortedSegmentMaxFunctor<CPUDevice, T, Index>\n+    : UnsortedSegmentBaseFunctor<CPUDevice, T, Index> {\n+  void operator()(OpKernelContext* ctx, const CPUDevice& d,\n+                  const Index output_rows, const TensorShape& segment_ids_shape,\n+                  typename TTypes<Index>::ConstFlat segment_ids,\n+                  const Index data_size, const T* data,\n+                  typename TTypes<T, 2>::Tensor output) override {\n+    output.setConstant(std::numeric_limits<T>::min());", "path": "tensorflow/core/kernels/segment_reduction_ops.cc", "position": 32, "original_position": 30, "commit_id": "e03e7ed1ed520f6f70d92614c7f91d7d9bedb761", "original_commit_id": "341e263f30dcb95d4b336c16b3ea8efa7acc9a6d", "user": {"login": "andydavis1", "id": 15696327, "node_id": "MDQ6VXNlcjE1Njk2MzI3", "avatar_url": "https://avatars0.githubusercontent.com/u/15696327?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andydavis1", "html_url": "https://github.com/andydavis1", "followers_url": "https://api.github.com/users/andydavis1/followers", "following_url": "https://api.github.com/users/andydavis1/following{/other_user}", "gists_url": "https://api.github.com/users/andydavis1/gists{/gist_id}", "starred_url": "https://api.github.com/users/andydavis1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andydavis1/subscriptions", "organizations_url": "https://api.github.com/users/andydavis1/orgs", "repos_url": "https://api.github.com/users/andydavis1/repos", "events_url": "https://api.github.com/users/andydavis1/events{/privacy}", "received_events_url": "https://api.github.com/users/andydavis1/received_events", "type": "User", "site_admin": false}, "body": "This doesn't share any code with UnsortedSegmentSumFunctor, yet there is lots of code copied between the two (I think the only differences are the initializer on line 256 and the output update on line 268).\r\n\r\nIs it possible to have the base UnsortedSegmentBaseFunctor contain this shared code, and pass in \"initializer\" and \"reducer\" functors into the base implementation which can be called at these two call sites? ", "created_at": "2017-01-23T18:06:37Z", "updated_at": "2017-02-02T22:06:57Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/6975#discussion_r97379074", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/6975", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/97379074"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/6975#discussion_r97379074"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/6975"}}, "body_html": "<p>This doesn't share any code with UnsortedSegmentSumFunctor, yet there is lots of code copied between the two (I think the only differences are the initializer on line 256 and the output update on line 268).</p>\n<p>Is it possible to have the base UnsortedSegmentBaseFunctor contain this shared code, and pass in \"initializer\" and \"reducer\" functors into the base implementation which can be called at these two call sites?</p>", "body_text": "This doesn't share any code with UnsortedSegmentSumFunctor, yet there is lots of code copied between the two (I think the only differences are the initializer on line 256 and the output update on line 268).\nIs it possible to have the base UnsortedSegmentBaseFunctor contain this shared code, and pass in \"initializer\" and \"reducer\" functors into the base implementation which can be called at these two call sites?"}