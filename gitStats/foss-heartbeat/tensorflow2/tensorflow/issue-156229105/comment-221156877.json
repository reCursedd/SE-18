{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/221156877", "html_url": "https://github.com/tensorflow/tensorflow/issues/2472#issuecomment-221156877", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2472", "id": 221156877, "node_id": "MDEyOklzc3VlQ29tbWVudDIyMTE1Njg3Nw==", "user": {"login": "s0okiym", "id": 6899298, "node_id": "MDQ6VXNlcjY4OTkyOTg=", "avatar_url": "https://avatars0.githubusercontent.com/u/6899298?v=4", "gravatar_id": "", "url": "https://api.github.com/users/s0okiym", "html_url": "https://github.com/s0okiym", "followers_url": "https://api.github.com/users/s0okiym/followers", "following_url": "https://api.github.com/users/s0okiym/following{/other_user}", "gists_url": "https://api.github.com/users/s0okiym/gists{/gist_id}", "starred_url": "https://api.github.com/users/s0okiym/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/s0okiym/subscriptions", "organizations_url": "https://api.github.com/users/s0okiym/orgs", "repos_url": "https://api.github.com/users/s0okiym/repos", "events_url": "https://api.github.com/users/s0okiym/events{/privacy}", "received_events_url": "https://api.github.com/users/s0okiym/received_events", "type": "User", "site_admin": false}, "created_at": "2016-05-24T03:24:27Z", "updated_at": "2016-05-24T03:56:45Z", "author_association": "NONE", "body_html": "<p>I added some print() calls at supervisor.py and session_manager.py in the source code of tensorflow,  then I found the reason why it hangs at prepare_or_wait_for_session():<br></p>\n<p>prepare_or_wait_for_session calls wait_for_session, The wait_for_session function in session_manager.py calls _mode_not_ready() function, and the _mode_not_ready() function returns a Exception, Here it is:<br></p>\n<pre><code>Attempting to use uninitialized value global_step\n     [[Node: global_step/read = Identity[T=DT_FLOAT, _class=[\"loc:@global_step\"], _device=\"/job:ps/replica:0/task:0/cpu:0\"](global_step)]]\n     [[Node: Rank_2_S1 = _HostRecv[client_terminated=false, recv_device=\"/job:worker/replica:0/task:1/gpu:0\", send_device=\"/job:ps/replica:0/task:0/cpu:0\", send_device_incarnation=6943251664905551597, tensor_name=\"edge_12_Rank_2\", tensor_type=DT_INT32, _device=\"/job:worker/replica:0/task:1/gpu:0\"]()]]\n     [[Node: pack_G3 = _Recv[client_terminated=false, recv_device=\"/job:worker/replica:0/task:1/cpu:0\", send_device=\"/job:worker/replica:0/task:1/gpu:0\", send_device_incarnation=-7346167572165274731, tensor_name=\"edge_5_pack\", tensor_type=DT_INT32, _device=\"/job:worker/replica:0/task:1/cpu:0\"]()]]\nCaused by op u'global_step/read', defined at:\n  File \"./distribute_test.py\", line 96, in \n    tf.app.run()\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv))\n  File \"./distribute_test.py\", line 93, in main\n    run_training(server, cluster_spec, num_workers)\n  File \"./distribute_test.py\", line 32, in run_training\n    initializer = tf.constant_initializer(0), trainable = False)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 339, in get_variable\n    collections=collections)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 262, in get_variable\n    collections=collections, caching_device=caching_device)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 158, in get_variable\n    dtype=variable_dtype)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 209, in __init__\n    dtype=dtype)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 318, in _init_from_args\n    self._snapshot = array_ops.identity(self._variable, name=\"read\")\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 609, in identity\n    return _op_def_lib.apply_op(\"Identity\", input=input, name=name)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/op_def_library.py\", line 655, in apply_op\n    op_def=op_def)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2154, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1154, in __init__\n    self._traceback = _extract_stack() </code></pre>\n<p>the source code I run is:  <a href=\"https://github.com/tensorflow/tensorflow/files/271770/mnist_softmax.py.txt\">mnist_softmax.py.txt</a> <br><br>\nIt seems like the ops in non-chief tasks are not initialized as expected!</p>", "body_text": "I added some print() calls at supervisor.py and session_manager.py in the source code of tensorflow,  then I found the reason why it hangs at prepare_or_wait_for_session():\nprepare_or_wait_for_session calls wait_for_session, The wait_for_session function in session_manager.py calls _mode_not_ready() function, and the _mode_not_ready() function returns a Exception, Here it is:\nAttempting to use uninitialized value global_step\n     [[Node: global_step/read = Identity[T=DT_FLOAT, _class=[\"loc:@global_step\"], _device=\"/job:ps/replica:0/task:0/cpu:0\"](global_step)]]\n     [[Node: Rank_2_S1 = _HostRecv[client_terminated=false, recv_device=\"/job:worker/replica:0/task:1/gpu:0\", send_device=\"/job:ps/replica:0/task:0/cpu:0\", send_device_incarnation=6943251664905551597, tensor_name=\"edge_12_Rank_2\", tensor_type=DT_INT32, _device=\"/job:worker/replica:0/task:1/gpu:0\"]()]]\n     [[Node: pack_G3 = _Recv[client_terminated=false, recv_device=\"/job:worker/replica:0/task:1/cpu:0\", send_device=\"/job:worker/replica:0/task:1/gpu:0\", send_device_incarnation=-7346167572165274731, tensor_name=\"edge_5_pack\", tensor_type=DT_INT32, _device=\"/job:worker/replica:0/task:1/cpu:0\"]()]]\nCaused by op u'global_step/read', defined at:\n  File \"./distribute_test.py\", line 96, in \n    tf.app.run()\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv))\n  File \"./distribute_test.py\", line 93, in main\n    run_training(server, cluster_spec, num_workers)\n  File \"./distribute_test.py\", line 32, in run_training\n    initializer = tf.constant_initializer(0), trainable = False)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 339, in get_variable\n    collections=collections)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 262, in get_variable\n    collections=collections, caching_device=caching_device)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 158, in get_variable\n    dtype=variable_dtype)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 209, in __init__\n    dtype=dtype)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 318, in _init_from_args\n    self._snapshot = array_ops.identity(self._variable, name=\"read\")\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 609, in identity\n    return _op_def_lib.apply_op(\"Identity\", input=input, name=name)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/op_def_library.py\", line 655, in apply_op\n    op_def=op_def)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2154, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1154, in __init__\n    self._traceback = _extract_stack() \nthe source code I run is:  mnist_softmax.py.txt \nIt seems like the ops in non-chief tasks are not initialized as expected!", "body": "I added some print() calls at supervisor.py and session_manager.py in the source code of tensorflow,  then I found the reason why it hangs at prepare_or_wait_for_session():<br>\n\nprepare_or_wait_for_session calls wait_for_session, The wait_for_session function in session_manager.py calls _mode_not_ready() function, and the _mode_not_ready() function returns a Exception, Here it is:<br>\n\n<pre><code>Attempting to use uninitialized value global_step\n     [[Node: global_step/read = Identity[T=DT_FLOAT, _class=[\"loc:@global_step\"], _device=\"/job:ps/replica:0/task:0/cpu:0\"](global_step)]]\n     [[Node: Rank_2_S1 = _HostRecv[client_terminated=false, recv_device=\"/job:worker/replica:0/task:1/gpu:0\", send_device=\"/job:ps/replica:0/task:0/cpu:0\", send_device_incarnation=6943251664905551597, tensor_name=\"edge_12_Rank_2\", tensor_type=DT_INT32, _device=\"/job:worker/replica:0/task:1/gpu:0\"]()]]\n     [[Node: pack_G3 = _Recv[client_terminated=false, recv_device=\"/job:worker/replica:0/task:1/cpu:0\", send_device=\"/job:worker/replica:0/task:1/gpu:0\", send_device_incarnation=-7346167572165274731, tensor_name=\"edge_5_pack\", tensor_type=DT_INT32, _device=\"/job:worker/replica:0/task:1/cpu:0\"]()]]\nCaused by op u'global_step/read', defined at:\n  File \"./distribute_test.py\", line 96, in <module>\n    tf.app.run()\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv))\n  File \"./distribute_test.py\", line 93, in main\n    run_training(server, cluster_spec, num_workers)\n  File \"./distribute_test.py\", line 32, in run_training\n    initializer = tf.constant_initializer(0), trainable = False)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 339, in get_variable\n    collections=collections)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 262, in get_variable\n    collections=collections, caching_device=caching_device)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 158, in get_variable\n    dtype=variable_dtype)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 209, in __init__\n    dtype=dtype)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 318, in _init_from_args\n    self._snapshot = array_ops.identity(self._variable, name=\"read\")\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 609, in identity\n    return _op_def_lib.apply_op(\"Identity\", input=input, name=name)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/ops/op_def_library.py\", line 655, in apply_op\n    op_def=op_def)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2154, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/data0/guohongyan/tools/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1154, in __init__\n    self._traceback = _extract_stack() </code></pre>\n\nthe source code I run is:  [mnist_softmax.py.txt](https://github.com/tensorflow/tensorflow/files/271770/mnist_softmax.py.txt) <br>\nIt seems like the ops in non-chief tasks are not initialized as expected!  \n"}