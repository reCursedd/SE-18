{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/79271411", "pull_request_review_id": 444919, "id": 79271411, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDc5MjcxNDEx", "diff_hunk": "@@ -203,6 +203,48 @@ def _BiasAddGrad(op, received_grad):\n   return (received_grad, gen_nn_ops.bias_add_grad(out_backprop=received_grad,\n                                                   data_format=data_format))\n \n+@ops.RegisterGradient(\"BiasAddGrad\")\n+def _BiasAddGradGrad(op, received_grad):\n+  \"\"\"Gradient for the BiasAddGrad op.\n+\n+  Args:\n+    op: BiasAddGrad op for which we are calculating gradients.\n+    received_grad: The gradients passed to the BiasAddGrad op.\n+    \n+  Returns:\n+    A single gradient Tensor for the input to BiasAddGrad (which\n+    is the gradient of the bias term in BiasAdd)\n+  \"\"\"\n+  \n+  try:\n+    data_format = op.get_attr(\"data_format\")\n+  except ValueError:\n+    data_format = None\n+    \n+  #zeros = array_ops.zeros_like(op.inputs[0])\n+  #return gen_nn_ops._bias_add(zeros, received_grad, data_format=data_format)\n+  \n+  shape = array_ops.shape(op.inputs[0])\n+  rank = array_ops.rank(op.inputs[0])\n+  bias_shape = array_ops.shape(received_grad)", "path": "tensorflow/python/ops/nn_grad.py", "position": null, "original_position": 27, "commit_id": "3f7374316e116450ad6c2ba76cb5c55f24c2297f", "original_commit_id": "f73f856b5c09d2706a5e377896afc5165362b2a3", "user": {"login": "zheng-xq", "id": 15736910, "node_id": "MDQ6VXNlcjE1NzM2OTEw", "avatar_url": "https://avatars0.githubusercontent.com/u/15736910?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zheng-xq", "html_url": "https://github.com/zheng-xq", "followers_url": "https://api.github.com/users/zheng-xq/followers", "following_url": "https://api.github.com/users/zheng-xq/following{/other_user}", "gists_url": "https://api.github.com/users/zheng-xq/gists{/gist_id}", "starred_url": "https://api.github.com/users/zheng-xq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zheng-xq/subscriptions", "organizations_url": "https://api.github.com/users/zheng-xq/orgs", "repos_url": "https://api.github.com/users/zheng-xq/repos", "events_url": "https://api.github.com/users/zheng-xq/events{/privacy}", "received_events_url": "https://api.github.com/users/zheng-xq/received_events", "type": "User", "site_admin": false}, "body": "If the shape is not fully defined at this point, this adds an unnecessary dependency at runtime. So it is better to do this when the shape is known, and do your previous bias_add when it is not. For example:\n\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/array_ops.py#L154\n\nIf possible, please also include a benchmark result to show this is not actually slower for non-trivially large shape. tf.tile may have a few performance problems on GPU, and it is on our roadmap for improvement. \n", "created_at": "2016-09-17T00:43:50Z", "updated_at": "2016-09-23T17:41:48Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/4411#discussion_r79271411", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/4411", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/79271411"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/4411#discussion_r79271411"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/4411"}}, "body_html": "<p>If the shape is not fully defined at this point, this adds an unnecessary dependency at runtime. So it is better to do this when the shape is known, and do your previous bias_add when it is not. For example:</p>\n<p><a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/array_ops.py#L154\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/array_ops.py#L154</a></p>\n<p>If possible, please also include a benchmark result to show this is not actually slower for non-trivially large shape. tf.tile may have a few performance problems on GPU, and it is on our roadmap for improvement.</p>", "body_text": "If the shape is not fully defined at this point, this adds an unnecessary dependency at runtime. So it is better to do this when the shape is known, and do your previous bias_add when it is not. For example:\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/array_ops.py#L154\nIf possible, please also include a benchmark result to show this is not actually slower for non-trivially large shape. tf.tile may have a few performance problems on GPU, and it is on our roadmap for improvement."}