{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21642", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21642/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21642/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21642/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/21642", "id": 351029173, "node_id": "MDU6SXNzdWUzNTEwMjkxNzM=", "number": 21642, "title": "MKL Build Failing with new PR Merge", "user": {"login": "sadatnfs", "id": 19790145, "node_id": "MDQ6VXNlcjE5NzkwMTQ1", "avatar_url": "https://avatars2.githubusercontent.com/u/19790145?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sadatnfs", "html_url": "https://github.com/sadatnfs", "followers_url": "https://api.github.com/users/sadatnfs/followers", "following_url": "https://api.github.com/users/sadatnfs/following{/other_user}", "gists_url": "https://api.github.com/users/sadatnfs/gists{/gist_id}", "starred_url": "https://api.github.com/users/sadatnfs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sadatnfs/subscriptions", "organizations_url": "https://api.github.com/users/sadatnfs/orgs", "repos_url": "https://api.github.com/users/sadatnfs/repos", "events_url": "https://api.github.com/users/sadatnfs/events{/privacy}", "received_events_url": "https://api.github.com/users/sadatnfs/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "gunan", "id": 7946809, "node_id": "MDQ6VXNlcjc5NDY4MDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/7946809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gunan", "html_url": "https://github.com/gunan", "followers_url": "https://api.github.com/users/gunan/followers", "following_url": "https://api.github.com/users/gunan/following{/other_user}", "gists_url": "https://api.github.com/users/gunan/gists{/gist_id}", "starred_url": "https://api.github.com/users/gunan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gunan/subscriptions", "organizations_url": "https://api.github.com/users/gunan/orgs", "repos_url": "https://api.github.com/users/gunan/repos", "events_url": "https://api.github.com/users/gunan/events{/privacy}", "received_events_url": "https://api.github.com/users/gunan/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "gunan", "id": 7946809, "node_id": "MDQ6VXNlcjc5NDY4MDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/7946809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gunan", "html_url": "https://github.com/gunan", "followers_url": "https://api.github.com/users/gunan/followers", "following_url": "https://api.github.com/users/gunan/following{/other_user}", "gists_url": "https://api.github.com/users/gunan/gists{/gist_id}", "starred_url": "https://api.github.com/users/gunan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gunan/subscriptions", "organizations_url": "https://api.github.com/users/gunan/orgs", "repos_url": "https://api.github.com/users/gunan/repos", "events_url": "https://api.github.com/users/gunan/events{/privacy}", "received_events_url": "https://api.github.com/users/gunan/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 13, "created_at": "2018-08-16T02:06:41Z", "updated_at": "2018-09-24T04:30:01Z", "closed_at": "2018-09-24T04:30:01Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Hello,</p>\n<p>It looks like with the latest changes to the BUILD file under <code>tools/pip_package</code>, the references to MKL DNN is not being picked up any longer, because there's no <code>intel_mkl_ml</code> folder under <code>third_party</code>. There are <code>mkl</code> and <code>mkl_dnn</code> but not <code>intel_mkl_ml</code> under <code>third_party</code>, and that being said, it looks like PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"120382622\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/408\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/408/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/408\">#408</a> which has this MKL \"fix\" actually passed all the build tests (red X next to the commit)...</p>\n<p>For what it's worth, I have both MKL and MKL-DNN built in my environment with the correct paths set, but TF always seems to want to build the MKL-DNN libraries themselves, so if I could even explicitly point to my environment's MKL library files, then that'd also work.</p>\n<h2>Build command:</h2>\n<pre><code>echo \"startup --batch\" &gt;&gt;/etc/bazel.bazelrc &amp;&amp; \\\n    echo \"build --spawn_strategy=standalone --genrule_strategy=standalone\" &gt;&gt;/etc/bazel.bazelrc &amp;&amp; \\\n    echo \"deb [arch=amd64] http://storage.googleapis.com/bazel-apt stable jdk1.8\" | tee /etc/apt/sources.list.d/bazel.list &amp;&amp; \\\n    curl https://bazel.build/bazel-release.pub.gpg | apt-key add - &amp;&amp; \\\n    apt-get update &amp;&amp; apt-get install -y bazel  &amp;&amp; rm -rf /var/lib/apt/lists/* &amp;&amp; \\\n    ldconfig &amp;&amp; \\\n    pip uninstall -y tensorflow-tensorboard tb-nightly tf-nightly tensorflow &amp;&amp; \\\n    cd /opt &amp;&amp; \\\n    git clone https://github.com/tensorflow/tensorflow.git &amp;&amp; \\\n    cd /opt/tensorflow &amp;&amp; \\\n    # cp /opt/tensorflow/third_party/mkl/LICENSE /opt/tensorflow/third_party/mkl_dnn/LICENSE &amp;&amp; \\\n    /bin/bash ./configure \\\n    &amp;&amp; \\\n    bazel build \\\n    --config=mkl --config=opt  \\\n    --cxxopt=\"-D_GLIBCXX_USE_CXX11_ABI=0\" \\\n    --copt=-msse4.2 --copt=-msse4.1 --copt=-mavx --copt=-msse2 --copt=-msse3  \\\n    --copt=-O3 --copt=-mfpmath=both \\\n    --copt=\"-DMKL_LP64\" \\\n    --copt=\"-fPIC\" \\\n    --linkopt=\"-lmkl_gf_lp64\" \\\n    --linkopt=\"-lmkl_gnu_thread\" \\\n    --linkopt=\"-dl\" \\\n    --linkopt=\"-lpthread\" \\\n    --linkopt=\"-lmkl_core\" \\\n    --linkopt=\"-lm\" \\\n    --linkopt=\"-lmkl_rt\" \\\n    --linkopt=\"-lmkldnn\" \\\n    tensorflow/tools/pip_package:build_pip_package &amp;&amp; \\\n    bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/pip &amp;&amp; \\\n    pip install --no-deps /tmp/pip/tensorflow-*.whl \n</code></pre>\n<h2>Error:</h2>\n<pre><code>/opt/tensorflow/tensorflow/tools/pip_package/BUILD:206:1: no such package 'third_party/intel_mkl_ml': BUILD file not found on package path and referenced by '//tensorflow/tools/pip_package:build_pip_package'```\n</code></pre>", "body_text": "Hello,\nIt looks like with the latest changes to the BUILD file under tools/pip_package, the references to MKL DNN is not being picked up any longer, because there's no intel_mkl_ml folder under third_party. There are mkl and mkl_dnn but not intel_mkl_ml under third_party, and that being said, it looks like PR #408 which has this MKL \"fix\" actually passed all the build tests (red X next to the commit)...\nFor what it's worth, I have both MKL and MKL-DNN built in my environment with the correct paths set, but TF always seems to want to build the MKL-DNN libraries themselves, so if I could even explicitly point to my environment's MKL library files, then that'd also work.\nBuild command:\necho \"startup --batch\" >>/etc/bazel.bazelrc && \\\n    echo \"build --spawn_strategy=standalone --genrule_strategy=standalone\" >>/etc/bazel.bazelrc && \\\n    echo \"deb [arch=amd64] http://storage.googleapis.com/bazel-apt stable jdk1.8\" | tee /etc/apt/sources.list.d/bazel.list && \\\n    curl https://bazel.build/bazel-release.pub.gpg | apt-key add - && \\\n    apt-get update && apt-get install -y bazel  && rm -rf /var/lib/apt/lists/* && \\\n    ldconfig && \\\n    pip uninstall -y tensorflow-tensorboard tb-nightly tf-nightly tensorflow && \\\n    cd /opt && \\\n    git clone https://github.com/tensorflow/tensorflow.git && \\\n    cd /opt/tensorflow && \\\n    # cp /opt/tensorflow/third_party/mkl/LICENSE /opt/tensorflow/third_party/mkl_dnn/LICENSE && \\\n    /bin/bash ./configure \\\n    && \\\n    bazel build \\\n    --config=mkl --config=opt  \\\n    --cxxopt=\"-D_GLIBCXX_USE_CXX11_ABI=0\" \\\n    --copt=-msse4.2 --copt=-msse4.1 --copt=-mavx --copt=-msse2 --copt=-msse3  \\\n    --copt=-O3 --copt=-mfpmath=both \\\n    --copt=\"-DMKL_LP64\" \\\n    --copt=\"-fPIC\" \\\n    --linkopt=\"-lmkl_gf_lp64\" \\\n    --linkopt=\"-lmkl_gnu_thread\" \\\n    --linkopt=\"-dl\" \\\n    --linkopt=\"-lpthread\" \\\n    --linkopt=\"-lmkl_core\" \\\n    --linkopt=\"-lm\" \\\n    --linkopt=\"-lmkl_rt\" \\\n    --linkopt=\"-lmkldnn\" \\\n    tensorflow/tools/pip_package:build_pip_package && \\\n    bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/pip && \\\n    pip install --no-deps /tmp/pip/tensorflow-*.whl \n\nError:\n/opt/tensorflow/tensorflow/tools/pip_package/BUILD:206:1: no such package 'third_party/intel_mkl_ml': BUILD file not found on package path and referenced by '//tensorflow/tools/pip_package:build_pip_package'```", "body": "Hello,\r\n\r\nIt looks like with the latest changes to the BUILD file under `tools/pip_package`, the references to MKL DNN is not being picked up any longer, because there's no `intel_mkl_ml` folder under `third_party`. There are `mkl` and `mkl_dnn` but not `intel_mkl_ml` under `third_party`, and that being said, it looks like PR #408 which has this MKL \"fix\" actually passed all the build tests (red X next to the commit)...\r\n\r\nFor what it's worth, I have both MKL and MKL-DNN built in my environment with the correct paths set, but TF always seems to want to build the MKL-DNN libraries themselves, so if I could even explicitly point to my environment's MKL library files, then that'd also work.\r\n\r\n## Build command:\r\n```\r\necho \"startup --batch\" >>/etc/bazel.bazelrc && \\\r\n    echo \"build --spawn_strategy=standalone --genrule_strategy=standalone\" >>/etc/bazel.bazelrc && \\\r\n    echo \"deb [arch=amd64] http://storage.googleapis.com/bazel-apt stable jdk1.8\" | tee /etc/apt/sources.list.d/bazel.list && \\\r\n    curl https://bazel.build/bazel-release.pub.gpg | apt-key add - && \\\r\n    apt-get update && apt-get install -y bazel  && rm -rf /var/lib/apt/lists/* && \\\r\n    ldconfig && \\\r\n    pip uninstall -y tensorflow-tensorboard tb-nightly tf-nightly tensorflow && \\\r\n    cd /opt && \\\r\n    git clone https://github.com/tensorflow/tensorflow.git && \\\r\n    cd /opt/tensorflow && \\\r\n    # cp /opt/tensorflow/third_party/mkl/LICENSE /opt/tensorflow/third_party/mkl_dnn/LICENSE && \\\r\n    /bin/bash ./configure \\\r\n    && \\\r\n    bazel build \\\r\n    --config=mkl --config=opt  \\\r\n    --cxxopt=\"-D_GLIBCXX_USE_CXX11_ABI=0\" \\\r\n    --copt=-msse4.2 --copt=-msse4.1 --copt=-mavx --copt=-msse2 --copt=-msse3  \\\r\n    --copt=-O3 --copt=-mfpmath=both \\\r\n    --copt=\"-DMKL_LP64\" \\\r\n    --copt=\"-fPIC\" \\\r\n    --linkopt=\"-lmkl_gf_lp64\" \\\r\n    --linkopt=\"-lmkl_gnu_thread\" \\\r\n    --linkopt=\"-dl\" \\\r\n    --linkopt=\"-lpthread\" \\\r\n    --linkopt=\"-lmkl_core\" \\\r\n    --linkopt=\"-lm\" \\\r\n    --linkopt=\"-lmkl_rt\" \\\r\n    --linkopt=\"-lmkldnn\" \\\r\n    tensorflow/tools/pip_package:build_pip_package && \\\r\n    bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/pip && \\\r\n    pip install --no-deps /tmp/pip/tensorflow-*.whl \r\n```\r\n\r\n## Error:\r\n```\r\n/opt/tensorflow/tensorflow/tools/pip_package/BUILD:206:1: no such package 'third_party/intel_mkl_ml': BUILD file not found on package path and referenced by '//tensorflow/tools/pip_package:build_pip_package'```"}