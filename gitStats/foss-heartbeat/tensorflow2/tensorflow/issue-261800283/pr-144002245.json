{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13394", "id": 144002245, "node_id": "MDExOlB1bGxSZXF1ZXN0MTQ0MDAyMjQ1", "html_url": "https://github.com/tensorflow/tensorflow/pull/13394", "diff_url": "https://github.com/tensorflow/tensorflow/pull/13394.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/13394.patch", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13394", "number": 13394, "state": "closed", "locked": false, "title": "Change tmp filename behavior in contrib.ffmpeg to support simultaneous decodes", "user": {"login": "chrisdonahue", "id": 748399, "node_id": "MDQ6VXNlcjc0ODM5OQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/748399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chrisdonahue", "html_url": "https://github.com/chrisdonahue", "followers_url": "https://api.github.com/users/chrisdonahue/followers", "following_url": "https://api.github.com/users/chrisdonahue/following{/other_user}", "gists_url": "https://api.github.com/users/chrisdonahue/gists{/gist_id}", "starred_url": "https://api.github.com/users/chrisdonahue/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chrisdonahue/subscriptions", "organizations_url": "https://api.github.com/users/chrisdonahue/orgs", "repos_url": "https://api.github.com/users/chrisdonahue/repos", "events_url": "https://api.github.com/users/chrisdonahue/events{/privacy}", "received_events_url": "https://api.github.com/users/chrisdonahue/received_events", "type": "User", "site_admin": false}, "body": "Encountered ill-defined behavior when trying to decode two audio files in a single call to `sess.run`. Changed `GetTempFilename` to use `mkstemps` instead of `getpid`. Old behavior demonstrated below:\r\n\r\n### Source code\r\n```python\r\nimport tensorflow as tf\r\n\r\ndef load_audio(wav_fp):\r\n  wav_bin = tf.read_file(wav_fp)\r\n  wav = tf.contrib.ffmpeg.decode_audio(\r\n      wav_bin,\r\n      file_format='wav',\r\n      samples_per_second=16000,\r\n      channel_count=1)\r\n  return wav\r\n\r\nwav_fp0 = tf.placeholder(tf.string, [])\r\nwav_fp1 = tf.placeholder(tf.string, [])\r\n\r\nwav0 = load_audio(wav_fp0)\r\nwav1 = load_audio(wav_fp1)\r\n\r\nwith tf.Session() as sess:\r\n  _wav_fp0 = 'test0.wav'\r\n  _wav_fp1 = 'test1.wav'\r\n\r\n  _wav0, _wav1 = sess.run(\r\n      [wav0, wav1],\r\n      feed_dict={\r\n        wav_fp0: _wav_fp0,\r\n        wav_fp1: _wav_fp1})\r\n\r\n  print _wav0.shape\r\n  print _wav1.shape\r\n```\r\n\r\n### Race condition outcome 1 (second file write completes before either decode)\r\n```sh\r\n2017-09-29 16:02:23.435427: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.\r\n2017-09-29 16:02:23.435459: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\r\nffmpeg version 2.8.11-0ubuntu0.16.04.1 Copyright (c) 2000-2017 the FFmpeg developers\r\n  built with gcc 5.4.0 (Ubuntu 5.4.0-6ubuntu1~16.04.4) 20160609\r\n  configuration: --prefix=/usr --extra-version=0ubuntu0.16.04.1 --build-suffix=-ffmpeg --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --cc=cc --cxx=g++ --enable-gpl --enable-shared --disable-stripping --disable-decoder=libopenjpeg --disable-decoder=libschroedinger --enable-avresample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libmodplug --enable-libmp3lame --enable-libopenjpeg --enable-libopus --enable-libpulse --enable-librtmp --enable-libschroedinger --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxvid --enable-libzvbi --enable-openal --enable-opengl --enable-x11grab --enable-libdc1394 --enable-libiec61883 --enable-libzmq --enable-frei0r --enable-libx264 --enable-libopencv\r\n  libavutil      54. 31.100 / 54. 31.100\r\n  libavcodec     56. 60.100 / 56. 60.100\r\n  libavformat    56. 40.101 / 56. 40.101\r\n  libavdevice    56.  4.100 / 56.  4.100\r\n  libavfilter     5. 40.101 /  5. 40.101\r\n  libavresample   2.  1.  0 /  2.  1.  0\r\n  libswscale      3.  1.101 /  3.  1.101\r\n  libswresample   1.  2.101 /  1.  2.101\r\n  libpostproc    53.  3.100 / 53.  3.100\r\nffmpeg version 2.8.11-0ubuntu0.16.04.1 Copyright (c) 2000-2017 the FFmpeg developers\r\n  built with gcc 5.4.0 (Ubuntu 5.4.0-6ubuntu1~16.04.4) 20160609\r\n  configuration: --prefix=/usr --extra-version=0ubuntu0.16.04.1 --build-suffix=-ffmpeg --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --cc=cc --cxx=g++ --enable-gpl --enable-shared --disable-stripping --disable-decoder=libopenjpeg --disable-decoder=libschroedinger --enable-avresample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libmodplug --enable-libmp3lame --enable-libopenjpeg --enable-libopus --enable-libpulse --enable-librtmp --enable-libschroedinger --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxvid --enable-libzvbi --enable-openal --enable-opengl --enable-x11grab --enable-libdc1394 --enable-libiec61883 --enable-libzmq --enable-frei0r --enable-libx264 --enable-libopencv\r\n  libavutil      54. 31.100 / 54. 31.100\r\n  libavcodec     56. 60.100 / 56. 60.100\r\n  libavformat    56. 40.101 / 56. 40.101\r\n  libavdevice    56.  4.100 / 56.  4.100\r\n  libavfilter     5. 40.101 /  5. 40.101\r\n  libavresample   2.  1.  0 /  2.  1.  0\r\n  libswscale      3.  1.101 /  3.  1.101\r\n  libswresample   1.  2.101 /  1.  2.101\r\n  libpostproc    53.  3.100 / 53.  3.100\r\nGuessed Channel Layout for  Input Stream #0.0 : mono\r\nInput #0, wav, from '/tmp/tmp_file_23229.wav':\r\n  Duration: 00:00:02.23, bitrate: 265 kb/s\r\n    Stream #0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 16000 Hz, 1 channels, s16, 256 kb/s\r\nOutput #0, s16le, to '/tmp/tmp_file_23229.raw':\r\n  Metadata:\r\n    encoder         : Lavf56.40.101\r\n    Stream #0:0: Audio: pcm_s16le, 16000 Hz, mono, s16, 256 kb/s\r\n    Metadata:\r\n      encoder         : Lavc56.60.100 pcm_s16le\r\nStream mapping:\r\n  Stream #0:0 -> #0:0 (pcm_s16le (native) -> pcm_s16le (native))\r\nsize=      70kB time=00:00:02.22 bitrate= 256.0kbits/s    \r\nvideo:0kB audio:70kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.000000%\r\nGuessed Channel Layout for  Input Stream #0.0 : mono\r\nInput #0, wav, from '/tmp/tmp_file_23229.wav':\r\n  Duration: 00:00:02.23, bitrate: 265 kb/s\r\n    Stream #0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 16000 Hz, 1 channels, s16, 256 kb/s\r\nOutput #0, s16le, to '/tmp/tmp_file_23229.raw':\r\n  Metadata:\r\n    encoder         : Lavf56.40.101\r\n    Stream #0:0: Audio: pcm_s16le, 16000 Hz, mono, s16, 256 kb/s\r\n    Metadata:\r\n      encoder         : Lavc56.60.100 pcm_s16le\r\nStream mapping:\r\n  Stream #0:0 -> #0:0 (pcm_s16le (native) -> pcm_s16le (native))\r\nsize=      70kB time=00:00:02.22 bitrate= 256.0kbits/s    \r\nvideo:0kB audio:70kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.000000%\r\n(35636, 1)\r\n(35636, 1)\r\n```\r\n\r\n### Race condition outcome 2 (file overwritten during decoding)\r\n```sh\r\n2017-09-29 16:02:18.596598: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.\r\n2017-09-29 16:02:18.596631: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\r\nffmpeg version 2.8.11-0ubuntu0.16.04.1 Copyright (c) 2000-2017 the FFmpeg developers\r\n  built with gcc 5.4.0 (Ubuntu 5.4.0-6ubuntu1~16.04.4) 20160609\r\n  configuration: --prefix=/usr --extra-version=0ubuntu0.16.04.1 --build-suffix=-ffmpeg --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --cc=cc --cxx=g++ --enable-gpl --enable-shared --disable-stripping --disable-decoder=libopenjpeg --disable-decoder=libschroedinger --enable-avresample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libmodplug --enable-libmp3lame --enable-libopenjpeg --enable-libopus --enable-libpulse --enable-librtmp --enable-libschroedinger --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxvid --enable-libzvbi --enable-openal --enable-opengl --enable-x11grab --enable-libdc1394 --enable-libiec61883 --enable-libzmq --enable-frei0r --enable-libx264 --enable-libopencv\r\n  libavutil      54. 31.100 / 54. 31.100\r\n  libavcodec     56. 60.100 / 56. 60.100\r\n  libavformat    56. 40.101 / 56. 40.101\r\n  libavdevice    56.  4.100 / 56.  4.100\r\n  libavfilter     5. 40.101 /  5. 40.101\r\n  libavresample   2.  1.  0 /  2.  1.  0\r\n  libswscale      3.  1.101 /  3.  1.101\r\n  libswresample   1.  2.101 /  1.  2.101\r\n  libpostproc    53.  3.100 / 53.  3.100\r\nffmpeg version 2.8.11-0ubuntu0.16.04.1 Copyright (c) 2000-2017 the FFmpeg developers\r\n  built with gcc 5.4.0 (Ubuntu 5.4.0-6ubuntu1~16.04.4) 20160609\r\n  configuration: --prefix=/usr --extra-version=0ubuntu0.16.04.1 --build-suffix=-ffmpeg --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --cc=cc --cxx=g++ --enable-gpl --enable-shared --disable-stripping --disable-decoder=libopenjpeg --disable-decoder=libschroedinger --enable-avresample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libmodplug --enable-libmp3lame --enable-libopenjpeg --enable-libopus --enable-libpulse --enable-librtmp --enable-libschroedinger --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxvid --enable-libzvbi --enable-openal --enable-opengl --enable-x11grab --enable-libdc1394 --enable-libiec61883 --enable-libzmq --enable-frei0r --enable-libx264 --enable-libopencv\r\n  libavutil      54. 31.100 / 54. 31.100\r\n  libavcodec     56. 60.100 / 56. 60.100\r\n  libavformat    56. 40.101 / 56. 40.101\r\n  libavdevice    56.  4.100 / 56.  4.100\r\n  libavfilter     5. 40.101 /  5. 40.101\r\n  libavresample   2.  1.  0 /  2.  1.  0\r\n  libswscale      3.  1.101 /  3.  1.101\r\n  libswresample   1.  2.101 /  1.  2.101\r\n  libpostproc    53.  3.100 / 53.  3.100\r\nGuessed Channel Layout for  Input Stream #0.0 : mono\r\nInput #0, wav, from '/tmp/tmp_file_23205.wav':\r\n  Duration: 00:00:02.31, bitrate: 256 kb/s\r\n    Stream #0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 16000 Hz, 1 channels, s16, 256 kb/s\r\nOutput #0, s16le, to '/tmp/tmp_file_23205.raw':\r\n  Metadata:\r\n    encoder         : Lavf56.40.101\r\n    Stream #0:0: Audio: pcm_s16le, 16000 Hz, mono, s16, 256 kb/s\r\n    Metadata:\r\n      encoder         : Lavc56.60.100 pcm_s16le\r\nStream mapping:\r\n  Stream #0:0 -> #0:0 (pcm_s16le (native) -> pcm_s16le (native))\r\nsize=      72kB time=00:00:02.31 bitrate= 256.0kbits/s    \r\nvideo:0kB audio:72kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.000000%\r\nGuessed Channel Layout for  Input Stream #0.0 : mono\r\nInput #0, wav, from '/tmp/tmp_file_23205.wav':\r\n  Duration: 00:00:02.31, bitrate: 256 kb/s\r\n    Stream #0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 16000 Hz, 1 channels, s16, 256 kb/s\r\nOutput #0, s16le, to '/tmp/tmp_file_23205.raw':\r\n  Metadata:\r\n    encoder         : Lavf56.40.101\r\n    Stream #0:0: Audio: pcm_s16le, 16000 Hz, mono, s16, 256 kb/s\r\n    Metadata:\r\n      encoder         : Lavc56.60.100 pcm_s16le\r\nStream mapping:\r\n  Stream #0:0 -> #0:0 (pcm_s16le (native) -> pcm_s16le (native))\r\nsize=      72kB time=00:00:02.31 bitrate= 256.0kbits/s    \r\nvideo:0kB audio:72kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.000000%\r\n2017-09-29 16:02:18.637254: F tensorflow/contrib/ffmpeg/default/ffmpeg_lib.cc:116] Non-OK-status: ReadFileToString(Env::Default(), filename, &raw_data) status: Not found: /tmp/tmp_file_23205.rawCould not read FFmpeg output file: /tmp/tmp_file_23205.raw\r\nAborted (core dumped)\r\n```", "created_at": "2017-09-30T00:02:30Z", "updated_at": "2017-09-30T03:07:38Z", "closed_at": "2017-09-30T03:07:38Z", "merged_at": "2017-09-30T03:07:38Z", "merge_commit_sha": "cff829fb16e8824719559f4f7237af546307d7fd", "assignee": {"login": "drpngx", "id": 20959853, "node_id": "MDQ6VXNlcjIwOTU5ODUz", "avatar_url": "https://avatars1.githubusercontent.com/u/20959853?v=4", "gravatar_id": "", "url": "https://api.github.com/users/drpngx", "html_url": "https://github.com/drpngx", "followers_url": "https://api.github.com/users/drpngx/followers", "following_url": "https://api.github.com/users/drpngx/following{/other_user}", "gists_url": "https://api.github.com/users/drpngx/gists{/gist_id}", "starred_url": "https://api.github.com/users/drpngx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/drpngx/subscriptions", "organizations_url": "https://api.github.com/users/drpngx/orgs", "repos_url": "https://api.github.com/users/drpngx/repos", "events_url": "https://api.github.com/users/drpngx/events{/privacy}", "received_events_url": "https://api.github.com/users/drpngx/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "drpngx", "id": 20959853, "node_id": "MDQ6VXNlcjIwOTU5ODUz", "avatar_url": "https://avatars1.githubusercontent.com/u/20959853?v=4", "gravatar_id": "", "url": "https://api.github.com/users/drpngx", "html_url": "https://github.com/drpngx", "followers_url": "https://api.github.com/users/drpngx/followers", "following_url": "https://api.github.com/users/drpngx/following{/other_user}", "gists_url": "https://api.github.com/users/drpngx/gists{/gist_id}", "starred_url": "https://api.github.com/users/drpngx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/drpngx/subscriptions", "organizations_url": "https://api.github.com/users/drpngx/orgs", "repos_url": "https://api.github.com/users/drpngx/repos", "events_url": "https://api.github.com/users/drpngx/events{/privacy}", "received_events_url": "https://api.github.com/users/drpngx/received_events", "type": "User", "site_admin": false}], "requested_reviewers": [], "requested_teams": [], "labels": [{"id": 419840263, "node_id": "MDU6TGFiZWw0MTk4NDAyNjM=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/awaiting%20testing%20(then%20merge)", "name": "awaiting testing (then merge)", "color": "c2e0c6", "default": false}, {"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}], "milestone": null, "commits_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13394/commits", "review_comments_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13394/comments", "review_comment_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments{/number}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13394/comments", "statuses_url": "https://api.github.com/repos/tensorflow/tensorflow/statuses/cdd35a75ea5a014086ef503726aef3da8c1eafec", "head": {"label": "chrisdonahue:ffmpeg", "ref": "ffmpeg", "sha": "cdd35a75ea5a014086ef503726aef3da8c1eafec", "user": {"login": "chrisdonahue", "id": 748399, "node_id": "MDQ6VXNlcjc0ODM5OQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/748399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chrisdonahue", "html_url": "https://github.com/chrisdonahue", "followers_url": "https://api.github.com/users/chrisdonahue/followers", "following_url": "https://api.github.com/users/chrisdonahue/following{/other_user}", "gists_url": "https://api.github.com/users/chrisdonahue/gists{/gist_id}", "starred_url": "https://api.github.com/users/chrisdonahue/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chrisdonahue/subscriptions", "organizations_url": "https://api.github.com/users/chrisdonahue/orgs", "repos_url": "https://api.github.com/users/chrisdonahue/repos", "events_url": "https://api.github.com/users/chrisdonahue/events{/privacy}", "received_events_url": "https://api.github.com/users/chrisdonahue/received_events", "type": "User", "site_admin": false}, "repo": {"id": 105325145, "node_id": "MDEwOlJlcG9zaXRvcnkxMDUzMjUxNDU=", "name": "tensorflow", "full_name": "chrisdonahue/tensorflow", "private": false, "owner": {"login": "chrisdonahue", "id": 748399, "node_id": "MDQ6VXNlcjc0ODM5OQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/748399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chrisdonahue", "html_url": "https://github.com/chrisdonahue", "followers_url": "https://api.github.com/users/chrisdonahue/followers", "following_url": "https://api.github.com/users/chrisdonahue/following{/other_user}", "gists_url": "https://api.github.com/users/chrisdonahue/gists{/gist_id}", "starred_url": "https://api.github.com/users/chrisdonahue/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chrisdonahue/subscriptions", "organizations_url": "https://api.github.com/users/chrisdonahue/orgs", "repos_url": "https://api.github.com/users/chrisdonahue/repos", "events_url": "https://api.github.com/users/chrisdonahue/events{/privacy}", "received_events_url": "https://api.github.com/users/chrisdonahue/received_events", "type": "User", "site_admin": false}, "html_url": "https://github.com/chrisdonahue/tensorflow", "description": "Computation using data flow graphs for scalable machine learning", "fork": true, "url": "https://api.github.com/repos/chrisdonahue/tensorflow", "forks_url": "https://api.github.com/repos/chrisdonahue/tensorflow/forks", "keys_url": "https://api.github.com/repos/chrisdonahue/tensorflow/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/chrisdonahue/tensorflow/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/chrisdonahue/tensorflow/teams", "hooks_url": "https://api.github.com/repos/chrisdonahue/tensorflow/hooks", "issue_events_url": "https://api.github.com/repos/chrisdonahue/tensorflow/issues/events{/number}", "events_url": "https://api.github.com/repos/chrisdonahue/tensorflow/events", "assignees_url": "https://api.github.com/repos/chrisdonahue/tensorflow/assignees{/user}", "branches_url": "https://api.github.com/repos/chrisdonahue/tensorflow/branches{/branch}", "tags_url": "https://api.github.com/repos/chrisdonahue/tensorflow/tags", "blobs_url": "https://api.github.com/repos/chrisdonahue/tensorflow/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/chrisdonahue/tensorflow/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/chrisdonahue/tensorflow/git/refs{/sha}", "trees_url": "https://api.github.com/repos/chrisdonahue/tensorflow/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/chrisdonahue/tensorflow/statuses/{sha}", "languages_url": "https://api.github.com/repos/chrisdonahue/tensorflow/languages", "stargazers_url": "https://api.github.com/repos/chrisdonahue/tensorflow/stargazers", "contributors_url": "https://api.github.com/repos/chrisdonahue/tensorflow/contributors", "subscribers_url": "https://api.github.com/repos/chrisdonahue/tensorflow/subscribers", "subscription_url": "https://api.github.com/repos/chrisdonahue/tensorflow/subscription", "commits_url": "https://api.github.com/repos/chrisdonahue/tensorflow/commits{/sha}", "git_commits_url": "https://api.github.com/repos/chrisdonahue/tensorflow/git/commits{/sha}", "comments_url": "https://api.github.com/repos/chrisdonahue/tensorflow/comments{/number}", "issue_comment_url": "https://api.github.com/repos/chrisdonahue/tensorflow/issues/comments{/number}", "contents_url": "https://api.github.com/repos/chrisdonahue/tensorflow/contents/{+path}", "compare_url": "https://api.github.com/repos/chrisdonahue/tensorflow/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/chrisdonahue/tensorflow/merges", "archive_url": "https://api.github.com/repos/chrisdonahue/tensorflow/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/chrisdonahue/tensorflow/downloads", "issues_url": "https://api.github.com/repos/chrisdonahue/tensorflow/issues{/number}", "pulls_url": "https://api.github.com/repos/chrisdonahue/tensorflow/pulls{/number}", "milestones_url": "https://api.github.com/repos/chrisdonahue/tensorflow/milestones{/number}", "notifications_url": "https://api.github.com/repos/chrisdonahue/tensorflow/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/chrisdonahue/tensorflow/labels{/name}", "releases_url": "https://api.github.com/repos/chrisdonahue/tensorflow/releases{/id}", "deployments_url": "https://api.github.com/repos/chrisdonahue/tensorflow/deployments", "created_at": "2017-09-29T23:26:41Z", "updated_at": "2017-09-29T23:27:13Z", "pushed_at": "2017-11-15T22:49:58Z", "git_url": "git://github.com/chrisdonahue/tensorflow.git", "ssh_url": "git@github.com:chrisdonahue/tensorflow.git", "clone_url": "https://github.com/chrisdonahue/tensorflow.git", "svn_url": "https://github.com/chrisdonahue/tensorflow", "homepage": "http://tensorflow.org", "size": 135545, "stargazers_count": 0, "watchers_count": 0, "language": "C++", "has_issues": false, "has_projects": true, "has_downloads": true, "has_wiki": false, "has_pages": false, "forks_count": 0, "mirror_url": null, "archived": false, "open_issues_count": 0, "license": {"key": "apache-2.0", "name": "Apache License 2.0", "spdx_id": "Apache-2.0", "url": "https://api.github.com/licenses/apache-2.0", "node_id": "MDc6TGljZW5zZTI="}, "forks": 0, "open_issues": 0, "watchers": 0, "default_branch": "master"}}, "base": {"label": "tensorflow:master", "ref": "master", "sha": "f807b39667e84a28e83105fd29533262c257a53e", "user": {"login": "tensorflow", "id": 15658638, "node_id": "MDEyOk9yZ2FuaXphdGlvbjE1NjU4NjM4", "avatar_url": "https://avatars1.githubusercontent.com/u/15658638?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tensorflow", "html_url": "https://github.com/tensorflow", "followers_url": "https://api.github.com/users/tensorflow/followers", "following_url": "https://api.github.com/users/tensorflow/following{/other_user}", "gists_url": "https://api.github.com/users/tensorflow/gists{/gist_id}", "starred_url": "https://api.github.com/users/tensorflow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tensorflow/subscriptions", "organizations_url": "https://api.github.com/users/tensorflow/orgs", "repos_url": "https://api.github.com/users/tensorflow/repos", "events_url": "https://api.github.com/users/tensorflow/events{/privacy}", "received_events_url": "https://api.github.com/users/tensorflow/received_events", "type": "Organization", "site_admin": false}, "repo": {"id": 45717250, "node_id": "MDEwOlJlcG9zaXRvcnk0NTcxNzI1MA==", "name": "tensorflow", "full_name": "tensorflow/tensorflow", "private": false, "owner": {"login": "tensorflow", "id": 15658638, "node_id": "MDEyOk9yZ2FuaXphdGlvbjE1NjU4NjM4", "avatar_url": "https://avatars1.githubusercontent.com/u/15658638?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tensorflow", "html_url": "https://github.com/tensorflow", "followers_url": "https://api.github.com/users/tensorflow/followers", "following_url": "https://api.github.com/users/tensorflow/following{/other_user}", "gists_url": "https://api.github.com/users/tensorflow/gists{/gist_id}", "starred_url": "https://api.github.com/users/tensorflow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tensorflow/subscriptions", "organizations_url": "https://api.github.com/users/tensorflow/orgs", "repos_url": "https://api.github.com/users/tensorflow/repos", "events_url": "https://api.github.com/users/tensorflow/events{/privacy}", "received_events_url": "https://api.github.com/users/tensorflow/received_events", "type": "Organization", "site_admin": false}, "html_url": "https://github.com/tensorflow/tensorflow", "description": "An Open Source Machine Learning Framework for Everyone", "fork": false, "url": "https://api.github.com/repos/tensorflow/tensorflow", "forks_url": "https://api.github.com/repos/tensorflow/tensorflow/forks", "keys_url": "https://api.github.com/repos/tensorflow/tensorflow/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/tensorflow/tensorflow/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/tensorflow/tensorflow/teams", "hooks_url": "https://api.github.com/repos/tensorflow/tensorflow/hooks", "issue_events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/events{/number}", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/events", "assignees_url": "https://api.github.com/repos/tensorflow/tensorflow/assignees{/user}", "branches_url": "https://api.github.com/repos/tensorflow/tensorflow/branches{/branch}", "tags_url": "https://api.github.com/repos/tensorflow/tensorflow/tags", "blobs_url": "https://api.github.com/repos/tensorflow/tensorflow/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/tensorflow/tensorflow/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/tensorflow/tensorflow/git/refs{/sha}", "trees_url": "https://api.github.com/repos/tensorflow/tensorflow/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/tensorflow/tensorflow/statuses/{sha}", "languages_url": "https://api.github.com/repos/tensorflow/tensorflow/languages", "stargazers_url": "https://api.github.com/repos/tensorflow/tensorflow/stargazers", "contributors_url": "https://api.github.com/repos/tensorflow/tensorflow/contributors", "subscribers_url": "https://api.github.com/repos/tensorflow/tensorflow/subscribers", "subscription_url": "https://api.github.com/repos/tensorflow/tensorflow/subscription", "commits_url": "https://api.github.com/repos/tensorflow/tensorflow/commits{/sha}", "git_commits_url": "https://api.github.com/repos/tensorflow/tensorflow/git/commits{/sha}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/comments{/number}", "issue_comment_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments{/number}", "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/{+path}", "compare_url": "https://api.github.com/repos/tensorflow/tensorflow/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/tensorflow/tensorflow/merges", "archive_url": "https://api.github.com/repos/tensorflow/tensorflow/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/tensorflow/tensorflow/downloads", "issues_url": "https://api.github.com/repos/tensorflow/tensorflow/issues{/number}", "pulls_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls{/number}", "milestones_url": "https://api.github.com/repos/tensorflow/tensorflow/milestones{/number}", "notifications_url": "https://api.github.com/repos/tensorflow/tensorflow/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/labels{/name}", "releases_url": "https://api.github.com/repos/tensorflow/tensorflow/releases{/id}", "deployments_url": "https://api.github.com/repos/tensorflow/tensorflow/deployments", "created_at": "2015-11-07T01:19:20Z", "updated_at": "2018-11-24T19:34:08Z", "pushed_at": "2018-11-24T18:40:19Z", "git_url": "git://github.com/tensorflow/tensorflow.git", "ssh_url": "git@github.com:tensorflow/tensorflow.git", "clone_url": "https://github.com/tensorflow/tensorflow.git", "svn_url": "https://github.com/tensorflow/tensorflow", "homepage": "https://tensorflow.org", "size": 284546, "stargazers_count": 115176, "watchers_count": 115176, "language": "C++", "has_issues": true, "has_projects": true, "has_downloads": true, "has_wiki": false, "has_pages": false, "forks_count": 69944, "mirror_url": null, "archived": false, "open_issues_count": 1759, "license": {"key": "apache-2.0", "name": "Apache License 2.0", "spdx_id": "Apache-2.0", "url": "https://api.github.com/licenses/apache-2.0", "node_id": "MDc6TGljZW5zZTI="}, "forks": 69944, "open_issues": 1759, "watchers": 115176, "default_branch": "master"}}, "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13394"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/13394"}, "issue": {"href": "https://api.github.com/repos/tensorflow/tensorflow/issues/13394"}, "comments": {"href": "https://api.github.com/repos/tensorflow/tensorflow/issues/13394/comments"}, "review_comments": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13394/comments"}, "review_comment": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments{/number}"}, "commits": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13394/commits"}, "statuses": {"href": "https://api.github.com/repos/tensorflow/tensorflow/statuses/cdd35a75ea5a014086ef503726aef3da8c1eafec"}}, "author_association": "CONTRIBUTOR", "body_html": "<p>Encountered ill-defined behavior when trying to decode two audio files in a single call to <code>sess.run</code>. Changed <code>GetTempFilename</code> to use <code>mkstemps</code> instead of <code>getpid</code>. Old behavior demonstrated below:</p>\n<h3>Source code</h3>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">load_audio</span>(<span class=\"pl-smi\">wav_fp</span>):\n  wav_bin <span class=\"pl-k\">=</span> tf.read_file(wav_fp)\n  wav <span class=\"pl-k\">=</span> tf.contrib.ffmpeg.decode_audio(\n      wav_bin,\n      <span class=\"pl-v\">file_format</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>wav<span class=\"pl-pds\">'</span></span>,\n      <span class=\"pl-v\">samples_per_second</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">16000</span>,\n      <span class=\"pl-v\">channel_count</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">1</span>)\n  <span class=\"pl-k\">return</span> wav\n\nwav_fp0 <span class=\"pl-k\">=</span> tf.placeholder(tf.string, [])\nwav_fp1 <span class=\"pl-k\">=</span> tf.placeholder(tf.string, [])\n\nwav0 <span class=\"pl-k\">=</span> load_audio(wav_fp0)\nwav1 <span class=\"pl-k\">=</span> load_audio(wav_fp1)\n\n<span class=\"pl-k\">with</span> tf.Session() <span class=\"pl-k\">as</span> sess:\n  _wav_fp0 <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>test0.wav<span class=\"pl-pds\">'</span></span>\n  _wav_fp1 <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>test1.wav<span class=\"pl-pds\">'</span></span>\n\n  _wav0, _wav1 <span class=\"pl-k\">=</span> sess.run(\n      [wav0, wav1],\n      <span class=\"pl-v\">feed_dict</span><span class=\"pl-k\">=</span>{\n        wav_fp0: _wav_fp0,\n        wav_fp1: _wav_fp1})\n\n  <span class=\"pl-c1\">print</span> _wav0.shape\n  <span class=\"pl-c1\">print</span> _wav1.shape</pre></div>\n<h3>Race condition outcome 1 (second file write completes before either decode)</h3>\n<div class=\"highlight highlight-source-shell\"><pre>2017-09-29 16:02:23.435427: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn<span class=\"pl-s\"><span class=\"pl-pds\">'</span>t compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.</span>\n<span class=\"pl-s\">2017-09-29 16:02:23.435459: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn<span class=\"pl-pds\">'</span></span>t compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\nffmpeg version 2.8.11-0ubuntu0.16.04.1 Copyright (c) 2000-2017 the FFmpeg developers\n  built with gcc 5.4.0 (Ubuntu 5.4.0-6ubuntu1~16.04.4) 20160609\n  configuration: --prefix=/usr --extra-version=0ubuntu0.16.04.1 --build-suffix=-ffmpeg --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --cc=cc --cxx=g++ --enable-gpl --enable-shared --disable-stripping --disable-decoder=libopenjpeg --disable-decoder=libschroedinger --enable-avresample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libmodplug --enable-libmp3lame --enable-libopenjpeg --enable-libopus --enable-libpulse --enable-librtmp --enable-libschroedinger --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxvid --enable-libzvbi --enable-openal --enable-opengl --enable-x11grab --enable-libdc1394 --enable-libiec61883 --enable-libzmq --enable-frei0r --enable-libx264 --enable-libopencv\n  libavutil      54. 31.100 / 54. 31.100\n  libavcodec     56. 60.100 / 56. 60.100\n  libavformat    56. 40.101 / 56. 40.101\n  libavdevice    56.  4.100 / 56.  4.100\n  libavfilter     5. 40.101 /  5. 40.101\n  libavresample   2.  1.  0 /  2.  1.  0\n  libswscale      3.  1.101 /  3.  1.101\n  libswresample   1.  2.101 /  1.  2.101\n  libpostproc    53.  3.100 / 53.  3.100\nffmpeg version 2.8.11-0ubuntu0.16.04.1 Copyright (c) 2000-2017 the FFmpeg developers\n  built with gcc 5.4.0 (Ubuntu 5.4.0-6ubuntu1~16.04.4) 20160609\n  configuration: --prefix=/usr --extra-version=0ubuntu0.16.04.1 --build-suffix=-ffmpeg --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --cc=cc --cxx=g++ --enable-gpl --enable-shared --disable-stripping --disable-decoder=libopenjpeg --disable-decoder=libschroedinger --enable-avresample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libmodplug --enable-libmp3lame --enable-libopenjpeg --enable-libopus --enable-libpulse --enable-librtmp --enable-libschroedinger --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxvid --enable-libzvbi --enable-openal --enable-opengl --enable-x11grab --enable-libdc1394 --enable-libiec61883 --enable-libzmq --enable-frei0r --enable-libx264 --enable-libopencv\n  libavutil      54. 31.100 / 54. 31.100\n  libavcodec     56. 60.100 / 56. 60.100\n  libavformat    56. 40.101 / 56. 40.101\n  libavdevice    56.  4.100 / 56.  4.100\n  libavfilter     5. 40.101 /  5. 40.101\n  libavresample   2.  1.  0 /  2.  1.  0\n  libswscale      3.  1.101 /  3.  1.101\n  libswresample   1.  2.101 /  1.  2.101\n  libpostproc    53.  3.100 / 53.  3.100\nGuessed Channel Layout <span class=\"pl-k\">for</span>  Input Stream <span class=\"pl-c\"><span class=\"pl-c\">#</span>0.0 : mono</span>\nInput <span class=\"pl-c\"><span class=\"pl-c\">#</span>0, wav, from '/tmp/tmp_file_23229.wav':</span>\n  Duration: 00:00:02.23, bitrate: 265 kb/s\n    Stream <span class=\"pl-c\"><span class=\"pl-c\">#</span>0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 16000 Hz, 1 channels, s16, 256 kb/s</span>\nOutput <span class=\"pl-c\"><span class=\"pl-c\">#</span>0, s16le, to '/tmp/tmp_file_23229.raw':</span>\n  Metadata:\n    encoder         <span class=\"pl-c1\">:</span> Lavf56.40.101\n    Stream <span class=\"pl-c\"><span class=\"pl-c\">#</span>0:0: Audio: pcm_s16le, 16000 Hz, mono, s16, 256 kb/s</span>\n    Metadata:\n      encoder         <span class=\"pl-c1\">:</span> Lavc56.60.100 pcm_s16le\nStream mapping:\n  Stream <span class=\"pl-c\"><span class=\"pl-c\">#</span>0:0 -&gt; #0:0 (pcm_s16le (native) -&gt; pcm_s16le (native))</span>\nsize=      70kB time=00:00:02.22 bitrate= 256.0kbits/s    \nvideo:0kB audio:70kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.000000%\nGuessed Channel Layout <span class=\"pl-k\">for</span>  Input Stream <span class=\"pl-c\"><span class=\"pl-c\">#</span>0.0 : mono</span>\nInput <span class=\"pl-c\"><span class=\"pl-c\">#</span>0, wav, from '/tmp/tmp_file_23229.wav':</span>\n  Duration: 00:00:02.23, bitrate: 265 kb/s\n    Stream <span class=\"pl-c\"><span class=\"pl-c\">#</span>0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 16000 Hz, 1 channels, s16, 256 kb/s</span>\nOutput <span class=\"pl-c\"><span class=\"pl-c\">#</span>0, s16le, to '/tmp/tmp_file_23229.raw':</span>\n  Metadata:\n    encoder         <span class=\"pl-c1\">:</span> Lavf56.40.101\n    Stream <span class=\"pl-c\"><span class=\"pl-c\">#</span>0:0: Audio: pcm_s16le, 16000 Hz, mono, s16, 256 kb/s</span>\n    Metadata:\n      encoder         <span class=\"pl-c1\">:</span> Lavc56.60.100 pcm_s16le\nStream mapping:\n  Stream <span class=\"pl-c\"><span class=\"pl-c\">#</span>0:0 -&gt; #0:0 (pcm_s16le (native) -&gt; pcm_s16le (native))</span>\nsize=      70kB time=00:00:02.22 bitrate= 256.0kbits/s    \nvideo:0kB audio:70kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.000000%\n(35636, 1)\n(35636, 1)</pre></div>\n<h3>Race condition outcome 2 (file overwritten during decoding)</h3>\n<div class=\"highlight highlight-source-shell\"><pre>2017-09-29 16:02:18.596598: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn<span class=\"pl-s\"><span class=\"pl-pds\">'</span>t compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.</span>\n<span class=\"pl-s\">2017-09-29 16:02:18.596631: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn<span class=\"pl-pds\">'</span></span>t compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\nffmpeg version 2.8.11-0ubuntu0.16.04.1 Copyright (c) 2000-2017 the FFmpeg developers\n  built with gcc 5.4.0 (Ubuntu 5.4.0-6ubuntu1~16.04.4) 20160609\n  configuration: --prefix=/usr --extra-version=0ubuntu0.16.04.1 --build-suffix=-ffmpeg --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --cc=cc --cxx=g++ --enable-gpl --enable-shared --disable-stripping --disable-decoder=libopenjpeg --disable-decoder=libschroedinger --enable-avresample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libmodplug --enable-libmp3lame --enable-libopenjpeg --enable-libopus --enable-libpulse --enable-librtmp --enable-libschroedinger --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxvid --enable-libzvbi --enable-openal --enable-opengl --enable-x11grab --enable-libdc1394 --enable-libiec61883 --enable-libzmq --enable-frei0r --enable-libx264 --enable-libopencv\n  libavutil      54. 31.100 / 54. 31.100\n  libavcodec     56. 60.100 / 56. 60.100\n  libavformat    56. 40.101 / 56. 40.101\n  libavdevice    56.  4.100 / 56.  4.100\n  libavfilter     5. 40.101 /  5. 40.101\n  libavresample   2.  1.  0 /  2.  1.  0\n  libswscale      3.  1.101 /  3.  1.101\n  libswresample   1.  2.101 /  1.  2.101\n  libpostproc    53.  3.100 / 53.  3.100\nffmpeg version 2.8.11-0ubuntu0.16.04.1 Copyright (c) 2000-2017 the FFmpeg developers\n  built with gcc 5.4.0 (Ubuntu 5.4.0-6ubuntu1~16.04.4) 20160609\n  configuration: --prefix=/usr --extra-version=0ubuntu0.16.04.1 --build-suffix=-ffmpeg --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --cc=cc --cxx=g++ --enable-gpl --enable-shared --disable-stripping --disable-decoder=libopenjpeg --disable-decoder=libschroedinger --enable-avresample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libmodplug --enable-libmp3lame --enable-libopenjpeg --enable-libopus --enable-libpulse --enable-librtmp --enable-libschroedinger --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxvid --enable-libzvbi --enable-openal --enable-opengl --enable-x11grab --enable-libdc1394 --enable-libiec61883 --enable-libzmq --enable-frei0r --enable-libx264 --enable-libopencv\n  libavutil      54. 31.100 / 54. 31.100\n  libavcodec     56. 60.100 / 56. 60.100\n  libavformat    56. 40.101 / 56. 40.101\n  libavdevice    56.  4.100 / 56.  4.100\n  libavfilter     5. 40.101 /  5. 40.101\n  libavresample   2.  1.  0 /  2.  1.  0\n  libswscale      3.  1.101 /  3.  1.101\n  libswresample   1.  2.101 /  1.  2.101\n  libpostproc    53.  3.100 / 53.  3.100\nGuessed Channel Layout <span class=\"pl-k\">for</span>  Input Stream <span class=\"pl-c\"><span class=\"pl-c\">#</span>0.0 : mono</span>\nInput <span class=\"pl-c\"><span class=\"pl-c\">#</span>0, wav, from '/tmp/tmp_file_23205.wav':</span>\n  Duration: 00:00:02.31, bitrate: 256 kb/s\n    Stream <span class=\"pl-c\"><span class=\"pl-c\">#</span>0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 16000 Hz, 1 channels, s16, 256 kb/s</span>\nOutput <span class=\"pl-c\"><span class=\"pl-c\">#</span>0, s16le, to '/tmp/tmp_file_23205.raw':</span>\n  Metadata:\n    encoder         <span class=\"pl-c1\">:</span> Lavf56.40.101\n    Stream <span class=\"pl-c\"><span class=\"pl-c\">#</span>0:0: Audio: pcm_s16le, 16000 Hz, mono, s16, 256 kb/s</span>\n    Metadata:\n      encoder         <span class=\"pl-c1\">:</span> Lavc56.60.100 pcm_s16le\nStream mapping:\n  Stream <span class=\"pl-c\"><span class=\"pl-c\">#</span>0:0 -&gt; #0:0 (pcm_s16le (native) -&gt; pcm_s16le (native))</span>\nsize=      72kB time=00:00:02.31 bitrate= 256.0kbits/s    \nvideo:0kB audio:72kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.000000%\nGuessed Channel Layout <span class=\"pl-k\">for</span>  Input Stream <span class=\"pl-c\"><span class=\"pl-c\">#</span>0.0 : mono</span>\nInput <span class=\"pl-c\"><span class=\"pl-c\">#</span>0, wav, from '/tmp/tmp_file_23205.wav':</span>\n  Duration: 00:00:02.31, bitrate: 256 kb/s\n    Stream <span class=\"pl-c\"><span class=\"pl-c\">#</span>0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 16000 Hz, 1 channels, s16, 256 kb/s</span>\nOutput <span class=\"pl-c\"><span class=\"pl-c\">#</span>0, s16le, to '/tmp/tmp_file_23205.raw':</span>\n  Metadata:\n    encoder         <span class=\"pl-c1\">:</span> Lavf56.40.101\n    Stream <span class=\"pl-c\"><span class=\"pl-c\">#</span>0:0: Audio: pcm_s16le, 16000 Hz, mono, s16, 256 kb/s</span>\n    Metadata:\n      encoder         <span class=\"pl-c1\">:</span> Lavc56.60.100 pcm_s16le\nStream mapping:\n  Stream <span class=\"pl-c\"><span class=\"pl-c\">#</span>0:0 -&gt; #0:0 (pcm_s16le (native) -&gt; pcm_s16le (native))</span>\nsize=      72kB time=00:00:02.31 bitrate= 256.0kbits/s    \nvideo:0kB audio:72kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.000000%\n2017-09-29 16:02:18.637254: F tensorflow/contrib/ffmpeg/default/ffmpeg_lib.cc:116] Non-OK-status: <span class=\"pl-en\">ReadFileToString(Env::Default</span>(), filename, &amp;raw_data) status: Not found: /tmp/tmp_file_23205.rawCould not <span class=\"pl-c1\">read</span> FFmpeg output file: /tmp/tmp_file_23205.raw\nAborted (core dumped)</pre></div>", "body_text": "Encountered ill-defined behavior when trying to decode two audio files in a single call to sess.run. Changed GetTempFilename to use mkstemps instead of getpid. Old behavior demonstrated below:\nSource code\nimport tensorflow as tf\n\ndef load_audio(wav_fp):\n  wav_bin = tf.read_file(wav_fp)\n  wav = tf.contrib.ffmpeg.decode_audio(\n      wav_bin,\n      file_format='wav',\n      samples_per_second=16000,\n      channel_count=1)\n  return wav\n\nwav_fp0 = tf.placeholder(tf.string, [])\nwav_fp1 = tf.placeholder(tf.string, [])\n\nwav0 = load_audio(wav_fp0)\nwav1 = load_audio(wav_fp1)\n\nwith tf.Session() as sess:\n  _wav_fp0 = 'test0.wav'\n  _wav_fp1 = 'test1.wav'\n\n  _wav0, _wav1 = sess.run(\n      [wav0, wav1],\n      feed_dict={\n        wav_fp0: _wav_fp0,\n        wav_fp1: _wav_fp1})\n\n  print _wav0.shape\n  print _wav1.shape\nRace condition outcome 1 (second file write completes before either decode)\n2017-09-29 16:02:23.435427: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.\n2017-09-29 16:02:23.435459: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\nffmpeg version 2.8.11-0ubuntu0.16.04.1 Copyright (c) 2000-2017 the FFmpeg developers\n  built with gcc 5.4.0 (Ubuntu 5.4.0-6ubuntu1~16.04.4) 20160609\n  configuration: --prefix=/usr --extra-version=0ubuntu0.16.04.1 --build-suffix=-ffmpeg --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --cc=cc --cxx=g++ --enable-gpl --enable-shared --disable-stripping --disable-decoder=libopenjpeg --disable-decoder=libschroedinger --enable-avresample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libmodplug --enable-libmp3lame --enable-libopenjpeg --enable-libopus --enable-libpulse --enable-librtmp --enable-libschroedinger --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxvid --enable-libzvbi --enable-openal --enable-opengl --enable-x11grab --enable-libdc1394 --enable-libiec61883 --enable-libzmq --enable-frei0r --enable-libx264 --enable-libopencv\n  libavutil      54. 31.100 / 54. 31.100\n  libavcodec     56. 60.100 / 56. 60.100\n  libavformat    56. 40.101 / 56. 40.101\n  libavdevice    56.  4.100 / 56.  4.100\n  libavfilter     5. 40.101 /  5. 40.101\n  libavresample   2.  1.  0 /  2.  1.  0\n  libswscale      3.  1.101 /  3.  1.101\n  libswresample   1.  2.101 /  1.  2.101\n  libpostproc    53.  3.100 / 53.  3.100\nffmpeg version 2.8.11-0ubuntu0.16.04.1 Copyright (c) 2000-2017 the FFmpeg developers\n  built with gcc 5.4.0 (Ubuntu 5.4.0-6ubuntu1~16.04.4) 20160609\n  configuration: --prefix=/usr --extra-version=0ubuntu0.16.04.1 --build-suffix=-ffmpeg --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --cc=cc --cxx=g++ --enable-gpl --enable-shared --disable-stripping --disable-decoder=libopenjpeg --disable-decoder=libschroedinger --enable-avresample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libmodplug --enable-libmp3lame --enable-libopenjpeg --enable-libopus --enable-libpulse --enable-librtmp --enable-libschroedinger --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxvid --enable-libzvbi --enable-openal --enable-opengl --enable-x11grab --enable-libdc1394 --enable-libiec61883 --enable-libzmq --enable-frei0r --enable-libx264 --enable-libopencv\n  libavutil      54. 31.100 / 54. 31.100\n  libavcodec     56. 60.100 / 56. 60.100\n  libavformat    56. 40.101 / 56. 40.101\n  libavdevice    56.  4.100 / 56.  4.100\n  libavfilter     5. 40.101 /  5. 40.101\n  libavresample   2.  1.  0 /  2.  1.  0\n  libswscale      3.  1.101 /  3.  1.101\n  libswresample   1.  2.101 /  1.  2.101\n  libpostproc    53.  3.100 / 53.  3.100\nGuessed Channel Layout for  Input Stream #0.0 : mono\nInput #0, wav, from '/tmp/tmp_file_23229.wav':\n  Duration: 00:00:02.23, bitrate: 265 kb/s\n    Stream #0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 16000 Hz, 1 channels, s16, 256 kb/s\nOutput #0, s16le, to '/tmp/tmp_file_23229.raw':\n  Metadata:\n    encoder         : Lavf56.40.101\n    Stream #0:0: Audio: pcm_s16le, 16000 Hz, mono, s16, 256 kb/s\n    Metadata:\n      encoder         : Lavc56.60.100 pcm_s16le\nStream mapping:\n  Stream #0:0 -> #0:0 (pcm_s16le (native) -> pcm_s16le (native))\nsize=      70kB time=00:00:02.22 bitrate= 256.0kbits/s    \nvideo:0kB audio:70kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.000000%\nGuessed Channel Layout for  Input Stream #0.0 : mono\nInput #0, wav, from '/tmp/tmp_file_23229.wav':\n  Duration: 00:00:02.23, bitrate: 265 kb/s\n    Stream #0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 16000 Hz, 1 channels, s16, 256 kb/s\nOutput #0, s16le, to '/tmp/tmp_file_23229.raw':\n  Metadata:\n    encoder         : Lavf56.40.101\n    Stream #0:0: Audio: pcm_s16le, 16000 Hz, mono, s16, 256 kb/s\n    Metadata:\n      encoder         : Lavc56.60.100 pcm_s16le\nStream mapping:\n  Stream #0:0 -> #0:0 (pcm_s16le (native) -> pcm_s16le (native))\nsize=      70kB time=00:00:02.22 bitrate= 256.0kbits/s    \nvideo:0kB audio:70kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.000000%\n(35636, 1)\n(35636, 1)\nRace condition outcome 2 (file overwritten during decoding)\n2017-09-29 16:02:18.596598: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.\n2017-09-29 16:02:18.596631: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\nffmpeg version 2.8.11-0ubuntu0.16.04.1 Copyright (c) 2000-2017 the FFmpeg developers\n  built with gcc 5.4.0 (Ubuntu 5.4.0-6ubuntu1~16.04.4) 20160609\n  configuration: --prefix=/usr --extra-version=0ubuntu0.16.04.1 --build-suffix=-ffmpeg --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --cc=cc --cxx=g++ --enable-gpl --enable-shared --disable-stripping --disable-decoder=libopenjpeg --disable-decoder=libschroedinger --enable-avresample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libmodplug --enable-libmp3lame --enable-libopenjpeg --enable-libopus --enable-libpulse --enable-librtmp --enable-libschroedinger --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxvid --enable-libzvbi --enable-openal --enable-opengl --enable-x11grab --enable-libdc1394 --enable-libiec61883 --enable-libzmq --enable-frei0r --enable-libx264 --enable-libopencv\n  libavutil      54. 31.100 / 54. 31.100\n  libavcodec     56. 60.100 / 56. 60.100\n  libavformat    56. 40.101 / 56. 40.101\n  libavdevice    56.  4.100 / 56.  4.100\n  libavfilter     5. 40.101 /  5. 40.101\n  libavresample   2.  1.  0 /  2.  1.  0\n  libswscale      3.  1.101 /  3.  1.101\n  libswresample   1.  2.101 /  1.  2.101\n  libpostproc    53.  3.100 / 53.  3.100\nffmpeg version 2.8.11-0ubuntu0.16.04.1 Copyright (c) 2000-2017 the FFmpeg developers\n  built with gcc 5.4.0 (Ubuntu 5.4.0-6ubuntu1~16.04.4) 20160609\n  configuration: --prefix=/usr --extra-version=0ubuntu0.16.04.1 --build-suffix=-ffmpeg --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --cc=cc --cxx=g++ --enable-gpl --enable-shared --disable-stripping --disable-decoder=libopenjpeg --disable-decoder=libschroedinger --enable-avresample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libmodplug --enable-libmp3lame --enable-libopenjpeg --enable-libopus --enable-libpulse --enable-librtmp --enable-libschroedinger --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxvid --enable-libzvbi --enable-openal --enable-opengl --enable-x11grab --enable-libdc1394 --enable-libiec61883 --enable-libzmq --enable-frei0r --enable-libx264 --enable-libopencv\n  libavutil      54. 31.100 / 54. 31.100\n  libavcodec     56. 60.100 / 56. 60.100\n  libavformat    56. 40.101 / 56. 40.101\n  libavdevice    56.  4.100 / 56.  4.100\n  libavfilter     5. 40.101 /  5. 40.101\n  libavresample   2.  1.  0 /  2.  1.  0\n  libswscale      3.  1.101 /  3.  1.101\n  libswresample   1.  2.101 /  1.  2.101\n  libpostproc    53.  3.100 / 53.  3.100\nGuessed Channel Layout for  Input Stream #0.0 : mono\nInput #0, wav, from '/tmp/tmp_file_23205.wav':\n  Duration: 00:00:02.31, bitrate: 256 kb/s\n    Stream #0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 16000 Hz, 1 channels, s16, 256 kb/s\nOutput #0, s16le, to '/tmp/tmp_file_23205.raw':\n  Metadata:\n    encoder         : Lavf56.40.101\n    Stream #0:0: Audio: pcm_s16le, 16000 Hz, mono, s16, 256 kb/s\n    Metadata:\n      encoder         : Lavc56.60.100 pcm_s16le\nStream mapping:\n  Stream #0:0 -> #0:0 (pcm_s16le (native) -> pcm_s16le (native))\nsize=      72kB time=00:00:02.31 bitrate= 256.0kbits/s    \nvideo:0kB audio:72kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.000000%\nGuessed Channel Layout for  Input Stream #0.0 : mono\nInput #0, wav, from '/tmp/tmp_file_23205.wav':\n  Duration: 00:00:02.31, bitrate: 256 kb/s\n    Stream #0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 16000 Hz, 1 channels, s16, 256 kb/s\nOutput #0, s16le, to '/tmp/tmp_file_23205.raw':\n  Metadata:\n    encoder         : Lavf56.40.101\n    Stream #0:0: Audio: pcm_s16le, 16000 Hz, mono, s16, 256 kb/s\n    Metadata:\n      encoder         : Lavc56.60.100 pcm_s16le\nStream mapping:\n  Stream #0:0 -> #0:0 (pcm_s16le (native) -> pcm_s16le (native))\nsize=      72kB time=00:00:02.31 bitrate= 256.0kbits/s    \nvideo:0kB audio:72kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.000000%\n2017-09-29 16:02:18.637254: F tensorflow/contrib/ffmpeg/default/ffmpeg_lib.cc:116] Non-OK-status: ReadFileToString(Env::Default(), filename, &raw_data) status: Not found: /tmp/tmp_file_23205.rawCould not read FFmpeg output file: /tmp/tmp_file_23205.raw\nAborted (core dumped)", "merged": true, "mergeable": null, "rebaseable": null, "mergeable_state": "unknown", "merged_by": {"login": "sb2nov", "id": 1517779, "node_id": "MDQ6VXNlcjE1MTc3Nzk=", "avatar_url": "https://avatars2.githubusercontent.com/u/1517779?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sb2nov", "html_url": "https://github.com/sb2nov", "followers_url": "https://api.github.com/users/sb2nov/followers", "following_url": "https://api.github.com/users/sb2nov/following{/other_user}", "gists_url": "https://api.github.com/users/sb2nov/gists{/gist_id}", "starred_url": "https://api.github.com/users/sb2nov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sb2nov/subscriptions", "organizations_url": "https://api.github.com/users/sb2nov/orgs", "repos_url": "https://api.github.com/users/sb2nov/repos", "events_url": "https://api.github.com/users/sb2nov/events{/privacy}", "received_events_url": "https://api.github.com/users/sb2nov/received_events", "type": "User", "site_admin": false}, "comments": 4, "review_comments": 0, "maintainer_can_modify": false, "commits": 2, "additions": 9, "deletions": 1, "changed_files": 1}