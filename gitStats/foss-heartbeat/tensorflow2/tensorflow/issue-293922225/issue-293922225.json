{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16695", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16695/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16695/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16695/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/16695", "id": 293922225, "node_id": "MDU6SXNzdWUyOTM5MjIyMjU=", "number": 16695, "title": "Padding algo is not working as doc says", "user": {"login": "LucasMahieu", "id": 12006816, "node_id": "MDQ6VXNlcjEyMDA2ODE2", "avatar_url": "https://avatars3.githubusercontent.com/u/12006816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LucasMahieu", "html_url": "https://github.com/LucasMahieu", "followers_url": "https://api.github.com/users/LucasMahieu/followers", "following_url": "https://api.github.com/users/LucasMahieu/following{/other_user}", "gists_url": "https://api.github.com/users/LucasMahieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/LucasMahieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LucasMahieu/subscriptions", "organizations_url": "https://api.github.com/users/LucasMahieu/orgs", "repos_url": "https://api.github.com/users/LucasMahieu/repos", "events_url": "https://api.github.com/users/LucasMahieu/events{/privacy}", "received_events_url": "https://api.github.com/users/LucasMahieu/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-02-02T15:19:12Z", "updated_at": "2018-02-02T17:38:10Z", "closed_at": "2018-02-02T17:38:10Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Linus centos 7</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: pip</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.4</li>\n<li><strong>Python version</strong>: 2.7.5</li>\n<li><strong>Bazel version (if compiling from source)</strong>: 0</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>:0</li>\n<li><strong>CUDA/cuDNN version</strong>:0</li>\n<li><strong>GPU model and memory</strong>:0</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<p>In the following situation, TF <a href=\"https://www.tensorflow.org/api_guides/python/nn#Convolution\" rel=\"nofollow\">doc</a> is not correct.</p>\n<ul>\n<li>Input tensor shape : [1, 5, 2, 1]</li>\n<li>Kernel shape:           [1, 3, 1, 1]</li>\n<li>Stride :                      [1, 5, 5, 1]</li>\n<li>Padding =                  \"SAME\"</li>\n</ul>\n<p>According to the formula we can compute :<br>\nout_h = 1<br>\nout_w = 1</p>\n<pre><code>if (in_height % strides[1] == 0):\n  pad_along_height = max(filter_height - strides[1], 0)\nelse:\n  pad_along_height = max(filter_height - (in_height % strides[1]), 0)\nif (in_width % strides[2] == 0):\n  pad_along_width = max(filter_width - strides[2], 0)\nelse:\n  pad_along_width = max(filter_width - (in_width % strides[2]), 0)\n</code></pre>\n<p>gives :<br>\npad_along_height = 0<br>\npad_along_width = 1</p>\n<p>then</p>\n<pre><code>pad_top = pad_along_height // 2\npad_bottom = pad_along_height - pad_top\npad_left = pad_along_width // 2\npad_right = pad_along_width - pad_left\n</code></pre>\n<p>gives:</p>\n<p>pad_top = 0<br>\npad_bottom = 0<br>\npad_left = 0<br>\npad_right = 1</p>\n<p>How tensorflow do a convolution with a kernel of height 1 on a image of height 5 and which gives output of height 1 (stride = 5) ??? How TF do this ? The doc can't explain the method used ...</p>\n<p>Doing retro engineering, I saw that TF apply the filter on the middle of the input tensor (pad_top = -2 and pad_bottom=-2).<br>\nI agree with this method, but the formulas of the Convolution doc is doing max(.., 0) so padding could never be negative (according to the doc).</p>\n<p>Could someone explain me clearly what is the formula used in tensorflow ?<br>\nCould someone update the doc ?</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linus centos 7\nTensorFlow installed from (source or binary): pip\nTensorFlow version (use command below): 1.4\nPython version: 2.7.5\nBazel version (if compiling from source): 0\nGCC/Compiler version (if compiling from source):0\nCUDA/cuDNN version:0\nGPU model and memory:0\nExact command to reproduce:\n\nIn the following situation, TF doc is not correct.\n\nInput tensor shape : [1, 5, 2, 1]\nKernel shape:           [1, 3, 1, 1]\nStride :                      [1, 5, 5, 1]\nPadding =                  \"SAME\"\n\nAccording to the formula we can compute :\nout_h = 1\nout_w = 1\nif (in_height % strides[1] == 0):\n  pad_along_height = max(filter_height - strides[1], 0)\nelse:\n  pad_along_height = max(filter_height - (in_height % strides[1]), 0)\nif (in_width % strides[2] == 0):\n  pad_along_width = max(filter_width - strides[2], 0)\nelse:\n  pad_along_width = max(filter_width - (in_width % strides[2]), 0)\n\ngives :\npad_along_height = 0\npad_along_width = 1\nthen\npad_top = pad_along_height // 2\npad_bottom = pad_along_height - pad_top\npad_left = pad_along_width // 2\npad_right = pad_along_width - pad_left\n\ngives:\npad_top = 0\npad_bottom = 0\npad_left = 0\npad_right = 1\nHow tensorflow do a convolution with a kernel of height 1 on a image of height 5 and which gives output of height 1 (stride = 5) ??? How TF do this ? The doc can't explain the method used ...\nDoing retro engineering, I saw that TF apply the filter on the middle of the input tensor (pad_top = -2 and pad_bottom=-2).\nI agree with this method, but the formulas of the Convolution doc is doing max(.., 0) so padding could never be negative (according to the doc).\nCould someone explain me clearly what is the formula used in tensorflow ?\nCould someone update the doc ?", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linus centos 7\r\n- **TensorFlow installed from (source or binary)**: pip\r\n- **TensorFlow version (use command below)**: 1.4\r\n- **Python version**: 2.7.5\r\n- **Bazel version (if compiling from source)**: 0\r\n- **GCC/Compiler version (if compiling from source)**:0\r\n- **CUDA/cuDNN version**:0\r\n- **GPU model and memory**:0\r\n- **Exact command to reproduce**:\r\n\r\nIn the following situation, TF [doc](https://www.tensorflow.org/api_guides/python/nn#Convolution) is not correct.\r\n- Input tensor shape : [1, 5, 2, 1]\r\n- Kernel shape:           [1, 3, 1, 1]\r\n- Stride :                      [1, 5, 5, 1]\r\n- Padding =                  \"SAME\"\r\n\r\nAccording to the formula we can compute : \r\nout_h = 1\r\nout_w = 1\r\n\r\n```\r\nif (in_height % strides[1] == 0):\r\n  pad_along_height = max(filter_height - strides[1], 0)\r\nelse:\r\n  pad_along_height = max(filter_height - (in_height % strides[1]), 0)\r\nif (in_width % strides[2] == 0):\r\n  pad_along_width = max(filter_width - strides[2], 0)\r\nelse:\r\n  pad_along_width = max(filter_width - (in_width % strides[2]), 0)\r\n```\r\ngives :\r\npad_along_height = 0\r\npad_along_width = 1\r\n\r\nthen \r\n```\r\npad_top = pad_along_height // 2\r\npad_bottom = pad_along_height - pad_top\r\npad_left = pad_along_width // 2\r\npad_right = pad_along_width - pad_left\r\n```\r\n\r\ngives:\r\n\r\npad_top = 0\r\npad_bottom = 0\r\npad_left = 0\r\npad_right = 1\r\n\r\nHow tensorflow do a convolution with a kernel of height 1 on a image of height 5 and which gives output of height 1 (stride = 5) ??? How TF do this ? The doc can't explain the method used ... \r\n\r\nDoing retro engineering, I saw that TF apply the filter on the middle of the input tensor (pad_top = -2 and pad_bottom=-2).\r\nI agree with this method, but the formulas of the Convolution doc is doing max(.., 0) so padding could never be negative (according to the doc).\r\n\r\nCould someone explain me clearly what is the formula used in tensorflow ?\r\nCould someone update the doc ?"}