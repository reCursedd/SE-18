{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/426355744", "html_url": "https://github.com/tensorflow/tensorflow/issues/22619#issuecomment-426355744", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22619", "id": 426355744, "node_id": "MDEyOklzc3VlQ29tbWVudDQyNjM1NTc0NA==", "user": {"login": "elliottslaughter", "id": 3129, "node_id": "MDQ6VXNlcjMxMjk=", "avatar_url": "https://avatars0.githubusercontent.com/u/3129?v=4", "gravatar_id": "", "url": "https://api.github.com/users/elliottslaughter", "html_url": "https://github.com/elliottslaughter", "followers_url": "https://api.github.com/users/elliottslaughter/followers", "following_url": "https://api.github.com/users/elliottslaughter/following{/other_user}", "gists_url": "https://api.github.com/users/elliottslaughter/gists{/gist_id}", "starred_url": "https://api.github.com/users/elliottslaughter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/elliottslaughter/subscriptions", "organizations_url": "https://api.github.com/users/elliottslaughter/orgs", "repos_url": "https://api.github.com/users/elliottslaughter/repos", "events_url": "https://api.github.com/users/elliottslaughter/events{/privacy}", "received_events_url": "https://api.github.com/users/elliottslaughter/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-02T17:13:33Z", "updated_at": "2018-10-02T17:13:33Z", "author_association": "NONE", "body_html": "<p>Sorry, you're right. I didn't realize that <code>time.clock</code> was processor, not wall-time, so I wasn't expecting it to diverge from <code>time.perf_counter</code>.</p>\n<p>I uploaded a new version of the script to my gist to make it easier to measure the differences between the different parallelism:</p>\n<p><a href=\"https://gist.github.com/elliottslaughter/750a27c832782f4daec8686281027de8\">https://gist.github.com/elliottslaughter/750a27c832782f4daec8686281027de8</a></p>\n<p>Using the new version makes it clear that I am able to use intra-parallelism, but not inter- or device parallelism. My results look like:</p>\n<pre><code>$ time python test_cores.py 1\n2018-10-02 10:03:39.670640: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\nRunning on 1 CPU devices with 1 inter- and 1 intra-parallelism\n  Assigning matmul to /cpu:0\n  Duration (via time.perf_counter()): 23.035862 (954428.021369 - 954404.985507)\n  Clock (via time.clock()): 23.033090 (28.836996 - 5.803906)\n\nreal\t0m24.255s\nuser\t0m24.341s\nsys\t0m4.684s\n$ time python test_cores.py 2 --use-intra\n2018-10-02 10:05:40.475097: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\nRunning on 1 CPU devices with 1 inter- and 2 intra-parallelism\n  Assigning matmul to /cpu:0\n  Assigning matmul to /cpu:0\n  Duration (via time.perf_counter()): 25.217650 (954551.012769 - 954525.795119)\n  Clock (via time.clock()): 48.820185 (54.550306 - 5.730121)\n\nreal\t0m26.358s\nuser\t0m48.323s\nsys\t0m6.395s\n$ time python test_cores.py 2 --use-inter\n2018-10-02 10:06:23.214802: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\nRunning on 1 CPU devices with 2 inter- and 1 intra-parallelism\n  Assigning matmul to /cpu:0\n  Assigning matmul to /cpu:0\n  Duration (via time.perf_counter()): 46.085013 (954614.619281 - 954568.534268)\n  Clock (via time.clock()): 46.082734 (51.454584 - 5.371850)\n\nreal\t0m47.329s\nuser\t0m46.348s\nsys\t0m5.282s\n$ time python test_cores.py 2 --use-dev\n2018-10-02 10:07:20.181342: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\nRunning on 2 CPU devices with 1 inter- and 1 intra-parallelism\n  Assigning matmul to /cpu:0\n  Assigning matmul to /cpu:1\n  Duration (via time.perf_counter()): 50.084812 (954675.586213 - 954625.501400)\n  Clock (via time.clock()): 49.951666 (55.752782 - 5.801116)\n\nreal\t0m51.306s\nuser\t0m50.315s\nsys\t0m5.631s\n</code></pre>\n<p>Are you aware of any reasons why I might not be able to use inter- or device parallelism? I really wanted to try model parallelism on some of my programs.</p>\n<p>Thanks.</p>", "body_text": "Sorry, you're right. I didn't realize that time.clock was processor, not wall-time, so I wasn't expecting it to diverge from time.perf_counter.\nI uploaded a new version of the script to my gist to make it easier to measure the differences between the different parallelism:\nhttps://gist.github.com/elliottslaughter/750a27c832782f4daec8686281027de8\nUsing the new version makes it clear that I am able to use intra-parallelism, but not inter- or device parallelism. My results look like:\n$ time python test_cores.py 1\n2018-10-02 10:03:39.670640: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\nRunning on 1 CPU devices with 1 inter- and 1 intra-parallelism\n  Assigning matmul to /cpu:0\n  Duration (via time.perf_counter()): 23.035862 (954428.021369 - 954404.985507)\n  Clock (via time.clock()): 23.033090 (28.836996 - 5.803906)\n\nreal\t0m24.255s\nuser\t0m24.341s\nsys\t0m4.684s\n$ time python test_cores.py 2 --use-intra\n2018-10-02 10:05:40.475097: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\nRunning on 1 CPU devices with 1 inter- and 2 intra-parallelism\n  Assigning matmul to /cpu:0\n  Assigning matmul to /cpu:0\n  Duration (via time.perf_counter()): 25.217650 (954551.012769 - 954525.795119)\n  Clock (via time.clock()): 48.820185 (54.550306 - 5.730121)\n\nreal\t0m26.358s\nuser\t0m48.323s\nsys\t0m6.395s\n$ time python test_cores.py 2 --use-inter\n2018-10-02 10:06:23.214802: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\nRunning on 1 CPU devices with 2 inter- and 1 intra-parallelism\n  Assigning matmul to /cpu:0\n  Assigning matmul to /cpu:0\n  Duration (via time.perf_counter()): 46.085013 (954614.619281 - 954568.534268)\n  Clock (via time.clock()): 46.082734 (51.454584 - 5.371850)\n\nreal\t0m47.329s\nuser\t0m46.348s\nsys\t0m5.282s\n$ time python test_cores.py 2 --use-dev\n2018-10-02 10:07:20.181342: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\nRunning on 2 CPU devices with 1 inter- and 1 intra-parallelism\n  Assigning matmul to /cpu:0\n  Assigning matmul to /cpu:1\n  Duration (via time.perf_counter()): 50.084812 (954675.586213 - 954625.501400)\n  Clock (via time.clock()): 49.951666 (55.752782 - 5.801116)\n\nreal\t0m51.306s\nuser\t0m50.315s\nsys\t0m5.631s\n\nAre you aware of any reasons why I might not be able to use inter- or device parallelism? I really wanted to try model parallelism on some of my programs.\nThanks.", "body": "Sorry, you're right. I didn't realize that `time.clock` was processor, not wall-time, so I wasn't expecting it to diverge from `time.perf_counter`.\r\n\r\nI uploaded a new version of the script to my gist to make it easier to measure the differences between the different parallelism:\r\n\r\nhttps://gist.github.com/elliottslaughter/750a27c832782f4daec8686281027de8\r\n\r\nUsing the new version makes it clear that I am able to use intra-parallelism, but not inter- or device parallelism. My results look like:\r\n\r\n```\r\n$ time python test_cores.py 1\r\n2018-10-02 10:03:39.670640: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\r\nRunning on 1 CPU devices with 1 inter- and 1 intra-parallelism\r\n  Assigning matmul to /cpu:0\r\n  Duration (via time.perf_counter()): 23.035862 (954428.021369 - 954404.985507)\r\n  Clock (via time.clock()): 23.033090 (28.836996 - 5.803906)\r\n\r\nreal\t0m24.255s\r\nuser\t0m24.341s\r\nsys\t0m4.684s\r\n$ time python test_cores.py 2 --use-intra\r\n2018-10-02 10:05:40.475097: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\r\nRunning on 1 CPU devices with 1 inter- and 2 intra-parallelism\r\n  Assigning matmul to /cpu:0\r\n  Assigning matmul to /cpu:0\r\n  Duration (via time.perf_counter()): 25.217650 (954551.012769 - 954525.795119)\r\n  Clock (via time.clock()): 48.820185 (54.550306 - 5.730121)\r\n\r\nreal\t0m26.358s\r\nuser\t0m48.323s\r\nsys\t0m6.395s\r\n$ time python test_cores.py 2 --use-inter\r\n2018-10-02 10:06:23.214802: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\r\nRunning on 1 CPU devices with 2 inter- and 1 intra-parallelism\r\n  Assigning matmul to /cpu:0\r\n  Assigning matmul to /cpu:0\r\n  Duration (via time.perf_counter()): 46.085013 (954614.619281 - 954568.534268)\r\n  Clock (via time.clock()): 46.082734 (51.454584 - 5.371850)\r\n\r\nreal\t0m47.329s\r\nuser\t0m46.348s\r\nsys\t0m5.282s\r\n$ time python test_cores.py 2 --use-dev\r\n2018-10-02 10:07:20.181342: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\r\nRunning on 2 CPU devices with 1 inter- and 1 intra-parallelism\r\n  Assigning matmul to /cpu:0\r\n  Assigning matmul to /cpu:1\r\n  Duration (via time.perf_counter()): 50.084812 (954675.586213 - 954625.501400)\r\n  Clock (via time.clock()): 49.951666 (55.752782 - 5.801116)\r\n\r\nreal\t0m51.306s\r\nuser\t0m50.315s\r\nsys\t0m5.631s\r\n```\r\n\r\nAre you aware of any reasons why I might not be able to use inter- or device parallelism? I really wanted to try model parallelism on some of my programs.\r\n\r\nThanks."}