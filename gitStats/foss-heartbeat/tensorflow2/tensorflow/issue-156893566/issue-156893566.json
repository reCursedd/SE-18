{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2511", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2511/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2511/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2511/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/2511", "id": 156893566, "node_id": "MDU6SXNzdWUxNTY4OTM1NjY=", "number": 2511, "title": "Shape inference crashes in SpaceToBatch when padding input is a persistent tensor", "user": {"login": "yaroslavvb", "id": 23068, "node_id": "MDQ6VXNlcjIzMDY4", "avatar_url": "https://avatars3.githubusercontent.com/u/23068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yaroslavvb", "html_url": "https://github.com/yaroslavvb", "followers_url": "https://api.github.com/users/yaroslavvb/followers", "following_url": "https://api.github.com/users/yaroslavvb/following{/other_user}", "gists_url": "https://api.github.com/users/yaroslavvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/yaroslavvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yaroslavvb/subscriptions", "organizations_url": "https://api.github.com/users/yaroslavvb/orgs", "repos_url": "https://api.github.com/users/yaroslavvb/repos", "events_url": "https://api.github.com/users/yaroslavvb/events{/privacy}", "received_events_url": "https://api.github.com/users/yaroslavvb/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-05-26T03:00:33Z", "updated_at": "2016-05-26T13:19:49Z", "closed_at": "2016-05-26T13:19:49Z", "author_association": "CONTRIBUTOR", "body_html": "<p>TLDR; is there a way to turn off shape inference, or allow support SpaceToBatch getting padding from GetSessionTensor op, which has unknown shape?</p>\n<p>To reproduce</p>\n<pre><code>(holder1, input) = tf.get_session_tensor(tf.float32)\n(holder2, paddings) = tf.get_session_tensor(tf.int32)\ntf.space_to_batch(input, paddings, 2)\n\n\nTypeError: 'NoneType' object has no attribute '__getitem__'\n\n</code></pre>\n<ol>\n<li>SpaceToBatch inputs are GetSessionTensor ops.</li>\n<li><code>_SpaceToBatchShape</code> calls tensor_util.constant_value</li>\n<li>that goes to _ConstantValue which checks op.type, and returns None since GetSessionTensor not recognized</li>\n<li>That goes back to <code>_SpaceToBatchShape</code> and crashes with<br>\nTypeError: 'NoneType' object has no attribute <code>'__getitem__'</code><br>\nin this line because paddings is None</li>\n</ol>\n<pre><code>  paddings = tensor_util.constant_value(op.inputs[1])\n  if (paddings[0, 0] &lt; 0 or paddings[0, 1] &lt; 0 or\n      paddings[1, 0] &lt; 0 or paddings[1, 1] &lt; 0):\n    raise ValueError(\"paddings cannot be negative.\")\n\n</code></pre>\n<p>I got this when trying to use atrous convolution</p>\n<pre><code>File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/contrib/immediate/python/immediate/ops/nn_test.py\", line 304, in testAtrousSequence\n    y1 = tf.nn.atrous_conv2d(x, f, rate, padding=padding)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/python/ops/nn_ops.py\", line 205, in atrous_conv2d\n    block_size=rate)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/python/ops/gen_array_ops.py\", line 1471, in space_to_batch\n    block_size=block_size, name=name)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/contrib/immediate/python/immediate/op.py\", line 315, in apply_op\n    **keywords)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/python/ops/op_def_library.py\", line 702, in apply_op\n    op_def=op_def)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/python/framework/ops.py\", line 2188, in create_op\n    set_shapes_for_outputs(ret)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/python/framework/ops.py\", line 1635, in set_shapes_for_outputs\n    shapes = shape_func(op)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/python/ops/array_ops.py\", line 1632, in _SpaceToBatchShape\n    if (paddings[0, 0] &lt; 0 or paddings[0, 1] &lt; 0 or\nTypeError: 'NoneType' object has no attribute '__getitem__'\n\n</code></pre>", "body_text": "TLDR; is there a way to turn off shape inference, or allow support SpaceToBatch getting padding from GetSessionTensor op, which has unknown shape?\nTo reproduce\n(holder1, input) = tf.get_session_tensor(tf.float32)\n(holder2, paddings) = tf.get_session_tensor(tf.int32)\ntf.space_to_batch(input, paddings, 2)\n\n\nTypeError: 'NoneType' object has no attribute '__getitem__'\n\n\n\nSpaceToBatch inputs are GetSessionTensor ops.\n_SpaceToBatchShape calls tensor_util.constant_value\nthat goes to _ConstantValue which checks op.type, and returns None since GetSessionTensor not recognized\nThat goes back to _SpaceToBatchShape and crashes with\nTypeError: 'NoneType' object has no attribute '__getitem__'\nin this line because paddings is None\n\n  paddings = tensor_util.constant_value(op.inputs[1])\n  if (paddings[0, 0] < 0 or paddings[0, 1] < 0 or\n      paddings[1, 0] < 0 or paddings[1, 1] < 0):\n    raise ValueError(\"paddings cannot be negative.\")\n\n\nI got this when trying to use atrous convolution\nFile \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/contrib/immediate/python/immediate/ops/nn_test.py\", line 304, in testAtrousSequence\n    y1 = tf.nn.atrous_conv2d(x, f, rate, padding=padding)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/python/ops/nn_ops.py\", line 205, in atrous_conv2d\n    block_size=rate)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/python/ops/gen_array_ops.py\", line 1471, in space_to_batch\n    block_size=block_size, name=name)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/contrib/immediate/python/immediate/op.py\", line 315, in apply_op\n    **keywords)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/python/ops/op_def_library.py\", line 702, in apply_op\n    op_def=op_def)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/python/framework/ops.py\", line 2188, in create_op\n    set_shapes_for_outputs(ret)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/python/framework/ops.py\", line 1635, in set_shapes_for_outputs\n    shapes = shape_func(op)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/python/ops/array_ops.py\", line 1632, in _SpaceToBatchShape\n    if (paddings[0, 0] < 0 or paddings[0, 1] < 0 or\nTypeError: 'NoneType' object has no attribute '__getitem__'", "body": "TLDR; is there a way to turn off shape inference, or allow support SpaceToBatch getting padding from GetSessionTensor op, which has unknown shape?\n\nTo reproduce\n\n```\n(holder1, input) = tf.get_session_tensor(tf.float32)\n(holder2, paddings) = tf.get_session_tensor(tf.int32)\ntf.space_to_batch(input, paddings, 2)\n\n\nTypeError: 'NoneType' object has no attribute '__getitem__'\n\n```\n1. SpaceToBatch inputs are GetSessionTensor ops.\n2. `_SpaceToBatchShape` calls tensor_util.constant_value\n3. that goes to _ConstantValue which checks op.type, and returns None since GetSessionTensor not recognized\n4. That goes back to `_SpaceToBatchShape` and crashes with\n   TypeError: 'NoneType' object has no attribute `'__getitem__'`\n   in this line because paddings is None\n\n```\n  paddings = tensor_util.constant_value(op.inputs[1])\n  if (paddings[0, 0] < 0 or paddings[0, 1] < 0 or\n      paddings[1, 0] < 0 or paddings[1, 1] < 0):\n    raise ValueError(\"paddings cannot be negative.\")\n\n```\n\nI got this when trying to use atrous convolution\n\n```\nFile \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/contrib/immediate/python/immediate/ops/nn_test.py\", line 304, in testAtrousSequence\n    y1 = tf.nn.atrous_conv2d(x, f, rate, padding=padding)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/python/ops/nn_ops.py\", line 205, in atrous_conv2d\n    block_size=rate)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/python/ops/gen_array_ops.py\", line 1471, in space_to_batch\n    block_size=block_size, name=name)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/contrib/immediate/python/immediate/op.py\", line 315, in apply_op\n    **keywords)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/python/ops/op_def_library.py\", line 702, in apply_op\n    op_def=op_def)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/python/framework/ops.py\", line 2188, in create_op\n    set_shapes_for_outputs(ret)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/python/framework/ops.py\", line 1635, in set_shapes_for_outputs\n    shapes = shape_func(op)\n  File \"/private/var/tmp/_bazel_yaroslavvb/ea642be0829ea15e6d2092d22e894d3d/tensorflow/bazel-out/local_darwin-opt/bin/tensorflow/contrib/immediate/nn_test.runfiles/tensorflow/python/ops/array_ops.py\", line 1632, in _SpaceToBatchShape\n    if (paddings[0, 0] < 0 or paddings[0, 1] < 0 or\nTypeError: 'NoneType' object has no attribute '__getitem__'\n\n```\n"}