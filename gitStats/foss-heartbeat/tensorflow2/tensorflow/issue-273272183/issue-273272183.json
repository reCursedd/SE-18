{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14505", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14505/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14505/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14505/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/14505", "id": 273272183, "node_id": "MDU6SXNzdWUyNzMyNzIxODM=", "number": 14505, "title": "index_to_string_table_from_file cannot use tf.string as vocabulary file", "user": {"login": "OlavHN", "id": 324645, "node_id": "MDQ6VXNlcjMyNDY0NQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/324645?v=4", "gravatar_id": "", "url": "https://api.github.com/users/OlavHN", "html_url": "https://github.com/OlavHN", "followers_url": "https://api.github.com/users/OlavHN/followers", "following_url": "https://api.github.com/users/OlavHN/following{/other_user}", "gists_url": "https://api.github.com/users/OlavHN/gists{/gist_id}", "starred_url": "https://api.github.com/users/OlavHN/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/OlavHN/subscriptions", "organizations_url": "https://api.github.com/users/OlavHN/orgs", "repos_url": "https://api.github.com/users/OlavHN/repos", "events_url": "https://api.github.com/users/OlavHN/events{/privacy}", "received_events_url": "https://api.github.com/users/OlavHN/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-11-12T22:37:22Z", "updated_at": "2017-12-15T18:20:53Z", "closed_at": "2017-12-15T18:20:53Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Running stock tensorflow on macOS I get:</p>\n<pre><code>import tensorflow as tf\n\nprint (tf.__version__)\n\nwith open('test', 'w') as f:\n  f.write('hello\\n')\n  f.write('world\\n')\n  f.write('!\\n')\n\nfile_path = tf.constant('test')\n#file_path = 'test' # this works\n\na = tf.constant(['world', 'hello'])\n\nwith tf.Session() as sess:\n  str2i = tf.contrib.lookup.index_table_from_file(vocabulary_file=file_path)\n  sess.run(str2i.init)\n  i = str2i.lookup(a)\n  print(sess.run(i))\n\n  # Other way doesn't work\n  i2str = tf.contrib.lookup.index_to_string_table_from_file(vocabulary_file=file_path)\n  sess.run(i2str.init)\n  s = i2str.lookup(i)\n  print(sess.run(s))\n</code></pre>\n<p>results in:</p>\n<pre><code>1.4.0\n2017-11-12 23:29:51.316725: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\n[1 0]\nTraceback (most recent call last):\n  File \"test.py\", line 22, in &lt;module&gt;\n    i2str = tf.contrib.lookup.index_to_string_table_from_file(vocabulary_file=file_path)\n  File \"/Users/olanymoe/anaconda2/envs/tf3/lib/python3.5/site-packages/tensorflow/python/ops/lookup_ops.py\", line 1121, in index_to_string_table_from_file\n    if not vocabulary_file:\n  File \"/Users/olanymoe/anaconda2/envs/tf3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 528, in __bool__\n    raise TypeError(\"Using a `tf.Tensor` as a Python `bool` is not allowed. \"\nTypeError: Using a `tf.Tensor` as a Python `bool` is not allowed. Use `if t is not None:` instead of `if t:` to test if a tensor is defined, and use TensorFlow ops such as tf.cond to execute subgraphs conditioned on the value of a tensor.\n</code></pre>\n<p>Expected:</p>\n<pre><code>1.4.0\n2017-11-12 23:30:22.082767: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\n[1 0]\n[b'world' b'hello']\n</code></pre>\n<p>Due to None check at <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/lookup_ops.py#L1126\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/lookup_ops.py#L1126</a></p>\n<p>This is an issue because I can't seem to be able to make <code>index_to_string_table_from_file</code> read the vocabulary_file from a <code>GraphKeys.ASSET_FILEPATHS</code> collection when storing the graph as a saved_model</p>", "body_text": "Running stock tensorflow on macOS I get:\nimport tensorflow as tf\n\nprint (tf.__version__)\n\nwith open('test', 'w') as f:\n  f.write('hello\\n')\n  f.write('world\\n')\n  f.write('!\\n')\n\nfile_path = tf.constant('test')\n#file_path = 'test' # this works\n\na = tf.constant(['world', 'hello'])\n\nwith tf.Session() as sess:\n  str2i = tf.contrib.lookup.index_table_from_file(vocabulary_file=file_path)\n  sess.run(str2i.init)\n  i = str2i.lookup(a)\n  print(sess.run(i))\n\n  # Other way doesn't work\n  i2str = tf.contrib.lookup.index_to_string_table_from_file(vocabulary_file=file_path)\n  sess.run(i2str.init)\n  s = i2str.lookup(i)\n  print(sess.run(s))\n\nresults in:\n1.4.0\n2017-11-12 23:29:51.316725: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\n[1 0]\nTraceback (most recent call last):\n  File \"test.py\", line 22, in <module>\n    i2str = tf.contrib.lookup.index_to_string_table_from_file(vocabulary_file=file_path)\n  File \"/Users/olanymoe/anaconda2/envs/tf3/lib/python3.5/site-packages/tensorflow/python/ops/lookup_ops.py\", line 1121, in index_to_string_table_from_file\n    if not vocabulary_file:\n  File \"/Users/olanymoe/anaconda2/envs/tf3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 528, in __bool__\n    raise TypeError(\"Using a `tf.Tensor` as a Python `bool` is not allowed. \"\nTypeError: Using a `tf.Tensor` as a Python `bool` is not allowed. Use `if t is not None:` instead of `if t:` to test if a tensor is defined, and use TensorFlow ops such as tf.cond to execute subgraphs conditioned on the value of a tensor.\n\nExpected:\n1.4.0\n2017-11-12 23:30:22.082767: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\n[1 0]\n[b'world' b'hello']\n\nDue to None check at https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/lookup_ops.py#L1126\nThis is an issue because I can't seem to be able to make index_to_string_table_from_file read the vocabulary_file from a GraphKeys.ASSET_FILEPATHS collection when storing the graph as a saved_model", "body": "Running stock tensorflow on macOS I get:\r\n\r\n```\r\nimport tensorflow as tf\r\n\r\nprint (tf.__version__)\r\n\r\nwith open('test', 'w') as f:\r\n  f.write('hello\\n')\r\n  f.write('world\\n')\r\n  f.write('!\\n')\r\n\r\nfile_path = tf.constant('test')\r\n#file_path = 'test' # this works\r\n\r\na = tf.constant(['world', 'hello'])\r\n\r\nwith tf.Session() as sess:\r\n  str2i = tf.contrib.lookup.index_table_from_file(vocabulary_file=file_path)\r\n  sess.run(str2i.init)\r\n  i = str2i.lookup(a)\r\n  print(sess.run(i))\r\n\r\n  # Other way doesn't work\r\n  i2str = tf.contrib.lookup.index_to_string_table_from_file(vocabulary_file=file_path)\r\n  sess.run(i2str.init)\r\n  s = i2str.lookup(i)\r\n  print(sess.run(s))\r\n```\r\n\r\nresults in:\r\n\r\n```\r\n1.4.0\r\n2017-11-12 23:29:51.316725: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\r\n[1 0]\r\nTraceback (most recent call last):\r\n  File \"test.py\", line 22, in <module>\r\n    i2str = tf.contrib.lookup.index_to_string_table_from_file(vocabulary_file=file_path)\r\n  File \"/Users/olanymoe/anaconda2/envs/tf3/lib/python3.5/site-packages/tensorflow/python/ops/lookup_ops.py\", line 1121, in index_to_string_table_from_file\r\n    if not vocabulary_file:\r\n  File \"/Users/olanymoe/anaconda2/envs/tf3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 528, in __bool__\r\n    raise TypeError(\"Using a `tf.Tensor` as a Python `bool` is not allowed. \"\r\nTypeError: Using a `tf.Tensor` as a Python `bool` is not allowed. Use `if t is not None:` instead of `if t:` to test if a tensor is defined, and use TensorFlow ops such as tf.cond to execute subgraphs conditioned on the value of a tensor.\r\n```\r\n\r\nExpected:\r\n\r\n```\r\n1.4.0\r\n2017-11-12 23:30:22.082767: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\r\n[1 0]\r\n[b'world' b'hello']\r\n```\r\n\r\nDue to None check at https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/lookup_ops.py#L1126\r\n\r\nThis is an issue because I can't seem to be able to make `index_to_string_table_from_file` read the vocabulary_file from a `GraphKeys.ASSET_FILEPATHS` collection when storing the graph as a saved_model"}