{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/339817898", "html_url": "https://github.com/tensorflow/tensorflow/issues/13999#issuecomment-339817898", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13999", "id": 339817898, "node_id": "MDEyOklzc3VlQ29tbWVudDMzOTgxNzg5OA==", "user": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "created_at": "2017-10-26T22:21:08Z", "updated_at": "2017-10-26T22:21:08Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Interestingly, the leak seems to be plugged if you replace the line:</p>\n<div class=\"highlight highlight-source-python\"><pre>        _ <span class=\"pl-k\">=</span> sess.run(images)</pre></div>\n<p>...with the following line:</p>\n<div class=\"highlight highlight-source-python\"><pre>        _ <span class=\"pl-k\">=</span> sess.run([images, labels])</pre></div>\n<p>I suspect it is not a coincidence that <code>labels</code> is a <code>tf.SparseTensor</code>, because <code>tf.train.shuffle_batch()</code> handles these by storing them in a buffer, replacing them with a key (to pass through the batch queue), and then removing them from the buffer when the key is emitted from the batch queue.</p>\n<p>Perhaps if you don't use the value, the remove-from-buffer code doesn't get triggered?</p>\n<p>Assigning to <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1794715\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ebrevdo\">@ebrevdo</a>, since he knows that part of the code best.</p>", "body_text": "Interestingly, the leak seems to be plugged if you replace the line:\n        _ = sess.run(images)\n...with the following line:\n        _ = sess.run([images, labels])\nI suspect it is not a coincidence that labels is a tf.SparseTensor, because tf.train.shuffle_batch() handles these by storing them in a buffer, replacing them with a key (to pass through the batch queue), and then removing them from the buffer when the key is emitted from the batch queue.\nPerhaps if you don't use the value, the remove-from-buffer code doesn't get triggered?\nAssigning to @ebrevdo, since he knows that part of the code best.", "body": "Interestingly, the leak seems to be plugged if you replace the line:\r\n\r\n```python\r\n        _ = sess.run(images)\r\n```\r\n\r\n...with the following line:\r\n\r\n```python\r\n        _ = sess.run([images, labels])\r\n```\r\n\r\nI suspect it is not a coincidence that `labels` is a `tf.SparseTensor`, because `tf.train.shuffle_batch()` handles these by storing them in a buffer, replacing them with a key (to pass through the batch queue), and then removing them from the buffer when the key is emitted from the batch queue.\r\n\r\nPerhaps if you don't use the value, the remove-from-buffer code doesn't get triggered?\r\n\r\nAssigning to @ebrevdo, since he knows that part of the code best."}