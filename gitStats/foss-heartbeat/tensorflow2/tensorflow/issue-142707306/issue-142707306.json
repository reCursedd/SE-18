{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1581", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1581/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1581/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1581/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/1581", "id": 142707306, "node_id": "MDU6SXNzdWUxNDI3MDczMDY=", "number": 1581, "title": "Odd error message for empty session run with queues", "user": {"login": "lukemetz", "id": 1248454, "node_id": "MDQ6VXNlcjEyNDg0NTQ=", "avatar_url": "https://avatars3.githubusercontent.com/u/1248454?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lukemetz", "html_url": "https://github.com/lukemetz", "followers_url": "https://api.github.com/users/lukemetz/followers", "following_url": "https://api.github.com/users/lukemetz/following{/other_user}", "gists_url": "https://api.github.com/users/lukemetz/gists{/gist_id}", "starred_url": "https://api.github.com/users/lukemetz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lukemetz/subscriptions", "organizations_url": "https://api.github.com/users/lukemetz/orgs", "repos_url": "https://api.github.com/users/lukemetz/repos", "events_url": "https://api.github.com/users/lukemetz/events{/privacy}", "received_events_url": "https://api.github.com/users/lukemetz/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-03-22T16:42:41Z", "updated_at": "2016-03-22T22:05:07Z", "closed_at": "2016-03-22T22:05:07Z", "author_association": "NONE", "body_html": "<p>I have encountered a counter intuative error when working with queues and accidental <code>sess.run([])</code>.<br>\nThis is a stretch, but possibly related to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"136149303\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/1277\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/1277/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/1277\">#1277</a> where batch norm updates are being run but there is no batch norm in the graph.</p>\n<h3>Environment info</h3>\n<p>Operating System: Ubuntu 14.04, tf version (<a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/63409bd23facad471973b110df998782c0e19c06/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/63409bd23facad471973b110df998782c0e19c06\"><tt>63409bd</tt></a>) with cuda.</p>\n<h3>Steps to reproduce</h3>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\n<span class=\"pl-c1\">BREAK_ME</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">False</span>\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">get_iter</span>():\n    img_list <span class=\"pl-k\">=</span> [(tf.zeros((<span class=\"pl-c1\">12</span>,)), ), (tf.zeros((<span class=\"pl-c1\">12</span>, )), )]\n    xx <span class=\"pl-k\">=</span> tf.train.shuffle_batch_join(\n        img_list, <span class=\"pl-v\">batch_size</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">5</span>,\n        <span class=\"pl-v\">capacity</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">1000</span> <span class=\"pl-k\">+</span> <span class=\"pl-c1\">3</span> <span class=\"pl-k\">*</span> <span class=\"pl-c1\">5</span>,\n        <span class=\"pl-v\">min_after_dequeue</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">1000</span>)\n    <span class=\"pl-k\">return</span> xx\n\n<span class=\"pl-k\">if</span> <span class=\"pl-c1\">BREAK_ME</span>:\n    w <span class=\"pl-k\">=</span> get_iter()\n\nsess <span class=\"pl-k\">=</span> tf.Session()\ncoord <span class=\"pl-k\">=</span> tf.train.Coordinator()\nthreads <span class=\"pl-k\">=</span> tf.train.start_queue_runners(<span class=\"pl-v\">sess</span><span class=\"pl-k\">=</span>sess, <span class=\"pl-v\">coord</span><span class=\"pl-k\">=</span>coord)\n\nsess.run([])</pre></div>\n<p>As expected, when <code>BREAK_ME</code> is false I get:<br>\n<code>RuntimeError: The Session graph is empty.  Add operations to the graph before calling run().</code></p>\n<p>When <code>BREAK_ME</code> is true, enabling the creation of a queue I get the following:</p>\n<pre><code>Traceback (most recent call last):\n  File \"test.py\", line 20, in &lt;module&gt;\n    sess.run([])\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/client/session.py\", line 332, in run\n    result = self._run(None, fetches, feed_dict, options_ptr, run_outputs_ptr)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/client/session.py\", line 537, in _run\n    feed_dict_string, options, run_outputs)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/client/session.py\", line 599, in _do_run\n    target_list, options, run_outputs)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/client/session.py\", line 621, in _do_call\n    e.code)\ntensorflow.python.framework.errors.OutOfRangeError: RandomShuffleQueue '_0_shuffle_batch_join/random_shuffle_queue' is closed and has insufficient elements (requested 5, current size 0)\n     [[Node: shuffle_batch_join = QueueDequeueMany[component_types=[DT_FLOAT], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch_join/random_shuffle_queue, shuffle_batch_join/n/_8)]]\nCaused by op u'shuffle_batch_join', defined at:\n  File \"test.py\", line 14, in &lt;module&gt;\n    w = get_iter()\n  File \"test.py\", line 10, in get_iter\n    min_after_dequeue=1000)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/training/input.py\", line 770, in shuffle_batch_join\n    dequeued = queue.dequeue_many(batch_size, name=name)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/ops/data_flow_ops.py\", line 301, in dequeue_many\n    self._queue_ref, n, self._dtypes, name=name)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/ops/gen_data_flow_ops.py\", line 359, in _queue_dequeue_many\n    timeout_ms=timeout_ms, name=name)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/ops/op_def_library.py\", line 655, in apply_op\n    op_def=op_def)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/framework/ops.py\", line 2104, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/framework/ops.py\", line 1129, in __init__\n    self._traceback = _extract_stack()\n</code></pre>", "body_text": "I have encountered a counter intuative error when working with queues and accidental sess.run([]).\nThis is a stretch, but possibly related to #1277 where batch norm updates are being run but there is no batch norm in the graph.\nEnvironment info\nOperating System: Ubuntu 14.04, tf version (63409bd) with cuda.\nSteps to reproduce\nimport tensorflow as tf\n\nBREAK_ME = False\n\ndef get_iter():\n    img_list = [(tf.zeros((12,)), ), (tf.zeros((12, )), )]\n    xx = tf.train.shuffle_batch_join(\n        img_list, batch_size=5,\n        capacity=1000 + 3 * 5,\n        min_after_dequeue=1000)\n    return xx\n\nif BREAK_ME:\n    w = get_iter()\n\nsess = tf.Session()\ncoord = tf.train.Coordinator()\nthreads = tf.train.start_queue_runners(sess=sess, coord=coord)\n\nsess.run([])\nAs expected, when BREAK_ME is false I get:\nRuntimeError: The Session graph is empty.  Add operations to the graph before calling run().\nWhen BREAK_ME is true, enabling the creation of a queue I get the following:\nTraceback (most recent call last):\n  File \"test.py\", line 20, in <module>\n    sess.run([])\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/client/session.py\", line 332, in run\n    result = self._run(None, fetches, feed_dict, options_ptr, run_outputs_ptr)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/client/session.py\", line 537, in _run\n    feed_dict_string, options, run_outputs)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/client/session.py\", line 599, in _do_run\n    target_list, options, run_outputs)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/client/session.py\", line 621, in _do_call\n    e.code)\ntensorflow.python.framework.errors.OutOfRangeError: RandomShuffleQueue '_0_shuffle_batch_join/random_shuffle_queue' is closed and has insufficient elements (requested 5, current size 0)\n     [[Node: shuffle_batch_join = QueueDequeueMany[component_types=[DT_FLOAT], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch_join/random_shuffle_queue, shuffle_batch_join/n/_8)]]\nCaused by op u'shuffle_batch_join', defined at:\n  File \"test.py\", line 14, in <module>\n    w = get_iter()\n  File \"test.py\", line 10, in get_iter\n    min_after_dequeue=1000)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/training/input.py\", line 770, in shuffle_batch_join\n    dequeued = queue.dequeue_many(batch_size, name=name)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/ops/data_flow_ops.py\", line 301, in dequeue_many\n    self._queue_ref, n, self._dtypes, name=name)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/ops/gen_data_flow_ops.py\", line 359, in _queue_dequeue_many\n    timeout_ms=timeout_ms, name=name)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/ops/op_def_library.py\", line 655, in apply_op\n    op_def=op_def)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/framework/ops.py\", line 2104, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/framework/ops.py\", line 1129, in __init__\n    self._traceback = _extract_stack()", "body": "I have encountered a counter intuative error when working with queues and accidental `sess.run([])`.\nThis is a stretch, but possibly related to #1277 where batch norm updates are being run but there is no batch norm in the graph. \n### Environment info\n\nOperating System: Ubuntu 14.04, tf version (63409bd23facad471973b110df998782c0e19c06) with cuda.\n### Steps to reproduce\n\n``` python\nimport tensorflow as tf\n\nBREAK_ME = False\n\ndef get_iter():\n    img_list = [(tf.zeros((12,)), ), (tf.zeros((12, )), )]\n    xx = tf.train.shuffle_batch_join(\n        img_list, batch_size=5,\n        capacity=1000 + 3 * 5,\n        min_after_dequeue=1000)\n    return xx\n\nif BREAK_ME:\n    w = get_iter()\n\nsess = tf.Session()\ncoord = tf.train.Coordinator()\nthreads = tf.train.start_queue_runners(sess=sess, coord=coord)\n\nsess.run([])\n```\n\nAs expected, when `BREAK_ME` is false I get:\n`RuntimeError: The Session graph is empty.  Add operations to the graph before calling run().`\n\nWhen `BREAK_ME` is true, enabling the creation of a queue I get the following:\n\n```\nTraceback (most recent call last):\n  File \"test.py\", line 20, in <module>\n    sess.run([])\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/client/session.py\", line 332, in run\n    result = self._run(None, fetches, feed_dict, options_ptr, run_outputs_ptr)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/client/session.py\", line 537, in _run\n    feed_dict_string, options, run_outputs)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/client/session.py\", line 599, in _do_run\n    target_list, options, run_outputs)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/client/session.py\", line 621, in _do_call\n    e.code)\ntensorflow.python.framework.errors.OutOfRangeError: RandomShuffleQueue '_0_shuffle_batch_join/random_shuffle_queue' is closed and has insufficient elements (requested 5, current size 0)\n     [[Node: shuffle_batch_join = QueueDequeueMany[component_types=[DT_FLOAT], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch_join/random_shuffle_queue, shuffle_batch_join/n/_8)]]\nCaused by op u'shuffle_batch_join', defined at:\n  File \"test.py\", line 14, in <module>\n    w = get_iter()\n  File \"test.py\", line 10, in get_iter\n    min_after_dequeue=1000)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/training/input.py\", line 770, in shuffle_batch_join\n    dequeued = queue.dequeue_many(batch_size, name=name)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/ops/data_flow_ops.py\", line 301, in dequeue_many\n    self._queue_ref, n, self._dtypes, name=name)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/ops/gen_data_flow_ops.py\", line 359, in _queue_dequeue_many\n    timeout_ms=timeout_ms, name=name)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/ops/op_def_library.py\", line 655, in apply_op\n    op_def=op_def)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/framework/ops.py\", line 2104, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/indico/Apps/tensorflow/_python_build/tensorflow/python/framework/ops.py\", line 1129, in __init__\n    self._traceback = _extract_stack()\n```\n"}