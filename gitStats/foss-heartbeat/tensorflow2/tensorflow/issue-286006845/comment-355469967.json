{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/355469967", "html_url": "https://github.com/tensorflow/tensorflow/issues/15849#issuecomment-355469967", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15849", "id": 355469967, "node_id": "MDEyOklzc3VlQ29tbWVudDM1NTQ2OTk2Nw==", "user": {"login": "ugmurthy", "id": 2167785, "node_id": "MDQ6VXNlcjIxNjc3ODU=", "avatar_url": "https://avatars0.githubusercontent.com/u/2167785?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ugmurthy", "html_url": "https://github.com/ugmurthy", "followers_url": "https://api.github.com/users/ugmurthy/followers", "following_url": "https://api.github.com/users/ugmurthy/following{/other_user}", "gists_url": "https://api.github.com/users/ugmurthy/gists{/gist_id}", "starred_url": "https://api.github.com/users/ugmurthy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ugmurthy/subscriptions", "organizations_url": "https://api.github.com/users/ugmurthy/orgs", "repos_url": "https://api.github.com/users/ugmurthy/repos", "events_url": "https://api.github.com/users/ugmurthy/events{/privacy}", "received_events_url": "https://api.github.com/users/ugmurthy/received_events", "type": "User", "site_admin": false}, "created_at": "2018-01-05T04:25:19Z", "updated_at": "2018-01-05T04:25:19Z", "author_association": "NONE", "body_html": "<p>Have I written custom code : N/A<br>\nOS Platform and Distribution: UBUNTU LTS 16.04<br>\nTensorFlow installed from : source cloned from <a href=\"https://github.com/tensorflow/tensorflow\">https://github.com/tensorflow/tensorflow</a><br>\nTensorFlow version : N/A<br>\nBazel version : 0.9.0<br>\nCUDA/cuDNN version : N/A<br>\nGPU model and memory : N/A<br>\nExact command to reproduce : see below the shell script I used to build<br>\n`<br>\n#!/bin/bash<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"115896656\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/3\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/3/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/3\">#3</a>/Jan/2018<br>\n#Murthy made changes to the section marked below</p>\n<p>#original Author: Sasha Nikiforov<br>\n#source of inspiration<br>\n#<a href=\"https://stackoverflow.com/questions/41293077/how-to-compile-tensorflow-with-sse4-2-and-avx-instructions\" rel=\"nofollow\">https://stackoverflow.com/questions/41293077/how-to-compile-tensorflow-with-sse4-2-and-avx-instructions</a></p>\n<p>#check if VirtuelEnv activated<br>\nif [ -z \"$VIRTUAL_ENV\" ]; then<br>\necho \"VirtualEnv is not activated\"<br>\nexit -1<br>\nfi</p>\n<p>VENV_BIN=$VIRTUAL_ENV/bin<br>\nVENV_LIB=$VIRTUAL_ENV/lib</p>\n<p>#bazel tf needs these env vars<br>\nexport PYTHON_BIN_PATH=$VENV_BIN/python<br>\nexport PYTHON_LIB_PATH=$VENV_LIB/<code>ls $VENV_LIB | grep python</code></p>\n<p>echo Python bin path: $PYTHON_BIN_PATH<br>\necho Python lib path: $PYTHON_LIB_PATH</p>\n<p>#changes made by Murthy start here<br>\nraw_cpu_flags=<code>sudo lscpu  | grep 'Flags'</code><br>\nCOPT=\"--copt=-march=native\"</p>\n<p>for cpu_feature in $raw_cpu_flags<br>\ndo<br>\ncase \"$cpu_feature\" in<br>\n\"ssse3\" | \"fma\" | \"cx16\" | \"popcnt\" | \"maes\")<br>\nCOPT+=\" --copt=-m$cpu_feature\"<br>\n;;<br>\n\"avx\")<br>\nCOPT+=\" --copt=-mavx\"<br>\n;;<br>\n\"sse4_1\")<br>\nCOPT+=\" --copt=-msse4.1\"<br>\n;;<br>\n\"sse4_2\")<br>\nCOPT+=\" --copt=-msse4.2\"<br>\n;;<br>\n*)<br>\n# noop<br>\n;;<br>\nesac<br>\ndone<br>\necho Options: $COPT<br>\n#end of section within with changes were made by murthy<br>\nbazel clean<br>\n./configure<br>\nbazel build --verbose_failures -c opt $COPT -k //tensorflow/tools/pip_package:build_pip_package<br>\nbazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg</p>\n<p>#pip install --upgrade /tmp/tensorflow_pkg/<code>ls /tmp/tensorflow_pkg/ | grep tensorflow</code></p>\n<p>`</p>", "body_text": "Have I written custom code : N/A\nOS Platform and Distribution: UBUNTU LTS 16.04\nTensorFlow installed from : source cloned from https://github.com/tensorflow/tensorflow\nTensorFlow version : N/A\nBazel version : 0.9.0\nCUDA/cuDNN version : N/A\nGPU model and memory : N/A\nExact command to reproduce : see below the shell script I used to build\n`\n#!/bin/bash\n#3/Jan/2018\n#Murthy made changes to the section marked below\n#original Author: Sasha Nikiforov\n#source of inspiration\n#https://stackoverflow.com/questions/41293077/how-to-compile-tensorflow-with-sse4-2-and-avx-instructions\n#check if VirtuelEnv activated\nif [ -z \"$VIRTUAL_ENV\" ]; then\necho \"VirtualEnv is not activated\"\nexit -1\nfi\nVENV_BIN=$VIRTUAL_ENV/bin\nVENV_LIB=$VIRTUAL_ENV/lib\n#bazel tf needs these env vars\nexport PYTHON_BIN_PATH=$VENV_BIN/python\nexport PYTHON_LIB_PATH=$VENV_LIB/ls $VENV_LIB | grep python\necho Python bin path: $PYTHON_BIN_PATH\necho Python lib path: $PYTHON_LIB_PATH\n#changes made by Murthy start here\nraw_cpu_flags=sudo lscpu  | grep 'Flags'\nCOPT=\"--copt=-march=native\"\nfor cpu_feature in $raw_cpu_flags\ndo\ncase \"$cpu_feature\" in\n\"ssse3\" | \"fma\" | \"cx16\" | \"popcnt\" | \"maes\")\nCOPT+=\" --copt=-m$cpu_feature\"\n;;\n\"avx\")\nCOPT+=\" --copt=-mavx\"\n;;\n\"sse4_1\")\nCOPT+=\" --copt=-msse4.1\"\n;;\n\"sse4_2\")\nCOPT+=\" --copt=-msse4.2\"\n;;\n*)\n# noop\n;;\nesac\ndone\necho Options: $COPT\n#end of section within with changes were made by murthy\nbazel clean\n./configure\nbazel build --verbose_failures -c opt $COPT -k //tensorflow/tools/pip_package:build_pip_package\nbazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg\n#pip install --upgrade /tmp/tensorflow_pkg/ls /tmp/tensorflow_pkg/ | grep tensorflow\n`", "body": "Have I written custom code : N/A\r\nOS Platform and Distribution: UBUNTU LTS 16.04\r\nTensorFlow installed from : source cloned from https://github.com/tensorflow/tensorflow\r\nTensorFlow version : N/A\r\nBazel version : 0.9.0\r\nCUDA/cuDNN version : N/A\r\nGPU model and memory : N/A\r\nExact command to reproduce : see below the shell script I used to build\r\n`\r\n#!/bin/bash\r\n#3/Jan/2018\r\n#Murthy made changes to the section marked below\r\n\r\n#original Author: Sasha Nikiforov\r\n#source of inspiration\r\n#https://stackoverflow.com/questions/41293077/how-to-compile-tensorflow-with-sse4-2-and-avx-instructions\r\n\r\n#check if VirtuelEnv activated\r\nif [ -z \"$VIRTUAL_ENV\" ]; then\r\n\techo \"VirtualEnv is not activated\"\r\n\texit -1\r\nfi\r\n\r\nVENV_BIN=$VIRTUAL_ENV/bin\r\nVENV_LIB=$VIRTUAL_ENV/lib\r\n\r\n#bazel tf needs these env vars\r\nexport PYTHON_BIN_PATH=$VENV_BIN/python\r\nexport PYTHON_LIB_PATH=$VENV_LIB/`ls $VENV_LIB | grep python`\r\n\r\necho Python bin path: $PYTHON_BIN_PATH\r\necho Python lib path: $PYTHON_LIB_PATH\r\n\r\n#changes made by Murthy start here\r\nraw_cpu_flags=`sudo lscpu  | grep 'Flags'`\r\nCOPT=\"--copt=-march=native\"\r\n\r\nfor cpu_feature in $raw_cpu_flags\r\ndo\r\n\tcase \"$cpu_feature\" in\r\n\t\t\"ssse3\" | \"fma\" | \"cx16\" | \"popcnt\" | \"maes\")\r\n\t\t    COPT+=\" --copt=-m$cpu_feature\"\r\n\t\t;;\r\n\t\t\"avx\")\r\n\t\t    COPT+=\" --copt=-mavx\"\r\n\t\t;;\r\n\t\t\"sse4_1\")\r\n\t\t    COPT+=\" --copt=-msse4.1\"\r\n\t\t;;\r\n\t\t\"sse4_2\")\r\n\t\t    COPT+=\" --copt=-msse4.2\"\r\n\t\t;;\r\n\t\t*)\r\n\t\t\t# noop\r\n\t\t;;\r\n\tesac\r\ndone\r\necho Options: $COPT\r\n#end of section within with changes were made by murthy\r\nbazel clean\r\n./configure\r\nbazel build --verbose_failures -c opt $COPT -k //tensorflow/tools/pip_package:build_pip_package\r\nbazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg\r\n\r\n#pip install --upgrade /tmp/tensorflow_pkg/`ls /tmp/tensorflow_pkg/ | grep tensorflow`\r\n\r\n`"}