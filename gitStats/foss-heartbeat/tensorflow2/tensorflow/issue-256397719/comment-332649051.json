{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/332649051", "html_url": "https://github.com/tensorflow/tensorflow/pull/12922#issuecomment-332649051", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12922", "id": 332649051, "node_id": "MDEyOklzc3VlQ29tbWVudDMzMjY0OTA1MQ==", "user": {"login": "cloudbank", "id": 2288294, "node_id": "MDQ6VXNlcjIyODgyOTQ=", "avatar_url": "https://avatars3.githubusercontent.com/u/2288294?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cloudbank", "html_url": "https://github.com/cloudbank", "followers_url": "https://api.github.com/users/cloudbank/followers", "following_url": "https://api.github.com/users/cloudbank/following{/other_user}", "gists_url": "https://api.github.com/users/cloudbank/gists{/gist_id}", "starred_url": "https://api.github.com/users/cloudbank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cloudbank/subscriptions", "organizations_url": "https://api.github.com/users/cloudbank/orgs", "repos_url": "https://api.github.com/users/cloudbank/repos", "events_url": "https://api.github.com/users/cloudbank/events{/privacy}", "received_events_url": "https://api.github.com/users/cloudbank/received_events", "type": "User", "site_admin": false}, "created_at": "2017-09-27T20:42:41Z", "updated_at": "2017-09-27T20:58:19Z", "author_association": "NONE", "body_html": "<div class=\"email-fragment\"><a class=\"user-mention\" href=\"https://github.com/andrewharp\">@andrewharp</a>\n-no compression either using gradle or bazel leads to OOM.  It is\nunreasonable I think to not make every effort to compress such a large file\nin a 100MB limit and kind of violates best practices.  I tried to map the\nuncompressed file directly and ran out of memory right away.  I am building\nthe java and native libraries with bazel and then using them in a gradle\nbuilt app.  We want people to build stuff with it, right?\n-using the res/raw and cache files dir doesn't run out of memory.  It might\nrun a little faster than using assets and cache since res are indexed.  I\nwill do a benchmark for both and get back to you.  If it is not a big\ndifference and you really want assets dir I can move it back there.\n-I have not given up on trying to map the file without copying but\n  1. every SO thread, and advice about this says it is not possible from\nexpert level people including Pete Warden and Mark Murphy.\n  2. I have tried every reasonable approach without getting into a hack so\nit might be best to start with this approach and if I, or someone else\nstumbles upon a better solution, it can be improved.  Given the natural way\nandroid is set up right now it seems improbable that copying can be avoided.</div>\n<span class=\"email-hidden-toggle\"><a href=\"#\">\u2026</a></span><div class=\"email-hidden-reply\">\n<div class=\"email-quoted-reply\">On Wed, Sep 27, 2017 at 11:34 AM, Andrew Harp ***@***.***&gt; wrote:\n <a class=\"user-mention\" href=\"https://github.com/cloudbank\">@cloudbank</a> &lt;<a href=\"https://github.com/cloudbank\">https://github.com/cloudbank</a>&gt; I still have reservations about\n limiting this to a res/raw implementation, would like the questions\n mentioned before clarified:\n\n    - Does noCompressExtensions not solve the compression problem for\n    assets/?\n    - Why does it give you an OOM error when mapping from the cache dir,\n    but not from assets/?\n\n \u2014\n You are receiving this because you were mentioned.\n Reply to this email directly, view it on GitHub\n &lt;<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"256397719\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/12922\" href=\"https://github.com/tensorflow/tensorflow/pull/12922#issuecomment-332613959\">#12922 (comment)</a>&gt;,\n or mute the thread\n &lt;<a href=\"https://github.com/notifications/unsubscribe-auth/ACLqptmrY2axZzCVTdzDA96kJ1J_DCMWks5smpU2gaJpZM4PRzkg\">https://github.com/notifications/unsubscribe-auth/ACLqptmrY2axZzCVTdzDA96kJ1J_DCMWks5smpU2gaJpZM4PRzkg</a>&gt;\n .\n</div>\n<div class=\"email-fragment\"></div>\n</div>", "body_text": "@andrewharp\n-no compression either using gradle or bazel leads to OOM.  It is\nunreasonable I think to not make every effort to compress such a large file\nin a 100MB limit and kind of violates best practices.  I tried to map the\nuncompressed file directly and ran out of memory right away.  I am building\nthe java and native libraries with bazel and then using them in a gradle\nbuilt app.  We want people to build stuff with it, right?\n-using the res/raw and cache files dir doesn't run out of memory.  It might\nrun a little faster than using assets and cache since res are indexed.  I\nwill do a benchmark for both and get back to you.  If it is not a big\ndifference and you really want assets dir I can move it back there.\n-I have not given up on trying to map the file without copying but\n  1. every SO thread, and advice about this says it is not possible from\nexpert level people including Pete Warden and Mark Murphy.\n  2. I have tried every reasonable approach without getting into a hack so\nit might be best to start with this approach and if I, or someone else\nstumbles upon a better solution, it can be improved.  Given the natural way\nandroid is set up right now it seems improbable that copying can be avoided.\n\u2026\nOn Wed, Sep 27, 2017 at 11:34 AM, Andrew Harp ***@***.***> wrote:\n @cloudbank <https://github.com/cloudbank> I still have reservations about\n limiting this to a res/raw implementation, would like the questions\n mentioned before clarified:\n\n    - Does noCompressExtensions not solve the compression problem for\n    assets/?\n    - Why does it give you an OOM error when mapping from the cache dir,\n    but not from assets/?\n\n \u2014\n You are receiving this because you were mentioned.\n Reply to this email directly, view it on GitHub\n <#12922 (comment)>,\n or mute the thread\n <https://github.com/notifications/unsubscribe-auth/ACLqptmrY2axZzCVTdzDA96kJ1J_DCMWks5smpU2gaJpZM4PRzkg>\n .", "body": "@andrewharp\r\n-no compression either using gradle or bazel leads to OOM.  It is\r\nunreasonable I think to not make every effort to compress such a large file\r\nin a 100MB limit and kind of violates best practices.  I tried to map the\r\nuncompressed file directly and ran out of memory right away.  I am building\r\nthe java and native libraries with bazel and then using them in a gradle\r\nbuilt app.  We want people to build stuff with it, right?\r\n-using the res/raw and cache files dir doesn't run out of memory.  It might\r\nrun a little faster than using assets and cache since res are indexed.  I\r\nwill do a benchmark for both and get back to you.  If it is not a big\r\ndifference and you really want assets dir I can move it back there.\r\n-I have not given up on trying to map the file without copying but\r\n  1. every SO thread, and advice about this says it is not possible from\r\nexpert level people including Pete Warden and Mark Murphy.\r\n  2. I have tried every reasonable approach without getting into a hack so\r\nit might be best to start with this approach and if I, or someone else\r\nstumbles upon a better solution, it can be improved.  Given the natural way\r\nandroid is set up right now it seems improbable that copying can be avoided.\r\n\r\n\r\n\r\n\r\n\r\nOn Wed, Sep 27, 2017 at 11:34 AM, Andrew Harp <notifications@github.com>\r\nwrote:\r\n\r\n> @cloudbank <https://github.com/cloudbank> I still have reservations about\r\n> limiting this to a res/raw implementation, would like the questions\r\n> mentioned before clarified:\r\n>\r\n>    - Does noCompressExtensions not solve the compression problem for\r\n>    assets/?\r\n>    - Why does it give you an OOM error when mapping from the cache dir,\r\n>    but not from assets/?\r\n>\r\n> \u2014\r\n> You are receiving this because you were mentioned.\r\n> Reply to this email directly, view it on GitHub\r\n> <https://github.com/tensorflow/tensorflow/pull/12922#issuecomment-332613959>,\r\n> or mute the thread\r\n> <https://github.com/notifications/unsubscribe-auth/ACLqptmrY2axZzCVTdzDA96kJ1J_DCMWks5smpU2gaJpZM4PRzkg>\r\n> .\r\n>\r\n"}