{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15485", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15485/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15485/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15485/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15485", "id": 283302364, "node_id": "MDU6SXNzdWUyODMzMDIzNjQ=", "number": 15485, "title": "Possible Bug with GPU: matmul_op.cc ", "user": {"login": "thzois", "id": 12307950, "node_id": "MDQ6VXNlcjEyMzA3OTUw", "avatar_url": "https://avatars0.githubusercontent.com/u/12307950?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thzois", "html_url": "https://github.com/thzois", "followers_url": "https://api.github.com/users/thzois/followers", "following_url": "https://api.github.com/users/thzois/following{/other_user}", "gists_url": "https://api.github.com/users/thzois/gists{/gist_id}", "starred_url": "https://api.github.com/users/thzois/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thzois/subscriptions", "organizations_url": "https://api.github.com/users/thzois/orgs", "repos_url": "https://api.github.com/users/thzois/repos", "events_url": "https://api.github.com/users/thzois/events{/privacy}", "received_events_url": "https://api.github.com/users/thzois/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-12-19T17:00:18Z", "updated_at": "2017-12-23T00:20:22Z", "closed_at": "2017-12-23T00:20:22Z", "author_association": "NONE", "body_html": "<p>Hello,</p>\n<p>I am trying to run a matrix multiplication on GPU. This is the code i am running on python.</p>\n<pre><code>import tensorflow as tf\n\nwith tf.device('/gpu:0'):\n  a = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[2, 3], name='a')\n  b = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[3, 2], name='b')\n  c = tf.matmul(a, b)\n\nsess = tf.Session(config=tf.ConfigProto(log_device_placement=True))\nprint(sess.run(c))\n</code></pre>\n<p>In the matmul_op.cc i have added an <code>std::cout &lt;&lt; \"Device: \" &lt;&lt; ctx-&gt;device()-&gt;name &lt;&lt; endl;</code> in function <code>Compute</code> that is on line 456. The weird thing is that this <code>cout</code> prints: <code>Device:  /job:localhost/replica:0/task:0/device:CPU:0 </code> while the log_device_placement from the session reports:</p>\n<pre><code>2017-12-19 18:50:35.432196: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1030] Found device 0 with properties: \nname: GeForce GT 720 major: 3 minor: 5 memoryClockRate(GHz): 0.797\npciBusID: 0000:82:00.0\ntotalMemory: 1.95GiB freeMemory: 1.95GiB\n2017-12-19 18:50:35.432273: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1120] Creating TensorFlow device (/device:GPU:0) -&gt; (device: 0, name: GeForce GT 720, pci bus id: 0000:82:00.0, compute capability: 3.5)\nDevice mapping:\n/job:localhost/replica:0/task:0/device:GPU:0 -&gt; device: 0, name: GeForce GT 720, pci bus id: 0000:82:00.0, compute capability: 3.5\n2017-12-19 18:50:35.455437: I tensorflow/core/common_runtime/direct_session.cc:300] Device mapping:\n/job:localhost/replica:0/task:0/device:GPU:0 -&gt; device: 0, name: GeForce GT 720, pci bus id: 0000:82:00.0, compute capability: 3.5\n\nTensor(\"MatMul:0\", shape=(2, 2), dtype=float32, device=/device:GPU:0)\nMatMul: (MatMul): /job:localhost/replica:0/task:0/device:GPU:0\n2017-12-19 18:50:35.456469: I tensorflow/core/common_runtime/placer.cc:874] MatMul: (MatMul)/job:localhost/replica:0/task:0/device:GPU:0\nb: (Const): /job:localhost/replica:0/task:0/device:GPU:0\n2017-12-19 18:50:35.456525: I tensorflow/core/common_runtime/placer.cc:874] b: (Const)/job:localhost/replica:0/task:0/device:GPU:0\na: (Const): /job:localhost/replica:0/task:0/device:GPU:0\n2017-12-19 18:50:35.456555: I tensorflow/core/common_runtime/placer.cc:874] a: (Const)/job:localhost/replica:0/task:0/device:GPU:0\n</code></pre>\n<p>I have also checked the <code>bool USE_CUBLAS</code> and it has value 0, in function <code>Compute</code>. Is it a possible bug or i am doing something wrong?</p>", "body_text": "Hello,\nI am trying to run a matrix multiplication on GPU. This is the code i am running on python.\nimport tensorflow as tf\n\nwith tf.device('/gpu:0'):\n  a = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[2, 3], name='a')\n  b = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[3, 2], name='b')\n  c = tf.matmul(a, b)\n\nsess = tf.Session(config=tf.ConfigProto(log_device_placement=True))\nprint(sess.run(c))\n\nIn the matmul_op.cc i have added an std::cout << \"Device: \" << ctx->device()->name << endl; in function Compute that is on line 456. The weird thing is that this cout prints: Device:  /job:localhost/replica:0/task:0/device:CPU:0  while the log_device_placement from the session reports:\n2017-12-19 18:50:35.432196: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1030] Found device 0 with properties: \nname: GeForce GT 720 major: 3 minor: 5 memoryClockRate(GHz): 0.797\npciBusID: 0000:82:00.0\ntotalMemory: 1.95GiB freeMemory: 1.95GiB\n2017-12-19 18:50:35.432273: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1120] Creating TensorFlow device (/device:GPU:0) -> (device: 0, name: GeForce GT 720, pci bus id: 0000:82:00.0, compute capability: 3.5)\nDevice mapping:\n/job:localhost/replica:0/task:0/device:GPU:0 -> device: 0, name: GeForce GT 720, pci bus id: 0000:82:00.0, compute capability: 3.5\n2017-12-19 18:50:35.455437: I tensorflow/core/common_runtime/direct_session.cc:300] Device mapping:\n/job:localhost/replica:0/task:0/device:GPU:0 -> device: 0, name: GeForce GT 720, pci bus id: 0000:82:00.0, compute capability: 3.5\n\nTensor(\"MatMul:0\", shape=(2, 2), dtype=float32, device=/device:GPU:0)\nMatMul: (MatMul): /job:localhost/replica:0/task:0/device:GPU:0\n2017-12-19 18:50:35.456469: I tensorflow/core/common_runtime/placer.cc:874] MatMul: (MatMul)/job:localhost/replica:0/task:0/device:GPU:0\nb: (Const): /job:localhost/replica:0/task:0/device:GPU:0\n2017-12-19 18:50:35.456525: I tensorflow/core/common_runtime/placer.cc:874] b: (Const)/job:localhost/replica:0/task:0/device:GPU:0\na: (Const): /job:localhost/replica:0/task:0/device:GPU:0\n2017-12-19 18:50:35.456555: I tensorflow/core/common_runtime/placer.cc:874] a: (Const)/job:localhost/replica:0/task:0/device:GPU:0\n\nI have also checked the bool USE_CUBLAS and it has value 0, in function Compute. Is it a possible bug or i am doing something wrong?", "body": "Hello,\r\n\r\nI am trying to run a matrix multiplication on GPU. This is the code i am running on python. \r\n```\r\nimport tensorflow as tf\r\n\r\nwith tf.device('/gpu:0'):\r\n  a = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[2, 3], name='a')\r\n  b = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[3, 2], name='b')\r\n  c = tf.matmul(a, b)\r\n\r\nsess = tf.Session(config=tf.ConfigProto(log_device_placement=True))\r\nprint(sess.run(c))\r\n```\r\n\r\nIn the matmul_op.cc i have added an ```std::cout << \"Device: \" << ctx->device()->name << endl;``` in function ```Compute``` that is on line 456. The weird thing is that this ```cout``` prints: ```Device:  /job:localhost/replica:0/task:0/device:CPU:0 ``` while the log_device_placement from the session reports: \r\n```\r\n2017-12-19 18:50:35.432196: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1030] Found device 0 with properties: \r\nname: GeForce GT 720 major: 3 minor: 5 memoryClockRate(GHz): 0.797\r\npciBusID: 0000:82:00.0\r\ntotalMemory: 1.95GiB freeMemory: 1.95GiB\r\n2017-12-19 18:50:35.432273: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1120] Creating TensorFlow device (/device:GPU:0) -> (device: 0, name: GeForce GT 720, pci bus id: 0000:82:00.0, compute capability: 3.5)\r\nDevice mapping:\r\n/job:localhost/replica:0/task:0/device:GPU:0 -> device: 0, name: GeForce GT 720, pci bus id: 0000:82:00.0, compute capability: 3.5\r\n2017-12-19 18:50:35.455437: I tensorflow/core/common_runtime/direct_session.cc:300] Device mapping:\r\n/job:localhost/replica:0/task:0/device:GPU:0 -> device: 0, name: GeForce GT 720, pci bus id: 0000:82:00.0, compute capability: 3.5\r\n\r\nTensor(\"MatMul:0\", shape=(2, 2), dtype=float32, device=/device:GPU:0)\r\nMatMul: (MatMul): /job:localhost/replica:0/task:0/device:GPU:0\r\n2017-12-19 18:50:35.456469: I tensorflow/core/common_runtime/placer.cc:874] MatMul: (MatMul)/job:localhost/replica:0/task:0/device:GPU:0\r\nb: (Const): /job:localhost/replica:0/task:0/device:GPU:0\r\n2017-12-19 18:50:35.456525: I tensorflow/core/common_runtime/placer.cc:874] b: (Const)/job:localhost/replica:0/task:0/device:GPU:0\r\na: (Const): /job:localhost/replica:0/task:0/device:GPU:0\r\n2017-12-19 18:50:35.456555: I tensorflow/core/common_runtime/placer.cc:874] a: (Const)/job:localhost/replica:0/task:0/device:GPU:0\r\n```\r\n\r\nI have also checked the ```bool USE_CUBLAS``` and it has value 0, in function ```Compute```. Is it a possible bug or i am doing something wrong?"}