{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/347132657", "html_url": "https://github.com/tensorflow/tensorflow/issues/9091#issuecomment-347132657", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9091", "id": 347132657, "node_id": "MDEyOklzc3VlQ29tbWVudDM0NzEzMjY1Nw==", "user": {"login": "dantkz", "id": 5220571, "node_id": "MDQ6VXNlcjUyMjA1NzE=", "avatar_url": "https://avatars1.githubusercontent.com/u/5220571?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dantkz", "html_url": "https://github.com/dantkz", "followers_url": "https://api.github.com/users/dantkz/followers", "following_url": "https://api.github.com/users/dantkz/following{/other_user}", "gists_url": "https://api.github.com/users/dantkz/gists{/gist_id}", "starred_url": "https://api.github.com/users/dantkz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dantkz/subscriptions", "organizations_url": "https://api.github.com/users/dantkz/orgs", "repos_url": "https://api.github.com/users/dantkz/repos", "events_url": "https://api.github.com/users/dantkz/events{/privacy}", "received_events_url": "https://api.github.com/users/dantkz/received_events", "type": "User", "site_admin": false}, "created_at": "2017-11-27T09:57:38Z", "updated_at": "2017-11-27T09:57:38Z", "author_association": "CONTRIBUTOR", "body_html": "<p>There is indeed different treatment for <code>dtype=tf.int32 </code> for <code>tf.zeros</code>, <code>tf.zeros_like</code>, <code>tf.ones</code>, <code>tf.ones_like</code>.</p>\n<p>These ops are defined in <a href=\"https://github.com/tensorflow/tensorflow/blob/96f334b0d6ec61f5037b8ddd1860a9aa7874efef/tensorflow/python/ops/array_ops.py#L1433\">tensorflow/python/ops/array_ops.py</a>.</p>\n<p>They all call <code>fill</code> function defined in <a href=\"https://github.com/tensorflow/tensorflow/blob/96f334b0d6ec61f5037b8ddd1860a9aa7874efef/tensorflow/core/kernels/constant_op.cc#L168\">tensorflow/core/kernels/constant_op.cc</a>.</p>\n<p>The <code>FillOp</code> is <a href=\"https://github.com/tensorflow/tensorflow/blob/96f334b0d6ec61f5037b8ddd1860a9aa7874efef/tensorflow/core/kernels/constant_op.cc#L251\">registered as usual</a> for all types except int32:</p>\n<pre><code>// A special GPU kernel for int32.\n// TODO(b/25387198): Also enable int32 in device memory. This kernel\n// registration requires all int32 inputs and outputs to be in host memory.\nREGISTER_KERNEL_BUILDER(Name(\"Fill\")\n                            .Device(DEVICE_GPU)\n                            .TypeConstraint&lt;int32&gt;(\"T\")\n                            .HostMemory(\"dims\")\n                            .HostMemory(\"value\")\n                            .HostMemory(\"output\"),\n                        FillOp&lt;CPUDevice, int32&gt;);\n</code></pre>\n<p><code>ConstantOp</code> in the same file also has this special treatment.</p>\n<p>*REGISTER_KERNEL_BUILDER macro is defined in tensorflow/core/framework/op_kernel.h.</p>", "body_text": "There is indeed different treatment for dtype=tf.int32  for tf.zeros, tf.zeros_like, tf.ones, tf.ones_like.\nThese ops are defined in tensorflow/python/ops/array_ops.py.\nThey all call fill function defined in tensorflow/core/kernels/constant_op.cc.\nThe FillOp is registered as usual for all types except int32:\n// A special GPU kernel for int32.\n// TODO(b/25387198): Also enable int32 in device memory. This kernel\n// registration requires all int32 inputs and outputs to be in host memory.\nREGISTER_KERNEL_BUILDER(Name(\"Fill\")\n                            .Device(DEVICE_GPU)\n                            .TypeConstraint<int32>(\"T\")\n                            .HostMemory(\"dims\")\n                            .HostMemory(\"value\")\n                            .HostMemory(\"output\"),\n                        FillOp<CPUDevice, int32>);\n\nConstantOp in the same file also has this special treatment.\n*REGISTER_KERNEL_BUILDER macro is defined in tensorflow/core/framework/op_kernel.h.", "body": "There is indeed different treatment for `dtype=tf.int32 ` for `tf.zeros`, `tf.zeros_like`, `tf.ones`, `tf.ones_like`.\r\n\r\nThese ops are defined in [tensorflow/python/ops/array_ops.py](https://github.com/tensorflow/tensorflow/blob/96f334b0d6ec61f5037b8ddd1860a9aa7874efef/tensorflow/python/ops/array_ops.py#L1433).\r\n\r\nThey all call `fill` function defined in [tensorflow/core/kernels/constant_op.cc](https://github.com/tensorflow/tensorflow/blob/96f334b0d6ec61f5037b8ddd1860a9aa7874efef/tensorflow/core/kernels/constant_op.cc#L168).\r\n\r\nThe `FillOp` is [registered as usual](https://github.com/tensorflow/tensorflow/blob/96f334b0d6ec61f5037b8ddd1860a9aa7874efef/tensorflow/core/kernels/constant_op.cc#L251) for all types except int32:\r\n\r\n```\r\n// A special GPU kernel for int32.\r\n// TODO(b/25387198): Also enable int32 in device memory. This kernel\r\n// registration requires all int32 inputs and outputs to be in host memory.\r\nREGISTER_KERNEL_BUILDER(Name(\"Fill\")\r\n                            .Device(DEVICE_GPU)\r\n                            .TypeConstraint<int32>(\"T\")\r\n                            .HostMemory(\"dims\")\r\n                            .HostMemory(\"value\")\r\n                            .HostMemory(\"output\"),\r\n                        FillOp<CPUDevice, int32>);\r\n```\r\n\r\n`ConstantOp` in the same file also has this special treatment.\r\n\r\n*REGISTER_KERNEL_BUILDER macro is defined in tensorflow/core/framework/op_kernel.h.\r\n"}