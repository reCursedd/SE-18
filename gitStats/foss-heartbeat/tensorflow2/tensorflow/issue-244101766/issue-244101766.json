{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11613", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11613/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11613/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11613/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/11613", "id": 244101766, "node_id": "MDU6SXNzdWUyNDQxMDE3NjY=", "number": 11613, "title": "Error in InputQueueingStateSaver/barrier", "user": {"login": "rubenvereecken", "id": 5216553, "node_id": "MDQ6VXNlcjUyMTY1NTM=", "avatar_url": "https://avatars0.githubusercontent.com/u/5216553?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rubenvereecken", "html_url": "https://github.com/rubenvereecken", "followers_url": "https://api.github.com/users/rubenvereecken/followers", "following_url": "https://api.github.com/users/rubenvereecken/following{/other_user}", "gists_url": "https://api.github.com/users/rubenvereecken/gists{/gist_id}", "starred_url": "https://api.github.com/users/rubenvereecken/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rubenvereecken/subscriptions", "organizations_url": "https://api.github.com/users/rubenvereecken/orgs", "repos_url": "https://api.github.com/users/rubenvereecken/repos", "events_url": "https://api.github.com/users/rubenvereecken/events{/privacy}", "received_events_url": "https://api.github.com/users/rubenvereecken/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 15, "created_at": "2017-07-19T16:34:48Z", "updated_at": "2018-11-21T12:21:02Z", "closed_at": "2018-01-04T18:39:05Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: Yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Linux Mint 18</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: Binary (pip)</li>\n<li><strong>TensorFlow version (use command below)</strong>: v1.2.0-rc2-21-g12f033d 1.2.0</li>\n<li><strong>Bazel version (if compiling from source)</strong>: N/A</li>\n<li><strong>CUDA/cuDNN version</strong>: N/A</li>\n<li><strong>GPU model and memory</strong>: N/A</li>\n<li><strong>Exact command to reproduce</strong>: N/A</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>I encounter an error related to barriers when using <code>tf.contrib.training.batch_sequences_with_states</code>. I use this function to batch sequences. For now, just batches of 4. I do not understand the error it but I tried empirically poking at it and it only occurs with some capacity values. For example, it does not occur within 15 minutes with a <code>capacity</code> value of 16 (good for 4 batches) and cycles through the input sequences as expected. It does occur within a minute with <code>capacity</code> values of 32 and 64.</p>\n<p>I know this is incredibly vague but I can explore more if you can help me understand the underlying issue. I do believe this question does not fit the StackOverflow format as this is buggy behaviour.</p>\n<h3>Source code / logs</h3>\n<p>Below the error log. One thing I do not understand for example is that it always complains about components 0-8. I have verified that this occurs for multiple keys. My best guess is that this has to do with <code>save_state</code> trying to save over state that has already been saved?</p>\n<pre><code>2017-07-19 17:16:52.465021: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 8 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n2017-07-19 17:16:52.465073: W tensorflow/core/kernels/queue_base.cc:294] _2_input/batch_seq_with_states/fifo_queue: Skipping cancelled enqueue attempt with queue not closed\n2017-07-19 17:16:52.465117: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 7 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n2017-07-19 17:16:52.465168: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 5 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n2017-07-19 17:16:52.465226: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 3 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n2017-07-19 17:16:52.465261: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 4 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n2017-07-19 17:16:52.465292: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 0 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n2017-07-19 17:16:52.465324: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 1 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n2017-07-19 17:16:52.465798: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 2 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n2017-07-19 17:16:52.469856: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 6 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\nINFO:tensorflow:Error reported to Coordinator: &lt;class 'tensorflow.python.framework.errors_impl.InvalidArgumentError'&gt;, Key 00030_of_00112:20120305_seq1 already has a value for component 8 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n         [[Node: input/batch_seq_with_states/InputQueueingStateSaver/BarrierInsertContext_num_frames = BarrierInsertMany[T=DT_INT64, _class=[\"loc:@input/batch_seq_with_states/fifo_queue\"], component_index=8, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](input/batch_seq_with_states/InputQueueingStateSaver/barrier, input/batch_seq_with_states/InputQueueingStateSaver/StringJoinCurrentKeys, input/batch_seq_with_states/InputQueueingStateSaver/dims_checked_expanded_context_num_frames)]]\n17:16:52 [tensorflow          ] [INFO    ] : Error reported to Coordinator: &lt;class 'tensorflow.python.framework.errors_impl.InvalidArgumentError'&gt;, Key 00030_of_00112:20120305_seq1 already has a value for component 8 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n         [[Node: input/batch_seq_with_states/InputQueueingStateSaver/BarrierInsertContext_num_frames = BarrierInsertMany[T=DT_INT64, _class=[\"loc:@input/batch_seq_with_states/fifo_queue\"], component_index=8, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](input/batch_seq_with_states/InputQueueingStateSaver/barrier, input/batch_seq_with_states/InputQueueingStateSaver/StringJoinCurrentKeys, input/batch_seq_with_states/InputQueueingStateSaver/dims_checked_expanded_context_num_frames)]]\nTraceback (most recent call last):\n  File \"./train.py\", line 108, in &lt;module&gt;\n    solver.train(**pick(all_args, list(inspect.signature(solver.train).parameters)))\n  File \"/home/ruben/attention/attend/attend/solver.py\", line 122, in train\n    coord.join(threads + input_threads)\n  File \"/home/ruben/anaconda3/lib/python3.6/site-packages/tensorflow/python/training/coordinator.py\", line 389, in join\n    six.reraise(*self._exc_info_to_raise)\n  File \"/home/ruben/anaconda3/lib/python3.6/site-packages/six.py\", line 686, in reraise\n    raise value\n  File \"/home/ruben/anaconda3/lib/python3.6/site-packages/tensorflow/python/training/queue_runner_impl.py\", line 238, in _run\n    enqueue_callable()\n  File \"/home/ruben/anaconda3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1063, in _single_operation_run\n    target_list_as_strings, status, None)\n  File \"/home/ruben/anaconda3/lib/python3.6/contextlib.py\", line 89, in __exit__\n    next(self.gen)\n  File \"/home/ruben/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/errors_impl.py\", line 466, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Key 00030_of_00112:20120305_seq1 already has a value for component 8 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n         [[Node: input/batch_seq_with_states/InputQueueingStateSaver/BarrierInsertContext_num_frames = BarrierInsertMany[T=DT_INT64, _class=[\"loc:@input/batch_seq_with_states/fifo_queue\"], component_index=8, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](input/batch_seq_with_states/InputQueueingStateSaver/barrier, input/batch_seq_with_states/InputQueueingStateSaver/StringJoinCurrentKeys, input/batch_seq_with_states/InputQueueingStateSaver/dims_checked_expanded_context_nu\n\n</code></pre>\n<p>Relevant source code in <code>provider.py</code>:</p>\n<div class=\"highlight highlight-source-python\"><pre>batch <span class=\"pl-k\">=</span> tf.contrib.training.batch_sequences_with_states(\n        <span class=\"pl-v\">input_sequences</span><span class=\"pl-k\">=</span>{\n            <span class=\"pl-s\"><span class=\"pl-pds\">'</span>images<span class=\"pl-pds\">'</span></span>: example,\n            <span class=\"pl-c1\">self</span>.feat_name: target,\n        },\n        <span class=\"pl-v\">input_key</span>      <span class=\"pl-k\">=</span> context[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>key<span class=\"pl-pds\">'</span></span>],\n        <span class=\"pl-v\">input_context</span>  <span class=\"pl-k\">=</span> context,\n        <span class=\"pl-v\">input_length</span>   <span class=\"pl-k\">=</span> tf.cast(context[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>num_frames<span class=\"pl-pds\">'</span></span>], tf.int32),\n        <span class=\"pl-v\">initial_states</span> <span class=\"pl-k\">=</span> initial_states,\n        <span class=\"pl-v\">num_unroll</span>     <span class=\"pl-k\">=</span> <span class=\"pl-c1\">self</span>.time_steps,\n        <span class=\"pl-v\">batch_size</span>     <span class=\"pl-k\">=</span> <span class=\"pl-c1\">self</span>.batch_size,\n        <span class=\"pl-v\">num_threads</span>    <span class=\"pl-k\">=</span> <span class=\"pl-c1\">2</span>, <span class=\"pl-c\"><span class=\"pl-c\">#</span> <span class=\"pl-k\">TODO</span> change</span>\n        <span class=\"pl-v\">capacity</span>       <span class=\"pl-k\">=</span> <span class=\"pl-c1\">self</span>.batch_size <span class=\"pl-k\">*</span> <span class=\"pl-c1\">4</span>,\n        <span class=\"pl-v\">name</span>           <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>batch_seq_with_states<span class=\"pl-pds\">'</span></span>\n        )\n\n</pre></div>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Mint 18\nTensorFlow installed from (source or binary): Binary (pip)\nTensorFlow version (use command below): v1.2.0-rc2-21-g12f033d 1.2.0\nBazel version (if compiling from source): N/A\nCUDA/cuDNN version: N/A\nGPU model and memory: N/A\nExact command to reproduce: N/A\n\nDescribe the problem\nI encounter an error related to barriers when using tf.contrib.training.batch_sequences_with_states. I use this function to batch sequences. For now, just batches of 4. I do not understand the error it but I tried empirically poking at it and it only occurs with some capacity values. For example, it does not occur within 15 minutes with a capacity value of 16 (good for 4 batches) and cycles through the input sequences as expected. It does occur within a minute with capacity values of 32 and 64.\nI know this is incredibly vague but I can explore more if you can help me understand the underlying issue. I do believe this question does not fit the StackOverflow format as this is buggy behaviour.\nSource code / logs\nBelow the error log. One thing I do not understand for example is that it always complains about components 0-8. I have verified that this occurs for multiple keys. My best guess is that this has to do with save_state trying to save over state that has already been saved?\n2017-07-19 17:16:52.465021: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 8 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n2017-07-19 17:16:52.465073: W tensorflow/core/kernels/queue_base.cc:294] _2_input/batch_seq_with_states/fifo_queue: Skipping cancelled enqueue attempt with queue not closed\n2017-07-19 17:16:52.465117: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 7 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n2017-07-19 17:16:52.465168: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 5 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n2017-07-19 17:16:52.465226: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 3 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n2017-07-19 17:16:52.465261: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 4 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n2017-07-19 17:16:52.465292: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 0 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n2017-07-19 17:16:52.465324: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 1 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n2017-07-19 17:16:52.465798: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 2 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n2017-07-19 17:16:52.469856: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 6 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\nINFO:tensorflow:Error reported to Coordinator: <class 'tensorflow.python.framework.errors_impl.InvalidArgumentError'>, Key 00030_of_00112:20120305_seq1 already has a value for component 8 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n         [[Node: input/batch_seq_with_states/InputQueueingStateSaver/BarrierInsertContext_num_frames = BarrierInsertMany[T=DT_INT64, _class=[\"loc:@input/batch_seq_with_states/fifo_queue\"], component_index=8, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](input/batch_seq_with_states/InputQueueingStateSaver/barrier, input/batch_seq_with_states/InputQueueingStateSaver/StringJoinCurrentKeys, input/batch_seq_with_states/InputQueueingStateSaver/dims_checked_expanded_context_num_frames)]]\n17:16:52 [tensorflow          ] [INFO    ] : Error reported to Coordinator: <class 'tensorflow.python.framework.errors_impl.InvalidArgumentError'>, Key 00030_of_00112:20120305_seq1 already has a value for component 8 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n         [[Node: input/batch_seq_with_states/InputQueueingStateSaver/BarrierInsertContext_num_frames = BarrierInsertMany[T=DT_INT64, _class=[\"loc:@input/batch_seq_with_states/fifo_queue\"], component_index=8, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](input/batch_seq_with_states/InputQueueingStateSaver/barrier, input/batch_seq_with_states/InputQueueingStateSaver/StringJoinCurrentKeys, input/batch_seq_with_states/InputQueueingStateSaver/dims_checked_expanded_context_num_frames)]]\nTraceback (most recent call last):\n  File \"./train.py\", line 108, in <module>\n    solver.train(**pick(all_args, list(inspect.signature(solver.train).parameters)))\n  File \"/home/ruben/attention/attend/attend/solver.py\", line 122, in train\n    coord.join(threads + input_threads)\n  File \"/home/ruben/anaconda3/lib/python3.6/site-packages/tensorflow/python/training/coordinator.py\", line 389, in join\n    six.reraise(*self._exc_info_to_raise)\n  File \"/home/ruben/anaconda3/lib/python3.6/site-packages/six.py\", line 686, in reraise\n    raise value\n  File \"/home/ruben/anaconda3/lib/python3.6/site-packages/tensorflow/python/training/queue_runner_impl.py\", line 238, in _run\n    enqueue_callable()\n  File \"/home/ruben/anaconda3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1063, in _single_operation_run\n    target_list_as_strings, status, None)\n  File \"/home/ruben/anaconda3/lib/python3.6/contextlib.py\", line 89, in __exit__\n    next(self.gen)\n  File \"/home/ruben/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/errors_impl.py\", line 466, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Key 00030_of_00112:20120305_seq1 already has a value for component 8 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\n         [[Node: input/batch_seq_with_states/InputQueueingStateSaver/BarrierInsertContext_num_frames = BarrierInsertMany[T=DT_INT64, _class=[\"loc:@input/batch_seq_with_states/fifo_queue\"], component_index=8, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](input/batch_seq_with_states/InputQueueingStateSaver/barrier, input/batch_seq_with_states/InputQueueingStateSaver/StringJoinCurrentKeys, input/batch_seq_with_states/InputQueueingStateSaver/dims_checked_expanded_context_nu\n\n\nRelevant source code in provider.py:\nbatch = tf.contrib.training.batch_sequences_with_states(\n        input_sequences={\n            'images': example,\n            self.feat_name: target,\n        },\n        input_key      = context['key'],\n        input_context  = context,\n        input_length   = tf.cast(context['num_frames'], tf.int32),\n        initial_states = initial_states,\n        num_unroll     = self.time_steps,\n        batch_size     = self.batch_size,\n        num_threads    = 2, # TODO change\n        capacity       = self.batch_size * 4,\n        name           = 'batch_seq_with_states'\n        )", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: Yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Mint 18\r\n- **TensorFlow installed from (source or binary)**: Binary (pip)\r\n- **TensorFlow version (use command below)**: v1.2.0-rc2-21-g12f033d 1.2.0\r\n- **Bazel version (if compiling from source)**: N/A\r\n- **CUDA/cuDNN version**: N/A\r\n- **GPU model and memory**: N/A\r\n- **Exact command to reproduce**: N/A\r\n\r\n### Describe the problem\r\nI encounter an error related to barriers when using `tf.contrib.training.batch_sequences_with_states`. I use this function to batch sequences. For now, just batches of 4. I do not understand the error it but I tried empirically poking at it and it only occurs with some capacity values. For example, it does not occur within 15 minutes with a `capacity` value of 16 (good for 4 batches) and cycles through the input sequences as expected. It does occur within a minute with `capacity` values of 32 and 64.\r\n\r\nI know this is incredibly vague but I can explore more if you can help me understand the underlying issue. I do believe this question does not fit the StackOverflow format as this is buggy behaviour. \r\n\r\n### Source code / logs\r\nBelow the error log. One thing I do not understand for example is that it always complains about components 0-8. I have verified that this occurs for multiple keys. My best guess is that this has to do with `save_state` trying to save over state that has already been saved?\r\n\r\n```\r\n2017-07-19 17:16:52.465021: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 8 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\r\n2017-07-19 17:16:52.465073: W tensorflow/core/kernels/queue_base.cc:294] _2_input/batch_seq_with_states/fifo_queue: Skipping cancelled enqueue attempt with queue not closed\r\n2017-07-19 17:16:52.465117: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 7 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\r\n2017-07-19 17:16:52.465168: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 5 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\r\n2017-07-19 17:16:52.465226: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 3 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\r\n2017-07-19 17:16:52.465261: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 4 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\r\n2017-07-19 17:16:52.465292: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 0 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\r\n2017-07-19 17:16:52.465324: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 1 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\r\n2017-07-19 17:16:52.465798: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 2 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\r\n2017-07-19 17:16:52.469856: W tensorflow/core/framework/op_kernel.cc:1158] Invalid argument: Key 00030_of_00112:20120305_seq1 already has a value for component 6 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\r\nINFO:tensorflow:Error reported to Coordinator: <class 'tensorflow.python.framework.errors_impl.InvalidArgumentError'>, Key 00030_of_00112:20120305_seq1 already has a value for component 8 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\r\n         [[Node: input/batch_seq_with_states/InputQueueingStateSaver/BarrierInsertContext_num_frames = BarrierInsertMany[T=DT_INT64, _class=[\"loc:@input/batch_seq_with_states/fifo_queue\"], component_index=8, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](input/batch_seq_with_states/InputQueueingStateSaver/barrier, input/batch_seq_with_states/InputQueueingStateSaver/StringJoinCurrentKeys, input/batch_seq_with_states/InputQueueingStateSaver/dims_checked_expanded_context_num_frames)]]\r\n17:16:52 [tensorflow          ] [INFO    ] : Error reported to Coordinator: <class 'tensorflow.python.framework.errors_impl.InvalidArgumentError'>, Key 00030_of_00112:20120305_seq1 already has a value for component 8 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\r\n         [[Node: input/batch_seq_with_states/InputQueueingStateSaver/BarrierInsertContext_num_frames = BarrierInsertMany[T=DT_INT64, _class=[\"loc:@input/batch_seq_with_states/fifo_queue\"], component_index=8, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](input/batch_seq_with_states/InputQueueingStateSaver/barrier, input/batch_seq_with_states/InputQueueingStateSaver/StringJoinCurrentKeys, input/batch_seq_with_states/InputQueueingStateSaver/dims_checked_expanded_context_num_frames)]]\r\nTraceback (most recent call last):\r\n  File \"./train.py\", line 108, in <module>\r\n    solver.train(**pick(all_args, list(inspect.signature(solver.train).parameters)))\r\n  File \"/home/ruben/attention/attend/attend/solver.py\", line 122, in train\r\n    coord.join(threads + input_threads)\r\n  File \"/home/ruben/anaconda3/lib/python3.6/site-packages/tensorflow/python/training/coordinator.py\", line 389, in join\r\n    six.reraise(*self._exc_info_to_raise)\r\n  File \"/home/ruben/anaconda3/lib/python3.6/site-packages/six.py\", line 686, in reraise\r\n    raise value\r\n  File \"/home/ruben/anaconda3/lib/python3.6/site-packages/tensorflow/python/training/queue_runner_impl.py\", line 238, in _run\r\n    enqueue_callable()\r\n  File \"/home/ruben/anaconda3/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1063, in _single_operation_run\r\n    target_list_as_strings, status, None)\r\n  File \"/home/ruben/anaconda3/lib/python3.6/contextlib.py\", line 89, in __exit__\r\n    next(self.gen)\r\n  File \"/home/ruben/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/errors_impl.py\", line 466, in raise_exception_on_not_ok_status\r\n    pywrap_tensorflow.TF_GetCode(status))\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Key 00030_of_00112:20120305_seq1 already has a value for component 8 in barrier _3_input/batch_seq_with_states/InputQueueingStateSaver/barrier\r\n         [[Node: input/batch_seq_with_states/InputQueueingStateSaver/BarrierInsertContext_num_frames = BarrierInsertMany[T=DT_INT64, _class=[\"loc:@input/batch_seq_with_states/fifo_queue\"], component_index=8, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](input/batch_seq_with_states/InputQueueingStateSaver/barrier, input/batch_seq_with_states/InputQueueingStateSaver/StringJoinCurrentKeys, input/batch_seq_with_states/InputQueueingStateSaver/dims_checked_expanded_context_nu\r\n\r\n```\r\n\r\nRelevant source code in `provider.py`:\r\n\r\n```python\r\nbatch = tf.contrib.training.batch_sequences_with_states(\r\n        input_sequences={\r\n            'images': example,\r\n            self.feat_name: target,\r\n        },\r\n        input_key      = context['key'],\r\n        input_context  = context,\r\n        input_length   = tf.cast(context['num_frames'], tf.int32),\r\n        initial_states = initial_states,\r\n        num_unroll     = self.time_steps,\r\n        batch_size     = self.batch_size,\r\n        num_threads    = 2, # TODO change\r\n        capacity       = self.batch_size * 4,\r\n        name           = 'batch_seq_with_states'\r\n        )\r\n\r\n\r\n```\r\n"}