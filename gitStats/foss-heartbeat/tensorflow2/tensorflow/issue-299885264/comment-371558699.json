{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/371558699", "html_url": "https://github.com/tensorflow/tensorflow/issues/17233#issuecomment-371558699", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17233", "id": 371558699, "node_id": "MDEyOklzc3VlQ29tbWVudDM3MTU1ODY5OQ==", "user": {"login": "niklas88", "id": 264873, "node_id": "MDQ6VXNlcjI2NDg3Mw==", "avatar_url": "https://avatars1.githubusercontent.com/u/264873?v=4", "gravatar_id": "", "url": "https://api.github.com/users/niklas88", "html_url": "https://github.com/niklas88", "followers_url": "https://api.github.com/users/niklas88/followers", "following_url": "https://api.github.com/users/niklas88/following{/other_user}", "gists_url": "https://api.github.com/users/niklas88/gists{/gist_id}", "starred_url": "https://api.github.com/users/niklas88/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/niklas88/subscriptions", "organizations_url": "https://api.github.com/users/niklas88/orgs", "repos_url": "https://api.github.com/users/niklas88/repos", "events_url": "https://api.github.com/users/niklas88/events{/privacy}", "received_events_url": "https://api.github.com/users/niklas88/received_events", "type": "User", "site_admin": false}, "created_at": "2018-03-08T17:22:17Z", "updated_at": "2018-03-08T17:23:43Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=23068\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/yaroslavvb\">@yaroslavvb</a> so with <code>align_numpy_tf()</code> as used in my posted code I didn't see an improvement. However using  <code>LD_PRELOAD</code> does the trick and the performance returns to 1.5 levels. When doing this tcmalloc warns of <code>large alloc</code>s though.</p>\n<p>Maybe <code>align_numpy_tf()</code> doesn't work since the embedding uses <a href=\"https://github.com/niklas88/tf_perf_regression/blob/master/deep_relscorer.py#L156\">vstack</a> or because the placeholder has an <a href=\"https://github.com/niklas88/tf_perf_regression/blob/e7bdac70ceba120ad20820cc3f93f8e4493b1a8b/deep_relscorer.py#L702\">explicit shape</a>?</p>", "body_text": "@yaroslavvb so with align_numpy_tf() as used in my posted code I didn't see an improvement. However using  LD_PRELOAD does the trick and the performance returns to 1.5 levels. When doing this tcmalloc warns of large allocs though.\nMaybe align_numpy_tf() doesn't work since the embedding uses vstack or because the placeholder has an explicit shape?", "body": "@yaroslavvb so with `align_numpy_tf()` as used in my posted code I didn't see an improvement. However using  `LD_PRELOAD` does the trick and the performance returns to 1.5 levels. When doing this tcmalloc warns of `large alloc`s though.\r\n\r\nMaybe `align_numpy_tf()` doesn't work since the embedding uses [vstack](https://github.com/niklas88/tf_perf_regression/blob/master/deep_relscorer.py#L156) or because the placeholder has an [explicit shape](https://github.com/niklas88/tf_perf_regression/blob/e7bdac70ceba120ad20820cc3f93f8e4493b1a8b/deep_relscorer.py#L702)?"}