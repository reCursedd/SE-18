{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19618", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19618/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19618/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19618/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/19618", "id": 327294777, "node_id": "MDU6SXNzdWUzMjcyOTQ3Nzc=", "number": 19618, "title": "Tensorflow custom Ops on AWS P3 instances exit with CUDA_ERROR_ILLEGAL_ADDRESS", "user": {"login": "badreddine1758", "id": 32060704, "node_id": "MDQ6VXNlcjMyMDYwNzA0", "avatar_url": "https://avatars1.githubusercontent.com/u/32060704?v=4", "gravatar_id": "", "url": "https://api.github.com/users/badreddine1758", "html_url": "https://github.com/badreddine1758", "followers_url": "https://api.github.com/users/badreddine1758/followers", "following_url": "https://api.github.com/users/badreddine1758/following{/other_user}", "gists_url": "https://api.github.com/users/badreddine1758/gists{/gist_id}", "starred_url": "https://api.github.com/users/badreddine1758/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/badreddine1758/subscriptions", "organizations_url": "https://api.github.com/users/badreddine1758/orgs", "repos_url": "https://api.github.com/users/badreddine1758/repos", "events_url": "https://api.github.com/users/badreddine1758/events{/privacy}", "received_events_url": "https://api.github.com/users/badreddine1758/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "angersson", "id": 32465472, "node_id": "MDQ6VXNlcjMyNDY1NDcy", "avatar_url": "https://avatars2.githubusercontent.com/u/32465472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/angersson", "html_url": "https://github.com/angersson", "followers_url": "https://api.github.com/users/angersson/followers", "following_url": "https://api.github.com/users/angersson/following{/other_user}", "gists_url": "https://api.github.com/users/angersson/gists{/gist_id}", "starred_url": "https://api.github.com/users/angersson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/angersson/subscriptions", "organizations_url": "https://api.github.com/users/angersson/orgs", "repos_url": "https://api.github.com/users/angersson/repos", "events_url": "https://api.github.com/users/angersson/events{/privacy}", "received_events_url": "https://api.github.com/users/angersson/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "angersson", "id": 32465472, "node_id": "MDQ6VXNlcjMyNDY1NDcy", "avatar_url": "https://avatars2.githubusercontent.com/u/32465472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/angersson", "html_url": "https://github.com/angersson", "followers_url": "https://api.github.com/users/angersson/followers", "following_url": "https://api.github.com/users/angersson/following{/other_user}", "gists_url": "https://api.github.com/users/angersson/gists{/gist_id}", "starred_url": "https://api.github.com/users/angersson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/angersson/subscriptions", "organizations_url": "https://api.github.com/users/angersson/orgs", "repos_url": "https://api.github.com/users/angersson/repos", "events_url": "https://api.github.com/users/angersson/events{/privacy}", "received_events_url": "https://api.github.com/users/angersson/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2018-05-29T12:16:43Z", "updated_at": "2018-06-02T00:18:00Z", "closed_at": "2018-06-02T00:18:00Z", "author_association": "NONE", "body_html": "<p>I am trying to build my own Tensorflow Op on a AWS P3 instance (using NVIDIA's GPU Cloud and nvidia-docker) and I get the following error message:</p>\n<pre><code>2018-05-29 10:47:38.377439: E tensorflow/stream_executor/cuda/cuda_event.cc:49] Error polling for event status: failed to query event: CUDA_ERROR_ILLEGAL_ADDRESS\n2018-05-29 10:47:38.377513: F tensorflow/core/common_runtime/gpu/gpu_event_mgr.cc:203] Unexpected Event status: 1\n</code></pre>\n<p>To build the Op, I had to create a coda_config.h, under /usr/local/cuda/, with the following content</p>\n<pre><code>#ifndef CUDA_CUDA_CONFIG_H_\n#define CUDA_CUDA_CONFIG_H_\n\n#define TF_CUDA_CAPABILITIES CudaVersion(\"3.0\")\n\n#define TF_CUDA_VERSION \"9.0\"\n#define TF_CUDNN_VERSION \"7.0.5\"\n\n#define TF_CUDA_TOOLKIT_PATH \"/usr/local/cuda-9.0\"\n\n#endif  // CUDA_CUDA_CONFIG_H_\n</code></pre>\n<p>I also had to make these changes to /usr/local/lib/python2.7/dist-packages/tensorflow/include/tensorflow/core/platform/default/mutex.h</p>\n<pre><code>#include \"/usr/local/lib/python2.7/dist-packages/tensorflow/include/external/nsync/public/nsync_cv.h\" // &lt;- \"nsync_cv.h\"\n#include \"/usr/local/lib/python2.7/dist-packages/tensorflow/include/external/nsync/public/nsync_mu.h\" // &lt;- \"nsync_mu.h\"\n</code></pre>\n<p>I compile my source code files as follows</p>\n<pre><code>nvcc -std=c++11 -c -o my_op_gpu.cu.o my_op_gpu.cu.cc -I $TF_INC -I /usr/local/ -I /usr/local/lib/python2.7/dist-packages/tensorflow/include/external/nsync/public -I /usr/local/cuda/include/ -D GOOGLE_CUDA=1 -x cu -Xcompiler -fPIC --expt-relaxed-constexpr\n\ng++ -std=c++11 -shared -D_GLIBCXX_USE_CXX_ABI=0 -o my_op.so my_op.cc my_op_gpu.cu.o -I $TF_INC -I /usr/local/lib/python2.7/dist-packages/tensorflow/include/external/nsync/public -D GOOGLE_CUDA=1 -L$TF_LIB -ltensorflow_framework -fPIC\n</code></pre>\n<p>where</p>\n<pre><code>TF_INC=$(python -c 'import tensorflow as tf; print(tf.sysconfig.get_include())')\nTF_LIB=$(python -c 'import tensorflow as tf; print(tf.sysconfig.get_lib())')\n</code></pre>\n<p>Please help.</p>", "body_text": "I am trying to build my own Tensorflow Op on a AWS P3 instance (using NVIDIA's GPU Cloud and nvidia-docker) and I get the following error message:\n2018-05-29 10:47:38.377439: E tensorflow/stream_executor/cuda/cuda_event.cc:49] Error polling for event status: failed to query event: CUDA_ERROR_ILLEGAL_ADDRESS\n2018-05-29 10:47:38.377513: F tensorflow/core/common_runtime/gpu/gpu_event_mgr.cc:203] Unexpected Event status: 1\n\nTo build the Op, I had to create a coda_config.h, under /usr/local/cuda/, with the following content\n#ifndef CUDA_CUDA_CONFIG_H_\n#define CUDA_CUDA_CONFIG_H_\n\n#define TF_CUDA_CAPABILITIES CudaVersion(\"3.0\")\n\n#define TF_CUDA_VERSION \"9.0\"\n#define TF_CUDNN_VERSION \"7.0.5\"\n\n#define TF_CUDA_TOOLKIT_PATH \"/usr/local/cuda-9.0\"\n\n#endif  // CUDA_CUDA_CONFIG_H_\n\nI also had to make these changes to /usr/local/lib/python2.7/dist-packages/tensorflow/include/tensorflow/core/platform/default/mutex.h\n#include \"/usr/local/lib/python2.7/dist-packages/tensorflow/include/external/nsync/public/nsync_cv.h\" // <- \"nsync_cv.h\"\n#include \"/usr/local/lib/python2.7/dist-packages/tensorflow/include/external/nsync/public/nsync_mu.h\" // <- \"nsync_mu.h\"\n\nI compile my source code files as follows\nnvcc -std=c++11 -c -o my_op_gpu.cu.o my_op_gpu.cu.cc -I $TF_INC -I /usr/local/ -I /usr/local/lib/python2.7/dist-packages/tensorflow/include/external/nsync/public -I /usr/local/cuda/include/ -D GOOGLE_CUDA=1 -x cu -Xcompiler -fPIC --expt-relaxed-constexpr\n\ng++ -std=c++11 -shared -D_GLIBCXX_USE_CXX_ABI=0 -o my_op.so my_op.cc my_op_gpu.cu.o -I $TF_INC -I /usr/local/lib/python2.7/dist-packages/tensorflow/include/external/nsync/public -D GOOGLE_CUDA=1 -L$TF_LIB -ltensorflow_framework -fPIC\n\nwhere\nTF_INC=$(python -c 'import tensorflow as tf; print(tf.sysconfig.get_include())')\nTF_LIB=$(python -c 'import tensorflow as tf; print(tf.sysconfig.get_lib())')\n\nPlease help.", "body": "I am trying to build my own Tensorflow Op on a AWS P3 instance (using NVIDIA's GPU Cloud and nvidia-docker) and I get the following error message:\r\n\r\n```\r\n2018-05-29 10:47:38.377439: E tensorflow/stream_executor/cuda/cuda_event.cc:49] Error polling for event status: failed to query event: CUDA_ERROR_ILLEGAL_ADDRESS\r\n2018-05-29 10:47:38.377513: F tensorflow/core/common_runtime/gpu/gpu_event_mgr.cc:203] Unexpected Event status: 1\r\n```\r\n\r\nTo build the Op, I had to create a coda_config.h, under /usr/local/cuda/, with the following content\r\n```\r\n#ifndef CUDA_CUDA_CONFIG_H_\r\n#define CUDA_CUDA_CONFIG_H_\r\n\r\n#define TF_CUDA_CAPABILITIES CudaVersion(\"3.0\")\r\n\r\n#define TF_CUDA_VERSION \"9.0\"\r\n#define TF_CUDNN_VERSION \"7.0.5\"\r\n\r\n#define TF_CUDA_TOOLKIT_PATH \"/usr/local/cuda-9.0\"\r\n\r\n#endif  // CUDA_CUDA_CONFIG_H_\r\n```\r\nI also had to make these changes to /usr/local/lib/python2.7/dist-packages/tensorflow/include/tensorflow/core/platform/default/mutex.h\r\n\r\n```\r\n#include \"/usr/local/lib/python2.7/dist-packages/tensorflow/include/external/nsync/public/nsync_cv.h\" // <- \"nsync_cv.h\"\r\n#include \"/usr/local/lib/python2.7/dist-packages/tensorflow/include/external/nsync/public/nsync_mu.h\" // <- \"nsync_mu.h\"\r\n```\r\nI compile my source code files as follows\r\n```\r\nnvcc -std=c++11 -c -o my_op_gpu.cu.o my_op_gpu.cu.cc -I $TF_INC -I /usr/local/ -I /usr/local/lib/python2.7/dist-packages/tensorflow/include/external/nsync/public -I /usr/local/cuda/include/ -D GOOGLE_CUDA=1 -x cu -Xcompiler -fPIC --expt-relaxed-constexpr\r\n\r\ng++ -std=c++11 -shared -D_GLIBCXX_USE_CXX_ABI=0 -o my_op.so my_op.cc my_op_gpu.cu.o -I $TF_INC -I /usr/local/lib/python2.7/dist-packages/tensorflow/include/external/nsync/public -D GOOGLE_CUDA=1 -L$TF_LIB -ltensorflow_framework -fPIC\r\n```\r\n\r\nwhere\r\n```\r\nTF_INC=$(python -c 'import tensorflow as tf; print(tf.sysconfig.get_include())')\r\nTF_LIB=$(python -c 'import tensorflow as tf; print(tf.sysconfig.get_lib())')\r\n```\r\n\r\nPlease help."}