{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17200", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17200/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17200/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17200/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/17200", "id": 299479451, "node_id": "MDU6SXNzdWUyOTk0Nzk0NTE=", "number": 17200, "title": "TimeDistributed wrapper works with \"standalone\" Keras, but not with \"built-in\" Keras", "user": {"login": "adamjones1", "id": 3438719, "node_id": "MDQ6VXNlcjM0Mzg3MTk=", "avatar_url": "https://avatars2.githubusercontent.com/u/3438719?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adamjones1", "html_url": "https://github.com/adamjones1", "followers_url": "https://api.github.com/users/adamjones1/followers", "following_url": "https://api.github.com/users/adamjones1/following{/other_user}", "gists_url": "https://api.github.com/users/adamjones1/gists{/gist_id}", "starred_url": "https://api.github.com/users/adamjones1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adamjones1/subscriptions", "organizations_url": "https://api.github.com/users/adamjones1/orgs", "repos_url": "https://api.github.com/users/adamjones1/repos", "events_url": "https://api.github.com/users/adamjones1/events{/privacy}", "received_events_url": "https://api.github.com/users/adamjones1/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "fchollet", "id": 710255, "node_id": "MDQ6VXNlcjcxMDI1NQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/710255?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fchollet", "html_url": "https://github.com/fchollet", "followers_url": "https://api.github.com/users/fchollet/followers", "following_url": "https://api.github.com/users/fchollet/following{/other_user}", "gists_url": "https://api.github.com/users/fchollet/gists{/gist_id}", "starred_url": "https://api.github.com/users/fchollet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fchollet/subscriptions", "organizations_url": "https://api.github.com/users/fchollet/orgs", "repos_url": "https://api.github.com/users/fchollet/repos", "events_url": "https://api.github.com/users/fchollet/events{/privacy}", "received_events_url": "https://api.github.com/users/fchollet/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "fchollet", "id": 710255, "node_id": "MDQ6VXNlcjcxMDI1NQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/710255?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fchollet", "html_url": "https://github.com/fchollet", "followers_url": "https://api.github.com/users/fchollet/followers", "following_url": "https://api.github.com/users/fchollet/following{/other_user}", "gists_url": "https://api.github.com/users/fchollet/gists{/gist_id}", "starred_url": "https://api.github.com/users/fchollet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fchollet/subscriptions", "organizations_url": "https://api.github.com/users/fchollet/orgs", "repos_url": "https://api.github.com/users/fchollet/repos", "events_url": "https://api.github.com/users/fchollet/events{/privacy}", "received_events_url": "https://api.github.com/users/fchollet/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2018-02-22T19:34:00Z", "updated_at": "2018-11-09T22:15:58Z", "closed_at": "2018-11-09T22:15:58Z", "author_association": "NONE", "body_html": "<p>The following lines worked with Keras (2.0.8) and Tensorflow (pre 1.4).</p>\n<p><code>input_tensor = Input((input_epochs_per_output_epoch, samples_per_epoch, features_per_epoch))</code></p>\n<p><code>inner_intermediate = TimeDistributed(BatchNormalization(axis = -1), name=\"bn_input\")(input_tensor)</code></p>\n<p><code>many lines...</code></p>\n<p><code>inner_out = TimeDistributed(Bidirectional(GRU(intermediate_features, return_sequences=False, recurrent_dropout=recurrent_dropout, dropout=normal_dropout, kernel_initializer=kernel_initializer, kernel_regularizer=l2(l2_lambda), implementation=lstm_implementation), merge_mode='concat'), name=\"inner_out\")(inner_intermediate)</code></p>\n<p>However, with Tensorflow 1.5.0, using the Keras within Tensorflow, the final line fails with:</p>\n<blockquote>\n<p>ValueError: as_list() is not defined on an unknown TensorShape.</p>\n</blockquote>\n<p>Because there are a lot of lines between 2 and 3, which have various layers wrapped by TimeDistributed, I've figured out that it is only GRU and LSTM layers that cause this error. I've tried specifying the input_shape for both the the wrappers and/or the layers themselves, to no avail.</p>", "body_text": "The following lines worked with Keras (2.0.8) and Tensorflow (pre 1.4).\ninput_tensor = Input((input_epochs_per_output_epoch, samples_per_epoch, features_per_epoch))\ninner_intermediate = TimeDistributed(BatchNormalization(axis = -1), name=\"bn_input\")(input_tensor)\nmany lines...\ninner_out = TimeDistributed(Bidirectional(GRU(intermediate_features, return_sequences=False, recurrent_dropout=recurrent_dropout, dropout=normal_dropout, kernel_initializer=kernel_initializer, kernel_regularizer=l2(l2_lambda), implementation=lstm_implementation), merge_mode='concat'), name=\"inner_out\")(inner_intermediate)\nHowever, with Tensorflow 1.5.0, using the Keras within Tensorflow, the final line fails with:\n\nValueError: as_list() is not defined on an unknown TensorShape.\n\nBecause there are a lot of lines between 2 and 3, which have various layers wrapped by TimeDistributed, I've figured out that it is only GRU and LSTM layers that cause this error. I've tried specifying the input_shape for both the the wrappers and/or the layers themselves, to no avail.", "body": "The following lines worked with Keras (2.0.8) and Tensorflow (pre 1.4).\r\n\r\n`input_tensor = Input((input_epochs_per_output_epoch, samples_per_epoch, features_per_epoch))`\r\n\r\n`inner_intermediate = TimeDistributed(BatchNormalization(axis = -1), name=\"bn_input\")(input_tensor)`\r\n\r\n`many lines...`\r\n\r\n`inner_out = TimeDistributed(Bidirectional(GRU(intermediate_features, return_sequences=False, recurrent_dropout=recurrent_dropout, dropout=normal_dropout, kernel_initializer=kernel_initializer, kernel_regularizer=l2(l2_lambda), implementation=lstm_implementation), merge_mode='concat'), name=\"inner_out\")(inner_intermediate)`\r\n\r\n\r\nHowever, with Tensorflow 1.5.0, using the Keras within Tensorflow, the final line fails with:\r\n> ValueError: as_list() is not defined on an unknown TensorShape.\r\n\r\nBecause there are a lot of lines between 2 and 3, which have various layers wrapped by TimeDistributed, I've figured out that it is only GRU and LSTM layers that cause this error. I've tried specifying the input_shape for both the the wrappers and/or the layers themselves, to no avail."}