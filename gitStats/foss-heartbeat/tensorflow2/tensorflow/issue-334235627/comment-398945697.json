{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/398945697", "html_url": "https://github.com/tensorflow/tensorflow/pull/20159#issuecomment-398945697", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20159", "id": 398945697, "node_id": "MDEyOklzc3VlQ29tbWVudDM5ODk0NTY5Nw==", "user": {"login": "d4l3k", "id": 909104, "node_id": "MDQ6VXNlcjkwOTEwNA==", "avatar_url": "https://avatars2.githubusercontent.com/u/909104?v=4", "gravatar_id": "", "url": "https://api.github.com/users/d4l3k", "html_url": "https://github.com/d4l3k", "followers_url": "https://api.github.com/users/d4l3k/followers", "following_url": "https://api.github.com/users/d4l3k/following{/other_user}", "gists_url": "https://api.github.com/users/d4l3k/gists{/gist_id}", "starred_url": "https://api.github.com/users/d4l3k/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/d4l3k/subscriptions", "organizations_url": "https://api.github.com/users/d4l3k/orgs", "repos_url": "https://api.github.com/users/d4l3k/repos", "events_url": "https://api.github.com/users/d4l3k/events{/privacy}", "received_events_url": "https://api.github.com/users/d4l3k/received_events", "type": "User", "site_admin": false}, "created_at": "2018-06-21T01:16:03Z", "updated_at": "2018-06-21T01:16:18Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Oh, it's happening under eager execution modes: <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/eager/pywrap_tensor.cc\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/eager/pywrap_tensor.cc</a></p>\n<p>I'm not sure why fill can't find a device, but the main difference under eager mode is that casting works with qint16 now. Graph mode appears to be unchanged for that test.</p>\n<p>Expected error under eager:</p>\n<pre><code>======================================================================\nERROR: testUnsupportedDtype (__main__.EmbedCheckCategoricalEventShapeTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/framework/test_util.py\", line 647, in decorated\n    run_eagerly(self, **kwargs)\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/framework/test_util.py\", line 639, in run_eagerly\n    f(self, **kwargs)\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/kernel_tests/distributions/util_test.py\", line 374, in testUnsupportedDtype\n    param = array_ops.ones([int(2**11+1)], dtype=dtypes.qint16)\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/ops/array_ops.py\", line 1687, in ones\n    output = fill(shape, constant(one, dtype=dtype), name=name)\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\nd 2 of 3):\n..2018-06-21 01:03:37.801623: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU support\ns instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\n...2018-06-21 01:03:38.108347: W tensorflow/core/framework/op_kernel.cc:1305] OP_REQUIRES failed at\n cast_op.cc:77 : Unimplemented: Cast int64 to qint16 is not supported\nE.............................\n======================================================================\nERROR: testUnsupportedDtype (__main__.EmbedCheckCategoricalEventShapeTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\now/tensorflow/python/framework/constant_op.py\", line 167, in constant\n    t = convert_to_eager_tensor(value, ctx, dtype)\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/framework/constant_op.py\", line 109, in convert_to_eager_tensor\n    t = ops.EagerTensor(value, context=handle, device=device, dtype=dtype)\nTypeError: Error while casting from DataType 9 to 15. Cast int64 to qint16 is not supported\n</code></pre>\n<p>Under graph mode there's a different expected error:</p>\n<pre><code>ERROR: testUnsupportedDtype (__main__.EmbedCheckCategoricalEventShapeTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/framework/test_util.py\", line 625, in decorated\n    f(self, **kwargs)\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/kernel_tests/distributions/util_test.py\", line 374, in testUnsupportedDtype\n    param = array_ops.ones([int(2**11+1)], dtype=dtypes.qint16)\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/ops/array_ops.py\", line 1687, in ones\n    output = fill(shape, constant(one, dtype=dtype), name=name)\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/framework/constant_op.py\", line 196, in constant\n    value, dtype=dtype, shape=shape, verify_shape=verify_shape))\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/framework/tensor_util.py\", line 436, in make_tensor_proto\n    _AssertCompatible(values, dtype)\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/framework/tensor_util.py\", line 347, in _AssertCompatible\n    (dtype.name, repr(mismatch), type(mismatch).__name__))\nTypeError: Expected qint16, got 1 of type 'int' instead.\n</code></pre>", "body_text": "Oh, it's happening under eager execution modes: https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/eager/pywrap_tensor.cc\nI'm not sure why fill can't find a device, but the main difference under eager mode is that casting works with qint16 now. Graph mode appears to be unchanged for that test.\nExpected error under eager:\n======================================================================\nERROR: testUnsupportedDtype (__main__.EmbedCheckCategoricalEventShapeTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/framework/test_util.py\", line 647, in decorated\n    run_eagerly(self, **kwargs)\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/framework/test_util.py\", line 639, in run_eagerly\n    f(self, **kwargs)\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/kernel_tests/distributions/util_test.py\", line 374, in testUnsupportedDtype\n    param = array_ops.ones([int(2**11+1)], dtype=dtypes.qint16)\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/ops/array_ops.py\", line 1687, in ones\n    output = fill(shape, constant(one, dtype=dtype), name=name)\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\nd 2 of 3):\n..2018-06-21 01:03:37.801623: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU support\ns instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\n...2018-06-21 01:03:38.108347: W tensorflow/core/framework/op_kernel.cc:1305] OP_REQUIRES failed at\n cast_op.cc:77 : Unimplemented: Cast int64 to qint16 is not supported\nE.............................\n======================================================================\nERROR: testUnsupportedDtype (__main__.EmbedCheckCategoricalEventShapeTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\now/tensorflow/python/framework/constant_op.py\", line 167, in constant\n    t = convert_to_eager_tensor(value, ctx, dtype)\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/framework/constant_op.py\", line 109, in convert_to_eager_tensor\n    t = ops.EagerTensor(value, context=handle, device=device, dtype=dtype)\nTypeError: Error while casting from DataType 9 to 15. Cast int64 to qint16 is not supported\n\nUnder graph mode there's a different expected error:\nERROR: testUnsupportedDtype (__main__.EmbedCheckCategoricalEventShapeTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/framework/test_util.py\", line 625, in decorated\n    f(self, **kwargs)\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/kernel_tests/distributions/util_test.py\", line 374, in testUnsupportedDtype\n    param = array_ops.ones([int(2**11+1)], dtype=dtypes.qint16)\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/ops/array_ops.py\", line 1687, in ones\n    output = fill(shape, constant(one, dtype=dtype), name=name)\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/framework/constant_op.py\", line 196, in constant\n    value, dtype=dtype, shape=shape, verify_shape=verify_shape))\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/framework/tensor_util.py\", line 436, in make_tensor_proto\n    _AssertCompatible(values, dtype)\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\now/tensorflow/python/framework/tensor_util.py\", line 347, in _AssertCompatible\n    (dtype.name, repr(mismatch), type(mismatch).__name__))\nTypeError: Expected qint16, got 1 of type 'int' instead.", "body": "Oh, it's happening under eager execution modes: https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/eager/pywrap_tensor.cc\r\n\r\nI'm not sure why fill can't find a device, but the main difference under eager mode is that casting works with qint16 now. Graph mode appears to be unchanged for that test.\r\n\r\nExpected error under eager:\r\n```\r\n======================================================================\r\nERROR: testUnsupportedDtype (__main__.EmbedCheckCategoricalEventShapeTest)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\r\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\r\now/tensorflow/python/framework/test_util.py\", line 647, in decorated\r\n    run_eagerly(self, **kwargs)\r\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\r\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\r\now/tensorflow/python/framework/test_util.py\", line 639, in run_eagerly\r\n    f(self, **kwargs)\r\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\r\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\r\now/tensorflow/python/kernel_tests/distributions/util_test.py\", line 374, in testUnsupportedDtype\r\n    param = array_ops.ones([int(2**11+1)], dtype=dtypes.qint16)\r\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\r\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\r\now/tensorflow/python/ops/array_ops.py\", line 1687, in ones\r\n    output = fill(shape, constant(one, dtype=dtype), name=name)\r\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\r\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\r\nd 2 of 3):\r\n..2018-06-21 01:03:37.801623: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU support\r\ns instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\r\n...2018-06-21 01:03:38.108347: W tensorflow/core/framework/op_kernel.cc:1305] OP_REQUIRES failed at\r\n cast_op.cc:77 : Unimplemented: Cast int64 to qint16 is not supported\r\nE.............................\r\n======================================================================\r\nERROR: testUnsupportedDtype (__main__.EmbedCheckCategoricalEventShapeTest)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\r\now/tensorflow/python/framework/constant_op.py\", line 167, in constant\r\n    t = convert_to_eager_tensor(value, ctx, dtype)\r\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\r\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\r\now/tensorflow/python/framework/constant_op.py\", line 109, in convert_to_eager_tensor\r\n    t = ops.EagerTensor(value, context=handle, device=device, dtype=dtype)\r\nTypeError: Error while casting from DataType 9 to 15. Cast int64 to qint16 is not supported\r\n```\r\n\r\nUnder graph mode there's a different expected error:\r\n```\r\nERROR: testUnsupportedDtype (__main__.EmbedCheckCategoricalEventShapeTest)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\r\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\r\now/tensorflow/python/framework/test_util.py\", line 625, in decorated\r\n    f(self, **kwargs)\r\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\r\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\r\now/tensorflow/python/kernel_tests/distributions/util_test.py\", line 374, in testUnsupportedDtype\r\n    param = array_ops.ones([int(2**11+1)], dtype=dtypes.qint16)\r\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\r\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\r\now/tensorflow/python/ops/array_ops.py\", line 1687, in ones\r\n    output = fill(shape, constant(one, dtype=dtype), name=name)\r\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\r\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\r\now/tensorflow/python/framework/constant_op.py\", line 196, in constant\r\n    value, dtype=dtype, shape=shape, verify_shape=verify_shape))\r\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\r\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\r\now/tensorflow/python/framework/tensor_util.py\", line 436, in make_tensor_proto\r\n    _AssertCompatible(values, dtype)\r\n  File \"/home/rice/.cache/bazel/_bazel_rice/d01f73017c98ae6e2acf29590b690a6c/execroot/org_tensorflo\r\nw/bazel-out/k8-dbg/bin/tensorflow/python/kernel_tests/distributions/util_test.runfiles/org_tensorfl\r\now/tensorflow/python/framework/tensor_util.py\", line 347, in _AssertCompatible\r\n    (dtype.name, repr(mismatch), type(mismatch).__name__))\r\nTypeError: Expected qint16, got 1 of type 'int' instead.\r\n```"}