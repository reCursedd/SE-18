{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6974", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6974/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6974/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6974/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/6974", "id": 202083329, "node_id": "MDU6SXNzdWUyMDIwODMzMjk=", "number": 6974, "title": "Race condition in EventFileWriter", "user": {"login": "gibiansky", "id": 1865411, "node_id": "MDQ6VXNlcjE4NjU0MTE=", "avatar_url": "https://avatars3.githubusercontent.com/u/1865411?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gibiansky", "html_url": "https://github.com/gibiansky", "followers_url": "https://api.github.com/users/gibiansky/followers", "following_url": "https://api.github.com/users/gibiansky/following{/other_user}", "gists_url": "https://api.github.com/users/gibiansky/gists{/gist_id}", "starred_url": "https://api.github.com/users/gibiansky/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gibiansky/subscriptions", "organizations_url": "https://api.github.com/users/gibiansky/orgs", "repos_url": "https://api.github.com/users/gibiansky/repos", "events_url": "https://api.github.com/users/gibiansky/events{/privacy}", "received_events_url": "https://api.github.com/users/gibiansky/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "suharshs", "id": 1450614, "node_id": "MDQ6VXNlcjE0NTA2MTQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/1450614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/suharshs", "html_url": "https://github.com/suharshs", "followers_url": "https://api.github.com/users/suharshs/followers", "following_url": "https://api.github.com/users/suharshs/following{/other_user}", "gists_url": "https://api.github.com/users/suharshs/gists{/gist_id}", "starred_url": "https://api.github.com/users/suharshs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/suharshs/subscriptions", "organizations_url": "https://api.github.com/users/suharshs/orgs", "repos_url": "https://api.github.com/users/suharshs/repos", "events_url": "https://api.github.com/users/suharshs/events{/privacy}", "received_events_url": "https://api.github.com/users/suharshs/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "suharshs", "id": 1450614, "node_id": "MDQ6VXNlcjE0NTA2MTQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/1450614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/suharshs", "html_url": "https://github.com/suharshs", "followers_url": "https://api.github.com/users/suharshs/followers", "following_url": "https://api.github.com/users/suharshs/following{/other_user}", "gists_url": "https://api.github.com/users/suharshs/gists{/gist_id}", "starred_url": "https://api.github.com/users/suharshs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/suharshs/subscriptions", "organizations_url": "https://api.github.com/users/suharshs/orgs", "repos_url": "https://api.github.com/users/suharshs/repos", "events_url": "https://api.github.com/users/suharshs/events{/privacy}", "received_events_url": "https://api.github.com/users/suharshs/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 9, "created_at": "2017-01-20T08:41:50Z", "updated_at": "2017-01-24T20:56:34Z", "closed_at": "2017-01-24T20:56:34Z", "author_association": "CONTRIBUTOR", "body_html": "<p>There is a race condition here in <code>EventFileWriter</code>: <a href=\"https://github.com/tensorflow/tensorflow/blob/287db3a9b0701021f302e7bb58af5cf89fdcd424/tensorflow/python/summary/writer/event_file_writer.py#L68\">here</a></p>\n<div class=\"highlight highlight-source-python\"><pre>    <span class=\"pl-k\">if</span> <span class=\"pl-k\">not</span> gfile.IsDirectory(<span class=\"pl-c1\">self</span>._logdir):\n      gfile.MakeDirs(<span class=\"pl-c1\">self</span>._logdir)</pre></div>\n<p>It is possible for multiple concurrent threads and/or processes to get to this code simultaneously, both check <code>IsDirectory</code>, return <code>False</code>, then both try creating the directory, and have one succeed and one error.</p>\n<p>This can be fixed by by catching the <code>AlreadyExistsError</code> from <code>MakeDirs</code> and handling it gracefully.</p>\n<p>(this is a real issue that we have encountered in daily usage and causes us issues, not just a hypothetical)</p>", "body_text": "There is a race condition here in EventFileWriter: here\n    if not gfile.IsDirectory(self._logdir):\n      gfile.MakeDirs(self._logdir)\nIt is possible for multiple concurrent threads and/or processes to get to this code simultaneously, both check IsDirectory, return False, then both try creating the directory, and have one succeed and one error.\nThis can be fixed by by catching the AlreadyExistsError from MakeDirs and handling it gracefully.\n(this is a real issue that we have encountered in daily usage and causes us issues, not just a hypothetical)", "body": "There is a race condition here in `EventFileWriter`: [here](https://github.com/tensorflow/tensorflow/blob/287db3a9b0701021f302e7bb58af5cf89fdcd424/tensorflow/python/summary/writer/event_file_writer.py#L68)\r\n\r\n```python\r\n    if not gfile.IsDirectory(self._logdir):\r\n      gfile.MakeDirs(self._logdir)\r\n```\r\n\r\nIt is possible for multiple concurrent threads and/or processes to get to this code simultaneously, both check `IsDirectory`, return `False`, then both try creating the directory, and have one succeed and one error.\r\n\r\nThis can be fixed by by catching the `AlreadyExistsError` from `MakeDirs` and handling it gracefully.\r\n\r\n(this is a real issue that we have encountered in daily usage and causes us issues, not just a hypothetical)"}