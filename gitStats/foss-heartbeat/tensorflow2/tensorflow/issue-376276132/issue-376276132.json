{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23420", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23420/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23420/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23420/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23420", "id": 376276132, "node_id": "MDU6SXNzdWUzNzYyNzYxMzI=", "number": 23420, "title": "bazel build on Windows with mkl failed", "user": {"login": "ufgtb24", "id": 22524859, "node_id": "MDQ6VXNlcjIyNTI0ODU5", "avatar_url": "https://avatars3.githubusercontent.com/u/22524859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ufgtb24", "html_url": "https://github.com/ufgtb24", "followers_url": "https://api.github.com/users/ufgtb24/followers", "following_url": "https://api.github.com/users/ufgtb24/following{/other_user}", "gists_url": "https://api.github.com/users/ufgtb24/gists{/gist_id}", "starred_url": "https://api.github.com/users/ufgtb24/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ufgtb24/subscriptions", "organizations_url": "https://api.github.com/users/ufgtb24/orgs", "repos_url": "https://api.github.com/users/ufgtb24/repos", "events_url": "https://api.github.com/users/ufgtb24/events{/privacy}", "received_events_url": "https://api.github.com/users/ufgtb24/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1104829434, "node_id": "MDU6TGFiZWwxMTA0ODI5NDM0", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:mkl", "name": "comp:mkl", "color": "0052cc", "default": false}, {"id": 473173351, "node_id": "MDU6TGFiZWw0NzMxNzMzNTE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:build/install", "name": "type:build/install", "color": "159b2e", "default": false}], "state": "open", "locked": false, "assignee": {"login": "TensorFlow-MKL", "id": 44416303, "node_id": "MDQ6VXNlcjQ0NDE2MzAz", "avatar_url": "https://avatars2.githubusercontent.com/u/44416303?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TensorFlow-MKL", "html_url": "https://github.com/TensorFlow-MKL", "followers_url": "https://api.github.com/users/TensorFlow-MKL/followers", "following_url": "https://api.github.com/users/TensorFlow-MKL/following{/other_user}", "gists_url": "https://api.github.com/users/TensorFlow-MKL/gists{/gist_id}", "starred_url": "https://api.github.com/users/TensorFlow-MKL/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TensorFlow-MKL/subscriptions", "organizations_url": "https://api.github.com/users/TensorFlow-MKL/orgs", "repos_url": "https://api.github.com/users/TensorFlow-MKL/repos", "events_url": "https://api.github.com/users/TensorFlow-MKL/events{/privacy}", "received_events_url": "https://api.github.com/users/TensorFlow-MKL/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "TensorFlow-MKL", "id": 44416303, "node_id": "MDQ6VXNlcjQ0NDE2MzAz", "avatar_url": "https://avatars2.githubusercontent.com/u/44416303?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TensorFlow-MKL", "html_url": "https://github.com/TensorFlow-MKL", "followers_url": "https://api.github.com/users/TensorFlow-MKL/followers", "following_url": "https://api.github.com/users/TensorFlow-MKL/following{/other_user}", "gists_url": "https://api.github.com/users/TensorFlow-MKL/gists{/gist_id}", "starred_url": "https://api.github.com/users/TensorFlow-MKL/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TensorFlow-MKL/subscriptions", "organizations_url": "https://api.github.com/users/TensorFlow-MKL/orgs", "repos_url": "https://api.github.com/users/TensorFlow-MKL/repos", "events_url": "https://api.github.com/users/TensorFlow-MKL/events{/privacy}", "received_events_url": "https://api.github.com/users/TensorFlow-MKL/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2018-11-01T06:56:21Z", "updated_at": "2018-11-23T18:37:22Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>I'm trying to compile tensorflow with MKL support on Windows 10 64bit via Bazel with command:<br>\n<code>bazel build --config=mkl --config=opt //tensorflow/tools/pip_package:build_pip_package</code><br>\non the following environments:</p>\n<ul>\n<li>Windows 10 64 bit</li>\n<li>Tensorflow 1.12</li>\n<li>Python 3.6.6</li>\n<li>Bazel 0.18</li>\n</ul>\n<p>On the same setup, I can successfully build it without --config=mkl term,  but when building with mkl it failed as following:<br>\nwho can tell me if it has anything related to mkl?</p>\n<pre><code>ERROR: F:/tools/tf1.12/tensorflow/tensorflow/python/BUILD:3766:1: Linking of rule '//tensorflow/python:_pywrap_tensorflow_internal.so' failed (Exit 1000): link.exe failed: error executing command\n  cd C:/users/10267/_bazel_10267/udaytyio/execroot/org_tensorflow\n  SET LIB=C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\LIB\\amd64;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\ATLMFC\\LIB\\amd64;C:\\Program Files (x86)\\Windows Kits\\10\\lib\\10.0.10240.0\\ucrt\\x64;C:\\Program Files (x86)\\Windows Kits\\NETFXSDK\\4.6.1\\lib\\um\\x64;C:\\Program Files (x86)\\Windows Kits\\8.1\\lib\\winv6.3\\um\\x64;\n    SET PATH=C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\Common7\\IDE\\CommonExtensions\\Microsoft\\TestWindow;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\BIN\\amd64;C:\\WINDOWS\\Microsoft.NET\\Framework64\\v4.0.30319;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\VCPackages;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\Common7\\IDE;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\Common7\\Tools;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\Team Tools\\Performance Tools\\x64;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\Team Tools\\Performance Tools;C:\\Program Files (x86)\\Windows Kits\\8.1\\bin\\x64;C:\\Program Files (x86)\\Windows Kits\\8.1\\bin\\x86;C:\\Program Files (x86)\\Microsoft SDKs\\Windows\\v10.0A\\bin\\NETFX 4.6.1 Tools\\x64\\;;C:\\WINDOWS\\system32\n    SET PWD=/proc/self/cwd\n    SET PYTHON_BIN_PATH=C:/Program Files/Python36/python.exe\n    SET PYTHON_LIB_PATH=C:/Program Files/Python36/lib/site-packages\n    SET TEMP=C:\\Users\\10267\\AppData\\Local\\Temp\n    SET TF_DOWNLOAD_CLANG=0\n    SET TF_NEED_CUDA=0\n    SET TF_NEED_OPENCL_SYCL=0\n    SET TMP=C:\\Users\\10267\\AppData\\Local\\Temp\n  C:/Program Files (x86)/Microsoft Visual Studio 14.0/VC/bin/amd64/link.exe /nologo /DLL /SUBSYSTEM:CONSOLE -defaultlib:advapi32.lib -DEFAULTLIB:advapi32.lib /MACHINE:X64 @bazel-out/x64_windows-opt/bin/tensorflow/python/_pywrap_tensorflow_internal.so-2.params /OPT:ICF /OPT:REF /DEF:bazel-out/x64_windows-opt/genfiles/tensorflow/python/pywrap_tensorflow_filtered_def_file.def /ignore:4070\nLINK : warning LNK4044: unrecognized option '/lpthread'; ignored\n\nbazel-out/x64_windows-opt/bin/external/nsync/nsync_cpp.lib : fatal error LNK1000: Internal error during CImplib::EmitThunk\n\n  Version 14.00.24215.1\n\n  ExceptionCode            = C0000005\n  ExceptionFlags           = 00000000\n  ExceptionAddress         = 00007FF7E0686896 (00007FF7E0670000) \"C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\bin\\amd64\\link.exe\"\n  NumberParameters         = 00000002\n  ExceptionInformation[ 0] = 0000000000000000\n  ExceptionInformation[ 1] = 0000000000000008\n\nCONTEXT:\n  Rax    = 0000000000000000  R8     = 00007FF7E076FBE0\n  Rbx    = 0000000000000000  R9     = 00007FF7E076E9F0\n  Rcx    = 0000000000000000  R10    = 0000000000000000\n  Rdx    = 00007FF7E076FBD8  R11    = 0000000000000000\n  Rsp    = 000000082B71DE68  R12    = 00007FF7E073D950\n  Rbp    = 000001A60F8F8360  E13    = 0000000000000000\n  Rsi    = 0000000000008000  R14    = 0000000000000000\n  Rdi    = 000001A6102AA300  R15    = 0000000000000000\n  Rip    = 00007FF7E0686896  EFlags = 0000000000010246\n  SegCs  = 0000000000000033  SegDs  = 000000000000002B\n  SegSs  = 000000000000002B  SegEs  = 000000000000002B\n  SegFs  = 0000000000000053  SegGs  = 000000000000002B\n  Dr0    = 0000000000000000  Dr3    = 0000000000000000\n  Dr1    = 0000000000000000  Dr6    = 0000000000000000\n  Dr2    = 0000000000000000  Dr7    = 0000000000000000\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\nINFO: Elapsed time: 3172.917s, Critical Path: 253.76s\nINFO: 3875 processes: 3875 local.\nFAILED: Build did NOT complete successfully\n</code></pre>", "body_text": "I'm trying to compile tensorflow with MKL support on Windows 10 64bit via Bazel with command:\nbazel build --config=mkl --config=opt //tensorflow/tools/pip_package:build_pip_package\non the following environments:\n\nWindows 10 64 bit\nTensorflow 1.12\nPython 3.6.6\nBazel 0.18\n\nOn the same setup, I can successfully build it without --config=mkl term,  but when building with mkl it failed as following:\nwho can tell me if it has anything related to mkl?\nERROR: F:/tools/tf1.12/tensorflow/tensorflow/python/BUILD:3766:1: Linking of rule '//tensorflow/python:_pywrap_tensorflow_internal.so' failed (Exit 1000): link.exe failed: error executing command\n  cd C:/users/10267/_bazel_10267/udaytyio/execroot/org_tensorflow\n  SET LIB=C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\LIB\\amd64;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\ATLMFC\\LIB\\amd64;C:\\Program Files (x86)\\Windows Kits\\10\\lib\\10.0.10240.0\\ucrt\\x64;C:\\Program Files (x86)\\Windows Kits\\NETFXSDK\\4.6.1\\lib\\um\\x64;C:\\Program Files (x86)\\Windows Kits\\8.1\\lib\\winv6.3\\um\\x64;\n    SET PATH=C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\Common7\\IDE\\CommonExtensions\\Microsoft\\TestWindow;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\BIN\\amd64;C:\\WINDOWS\\Microsoft.NET\\Framework64\\v4.0.30319;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\VCPackages;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\Common7\\IDE;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\Common7\\Tools;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\Team Tools\\Performance Tools\\x64;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\Team Tools\\Performance Tools;C:\\Program Files (x86)\\Windows Kits\\8.1\\bin\\x64;C:\\Program Files (x86)\\Windows Kits\\8.1\\bin\\x86;C:\\Program Files (x86)\\Microsoft SDKs\\Windows\\v10.0A\\bin\\NETFX 4.6.1 Tools\\x64\\;;C:\\WINDOWS\\system32\n    SET PWD=/proc/self/cwd\n    SET PYTHON_BIN_PATH=C:/Program Files/Python36/python.exe\n    SET PYTHON_LIB_PATH=C:/Program Files/Python36/lib/site-packages\n    SET TEMP=C:\\Users\\10267\\AppData\\Local\\Temp\n    SET TF_DOWNLOAD_CLANG=0\n    SET TF_NEED_CUDA=0\n    SET TF_NEED_OPENCL_SYCL=0\n    SET TMP=C:\\Users\\10267\\AppData\\Local\\Temp\n  C:/Program Files (x86)/Microsoft Visual Studio 14.0/VC/bin/amd64/link.exe /nologo /DLL /SUBSYSTEM:CONSOLE -defaultlib:advapi32.lib -DEFAULTLIB:advapi32.lib /MACHINE:X64 @bazel-out/x64_windows-opt/bin/tensorflow/python/_pywrap_tensorflow_internal.so-2.params /OPT:ICF /OPT:REF /DEF:bazel-out/x64_windows-opt/genfiles/tensorflow/python/pywrap_tensorflow_filtered_def_file.def /ignore:4070\nLINK : warning LNK4044: unrecognized option '/lpthread'; ignored\n\nbazel-out/x64_windows-opt/bin/external/nsync/nsync_cpp.lib : fatal error LNK1000: Internal error during CImplib::EmitThunk\n\n  Version 14.00.24215.1\n\n  ExceptionCode            = C0000005\n  ExceptionFlags           = 00000000\n  ExceptionAddress         = 00007FF7E0686896 (00007FF7E0670000) \"C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\bin\\amd64\\link.exe\"\n  NumberParameters         = 00000002\n  ExceptionInformation[ 0] = 0000000000000000\n  ExceptionInformation[ 1] = 0000000000000008\n\nCONTEXT:\n  Rax    = 0000000000000000  R8     = 00007FF7E076FBE0\n  Rbx    = 0000000000000000  R9     = 00007FF7E076E9F0\n  Rcx    = 0000000000000000  R10    = 0000000000000000\n  Rdx    = 00007FF7E076FBD8  R11    = 0000000000000000\n  Rsp    = 000000082B71DE68  R12    = 00007FF7E073D950\n  Rbp    = 000001A60F8F8360  E13    = 0000000000000000\n  Rsi    = 0000000000008000  R14    = 0000000000000000\n  Rdi    = 000001A6102AA300  R15    = 0000000000000000\n  Rip    = 00007FF7E0686896  EFlags = 0000000000010246\n  SegCs  = 0000000000000033  SegDs  = 000000000000002B\n  SegSs  = 000000000000002B  SegEs  = 000000000000002B\n  SegFs  = 0000000000000053  SegGs  = 000000000000002B\n  Dr0    = 0000000000000000  Dr3    = 0000000000000000\n  Dr1    = 0000000000000000  Dr6    = 0000000000000000\n  Dr2    = 0000000000000000  Dr7    = 0000000000000000\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\nINFO: Elapsed time: 3172.917s, Critical Path: 253.76s\nINFO: 3875 processes: 3875 local.\nFAILED: Build did NOT complete successfully", "body": "I'm trying to compile tensorflow with MKL support on Windows 10 64bit via Bazel with command:\r\n`bazel build --config=mkl --config=opt //tensorflow/tools/pip_package:build_pip_package`\r\non the following environments:\r\n- Windows 10 64 bit\r\n- Tensorflow 1.12\r\n- Python 3.6.6\r\n- Bazel 0.18\r\n\r\nOn the same setup, I can successfully build it without --config=mkl term,  but when building with mkl it failed as following:\r\nwho can tell me if it has anything related to mkl?\r\n```\r\nERROR: F:/tools/tf1.12/tensorflow/tensorflow/python/BUILD:3766:1: Linking of rule '//tensorflow/python:_pywrap_tensorflow_internal.so' failed (Exit 1000): link.exe failed: error executing command\r\n  cd C:/users/10267/_bazel_10267/udaytyio/execroot/org_tensorflow\r\n  SET LIB=C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\LIB\\amd64;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\ATLMFC\\LIB\\amd64;C:\\Program Files (x86)\\Windows Kits\\10\\lib\\10.0.10240.0\\ucrt\\x64;C:\\Program Files (x86)\\Windows Kits\\NETFXSDK\\4.6.1\\lib\\um\\x64;C:\\Program Files (x86)\\Windows Kits\\8.1\\lib\\winv6.3\\um\\x64;\r\n    SET PATH=C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\Common7\\IDE\\CommonExtensions\\Microsoft\\TestWindow;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\BIN\\amd64;C:\\WINDOWS\\Microsoft.NET\\Framework64\\v4.0.30319;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\VCPackages;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\Common7\\IDE;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\Common7\\Tools;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\Team Tools\\Performance Tools\\x64;C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\Team Tools\\Performance Tools;C:\\Program Files (x86)\\Windows Kits\\8.1\\bin\\x64;C:\\Program Files (x86)\\Windows Kits\\8.1\\bin\\x86;C:\\Program Files (x86)\\Microsoft SDKs\\Windows\\v10.0A\\bin\\NETFX 4.6.1 Tools\\x64\\;;C:\\WINDOWS\\system32\r\n    SET PWD=/proc/self/cwd\r\n    SET PYTHON_BIN_PATH=C:/Program Files/Python36/python.exe\r\n    SET PYTHON_LIB_PATH=C:/Program Files/Python36/lib/site-packages\r\n    SET TEMP=C:\\Users\\10267\\AppData\\Local\\Temp\r\n    SET TF_DOWNLOAD_CLANG=0\r\n    SET TF_NEED_CUDA=0\r\n    SET TF_NEED_OPENCL_SYCL=0\r\n    SET TMP=C:\\Users\\10267\\AppData\\Local\\Temp\r\n  C:/Program Files (x86)/Microsoft Visual Studio 14.0/VC/bin/amd64/link.exe /nologo /DLL /SUBSYSTEM:CONSOLE -defaultlib:advapi32.lib -DEFAULTLIB:advapi32.lib /MACHINE:X64 @bazel-out/x64_windows-opt/bin/tensorflow/python/_pywrap_tensorflow_internal.so-2.params /OPT:ICF /OPT:REF /DEF:bazel-out/x64_windows-opt/genfiles/tensorflow/python/pywrap_tensorflow_filtered_def_file.def /ignore:4070\r\nLINK : warning LNK4044: unrecognized option '/lpthread'; ignored\r\n\r\nbazel-out/x64_windows-opt/bin/external/nsync/nsync_cpp.lib : fatal error LNK1000: Internal error during CImplib::EmitThunk\r\n\r\n  Version 14.00.24215.1\r\n\r\n  ExceptionCode            = C0000005\r\n  ExceptionFlags           = 00000000\r\n  ExceptionAddress         = 00007FF7E0686896 (00007FF7E0670000) \"C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\bin\\amd64\\link.exe\"\r\n  NumberParameters         = 00000002\r\n  ExceptionInformation[ 0] = 0000000000000000\r\n  ExceptionInformation[ 1] = 0000000000000008\r\n\r\nCONTEXT:\r\n  Rax    = 0000000000000000  R8     = 00007FF7E076FBE0\r\n  Rbx    = 0000000000000000  R9     = 00007FF7E076E9F0\r\n  Rcx    = 0000000000000000  R10    = 0000000000000000\r\n  Rdx    = 00007FF7E076FBD8  R11    = 0000000000000000\r\n  Rsp    = 000000082B71DE68  R12    = 00007FF7E073D950\r\n  Rbp    = 000001A60F8F8360  E13    = 0000000000000000\r\n  Rsi    = 0000000000008000  R14    = 0000000000000000\r\n  Rdi    = 000001A6102AA300  R15    = 0000000000000000\r\n  Rip    = 00007FF7E0686896  EFlags = 0000000000010246\r\n  SegCs  = 0000000000000033  SegDs  = 000000000000002B\r\n  SegSs  = 000000000000002B  SegEs  = 000000000000002B\r\n  SegFs  = 0000000000000053  SegGs  = 000000000000002B\r\n  Dr0    = 0000000000000000  Dr3    = 0000000000000000\r\n  Dr1    = 0000000000000000  Dr6    = 0000000000000000\r\n  Dr2    = 0000000000000000  Dr7    = 0000000000000000\r\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\r\nINFO: Elapsed time: 3172.917s, Critical Path: 253.76s\r\nINFO: 3875 processes: 3875 local.\r\nFAILED: Build did NOT complete successfully\r\n```\r\n\r\n\r\n\r\n\r\n\r\n"}