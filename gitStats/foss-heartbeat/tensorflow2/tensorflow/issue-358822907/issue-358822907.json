{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22201", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22201/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22201/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22201/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/22201", "id": 358822907, "node_id": "MDU6SXNzdWUzNTg4MjI5MDc=", "number": 22201, "title": "Fall 2018 Symposium Performance Talk Notes", "user": {"login": "tfboyd", "id": 23486130, "node_id": "MDQ6VXNlcjIzNDg2MTMw", "avatar_url": "https://avatars1.githubusercontent.com/u/23486130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tfboyd", "html_url": "https://github.com/tfboyd", "followers_url": "https://api.github.com/users/tfboyd/followers", "following_url": "https://api.github.com/users/tfboyd/following{/other_user}", "gists_url": "https://api.github.com/users/tfboyd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tfboyd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tfboyd/subscriptions", "organizations_url": "https://api.github.com/users/tfboyd/orgs", "repos_url": "https://api.github.com/users/tfboyd/repos", "events_url": "https://api.github.com/users/tfboyd/events{/privacy}", "received_events_url": "https://api.github.com/users/tfboyd/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 996845227, "node_id": "MDU6TGFiZWw5OTY4NDUyMjc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:dist-strat", "name": "comp:dist-strat", "color": "0052cc", "default": false}, {"id": 284443156, "node_id": "MDU6TGFiZWwyODQ0NDMxNTY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:docs", "name": "type:docs", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "tfboyd", "id": 23486130, "node_id": "MDQ6VXNlcjIzNDg2MTMw", "avatar_url": "https://avatars1.githubusercontent.com/u/23486130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tfboyd", "html_url": "https://github.com/tfboyd", "followers_url": "https://api.github.com/users/tfboyd/followers", "following_url": "https://api.github.com/users/tfboyd/following{/other_user}", "gists_url": "https://api.github.com/users/tfboyd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tfboyd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tfboyd/subscriptions", "organizations_url": "https://api.github.com/users/tfboyd/orgs", "repos_url": "https://api.github.com/users/tfboyd/repos", "events_url": "https://api.github.com/users/tfboyd/events{/privacy}", "received_events_url": "https://api.github.com/users/tfboyd/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "tfboyd", "id": 23486130, "node_id": "MDQ6VXNlcjIzNDg2MTMw", "avatar_url": "https://avatars1.githubusercontent.com/u/23486130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tfboyd", "html_url": "https://github.com/tfboyd", "followers_url": "https://api.github.com/users/tfboyd/followers", "following_url": "https://api.github.com/users/tfboyd/following{/other_user}", "gists_url": "https://api.github.com/users/tfboyd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tfboyd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tfboyd/subscriptions", "organizations_url": "https://api.github.com/users/tfboyd/orgs", "repos_url": "https://api.github.com/users/tfboyd/repos", "events_url": "https://api.github.com/users/tfboyd/events{/privacy}", "received_events_url": "https://api.github.com/users/tfboyd/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2018-09-10T22:49:30Z", "updated_at": "2018-09-24T04:50:46Z", "closed_at": "2018-09-18T20:42:36Z", "author_association": "MEMBER", "body_html": "<p>There were additional topics discussed that could not be turned into coherent notes after the fact.</p>\n<h2>Action items</h2>\n<ul>\n<li>TensorFlow team to create a block diagram and then go deeper.  Goal is to help people who want to contribute plugins or extensions. <a href=\"https://github.com/tensorflow/tensorflow/issues/22356\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/22356/hovercard\">#22356</a></li>\n<li>Make the NVIDIA Library to TF Version matrix more visible and consider better error messages. <a href=\"https://github.com/tensorflow/tensorflow/issues/22357\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/22357/hovercard\">#22357</a></li>\n<li>Document tips and methods to use for large batch scaling with TensorFlow.  Possibly mention where this is proven and unproven to work.  This would include adding optimizers or wrapper to simplify usage.  Researchers are large labs want to scale but do not have the knowledge to do it quickly. <a href=\"https://github.com/tensorflow/tensorflow/issues/22358\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/22358/hovercard\">#22358</a></li>\n</ul>\n<h2>General Questions and discussion results</h2>\n<ul>\n<li>Should TensorFlow default builds move forward more aggressively with newer versions of CUDA/cuDNN?\n<ul>\n<li>Internally Google moves slowly to new versions of CUDA as the verification process is long and often includes multiple patches with NVIDIA until all edge cases are covered.  The bar is extremely high for obvious reasons.</li>\n<li>Group thought was it doesn\u2019t matter. Situation would be improved with better error messages indicating what version is needed and making the matrix showing what NVIDIA libs are needed for each TensorFlow version.</li>\n</ul>\n</li>\n<li>Provide more models with good performance and accuracy in github.com/tensorflow/models.  Too many different versions and unsure which one to use.  Example:  There are 3+ ResNet models.\n<ul>\n<li>Contact tfboyd@ or comment in this thread if there is a specific model of interest and why.  MLPerf may improve this situation.</li>\n</ul>\n</li>\n<li>Auto regressive models with long dependency chains are hard to optimize by doing fusion by hand.\n<ul>\n<li>Consider trying XLA and providing feedback. An objective of XLA is to reduce the need for custom fusion.</li>\n</ul>\n</li>\n<li>[Ask] Distributing the input pipeline across servers.  Some work has been done and rumored to have occured in production but not trivial to setup.  Consider an RFP and/or reach out to the tf.data team.</li>\n<li>TensorCores are only used if you are using tf.16.  You can do Pseudo FP16 with an envar that should be in TF 1.11 from NVIDIA as an experimental feature.  You still need to do loss scaling.</li>\n</ul>\n<h2>Debugging and performance investigations</h2>\n<ul>\n<li>Hard to get timelines and profiler results.\n<ul>\n<li>New guide is on the way, not positive this will make it as easy as desired.</li>\n</ul>\n</li>\n<li>[Ask] Provide an interface to autotuning parameters such as intra and inter thread pools.\n<ul>\n<li>In hindsight, more information is needed to make this actionable.  Please add info to the comments.</li>\n</ul>\n</li>\n</ul>\n<h2>Distributed compute (multi-gpu and multi-node)</h2>\n<ul>\n<li>\n<p>All reduce API for multi-node and support MPI.</p>\n<ul>\n<li>MPI would be useful for supercomputers where you need to use their MPI library to get good communication.</li>\n<li>NCCL currently used by MirroredStrategy but only for multi-GPU.  TensorFlow\u2019s own <code>ops</code> are used for multi-node all-reduce.</li>\n</ul>\n</li>\n<li>\n<p>Document on how the distribution strategies is setup with the goal of showing how others can add their own solution and collective ops.  The API is the best place right now to figure this out.</p>\n</li>\n<li>\n<p>[AI] TensorFlow team to create a block diagram and then go deeper.  Goal is to help people who want to contribute plugins or extensions.</p>\n</li>\n<li>\n<p>Having a hard time with MPI.  People are using a newer versions of MPI</p>\n</li>\n<li>\n<p>How do we plan to support fault tolerance? Will it allow dynamic addition and removal of machines to the collective. E.g. preemption but keep training with a smaller pool. Also increasing machines &amp; batch size as training progresses. Need to adjust the learning rate, so maybe get a callback, especially when you are going to lose or have just lost a machine. Response to call back is starting with revised set of machines an new learning rate.<br>\n*[AI] Document strategies for large batch training.  LARS looking to automatic learning rate, warmup rate and stuff.</p>\n</li>\n</ul>\n<h2>Model parallelism and Data parallelism</h2>\n<ul>\n<li>Model parallelism is currently manual.  Work to automate it is on going and it can be phrased as an RL problem.</li>\n<li>Data parallelism supported via MirroredStrategy discussed today</li>\n</ul>", "body_text": "There were additional topics discussed that could not be turned into coherent notes after the fact.\nAction items\n\nTensorFlow team to create a block diagram and then go deeper.  Goal is to help people who want to contribute plugins or extensions. #22356\nMake the NVIDIA Library to TF Version matrix more visible and consider better error messages. #22357\nDocument tips and methods to use for large batch scaling with TensorFlow.  Possibly mention where this is proven and unproven to work.  This would include adding optimizers or wrapper to simplify usage.  Researchers are large labs want to scale but do not have the knowledge to do it quickly. #22358\n\nGeneral Questions and discussion results\n\nShould TensorFlow default builds move forward more aggressively with newer versions of CUDA/cuDNN?\n\nInternally Google moves slowly to new versions of CUDA as the verification process is long and often includes multiple patches with NVIDIA until all edge cases are covered.  The bar is extremely high for obvious reasons.\nGroup thought was it doesn\u2019t matter. Situation would be improved with better error messages indicating what version is needed and making the matrix showing what NVIDIA libs are needed for each TensorFlow version.\n\n\nProvide more models with good performance and accuracy in github.com/tensorflow/models.  Too many different versions and unsure which one to use.  Example:  There are 3+ ResNet models.\n\nContact tfboyd@ or comment in this thread if there is a specific model of interest and why.  MLPerf may improve this situation.\n\n\nAuto regressive models with long dependency chains are hard to optimize by doing fusion by hand.\n\nConsider trying XLA and providing feedback. An objective of XLA is to reduce the need for custom fusion.\n\n\n[Ask] Distributing the input pipeline across servers.  Some work has been done and rumored to have occured in production but not trivial to setup.  Consider an RFP and/or reach out to the tf.data team.\nTensorCores are only used if you are using tf.16.  You can do Pseudo FP16 with an envar that should be in TF 1.11 from NVIDIA as an experimental feature.  You still need to do loss scaling.\n\nDebugging and performance investigations\n\nHard to get timelines and profiler results.\n\nNew guide is on the way, not positive this will make it as easy as desired.\n\n\n[Ask] Provide an interface to autotuning parameters such as intra and inter thread pools.\n\nIn hindsight, more information is needed to make this actionable.  Please add info to the comments.\n\n\n\nDistributed compute (multi-gpu and multi-node)\n\n\nAll reduce API for multi-node and support MPI.\n\nMPI would be useful for supercomputers where you need to use their MPI library to get good communication.\nNCCL currently used by MirroredStrategy but only for multi-GPU.  TensorFlow\u2019s own ops are used for multi-node all-reduce.\n\n\n\nDocument on how the distribution strategies is setup with the goal of showing how others can add their own solution and collective ops.  The API is the best place right now to figure this out.\n\n\n[AI] TensorFlow team to create a block diagram and then go deeper.  Goal is to help people who want to contribute plugins or extensions.\n\n\nHaving a hard time with MPI.  People are using a newer versions of MPI\n\n\nHow do we plan to support fault tolerance? Will it allow dynamic addition and removal of machines to the collective. E.g. preemption but keep training with a smaller pool. Also increasing machines & batch size as training progresses. Need to adjust the learning rate, so maybe get a callback, especially when you are going to lose or have just lost a machine. Response to call back is starting with revised set of machines an new learning rate.\n*[AI] Document strategies for large batch training.  LARS looking to automatic learning rate, warmup rate and stuff.\n\n\nModel parallelism and Data parallelism\n\nModel parallelism is currently manual.  Work to automate it is on going and it can be phrased as an RL problem.\nData parallelism supported via MirroredStrategy discussed today", "body": "There were additional topics discussed that could not be turned into coherent notes after the fact.\r\n\r\n## Action items\r\n   * TensorFlow team to create a block diagram and then go deeper.  Goal is to help people who want to contribute plugins or extensions. [#22356](https://github.com/tensorflow/tensorflow/issues/22356)\r\n   * Make the NVIDIA Library to TF Version matrix more visible and consider better error messages. [#22357](https://github.com/tensorflow/tensorflow/issues/22357)\r\n   * Document tips and methods to use for large batch scaling with TensorFlow.  Possibly mention where this is proven and unproven to work.  This would include adding optimizers or wrapper to simplify usage.  Researchers are large labs want to scale but do not have the knowledge to do it quickly. [#22358](https://github.com/tensorflow/tensorflow/issues/22358)\r\n\r\n## General Questions and discussion results\r\n\r\n   * Should TensorFlow default builds move forward more aggressively with newer versions of CUDA/cuDNN?\r\n      * Internally Google moves slowly to new versions of CUDA as the verification process is long and often includes multiple patches with NVIDIA until all edge cases are covered.  The bar is extremely high for obvious reasons.\r\n      * Group thought was it doesn\u2019t matter. Situation would be improved with better error messages indicating what version is needed and making the matrix showing what NVIDIA libs are needed for each TensorFlow version.\r\n   * Provide more models with good performance and accuracy in github.com/tensorflow/models.  Too many different versions and unsure which one to use.  Example:  There are 3+ ResNet models.\r\n      * Contact tfboyd@ or comment in this thread if there is a specific model of interest and why.  MLPerf may improve this situation.\r\n   * Auto regressive models with long dependency chains are hard to optimize by doing fusion by hand.\r\n      * Consider trying XLA and providing feedback. An objective of XLA is to reduce the need for custom fusion.\r\n   * [Ask] Distributing the input pipeline across servers.  Some work has been done and rumored to have occured in production but not trivial to setup.  Consider an RFP and/or reach out to the tf.data team.\r\n   * TensorCores are only used if you are using tf.16.  You can do Pseudo FP16 with an envar that should be in TF 1.11 from NVIDIA as an experimental feature.  You still need to do loss scaling.\r\n\r\n## Debugging and performance investigations\r\n   * Hard to get timelines and profiler results.\r\n      * New guide is on the way, not positive this will make it as easy as desired.\r\n   * [Ask] Provide an interface to autotuning parameters such as intra and inter thread pools.\r\n      * In hindsight, more information is needed to make this actionable.  Please add info to the comments.  \r\n\r\n## Distributed compute (multi-gpu and multi-node)\r\n   * All reduce API for multi-node and support MPI.\r\n      * MPI would be useful for supercomputers where you need to use their MPI library to get good communication.\r\n      * NCCL currently used by MirroredStrategy but only for multi-GPU.  TensorFlow\u2019s own `ops` are used for multi-node all-reduce.\r\n\r\n   * Document on how the distribution strategies is setup with the goal of showing how others can add their own solution and collective ops.  The API is the best place right now to figure this out.\r\n   * [AI] TensorFlow team to create a block diagram and then go deeper.  Goal is to help people who want to contribute plugins or extensions.\r\n   * Having a hard time with MPI.  People are using a newer versions of MPI\r\n   * How do we plan to support fault tolerance? Will it allow dynamic addition and removal of machines to the collective. E.g. preemption but keep training with a smaller pool. Also increasing machines & batch size as training progresses. Need to adjust the learning rate, so maybe get a callback, especially when you are going to lose or have just lost a machine. Response to call back is starting with revised set of machines an new learning rate.\r\n   *[AI] Document strategies for large batch training.  LARS looking to automatic learning rate, warmup rate and stuff.  \r\n\r\n## Model parallelism and Data parallelism\r\n   * Model parallelism is currently manual.  Work to automate it is on going and it can be phrased as an RL problem.  \r\n   * Data parallelism supported via MirroredStrategy discussed today\r\n"}