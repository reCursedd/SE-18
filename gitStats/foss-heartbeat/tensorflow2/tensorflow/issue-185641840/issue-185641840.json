{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5235", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5235/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5235/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5235/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/5235", "id": 185641840, "node_id": "MDU6SXNzdWUxODU2NDE4NDA=", "number": 5235, "title": "ResourceExhaustedError on GPU", "user": {"login": "luxiaolei", "id": 15217663, "node_id": "MDQ6VXNlcjE1MjE3NjYz", "avatar_url": "https://avatars1.githubusercontent.com/u/15217663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luxiaolei", "html_url": "https://github.com/luxiaolei", "followers_url": "https://api.github.com/users/luxiaolei/followers", "following_url": "https://api.github.com/users/luxiaolei/following{/other_user}", "gists_url": "https://api.github.com/users/luxiaolei/gists{/gist_id}", "starred_url": "https://api.github.com/users/luxiaolei/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luxiaolei/subscriptions", "organizations_url": "https://api.github.com/users/luxiaolei/orgs", "repos_url": "https://api.github.com/users/luxiaolei/repos", "events_url": "https://api.github.com/users/luxiaolei/events{/privacy}", "received_events_url": "https://api.github.com/users/luxiaolei/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2016-10-27T11:25:21Z", "updated_at": "2016-11-05T03:34:23Z", "closed_at": "2016-11-05T03:34:23Z", "author_association": "NONE", "body_html": "<p>Environment info</p>\n<p>Operating System: Ubuntu 16.04</p>\n<p>Installed version of CUDA and cuDNN: CUDA 8.0, cuDNN 5</p>\n<p>(please attach the output of ls -l /path/to/cuda/lib/libcud*):</p>\n<p>/usr/local/cuda/lib64/libcudadevrt.a<br>\n/usr/local/cuda/lib64/libcudart.so<br>\n/usr/local/cuda/lib64/libcudart.so.8.0<br>\n/usr/local/cuda/lib64/libcudart.so.8.0.27<br>\n/usr/local/cuda/lib64/libcudart_static.a<br>\n/usr/local/cuda/lib64/libcudnn.so<br>\n/usr/local/cuda/lib64/libcudnn.so.5<br>\n/usr/local/cuda/lib64/libcudnn.so.5.0.5<br>\nIf installed from sources, provide the commit hash:<br>\n<a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/2cbb9b529a6723ebbe07663156b18c04fbaf4531/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/2cbb9b529a6723ebbe07663156b18c04fbaf4531\"><tt>2cbb9b5</tt></a></p>\n<p>Hi All,<br>\nI am able to run the following code on CPU, but when on GPU, I got a <code>ResourceExhaustedError</code>, My GPU is an GTX1080 one, which has 8G memeory.</p>\n<pre><code>import tensorflow as tf\nimport numpy as np\n\nsess = tf.Session()\n\ninputs = tf.placeholder(tf.float32, shape=(30,224,224,512))\nwith tf.device('/gpu:0') as d:\n    kernel = tf.Variable(tf.truncated_normal([9,9,512,36], dtype=tf.float32,stddev=1e-1), name='weights')\n    conv = tf.nn.conv2d(inputs, kernel, [1, 1, 1, 1], padding='SAME')\n\ninputs_arr = np.random.random((30,224,224,512)).astype(np.float32)\nsess.run(tf.initialize_variables([kernel]))\ncc = sess.run(conv, feed_dict={inputs: inputs_arr})\n</code></pre>\n<p>Error message:</p>\n<pre><code>---------------------------------------------------------------------------\nResourceExhaustedError                    Traceback (most recent call last)\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\n    971     try:\n--&gt; 972       return fn(*args)\n    973     except errors.OpError as e:\n\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run_fn(session, feed_dict, fetch_list, target_list, options, run_metadata)\n    953                                  feed_dict, fetch_list, target_list,\n--&gt; 954                                  status, run_metadata)\n    955 \n\n/home/xlws/anaconda3/lib/python3.5/contextlib.py in __exit__(self, type, value, traceback)\n     65             try:\n---&gt; 66                 next(self.gen)\n     67             except StopIteration:\n\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/errors.py in raise_exception_on_not_ok_status()\n    462           compat.as_text(pywrap_tensorflow.TF_Message(status)),\n--&gt; 463           pywrap_tensorflow.TF_GetCode(status))\n    464   finally:\n\nResourceExhaustedError: OOM when allocating tensor with shape[30,36,224,224]\n     [[Node: Conv2D = Conv2D[T=DT_FLOAT, data_format=\"NHWC\", padding=\"SAME\", strides=[1, 1, 1, 1], use_cudnn_on_gpu=true, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](_recv_Placeholder_0/_1, weights/read)]]\n     [[Node: Conv2D/_3 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device_incarnation=1, tensor_name=\"edge_4_Conv2D\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/cpu:0\"]()]]\n\nDuring handling of the above exception, another exception occurred:\n\nResourceExhaustedError                    Traceback (most recent call last)\n&lt;ipython-input-1-92fd065a1eed&gt; in &lt;module&gt;()\n     12 inputs_arr = np.random.random((30,224,224,512)).astype(np.float32)\n     13 sess.run(tf.initialize_variables([kernel]))\n---&gt; 14 cc = sess.run(conv, feed_dict={inputs: inputs_arr})\n\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/client/session.py in run(self, fetches, feed_dict, options, run_metadata)\n    715     try:\n    716       result = self._run(None, fetches, feed_dict, options_ptr,\n--&gt; 717                          run_metadata_ptr)\n    718       if run_metadata:\n    719         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)\n\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run(self, handle, fetches, feed_dict, options, run_metadata)\n    913     if final_fetches or final_targets:\n    914       results = self._do_run(handle, final_targets, final_fetches,\n--&gt; 915                              feed_dict_string, options, run_metadata)\n    916     else:\n    917       results = []\n\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)\n    963     if handle is None:\n    964       return self._do_call(_run_fn, self._session, feed_dict, fetch_list,\n--&gt; 965                            target_list, options, run_metadata)\n    966     else:\n    967       return self._do_call(_prun_fn, self._session, handle, feed_dict,\n\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\n    983         except KeyError:\n    984           pass\n--&gt; 985       raise type(e)(node_def, op, message)\n    986 \n    987   def _extend_graph(self):\n\nResourceExhaustedError: OOM when allocating tensor with shape[30,36,224,224]\n     [[Node: Conv2D = Conv2D[T=DT_FLOAT, data_format=\"NHWC\", padding=\"SAME\", strides=[1, 1, 1, 1], use_cudnn_on_gpu=true, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](_recv_Placeholder_0/_1, weights/read)]]\n     [[Node: Conv2D/_3 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device_incarnation=1, tensor_name=\"edge_4_Conv2D\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/cpu:0\"]()]]\n\nCaused by op 'Conv2D', defined at:\n  File \"/home/xlws/anaconda3/lib/python3.5/runpy.py\", line 184, in _run_module_as_main\n    \"__main__\", mod_spec)\n  File \"/home/xlws/anaconda3/lib/python3.5/runpy.py\", line 85, in _run_code\n    exec(code, run_globals)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/ipykernel/__main__.py\", line 3, in &lt;module&gt;\n    app.launch_new_instance()\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/traitlets/config/application.py\", line 596, in launch_instance\n    app.start()\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/ipykernel/kernelapp.py\", line 442, in start\n    ioloop.IOLoop.instance().start()\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/zmq/eventloop/ioloop.py\", line 162, in start\n    super(ZMQIOLoop, self).start()\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tornado/ioloop.py\", line 883, in start\n    handler_func(fd_obj, events)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\n    return fn(*args, **kwargs)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/zmq/eventloop/zmqstream.py\", line 440, in _handle_events\n    self._handle_recv()\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/zmq/eventloop/zmqstream.py\", line 472, in _handle_recv\n    self._run_callback(callback, msg)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/zmq/eventloop/zmqstream.py\", line 414, in _run_callback\n    callback(*args, **kwargs)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\n    return fn(*args, **kwargs)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/ipykernel/kernelbase.py\", line 276, in dispatcher\n    return self.dispatch_shell(stream, msg)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/ipykernel/kernelbase.py\", line 228, in dispatch_shell\n    handler(stream, idents, msg)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/ipykernel/kernelbase.py\", line 391, in execute_request\n    user_expressions, allow_stdin)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/ipykernel/ipkernel.py\", line 199, in do_execute\n    shell.run_cell(code, store_history=store_history, silent=silent)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/IPython/core/interactiveshell.py\", line 2723, in run_cell\n    interactivity=interactivity, compiler=compiler, result=result)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/IPython/core/interactiveshell.py\", line 2825, in run_ast_nodes\n    if self.run_code(code, result):\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/IPython/core/interactiveshell.py\", line 2885, in run_code\n    exec(code_obj, self.user_global_ns, self.user_ns)\n  File \"&lt;ipython-input-1-92fd065a1eed&gt;\", line 10, in &lt;module&gt;\n    conv = tf.nn.conv2d(inputs, kernel, [1, 1, 1, 1], padding='SAME')\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/ops/gen_nn_ops.py\", line 394, in conv2d\n    data_format=data_format, name=name)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 748, in apply_op\n    op_def=op_def)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2403, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1305, in __init__\n    self._traceback = _extract_stack()\n\nResourceExhaustedError (see above for traceback): OOM when allocating tensor with shape[30,36,224,224]\n     [[Node: Conv2D = Conv2D[T=DT_FLOAT, data_format=\"NHWC\", padding=\"SAME\", strides=[1, 1, 1, 1], use_cudnn_on_gpu=true, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](_recv_Placeholder_0/_1, weights/read)]]\n     [[Node: Conv2D/_3 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device_incarnation=1, tensor_name=\"edge_4_Conv2D\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/cpu:0\"]()]]\n</code></pre>", "body_text": "Environment info\nOperating System: Ubuntu 16.04\nInstalled version of CUDA and cuDNN: CUDA 8.0, cuDNN 5\n(please attach the output of ls -l /path/to/cuda/lib/libcud*):\n/usr/local/cuda/lib64/libcudadevrt.a\n/usr/local/cuda/lib64/libcudart.so\n/usr/local/cuda/lib64/libcudart.so.8.0\n/usr/local/cuda/lib64/libcudart.so.8.0.27\n/usr/local/cuda/lib64/libcudart_static.a\n/usr/local/cuda/lib64/libcudnn.so\n/usr/local/cuda/lib64/libcudnn.so.5\n/usr/local/cuda/lib64/libcudnn.so.5.0.5\nIf installed from sources, provide the commit hash:\n2cbb9b5\nHi All,\nI am able to run the following code on CPU, but when on GPU, I got a ResourceExhaustedError, My GPU is an GTX1080 one, which has 8G memeory.\nimport tensorflow as tf\nimport numpy as np\n\nsess = tf.Session()\n\ninputs = tf.placeholder(tf.float32, shape=(30,224,224,512))\nwith tf.device('/gpu:0') as d:\n    kernel = tf.Variable(tf.truncated_normal([9,9,512,36], dtype=tf.float32,stddev=1e-1), name='weights')\n    conv = tf.nn.conv2d(inputs, kernel, [1, 1, 1, 1], padding='SAME')\n\ninputs_arr = np.random.random((30,224,224,512)).astype(np.float32)\nsess.run(tf.initialize_variables([kernel]))\ncc = sess.run(conv, feed_dict={inputs: inputs_arr})\n\nError message:\n---------------------------------------------------------------------------\nResourceExhaustedError                    Traceback (most recent call last)\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\n    971     try:\n--> 972       return fn(*args)\n    973     except errors.OpError as e:\n\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run_fn(session, feed_dict, fetch_list, target_list, options, run_metadata)\n    953                                  feed_dict, fetch_list, target_list,\n--> 954                                  status, run_metadata)\n    955 \n\n/home/xlws/anaconda3/lib/python3.5/contextlib.py in __exit__(self, type, value, traceback)\n     65             try:\n---> 66                 next(self.gen)\n     67             except StopIteration:\n\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/errors.py in raise_exception_on_not_ok_status()\n    462           compat.as_text(pywrap_tensorflow.TF_Message(status)),\n--> 463           pywrap_tensorflow.TF_GetCode(status))\n    464   finally:\n\nResourceExhaustedError: OOM when allocating tensor with shape[30,36,224,224]\n     [[Node: Conv2D = Conv2D[T=DT_FLOAT, data_format=\"NHWC\", padding=\"SAME\", strides=[1, 1, 1, 1], use_cudnn_on_gpu=true, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](_recv_Placeholder_0/_1, weights/read)]]\n     [[Node: Conv2D/_3 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device_incarnation=1, tensor_name=\"edge_4_Conv2D\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/cpu:0\"]()]]\n\nDuring handling of the above exception, another exception occurred:\n\nResourceExhaustedError                    Traceback (most recent call last)\n<ipython-input-1-92fd065a1eed> in <module>()\n     12 inputs_arr = np.random.random((30,224,224,512)).astype(np.float32)\n     13 sess.run(tf.initialize_variables([kernel]))\n---> 14 cc = sess.run(conv, feed_dict={inputs: inputs_arr})\n\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/client/session.py in run(self, fetches, feed_dict, options, run_metadata)\n    715     try:\n    716       result = self._run(None, fetches, feed_dict, options_ptr,\n--> 717                          run_metadata_ptr)\n    718       if run_metadata:\n    719         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)\n\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run(self, handle, fetches, feed_dict, options, run_metadata)\n    913     if final_fetches or final_targets:\n    914       results = self._do_run(handle, final_targets, final_fetches,\n--> 915                              feed_dict_string, options, run_metadata)\n    916     else:\n    917       results = []\n\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)\n    963     if handle is None:\n    964       return self._do_call(_run_fn, self._session, feed_dict, fetch_list,\n--> 965                            target_list, options, run_metadata)\n    966     else:\n    967       return self._do_call(_prun_fn, self._session, handle, feed_dict,\n\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\n    983         except KeyError:\n    984           pass\n--> 985       raise type(e)(node_def, op, message)\n    986 \n    987   def _extend_graph(self):\n\nResourceExhaustedError: OOM when allocating tensor with shape[30,36,224,224]\n     [[Node: Conv2D = Conv2D[T=DT_FLOAT, data_format=\"NHWC\", padding=\"SAME\", strides=[1, 1, 1, 1], use_cudnn_on_gpu=true, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](_recv_Placeholder_0/_1, weights/read)]]\n     [[Node: Conv2D/_3 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device_incarnation=1, tensor_name=\"edge_4_Conv2D\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/cpu:0\"]()]]\n\nCaused by op 'Conv2D', defined at:\n  File \"/home/xlws/anaconda3/lib/python3.5/runpy.py\", line 184, in _run_module_as_main\n    \"__main__\", mod_spec)\n  File \"/home/xlws/anaconda3/lib/python3.5/runpy.py\", line 85, in _run_code\n    exec(code, run_globals)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/ipykernel/__main__.py\", line 3, in <module>\n    app.launch_new_instance()\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/traitlets/config/application.py\", line 596, in launch_instance\n    app.start()\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/ipykernel/kernelapp.py\", line 442, in start\n    ioloop.IOLoop.instance().start()\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/zmq/eventloop/ioloop.py\", line 162, in start\n    super(ZMQIOLoop, self).start()\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tornado/ioloop.py\", line 883, in start\n    handler_func(fd_obj, events)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\n    return fn(*args, **kwargs)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/zmq/eventloop/zmqstream.py\", line 440, in _handle_events\n    self._handle_recv()\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/zmq/eventloop/zmqstream.py\", line 472, in _handle_recv\n    self._run_callback(callback, msg)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/zmq/eventloop/zmqstream.py\", line 414, in _run_callback\n    callback(*args, **kwargs)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\n    return fn(*args, **kwargs)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/ipykernel/kernelbase.py\", line 276, in dispatcher\n    return self.dispatch_shell(stream, msg)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/ipykernel/kernelbase.py\", line 228, in dispatch_shell\n    handler(stream, idents, msg)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/ipykernel/kernelbase.py\", line 391, in execute_request\n    user_expressions, allow_stdin)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/ipykernel/ipkernel.py\", line 199, in do_execute\n    shell.run_cell(code, store_history=store_history, silent=silent)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/IPython/core/interactiveshell.py\", line 2723, in run_cell\n    interactivity=interactivity, compiler=compiler, result=result)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/IPython/core/interactiveshell.py\", line 2825, in run_ast_nodes\n    if self.run_code(code, result):\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/IPython/core/interactiveshell.py\", line 2885, in run_code\n    exec(code_obj, self.user_global_ns, self.user_ns)\n  File \"<ipython-input-1-92fd065a1eed>\", line 10, in <module>\n    conv = tf.nn.conv2d(inputs, kernel, [1, 1, 1, 1], padding='SAME')\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/ops/gen_nn_ops.py\", line 394, in conv2d\n    data_format=data_format, name=name)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 748, in apply_op\n    op_def=op_def)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2403, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1305, in __init__\n    self._traceback = _extract_stack()\n\nResourceExhaustedError (see above for traceback): OOM when allocating tensor with shape[30,36,224,224]\n     [[Node: Conv2D = Conv2D[T=DT_FLOAT, data_format=\"NHWC\", padding=\"SAME\", strides=[1, 1, 1, 1], use_cudnn_on_gpu=true, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](_recv_Placeholder_0/_1, weights/read)]]\n     [[Node: Conv2D/_3 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device_incarnation=1, tensor_name=\"edge_4_Conv2D\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/cpu:0\"]()]]", "body": "Environment info\n\nOperating System: Ubuntu 16.04\n\nInstalled version of CUDA and cuDNN: CUDA 8.0, cuDNN 5\n\n(please attach the output of ls -l /path/to/cuda/lib/libcud*):\n\n/usr/local/cuda/lib64/libcudadevrt.a\n/usr/local/cuda/lib64/libcudart.so\n/usr/local/cuda/lib64/libcudart.so.8.0\n/usr/local/cuda/lib64/libcudart.so.8.0.27\n/usr/local/cuda/lib64/libcudart_static.a\n/usr/local/cuda/lib64/libcudnn.so\n/usr/local/cuda/lib64/libcudnn.so.5\n/usr/local/cuda/lib64/libcudnn.so.5.0.5\nIf installed from sources, provide the commit hash:\n2cbb9b529a6723ebbe07663156b18c04fbaf4531\n\nHi All, \nI am able to run the following code on CPU, but when on GPU, I got a `ResourceExhaustedError`, My GPU is an GTX1080 one, which has 8G memeory.\n\n```\nimport tensorflow as tf\nimport numpy as np\n\nsess = tf.Session()\n\ninputs = tf.placeholder(tf.float32, shape=(30,224,224,512))\nwith tf.device('/gpu:0') as d:\n    kernel = tf.Variable(tf.truncated_normal([9,9,512,36], dtype=tf.float32,stddev=1e-1), name='weights')\n    conv = tf.nn.conv2d(inputs, kernel, [1, 1, 1, 1], padding='SAME')\n\ninputs_arr = np.random.random((30,224,224,512)).astype(np.float32)\nsess.run(tf.initialize_variables([kernel]))\ncc = sess.run(conv, feed_dict={inputs: inputs_arr})\n```\n\nError message:\n\n```\n---------------------------------------------------------------------------\nResourceExhaustedError                    Traceback (most recent call last)\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\n    971     try:\n--> 972       return fn(*args)\n    973     except errors.OpError as e:\n\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run_fn(session, feed_dict, fetch_list, target_list, options, run_metadata)\n    953                                  feed_dict, fetch_list, target_list,\n--> 954                                  status, run_metadata)\n    955 \n\n/home/xlws/anaconda3/lib/python3.5/contextlib.py in __exit__(self, type, value, traceback)\n     65             try:\n---> 66                 next(self.gen)\n     67             except StopIteration:\n\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/errors.py in raise_exception_on_not_ok_status()\n    462           compat.as_text(pywrap_tensorflow.TF_Message(status)),\n--> 463           pywrap_tensorflow.TF_GetCode(status))\n    464   finally:\n\nResourceExhaustedError: OOM when allocating tensor with shape[30,36,224,224]\n     [[Node: Conv2D = Conv2D[T=DT_FLOAT, data_format=\"NHWC\", padding=\"SAME\", strides=[1, 1, 1, 1], use_cudnn_on_gpu=true, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](_recv_Placeholder_0/_1, weights/read)]]\n     [[Node: Conv2D/_3 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device_incarnation=1, tensor_name=\"edge_4_Conv2D\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/cpu:0\"]()]]\n\nDuring handling of the above exception, another exception occurred:\n\nResourceExhaustedError                    Traceback (most recent call last)\n<ipython-input-1-92fd065a1eed> in <module>()\n     12 inputs_arr = np.random.random((30,224,224,512)).astype(np.float32)\n     13 sess.run(tf.initialize_variables([kernel]))\n---> 14 cc = sess.run(conv, feed_dict={inputs: inputs_arr})\n\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/client/session.py in run(self, fetches, feed_dict, options, run_metadata)\n    715     try:\n    716       result = self._run(None, fetches, feed_dict, options_ptr,\n--> 717                          run_metadata_ptr)\n    718       if run_metadata:\n    719         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)\n\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run(self, handle, fetches, feed_dict, options, run_metadata)\n    913     if final_fetches or final_targets:\n    914       results = self._do_run(handle, final_targets, final_fetches,\n--> 915                              feed_dict_string, options, run_metadata)\n    916     else:\n    917       results = []\n\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)\n    963     if handle is None:\n    964       return self._do_call(_run_fn, self._session, feed_dict, fetch_list,\n--> 965                            target_list, options, run_metadata)\n    966     else:\n    967       return self._do_call(_prun_fn, self._session, handle, feed_dict,\n\n/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\n    983         except KeyError:\n    984           pass\n--> 985       raise type(e)(node_def, op, message)\n    986 \n    987   def _extend_graph(self):\n\nResourceExhaustedError: OOM when allocating tensor with shape[30,36,224,224]\n     [[Node: Conv2D = Conv2D[T=DT_FLOAT, data_format=\"NHWC\", padding=\"SAME\", strides=[1, 1, 1, 1], use_cudnn_on_gpu=true, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](_recv_Placeholder_0/_1, weights/read)]]\n     [[Node: Conv2D/_3 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device_incarnation=1, tensor_name=\"edge_4_Conv2D\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/cpu:0\"]()]]\n\nCaused by op 'Conv2D', defined at:\n  File \"/home/xlws/anaconda3/lib/python3.5/runpy.py\", line 184, in _run_module_as_main\n    \"__main__\", mod_spec)\n  File \"/home/xlws/anaconda3/lib/python3.5/runpy.py\", line 85, in _run_code\n    exec(code, run_globals)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/ipykernel/__main__.py\", line 3, in <module>\n    app.launch_new_instance()\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/traitlets/config/application.py\", line 596, in launch_instance\n    app.start()\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/ipykernel/kernelapp.py\", line 442, in start\n    ioloop.IOLoop.instance().start()\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/zmq/eventloop/ioloop.py\", line 162, in start\n    super(ZMQIOLoop, self).start()\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tornado/ioloop.py\", line 883, in start\n    handler_func(fd_obj, events)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\n    return fn(*args, **kwargs)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/zmq/eventloop/zmqstream.py\", line 440, in _handle_events\n    self._handle_recv()\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/zmq/eventloop/zmqstream.py\", line 472, in _handle_recv\n    self._run_callback(callback, msg)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/zmq/eventloop/zmqstream.py\", line 414, in _run_callback\n    callback(*args, **kwargs)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\n    return fn(*args, **kwargs)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/ipykernel/kernelbase.py\", line 276, in dispatcher\n    return self.dispatch_shell(stream, msg)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/ipykernel/kernelbase.py\", line 228, in dispatch_shell\n    handler(stream, idents, msg)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/ipykernel/kernelbase.py\", line 391, in execute_request\n    user_expressions, allow_stdin)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/ipykernel/ipkernel.py\", line 199, in do_execute\n    shell.run_cell(code, store_history=store_history, silent=silent)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/IPython/core/interactiveshell.py\", line 2723, in run_cell\n    interactivity=interactivity, compiler=compiler, result=result)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/IPython/core/interactiveshell.py\", line 2825, in run_ast_nodes\n    if self.run_code(code, result):\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/IPython/core/interactiveshell.py\", line 2885, in run_code\n    exec(code_obj, self.user_global_ns, self.user_ns)\n  File \"<ipython-input-1-92fd065a1eed>\", line 10, in <module>\n    conv = tf.nn.conv2d(inputs, kernel, [1, 1, 1, 1], padding='SAME')\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/ops/gen_nn_ops.py\", line 394, in conv2d\n    data_format=data_format, name=name)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 748, in apply_op\n    op_def=op_def)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2403, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/xlws/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1305, in __init__\n    self._traceback = _extract_stack()\n\nResourceExhaustedError (see above for traceback): OOM when allocating tensor with shape[30,36,224,224]\n     [[Node: Conv2D = Conv2D[T=DT_FLOAT, data_format=\"NHWC\", padding=\"SAME\", strides=[1, 1, 1, 1], use_cudnn_on_gpu=true, _device=\"/job:localhost/replica:0/task:0/gpu:0\"](_recv_Placeholder_0/_1, weights/read)]]\n     [[Node: Conv2D/_3 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device_incarnation=1, tensor_name=\"edge_4_Conv2D\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/cpu:0\"]()]]\n```\n"}