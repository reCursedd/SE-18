{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/439547227", "html_url": "https://github.com/tensorflow/tensorflow/issues/22987#issuecomment-439547227", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22987", "id": 439547227, "node_id": "MDEyOklzc3VlQ29tbWVudDQzOTU0NzIyNw==", "user": {"login": "nluehr", "id": 1873655, "node_id": "MDQ6VXNlcjE4NzM2NTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1873655?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nluehr", "html_url": "https://github.com/nluehr", "followers_url": "https://api.github.com/users/nluehr/followers", "following_url": "https://api.github.com/users/nluehr/following{/other_user}", "gists_url": "https://api.github.com/users/nluehr/gists{/gist_id}", "starred_url": "https://api.github.com/users/nluehr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nluehr/subscriptions", "organizations_url": "https://api.github.com/users/nluehr/orgs", "repos_url": "https://api.github.com/users/nluehr/repos", "events_url": "https://api.github.com/users/nluehr/events{/privacy}", "received_events_url": "https://api.github.com/users/nluehr/received_events", "type": "User", "site_admin": false}, "created_at": "2018-11-16T22:21:53Z", "updated_at": "2018-11-16T22:21:53Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Not sure I see synchronization of runners in RunInternal.</p>\n<p>In TF 1.12 I add two prints: one of <code>(traceing::TraceCollector*)this</code> in ~DeviceTracerImpl() after <a href=\"https://github.com/tensorflow/tensorflow/blob/v1.12.0/tensorflow/core/platform/default/device_tracer.cc#L400\">https://github.com/tensorflow/tensorflow/blob/v1.12.0/tensorflow/core/platform/default/device_tracer.cc#L400</a> and the second of <code>trace_collector</code> after <a href=\"https://github.com/tensorflow/tensorflow/blob/v1.12.0/tensorflow/core/common_runtime/executor.cc#L1578\">https://github.com/tensorflow/tensorflow/blob/v1.12.0/tensorflow/core/common_runtime/executor.cc#L1578</a>.</p>\n<p>Then I run <code>train_multi_gpu.py</code> provided above and the following output is generated before triggering a SEGFAULT at <a href=\"https://github.com/grasseau/HAhRD/blob/master/GSOC18/train_multi_gpu.py#L443-L447\">https://github.com/grasseau/HAhRD/blob/master/GSOC18/train_multi_gpu.py#L443-L447</a>.</p>\n<pre lang=\"Using\" data-meta=\"trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\"><code>Using trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nDestroying DeviceTracerImpl=0x12d87c380 at tensorflow/core/platform/default/device_tracer.cc:404\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\n</code></pre>\n<p>So the destructor seems to be called before the executor has completed.</p>", "body_text": "Not sure I see synchronization of runners in RunInternal.\nIn TF 1.12 I add two prints: one of (traceing::TraceCollector*)this in ~DeviceTracerImpl() after https://github.com/tensorflow/tensorflow/blob/v1.12.0/tensorflow/core/platform/default/device_tracer.cc#L400 and the second of trace_collector after https://github.com/tensorflow/tensorflow/blob/v1.12.0/tensorflow/core/common_runtime/executor.cc#L1578.\nThen I run train_multi_gpu.py provided above and the following output is generated before triggering a SEGFAULT at https://github.com/grasseau/HAhRD/blob/master/GSOC18/train_multi_gpu.py#L443-L447.\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nDestroying DeviceTracerImpl=0x12d87c380 at tensorflow/core/platform/default/device_tracer.cc:404\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\n\nSo the destructor seems to be called before the executor has completed.", "body": "Not sure I see synchronization of runners in RunInternal.\r\n\r\nIn TF 1.12 I add two prints: one of `(traceing::TraceCollector*)this` in ~DeviceTracerImpl() after https://github.com/tensorflow/tensorflow/blob/v1.12.0/tensorflow/core/platform/default/device_tracer.cc#L400 and the second of `trace_collector` after https://github.com/tensorflow/tensorflow/blob/v1.12.0/tensorflow/core/common_runtime/executor.cc#L1578.\r\n\r\nThen I run `train_multi_gpu.py` provided above and the following output is generated before triggering a SEGFAULT at https://github.com/grasseau/HAhRD/blob/master/GSOC18/train_multi_gpu.py#L443-L447.\r\n\r\n```Using trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\r\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\r\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\r\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\r\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\r\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\r\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\r\nDestroying DeviceTracerImpl=0x12d87c380 at tensorflow/core/platform/default/device_tracer.cc:404\r\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\r\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\r\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\r\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\r\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\r\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\r\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\r\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\r\nUsing trace_collector=0x12d87c380 at tensorflow/core/common_runtime/executor.cc:1585\r\n```\r\n\r\nSo the destructor seems to be called before the executor has completed."}