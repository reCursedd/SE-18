{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12749", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12749/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12749/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12749/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/12749", "id": 254587690, "node_id": "MDU6SXNzdWUyNTQ1ODc2OTA=", "number": 12749, "title": "Android- Tensorflow model loading issue", "user": {"login": "manishvatsa", "id": 31509879, "node_id": "MDQ6VXNlcjMxNTA5ODc5", "avatar_url": "https://avatars1.githubusercontent.com/u/31509879?v=4", "gravatar_id": "", "url": "https://api.github.com/users/manishvatsa", "html_url": "https://github.com/manishvatsa", "followers_url": "https://api.github.com/users/manishvatsa/followers", "following_url": "https://api.github.com/users/manishvatsa/following{/other_user}", "gists_url": "https://api.github.com/users/manishvatsa/gists{/gist_id}", "starred_url": "https://api.github.com/users/manishvatsa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/manishvatsa/subscriptions", "organizations_url": "https://api.github.com/users/manishvatsa/orgs", "repos_url": "https://api.github.com/users/manishvatsa/repos", "events_url": "https://api.github.com/users/manishvatsa/events{/privacy}", "received_events_url": "https://api.github.com/users/manishvatsa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473184161, "node_id": "MDU6TGFiZWw0NzMxODQxNjE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:support", "name": "type:support", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-09-01T09:35:17Z", "updated_at": "2017-09-04T01:16:09Z", "closed_at": "2017-09-04T01:16:09Z", "author_association": "NONE", "body_html": "<p>I have saved model using tf.train.Saver.save() and then freeze the graph bu using below method:<br>\ndef freezeModel(modelName):<br>\ninput_graph_path = modelName + '.pb'<br>\ncheckpoint_path = './' + modelName + '.ckpt'<br>\ninput_saver_def_path = \"\"<br>\ninput_binary = True<br>\noutput_node_names = \"x_indices,x_values,x_dense_shape,unary_scores,transition_params,train_op\"<br>\nrestore_op_name = \"save/restore_all\"<br>\nfilename_tensor_name = \"save/Const:0\"<br>\noutput_frozen_graph_name = 'frozen_' + modelName + '.pb'</p>\n<pre><code>clear_devices = True\n\nfreeze_graph.freeze_graph(input_graph_path, input_saver_def_path,input_binary, checkpoint_path, output_node_names,restore_op_name, filename_tensor_name,output_frozen_graph_name, clear_devices, \"\")\n#freeze_graph.freeze_graph(input_saved_model_dir='Model/', saved_model_tags='serve')\nreturn\n</code></pre>\n<p>Then loading the modelName.pb file in Android using inference api as below:<br>\nTensorFlowInferenceInterface inferenceInterface = new <strong>TensorFlowInferenceInterface</strong>(context.getAssets(), MODEL_FILE);</p>\n<p>I am getting <strong>below error</strong>:<br>\nCaused by: <strong>java.io.IOException: Not a valid TensorFlow Graph serialization: Value for attr 'T' of int64 is not in the list of allowed values: float, int32</strong><br>\n; NodeDef: Less_1 = Less[T=DT_INT64](ToInt64_2, ToInt64_3); Op&lt;name=Less; signature=x:T, y:T -&gt; z:bool; attr=T:type,allowed=[DT_FLOAT, DT_INT32]&gt;<br>\nat org.tensorflow.contrib.android.TensorFlowInferenceInterface.loadGraph(TensorFlowInferenceInterface.java:439)<br>\nat org.tensorflow.contrib.android.TensorFlowInferenceInterface.(TensorFlowInferenceInterface.java:98)</p>\n<p><strong>Here is the code using to create the graph:</strong><br>\nx_indices_t= tf.placeholder(tf.int64, shape=(None, 3), name=\"x_indices\")<br>\nx_values_t= tf.placeholder(tf.float32, shape=(None), name=\"x_values\")<br>\nx_dense_shape_t= tf.placeholder(tf.int64, shape=(3), name=\"x_dense_shape\")#[len(X_train), max_word_count, feature_count]<br>\nshape_unary_score_t = tf.placeholder(dtype=tf.int64, shape=(None, None, None), name=\"shape_unary_score\")#[num_examples_t, max_word_count, num_tags]<br>\nshape_t = tf.shape(shape_unary_score_t)</p>\n<p>x_t = tf.SparseTensor(indices=x_indices, values=x_values, dense_shape=x_dense_shape)</p>\n<p>To resolve above error i changed the dtype of indices and shapes to int32 then tf.SparseTensor() is givving below error:<br>\nFile \"CRF_POS_Trainer_Tensor - Training.py\", line 323, in <br>\nx_t = tf.SparseTensor(indices=x_indices_t, values=x_values_t, dense_shape=x_dense_shape_t)<br>\nFile \"/home/anaconda3/envs/tensorflow/lib/python3.6/site-packages/tensorflow/python/framework/sparse_tensor.py\", line 119, in <em>init</em><br>\nindices, name=\"indices\", dtype=dtypes.int64)<br>\nFile \"/home/anaconda3/envs/tensorflow/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 676, in convert_to_tensor<br>\nas_ref=False)<br>\nFile \"/home/anaconda3/envs/tensorflow/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 741, in internal_convert_to_tensor<br>\nret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)<br>\nFile \"/home/anaconda3/envs/tensorflow/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 614, in _TensorTensorConversionFunction<br>\n% (dtype.name, t.dtype.name, str(t)))<br>\nValueError: Tensor conversion requested dtype int64 for Tensor with dtype int32: 'Tensor(\"x_indices:0\", shape=(?, 3), dtype=int32)'</p>\n<p>So how to i resolve issue to create SparseTensor with int32 data.</p>\n<p><strong>Tensorflow Version: 1.3.0</strong></p>", "body_text": "I have saved model using tf.train.Saver.save() and then freeze the graph bu using below method:\ndef freezeModel(modelName):\ninput_graph_path = modelName + '.pb'\ncheckpoint_path = './' + modelName + '.ckpt'\ninput_saver_def_path = \"\"\ninput_binary = True\noutput_node_names = \"x_indices,x_values,x_dense_shape,unary_scores,transition_params,train_op\"\nrestore_op_name = \"save/restore_all\"\nfilename_tensor_name = \"save/Const:0\"\noutput_frozen_graph_name = 'frozen_' + modelName + '.pb'\nclear_devices = True\n\nfreeze_graph.freeze_graph(input_graph_path, input_saver_def_path,input_binary, checkpoint_path, output_node_names,restore_op_name, filename_tensor_name,output_frozen_graph_name, clear_devices, \"\")\n#freeze_graph.freeze_graph(input_saved_model_dir='Model/', saved_model_tags='serve')\nreturn\n\nThen loading the modelName.pb file in Android using inference api as below:\nTensorFlowInferenceInterface inferenceInterface = new TensorFlowInferenceInterface(context.getAssets(), MODEL_FILE);\nI am getting below error:\nCaused by: java.io.IOException: Not a valid TensorFlow Graph serialization: Value for attr 'T' of int64 is not in the list of allowed values: float, int32\n; NodeDef: Less_1 = Less[T=DT_INT64](ToInt64_2, ToInt64_3); Op<name=Less; signature=x:T, y:T -> z:bool; attr=T:type,allowed=[DT_FLOAT, DT_INT32]>\nat org.tensorflow.contrib.android.TensorFlowInferenceInterface.loadGraph(TensorFlowInferenceInterface.java:439)\nat org.tensorflow.contrib.android.TensorFlowInferenceInterface.(TensorFlowInferenceInterface.java:98)\nHere is the code using to create the graph:\nx_indices_t= tf.placeholder(tf.int64, shape=(None, 3), name=\"x_indices\")\nx_values_t= tf.placeholder(tf.float32, shape=(None), name=\"x_values\")\nx_dense_shape_t= tf.placeholder(tf.int64, shape=(3), name=\"x_dense_shape\")#[len(X_train), max_word_count, feature_count]\nshape_unary_score_t = tf.placeholder(dtype=tf.int64, shape=(None, None, None), name=\"shape_unary_score\")#[num_examples_t, max_word_count, num_tags]\nshape_t = tf.shape(shape_unary_score_t)\nx_t = tf.SparseTensor(indices=x_indices, values=x_values, dense_shape=x_dense_shape)\nTo resolve above error i changed the dtype of indices and shapes to int32 then tf.SparseTensor() is givving below error:\nFile \"CRF_POS_Trainer_Tensor - Training.py\", line 323, in \nx_t = tf.SparseTensor(indices=x_indices_t, values=x_values_t, dense_shape=x_dense_shape_t)\nFile \"/home/anaconda3/envs/tensorflow/lib/python3.6/site-packages/tensorflow/python/framework/sparse_tensor.py\", line 119, in init\nindices, name=\"indices\", dtype=dtypes.int64)\nFile \"/home/anaconda3/envs/tensorflow/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 676, in convert_to_tensor\nas_ref=False)\nFile \"/home/anaconda3/envs/tensorflow/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 741, in internal_convert_to_tensor\nret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\nFile \"/home/anaconda3/envs/tensorflow/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 614, in _TensorTensorConversionFunction\n% (dtype.name, t.dtype.name, str(t)))\nValueError: Tensor conversion requested dtype int64 for Tensor with dtype int32: 'Tensor(\"x_indices:0\", shape=(?, 3), dtype=int32)'\nSo how to i resolve issue to create SparseTensor with int32 data.\nTensorflow Version: 1.3.0", "body": "I have saved model using tf.train.Saver.save() and then freeze the graph bu using below method:\r\ndef freezeModel(modelName):\r\n    input_graph_path = modelName + '.pb'\r\n    checkpoint_path = './' + modelName + '.ckpt'\r\n    input_saver_def_path = \"\"\r\n    input_binary = True\r\n    output_node_names = \"x_indices,x_values,x_dense_shape,unary_scores,transition_params,train_op\"\r\n    restore_op_name = \"save/restore_all\"\r\n    filename_tensor_name = \"save/Const:0\"\r\n    output_frozen_graph_name = 'frozen_' + modelName + '.pb'\r\n   \r\n    clear_devices = True\r\n\r\n    freeze_graph.freeze_graph(input_graph_path, input_saver_def_path,input_binary, checkpoint_path, output_node_names,restore_op_name, filename_tensor_name,output_frozen_graph_name, clear_devices, \"\")\r\n    #freeze_graph.freeze_graph(input_saved_model_dir='Model/', saved_model_tags='serve')\r\n    return\r\n\r\n\r\nThen loading the modelName.pb file in Android using inference api as below:\r\nTensorFlowInferenceInterface inferenceInterface = new **TensorFlowInferenceInterface**(context.getAssets(), MODEL_FILE);\r\n\r\nI am getting **below error**:\r\nCaused by: **java.io.IOException: Not a valid TensorFlow Graph serialization: Value for attr 'T' of int64 is not in the list of allowed values: float, int32**\r\n; NodeDef: Less_1 = Less[T=DT_INT64](ToInt64_2, ToInt64_3); Op<name=Less; signature=x:T, y:T -> z:bool; attr=T:type,allowed=[DT_FLOAT, DT_INT32]>\r\nat org.tensorflow.contrib.android.TensorFlowInferenceInterface.loadGraph(TensorFlowInferenceInterface.java:439)\r\nat org.tensorflow.contrib.android.TensorFlowInferenceInterface.<init>(TensorFlowInferenceInterface.java:98)\r\n\r\n\r\n **Here is the code using to create the graph:**\r\nx_indices_t= tf.placeholder(tf.int64, shape=(None, 3), name=\"x_indices\")\r\nx_values_t= tf.placeholder(tf.float32, shape=(None), name=\"x_values\")\r\nx_dense_shape_t= tf.placeholder(tf.int64, shape=(3), name=\"x_dense_shape\")#[len(X_train), max_word_count, feature_count]\r\nshape_unary_score_t = tf.placeholder(dtype=tf.int64, shape=(None, None, None), name=\"shape_unary_score\")#[num_examples_t, max_word_count, num_tags]\r\nshape_t = tf.shape(shape_unary_score_t)\r\n\r\nx_t = tf.SparseTensor(indices=x_indices, values=x_values, dense_shape=x_dense_shape)\r\n\r\n\r\nTo resolve above error i changed the dtype of indices and shapes to int32 then tf.SparseTensor() is givving below error:\r\nFile \"CRF_POS_Trainer_Tensor - Training.py\", line 323, in <module>\r\n    x_t = tf.SparseTensor(indices=x_indices_t, values=x_values_t, dense_shape=x_dense_shape_t)\r\n  File \"/home/anaconda3/envs/tensorflow/lib/python3.6/site-packages/tensorflow/python/framework/sparse_tensor.py\", line 119, in _init_\r\n    indices, name=\"indices\", dtype=dtypes.int64)\r\n  File \"/home/anaconda3/envs/tensorflow/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 676, in convert_to_tensor\r\n    as_ref=False)\r\n  File \"/home/anaconda3/envs/tensorflow/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 741, in internal_convert_to_tensor\r\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\r\n  File \"/home/anaconda3/envs/tensorflow/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 614, in _TensorTensorConversionFunction\r\n    % (dtype.name, t.dtype.name, str(t)))\r\nValueError: Tensor conversion requested dtype int64 for Tensor with dtype int32: 'Tensor(\"x_indices:0\", shape=(?, 3), dtype=int32)'\r\n        \r\n\r\nSo how to i resolve issue to create SparseTensor with int32 data.\r\n\r\n**Tensorflow Version: 1.3.0**"}