{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/325491395", "html_url": "https://github.com/tensorflow/tensorflow/issues/12608#issuecomment-325491395", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12608", "id": 325491395, "node_id": "MDEyOklzc3VlQ29tbWVudDMyNTQ5MTM5NQ==", "user": {"login": "Timeroot", "id": 568733, "node_id": "MDQ6VXNlcjU2ODczMw==", "avatar_url": "https://avatars0.githubusercontent.com/u/568733?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Timeroot", "html_url": "https://github.com/Timeroot", "followers_url": "https://api.github.com/users/Timeroot/followers", "following_url": "https://api.github.com/users/Timeroot/following{/other_user}", "gists_url": "https://api.github.com/users/Timeroot/gists{/gist_id}", "starred_url": "https://api.github.com/users/Timeroot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Timeroot/subscriptions", "organizations_url": "https://api.github.com/users/Timeroot/orgs", "repos_url": "https://api.github.com/users/Timeroot/repos", "events_url": "https://api.github.com/users/Timeroot/events{/privacy}", "received_events_url": "https://api.github.com/users/Timeroot/received_events", "type": "User", "site_admin": false}, "created_at": "2017-08-28T21:42:31Z", "updated_at": "2017-08-28T21:42:31Z", "author_association": "NONE", "body_html": "<p>It looks like relevant bounds-checking code for the CPU is in <div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/dff1062bbf53cd8890d8d43ea815c90ba4555ba4/tensorflow/core/kernels/gather_nd_op_cpu_impl.h#L57\">tensorflow/tensorflow/core/kernels/gather_nd_op_cpu_impl.h</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n         Line 57\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/dff1062bbf53cd8890d8d43ea815c90ba4555ba4\">dff1062</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L57\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"57\"></td>\n          <td id=\"LC57\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-k\">bool</span> out_of_bounds = <span class=\"pl-c1\">false</span>; </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n The 'out_of_bounds' variable gets stored in 'error_loc' and then passed out as 'bad_i' in <div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/e073322452e41e76754314aa75d543d071003fc5/tensorflow/core/kernels/gather_nd_op.cc#L126\">tensorflow/tensorflow/core/kernels/gather_nd_op.cc</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n         Line 126\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/e073322452e41e76754314aa75d543d071003fc5\">e073322</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L126\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"126\"></td>\n          <td id=\"LC126\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> bad_i = <span class=\"pl-c1\">func</span>(c-&gt;<span class=\"pl-smi\">eigen_device</span>&lt;Device&gt;(), slice_size, scratch_scalar, \\ </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>\n<p>But based on L144 in gather_nd_op.cc, it seems that the GPU kernel is currently not designed to do the bounds checking.</p>\n<p><div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/e073322452e41e76754314aa75d543d071003fc5/tensorflow/core/kernels/gather_nd_op_gpu.cu.cc#L56\">tensorflow/tensorflow/core/kernels/gather_nd_op_gpu.cu.cc</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n         Line 56\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/e073322452e41e76754314aa75d543d071003fc5\">e073322</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L56\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"56\"></td>\n          <td id=\"LC56\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> out[i] = (out_of_bounds) ? <span class=\"pl-c1\">T</span>(<span class=\"pl-c1\">0</span>) : <span class=\"pl-c1\">ldg</span>(params + offset + loc_offset); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n shows that it deliberately returns an all-zero tensors when the bounds check fails, but doesn't report the error. L91 says something about it requiring CPU/GPU communication that I honestly don't understand. I figure this will be a #dontfix for now then? :|</p>\n<p>Tagging <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1794715\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ebrevdo\">@ebrevdo</a> since it looks like his code (many thanks, though, for this useful function!)</p>", "body_text": "It looks like relevant bounds-checking code for the CPU is in \n  \n    \n      tensorflow/tensorflow/core/kernels/gather_nd_op_cpu_impl.h\n    \n    \n         Line 57\n      in\n      dff1062\n    \n    \n    \n    \n\n        \n          \n           bool out_of_bounds = false; \n        \n    \n  \n\n The 'out_of_bounds' variable gets stored in 'error_loc' and then passed out as 'bad_i' in \n  \n    \n      tensorflow/tensorflow/core/kernels/gather_nd_op.cc\n    \n    \n         Line 126\n      in\n      e073322\n    \n    \n    \n    \n\n        \n          \n           bad_i = func(c->eigen_device<Device>(), slice_size, scratch_scalar, \\ \n        \n    \n  \n\n\nBut based on L144 in gather_nd_op.cc, it seems that the GPU kernel is currently not designed to do the bounds checking.\n\n  \n    \n      tensorflow/tensorflow/core/kernels/gather_nd_op_gpu.cu.cc\n    \n    \n         Line 56\n      in\n      e073322\n    \n    \n    \n    \n\n        \n          \n           out[i] = (out_of_bounds) ? T(0) : ldg(params + offset + loc_offset); \n        \n    \n  \n\n shows that it deliberately returns an all-zero tensors when the bounds check fails, but doesn't report the error. L91 says something about it requiring CPU/GPU communication that I honestly don't understand. I figure this will be a #dontfix for now then? :|\nTagging @ebrevdo since it looks like his code (many thanks, though, for this useful function!)", "body": "It looks like relevant bounds-checking code for the CPU is in https://github.com/tensorflow/tensorflow/blob/dff1062bbf53cd8890d8d43ea815c90ba4555ba4/tensorflow/core/kernels/gather_nd_op_cpu_impl.h#L57 The 'out_of_bounds' variable gets stored in 'error_loc' and then passed out as 'bad_i' in https://github.com/tensorflow/tensorflow/blob/e073322452e41e76754314aa75d543d071003fc5/tensorflow/core/kernels/gather_nd_op.cc#L126\r\n\r\nBut based on L144 in gather_nd_op.cc, it seems that the GPU kernel is currently not designed to do the bounds checking.\r\n\r\nhttps://github.com/tensorflow/tensorflow/blob/e073322452e41e76754314aa75d543d071003fc5/tensorflow/core/kernels/gather_nd_op_gpu.cu.cc#L56 shows that it deliberately returns an all-zero tensors when the bounds check fails, but doesn't report the error. L91 says something about it requiring CPU/GPU communication that I honestly don't understand. I figure this will be a #dontfix for now then? :| \r\n\r\nTagging @ebrevdo since it looks like his code (many thanks, though, for this useful function!) "}