{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2455", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2455/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2455/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2455/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/2455", "id": 156112742, "node_id": "MDU6SXNzdWUxNTYxMTI3NDI=", "number": 2455, "title": "Adding a New Op Error:  can not load the customed file", "user": {"login": "JakeRenn", "id": 14928816, "node_id": "MDQ6VXNlcjE0OTI4ODE2", "avatar_url": "https://avatars2.githubusercontent.com/u/14928816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JakeRenn", "html_url": "https://github.com/JakeRenn", "followers_url": "https://api.github.com/users/JakeRenn/followers", "following_url": "https://api.github.com/users/JakeRenn/following{/other_user}", "gists_url": "https://api.github.com/users/JakeRenn/gists{/gist_id}", "starred_url": "https://api.github.com/users/JakeRenn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JakeRenn/subscriptions", "organizations_url": "https://api.github.com/users/JakeRenn/orgs", "repos_url": "https://api.github.com/users/JakeRenn/repos", "events_url": "https://api.github.com/users/JakeRenn/events{/privacy}", "received_events_url": "https://api.github.com/users/JakeRenn/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "keveman", "id": 229914, "node_id": "MDQ6VXNlcjIyOTkxNA==", "avatar_url": "https://avatars1.githubusercontent.com/u/229914?v=4", "gravatar_id": "", "url": "https://api.github.com/users/keveman", "html_url": "https://github.com/keveman", "followers_url": "https://api.github.com/users/keveman/followers", "following_url": "https://api.github.com/users/keveman/following{/other_user}", "gists_url": "https://api.github.com/users/keveman/gists{/gist_id}", "starred_url": "https://api.github.com/users/keveman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/keveman/subscriptions", "organizations_url": "https://api.github.com/users/keveman/orgs", "repos_url": "https://api.github.com/users/keveman/repos", "events_url": "https://api.github.com/users/keveman/events{/privacy}", "received_events_url": "https://api.github.com/users/keveman/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "keveman", "id": 229914, "node_id": "MDQ6VXNlcjIyOTkxNA==", "avatar_url": "https://avatars1.githubusercontent.com/u/229914?v=4", "gravatar_id": "", "url": "https://api.github.com/users/keveman", "html_url": "https://github.com/keveman", "followers_url": "https://api.github.com/users/keveman/followers", "following_url": "https://api.github.com/users/keveman/following{/other_user}", "gists_url": "https://api.github.com/users/keveman/gists{/gist_id}", "starred_url": "https://api.github.com/users/keveman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/keveman/subscriptions", "organizations_url": "https://api.github.com/users/keveman/orgs", "repos_url": "https://api.github.com/users/keveman/repos", "events_url": "https://api.github.com/users/keveman/events{/privacy}", "received_events_url": "https://api.github.com/users/keveman/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2016-05-21T17:26:44Z", "updated_at": "2017-01-19T03:58:09Z", "closed_at": "2016-06-09T17:05:06Z", "author_association": "NONE", "body_html": "<h3>Environment info</h3>\n<p>Operating System:  Ubuntu 14.04 LTS</p>\n<p>Installed version of CUDA and cuDNN: None</p>\n<p>If installed from binary pip package, provide:</p>\n<ol>\n<li>Which pip package you installed.<br>\nI use the command below to install tensorflow.<br>\nsudo pip install --upgrade <a href=\"https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.8.0-cp27-none-linux_x86_64.whl\" rel=\"nofollow\">https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.8.0-cp27-none-linux_x86_64.whl</a></li>\n<li>The output from python -c \"import tensorflow; print(tensorflow.<strong>version</strong>)\".<br>\n0.8.0</li>\n</ol>\n<h3>What have you tried?</h3>\n<p>I have tried to create my new operation, but there was something wrong that made me fail to load the self-defined_tensorflow_op.so. Here are steps which are exactly the same as those in the official tutorial and what I have tried.</p>\n<ol>\n<li>\n<p>Copy the whole content from the official tutorial to create a  file named tensorflow/core/user_ops/zero_out.cc . What is the file is as following.</p>\n<pre><code>#include \"tensorflow/core/framework/op.h\"\n\nREGISTER_OP(\"ZeroOut\")\n    .Input(\"to_zero: int32\")\n    .Output(\"zeroed: int32\");\n\n\\#include \"tensorflow/core/framework/op_kernel.h\"\n\nusing namespace tensorflow;\n\nclass ZeroOutOp : public OpKernel {\n public:\n  explicit ZeroOutOp(OpKernelConstruction* context) : OpKernel(context) {}\n\n  void Compute(OpKernelContext* context) override {\n    // Grab the input tensor\n    const Tensor&amp; input_tensor = context-&gt;input(0);\n    auto input = input_tensor.flat&lt;int32&gt;();\n\n    // Create an output tensor\n    Tensor* output_tensor = NULL;\n    OP_REQUIRES_OK(context, context-&gt;allocate_output(0, input_tensor.shape(),\n                                                     &amp;output_tensor));\n    auto output = output_tensor-&gt;template flat&lt;int32&gt;();\n\n    // Set all but the first element of the output tensor to 0.\n    const int N = input.size();\n    for (int i = 1; i &lt; N; i++) {\n      output(i) = 0;\n    }\n\n    // Preserve the first input value if possible.\n    if (N &gt; 0) output(0) = input(0);\n  }\n};\n\nREGISTER_KERNEL_BUILDER(Name(\"ZeroOut\").Device(DEVICE_CPU), ZeroOutOp);\n</code></pre>\n</li>\n<li>\n<p>Then I compile the zero_out.cc with following commands:</p>\n<pre><code>TF_INC=$(python -c 'import tensorflow as tf; print(tf.sysconfig.get_include())')\n\ng++ -std=c++11 -shared zero_out.cc -o zero_out.so -fPIC -I $TF_INC\n</code></pre>\n</li>\n<li>\n<p>Trying not to miss anything, I also create the BUILD file and run the corresponding commands.</p>\n<pre><code>\\# Here is the BUILD file\nload(\"//tensorflow:tensorflow.bzl\", \"tf_custom_op_library\")\n\ntf_custom_op_library(\n    name = \"zero_out.so\",\n    srcs = [\"zero_out.cc\"],\n)\n\n\\# Then run this command\n$ bazel build -c opt //tensorflow/core/user_ops:zero_out.so\n</code></pre>\n</li>\n<li>\n<p>When I try to use the new op, the error comes out.<br>\n# Run in python 2.7.11, with following command<br>\nimport tensorflow as tf<br>\nzero_out_module = tf.load_op_library('zero_out.so')</p>\n</li>\n</ol>\n<h3>Here is the error message</h3>\n<pre><code>    Traceback (most recent call last):\n      File \"&lt;stdin&gt;\", line 1, in &lt;module&gt;\n        File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/load_library.py\", line 71, in load_op_library\n            raise errors._make_specific_exception(None, None, error_msg, error_code)\n            tensorflow.python.framework.errors.NotFoundError: zero_out.so: cannot open shared object file: No such file or directory\n</code></pre>\n<p>Please help me out with this. I have spent lots of time trying to figure out what is wrong and searching for the answer, but nothing works. Any advice is also will welcome. Thanks</p>", "body_text": "Environment info\nOperating System:  Ubuntu 14.04 LTS\nInstalled version of CUDA and cuDNN: None\nIf installed from binary pip package, provide:\n\nWhich pip package you installed.\nI use the command below to install tensorflow.\nsudo pip install --upgrade https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.8.0-cp27-none-linux_x86_64.whl\nThe output from python -c \"import tensorflow; print(tensorflow.version)\".\n0.8.0\n\nWhat have you tried?\nI have tried to create my new operation, but there was something wrong that made me fail to load the self-defined_tensorflow_op.so. Here are steps which are exactly the same as those in the official tutorial and what I have tried.\n\n\nCopy the whole content from the official tutorial to create a  file named tensorflow/core/user_ops/zero_out.cc . What is the file is as following.\n#include \"tensorflow/core/framework/op.h\"\n\nREGISTER_OP(\"ZeroOut\")\n    .Input(\"to_zero: int32\")\n    .Output(\"zeroed: int32\");\n\n\\#include \"tensorflow/core/framework/op_kernel.h\"\n\nusing namespace tensorflow;\n\nclass ZeroOutOp : public OpKernel {\n public:\n  explicit ZeroOutOp(OpKernelConstruction* context) : OpKernel(context) {}\n\n  void Compute(OpKernelContext* context) override {\n    // Grab the input tensor\n    const Tensor& input_tensor = context->input(0);\n    auto input = input_tensor.flat<int32>();\n\n    // Create an output tensor\n    Tensor* output_tensor = NULL;\n    OP_REQUIRES_OK(context, context->allocate_output(0, input_tensor.shape(),\n                                                     &output_tensor));\n    auto output = output_tensor->template flat<int32>();\n\n    // Set all but the first element of the output tensor to 0.\n    const int N = input.size();\n    for (int i = 1; i < N; i++) {\n      output(i) = 0;\n    }\n\n    // Preserve the first input value if possible.\n    if (N > 0) output(0) = input(0);\n  }\n};\n\nREGISTER_KERNEL_BUILDER(Name(\"ZeroOut\").Device(DEVICE_CPU), ZeroOutOp);\n\n\n\nThen I compile the zero_out.cc with following commands:\nTF_INC=$(python -c 'import tensorflow as tf; print(tf.sysconfig.get_include())')\n\ng++ -std=c++11 -shared zero_out.cc -o zero_out.so -fPIC -I $TF_INC\n\n\n\nTrying not to miss anything, I also create the BUILD file and run the corresponding commands.\n\\# Here is the BUILD file\nload(\"//tensorflow:tensorflow.bzl\", \"tf_custom_op_library\")\n\ntf_custom_op_library(\n    name = \"zero_out.so\",\n    srcs = [\"zero_out.cc\"],\n)\n\n\\# Then run this command\n$ bazel build -c opt //tensorflow/core/user_ops:zero_out.so\n\n\n\nWhen I try to use the new op, the error comes out.\n# Run in python 2.7.11, with following command\nimport tensorflow as tf\nzero_out_module = tf.load_op_library('zero_out.so')\n\n\nHere is the error message\n    Traceback (most recent call last):\n      File \"<stdin>\", line 1, in <module>\n        File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/load_library.py\", line 71, in load_op_library\n            raise errors._make_specific_exception(None, None, error_msg, error_code)\n            tensorflow.python.framework.errors.NotFoundError: zero_out.so: cannot open shared object file: No such file or directory\n\nPlease help me out with this. I have spent lots of time trying to figure out what is wrong and searching for the answer, but nothing works. Any advice is also will welcome. Thanks", "body": "### Environment info\n\nOperating System:  Ubuntu 14.04 LTS\n\nInstalled version of CUDA and cuDNN: None \n\nIf installed from binary pip package, provide:\n1. Which pip package you installed.\n   I use the command below to install tensorflow.\n   sudo pip install --upgrade https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.8.0-cp27-none-linux_x86_64.whl\n2. The output from python -c \"import tensorflow; print(tensorflow.**version**)\".\n   0.8.0\n### What have you tried?\n\nI have tried to create my new operation, but there was something wrong that made me fail to load the self-defined_tensorflow_op.so. Here are steps which are exactly the same as those in the official tutorial and what I have tried. \n1. Copy the whole content from the official tutorial to create a  file named tensorflow/core/user_ops/zero_out.cc . What is the file is as following.\n   \n   ```\n   #include \"tensorflow/core/framework/op.h\"\n   \n   REGISTER_OP(\"ZeroOut\")\n       .Input(\"to_zero: int32\")\n       .Output(\"zeroed: int32\");\n   \n   \\#include \"tensorflow/core/framework/op_kernel.h\"\n   \n   using namespace tensorflow;\n   \n   class ZeroOutOp : public OpKernel {\n    public:\n     explicit ZeroOutOp(OpKernelConstruction* context) : OpKernel(context) {}\n   \n     void Compute(OpKernelContext* context) override {\n       // Grab the input tensor\n       const Tensor& input_tensor = context->input(0);\n       auto input = input_tensor.flat<int32>();\n   \n       // Create an output tensor\n       Tensor* output_tensor = NULL;\n       OP_REQUIRES_OK(context, context->allocate_output(0, input_tensor.shape(),\n                                                        &output_tensor));\n       auto output = output_tensor->template flat<int32>();\n   \n       // Set all but the first element of the output tensor to 0.\n       const int N = input.size();\n       for (int i = 1; i < N; i++) {\n         output(i) = 0;\n       }\n   \n       // Preserve the first input value if possible.\n       if (N > 0) output(0) = input(0);\n     }\n   };\n   \n   REGISTER_KERNEL_BUILDER(Name(\"ZeroOut\").Device(DEVICE_CPU), ZeroOutOp);\n   ```\n2. Then I compile the zero_out.cc with following commands:\n   \n   ```\n   TF_INC=$(python -c 'import tensorflow as tf; print(tf.sysconfig.get_include())')\n   \n   g++ -std=c++11 -shared zero_out.cc -o zero_out.so -fPIC -I $TF_INC\n   ```\n3. Trying not to miss anything, I also create the BUILD file and run the corresponding commands.\n   \n   ```\n   \\# Here is the BUILD file\n   load(\"//tensorflow:tensorflow.bzl\", \"tf_custom_op_library\")\n   \n   tf_custom_op_library(\n       name = \"zero_out.so\",\n       srcs = [\"zero_out.cc\"],\n   )\n   \n   \\# Then run this command\n   $ bazel build -c opt //tensorflow/core/user_ops:zero_out.so\n   ```\n4. When I try to use the new op, the error comes out. \n       # Run in python 2.7.11, with following command\n       import tensorflow as tf\n       zero_out_module = tf.load_op_library('zero_out.so')\n### Here is the error message\n\n```\n    Traceback (most recent call last):\n      File \"<stdin>\", line 1, in <module>\n        File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/load_library.py\", line 71, in load_op_library\n            raise errors._make_specific_exception(None, None, error_msg, error_code)\n            tensorflow.python.framework.errors.NotFoundError: zero_out.so: cannot open shared object file: No such file or directory\n```\n\nPlease help me out with this. I have spent lots of time trying to figure out what is wrong and searching for the answer, but nothing works. Any advice is also will welcome. Thanks \n"}