{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/427784003", "html_url": "https://github.com/tensorflow/tensorflow/issues/22162#issuecomment-427784003", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22162", "id": 427784003, "node_id": "MDEyOklzc3VlQ29tbWVudDQyNzc4NDAwMw==", "user": {"login": "stefsietz", "id": 2621937, "node_id": "MDQ6VXNlcjI2MjE5Mzc=", "avatar_url": "https://avatars0.githubusercontent.com/u/2621937?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stefsietz", "html_url": "https://github.com/stefsietz", "followers_url": "https://api.github.com/users/stefsietz/followers", "following_url": "https://api.github.com/users/stefsietz/following{/other_user}", "gists_url": "https://api.github.com/users/stefsietz/gists{/gist_id}", "starred_url": "https://api.github.com/users/stefsietz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stefsietz/subscriptions", "organizations_url": "https://api.github.com/users/stefsietz/orgs", "repos_url": "https://api.github.com/users/stefsietz/repos", "events_url": "https://api.github.com/users/stefsietz/events{/privacy}", "received_events_url": "https://api.github.com/users/stefsietz/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-08T10:19:02Z", "updated_at": "2018-10-08T10:19:02Z", "author_association": "NONE", "body_html": "<blockquote>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=2621937\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/stefsietz\">@stefsietz</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=8183542\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/kree-colemcalughlin\">@kree-colemcalughlin</a> According to <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/graph/control_flow_test.cc#L118-L145\">this test</a>, one scope can only contain one loop_control. That means, <code>tf.map_fn()</code> need to be put under different scopes. <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=2621937\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/stefsietz\">@stefsietz</a> For your test code, it will work if changing the last line to <code>connect_graphs(both_are_map_graphs=True, rename_second=True)</code>.</p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=88808\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/skye\">@skye</a> Is my understanding correct?</p>\n</blockquote>\n<p>Yes, sorry actually the second \"connect_graphs\" test call was supposed to be connect_graphs(both_are_map_graphs=True, rename_second=True) to demonstrate this behaviour.</p>", "body_text": "@stefsietz @kree-colemcalughlin According to this test, one scope can only contain one loop_control. That means, tf.map_fn() need to be put under different scopes. @stefsietz For your test code, it will work if changing the last line to connect_graphs(both_are_map_graphs=True, rename_second=True).\n@skye Is my understanding correct?\n\nYes, sorry actually the second \"connect_graphs\" test call was supposed to be connect_graphs(both_are_map_graphs=True, rename_second=True) to demonstrate this behaviour.", "body": "> @stefsietz @kree-colemcalughlin According to [this test](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/graph/control_flow_test.cc#L118-L145), one scope can only contain one loop_control. That means, `tf.map_fn()` need to be put under different scopes. @stefsietz For your test code, it will work if changing the last line to `connect_graphs(both_are_map_graphs=True, rename_second=True)`.\r\n> \r\n> @skye Is my understanding correct?\r\n\r\nYes, sorry actually the second \"connect_graphs\" test call was supposed to be connect_graphs(both_are_map_graphs=True, rename_second=True) to demonstrate this behaviour."}