{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20976", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20976/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20976/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20976/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/20976", "id": 342812222, "node_id": "MDU6SXNzdWUzNDI4MTIyMjI=", "number": 20976, "title": "map_fn removes a dimension", "user": {"login": "johnsrude", "id": 15482785, "node_id": "MDQ6VXNlcjE1NDgyNzg1", "avatar_url": "https://avatars1.githubusercontent.com/u/15482785?v=4", "gravatar_id": "", "url": "https://api.github.com/users/johnsrude", "html_url": "https://github.com/johnsrude", "followers_url": "https://api.github.com/users/johnsrude/followers", "following_url": "https://api.github.com/users/johnsrude/following{/other_user}", "gists_url": "https://api.github.com/users/johnsrude/gists{/gist_id}", "starred_url": "https://api.github.com/users/johnsrude/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/johnsrude/subscriptions", "organizations_url": "https://api.github.com/users/johnsrude/orgs", "repos_url": "https://api.github.com/users/johnsrude/repos", "events_url": "https://api.github.com/users/johnsrude/events{/privacy}", "received_events_url": "https://api.github.com/users/johnsrude/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "drpngx", "id": 20959853, "node_id": "MDQ6VXNlcjIwOTU5ODUz", "avatar_url": "https://avatars1.githubusercontent.com/u/20959853?v=4", "gravatar_id": "", "url": "https://api.github.com/users/drpngx", "html_url": "https://github.com/drpngx", "followers_url": "https://api.github.com/users/drpngx/followers", "following_url": "https://api.github.com/users/drpngx/following{/other_user}", "gists_url": "https://api.github.com/users/drpngx/gists{/gist_id}", "starred_url": "https://api.github.com/users/drpngx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/drpngx/subscriptions", "organizations_url": "https://api.github.com/users/drpngx/orgs", "repos_url": "https://api.github.com/users/drpngx/repos", "events_url": "https://api.github.com/users/drpngx/events{/privacy}", "received_events_url": "https://api.github.com/users/drpngx/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "drpngx", "id": 20959853, "node_id": "MDQ6VXNlcjIwOTU5ODUz", "avatar_url": "https://avatars1.githubusercontent.com/u/20959853?v=4", "gravatar_id": "", "url": "https://api.github.com/users/drpngx", "html_url": "https://github.com/drpngx", "followers_url": "https://api.github.com/users/drpngx/followers", "following_url": "https://api.github.com/users/drpngx/following{/other_user}", "gists_url": "https://api.github.com/users/drpngx/gists{/gist_id}", "starred_url": "https://api.github.com/users/drpngx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/drpngx/subscriptions", "organizations_url": "https://api.github.com/users/drpngx/orgs", "repos_url": "https://api.github.com/users/drpngx/repos", "events_url": "https://api.github.com/users/drpngx/events{/privacy}", "received_events_url": "https://api.github.com/users/drpngx/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 14, "created_at": "2018-07-19T17:00:38Z", "updated_at": "2018-08-09T23:45:45Z", "closed_at": "2018-08-07T21:59:55Z", "author_association": "NONE", "body_html": "<p>I am trying to remap values in an input Tensor using a defaultdict.</p>\n<pre><code>class MyDataSet(object):\n    def __init__(self):\n        self.class_map = MyDataSet.remap_class()\n\n    @staticmethod\n    def remap_class():\n        class_remap = defaultdict(lambda: 11)\n        class_remap[128] = 0  \n        class_remap[130] = 1  \n        class_remap[132] = 2\n        # ...\n\n    def parser(self, serialized_example):\n        features = tf.parse_single_example(\n            serialized_example,\n            features={\n                'image': tf.FixedLenFeature([], tf.string),\n                'label': tf.FixedLenFeature([], tf.string),\n            })\n        label = tf.decode_raw(features['label'], tf.uint8)\n        label.set_shape([256 * 512])\n        label = tf.cast(tf.reshape(label, [256, 512]), tf.int32)\n\n        output_label = tf.map_fn(lambda x: self.class_map(x), label)\n\n    #...\n    dataset = tf.data.TFRecordDataset(filenames).repeat()\n    dataset = dataset.map(self.parser, num_parallel_calls=batch_size)\n</code></pre>\n<p>The label shape is (256,512) but the output_label shape is (256,).  I can't change this shape with tf.reshape() or output_label.set_shape().</p>\n<p>This seems to be a bug.</p>", "body_text": "I am trying to remap values in an input Tensor using a defaultdict.\nclass MyDataSet(object):\n    def __init__(self):\n        self.class_map = MyDataSet.remap_class()\n\n    @staticmethod\n    def remap_class():\n        class_remap = defaultdict(lambda: 11)\n        class_remap[128] = 0  \n        class_remap[130] = 1  \n        class_remap[132] = 2\n        # ...\n\n    def parser(self, serialized_example):\n        features = tf.parse_single_example(\n            serialized_example,\n            features={\n                'image': tf.FixedLenFeature([], tf.string),\n                'label': tf.FixedLenFeature([], tf.string),\n            })\n        label = tf.decode_raw(features['label'], tf.uint8)\n        label.set_shape([256 * 512])\n        label = tf.cast(tf.reshape(label, [256, 512]), tf.int32)\n\n        output_label = tf.map_fn(lambda x: self.class_map(x), label)\n\n    #...\n    dataset = tf.data.TFRecordDataset(filenames).repeat()\n    dataset = dataset.map(self.parser, num_parallel_calls=batch_size)\n\nThe label shape is (256,512) but the output_label shape is (256,).  I can't change this shape with tf.reshape() or output_label.set_shape().\nThis seems to be a bug.", "body": "I am trying to remap values in an input Tensor using a defaultdict.\r\n\r\n    class MyDataSet(object):\r\n        def __init__(self):\r\n            self.class_map = MyDataSet.remap_class()\r\n\r\n        @staticmethod\r\n        def remap_class():\r\n            class_remap = defaultdict(lambda: 11)\r\n            class_remap[128] = 0  \r\n            class_remap[130] = 1  \r\n            class_remap[132] = 2\r\n            # ...\r\n\r\n        def parser(self, serialized_example):\r\n            features = tf.parse_single_example(\r\n                serialized_example,\r\n                features={\r\n                    'image': tf.FixedLenFeature([], tf.string),\r\n                    'label': tf.FixedLenFeature([], tf.string),\r\n                })\r\n            label = tf.decode_raw(features['label'], tf.uint8)\r\n            label.set_shape([256 * 512])\r\n            label = tf.cast(tf.reshape(label, [256, 512]), tf.int32)\r\n    \r\n            output_label = tf.map_fn(lambda x: self.class_map(x), label)\r\n\r\n        #...\r\n        dataset = tf.data.TFRecordDataset(filenames).repeat()\r\n        dataset = dataset.map(self.parser, num_parallel_calls=batch_size)\r\n\r\n\r\nThe label shape is (256,512) but the output_label shape is (256,).  I can't change this shape with tf.reshape() or output_label.set_shape().\r\n\r\nThis seems to be a bug. "}