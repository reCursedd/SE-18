{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2818", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2818/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2818/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2818/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/2818", "id": 159845989, "node_id": "MDU6SXNzdWUxNTk4NDU5ODk=", "number": 2818, "title": "tf.gradients casts away imaginary part of result when differentiating by a real value ", "user": {"login": "ibab", "id": 890531, "node_id": "MDQ6VXNlcjg5MDUzMQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/890531?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibab", "html_url": "https://github.com/ibab", "followers_url": "https://api.github.com/users/ibab/followers", "following_url": "https://api.github.com/users/ibab/following{/other_user}", "gists_url": "https://api.github.com/users/ibab/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibab/subscriptions", "organizations_url": "https://api.github.com/users/ibab/orgs", "repos_url": "https://api.github.com/users/ibab/repos", "events_url": "https://api.github.com/users/ibab/events{/privacy}", "received_events_url": "https://api.github.com/users/ibab/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "girving", "id": 70511, "node_id": "MDQ6VXNlcjcwNTEx", "avatar_url": "https://avatars1.githubusercontent.com/u/70511?v=4", "gravatar_id": "", "url": "https://api.github.com/users/girving", "html_url": "https://github.com/girving", "followers_url": "https://api.github.com/users/girving/followers", "following_url": "https://api.github.com/users/girving/following{/other_user}", "gists_url": "https://api.github.com/users/girving/gists{/gist_id}", "starred_url": "https://api.github.com/users/girving/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/girving/subscriptions", "organizations_url": "https://api.github.com/users/girving/orgs", "repos_url": "https://api.github.com/users/girving/repos", "events_url": "https://api.github.com/users/girving/events{/privacy}", "received_events_url": "https://api.github.com/users/girving/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "girving", "id": 70511, "node_id": "MDQ6VXNlcjcwNTEx", "avatar_url": "https://avatars1.githubusercontent.com/u/70511?v=4", "gravatar_id": "", "url": "https://api.github.com/users/girving", "html_url": "https://github.com/girving", "followers_url": "https://api.github.com/users/girving/followers", "following_url": "https://api.github.com/users/girving/following{/other_user}", "gists_url": "https://api.github.com/users/girving/gists{/gist_id}", "starred_url": "https://api.github.com/users/girving/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/girving/subscriptions", "organizations_url": "https://api.github.com/users/girving/orgs", "repos_url": "https://api.github.com/users/girving/repos", "events_url": "https://api.github.com/users/girving/events{/privacy}", "received_events_url": "https://api.github.com/users/girving/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2016-06-12T20:28:29Z", "updated_at": "2018-07-13T11:18:01Z", "closed_at": "2017-01-24T20:56:34Z", "author_association": "CONTRIBUTOR", "body_html": "<p>This is continued from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"153518419\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/2255\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/2255/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/2255\">#2255</a>:</p>\n<p>Differentiating a complex expression by a real value with <code>tf.gradients</code> should yield a complex value, but this doesn't seem to be the way that <code>tf.gradients</code> works at the moment.<br>\nIf I run</p>\n<pre><code>import tensorflow as tf\nimport numpy as np\n\ns = tf.Session()\nx = tf.placeholder(tf.float32)\n\nz = tf.complex(0., x)\n\nprint('full', s.run(tf.gradients(z, [x]), feed_dict={x: 1}))\nprint('real', s.run(tf.gradients(tf.real(z), [x]), feed_dict={x: 1}))\nprint('imag', s.run(tf.gradients(tf.imag(z), [x]), feed_dict={x: 1}))\n</code></pre>\n<p>The output is</p>\n<pre><code>full [0.0]\nreal [0.0]\nimag [1.0]\n</code></pre>\n<p>while I would have expected</p>\n<pre><code>full [0.0 + 1.0j]\nreal [0.0]\nimag [1.0]\n</code></pre>\n<p>I suspect that <code>tf.gradients</code> always casts the final result to the type of the variable that we differentiate with respect to, which makes sense in many circumstances, but leads to incorrect behaviour in this case.</p>", "body_text": "This is continued from #2255:\nDifferentiating a complex expression by a real value with tf.gradients should yield a complex value, but this doesn't seem to be the way that tf.gradients works at the moment.\nIf I run\nimport tensorflow as tf\nimport numpy as np\n\ns = tf.Session()\nx = tf.placeholder(tf.float32)\n\nz = tf.complex(0., x)\n\nprint('full', s.run(tf.gradients(z, [x]), feed_dict={x: 1}))\nprint('real', s.run(tf.gradients(tf.real(z), [x]), feed_dict={x: 1}))\nprint('imag', s.run(tf.gradients(tf.imag(z), [x]), feed_dict={x: 1}))\n\nThe output is\nfull [0.0]\nreal [0.0]\nimag [1.0]\n\nwhile I would have expected\nfull [0.0 + 1.0j]\nreal [0.0]\nimag [1.0]\n\nI suspect that tf.gradients always casts the final result to the type of the variable that we differentiate with respect to, which makes sense in many circumstances, but leads to incorrect behaviour in this case.", "body": "This is continued from #2255:\n\nDifferentiating a complex expression by a real value with `tf.gradients` should yield a complex value, but this doesn't seem to be the way that `tf.gradients` works at the moment.\nIf I run\n\n```\nimport tensorflow as tf\nimport numpy as np\n\ns = tf.Session()\nx = tf.placeholder(tf.float32)\n\nz = tf.complex(0., x)\n\nprint('full', s.run(tf.gradients(z, [x]), feed_dict={x: 1}))\nprint('real', s.run(tf.gradients(tf.real(z), [x]), feed_dict={x: 1}))\nprint('imag', s.run(tf.gradients(tf.imag(z), [x]), feed_dict={x: 1}))\n```\n\nThe output is\n\n```\nfull [0.0]\nreal [0.0]\nimag [1.0]\n```\n\nwhile I would have expected\n\n```\nfull [0.0 + 1.0j]\nreal [0.0]\nimag [1.0]\n```\n\nI suspect that `tf.gradients` always casts the final result to the type of the variable that we differentiate with respect to, which makes sense in many circumstances, but leads to incorrect behaviour in this case.\n"}