{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11355", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11355/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11355/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11355/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/11355", "id": 241311317, "node_id": "MDU6SXNzdWUyNDEzMTEzMTc=", "number": 11355, "title": "Use pretrained model VGG16 for android app (demo example)", "user": {"login": "dongsungkim", "id": 13468075, "node_id": "MDQ6VXNlcjEzNDY4MDc1", "avatar_url": "https://avatars3.githubusercontent.com/u/13468075?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dongsungkim", "html_url": "https://github.com/dongsungkim", "followers_url": "https://api.github.com/users/dongsungkim/followers", "following_url": "https://api.github.com/users/dongsungkim/following{/other_user}", "gists_url": "https://api.github.com/users/dongsungkim/gists{/gist_id}", "starred_url": "https://api.github.com/users/dongsungkim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dongsungkim/subscriptions", "organizations_url": "https://api.github.com/users/dongsungkim/orgs", "repos_url": "https://api.github.com/users/dongsungkim/repos", "events_url": "https://api.github.com/users/dongsungkim/events{/privacy}", "received_events_url": "https://api.github.com/users/dongsungkim/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-07-07T16:12:41Z", "updated_at": "2017-07-07T16:29:02Z", "closed_at": "2017-07-07T16:29:02Z", "author_association": "NONE", "body_html": "<p>I download demo example which uses tensorflow_inception_graph.pb from the google tensorflow download page.</p>\n<p>What I want to do is to replace it with vgg_16.pb. (The same demo app, only difference is the model')</p>\n<p>But I need a help for replacing those with new ones.</p>\n<p>In ClassifierActivity.java (<a href=\"https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android\">https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android</a>)</p>\n<pre><code>private static final int **INPUT_SIZE** = 224; ==&gt; 224\nprivate static final int **IMAGE_MEAN** = 117; ==&gt; ?\nprivate static final float **IMAGE_STD** = 1; ==&gt; ?\nprivate static final String **INPUT_NAME** = \"input\";\nprivate static final String **OUTPUT_NAME** = \"output\";\n\nprivate static final String MODEL_FILE = \"file:///android_asset/tensorflow_inception_graph.pb\"; ==&gt;changing the file \nprivate static final String **LABEL_FILE** =\n    \"file:///android_asset/imagenet_comp_graph_label_strings.txt\";  ==&gt; reusing it. Is it ok? (vgg16 is also trained with imagenet data)\n</code></pre>\n<p>I want to replace \"tensorflow_inception_graph.pb\" with \"vgg_16.pb\"</p>\n<p>For that, I followed those step</p>\n<ol>\n<li>converting ckpt to pbtxt</li>\n</ol>\n<pre><code>import tensorflow as tf\nimport tensorflow.contrib.slim as slim\nfrom nets.vgg import vgg_16, vgg_arg_scope\nimport numpy as np\n\nheight = 224\nwidth = 224\nchannels = 3\n\n# Create graph\nX = tf.placeholder(tf.float32, shape=[None, height, width, channels])\nwith slim.arg_scope(vgg_arg_scope()):\n        logits, end_points = vgg_16(X, num_classes=1000, is_training=False)\npredictions = end_points[\"vgg_16/fc8\"]\nsaver = tf.train.Saver()\n\nX_test = np.ones((1,224,224,3))\n\nwith tf.Session() as sess:\n        saver.restore(sess,\"./vgg_16.ckpt\")\n        predictions_val = predictions.eval(feed_dict={X: X_test})\n        tf.train.write_graph(sess.graph_def, './', 'vgg_16.pbtxt')\n</code></pre>\n<ol start=\"2\">\n<li>\n<p>creating pb file<br>\n<code>python [../../../../]tensorflow/tensorflow/python/tools/freeze_graph.py --input_graph=./vgg_16.pbtxt --input_checkpoint=./vgg_16.ckpt --output_graph=./vgg_16.pb --output_node_names=vgg_16/fc8/squeezed</code></p>\n</li>\n<li>\n<p>Finding input, output</p>\n</li>\n</ol>\n<pre><code>\nimport tensorflow as tf\nimport os\nimport numpy as np\nfrom tensorflow.python.platform import gfile\n\nwith gfile.FastGFile(\"./vgg_16.pb\",'rb') as f:\n    graph_def = tf.GraphDef()\n    graph_def.ParseFromString(f.read())\n    tf.import_graph_def(graph_def, name='')\n\n[n.name + '=&gt;' +  n.op for n in graph_def.node if n.op in ( 'Softmax','Placeholder', 'Squeeze')]\n</code></pre>\n<p><code>[u'Placeholder=&gt;Placeholder', u'vgg_16/fc8/squeezed=&gt;Squeeze']</code></p>\n<pre><code>with tf.Session() as sess:\n    input_x = sess.graph.get_tensor_by_name(\"Placeholder:0\")\n    print input_x\n    input_x = sess.graph.get_operation_by_name(\"Placeholder\")\n    print input_x\n    out = sess.graph.get_tensor_by_name(\"vgg_16/fc8/squeezed:0\")\n    print out\n    output = sess.graph.get_operation_by_name(\"vgg_16/fc8/squeezed\")\n    print output\n</code></pre>\n<pre><code>Tensor(\"Placeholder:0\", dtype=float32)\nname: \"Placeholder\"\nop: \"Placeholder\"\nattr {\n  key: \"dtype\"\n  value {\n    type: DT_FLOAT\n  }\n}\nattr {\n  key: \"shape\"\n  value {\n    shape {\n    }\n  }\n}\n\nTensor(\"vgg_16/fc8/squeezed:0\", shape=(?, 1000), dtype=float32)\nname: \"vgg_16/fc8/squeezed\"\nop: \"Squeeze\"\ninput: \"vgg_16/fc8/BiasAdd\"\nattr {\n  key: \"T\"\n  value {\n    type: DT_FLOAT\n  }\n}\nattr {\n  key: \"squeeze_dims\"\n  value {\n    list {\n      i: 1\n      i: 2\n    }\n  }\n}\n</code></pre>\n<p>But why input and output is not kind of demo codes. Do I change it to</p>\n<pre><code>  private static final String **INPUT_NAME** = \"input\"; ==&gt; \"Policeholde\"\n  private static final String **OUTPUT_NAME** = \"output\"; ==&gt; \"vgg_16/fc8/squeezed\"\n</code></pre>\n<ol start=\"4\">\n<li>Last one. the size of<br>\neventhough I run the script. the size is not changed much.. Still big 553MB<br>\n<code>python ../../../../tensorflow/tensorflow/python/tools/optimize_for_inference.py --input=./inception_v3.pb --output=./vgg_16.pb --input_names= ? --output_names=vgg_16/fc8/squeezed</code></li>\n</ol>\n<pre><code>553440161 Jul  7 16:06 optimized_graph_vgg_16.pb\n553444585 Jul  7 09:46 vgg_16.pb\n</code></pre>", "body_text": "I download demo example which uses tensorflow_inception_graph.pb from the google tensorflow download page.\nWhat I want to do is to replace it with vgg_16.pb. (The same demo app, only difference is the model')\nBut I need a help for replacing those with new ones.\nIn ClassifierActivity.java (https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android)\nprivate static final int **INPUT_SIZE** = 224; ==> 224\nprivate static final int **IMAGE_MEAN** = 117; ==> ?\nprivate static final float **IMAGE_STD** = 1; ==> ?\nprivate static final String **INPUT_NAME** = \"input\";\nprivate static final String **OUTPUT_NAME** = \"output\";\n\nprivate static final String MODEL_FILE = \"file:///android_asset/tensorflow_inception_graph.pb\"; ==>changing the file \nprivate static final String **LABEL_FILE** =\n    \"file:///android_asset/imagenet_comp_graph_label_strings.txt\";  ==> reusing it. Is it ok? (vgg16 is also trained with imagenet data)\n\nI want to replace \"tensorflow_inception_graph.pb\" with \"vgg_16.pb\"\nFor that, I followed those step\n\nconverting ckpt to pbtxt\n\nimport tensorflow as tf\nimport tensorflow.contrib.slim as slim\nfrom nets.vgg import vgg_16, vgg_arg_scope\nimport numpy as np\n\nheight = 224\nwidth = 224\nchannels = 3\n\n# Create graph\nX = tf.placeholder(tf.float32, shape=[None, height, width, channels])\nwith slim.arg_scope(vgg_arg_scope()):\n        logits, end_points = vgg_16(X, num_classes=1000, is_training=False)\npredictions = end_points[\"vgg_16/fc8\"]\nsaver = tf.train.Saver()\n\nX_test = np.ones((1,224,224,3))\n\nwith tf.Session() as sess:\n        saver.restore(sess,\"./vgg_16.ckpt\")\n        predictions_val = predictions.eval(feed_dict={X: X_test})\n        tf.train.write_graph(sess.graph_def, './', 'vgg_16.pbtxt')\n\n\n\ncreating pb file\npython [../../../../]tensorflow/tensorflow/python/tools/freeze_graph.py --input_graph=./vgg_16.pbtxt --input_checkpoint=./vgg_16.ckpt --output_graph=./vgg_16.pb --output_node_names=vgg_16/fc8/squeezed\n\n\nFinding input, output\n\n\n\nimport tensorflow as tf\nimport os\nimport numpy as np\nfrom tensorflow.python.platform import gfile\n\nwith gfile.FastGFile(\"./vgg_16.pb\",'rb') as f:\n    graph_def = tf.GraphDef()\n    graph_def.ParseFromString(f.read())\n    tf.import_graph_def(graph_def, name='')\n\n[n.name + '=>' +  n.op for n in graph_def.node if n.op in ( 'Softmax','Placeholder', 'Squeeze')]\n\n[u'Placeholder=>Placeholder', u'vgg_16/fc8/squeezed=>Squeeze']\nwith tf.Session() as sess:\n    input_x = sess.graph.get_tensor_by_name(\"Placeholder:0\")\n    print input_x\n    input_x = sess.graph.get_operation_by_name(\"Placeholder\")\n    print input_x\n    out = sess.graph.get_tensor_by_name(\"vgg_16/fc8/squeezed:0\")\n    print out\n    output = sess.graph.get_operation_by_name(\"vgg_16/fc8/squeezed\")\n    print output\n\nTensor(\"Placeholder:0\", dtype=float32)\nname: \"Placeholder\"\nop: \"Placeholder\"\nattr {\n  key: \"dtype\"\n  value {\n    type: DT_FLOAT\n  }\n}\nattr {\n  key: \"shape\"\n  value {\n    shape {\n    }\n  }\n}\n\nTensor(\"vgg_16/fc8/squeezed:0\", shape=(?, 1000), dtype=float32)\nname: \"vgg_16/fc8/squeezed\"\nop: \"Squeeze\"\ninput: \"vgg_16/fc8/BiasAdd\"\nattr {\n  key: \"T\"\n  value {\n    type: DT_FLOAT\n  }\n}\nattr {\n  key: \"squeeze_dims\"\n  value {\n    list {\n      i: 1\n      i: 2\n    }\n  }\n}\n\nBut why input and output is not kind of demo codes. Do I change it to\n  private static final String **INPUT_NAME** = \"input\"; ==> \"Policeholde\"\n  private static final String **OUTPUT_NAME** = \"output\"; ==> \"vgg_16/fc8/squeezed\"\n\n\nLast one. the size of\neventhough I run the script. the size is not changed much.. Still big 553MB\npython ../../../../tensorflow/tensorflow/python/tools/optimize_for_inference.py --input=./inception_v3.pb --output=./vgg_16.pb --input_names= ? --output_names=vgg_16/fc8/squeezed\n\n553440161 Jul  7 16:06 optimized_graph_vgg_16.pb\n553444585 Jul  7 09:46 vgg_16.pb", "body": "I download demo example which uses tensorflow_inception_graph.pb from the google tensorflow download page.\r\n\r\nWhat I want to do is to replace it with vgg_16.pb. (The same demo app, only difference is the model')\r\n\r\nBut I need a help for replacing those with new ones.\r\n\r\nIn ClassifierActivity.java (https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android)\r\n\r\n  ```\r\nprivate static final int **INPUT_SIZE** = 224; ==> 224\r\n  private static final int **IMAGE_MEAN** = 117; ==> ?\r\n  private static final float **IMAGE_STD** = 1; ==> ?\r\n  private static final String **INPUT_NAME** = \"input\";\r\n  private static final String **OUTPUT_NAME** = \"output\";\r\n\r\n  private static final String MODEL_FILE = \"file:///android_asset/tensorflow_inception_graph.pb\"; ==>changing the file \r\n  private static final String **LABEL_FILE** =\r\n      \"file:///android_asset/imagenet_comp_graph_label_strings.txt\";  ==> reusing it. Is it ok? (vgg16 is also trained with imagenet data)\r\n```\r\n\r\nI want to replace \"tensorflow_inception_graph.pb\" with \"vgg_16.pb\"\r\n\r\nFor that, I followed those step\r\n1. converting ckpt to pbtxt\r\n\r\n```\r\nimport tensorflow as tf\r\nimport tensorflow.contrib.slim as slim\r\nfrom nets.vgg import vgg_16, vgg_arg_scope\r\nimport numpy as np\r\n\r\nheight = 224\r\nwidth = 224\r\nchannels = 3\r\n\r\n# Create graph\r\nX = tf.placeholder(tf.float32, shape=[None, height, width, channels])\r\nwith slim.arg_scope(vgg_arg_scope()):\r\n        logits, end_points = vgg_16(X, num_classes=1000, is_training=False)\r\npredictions = end_points[\"vgg_16/fc8\"]\r\nsaver = tf.train.Saver()\r\n\r\nX_test = np.ones((1,224,224,3))\r\n\r\nwith tf.Session() as sess:\r\n        saver.restore(sess,\"./vgg_16.ckpt\")\r\n        predictions_val = predictions.eval(feed_dict={X: X_test})\r\n        tf.train.write_graph(sess.graph_def, './', 'vgg_16.pbtxt')\r\n```\r\n2. creating pb file \r\n`python [../../../../]tensorflow/tensorflow/python/tools/freeze_graph.py --input_graph=./vgg_16.pbtxt --input_checkpoint=./vgg_16.ckpt --output_graph=./vgg_16.pb --output_node_names=vgg_16/fc8/squeezed`\r\n\r\n3. Finding input, output \r\n```\r\n\r\nimport tensorflow as tf\r\nimport os\r\nimport numpy as np\r\nfrom tensorflow.python.platform import gfile\r\n\r\nwith gfile.FastGFile(\"./vgg_16.pb\",'rb') as f:\r\n    graph_def = tf.GraphDef()\r\n    graph_def.ParseFromString(f.read())\r\n    tf.import_graph_def(graph_def, name='')\r\n\r\n[n.name + '=>' +  n.op for n in graph_def.node if n.op in ( 'Softmax','Placeholder', 'Squeeze')]\r\n```\r\n`[u'Placeholder=>Placeholder', u'vgg_16/fc8/squeezed=>Squeeze']`\r\n\r\n```\r\nwith tf.Session() as sess:\r\n    input_x = sess.graph.get_tensor_by_name(\"Placeholder:0\")\r\n    print input_x\r\n    input_x = sess.graph.get_operation_by_name(\"Placeholder\")\r\n    print input_x\r\n    out = sess.graph.get_tensor_by_name(\"vgg_16/fc8/squeezed:0\")\r\n    print out\r\n    output = sess.graph.get_operation_by_name(\"vgg_16/fc8/squeezed\")\r\n    print output\r\n```\r\n```\r\nTensor(\"Placeholder:0\", dtype=float32)\r\nname: \"Placeholder\"\r\nop: \"Placeholder\"\r\nattr {\r\n  key: \"dtype\"\r\n  value {\r\n    type: DT_FLOAT\r\n  }\r\n}\r\nattr {\r\n  key: \"shape\"\r\n  value {\r\n    shape {\r\n    }\r\n  }\r\n}\r\n\r\nTensor(\"vgg_16/fc8/squeezed:0\", shape=(?, 1000), dtype=float32)\r\nname: \"vgg_16/fc8/squeezed\"\r\nop: \"Squeeze\"\r\ninput: \"vgg_16/fc8/BiasAdd\"\r\nattr {\r\n  key: \"T\"\r\n  value {\r\n    type: DT_FLOAT\r\n  }\r\n}\r\nattr {\r\n  key: \"squeeze_dims\"\r\n  value {\r\n    list {\r\n      i: 1\r\n      i: 2\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nBut why input and output is not kind of demo codes. Do I change it to \r\n```\r\n  private static final String **INPUT_NAME** = \"input\"; ==> \"Policeholde\"\r\n  private static final String **OUTPUT_NAME** = \"output\"; ==> \"vgg_16/fc8/squeezed\"\r\n```\r\n\r\n4. Last one. the size of \r\n  eventhough I run the script. the size is not changed much.. Still big 553MB\r\n`python ../../../../tensorflow/tensorflow/python/tools/optimize_for_inference.py --input=./inception_v3.pb --output=./vgg_16.pb --input_names= ? --output_names=vgg_16/fc8/squeezed`\r\n\r\n```\r\n553440161 Jul  7 16:06 optimized_graph_vgg_16.pb\r\n553444585 Jul  7 09:46 vgg_16.pb\r\n```"}