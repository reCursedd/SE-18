{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/138216406", "pull_request_review_id": 61982669, "id": 138216406, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzODIxNjQwNg==", "diff_hunk": "@@ -412,34 +411,39 @@ void LaunchFusedConv2DBiasActivationOp<GPUDevice, T>::launch(\n   AlgorithmConfig algorithm_config;\n   if (cudnn_use_autotune && !AutoTuneConvBiasActivation::GetInstance()->Find(\n                                 conv_parameters, &algorithm_config)) {\n-    std::vector<AlgorithmType> algorithms;\n+    std::vector<AlgorithmType::Index> algorithms;\n     CHECK(stream->parent()->GetConvolveAlgorithms(\n         conv_parameters.ShouldIncludeWinogradNonfusedAlgo<T>(), &algorithms));\n     ProfileResult best_result;\n     ProfileResult best_result_no_scratch;\n-    for (auto profile_algorithm : algorithms) {\n-      // TODO(zhengxq): profile each algorithm multiple times to better\n-      // accuracy.\n-      CudnnScratchAllocator scratch_allocator(ConvolveScratchSize, ctx);\n-      ProfileResult profile_result;\n-      bool cudnn_launch_status =\n-          stream\n-              ->ThenConvolveWithAlgorithm(\n-                  input_desc, input_ptr, filter_desc, filter_ptr, conv_desc,\n-                  bias_ptr, cudnn_activation_mode, output_desc, &output_ptr,\n-                  &scratch_allocator, AlgorithmConfig(profile_algorithm),\n-                  &profile_result)\n-              .ok();\n-      if (cudnn_launch_status) {\n-        if (profile_result.is_valid()) {\n-          if (profile_result.elapsed_time_in_ms() <\n-              best_result.elapsed_time_in_ms()) {\n-            best_result = profile_result;\n-          }\n-          if (scratch_allocator.TotalByteSize() == 0 &&\n-              profile_result.elapsed_time_in_ms() <\n-                  best_result_no_scratch.elapsed_time_in_ms()) {\n-            best_result_no_scratch = profile_result;\n+    // TODO(benbarsdell): Ideally this should not attempt using tensor op math\n+    //                      if it's not enabled.", "path": "tensorflow/contrib/fused_conv/kernels/fused_conv2d_bias_activation_op.cc", "position": null, "original_position": 42, "commit_id": "8ddc5af4dc546baea4e075c153d834731b4487bf", "original_commit_id": "bba5967a3fde4ae6626dea9a8f477a52a744bf00", "user": {"login": "nluehr", "id": 1873655, "node_id": "MDQ6VXNlcjE4NzM2NTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1873655?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nluehr", "html_url": "https://github.com/nluehr", "followers_url": "https://api.github.com/users/nluehr/followers", "following_url": "https://api.github.com/users/nluehr/following{/other_user}", "gists_url": "https://api.github.com/users/nluehr/gists{/gist_id}", "starred_url": "https://api.github.com/users/nluehr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nluehr/subscriptions", "organizations_url": "https://api.github.com/users/nluehr/orgs", "repos_url": "https://api.github.com/users/nluehr/repos", "events_url": "https://api.github.com/users/nluehr/events{/privacy}", "received_events_url": "https://api.github.com/users/nluehr/received_events", "type": "User", "site_admin": false}, "body": "That may be the best option. But the TODO would still move inside the GetConvolveAlgorithms function. The work required is figuring out how to determine where tensor ops are applicable without brute forcing the search.", "created_at": "2017-09-11T23:13:50Z", "updated_at": "2017-09-15T18:08:26Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/12503#discussion_r138216406", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12503", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/138216406"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/12503#discussion_r138216406"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12503"}}, "body_html": "<p>That may be the best option. But the TODO would still move inside the GetConvolveAlgorithms function. The work required is figuring out how to determine where tensor ops are applicable without brute forcing the search.</p>", "body_text": "That may be the best option. But the TODO would still move inside the GetConvolveAlgorithms function. The work required is figuring out how to determine where tensor ops are applicable without brute forcing the search.", "in_reply_to_id": 137604284}