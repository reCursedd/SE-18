{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13282", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13282/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13282/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13282/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/13282", "id": 260122329, "node_id": "MDExOlB1bGxSZXF1ZXN0MTQyNzc0NzQ2", "number": 13282, "title": "Relex restrictions on `tf.foldr` and `tf.foldl`", "user": {"login": "yongtang", "id": 6932348, "node_id": "MDQ6VXNlcjY5MzIzNDg=", "avatar_url": "https://avatars0.githubusercontent.com/u/6932348?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yongtang", "html_url": "https://github.com/yongtang", "followers_url": "https://api.github.com/users/yongtang/followers", "following_url": "https://api.github.com/users/yongtang/following{/other_user}", "gists_url": "https://api.github.com/users/yongtang/gists{/gist_id}", "starred_url": "https://api.github.com/users/yongtang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yongtang/subscriptions", "organizations_url": "https://api.github.com/users/yongtang/orgs", "repos_url": "https://api.github.com/users/yongtang/repos", "events_url": "https://api.github.com/users/yongtang/events{/privacy}", "received_events_url": "https://api.github.com/users/yongtang/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}, {"id": 474725938, "node_id": "MDU6TGFiZWw0NzQ3MjU5Mzg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stalled", "name": "stalled", "color": "d4c5f9", "default": false}, {"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 13, "created_at": "2017-09-24T22:52:35Z", "updated_at": "2017-12-23T07:34:49Z", "closed_at": "2017-12-23T07:34:48Z", "author_association": "MEMBER", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13282", "html_url": "https://github.com/tensorflow/tensorflow/pull/13282", "diff_url": "https://github.com/tensorflow/tensorflow/pull/13282.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/13282.patch"}, "body_html": "<p>This fix tries to address the issue raised in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"247823207\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/12019\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/12019/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/12019\">#12019</a> where <code>tf.foldr</code> and <code>tf.foldl</code> only accpet first shape dimensions be identical for all list elements.</p>\n<p>The issue comes from the implementation of <code>tf.foldr</code> and <code>tf.foldl</code> where the input elems is converted to tensor, then converted to tensor array:<br>\n<div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/1e1b3d90295f9396a25b9cfd4c571f7949716182/tensorflow/python/ops/functional_ops.py#L100-L106\">tensorflow/tensorflow/python/ops/functional_ops.py</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n        Lines 100 to 106\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/1e1b3d90295f9396a25b9cfd4c571f7949716182\">1e1b3d9</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L100\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"100\"></td>\n          <td id=\"LC100\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-c\"><span class=\"pl-c\">#</span> Convert elems to tensor array.</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L101\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"101\"></td>\n          <td id=\"LC101\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> elems <span class=\"pl-k\">=</span> ops.convert_to_tensor(elems, <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>elems<span class=\"pl-pds\">\"</span></span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L102\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"102\"></td>\n          <td id=\"LC102\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> n <span class=\"pl-k\">=</span> array_ops.shape(elems)[<span class=\"pl-c1\">0</span>] </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L103\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"103\"></td>\n          <td id=\"LC103\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> elems_ta <span class=\"pl-k\">=</span> tensor_array_ops.TensorArray(<span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>elems.dtype, <span class=\"pl-v\">size</span><span class=\"pl-k\">=</span>n, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L104\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"104\"></td>\n          <td id=\"LC104\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">                                         <span class=\"pl-v\">dynamic_size</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">False</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L105\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"105\"></td>\n          <td id=\"LC105\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">                                         <span class=\"pl-v\">infer_shape</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L106\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"106\"></td>\n          <td id=\"LC106\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> elems_ta <span class=\"pl-k\">=</span> elems_ta.unstack(elems) </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>\n<p>It is possible to bypass the conversion to tensor, and go directly to tensor array, as long as the input elems is Iterable (and pass <code>infer_shape=False</code>)</p>\n<p>This fix is an proposal to relex the restriction on <code>tf.foldr</code> and <code>tf.foldl</code> so that a list of elements with different shapes could be passed.</p>\n<p>This fix <span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #12019.\">fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"247823207\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/12019\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/12019/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/12019\">#12019</a>.</p>\n<p>Signed-off-by: Yong Tang <a href=\"mailto:yong.tang.github@outlook.com\">yong.tang.github@outlook.com</a></p>", "body_text": "This fix tries to address the issue raised in #12019 where tf.foldr and tf.foldl only accpet first shape dimensions be identical for all list elements.\nThe issue comes from the implementation of tf.foldr and tf.foldl where the input elems is converted to tensor, then converted to tensor array:\n\n  \n    \n      tensorflow/tensorflow/python/ops/functional_ops.py\n    \n    \n        Lines 100 to 106\n      in\n      1e1b3d9\n    \n    \n    \n    \n\n        \n          \n           # Convert elems to tensor array. \n        \n\n        \n          \n           elems = ops.convert_to_tensor(elems, name=\"elems\") \n        \n\n        \n          \n           n = array_ops.shape(elems)[0] \n        \n\n        \n          \n           elems_ta = tensor_array_ops.TensorArray(dtype=elems.dtype, size=n, \n        \n\n        \n          \n                                                   dynamic_size=False, \n        \n\n        \n          \n                                                   infer_shape=True) \n        \n\n        \n          \n           elems_ta = elems_ta.unstack(elems) \n        \n    \n  \n\n\nIt is possible to bypass the conversion to tensor, and go directly to tensor array, as long as the input elems is Iterable (and pass infer_shape=False)\nThis fix is an proposal to relex the restriction on tf.foldr and tf.foldl so that a list of elements with different shapes could be passed.\nThis fix fixes #12019.\nSigned-off-by: Yong Tang yong.tang.github@outlook.com", "body": "This fix tries to address the issue raised in #12019 where `tf.foldr` and `tf.foldl` only accpet first shape dimensions be identical for all list elements.\r\n\r\nThe issue comes from the implementation of `tf.foldr` and `tf.foldl` where the input elems is converted to tensor, then converted to tensor array:\r\nhttps://github.com/tensorflow/tensorflow/blob/1e1b3d90295f9396a25b9cfd4c571f7949716182/tensorflow/python/ops/functional_ops.py#L100-L106\r\n\r\nIt is possible to bypass the conversion to tensor, and go directly to tensor array, as long as the input elems is Iterable (and pass `infer_shape=False`)\r\n\r\nThis fix is an proposal to relex the restriction on `tf.foldr` and `tf.foldl` so that a list of elements with different shapes could be passed.\r\n\r\nThis fix fixes #12019.\r\n\r\nSigned-off-by: Yong Tang <yong.tang.github@outlook.com>"}