{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18720", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18720/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18720/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18720/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/18720", "id": 316130548, "node_id": "MDU6SXNzdWUzMTYxMzA1NDg=", "number": 18720, "title": "Problem:  Cannot merge devices with incompatible types: '/job:localhost/replica:0/task:0/device:CPU:0' and '/job:localhost/replica:0/task:0/device:GPU:0'", "user": {"login": "chauhochow", "id": 26325462, "node_id": "MDQ6VXNlcjI2MzI1NDYy", "avatar_url": "https://avatars3.githubusercontent.com/u/26325462?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chauhochow", "html_url": "https://github.com/chauhochow", "followers_url": "https://api.github.com/users/chauhochow/followers", "following_url": "https://api.github.com/users/chauhochow/following{/other_user}", "gists_url": "https://api.github.com/users/chauhochow/gists{/gist_id}", "starred_url": "https://api.github.com/users/chauhochow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chauhochow/subscriptions", "organizations_url": "https://api.github.com/users/chauhochow/orgs", "repos_url": "https://api.github.com/users/chauhochow/repos", "events_url": "https://api.github.com/users/chauhochow/events{/privacy}", "received_events_url": "https://api.github.com/users/chauhochow/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 9, "created_at": "2018-04-20T05:16:38Z", "updated_at": "2018-08-14T19:48:18Z", "closed_at": "2018-08-14T19:45:14Z", "author_association": "NONE", "body_html": "<p>I get a problem. Here is the description of the error:</p>\n<p>Caused by op u'block_stack_0/block_0/short_cut/weight/Initializer/random_uniform/RandomUniform', defined at:<br>\nFile \"train.py\", line 133, in <br>\ntrain()<br>\nFile \"train.py\", line 84, in train<br>\nmodel.get_loss(image, gt, args.block_num_channel_list)<br>\nFile \"model.py\", line 145, in get_loss<br>\nself.logits = self.inference(images, block_num_channel_list=block_num_channel_list)<br>\nFile \"model.py\", line 126, in inference<br>\noutput = self.stack(inputs=output, output_channel=bottel_neck_channel * 4, stack_num=stack_num, strides=stride, scope='block_stack_%d' % stack_block_index, bottel_neck_channel=bottel_neck_channel)<br>\nFile \"model.py\", line 118, in stack<br>\noutput = self.block(inputs, bottel_neck_channel=bottel_neck_channel, output_channel=output_channel, strides=strides, is_projection=True, scope='block_0')<br>\nFile \"model.py\", line 106, in block<br>\nshort_cut = self.conv(output, kernel_size=1, strides=strides, output_channel=output_channel, scope='short_cut', use_bias=False, is_activate=False)<br>\nFile \"model.py\", line 48, in conv<br>\nname='weight')<br>\nFile \"model.py\", line 36, in get_variable<br>\ntrainable=trainable)<br>\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 1065, in get_variable<br>\nuse_resource=use_resource, custom_getter=custom_getter)<br>\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 962, in get_variable<br>\nuse_resource=use_resource, custom_getter=custom_getter)<br>\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 367, in get_variable<br>\nvalidate_shape=validate_shape, use_resource=use_resource)<br>\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 352, in _true_getter<br>\nuse_resource=use_resource)<br>\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 725, in _get_single_variable<br>\nvalidate_shape=validate_shape)<br>\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 199, in <strong>init</strong><br>\nexpected_shape=expected_shape)<br>\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 277, in _init_from_args<br>\ninitial_value(), name=\"initial_value\", dtype=dtype)<br>\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 701, in <br>\nshape.as_list(), dtype=dtype, partition_info=partition_info)<br>\nFile \"/usr/lib/python2.7/site-packages/tensorflow/contrib/layers/python/layers/initializers.py\", line 144, in _initializer<br>\ndtype, seed=seed)<br>\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/random_ops.py\", line 240, in random_uniform<br>\nshape, dtype, seed=seed1, seed2=seed2)<br>\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/gen_random_ops.py\", line 247, in _random_uniform<br>\nseed=seed, seed2=seed2, name=name)<br>\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 767, in apply_op<br>\nop_def=op_def)<br>\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2630, in create_op<br>\noriginal_op=self._default_original_op, op_def=op_def)<br>\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1204, in <strong>init</strong><br>\nself._traceback = self._graph._extract_stack()  # pylint: disable=protected-access</p>\n<p>InvalidArgumentError (see above for traceback): Cannot colocate nodes 'block_stack_0/block_0/short_cut/weight/Initializer/random_uniform/RandomUniform' and 'block_stack_0/block_0/short_cut/weight: Cannot merge devices with incompatible types: '/job:localhost/replica:0/task:0/device:CPU:0' and '/job:localhost/replica:0/task:0/device:GPU:0'<br>\n[[Node: block_stack_0/block_0/short_cut/weight/Initializer/random_uniform/RandomUniform = RandomUniform<a href=\"block_stack_0/block_0/short_cut/weight/Initializer/random_uniform/shape\">T=DT_INT32, _class=[\"loc:@block_stack_0/block_0/short_cut/weight\"], dtype=DT_FLOAT, seed=0, seed2=0</a>]]</p>\n<p>('add regulariztion, regularization decay:', 0.003)<br>\nset learning rate<br>\nTraceback (most recent call last):<br>\nFile \"train.py\", line 133, in <br>\ntrain()<br>\nFile \"train.py\", line 91, in train<br>\nsess.run(tf.global_variables_initializer())<br>\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 895, in run<br>\nrun_metadata_ptr)<br>\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1124, in _run<br>\nfeed_dict_tensor, options, run_metadata)<br>\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1321, in _do_run<br>\noptions, run_metadata)<br>\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1340, in _do_call<br>\nraise type(e)(node_def, op, message)<br>\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Node 'block_stack_0/block_0/short_cut/cond/Switch_1': Unknown input node 'block_stack_0/block_0/short_cut/weight/Initializer/random_uniform'</p>\n<p>it seems that the error happen on the op \"tf.global_variables_initializer()\"<br>\nsome code may be related to this error is :</p>\n<p>os.environ['CUDA_VISIBLE_DEVICES'] = '0'</p>\n<p>with tf.device('/cpu:0'):<br>\nvar = tf.get_variable(shape=shape,<br>\nname=name,<br>\ndtype=dtype,<br>\ninitializer=initializer,<br>\nregularizer=regularizer,<br>\ntrainable=trainable)<br>\nmoving_average_opt = self.moving_averager.apply([var])<br>\ntf.add_to_collection(tf.GraphKeys.UPDATE_OPS, moving_average_opt)<br>\nmoving_average_variable = self.moving_averager.average(var)<br>\ntf.summary.histogram(var.name, var)<br>\ntf.summary.histogram('moving_'+ var.name, moving_average_variable)</p>\n<p>how can i solve this problem? Thanks.</p>", "body_text": "I get a problem. Here is the description of the error:\nCaused by op u'block_stack_0/block_0/short_cut/weight/Initializer/random_uniform/RandomUniform', defined at:\nFile \"train.py\", line 133, in \ntrain()\nFile \"train.py\", line 84, in train\nmodel.get_loss(image, gt, args.block_num_channel_list)\nFile \"model.py\", line 145, in get_loss\nself.logits = self.inference(images, block_num_channel_list=block_num_channel_list)\nFile \"model.py\", line 126, in inference\noutput = self.stack(inputs=output, output_channel=bottel_neck_channel * 4, stack_num=stack_num, strides=stride, scope='block_stack_%d' % stack_block_index, bottel_neck_channel=bottel_neck_channel)\nFile \"model.py\", line 118, in stack\noutput = self.block(inputs, bottel_neck_channel=bottel_neck_channel, output_channel=output_channel, strides=strides, is_projection=True, scope='block_0')\nFile \"model.py\", line 106, in block\nshort_cut = self.conv(output, kernel_size=1, strides=strides, output_channel=output_channel, scope='short_cut', use_bias=False, is_activate=False)\nFile \"model.py\", line 48, in conv\nname='weight')\nFile \"model.py\", line 36, in get_variable\ntrainable=trainable)\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 1065, in get_variable\nuse_resource=use_resource, custom_getter=custom_getter)\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 962, in get_variable\nuse_resource=use_resource, custom_getter=custom_getter)\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 367, in get_variable\nvalidate_shape=validate_shape, use_resource=use_resource)\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 352, in _true_getter\nuse_resource=use_resource)\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 725, in _get_single_variable\nvalidate_shape=validate_shape)\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 199, in init\nexpected_shape=expected_shape)\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 277, in _init_from_args\ninitial_value(), name=\"initial_value\", dtype=dtype)\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 701, in \nshape.as_list(), dtype=dtype, partition_info=partition_info)\nFile \"/usr/lib/python2.7/site-packages/tensorflow/contrib/layers/python/layers/initializers.py\", line 144, in _initializer\ndtype, seed=seed)\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/random_ops.py\", line 240, in random_uniform\nshape, dtype, seed=seed1, seed2=seed2)\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/gen_random_ops.py\", line 247, in _random_uniform\nseed=seed, seed2=seed2, name=name)\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 767, in apply_op\nop_def=op_def)\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2630, in create_op\noriginal_op=self._default_original_op, op_def=op_def)\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1204, in init\nself._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\nInvalidArgumentError (see above for traceback): Cannot colocate nodes 'block_stack_0/block_0/short_cut/weight/Initializer/random_uniform/RandomUniform' and 'block_stack_0/block_0/short_cut/weight: Cannot merge devices with incompatible types: '/job:localhost/replica:0/task:0/device:CPU:0' and '/job:localhost/replica:0/task:0/device:GPU:0'\n[[Node: block_stack_0/block_0/short_cut/weight/Initializer/random_uniform/RandomUniform = RandomUniformT=DT_INT32, _class=[\"loc:@block_stack_0/block_0/short_cut/weight\"], dtype=DT_FLOAT, seed=0, seed2=0]]\n('add regulariztion, regularization decay:', 0.003)\nset learning rate\nTraceback (most recent call last):\nFile \"train.py\", line 133, in \ntrain()\nFile \"train.py\", line 91, in train\nsess.run(tf.global_variables_initializer())\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 895, in run\nrun_metadata_ptr)\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1124, in _run\nfeed_dict_tensor, options, run_metadata)\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1321, in _do_run\noptions, run_metadata)\nFile \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1340, in _do_call\nraise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Node 'block_stack_0/block_0/short_cut/cond/Switch_1': Unknown input node 'block_stack_0/block_0/short_cut/weight/Initializer/random_uniform'\nit seems that the error happen on the op \"tf.global_variables_initializer()\"\nsome code may be related to this error is :\nos.environ['CUDA_VISIBLE_DEVICES'] = '0'\nwith tf.device('/cpu:0'):\nvar = tf.get_variable(shape=shape,\nname=name,\ndtype=dtype,\ninitializer=initializer,\nregularizer=regularizer,\ntrainable=trainable)\nmoving_average_opt = self.moving_averager.apply([var])\ntf.add_to_collection(tf.GraphKeys.UPDATE_OPS, moving_average_opt)\nmoving_average_variable = self.moving_averager.average(var)\ntf.summary.histogram(var.name, var)\ntf.summary.histogram('moving_'+ var.name, moving_average_variable)\nhow can i solve this problem? Thanks.", "body": "I get a problem. Here is the description of the error:\r\n\r\nCaused by op u'block_stack_0/block_0/short_cut/weight/Initializer/random_uniform/RandomUniform', defined at:\r\n  File \"train.py\", line 133, in <module>\r\n    train()\r\n  File \"train.py\", line 84, in train\r\n    model.get_loss(image, gt, args.block_num_channel_list)\r\n  File \"model.py\", line 145, in get_loss\r\n    self.logits = self.inference(images, block_num_channel_list=block_num_channel_list)\r\n  File \"model.py\", line 126, in inference\r\n    output = self.stack(inputs=output, output_channel=bottel_neck_channel * 4, stack_num=stack_num, strides=stride, scope='block_stack_%d' % stack_block_index, bottel_neck_channel=bottel_neck_channel)\r\n  File \"model.py\", line 118, in stack\r\n    output = self.block(inputs, bottel_neck_channel=bottel_neck_channel, output_channel=output_channel, strides=strides, is_projection=True, scope='block_0')\r\n  File \"model.py\", line 106, in block\r\n    short_cut = self.conv(output, kernel_size=1, strides=strides, output_channel=output_channel, scope='short_cut', use_bias=False, is_activate=False)\r\n  File \"model.py\", line 48, in conv\r\n    name='weight')\r\n  File \"model.py\", line 36, in get_variable\r\n    trainable=trainable)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 1065, in get_variable\r\n    use_resource=use_resource, custom_getter=custom_getter)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 962, in get_variable\r\n    use_resource=use_resource, custom_getter=custom_getter)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 367, in get_variable\r\n    validate_shape=validate_shape, use_resource=use_resource)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 352, in _true_getter\r\n    use_resource=use_resource)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 725, in _get_single_variable\r\n    validate_shape=validate_shape)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 199, in __init__\r\n    expected_shape=expected_shape)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 277, in _init_from_args\r\n    initial_value(), name=\"initial_value\", dtype=dtype)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 701, in <lambda>\r\n    shape.as_list(), dtype=dtype, partition_info=partition_info)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/contrib/layers/python/layers/initializers.py\", line 144, in _initializer\r\n    dtype, seed=seed)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/random_ops.py\", line 240, in random_uniform\r\n    shape, dtype, seed=seed1, seed2=seed2)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/ops/gen_random_ops.py\", line 247, in _random_uniform\r\n    seed=seed, seed2=seed2, name=name)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 767, in apply_op\r\n    op_def=op_def)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2630, in create_op\r\n    original_op=self._default_original_op, op_def=op_def)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1204, in __init__\r\n    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\r\n\r\nInvalidArgumentError (see above for traceback): Cannot colocate nodes 'block_stack_0/block_0/short_cut/weight/Initializer/random_uniform/RandomUniform' and 'block_stack_0/block_0/short_cut/weight: Cannot merge devices with incompatible types: '/job:localhost/replica:0/task:0/device:CPU:0' and '/job:localhost/replica:0/task:0/device:GPU:0'\r\n\t [[Node: block_stack_0/block_0/short_cut/weight/Initializer/random_uniform/RandomUniform = RandomUniform[T=DT_INT32, _class=[\"loc:@block_stack_0/block_0/short_cut/weight\"], dtype=DT_FLOAT, seed=0, seed2=0](block_stack_0/block_0/short_cut/weight/Initializer/random_uniform/shape)]]\r\n\r\n\r\n('add regulariztion, regularization decay:', 0.003)\r\nset learning rate\r\nTraceback (most recent call last):\r\n  File \"train.py\", line 133, in <module>\r\n    train()\r\n  File \"train.py\", line 91, in train\r\n    sess.run(tf.global_variables_initializer())\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 895, in run\r\n    run_metadata_ptr)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1124, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1321, in _do_run\r\n    options, run_metadata)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1340, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Node 'block_stack_0/block_0/short_cut/cond/Switch_1': Unknown input node 'block_stack_0/block_0/short_cut/weight/Initializer/random_uniform'\r\n\r\n\r\n\r\nit seems that the error happen on the op \"tf.global_variables_initializer()\"\r\nsome code may be related to this error is : \r\n\r\nos.environ['CUDA_VISIBLE_DEVICES'] = '0'\r\n\r\nwith tf.device('/cpu:0'):\r\n            var = tf.get_variable(shape=shape,\r\n                                  name=name,\r\n                                  dtype=dtype,\r\n                                  initializer=initializer,\r\n                                  regularizer=regularizer,\r\n                                  trainable=trainable)\r\n            moving_average_opt = self.moving_averager.apply([var])\r\n            tf.add_to_collection(tf.GraphKeys.UPDATE_OPS, moving_average_opt)\r\n            moving_average_variable = self.moving_averager.average(var)\r\n            tf.summary.histogram(var.name, var)\r\n            tf.summary.histogram('moving_'+ var.name, moving_average_variable)\r\n\r\n\r\nhow can i solve this problem? Thanks. \r\n\r\n"}