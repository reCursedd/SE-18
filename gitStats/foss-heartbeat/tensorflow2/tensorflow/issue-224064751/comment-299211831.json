{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/299211831", "html_url": "https://github.com/tensorflow/tensorflow/pull/9432#issuecomment-299211831", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9432", "id": 299211831, "node_id": "MDEyOklzc3VlQ29tbWVudDI5OTIxMTgzMQ==", "user": {"login": "shamoya", "id": 22274255, "node_id": "MDQ6VXNlcjIyMjc0MjU1", "avatar_url": "https://avatars2.githubusercontent.com/u/22274255?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shamoya", "html_url": "https://github.com/shamoya", "followers_url": "https://api.github.com/users/shamoya/followers", "following_url": "https://api.github.com/users/shamoya/following{/other_user}", "gists_url": "https://api.github.com/users/shamoya/gists{/gist_id}", "starred_url": "https://api.github.com/users/shamoya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shamoya/subscriptions", "organizations_url": "https://api.github.com/users/shamoya/orgs", "repos_url": "https://api.github.com/users/shamoya/repos", "events_url": "https://api.github.com/users/shamoya/events{/privacy}", "received_events_url": "https://api.github.com/users/shamoya/received_events", "type": "User", "site_admin": false}, "created_at": "2017-05-04T15:01:20Z", "updated_at": "2017-05-04T15:01:20Z", "author_association": "CONTRIBUTOR", "body_html": "<p>OK <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=192829\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/llhe\">@llhe</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=12075848\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/junshi15\">@junshi15</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1207763\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/li-ch\">@li-ch</a> - I see the issue now.</p>\n<p>It comes from:<br>\n(line 478 rdma.cc) attr.path_mtu = IBV_MTU_4096;</p>\n<p>This won't work on standard 1500 MTU Ethernet network of course.<br>\nIn this case (1500 MTU Ethernet network) one should use IBV_MTU_1024 (RoCE MTU are always power of 2).</p>\n<p>I guess whoever didn't noticed it, is working with MTU 9000 (or above 4K) on his Ethernet network.</p>\n<p>Also in IB network this is wrong (since the MTU configured can also different, depends on how SM was configured) but will most likely work as 4K as the usually the MTU.</p>\n<p>Another good reason to use rdmacm, as it deals with it in the best way (queries the correct MTU configured on the device, in both IB/Ethernet cases).</p>\n<p>Until we'll have the rdmacm code (I hope soon, having some delays here) I think we should change to attr.path_mtu = IBV_MTU_1024 - which will work for 99.99% of the cases and the performance will not be felt.</p>", "body_text": "OK @llhe @junshi15 @li-ch - I see the issue now.\nIt comes from:\n(line 478 rdma.cc) attr.path_mtu = IBV_MTU_4096;\nThis won't work on standard 1500 MTU Ethernet network of course.\nIn this case (1500 MTU Ethernet network) one should use IBV_MTU_1024 (RoCE MTU are always power of 2).\nI guess whoever didn't noticed it, is working with MTU 9000 (or above 4K) on his Ethernet network.\nAlso in IB network this is wrong (since the MTU configured can also different, depends on how SM was configured) but will most likely work as 4K as the usually the MTU.\nAnother good reason to use rdmacm, as it deals with it in the best way (queries the correct MTU configured on the device, in both IB/Ethernet cases).\nUntil we'll have the rdmacm code (I hope soon, having some delays here) I think we should change to attr.path_mtu = IBV_MTU_1024 - which will work for 99.99% of the cases and the performance will not be felt.", "body": "OK @llhe @junshi15 @li-ch - I see the issue now.\r\n\r\nIt comes from:\r\n(line 478 rdma.cc) attr.path_mtu = IBV_MTU_4096; \r\n\r\nThis won't work on standard 1500 MTU Ethernet network of course.\r\nIn this case (1500 MTU Ethernet network) one should use IBV_MTU_1024 (RoCE MTU are always power of 2).\r\n\r\nI guess whoever didn't noticed it, is working with MTU 9000 (or above 4K) on his Ethernet network.\r\n\r\nAlso in IB network this is wrong (since the MTU configured can also different, depends on how SM was configured) but will most likely work as 4K as the usually the MTU.\r\n\r\nAnother good reason to use rdmacm, as it deals with it in the best way (queries the correct MTU configured on the device, in both IB/Ethernet cases).\r\n\r\nUntil we'll have the rdmacm code (I hope soon, having some delays here) I think we should change to attr.path_mtu = IBV_MTU_1024 - which will work for 99.99% of the cases and the performance will not be felt."}