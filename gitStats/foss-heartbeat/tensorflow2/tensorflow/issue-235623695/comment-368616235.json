{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/368616235", "html_url": "https://github.com/tensorflow/tensorflow/issues/10685#issuecomment-368616235", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10685", "id": 368616235, "node_id": "MDEyOklzc3VlQ29tbWVudDM2ODYxNjIzNQ==", "user": {"login": "anton-matosov", "id": 3339485, "node_id": "MDQ6VXNlcjMzMzk0ODU=", "avatar_url": "https://avatars1.githubusercontent.com/u/3339485?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anton-matosov", "html_url": "https://github.com/anton-matosov", "followers_url": "https://api.github.com/users/anton-matosov/followers", "following_url": "https://api.github.com/users/anton-matosov/following{/other_user}", "gists_url": "https://api.github.com/users/anton-matosov/gists{/gist_id}", "starred_url": "https://api.github.com/users/anton-matosov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anton-matosov/subscriptions", "organizations_url": "https://api.github.com/users/anton-matosov/orgs", "repos_url": "https://api.github.com/users/anton-matosov/repos", "events_url": "https://api.github.com/users/anton-matosov/events{/privacy}", "received_events_url": "https://api.github.com/users/anton-matosov/received_events", "type": "User", "site_admin": false}, "created_at": "2018-02-26T19:17:20Z", "updated_at": "2018-02-26T19:17:20Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Hi everyone,<br>\nI am yet another MacBook Pro owner struggling to gain a bit more performance.<br>\nFortunately I had some degree of success with MKL, but only in docker instances so far.<br>\nIt gives about 3.5x of performance gain compared to <code>native</code> build (tested with resnet50 benchmark)</p>\n<hr>\n<h2>Test Hardware:</h2>\n<pre><code>MacBook Pro (15-inch, 2016)\nmacOS High Sierra 10.13.3 (17D47)\n2.6 GHz Intel Core i7\n16 GB 2133 MHz LPDDR3\n</code></pre>\n<h2>Docker image with MKL</h2>\n<p><code>antonmatosov/tensorflow:latest-devel-cpu-mkl-py3</code></p>\n<hr>\n<h2>Here are test results</h2>\n<p>Non MKL build - total images/sec: 1.31<br>\nMK build - total images/sec: 4.75</p>\n<p><strong>Total gain: 3.63</strong></p>\n<h2>Here are full results:</h2>\n<h3>Native build with triSYCL enabled, executed on bare OS:</h3>\n<pre><code>python tf_cnn_benchmarks.py --num_gpus=1 --batch_size=32 --model=resnet50 --data_format=NHWC\n\n\nTensorFlow:  1.5\nModel:       resnet50\nDataset:     imagenet (synthetic)\nMode:        training\nSingleSess:  False\nBatch size:  32 global\n             32.0 per device\nNum batches: 100\nNum epochs:  0.00\nDevices:     ['/gpu:0']\nData format: NHWC\nLayout optimizer: False\nOptimizer:   sgd\nVariables:   parameter_server\n==========\n\nStep\tImg/sec\ttotal_loss\nI0223 23:10:55.230010 123145468305408 tf_logging.py:110] Starting real work at step 10 at time Fri Feb 23 23:10:55 2018\n1\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n10\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n20\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n30\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n40\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n50\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n60\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n70\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n80\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n90\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\nI0223 23:51:10.453911 123145468305408 tf_logging.py:110] Finishing real work at step 109 at time Fri Feb 23 23:51:10 2018\n100\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n----------------------------------------------------------------\ntotal images/sec: 1.31\n----------------------------------------------------------------\n</code></pre>\n<hr>\n<h3>MKL enabled build on Docker for Mac (4 CPUs, 4GB)</h3>\n<pre><code>python3 tf_cnn_benchmarks.py --batch_size=32 --model=resnet50\n\nTensorFlow:  1.5\nModel:       resnet50\nDataset:     imagenet (synthetic)\nMode:        training\nSingleSess:  False\nBatch size:  32 global\n             32.0 per device\nNum batches: 100\nNum epochs:  0.00\nDevices:     ['/gpu:0']\nData format: NCHW\nLayout optimizer: False\nOptimizer:   sgd\nVariables:   parameter_server\n==========\n\nStep\tImg/sec\ttotal_loss\nI0225 23:12:09.519792 140405827925760 tf_logging.py:110] Starting real work at step 10 at time Sun Feb 25 23:12:09 2018\n1\timages/sec: 4.9 +/- 0.0 (jitter = 0.0)\t11.576\n10\timages/sec: 4.7 +/- 0.0 (jitter = 0.1)\t8.911\n20\timages/sec: 4.7 +/- 0.0 (jitter = 0.1)\t8.426\n30\timages/sec: 4.7 +/- 0.0 (jitter = 0.2)\t8.177\n40\timages/sec: 4.7 +/- 0.0 (jitter = 0.1)\t15.682\n50\timages/sec: 4.7 +/- 0.0 (jitter = 0.1)\t7.956\n60\timages/sec: 4.7 +/- 0.0 (jitter = 0.1)\t8.638\n70\timages/sec: 4.7 +/- 0.0 (jitter = 0.1)\t8.246\n80\timages/sec: 4.7 +/- 0.0 (jitter = 0.2)\t7.947\n90\timages/sec: 4.7 +/- 0.0 (jitter = 0.2)\t7.906\nI0225 23:23:16.803599 140405827925760 tf_logging.py:110] Finishing real work at step 109 at time Sun Feb 25 23:23:16 2018\n100\timages/sec: 4.8 +/- 0.0 (jitter = 0.2)\t7.874\n----------------------------------------------------------------\ntotal images/sec: 4.75\n----------------------------------------------------------------\n</code></pre>", "body_text": "Hi everyone,\nI am yet another MacBook Pro owner struggling to gain a bit more performance.\nFortunately I had some degree of success with MKL, but only in docker instances so far.\nIt gives about 3.5x of performance gain compared to native build (tested with resnet50 benchmark)\n\nTest Hardware:\nMacBook Pro (15-inch, 2016)\nmacOS High Sierra 10.13.3 (17D47)\n2.6 GHz Intel Core i7\n16 GB 2133 MHz LPDDR3\n\nDocker image with MKL\nantonmatosov/tensorflow:latest-devel-cpu-mkl-py3\n\nHere are test results\nNon MKL build - total images/sec: 1.31\nMK build - total images/sec: 4.75\nTotal gain: 3.63\nHere are full results:\nNative build with triSYCL enabled, executed on bare OS:\npython tf_cnn_benchmarks.py --num_gpus=1 --batch_size=32 --model=resnet50 --data_format=NHWC\n\n\nTensorFlow:  1.5\nModel:       resnet50\nDataset:     imagenet (synthetic)\nMode:        training\nSingleSess:  False\nBatch size:  32 global\n             32.0 per device\nNum batches: 100\nNum epochs:  0.00\nDevices:     ['/gpu:0']\nData format: NHWC\nLayout optimizer: False\nOptimizer:   sgd\nVariables:   parameter_server\n==========\n\nStep\tImg/sec\ttotal_loss\nI0223 23:10:55.230010 123145468305408 tf_logging.py:110] Starting real work at step 10 at time Fri Feb 23 23:10:55 2018\n1\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n10\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n20\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n30\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n40\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n50\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n60\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n70\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n80\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n90\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\nI0223 23:51:10.453911 123145468305408 tf_logging.py:110] Finishing real work at step 109 at time Fri Feb 23 23:51:10 2018\n100\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\n----------------------------------------------------------------\ntotal images/sec: 1.31\n----------------------------------------------------------------\n\n\nMKL enabled build on Docker for Mac (4 CPUs, 4GB)\npython3 tf_cnn_benchmarks.py --batch_size=32 --model=resnet50\n\nTensorFlow:  1.5\nModel:       resnet50\nDataset:     imagenet (synthetic)\nMode:        training\nSingleSess:  False\nBatch size:  32 global\n             32.0 per device\nNum batches: 100\nNum epochs:  0.00\nDevices:     ['/gpu:0']\nData format: NCHW\nLayout optimizer: False\nOptimizer:   sgd\nVariables:   parameter_server\n==========\n\nStep\tImg/sec\ttotal_loss\nI0225 23:12:09.519792 140405827925760 tf_logging.py:110] Starting real work at step 10 at time Sun Feb 25 23:12:09 2018\n1\timages/sec: 4.9 +/- 0.0 (jitter = 0.0)\t11.576\n10\timages/sec: 4.7 +/- 0.0 (jitter = 0.1)\t8.911\n20\timages/sec: 4.7 +/- 0.0 (jitter = 0.1)\t8.426\n30\timages/sec: 4.7 +/- 0.0 (jitter = 0.2)\t8.177\n40\timages/sec: 4.7 +/- 0.0 (jitter = 0.1)\t15.682\n50\timages/sec: 4.7 +/- 0.0 (jitter = 0.1)\t7.956\n60\timages/sec: 4.7 +/- 0.0 (jitter = 0.1)\t8.638\n70\timages/sec: 4.7 +/- 0.0 (jitter = 0.1)\t8.246\n80\timages/sec: 4.7 +/- 0.0 (jitter = 0.2)\t7.947\n90\timages/sec: 4.7 +/- 0.0 (jitter = 0.2)\t7.906\nI0225 23:23:16.803599 140405827925760 tf_logging.py:110] Finishing real work at step 109 at time Sun Feb 25 23:23:16 2018\n100\timages/sec: 4.8 +/- 0.0 (jitter = 0.2)\t7.874\n----------------------------------------------------------------\ntotal images/sec: 4.75\n----------------------------------------------------------------", "body": "Hi everyone,\r\nI am yet another MacBook Pro owner struggling to gain a bit more performance.\r\nFortunately I had some degree of success with MKL, but only in docker instances so far.\r\nIt gives about 3.5x of performance gain compared to `native` build (tested with resnet50 benchmark)\r\n\r\n---\r\n\r\n## Test Hardware:\r\n```\r\nMacBook Pro (15-inch, 2016)\r\nmacOS High Sierra 10.13.3 (17D47)\r\n2.6 GHz Intel Core i7\r\n16 GB 2133 MHz LPDDR3\r\n```\r\n\r\n## Docker image with MKL\r\n`antonmatosov/tensorflow:latest-devel-cpu-mkl-py3`\r\n\r\n-----\r\n## Here are test results\r\n\r\nNon MKL build - total images/sec: 1.31\r\nMK build - total images/sec: 4.75\r\n\r\n**Total gain: 3.63**\r\n\r\n## Here are full results:\r\n\r\n### Native build with triSYCL enabled, executed on bare OS:\r\n```\r\npython tf_cnn_benchmarks.py --num_gpus=1 --batch_size=32 --model=resnet50 --data_format=NHWC\r\n\r\n\r\nTensorFlow:  1.5\r\nModel:       resnet50\r\nDataset:     imagenet (synthetic)\r\nMode:        training\r\nSingleSess:  False\r\nBatch size:  32 global\r\n             32.0 per device\r\nNum batches: 100\r\nNum epochs:  0.00\r\nDevices:     ['/gpu:0']\r\nData format: NHWC\r\nLayout optimizer: False\r\nOptimizer:   sgd\r\nVariables:   parameter_server\r\n==========\r\n\r\nStep\tImg/sec\ttotal_loss\r\nI0223 23:10:55.230010 123145468305408 tf_logging.py:110] Starting real work at step 10 at time Fri Feb 23 23:10:55 2018\r\n1\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\r\n10\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\r\n20\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\r\n30\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\r\n40\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\r\n50\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\r\n60\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\r\n70\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\r\n80\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\r\n90\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\r\nI0223 23:51:10.453911 123145468305408 tf_logging.py:110] Finishing real work at step 109 at time Fri Feb 23 23:51:10 2018\r\n100\timages/sec: 1.3 +/- 0.0 (jitter = 0.0)\tnan\r\n----------------------------------------------------------------\r\ntotal images/sec: 1.31\r\n----------------------------------------------------------------\r\n```\r\n\r\n----\r\n### MKL enabled build on Docker for Mac (4 CPUs, 4GB)\r\n\r\n```\r\npython3 tf_cnn_benchmarks.py --batch_size=32 --model=resnet50\r\n\r\nTensorFlow:  1.5\r\nModel:       resnet50\r\nDataset:     imagenet (synthetic)\r\nMode:        training\r\nSingleSess:  False\r\nBatch size:  32 global\r\n             32.0 per device\r\nNum batches: 100\r\nNum epochs:  0.00\r\nDevices:     ['/gpu:0']\r\nData format: NCHW\r\nLayout optimizer: False\r\nOptimizer:   sgd\r\nVariables:   parameter_server\r\n==========\r\n\r\nStep\tImg/sec\ttotal_loss\r\nI0225 23:12:09.519792 140405827925760 tf_logging.py:110] Starting real work at step 10 at time Sun Feb 25 23:12:09 2018\r\n1\timages/sec: 4.9 +/- 0.0 (jitter = 0.0)\t11.576\r\n10\timages/sec: 4.7 +/- 0.0 (jitter = 0.1)\t8.911\r\n20\timages/sec: 4.7 +/- 0.0 (jitter = 0.1)\t8.426\r\n30\timages/sec: 4.7 +/- 0.0 (jitter = 0.2)\t8.177\r\n40\timages/sec: 4.7 +/- 0.0 (jitter = 0.1)\t15.682\r\n50\timages/sec: 4.7 +/- 0.0 (jitter = 0.1)\t7.956\r\n60\timages/sec: 4.7 +/- 0.0 (jitter = 0.1)\t8.638\r\n70\timages/sec: 4.7 +/- 0.0 (jitter = 0.1)\t8.246\r\n80\timages/sec: 4.7 +/- 0.0 (jitter = 0.2)\t7.947\r\n90\timages/sec: 4.7 +/- 0.0 (jitter = 0.2)\t7.906\r\nI0225 23:23:16.803599 140405827925760 tf_logging.py:110] Finishing real work at step 109 at time Sun Feb 25 23:23:16 2018\r\n100\timages/sec: 4.8 +/- 0.0 (jitter = 0.2)\t7.874\r\n----------------------------------------------------------------\r\ntotal images/sec: 4.75\r\n----------------------------------------------------------------\r\n```\r\n"}