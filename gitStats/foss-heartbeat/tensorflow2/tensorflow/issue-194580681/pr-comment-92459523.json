{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/92459523", "pull_request_review_id": 12975769, "id": 92459523, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDkyNDU5NTIz", "diff_hunk": "@@ -416,24 +416,44 @@ REGISTER_OP(\"SplitV\")\n     .Attr(\"T: type\")\n     .Attr(\"Tlen: {int32, int64} = DT_INT64\")\n     .SetShapeFn([](InferenceContext* c) {\n-      ShapeHandle unused;\n+      DimensionHandle split_dimension;\n+      TF_RETURN_IF_ERROR(c->MakeDimForScalarInput(2, &split_dimension));\n       int32 num_outputs = c->num_outputs();\n-      // Return unknown shapes with the same rank as the input\n-      // or unknown rank if input's rank isn't known\n-      // can't determine exact shapes until runtime because\n-      // we don't know where the tensor containing the split sizes\n-      // is located\n-      int32 rank = c->Rank(c->input(0));\n+      ShapeHandle input = c->input(0);\n+      int32 rank = c->Rank(input);\n       ShapeHandle output_shape;\n+      const Tensor* size_splits = c->input_tensor(1);\n       if (rank == InferenceContext::kUnknownRank) {\n+        // If the rank of input tensor is unknown, then return unkown shapes.\n         output_shape = c->UnknownShape();\n+        for (int i = 0; i < num_outputs; ++i) {\n+          c->set_output(i, output_shape);\n+        }\n       } else if (rank == 0) {\n+        // Throw error if input is a scalar.\n         return errors::InvalidArgument(\"Can't split scalars\");\n-      } else {\n+      } else if (size_splits == nullptr || !c->ValueKnown(split_dimension)) {\n+        // If split dimension or tensor containing the split sizes is unkown,\n+        // then return unknown shapes of same rank as input.\n         output_shape = c->UnknownShapeOfRank(rank);\n-      }\n-      for (int i = 0; i < num_outputs; ++i) {\n-        c->set_output(i, output_shape);\n+        for (int i = 0; i < num_outputs; ++i) {\n+          c->set_output(i, output_shape);\n+        }\n+      } else {\n+        // Determine the output shape if split dimension and split sizes are known\n+        int64 split_dim = c->Value(split_dimension);\n+        TF_RETURN_IF_ERROR(c->WithRankAtLeast(input, split_dim + 1, &input));\n+        auto vec = size_splits->vec<int32>();", "path": "tensorflow/core/ops/array_ops.cc", "position": null, "original_position": 42, "commit_id": "622496ad3f13ded86c5bff2e3842b53f78019f4b", "original_commit_id": "86d5af19596d9109e3564dcf2b7b5b3a4ad16da2", "user": {"login": "ekelsen", "id": 2533174, "node_id": "MDQ6VXNlcjI1MzMxNzQ=", "avatar_url": "https://avatars0.githubusercontent.com/u/2533174?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ekelsen", "html_url": "https://github.com/ekelsen", "followers_url": "https://api.github.com/users/ekelsen/followers", "following_url": "https://api.github.com/users/ekelsen/following{/other_user}", "gists_url": "https://api.github.com/users/ekelsen/gists{/gist_id}", "starred_url": "https://api.github.com/users/ekelsen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ekelsen/subscriptions", "organizations_url": "https://api.github.com/users/ekelsen/orgs", "repos_url": "https://api.github.com/users/ekelsen/repos", "events_url": "https://api.github.com/users/ekelsen/events{/privacy}", "received_events_url": "https://api.github.com/users/ekelsen/received_events", "type": "User", "site_admin": false}, "body": "The problem is here - size_splits can be either of type int32 or int64 (see the signature), but this line assumes int32, which is what is causing the type mismatch.", "created_at": "2016-12-14T18:39:45Z", "updated_at": "2016-12-15T08:44:43Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/6212#discussion_r92459523", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/6212", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/92459523"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/6212#discussion_r92459523"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/6212"}}, "body_html": "<p>The problem is here - size_splits can be either of type int32 or int64 (see the signature), but this line assumes int32, which is what is causing the type mismatch.</p>", "body_text": "The problem is here - size_splits can be either of type int32 or int64 (see the signature), but this line assumes int32, which is what is causing the type mismatch."}