{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/310737492", "html_url": "https://github.com/tensorflow/tensorflow/issues/10835#issuecomment-310737492", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10835", "id": 310737492, "node_id": "MDEyOklzc3VlQ29tbWVudDMxMDczNzQ5Mg==", "user": {"login": "AnishShah", "id": 3175743, "node_id": "MDQ6VXNlcjMxNzU3NDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/3175743?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AnishShah", "html_url": "https://github.com/AnishShah", "followers_url": "https://api.github.com/users/AnishShah/followers", "following_url": "https://api.github.com/users/AnishShah/following{/other_user}", "gists_url": "https://api.github.com/users/AnishShah/gists{/gist_id}", "starred_url": "https://api.github.com/users/AnishShah/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AnishShah/subscriptions", "organizations_url": "https://api.github.com/users/AnishShah/orgs", "repos_url": "https://api.github.com/users/AnishShah/repos", "events_url": "https://api.github.com/users/AnishShah/events{/privacy}", "received_events_url": "https://api.github.com/users/AnishShah/received_events", "type": "User", "site_admin": false}, "created_at": "2017-06-23T18:18:07Z", "updated_at": "2017-06-23T18:20:38Z", "author_association": "CONTRIBUTOR", "body_html": "<p>The main problem is in <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/math_grad.py#L127\">_ProdGrad function</a></p>\n<p>This is the snippet of _ProdGrad. In the comment, I have added an example where this fails.</p>\n<pre><code>reduced = math_ops.cast(reduction_indices, dtypes.int32) # [-1]\nidx = math_ops.range(0, array_ops.rank(op.inputs[0])) # if rank is 2, then [0, 1]\nother, _ = array_ops.setdiff1d(idx, reduced)  # others = [0, 1]\nperm = array_ops.concat([reduced, other], 0) # [-1, 0, 1] (size is 3, which is greater than rank. throws error in transpose)\n</code></pre>\n<p><code>tf.setdiff1d</code> is getting a list of <code>range(0, rank(input))</code> and list of reduction indices which contains negative axis. So, <code>perm</code> list contains <code>range(0, rank(input))</code> and negative indices. This is used to <code>tf.transpose</code> and it throws error because the dimensions don't match.</p>\n<p>I hope I make sense.</p>\n<p>I think, the best way to solve this would be in this function itself.</p>", "body_text": "The main problem is in _ProdGrad function\nThis is the snippet of _ProdGrad. In the comment, I have added an example where this fails.\nreduced = math_ops.cast(reduction_indices, dtypes.int32) # [-1]\nidx = math_ops.range(0, array_ops.rank(op.inputs[0])) # if rank is 2, then [0, 1]\nother, _ = array_ops.setdiff1d(idx, reduced)  # others = [0, 1]\nperm = array_ops.concat([reduced, other], 0) # [-1, 0, 1] (size is 3, which is greater than rank. throws error in transpose)\n\ntf.setdiff1d is getting a list of range(0, rank(input)) and list of reduction indices which contains negative axis. So, perm list contains range(0, rank(input)) and negative indices. This is used to tf.transpose and it throws error because the dimensions don't match.\nI hope I make sense.\nI think, the best way to solve this would be in this function itself.", "body": "The main problem is in [_ProdGrad function](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/math_grad.py#L127)\r\n\r\nThis is the snippet of _ProdGrad. In the comment, I have added an example where this fails.\r\n```\r\nreduced = math_ops.cast(reduction_indices, dtypes.int32) # [-1]\r\nidx = math_ops.range(0, array_ops.rank(op.inputs[0])) # if rank is 2, then [0, 1]\r\nother, _ = array_ops.setdiff1d(idx, reduced)  # others = [0, 1]\r\nperm = array_ops.concat([reduced, other], 0) # [-1, 0, 1] (size is 3, which is greater than rank. throws error in transpose)\r\n```\r\n`tf.setdiff1d` is getting a list of `range(0, rank(input))` and list of reduction indices which contains negative axis. So, `perm` list contains `range(0, rank(input))` and negative indices. This is used to `tf.transpose` and it throws error because the dimensions don't match. \r\n\r\nI hope I make sense.\r\n\r\nI think, the best way to solve this would be in this function itself."}