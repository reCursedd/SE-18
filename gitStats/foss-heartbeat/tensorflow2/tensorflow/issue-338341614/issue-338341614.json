{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20549", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20549/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20549/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20549/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/20549", "id": 338341614, "node_id": "MDExOlB1bGxSZXF1ZXN0MTk5Mjk5NjI3", "number": 20549, "title": "Check parameters before creating gRPC server", "user": {"login": "naurril", "id": 7512334, "node_id": "MDQ6VXNlcjc1MTIzMzQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/7512334?v=4", "gravatar_id": "", "url": "https://api.github.com/users/naurril", "html_url": "https://github.com/naurril", "followers_url": "https://api.github.com/users/naurril/followers", "following_url": "https://api.github.com/users/naurril/following{/other_user}", "gists_url": "https://api.github.com/users/naurril/gists{/gist_id}", "starred_url": "https://api.github.com/users/naurril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/naurril/subscriptions", "organizations_url": "https://api.github.com/users/naurril/orgs", "repos_url": "https://api.github.com/users/naurril/repos", "events_url": "https://api.github.com/users/naurril/events{/privacy}", "received_events_url": "https://api.github.com/users/naurril/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}, {"id": 987666414, "node_id": "MDU6TGFiZWw5ODc2NjY0MTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/ready%20to%20pull", "name": "ready to pull", "color": "2cd643", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "martinwicke", "id": 577277, "node_id": "MDQ6VXNlcjU3NzI3Nw==", "avatar_url": "https://avatars2.githubusercontent.com/u/577277?v=4", "gravatar_id": "", "url": "https://api.github.com/users/martinwicke", "html_url": "https://github.com/martinwicke", "followers_url": "https://api.github.com/users/martinwicke/followers", "following_url": "https://api.github.com/users/martinwicke/following{/other_user}", "gists_url": "https://api.github.com/users/martinwicke/gists{/gist_id}", "starred_url": "https://api.github.com/users/martinwicke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/martinwicke/subscriptions", "organizations_url": "https://api.github.com/users/martinwicke/orgs", "repos_url": "https://api.github.com/users/martinwicke/repos", "events_url": "https://api.github.com/users/martinwicke/events{/privacy}", "received_events_url": "https://api.github.com/users/martinwicke/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "martinwicke", "id": 577277, "node_id": "MDQ6VXNlcjU3NzI3Nw==", "avatar_url": "https://avatars2.githubusercontent.com/u/577277?v=4", "gravatar_id": "", "url": "https://api.github.com/users/martinwicke", "html_url": "https://github.com/martinwicke", "followers_url": "https://api.github.com/users/martinwicke/followers", "following_url": "https://api.github.com/users/martinwicke/following{/other_user}", "gists_url": "https://api.github.com/users/martinwicke/gists{/gist_id}", "starred_url": "https://api.github.com/users/martinwicke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/martinwicke/subscriptions", "organizations_url": "https://api.github.com/users/martinwicke/orgs", "repos_url": "https://api.github.com/users/martinwicke/repos", "events_url": "https://api.github.com/users/martinwicke/events{/privacy}", "received_events_url": "https://api.github.com/users/martinwicke/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2018-07-04T17:17:11Z", "updated_at": "2018-08-10T21:31:57Z", "closed_at": "2018-08-10T21:31:57Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/20549", "html_url": "https://github.com/tensorflow/tensorflow/pull/20549", "diff_url": "https://github.com/tensorflow/tensorflow/pull/20549.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/20549.patch"}, "body_html": "<p>When creating gRPC server with <code>task_index=-1</code>, TF just aborts (core dumped):</p>\n<pre><code>&gt;&gt;&gt; import tensorflow as tf\n&gt;&gt;&gt; cluster = tf.train.ClusterSpec({\"ps\": [\"localhost:2222\"]}) \n&gt;&gt;&gt; server = tf.train.Server(cluster, job_name=\"ps\", task_index=2)\n// error msg...\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Task 2 was not defined in job \"ps\"\n\n&gt;&gt;&gt; server = tf.train.Server(cluster, job_name=\"ps\", task_index=-1)\n2018-07-05 00:59:49.609445: F tensorflow/core/common_runtime/device.cc:28] Check failed: DeviceNameUtils::ParseFullName(name(), &amp;parsed_name_) Invalid device name: /job:ps/replica:0/task:-1/device:CPU:0\nAborted (core dumped)\n</code></pre>\n<p>Both -1 and 2 are invalid task indices, but the results are totally different. I think it's better to give the same message as when task_index=2</p>\n<p>This can be solved by moving the parameter checking part to earlier place, just before adding devices.</p>\n<p>Although the parameter checking part seems not intended to check parameters in the original place, it actually filters all invalid parameters.</p>", "body_text": "When creating gRPC server with task_index=-1, TF just aborts (core dumped):\n>>> import tensorflow as tf\n>>> cluster = tf.train.ClusterSpec({\"ps\": [\"localhost:2222\"]}) \n>>> server = tf.train.Server(cluster, job_name=\"ps\", task_index=2)\n// error msg...\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Task 2 was not defined in job \"ps\"\n\n>>> server = tf.train.Server(cluster, job_name=\"ps\", task_index=-1)\n2018-07-05 00:59:49.609445: F tensorflow/core/common_runtime/device.cc:28] Check failed: DeviceNameUtils::ParseFullName(name(), &parsed_name_) Invalid device name: /job:ps/replica:0/task:-1/device:CPU:0\nAborted (core dumped)\n\nBoth -1 and 2 are invalid task indices, but the results are totally different. I think it's better to give the same message as when task_index=2\nThis can be solved by moving the parameter checking part to earlier place, just before adding devices.\nAlthough the parameter checking part seems not intended to check parameters in the original place, it actually filters all invalid parameters.", "body": "When creating gRPC server with ```task_index=-1```, TF just aborts (core dumped):\r\n\r\n```\r\n>>> import tensorflow as tf\r\n>>> cluster = tf.train.ClusterSpec({\"ps\": [\"localhost:2222\"]}) \r\n>>> server = tf.train.Server(cluster, job_name=\"ps\", task_index=2)\r\n// error msg...\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Task 2 was not defined in job \"ps\"\r\n\r\n>>> server = tf.train.Server(cluster, job_name=\"ps\", task_index=-1)\r\n2018-07-05 00:59:49.609445: F tensorflow/core/common_runtime/device.cc:28] Check failed: DeviceNameUtils::ParseFullName(name(), &parsed_name_) Invalid device name: /job:ps/replica:0/task:-1/device:CPU:0\r\nAborted (core dumped)\r\n```\r\n\r\nBoth -1 and 2 are invalid task indices, but the results are totally different. I think it's better to give the same message as when task_index=2\r\n\r\nThis can be solved by moving the parameter checking part to earlier place, just before adding devices. \r\n\r\nAlthough the parameter checking part seems not intended to check parameters in the original place, it actually filters all invalid parameters.\r\n"}