{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/351016179", "html_url": "https://github.com/tensorflow/tensorflow/issues/15278#issuecomment-351016179", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15278", "id": 351016179, "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTAxNjE3OQ==", "user": {"login": "facaiy", "id": 1112263, "node_id": "MDQ6VXNlcjExMTIyNjM=", "avatar_url": "https://avatars3.githubusercontent.com/u/1112263?v=4", "gravatar_id": "", "url": "https://api.github.com/users/facaiy", "html_url": "https://github.com/facaiy", "followers_url": "https://api.github.com/users/facaiy/followers", "following_url": "https://api.github.com/users/facaiy/following{/other_user}", "gists_url": "https://api.github.com/users/facaiy/gists{/gist_id}", "starred_url": "https://api.github.com/users/facaiy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/facaiy/subscriptions", "organizations_url": "https://api.github.com/users/facaiy/orgs", "repos_url": "https://api.github.com/users/facaiy/repos", "events_url": "https://api.github.com/users/facaiy/events{/privacy}", "received_events_url": "https://api.github.com/users/facaiy/received_events", "type": "User", "site_admin": false}, "created_at": "2017-12-12T10:52:48Z", "updated_at": "2017-12-12T10:52:48Z", "author_association": "MEMBER", "body_html": "<p>Perhaps it is related to <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/69c324591ba4dfeafb403ee59de56ffe063c1e94/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/69c324591ba4dfeafb403ee59de56ffe063c1e94\"><tt>69c3245</tt></a> , which removed the <code>tf.cast</code> about 5 days ago.</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\na <span class=\"pl-k\">=</span> tf.constant([<span class=\"pl-c1\">1.0</span>])\nb <span class=\"pl-k\">=</span> a <span class=\"pl-k\">*</span> <span class=\"pl-c1\">2</span>\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">use_cast</span>(<span class=\"pl-smi\">b</span>):\n    c <span class=\"pl-k\">=</span> tf.argmax(b, <span class=\"pl-v\">axis</span><span class=\"pl-k\">=</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>)\n    c <span class=\"pl-k\">=</span> tf.cast(c, tf.int32)\n    <span class=\"pl-k\">return</span> c\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">not_use_cast</span>(<span class=\"pl-smi\">b</span>):\n    <span class=\"pl-k\">return</span> tf.argmax(b, <span class=\"pl-v\">axis</span><span class=\"pl-k\">=</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>, <span class=\"pl-v\">output_type</span><span class=\"pl-k\">=</span>tf.int32)\n\n<span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>use cast:<span class=\"pl-pds\">\"</span></span>)\n<span class=\"pl-c1\">print</span>(tf.gradients(use_cast(b), a))\n\n<span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>===========<span class=\"pl-pds\">\"</span></span>)\n<span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>not use cast<span class=\"pl-pds\">\"</span></span>)\n<span class=\"pl-c1\">print</span>(tf.gradients(not_use_cast(b), a))</pre></div>\n<p>Output:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">~</span><span class=\"pl-k\">/</span>Downloads \u276f\u276f\u276f python test.py                                                               \u23ce\nuse cast:\n[<span class=\"pl-c1\">None</span>]\n<span class=\"pl-k\">==========</span><span class=\"pl-k\">=</span>\n<span class=\"pl-k\">not</span> use cast\nTraceback (most recent call last):\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">551</span>, <span class=\"pl-k\">in</span> gradients\n    grad_fn <span class=\"pl-k\">=</span> ops.get_gradient_function(op)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">2134</span>, <span class=\"pl-k\">in</span> get_gradient_function\n    <span class=\"pl-k\">return</span> _gradient_registry.lookup(op_type)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/registry.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">93</span>, <span class=\"pl-k\">in</span> lookup\n    <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>%s registry has no entry for: %s<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">%</span> (<span class=\"pl-c1\">self</span>._name, name))\n<span class=\"pl-c1\">LookupError</span>: gradient registry has no entry <span class=\"pl-k\">for</span>: ArgMax\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>test.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">19</span>, <span class=\"pl-k\">in</span> <span class=\"pl-k\">&lt;</span>module<span class=\"pl-k\">&gt;</span>\n    <span class=\"pl-c1\">print</span>(tf.gradients(not_use_case(b), a))\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py<span class=\"pl-pds\">\"</span></span>, line <span class=\"pl-c1\">555</span>, <span class=\"pl-k\">in</span> gradients\n    (op.name, op.type))\n<span class=\"pl-c1\">LookupError</span>: No gradient defined <span class=\"pl-k\">for</span> operation <span class=\"pl-s\"><span class=\"pl-pds\">'</span>ArgMax_1<span class=\"pl-pds\">'</span></span> (op <span class=\"pl-c1\">type</span>: ArgMax)</pre></div>", "body_text": "Perhaps it is related to 69c3245 , which removed the tf.cast about 5 days ago.\nimport tensorflow as tf\n\na = tf.constant([1.0])\nb = a * 2\n\ndef use_cast(b):\n    c = tf.argmax(b, axis=-1)\n    c = tf.cast(c, tf.int32)\n    return c\n\ndef not_use_cast(b):\n    return tf.argmax(b, axis=-1, output_type=tf.int32)\n\nprint(\"use cast:\")\nprint(tf.gradients(use_cast(b), a))\n\nprint(\"===========\")\nprint(\"not use cast\")\nprint(tf.gradients(not_use_cast(b), a))\nOutput:\n~/Downloads \u276f\u276f\u276f python test.py                                                               \u23ce\nuse cast:\n[None]\n===========\nnot use cast\nTraceback (most recent call last):\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 551, in gradients\n    grad_fn = ops.get_gradient_function(op)\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2134, in get_gradient_function\n    return _gradient_registry.lookup(op_type)\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/registry.py\", line 93, in lookup\n    \"%s registry has no entry for: %s\" % (self._name, name))\nLookupError: gradient registry has no entry for: ArgMax\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"test.py\", line 19, in <module>\n    print(tf.gradients(not_use_case(b), a))\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 555, in gradients\n    (op.name, op.type))\nLookupError: No gradient defined for operation 'ArgMax_1' (op type: ArgMax)", "body": "Perhaps it is related to 69c32459 , which removed the `tf.cast` about 5 days ago.\r\n\r\n```python\r\nimport tensorflow as tf\r\n\r\na = tf.constant([1.0])\r\nb = a * 2\r\n\r\ndef use_cast(b):\r\n    c = tf.argmax(b, axis=-1)\r\n    c = tf.cast(c, tf.int32)\r\n    return c\r\n\r\ndef not_use_cast(b):\r\n    return tf.argmax(b, axis=-1, output_type=tf.int32)\r\n\r\nprint(\"use cast:\")\r\nprint(tf.gradients(use_cast(b), a))\r\n\r\nprint(\"===========\")\r\nprint(\"not use cast\")\r\nprint(tf.gradients(not_use_cast(b), a))\r\n```\r\nOutput:\r\n```python\r\n~/Downloads \u276f\u276f\u276f python test.py                                                               \u23ce\r\nuse cast:\r\n[None]\r\n===========\r\nnot use cast\r\nTraceback (most recent call last):\r\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 551, in gradients\r\n    grad_fn = ops.get_gradient_function(op)\r\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2134, in get_gradient_function\r\n    return _gradient_registry.lookup(op_type)\r\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/framework/registry.py\", line 93, in lookup\r\n    \"%s registry has no entry for: %s\" % (self._name, name))\r\nLookupError: gradient registry has no entry for: ArgMax\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"test.py\", line 19, in <module>\r\n    print(tf.gradients(not_use_case(b), a))\r\n  File \"/Users/facai/Library/anaconda3/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 555, in gradients\r\n    (op.name, op.type))\r\nLookupError: No gradient defined for operation 'ArgMax_1' (op type: ArgMax)\r\n```"}