{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20741", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20741/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20741/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20741/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/20741", "id": 340667815, "node_id": "MDU6SXNzdWUzNDA2Njc4MTU=", "number": 20741, "title": "TFLite: Cannot use boolean scalar as input to TFLite model", "user": {"login": "hoavt-54", "id": 1913161, "node_id": "MDQ6VXNlcjE5MTMxNjE=", "avatar_url": "https://avatars0.githubusercontent.com/u/1913161?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hoavt-54", "html_url": "https://github.com/hoavt-54", "followers_url": "https://api.github.com/users/hoavt-54/followers", "following_url": "https://api.github.com/users/hoavt-54/following{/other_user}", "gists_url": "https://api.github.com/users/hoavt-54/gists{/gist_id}", "starred_url": "https://api.github.com/users/hoavt-54/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hoavt-54/subscriptions", "organizations_url": "https://api.github.com/users/hoavt-54/orgs", "repos_url": "https://api.github.com/users/hoavt-54/repos", "events_url": "https://api.github.com/users/hoavt-54/events{/privacy}", "received_events_url": "https://api.github.com/users/hoavt-54/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 750616506, "node_id": "MDU6TGFiZWw3NTA2MTY1MDY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:lite", "name": "comp:lite", "color": "0052cc", "default": false}, {"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "jdduke", "id": 479117, "node_id": "MDQ6VXNlcjQ3OTExNw==", "avatar_url": "https://avatars2.githubusercontent.com/u/479117?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jdduke", "html_url": "https://github.com/jdduke", "followers_url": "https://api.github.com/users/jdduke/followers", "following_url": "https://api.github.com/users/jdduke/following{/other_user}", "gists_url": "https://api.github.com/users/jdduke/gists{/gist_id}", "starred_url": "https://api.github.com/users/jdduke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jdduke/subscriptions", "organizations_url": "https://api.github.com/users/jdduke/orgs", "repos_url": "https://api.github.com/users/jdduke/repos", "events_url": "https://api.github.com/users/jdduke/events{/privacy}", "received_events_url": "https://api.github.com/users/jdduke/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jdduke", "id": 479117, "node_id": "MDQ6VXNlcjQ3OTExNw==", "avatar_url": "https://avatars2.githubusercontent.com/u/479117?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jdduke", "html_url": "https://github.com/jdduke", "followers_url": "https://api.github.com/users/jdduke/followers", "following_url": "https://api.github.com/users/jdduke/following{/other_user}", "gists_url": "https://api.github.com/users/jdduke/gists{/gist_id}", "starred_url": "https://api.github.com/users/jdduke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jdduke/subscriptions", "organizations_url": "https://api.github.com/users/jdduke/orgs", "repos_url": "https://api.github.com/users/jdduke/repos", "events_url": "https://api.github.com/users/jdduke/events{/privacy}", "received_events_url": "https://api.github.com/users/jdduke/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2018-07-12T14:40:12Z", "updated_at": "2018-08-24T21:53:30Z", "closed_at": "2018-08-24T20:12:57Z", "author_association": "NONE", "body_html": "<p>Edit: Adding issue template<br>\nHave I written custom code: No<br>\nOS Platform and Distribution: Ubuntu 14.04<br>\nTensorFlow installed from: pip<br>\nTensorFlow version: r1.9<br>\nBazel version<br>\nCUDA/cuDNN version<br>\nGPU model and memory<br>\nExact command to reproduce: tf.contrib.lite.toco_convert (More details below)</p>\n<p>I am trying to convert the <a href=\"https://github.com/davidsandberg/facenet\">Facenet Tensorflow</a> model into <code>TFLITE</code> format which I could use for an Android app. This Facenet model takes a tensor containing image data and a boolean scalar (is_training) as input:</p>\n<p><code>  feed_dict = { images_placeholder: images, phase_train_placeholder:False }</code></p>\n<p>I follow the <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/docs_src/mobile/tflite/devguide.md\">Tensorflow lite guide</a> to convert models into TFLITE format. Here is an example:</p>\n<pre><code>import tensorflow as tf\n \n img = tf.placeholder(name=\"img\", dtype=tf.float32, shape=(1, 64, 64, 3))\n val = img + tf.constant([1., 2., 3.]) + tf.constant([1., 4., 4.])\n out = tf.identity(val, name=\"out\")\n \n with tf.Session() as sess:\n   tflite_model = tf.contrib.lite.toco_convert(sess.graph_def, [img], [out])\n   open(\"converteds_model.tflite\", \"wb\").write(tflite_model)\n\n</code></pre>\n<p>Here is my code:</p>\n<pre><code>with tf.Graph().as_default():\n \n         with tf.Session() as sess:\n \n             # Load the model\n             facenet.load_model(args.model)\n \n             # Get input and output tensors\n             images_placeholder = tf.get_default_graph().get_tensor_by_name(\"input:0\")\n             embeddings = tf.get_default_graph().get_tensor_by_name(\"embeddings:0\")\n             phase_train_placeholder = tf.get_default_graph().get_tensor_by_name(\"phase_train:0\")\n             #reshape as tflite does not accepts None dimension\n             images_placeholder = tf.reshape(images_placeholder, [1,160,160,3])\n             tflite_model = tf.contrib.lite.toco_convert(sess.graph_def, [images_placeholder, phase_train_placeholder], [embeddings])\n             open(\"converteds_model.tflite\", \"wb\").write(tflite_model)\n</code></pre>\n<p>The program gives an error saying (I guess this happens as <code>tflite</code> does not support <code>tf.bool</code> just yet):</p>\n<pre><code>    File \"/.../facenet/tensorflow1.8/lib/python3.4/site-packages/tensorflow/contrib/lite/python/convert.py\", line 206, in toco_convert\n        input_tensor.dtype))\n    ValueError: Tensors phase_train:0 not known type tf.bool\n\n</code></pre>\n<p>If I cast the <code>phase_train_placeholder</code> to the supported type <code>tf.int32</code>, just to see how it goes. Then it gives another error (I guess this happens as the convert function does not accept scalar):</p>\n<pre><code>File \"/.../facenet/tensorflow1.8/lib/python3.4/site-packages/tensorflow/contrib/lite/python/convert.py\", line 217, in toco_convert\n        input_array.shape.dims.extend(map(int, input_tensor.get_shape()))\n      File \"/.../facenet/tensorflow1.8/lib/python3.4/site-packages/tensorflow/python/framework/tensor_shape.py\", line 591, in __iter__\n        raise ValueError(\"Cannot iterate over a shape with unknown rank.\")\n    ValueError: Cannot iterate over a shape with unknown rank.\n</code></pre>\n<p>Could you please suggest an workaround for this? I understand that TFLite is still in development but I could try to contribute this part if it is possible. Many thanks.</p>\n<p>I also posted to <a href=\"https://stackoverflow.com/questions/51307107/tensorflow-lite-boolean-scalar-as-input-tensor\" rel=\"nofollow\">SO</a>; however I think this is also an issue therefore I put it here as well.</p>", "body_text": "Edit: Adding issue template\nHave I written custom code: No\nOS Platform and Distribution: Ubuntu 14.04\nTensorFlow installed from: pip\nTensorFlow version: r1.9\nBazel version\nCUDA/cuDNN version\nGPU model and memory\nExact command to reproduce: tf.contrib.lite.toco_convert (More details below)\nI am trying to convert the Facenet Tensorflow model into TFLITE format which I could use for an Android app. This Facenet model takes a tensor containing image data and a boolean scalar (is_training) as input:\n  feed_dict = { images_placeholder: images, phase_train_placeholder:False }\nI follow the Tensorflow lite guide to convert models into TFLITE format. Here is an example:\nimport tensorflow as tf\n \n img = tf.placeholder(name=\"img\", dtype=tf.float32, shape=(1, 64, 64, 3))\n val = img + tf.constant([1., 2., 3.]) + tf.constant([1., 4., 4.])\n out = tf.identity(val, name=\"out\")\n \n with tf.Session() as sess:\n   tflite_model = tf.contrib.lite.toco_convert(sess.graph_def, [img], [out])\n   open(\"converteds_model.tflite\", \"wb\").write(tflite_model)\n\n\nHere is my code:\nwith tf.Graph().as_default():\n \n         with tf.Session() as sess:\n \n             # Load the model\n             facenet.load_model(args.model)\n \n             # Get input and output tensors\n             images_placeholder = tf.get_default_graph().get_tensor_by_name(\"input:0\")\n             embeddings = tf.get_default_graph().get_tensor_by_name(\"embeddings:0\")\n             phase_train_placeholder = tf.get_default_graph().get_tensor_by_name(\"phase_train:0\")\n             #reshape as tflite does not accepts None dimension\n             images_placeholder = tf.reshape(images_placeholder, [1,160,160,3])\n             tflite_model = tf.contrib.lite.toco_convert(sess.graph_def, [images_placeholder, phase_train_placeholder], [embeddings])\n             open(\"converteds_model.tflite\", \"wb\").write(tflite_model)\n\nThe program gives an error saying (I guess this happens as tflite does not support tf.bool just yet):\n    File \"/.../facenet/tensorflow1.8/lib/python3.4/site-packages/tensorflow/contrib/lite/python/convert.py\", line 206, in toco_convert\n        input_tensor.dtype))\n    ValueError: Tensors phase_train:0 not known type tf.bool\n\n\nIf I cast the phase_train_placeholder to the supported type tf.int32, just to see how it goes. Then it gives another error (I guess this happens as the convert function does not accept scalar):\nFile \"/.../facenet/tensorflow1.8/lib/python3.4/site-packages/tensorflow/contrib/lite/python/convert.py\", line 217, in toco_convert\n        input_array.shape.dims.extend(map(int, input_tensor.get_shape()))\n      File \"/.../facenet/tensorflow1.8/lib/python3.4/site-packages/tensorflow/python/framework/tensor_shape.py\", line 591, in __iter__\n        raise ValueError(\"Cannot iterate over a shape with unknown rank.\")\n    ValueError: Cannot iterate over a shape with unknown rank.\n\nCould you please suggest an workaround for this? I understand that TFLite is still in development but I could try to contribute this part if it is possible. Many thanks.\nI also posted to SO; however I think this is also an issue therefore I put it here as well.", "body": "Edit: Adding issue template\r\nHave I written custom code: No\r\nOS Platform and Distribution: Ubuntu 14.04 \r\nTensorFlow installed from: pip\r\nTensorFlow version: r1.9\r\nBazel version\r\nCUDA/cuDNN version\r\nGPU model and memory\r\nExact command to reproduce: tf.contrib.lite.toco_convert (More details below)\r\n\r\n\r\nI am trying to convert the [Facenet Tensorflow](https://github.com/davidsandberg/facenet) model into `TFLITE` format which I could use for an Android app. This Facenet model takes a tensor containing image data and a boolean scalar (is_training) as input:\r\n\r\n  `  feed_dict = { images_placeholder: images, phase_train_placeholder:False }`\r\n\r\nI follow the [Tensorflow lite guide](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/docs_src/mobile/tflite/devguide.md) to convert models into TFLITE format. Here is an example: \r\n\r\n   ```\r\n import tensorflow as tf\r\n    \r\n    img = tf.placeholder(name=\"img\", dtype=tf.float32, shape=(1, 64, 64, 3))\r\n    val = img + tf.constant([1., 2., 3.]) + tf.constant([1., 4., 4.])\r\n    out = tf.identity(val, name=\"out\")\r\n    \r\n    with tf.Session() as sess:\r\n      tflite_model = tf.contrib.lite.toco_convert(sess.graph_def, [img], [out])\r\n      open(\"converteds_model.tflite\", \"wb\").write(tflite_model)\r\n\r\n```\r\nHere is my code:\r\n\r\n   ```\r\n with tf.Graph().as_default():\r\n    \r\n            with tf.Session() as sess:\r\n    \r\n                # Load the model\r\n                facenet.load_model(args.model)\r\n    \r\n                # Get input and output tensors\r\n                images_placeholder = tf.get_default_graph().get_tensor_by_name(\"input:0\")\r\n                embeddings = tf.get_default_graph().get_tensor_by_name(\"embeddings:0\")\r\n                phase_train_placeholder = tf.get_default_graph().get_tensor_by_name(\"phase_train:0\")\r\n                #reshape as tflite does not accepts None dimension\r\n                images_placeholder = tf.reshape(images_placeholder, [1,160,160,3])\r\n                tflite_model = tf.contrib.lite.toco_convert(sess.graph_def, [images_placeholder, phase_train_placeholder], [embeddings])\r\n                open(\"converteds_model.tflite\", \"wb\").write(tflite_model)\r\n```\r\n\r\nThe program gives an error saying (I guess this happens as `tflite` does not support `tf.bool` just yet):\r\n\r\n```\r\n    File \"/.../facenet/tensorflow1.8/lib/python3.4/site-packages/tensorflow/contrib/lite/python/convert.py\", line 206, in toco_convert\r\n        input_tensor.dtype))\r\n    ValueError: Tensors phase_train:0 not known type tf.bool\r\n\r\n```\r\nIf I cast the `phase_train_placeholder` to the supported type `tf.int32`, just to see how it goes. Then it gives another error (I guess this happens as the convert function does not accept scalar):\r\n\r\n \r\n\r\n```\r\nFile \"/.../facenet/tensorflow1.8/lib/python3.4/site-packages/tensorflow/contrib/lite/python/convert.py\", line 217, in toco_convert\r\n        input_array.shape.dims.extend(map(int, input_tensor.get_shape()))\r\n      File \"/.../facenet/tensorflow1.8/lib/python3.4/site-packages/tensorflow/python/framework/tensor_shape.py\", line 591, in __iter__\r\n        raise ValueError(\"Cannot iterate over a shape with unknown rank.\")\r\n    ValueError: Cannot iterate over a shape with unknown rank.\r\n```\r\n\r\nCould you please suggest an workaround for this? I understand that TFLite is still in development but I could try to contribute this part if it is possible. Many thanks.\r\n \r\nI also posted to [SO](https://stackoverflow.com/questions/51307107/tensorflow-lite-boolean-scalar-as-input-tensor); however I think this is also an issue therefore I put it here as well.  "}