{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/438689710", "html_url": "https://github.com/tensorflow/tensorflow/issues/23733#issuecomment-438689710", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23733", "id": 438689710, "node_id": "MDEyOklzc3VlQ29tbWVudDQzODY4OTcxMA==", "user": {"login": "galeone", "id": 8427788, "node_id": "MDQ6VXNlcjg0Mjc3ODg=", "avatar_url": "https://avatars1.githubusercontent.com/u/8427788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/galeone", "html_url": "https://github.com/galeone", "followers_url": "https://api.github.com/users/galeone/followers", "following_url": "https://api.github.com/users/galeone/following{/other_user}", "gists_url": "https://api.github.com/users/galeone/gists{/gist_id}", "starred_url": "https://api.github.com/users/galeone/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/galeone/subscriptions", "organizations_url": "https://api.github.com/users/galeone/orgs", "repos_url": "https://api.github.com/users/galeone/repos", "events_url": "https://api.github.com/users/galeone/events{/privacy}", "received_events_url": "https://api.github.com/users/galeone/received_events", "type": "User", "site_admin": false}, "created_at": "2018-11-14T14:55:09Z", "updated_at": "2018-11-14T14:55:09Z", "author_association": "NONE", "body_html": "<p>Update: probably the leak is in <code>tf.gfile</code> since I can see that the memory grows every time I run the line:</p>\n<div class=\"highlight highlight-source-python\"><pre>                <span class=\"pl-k\">with</span> tf.gfile.GFile(new_element, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>rb<span class=\"pl-pds\">\"</span></span>) <span class=\"pl-k\">as</span> fp:\n                    img_bytes <span class=\"pl-k\">=</span> fp.read()</pre></div>\n<p>In the loop.</p>\n<p>I've also tried to change it to:</p>\n<div class=\"highlight highlight-source-python\"><pre>fp <span class=\"pl-k\">=</span> tf.gfile.GFile(new_element, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>rb<span class=\"pl-pds\">\"</span></span>)\nimg_bytes <span class=\"pl-k\">=</span> fp.read()\nfp.close()\nfp <span class=\"pl-k\">=</span> <span class=\"pl-c1\">None</span></pre></div>\n<p>But every time I <code>read()</code> the memory is never released</p>", "body_text": "Update: probably the leak is in tf.gfile since I can see that the memory grows every time I run the line:\n                with tf.gfile.GFile(new_element, \"rb\") as fp:\n                    img_bytes = fp.read()\nIn the loop.\nI've also tried to change it to:\nfp = tf.gfile.GFile(new_element, \"rb\")\nimg_bytes = fp.read()\nfp.close()\nfp = None\nBut every time I read() the memory is never released", "body": "Update: probably the leak is in `tf.gfile` since I can see that the memory grows every time I run the line:\r\n\r\n```python\r\n                with tf.gfile.GFile(new_element, \"rb\") as fp:\r\n                    img_bytes = fp.read()\r\n```\r\nIn the loop.\r\n\r\nI've also tried to change it to:\r\n\r\n```python\r\nfp = tf.gfile.GFile(new_element, \"rb\")\r\nimg_bytes = fp.read()\r\nfp.close()\r\nfp = None\r\n```\r\n\r\nBut every time I `read()` the memory is never released"}