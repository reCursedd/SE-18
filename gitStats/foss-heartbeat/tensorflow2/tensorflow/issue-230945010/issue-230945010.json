{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10151", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10151/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10151/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10151/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/10151", "id": 230945010, "node_id": "MDU6SXNzdWUyMzA5NDUwMTA=", "number": 10151, "title": "Support dictionaries of tensors in tf.contrib.data.Dataset", "user": {"login": "EdeMeijer", "id": 5758565, "node_id": "MDQ6VXNlcjU3NTg1NjU=", "avatar_url": "https://avatars0.githubusercontent.com/u/5758565?v=4", "gravatar_id": "", "url": "https://api.github.com/users/EdeMeijer", "html_url": "https://github.com/EdeMeijer", "followers_url": "https://api.github.com/users/EdeMeijer/followers", "following_url": "https://api.github.com/users/EdeMeijer/following{/other_user}", "gists_url": "https://api.github.com/users/EdeMeijer/gists{/gist_id}", "starred_url": "https://api.github.com/users/EdeMeijer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/EdeMeijer/subscriptions", "organizations_url": "https://api.github.com/users/EdeMeijer/orgs", "repos_url": "https://api.github.com/users/EdeMeijer/repos", "events_url": "https://api.github.com/users/EdeMeijer/events{/privacy}", "received_events_url": "https://api.github.com/users/EdeMeijer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}, {"id": 473173272, "node_id": "MDU6TGFiZWw0NzMxNzMyNzI=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:feature", "name": "type:feature", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2017-05-24T07:28:15Z", "updated_at": "2017-07-19T14:08:05Z", "closed_at": "2017-06-07T18:29:46Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Ubuntu 16.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary (nightly build)</li>\n<li><strong>TensorFlow version (use command below)</strong>: v1.2.0-rc0-172-g9e25de3</li>\n<li><strong>Bazel version (if compiling from source)</strong>: N/A</li>\n<li><strong>CUDA/cuDNN version</strong>: N/A</li>\n<li><strong>GPU model and memory</strong>: N/A</li>\n<li><strong>Exact command to reproduce</strong>: <code>python3 test.py</code></li>\n</ul>\n<h3>Describe the problem</h3>\n<p>With the new <code>tf.contrib.data.Dataset</code>, it is possible to work with tuples and lists of tensors, but not with dictionaries. Using dictionary structures is supported for things like <code>tf.batch</code>, and it would make migrating to Dataset easier if it also supported it.</p>\n<h3>Source code / logs</h3>\n<p>test.py</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\ndataset <span class=\"pl-k\">=</span> tf.contrib.data.Dataset.range(<span class=\"pl-c1\">3</span>)\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Using tuples works</span>\ndataset_tup <span class=\"pl-k\">=</span> dataset.map(<span class=\"pl-k\">lambda</span> <span class=\"pl-smi\">x</span>: (x, x <span class=\"pl-k\">*</span> <span class=\"pl-c1\">10</span>))\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Using lists works</span>\ndataset_list <span class=\"pl-k\">=</span> dataset.map(<span class=\"pl-k\">lambda</span> <span class=\"pl-smi\">x</span>: [x, x <span class=\"pl-k\">*</span> <span class=\"pl-c1\">10</span>])\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Using dicts doesn't work</span>\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> dataset_dict = dataset.map(lambda x: {'a': x, 'b': x * 10})</span>\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Select dataset_tup, dataset_list or dataset_struct to output the values</span>\ndataset_out <span class=\"pl-k\">=</span> dataset_tup\n\niterator <span class=\"pl-k\">=</span> dataset_tup.make_one_shot_iterator()\nnext_element <span class=\"pl-k\">=</span> iterator.get_next()\n\nsess <span class=\"pl-k\">=</span> tf.Session()\n\n<span class=\"pl-k\">for</span> _ <span class=\"pl-k\">in</span> <span class=\"pl-c1\">range</span>(<span class=\"pl-c1\">3</span>):\n    <span class=\"pl-c1\">print</span>(sess.run(next_element))</pre></div>\n<p>When trying to use structs, I get this error</p>\n<pre><code>Traceback (most recent call last):\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/tensor_util.py\", line 460, in make_tensor_proto\n    str_values = [compat.as_bytes(x) for x in proto_values]\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/tensor_util.py\", line 460, in &lt;listcomp&gt;\n    str_values = [compat.as_bytes(x) for x in proto_values]\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/util/compat.py\", line 65, in as_bytes\n    (bytes_or_text,))\nTypeError: Expected binary or unicode string, got {'a': &lt;tf.Tensor 'arg0:0' shape=() dtype=int64&gt;, 'b': &lt;tf.Tensor 'mul:0' shape=() dtype=int64&gt;}\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/ede/test/test3.py\", line 10, in &lt;module&gt;\n    dataset_dict = dataset.map(lambda x: {'a': x, 'b': x * 10})\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 813, in map\n    return MapDataset(self, map_func, num_threads, output_buffer_size)\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1436, in __init__\n    self._map_func.add_to_graph(ops.get_default_graph())\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/function.py\", line 619, in add_to_graph\n    self._create_definition_if_needed()\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/contrib/data/python/framework/function.py\", line 167, in _create_definition_if_needed\n    outputs = self._func(*inputs)\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1427, in tf_map_func\n    flattened_ret = [ops.convert_to_tensor(t) for t in nest.flatten(ret)]\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1427, in &lt;listcomp&gt;\n    flattened_ret = [ops.convert_to_tensor(t) for t in nest.flatten(ret)]\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 676, in convert_to_tensor\n    as_ref=False)\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 741, in internal_convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/constant_op.py\", line 113, in _constant_tensor_conversion_function\n    return constant(v, dtype=dtype, name=name)\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/constant_op.py\", line 102, in constant\n    tensor_util.make_tensor_proto(value, dtype=dtype, shape=shape, verify_shape=verify_shape))\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/tensor_util.py\", line 464, in make_tensor_proto\n    \"supported type.\" % (type(values), values))\nTypeError: Failed to convert object of type &lt;class 'dict'&gt; to Tensor. Contents: {'a': &lt;tf.Tensor 'arg0:0' shape=() dtype=int64&gt;, 'b': &lt;tf.Tensor 'mul:0' shape=() dtype=int64&gt;}. Consider casting elements to a supported type.\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Ubuntu 16.04\nTensorFlow installed from (source or binary): binary (nightly build)\nTensorFlow version (use command below): v1.2.0-rc0-172-g9e25de3\nBazel version (if compiling from source): N/A\nCUDA/cuDNN version: N/A\nGPU model and memory: N/A\nExact command to reproduce: python3 test.py\n\nDescribe the problem\nWith the new tf.contrib.data.Dataset, it is possible to work with tuples and lists of tensors, but not with dictionaries. Using dictionary structures is supported for things like tf.batch, and it would make migrating to Dataset easier if it also supported it.\nSource code / logs\ntest.py\nimport tensorflow as tf\n\ndataset = tf.contrib.data.Dataset.range(3)\n\n# Using tuples works\ndataset_tup = dataset.map(lambda x: (x, x * 10))\n# Using lists works\ndataset_list = dataset.map(lambda x: [x, x * 10])\n# Using dicts doesn't work\n# dataset_dict = dataset.map(lambda x: {'a': x, 'b': x * 10})\n\n# Select dataset_tup, dataset_list or dataset_struct to output the values\ndataset_out = dataset_tup\n\niterator = dataset_tup.make_one_shot_iterator()\nnext_element = iterator.get_next()\n\nsess = tf.Session()\n\nfor _ in range(3):\n    print(sess.run(next_element))\nWhen trying to use structs, I get this error\nTraceback (most recent call last):\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/tensor_util.py\", line 460, in make_tensor_proto\n    str_values = [compat.as_bytes(x) for x in proto_values]\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/tensor_util.py\", line 460, in <listcomp>\n    str_values = [compat.as_bytes(x) for x in proto_values]\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/util/compat.py\", line 65, in as_bytes\n    (bytes_or_text,))\nTypeError: Expected binary or unicode string, got {'a': <tf.Tensor 'arg0:0' shape=() dtype=int64>, 'b': <tf.Tensor 'mul:0' shape=() dtype=int64>}\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/ede/test/test3.py\", line 10, in <module>\n    dataset_dict = dataset.map(lambda x: {'a': x, 'b': x * 10})\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 813, in map\n    return MapDataset(self, map_func, num_threads, output_buffer_size)\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1436, in __init__\n    self._map_func.add_to_graph(ops.get_default_graph())\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/function.py\", line 619, in add_to_graph\n    self._create_definition_if_needed()\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/contrib/data/python/framework/function.py\", line 167, in _create_definition_if_needed\n    outputs = self._func(*inputs)\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1427, in tf_map_func\n    flattened_ret = [ops.convert_to_tensor(t) for t in nest.flatten(ret)]\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1427, in <listcomp>\n    flattened_ret = [ops.convert_to_tensor(t) for t in nest.flatten(ret)]\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 676, in convert_to_tensor\n    as_ref=False)\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 741, in internal_convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/constant_op.py\", line 113, in _constant_tensor_conversion_function\n    return constant(v, dtype=dtype, name=name)\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/constant_op.py\", line 102, in constant\n    tensor_util.make_tensor_proto(value, dtype=dtype, shape=shape, verify_shape=verify_shape))\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/tensor_util.py\", line 464, in make_tensor_proto\n    \"supported type.\" % (type(values), values))\nTypeError: Failed to convert object of type <class 'dict'> to Tensor. Contents: {'a': <tf.Tensor 'arg0:0' shape=() dtype=int64>, 'b': <tf.Tensor 'mul:0' shape=() dtype=int64>}. Consider casting elements to a supported type.", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Ubuntu 16.04\r\n- **TensorFlow installed from (source or binary)**: binary (nightly build)\r\n- **TensorFlow version (use command below)**: v1.2.0-rc0-172-g9e25de3\r\n- **Bazel version (if compiling from source)**: N/A\r\n- **CUDA/cuDNN version**: N/A\r\n- **GPU model and memory**: N/A\r\n- **Exact command to reproduce**: `python3 test.py`\r\n\r\n### Describe the problem\r\nWith the new `tf.contrib.data.Dataset`, it is possible to work with tuples and lists of tensors, but not with dictionaries. Using dictionary structures is supported for things like `tf.batch`, and it would make migrating to Dataset easier if it also supported it.\r\n\r\n### Source code / logs\r\ntest.py\r\n```python\r\nimport tensorflow as tf\r\n\r\ndataset = tf.contrib.data.Dataset.range(3)\r\n\r\n# Using tuples works\r\ndataset_tup = dataset.map(lambda x: (x, x * 10))\r\n# Using lists works\r\ndataset_list = dataset.map(lambda x: [x, x * 10])\r\n# Using dicts doesn't work\r\n# dataset_dict = dataset.map(lambda x: {'a': x, 'b': x * 10})\r\n\r\n# Select dataset_tup, dataset_list or dataset_struct to output the values\r\ndataset_out = dataset_tup\r\n\r\niterator = dataset_tup.make_one_shot_iterator()\r\nnext_element = iterator.get_next()\r\n\r\nsess = tf.Session()\r\n\r\nfor _ in range(3):\r\n    print(sess.run(next_element))\r\n```\r\n\r\nWhen trying to use structs, I get this error\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/tensor_util.py\", line 460, in make_tensor_proto\r\n    str_values = [compat.as_bytes(x) for x in proto_values]\r\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/tensor_util.py\", line 460, in <listcomp>\r\n    str_values = [compat.as_bytes(x) for x in proto_values]\r\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/util/compat.py\", line 65, in as_bytes\r\n    (bytes_or_text,))\r\nTypeError: Expected binary or unicode string, got {'a': <tf.Tensor 'arg0:0' shape=() dtype=int64>, 'b': <tf.Tensor 'mul:0' shape=() dtype=int64>}\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/ede/test/test3.py\", line 10, in <module>\r\n    dataset_dict = dataset.map(lambda x: {'a': x, 'b': x * 10})\r\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 813, in map\r\n    return MapDataset(self, map_func, num_threads, output_buffer_size)\r\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1436, in __init__\r\n    self._map_func.add_to_graph(ops.get_default_graph())\r\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/function.py\", line 619, in add_to_graph\r\n    self._create_definition_if_needed()\r\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/contrib/data/python/framework/function.py\", line 167, in _create_definition_if_needed\r\n    outputs = self._func(*inputs)\r\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1427, in tf_map_func\r\n    flattened_ret = [ops.convert_to_tensor(t) for t in nest.flatten(ret)]\r\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1427, in <listcomp>\r\n    flattened_ret = [ops.convert_to_tensor(t) for t in nest.flatten(ret)]\r\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 676, in convert_to_tensor\r\n    as_ref=False)\r\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 741, in internal_convert_to_tensor\r\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\r\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/constant_op.py\", line 113, in _constant_tensor_conversion_function\r\n    return constant(v, dtype=dtype, name=name)\r\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/constant_op.py\", line 102, in constant\r\n    tensor_util.make_tensor_proto(value, dtype=dtype, shape=shape, verify_shape=verify_shape))\r\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/tensor_util.py\", line 464, in make_tensor_proto\r\n    \"supported type.\" % (type(values), values))\r\nTypeError: Failed to convert object of type <class 'dict'> to Tensor. Contents: {'a': <tf.Tensor 'arg0:0' shape=() dtype=int64>, 'b': <tf.Tensor 'mul:0' shape=() dtype=int64>}. Consider casting elements to a supported type.\r\n```"}