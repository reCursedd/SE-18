{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/436483416", "html_url": "https://github.com/tensorflow/tensorflow/pull/23022#issuecomment-436483416", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23022", "id": 436483416, "node_id": "MDEyOklzc3VlQ29tbWVudDQzNjQ4MzQxNg==", "user": {"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}, "created_at": "2018-11-07T02:36:20Z", "updated_at": "2018-11-07T02:36:20Z", "author_association": "MEMBER", "body_html": "<p>Thanks <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1028969\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/dmitrievanthony\">@dmitrievanthony</a> : I'll run the tests once we have a fix for the licenses failure.</p>\n<p>Some background: When we package the JNI library in a tarball, we include the LICENSE files of all libraries that the target depends on. You can probably run <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/ci_build/ci_sanity.sh\"><code>ci_sanity.sh</code></a> locally to reproduce the failure seen in the \"Ubuntu Sanity\" build.</p>\n<p>The LICENSE files are explicitly listed in the <a href=\"https://github.com/tensorflow/tensorflow/blob/ee1263ea3a0d8cb0bccf824d78d25d6c9d545561/tensorflow/tools/lib_package/BUILD#L181\"><code>//tensorflow/tools/lib_package:jnilicenses_generate</code></a> BUILD target and the sanity check script aims to ensure that this list is in <a href=\"https://github.com/tensorflow/tensorflow/blob/ee1263ea3a0d8cb0bccf824d78d25d6c9d545561/tensorflow/tools/ci_build/ci_sanity.sh#L414\">sync with the actual dependencies of <code>//tensorflow/java:libtensorflow_jni.so</code> target</a>.</p>\n<p>Since we're adding a dependency to another third party library (grpc) we need to include the license for that as well - listed in the logs of the failing test:</p>\n<pre><code>FAIL: mismatch in packaged licenses and external dependencies\nMissing the licenses for the following external dependencies:\n@grpc//\n@grpc//third_party/address_sorting\n@grpc//third_party/nanopb\n</code></pre>\n<p>(Which means we need the LICENSE file for grpc as well as <em>its</em> external dependencies on address_sorting and nanopb).</p>\n<p>So I think simply adding these to the dependencies of the <a href=\"https://github.com/tensorflow/tensorflow/blob/ee1263ea3a0d8cb0bccf824d78d25d6c9d545561/tensorflow/tools/lib_package/BUILD#L181\"><code>//tensorflow/tools/lib_package:jnilicenses_generate</code></a> target should do.</p>\n<p>Let me know if you can do that (and run <code>ci_sanity.sh</code> locally to iterate faster). If not, and you need some help, I can try to patch that in before merging this PR.</p>\n<p>Thanks!</p>", "body_text": "Thanks @dmitrievanthony : I'll run the tests once we have a fix for the licenses failure.\nSome background: When we package the JNI library in a tarball, we include the LICENSE files of all libraries that the target depends on. You can probably run ci_sanity.sh locally to reproduce the failure seen in the \"Ubuntu Sanity\" build.\nThe LICENSE files are explicitly listed in the //tensorflow/tools/lib_package:jnilicenses_generate BUILD target and the sanity check script aims to ensure that this list is in sync with the actual dependencies of //tensorflow/java:libtensorflow_jni.so target.\nSince we're adding a dependency to another third party library (grpc) we need to include the license for that as well - listed in the logs of the failing test:\nFAIL: mismatch in packaged licenses and external dependencies\nMissing the licenses for the following external dependencies:\n@grpc//\n@grpc//third_party/address_sorting\n@grpc//third_party/nanopb\n\n(Which means we need the LICENSE file for grpc as well as its external dependencies on address_sorting and nanopb).\nSo I think simply adding these to the dependencies of the //tensorflow/tools/lib_package:jnilicenses_generate target should do.\nLet me know if you can do that (and run ci_sanity.sh locally to iterate faster). If not, and you need some help, I can try to patch that in before merging this PR.\nThanks!", "body": "Thanks @dmitrievanthony : I'll run the tests once we have a fix for the licenses failure.\r\n\r\nSome background: When we package the JNI library in a tarball, we include the LICENSE files of all libraries that the target depends on. You can probably run [`ci_sanity.sh`](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/ci_build/ci_sanity.sh) locally to reproduce the failure seen in the \"Ubuntu Sanity\" build. \r\n\r\nThe LICENSE files are explicitly listed in the [`//tensorflow/tools/lib_package:jnilicenses_generate`](https://github.com/tensorflow/tensorflow/blob/ee1263ea3a0d8cb0bccf824d78d25d6c9d545561/tensorflow/tools/lib_package/BUILD#L181) BUILD target and the sanity check script aims to ensure that this list is in [sync with the actual dependencies of `//tensorflow/java:libtensorflow_jni.so` target](https://github.com/tensorflow/tensorflow/blob/ee1263ea3a0d8cb0bccf824d78d25d6c9d545561/tensorflow/tools/ci_build/ci_sanity.sh#L414).\r\n\r\nSince we're adding a dependency to another third party library (grpc) we need to include the license for that as well - listed in the logs of the failing test:\r\n```\r\nFAIL: mismatch in packaged licenses and external dependencies\r\nMissing the licenses for the following external dependencies:\r\n@grpc//\r\n@grpc//third_party/address_sorting\r\n@grpc//third_party/nanopb\r\n```\r\n\r\n(Which means we need the LICENSE file for grpc as well as _its_ external dependencies on address_sorting and nanopb). \r\n\r\nSo I think simply adding these to the dependencies of the [`//tensorflow/tools/lib_package:jnilicenses_generate`](https://github.com/tensorflow/tensorflow/blob/ee1263ea3a0d8cb0bccf824d78d25d6c9d545561/tensorflow/tools/lib_package/BUILD#L181) target should do.\r\n\r\nLet me know if you can do that (and run `ci_sanity.sh` locally to iterate faster). If not, and you need some help, I can try to patch that in before merging this PR.\r\n\r\nThanks!"}