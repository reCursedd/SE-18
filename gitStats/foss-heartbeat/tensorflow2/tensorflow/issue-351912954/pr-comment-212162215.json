{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/212162215", "pull_request_review_id": 148733969, "id": 212162215, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMjE2MjIxNQ==", "diff_hunk": "@@ -0,0 +1,189 @@\n+/* Copyright 2018 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+/* \n+See extract_image_patches_op* files and docs for extract_image_patches in \n+../ops/image_ops.cc.\n+\n+Rates are not supported as of now, but the comments hint how to edit the code\n+when rates are to be added.\n+*/\n+\n+#define USE_EIGEN_TENSOR\n+#define EIGEN_USE_THREADS\n+\n+#include \"tensorflow/core/kernels/extract_volume_patches_op.h\"\n+#include <vector>\n+#include \"tensorflow/core/framework/numeric_op.h\"\n+#include \"tensorflow/core/framework/op_kernel.h\"\n+#include \"tensorflow/core/framework/register_types.h\"\n+#include \"tensorflow/core/framework/tensor.h\"\n+#include \"tensorflow/core/kernels/bounds_check.h\"\n+#include \"tensorflow/core/kernels/ops_util.h\"\n+#include \"tensorflow/core/lib/core/errors.h\"\n+#include \"tensorflow/core/platform/logging.h\"\n+#include \"tensorflow/core/platform/macros.h\"\n+#include \"tensorflow/core/util/tensor_format.h\"\n+\n+namespace tensorflow {\n+\n+typedef Eigen::ThreadPoolDevice CPUDevice;\n+typedef Eigen::GpuDevice GPUDevice;\n+\n+static inline void ParseAttributeVec5(OpKernelConstruction* context,\n+                                      const string& attr_name,\n+                                      std::vector<int32>* attr) {\n+  OP_REQUIRES_OK(context, context->GetAttr(attr_name, attr));\n+  OP_REQUIRES(\n+      context, (*attr)[0] == 1 && (*attr)[4] == 1,\n+      errors::Unimplemented(\"Only support \", attr_name, \" across space.\"));\n+  OP_REQUIRES(context, (*attr)[1] >= 1 && (*attr)[2] >= 1 && (*attr)[3] >= 1,\n+              errors::OutOfRange(attr_name, \" is out of range.\"));\n+}\n+\n+template <typename Device, typename T>\n+class ExtractVolumePatchesOp : public UnaryOp<T> {\n+ public:\n+  explicit ExtractVolumePatchesOp(OpKernelConstruction* context)\n+      : UnaryOp<T>(context) {\n+    ParseAttributeVec5(context, \"ksizes\", &ksizes_);\n+    ParseAttributeVec5(context, \"strides\", &strides_);\n+    //ParseAttributeVec5(context, \"rates\", &rates_);\n+    OP_REQUIRES_OK(context, context->GetAttr(\"padding\", &padding_));\n+  }\n+\n+  void Compute(OpKernelContext* context) override {\n+    // Input tensor is of the following dimensions:\n+    // [ batch, in_planes, in_rows, in_cols, channels ]\n+    const Tensor& input = context->input(0);\n+    OP_REQUIRES(context, input.dims() == 5,\n+                errors::InvalidArgument(\"input must be 5-dimensional\",\n+                                        input.shape().DebugString()));\n+\n+    const int batch = input.dim_size(0);\n+    const int in_planes = input.dim_size(1);\n+    const int in_rows = input.dim_size(2);\n+    const int in_cols = input.dim_size(3);\n+    const int depth = input.dim_size(4);\n+\n+    const int ksize_planes = ksizes_[1];\n+    const int ksize_rows = ksizes_[2];\n+    const int ksize_cols = ksizes_[3];\n+\n+    const int stride_planes = strides_[1];\n+    const int stride_rows = strides_[2];\n+    const int stride_cols = strides_[3];\n+\n+    /*\n+    // In order to enable rates, uncomment the following lines and use", "path": "tensorflow/core/kernels/extract_volume_patches_op.cc", "position": null, "original_position": 90, "commit_id": "33f57bd1311df97a25cd70784dfaafc8e44d07c4", "original_commit_id": "ad18b2dd923329ef598ee12b9bafd7fc63d7013d", "user": {"login": "ezhulenev", "id": 1174378, "node_id": "MDQ6VXNlcjExNzQzNzg=", "avatar_url": "https://avatars2.githubusercontent.com/u/1174378?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ezhulenev", "html_url": "https://github.com/ezhulenev", "followers_url": "https://api.github.com/users/ezhulenev/followers", "following_url": "https://api.github.com/users/ezhulenev/following{/other_user}", "gists_url": "https://api.github.com/users/ezhulenev/gists{/gist_id}", "starred_url": "https://api.github.com/users/ezhulenev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ezhulenev/subscriptions", "organizations_url": "https://api.github.com/users/ezhulenev/orgs", "repos_url": "https://api.github.com/users/ezhulenev/repos", "events_url": "https://api.github.com/users/ezhulenev/events{/privacy}", "received_events_url": "https://api.github.com/users/ezhulenev/received_events", "type": "User", "site_admin": false}, "body": "Can you add a brief note about missing rates parameter in Eigen op, as a reason for commenting this code. Maybe even a TODO, adding rates to Eigen should be a reasonably small change.", "created_at": "2018-08-23T01:54:50Z", "updated_at": "2018-09-15T03:47:37Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/21715#discussion_r212162215", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/21715", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/212162215"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/21715#discussion_r212162215"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/21715"}}, "body_html": "<p>Can you add a brief note about missing rates parameter in Eigen op, as a reason for commenting this code. Maybe even a TODO, adding rates to Eigen should be a reasonably small change.</p>", "body_text": "Can you add a brief note about missing rates parameter in Eigen op, as a reason for commenting this code. Maybe even a TODO, adding rates to Eigen should be a reasonably small change."}