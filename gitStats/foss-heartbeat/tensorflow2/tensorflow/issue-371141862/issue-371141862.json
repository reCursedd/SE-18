{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23048", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23048/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23048/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23048/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23048", "id": 371141862, "node_id": "MDU6SXNzdWUzNzExNDE4NjI=", "number": 23048, "title": "Bug in function: MutableGraphView::ReplaceInput(..) ?", "user": {"login": "yehenrytian", "id": 4379480, "node_id": "MDQ6VXNlcjQzNzk0ODA=", "avatar_url": "https://avatars2.githubusercontent.com/u/4379480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yehenrytian", "html_url": "https://github.com/yehenrytian", "followers_url": "https://api.github.com/users/yehenrytian/followers", "following_url": "https://api.github.com/users/yehenrytian/following{/other_user}", "gists_url": "https://api.github.com/users/yehenrytian/gists{/gist_id}", "starred_url": "https://api.github.com/users/yehenrytian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yehenrytian/subscriptions", "organizations_url": "https://api.github.com/users/yehenrytian/orgs", "repos_url": "https://api.github.com/users/yehenrytian/repos", "events_url": "https://api.github.com/users/yehenrytian/events{/privacy}", "received_events_url": "https://api.github.com/users/yehenrytian/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1097547147, "node_id": "MDU6TGFiZWwxMDk3NTQ3MTQ3", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:ops", "name": "comp:ops", "color": "0052cc", "default": false}, {"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "open", "locked": false, "assignee": {"login": "shivaniag", "id": 16565716, "node_id": "MDQ6VXNlcjE2NTY1NzE2", "avatar_url": "https://avatars1.githubusercontent.com/u/16565716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shivaniag", "html_url": "https://github.com/shivaniag", "followers_url": "https://api.github.com/users/shivaniag/followers", "following_url": "https://api.github.com/users/shivaniag/following{/other_user}", "gists_url": "https://api.github.com/users/shivaniag/gists{/gist_id}", "starred_url": "https://api.github.com/users/shivaniag/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shivaniag/subscriptions", "organizations_url": "https://api.github.com/users/shivaniag/orgs", "repos_url": "https://api.github.com/users/shivaniag/repos", "events_url": "https://api.github.com/users/shivaniag/events{/privacy}", "received_events_url": "https://api.github.com/users/shivaniag/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "shivaniag", "id": 16565716, "node_id": "MDQ6VXNlcjE2NTY1NzE2", "avatar_url": "https://avatars1.githubusercontent.com/u/16565716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shivaniag", "html_url": "https://github.com/shivaniag", "followers_url": "https://api.github.com/users/shivaniag/followers", "following_url": "https://api.github.com/users/shivaniag/following{/other_user}", "gists_url": "https://api.github.com/users/shivaniag/gists{/gist_id}", "starred_url": "https://api.github.com/users/shivaniag/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shivaniag/subscriptions", "organizations_url": "https://api.github.com/users/shivaniag/orgs", "repos_url": "https://api.github.com/users/shivaniag/repos", "events_url": "https://api.github.com/users/shivaniag/events{/privacy}", "received_events_url": "https://api.github.com/users/shivaniag/received_events", "type": "User", "site_admin": false}, {"login": "harshini-gadige", "id": 42781361, "node_id": "MDQ6VXNlcjQyNzgxMzYx", "avatar_url": "https://avatars1.githubusercontent.com/u/42781361?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harshini-gadige", "html_url": "https://github.com/harshini-gadige", "followers_url": "https://api.github.com/users/harshini-gadige/followers", "following_url": "https://api.github.com/users/harshini-gadige/following{/other_user}", "gists_url": "https://api.github.com/users/harshini-gadige/gists{/gist_id}", "starred_url": "https://api.github.com/users/harshini-gadige/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harshini-gadige/subscriptions", "organizations_url": "https://api.github.com/users/harshini-gadige/orgs", "repos_url": "https://api.github.com/users/harshini-gadige/repos", "events_url": "https://api.github.com/users/harshini-gadige/events{/privacy}", "received_events_url": "https://api.github.com/users/harshini-gadige/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2018-10-17T15:39:03Z", "updated_at": "2018-11-22T18:59:39Z", "closed_at": null, "author_association": "NONE", "body_html": "<hr>\n<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Linux Ubuntu 16.04.10</li>\n<li><strong>Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device</strong>: N/A</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: source</li>\n<li><strong>TensorFlow version (use command below)</strong>: v1.11</li>\n<li><strong>Python version</strong>: 3.5</li>\n<li><strong>Bazel version (if compiling from source)</strong>: 0.16</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: 5.4.0 20160609</li>\n<li><strong>CUDA/cuDNN version</strong>:  N/A</li>\n<li><strong>GPU model and memory</strong>: N/A</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>I am modifying the Tensorflow source to add a new <code>tensorflow::grappler::CustomGraphOptimizer</code> pass, and I am having a hard time of using the fuction: <code>MutableGraphView::ReplaceInput(..)</code>. I think there is a bug inside this function, (the master branch version is the same as the r1.11 version), in that the new input is not specified with the <code>output_port_id</code>:</p>\n<h3>Source code / logs</h3>\n<p>The description of the function seems pretty clear in the header file:</p>\n<div class=\"highlight highlight-source-c++\"><pre>  <span class=\"pl-c\"><span class=\"pl-c\">//</span> Replaces the input for the output nodes of 'old_input' with a port</span>\n  <span class=\"pl-c\"><span class=\"pl-c\">//</span> `output_port_id` with 'new_input'.</span>\n  <span class=\"pl-c\"><span class=\"pl-c\">//</span></span>\n  <span class=\"pl-c\"><span class=\"pl-c\">//</span> E.g: We have 2 nodes that use 'bar' node outputs as inputs:</span>\n  <span class=\"pl-c\"><span class=\"pl-c\">//</span> foo(bar:0, bar:1),  foo2(other:0, bar:0)</span>\n  <span class=\"pl-c\"><span class=\"pl-c\">//</span> Calling ReplaceInput(bar, new, 0) changes every occurrence of bar:0 for</span>\n  <span class=\"pl-c\"><span class=\"pl-c\">//</span> new:0.  Result:</span>\n  <span class=\"pl-c\"><span class=\"pl-c\">//</span> foo(new:0, bar:1),  foo2(other:0, new:0)</span>\n  <span class=\"pl-k\">void</span> <span class=\"pl-en\">ReplaceInput</span>(<span class=\"pl-k\">const</span> NodeDef&amp; old_input, <span class=\"pl-k\">const</span> NodeDef&amp; new_input,\n                    <span class=\"pl-k\">int</span> output_port_id = <span class=\"pl-c1\">0</span>);\n</pre></div>\n<p>However in the .cc code of the function body, I don't see where we set the output port index to the new_input:</p>\n<div class=\"highlight highlight-source-c++\"><pre><span class=\"pl-k\">void</span> <span class=\"pl-en\">MutableGraphView::ReplaceInput</span>(<span class=\"pl-k\">const</span> NodeDef&amp; old_input,\n                                    <span class=\"pl-k\">const</span> NodeDef&amp; new_input,\n                                    <span class=\"pl-k\">const</span> <span class=\"pl-k\">int</span> output_port_id) {\n  GraphView::OutputPort output_port =\n      <span class=\"pl-c1\">GetOutputPort</span>(old_input.<span class=\"pl-c1\">name</span>(), output_port_id);\n  <span class=\"pl-k\">auto</span> fanout = <span class=\"pl-c1\">GetFanout</span>(output_port);\n  <span class=\"pl-k\">for</span> (<span class=\"pl-k\">auto</span>&amp; input_port : fanout) {\n    <span class=\"pl-c\"><span class=\"pl-c\">//</span> Isn't that here we should have something like: strings::StrCat(new_input.name(), \":\", output_port_id); </span>\n   <span class=\"pl-c\"><span class=\"pl-c\">//</span> instead of just put the new_input.name() below!?</span>\n    input_port.<span class=\"pl-smi\">node</span>-&gt;<span class=\"pl-c1\">set_input</span>(input_port.<span class=\"pl-smi\">port_id</span>, new_input.<span class=\"pl-c1\">name</span>());  \n    <span class=\"pl-c1\">AddFanouts</span>(input_port.<span class=\"pl-smi\">node</span>);\n  }\n}</pre></div>\n<p>Also I have a related question, if the output port indexes are different between the new and old input, how can I properly replace the input? e.g. something like</p>\n<div class=\"highlight highlight-source-c++\"><pre>  <span class=\"pl-c\"><span class=\"pl-c\">//</span> foo(bar:0, bar:1),  foo2(other:0, bar:0)</span>\n  <span class=\"pl-c\"><span class=\"pl-c\">//</span> Calling ReplaceInput(bar, 0, new, 2) changes every occurrence of bar:0 for</span>\n  <span class=\"pl-c\"><span class=\"pl-c\">//</span> new:2.  Result:</span>\n  <span class=\"pl-c\"><span class=\"pl-c\">//</span> foo(new:2, bar:1),  foo2(other:0, new:2)</span></pre></div>\n<p>Thanks a lot!</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 16.04.10\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: N/A\nTensorFlow installed from (source or binary): source\nTensorFlow version (use command below): v1.11\nPython version: 3.5\nBazel version (if compiling from source): 0.16\nGCC/Compiler version (if compiling from source): 5.4.0 20160609\nCUDA/cuDNN version:  N/A\nGPU model and memory: N/A\nExact command to reproduce:\n\nDescribe the problem\nI am modifying the Tensorflow source to add a new tensorflow::grappler::CustomGraphOptimizer pass, and I am having a hard time of using the fuction: MutableGraphView::ReplaceInput(..). I think there is a bug inside this function, (the master branch version is the same as the r1.11 version), in that the new input is not specified with the output_port_id:\nSource code / logs\nThe description of the function seems pretty clear in the header file:\n  // Replaces the input for the output nodes of 'old_input' with a port\n  // `output_port_id` with 'new_input'.\n  //\n  // E.g: We have 2 nodes that use 'bar' node outputs as inputs:\n  // foo(bar:0, bar:1),  foo2(other:0, bar:0)\n  // Calling ReplaceInput(bar, new, 0) changes every occurrence of bar:0 for\n  // new:0.  Result:\n  // foo(new:0, bar:1),  foo2(other:0, new:0)\n  void ReplaceInput(const NodeDef& old_input, const NodeDef& new_input,\n                    int output_port_id = 0);\n\nHowever in the .cc code of the function body, I don't see where we set the output port index to the new_input:\nvoid MutableGraphView::ReplaceInput(const NodeDef& old_input,\n                                    const NodeDef& new_input,\n                                    const int output_port_id) {\n  GraphView::OutputPort output_port =\n      GetOutputPort(old_input.name(), output_port_id);\n  auto fanout = GetFanout(output_port);\n  for (auto& input_port : fanout) {\n    // Isn't that here we should have something like: strings::StrCat(new_input.name(), \":\", output_port_id); \n   // instead of just put the new_input.name() below!?\n    input_port.node->set_input(input_port.port_id, new_input.name());  \n    AddFanouts(input_port.node);\n  }\n}\nAlso I have a related question, if the output port indexes are different between the new and old input, how can I properly replace the input? e.g. something like\n  // foo(bar:0, bar:1),  foo2(other:0, bar:0)\n  // Calling ReplaceInput(bar, 0, new, 2) changes every occurrence of bar:0 for\n  // new:2.  Result:\n  // foo(new:2, bar:1),  foo2(other:0, new:2)\nThanks a lot!", "body": "------------------------\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Ubuntu 16.04.10\r\n- **Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device**: N/A\r\n- **TensorFlow installed from (source or binary)**: source\r\n- **TensorFlow version (use command below)**: v1.11\r\n- **Python version**: 3.5\r\n- **Bazel version (if compiling from source)**: 0.16\r\n- **GCC/Compiler version (if compiling from source)**: 5.4.0 20160609\r\n- **CUDA/cuDNN version**:  N/A\r\n- **GPU model and memory**: N/A\r\n- **Exact command to reproduce**:\r\n\r\n\r\n### Describe the problem\r\nI am modifying the Tensorflow source to add a new `tensorflow::grappler::CustomGraphOptimizer` pass, and I am having a hard time of using the fuction: `MutableGraphView::ReplaceInput(..)`. I think there is a bug inside this function, (the master branch version is the same as the r1.11 version), in that the new input is not specified with the `output_port_id`:\r\n\r\n### Source code / logs\r\nThe description of the function seems pretty clear in the header file:\r\n```c++\r\n  // Replaces the input for the output nodes of 'old_input' with a port\r\n  // `output_port_id` with 'new_input'.\r\n  //\r\n  // E.g: We have 2 nodes that use 'bar' node outputs as inputs:\r\n  // foo(bar:0, bar:1),  foo2(other:0, bar:0)\r\n  // Calling ReplaceInput(bar, new, 0) changes every occurrence of bar:0 for\r\n  // new:0.  Result:\r\n  // foo(new:0, bar:1),  foo2(other:0, new:0)\r\n  void ReplaceInput(const NodeDef& old_input, const NodeDef& new_input,\r\n                    int output_port_id = 0);\r\n\r\n```\r\nHowever in the .cc code of the function body, I don't see where we set the output port index to the new_input:\r\n```c++\r\nvoid MutableGraphView::ReplaceInput(const NodeDef& old_input,\r\n                                    const NodeDef& new_input,\r\n                                    const int output_port_id) {\r\n  GraphView::OutputPort output_port =\r\n      GetOutputPort(old_input.name(), output_port_id);\r\n  auto fanout = GetFanout(output_port);\r\n  for (auto& input_port : fanout) {\r\n    // Isn't that here we should have something like: strings::StrCat(new_input.name(), \":\", output_port_id); \r\n   // instead of just put the new_input.name() below!?\r\n    input_port.node->set_input(input_port.port_id, new_input.name());  \r\n    AddFanouts(input_port.node);\r\n  }\r\n}\r\n```\r\n\r\nAlso I have a related question, if the output port indexes are different between the new and old input, how can I properly replace the input? e.g. something like\r\n```c++\r\n  // foo(bar:0, bar:1),  foo2(other:0, bar:0)\r\n  // Calling ReplaceInput(bar, 0, new, 2) changes every occurrence of bar:0 for\r\n  // new:2.  Result:\r\n  // foo(new:2, bar:1),  foo2(other:0, new:2)\r\n```\r\n\r\nThanks a lot!\r\n\r\n"}