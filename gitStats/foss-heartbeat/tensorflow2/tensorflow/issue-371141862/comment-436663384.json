{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/436663384", "html_url": "https://github.com/tensorflow/tensorflow/issues/23048#issuecomment-436663384", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23048", "id": 436663384, "node_id": "MDEyOklzc3VlQ29tbWVudDQzNjY2MzM4NA==", "user": {"login": "yehenrytian", "id": 4379480, "node_id": "MDQ6VXNlcjQzNzk0ODA=", "avatar_url": "https://avatars2.githubusercontent.com/u/4379480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yehenrytian", "html_url": "https://github.com/yehenrytian", "followers_url": "https://api.github.com/users/yehenrytian/followers", "following_url": "https://api.github.com/users/yehenrytian/following{/other_user}", "gists_url": "https://api.github.com/users/yehenrytian/gists{/gist_id}", "starred_url": "https://api.github.com/users/yehenrytian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yehenrytian/subscriptions", "organizations_url": "https://api.github.com/users/yehenrytian/orgs", "repos_url": "https://api.github.com/users/yehenrytian/repos", "events_url": "https://api.github.com/users/yehenrytian/events{/privacy}", "received_events_url": "https://api.github.com/users/yehenrytian/received_events", "type": "User", "site_admin": false}, "created_at": "2018-11-07T15:31:37Z", "updated_at": "2018-11-07T15:33:08Z", "author_association": "NONE", "body_html": "<p>Below is my own <code>fix</code> for the issue and also the solution to the different index question:</p>\n<p>In <code>mutable_graph_view.h</code>:</p>\n<div class=\"highlight highlight-source-c++\"><pre><span class=\"pl-k\">void</span> <span class=\"pl-en\">ReplaceInput</span>(<span class=\"pl-k\">const</span> NodeDef&amp; old_input, <span class=\"pl-k\">const</span> NodeDef&amp; new_input,\n                    <span class=\"pl-k\">int</span> output_port_id = <span class=\"pl-c1\">0</span>, <span class=\"pl-k\">int</span> new_output_port_id = <span class=\"pl-c1\">0</span>);</pre></div>\n<p>In <code>mutable_graph_view.cc</code>:</p>\n<div class=\"highlight highlight-source-c++\"><pre><span class=\"pl-k\">void</span> <span class=\"pl-en\">MutableGraphView::ReplaceInput</span>(<span class=\"pl-k\">const</span> NodeDef&amp; old_input,\n                                    <span class=\"pl-k\">const</span> NodeDef&amp; new_input,\n                                    <span class=\"pl-k\">const</span> <span class=\"pl-k\">int</span> output_port_id,\n                                    <span class=\"pl-k\">int</span> new_output_port_id) {\n  GraphView::OutputPort output_port =\n      <span class=\"pl-c1\">GetOutputPort</span>(old_input.<span class=\"pl-c1\">name</span>(), output_port_id);\n \n  <span class=\"pl-k\">auto</span> fanout = <span class=\"pl-c1\">GetFanout</span>(output_port);\n  <span class=\"pl-k\">for</span> (<span class=\"pl-k\">auto</span>&amp; input_port : fanout) {\n    <span class=\"pl-c1\">VLOG</span>(<span class=\"pl-c1\">0</span>) &lt;&lt; <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>input_port.port_id22 is: <span class=\"pl-pds\">\"</span></span> &lt;&lt; input_port.<span class=\"pl-smi\">port_id</span>;\n    string new_input_name = <span class=\"pl-c1\">strings::StrCat</span>(new_input.<span class=\"pl-c1\">name</span>(), <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>:<span class=\"pl-pds\">\"</span></span>, new_output_port_id);\n    input_port.<span class=\"pl-smi\">node</span>-&gt;<span class=\"pl-c1\">set_input</span>(input_port.<span class=\"pl-smi\">port_id</span>, new_input_name);\n    <span class=\"pl-c1\">AddFanouts</span>(input_port.<span class=\"pl-smi\">node</span>);\n  }\n}</pre></div>\n<p>Just for your reference.</p>", "body_text": "Below is my own fix for the issue and also the solution to the different index question:\nIn mutable_graph_view.h:\nvoid ReplaceInput(const NodeDef& old_input, const NodeDef& new_input,\n                    int output_port_id = 0, int new_output_port_id = 0);\nIn mutable_graph_view.cc:\nvoid MutableGraphView::ReplaceInput(const NodeDef& old_input,\n                                    const NodeDef& new_input,\n                                    const int output_port_id,\n                                    int new_output_port_id) {\n  GraphView::OutputPort output_port =\n      GetOutputPort(old_input.name(), output_port_id);\n \n  auto fanout = GetFanout(output_port);\n  for (auto& input_port : fanout) {\n    VLOG(0) << \"input_port.port_id22 is: \" << input_port.port_id;\n    string new_input_name = strings::StrCat(new_input.name(), \":\", new_output_port_id);\n    input_port.node->set_input(input_port.port_id, new_input_name);\n    AddFanouts(input_port.node);\n  }\n}\nJust for your reference.", "body": "Below is my own `fix` for the issue and also the solution to the different index question:\r\n\r\nIn `mutable_graph_view.h`:\r\n\r\n```c++\r\nvoid ReplaceInput(const NodeDef& old_input, const NodeDef& new_input,\r\n                    int output_port_id = 0, int new_output_port_id = 0);\r\n```\r\n\r\nIn `mutable_graph_view.cc`:\r\n\r\n```c++\r\nvoid MutableGraphView::ReplaceInput(const NodeDef& old_input,\r\n                                    const NodeDef& new_input,\r\n                                    const int output_port_id,\r\n                                    int new_output_port_id) {\r\n  GraphView::OutputPort output_port =\r\n      GetOutputPort(old_input.name(), output_port_id);\r\n \r\n  auto fanout = GetFanout(output_port);\r\n  for (auto& input_port : fanout) {\r\n    VLOG(0) << \"input_port.port_id22 is: \" << input_port.port_id;\r\n    string new_input_name = strings::StrCat(new_input.name(), \":\", new_output_port_id);\r\n    input_port.node->set_input(input_port.port_id, new_input_name);\r\n    AddFanouts(input_port.node);\r\n  }\r\n}\r\n```\r\n\r\nJust for your reference."}