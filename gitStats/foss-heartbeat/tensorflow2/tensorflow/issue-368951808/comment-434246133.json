{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/434246133", "html_url": "https://github.com/tensorflow/tensorflow/issues/22887#issuecomment-434246133", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22887", "id": 434246133, "node_id": "MDEyOklzc3VlQ29tbWVudDQzNDI0NjEzMw==", "user": {"login": "qiaohaijun", "id": 1198833, "node_id": "MDQ6VXNlcjExOTg4MzM=", "avatar_url": "https://avatars2.githubusercontent.com/u/1198833?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qiaohaijun", "html_url": "https://github.com/qiaohaijun", "followers_url": "https://api.github.com/users/qiaohaijun/followers", "following_url": "https://api.github.com/users/qiaohaijun/following{/other_user}", "gists_url": "https://api.github.com/users/qiaohaijun/gists{/gist_id}", "starred_url": "https://api.github.com/users/qiaohaijun/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qiaohaijun/subscriptions", "organizations_url": "https://api.github.com/users/qiaohaijun/orgs", "repos_url": "https://api.github.com/users/qiaohaijun/repos", "events_url": "https://api.github.com/users/qiaohaijun/events{/privacy}", "received_events_url": "https://api.github.com/users/qiaohaijun/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-30T10:22:41Z", "updated_at": "2018-10-30T10:22:41Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=10539540\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/samikama\">@samikama</a><br>\nadd more info.</p>\n<h3>my scripts</h3>\n<pre><code>graph_pb = './freezed_jce.pb'\n\ngraph_def=tf.GraphDef()\nwith tf.gfile.GFile(graph_pb, \"rb\") as f:\n    graph_def.ParseFromString(f.read())\n\ngpu_options=tf.GPUOptions(per_process_gpu_memory_fraction=0.4)\n\ntrt_graph_def=trt.create_inference_graph(\n        input_graph_def = graph_def,\n        outputs = [\"final_score\"],\n        max_batch_size = 6000,\n        max_workspace_size_bytes=1&lt;&lt;32,\n        precision_mode = \"FP32\"\n        )   \n\ntf.reset_default_graph()\ng = tf.Graph()\n\nwith tf.Session(graph=g) as sess:\n    with g.as_default():\n        tf.import_graph_def(\n        graph_def=trt_graph_def,\n        name='')\n    graph_io.write_graph(g, '.', 'trt_jce_fp32_b6000.pb', as_text=False)\n\n</code></pre>\n<h3>conversion Error and Warning</h3>\n<pre><code>2018-10-30 18:17:36.761273: E tensorflow/contrib/tensorrt/convert/convert_graph.cc:418] Can't find a device placement for the op!\n2018-10-30 18:17:36.768941: E tensorflow/contrib/tensorrt/convert/convert_graph.cc:418] Can't find a device placement for the op!\n2018-10-30 18:17:36.770592: E tensorflow/contrib/tensorrt/convert/convert_graph.cc:418] Can't find a device placement for the op!\n2018-10-30 18:18:30.236226: W tensorflow/contrib/tensorrt/convert/trt_optimization_pass.cc:185] TensorRTOptimizer is probably called on funcdef! This optimizer must *NOT* be called on function objects.\n2018-10-30 18:18:30.251184: W tensorflow/contrib/tensorrt/convert/trt_optimization_pass.cc:185] TensorRTOptimizer is probably called on funcdef! This optimizer must *NOT* be called on function objects.\n2018-10-30 18:18:30.271306: W tensorflow/contrib/tensorrt/convert/trt_optimization_pass.cc:185] TensorRTOptimizer is probably called on funcdef! This optimizer must *NOT* be called on function objects.\n2018-10-30 18:18:30.276792: W tensorflow/contrib/tensorrt/convert/trt_optimization_pass.cc:185] TensorRTOptimizer is probably called on funcdef! This optimizer must *NOT* be called on function objects.\n2018-10-30 18:18:30.292489: W tensorflow/contrib/tensorrt/convert/trt_optimization_pass.cc:185] TensorRTOptimizer is probably called on funcdef! This optimizer must *NOT* be called on function objects.\n2018-10-30 18:18:30.297720: W tensorflow/contrib/tensorrt/convert/trt_optimization_pass.cc:185] TensorRTOptimizer is probably called on funcdef! This optimizer must *NOT* be called on function objects.\n\n### c++ source code\n</code></pre>\n<div class=\"highlight highlight-source-c++\"><pre><span class=\"pl-c1\">184</span>   <span class=\"pl-k\">if</span> (item.id != <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>tf_graph<span class=\"pl-pds\">\"</span></span>) {\n<span class=\"pl-c1\">185</span>     <span class=\"pl-smi\">LOG</span>(WARNING) &lt;&lt; name_\n<span class=\"pl-c1\">186</span>                  &lt;&lt; <span class=\"pl-s\"><span class=\"pl-pds\">\"</span> is probably called on funcdef! This optimizer must *NOT* <span class=\"pl-pds\">\"</span></span>\n<span class=\"pl-c1\">187</span>                     <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>be called on function objects.<span class=\"pl-pds\">\"</span></span>;\n<span class=\"pl-c1\">188</span>     *optimized_graph = item.<span class=\"pl-smi\">graph</span>;\n<span class=\"pl-c1\">189</span>     <span class=\"pl-k\">return</span> <span class=\"pl-c1\">tensorflow::Status::OK</span>();\n<span class=\"pl-c1\">190</span>   }\n</pre></div>", "body_text": "@samikama\nadd more info.\nmy scripts\ngraph_pb = './freezed_jce.pb'\n\ngraph_def=tf.GraphDef()\nwith tf.gfile.GFile(graph_pb, \"rb\") as f:\n    graph_def.ParseFromString(f.read())\n\ngpu_options=tf.GPUOptions(per_process_gpu_memory_fraction=0.4)\n\ntrt_graph_def=trt.create_inference_graph(\n        input_graph_def = graph_def,\n        outputs = [\"final_score\"],\n        max_batch_size = 6000,\n        max_workspace_size_bytes=1<<32,\n        precision_mode = \"FP32\"\n        )   \n\ntf.reset_default_graph()\ng = tf.Graph()\n\nwith tf.Session(graph=g) as sess:\n    with g.as_default():\n        tf.import_graph_def(\n        graph_def=trt_graph_def,\n        name='')\n    graph_io.write_graph(g, '.', 'trt_jce_fp32_b6000.pb', as_text=False)\n\n\nconversion Error and Warning\n2018-10-30 18:17:36.761273: E tensorflow/contrib/tensorrt/convert/convert_graph.cc:418] Can't find a device placement for the op!\n2018-10-30 18:17:36.768941: E tensorflow/contrib/tensorrt/convert/convert_graph.cc:418] Can't find a device placement for the op!\n2018-10-30 18:17:36.770592: E tensorflow/contrib/tensorrt/convert/convert_graph.cc:418] Can't find a device placement for the op!\n2018-10-30 18:18:30.236226: W tensorflow/contrib/tensorrt/convert/trt_optimization_pass.cc:185] TensorRTOptimizer is probably called on funcdef! This optimizer must *NOT* be called on function objects.\n2018-10-30 18:18:30.251184: W tensorflow/contrib/tensorrt/convert/trt_optimization_pass.cc:185] TensorRTOptimizer is probably called on funcdef! This optimizer must *NOT* be called on function objects.\n2018-10-30 18:18:30.271306: W tensorflow/contrib/tensorrt/convert/trt_optimization_pass.cc:185] TensorRTOptimizer is probably called on funcdef! This optimizer must *NOT* be called on function objects.\n2018-10-30 18:18:30.276792: W tensorflow/contrib/tensorrt/convert/trt_optimization_pass.cc:185] TensorRTOptimizer is probably called on funcdef! This optimizer must *NOT* be called on function objects.\n2018-10-30 18:18:30.292489: W tensorflow/contrib/tensorrt/convert/trt_optimization_pass.cc:185] TensorRTOptimizer is probably called on funcdef! This optimizer must *NOT* be called on function objects.\n2018-10-30 18:18:30.297720: W tensorflow/contrib/tensorrt/convert/trt_optimization_pass.cc:185] TensorRTOptimizer is probably called on funcdef! This optimizer must *NOT* be called on function objects.\n\n### c++ source code\n\n184   if (item.id != \"tf_graph\") {\n185     LOG(WARNING) << name_\n186                  << \" is probably called on funcdef! This optimizer must *NOT* \"\n187                     \"be called on function objects.\";\n188     *optimized_graph = item.graph;\n189     return tensorflow::Status::OK();\n190   }", "body": "@samikama \r\nadd more info.\r\n\r\n### my scripts\r\n```\r\ngraph_pb = './freezed_jce.pb'\r\n\r\ngraph_def=tf.GraphDef()\r\nwith tf.gfile.GFile(graph_pb, \"rb\") as f:\r\n    graph_def.ParseFromString(f.read())\r\n\r\ngpu_options=tf.GPUOptions(per_process_gpu_memory_fraction=0.4)\r\n\r\ntrt_graph_def=trt.create_inference_graph(\r\n        input_graph_def = graph_def,\r\n        outputs = [\"final_score\"],\r\n        max_batch_size = 6000,\r\n        max_workspace_size_bytes=1<<32,\r\n        precision_mode = \"FP32\"\r\n        )   \r\n\r\ntf.reset_default_graph()\r\ng = tf.Graph()\r\n\r\nwith tf.Session(graph=g) as sess:\r\n    with g.as_default():\r\n        tf.import_graph_def(\r\n        graph_def=trt_graph_def,\r\n        name='')\r\n    graph_io.write_graph(g, '.', 'trt_jce_fp32_b6000.pb', as_text=False)\r\n\r\n```\r\n### conversion Error and Warning\r\n```\r\n2018-10-30 18:17:36.761273: E tensorflow/contrib/tensorrt/convert/convert_graph.cc:418] Can't find a device placement for the op!\r\n2018-10-30 18:17:36.768941: E tensorflow/contrib/tensorrt/convert/convert_graph.cc:418] Can't find a device placement for the op!\r\n2018-10-30 18:17:36.770592: E tensorflow/contrib/tensorrt/convert/convert_graph.cc:418] Can't find a device placement for the op!\r\n2018-10-30 18:18:30.236226: W tensorflow/contrib/tensorrt/convert/trt_optimization_pass.cc:185] TensorRTOptimizer is probably called on funcdef! This optimizer must *NOT* be called on function objects.\r\n2018-10-30 18:18:30.251184: W tensorflow/contrib/tensorrt/convert/trt_optimization_pass.cc:185] TensorRTOptimizer is probably called on funcdef! This optimizer must *NOT* be called on function objects.\r\n2018-10-30 18:18:30.271306: W tensorflow/contrib/tensorrt/convert/trt_optimization_pass.cc:185] TensorRTOptimizer is probably called on funcdef! This optimizer must *NOT* be called on function objects.\r\n2018-10-30 18:18:30.276792: W tensorflow/contrib/tensorrt/convert/trt_optimization_pass.cc:185] TensorRTOptimizer is probably called on funcdef! This optimizer must *NOT* be called on function objects.\r\n2018-10-30 18:18:30.292489: W tensorflow/contrib/tensorrt/convert/trt_optimization_pass.cc:185] TensorRTOptimizer is probably called on funcdef! This optimizer must *NOT* be called on function objects.\r\n2018-10-30 18:18:30.297720: W tensorflow/contrib/tensorrt/convert/trt_optimization_pass.cc:185] TensorRTOptimizer is probably called on funcdef! This optimizer must *NOT* be called on function objects.\r\n\r\n### c++ source code\r\n```\r\n```c++\r\n184   if (item.id != \"tf_graph\") {\r\n185     LOG(WARNING) << name_\r\n186                  << \" is probably called on funcdef! This optimizer must *NOT* \"\r\n187                     \"be called on function objects.\";\r\n188     *optimized_graph = item.graph;\r\n189     return tensorflow::Status::OK();\r\n190   }\r\n\r\n```"}