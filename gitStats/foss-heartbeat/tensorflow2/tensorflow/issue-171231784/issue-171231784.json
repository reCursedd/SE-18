{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3824", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3824/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3824/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3824/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/3824", "id": 171231784, "node_id": "MDU6SXNzdWUxNzEyMzE3ODQ=", "number": 3824, "title": "Unclear documentation and behavior for sampler in Tensorflow", "user": {"login": "ylongqi", "id": 5272504, "node_id": "MDQ6VXNlcjUyNzI1MDQ=", "avatar_url": "https://avatars3.githubusercontent.com/u/5272504?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ylongqi", "html_url": "https://github.com/ylongqi", "followers_url": "https://api.github.com/users/ylongqi/followers", "following_url": "https://api.github.com/users/ylongqi/following{/other_user}", "gists_url": "https://api.github.com/users/ylongqi/gists{/gist_id}", "starred_url": "https://api.github.com/users/ylongqi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ylongqi/subscriptions", "organizations_url": "https://api.github.com/users/ylongqi/orgs", "repos_url": "https://api.github.com/users/ylongqi/repos", "events_url": "https://api.github.com/users/ylongqi/events{/privacy}", "received_events_url": "https://api.github.com/users/ylongqi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 284443156, "node_id": "MDU6TGFiZWwyODQ0NDMxNTY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:docs", "name": "type:docs", "color": "159b2e", "default": false}, {"id": 473173272, "node_id": "MDU6TGFiZWw0NzMxNzMyNzI=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:feature", "name": "type:feature", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "dr4b", "id": 5649718, "node_id": "MDQ6VXNlcjU2NDk3MTg=", "avatar_url": "https://avatars3.githubusercontent.com/u/5649718?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dr4b", "html_url": "https://github.com/dr4b", "followers_url": "https://api.github.com/users/dr4b/followers", "following_url": "https://api.github.com/users/dr4b/following{/other_user}", "gists_url": "https://api.github.com/users/dr4b/gists{/gist_id}", "starred_url": "https://api.github.com/users/dr4b/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dr4b/subscriptions", "organizations_url": "https://api.github.com/users/dr4b/orgs", "repos_url": "https://api.github.com/users/dr4b/repos", "events_url": "https://api.github.com/users/dr4b/events{/privacy}", "received_events_url": "https://api.github.com/users/dr4b/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "dr4b", "id": 5649718, "node_id": "MDQ6VXNlcjU2NDk3MTg=", "avatar_url": "https://avatars3.githubusercontent.com/u/5649718?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dr4b", "html_url": "https://github.com/dr4b", "followers_url": "https://api.github.com/users/dr4b/followers", "following_url": "https://api.github.com/users/dr4b/following{/other_user}", "gists_url": "https://api.github.com/users/dr4b/gists{/gist_id}", "starred_url": "https://api.github.com/users/dr4b/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dr4b/subscriptions", "organizations_url": "https://api.github.com/users/dr4b/orgs", "repos_url": "https://api.github.com/users/dr4b/repos", "events_url": "https://api.github.com/users/dr4b/events{/privacy}", "received_events_url": "https://api.github.com/users/dr4b/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2016-08-15T18:34:24Z", "updated_at": "2017-08-07T13:17:51Z", "closed_at": "2017-05-01T16:22:27Z", "author_association": "CONTRIBUTOR", "body_html": "<p>For the samplers implemented in tensorflow, e.g. tf.nn.fixed_unigram_candidate_sampler. The behavior is not well-defined in the document. For instance, I would expect the labels specified in true_classes will be excluded from the sampling pool, and the sampling will be conducted for each batch. But according to my experiments, neither of above is true.</p>\n<p>Consider the following code:</p>\n<p>`import tensorflow as tf</p>\n<p>labels_matrix = tf.reshape(tf.constant([1, 2, 3, 4], dtype=tf.int64), [-1, 1])</p>\n<p>sampled_ids, _, _ = tf.nn.fixed_unigram_candidate_sampler(<br>\ntrue_classes = labels_matrix,<br>\nnum_true = 1,<br>\nnum_sampled = 1,<br>\nunique = True,<br>\nrange_max = 5,<br>\ndistortion = 0.0,<br>\nunigrams = range(5)<br>\n)</p>\n<p>init = tf.initialize_all_variables()<br>\nwith tf.Session() as sess:<br>\nsess.run(init)<br>\nprint sess.run([sampled_ids])<br>\n`</p>\n<p>The output can be 3, which actually belongs to the set of true classes. - Also, the output has the dimension [1], which basically means that the sampling is only conducted once, not for each batch.</p>\n<p>Can someone help to clarify this?</p>", "body_text": "For the samplers implemented in tensorflow, e.g. tf.nn.fixed_unigram_candidate_sampler. The behavior is not well-defined in the document. For instance, I would expect the labels specified in true_classes will be excluded from the sampling pool, and the sampling will be conducted for each batch. But according to my experiments, neither of above is true.\nConsider the following code:\n`import tensorflow as tf\nlabels_matrix = tf.reshape(tf.constant([1, 2, 3, 4], dtype=tf.int64), [-1, 1])\nsampled_ids, _, _ = tf.nn.fixed_unigram_candidate_sampler(\ntrue_classes = labels_matrix,\nnum_true = 1,\nnum_sampled = 1,\nunique = True,\nrange_max = 5,\ndistortion = 0.0,\nunigrams = range(5)\n)\ninit = tf.initialize_all_variables()\nwith tf.Session() as sess:\nsess.run(init)\nprint sess.run([sampled_ids])\n`\nThe output can be 3, which actually belongs to the set of true classes. - Also, the output has the dimension [1], which basically means that the sampling is only conducted once, not for each batch.\nCan someone help to clarify this?", "body": "For the samplers implemented in tensorflow, e.g. tf.nn.fixed_unigram_candidate_sampler. The behavior is not well-defined in the document. For instance, I would expect the labels specified in true_classes will be excluded from the sampling pool, and the sampling will be conducted for each batch. But according to my experiments, neither of above is true.\n\nConsider the following code:\n\n`import tensorflow as tf\n\nlabels_matrix = tf.reshape(tf.constant([1, 2, 3, 4], dtype=tf.int64), [-1, 1])\n\nsampled_ids, _, _ = tf.nn.fixed_unigram_candidate_sampler(\n    true_classes = labels_matrix,\n    num_true = 1,\n    num_sampled = 1,\n    unique = True,\n    range_max = 5,\n    distortion = 0.0,\n    unigrams = range(5)\n)\n\ninit = tf.initialize_all_variables()\nwith tf.Session() as sess:\n    sess.run(init)\n    print sess.run([sampled_ids])\n`\n\nThe output can be 3, which actually belongs to the set of true classes. - Also, the output has the dimension [1], which basically means that the sampling is only conducted once, not for each batch.\n\nCan someone help to clarify this?\n"}