{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10130", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10130/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10130/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10130/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/10130", "id": 230627413, "node_id": "MDU6SXNzdWUyMzA2Mjc0MTM=", "number": 10130, "title": "tf.contrib.data: No op named OneShotIterator in defined operations", "user": {"login": "EdeMeijer", "id": 5758565, "node_id": "MDQ6VXNlcjU3NTg1NjU=", "avatar_url": "https://avatars0.githubusercontent.com/u/5758565?v=4", "gravatar_id": "", "url": "https://api.github.com/users/EdeMeijer", "html_url": "https://github.com/EdeMeijer", "followers_url": "https://api.github.com/users/EdeMeijer/followers", "following_url": "https://api.github.com/users/EdeMeijer/following{/other_user}", "gists_url": "https://api.github.com/users/EdeMeijer/gists{/gist_id}", "starred_url": "https://api.github.com/users/EdeMeijer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/EdeMeijer/subscriptions", "organizations_url": "https://api.github.com/users/EdeMeijer/orgs", "repos_url": "https://api.github.com/users/EdeMeijer/repos", "events_url": "https://api.github.com/users/EdeMeijer/events{/privacy}", "received_events_url": "https://api.github.com/users/EdeMeijer/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2017-05-23T08:29:04Z", "updated_at": "2017-10-29T16:55:58Z", "closed_at": "2017-05-24T05:27:02Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: Yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Ubuntu 16.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary (nightly build from May 23rd)</li>\n<li><strong>TensorFlow version (use command below)</strong>: v1.2.0-rc0-172-g9e25de3</li>\n<li><strong>Bazel version (if compiling from source)</strong>: N/A</li>\n<li><strong>CUDA/cuDNN version</strong>: N/A</li>\n<li><strong>GPU model and memory</strong>: N/A</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<pre><code>python3 save.py\npython3 load.py\n</code></pre>\n<h3>Describe the problem</h3>\n<p>I'm playing around with the new <code>tf.contrib.data</code> stuff because it looks awesome and can make a lot of my code a lot simpler. However, I'm trying to save and restore a graph that contains these new ops. Saving works fine, but loading doesn't work. If I inspect the saved file, it seems to be serializing everything correctly, I recognize the structure of all the data set ops I added in the code so that seems fine. In the case of the below example, I'm getting an error <code>No op named OneShotIterator in defined operations</code> when trying to load the graph again.</p>\n<h3>Source code / logs</h3>\n<p>save.py</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\ndataset <span class=\"pl-k\">=</span> tf.contrib.data.Dataset.range(<span class=\"pl-c1\">10</span>)\ndataset <span class=\"pl-k\">=</span> dataset.map(<span class=\"pl-k\">lambda</span> <span class=\"pl-smi\">x</span>: x <span class=\"pl-k\">+</span> <span class=\"pl-c1\">2</span>)\nbatched_dataset <span class=\"pl-k\">=</span> dataset.batch(<span class=\"pl-c1\">4</span>)\n\niterator <span class=\"pl-k\">=</span> batched_dataset.make_one_shot_iterator()\nnext_element <span class=\"pl-k\">=</span> iterator.get_next()\n\ntf.add_to_collection(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>next<span class=\"pl-pds\">'</span></span>, next_element)\ntf.train.export_meta_graph(<span class=\"pl-v\">filename</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>graph<span class=\"pl-pds\">'</span></span>, <span class=\"pl-v\">as_text</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>)</pre></div>\n<p>load.py</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\ntf.train.import_meta_graph(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>graph<span class=\"pl-pds\">'</span></span>)\nnext_element <span class=\"pl-k\">=</span> tf.get_collection(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>next<span class=\"pl-pds\">'</span></span>)[<span class=\"pl-c1\">0</span>]\n\nsess <span class=\"pl-k\">=</span> tf.Session()\n\n<span class=\"pl-c1\">print</span>(sess.run(next_element))</pre></div>\n<p>load.py output</p>\n<pre><code>Traceback (most recent call last):\n  File \"/home/ede/test/load.py\", line 3, in &lt;module&gt;\n    tf.train.import_meta_graph('graph')\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/training/saver.py\", line 1683, in import_meta_graph\n    **kwargs)\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/meta_graph.py\", line 504, in import_scoped_meta_graph\n    producer_op_list=producer_op_list)\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/importer.py\", line 283, in import_graph_def\n    raise ValueError('No op named %s in defined operations.' % node.op)\nValueError: No op named OneShotIterator in defined operations.\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Ubuntu 16.04\nTensorFlow installed from (source or binary): binary (nightly build from May 23rd)\nTensorFlow version (use command below): v1.2.0-rc0-172-g9e25de3\nBazel version (if compiling from source): N/A\nCUDA/cuDNN version: N/A\nGPU model and memory: N/A\nExact command to reproduce:\n\npython3 save.py\npython3 load.py\n\nDescribe the problem\nI'm playing around with the new tf.contrib.data stuff because it looks awesome and can make a lot of my code a lot simpler. However, I'm trying to save and restore a graph that contains these new ops. Saving works fine, but loading doesn't work. If I inspect the saved file, it seems to be serializing everything correctly, I recognize the structure of all the data set ops I added in the code so that seems fine. In the case of the below example, I'm getting an error No op named OneShotIterator in defined operations when trying to load the graph again.\nSource code / logs\nsave.py\nimport tensorflow as tf\n\ndataset = tf.contrib.data.Dataset.range(10)\ndataset = dataset.map(lambda x: x + 2)\nbatched_dataset = dataset.batch(4)\n\niterator = batched_dataset.make_one_shot_iterator()\nnext_element = iterator.get_next()\n\ntf.add_to_collection('next', next_element)\ntf.train.export_meta_graph(filename='graph', as_text=True)\nload.py\nimport tensorflow as tf\n\ntf.train.import_meta_graph('graph')\nnext_element = tf.get_collection('next')[0]\n\nsess = tf.Session()\n\nprint(sess.run(next_element))\nload.py output\nTraceback (most recent call last):\n  File \"/home/ede/test/load.py\", line 3, in <module>\n    tf.train.import_meta_graph('graph')\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/training/saver.py\", line 1683, in import_meta_graph\n    **kwargs)\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/meta_graph.py\", line 504, in import_scoped_meta_graph\n    producer_op_list=producer_op_list)\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/importer.py\", line 283, in import_graph_def\n    raise ValueError('No op named %s in defined operations.' % node.op)\nValueError: No op named OneShotIterator in defined operations.", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: Yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Ubuntu 16.04\r\n- **TensorFlow installed from (source or binary)**: binary (nightly build from May 23rd)\r\n- **TensorFlow version (use command below)**: v1.2.0-rc0-172-g9e25de3\r\n- **Bazel version (if compiling from source)**: N/A\r\n- **CUDA/cuDNN version**: N/A\r\n- **GPU model and memory**: N/A\r\n- **Exact command to reproduce**:\r\n\r\n```\r\npython3 save.py\r\npython3 load.py\r\n```\r\n\r\n### Describe the problem\r\nI'm playing around with the new `tf.contrib.data` stuff because it looks awesome and can make a lot of my code a lot simpler. However, I'm trying to save and restore a graph that contains these new ops. Saving works fine, but loading doesn't work. If I inspect the saved file, it seems to be serializing everything correctly, I recognize the structure of all the data set ops I added in the code so that seems fine. In the case of the below example, I'm getting an error `No op named OneShotIterator in defined operations` when trying to load the graph again.\r\n\r\n### Source code / logs\r\nsave.py\r\n```python\r\nimport tensorflow as tf\r\n\r\ndataset = tf.contrib.data.Dataset.range(10)\r\ndataset = dataset.map(lambda x: x + 2)\r\nbatched_dataset = dataset.batch(4)\r\n\r\niterator = batched_dataset.make_one_shot_iterator()\r\nnext_element = iterator.get_next()\r\n\r\ntf.add_to_collection('next', next_element)\r\ntf.train.export_meta_graph(filename='graph', as_text=True)\r\n```\r\nload.py\r\n```python\r\nimport tensorflow as tf\r\n\r\ntf.train.import_meta_graph('graph')\r\nnext_element = tf.get_collection('next')[0]\r\n\r\nsess = tf.Session()\r\n\r\nprint(sess.run(next_element))\r\n```\r\n\r\nload.py output\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/ede/test/load.py\", line 3, in <module>\r\n    tf.train.import_meta_graph('graph')\r\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/training/saver.py\", line 1683, in import_meta_graph\r\n    **kwargs)\r\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/meta_graph.py\", line 504, in import_scoped_meta_graph\r\n    producer_op_list=producer_op_list)\r\n  File \"/home/ede/tensorflow/lib/python3.5/site-packages/tensorflow/python/framework/importer.py\", line 283, in import_graph_def\r\n    raise ValueError('No op named %s in defined operations.' % node.op)\r\nValueError: No op named OneShotIterator in defined operations.\r\n```"}