{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/314515057", "html_url": "https://github.com/tensorflow/tensorflow/issues/10766#issuecomment-314515057", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10766", "id": 314515057, "node_id": "MDEyOklzc3VlQ29tbWVudDMxNDUxNTA1Nw==", "user": {"login": "pascalxia", "id": 7058606, "node_id": "MDQ6VXNlcjcwNTg2MDY=", "avatar_url": "https://avatars0.githubusercontent.com/u/7058606?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pascalxia", "html_url": "https://github.com/pascalxia", "followers_url": "https://api.github.com/users/pascalxia/followers", "following_url": "https://api.github.com/users/pascalxia/following{/other_user}", "gists_url": "https://api.github.com/users/pascalxia/gists{/gist_id}", "starred_url": "https://api.github.com/users/pascalxia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pascalxia/subscriptions", "organizations_url": "https://api.github.com/users/pascalxia/orgs", "repos_url": "https://api.github.com/users/pascalxia/repos", "events_url": "https://api.github.com/users/pascalxia/events{/privacy}", "received_events_url": "https://api.github.com/users/pascalxia/received_events", "type": "User", "site_admin": false}, "created_at": "2017-07-11T17:26:51Z", "updated_at": "2017-07-11T17:28:10Z", "author_association": "NONE", "body_html": "<p>I upgraded my Tensorflow to v1.2.1. But I am still facing the same error message when I am trying to train a model to learn an appropriate sigma value for the Gaussian filter. Am I doing something wrong? My system is Win10. I installed Tensorflow through Anaonda. Here is my code.</p>\n<pre><code>import tensorflow as tf\nimport tensorflow.contrib.distributions as ds\nimport numpy as np\nimport scipy.ndimage.filters as filters\n\n\n#set parameters-------------------\nIMAGE_SIZE = (576, 1024)\nKERNEL_SIZE = 3\n\n#build graph--------------\nimage = tf.placeholder(tf.float32, shape=(None,)+IMAGE_SIZE+(1,))\nlabel = tf.placeholder(tf.float32, shape=(None,)+IMAGE_SIZE+(1,))\nsigma = tf.Variable(tf.ones(1))\n\nxinds, yinds = np.unravel_index(range(KERNEL_SIZE*KERNEL_SIZE),                                 (KERNEL_SIZE, KERNEL_SIZE))\ninds = (np.column_stack((xinds,yinds))-\n                    [(KERNEL_SIZE-1)/2, (KERNEL_SIZE-1)/2]).astype(np.float32)\ninds = tf.constant(inds)\nloc = tf.zeros(2)\nscale_diag = tf.multiply(sigma, tf.ones([2,]))\n\nmvn = ds.MultivariateNormalDiag(\n    loc=loc,\n    scale_diag=scale_diag)\n\nkernel = mvn.prob(inds)\nkernel = tf.reshape(kernel, (KERNEL_SIZE, KERNEL_SIZE, 1, 1))\n\n\nx = tf.nn.conv2d(image, kernel, strides=[1,1,1,1], padding='SAME')\nloss = tf.nn.l2_loss(tf.subtract(x, label))\n\ntrain_op = tf.train.AdamOptimizer().minimize(loss)\n\nsess = tf.Session()\nsess.run(tf.global_variables_initializer())\n#start training-------------------------\nstimulus = np.zeros(IMAGE_SIZE)\nstimulus[300, 500] = 1\ntest_sigma = (30,30)\nfiltered = filters.gaussian_filter(stimulus, test_sigma)\nfeed_dict = {image: np.expand_dims(np.expand_dims(stimulus, 0), 3), \n                 label: np.expand_dims(np.expand_dims(filtered, 0), 3)}\nsess.run(train_op, feed_dict=feed_dict)\n</code></pre>\n<p>Here are the error messages.</p>\n<pre><code>InvalidArgumentError: indices[0] = -1 is not in [0, 2)\n\t [[Node: gradients/MultivariateNormalDiag_3/prob/Prod_grad/Gather = Gather[Tindices=DT_INT32, Tparams=DT_INT32, validate_indices=true, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](gradients/MultivariateNormalDiag_3/prob/Prod_grad/Shape, gradients/MultivariateNormalDiag_3/prob/Prod_grad/Reshape)]]\n\nCaused by op 'gradients/MultivariateNormalDiag_3/prob/Prod_grad/Gather', defined at:\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\spyder\\utils\\ipython\\start_kernel.py\", line 231, in &lt;module&gt;\n    main()\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\spyder\\utils\\ipython\\start_kernel.py\", line 227, in main\n    kernel.start()\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\kernelapp.py\", line 477, in start\n    ioloop.IOLoop.instance().start()\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\zmq\\eventloop\\ioloop.py\", line 177, in start\n    super(ZMQIOLoop, self).start()\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tornado\\ioloop.py\", line 832, in start\n    self._run_callback(self._callbacks.popleft())\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tornado\\ioloop.py\", line 605, in _run_callback\n    ret = callback()\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tornado\\stack_context.py\", line 277, in null_wrapper\n    return fn(*args, **kwargs)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\kernelbase.py\", line 265, in enter_eventloop\n    self.eventloop(self)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\eventloops.py\", line 106, in loop_qt5\n    return loop_qt4(kernel)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\eventloops.py\", line 99, in loop_qt4\n    _loop_qt(kernel.app)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\eventloops.py\", line 83, in _loop_qt\n    app.exec_()\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\eventloops.py\", line 39, in process_stream_events\n    kernel.do_one_iteration()\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\kernelbase.py\", line 298, in do_one_iteration\n    stream.flush(zmq.POLLIN, 1)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\zmq\\eventloop\\zmqstream.py\", line 352, in flush\n    self._handle_recv()\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\zmq\\eventloop\\zmqstream.py\", line 472, in _handle_recv\n    self._run_callback(callback, msg)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\zmq\\eventloop\\zmqstream.py\", line 414, in _run_callback\n    callback(*args, **kwargs)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tornado\\stack_context.py\", line 277, in null_wrapper\n    return fn(*args, **kwargs)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\kernelbase.py\", line 283, in dispatcher\n    return self.dispatch_shell(stream, msg)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\kernelbase.py\", line 235, in dispatch_shell\n    handler(stream, idents, msg)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\kernelbase.py\", line 399, in execute_request\n    user_expressions, allow_stdin)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\ipkernel.py\", line 196, in do_execute\n    res = shell.run_cell(code, store_history=store_history, silent=silent)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\zmqshell.py\", line 533, in run_cell\n    return super(ZMQInteractiveShell, self).run_cell(*args, **kwargs)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\IPython\\core\\interactiveshell.py\", line 2698, in run_cell\n    interactivity=interactivity, compiler=compiler, result=result)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\IPython\\core\\interactiveshell.py\", line 2802, in run_ast_nodes\n    if self.run_code(code, result):\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\IPython\\core\\interactiveshell.py\", line 2862, in run_code\n    exec(code_obj, self.user_global_ns, self.user_ns)\n  File \"&lt;ipython-input-7-de90f1cd6d46&gt;\", line 40, in &lt;module&gt;\n    train_op = tf.train.AdamOptimizer().minimize(loss)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\training\\optimizer.py\", line 315, in minimize\n    grad_loss=grad_loss)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\training\\optimizer.py\", line 386, in compute_gradients\n    colocate_gradients_with_ops=colocate_gradients_with_ops)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 540, in gradients\n    grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 346, in _MaybeCompile\n    return grad_fn()  # Exit early\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 540, in &lt;lambda&gt;\n    grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\math_grad.py\", line 129, in _ProdGrad\n    reduced_num = math_ops.reduce_prod(array_ops.gather(input_shape, reduced))\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\gen_array_ops.py\", line 1179, in gather\n    validate_indices=validate_indices, name=name)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 767, in apply_op\n    op_def=op_def)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 2506, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1269, in __init__\n    self._traceback = _extract_stack()\n\n...which was originally created as op 'MultivariateNormalDiag_3/prob/Prod', defined at:\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\spyder\\utils\\ipython\\start_kernel.py\", line 231, in &lt;module&gt;\n    main()\n[elided 23 identical lines from previous traceback]\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\IPython\\core\\interactiveshell.py\", line 2862, in run_code\n    exec(code_obj, self.user_global_ns, self.user_ns)\n  File \"&lt;ipython-input-7-de90f1cd6d46&gt;\", line 33, in &lt;module&gt;\n    kernel = mvn.prob(inds)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\distribution.py\", line 712, in prob\n    return self._call_prob(value, name)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\distribution.py\", line 694, in _call_prob\n    return self._prob(value, **kwargs)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\util.py\", line 688, in _fn\n    return fn(*args, **kwargs)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\contrib\\distributions\\python\\ops\\mvn_linear_operator.py\", line 216, in _prob\n    return super(MultivariateNormalLinearOperator, self)._prob(x)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\transformed_distribution.py\", line 406, in _prob\n    prob = math_ops.reduce_prod(prob, self._reduce_event_indices)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 1392, in reduce_prod\n    name=name)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\gen_math_ops.py\", line 1488, in _prod\n    keep_dims=keep_dims, name=name)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 767, in apply_op\n    op_def=op_def)\n\nInvalidArgumentError (see above for traceback): indices[0] = -1 is not in [0, 2)\n\t [[Node: gradients/MultivariateNormalDiag_3/prob/Prod_grad/Gather = Gather[Tindices=DT_INT32, Tparams=DT_INT32, validate_indices=true, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](gradients/MultivariateNormalDiag_3/prob/Prod_grad/Shape, gradients/MultivariateNormalDiag_3/prob/Prod_grad/Reshape)]]\n</code></pre>", "body_text": "I upgraded my Tensorflow to v1.2.1. But I am still facing the same error message when I am trying to train a model to learn an appropriate sigma value for the Gaussian filter. Am I doing something wrong? My system is Win10. I installed Tensorflow through Anaonda. Here is my code.\nimport tensorflow as tf\nimport tensorflow.contrib.distributions as ds\nimport numpy as np\nimport scipy.ndimage.filters as filters\n\n\n#set parameters-------------------\nIMAGE_SIZE = (576, 1024)\nKERNEL_SIZE = 3\n\n#build graph--------------\nimage = tf.placeholder(tf.float32, shape=(None,)+IMAGE_SIZE+(1,))\nlabel = tf.placeholder(tf.float32, shape=(None,)+IMAGE_SIZE+(1,))\nsigma = tf.Variable(tf.ones(1))\n\nxinds, yinds = np.unravel_index(range(KERNEL_SIZE*KERNEL_SIZE),                                 (KERNEL_SIZE, KERNEL_SIZE))\ninds = (np.column_stack((xinds,yinds))-\n                    [(KERNEL_SIZE-1)/2, (KERNEL_SIZE-1)/2]).astype(np.float32)\ninds = tf.constant(inds)\nloc = tf.zeros(2)\nscale_diag = tf.multiply(sigma, tf.ones([2,]))\n\nmvn = ds.MultivariateNormalDiag(\n    loc=loc,\n    scale_diag=scale_diag)\n\nkernel = mvn.prob(inds)\nkernel = tf.reshape(kernel, (KERNEL_SIZE, KERNEL_SIZE, 1, 1))\n\n\nx = tf.nn.conv2d(image, kernel, strides=[1,1,1,1], padding='SAME')\nloss = tf.nn.l2_loss(tf.subtract(x, label))\n\ntrain_op = tf.train.AdamOptimizer().minimize(loss)\n\nsess = tf.Session()\nsess.run(tf.global_variables_initializer())\n#start training-------------------------\nstimulus = np.zeros(IMAGE_SIZE)\nstimulus[300, 500] = 1\ntest_sigma = (30,30)\nfiltered = filters.gaussian_filter(stimulus, test_sigma)\nfeed_dict = {image: np.expand_dims(np.expand_dims(stimulus, 0), 3), \n                 label: np.expand_dims(np.expand_dims(filtered, 0), 3)}\nsess.run(train_op, feed_dict=feed_dict)\n\nHere are the error messages.\nInvalidArgumentError: indices[0] = -1 is not in [0, 2)\n\t [[Node: gradients/MultivariateNormalDiag_3/prob/Prod_grad/Gather = Gather[Tindices=DT_INT32, Tparams=DT_INT32, validate_indices=true, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](gradients/MultivariateNormalDiag_3/prob/Prod_grad/Shape, gradients/MultivariateNormalDiag_3/prob/Prod_grad/Reshape)]]\n\nCaused by op 'gradients/MultivariateNormalDiag_3/prob/Prod_grad/Gather', defined at:\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\spyder\\utils\\ipython\\start_kernel.py\", line 231, in <module>\n    main()\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\spyder\\utils\\ipython\\start_kernel.py\", line 227, in main\n    kernel.start()\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\kernelapp.py\", line 477, in start\n    ioloop.IOLoop.instance().start()\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\zmq\\eventloop\\ioloop.py\", line 177, in start\n    super(ZMQIOLoop, self).start()\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tornado\\ioloop.py\", line 832, in start\n    self._run_callback(self._callbacks.popleft())\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tornado\\ioloop.py\", line 605, in _run_callback\n    ret = callback()\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tornado\\stack_context.py\", line 277, in null_wrapper\n    return fn(*args, **kwargs)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\kernelbase.py\", line 265, in enter_eventloop\n    self.eventloop(self)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\eventloops.py\", line 106, in loop_qt5\n    return loop_qt4(kernel)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\eventloops.py\", line 99, in loop_qt4\n    _loop_qt(kernel.app)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\eventloops.py\", line 83, in _loop_qt\n    app.exec_()\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\eventloops.py\", line 39, in process_stream_events\n    kernel.do_one_iteration()\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\kernelbase.py\", line 298, in do_one_iteration\n    stream.flush(zmq.POLLIN, 1)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\zmq\\eventloop\\zmqstream.py\", line 352, in flush\n    self._handle_recv()\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\zmq\\eventloop\\zmqstream.py\", line 472, in _handle_recv\n    self._run_callback(callback, msg)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\zmq\\eventloop\\zmqstream.py\", line 414, in _run_callback\n    callback(*args, **kwargs)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tornado\\stack_context.py\", line 277, in null_wrapper\n    return fn(*args, **kwargs)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\kernelbase.py\", line 283, in dispatcher\n    return self.dispatch_shell(stream, msg)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\kernelbase.py\", line 235, in dispatch_shell\n    handler(stream, idents, msg)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\kernelbase.py\", line 399, in execute_request\n    user_expressions, allow_stdin)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\ipkernel.py\", line 196, in do_execute\n    res = shell.run_cell(code, store_history=store_history, silent=silent)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\zmqshell.py\", line 533, in run_cell\n    return super(ZMQInteractiveShell, self).run_cell(*args, **kwargs)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\IPython\\core\\interactiveshell.py\", line 2698, in run_cell\n    interactivity=interactivity, compiler=compiler, result=result)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\IPython\\core\\interactiveshell.py\", line 2802, in run_ast_nodes\n    if self.run_code(code, result):\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\IPython\\core\\interactiveshell.py\", line 2862, in run_code\n    exec(code_obj, self.user_global_ns, self.user_ns)\n  File \"<ipython-input-7-de90f1cd6d46>\", line 40, in <module>\n    train_op = tf.train.AdamOptimizer().minimize(loss)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\training\\optimizer.py\", line 315, in minimize\n    grad_loss=grad_loss)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\training\\optimizer.py\", line 386, in compute_gradients\n    colocate_gradients_with_ops=colocate_gradients_with_ops)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 540, in gradients\n    grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 346, in _MaybeCompile\n    return grad_fn()  # Exit early\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 540, in <lambda>\n    grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\math_grad.py\", line 129, in _ProdGrad\n    reduced_num = math_ops.reduce_prod(array_ops.gather(input_shape, reduced))\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\gen_array_ops.py\", line 1179, in gather\n    validate_indices=validate_indices, name=name)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 767, in apply_op\n    op_def=op_def)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 2506, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1269, in __init__\n    self._traceback = _extract_stack()\n\n...which was originally created as op 'MultivariateNormalDiag_3/prob/Prod', defined at:\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\spyder\\utils\\ipython\\start_kernel.py\", line 231, in <module>\n    main()\n[elided 23 identical lines from previous traceback]\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\IPython\\core\\interactiveshell.py\", line 2862, in run_code\n    exec(code_obj, self.user_global_ns, self.user_ns)\n  File \"<ipython-input-7-de90f1cd6d46>\", line 33, in <module>\n    kernel = mvn.prob(inds)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\distribution.py\", line 712, in prob\n    return self._call_prob(value, name)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\distribution.py\", line 694, in _call_prob\n    return self._prob(value, **kwargs)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\util.py\", line 688, in _fn\n    return fn(*args, **kwargs)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\contrib\\distributions\\python\\ops\\mvn_linear_operator.py\", line 216, in _prob\n    return super(MultivariateNormalLinearOperator, self)._prob(x)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\transformed_distribution.py\", line 406, in _prob\n    prob = math_ops.reduce_prod(prob, self._reduce_event_indices)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 1392, in reduce_prod\n    name=name)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\gen_math_ops.py\", line 1488, in _prod\n    keep_dims=keep_dims, name=name)\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 767, in apply_op\n    op_def=op_def)\n\nInvalidArgumentError (see above for traceback): indices[0] = -1 is not in [0, 2)\n\t [[Node: gradients/MultivariateNormalDiag_3/prob/Prod_grad/Gather = Gather[Tindices=DT_INT32, Tparams=DT_INT32, validate_indices=true, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](gradients/MultivariateNormalDiag_3/prob/Prod_grad/Shape, gradients/MultivariateNormalDiag_3/prob/Prod_grad/Reshape)]]", "body": "I upgraded my Tensorflow to v1.2.1. But I am still facing the same error message when I am trying to train a model to learn an appropriate sigma value for the Gaussian filter. Am I doing something wrong? My system is Win10. I installed Tensorflow through Anaonda. Here is my code.\r\n```\r\nimport tensorflow as tf\r\nimport tensorflow.contrib.distributions as ds\r\nimport numpy as np\r\nimport scipy.ndimage.filters as filters\r\n\r\n\r\n#set parameters-------------------\r\nIMAGE_SIZE = (576, 1024)\r\nKERNEL_SIZE = 3\r\n\r\n#build graph--------------\r\nimage = tf.placeholder(tf.float32, shape=(None,)+IMAGE_SIZE+(1,))\r\nlabel = tf.placeholder(tf.float32, shape=(None,)+IMAGE_SIZE+(1,))\r\nsigma = tf.Variable(tf.ones(1))\r\n\r\nxinds, yinds = np.unravel_index(range(KERNEL_SIZE*KERNEL_SIZE),                                 (KERNEL_SIZE, KERNEL_SIZE))\r\ninds = (np.column_stack((xinds,yinds))-\r\n                    [(KERNEL_SIZE-1)/2, (KERNEL_SIZE-1)/2]).astype(np.float32)\r\ninds = tf.constant(inds)\r\nloc = tf.zeros(2)\r\nscale_diag = tf.multiply(sigma, tf.ones([2,]))\r\n\r\nmvn = ds.MultivariateNormalDiag(\r\n    loc=loc,\r\n    scale_diag=scale_diag)\r\n\r\nkernel = mvn.prob(inds)\r\nkernel = tf.reshape(kernel, (KERNEL_SIZE, KERNEL_SIZE, 1, 1))\r\n\r\n\r\nx = tf.nn.conv2d(image, kernel, strides=[1,1,1,1], padding='SAME')\r\nloss = tf.nn.l2_loss(tf.subtract(x, label))\r\n\r\ntrain_op = tf.train.AdamOptimizer().minimize(loss)\r\n\r\nsess = tf.Session()\r\nsess.run(tf.global_variables_initializer())\r\n#start training-------------------------\r\nstimulus = np.zeros(IMAGE_SIZE)\r\nstimulus[300, 500] = 1\r\ntest_sigma = (30,30)\r\nfiltered = filters.gaussian_filter(stimulus, test_sigma)\r\nfeed_dict = {image: np.expand_dims(np.expand_dims(stimulus, 0), 3), \r\n                 label: np.expand_dims(np.expand_dims(filtered, 0), 3)}\r\nsess.run(train_op, feed_dict=feed_dict)\r\n```\r\n\r\nHere are the error messages.\r\n```\r\nInvalidArgumentError: indices[0] = -1 is not in [0, 2)\r\n\t [[Node: gradients/MultivariateNormalDiag_3/prob/Prod_grad/Gather = Gather[Tindices=DT_INT32, Tparams=DT_INT32, validate_indices=true, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](gradients/MultivariateNormalDiag_3/prob/Prod_grad/Shape, gradients/MultivariateNormalDiag_3/prob/Prod_grad/Reshape)]]\r\n\r\nCaused by op 'gradients/MultivariateNormalDiag_3/prob/Prod_grad/Gather', defined at:\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\spyder\\utils\\ipython\\start_kernel.py\", line 231, in <module>\r\n    main()\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\spyder\\utils\\ipython\\start_kernel.py\", line 227, in main\r\n    kernel.start()\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\kernelapp.py\", line 477, in start\r\n    ioloop.IOLoop.instance().start()\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\zmq\\eventloop\\ioloop.py\", line 177, in start\r\n    super(ZMQIOLoop, self).start()\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tornado\\ioloop.py\", line 832, in start\r\n    self._run_callback(self._callbacks.popleft())\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tornado\\ioloop.py\", line 605, in _run_callback\r\n    ret = callback()\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tornado\\stack_context.py\", line 277, in null_wrapper\r\n    return fn(*args, **kwargs)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\kernelbase.py\", line 265, in enter_eventloop\r\n    self.eventloop(self)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\eventloops.py\", line 106, in loop_qt5\r\n    return loop_qt4(kernel)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\eventloops.py\", line 99, in loop_qt4\r\n    _loop_qt(kernel.app)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\eventloops.py\", line 83, in _loop_qt\r\n    app.exec_()\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\eventloops.py\", line 39, in process_stream_events\r\n    kernel.do_one_iteration()\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\kernelbase.py\", line 298, in do_one_iteration\r\n    stream.flush(zmq.POLLIN, 1)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\zmq\\eventloop\\zmqstream.py\", line 352, in flush\r\n    self._handle_recv()\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\zmq\\eventloop\\zmqstream.py\", line 472, in _handle_recv\r\n    self._run_callback(callback, msg)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\zmq\\eventloop\\zmqstream.py\", line 414, in _run_callback\r\n    callback(*args, **kwargs)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tornado\\stack_context.py\", line 277, in null_wrapper\r\n    return fn(*args, **kwargs)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\kernelbase.py\", line 283, in dispatcher\r\n    return self.dispatch_shell(stream, msg)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\kernelbase.py\", line 235, in dispatch_shell\r\n    handler(stream, idents, msg)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\kernelbase.py\", line 399, in execute_request\r\n    user_expressions, allow_stdin)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\ipkernel.py\", line 196, in do_execute\r\n    res = shell.run_cell(code, store_history=store_history, silent=silent)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\ipykernel\\zmqshell.py\", line 533, in run_cell\r\n    return super(ZMQInteractiveShell, self).run_cell(*args, **kwargs)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\IPython\\core\\interactiveshell.py\", line 2698, in run_cell\r\n    interactivity=interactivity, compiler=compiler, result=result)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\IPython\\core\\interactiveshell.py\", line 2802, in run_ast_nodes\r\n    if self.run_code(code, result):\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\IPython\\core\\interactiveshell.py\", line 2862, in run_code\r\n    exec(code_obj, self.user_global_ns, self.user_ns)\r\n  File \"<ipython-input-7-de90f1cd6d46>\", line 40, in <module>\r\n    train_op = tf.train.AdamOptimizer().minimize(loss)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\training\\optimizer.py\", line 315, in minimize\r\n    grad_loss=grad_loss)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\training\\optimizer.py\", line 386, in compute_gradients\r\n    colocate_gradients_with_ops=colocate_gradients_with_ops)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 540, in gradients\r\n    grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 346, in _MaybeCompile\r\n    return grad_fn()  # Exit early\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\gradients_impl.py\", line 540, in <lambda>\r\n    grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\math_grad.py\", line 129, in _ProdGrad\r\n    reduced_num = math_ops.reduce_prod(array_ops.gather(input_shape, reduced))\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\gen_array_ops.py\", line 1179, in gather\r\n    validate_indices=validate_indices, name=name)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 767, in apply_op\r\n    op_def=op_def)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 2506, in create_op\r\n    original_op=self._default_original_op, op_def=op_def)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1269, in __init__\r\n    self._traceback = _extract_stack()\r\n\r\n...which was originally created as op 'MultivariateNormalDiag_3/prob/Prod', defined at:\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\spyder\\utils\\ipython\\start_kernel.py\", line 231, in <module>\r\n    main()\r\n[elided 23 identical lines from previous traceback]\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\IPython\\core\\interactiveshell.py\", line 2862, in run_code\r\n    exec(code_obj, self.user_global_ns, self.user_ns)\r\n  File \"<ipython-input-7-de90f1cd6d46>\", line 33, in <module>\r\n    kernel = mvn.prob(inds)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\distribution.py\", line 712, in prob\r\n    return self._call_prob(value, name)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\distribution.py\", line 694, in _call_prob\r\n    return self._prob(value, **kwargs)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\util.py\", line 688, in _fn\r\n    return fn(*args, **kwargs)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\contrib\\distributions\\python\\ops\\mvn_linear_operator.py\", line 216, in _prob\r\n    return super(MultivariateNormalLinearOperator, self)._prob(x)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\distributions\\transformed_distribution.py\", line 406, in _prob\r\n    prob = math_ops.reduce_prod(prob, self._reduce_event_indices)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\math_ops.py\", line 1392, in reduce_prod\r\n    name=name)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\ops\\gen_math_ops.py\", line 1488, in _prod\r\n    keep_dims=keep_dims, name=name)\r\n  File \"C:\\Users\\pasca\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 767, in apply_op\r\n    op_def=op_def)\r\n\r\nInvalidArgumentError (see above for traceback): indices[0] = -1 is not in [0, 2)\r\n\t [[Node: gradients/MultivariateNormalDiag_3/prob/Prod_grad/Gather = Gather[Tindices=DT_INT32, Tparams=DT_INT32, validate_indices=true, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](gradients/MultivariateNormalDiag_3/prob/Prod_grad/Shape, gradients/MultivariateNormalDiag_3/prob/Prod_grad/Reshape)]]\r\n```"}