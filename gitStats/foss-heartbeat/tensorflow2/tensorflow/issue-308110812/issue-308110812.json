{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17957", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17957/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17957/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17957/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/17957", "id": 308110812, "node_id": "MDU6SXNzdWUzMDgxMTA4MTI=", "number": 17957, "title": "InvalidArgumentError when training with weight regularization with anaconda in win 10 (tensorflow-gpu 1.6.0)", "user": {"login": "tim9510019", "id": 6170086, "node_id": "MDQ6VXNlcjYxNzAwODY=", "avatar_url": "https://avatars2.githubusercontent.com/u/6170086?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tim9510019", "html_url": "https://github.com/tim9510019", "followers_url": "https://api.github.com/users/tim9510019/followers", "following_url": "https://api.github.com/users/tim9510019/following{/other_user}", "gists_url": "https://api.github.com/users/tim9510019/gists{/gist_id}", "starred_url": "https://api.github.com/users/tim9510019/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tim9510019/subscriptions", "organizations_url": "https://api.github.com/users/tim9510019/orgs", "repos_url": "https://api.github.com/users/tim9510019/repos", "events_url": "https://api.github.com/users/tim9510019/events{/privacy}", "received_events_url": "https://api.github.com/users/tim9510019/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "bignamehyp", "id": 3474655, "node_id": "MDQ6VXNlcjM0NzQ2NTU=", "avatar_url": "https://avatars2.githubusercontent.com/u/3474655?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bignamehyp", "html_url": "https://github.com/bignamehyp", "followers_url": "https://api.github.com/users/bignamehyp/followers", "following_url": "https://api.github.com/users/bignamehyp/following{/other_user}", "gists_url": "https://api.github.com/users/bignamehyp/gists{/gist_id}", "starred_url": "https://api.github.com/users/bignamehyp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bignamehyp/subscriptions", "organizations_url": "https://api.github.com/users/bignamehyp/orgs", "repos_url": "https://api.github.com/users/bignamehyp/repos", "events_url": "https://api.github.com/users/bignamehyp/events{/privacy}", "received_events_url": "https://api.github.com/users/bignamehyp/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "bignamehyp", "id": 3474655, "node_id": "MDQ6VXNlcjM0NzQ2NTU=", "avatar_url": "https://avatars2.githubusercontent.com/u/3474655?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bignamehyp", "html_url": "https://github.com/bignamehyp", "followers_url": "https://api.github.com/users/bignamehyp/followers", "following_url": "https://api.github.com/users/bignamehyp/following{/other_user}", "gists_url": "https://api.github.com/users/bignamehyp/gists{/gist_id}", "starred_url": "https://api.github.com/users/bignamehyp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bignamehyp/subscriptions", "organizations_url": "https://api.github.com/users/bignamehyp/orgs", "repos_url": "https://api.github.com/users/bignamehyp/repos", "events_url": "https://api.github.com/users/bignamehyp/events{/privacy}", "received_events_url": "https://api.github.com/users/bignamehyp/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 10, "created_at": "2018-03-23T17:07:36Z", "updated_at": "2018-06-21T20:16:50Z", "closed_at": "2018-06-21T20:16:50Z", "author_association": "NONE", "body_html": "<p>Error message occurs when applying L2 loss weight decay with 1080ti gpu activated<br>\nNo Error message occurs when applying weight decay with only cpu running<br>\nThe error message always come out if training with all the Optimizer in anaconda, win10, gpu 1080ti, tensorflow 1.6.0. CUDA 9 CUDNN 7.0</p>\n<pre><code>Traceback (most recent call last):\n  File \"train_ADAM_add1CNN.py\", line 89, in &lt;module&gt;\n    _ = sess.run([train_step_adam],feed_dict={img_in:X_mb, label_gt:y_gt})\n  File \"D:\\ProgramData\\Anaconda4\\envs\\tff\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 905, in run\n    run_metadata_ptr)\n  File \"D:\\ProgramData\\Anaconda4\\envs\\tff\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1137, in _run\n    feed_dict_tensor, options, run_metadata)\n  File \"D:\\ProgramData\\Anaconda4\\envs\\tff\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1355, in _do_run\n    options, run_metadata)\n  File \"D:\\ProgramData\\Anaconda4\\envs\\tff\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1374, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InvalidArgumentError: AttrValue must not have reference type value of float_ref\n         for attr 'tensor_type'\n</code></pre>\n<p>Here is the example code that can duplicate the issue:</p>\n<pre><code>...\ndef optimize_adam(loss, learning_rate, LRdecaysteps, LRdecayrate):\n    decay_learning_rate = tf.train.exponential_decay(learning_rate, global_step, LRdecaysteps, LRdecayrate, staircase=True)\n    update_ops = tf.get_collection(tf.GraphKeys.UPDATE_OPS)\n    with tf.control_dependencies(update_ops):\n        return tf.train.AdamOptimizer(decay_learning_rate).minimize(loss, global_step=global_step), decay_learning_rate\n\nregularization_loss = tf.add_n(tf.losses.get_regularization_losses())\ntotal_loss = total_loss + regularization_loss\ntrain_step_adam,decay_learning_rate = optimize_adam(total_loss,learning_rate,LRdecaysteps,LRdecayrate)\n...\n</code></pre>\n<p>it can be run with :<br>\nsession_conf = tf.ConfigProto(<br>\ndevice_count={'CPU' : 1, 'GPU' : 0},<br>\nallow_soft_placement=True,<br>\nlog_device_placement=False<br>\n)</p>\n<p>But it will come out this error message with:<br>\nsession_conf = tf.ConfigProto(<br>\ndevice_count={'CPU' : 1, 'GPU' : 1},<br>\nallow_soft_placement=True,<br>\nlog_device_placement=False<br>\n)</p>", "body_text": "Error message occurs when applying L2 loss weight decay with 1080ti gpu activated\nNo Error message occurs when applying weight decay with only cpu running\nThe error message always come out if training with all the Optimizer in anaconda, win10, gpu 1080ti, tensorflow 1.6.0. CUDA 9 CUDNN 7.0\nTraceback (most recent call last):\n  File \"train_ADAM_add1CNN.py\", line 89, in <module>\n    _ = sess.run([train_step_adam],feed_dict={img_in:X_mb, label_gt:y_gt})\n  File \"D:\\ProgramData\\Anaconda4\\envs\\tff\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 905, in run\n    run_metadata_ptr)\n  File \"D:\\ProgramData\\Anaconda4\\envs\\tff\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1137, in _run\n    feed_dict_tensor, options, run_metadata)\n  File \"D:\\ProgramData\\Anaconda4\\envs\\tff\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1355, in _do_run\n    options, run_metadata)\n  File \"D:\\ProgramData\\Anaconda4\\envs\\tff\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1374, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InvalidArgumentError: AttrValue must not have reference type value of float_ref\n         for attr 'tensor_type'\n\nHere is the example code that can duplicate the issue:\n...\ndef optimize_adam(loss, learning_rate, LRdecaysteps, LRdecayrate):\n    decay_learning_rate = tf.train.exponential_decay(learning_rate, global_step, LRdecaysteps, LRdecayrate, staircase=True)\n    update_ops = tf.get_collection(tf.GraphKeys.UPDATE_OPS)\n    with tf.control_dependencies(update_ops):\n        return tf.train.AdamOptimizer(decay_learning_rate).minimize(loss, global_step=global_step), decay_learning_rate\n\nregularization_loss = tf.add_n(tf.losses.get_regularization_losses())\ntotal_loss = total_loss + regularization_loss\ntrain_step_adam,decay_learning_rate = optimize_adam(total_loss,learning_rate,LRdecaysteps,LRdecayrate)\n...\n\nit can be run with :\nsession_conf = tf.ConfigProto(\ndevice_count={'CPU' : 1, 'GPU' : 0},\nallow_soft_placement=True,\nlog_device_placement=False\n)\nBut it will come out this error message with:\nsession_conf = tf.ConfigProto(\ndevice_count={'CPU' : 1, 'GPU' : 1},\nallow_soft_placement=True,\nlog_device_placement=False\n)", "body": "Error message occurs when applying L2 loss weight decay with 1080ti gpu activated\r\nNo Error message occurs when applying weight decay with only cpu running\r\nThe error message always come out if training with all the Optimizer in anaconda, win10, gpu 1080ti, tensorflow 1.6.0. CUDA 9 CUDNN 7.0\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"train_ADAM_add1CNN.py\", line 89, in <module>\r\n    _ = sess.run([train_step_adam],feed_dict={img_in:X_mb, label_gt:y_gt})\r\n  File \"D:\\ProgramData\\Anaconda4\\envs\\tff\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 905, in run\r\n    run_metadata_ptr)\r\n  File \"D:\\ProgramData\\Anaconda4\\envs\\tff\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1137, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"D:\\ProgramData\\Anaconda4\\envs\\tff\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1355, in _do_run\r\n    options, run_metadata)\r\n  File \"D:\\ProgramData\\Anaconda4\\envs\\tff\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1374, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: AttrValue must not have reference type value of float_ref\r\n         for attr 'tensor_type'\r\n```\r\n\r\nHere is the example code that can duplicate the issue:\r\n\r\n```\r\n...\r\ndef optimize_adam(loss, learning_rate, LRdecaysteps, LRdecayrate):\r\n    decay_learning_rate = tf.train.exponential_decay(learning_rate, global_step, LRdecaysteps, LRdecayrate, staircase=True)\r\n    update_ops = tf.get_collection(tf.GraphKeys.UPDATE_OPS)\r\n    with tf.control_dependencies(update_ops):\r\n        return tf.train.AdamOptimizer(decay_learning_rate).minimize(loss, global_step=global_step), decay_learning_rate\r\n\r\nregularization_loss = tf.add_n(tf.losses.get_regularization_losses())\r\ntotal_loss = total_loss + regularization_loss\r\ntrain_step_adam,decay_learning_rate = optimize_adam(total_loss,learning_rate,LRdecaysteps,LRdecayrate)\r\n...\r\n```\r\n\r\nit can be run with :\r\nsession_conf = tf.ConfigProto(\r\n    device_count={'CPU' : 1, 'GPU' : 0},\r\n    allow_soft_placement=True,\r\n    log_device_placement=False\r\n)\r\n\r\nBut it will come out this error message with:\r\nsession_conf = tf.ConfigProto(\r\n    device_count={'CPU' : 1, 'GPU' : 1},\r\n    allow_soft_placement=True,\r\n    log_device_placement=False\r\n)"}