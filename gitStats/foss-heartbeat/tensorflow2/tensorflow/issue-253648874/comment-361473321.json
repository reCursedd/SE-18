{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/361473321", "html_url": "https://github.com/tensorflow/tensorflow/issues/12683#issuecomment-361473321", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12683", "id": 361473321, "node_id": "MDEyOklzc3VlQ29tbWVudDM2MTQ3MzMyMQ==", "user": {"login": "bixia1", "id": 35820639, "node_id": "MDQ6VXNlcjM1ODIwNjM5", "avatar_url": "https://avatars1.githubusercontent.com/u/35820639?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bixia1", "html_url": "https://github.com/bixia1", "followers_url": "https://api.github.com/users/bixia1/followers", "following_url": "https://api.github.com/users/bixia1/following{/other_user}", "gists_url": "https://api.github.com/users/bixia1/gists{/gist_id}", "starred_url": "https://api.github.com/users/bixia1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bixia1/subscriptions", "organizations_url": "https://api.github.com/users/bixia1/orgs", "repos_url": "https://api.github.com/users/bixia1/repos", "events_url": "https://api.github.com/users/bixia1/events{/privacy}", "received_events_url": "https://api.github.com/users/bixia1/received_events", "type": "User", "site_admin": false}, "created_at": "2018-01-30T04:24:15Z", "updated_at": "2018-01-30T04:30:27Z", "author_association": "CONTRIBUTOR", "body_html": "<p>I am able to reproduce the problem and verify that the latest tensorflow source doesn't have this problem. It looks to me that the following single line change can fix the problem, would you please give this a try? My source file may not be exactly the same as yours, so please manually apply the change to routine ConstantFolding::SimplifyGraph.</p>\n<p>--- .../tensorflow/core/grappler/optimizers/constant_folding.cc<br>\n+++ .../tensorflow/core/grappler/optimizers/constant_folding.cc<br>\n@@ -1357,7 +1357,7 @@ Status ConstantFolding::SimplifyGraph(GraphDef* output,<br>\nconst bool is_any_div = IsAnyDiv(*node);<br>\n// Simplify multiplication by ones or zeros, and addition/subtraction of<br>\n// zeros.<br>\n--    if (is_aggressive &amp;&amp; use_shape_info &amp;&amp;<br>\n++    if (safe_to_use_shapes &amp;&amp;<br>\n(is_mul || is_matmul || is_add || is_sub || is_any_div) &amp;&amp;<br>\nproperties.HasInputProperties(node-&gt;name()) &amp;&amp;<br>\nproperties.HasOutputProperties(node-&gt;name())) {</p>", "body_text": "I am able to reproduce the problem and verify that the latest tensorflow source doesn't have this problem. It looks to me that the following single line change can fix the problem, would you please give this a try? My source file may not be exactly the same as yours, so please manually apply the change to routine ConstantFolding::SimplifyGraph.\n--- .../tensorflow/core/grappler/optimizers/constant_folding.cc\n+++ .../tensorflow/core/grappler/optimizers/constant_folding.cc\n@@ -1357,7 +1357,7 @@ Status ConstantFolding::SimplifyGraph(GraphDef* output,\nconst bool is_any_div = IsAnyDiv(*node);\n// Simplify multiplication by ones or zeros, and addition/subtraction of\n// zeros.\n--    if (is_aggressive && use_shape_info &&\n++    if (safe_to_use_shapes &&\n(is_mul || is_matmul || is_add || is_sub || is_any_div) &&\nproperties.HasInputProperties(node->name()) &&\nproperties.HasOutputProperties(node->name())) {", "body": "I am able to reproduce the problem and verify that the latest tensorflow source doesn't have this problem. It looks to me that the following single line change can fix the problem, would you please give this a try? My source file may not be exactly the same as yours, so please manually apply the change to routine ConstantFolding::SimplifyGraph.\r\n\r\n--- .../tensorflow/core/grappler/optimizers/constant_folding.cc\r\n+++ .../tensorflow/core/grappler/optimizers/constant_folding.cc\r\n@@ -1357,7 +1357,7 @@ Status ConstantFolding::SimplifyGraph(GraphDef* output,\r\n     const bool is_any_div = IsAnyDiv(*node);\r\n     // Simplify multiplication by ones or zeros, and addition/subtraction of\r\n     // zeros.\r\n --    if (is_aggressive && use_shape_info &&\r\n ++    if (safe_to_use_shapes &&\r\n         (is_mul || is_matmul || is_add || is_sub || is_any_div) &&\r\n         properties.HasInputProperties(node->name()) &&\r\n         properties.HasOutputProperties(node->name())) {\r\n\r\n"}