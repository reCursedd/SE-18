{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20469", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20469/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20469/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20469/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/20469", "id": 337373558, "node_id": "MDU6SXNzdWUzMzczNzM1NTg=", "number": 20469, "title": "total_float_ops is 0 by tf.profiler.profile", "user": {"login": "ChiFang", "id": 16358320, "node_id": "MDQ6VXNlcjE2MzU4MzIw", "avatar_url": "https://avatars3.githubusercontent.com/u/16358320?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChiFang", "html_url": "https://github.com/ChiFang", "followers_url": "https://api.github.com/users/ChiFang/followers", "following_url": "https://api.github.com/users/ChiFang/following{/other_user}", "gists_url": "https://api.github.com/users/ChiFang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChiFang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChiFang/subscriptions", "organizations_url": "https://api.github.com/users/ChiFang/orgs", "repos_url": "https://api.github.com/users/ChiFang/repos", "events_url": "https://api.github.com/users/ChiFang/events{/privacy}", "received_events_url": "https://api.github.com/users/ChiFang/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "angersson", "id": 32465472, "node_id": "MDQ6VXNlcjMyNDY1NDcy", "avatar_url": "https://avatars2.githubusercontent.com/u/32465472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/angersson", "html_url": "https://github.com/angersson", "followers_url": "https://api.github.com/users/angersson/followers", "following_url": "https://api.github.com/users/angersson/following{/other_user}", "gists_url": "https://api.github.com/users/angersson/gists{/gist_id}", "starred_url": "https://api.github.com/users/angersson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/angersson/subscriptions", "organizations_url": "https://api.github.com/users/angersson/orgs", "repos_url": "https://api.github.com/users/angersson/repos", "events_url": "https://api.github.com/users/angersson/events{/privacy}", "received_events_url": "https://api.github.com/users/angersson/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "angersson", "id": 32465472, "node_id": "MDQ6VXNlcjMyNDY1NDcy", "avatar_url": "https://avatars2.githubusercontent.com/u/32465472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/angersson", "html_url": "https://github.com/angersson", "followers_url": "https://api.github.com/users/angersson/followers", "following_url": "https://api.github.com/users/angersson/following{/other_user}", "gists_url": "https://api.github.com/users/angersson/gists{/gist_id}", "starred_url": "https://api.github.com/users/angersson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/angersson/subscriptions", "organizations_url": "https://api.github.com/users/angersson/orgs", "repos_url": "https://api.github.com/users/angersson/repos", "events_url": "https://api.github.com/users/angersson/events{/privacy}", "received_events_url": "https://api.github.com/users/angersson/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2018-07-02T05:22:26Z", "updated_at": "2018-07-20T07:15:03Z", "closed_at": "2018-07-09T20:34:38Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:No</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Linux Ubuntu 16.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.8</li>\n<li><strong>Python version</strong>: 3.5</li>\n<li><strong>Bazel version (if compiling from source)</strong>: None</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: 5.4</li>\n<li><strong>CUDA/cuDNN version</strong>: CUDA 9 / cuDNN 7</li>\n<li><strong>GPU model and memory</strong>: GeForce GTX 1080Ti</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<pre><code>import cv2\nimport time\nimport tensorflow as tf\nfrom tensorflow.python.framework import graph_util\n\nModelFile = \"OX_Predict_frozen.pb\"\n\ndef load_pb(pb):\n    with tf.gfile.GFile(pb, \"rb\") as f:\n        graph_def = tf.GraphDef()\n        graph_def.ParseFromString(f.read())\n    with tf.Graph().as_default() as graph:\n        tf.import_graph_def(graph_def, name='')\n        return graph\n        \nimport math\nM = math.pow( 10, 6 )\nprint(M)\n\ndef log_FLOP():\n    # ***** (3) Load frozen graph *****\n    g2 = load_pb(ModelFile)\n    with g2.as_default():\n        flops = tf.profiler.profile(g2, options = tf.profiler.ProfileOptionBuilder.float_operation())\n        print('FLOP after freezing(M): ', flops.total_float_ops/ M)\n\ndef main():\n    log_FLOP()\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>\n<h3>Describe the problem</h3>\n<p>I'm trying to log the number of multiply-add operations (MAC) in my network by \"tf.profiler.profile\".</p>\n<p>here is the <a href=\"https://drive.google.com/file/d/12-7TI7EGLuN8JgcafGPJKeugp263gVYD/view?usp=sharing\" rel=\"nofollow\">model</a>(.pb)</p>\n<p>the model work perfect when predict, but it always return 0 flops with \"tf.profiler.profile\"</p>\n<p>any suggestion ?</p>\n<h3>Source code / logs</h3>\n<p>the sample code to get .pb is following:<br>\n<a href=\"https://github.com/ChiFang/TensorFlow_XO_example\">https://github.com/ChiFang/TensorFlow_XO_example</a></p>\n<p>it takes only few sec~~~~</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):No\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 16.04\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below): 1.8\nPython version: 3.5\nBazel version (if compiling from source): None\nGCC/Compiler version (if compiling from source): 5.4\nCUDA/cuDNN version: CUDA 9 / cuDNN 7\nGPU model and memory: GeForce GTX 1080Ti\nExact command to reproduce:\n\nimport cv2\nimport time\nimport tensorflow as tf\nfrom tensorflow.python.framework import graph_util\n\nModelFile = \"OX_Predict_frozen.pb\"\n\ndef load_pb(pb):\n    with tf.gfile.GFile(pb, \"rb\") as f:\n        graph_def = tf.GraphDef()\n        graph_def.ParseFromString(f.read())\n    with tf.Graph().as_default() as graph:\n        tf.import_graph_def(graph_def, name='')\n        return graph\n        \nimport math\nM = math.pow( 10, 6 )\nprint(M)\n\ndef log_FLOP():\n    # ***** (3) Load frozen graph *****\n    g2 = load_pb(ModelFile)\n    with g2.as_default():\n        flops = tf.profiler.profile(g2, options = tf.profiler.ProfileOptionBuilder.float_operation())\n        print('FLOP after freezing(M): ', flops.total_float_ops/ M)\n\ndef main():\n    log_FLOP()\n\nif __name__ == \"__main__\":\n    main()\n\nDescribe the problem\nI'm trying to log the number of multiply-add operations (MAC) in my network by \"tf.profiler.profile\".\nhere is the model(.pb)\nthe model work perfect when predict, but it always return 0 flops with \"tf.profiler.profile\"\nany suggestion ?\nSource code / logs\nthe sample code to get .pb is following:\nhttps://github.com/ChiFang/TensorFlow_XO_example\nit takes only few sec~~~~", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Ubuntu 16.04\r\n- **TensorFlow installed from (source or binary)**: binary\r\n- **TensorFlow version (use command below)**: 1.8\r\n- **Python version**: 3.5\r\n- **Bazel version (if compiling from source)**: None\r\n- **GCC/Compiler version (if compiling from source)**: 5.4\r\n- **CUDA/cuDNN version**: CUDA 9 / cuDNN 7\r\n- **GPU model and memory**: GeForce GTX 1080Ti\r\n- **Exact command to reproduce**:\r\n```\r\nimport cv2\r\nimport time\r\nimport tensorflow as tf\r\nfrom tensorflow.python.framework import graph_util\r\n\r\nModelFile = \"OX_Predict_frozen.pb\"\r\n\r\ndef load_pb(pb):\r\n    with tf.gfile.GFile(pb, \"rb\") as f:\r\n        graph_def = tf.GraphDef()\r\n        graph_def.ParseFromString(f.read())\r\n    with tf.Graph().as_default() as graph:\r\n        tf.import_graph_def(graph_def, name='')\r\n        return graph\r\n        \r\nimport math\r\nM = math.pow( 10, 6 )\r\nprint(M)\r\n\r\ndef log_FLOP():\r\n    # ***** (3) Load frozen graph *****\r\n    g2 = load_pb(ModelFile)\r\n    with g2.as_default():\r\n        flops = tf.profiler.profile(g2, options = tf.profiler.ProfileOptionBuilder.float_operation())\r\n        print('FLOP after freezing(M): ', flops.total_float_ops/ M)\r\n\r\ndef main():\r\n    log_FLOP()\r\n\r\nif __name__ == \"__main__\":\r\n    main()\r\n```\r\n\r\n\r\n### Describe the problem\r\nI'm trying to log the number of multiply-add operations (MAC) in my network by \"tf.profiler.profile\".\r\n\r\nhere is the [model](https://drive.google.com/file/d/12-7TI7EGLuN8JgcafGPJKeugp263gVYD/view?usp=sharing)(.pb)\r\n\r\nthe model work perfect when predict, but it always return 0 flops with \"tf.profiler.profile\"\r\n\r\nany suggestion ?\r\n\r\n### Source code / logs\r\nthe sample code to get .pb is following:\r\nhttps://github.com/ChiFang/TensorFlow_XO_example\r\n\r\nit takes only few sec~~~~\r\n"}