{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4331", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4331/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4331/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4331/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/4331", "id": 176311326, "node_id": "MDU6SXNzdWUxNzYzMTEzMjY=", "number": 4331, "title": "Problem with using tf.contrib.metrics.streaming_mean_iou", "user": {"login": "ziky90", "id": 1810839, "node_id": "MDQ6VXNlcjE4MTA4Mzk=", "avatar_url": "https://avatars0.githubusercontent.com/u/1810839?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ziky90", "html_url": "https://github.com/ziky90", "followers_url": "https://api.github.com/users/ziky90/followers", "following_url": "https://api.github.com/users/ziky90/following{/other_user}", "gists_url": "https://api.github.com/users/ziky90/gists{/gist_id}", "starred_url": "https://api.github.com/users/ziky90/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ziky90/subscriptions", "organizations_url": "https://api.github.com/users/ziky90/orgs", "repos_url": "https://api.github.com/users/ziky90/repos", "events_url": "https://api.github.com/users/ziky90/events{/privacy}", "received_events_url": "https://api.github.com/users/ziky90/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2016-09-12T07:35:03Z", "updated_at": "2016-10-31T18:22:04Z", "closed_at": "2016-09-13T11:48:47Z", "author_association": "CONTRIBUTOR", "body_html": "<p>I am trying to use <code>tf.contrib.metrics.streaming_mean_iou</code> in my network and I am getting following Error.</p>\n<pre><code>W tensorflow/core/framework/op_kernel.cc:940] Failed precondition: Attempting to use uninitialized value mean_iou/total_confusion_matrix\n     [[Node: mean_iou/total_confusion_matrix/read = Identity[T=DT_INT64, _class=[\"loc:@mean_iou/total_confusion_matrix\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](mean_iou/total_confusion_matrix)]]\nTraceback (most recent call last):\n....\n....\nFile \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 710, in run\n    run_metadata_ptr)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 908, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 958, in _do_run\n    target_list, options, run_metadata)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 978, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors.FailedPreconditionError: Attempting to use uninitialized value mean_iou/total_confusion_matrix\n     [[Node: mean_iou/total_confusion_matrix/read = Identity[T=DT_INT64, _class=[\"loc:@mean_iou/total_confusion_matrix\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](mean_iou/total_confusion_matrix)]]\n....\n....\nFile \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/contrib/metrics/python/ops/metric_ops.py\", line 1805, in streaming_mean_iou\n    dtype=dtypes.int64)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/contrib/metrics/python/ops/metric_ops.py\", line 79, in _create_local\n    collections=collections)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 211, in __init__\n    dtype=dtype)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 323, in _init_from_args\n    self._snapshot = array_ops.identity(self._variable, name=\"read\")\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 1106, in identity\n    result = _op_def_lib.apply_op(\"Identity\", input=input, name=name)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 703, in apply_op\n    op_def=op_def)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2317, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1239, in __init__\n    self._traceback = _extract_stack()\n</code></pre>\n<p>It seems to me that there might be some bug in the <code>tf.contrib.metrics.streaming_mean_iou</code>since all the variables are already initialised.</p>\n<p>I am using it as follows:</p>\n<pre><code>accuracy_increment, iou_increment = self.session.run(\n                [self.accuracy, self.mean_iou], feed_dict={\n                self.X: eval_patches[\n                        q * self.microbatch_size:\n                        q * self.microbatch_size +\n                        self.microbatch_size],\n                self.Y: eval_labels[\n                        q * self.microbatch_size:\n                        q * self.microbatch_size +\n                        self.microbatch_size],\n                self.p_keep_conv: 1})\n</code></pre>\n<p>And the mean iou is computed in the object as:</p>\n<pre><code>self.mean_iou, _ = tf.contrib.metrics.streaming_mean_iou(\n            self.predictions, tf.argmax(self.Y, dimension=3), num_classes=2)\n</code></pre>\n<p>I am using from source build tensorflow (branch r10.0) and it's happening to me on both CPU and GPU.</p>\n<p>I am not 100% sure that I am using the <code>tf.contrib.metrics.streaming_mean_iou</code> correctly, but I have played with that a lot, but there is quite lack of the documentation, so I am currently stuck assuming that there is either some bug in the <code>tf.contrib.metrics.streaming_mean_iou</code> or not enough documentation for me to make it work.</p>\n<p>I thank in advance anyone for any comments.</p>", "body_text": "I am trying to use tf.contrib.metrics.streaming_mean_iou in my network and I am getting following Error.\nW tensorflow/core/framework/op_kernel.cc:940] Failed precondition: Attempting to use uninitialized value mean_iou/total_confusion_matrix\n     [[Node: mean_iou/total_confusion_matrix/read = Identity[T=DT_INT64, _class=[\"loc:@mean_iou/total_confusion_matrix\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](mean_iou/total_confusion_matrix)]]\nTraceback (most recent call last):\n....\n....\nFile \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 710, in run\n    run_metadata_ptr)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 908, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 958, in _do_run\n    target_list, options, run_metadata)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 978, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors.FailedPreconditionError: Attempting to use uninitialized value mean_iou/total_confusion_matrix\n     [[Node: mean_iou/total_confusion_matrix/read = Identity[T=DT_INT64, _class=[\"loc:@mean_iou/total_confusion_matrix\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](mean_iou/total_confusion_matrix)]]\n....\n....\nFile \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/contrib/metrics/python/ops/metric_ops.py\", line 1805, in streaming_mean_iou\n    dtype=dtypes.int64)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/contrib/metrics/python/ops/metric_ops.py\", line 79, in _create_local\n    collections=collections)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 211, in __init__\n    dtype=dtype)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 323, in _init_from_args\n    self._snapshot = array_ops.identity(self._variable, name=\"read\")\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 1106, in identity\n    result = _op_def_lib.apply_op(\"Identity\", input=input, name=name)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 703, in apply_op\n    op_def=op_def)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2317, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1239, in __init__\n    self._traceback = _extract_stack()\n\nIt seems to me that there might be some bug in the tf.contrib.metrics.streaming_mean_iousince all the variables are already initialised.\nI am using it as follows:\naccuracy_increment, iou_increment = self.session.run(\n                [self.accuracy, self.mean_iou], feed_dict={\n                self.X: eval_patches[\n                        q * self.microbatch_size:\n                        q * self.microbatch_size +\n                        self.microbatch_size],\n                self.Y: eval_labels[\n                        q * self.microbatch_size:\n                        q * self.microbatch_size +\n                        self.microbatch_size],\n                self.p_keep_conv: 1})\n\nAnd the mean iou is computed in the object as:\nself.mean_iou, _ = tf.contrib.metrics.streaming_mean_iou(\n            self.predictions, tf.argmax(self.Y, dimension=3), num_classes=2)\n\nI am using from source build tensorflow (branch r10.0) and it's happening to me on both CPU and GPU.\nI am not 100% sure that I am using the tf.contrib.metrics.streaming_mean_iou correctly, but I have played with that a lot, but there is quite lack of the documentation, so I am currently stuck assuming that there is either some bug in the tf.contrib.metrics.streaming_mean_iou or not enough documentation for me to make it work.\nI thank in advance anyone for any comments.", "body": "I am trying to use `tf.contrib.metrics.streaming_mean_iou` in my network and I am getting following Error.\n\n```\nW tensorflow/core/framework/op_kernel.cc:940] Failed precondition: Attempting to use uninitialized value mean_iou/total_confusion_matrix\n     [[Node: mean_iou/total_confusion_matrix/read = Identity[T=DT_INT64, _class=[\"loc:@mean_iou/total_confusion_matrix\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](mean_iou/total_confusion_matrix)]]\nTraceback (most recent call last):\n....\n....\nFile \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 710, in run\n    run_metadata_ptr)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 908, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 958, in _do_run\n    target_list, options, run_metadata)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 978, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors.FailedPreconditionError: Attempting to use uninitialized value mean_iou/total_confusion_matrix\n     [[Node: mean_iou/total_confusion_matrix/read = Identity[T=DT_INT64, _class=[\"loc:@mean_iou/total_confusion_matrix\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](mean_iou/total_confusion_matrix)]]\n....\n....\nFile \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/contrib/metrics/python/ops/metric_ops.py\", line 1805, in streaming_mean_iou\n    dtype=dtypes.int64)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/contrib/metrics/python/ops/metric_ops.py\", line 79, in _create_local\n    collections=collections)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 211, in __init__\n    dtype=dtype)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 323, in _init_from_args\n    self._snapshot = array_ops.identity(self._variable, name=\"read\")\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 1106, in identity\n    result = _op_def_lib.apply_op(\"Identity\", input=input, name=name)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 703, in apply_op\n    op_def=op_def)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2317, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/Users/janzikes/anaconda2/envs/research/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1239, in __init__\n    self._traceback = _extract_stack()\n```\n\nIt seems to me that there might be some bug in the `tf.contrib.metrics.streaming_mean_iou`since all the variables are already initialised.\n\nI am using it as follows:\n\n```\naccuracy_increment, iou_increment = self.session.run(\n                [self.accuracy, self.mean_iou], feed_dict={\n                self.X: eval_patches[\n                        q * self.microbatch_size:\n                        q * self.microbatch_size +\n                        self.microbatch_size],\n                self.Y: eval_labels[\n                        q * self.microbatch_size:\n                        q * self.microbatch_size +\n                        self.microbatch_size],\n                self.p_keep_conv: 1})\n```\n\nAnd the mean iou is computed in the object as:\n\n```\nself.mean_iou, _ = tf.contrib.metrics.streaming_mean_iou(\n            self.predictions, tf.argmax(self.Y, dimension=3), num_classes=2)\n```\n\nI am using from source build tensorflow (branch r10.0) and it's happening to me on both CPU and GPU.\n\nI am not 100% sure that I am using the `tf.contrib.metrics.streaming_mean_iou` correctly, but I have played with that a lot, but there is quite lack of the documentation, so I am currently stuck assuming that there is either some bug in the `tf.contrib.metrics.streaming_mean_iou` or not enough documentation for me to make it work.\n\nI thank in advance anyone for any comments.\n"}