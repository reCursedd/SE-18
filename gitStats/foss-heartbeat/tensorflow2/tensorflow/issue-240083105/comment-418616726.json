{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/418616726", "html_url": "https://github.com/tensorflow/tensorflow/issues/11235#issuecomment-418616726", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11235", "id": 418616726, "node_id": "MDEyOklzc3VlQ29tbWVudDQxODYxNjcyNg==", "user": {"login": "shinya321", "id": 11747251, "node_id": "MDQ6VXNlcjExNzQ3MjUx", "avatar_url": "https://avatars1.githubusercontent.com/u/11747251?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shinya321", "html_url": "https://github.com/shinya321", "followers_url": "https://api.github.com/users/shinya321/followers", "following_url": "https://api.github.com/users/shinya321/following{/other_user}", "gists_url": "https://api.github.com/users/shinya321/gists{/gist_id}", "starred_url": "https://api.github.com/users/shinya321/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shinya321/subscriptions", "organizations_url": "https://api.github.com/users/shinya321/orgs", "repos_url": "https://api.github.com/users/shinya321/repos", "events_url": "https://api.github.com/users/shinya321/events{/privacy}", "received_events_url": "https://api.github.com/users/shinya321/received_events", "type": "User", "site_admin": false}, "created_at": "2018-09-05T06:40:55Z", "updated_at": "2018-09-05T06:40:55Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=11378214\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/alexcdot\">@alexcdot</a> Thank you so much for replying me!<br>\nI updated \"quantize_graph.py\" as you said, and try to quantize ssd-mobilenet v1 model as below:</p>\n<pre>python quantize_graph_new.py --input=frozen_inference_graph.pb --output_node_names=\"detection_scores,detection_classes,num_detections\" --output=frozen_8bit_graph.pb --mode=eightbit\n</pre>\n<p>Next I try to execute inference by using frozen graph \"frozen_8bit_graph.pb\",<br>\nbut still it does not work.... like this.\u2193\u2193</p>\n<pre>---------------------------------------------------------------------------\nInvalidArgumentError                      Traceback (most recent call last)\nc:\\users\\s120077.sei\\appdata\\local\\continuum\\anaconda3\\envs\\takubo\\lib\\site-packages\\tensorflow\\python\\framework\\importer.py in import_graph_def(graph_def, input_map, return_elements, name, op_dict, producer_op_list)\n    488           results = c_api.TF_GraphImportGraphDefWithResults(\n--&gt; 489               graph._c_graph, serialized, options)  # pylint: disable=protected-access\n    490           results = c_api_util.ScopedTFImportGraphDefResults(results)\n\nInvalidArgumentError: Node 'FeatureExtractor/MobilenetV1/MobilenetV1/Conv2d_0/BatchNorm/batchnorm/mul_1_eightbit_reshape___hat__FeatureExtractor/Assert/Assert': Control dependencies must come after regular dependencies\n\nDuring handling of the above exception, another exception occurred:\n\nValueError                                Traceback (most recent call last)\n in ()\n     15     serialized_graph = fid.read()\n     16     od_graph_def.ParseFromString(serialized_graph)\n---&gt; 17     tf.import_graph_def(od_graph_def, name='')\n     18 \n     19 \n\nc:\\users\\s120077.sei\\appdata\\local\\continuum\\anaconda3\\envs\\takubo\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py in new_func(*args, **kwargs)\n    430                 'in a future version' if date is None else ('after %s' % date),\n    431                 instructions)\n--&gt; 432       return func(*args, **kwargs)\n    433     return tf_decorator.make_decorator(func, new_func, 'deprecated',\n    434                                        _add_deprecated_arg_notice_to_docstring(\n\nc:\\users\\s120077.sei\\appdata\\local\\continuum\\anaconda3\\envs\\takubo\\lib\\site-packages\\tensorflow\\python\\framework\\importer.py in import_graph_def(graph_def, input_map, return_elements, name, op_dict, producer_op_list)\n    491         except errors.InvalidArgumentError as e:\n    492           # Convert to ValueError for backwards compatibility.\n--&gt; 493           raise ValueError(str(e))\n    494 \n    495       # Create _DefinedFunctions for any imported functions.\n\nValueError: Node 'FeatureExtractor/MobilenetV1/MobilenetV1/Conv2d_0/BatchNorm/batchnorm/mul_1_eightbit_reshape___hat__FeatureExtractor/Assert/Assert': Control dependencies must come after regular dependencies\n\n</pre>\n<p>I could execute inference program by using no quantized model.<br>\nIf you know, please tell me why the program does not work.</p>", "body_text": "@alexcdot Thank you so much for replying me!\nI updated \"quantize_graph.py\" as you said, and try to quantize ssd-mobilenet v1 model as below:\npython quantize_graph_new.py --input=frozen_inference_graph.pb --output_node_names=\"detection_scores,detection_classes,num_detections\" --output=frozen_8bit_graph.pb --mode=eightbit\n\nNext I try to execute inference by using frozen graph \"frozen_8bit_graph.pb\",\nbut still it does not work.... like this.\u2193\u2193\n---------------------------------------------------------------------------\nInvalidArgumentError                      Traceback (most recent call last)\nc:\\users\\s120077.sei\\appdata\\local\\continuum\\anaconda3\\envs\\takubo\\lib\\site-packages\\tensorflow\\python\\framework\\importer.py in import_graph_def(graph_def, input_map, return_elements, name, op_dict, producer_op_list)\n    488           results = c_api.TF_GraphImportGraphDefWithResults(\n--> 489               graph._c_graph, serialized, options)  # pylint: disable=protected-access\n    490           results = c_api_util.ScopedTFImportGraphDefResults(results)\n\nInvalidArgumentError: Node 'FeatureExtractor/MobilenetV1/MobilenetV1/Conv2d_0/BatchNorm/batchnorm/mul_1_eightbit_reshape___hat__FeatureExtractor/Assert/Assert': Control dependencies must come after regular dependencies\n\nDuring handling of the above exception, another exception occurred:\n\nValueError                                Traceback (most recent call last)\n in ()\n     15     serialized_graph = fid.read()\n     16     od_graph_def.ParseFromString(serialized_graph)\n---> 17     tf.import_graph_def(od_graph_def, name='')\n     18 \n     19 \n\nc:\\users\\s120077.sei\\appdata\\local\\continuum\\anaconda3\\envs\\takubo\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py in new_func(*args, **kwargs)\n    430                 'in a future version' if date is None else ('after %s' % date),\n    431                 instructions)\n--> 432       return func(*args, **kwargs)\n    433     return tf_decorator.make_decorator(func, new_func, 'deprecated',\n    434                                        _add_deprecated_arg_notice_to_docstring(\n\nc:\\users\\s120077.sei\\appdata\\local\\continuum\\anaconda3\\envs\\takubo\\lib\\site-packages\\tensorflow\\python\\framework\\importer.py in import_graph_def(graph_def, input_map, return_elements, name, op_dict, producer_op_list)\n    491         except errors.InvalidArgumentError as e:\n    492           # Convert to ValueError for backwards compatibility.\n--> 493           raise ValueError(str(e))\n    494 \n    495       # Create _DefinedFunctions for any imported functions.\n\nValueError: Node 'FeatureExtractor/MobilenetV1/MobilenetV1/Conv2d_0/BatchNorm/batchnorm/mul_1_eightbit_reshape___hat__FeatureExtractor/Assert/Assert': Control dependencies must come after regular dependencies\n\n\nI could execute inference program by using no quantized model.\nIf you know, please tell me why the program does not work.", "body": "@alexcdot Thank you so much for replying me!\r\nI updated \"quantize_graph.py\" as you said, and try to quantize ssd-mobilenet v1 model as below:\r\n<pre>\r\npython quantize_graph_new.py --input=frozen_inference_graph.pb --output_node_names=\"detection_scores,detection_classes,num_detections\" --output=frozen_8bit_graph.pb --mode=eightbit\r\n</pre>\r\n\r\nNext I try to execute inference by using frozen graph \"frozen_8bit_graph.pb\",\r\nbut still it does not work.... like this.\u2193\u2193\r\n<pre>\r\n---------------------------------------------------------------------------\r\nInvalidArgumentError                      Traceback (most recent call last)\r\nc:\\users\\s120077.sei\\appdata\\local\\continuum\\anaconda3\\envs\\takubo\\lib\\site-packages\\tensorflow\\python\\framework\\importer.py in import_graph_def(graph_def, input_map, return_elements, name, op_dict, producer_op_list)\r\n    488           results = c_api.TF_GraphImportGraphDefWithResults(\r\n--> 489               graph._c_graph, serialized, options)  # pylint: disable=protected-access\r\n    490           results = c_api_util.ScopedTFImportGraphDefResults(results)\r\n\r\nInvalidArgumentError: Node 'FeatureExtractor/MobilenetV1/MobilenetV1/Conv2d_0/BatchNorm/batchnorm/mul_1_eightbit_reshape___hat__FeatureExtractor/Assert/Assert': Control dependencies must come after regular dependencies\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-5-88c9617d43b8> in <module>()\r\n     15     serialized_graph = fid.read()\r\n     16     od_graph_def.ParseFromString(serialized_graph)\r\n---> 17     tf.import_graph_def(od_graph_def, name='')\r\n     18 \r\n     19 \r\n\r\nc:\\users\\s120077.sei\\appdata\\local\\continuum\\anaconda3\\envs\\takubo\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py in new_func(*args, **kwargs)\r\n    430                 'in a future version' if date is None else ('after %s' % date),\r\n    431                 instructions)\r\n--> 432       return func(*args, **kwargs)\r\n    433     return tf_decorator.make_decorator(func, new_func, 'deprecated',\r\n    434                                        _add_deprecated_arg_notice_to_docstring(\r\n\r\nc:\\users\\s120077.sei\\appdata\\local\\continuum\\anaconda3\\envs\\takubo\\lib\\site-packages\\tensorflow\\python\\framework\\importer.py in import_graph_def(graph_def, input_map, return_elements, name, op_dict, producer_op_list)\r\n    491         except errors.InvalidArgumentError as e:\r\n    492           # Convert to ValueError for backwards compatibility.\r\n--> 493           raise ValueError(str(e))\r\n    494 \r\n    495       # Create _DefinedFunctions for any imported functions.\r\n\r\nValueError: Node 'FeatureExtractor/MobilenetV1/MobilenetV1/Conv2d_0/BatchNorm/batchnorm/mul_1_eightbit_reshape___hat__FeatureExtractor/Assert/Assert': Control dependencies must come after regular dependencies\r\n\r\n</pre>\r\n\r\nI could execute inference program by using no quantized model.\r\nIf you know, please tell me why the program does not work."}