{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13983", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13983/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13983/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13983/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/13983", "id": 268556765, "node_id": "MDU6SXNzdWUyNjg1NTY3NjU=", "number": 13983, "title": "gradient not working with aggregation on TensorArray in tf.while_loop", "user": {"login": "ecsark", "id": 1857013, "node_id": "MDQ6VXNlcjE4NTcwMTM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1857013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecsark", "html_url": "https://github.com/ecsark", "followers_url": "https://api.github.com/users/ecsark/followers", "following_url": "https://api.github.com/users/ecsark/following{/other_user}", "gists_url": "https://api.github.com/users/ecsark/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecsark/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecsark/subscriptions", "organizations_url": "https://api.github.com/users/ecsark/orgs", "repos_url": "https://api.github.com/users/ecsark/repos", "events_url": "https://api.github.com/users/ecsark/events{/privacy}", "received_events_url": "https://api.github.com/users/ecsark/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2017-10-25T21:32:30Z", "updated_at": "2018-05-26T18:36:58Z", "closed_at": "2018-05-26T18:36:58Z", "author_association": "NONE", "body_html": "<h3>Problem description</h3>\n<p>I am trying to compute gradient of an aggregation on the currently available elements in <code>tf.TensorArray</code> in a <code>tf.while_loop</code>, but got an <code>InvalidArgumentError: TensorArray TensorArray_4_21@while_63/gradients: Could not write to TensorArray index 0 because it has already been read.</code></p>\n<h3>Minimum code to reproduce the error</h3>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">def</span> <span class=\"pl-en\">make_loop_test</span>():\n\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">_cond</span>(<span class=\"pl-smi\">i</span>, <span class=\"pl-k\">*</span><span class=\"pl-smi\">_</span>):\n        <span class=\"pl-k\">return</span> i <span class=\"pl-k\">&lt;</span> <span class=\"pl-c1\">3</span>\n\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">_body</span>(<span class=\"pl-smi\">i</span>, <span class=\"pl-smi\">var</span>, <span class=\"pl-smi\">var_hist</span>):\n        <span class=\"pl-c\"><span class=\"pl-c\">#</span> write current element</span>\n        var_hist <span class=\"pl-k\">=</span> var_hist.write(i, var)\n\n        <span class=\"pl-c\"><span class=\"pl-c\">#</span> retrieve all current previous elements as well as the one appended just now, and compute the sum</span>\n        util <span class=\"pl-k\">=</span> tf.reduce_sum(var_hist.gather(tf.range(<span class=\"pl-c1\">0</span>, i<span class=\"pl-k\">+</span><span class=\"pl-c1\">1</span>))) <span class=\"pl-k\">*</span> <span class=\"pl-c1\">2.0</span> <span class=\"pl-k\">+</span> <span class=\"pl-c1\">1.0</span>\n\n        <span class=\"pl-c\"><span class=\"pl-c\">#</span> take gradient, where I think the problem comes from</span>\n        grad <span class=\"pl-k\">=</span> tf.gradients(util, [var])[<span class=\"pl-c1\">0</span>]\n\n        <span class=\"pl-k\">return</span> i <span class=\"pl-k\">+</span> <span class=\"pl-c1\">1</span>, var <span class=\"pl-k\">-</span> grad <span class=\"pl-k\">*</span> <span class=\"pl-c1\">0.1</span>, var_hist\n\n    _init_state <span class=\"pl-k\">=</span> (<span class=\"pl-c1\">0</span>, <span class=\"pl-c1\">2e3</span>, tf.TensorArray(<span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>tf.float32, <span class=\"pl-v\">size</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">3</span>, <span class=\"pl-v\">clear_after_read</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">False</span>))\n\n    loop_i, loop_var, loop_var_hist <span class=\"pl-k\">=</span> tf.while_loop(_cond, _body, _init_state, <span class=\"pl-v\">parallel_iterations</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">1</span>)\n\n    <span class=\"pl-k\">return</span> loop_i, loop_var, loop_var_hist.stack()\n\n<span class=\"pl-k\">with</span> tf.Session() <span class=\"pl-k\">as</span> sess:\n    <span class=\"pl-c1\">print</span>(sess.run(make_loop_test()))</pre></div>\n<p>I used to add a bunch of tf.Print statements and found the error was coming from gradient statement in the second iteration. The error message looks weird to me since I am not writing to index 0 at that time.</p>\n<h3>Complete logs</h3>\n<pre><code>File \"&lt;ipython-input-132-3da3dc3dd8f4&gt;\", line 18, in &lt;module&gt;\n  print(sess.run(make_loop_test()))\nFile \"&lt;ipython-input-132-3da3dc3dd8f4&gt;\", line 13, in make_loop_test\n  loop_i, loop_var, loop_var_hist = tf.while_loop(_cond, _body, _init_state, parallel_iterations=1)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2775, in while_loop\n  result = context.BuildLoop(cond, body, loop_vars, shape_invariants)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2604, in BuildLoop\n  pred, body, original_loop_vars, loop_vars, shape_invariants)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2554, in _BuildLoop\n  body_result = body(*packed_vars_for_body)\nFile \"&lt;ipython-input-132-3da3dc3dd8f4&gt;\", line 8, in _body\n  grad = tf.gradients(util, [var])[0]\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 542, in gradients\n  grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 348, in _MaybeCompile\n  return grad_fn()  # Exit early\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 542, in &lt;lambda&gt;\n  grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_grad.py\", line 162, in _TensorArrayGatherGrad\n  u_g = g.scatter(indices, grad)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/util/tf_should_use.py\", line 175, in wrapped\n  return _add_should_use_warning(fn(*args, **kwargs))\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 441, in scatter\n  name=name)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 2649, in _tensor_array_scatter_v3\n  name=name)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 767, in apply_op\n  op_def=op_def)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2630, in create_op\n  original_op=self._default_original_op, op_def=op_def)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1204, in __init__\n  self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\n...which was originally created as op 'while_62/TensorArrayGatherV3', defined at:\nFile \"/home/ecsark/envs/conda/lib/python3.5/runpy.py\", line 193, in _run_module_as_main\n  \"__main__\", mod_spec)\n[elided 23 identical lines from previous traceback]\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2554, in _BuildLoop\n  body_result = body(*packed_vars_for_body)\nFile \"&lt;ipython-input-132-3da3dc3dd8f4&gt;\", line 7, in _body\n  util = tf.reduce_sum(var_hist.gather(tf.range(0, i+1))) * 2.0 + 1.0\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/util/tf_should_use.py\", line 93, in fn\n  return method(self, *args, **kwargs)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 360, in gather\n  element_shape=element_shape)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 2401, in _tensor_array_gather_v3\n  element_shape=element_shape, name=name)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 767, in apply_op\n  op_def=op_def)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2630, in create_op\n  original_op=self._default_original_op, op_def=op_def)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1204, in __init__\n  self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\nInvalidArgumentError (see above for traceback): TensorArray TensorArray_3_20@while_62/gradients: Could not write to TensorArray index 0 because it has already been read.\n [[Node: while_62/gradients/while_62/TensorArrayGatherV3_grad/TensorArrayScatter/TensorArrayScatterV3 = TensorArrayScatterV3[T=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](while_62/gradients/while_62/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3, while_62/range, while_62/gradients/while_62/Sum_grad/Tile, while_62/gradients/while_62/TensorArrayGatherV3_grad/TensorArrayGrad/gradient_flow)]]\n</code></pre>\n<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: No</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Debian GNU/Linux 7.11 (wheezy)</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: v1.3.1-0-g48c54ee 1.3.1</li>\n<li><strong>Python version</strong>:  3.5.4</li>\n<li><strong>Bazel version (if compiling from source)</strong>:</li>\n<li><strong>CUDA/cuDNN version</strong>: NA</li>\n<li><strong>GPU model and memory</strong>: NA</li>\n</ul>", "body_text": "Problem description\nI am trying to compute gradient of an aggregation on the currently available elements in tf.TensorArray in a tf.while_loop, but got an InvalidArgumentError: TensorArray TensorArray_4_21@while_63/gradients: Could not write to TensorArray index 0 because it has already been read.\nMinimum code to reproduce the error\ndef make_loop_test():\n\n    def _cond(i, *_):\n        return i < 3\n\n    def _body(i, var, var_hist):\n        # write current element\n        var_hist = var_hist.write(i, var)\n\n        # retrieve all current previous elements as well as the one appended just now, and compute the sum\n        util = tf.reduce_sum(var_hist.gather(tf.range(0, i+1))) * 2.0 + 1.0\n\n        # take gradient, where I think the problem comes from\n        grad = tf.gradients(util, [var])[0]\n\n        return i + 1, var - grad * 0.1, var_hist\n\n    _init_state = (0, 2e3, tf.TensorArray(dtype=tf.float32, size=3, clear_after_read=False))\n\n    loop_i, loop_var, loop_var_hist = tf.while_loop(_cond, _body, _init_state, parallel_iterations=1)\n\n    return loop_i, loop_var, loop_var_hist.stack()\n\nwith tf.Session() as sess:\n    print(sess.run(make_loop_test()))\nI used to add a bunch of tf.Print statements and found the error was coming from gradient statement in the second iteration. The error message looks weird to me since I am not writing to index 0 at that time.\nComplete logs\nFile \"<ipython-input-132-3da3dc3dd8f4>\", line 18, in <module>\n  print(sess.run(make_loop_test()))\nFile \"<ipython-input-132-3da3dc3dd8f4>\", line 13, in make_loop_test\n  loop_i, loop_var, loop_var_hist = tf.while_loop(_cond, _body, _init_state, parallel_iterations=1)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2775, in while_loop\n  result = context.BuildLoop(cond, body, loop_vars, shape_invariants)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2604, in BuildLoop\n  pred, body, original_loop_vars, loop_vars, shape_invariants)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2554, in _BuildLoop\n  body_result = body(*packed_vars_for_body)\nFile \"<ipython-input-132-3da3dc3dd8f4>\", line 8, in _body\n  grad = tf.gradients(util, [var])[0]\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 542, in gradients\n  grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 348, in _MaybeCompile\n  return grad_fn()  # Exit early\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 542, in <lambda>\n  grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_grad.py\", line 162, in _TensorArrayGatherGrad\n  u_g = g.scatter(indices, grad)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/util/tf_should_use.py\", line 175, in wrapped\n  return _add_should_use_warning(fn(*args, **kwargs))\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 441, in scatter\n  name=name)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 2649, in _tensor_array_scatter_v3\n  name=name)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 767, in apply_op\n  op_def=op_def)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2630, in create_op\n  original_op=self._default_original_op, op_def=op_def)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1204, in __init__\n  self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\n...which was originally created as op 'while_62/TensorArrayGatherV3', defined at:\nFile \"/home/ecsark/envs/conda/lib/python3.5/runpy.py\", line 193, in _run_module_as_main\n  \"__main__\", mod_spec)\n[elided 23 identical lines from previous traceback]\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2554, in _BuildLoop\n  body_result = body(*packed_vars_for_body)\nFile \"<ipython-input-132-3da3dc3dd8f4>\", line 7, in _body\n  util = tf.reduce_sum(var_hist.gather(tf.range(0, i+1))) * 2.0 + 1.0\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/util/tf_should_use.py\", line 93, in fn\n  return method(self, *args, **kwargs)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 360, in gather\n  element_shape=element_shape)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 2401, in _tensor_array_gather_v3\n  element_shape=element_shape, name=name)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 767, in apply_op\n  op_def=op_def)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2630, in create_op\n  original_op=self._default_original_op, op_def=op_def)\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1204, in __init__\n  self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\nInvalidArgumentError (see above for traceback): TensorArray TensorArray_3_20@while_62/gradients: Could not write to TensorArray index 0 because it has already been read.\n [[Node: while_62/gradients/while_62/TensorArrayGatherV3_grad/TensorArrayScatter/TensorArrayScatterV3 = TensorArrayScatterV3[T=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](while_62/gradients/while_62/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3, while_62/range, while_62/gradients/while_62/Sum_grad/Tile, while_62/gradients/while_62/TensorArrayGatherV3_grad/TensorArrayGrad/gradient_flow)]]\n\nSystem information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): No\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Debian GNU/Linux 7.11 (wheezy)\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below): v1.3.1-0-g48c54ee 1.3.1\nPython version:  3.5.4\nBazel version (if compiling from source):\nCUDA/cuDNN version: NA\nGPU model and memory: NA", "body": "### Problem description\r\nI am trying to compute gradient of an aggregation on the currently available elements in `tf.TensorArray` in a `tf.while_loop`, but got an `InvalidArgumentError: TensorArray TensorArray_4_21@while_63/gradients: Could not write to TensorArray index 0 because it has already been read.`\r\n\r\n### Minimum code to reproduce the error\r\n```python\r\ndef make_loop_test():\r\n\r\n    def _cond(i, *_):\r\n        return i < 3\r\n\r\n    def _body(i, var, var_hist):\r\n        # write current element\r\n        var_hist = var_hist.write(i, var)\r\n\r\n        # retrieve all current previous elements as well as the one appended just now, and compute the sum\r\n        util = tf.reduce_sum(var_hist.gather(tf.range(0, i+1))) * 2.0 + 1.0\r\n\r\n        # take gradient, where I think the problem comes from\r\n        grad = tf.gradients(util, [var])[0]\r\n\r\n        return i + 1, var - grad * 0.1, var_hist\r\n\r\n    _init_state = (0, 2e3, tf.TensorArray(dtype=tf.float32, size=3, clear_after_read=False))\r\n\r\n    loop_i, loop_var, loop_var_hist = tf.while_loop(_cond, _body, _init_state, parallel_iterations=1)\r\n\r\n    return loop_i, loop_var, loop_var_hist.stack()\r\n\r\nwith tf.Session() as sess:\r\n    print(sess.run(make_loop_test()))\r\n```\r\n\r\nI used to add a bunch of tf.Print statements and found the error was coming from gradient statement in the second iteration. The error message looks weird to me since I am not writing to index 0 at that time.\r\n\r\n\r\n### Complete logs\r\n```\r\nFile \"<ipython-input-132-3da3dc3dd8f4>\", line 18, in <module>\r\n  print(sess.run(make_loop_test()))\r\nFile \"<ipython-input-132-3da3dc3dd8f4>\", line 13, in make_loop_test\r\n  loop_i, loop_var, loop_var_hist = tf.while_loop(_cond, _body, _init_state, parallel_iterations=1)\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2775, in while_loop\r\n  result = context.BuildLoop(cond, body, loop_vars, shape_invariants)\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2604, in BuildLoop\r\n  pred, body, original_loop_vars, loop_vars, shape_invariants)\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2554, in _BuildLoop\r\n  body_result = body(*packed_vars_for_body)\r\nFile \"<ipython-input-132-3da3dc3dd8f4>\", line 8, in _body\r\n  grad = tf.gradients(util, [var])[0]\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 542, in gradients\r\n  grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 348, in _MaybeCompile\r\n  return grad_fn()  # Exit early\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 542, in <lambda>\r\n  grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_grad.py\", line 162, in _TensorArrayGatherGrad\r\n  u_g = g.scatter(indices, grad)\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/util/tf_should_use.py\", line 175, in wrapped\r\n  return _add_should_use_warning(fn(*args, **kwargs))\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 441, in scatter\r\n  name=name)\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 2649, in _tensor_array_scatter_v3\r\n  name=name)\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 767, in apply_op\r\n  op_def=op_def)\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2630, in create_op\r\n  original_op=self._default_original_op, op_def=op_def)\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1204, in __init__\r\n  self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\r\n...which was originally created as op 'while_62/TensorArrayGatherV3', defined at:\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/runpy.py\", line 193, in _run_module_as_main\r\n  \"__main__\", mod_spec)\r\n[elided 23 identical lines from previous traceback]\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 2554, in _BuildLoop\r\n  body_result = body(*packed_vars_for_body)\r\nFile \"<ipython-input-132-3da3dc3dd8f4>\", line 7, in _body\r\n  util = tf.reduce_sum(var_hist.gather(tf.range(0, i+1))) * 2.0 + 1.0\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/util/tf_should_use.py\", line 93, in fn\r\n  return method(self, *args, **kwargs)\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 360, in gather\r\n  element_shape=element_shape)\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 2401, in _tensor_array_gather_v3\r\n  element_shape=element_shape, name=name)\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 767, in apply_op\r\n  op_def=op_def)\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2630, in create_op\r\n  original_op=self._default_original_op, op_def=op_def)\r\nFile \"/home/ecsark/envs/conda/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1204, in __init__\r\n  self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\r\nInvalidArgumentError (see above for traceback): TensorArray TensorArray_3_20@while_62/gradients: Could not write to TensorArray index 0 because it has already been read.\r\n [[Node: while_62/gradients/while_62/TensorArrayGatherV3_grad/TensorArrayScatter/TensorArrayScatterV3 = TensorArrayScatterV3[T=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](while_62/gradients/while_62/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3, while_62/range, while_62/gradients/while_62/Sum_grad/Tile, while_62/gradients/while_62/TensorArrayGatherV3_grad/TensorArrayGrad/gradient_flow)]]\r\n```\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Debian GNU/Linux 7.11 (wheezy)\r\n- **TensorFlow installed from (source or binary)**: binary\r\n- **TensorFlow version (use command below)**: v1.3.1-0-g48c54ee 1.3.1 \r\n- **Python version**:  3.5.4\r\n- **Bazel version (if compiling from source)**:\r\n- **CUDA/cuDNN version**: NA\r\n- **GPU model and memory**: NA"}