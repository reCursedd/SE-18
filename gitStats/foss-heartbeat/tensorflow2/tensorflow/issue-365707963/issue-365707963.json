{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22658", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22658/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22658/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22658/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/22658", "id": 365707963, "node_id": "MDExOlB1bGxSZXF1ZXN0MjE5NTYzOTYx", "number": 22658, "title": "Fix for the broken \"--config=rocm\" build (followup to PR 20277)", "user": {"login": "deven-amd", "id": 36858332, "node_id": "MDQ6VXNlcjM2ODU4MzMy", "avatar_url": "https://avatars2.githubusercontent.com/u/36858332?v=4", "gravatar_id": "", "url": "https://api.github.com/users/deven-amd", "html_url": "https://github.com/deven-amd", "followers_url": "https://api.github.com/users/deven-amd/followers", "following_url": "https://api.github.com/users/deven-amd/following{/other_user}", "gists_url": "https://api.github.com/users/deven-amd/gists{/gist_id}", "starred_url": "https://api.github.com/users/deven-amd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/deven-amd/subscriptions", "organizations_url": "https://api.github.com/users/deven-amd/orgs", "repos_url": "https://api.github.com/users/deven-amd/repos", "events_url": "https://api.github.com/users/deven-amd/events{/privacy}", "received_events_url": "https://api.github.com/users/deven-amd/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 390482148, "node_id": "MDU6TGFiZWwzOTA0ODIxNDg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/awaiting%20review", "name": "awaiting review", "color": "fef2c0", "default": false}, {"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "rmlarsen", "id": 16907534, "node_id": "MDQ6VXNlcjE2OTA3NTM0", "avatar_url": "https://avatars2.githubusercontent.com/u/16907534?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rmlarsen", "html_url": "https://github.com/rmlarsen", "followers_url": "https://api.github.com/users/rmlarsen/followers", "following_url": "https://api.github.com/users/rmlarsen/following{/other_user}", "gists_url": "https://api.github.com/users/rmlarsen/gists{/gist_id}", "starred_url": "https://api.github.com/users/rmlarsen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rmlarsen/subscriptions", "organizations_url": "https://api.github.com/users/rmlarsen/orgs", "repos_url": "https://api.github.com/users/rmlarsen/repos", "events_url": "https://api.github.com/users/rmlarsen/events{/privacy}", "received_events_url": "https://api.github.com/users/rmlarsen/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "rmlarsen", "id": 16907534, "node_id": "MDQ6VXNlcjE2OTA3NTM0", "avatar_url": "https://avatars2.githubusercontent.com/u/16907534?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rmlarsen", "html_url": "https://github.com/rmlarsen", "followers_url": "https://api.github.com/users/rmlarsen/followers", "following_url": "https://api.github.com/users/rmlarsen/following{/other_user}", "gists_url": "https://api.github.com/users/rmlarsen/gists{/gist_id}", "starred_url": "https://api.github.com/users/rmlarsen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rmlarsen/subscriptions", "organizations_url": "https://api.github.com/users/rmlarsen/orgs", "repos_url": "https://api.github.com/users/rmlarsen/repos", "events_url": "https://api.github.com/users/rmlarsen/events{/privacy}", "received_events_url": "https://api.github.com/users/rmlarsen/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2018-10-02T01:50:43Z", "updated_at": "2018-10-30T21:44:15Z", "closed_at": "2018-10-30T21:44:15Z", "author_association": "NONE", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/22658", "html_url": "https://github.com/tensorflow/tensorflow/pull/22658", "diff_url": "https://github.com/tensorflow/tensorflow/pull/22658.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/22658.patch"}, "body_html": "<p>This is more of a followup to PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"335455607\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/20277\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/20277/hovercard\" href=\"https://github.com/tensorflow/tensorflow/pull/20277\">#20277</a></p>\n<p>As per the following comment by <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1192265\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/yifeif\">@yifeif</a><br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"335455607\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/20277\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/20277/hovercard?comment_id=425178770&amp;comment_type=issue_comment\" href=\"https://github.com/tensorflow/tensorflow/pull/20277#issuecomment-425178770\">#20277 (comment)</a></p>\n<p><code>if_cuda_is_configured</code> was changed to <code>if_cuda</code> in the merge to make some internal targets pass. Unfortunately it seems that doing so break the <code>ROCm</code> build.</p>\n<p>When I try to do a <code>ROCm</code> build on a clean repo (post PR 20277 <code>master</code> branch), I get the following errors</p>\n<pre><code>  Successfully uninstalled tensorflow-1.10.0\nERROR: /root/tensorflow/tensorflow/contrib/tensor_forest/BUILD:110:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'tensor_forest_kernels'\nERROR: /root/tensorflow/tensorflow/contrib/tensor_forest/BUILD:220:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'model_ops_kernels'\nERROR: /root/tensorflow/tensorflow/contrib/tensor_forest/BUILD:315:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'stats_ops_kernels'\nERROR: /root/tensorflow/tensorflow/contrib/boosted_trees/BUILD:324:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'model_ops_kernels'\nERROR: /root/tensorflow/tensorflow/contrib/boosted_trees/BUILD:395:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'split_handler_ops_kernels'\nERROR: /root/tensorflow/tensorflow/contrib/boosted_trees/BUILD:439:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'training_ops_kernels'\nERROR: /root/tensorflow/tensorflow/contrib/boosted_trees/BUILD:486:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'prediction_ops_kernels'\nERROR: /root/tensorflow/tensorflow/contrib/boosted_trees/BUILD:534:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'quantile_ops_kernels'\nERROR: /root/tensorflow/tensorflow/contrib/boosted_trees/BUILD:578:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'stats_accumulator_ops_kernels'\n</code></pre>\n<p>The following commands can be used to do the <code>ROCm</code> build</p>\n<pre><code>&lt;run configure.py to enable the ROCm support&gt;\nbazel build --config=opt --config=rocm //tensorflow/tools/pip_package:build_pip_package \n</code></pre>\n<p>This build does complete without any errors with the commit in this PR.<br>\nI realize that this commit will most likely cause regressions in the internal targets/builds that <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1192265\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/yifeif\">@yifeif</a> eluded to in the comment. So we need to come up with a solution that makes everything work, and we will need your help in that matter.</p>", "body_text": "This is more of a followup to PR #20277\nAs per the following comment by @yifeif\n#20277 (comment)\nif_cuda_is_configured was changed to if_cuda in the merge to make some internal targets pass. Unfortunately it seems that doing so break the ROCm build.\nWhen I try to do a ROCm build on a clean repo (post PR 20277 master branch), I get the following errors\n  Successfully uninstalled tensorflow-1.10.0\nERROR: /root/tensorflow/tensorflow/contrib/tensor_forest/BUILD:110:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'tensor_forest_kernels'\nERROR: /root/tensorflow/tensorflow/contrib/tensor_forest/BUILD:220:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'model_ops_kernels'\nERROR: /root/tensorflow/tensorflow/contrib/tensor_forest/BUILD:315:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'stats_ops_kernels'\nERROR: /root/tensorflow/tensorflow/contrib/boosted_trees/BUILD:324:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'model_ops_kernels'\nERROR: /root/tensorflow/tensorflow/contrib/boosted_trees/BUILD:395:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'split_handler_ops_kernels'\nERROR: /root/tensorflow/tensorflow/contrib/boosted_trees/BUILD:439:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'training_ops_kernels'\nERROR: /root/tensorflow/tensorflow/contrib/boosted_trees/BUILD:486:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'prediction_ops_kernels'\nERROR: /root/tensorflow/tensorflow/contrib/boosted_trees/BUILD:534:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'quantile_ops_kernels'\nERROR: /root/tensorflow/tensorflow/contrib/boosted_trees/BUILD:578:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'stats_accumulator_ops_kernels'\n\nThe following commands can be used to do the ROCm build\n<run configure.py to enable the ROCm support>\nbazel build --config=opt --config=rocm //tensorflow/tools/pip_package:build_pip_package \n\nThis build does complete without any errors with the commit in this PR.\nI realize that this commit will most likely cause regressions in the internal targets/builds that @yifeif eluded to in the comment. So we need to come up with a solution that makes everything work, and we will need your help in that matter.", "body": "This is more of a followup to PR #20277 \r\n\r\nAs per the following comment by @yifeif \r\nhttps://github.com/tensorflow/tensorflow/pull/20277#issuecomment-425178770\r\n\r\n`if_cuda_is_configured` was changed to `if_cuda` in the merge to make some internal targets pass. Unfortunately it seems that doing so break the `ROCm` build.\r\n\r\nWhen I try to do a `ROCm` build on a clean repo (post PR 20277 `master` branch), I get the following errors\r\n```\r\n  Successfully uninstalled tensorflow-1.10.0\r\nERROR: /root/tensorflow/tensorflow/contrib/tensor_forest/BUILD:110:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'tensor_forest_kernels'\r\nERROR: /root/tensorflow/tensorflow/contrib/tensor_forest/BUILD:220:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'model_ops_kernels'\r\nERROR: /root/tensorflow/tensorflow/contrib/tensor_forest/BUILD:315:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'stats_ops_kernels'\r\nERROR: /root/tensorflow/tensorflow/contrib/boosted_trees/BUILD:324:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'model_ops_kernels'\r\nERROR: /root/tensorflow/tensorflow/contrib/boosted_trees/BUILD:395:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'split_handler_ops_kernels'\r\nERROR: /root/tensorflow/tensorflow/contrib/boosted_trees/BUILD:439:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'training_ops_kernels'\r\nERROR: /root/tensorflow/tensorflow/contrib/boosted_trees/BUILD:486:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'prediction_ops_kernels'\r\nERROR: /root/tensorflow/tensorflow/contrib/boosted_trees/BUILD:534:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'quantile_ops_kernels'\r\nERROR: /root/tensorflow/tensorflow/contrib/boosted_trees/BUILD:578:1: Label '//tensorflow/core:gpu_lib' is duplicated in the 'deps' attribute of rule 'stats_accumulator_ops_kernels'\r\n```\r\n\r\nThe following commands can be used to do the `ROCm` build\r\n```\r\n<run configure.py to enable the ROCm support>\r\nbazel build --config=opt --config=rocm //tensorflow/tools/pip_package:build_pip_package \r\n```\r\n\r\nThis build does complete without any errors with the commit in this PR.\r\nI realize that this commit will most likely cause regressions in the internal targets/builds that @yifeif eluded to in the comment. So we need to come up with a solution that makes everything work, and we will need your help in that matter."}