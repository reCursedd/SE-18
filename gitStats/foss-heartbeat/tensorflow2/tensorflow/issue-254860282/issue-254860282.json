{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12776", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12776/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12776/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12776/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/12776", "id": 254860282, "node_id": "MDU6SXNzdWUyNTQ4NjAyODI=", "number": 12776, "title": "nest.flatten() does not work with list", "user": {"login": "eloyfer", "id": 17128370, "node_id": "MDQ6VXNlcjE3MTI4Mzcw", "avatar_url": "https://avatars0.githubusercontent.com/u/17128370?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eloyfer", "html_url": "https://github.com/eloyfer", "followers_url": "https://api.github.com/users/eloyfer/followers", "following_url": "https://api.github.com/users/eloyfer/following{/other_user}", "gists_url": "https://api.github.com/users/eloyfer/gists{/gist_id}", "starred_url": "https://api.github.com/users/eloyfer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eloyfer/subscriptions", "organizations_url": "https://api.github.com/users/eloyfer/orgs", "repos_url": "https://api.github.com/users/eloyfer/repos", "events_url": "https://api.github.com/users/eloyfer/events{/privacy}", "received_events_url": "https://api.github.com/users/eloyfer/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-09-03T08:06:58Z", "updated_at": "2017-09-03T19:38:29Z", "closed_at": "2017-09-03T19:38:28Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<p>== cat /etc/issue ===============================================<br>\nLinux mews3153 3.16.0-4-amd64 <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"115886302\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/1\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/1/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/1\">#1</a> SMP Debian 3.16.36-1+deb8u2 (2016-10-19) x86_64 GNU/Linux<br>\nVERSION_ID=\"8\"<br>\nVERSION=\"8 (jessie)\"</p>\n<p>== are we in docker =============================================<br>\nNo</p>\n<p>== compiler =====================================================<br>\nc++ (Debian 4.9.2-10) 4.9.2<br>\nCopyright (C) 2014 Free Software Foundation, Inc.<br>\nThis is free software; see the source for copying conditions.  There is NO<br>\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</p>\n<p>== uname -a =====================================================<br>\nLinux mews3153 3.16.0-4-amd64 <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"115886302\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/1\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/1/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/1\">#1</a> SMP Debian 3.16.36-1+deb8u2 (2016-10-19) x86_64 GNU/Linux</p>\n<p>== check pips ===================================================<br>\nnumpy (1.13.1)<br>\nprotobuf (3.4.0)<br>\ntensorflow (1.3.0)<br>\ntensorflow-tensorboard (0.1.5)</p>\n<p>== check for virtualenv =========================================<br>\nTrue</p>\n<p>== tensorflow import ============================================<br>\ntf.VERSION = 1.3.0<br>\ntf.GIT_VERSION = v1.3.0-rc2-20-g0787eee<br>\ntf.COMPILER_VERSION = v1.3.0-rc2-20-g0787eee<br>\nSanity check: array([1], dtype=int32)</p>\n<p>== env ==========================================================<br>\nLD_LIBRARY_PATH /usr/lib/libipp-intel:/opt/boost/lib/:/usr/lib64/:/mobileye/shared/boost-python2.7/lib<br>\nDYLD_LIBRARY_PATH is unset</p>\n<p>== nvidia-smi ===================================================<br>\n/tmp/tf_env_collect.sh: line 105: nvidia-smi: command not found</p>\n<p>== cuda libs  ===================================================</p>\n<h3>Describe the problem</h3>\n<p>The function <em>tensorflow.contrib.data.python.util.nest.flatten</em> fails to flatten a list. Given a flat list, it returns a nested list. This causes a problem in dataset_ops.py, when the datasource is created by zipping several datasources and then attempting to create an iterator.</p>\n<h3>Source code / logs</h3>\n<h4>Example 1:</h4>\n<p>from tensorflow.contrib.data.python.util import nest<br>\nnest.flatten([1,2,3,4])</p>\n<blockquote>\n<p>[[1, 2, 3, 4]]</p>\n</blockquote>\n<p>nest.flatten((1,2,3,4)) # works with a tuple</p>\n<blockquote>\n<p>[1, 2, 3, 4]</p>\n</blockquote>\n<h4>Example 2:</h4>\n<p>import tensorflow as tf</p>\n<p>dataset1 = tf.contrib.data.Dataset.from_tensor_slices(tf.random_uniform([4, 10]))<br>\ndataset2 = tf.contrib.data.Dataset.from_tensor_slices(tf.random_uniform([4]))<br>\ndataset3 = tf.contrib.data.Dataset.zip([dataset1, dataset2])</p>\n<p>iterator = dataset3.make_initializable_iterator()</p>\n<p>sess = tf.InteractiveSession()<br>\nsess.run(iterator.initializer)<br>\nnext1, next2 = iterator.get_next()</p>\n<blockquote>\n<p>running the above code:<br>\nTraceback (most recent call last):<br>\nFile \"/tmp/tds.py\", line 7, in <br>\niterator = dataset3.make_initializable_iterator()<br>\nFile \"/homes/elyassaf/venv/local/lib/python2.7/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 464, in make_initializable_iterator<br>\nreturn Iterator.from_dataset(self, shared_name)<br>\nFile \"/homes/elyassaf/venv/local/lib/python2.7/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 97, in from_dataset<br>\noutput_types=nest.flatten(dataset.output_types),<br>\nFile \"/homes/elyassaf/venv/local/lib/python2.7/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1199, in output_types<br>\nds.output_types for ds in nest.flatten(self._datasets)<br>\nAttributeError: 'list' object has no attribute 'output_types'</p>\n</blockquote>", "body_text": "System information\n== cat /etc/issue ===============================================\nLinux mews3153 3.16.0-4-amd64 #1 SMP Debian 3.16.36-1+deb8u2 (2016-10-19) x86_64 GNU/Linux\nVERSION_ID=\"8\"\nVERSION=\"8 (jessie)\"\n== are we in docker =============================================\nNo\n== compiler =====================================================\nc++ (Debian 4.9.2-10) 4.9.2\nCopyright (C) 2014 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n== uname -a =====================================================\nLinux mews3153 3.16.0-4-amd64 #1 SMP Debian 3.16.36-1+deb8u2 (2016-10-19) x86_64 GNU/Linux\n== check pips ===================================================\nnumpy (1.13.1)\nprotobuf (3.4.0)\ntensorflow (1.3.0)\ntensorflow-tensorboard (0.1.5)\n== check for virtualenv =========================================\nTrue\n== tensorflow import ============================================\ntf.VERSION = 1.3.0\ntf.GIT_VERSION = v1.3.0-rc2-20-g0787eee\ntf.COMPILER_VERSION = v1.3.0-rc2-20-g0787eee\nSanity check: array([1], dtype=int32)\n== env ==========================================================\nLD_LIBRARY_PATH /usr/lib/libipp-intel:/opt/boost/lib/:/usr/lib64/:/mobileye/shared/boost-python2.7/lib\nDYLD_LIBRARY_PATH is unset\n== nvidia-smi ===================================================\n/tmp/tf_env_collect.sh: line 105: nvidia-smi: command not found\n== cuda libs  ===================================================\nDescribe the problem\nThe function tensorflow.contrib.data.python.util.nest.flatten fails to flatten a list. Given a flat list, it returns a nested list. This causes a problem in dataset_ops.py, when the datasource is created by zipping several datasources and then attempting to create an iterator.\nSource code / logs\nExample 1:\nfrom tensorflow.contrib.data.python.util import nest\nnest.flatten([1,2,3,4])\n\n[[1, 2, 3, 4]]\n\nnest.flatten((1,2,3,4)) # works with a tuple\n\n[1, 2, 3, 4]\n\nExample 2:\nimport tensorflow as tf\ndataset1 = tf.contrib.data.Dataset.from_tensor_slices(tf.random_uniform([4, 10]))\ndataset2 = tf.contrib.data.Dataset.from_tensor_slices(tf.random_uniform([4]))\ndataset3 = tf.contrib.data.Dataset.zip([dataset1, dataset2])\niterator = dataset3.make_initializable_iterator()\nsess = tf.InteractiveSession()\nsess.run(iterator.initializer)\nnext1, next2 = iterator.get_next()\n\nrunning the above code:\nTraceback (most recent call last):\nFile \"/tmp/tds.py\", line 7, in \niterator = dataset3.make_initializable_iterator()\nFile \"/homes/elyassaf/venv/local/lib/python2.7/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 464, in make_initializable_iterator\nreturn Iterator.from_dataset(self, shared_name)\nFile \"/homes/elyassaf/venv/local/lib/python2.7/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 97, in from_dataset\noutput_types=nest.flatten(dataset.output_types),\nFile \"/homes/elyassaf/venv/local/lib/python2.7/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1199, in output_types\nds.output_types for ds in nest.flatten(self._datasets)\nAttributeError: 'list' object has no attribute 'output_types'", "body": "\r\n### System information\r\n== cat /etc/issue ===============================================\r\nLinux mews3153 3.16.0-4-amd64 #1 SMP Debian 3.16.36-1+deb8u2 (2016-10-19) x86_64 GNU/Linux\r\nVERSION_ID=\"8\"\r\nVERSION=\"8 (jessie)\"\r\n\r\n== are we in docker =============================================\r\nNo\r\n\r\n== compiler =====================================================\r\nc++ (Debian 4.9.2-10) 4.9.2\r\nCopyright (C) 2014 Free Software Foundation, Inc.\r\nThis is free software; see the source for copying conditions.  There is NO\r\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n\r\n== uname -a =====================================================\r\nLinux mews3153 3.16.0-4-amd64 #1 SMP Debian 3.16.36-1+deb8u2 (2016-10-19) x86_64 GNU/Linux\r\n\r\n== check pips ===================================================\r\nnumpy (1.13.1)\r\nprotobuf (3.4.0)\r\ntensorflow (1.3.0)\r\ntensorflow-tensorboard (0.1.5)\r\n\r\n== check for virtualenv =========================================\r\nTrue\r\n\r\n== tensorflow import ============================================\r\ntf.VERSION = 1.3.0\r\ntf.GIT_VERSION = v1.3.0-rc2-20-g0787eee\r\ntf.COMPILER_VERSION = v1.3.0-rc2-20-g0787eee\r\nSanity check: array([1], dtype=int32)\r\n\r\n== env ==========================================================\r\nLD_LIBRARY_PATH /usr/lib/libipp-intel:/opt/boost/lib/:/usr/lib64/:/mobileye/shared/boost-python2.7/lib\r\nDYLD_LIBRARY_PATH is unset\r\n\r\n== nvidia-smi ===================================================\r\n/tmp/tf_env_collect.sh: line 105: nvidia-smi: command not found\r\n\r\n== cuda libs  ===================================================\r\n\r\n### Describe the problem\r\nThe function *tensorflow.contrib.data.python.util.nest.flatten* fails to flatten a list. Given a flat list, it returns a nested list. This causes a problem in dataset_ops.py, when the datasource is created by zipping several datasources and then attempting to create an iterator.\r\n\r\n### Source code / logs\r\n#### Example 1:\r\nfrom tensorflow.contrib.data.python.util import nest\r\nnest.flatten([1,2,3,4])\r\n> [[1, 2, 3, 4]]\r\n\r\nnest.flatten((1,2,3,4)) # works with a tuple\r\n> [1, 2, 3, 4]\r\n\r\n\r\n#### Example 2:\r\nimport tensorflow as tf\r\n\r\ndataset1 = tf.contrib.data.Dataset.from_tensor_slices(tf.random_uniform([4, 10]))\r\ndataset2 = tf.contrib.data.Dataset.from_tensor_slices(tf.random_uniform([4]))\r\ndataset3 = tf.contrib.data.Dataset.zip([dataset1, dataset2])\r\n\r\niterator = dataset3.make_initializable_iterator()\r\n\r\nsess = tf.InteractiveSession()\r\nsess.run(iterator.initializer)\r\nnext1, next2 = iterator.get_next()\r\n\r\n> running the above code:\r\nTraceback (most recent call last):\r\n  File \"/tmp/tds.py\", line 7, in <module>\r\n    iterator = dataset3.make_initializable_iterator()\r\n  File \"/homes/elyassaf/venv/local/lib/python2.7/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 464, in make_initializable_iterator\r\n    return Iterator.from_dataset(self, shared_name)\r\n  File \"/homes/elyassaf/venv/local/lib/python2.7/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 97, in from_dataset\r\n    output_types=nest.flatten(dataset.output_types),\r\n  File \"/homes/elyassaf/venv/local/lib/python2.7/site-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 1199, in output_types\r\n    ds.output_types for ds in nest.flatten(self._datasets)\r\nAttributeError: 'list' object has no attribute 'output_types'\r\n"}