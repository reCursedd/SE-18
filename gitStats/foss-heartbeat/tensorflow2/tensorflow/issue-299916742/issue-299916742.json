{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17239", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17239/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17239/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17239/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/17239", "id": 299916742, "node_id": "MDExOlB1bGxSZXF1ZXN0MTcxMTY0MzQ1", "number": 17239, "title": "Support GCS URL by tf.estimator.LatestExporter", "user": {"login": "nagachika", "id": 21976, "node_id": "MDQ6VXNlcjIxOTc2", "avatar_url": "https://avatars1.githubusercontent.com/u/21976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagachika", "html_url": "https://github.com/nagachika", "followers_url": "https://api.github.com/users/nagachika/followers", "following_url": "https://api.github.com/users/nagachika/following{/other_user}", "gists_url": "https://api.github.com/users/nagachika/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagachika/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagachika/subscriptions", "organizations_url": "https://api.github.com/users/nagachika/orgs", "repos_url": "https://api.github.com/users/nagachika/repos", "events_url": "https://api.github.com/users/nagachika/events{/privacy}", "received_events_url": "https://api.github.com/users/nagachika/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}, {"id": 987666414, "node_id": "MDU6TGFiZWw5ODc2NjY0MTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/ready%20to%20pull", "name": "ready to pull", "color": "2cd643", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "ispirmustafa", "id": 19293677, "node_id": "MDQ6VXNlcjE5MjkzNjc3", "avatar_url": "https://avatars1.githubusercontent.com/u/19293677?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ispirmustafa", "html_url": "https://github.com/ispirmustafa", "followers_url": "https://api.github.com/users/ispirmustafa/followers", "following_url": "https://api.github.com/users/ispirmustafa/following{/other_user}", "gists_url": "https://api.github.com/users/ispirmustafa/gists{/gist_id}", "starred_url": "https://api.github.com/users/ispirmustafa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ispirmustafa/subscriptions", "organizations_url": "https://api.github.com/users/ispirmustafa/orgs", "repos_url": "https://api.github.com/users/ispirmustafa/repos", "events_url": "https://api.github.com/users/ispirmustafa/events{/privacy}", "received_events_url": "https://api.github.com/users/ispirmustafa/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ispirmustafa", "id": 19293677, "node_id": "MDQ6VXNlcjE5MjkzNjc3", "avatar_url": "https://avatars1.githubusercontent.com/u/19293677?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ispirmustafa", "html_url": "https://github.com/ispirmustafa", "followers_url": "https://api.github.com/users/ispirmustafa/followers", "following_url": "https://api.github.com/users/ispirmustafa/following{/other_user}", "gists_url": "https://api.github.com/users/ispirmustafa/gists{/gist_id}", "starred_url": "https://api.github.com/users/ispirmustafa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ispirmustafa/subscriptions", "organizations_url": "https://api.github.com/users/ispirmustafa/orgs", "repos_url": "https://api.github.com/users/ispirmustafa/repos", "events_url": "https://api.github.com/users/ispirmustafa/events{/privacy}", "received_events_url": "https://api.github.com/users/ispirmustafa/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 13, "created_at": "2018-02-24T06:23:35Z", "updated_at": "2018-08-16T23:03:40Z", "closed_at": "2018-08-16T23:03:40Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/17239", "html_url": "https://github.com/tensorflow/tensorflow/pull/17239", "diff_url": "https://github.com/tensorflow/tensorflow/pull/17239.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/17239.patch"}, "body_html": "<p>I have found that the parameter <code>exports_to_keep</code> of <code>tf.estimator.LatestExporter()</code> is ignored if export_path is GCS URL (like <code>gs://bucket/object/</code>). All exported SavedModel directories are never removed.</p>\n<p>The root cause is that the <code>tf.gfile.ListDirectory</code> returns basenames with file separator '/' at the end if the path was GCS URL.  The <code>_export_version_parser</code> function rejects a path with trailing '/'.</p>\n<p>I don't think the behavior of <code>tf.gfile.ListDirectory</code> is wrong because the semantics of \"path\" in GCS is different from usual filesystems. For example, you can place two different objects in the GCS bucket like <code>gs://bucket/obj</code> and <code>gs://bucket/obj/</code>. So I think <code>tf.gfile.ListDirectory</code> should return basename with '/'.</p>\n<p>I try to fix the issue by eliminating trailing separator at <code>tf.estimator.gc._getpaths()</code>.</p>", "body_text": "I have found that the parameter exports_to_keep of tf.estimator.LatestExporter() is ignored if export_path is GCS URL (like gs://bucket/object/). All exported SavedModel directories are never removed.\nThe root cause is that the tf.gfile.ListDirectory returns basenames with file separator '/' at the end if the path was GCS URL.  The _export_version_parser function rejects a path with trailing '/'.\nI don't think the behavior of tf.gfile.ListDirectory is wrong because the semantics of \"path\" in GCS is different from usual filesystems. For example, you can place two different objects in the GCS bucket like gs://bucket/obj and gs://bucket/obj/. So I think tf.gfile.ListDirectory should return basename with '/'.\nI try to fix the issue by eliminating trailing separator at tf.estimator.gc._getpaths().", "body": "I have found that the parameter `exports_to_keep` of `tf.estimator.LatestExporter()` is ignored if export_path is GCS URL (like `gs://bucket/object/`). All exported SavedModel directories are never removed.\r\n\r\nThe root cause is that the `tf.gfile.ListDirectory` returns basenames with file separator '/' at the end if the path was GCS URL.  The `_export_version_parser` function rejects a path with trailing '/'.\r\n\r\nI don't think the behavior of `tf.gfile.ListDirectory` is wrong because the semantics of \"path\" in GCS is different from usual filesystems. For example, you can place two different objects in the GCS bucket like `gs://bucket/obj` and `gs://bucket/obj/`. So I think `tf.gfile.ListDirectory` should return basename with '/'.\r\n\r\nI try to fix the issue by eliminating trailing separator at `tf.estimator.gc._getpaths()`."}