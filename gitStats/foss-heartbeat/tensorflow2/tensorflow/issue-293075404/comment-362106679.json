{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/362106679", "html_url": "https://github.com/tensorflow/tensorflow/issues/16617#issuecomment-362106679", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16617", "id": 362106679, "node_id": "MDEyOklzc3VlQ29tbWVudDM2MjEwNjY3OQ==", "user": {"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}, "created_at": "2018-01-31T23:31:46Z", "updated_at": "2018-01-31T23:31:46Z", "author_association": "MEMBER", "body_html": "<p>Thanks for the report. This issue isn't specific to eager execution - the underlying problem is that <code>tf.tensordot()</code> utilizes operations on <code>tf.int32</code> tensors, and many operations do not have GPU kernels that support int32. For example, without eager execution, you'll see a similar error:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\n<span class=\"pl-k\">with</span> tf.device(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/gpu:0<span class=\"pl-pds\">\"</span></span>):\n  a <span class=\"pl-k\">=</span> tf.ones([<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">2</span>])\n  b <span class=\"pl-k\">=</span> tf.ones([<span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">1</span>])\n  c <span class=\"pl-k\">=</span> tf.tensordot(a, b, <span class=\"pl-v\">axes</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">1</span>)\n\n<span class=\"pl-k\">with</span> tf.Session() <span class=\"pl-k\">as</span> sess:\n  <span class=\"pl-c1\">print</span>(sess.run(c))</pre></div>\n<p>leads to:</p>\n<pre><code>InvalidArgumentError (see above for traceback): Cannot assign a device for operation 'Tensordot/Gather_3': Could not satisfy explicit device specification '/device:GPU:0' because no supported kernel for GPU devices is available.\n         [[Node: Tensordot/Gather_3 = Gather[Tindices=DT_INT32, Tparams=DT_INT32, validate_indices=true, _device=\"/device:GPU:0\"](Tensordot/Shape_1, Tensordot/add_3)]]\n</code></pre>\n<p>This probably has something to do with the use of <code>gather</code> and other operations with int32 axes here: <a href=\"https://github.com/tensorflow/tensorflow/blob/r1.5/tensorflow/python/ops/math_ops.py#L2751\">https://github.com/tensorflow/tensorflow/blob/r1.5/tensorflow/python/ops/math_ops.py#L2751</a></p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=16907534\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rmlarsen\">@rmlarsen</a> : Could you take a look and comment on the use of <code>tf.tensordot</code> on GPUs?</p>", "body_text": "Thanks for the report. This issue isn't specific to eager execution - the underlying problem is that tf.tensordot() utilizes operations on tf.int32 tensors, and many operations do not have GPU kernels that support int32. For example, without eager execution, you'll see a similar error:\nimport tensorflow as tf\n\nwith tf.device(\"/gpu:0\"):\n  a = tf.ones([1, 2])\n  b = tf.ones([2, 1])\n  c = tf.tensordot(a, b, axes=1)\n\nwith tf.Session() as sess:\n  print(sess.run(c))\nleads to:\nInvalidArgumentError (see above for traceback): Cannot assign a device for operation 'Tensordot/Gather_3': Could not satisfy explicit device specification '/device:GPU:0' because no supported kernel for GPU devices is available.\n         [[Node: Tensordot/Gather_3 = Gather[Tindices=DT_INT32, Tparams=DT_INT32, validate_indices=true, _device=\"/device:GPU:0\"](Tensordot/Shape_1, Tensordot/add_3)]]\n\nThis probably has something to do with the use of gather and other operations with int32 axes here: https://github.com/tensorflow/tensorflow/blob/r1.5/tensorflow/python/ops/math_ops.py#L2751\n@rmlarsen : Could you take a look and comment on the use of tf.tensordot on GPUs?", "body": "Thanks for the report. This issue isn't specific to eager execution - the underlying problem is that `tf.tensordot()` utilizes operations on `tf.int32` tensors, and many operations do not have GPU kernels that support int32. For example, without eager execution, you'll see a similar error:\r\n\r\n```python\r\nimport tensorflow as tf\r\n\r\nwith tf.device(\"/gpu:0\"):\r\n  a = tf.ones([1, 2])\r\n  b = tf.ones([2, 1])\r\n  c = tf.tensordot(a, b, axes=1)\r\n\r\nwith tf.Session() as sess:\r\n  print(sess.run(c))\r\n```\r\nleads to:\r\n\r\n```\r\nInvalidArgumentError (see above for traceback): Cannot assign a device for operation 'Tensordot/Gather_3': Could not satisfy explicit device specification '/device:GPU:0' because no supported kernel for GPU devices is available.\r\n         [[Node: Tensordot/Gather_3 = Gather[Tindices=DT_INT32, Tparams=DT_INT32, validate_indices=true, _device=\"/device:GPU:0\"](Tensordot/Shape_1, Tensordot/add_3)]]\r\n```\r\n\r\nThis probably has something to do with the use of `gather` and other operations with int32 axes here: https://github.com/tensorflow/tensorflow/blob/r1.5/tensorflow/python/ops/math_ops.py#L2751\r\n\r\n@rmlarsen : Could you take a look and comment on the use of `tf.tensordot` on GPUs?"}