{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7159", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7159/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7159/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7159/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/7159", "id": 204240745, "node_id": "MDU6SXNzdWUyMDQyNDA3NDU=", "number": 7159, "title": "Tensorflow restore doesn't work on AWS", "user": {"login": "yonatanaol", "id": 17764484, "node_id": "MDQ6VXNlcjE3NzY0NDg0", "avatar_url": "https://avatars3.githubusercontent.com/u/17764484?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yonatanaol", "html_url": "https://github.com/yonatanaol", "followers_url": "https://api.github.com/users/yonatanaol/followers", "following_url": "https://api.github.com/users/yonatanaol/following{/other_user}", "gists_url": "https://api.github.com/users/yonatanaol/gists{/gist_id}", "starred_url": "https://api.github.com/users/yonatanaol/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yonatanaol/subscriptions", "organizations_url": "https://api.github.com/users/yonatanaol/orgs", "repos_url": "https://api.github.com/users/yonatanaol/repos", "events_url": "https://api.github.com/users/yonatanaol/events{/privacy}", "received_events_url": "https://api.github.com/users/yonatanaol/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2017-01-31T09:19:35Z", "updated_at": "2018-03-24T11:42:59Z", "closed_at": "2017-01-31T15:05:11Z", "author_association": "NONE", "body_html": "<p>I am running a script that perfectly works on ubuntu 14.04, docker over ubuntu 14.04, docker over MAC OS - but doesn't work on ubuntu 16 on AWS.<br>\nthe script is:</p>\n<pre><code>import tensorflow as tf\nimport os\n\ndef load_model_to_session(session, model_dir, meta_file, ckpt_file):\n    model_dir_exp = os.path.expanduser(model_dir)\n    saver = tf.train.import_meta_graph(os.path.join(model_dir_exp, meta_file))\n    saver.restore(session, os.path.join(model_dir_exp, ckpt_file))\n\nsession = tf.Session()\nprint ('loading models')\nmodel_dir = '/data/model'\nmeta_file, ckpt_file = 'a.meta', 'a.ckpt'\nprint ('ckpt file ' + ckpt_file)\nload_model_to_session(session, model_dir, meta_file, ckpt_file)\nprint ('finish loading the model')\nsession.close()\n\n</code></pre>\n<p>the errors i get:</p>\n<blockquote>\n<p>W tensorflow/core/framework/op_kernel.cc:975] Data loss: Unable to open table file /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?<br>\nW tensorflow/core/util/tensor_slice_reader.cc:95] Could not open /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?<br>\nW tensorflow/core/util/tensor_slice_reader.cc:95] Could not open /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?<br>\nW tensorflow/core/framework/op_kernel.cc:975] Data loss: Unable to open table file /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?<br>\nW tensorflow/core/util/tensor_slice_reader.cc:95] Could not open /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?<br>\nW tensorflow/core/framework/op_kernel.cc:975] Data loss: Unable to open table file /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?<br>\nTraceback (most recent call last):<br>\nFile \"/tmp/runner.py\", line 35, in <br>\nload_model_to_session(session, model_dir, meta_file, ckpt_file)<br>\nFile \"/tmp/runner.py\", line 7, in load_model_to_session<br>\nsaver.restore(session, os.path.join(model_dir_exp, ckpt_file))<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py\", line 1388, in restore<br>\n{self.saver_def.filename_tensor_name: save_path})<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 766, in run<br>\nrun_metadata_ptr)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 964, in _run<br>\nfeed_dict_string, options, run_metadata)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1014, in _do_run<br>\ntarget_list, options, run_metadata)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1034, in _do_call<br>\nraise type(e)(node_def, op, message)<br>\ntensorflow.python.framework.errors_impl.DataLossError: Unable to open table file /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?<br>\n[[Node: save/restore_slice_318 = RestoreSlice[dt=DT_FLOAT, preferred_shard=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](_recv_save/Const_0, save/restore_slice_318/tensor_name, save/restore_slice_318/shape_and_slice)]]</p>\n<p>Caused by op u'save/restore_slice_318', defined at:<br>\nFile \"/tmp/runner.py\", line 35, in <br>\nload_model_to_session(session, model_dir, meta_file, ckpt_file)<br>\nFile \"/tmp/runner.py\", line 6, in load_model_to_session<br>\nsaver = tf.train.import_meta_graph(os.path.join(model_dir_exp, meta_file))<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py\", line 1526, in import_meta_graph<br>\n**kwargs)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/meta_graph.py\", line 502, in import_scoped_meta_graph<br>\nproducer_op_list=producer_op_list)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/importer.py\", line 285, in import_graph_def<br>\nop_def=op_def)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2240, in create_op<br>\noriginal_op=self._default_original_op, op_def=op_def)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1128, in <strong>init</strong><br>\nself._traceback = _extract_stack()</p>\n<p>DataLossError (see above for traceback): Unable to open table file /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?<br>\n[[Node: save/restore_slice_318 = RestoreSlice[dt=DT_FLOAT, preferred_shard=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](_recv_save/Const_0, save/restore_slice_318/tensor_name, save/restore_slice_318/shape_and_slice)]]</p>\n</blockquote>\n<p>in order to reproduce this, you can use the pre-trained open source model here:<br>\n<a href=\"https://drive.google.com/file/d/0B5MzpY9kBtDVSTgxX25ZQzNTMGc/view\" rel=\"nofollow\">https://drive.google.com/file/d/0B5MzpY9kBtDVSTgxX25ZQzNTMGc/view</a></p>\n<p>I'm using tensorflow (python) 0.12.1 .</p>\n<p>I suspect that it has something to do with the virtualization (AWS).</p>\n<p>BTW, the code works on the pretrained model <a href=\"http://download.tensorflow.org/models/inception_v1_2016_08_28.tar.gz\" rel=\"nofollow\">http://download.tensorflow.org/models/inception_v1_2016_08_28.tar.gz</a></p>", "body_text": "I am running a script that perfectly works on ubuntu 14.04, docker over ubuntu 14.04, docker over MAC OS - but doesn't work on ubuntu 16 on AWS.\nthe script is:\nimport tensorflow as tf\nimport os\n\ndef load_model_to_session(session, model_dir, meta_file, ckpt_file):\n    model_dir_exp = os.path.expanduser(model_dir)\n    saver = tf.train.import_meta_graph(os.path.join(model_dir_exp, meta_file))\n    saver.restore(session, os.path.join(model_dir_exp, ckpt_file))\n\nsession = tf.Session()\nprint ('loading models')\nmodel_dir = '/data/model'\nmeta_file, ckpt_file = 'a.meta', 'a.ckpt'\nprint ('ckpt file ' + ckpt_file)\nload_model_to_session(session, model_dir, meta_file, ckpt_file)\nprint ('finish loading the model')\nsession.close()\n\n\nthe errors i get:\n\nW tensorflow/core/framework/op_kernel.cc:975] Data loss: Unable to open table file /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\nW tensorflow/core/util/tensor_slice_reader.cc:95] Could not open /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\nW tensorflow/core/util/tensor_slice_reader.cc:95] Could not open /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\nW tensorflow/core/framework/op_kernel.cc:975] Data loss: Unable to open table file /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\nW tensorflow/core/util/tensor_slice_reader.cc:95] Could not open /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\nW tensorflow/core/framework/op_kernel.cc:975] Data loss: Unable to open table file /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\nTraceback (most recent call last):\nFile \"/tmp/runner.py\", line 35, in \nload_model_to_session(session, model_dir, meta_file, ckpt_file)\nFile \"/tmp/runner.py\", line 7, in load_model_to_session\nsaver.restore(session, os.path.join(model_dir_exp, ckpt_file))\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py\", line 1388, in restore\n{self.saver_def.filename_tensor_name: save_path})\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 766, in run\nrun_metadata_ptr)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 964, in _run\nfeed_dict_string, options, run_metadata)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1014, in _do_run\ntarget_list, options, run_metadata)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1034, in _do_call\nraise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.DataLossError: Unable to open table file /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\n[[Node: save/restore_slice_318 = RestoreSlice[dt=DT_FLOAT, preferred_shard=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](_recv_save/Const_0, save/restore_slice_318/tensor_name, save/restore_slice_318/shape_and_slice)]]\nCaused by op u'save/restore_slice_318', defined at:\nFile \"/tmp/runner.py\", line 35, in \nload_model_to_session(session, model_dir, meta_file, ckpt_file)\nFile \"/tmp/runner.py\", line 6, in load_model_to_session\nsaver = tf.train.import_meta_graph(os.path.join(model_dir_exp, meta_file))\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py\", line 1526, in import_meta_graph\n**kwargs)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/meta_graph.py\", line 502, in import_scoped_meta_graph\nproducer_op_list=producer_op_list)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/importer.py\", line 285, in import_graph_def\nop_def=op_def)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2240, in create_op\noriginal_op=self._default_original_op, op_def=op_def)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1128, in init\nself._traceback = _extract_stack()\nDataLossError (see above for traceback): Unable to open table file /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\n[[Node: save/restore_slice_318 = RestoreSlice[dt=DT_FLOAT, preferred_shard=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](_recv_save/Const_0, save/restore_slice_318/tensor_name, save/restore_slice_318/shape_and_slice)]]\n\nin order to reproduce this, you can use the pre-trained open source model here:\nhttps://drive.google.com/file/d/0B5MzpY9kBtDVSTgxX25ZQzNTMGc/view\nI'm using tensorflow (python) 0.12.1 .\nI suspect that it has something to do with the virtualization (AWS).\nBTW, the code works on the pretrained model http://download.tensorflow.org/models/inception_v1_2016_08_28.tar.gz", "body": "I am running a script that perfectly works on ubuntu 14.04, docker over ubuntu 14.04, docker over MAC OS - but doesn't work on ubuntu 16 on AWS.\r\nthe script is:\r\n\r\n```\r\nimport tensorflow as tf\r\nimport os\r\n\r\ndef load_model_to_session(session, model_dir, meta_file, ckpt_file):\r\n    model_dir_exp = os.path.expanduser(model_dir)\r\n    saver = tf.train.import_meta_graph(os.path.join(model_dir_exp, meta_file))\r\n    saver.restore(session, os.path.join(model_dir_exp, ckpt_file))\r\n\r\nsession = tf.Session()\r\nprint ('loading models')\r\nmodel_dir = '/data/model'\r\nmeta_file, ckpt_file = 'a.meta', 'a.ckpt'\r\nprint ('ckpt file ' + ckpt_file)\r\nload_model_to_session(session, model_dir, meta_file, ckpt_file)\r\nprint ('finish loading the model')\r\nsession.close()\r\n\r\n`````\r\n\r\nthe errors i get:\r\n\r\n> W tensorflow/core/framework/op_kernel.cc:975] Data loss: Unable to open table file /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\r\n> W tensorflow/core/util/tensor_slice_reader.cc:95] Could not open /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\r\n> W tensorflow/core/util/tensor_slice_reader.cc:95] Could not open /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\r\n> W tensorflow/core/framework/op_kernel.cc:975] Data loss: Unable to open table file /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\r\n> W tensorflow/core/util/tensor_slice_reader.cc:95] Could not open /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\r\n> W tensorflow/core/framework/op_kernel.cc:975] Data loss: Unable to open table file /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\r\n> Traceback (most recent call last):\r\n>   File \"/tmp/runner.py\", line 35, in <module>\r\n>     load_model_to_session(session, model_dir, meta_file, ckpt_file)\r\n>   File \"/tmp/runner.py\", line 7, in load_model_to_session\r\n>     saver.restore(session, os.path.join(model_dir_exp, ckpt_file))\r\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py\", line 1388, in restore\r\n>     {self.saver_def.filename_tensor_name: save_path})\r\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 766, in run\r\n>     run_metadata_ptr)\r\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 964, in _run\r\n>     feed_dict_string, options, run_metadata)\r\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1014, in _do_run\r\n>     target_list, options, run_metadata)\r\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1034, in _do_call\r\n>     raise type(e)(node_def, op, message)\r\n> tensorflow.python.framework.errors_impl.DataLossError: Unable to open table file /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\r\n>          [[Node: save/restore_slice_318 = RestoreSlice[dt=DT_FLOAT, preferred_shard=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](_recv_save/Const_0, save/restore_slice_318/tensor_name, save/restore_slice_318/shape_and_slice)]]\r\n> \r\n> Caused by op u'save/restore_slice_318', defined at:\r\n>   File \"/tmp/runner.py\", line 35, in <module>\r\n>     load_model_to_session(session, model_dir, meta_file, ckpt_file)\r\n>   File \"/tmp/runner.py\", line 6, in load_model_to_session\r\n>     saver = tf.train.import_meta_graph(os.path.join(model_dir_exp, meta_file))\r\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py\", line 1526, in import_meta_graph\r\n>     **kwargs)\r\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/meta_graph.py\", line 502, in import_scoped_meta_graph\r\n>     producer_op_list=producer_op_list)\r\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/importer.py\", line 285, in import_graph_def\r\n>     op_def=op_def)\r\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2240, in create_op\r\n>     original_op=self._default_original_op, op_def=op_def)\r\n>   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1128, in __init__\r\n>     self._traceback = _extract_stack()\r\n> \r\n> DataLossError (see above for traceback): Unable to open table file /data/model/a.ckpt: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\r\n>          [[Node: save/restore_slice_318 = RestoreSlice[dt=DT_FLOAT, preferred_shard=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](_recv_save/Const_0, save/restore_slice_318/tensor_name, save/restore_slice_318/shape_and_slice)]]\r\n> \r\n\r\nin order to reproduce this, you can use the pre-trained open source model here:\r\nhttps://drive.google.com/file/d/0B5MzpY9kBtDVSTgxX25ZQzNTMGc/view\r\n\r\nI'm using tensorflow (python) 0.12.1 .\r\n\r\nI suspect that it has something to do with the virtualization (AWS).\r\n\r\nBTW, the code works on the pretrained model http://download.tensorflow.org/models/inception_v1_2016_08_28.tar.gz"}