{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/219004882", "pull_request_review_id": 157071849, "id": 219004882, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTAwNDg4Mg==", "diff_hunk": "@@ -2810,6 +2837,73 @@ class MklLayoutRewritePass : public GraphOptimizationPass {\n     return n;\n   }\n \n+  // Find Relu or Conv2D node that can be merged with input node 'm'.\n+  // If input 'm' is Relu, then check if there exists Conv2D node that can be\n+  // merged with 'm'. If input 'm' is Conv2D, then check if there exists Relu\n+  // node that can be merged with 'm'.\n+  static Node* GetConv2DOrRelu(const Node* m) {\n+    CHECK_NOTNULL(m);\n+    Node* n = nullptr;\n+\n+    if (m->type_string() == csinfo_.relu) {\n+      // If a is Relu, then Conv2D is 0th input of Relu.\n+      TF_CHECK_OK(m->input_node(0, &n));\n+    } else {\n+      CHECK_EQ(m->type_string(), csinfo_.conv2d);\n+      // Go over all output edges and search for Relu Node.\n+      // 0th input of Relu is Conv2D.\n+      for (const Edge* e : m->out_edges()) {\n+        if (!e->IsControlEdge() && e->dst()->type_string() == csinfo_.relu &&\n+            e->dst_input() == 0) {\n+          n = e->dst();\n+          break;\n+        }\n+      }\n+    }\n+\n+    if (n == nullptr) {\n+      VLOG(1) << \"MklLayoutRewritePass: Could not find matching \"\n+              << \"Conv2D and Relu node for merging. Input node: \"\n+              << m->DebugString();\n+    }\n+\n+    return n;\n+  }\n+\n+  // Find Conv2DWithBias or Relu node that can be merged with input node 'm'.\n+  // If input 'm' is Conv2DWithBias, then check if there exists Relu node that\n+  // can be merged with 'm'. If input 'm' is Relu, then check if there exists\n+  // Conv2DWithBias node that can be merged with 'm'.\n+  static Node* GetConv2DWithBiasOrRelu(const Node* m) {", "path": "tensorflow/core/graph/mkl_layout_pass.cc", "position": 147, "original_position": 147, "commit_id": "00408b3315b825805812386b5c29f446fd05120d", "original_commit_id": "00408b3315b825805812386b5c29f446fd05120d", "user": {"login": "tatianashp", "id": 986732, "node_id": "MDQ6VXNlcjk4NjczMg==", "avatar_url": "https://avatars2.githubusercontent.com/u/986732?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tatianashp", "html_url": "https://github.com/tatianashp", "followers_url": "https://api.github.com/users/tatianashp/followers", "following_url": "https://api.github.com/users/tatianashp/following{/other_user}", "gists_url": "https://api.github.com/users/tatianashp/gists{/gist_id}", "starred_url": "https://api.github.com/users/tatianashp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tatianashp/subscriptions", "organizations_url": "https://api.github.com/users/tatianashp/orgs", "repos_url": "https://api.github.com/users/tatianashp/repos", "events_url": "https://api.github.com/users/tatianashp/events{/privacy}", "received_events_url": "https://api.github.com/users/tatianashp/received_events", "type": "User", "site_admin": false}, "body": "This method is identical to GetConv2DOrRelu except that it uses csinfo_.conv2d_with_bias instead of csinfo_.conv2d and the error message. Please use a single method instead that passes the name of the convolution opeation as an argument.", "created_at": "2018-09-20T00:35:18Z", "updated_at": "2018-09-20T00:38:36Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/21314#discussion_r219004882", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/21314", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/219004882"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/21314#discussion_r219004882"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/21314"}}, "body_html": "<p>This method is identical to GetConv2DOrRelu except that it uses csinfo_.conv2d_with_bias instead of csinfo_.conv2d and the error message. Please use a single method instead that passes the name of the convolution opeation as an argument.</p>", "body_text": "This method is identical to GetConv2DOrRelu except that it uses csinfo_.conv2d_with_bias instead of csinfo_.conv2d and the error message. Please use a single method instead that passes the name of the convolution opeation as an argument."}