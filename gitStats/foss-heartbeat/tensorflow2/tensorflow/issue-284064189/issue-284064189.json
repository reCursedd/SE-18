{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15570", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15570/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15570/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15570/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15570", "id": 284064189, "node_id": "MDU6SXNzdWUyODQwNjQxODk=", "number": 15570, "title": "Using grid_rnn_cell.Grid1LSTMCell makes stack_bidirectional_dynamic_rnn Throw different shape errors", "user": {"login": "selcouthlyBlue", "id": 13268675, "node_id": "MDQ6VXNlcjEzMjY4Njc1", "avatar_url": "https://avatars2.githubusercontent.com/u/13268675?v=4", "gravatar_id": "", "url": "https://api.github.com/users/selcouthlyBlue", "html_url": "https://github.com/selcouthlyBlue", "followers_url": "https://api.github.com/users/selcouthlyBlue/followers", "following_url": "https://api.github.com/users/selcouthlyBlue/following{/other_user}", "gists_url": "https://api.github.com/users/selcouthlyBlue/gists{/gist_id}", "starred_url": "https://api.github.com/users/selcouthlyBlue/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/selcouthlyBlue/subscriptions", "organizations_url": "https://api.github.com/users/selcouthlyBlue/orgs", "repos_url": "https://api.github.com/users/selcouthlyBlue/repos", "events_url": "https://api.github.com/users/selcouthlyBlue/events{/privacy}", "received_events_url": "https://api.github.com/users/selcouthlyBlue/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2017-12-22T03:34:15Z", "updated_at": "2018-01-04T16:28:23Z", "closed_at": "2018-01-04T16:28:23Z", "author_association": "CONTRIBUTOR", "body_html": "<p>I encountered a problem using grid_rnn_cell.Grid1LSTMCell. I have no problems using it on contrib static_rnn and contrib static_bidirectional_rnn.</p>\n<pre><code>class GridRNNTest(tf.test.TestCase):\n    def setUp(self):\n        self.num_features = 1\n        self.time_steps = 1\n        self.batch_size = 1\n        tf.reset_default_graph()\n        self.input_layer = tf.placeholder(tf.float32, [self.batch_size, self.time_steps, self.num_features])\n        self.cell = grid_rnn_cell.Grid1LSTMCell(num_units=8)\n\n    def test_simple_grid_rnn(self):\n        self.input_layer = tf.unstack(self.input_layer, self.time_steps, 1)\n        rnn.static_rnn(self.cell, self.input_layer, dtype=tf.float32)\n\nclass BidirectionalGridRNNTest(tf.test.TestCase):\n    def setUp(self):\n        self.num_features = 1\n        self.time_steps = 1\n        self.batch_size = 1\n        tf.reset_default_graph()\n        self.input_layer = tf.placeholder(tf.float32, [self.batch_size, self.time_steps, self.num_features])\n        self.cell_fw = grid_rnn_cell.Grid1LSTMCell(num_units=8)\n        self.cell_bw = grid_rnn_cell.Grid1LSTMCell(num_units=8)\n\n    def test_simple_bidirectional_grid_rnn(self):\n        self.input_layer = tf.unstack(self.input_layer, self.time_steps, 1)\n        rnn.static_bidirectional_rnn(self.cell_fw, self.cell_bw, self.input_layer, dtype=tf.float32)\n</code></pre>\n<p>However, when I test it on contrib stack_bidirectional_dynamic_rnn:</p>\n<pre><code>class StackBidirectionalGridRNNTest(tf.test.TestCase):\n    def setUp(self):\n        self.num_features = 1\n        self.time_steps = 1\n        self.batch_size = 1\n        tf.reset_default_graph()\n        self.input_layer = tf.placeholder(tf.float32, [self.batch_size, self.time_steps, self.num_features])\n        self.cells_fw = [grid_rnn_cell.Grid1LSTMCell(num_units=8) for _ in range(2)]\n        self.cells_bw = [grid_rnn_cell.Grid1LSTMCell(num_units=8) for _ in range(2)]\n\n    def test_stack_bidirectional_grid_rnn(self):\n        self.input_layer = tf.unstack(self.input_layer, self.time_steps, 1)\n        rnn.stack_bidirectional_dynamic_rnn(self.cells_fw, self.cells_fw, self.input_layer, dtype=tf.float32)\n</code></pre>\n<p>I encounter these shape errors:</p>\n<p>(1) When the input_layer is unstacked: <code>Shape (1, 1) must have rank at least 3</code><br>\n(2) When the input_layer is not unstacked: Shape <code>(1, 2, 8) must have rank 2</code></p>\n<p>Which are, apparently,  conflicting with each other.</p>", "body_text": "I encountered a problem using grid_rnn_cell.Grid1LSTMCell. I have no problems using it on contrib static_rnn and contrib static_bidirectional_rnn.\nclass GridRNNTest(tf.test.TestCase):\n    def setUp(self):\n        self.num_features = 1\n        self.time_steps = 1\n        self.batch_size = 1\n        tf.reset_default_graph()\n        self.input_layer = tf.placeholder(tf.float32, [self.batch_size, self.time_steps, self.num_features])\n        self.cell = grid_rnn_cell.Grid1LSTMCell(num_units=8)\n\n    def test_simple_grid_rnn(self):\n        self.input_layer = tf.unstack(self.input_layer, self.time_steps, 1)\n        rnn.static_rnn(self.cell, self.input_layer, dtype=tf.float32)\n\nclass BidirectionalGridRNNTest(tf.test.TestCase):\n    def setUp(self):\n        self.num_features = 1\n        self.time_steps = 1\n        self.batch_size = 1\n        tf.reset_default_graph()\n        self.input_layer = tf.placeholder(tf.float32, [self.batch_size, self.time_steps, self.num_features])\n        self.cell_fw = grid_rnn_cell.Grid1LSTMCell(num_units=8)\n        self.cell_bw = grid_rnn_cell.Grid1LSTMCell(num_units=8)\n\n    def test_simple_bidirectional_grid_rnn(self):\n        self.input_layer = tf.unstack(self.input_layer, self.time_steps, 1)\n        rnn.static_bidirectional_rnn(self.cell_fw, self.cell_bw, self.input_layer, dtype=tf.float32)\n\nHowever, when I test it on contrib stack_bidirectional_dynamic_rnn:\nclass StackBidirectionalGridRNNTest(tf.test.TestCase):\n    def setUp(self):\n        self.num_features = 1\n        self.time_steps = 1\n        self.batch_size = 1\n        tf.reset_default_graph()\n        self.input_layer = tf.placeholder(tf.float32, [self.batch_size, self.time_steps, self.num_features])\n        self.cells_fw = [grid_rnn_cell.Grid1LSTMCell(num_units=8) for _ in range(2)]\n        self.cells_bw = [grid_rnn_cell.Grid1LSTMCell(num_units=8) for _ in range(2)]\n\n    def test_stack_bidirectional_grid_rnn(self):\n        self.input_layer = tf.unstack(self.input_layer, self.time_steps, 1)\n        rnn.stack_bidirectional_dynamic_rnn(self.cells_fw, self.cells_fw, self.input_layer, dtype=tf.float32)\n\nI encounter these shape errors:\n(1) When the input_layer is unstacked: Shape (1, 1) must have rank at least 3\n(2) When the input_layer is not unstacked: Shape (1, 2, 8) must have rank 2\nWhich are, apparently,  conflicting with each other.", "body": "I encountered a problem using grid_rnn_cell.Grid1LSTMCell. I have no problems using it on contrib static_rnn and contrib static_bidirectional_rnn.\r\n\r\n```\r\nclass GridRNNTest(tf.test.TestCase):\r\n    def setUp(self):\r\n        self.num_features = 1\r\n        self.time_steps = 1\r\n        self.batch_size = 1\r\n        tf.reset_default_graph()\r\n        self.input_layer = tf.placeholder(tf.float32, [self.batch_size, self.time_steps, self.num_features])\r\n        self.cell = grid_rnn_cell.Grid1LSTMCell(num_units=8)\r\n\r\n    def test_simple_grid_rnn(self):\r\n        self.input_layer = tf.unstack(self.input_layer, self.time_steps, 1)\r\n        rnn.static_rnn(self.cell, self.input_layer, dtype=tf.float32)\r\n\r\nclass BidirectionalGridRNNTest(tf.test.TestCase):\r\n    def setUp(self):\r\n        self.num_features = 1\r\n        self.time_steps = 1\r\n        self.batch_size = 1\r\n        tf.reset_default_graph()\r\n        self.input_layer = tf.placeholder(tf.float32, [self.batch_size, self.time_steps, self.num_features])\r\n        self.cell_fw = grid_rnn_cell.Grid1LSTMCell(num_units=8)\r\n        self.cell_bw = grid_rnn_cell.Grid1LSTMCell(num_units=8)\r\n\r\n    def test_simple_bidirectional_grid_rnn(self):\r\n        self.input_layer = tf.unstack(self.input_layer, self.time_steps, 1)\r\n        rnn.static_bidirectional_rnn(self.cell_fw, self.cell_bw, self.input_layer, dtype=tf.float32)\r\n```\r\n\r\nHowever, when I test it on contrib stack_bidirectional_dynamic_rnn:\r\n\r\n```\r\nclass StackBidirectionalGridRNNTest(tf.test.TestCase):\r\n    def setUp(self):\r\n        self.num_features = 1\r\n        self.time_steps = 1\r\n        self.batch_size = 1\r\n        tf.reset_default_graph()\r\n        self.input_layer = tf.placeholder(tf.float32, [self.batch_size, self.time_steps, self.num_features])\r\n        self.cells_fw = [grid_rnn_cell.Grid1LSTMCell(num_units=8) for _ in range(2)]\r\n        self.cells_bw = [grid_rnn_cell.Grid1LSTMCell(num_units=8) for _ in range(2)]\r\n\r\n    def test_stack_bidirectional_grid_rnn(self):\r\n        self.input_layer = tf.unstack(self.input_layer, self.time_steps, 1)\r\n        rnn.stack_bidirectional_dynamic_rnn(self.cells_fw, self.cells_fw, self.input_layer, dtype=tf.float32)\r\n```\r\n\r\nI encounter these shape errors:\r\n\r\n(1) When the input_layer is unstacked: `Shape (1, 1) must have rank at least 3`\r\n(2) When the input_layer is not unstacked: Shape `(1, 2, 8) must have rank 2`\r\n\r\nWhich are, apparently,  conflicting with each other."}