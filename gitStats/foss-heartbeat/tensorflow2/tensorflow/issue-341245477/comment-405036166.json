{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/405036166", "html_url": "https://github.com/tensorflow/tensorflow/issues/20803#issuecomment-405036166", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20803", "id": 405036166, "node_id": "MDEyOklzc3VlQ29tbWVudDQwNTAzNjE2Ng==", "user": {"login": "dchichkov", "id": 369017, "node_id": "MDQ6VXNlcjM2OTAxNw==", "avatar_url": "https://avatars0.githubusercontent.com/u/369017?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dchichkov", "html_url": "https://github.com/dchichkov", "followers_url": "https://api.github.com/users/dchichkov/followers", "following_url": "https://api.github.com/users/dchichkov/following{/other_user}", "gists_url": "https://api.github.com/users/dchichkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/dchichkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dchichkov/subscriptions", "organizations_url": "https://api.github.com/users/dchichkov/orgs", "repos_url": "https://api.github.com/users/dchichkov/repos", "events_url": "https://api.github.com/users/dchichkov/events{/privacy}", "received_events_url": "https://api.github.com/users/dchichkov/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-14T17:00:06Z", "updated_at": "2018-07-14T18:26:51Z", "author_association": "NONE", "body_html": "<p>It needs sess.run(tf.global_variables_initializer())? The following code seem to work:</p>\n<pre><code>!wget https://www.tensorflow.org/images/daisies.jpg\nimport tensorflow as tf, tensorflow_hub as hub, numpy as np\n\ndef read_tensor_from_image_file(file_name, height, width, mean=0, std=128):  \n  file_reader = tf.read_file(file_name, name=\"file_reader\")\n  image_reader = tf.image.decode_jpeg(file_reader, channels=3, name=\"jpeg_reader\")\n  float_caster = tf.cast(image_reader, tf.float32)\n  dims_expander = tf.expand_dims(float_caster, 0)\n  resized = tf.image.resize_bilinear(dims_expander, [height, width])\n  normalized = tf.divide(tf.subtract(resized, [mean]), [std])\n  return normalized\n\n\nmodule = hub.Module(\"https://tfhub.dev/google/imagenet/mobilenet_v2_140_224/feature_vector/2\")\nheight, width = hub.get_expected_image_size(module)\nimage = read_tensor_from_image_file(\"daisies.jpg\", 224, 224)\nfeatures = module(image)\n\nwith tf.Session() as sess:\n  sess.run(tf.global_variables_initializer())\n  sess.run(tf.tables_initializer())\n\n  result = sess.run(features)\n  print(np.squeeze(result))\n</code></pre>\n<p>Still, seem like a bug to me, as the:</p>\n<ul>\n<li>requirement to run tf.global_variables_initializer is not documented</li>\n<li>error message is very poor</li>\n<li>no minimalistic sample code is available</li>\n</ul>", "body_text": "It needs sess.run(tf.global_variables_initializer())? The following code seem to work:\n!wget https://www.tensorflow.org/images/daisies.jpg\nimport tensorflow as tf, tensorflow_hub as hub, numpy as np\n\ndef read_tensor_from_image_file(file_name, height, width, mean=0, std=128):  \n  file_reader = tf.read_file(file_name, name=\"file_reader\")\n  image_reader = tf.image.decode_jpeg(file_reader, channels=3, name=\"jpeg_reader\")\n  float_caster = tf.cast(image_reader, tf.float32)\n  dims_expander = tf.expand_dims(float_caster, 0)\n  resized = tf.image.resize_bilinear(dims_expander, [height, width])\n  normalized = tf.divide(tf.subtract(resized, [mean]), [std])\n  return normalized\n\n\nmodule = hub.Module(\"https://tfhub.dev/google/imagenet/mobilenet_v2_140_224/feature_vector/2\")\nheight, width = hub.get_expected_image_size(module)\nimage = read_tensor_from_image_file(\"daisies.jpg\", 224, 224)\nfeatures = module(image)\n\nwith tf.Session() as sess:\n  sess.run(tf.global_variables_initializer())\n  sess.run(tf.tables_initializer())\n\n  result = sess.run(features)\n  print(np.squeeze(result))\n\nStill, seem like a bug to me, as the:\n\nrequirement to run tf.global_variables_initializer is not documented\nerror message is very poor\nno minimalistic sample code is available", "body": "It needs sess.run(tf.global_variables_initializer())? The following code seem to work:\r\n\r\n```\r\n!wget https://www.tensorflow.org/images/daisies.jpg\r\nimport tensorflow as tf, tensorflow_hub as hub, numpy as np\r\n\r\ndef read_tensor_from_image_file(file_name, height, width, mean=0, std=128):  \r\n  file_reader = tf.read_file(file_name, name=\"file_reader\")\r\n  image_reader = tf.image.decode_jpeg(file_reader, channels=3, name=\"jpeg_reader\")\r\n  float_caster = tf.cast(image_reader, tf.float32)\r\n  dims_expander = tf.expand_dims(float_caster, 0)\r\n  resized = tf.image.resize_bilinear(dims_expander, [height, width])\r\n  normalized = tf.divide(tf.subtract(resized, [mean]), [std])\r\n  return normalized\r\n\r\n\r\nmodule = hub.Module(\"https://tfhub.dev/google/imagenet/mobilenet_v2_140_224/feature_vector/2\")\r\nheight, width = hub.get_expected_image_size(module)\r\nimage = read_tensor_from_image_file(\"daisies.jpg\", 224, 224)\r\nfeatures = module(image)\r\n\r\nwith tf.Session() as sess:\r\n  sess.run(tf.global_variables_initializer())\r\n  sess.run(tf.tables_initializer())\r\n\r\n  result = sess.run(features)\r\n  print(np.squeeze(result))\r\n```\r\n\r\nStill, seem like a bug to me, as the:\r\n * requirement to run tf.global_variables_initializer is not documented\r\n * error message is very poor\r\n * no minimalistic sample code is available"}