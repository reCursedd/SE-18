{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/218557203", "html_url": "https://github.com/tensorflow/tensorflow/issues/2264#issuecomment-218557203", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2264", "id": 218557203, "node_id": "MDEyOklzc3VlQ29tbWVudDIxODU1NzIwMw==", "user": {"login": "petamem", "id": 2607711, "node_id": "MDQ6VXNlcjI2MDc3MTE=", "avatar_url": "https://avatars3.githubusercontent.com/u/2607711?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petamem", "html_url": "https://github.com/petamem", "followers_url": "https://api.github.com/users/petamem/followers", "following_url": "https://api.github.com/users/petamem/following{/other_user}", "gists_url": "https://api.github.com/users/petamem/gists{/gist_id}", "starred_url": "https://api.github.com/users/petamem/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petamem/subscriptions", "organizations_url": "https://api.github.com/users/petamem/orgs", "repos_url": "https://api.github.com/users/petamem/repos", "events_url": "https://api.github.com/users/petamem/events{/privacy}", "received_events_url": "https://api.github.com/users/petamem/received_events", "type": "User", "site_admin": false}, "created_at": "2016-05-11T19:01:44Z", "updated_at": "2016-05-11T19:18:00Z", "author_association": "NONE", "body_html": "<p>Hm. I'm afraid the path template \"/sys/bus/pci/devices/%s/numa_node\" cannot be found on my system as /sys/bus/pci/devices looks like that:</p>\n<pre><code># ll /sys/bus/pci/devices/0000\\:*\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:00.0 -&gt; ../../../devices/pci0000:00/0000:00:00.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:01.0 -&gt; ../../../devices/pci0000:00/0000:00:01.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:14.0 -&gt; ../../../devices/pci0000:00/0000:00:14.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:14.2 -&gt; ../../../devices/pci0000:00/0000:00:14.2\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:16.0 -&gt; ../../../devices/pci0000:00/0000:00:16.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:16.3 -&gt; ../../../devices/pci0000:00/0000:00:16.3\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:17.0 -&gt; ../../../devices/pci0000:00/0000:00:17.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1c.0 -&gt; ../../../devices/pci0000:00/0000:00:1c.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1c.2 -&gt; ../../../devices/pci0000:00/0000:00:1c.2\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1c.4 -&gt; ../../../devices/pci0000:00/0000:00:1c.4\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1d.0 -&gt; ../../../devices/pci0000:00/0000:00:1d.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1d.4 -&gt; ../../../devices/pci0000:00/0000:00:1d.4\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1f.0 -&gt; ../../../devices/pci0000:00/0000:00:1f.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1f.2 -&gt; ../../../devices/pci0000:00/0000:00:1f.2\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1f.3 -&gt; ../../../devices/pci0000:00/0000:00:1f.3\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1f.4 -&gt; ../../../devices/pci0000:00/0000:00:1f.4\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1f.6 -&gt; ../../../devices/pci0000:00/0000:00:1f.6\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:01:00.0 -&gt; ../../../devices/pci0000:00/0000:00:01.0/0000:01:00.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:01:00.1 -&gt; ../../../devices/pci0000:00/0000:00:01.0/0000:01:00.1\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:04:00.0 -&gt; ../../../devices/pci0000:00/0000:00:1c.2/0000:04:00.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:3e:00.0 -&gt; ../../../devices/pci0000:00/0000:00:1d.0/0000:3e:00.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:3f:00.0 -&gt; ../../../devices/pci0000:00/0000:00:1d.4/0000:3f:00.0\n\nls /sys/bus/pci/devices/*/numa_node\n</code></pre>\n<p>no such file or directory</p>\n<p>Which it does - of course, because the kernel has no NUMA support. :-)<br>\nSo I compiled a new 4.5.3 kernel with NUMA support and ...</p>\n<pre><code>&gt;&gt;&gt; sess = tf.Session()\nI tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:900] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\nI tensorflow/core/common_runtime/gpu/gpu_init.cc:102] Found device 0 with properties: \nname: Quadro M2000M\nmajor: 5 minor: 0 memoryClockRate (GHz) 1.137\npciBusID 0000:01:00.0\nTotal memory: 4.00GiB\nFree memory: 3.47GiB\nI tensorflow/core/common_runtime/gpu/gpu_init.cc:126] DMA: 0 \nI tensorflow/core/common_runtime/gpu/gpu_init.cc:136] 0:   Y \nI tensorflow/core/common_runtime/gpu/gpu_device.cc:755] Creating TensorFlow device (/gpu:0) -&gt; (device: 0, name: Quadro M2000M, pci bus id: 0000:01:00.0)\n</code></pre>\n<p>So it seems my problem was simply due to the fact, that the kernel had no NUMA support.<br>\nI will now switch back to Hybrid mode (activate the Intel GPU) and test if that works with NUMA enabled.</p>\n<p>edit: it does. So the \"fix\" could be some warning sign somewhere \"NUMA support is a must\".</p>", "body_text": "Hm. I'm afraid the path template \"/sys/bus/pci/devices/%s/numa_node\" cannot be found on my system as /sys/bus/pci/devices looks like that:\n# ll /sys/bus/pci/devices/0000\\:*\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:00.0 -> ../../../devices/pci0000:00/0000:00:00.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:01.0 -> ../../../devices/pci0000:00/0000:00:01.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:14.0 -> ../../../devices/pci0000:00/0000:00:14.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:14.2 -> ../../../devices/pci0000:00/0000:00:14.2\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:16.0 -> ../../../devices/pci0000:00/0000:00:16.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:16.3 -> ../../../devices/pci0000:00/0000:00:16.3\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:17.0 -> ../../../devices/pci0000:00/0000:00:17.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1c.0 -> ../../../devices/pci0000:00/0000:00:1c.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1c.2 -> ../../../devices/pci0000:00/0000:00:1c.2\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1c.4 -> ../../../devices/pci0000:00/0000:00:1c.4\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1d.0 -> ../../../devices/pci0000:00/0000:00:1d.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1d.4 -> ../../../devices/pci0000:00/0000:00:1d.4\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1f.0 -> ../../../devices/pci0000:00/0000:00:1f.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1f.2 -> ../../../devices/pci0000:00/0000:00:1f.2\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1f.3 -> ../../../devices/pci0000:00/0000:00:1f.3\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1f.4 -> ../../../devices/pci0000:00/0000:00:1f.4\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1f.6 -> ../../../devices/pci0000:00/0000:00:1f.6\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:01:00.0 -> ../../../devices/pci0000:00/0000:00:01.0/0000:01:00.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:01:00.1 -> ../../../devices/pci0000:00/0000:00:01.0/0000:01:00.1\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:04:00.0 -> ../../../devices/pci0000:00/0000:00:1c.2/0000:04:00.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:3e:00.0 -> ../../../devices/pci0000:00/0000:00:1d.0/0000:3e:00.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:3f:00.0 -> ../../../devices/pci0000:00/0000:00:1d.4/0000:3f:00.0\n\nls /sys/bus/pci/devices/*/numa_node\n\nno such file or directory\nWhich it does - of course, because the kernel has no NUMA support. :-)\nSo I compiled a new 4.5.3 kernel with NUMA support and ...\n>>> sess = tf.Session()\nI tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:900] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\nI tensorflow/core/common_runtime/gpu/gpu_init.cc:102] Found device 0 with properties: \nname: Quadro M2000M\nmajor: 5 minor: 0 memoryClockRate (GHz) 1.137\npciBusID 0000:01:00.0\nTotal memory: 4.00GiB\nFree memory: 3.47GiB\nI tensorflow/core/common_runtime/gpu/gpu_init.cc:126] DMA: 0 \nI tensorflow/core/common_runtime/gpu/gpu_init.cc:136] 0:   Y \nI tensorflow/core/common_runtime/gpu/gpu_device.cc:755] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Quadro M2000M, pci bus id: 0000:01:00.0)\n\nSo it seems my problem was simply due to the fact, that the kernel had no NUMA support.\nI will now switch back to Hybrid mode (activate the Intel GPU) and test if that works with NUMA enabled.\nedit: it does. So the \"fix\" could be some warning sign somewhere \"NUMA support is a must\".", "body": "Hm. I'm afraid the path template \"/sys/bus/pci/devices/%s/numa_node\" cannot be found on my system as /sys/bus/pci/devices looks like that:\n\n```\n# ll /sys/bus/pci/devices/0000\\:*\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:00.0 -> ../../../devices/pci0000:00/0000:00:00.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:01.0 -> ../../../devices/pci0000:00/0000:00:01.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:14.0 -> ../../../devices/pci0000:00/0000:00:14.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:14.2 -> ../../../devices/pci0000:00/0000:00:14.2\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:16.0 -> ../../../devices/pci0000:00/0000:00:16.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:16.3 -> ../../../devices/pci0000:00/0000:00:16.3\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:17.0 -> ../../../devices/pci0000:00/0000:00:17.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1c.0 -> ../../../devices/pci0000:00/0000:00:1c.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1c.2 -> ../../../devices/pci0000:00/0000:00:1c.2\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1c.4 -> ../../../devices/pci0000:00/0000:00:1c.4\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1d.0 -> ../../../devices/pci0000:00/0000:00:1d.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1d.4 -> ../../../devices/pci0000:00/0000:00:1d.4\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1f.0 -> ../../../devices/pci0000:00/0000:00:1f.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1f.2 -> ../../../devices/pci0000:00/0000:00:1f.2\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1f.3 -> ../../../devices/pci0000:00/0000:00:1f.3\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1f.4 -> ../../../devices/pci0000:00/0000:00:1f.4\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:00:1f.6 -> ../../../devices/pci0000:00/0000:00:1f.6\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:01:00.0 -> ../../../devices/pci0000:00/0000:00:01.0/0000:01:00.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:01:00.1 -> ../../../devices/pci0000:00/0000:00:01.0/0000:01:00.1\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:04:00.0 -> ../../../devices/pci0000:00/0000:00:1c.2/0000:04:00.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:3e:00.0 -> ../../../devices/pci0000:00/0000:00:1d.0/0000:3e:00.0\nlrwxrwxrwx 1 root root 0 May 11 15:06 /sys/bus/pci/devices/0000:3f:00.0 -> ../../../devices/pci0000:00/0000:00:1d.4/0000:3f:00.0\n\nls /sys/bus/pci/devices/*/numa_node\n```\n\n   no such file or directory\n\nWhich it does - of course, because the kernel has no NUMA support. :-)\nSo I compiled a new 4.5.3 kernel with NUMA support and ... \n\n```\n>>> sess = tf.Session()\nI tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:900] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\nI tensorflow/core/common_runtime/gpu/gpu_init.cc:102] Found device 0 with properties: \nname: Quadro M2000M\nmajor: 5 minor: 0 memoryClockRate (GHz) 1.137\npciBusID 0000:01:00.0\nTotal memory: 4.00GiB\nFree memory: 3.47GiB\nI tensorflow/core/common_runtime/gpu/gpu_init.cc:126] DMA: 0 \nI tensorflow/core/common_runtime/gpu/gpu_init.cc:136] 0:   Y \nI tensorflow/core/common_runtime/gpu/gpu_device.cc:755] Creating TensorFlow device (/gpu:0) -> (device: 0, name: Quadro M2000M, pci bus id: 0000:01:00.0)\n```\n\nSo it seems my problem was simply due to the fact, that the kernel had no NUMA support.\nI will now switch back to Hybrid mode (activate the Intel GPU) and test if that works with NUMA enabled.\n\nedit: it does. So the \"fix\" could be some warning sign somewhere \"NUMA support is a must\".\n"}