{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20116", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20116/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20116/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20116/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/20116", "id": 333575238, "node_id": "MDU6SXNzdWUzMzM1NzUyMzg=", "number": 20116, "title": "TensorFlow eager execution API give a wrong answer for some function", "user": {"login": "yt7589", "id": 4186566, "node_id": "MDQ6VXNlcjQxODY1NjY=", "avatar_url": "https://avatars2.githubusercontent.com/u/4186566?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yt7589", "html_url": "https://github.com/yt7589", "followers_url": "https://api.github.com/users/yt7589/followers", "following_url": "https://api.github.com/users/yt7589/following{/other_user}", "gists_url": "https://api.github.com/users/yt7589/gists{/gist_id}", "starred_url": "https://api.github.com/users/yt7589/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yt7589/subscriptions", "organizations_url": "https://api.github.com/users/yt7589/orgs", "repos_url": "https://api.github.com/users/yt7589/repos", "events_url": "https://api.github.com/users/yt7589/events{/privacy}", "received_events_url": "https://api.github.com/users/yt7589/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 736653459, "node_id": "MDU6TGFiZWw3MzY2NTM0NTk=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:eager", "name": "comp:eager", "color": "0052cc", "default": false}, {"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}, {"id": 473184161, "node_id": "MDU6TGFiZWw0NzMxODQxNjE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:support", "name": "type:support", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 9, "created_at": "2018-06-19T08:46:48Z", "updated_at": "2018-08-14T08:31:00Z", "closed_at": "2018-08-14T08:31:00Z", "author_association": "NONE", "body_html": "<p>Why TensorFlow eager execution API give a wrong answer for this function?</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">def</span> <span class=\"pl-en\">dp1_f1</span>(<span class=\"pl-smi\">x</span>):\n    <span class=\"pl-k\">return</span> <span class=\"pl-c1\">64</span><span class=\"pl-k\">*</span>x<span class=\"pl-k\">*</span>(<span class=\"pl-c1\">1</span><span class=\"pl-k\">-</span>x)<span class=\"pl-k\">*</span>(math.pow((<span class=\"pl-c1\">1</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">2</span><span class=\"pl-k\">*</span>x),<span class=\"pl-c1\">2</span>) )<span class=\"pl-k\">*</span>math.pow((<span class=\"pl-c1\">1</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">8</span><span class=\"pl-k\">*</span>x<span class=\"pl-k\">+</span><span class=\"pl-c1\">8</span><span class=\"pl-k\">*</span>x<span class=\"pl-k\">*</span>x), <span class=\"pl-c1\">2</span>)</pre></div>\n<p>I want to get dy/dx value. I can get this value by numeric method just as below:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">def</span> <span class=\"pl-en\">dp_numeric_diff</span>(<span class=\"pl-smi\">x</span>):\n    delta_x <span class=\"pl-k\">=</span> <span class=\"pl-c1\">0.0001</span>\n    <span class=\"pl-k\">return</span> (dp1_f1(x<span class=\"pl-k\">+</span>delta_x)<span class=\"pl-k\">-</span>dp1_f1(x))<span class=\"pl-k\">/</span>delta_x</pre></div>\n<p>I use TensorFlow eager execution API to calculate this value:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">def</span> <span class=\"pl-en\">dp_ad_tfe</span>(<span class=\"pl-smi\">x</span>):\n    tf.enable_eager_execution()\n    tfe <span class=\"pl-k\">=</span> tf.contrib.eager\n    grad_lx <span class=\"pl-k\">=</span> tfe.gradients_function(dp1_f1)\n    x <span class=\"pl-k\">=</span> <span class=\"pl-c1\">3.0</span>\n    y <span class=\"pl-k\">=</span> dp1_f1(x)\n    rst <span class=\"pl-k\">=</span> grad_lx(x)\n    <span class=\"pl-k\">return</span> y, rst[<span class=\"pl-c1\">0</span>]</pre></div>\n<p>I call this function with code below:</p>\n<div class=\"highlight highlight-source-python\"><pre>numeric_diff <span class=\"pl-k\">=</span> dp_numeric_diff(x)\n<span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>Numeric method\uff1a<span class=\"pl-c1\">{0}</span><span class=\"pl-pds\">'</span></span>.format(numeric_diff))\nv, d <span class=\"pl-k\">=</span> dp_ad_tfe(x)\n<span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>TFE\uff1a<span class=\"pl-c1\">{0}</span><span class=\"pl-pds\">'</span></span>.format(d))</pre></div>\n<p>It will display something like this:</p>\n<pre><code>Numeric method\uff1a-75290405.66440672\nTFE\uff1a-19208000.0\n</code></pre>\n<p>I am sure that the numeric method is right. What's wrong with my TensorFlow eager execution code? By the way the same TensorFlow eager execution code can get correct answer for simple function like x^2.</p>", "body_text": "Why TensorFlow eager execution API give a wrong answer for this function?\ndef dp1_f1(x):\n    return 64*x*(1-x)*(math.pow((1-2*x),2) )*math.pow((1-8*x+8*x*x), 2)\nI want to get dy/dx value. I can get this value by numeric method just as below:\ndef dp_numeric_diff(x):\n    delta_x = 0.0001\n    return (dp1_f1(x+delta_x)-dp1_f1(x))/delta_x\nI use TensorFlow eager execution API to calculate this value:\ndef dp_ad_tfe(x):\n    tf.enable_eager_execution()\n    tfe = tf.contrib.eager\n    grad_lx = tfe.gradients_function(dp1_f1)\n    x = 3.0\n    y = dp1_f1(x)\n    rst = grad_lx(x)\n    return y, rst[0]\nI call this function with code below:\nnumeric_diff = dp_numeric_diff(x)\nprint('Numeric method\uff1a{0}'.format(numeric_diff))\nv, d = dp_ad_tfe(x)\nprint('TFE\uff1a{0}'.format(d))\nIt will display something like this:\nNumeric method\uff1a-75290405.66440672\nTFE\uff1a-19208000.0\n\nI am sure that the numeric method is right. What's wrong with my TensorFlow eager execution code? By the way the same TensorFlow eager execution code can get correct answer for simple function like x^2.", "body": "Why TensorFlow eager execution API give a wrong answer for this function?\r\n``` python\r\ndef dp1_f1(x):\r\n    return 64*x*(1-x)*(math.pow((1-2*x),2) )*math.pow((1-8*x+8*x*x), 2)\r\n```\r\nI want to get dy/dx value. I can get this value by numeric method just as below:\r\n``` python\r\ndef dp_numeric_diff(x):\r\n    delta_x = 0.0001\r\n    return (dp1_f1(x+delta_x)-dp1_f1(x))/delta_x\r\n```\r\nI use TensorFlow eager execution API to calculate this value:\r\n``` python\r\ndef dp_ad_tfe(x):\r\n    tf.enable_eager_execution()\r\n    tfe = tf.contrib.eager\r\n    grad_lx = tfe.gradients_function(dp1_f1)\r\n    x = 3.0\r\n    y = dp1_f1(x)\r\n    rst = grad_lx(x)\r\n    return y, rst[0]\r\n```\r\nI call this function with code below:\r\n``` python\r\nnumeric_diff = dp_numeric_diff(x)\r\nprint('Numeric method\uff1a{0}'.format(numeric_diff))\r\nv, d = dp_ad_tfe(x)\r\nprint('TFE\uff1a{0}'.format(d))\r\n```\r\nIt will display something like this:\r\n```\r\nNumeric method\uff1a-75290405.66440672\r\nTFE\uff1a-19208000.0\r\n```\r\nI am sure that the numeric method is right. What's wrong with my TensorFlow eager execution code? By the way the same TensorFlow eager execution code can get correct answer for simple function like x^2."}