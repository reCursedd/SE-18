{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13492", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13492/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13492/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13492/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/13492", "id": 262868243, "node_id": "MDU6SXNzdWUyNjI4NjgyNDM=", "number": 13492, "title": "Can't run new ops in new session after sess.run RuntimeError", "user": {"login": "yaroslavvb", "id": 23068, "node_id": "MDQ6VXNlcjIzMDY4", "avatar_url": "https://avatars3.githubusercontent.com/u/23068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yaroslavvb", "html_url": "https://github.com/yaroslavvb", "followers_url": "https://api.github.com/users/yaroslavvb/followers", "following_url": "https://api.github.com/users/yaroslavvb/following{/other_user}", "gists_url": "https://api.github.com/users/yaroslavvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/yaroslavvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yaroslavvb/subscriptions", "organizations_url": "https://api.github.com/users/yaroslavvb/orgs", "repos_url": "https://api.github.com/users/yaroslavvb/repos", "events_url": "https://api.github.com/users/yaroslavvb/events{/privacy}", "received_events_url": "https://api.github.com/users/yaroslavvb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2017-10-04T17:29:12Z", "updated_at": "2017-10-11T16:52:37Z", "closed_at": "2017-10-11T16:52:37Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Scenario:</p>\n<ol>\n<li>runtime error during session.run</li>\n<li>create new session</li>\n<li>new session fails to evaluate any tensor, giving same runtime error as in step 1.</li>\n</ol>\n<p>The following example fails to evaluate <code>tf.constant</code> with error <code>tensorflow.python.framework.errors_impl.InvalidArgumentError: Cannot assign a device for operation 'Diag</code></p>\n<p>Using 12-day old version from this commit: <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/ea94bbe9fa9f9b3d01fb057c02ef7873d76bf09c/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/ea94bbe9fa9f9b3d01fb057c02ef7873d76bf09c\"><tt>ea94bbe</tt></a></p>\n<pre><code>import tensorflow as tf\ndef main():\n  \n  sess = tf.Session()\n  with tf.device(\"/gpu:0\"):\n    bad_op = tf.diag([1, 1])\n    \n  print(\"About to run tensor \", bad_op)\n  try:\n    sess.run(bad_op)\n  except:\n    print(\"First run failed, trying something else\")\n\n  sess = tf.Session()\n  good_op = tf.constant(1)\n  sess.run(good_op)\n\nmain()\n</code></pre>\n<p>I thought it's something to do with <code>TF_ExtendGraph</code> not being called, but manually adding ExtendGraph before second call results in segmentation fault</p>\n<pre><code>import tensorflow as tf\ndef main():\n  \n  sess = tf.Session()\n  with tf.device(\"/gpu:0\"):\n    bad_op = tf.diag([1, 1])\n    \n  print(\"About to run tensor \", bad_op)\n  try:\n    sess.run(bad_op)\n  except:\n    print(\"First run failed, trying something else\")\n\n  sess = tf.Session()\n  good_op = tf.constant(1)\n  from tensorflow.python import pywrap_tensorflow as tf_session\n  from tensorflow.python.framework import errors\n  with errors.raise_exception_on_not_ok_status() as status:\n    tf_session.TF_ExtendGraph(sess._session, sess.graph.as_graph_def().SerializeToString(), None)\n  sess.run(good_op)\n\nmain()\n\n</code></pre>", "body_text": "Scenario:\n\nruntime error during session.run\ncreate new session\nnew session fails to evaluate any tensor, giving same runtime error as in step 1.\n\nThe following example fails to evaluate tf.constant with error tensorflow.python.framework.errors_impl.InvalidArgumentError: Cannot assign a device for operation 'Diag\nUsing 12-day old version from this commit: ea94bbe\nimport tensorflow as tf\ndef main():\n  \n  sess = tf.Session()\n  with tf.device(\"/gpu:0\"):\n    bad_op = tf.diag([1, 1])\n    \n  print(\"About to run tensor \", bad_op)\n  try:\n    sess.run(bad_op)\n  except:\n    print(\"First run failed, trying something else\")\n\n  sess = tf.Session()\n  good_op = tf.constant(1)\n  sess.run(good_op)\n\nmain()\n\nI thought it's something to do with TF_ExtendGraph not being called, but manually adding ExtendGraph before second call results in segmentation fault\nimport tensorflow as tf\ndef main():\n  \n  sess = tf.Session()\n  with tf.device(\"/gpu:0\"):\n    bad_op = tf.diag([1, 1])\n    \n  print(\"About to run tensor \", bad_op)\n  try:\n    sess.run(bad_op)\n  except:\n    print(\"First run failed, trying something else\")\n\n  sess = tf.Session()\n  good_op = tf.constant(1)\n  from tensorflow.python import pywrap_tensorflow as tf_session\n  from tensorflow.python.framework import errors\n  with errors.raise_exception_on_not_ok_status() as status:\n    tf_session.TF_ExtendGraph(sess._session, sess.graph.as_graph_def().SerializeToString(), None)\n  sess.run(good_op)\n\nmain()", "body": "Scenario:\r\n1. runtime error during session.run\r\n2. create new session\r\n3. new session fails to evaluate any tensor, giving same runtime error as in step 1.\r\n\r\nThe following example fails to evaluate `tf.constant` with error `tensorflow.python.framework.errors_impl.InvalidArgumentError: Cannot assign a device for operation 'Diag`\r\n\r\nUsing 12-day old version from this commit: https://github.com/tensorflow/tensorflow/commit/ea94bbe9fa9f9b3d01fb057c02ef7873d76bf09c\r\n\r\n```\r\nimport tensorflow as tf\r\ndef main():\r\n  \r\n  sess = tf.Session()\r\n  with tf.device(\"/gpu:0\"):\r\n    bad_op = tf.diag([1, 1])\r\n    \r\n  print(\"About to run tensor \", bad_op)\r\n  try:\r\n    sess.run(bad_op)\r\n  except:\r\n    print(\"First run failed, trying something else\")\r\n\r\n  sess = tf.Session()\r\n  good_op = tf.constant(1)\r\n  sess.run(good_op)\r\n\r\nmain()\r\n```\r\n\r\nI thought it's something to do with `TF_ExtendGraph` not being called, but manually adding ExtendGraph before second call results in segmentation fault\r\n\r\n\r\n```\r\nimport tensorflow as tf\r\ndef main():\r\n  \r\n  sess = tf.Session()\r\n  with tf.device(\"/gpu:0\"):\r\n    bad_op = tf.diag([1, 1])\r\n    \r\n  print(\"About to run tensor \", bad_op)\r\n  try:\r\n    sess.run(bad_op)\r\n  except:\r\n    print(\"First run failed, trying something else\")\r\n\r\n  sess = tf.Session()\r\n  good_op = tf.constant(1)\r\n  from tensorflow.python import pywrap_tensorflow as tf_session\r\n  from tensorflow.python.framework import errors\r\n  with errors.raise_exception_on_not_ok_status() as status:\r\n    tf_session.TF_ExtendGraph(sess._session, sess.graph.as_graph_def().SerializeToString(), None)\r\n  sess.run(good_op)\r\n\r\nmain()\r\n\r\n```\r\n\r\n  \r\n"}