{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/138755283", "pull_request_review_id": 62594768, "id": 138755283, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzODc1NTI4Mw==", "diff_hunk": "@@ -2041,48 +2041,38 @@ def accumulate_n(inputs, shape=None, tensor_dtype=None, name=None):\n     ValueError: If `inputs` don't all have same shape and dtype or the shape\n     cannot be inferred.\n   \"\"\"\n+  _INPUTS_ERR_MSG = ValueError(\"inputs must be a list of at least one Tensor\"\n+                               \"with the same dtype and shape\")\n   if context.in_eager_mode():\n     # TODO(apassos) remove this once the lifetime of eager variables gets\n     # addressed.\n     raise ValueError(\"accumulate_n not supported in eager mode\")\n   if not inputs or not isinstance(inputs, (list, tuple)):\n-    raise ValueError(\"inputs must be a list of at least one Tensor with the \"\n-                     \"same dtype and shape\")\n+    raise _INPUTS_ERR_MSG\n   inputs = ops.convert_n_to_tensor_or_indexed_slices(inputs)\n   if not all(isinstance(x, ops.Tensor) for x in inputs):\n-    raise ValueError(\"inputs must be a list of at least one Tensor with the \"\n-                     \"same dtype and shape\")\n+    raise _INPUTS_ERR_MSG\n   if not all(x.dtype == inputs[0].dtype for x in inputs):\n-    raise ValueError(\"inputs must be a list of at least one Tensor with the \"\n-                     \"same dtype and shape\")\n+    raise _INPUTS_ERR_MSG\n   if shape is not None:\n     shape = tensor_shape.as_shape(shape)\n   else:\n     shape = tensor_shape.unknown_shape()\n   for input_tensor in inputs:\n     if isinstance(input_tensor, ops.Tensor):\n       shape = shape.merge_with(input_tensor.get_shape())\n-  if tensor_dtype is None:\n-    tensor_dtype = inputs[0].dtype\n-  if tensor_dtype != inputs[0].dtype:\n+\n+  # tensor_dtype is for safety only; operator's output type computed in C++\n+  if tensor_dtype is not None and tensor_dtype != inputs[0].dtype:\n     raise TypeError(\"tensor_dtype is {}, but input is of type {}\"\n                     .format(tensor_dtype, inputs[0].dtype))\n-  if len(inputs) == 1:\n+\n+  if len(inputs) == 1 and name is None:\n     return inputs[0]\n-  with ops.name_scope(name, \"AccumulateN\", inputs) as name:", "path": "tensorflow/python/ops/math_ops.py", "position": 42, "original_position": 42, "commit_id": "77f9498601c8246170ba06b97e71460379c64b4c", "original_commit_id": "c6b5de65ce8de611e075725e58a3a92c051dabce", "user": {"login": "frreiss", "id": 12436991, "node_id": "MDQ6VXNlcjEyNDM2OTkx", "avatar_url": "https://avatars1.githubusercontent.com/u/12436991?v=4", "gravatar_id": "", "url": "https://api.github.com/users/frreiss", "html_url": "https://github.com/frreiss", "followers_url": "https://api.github.com/users/frreiss/followers", "following_url": "https://api.github.com/users/frreiss/following{/other_user}", "gists_url": "https://api.github.com/users/frreiss/gists{/gist_id}", "starred_url": "https://api.github.com/users/frreiss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/frreiss/subscriptions", "organizations_url": "https://api.github.com/users/frreiss/orgs", "repos_url": "https://api.github.com/users/frreiss/repos", "events_url": "https://api.github.com/users/frreiss/events{/privacy}", "received_events_url": "https://api.github.com/users/frreiss/received_events", "type": "User", "site_admin": false}, "body": "Sure, no problem. I can restructure the code so the new implementation is a different op with a different name and the old op remains unchanged.", "created_at": "2017-09-13T22:22:30Z", "updated_at": "2017-09-13T22:22:30Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/13022#discussion_r138755283", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13022", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/138755283"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/13022#discussion_r138755283"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13022"}}, "body_html": "<p>Sure, no problem. I can restructure the code so the new implementation is a different op with a different name and the old op remains unchanged.</p>", "body_text": "Sure, no problem. I can restructure the code so the new implementation is a different op with a different name and the old op remains unchanged.", "in_reply_to_id": 138747312}