{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/414505377", "html_url": "https://github.com/tensorflow/tensorflow/issues/21473#issuecomment-414505377", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21473", "id": 414505377, "node_id": "MDEyOklzc3VlQ29tbWVudDQxNDUwNTM3Nw==", "user": {"login": "jyoungyun", "id": 7223627, "node_id": "MDQ6VXNlcjcyMjM2Mjc=", "avatar_url": "https://avatars1.githubusercontent.com/u/7223627?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyoungyun", "html_url": "https://github.com/jyoungyun", "followers_url": "https://api.github.com/users/jyoungyun/followers", "following_url": "https://api.github.com/users/jyoungyun/following{/other_user}", "gists_url": "https://api.github.com/users/jyoungyun/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyoungyun/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyoungyun/subscriptions", "organizations_url": "https://api.github.com/users/jyoungyun/orgs", "repos_url": "https://api.github.com/users/jyoungyun/repos", "events_url": "https://api.github.com/users/jyoungyun/events{/privacy}", "received_events_url": "https://api.github.com/users/jyoungyun/received_events", "type": "User", "site_admin": false}, "created_at": "2018-08-21T00:14:22Z", "updated_at": "2018-08-21T00:14:22Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=20959853\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/drpngx\">@drpngx</a> I couldn't find a good way to share a test for this issue, so for now I shared a test scenario here with test file. (<a href=\"https://github.com/tensorflow/tensorflow/files/2304231/rnn_optimized.pb.txt\">rnn_optimized.pb.txt</a>, this is a pb file so please remove the txt extension before using it.)</p>\n<p>And command is :</p>\n<pre><code>bazel run tensorflow/contrib/lite/toco:toco -- \\\n--input_file=\"$HOME/git/ml/test/rnn_mnist/save/rnn_optimized.pb\" \\\n--input_format=TENSORFLOW_GRAPHDEF \\\n--output_format=TFLITE \\\n--output_file=\"$HOME/git/ml/test/rnn_mnist/save/rnn_optimized.tflite\" \\\n--input_arrays=\"input_tensor\" \\\n--input_shapes=\"1,28\" \\\n--output_arrays=\"output\" \\\n--allow_custom_ops \\\n--toco_compatible=True\n</code></pre>\n<p>Before applying my changes(<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"348653545\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/21474\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/21474/hovercard\" href=\"https://github.com/tensorflow/tensorflow/pull/21474\">#21474</a>), the generated tflite file does not have a <code>LSTM</code> operator.</p>\n<pre><code>Number of all operator types: 7\n\tCONCATENATION                         :   28 \t (instrs: 0)\n\tFULLY_CONNECTED                       :   29 \t (instrs: 90,520,366,340,588,690,046)\n\tSPLIT                                 :   28 \t (instrs: ???)\n\tLOGISTIC                              :   83 \t (instrs: ???)\n\tTANH                                  :   56 \t (instrs: ???)\n\tMUL                                   :   83 \t (instrs: ???)\n\tADD                                   :   55 \t (instrs: ???)\nNumber of all operators                       :  362 \t (total instrs: 90,520,366,340,588,690,046)\n</code></pre>\n<p>However, when it tests with my changing, it makes a <code>LSTM</code> operator successfully.</p>\n<pre><code>Number of all operator types: 8\n\tCONCATENATION                         :    1 \t (instrs: 0)\n\tFULLY_CONNECTED                       :    2 \t (instrs: 7,307,046,758,316,309,978)\n\tSPLIT                                 :    1 \t (instrs: ???)\n\tLOGISTIC                              :    2 \t (instrs: ???)\n\tTANH                                  :    2 \t (instrs: ???)\n\tMUL                                   :    2 \t (instrs: ???)\n\tADD                                   :    1 \t (instrs: ???)\n\tLSTM                                  :   27 \t (instrs: ???)\nNumber of all operators                       :   38 \t (total instrs: 7,307,046,758,316,309,978)\n</code></pre>", "body_text": "@drpngx I couldn't find a good way to share a test for this issue, so for now I shared a test scenario here with test file. (rnn_optimized.pb.txt, this is a pb file so please remove the txt extension before using it.)\nAnd command is :\nbazel run tensorflow/contrib/lite/toco:toco -- \\\n--input_file=\"$HOME/git/ml/test/rnn_mnist/save/rnn_optimized.pb\" \\\n--input_format=TENSORFLOW_GRAPHDEF \\\n--output_format=TFLITE \\\n--output_file=\"$HOME/git/ml/test/rnn_mnist/save/rnn_optimized.tflite\" \\\n--input_arrays=\"input_tensor\" \\\n--input_shapes=\"1,28\" \\\n--output_arrays=\"output\" \\\n--allow_custom_ops \\\n--toco_compatible=True\n\nBefore applying my changes(#21474), the generated tflite file does not have a LSTM operator.\nNumber of all operator types: 7\n\tCONCATENATION                         :   28 \t (instrs: 0)\n\tFULLY_CONNECTED                       :   29 \t (instrs: 90,520,366,340,588,690,046)\n\tSPLIT                                 :   28 \t (instrs: ???)\n\tLOGISTIC                              :   83 \t (instrs: ???)\n\tTANH                                  :   56 \t (instrs: ???)\n\tMUL                                   :   83 \t (instrs: ???)\n\tADD                                   :   55 \t (instrs: ???)\nNumber of all operators                       :  362 \t (total instrs: 90,520,366,340,588,690,046)\n\nHowever, when it tests with my changing, it makes a LSTM operator successfully.\nNumber of all operator types: 8\n\tCONCATENATION                         :    1 \t (instrs: 0)\n\tFULLY_CONNECTED                       :    2 \t (instrs: 7,307,046,758,316,309,978)\n\tSPLIT                                 :    1 \t (instrs: ???)\n\tLOGISTIC                              :    2 \t (instrs: ???)\n\tTANH                                  :    2 \t (instrs: ???)\n\tMUL                                   :    2 \t (instrs: ???)\n\tADD                                   :    1 \t (instrs: ???)\n\tLSTM                                  :   27 \t (instrs: ???)\nNumber of all operators                       :   38 \t (total instrs: 7,307,046,758,316,309,978)", "body": "@drpngx I couldn't find a good way to share a test for this issue, so for now I shared a test scenario here with test file. ([rnn_optimized.pb.txt](https://github.com/tensorflow/tensorflow/files/2304231/rnn_optimized.pb.txt), this is a pb file so please remove the txt extension before using it.)\r\n\r\nAnd command is :\r\n```\r\nbazel run tensorflow/contrib/lite/toco:toco -- \\\r\n--input_file=\"$HOME/git/ml/test/rnn_mnist/save/rnn_optimized.pb\" \\\r\n--input_format=TENSORFLOW_GRAPHDEF \\\r\n--output_format=TFLITE \\\r\n--output_file=\"$HOME/git/ml/test/rnn_mnist/save/rnn_optimized.tflite\" \\\r\n--input_arrays=\"input_tensor\" \\\r\n--input_shapes=\"1,28\" \\\r\n--output_arrays=\"output\" \\\r\n--allow_custom_ops \\\r\n--toco_compatible=True\r\n```\r\n\r\nBefore applying my changes(#21474), the generated tflite file does not have a `LSTM` operator.\r\n```\r\nNumber of all operator types: 7\r\n\tCONCATENATION                         :   28 \t (instrs: 0)\r\n\tFULLY_CONNECTED                       :   29 \t (instrs: 90,520,366,340,588,690,046)\r\n\tSPLIT                                 :   28 \t (instrs: ???)\r\n\tLOGISTIC                              :   83 \t (instrs: ???)\r\n\tTANH                                  :   56 \t (instrs: ???)\r\n\tMUL                                   :   83 \t (instrs: ???)\r\n\tADD                                   :   55 \t (instrs: ???)\r\nNumber of all operators                       :  362 \t (total instrs: 90,520,366,340,588,690,046)\r\n```\r\nHowever, when it tests with my changing, it makes a `LSTM` operator successfully.\r\n```\r\nNumber of all operator types: 8\r\n\tCONCATENATION                         :    1 \t (instrs: 0)\r\n\tFULLY_CONNECTED                       :    2 \t (instrs: 7,307,046,758,316,309,978)\r\n\tSPLIT                                 :    1 \t (instrs: ???)\r\n\tLOGISTIC                              :    2 \t (instrs: ???)\r\n\tTANH                                  :    2 \t (instrs: ???)\r\n\tMUL                                   :    2 \t (instrs: ???)\r\n\tADD                                   :    1 \t (instrs: ???)\r\n\tLSTM                                  :   27 \t (instrs: ???)\r\nNumber of all operators                       :   38 \t (total instrs: 7,307,046,758,316,309,978)\r\n```\r\n"}