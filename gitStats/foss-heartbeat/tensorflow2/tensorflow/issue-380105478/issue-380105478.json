{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23709", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23709/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23709/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23709/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23709", "id": 380105478, "node_id": "MDU6SXNzdWUzODAxMDU0Nzg=", "number": 23709, "title": "image_ocr.py running error on tf.keras", "user": {"login": "shijie001", "id": 25165513, "node_id": "MDQ6VXNlcjI1MTY1NTEz", "avatar_url": "https://avatars3.githubusercontent.com/u/25165513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shijie001", "html_url": "https://github.com/shijie001", "followers_url": "https://api.github.com/users/shijie001/followers", "following_url": "https://api.github.com/users/shijie001/following{/other_user}", "gists_url": "https://api.github.com/users/shijie001/gists{/gist_id}", "starred_url": "https://api.github.com/users/shijie001/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shijie001/subscriptions", "organizations_url": "https://api.github.com/users/shijie001/orgs", "repos_url": "https://api.github.com/users/shijie001/repos", "events_url": "https://api.github.com/users/shijie001/events{/privacy}", "received_events_url": "https://api.github.com/users/shijie001/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1097546578, "node_id": "MDU6TGFiZWwxMDk3NTQ2NTc4", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:keras", "name": "comp:keras", "color": "0052cc", "default": false}], "state": "open", "locked": false, "assignee": {"login": "ymodak", "id": 42785357, "node_id": "MDQ6VXNlcjQyNzg1MzU3", "avatar_url": "https://avatars1.githubusercontent.com/u/42785357?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ymodak", "html_url": "https://github.com/ymodak", "followers_url": "https://api.github.com/users/ymodak/followers", "following_url": "https://api.github.com/users/ymodak/following{/other_user}", "gists_url": "https://api.github.com/users/ymodak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ymodak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ymodak/subscriptions", "organizations_url": "https://api.github.com/users/ymodak/orgs", "repos_url": "https://api.github.com/users/ymodak/repos", "events_url": "https://api.github.com/users/ymodak/events{/privacy}", "received_events_url": "https://api.github.com/users/ymodak/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ymodak", "id": 42785357, "node_id": "MDQ6VXNlcjQyNzg1MzU3", "avatar_url": "https://avatars1.githubusercontent.com/u/42785357?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ymodak", "html_url": "https://github.com/ymodak", "followers_url": "https://api.github.com/users/ymodak/followers", "following_url": "https://api.github.com/users/ymodak/following{/other_user}", "gists_url": "https://api.github.com/users/ymodak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ymodak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ymodak/subscriptions", "organizations_url": "https://api.github.com/users/ymodak/orgs", "repos_url": "https://api.github.com/users/ymodak/repos", "events_url": "https://api.github.com/users/ymodak/events{/privacy}", "received_events_url": "https://api.github.com/users/ymodak/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2018-11-13T08:12:52Z", "updated_at": "2018-11-14T01:44:18Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>I try to run image_ocr.py on tf.keras.<br>\nimage_ocr.py is the example code from keras<br>\n<a href=\"https://github.com/keras-team/keras/blob/master/examples/image_ocr.py\">https://github.com/keras-team/keras/blob/master/examples/image_ocr.py</a></p>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>import tensorflow as tf<br>\ntf.<strong>version</strong><br>\n'1.11.0'<br>\ntf.keras.<strong>version</strong><br>\n'2.1.6-tf'</p>\n</blockquote>\n</blockquote>\n</blockquote>\n<p>I only modify some imports to use tf.keras.</p>\n<p>import tensorflow as tf<br>\nfrom tensorflow.keras import backend as K<br>\nfrom tensorflow.keras.layers import Conv2D, MaxPooling2D<br>\n...</p>\n<p>The error code<br>\nFile \"D:\\Anaconda2\\envs\\tf-cpu\\lib\\site-packages\\tensorflow\\python\\keras\\utils\\data_utils.py\", line 689, in _data_generator_task<br>\ngenerator_output = next(self._generator)<br>\nFile \"image_ocr.py\", line 312, in next_train<br>\nprint(self.cur_train_index)<br>\nAttributeError: 'TextImageGenerator' object has no attribute 'cur_train_index'</p>\n<p>The problem is occurs in model.fit_generator().<br>\nI found next_train() and build_word_list() run in different python thread.</p>\n<p>the next_train() is called before the build_word_list(). So the initializeation of TextImageGenerator is incorrect.</p>\n<p>I also try to set  \"workers=0\" to use single thread.<br>\nmodel.fit_generator(<br>\ngenerator=img_gen.next_train(),<br>\nsteps_per_epoch=(words_per_epoch - val_words) // minibatch_size,<br>\nepochs=stop_epoch,<br>\nvalidation_data=img_gen.next_val(),<br>\nvalidation_steps=val_words // minibatch_size,<br>\ncallbacks=[viz_cb, img_gen],<br>\ninitial_epoch=start_epoch,<br>\nworkers=0)</p>\n<p>Now it can run. But the traing does not converge. 100% error result.<br>\nBut there is no problem if use Keras intead of tf.keras.</p>", "body_text": "I try to run image_ocr.py on tf.keras.\nimage_ocr.py is the example code from keras\nhttps://github.com/keras-team/keras/blob/master/examples/image_ocr.py\n\n\n\nimport tensorflow as tf\ntf.version\n'1.11.0'\ntf.keras.version\n'2.1.6-tf'\n\n\n\nI only modify some imports to use tf.keras.\nimport tensorflow as tf\nfrom tensorflow.keras import backend as K\nfrom tensorflow.keras.layers import Conv2D, MaxPooling2D\n...\nThe error code\nFile \"D:\\Anaconda2\\envs\\tf-cpu\\lib\\site-packages\\tensorflow\\python\\keras\\utils\\data_utils.py\", line 689, in _data_generator_task\ngenerator_output = next(self._generator)\nFile \"image_ocr.py\", line 312, in next_train\nprint(self.cur_train_index)\nAttributeError: 'TextImageGenerator' object has no attribute 'cur_train_index'\nThe problem is occurs in model.fit_generator().\nI found next_train() and build_word_list() run in different python thread.\nthe next_train() is called before the build_word_list(). So the initializeation of TextImageGenerator is incorrect.\nI also try to set  \"workers=0\" to use single thread.\nmodel.fit_generator(\ngenerator=img_gen.next_train(),\nsteps_per_epoch=(words_per_epoch - val_words) // minibatch_size,\nepochs=stop_epoch,\nvalidation_data=img_gen.next_val(),\nvalidation_steps=val_words // minibatch_size,\ncallbacks=[viz_cb, img_gen],\ninitial_epoch=start_epoch,\nworkers=0)\nNow it can run. But the traing does not converge. 100% error result.\nBut there is no problem if use Keras intead of tf.keras.", "body": "I try to run image_ocr.py on tf.keras.\r\nimage_ocr.py is the example code from keras\r\nhttps://github.com/keras-team/keras/blob/master/examples/image_ocr.py\r\n\r\n>>> import tensorflow as tf\r\n>>> tf.__version__\r\n'1.11.0'\r\n>>> tf.keras.__version__\r\n'2.1.6-tf'\r\n>>>\r\n\r\nI only modify some imports to use tf.keras.\r\n\r\nimport tensorflow as tf\r\nfrom tensorflow.keras import backend as K\r\nfrom tensorflow.keras.layers import Conv2D, MaxPooling2D\r\n...\r\n\r\nThe error code\r\n  File \"D:\\Anaconda2\\envs\\tf-cpu\\lib\\site-packages\\tensorflow\\python\\keras\\utils\\data_utils.py\", line 689, in _data_generator_task\r\n    generator_output = next(self._generator)\r\n  File \"image_ocr.py\", line 312, in next_train\r\n    print(self.cur_train_index)\r\nAttributeError: 'TextImageGenerator' object has no attribute 'cur_train_index'\r\n\r\nThe problem is occurs in model.fit_generator().\r\nI found next_train() and build_word_list() run in different python thread.\r\n\r\nthe next_train() is called before the build_word_list(). So the initializeation of TextImageGenerator is incorrect.\r\n\r\nI also try to set  \"workers=0\" to use single thread. \r\n    model.fit_generator(\r\n        generator=img_gen.next_train(),\r\n        steps_per_epoch=(words_per_epoch - val_words) // minibatch_size,\r\n        epochs=stop_epoch,\r\n        validation_data=img_gen.next_val(),\r\n        validation_steps=val_words // minibatch_size,\r\n        callbacks=[viz_cb, img_gen],\r\n        initial_epoch=start_epoch,\r\n        workers=0)\r\n\r\nNow it can run. But the traing does not converge. 100% error result.\r\nBut there is no problem if use Keras intead of tf.keras.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"}