{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22897", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22897/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22897/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22897/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/22897", "id": 369109032, "node_id": "MDU6SXNzdWUzNjkxMDkwMzI=", "number": 22897, "title": "Conversion from pb to tflite fails", "user": {"login": "Noltibus", "id": 15614838, "node_id": "MDQ6VXNlcjE1NjE0ODM4", "avatar_url": "https://avatars3.githubusercontent.com/u/15614838?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Noltibus", "html_url": "https://github.com/Noltibus", "followers_url": "https://api.github.com/users/Noltibus/followers", "following_url": "https://api.github.com/users/Noltibus/following{/other_user}", "gists_url": "https://api.github.com/users/Noltibus/gists{/gist_id}", "starred_url": "https://api.github.com/users/Noltibus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Noltibus/subscriptions", "organizations_url": "https://api.github.com/users/Noltibus/orgs", "repos_url": "https://api.github.com/users/Noltibus/repos", "events_url": "https://api.github.com/users/Noltibus/events{/privacy}", "received_events_url": "https://api.github.com/users/Noltibus/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 750616506, "node_id": "MDU6TGFiZWw3NTA2MTY1MDY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:lite", "name": "comp:lite", "color": "0052cc", "default": false}], "state": "open", "locked": false, "assignee": {"login": "aselle", "id": 326106, "node_id": "MDQ6VXNlcjMyNjEwNg==", "avatar_url": "https://avatars1.githubusercontent.com/u/326106?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aselle", "html_url": "https://github.com/aselle", "followers_url": "https://api.github.com/users/aselle/followers", "following_url": "https://api.github.com/users/aselle/following{/other_user}", "gists_url": "https://api.github.com/users/aselle/gists{/gist_id}", "starred_url": "https://api.github.com/users/aselle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aselle/subscriptions", "organizations_url": "https://api.github.com/users/aselle/orgs", "repos_url": "https://api.github.com/users/aselle/repos", "events_url": "https://api.github.com/users/aselle/events{/privacy}", "received_events_url": "https://api.github.com/users/aselle/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "aselle", "id": 326106, "node_id": "MDQ6VXNlcjMyNjEwNg==", "avatar_url": "https://avatars1.githubusercontent.com/u/326106?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aselle", "html_url": "https://github.com/aselle", "followers_url": "https://api.github.com/users/aselle/followers", "following_url": "https://api.github.com/users/aselle/following{/other_user}", "gists_url": "https://api.github.com/users/aselle/gists{/gist_id}", "starred_url": "https://api.github.com/users/aselle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aselle/subscriptions", "organizations_url": "https://api.github.com/users/aselle/orgs", "repos_url": "https://api.github.com/users/aselle/repos", "events_url": "https://api.github.com/users/aselle/events{/privacy}", "received_events_url": "https://api.github.com/users/aselle/received_events", "type": "User", "site_admin": false}, {"login": "gargn", "id": 1900612, "node_id": "MDQ6VXNlcjE5MDA2MTI=", "avatar_url": "https://avatars2.githubusercontent.com/u/1900612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gargn", "html_url": "https://github.com/gargn", "followers_url": "https://api.github.com/users/gargn/followers", "following_url": "https://api.github.com/users/gargn/following{/other_user}", "gists_url": "https://api.github.com/users/gargn/gists{/gist_id}", "starred_url": "https://api.github.com/users/gargn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gargn/subscriptions", "organizations_url": "https://api.github.com/users/gargn/orgs", "repos_url": "https://api.github.com/users/gargn/repos", "events_url": "https://api.github.com/users/gargn/events{/privacy}", "received_events_url": "https://api.github.com/users/gargn/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2018-10-11T12:58:27Z", "updated_at": "2018-11-15T07:20:50Z", "closed_at": null, "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Windows 10</li>\n<li><strong>Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device</strong>:</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary through pip</li>\n<li><strong>TensorFlow version (use command below)</strong>: tf-nightly and tf 1.11 (updated today)</li>\n<li><strong>Python version</strong>: 3.6.6</li>\n<li><strong>Bazel version (if compiling from source)</strong>:</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>:</li>\n<li><strong>CUDA/cuDNN version</strong>: CPU only</li>\n<li><strong>GPU model and memory</strong>:</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>I have a trained model and exportet it to a frozen pb file. After that, I optimized this frozen graph for inference. Now I want to convert this graph to a tflite model to use on Android.<br>\nThe code I used to convert it is:</p>\n<pre><code>import tensorflow as tf\n\ngraph_def_file = \"graph_optimized.pb\"\ninput_arrays = [\"Placeholder\"]\noutput_arrays = [\"output\"]\n\nconverter = tf.contrib.lite.TocoConverter.from_frozen_graph(\n    graph_def_file, input_arrays, output_arrays, input_shapes={\"Placeholder\" : [1, 227, 227, 3]})\ntflite_model = converter.convert()\nopen(\"save_path/converted_model.tflite\", \"wb\").write(tflite_model)\n</code></pre>\n<p>This fails with an error. I tried it both with my existing tensorflow installation and with a clean installation in a new virtualenv with tf-nightly like it was suggested in issue <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"365131817\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/22617\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/22617/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/22617\">#22617</a> . Still the same errors happen</p>\n<h3>Source code / logs</h3>\n<pre><code>WARNING:tensorflow:From C:/Users/User/Documents/Test_export/export.py:8: TocoConverter.from_frozen_graph (from tensorflow.contrib.lite.python.lite) is deprecated and will be removed in a future version.\nInstructions for updating:\nUse `lite.TFLiteConverter.from_frozen_graph` instead.\n2018-10-11 11:57:49.338944: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2\nTraceback (most recent call last):\n  File \"C:/Users/User/Documents/Test_export/export.py\", line 9, in &lt;module&gt;\n    tflite_model = converter.convert()\n  File \"C:\\Users\\User\\venv-tf-nightly\\lib\\site-packages\\tensorflow\\contrib\\lite\\python\\lite.py\", line 453, in convert\n    **converter_kwargs)\n  File \"C:\\Users\\User\\venv-tf-nightly\\lib\\site-packages\\tensorflow\\contrib\\lite\\python\\convert.py\", line 348, in toco_convert_impl\n    input_data.SerializeToString())\n  File \"C:\\Users\\User\\venv-tf-nightly\\lib\\site-packages\\tensorflow\\contrib\\lite\\python\\convert.py\", line 135, in toco_convert_protos\n    (stdout, stderr))\nRuntimeError: TOCO failed see console for info.\nb'Traceback (most recent call last):\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\site-packages\\\\tensorflow\\\\contrib\\\\lite\\\\toco\\\\python\\\\tensorflow_wrap_toco.py\", line 18, in swig_import_helper\\r\\n    fp, pathname, description = imp.find_module(\\'_tensorflow_wrap_toco\\', [dirname(__file__)])\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\imp.py\", line 297, in find_module\\r\\n    raise ImportError(_ERR_MSG.format(name), name=name)\\r\\nImportError: No module named \\'_tensorflow_wrap_toco\\'\\r\\n\\r\\nDuring handling of the above exception, another exception occurred:\\r\\n\\r\\nTraceback (most recent call last):\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\runpy.py\", line 193, in _run_module_as_main\\r\\n    \"__main__\", mod_spec)\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\runpy.py\", line 85, in _run_code\\r\\n    exec(code, run_globals)\\r\\n  File \"C:\\\\Users\\\\User\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python36\\\\Scripts\\\\toco_from_protos.exe\\\\__main__.py\", line 5, in &lt;module&gt;\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\site-packages\\\\tensorflow\\\\contrib\\\\lite\\\\toco\\\\python\\\\toco_from_protos.py\", line 22, in &lt;module&gt;\\r\\n    from tensorflow.contrib.lite.toco.python import tensorflow_wrap_toco\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\site-packages\\\\tensorflow\\\\contrib\\\\lite\\\\toco\\\\python\\\\tensorflow_wrap_toco.py\", line 28, in &lt;module&gt;\\r\\n    _tensorflow_wrap_toco = swig_import_helper()\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\site-packages\\\\tensorflow\\\\contrib\\\\lite\\\\toco\\\\python\\\\tensorflow_wrap_toco.py\", line 20, in swig_import_helper\\r\\n    import _tensorflow_wrap_toco\\r\\nModuleNotFoundError: No module named \\'_tensorflow_wrap_toco\\'\\r\\n'\nNone\n\n\nProcess finished with exit code 1\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Windows 10\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:\nTensorFlow installed from (source or binary): binary through pip\nTensorFlow version (use command below): tf-nightly and tf 1.11 (updated today)\nPython version: 3.6.6\nBazel version (if compiling from source):\nGCC/Compiler version (if compiling from source):\nCUDA/cuDNN version: CPU only\nGPU model and memory:\nExact command to reproduce:\n\nDescribe the problem\nI have a trained model and exportet it to a frozen pb file. After that, I optimized this frozen graph for inference. Now I want to convert this graph to a tflite model to use on Android.\nThe code I used to convert it is:\nimport tensorflow as tf\n\ngraph_def_file = \"graph_optimized.pb\"\ninput_arrays = [\"Placeholder\"]\noutput_arrays = [\"output\"]\n\nconverter = tf.contrib.lite.TocoConverter.from_frozen_graph(\n    graph_def_file, input_arrays, output_arrays, input_shapes={\"Placeholder\" : [1, 227, 227, 3]})\ntflite_model = converter.convert()\nopen(\"save_path/converted_model.tflite\", \"wb\").write(tflite_model)\n\nThis fails with an error. I tried it both with my existing tensorflow installation and with a clean installation in a new virtualenv with tf-nightly like it was suggested in issue #22617 . Still the same errors happen\nSource code / logs\nWARNING:tensorflow:From C:/Users/User/Documents/Test_export/export.py:8: TocoConverter.from_frozen_graph (from tensorflow.contrib.lite.python.lite) is deprecated and will be removed in a future version.\nInstructions for updating:\nUse `lite.TFLiteConverter.from_frozen_graph` instead.\n2018-10-11 11:57:49.338944: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2\nTraceback (most recent call last):\n  File \"C:/Users/User/Documents/Test_export/export.py\", line 9, in <module>\n    tflite_model = converter.convert()\n  File \"C:\\Users\\User\\venv-tf-nightly\\lib\\site-packages\\tensorflow\\contrib\\lite\\python\\lite.py\", line 453, in convert\n    **converter_kwargs)\n  File \"C:\\Users\\User\\venv-tf-nightly\\lib\\site-packages\\tensorflow\\contrib\\lite\\python\\convert.py\", line 348, in toco_convert_impl\n    input_data.SerializeToString())\n  File \"C:\\Users\\User\\venv-tf-nightly\\lib\\site-packages\\tensorflow\\contrib\\lite\\python\\convert.py\", line 135, in toco_convert_protos\n    (stdout, stderr))\nRuntimeError: TOCO failed see console for info.\nb'Traceback (most recent call last):\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\site-packages\\\\tensorflow\\\\contrib\\\\lite\\\\toco\\\\python\\\\tensorflow_wrap_toco.py\", line 18, in swig_import_helper\\r\\n    fp, pathname, description = imp.find_module(\\'_tensorflow_wrap_toco\\', [dirname(__file__)])\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\imp.py\", line 297, in find_module\\r\\n    raise ImportError(_ERR_MSG.format(name), name=name)\\r\\nImportError: No module named \\'_tensorflow_wrap_toco\\'\\r\\n\\r\\nDuring handling of the above exception, another exception occurred:\\r\\n\\r\\nTraceback (most recent call last):\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\runpy.py\", line 193, in _run_module_as_main\\r\\n    \"__main__\", mod_spec)\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\runpy.py\", line 85, in _run_code\\r\\n    exec(code, run_globals)\\r\\n  File \"C:\\\\Users\\\\User\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python36\\\\Scripts\\\\toco_from_protos.exe\\\\__main__.py\", line 5, in <module>\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\site-packages\\\\tensorflow\\\\contrib\\\\lite\\\\toco\\\\python\\\\toco_from_protos.py\", line 22, in <module>\\r\\n    from tensorflow.contrib.lite.toco.python import tensorflow_wrap_toco\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\site-packages\\\\tensorflow\\\\contrib\\\\lite\\\\toco\\\\python\\\\tensorflow_wrap_toco.py\", line 28, in <module>\\r\\n    _tensorflow_wrap_toco = swig_import_helper()\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\site-packages\\\\tensorflow\\\\contrib\\\\lite\\\\toco\\\\python\\\\tensorflow_wrap_toco.py\", line 20, in swig_import_helper\\r\\n    import _tensorflow_wrap_toco\\r\\nModuleNotFoundError: No module named \\'_tensorflow_wrap_toco\\'\\r\\n'\nNone\n\n\nProcess finished with exit code 1", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Windows 10\r\n- **Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device**:\r\n- **TensorFlow installed from (source or binary)**: binary through pip\r\n- **TensorFlow version (use command below)**: tf-nightly and tf 1.11 (updated today)\r\n- **Python version**: 3.6.6\r\n- **Bazel version (if compiling from source)**:\r\n- **GCC/Compiler version (if compiling from source)**:\r\n- **CUDA/cuDNN version**: CPU only\r\n- **GPU model and memory**:\r\n- **Exact command to reproduce**:\r\n\r\n\r\n### Describe the problem\r\nI have a trained model and exportet it to a frozen pb file. After that, I optimized this frozen graph for inference. Now I want to convert this graph to a tflite model to use on Android.\r\nThe code I used to convert it is:\r\n```\r\nimport tensorflow as tf\r\n\r\ngraph_def_file = \"graph_optimized.pb\"\r\ninput_arrays = [\"Placeholder\"]\r\noutput_arrays = [\"output\"]\r\n\r\nconverter = tf.contrib.lite.TocoConverter.from_frozen_graph(\r\n    graph_def_file, input_arrays, output_arrays, input_shapes={\"Placeholder\" : [1, 227, 227, 3]})\r\ntflite_model = converter.convert()\r\nopen(\"save_path/converted_model.tflite\", \"wb\").write(tflite_model)\r\n```\r\n\r\nThis fails with an error. I tried it both with my existing tensorflow installation and with a clean installation in a new virtualenv with tf-nightly like it was suggested in issue #22617 . Still the same errors happen\r\n### Source code / logs\r\n\r\n```\r\nWARNING:tensorflow:From C:/Users/User/Documents/Test_export/export.py:8: TocoConverter.from_frozen_graph (from tensorflow.contrib.lite.python.lite) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nUse `lite.TFLiteConverter.from_frozen_graph` instead.\r\n2018-10-11 11:57:49.338944: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2\r\nTraceback (most recent call last):\r\n  File \"C:/Users/User/Documents/Test_export/export.py\", line 9, in <module>\r\n    tflite_model = converter.convert()\r\n  File \"C:\\Users\\User\\venv-tf-nightly\\lib\\site-packages\\tensorflow\\contrib\\lite\\python\\lite.py\", line 453, in convert\r\n    **converter_kwargs)\r\n  File \"C:\\Users\\User\\venv-tf-nightly\\lib\\site-packages\\tensorflow\\contrib\\lite\\python\\convert.py\", line 348, in toco_convert_impl\r\n    input_data.SerializeToString())\r\n  File \"C:\\Users\\User\\venv-tf-nightly\\lib\\site-packages\\tensorflow\\contrib\\lite\\python\\convert.py\", line 135, in toco_convert_protos\r\n    (stdout, stderr))\r\nRuntimeError: TOCO failed see console for info.\r\nb'Traceback (most recent call last):\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\site-packages\\\\tensorflow\\\\contrib\\\\lite\\\\toco\\\\python\\\\tensorflow_wrap_toco.py\", line 18, in swig_import_helper\\r\\n    fp, pathname, description = imp.find_module(\\'_tensorflow_wrap_toco\\', [dirname(__file__)])\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\imp.py\", line 297, in find_module\\r\\n    raise ImportError(_ERR_MSG.format(name), name=name)\\r\\nImportError: No module named \\'_tensorflow_wrap_toco\\'\\r\\n\\r\\nDuring handling of the above exception, another exception occurred:\\r\\n\\r\\nTraceback (most recent call last):\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\runpy.py\", line 193, in _run_module_as_main\\r\\n    \"__main__\", mod_spec)\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\runpy.py\", line 85, in _run_code\\r\\n    exec(code, run_globals)\\r\\n  File \"C:\\\\Users\\\\User\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python36\\\\Scripts\\\\toco_from_protos.exe\\\\__main__.py\", line 5, in <module>\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\site-packages\\\\tensorflow\\\\contrib\\\\lite\\\\toco\\\\python\\\\toco_from_protos.py\", line 22, in <module>\\r\\n    from tensorflow.contrib.lite.toco.python import tensorflow_wrap_toco\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\site-packages\\\\tensorflow\\\\contrib\\\\lite\\\\toco\\\\python\\\\tensorflow_wrap_toco.py\", line 28, in <module>\\r\\n    _tensorflow_wrap_toco = swig_import_helper()\\r\\n  File \"c:\\\\users\\\\user\\\\appdata\\\\local\\\\programs\\\\python\\\\python36\\\\lib\\\\site-packages\\\\tensorflow\\\\contrib\\\\lite\\\\toco\\\\python\\\\tensorflow_wrap_toco.py\", line 20, in swig_import_helper\\r\\n    import _tensorflow_wrap_toco\\r\\nModuleNotFoundError: No module named \\'_tensorflow_wrap_toco\\'\\r\\n'\r\nNone\r\n\r\n\r\nProcess finished with exit code 1\r\n```\r\n"}