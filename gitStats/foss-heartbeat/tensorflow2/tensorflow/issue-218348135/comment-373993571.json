{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/373993571", "html_url": "https://github.com/tensorflow/tensorflow/issues/8854#issuecomment-373993571", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8854", "id": 373993571, "node_id": "MDEyOklzc3VlQ29tbWVudDM3Mzk5MzU3MQ==", "user": {"login": "Jon889", "id": 389853, "node_id": "MDQ6VXNlcjM4OTg1Mw==", "avatar_url": "https://avatars3.githubusercontent.com/u/389853?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jon889", "html_url": "https://github.com/Jon889", "followers_url": "https://api.github.com/users/Jon889/followers", "following_url": "https://api.github.com/users/Jon889/following{/other_user}", "gists_url": "https://api.github.com/users/Jon889/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jon889/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jon889/subscriptions", "organizations_url": "https://api.github.com/users/Jon889/orgs", "repos_url": "https://api.github.com/users/Jon889/repos", "events_url": "https://api.github.com/users/Jon889/events{/privacy}", "received_events_url": "https://api.github.com/users/Jon889/received_events", "type": "User", "site_admin": false}, "created_at": "2018-03-18T12:12:04Z", "updated_at": "2018-03-18T12:12:04Z", "author_association": "NONE", "body_html": "<p>I found I had to change  <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=21314536\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/brandondutra\">@brandondutra</a> script slightly to add a flush and close at the end.<br>\nElse on some models nothing would be written to the LOG_DIR.<br>\nAlso found that import_pb_to_tensorboard gave the same error as <code>google.protobuf.message.DecodeError: Error parsing message</code> so had to use this in the first place.</p>\n<pre><code>import tensorflow as tf\nimport sys\nfrom tensorflow.python.platform import gfile\n\nfrom tensorflow.core.protobuf import saved_model_pb2\nfrom tensorflow.python.util import compat\n\nwith tf.Session() as sess:\n\tmodel_filename =sys.argv[1]\n\twith gfile.FastGFile(model_filename, 'rb') as f:\n\n\t\tdata = compat.as_bytes(f.read())\n\t\tsm = saved_model_pb2.SavedModel()\n\t\tsm.ParseFromString(data)\n\t\t#print(sm)\n\t\tif 1 != len(sm.meta_graphs):\n\t\t\tprint('More than one graph found. Not sure which to write')\n\t\t\tsys.exit(1)\n\t\t\t\n\t\t#graph_def = tf.GraphDef()\n\t\t#graph_def.ParseFromString(sm.meta_graphs[0])\n\t\tg_in = tf.import_graph_def(sm.meta_graphs[0].graph_def)\n\tLOGDIR=sys.argv[2]\n\ntrain_writer = tf.summary.FileWriter(LOGDIR)\ntrain_writer.add_graph(sess.graph)\ntrain_writer.flush()\ntrain_writer.close()\n</code></pre>", "body_text": "I found I had to change  @brandondutra script slightly to add a flush and close at the end.\nElse on some models nothing would be written to the LOG_DIR.\nAlso found that import_pb_to_tensorboard gave the same error as google.protobuf.message.DecodeError: Error parsing message so had to use this in the first place.\nimport tensorflow as tf\nimport sys\nfrom tensorflow.python.platform import gfile\n\nfrom tensorflow.core.protobuf import saved_model_pb2\nfrom tensorflow.python.util import compat\n\nwith tf.Session() as sess:\n\tmodel_filename =sys.argv[1]\n\twith gfile.FastGFile(model_filename, 'rb') as f:\n\n\t\tdata = compat.as_bytes(f.read())\n\t\tsm = saved_model_pb2.SavedModel()\n\t\tsm.ParseFromString(data)\n\t\t#print(sm)\n\t\tif 1 != len(sm.meta_graphs):\n\t\t\tprint('More than one graph found. Not sure which to write')\n\t\t\tsys.exit(1)\n\t\t\t\n\t\t#graph_def = tf.GraphDef()\n\t\t#graph_def.ParseFromString(sm.meta_graphs[0])\n\t\tg_in = tf.import_graph_def(sm.meta_graphs[0].graph_def)\n\tLOGDIR=sys.argv[2]\n\ntrain_writer = tf.summary.FileWriter(LOGDIR)\ntrain_writer.add_graph(sess.graph)\ntrain_writer.flush()\ntrain_writer.close()", "body": "I found I had to change  @brandondutra script slightly to add a flush and close at the end.\r\nElse on some models nothing would be written to the LOG_DIR.\r\nAlso found that import_pb_to_tensorboard gave the same error as `google.protobuf.message.DecodeError: Error parsing message` so had to use this in the first place.\r\n\r\n```\r\nimport tensorflow as tf\r\nimport sys\r\nfrom tensorflow.python.platform import gfile\r\n\r\nfrom tensorflow.core.protobuf import saved_model_pb2\r\nfrom tensorflow.python.util import compat\r\n\r\nwith tf.Session() as sess:\r\n\tmodel_filename =sys.argv[1]\r\n\twith gfile.FastGFile(model_filename, 'rb') as f:\r\n\r\n\t\tdata = compat.as_bytes(f.read())\r\n\t\tsm = saved_model_pb2.SavedModel()\r\n\t\tsm.ParseFromString(data)\r\n\t\t#print(sm)\r\n\t\tif 1 != len(sm.meta_graphs):\r\n\t\t\tprint('More than one graph found. Not sure which to write')\r\n\t\t\tsys.exit(1)\r\n\t\t\t\r\n\t\t#graph_def = tf.GraphDef()\r\n\t\t#graph_def.ParseFromString(sm.meta_graphs[0])\r\n\t\tg_in = tf.import_graph_def(sm.meta_graphs[0].graph_def)\r\n\tLOGDIR=sys.argv[2]\r\n\r\ntrain_writer = tf.summary.FileWriter(LOGDIR)\r\ntrain_writer.add_graph(sess.graph)\r\ntrain_writer.flush()\r\ntrain_writer.close()\r\n```"}