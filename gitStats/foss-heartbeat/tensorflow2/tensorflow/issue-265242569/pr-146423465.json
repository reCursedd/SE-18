{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13684", "id": 146423465, "node_id": "MDExOlB1bGxSZXF1ZXN0MTQ2NDIzNDY1", "html_url": "https://github.com/tensorflow/tensorflow/pull/13684", "diff_url": "https://github.com/tensorflow/tensorflow/pull/13684.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/13684.patch", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13684", "number": 13684, "state": "closed", "locked": false, "title": "Fix deadlocks in Staging Areas.", "user": {"login": "sjperkins", "id": 3530212, "node_id": "MDQ6VXNlcjM1MzAyMTI=", "avatar_url": "https://avatars3.githubusercontent.com/u/3530212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sjperkins", "html_url": "https://github.com/sjperkins", "followers_url": "https://api.github.com/users/sjperkins/followers", "following_url": "https://api.github.com/users/sjperkins/following{/other_user}", "gists_url": "https://api.github.com/users/sjperkins/gists{/gist_id}", "starred_url": "https://api.github.com/users/sjperkins/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sjperkins/subscriptions", "organizations_url": "https://api.github.com/users/sjperkins/orgs", "repos_url": "https://api.github.com/users/sjperkins/repos", "events_url": "https://api.github.com/users/sjperkins/events{/privacy}", "received_events_url": "https://api.github.com/users/sjperkins/received_events", "type": "User", "site_admin": false}, "body": "Previously, `notify_one` was used to notify inserters and removers waiting to insert and remove elements into the Staging Areas. This could result in deadlock when  many removers where waiting for\r\ndifferent keys in the case of the MapStagingArea, or were waiting on either peeks or get operations in the StagingArea.\r\n\r\nFor example, if two removers were waiting for keys 2 and 3 in a MapStaging Area respectively, and 2 was inserted but only 3's remover was notified, it is possible that 2's remover would never be notified resulting in deadlock. Thus, both should be notified.\r\n\r\nSimilarly in the case of the StagingArea with a remover and a peeker wanting to remove the last element and peek at a specific element respectively, it is not clear which one should be notified due to\r\nan insert. Thus, both should be notified.\r\n\r\nAdditionally, all inserters are now notified when an element is removed. Consider the case where two inserters are waiting to small elements into the Staging Area and a remover removes a single large element. As there may be space for both insertion elements, both inserters should be notified.", "created_at": "2017-10-13T10:29:16Z", "updated_at": "2017-11-30T13:42:37Z", "closed_at": "2017-10-13T16:40:11Z", "merged_at": "2017-10-13T16:40:11Z", "merge_commit_sha": "3564997e080329af3ea1b4d88b442866a9593263", "assignee": null, "assignees": [], "requested_reviewers": [], "requested_teams": [], "labels": [{"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}], "milestone": null, "commits_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13684/commits", "review_comments_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13684/comments", "review_comment_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments{/number}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13684/comments", "statuses_url": "https://api.github.com/repos/tensorflow/tensorflow/statuses/d5e99136e47f1add4df3f577983ec7b02d20d4c3", "head": {"label": "sjperkins:fix-staging-area-race-deadlocks", "ref": "fix-staging-area-race-deadlocks", "sha": "d5e99136e47f1add4df3f577983ec7b02d20d4c3", "user": {"login": "sjperkins", "id": 3530212, "node_id": "MDQ6VXNlcjM1MzAyMTI=", "avatar_url": "https://avatars3.githubusercontent.com/u/3530212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sjperkins", "html_url": "https://github.com/sjperkins", "followers_url": "https://api.github.com/users/sjperkins/followers", "following_url": "https://api.github.com/users/sjperkins/following{/other_user}", "gists_url": "https://api.github.com/users/sjperkins/gists{/gist_id}", "starred_url": "https://api.github.com/users/sjperkins/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sjperkins/subscriptions", "organizations_url": "https://api.github.com/users/sjperkins/orgs", "repos_url": "https://api.github.com/users/sjperkins/repos", "events_url": "https://api.github.com/users/sjperkins/events{/privacy}", "received_events_url": "https://api.github.com/users/sjperkins/received_events", "type": "User", "site_admin": false}, "repo": {"id": 79132464, "node_id": "MDEwOlJlcG9zaXRvcnk3OTEzMjQ2NA==", "name": "tensorflow", "full_name": "sjperkins/tensorflow", "private": false, "owner": {"login": "sjperkins", "id": 3530212, "node_id": "MDQ6VXNlcjM1MzAyMTI=", "avatar_url": "https://avatars3.githubusercontent.com/u/3530212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sjperkins", "html_url": "https://github.com/sjperkins", "followers_url": "https://api.github.com/users/sjperkins/followers", "following_url": "https://api.github.com/users/sjperkins/following{/other_user}", "gists_url": "https://api.github.com/users/sjperkins/gists{/gist_id}", "starred_url": "https://api.github.com/users/sjperkins/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sjperkins/subscriptions", "organizations_url": "https://api.github.com/users/sjperkins/orgs", "repos_url": "https://api.github.com/users/sjperkins/repos", "events_url": "https://api.github.com/users/sjperkins/events{/privacy}", "received_events_url": "https://api.github.com/users/sjperkins/received_events", "type": "User", "site_admin": false}, "html_url": "https://github.com/sjperkins/tensorflow", "description": "Computation using data flow graphs for scalable machine learning", "fork": true, "url": "https://api.github.com/repos/sjperkins/tensorflow", "forks_url": "https://api.github.com/repos/sjperkins/tensorflow/forks", "keys_url": "https://api.github.com/repos/sjperkins/tensorflow/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/sjperkins/tensorflow/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/sjperkins/tensorflow/teams", "hooks_url": "https://api.github.com/repos/sjperkins/tensorflow/hooks", "issue_events_url": "https://api.github.com/repos/sjperkins/tensorflow/issues/events{/number}", "events_url": "https://api.github.com/repos/sjperkins/tensorflow/events", "assignees_url": "https://api.github.com/repos/sjperkins/tensorflow/assignees{/user}", "branches_url": "https://api.github.com/repos/sjperkins/tensorflow/branches{/branch}", "tags_url": "https://api.github.com/repos/sjperkins/tensorflow/tags", "blobs_url": "https://api.github.com/repos/sjperkins/tensorflow/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/sjperkins/tensorflow/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/sjperkins/tensorflow/git/refs{/sha}", "trees_url": "https://api.github.com/repos/sjperkins/tensorflow/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/sjperkins/tensorflow/statuses/{sha}", "languages_url": "https://api.github.com/repos/sjperkins/tensorflow/languages", "stargazers_url": "https://api.github.com/repos/sjperkins/tensorflow/stargazers", "contributors_url": "https://api.github.com/repos/sjperkins/tensorflow/contributors", "subscribers_url": "https://api.github.com/repos/sjperkins/tensorflow/subscribers", "subscription_url": "https://api.github.com/repos/sjperkins/tensorflow/subscription", "commits_url": "https://api.github.com/repos/sjperkins/tensorflow/commits{/sha}", "git_commits_url": "https://api.github.com/repos/sjperkins/tensorflow/git/commits{/sha}", "comments_url": "https://api.github.com/repos/sjperkins/tensorflow/comments{/number}", "issue_comment_url": "https://api.github.com/repos/sjperkins/tensorflow/issues/comments{/number}", "contents_url": "https://api.github.com/repos/sjperkins/tensorflow/contents/{+path}", "compare_url": "https://api.github.com/repos/sjperkins/tensorflow/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/sjperkins/tensorflow/merges", "archive_url": "https://api.github.com/repos/sjperkins/tensorflow/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/sjperkins/tensorflow/downloads", "issues_url": "https://api.github.com/repos/sjperkins/tensorflow/issues{/number}", "pulls_url": "https://api.github.com/repos/sjperkins/tensorflow/pulls{/number}", "milestones_url": "https://api.github.com/repos/sjperkins/tensorflow/milestones{/number}", "notifications_url": "https://api.github.com/repos/sjperkins/tensorflow/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/sjperkins/tensorflow/labels{/name}", "releases_url": "https://api.github.com/repos/sjperkins/tensorflow/releases{/id}", "deployments_url": "https://api.github.com/repos/sjperkins/tensorflow/deployments", "created_at": "2017-01-16T15:37:11Z", "updated_at": "2017-01-16T15:37:33Z", "pushed_at": "2017-11-30T13:42:37Z", "git_url": "git://github.com/sjperkins/tensorflow.git", "ssh_url": "git@github.com:sjperkins/tensorflow.git", "clone_url": "https://github.com/sjperkins/tensorflow.git", "svn_url": "https://github.com/sjperkins/tensorflow", "homepage": "http://tensorflow.org", "size": 109060, "stargazers_count": 0, "watchers_count": 0, "language": "C++", "has_issues": false, "has_projects": true, "has_downloads": true, "has_wiki": false, "has_pages": false, "forks_count": 0, "mirror_url": null, "archived": false, "open_issues_count": 0, "license": {"key": "apache-2.0", "name": "Apache License 2.0", "spdx_id": "Apache-2.0", "url": "https://api.github.com/licenses/apache-2.0", "node_id": "MDc6TGljZW5zZTI="}, "forks": 0, "open_issues": 0, "watchers": 0, "default_branch": "master"}}, "base": {"label": "tensorflow:master", "ref": "master", "sha": "c1832374a6a311837f2738e08a9bff8480c8ede4", "user": {"login": "tensorflow", "id": 15658638, "node_id": "MDEyOk9yZ2FuaXphdGlvbjE1NjU4NjM4", "avatar_url": "https://avatars1.githubusercontent.com/u/15658638?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tensorflow", "html_url": "https://github.com/tensorflow", "followers_url": "https://api.github.com/users/tensorflow/followers", "following_url": "https://api.github.com/users/tensorflow/following{/other_user}", "gists_url": "https://api.github.com/users/tensorflow/gists{/gist_id}", "starred_url": "https://api.github.com/users/tensorflow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tensorflow/subscriptions", "organizations_url": "https://api.github.com/users/tensorflow/orgs", "repos_url": "https://api.github.com/users/tensorflow/repos", "events_url": "https://api.github.com/users/tensorflow/events{/privacy}", "received_events_url": "https://api.github.com/users/tensorflow/received_events", "type": "Organization", "site_admin": false}, "repo": {"id": 45717250, "node_id": "MDEwOlJlcG9zaXRvcnk0NTcxNzI1MA==", "name": "tensorflow", "full_name": "tensorflow/tensorflow", "private": false, "owner": {"login": "tensorflow", "id": 15658638, "node_id": "MDEyOk9yZ2FuaXphdGlvbjE1NjU4NjM4", "avatar_url": "https://avatars1.githubusercontent.com/u/15658638?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tensorflow", "html_url": "https://github.com/tensorflow", "followers_url": "https://api.github.com/users/tensorflow/followers", "following_url": "https://api.github.com/users/tensorflow/following{/other_user}", "gists_url": "https://api.github.com/users/tensorflow/gists{/gist_id}", "starred_url": "https://api.github.com/users/tensorflow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tensorflow/subscriptions", "organizations_url": "https://api.github.com/users/tensorflow/orgs", "repos_url": "https://api.github.com/users/tensorflow/repos", "events_url": "https://api.github.com/users/tensorflow/events{/privacy}", "received_events_url": "https://api.github.com/users/tensorflow/received_events", "type": "Organization", "site_admin": false}, "html_url": "https://github.com/tensorflow/tensorflow", "description": "An Open Source Machine Learning Framework for Everyone", "fork": false, "url": "https://api.github.com/repos/tensorflow/tensorflow", "forks_url": "https://api.github.com/repos/tensorflow/tensorflow/forks", "keys_url": "https://api.github.com/repos/tensorflow/tensorflow/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/tensorflow/tensorflow/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/tensorflow/tensorflow/teams", "hooks_url": "https://api.github.com/repos/tensorflow/tensorflow/hooks", "issue_events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/events{/number}", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/events", "assignees_url": "https://api.github.com/repos/tensorflow/tensorflow/assignees{/user}", "branches_url": "https://api.github.com/repos/tensorflow/tensorflow/branches{/branch}", "tags_url": "https://api.github.com/repos/tensorflow/tensorflow/tags", "blobs_url": "https://api.github.com/repos/tensorflow/tensorflow/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/tensorflow/tensorflow/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/tensorflow/tensorflow/git/refs{/sha}", "trees_url": "https://api.github.com/repos/tensorflow/tensorflow/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/tensorflow/tensorflow/statuses/{sha}", "languages_url": "https://api.github.com/repos/tensorflow/tensorflow/languages", "stargazers_url": "https://api.github.com/repos/tensorflow/tensorflow/stargazers", "contributors_url": "https://api.github.com/repos/tensorflow/tensorflow/contributors", "subscribers_url": "https://api.github.com/repos/tensorflow/tensorflow/subscribers", "subscription_url": "https://api.github.com/repos/tensorflow/tensorflow/subscription", "commits_url": "https://api.github.com/repos/tensorflow/tensorflow/commits{/sha}", "git_commits_url": "https://api.github.com/repos/tensorflow/tensorflow/git/commits{/sha}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/comments{/number}", "issue_comment_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments{/number}", "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/{+path}", "compare_url": "https://api.github.com/repos/tensorflow/tensorflow/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/tensorflow/tensorflow/merges", "archive_url": "https://api.github.com/repos/tensorflow/tensorflow/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/tensorflow/tensorflow/downloads", "issues_url": "https://api.github.com/repos/tensorflow/tensorflow/issues{/number}", "pulls_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls{/number}", "milestones_url": "https://api.github.com/repos/tensorflow/tensorflow/milestones{/number}", "notifications_url": "https://api.github.com/repos/tensorflow/tensorflow/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/labels{/name}", "releases_url": "https://api.github.com/repos/tensorflow/tensorflow/releases{/id}", "deployments_url": "https://api.github.com/repos/tensorflow/tensorflow/deployments", "created_at": "2015-11-07T01:19:20Z", "updated_at": "2018-11-24T22:13:04Z", "pushed_at": "2018-11-24T18:40:19Z", "git_url": "git://github.com/tensorflow/tensorflow.git", "ssh_url": "git@github.com:tensorflow/tensorflow.git", "clone_url": "https://github.com/tensorflow/tensorflow.git", "svn_url": "https://github.com/tensorflow/tensorflow", "homepage": "https://tensorflow.org", "size": 284546, "stargazers_count": 115176, "watchers_count": 115176, "language": "C++", "has_issues": true, "has_projects": true, "has_downloads": true, "has_wiki": false, "has_pages": false, "forks_count": 69946, "mirror_url": null, "archived": false, "open_issues_count": 1760, "license": {"key": "apache-2.0", "name": "Apache License 2.0", "spdx_id": "Apache-2.0", "url": "https://api.github.com/licenses/apache-2.0", "node_id": "MDc6TGljZW5zZTI="}, "forks": 69946, "open_issues": 1760, "watchers": 115176, "default_branch": "master"}}, "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13684"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/13684"}, "issue": {"href": "https://api.github.com/repos/tensorflow/tensorflow/issues/13684"}, "comments": {"href": "https://api.github.com/repos/tensorflow/tensorflow/issues/13684/comments"}, "review_comments": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13684/comments"}, "review_comment": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments{/number}"}, "commits": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13684/commits"}, "statuses": {"href": "https://api.github.com/repos/tensorflow/tensorflow/statuses/d5e99136e47f1add4df3f577983ec7b02d20d4c3"}}, "author_association": "CONTRIBUTOR", "body_html": "<p>Previously, <code>notify_one</code> was used to notify inserters and removers waiting to insert and remove elements into the Staging Areas. This could result in deadlock when  many removers where waiting for<br>\ndifferent keys in the case of the MapStagingArea, or were waiting on either peeks or get operations in the StagingArea.</p>\n<p>For example, if two removers were waiting for keys 2 and 3 in a MapStaging Area respectively, and 2 was inserted but only 3's remover was notified, it is possible that 2's remover would never be notified resulting in deadlock. Thus, both should be notified.</p>\n<p>Similarly in the case of the StagingArea with a remover and a peeker wanting to remove the last element and peek at a specific element respectively, it is not clear which one should be notified due to<br>\nan insert. Thus, both should be notified.</p>\n<p>Additionally, all inserters are now notified when an element is removed. Consider the case where two inserters are waiting to small elements into the Staging Area and a remover removes a single large element. As there may be space for both insertion elements, both inserters should be notified.</p>", "body_text": "Previously, notify_one was used to notify inserters and removers waiting to insert and remove elements into the Staging Areas. This could result in deadlock when  many removers where waiting for\ndifferent keys in the case of the MapStagingArea, or were waiting on either peeks or get operations in the StagingArea.\nFor example, if two removers were waiting for keys 2 and 3 in a MapStaging Area respectively, and 2 was inserted but only 3's remover was notified, it is possible that 2's remover would never be notified resulting in deadlock. Thus, both should be notified.\nSimilarly in the case of the StagingArea with a remover and a peeker wanting to remove the last element and peek at a specific element respectively, it is not clear which one should be notified due to\nan insert. Thus, both should be notified.\nAdditionally, all inserters are now notified when an element is removed. Consider the case where two inserters are waiting to small elements into the Staging Area and a remover removes a single large element. As there may be space for both insertion elements, both inserters should be notified.", "merged": true, "mergeable": null, "rebaseable": null, "mergeable_state": "unknown", "merged_by": {"login": "caisq", "id": 16824702, "node_id": "MDQ6VXNlcjE2ODI0NzAy", "avatar_url": "https://avatars2.githubusercontent.com/u/16824702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/caisq", "html_url": "https://github.com/caisq", "followers_url": "https://api.github.com/users/caisq/followers", "following_url": "https://api.github.com/users/caisq/following{/other_user}", "gists_url": "https://api.github.com/users/caisq/gists{/gist_id}", "starred_url": "https://api.github.com/users/caisq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/caisq/subscriptions", "organizations_url": "https://api.github.com/users/caisq/orgs", "repos_url": "https://api.github.com/users/caisq/repos", "events_url": "https://api.github.com/users/caisq/events{/privacy}", "received_events_url": "https://api.github.com/users/caisq/received_events", "type": "User", "site_admin": false}, "comments": 5, "review_comments": 0, "maintainer_can_modify": false, "commits": 1, "additions": 19, "deletions": 7, "changed_files": 2}