{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9044", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9044/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9044/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9044/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/9044", "id": 220220930, "node_id": "MDU6SXNzdWUyMjAyMjA5MzA=", "number": 9044, "title": "hang in google/protobuf/pyext/_message.so at exit", "user": {"login": "albertz", "id": 59132, "node_id": "MDQ6VXNlcjU5MTMy", "avatar_url": "https://avatars0.githubusercontent.com/u/59132?v=4", "gravatar_id": "", "url": "https://api.github.com/users/albertz", "html_url": "https://github.com/albertz", "followers_url": "https://api.github.com/users/albertz/followers", "following_url": "https://api.github.com/users/albertz/following{/other_user}", "gists_url": "https://api.github.com/users/albertz/gists{/gist_id}", "starred_url": "https://api.github.com/users/albertz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/albertz/subscriptions", "organizations_url": "https://api.github.com/users/albertz/orgs", "repos_url": "https://api.github.com/users/albertz/repos", "events_url": "https://api.github.com/users/albertz/events{/privacy}", "received_events_url": "https://api.github.com/users/albertz/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-04-07T13:54:42Z", "updated_at": "2017-04-07T20:38:41Z", "closed_at": "2017-04-07T17:30:23Z", "author_association": "NONE", "body_html": "<p>This is TensorFlow 1.0.1 installed via pip.<br>\nIt runs via an embedded CPython (libpython).</p>\n<p>Sometimes (maybe 30% of my runs) it hangs in <code>Py_Finalize()</code>, and I see this backtrace:</p>\n<pre><code>/work/asr2/zeyer/sprint-executables/20160902.235443.fad8965.linux-x86_64-standard/Flf/flf-tool.linux-intel-standard(_ZN17AssertionsPrivate15safe_stackTraceEi+0x21)[0xc5b891]\n/work/asr2/zeyer/sprint-executables/20160902.235443.fad8965.linux-x86_64-standard/Flf/flf-tool.linux-intel-standard[0xc5b8ef]\n/u/zeyer/tools/glibc217/libpthread.so.0(+0x113d0)[0x2b6d89bad3d0]\n/u/zeyer/tools/glibc217/libpthread.so.0(raise+0x29)[0x2b6d89bad2a9]\n/u/zeyer/py-envs/py2-ubuntu16/local/lib/python2.7/site-packages/faulthandler.so(+0x3198)[0x2b6dc2372198]\n/u/zeyer/tools/glibc217/libpthread.so.0(+0x113d0)[0x2b6d89bad3d0]\n/u/zeyer/py-envs/py2-ubuntu16/local/lib/python2.7/site-packages/google/protobuf/pyext/_message.so(+0xaa943)[0x2b6dc14f0943]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(+0x160f6b)[0x2b6d8b23af6b]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(+0xc8f0e)[0x2b6d8b1a2f0e]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(+0x15d747)[0x2b6d8b237747]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyDict_SetItem+0x7b)[0x2b6d8b23becb]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(_PyModule_Clear+0xb5)[0x2b6d8b278565]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyImport_Cleanup+0x437)[0x2b6d8b2280e7]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(Py_Finalize+0xfe)[0x2b6d8b1fed9e]\n/work/asr2/zeyer/sprint-executables/20160902.235443.fad8965.linux-x86_64-standard/Flf/flf-tool.linux-intel-standard(_ZN6Python11Initializer19AtExitUninitHandlerEv+0x2e)[0xff80de]\n/u/zeyer/tools/glibc217/libc.so.6(+0x39fe8)[0x2b6d8bc39fe8]\n/u/zeyer/tools/glibc217/libc.so.6(+0x3a035)[0x2b6d8bc3a035]\n/u/zeyer/tools/glibc217/libc.so.6(__libc_start_main+0xf7)[0x2b6d8bc20837]\n/work/asr2/zeyer/sprint-executables/20160902.235443.fad8965.linux-x86_64-standard/Flf/flf-tool.linux-intel-standard[0x7d6991]\n</code></pre>\n<p>or with GDB:</p>\n<pre><code>(gdb) bt full\n#0  0x00002b6dc14f0943 in std::tr1::_Hashtable&lt;google::protobuf::DescriptorPool const*, std::pair&lt;google::protobuf::DescriptorPool const* const, google::protobuf::python::PyDescriptorPool*&gt;, std::allocator&lt;std::pair&lt;google::protobuf::DescriptorPool const* const, google::protobuf::python::PyDescriptorPool*&gt; &gt;, std::_Select1st&lt;std::pair&lt;google::protobuf::DescriptorPool const* const, google::protobuf::python::PyDescriptorPool*&gt; &gt;, std::equal_to&lt;google::protobuf::DescriptorPool const*&gt;, google::protobuf::hash&lt;google::protobuf::DescriptorPool const*&gt;, std::tr1::__detail::_Mod_range_hashing, std::tr1::__detail::_Default_ranged_hash, std::tr1::__detail::_Prime_rehash_policy, false, false, true&gt;::erase (\n    __k=@0x7ffd1bbea740: 0x8269780, this=0x2b6dc1826e40 &lt;google::protobuf::python::descriptor_pool_map&gt;)\n    at /opt/rh/devtoolset-2/root/usr/include/c++/4.8.2/tr1/hashtable.h:1041\n        __slot = &lt;optimized out&gt;\n        __saved_slot = &lt;optimized out&gt;\n        __code = 136746880\n        __n = 0\n        __result = 0\n#1  google::protobuf::python::cdescriptor_pool::Dealloc (self=0x2b6dc0d86880)\n    at google/protobuf/pyext/descriptor_pool.cc:152\nNo locals.\n#2  0x00002b6d8b23af6b in ?? () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\nNo symbol table info available.\n#3  0x00002b6d8b1a2f0e in ?? () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\nNo symbol table info available.\n#4  0x00002b6d8b237747 in ?? () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\nNo symbol table info available.\n#5  0x00002b6d8b23becb in PyDict_SetItem () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\nNo symbol table info available.\n#6  0x00002b6d8b278565 in _PyModule_Clear () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\nNo symbol table info available.\n#7  0x00002b6d8b2280e7 in PyImport_Cleanup () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\nNo symbol table info available.\n#8  0x00002b6d8b1fed9e in Py_Finalize () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\nNo symbol table info available.\n#9  0x0000000000ff80de in Python::Initializer::AtExitUninitHandler() ()\nNo symbol table info available.\n#10 0x00002b6d8bc39fe8 in ?? () from /u/zeyer/tools/glibc217/libc.so.6\nNo symbol table info available.\n#11 0x00002b6d8bc3a035 in exit () from /u/zeyer/tools/glibc217/libc.so.6\nNo symbol table info available.\n#12 0x00002b6d8bc20837 in __libc_start_main () from /u/zeyer/tools/glibc217/libc.so.6\nNo symbol table info available.\n#13 0x00000000007d6991 in _start ()\nNo symbol table info available.\n</code></pre>\n<p>I.e. it happens in <code>_PyModule_Clear</code>, and then inside <code>google/protobuf/pyext/_message.so</code>, that's why I think this is TF related.</p>\n<p>In the case when it does not hang, I see this output:</p>\n<pre><code>Exception AttributeError: AttributeError(\"'NoneType' object has no attribute 'raise_exception_on_not_ok_status'\",) in &lt;bound method Session.__del__ of &lt;tensorflow.python.client.session.Session object at 0x2afd625b12d0&gt;&gt; ignored\n</code></pre>", "body_text": "This is TensorFlow 1.0.1 installed via pip.\nIt runs via an embedded CPython (libpython).\nSometimes (maybe 30% of my runs) it hangs in Py_Finalize(), and I see this backtrace:\n/work/asr2/zeyer/sprint-executables/20160902.235443.fad8965.linux-x86_64-standard/Flf/flf-tool.linux-intel-standard(_ZN17AssertionsPrivate15safe_stackTraceEi+0x21)[0xc5b891]\n/work/asr2/zeyer/sprint-executables/20160902.235443.fad8965.linux-x86_64-standard/Flf/flf-tool.linux-intel-standard[0xc5b8ef]\n/u/zeyer/tools/glibc217/libpthread.so.0(+0x113d0)[0x2b6d89bad3d0]\n/u/zeyer/tools/glibc217/libpthread.so.0(raise+0x29)[0x2b6d89bad2a9]\n/u/zeyer/py-envs/py2-ubuntu16/local/lib/python2.7/site-packages/faulthandler.so(+0x3198)[0x2b6dc2372198]\n/u/zeyer/tools/glibc217/libpthread.so.0(+0x113d0)[0x2b6d89bad3d0]\n/u/zeyer/py-envs/py2-ubuntu16/local/lib/python2.7/site-packages/google/protobuf/pyext/_message.so(+0xaa943)[0x2b6dc14f0943]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(+0x160f6b)[0x2b6d8b23af6b]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(+0xc8f0e)[0x2b6d8b1a2f0e]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(+0x15d747)[0x2b6d8b237747]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyDict_SetItem+0x7b)[0x2b6d8b23becb]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(_PyModule_Clear+0xb5)[0x2b6d8b278565]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyImport_Cleanup+0x437)[0x2b6d8b2280e7]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(Py_Finalize+0xfe)[0x2b6d8b1fed9e]\n/work/asr2/zeyer/sprint-executables/20160902.235443.fad8965.linux-x86_64-standard/Flf/flf-tool.linux-intel-standard(_ZN6Python11Initializer19AtExitUninitHandlerEv+0x2e)[0xff80de]\n/u/zeyer/tools/glibc217/libc.so.6(+0x39fe8)[0x2b6d8bc39fe8]\n/u/zeyer/tools/glibc217/libc.so.6(+0x3a035)[0x2b6d8bc3a035]\n/u/zeyer/tools/glibc217/libc.so.6(__libc_start_main+0xf7)[0x2b6d8bc20837]\n/work/asr2/zeyer/sprint-executables/20160902.235443.fad8965.linux-x86_64-standard/Flf/flf-tool.linux-intel-standard[0x7d6991]\n\nor with GDB:\n(gdb) bt full\n#0  0x00002b6dc14f0943 in std::tr1::_Hashtable<google::protobuf::DescriptorPool const*, std::pair<google::protobuf::DescriptorPool const* const, google::protobuf::python::PyDescriptorPool*>, std::allocator<std::pair<google::protobuf::DescriptorPool const* const, google::protobuf::python::PyDescriptorPool*> >, std::_Select1st<std::pair<google::protobuf::DescriptorPool const* const, google::protobuf::python::PyDescriptorPool*> >, std::equal_to<google::protobuf::DescriptorPool const*>, google::protobuf::hash<google::protobuf::DescriptorPool const*>, std::tr1::__detail::_Mod_range_hashing, std::tr1::__detail::_Default_ranged_hash, std::tr1::__detail::_Prime_rehash_policy, false, false, true>::erase (\n    __k=@0x7ffd1bbea740: 0x8269780, this=0x2b6dc1826e40 <google::protobuf::python::descriptor_pool_map>)\n    at /opt/rh/devtoolset-2/root/usr/include/c++/4.8.2/tr1/hashtable.h:1041\n        __slot = <optimized out>\n        __saved_slot = <optimized out>\n        __code = 136746880\n        __n = 0\n        __result = 0\n#1  google::protobuf::python::cdescriptor_pool::Dealloc (self=0x2b6dc0d86880)\n    at google/protobuf/pyext/descriptor_pool.cc:152\nNo locals.\n#2  0x00002b6d8b23af6b in ?? () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\nNo symbol table info available.\n#3  0x00002b6d8b1a2f0e in ?? () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\nNo symbol table info available.\n#4  0x00002b6d8b237747 in ?? () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\nNo symbol table info available.\n#5  0x00002b6d8b23becb in PyDict_SetItem () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\nNo symbol table info available.\n#6  0x00002b6d8b278565 in _PyModule_Clear () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\nNo symbol table info available.\n#7  0x00002b6d8b2280e7 in PyImport_Cleanup () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\nNo symbol table info available.\n#8  0x00002b6d8b1fed9e in Py_Finalize () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\nNo symbol table info available.\n#9  0x0000000000ff80de in Python::Initializer::AtExitUninitHandler() ()\nNo symbol table info available.\n#10 0x00002b6d8bc39fe8 in ?? () from /u/zeyer/tools/glibc217/libc.so.6\nNo symbol table info available.\n#11 0x00002b6d8bc3a035 in exit () from /u/zeyer/tools/glibc217/libc.so.6\nNo symbol table info available.\n#12 0x00002b6d8bc20837 in __libc_start_main () from /u/zeyer/tools/glibc217/libc.so.6\nNo symbol table info available.\n#13 0x00000000007d6991 in _start ()\nNo symbol table info available.\n\nI.e. it happens in _PyModule_Clear, and then inside google/protobuf/pyext/_message.so, that's why I think this is TF related.\nIn the case when it does not hang, I see this output:\nException AttributeError: AttributeError(\"'NoneType' object has no attribute 'raise_exception_on_not_ok_status'\",) in <bound method Session.__del__ of <tensorflow.python.client.session.Session object at 0x2afd625b12d0>> ignored", "body": "This is TensorFlow 1.0.1 installed via pip.\r\nIt runs via an embedded CPython (libpython).\r\n\r\nSometimes (maybe 30% of my runs) it hangs in `Py_Finalize()`, and I see this backtrace:\r\n\r\n```\r\n/work/asr2/zeyer/sprint-executables/20160902.235443.fad8965.linux-x86_64-standard/Flf/flf-tool.linux-intel-standard(_ZN17AssertionsPrivate15safe_stackTraceEi+0x21)[0xc5b891]\r\n/work/asr2/zeyer/sprint-executables/20160902.235443.fad8965.linux-x86_64-standard/Flf/flf-tool.linux-intel-standard[0xc5b8ef]\r\n/u/zeyer/tools/glibc217/libpthread.so.0(+0x113d0)[0x2b6d89bad3d0]\r\n/u/zeyer/tools/glibc217/libpthread.so.0(raise+0x29)[0x2b6d89bad2a9]\r\n/u/zeyer/py-envs/py2-ubuntu16/local/lib/python2.7/site-packages/faulthandler.so(+0x3198)[0x2b6dc2372198]\r\n/u/zeyer/tools/glibc217/libpthread.so.0(+0x113d0)[0x2b6d89bad3d0]\r\n/u/zeyer/py-envs/py2-ubuntu16/local/lib/python2.7/site-packages/google/protobuf/pyext/_message.so(+0xaa943)[0x2b6dc14f0943]\r\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(+0x160f6b)[0x2b6d8b23af6b]\r\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(+0xc8f0e)[0x2b6d8b1a2f0e]\r\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(+0x15d747)[0x2b6d8b237747]\r\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyDict_SetItem+0x7b)[0x2b6d8b23becb]\r\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(_PyModule_Clear+0xb5)[0x2b6d8b278565]\r\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyImport_Cleanup+0x437)[0x2b6d8b2280e7]\r\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(Py_Finalize+0xfe)[0x2b6d8b1fed9e]\r\n/work/asr2/zeyer/sprint-executables/20160902.235443.fad8965.linux-x86_64-standard/Flf/flf-tool.linux-intel-standard(_ZN6Python11Initializer19AtExitUninitHandlerEv+0x2e)[0xff80de]\r\n/u/zeyer/tools/glibc217/libc.so.6(+0x39fe8)[0x2b6d8bc39fe8]\r\n/u/zeyer/tools/glibc217/libc.so.6(+0x3a035)[0x2b6d8bc3a035]\r\n/u/zeyer/tools/glibc217/libc.so.6(__libc_start_main+0xf7)[0x2b6d8bc20837]\r\n/work/asr2/zeyer/sprint-executables/20160902.235443.fad8965.linux-x86_64-standard/Flf/flf-tool.linux-intel-standard[0x7d6991]\r\n```\r\nor with GDB:\r\n```\r\n(gdb) bt full\r\n#0  0x00002b6dc14f0943 in std::tr1::_Hashtable<google::protobuf::DescriptorPool const*, std::pair<google::protobuf::DescriptorPool const* const, google::protobuf::python::PyDescriptorPool*>, std::allocator<std::pair<google::protobuf::DescriptorPool const* const, google::protobuf::python::PyDescriptorPool*> >, std::_Select1st<std::pair<google::protobuf::DescriptorPool const* const, google::protobuf::python::PyDescriptorPool*> >, std::equal_to<google::protobuf::DescriptorPool const*>, google::protobuf::hash<google::protobuf::DescriptorPool const*>, std::tr1::__detail::_Mod_range_hashing, std::tr1::__detail::_Default_ranged_hash, std::tr1::__detail::_Prime_rehash_policy, false, false, true>::erase (\r\n    __k=@0x7ffd1bbea740: 0x8269780, this=0x2b6dc1826e40 <google::protobuf::python::descriptor_pool_map>)\r\n    at /opt/rh/devtoolset-2/root/usr/include/c++/4.8.2/tr1/hashtable.h:1041\r\n        __slot = <optimized out>\r\n        __saved_slot = <optimized out>\r\n        __code = 136746880\r\n        __n = 0\r\n        __result = 0\r\n#1  google::protobuf::python::cdescriptor_pool::Dealloc (self=0x2b6dc0d86880)\r\n    at google/protobuf/pyext/descriptor_pool.cc:152\r\nNo locals.\r\n#2  0x00002b6d8b23af6b in ?? () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\r\nNo symbol table info available.\r\n#3  0x00002b6d8b1a2f0e in ?? () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\r\nNo symbol table info available.\r\n#4  0x00002b6d8b237747 in ?? () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\r\nNo symbol table info available.\r\n#5  0x00002b6d8b23becb in PyDict_SetItem () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\r\nNo symbol table info available.\r\n#6  0x00002b6d8b278565 in _PyModule_Clear () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\r\nNo symbol table info available.\r\n#7  0x00002b6d8b2280e7 in PyImport_Cleanup () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\r\nNo symbol table info available.\r\n#8  0x00002b6d8b1fed9e in Py_Finalize () from /usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0\r\nNo symbol table info available.\r\n#9  0x0000000000ff80de in Python::Initializer::AtExitUninitHandler() ()\r\nNo symbol table info available.\r\n#10 0x00002b6d8bc39fe8 in ?? () from /u/zeyer/tools/glibc217/libc.so.6\r\nNo symbol table info available.\r\n#11 0x00002b6d8bc3a035 in exit () from /u/zeyer/tools/glibc217/libc.so.6\r\nNo symbol table info available.\r\n#12 0x00002b6d8bc20837 in __libc_start_main () from /u/zeyer/tools/glibc217/libc.so.6\r\nNo symbol table info available.\r\n#13 0x00000000007d6991 in _start ()\r\nNo symbol table info available.\r\n```\r\n\r\nI.e. it happens in `_PyModule_Clear`, and then inside `google/protobuf/pyext/_message.so`, that's why I think this is TF related.\r\n\r\nIn the case when it does not hang, I see this output:\r\n\r\n```\r\nException AttributeError: AttributeError(\"'NoneType' object has no attribute 'raise_exception_on_not_ok_status'\",) in <bound method Session.__del__ of <tensorflow.python.client.session.Session object at 0x2afd625b12d0>> ignored\r\n```\r\n\r\n"}