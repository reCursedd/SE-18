{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1522", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1522/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1522/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1522/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/1522", "id": 141182501, "node_id": "MDU6SXNzdWUxNDExODI1MDE=", "number": 1522, "title": "closing file object in read_data() function for word2vec tutorials", "user": {"login": "ronrest", "id": 10935663, "node_id": "MDQ6VXNlcjEwOTM1NjYz", "avatar_url": "https://avatars3.githubusercontent.com/u/10935663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronrest", "html_url": "https://github.com/ronrest", "followers_url": "https://api.github.com/users/ronrest/followers", "following_url": "https://api.github.com/users/ronrest/following{/other_user}", "gists_url": "https://api.github.com/users/ronrest/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronrest/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronrest/subscriptions", "organizations_url": "https://api.github.com/users/ronrest/orgs", "repos_url": "https://api.github.com/users/ronrest/repos", "events_url": "https://api.github.com/users/ronrest/events{/privacy}", "received_events_url": "https://api.github.com/users/ronrest/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2016-03-16T06:08:21Z", "updated_at": "2016-03-18T06:10:39Z", "closed_at": "2016-03-18T06:10:39Z", "author_association": "CONTRIBUTOR", "body_html": "<p>The <code>read_data()</code> function that appears in the following files:</p>\n<ul>\n<li>tensorflow/tensorflow/examples/tutorials/word2vec/word2vec_basic.py</li>\n<li>tensorflow/tensorflow/examples/udacity/5_word2vec.ipynb</li>\n</ul>\n<p>Look like this:</p>\n<pre><code>def read_data(filename):\n  f = zipfile.ZipFile(filename)\n  for name in f.namelist():\n    return f.read(name).split()\n  f.close()\n</code></pre>\n<pre><code>def read_data(filename):\n  f = zipfile.ZipFile(filename)\n  for name in f.namelist():\n    return tf.compat.as_str(f.read(name)).split()\n  f.close()\n</code></pre>\n<p>There are two problems that these two versions of the function share:</p>\n<ol>\n<li>The for loop is redundant since the <code>return</code> statement exits the loop (and the function) with the first file in the loop. Also, there is only one file within the zip file anyway.</li>\n<li>Since the return statement exits the function early, it never executes the <code>f.close()</code> line. Therefore it doesn't get to close the file object properly.</li>\n</ol>\n<p>I propose something like this instead:</p>\n<pre><code>def read_data(filename):\n  \"\"\"Extract the first file enclosed in a zip file as a list of words\"\"\"\n  with zipfile.ZipFile(filename) as f:\n    data = f.read(f.namelist()[0]).split()\n  return data\n</code></pre>\n<pre><code>def read_data(filename):\n  \"\"\"Extract the first file enclosed in a zip file as a list of words\"\"\"\n  with zipfile.ZipFile(filename) as f:\n    data = tf.compat.as_str(f.read(f.namelist()[0])).split()\n  return data\n</code></pre>\n<p>I will submit a pull request with the proposed changes.</p>", "body_text": "The read_data() function that appears in the following files:\n\ntensorflow/tensorflow/examples/tutorials/word2vec/word2vec_basic.py\ntensorflow/tensorflow/examples/udacity/5_word2vec.ipynb\n\nLook like this:\ndef read_data(filename):\n  f = zipfile.ZipFile(filename)\n  for name in f.namelist():\n    return f.read(name).split()\n  f.close()\n\ndef read_data(filename):\n  f = zipfile.ZipFile(filename)\n  for name in f.namelist():\n    return tf.compat.as_str(f.read(name)).split()\n  f.close()\n\nThere are two problems that these two versions of the function share:\n\nThe for loop is redundant since the return statement exits the loop (and the function) with the first file in the loop. Also, there is only one file within the zip file anyway.\nSince the return statement exits the function early, it never executes the f.close() line. Therefore it doesn't get to close the file object properly.\n\nI propose something like this instead:\ndef read_data(filename):\n  \"\"\"Extract the first file enclosed in a zip file as a list of words\"\"\"\n  with zipfile.ZipFile(filename) as f:\n    data = f.read(f.namelist()[0]).split()\n  return data\n\ndef read_data(filename):\n  \"\"\"Extract the first file enclosed in a zip file as a list of words\"\"\"\n  with zipfile.ZipFile(filename) as f:\n    data = tf.compat.as_str(f.read(f.namelist()[0])).split()\n  return data\n\nI will submit a pull request with the proposed changes.", "body": "The `read_data()` function that appears in the following files:\n- tensorflow/tensorflow/examples/tutorials/word2vec/word2vec_basic.py\n- tensorflow/tensorflow/examples/udacity/5_word2vec.ipynb\n\nLook like this: \n\n```\ndef read_data(filename):\n  f = zipfile.ZipFile(filename)\n  for name in f.namelist():\n    return f.read(name).split()\n  f.close()\n```\n\n```\ndef read_data(filename):\n  f = zipfile.ZipFile(filename)\n  for name in f.namelist():\n    return tf.compat.as_str(f.read(name)).split()\n  f.close()\n```\n\nThere are two problems that these two versions of the function share: \n1. The for loop is redundant since the `return` statement exits the loop (and the function) with the first file in the loop. Also, there is only one file within the zip file anyway. \n2. Since the return statement exits the function early, it never executes the `f.close()` line. Therefore it doesn't get to close the file object properly. \n\nI propose something like this instead: \n\n```\ndef read_data(filename):\n  \"\"\"Extract the first file enclosed in a zip file as a list of words\"\"\"\n  with zipfile.ZipFile(filename) as f:\n    data = f.read(f.namelist()[0]).split()\n  return data\n```\n\n```\ndef read_data(filename):\n  \"\"\"Extract the first file enclosed in a zip file as a list of words\"\"\"\n  with zipfile.ZipFile(filename) as f:\n    data = tf.compat.as_str(f.read(f.namelist()[0])).split()\n  return data\n```\n\nI will submit a pull request with the proposed changes. \n"}