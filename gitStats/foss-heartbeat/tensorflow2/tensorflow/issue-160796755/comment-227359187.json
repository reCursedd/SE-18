{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/227359187", "html_url": "https://github.com/tensorflow/tensorflow/issues/2921#issuecomment-227359187", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2921", "id": 227359187, "node_id": "MDEyOklzc3VlQ29tbWVudDIyNzM1OTE4Nw==", "user": {"login": "jyshee", "id": 18115420, "node_id": "MDQ6VXNlcjE4MTE1NDIw", "avatar_url": "https://avatars3.githubusercontent.com/u/18115420?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyshee", "html_url": "https://github.com/jyshee", "followers_url": "https://api.github.com/users/jyshee/followers", "following_url": "https://api.github.com/users/jyshee/following{/other_user}", "gists_url": "https://api.github.com/users/jyshee/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyshee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyshee/subscriptions", "organizations_url": "https://api.github.com/users/jyshee/orgs", "repos_url": "https://api.github.com/users/jyshee/repos", "events_url": "https://api.github.com/users/jyshee/events{/privacy}", "received_events_url": "https://api.github.com/users/jyshee/received_events", "type": "User", "site_admin": false}, "created_at": "2016-06-21T07:14:52Z", "updated_at": "2016-06-21T08:59:26Z", "author_association": "NONE", "body_html": "<p>I tried to implement the gradient of tf.extract_image_patches using tf.reshape and tf.pad Ops as:</p>\n<pre><code>   @ops.RegisterGradient(\"ExtractImagePatches\")\n   def _ExtractImagePatchesGrad(op,grad):\n      ksize=op.get_attr(\"ksizes\")[1]\n      im=grad\n      batch_size = im.get_shape()[0].value\n      h = im.get_shape()[1].value\n      w = im.get_shape()[2].value\n      ch = im.get_shape()[3].value\n      h_o = h + (ksize - 1)\n      w_o = w + (ksize - 1)\n      ch_o = ch / ksize / ksize\n      im_o = tf.Variable(tf.zeros([batch_size, h_o, w_o, ch_o]), trainable=False)\n      for i in xrange(h):\n         for j in xrange(w):\n            res=tf.reshape(im[:,i,j,:],[-1,ksize,ksize,int(ch/ksize/ksize)])\n            padres=tf.pad(res,[[0,0],[i,h_o-i-ksize],[j,w_o-j-ksize],[0,0]])\n            im_o+=padres\n      return tf.identity(im_o)```\n\n\nAnd it seems work...\n</code></pre>", "body_text": "I tried to implement the gradient of tf.extract_image_patches using tf.reshape and tf.pad Ops as:\n   @ops.RegisterGradient(\"ExtractImagePatches\")\n   def _ExtractImagePatchesGrad(op,grad):\n      ksize=op.get_attr(\"ksizes\")[1]\n      im=grad\n      batch_size = im.get_shape()[0].value\n      h = im.get_shape()[1].value\n      w = im.get_shape()[2].value\n      ch = im.get_shape()[3].value\n      h_o = h + (ksize - 1)\n      w_o = w + (ksize - 1)\n      ch_o = ch / ksize / ksize\n      im_o = tf.Variable(tf.zeros([batch_size, h_o, w_o, ch_o]), trainable=False)\n      for i in xrange(h):\n         for j in xrange(w):\n            res=tf.reshape(im[:,i,j,:],[-1,ksize,ksize,int(ch/ksize/ksize)])\n            padres=tf.pad(res,[[0,0],[i,h_o-i-ksize],[j,w_o-j-ksize],[0,0]])\n            im_o+=padres\n      return tf.identity(im_o)```\n\n\nAnd it seems work...", "body": "I tried to implement the gradient of tf.extract_image_patches using tf.reshape and tf.pad Ops as:\n\n``````\n   @ops.RegisterGradient(\"ExtractImagePatches\")\n   def _ExtractImagePatchesGrad(op,grad):\n      ksize=op.get_attr(\"ksizes\")[1]\n      im=grad\n      batch_size = im.get_shape()[0].value\n      h = im.get_shape()[1].value\n      w = im.get_shape()[2].value\n      ch = im.get_shape()[3].value\n      h_o = h + (ksize - 1)\n      w_o = w + (ksize - 1)\n      ch_o = ch / ksize / ksize\n      im_o = tf.Variable(tf.zeros([batch_size, h_o, w_o, ch_o]), trainable=False)\n      for i in xrange(h):\n         for j in xrange(w):\n            res=tf.reshape(im[:,i,j,:],[-1,ksize,ksize,int(ch/ksize/ksize)])\n            padres=tf.pad(res,[[0,0],[i,h_o-i-ksize],[j,w_o-j-ksize],[0,0]])\n            im_o+=padres\n      return tf.identity(im_o)```\n\n\nAnd it seems work...\n``````\n"}