{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15216", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15216/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15216/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15216/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15216", "id": 280536217, "node_id": "MDU6SXNzdWUyODA1MzYyMTc=", "number": 15216, "title": "When data become large,parition variables can not initialized successfully", "user": {"login": "weidong8405347", "id": 12580804, "node_id": "MDQ6VXNlcjEyNTgwODA0", "avatar_url": "https://avatars1.githubusercontent.com/u/12580804?v=4", "gravatar_id": "", "url": "https://api.github.com/users/weidong8405347", "html_url": "https://github.com/weidong8405347", "followers_url": "https://api.github.com/users/weidong8405347/followers", "following_url": "https://api.github.com/users/weidong8405347/following{/other_user}", "gists_url": "https://api.github.com/users/weidong8405347/gists{/gist_id}", "starred_url": "https://api.github.com/users/weidong8405347/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/weidong8405347/subscriptions", "organizations_url": "https://api.github.com/users/weidong8405347/orgs", "repos_url": "https://api.github.com/users/weidong8405347/repos", "events_url": "https://api.github.com/users/weidong8405347/events{/privacy}", "received_events_url": "https://api.github.com/users/weidong8405347/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2017-12-08T16:03:41Z", "updated_at": "2018-01-30T00:16:16Z", "closed_at": "2018-01-30T00:16:16Z", "author_association": "NONE", "body_html": "<p>i use tensorflow to distributed trainning models,  i use the partition valriables to store an array data, when the data is not so bigger, everything looks ok,but when the array data become larger, when the session initialize, the partition variables can not  initialized and the session will wait util time out.</p>\n<h3>Describe the problem</h3>\n<p>Describe the problem clearly here. Be sure to convey here why it's a bug in TensorFlow or a feature request. the feat_info can initialize successfully, but the adj_info cannot initialized. the adj_info is larger than feat_info</p>\n<h3>Source code / logs</h3>\n<p>i use ps_num = 4, worker_num =4 and i also try some other distributed config, like ps_num=1, worker_num=4, the result is the same<br>\nsource code:<br>\nwith tf.device(tf.train.replica_device_setter(<br>\nworker_device=\"/job:worker/task:%d\" % task_id,<br>\ncluster=cluster_spec)):</p>\n<pre><code>  feat_info = tf.get_variable(\"feature_info\", (len(id_map),FLAGS.features_column), tf.float32, trainable=False, partitioner=tf.fixed_size_partitioner(num_workers))\n  adj_info = tf.get_variable(\"adj_info\", (len(id_map),FLAGS.max_degree), tf.int64, trainable=False, partitioner=tf.fixed_size_partitioner(num_workers))\n \n  with tf.device('/job:worker/task:%d' %task_id):\n      adj_local = tf.Variable(tf.constant(minibatch.adj, dtype=tf.int64), trainable=False, name=\"adj_local\", collections=[tf.GraphKeys.LOCAL_VARIABLES])\n      feat_local = tf.Variable(tf.constant(features, dtype=tf.float32), trainable=False, name=\"feat_local\", collections=[tf.GraphKeys.LOCAL_VARIABLES])\n \n  length, begin, end = split_node_by_task(len(id_map), task_id, num_workers)\n  adj = tf.nn.embedding_lookup(adj_info, [x for x in range(begin, end)])\n  adj = adj_local\n  \n  feat = tf.nn.embedding_lookup(feat_info, [x for x in range(begin, end)])\n  feat = feat_local\n</code></pre>\n<p>log:<br>\n2017-12-08 23:54:17.377290: I tensorflow/core/distributed_runtime/master_session.cc:998] Start master session c2b3ba9b700261ba with config:<br>\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  None, ready: Variables not initialized: adj_info/part_0, adj_info/part_1, adj_info/part_2, adj_info/part_3, adj_info/part_4, adj_info/part_5, adj_info/part_6, adj_info/part_7, adj_info/part_8, adj_info/part_9, adj_info/part_10, adj_info/part_11, adj_info/part_12, adj_info/part_13, adj_info/part_14, adj_info/part_15<br>\n2017-12-09 00:00:35.637019: I tensorflow/core/distributed_runtime/master_session.cc:998] Start master session f35fcf332e3908ec with config:<br>\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  None, ready: Variables not initialized: adj_info/part_0, adj_info/part_1, adj_info/part_2, adj_info/part_3, adj_info/part_4, adj_info/part_5, adj_info/part_6, adj_info/part_7, adj_info/part_8, adj_info/part_9, adj_info/part_10, adj_info/part_11, adj_info/part_12, adj_info/part_13, adj_info/part_14, adj_info/part_15<br>\nand it will alway waiting adj_info to initialize</p>", "body_text": "i use tensorflow to distributed trainning models,  i use the partition valriables to store an array data, when the data is not so bigger, everything looks ok,but when the array data become larger, when the session initialize, the partition variables can not  initialized and the session will wait util time out.\nDescribe the problem\nDescribe the problem clearly here. Be sure to convey here why it's a bug in TensorFlow or a feature request. the feat_info can initialize successfully, but the adj_info cannot initialized. the adj_info is larger than feat_info\nSource code / logs\ni use ps_num = 4, worker_num =4 and i also try some other distributed config, like ps_num=1, worker_num=4, the result is the same\nsource code:\nwith tf.device(tf.train.replica_device_setter(\nworker_device=\"/job:worker/task:%d\" % task_id,\ncluster=cluster_spec)):\n  feat_info = tf.get_variable(\"feature_info\", (len(id_map),FLAGS.features_column), tf.float32, trainable=False, partitioner=tf.fixed_size_partitioner(num_workers))\n  adj_info = tf.get_variable(\"adj_info\", (len(id_map),FLAGS.max_degree), tf.int64, trainable=False, partitioner=tf.fixed_size_partitioner(num_workers))\n \n  with tf.device('/job:worker/task:%d' %task_id):\n      adj_local = tf.Variable(tf.constant(minibatch.adj, dtype=tf.int64), trainable=False, name=\"adj_local\", collections=[tf.GraphKeys.LOCAL_VARIABLES])\n      feat_local = tf.Variable(tf.constant(features, dtype=tf.float32), trainable=False, name=\"feat_local\", collections=[tf.GraphKeys.LOCAL_VARIABLES])\n \n  length, begin, end = split_node_by_task(len(id_map), task_id, num_workers)\n  adj = tf.nn.embedding_lookup(adj_info, [x for x in range(begin, end)])\n  adj = adj_local\n  \n  feat = tf.nn.embedding_lookup(feat_info, [x for x in range(begin, end)])\n  feat = feat_local\n\nlog:\n2017-12-08 23:54:17.377290: I tensorflow/core/distributed_runtime/master_session.cc:998] Start master session c2b3ba9b700261ba with config:\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  None, ready: Variables not initialized: adj_info/part_0, adj_info/part_1, adj_info/part_2, adj_info/part_3, adj_info/part_4, adj_info/part_5, adj_info/part_6, adj_info/part_7, adj_info/part_8, adj_info/part_9, adj_info/part_10, adj_info/part_11, adj_info/part_12, adj_info/part_13, adj_info/part_14, adj_info/part_15\n2017-12-09 00:00:35.637019: I tensorflow/core/distributed_runtime/master_session.cc:998] Start master session f35fcf332e3908ec with config:\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  None, ready: Variables not initialized: adj_info/part_0, adj_info/part_1, adj_info/part_2, adj_info/part_3, adj_info/part_4, adj_info/part_5, adj_info/part_6, adj_info/part_7, adj_info/part_8, adj_info/part_9, adj_info/part_10, adj_info/part_11, adj_info/part_12, adj_info/part_13, adj_info/part_14, adj_info/part_15\nand it will alway waiting adj_info to initialize", "body": "i use tensorflow to distributed trainning models,  i use the partition valriables to store an array data, when the data is not so bigger, everything looks ok,but when the array data become larger, when the session initialize, the partition variables can not  initialized and the session will wait util time out.\r\n### Describe the problem\r\nDescribe the problem clearly here. Be sure to convey here why it's a bug in TensorFlow or a feature request. the feat_info can initialize successfully, but the adj_info cannot initialized. the adj_info is larger than feat_info\r\n### Source code / logs\r\ni use ps_num = 4, worker_num =4 and i also try some other distributed config, like ps_num=1, worker_num=4, the result is the same\r\nsource code:\r\n    with tf.device(tf.train.replica_device_setter(\r\n        worker_device=\"/job:worker/task:%d\" % task_id,\r\n        cluster=cluster_spec)):\r\n      \r\n      feat_info = tf.get_variable(\"feature_info\", (len(id_map),FLAGS.features_column), tf.float32, trainable=False, partitioner=tf.fixed_size_partitioner(num_workers))\r\n      adj_info = tf.get_variable(\"adj_info\", (len(id_map),FLAGS.max_degree), tf.int64, trainable=False, partitioner=tf.fixed_size_partitioner(num_workers))\r\n     \r\n      with tf.device('/job:worker/task:%d' %task_id):\r\n          adj_local = tf.Variable(tf.constant(minibatch.adj, dtype=tf.int64), trainable=False, name=\"adj_local\", collections=[tf.GraphKeys.LOCAL_VARIABLES])\r\n          feat_local = tf.Variable(tf.constant(features, dtype=tf.float32), trainable=False, name=\"feat_local\", collections=[tf.GraphKeys.LOCAL_VARIABLES])\r\n     \r\n      length, begin, end = split_node_by_task(len(id_map), task_id, num_workers)\r\n      adj = tf.nn.embedding_lookup(adj_info, [x for x in range(begin, end)])\r\n      adj = adj_local\r\n      \r\n      feat = tf.nn.embedding_lookup(feat_info, [x for x in range(begin, end)])\r\n      feat = feat_local\r\n\r\nlog:\r\n2017-12-08 23:54:17.377290: I tensorflow/core/distributed_runtime/master_session.cc:998] Start master session c2b3ba9b700261ba with config: \r\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  None, ready: Variables not initialized: adj_info/part_0, adj_info/part_1, adj_info/part_2, adj_info/part_3, adj_info/part_4, adj_info/part_5, adj_info/part_6, adj_info/part_7, adj_info/part_8, adj_info/part_9, adj_info/part_10, adj_info/part_11, adj_info/part_12, adj_info/part_13, adj_info/part_14, adj_info/part_15\r\n2017-12-09 00:00:35.637019: I tensorflow/core/distributed_runtime/master_session.cc:998] Start master session f35fcf332e3908ec with config: \r\nINFO:tensorflow:Waiting for model to be ready.  Ready_for_local_init_op:  None, ready: Variables not initialized: adj_info/part_0, adj_info/part_1, adj_info/part_2, adj_info/part_3, adj_info/part_4, adj_info/part_5, adj_info/part_6, adj_info/part_7, adj_info/part_8, adj_info/part_9, adj_info/part_10, adj_info/part_11, adj_info/part_12, adj_info/part_13, adj_info/part_14, adj_info/part_15\r\nand it will alway waiting adj_info to initialize"}