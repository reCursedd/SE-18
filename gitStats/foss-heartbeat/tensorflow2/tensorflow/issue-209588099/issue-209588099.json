{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7796", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7796/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7796/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7796/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/7796", "id": 209588099, "node_id": "MDU6SXNzdWUyMDk1ODgwOTk=", "number": 7796, "title": "Problems in Defining New Op ", "user": {"login": "xingyul", "id": 25826644, "node_id": "MDQ6VXNlcjI1ODI2NjQ0", "avatar_url": "https://avatars0.githubusercontent.com/u/25826644?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xingyul", "html_url": "https://github.com/xingyul", "followers_url": "https://api.github.com/users/xingyul/followers", "following_url": "https://api.github.com/users/xingyul/following{/other_user}", "gists_url": "https://api.github.com/users/xingyul/gists{/gist_id}", "starred_url": "https://api.github.com/users/xingyul/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xingyul/subscriptions", "organizations_url": "https://api.github.com/users/xingyul/orgs", "repos_url": "https://api.github.com/users/xingyul/repos", "events_url": "https://api.github.com/users/xingyul/events{/privacy}", "received_events_url": "https://api.github.com/users/xingyul/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}, {"id": 473184161, "node_id": "MDU6TGFiZWw0NzMxODQxNjE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:support", "name": "type:support", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "keveman", "id": 229914, "node_id": "MDQ6VXNlcjIyOTkxNA==", "avatar_url": "https://avatars1.githubusercontent.com/u/229914?v=4", "gravatar_id": "", "url": "https://api.github.com/users/keveman", "html_url": "https://github.com/keveman", "followers_url": "https://api.github.com/users/keveman/followers", "following_url": "https://api.github.com/users/keveman/following{/other_user}", "gists_url": "https://api.github.com/users/keveman/gists{/gist_id}", "starred_url": "https://api.github.com/users/keveman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/keveman/subscriptions", "organizations_url": "https://api.github.com/users/keveman/orgs", "repos_url": "https://api.github.com/users/keveman/repos", "events_url": "https://api.github.com/users/keveman/events{/privacy}", "received_events_url": "https://api.github.com/users/keveman/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "keveman", "id": 229914, "node_id": "MDQ6VXNlcjIyOTkxNA==", "avatar_url": "https://avatars1.githubusercontent.com/u/229914?v=4", "gravatar_id": "", "url": "https://api.github.com/users/keveman", "html_url": "https://github.com/keveman", "followers_url": "https://api.github.com/users/keveman/followers", "following_url": "https://api.github.com/users/keveman/following{/other_user}", "gists_url": "https://api.github.com/users/keveman/gists{/gist_id}", "starred_url": "https://api.github.com/users/keveman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/keveman/subscriptions", "organizations_url": "https://api.github.com/users/keveman/orgs", "repos_url": "https://api.github.com/users/keveman/repos", "events_url": "https://api.github.com/users/keveman/events{/privacy}", "received_events_url": "https://api.github.com/users/keveman/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2017-02-22T21:33:41Z", "updated_at": "2017-04-26T23:13:26Z", "closed_at": "2017-04-26T23:13:26Z", "author_association": "NONE", "body_html": "<p>I'm trying to define a new Op (a simple matmul) by myself. I defined the both CPU and GPU Opkernel and ran REGISTER_KERNEL_BUILDER with DEVICE_CPU and DEVICE_GPU respectively to register them. When I was testing it on my server installed with GPU, and used</p>\n<pre><code>with tf.Graph().as_default():\n    with tf.device('/gpu:0'):\n    # some code for graph\n    sess = tf.Session(config=tf.ConfigProto(allow_soft_placement=True, log_device_placement=True))\n    sess.run(tf.initialize_all_variables())\n    print sess.run(out)\n</code></pre>\n<p>to define variable and Ops, I found only the code of CPU Opkernel is used.</p>\n<p>Weird thing is that if I delete the CPU Opkernel code and CPU Opkernel registration, keep only GPU Opkernel and register only the GPU Opkernel, GPU Opkernel code will be used now and everything works and with the following output:</p>\n<pre><code>E tensorflow/core/common_runtime/executor.cc:390] Executor failed to create kernel. Not found: No registered 'MyMatMul' OpKernel for CPU devices compatible with node MyMatMul = MyMatMul[_device=\"/job:localhost/replica:0/task:0/gpu:0\"](Const, Const_1)\n        .  Registered:  device='GPU'\n\n         [[Node: MyMatMul = MyMatMul[_device=\"/job:localhost/replica:0/task:0/gpu:0\"](Const, Const_1)]]\n</code></pre>\n<p>Anyone has idea for it?</p>", "body_text": "I'm trying to define a new Op (a simple matmul) by myself. I defined the both CPU and GPU Opkernel and ran REGISTER_KERNEL_BUILDER with DEVICE_CPU and DEVICE_GPU respectively to register them. When I was testing it on my server installed with GPU, and used\nwith tf.Graph().as_default():\n    with tf.device('/gpu:0'):\n    # some code for graph\n    sess = tf.Session(config=tf.ConfigProto(allow_soft_placement=True, log_device_placement=True))\n    sess.run(tf.initialize_all_variables())\n    print sess.run(out)\n\nto define variable and Ops, I found only the code of CPU Opkernel is used.\nWeird thing is that if I delete the CPU Opkernel code and CPU Opkernel registration, keep only GPU Opkernel and register only the GPU Opkernel, GPU Opkernel code will be used now and everything works and with the following output:\nE tensorflow/core/common_runtime/executor.cc:390] Executor failed to create kernel. Not found: No registered 'MyMatMul' OpKernel for CPU devices compatible with node MyMatMul = MyMatMul[_device=\"/job:localhost/replica:0/task:0/gpu:0\"](Const, Const_1)\n        .  Registered:  device='GPU'\n\n         [[Node: MyMatMul = MyMatMul[_device=\"/job:localhost/replica:0/task:0/gpu:0\"](Const, Const_1)]]\n\nAnyone has idea for it?", "body": "I'm trying to define a new Op (a simple matmul) by myself. I defined the both CPU and GPU Opkernel and ran REGISTER_KERNEL_BUILDER with DEVICE_CPU and DEVICE_GPU respectively to register them. When I was testing it on my server installed with GPU, and used\r\n```\r\nwith tf.Graph().as_default():\r\n    with tf.device('/gpu:0'):\r\n    # some code for graph\r\n    sess = tf.Session(config=tf.ConfigProto(allow_soft_placement=True, log_device_placement=True))\r\n    sess.run(tf.initialize_all_variables())\r\n    print sess.run(out)\r\n```\r\nto define variable and Ops, I found only the code of CPU Opkernel is used.\r\n\r\nWeird thing is that if I delete the CPU Opkernel code and CPU Opkernel registration, keep only GPU Opkernel and register only the GPU Opkernel, GPU Opkernel code will be used now and everything works and with the following output:\r\n\r\n```\r\nE tensorflow/core/common_runtime/executor.cc:390] Executor failed to create kernel. Not found: No registered 'MyMatMul' OpKernel for CPU devices compatible with node MyMatMul = MyMatMul[_device=\"/job:localhost/replica:0/task:0/gpu:0\"](Const, Const_1)\r\n        .  Registered:  device='GPU'\r\n\r\n         [[Node: MyMatMul = MyMatMul[_device=\"/job:localhost/replica:0/task:0/gpu:0\"](Const, Const_1)]]\r\n```\r\n\r\nAnyone has idea for it?"}