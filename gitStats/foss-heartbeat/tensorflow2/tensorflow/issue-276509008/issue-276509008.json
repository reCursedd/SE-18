{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14851", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14851/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14851/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14851/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/14851", "id": 276509008, "node_id": "MDU6SXNzdWUyNzY1MDkwMDg=", "number": 14851, "title": "Got NAN when calling embedding_lookup_sparse with weights and \"mean\" combiner", "user": {"login": "zhangyafeikimi", "id": 998536, "node_id": "MDQ6VXNlcjk5ODUzNg==", "avatar_url": "https://avatars2.githubusercontent.com/u/998536?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhangyafeikimi", "html_url": "https://github.com/zhangyafeikimi", "followers_url": "https://api.github.com/users/zhangyafeikimi/followers", "following_url": "https://api.github.com/users/zhangyafeikimi/following{/other_user}", "gists_url": "https://api.github.com/users/zhangyafeikimi/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhangyafeikimi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhangyafeikimi/subscriptions", "organizations_url": "https://api.github.com/users/zhangyafeikimi/orgs", "repos_url": "https://api.github.com/users/zhangyafeikimi/repos", "events_url": "https://api.github.com/users/zhangyafeikimi/events{/privacy}", "received_events_url": "https://api.github.com/users/zhangyafeikimi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2017-11-24T03:53:11Z", "updated_at": "2018-02-21T02:19:21Z", "closed_at": null, "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>OS Platform and Distribution</strong>: Win7 64bit</li>\n<li><strong>TensorFlow installed from</strong>: anaconda binary</li>\n<li><strong>TensorFlow version</strong>: 1.2.1</li>\n<li><strong>Python version</strong>: 3.6</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>I always got nan when I call embedding_lookup_sparse with weights and \"mean\" combiner.<br>\nCode pieces are listed below:</p>\n<h3>Source code / logs</h3>\n<p>from <strong>future</strong> import absolute_import<br>\nfrom <strong>future</strong> import print_function<br>\nimport os<br>\nimport numpy as np<br>\nimport tensorflow as tf<br>\nos.environ['TF_CPP_MIN_LOG_LEVEL'] = '3'</p>\n<p>a = np.arange(192).reshape(24, 8)<br>\nprint(a)</p>\n<p>a = tf.Variable(a, dtype=tf.float32)<br>\nids = tf.SparseTensor(<br>\nindices=[[1, 0], [2, 0], [2, 1], [2, 2], [3, 0], [9, 1]],<br>\nvalues=[10, 1, 2, 3, 4, 5],<br>\ndense_shape=[1, 1])<br>\nweights = tf.SparseTensor(<br>\nindices=[[1, 0], [2, 0], [2, 1], [2, 2], [3, 0], [9, 1]],<br>\nvalues=[1, 0.2, 0.4, 0.4, 1, 1],<br>\ndense_shape=[1, 1])<br>\nb = tf.nn.embedding_lookup_sparse(<br>\na, ids, weights, partition_strategy='mod', combiner='sum')<br>\nc = tf.pad(b, [[0, 16 - tf.shape(b)[0]], [0, 0]], mode='CONSTANT')</p>\n<p>sess = tf.Session()<br>\nsess.run(tf.global_variables_initializer())<br>\n[value] = sess.run([c])<br>\nprint(value)</p>", "body_text": "System information\n\nOS Platform and Distribution: Win7 64bit\nTensorFlow installed from: anaconda binary\nTensorFlow version: 1.2.1\nPython version: 3.6\n\nDescribe the problem\nI always got nan when I call embedding_lookup_sparse with weights and \"mean\" combiner.\nCode pieces are listed below:\nSource code / logs\nfrom future import absolute_import\nfrom future import print_function\nimport os\nimport numpy as np\nimport tensorflow as tf\nos.environ['TF_CPP_MIN_LOG_LEVEL'] = '3'\na = np.arange(192).reshape(24, 8)\nprint(a)\na = tf.Variable(a, dtype=tf.float32)\nids = tf.SparseTensor(\nindices=[[1, 0], [2, 0], [2, 1], [2, 2], [3, 0], [9, 1]],\nvalues=[10, 1, 2, 3, 4, 5],\ndense_shape=[1, 1])\nweights = tf.SparseTensor(\nindices=[[1, 0], [2, 0], [2, 1], [2, 2], [3, 0], [9, 1]],\nvalues=[1, 0.2, 0.4, 0.4, 1, 1],\ndense_shape=[1, 1])\nb = tf.nn.embedding_lookup_sparse(\na, ids, weights, partition_strategy='mod', combiner='sum')\nc = tf.pad(b, [[0, 16 - tf.shape(b)[0]], [0, 0]], mode='CONSTANT')\nsess = tf.Session()\nsess.run(tf.global_variables_initializer())\n[value] = sess.run([c])\nprint(value)", "body": "### System information\r\n- **OS Platform and Distribution**: Win7 64bit\r\n- **TensorFlow installed from**: anaconda binary\r\n- **TensorFlow version**: 1.2.1\r\n- **Python version**: 3.6\r\n\r\n### Describe the problem\r\nI always got nan when I call embedding_lookup_sparse with weights and \"mean\" combiner.\r\nCode pieces are listed below:\r\n\r\n### Source code / logs\r\nfrom __future__ import absolute_import\r\nfrom __future__ import print_function\r\nimport os\r\nimport numpy as np\r\nimport tensorflow as tf\r\nos.environ['TF_CPP_MIN_LOG_LEVEL'] = '3'\r\n\r\na = np.arange(192).reshape(24, 8)\r\nprint(a)\r\n\r\na = tf.Variable(a, dtype=tf.float32)\r\nids = tf.SparseTensor(\r\n    indices=[[1, 0], [2, 0], [2, 1], [2, 2], [3, 0], [9, 1]],\r\n    values=[10, 1, 2, 3, 4, 5],\r\n    dense_shape=[1, 1])\r\nweights = tf.SparseTensor(\r\n    indices=[[1, 0], [2, 0], [2, 1], [2, 2], [3, 0], [9, 1]],\r\n    values=[1, 0.2, 0.4, 0.4, 1, 1],\r\n    dense_shape=[1, 1])\r\nb = tf.nn.embedding_lookup_sparse(\r\n    a, ids, weights, partition_strategy='mod', combiner='sum')\r\nc = tf.pad(b, [[0, 16 - tf.shape(b)[0]], [0, 0]], mode='CONSTANT')\r\n\r\nsess = tf.Session()\r\nsess.run(tf.global_variables_initializer())\r\n[value] = sess.run([c])\r\nprint(value)\r\n"}