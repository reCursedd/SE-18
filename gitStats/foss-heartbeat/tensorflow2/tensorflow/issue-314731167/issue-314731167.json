{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18564", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18564/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18564/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18564/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/18564", "id": 314731167, "node_id": "MDU6SXNzdWUzMTQ3MzExNjc=", "number": 18564, "title": "Failed to compile summarize_graph on macOS with TF 1.7", "user": {"login": "sadlerjw", "id": 2762244, "node_id": "MDQ6VXNlcjI3NjIyNDQ=", "avatar_url": "https://avatars3.githubusercontent.com/u/2762244?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sadlerjw", "html_url": "https://github.com/sadlerjw", "followers_url": "https://api.github.com/users/sadlerjw/followers", "following_url": "https://api.github.com/users/sadlerjw/following{/other_user}", "gists_url": "https://api.github.com/users/sadlerjw/gists{/gist_id}", "starred_url": "https://api.github.com/users/sadlerjw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sadlerjw/subscriptions", "organizations_url": "https://api.github.com/users/sadlerjw/orgs", "repos_url": "https://api.github.com/users/sadlerjw/repos", "events_url": "https://api.github.com/users/sadlerjw/events{/privacy}", "received_events_url": "https://api.github.com/users/sadlerjw/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "gunan", "id": 7946809, "node_id": "MDQ6VXNlcjc5NDY4MDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/7946809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gunan", "html_url": "https://github.com/gunan", "followers_url": "https://api.github.com/users/gunan/followers", "following_url": "https://api.github.com/users/gunan/following{/other_user}", "gists_url": "https://api.github.com/users/gunan/gists{/gist_id}", "starred_url": "https://api.github.com/users/gunan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gunan/subscriptions", "organizations_url": "https://api.github.com/users/gunan/orgs", "repos_url": "https://api.github.com/users/gunan/repos", "events_url": "https://api.github.com/users/gunan/events{/privacy}", "received_events_url": "https://api.github.com/users/gunan/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "gunan", "id": 7946809, "node_id": "MDQ6VXNlcjc5NDY4MDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/7946809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gunan", "html_url": "https://github.com/gunan", "followers_url": "https://api.github.com/users/gunan/followers", "following_url": "https://api.github.com/users/gunan/following{/other_user}", "gists_url": "https://api.github.com/users/gunan/gists{/gist_id}", "starred_url": "https://api.github.com/users/gunan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gunan/subscriptions", "organizations_url": "https://api.github.com/users/gunan/orgs", "repos_url": "https://api.github.com/users/gunan/repos", "events_url": "https://api.github.com/users/gunan/events{/privacy}", "received_events_url": "https://api.github.com/users/gunan/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2018-04-16T16:34:06Z", "updated_at": "2018-05-15T18:44:47Z", "closed_at": "2018-05-15T18:44:47Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: No</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: macOS High Sierra 10.13.3</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: source</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.7.0</li>\n<li><strong>Python version</strong>: 2.7.14</li>\n<li><strong>Bazel version (if compiling from source)</strong>: 0.12.0-homebrew</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: Xcode 9.3: Apple LLVM version 9.1.0 (clang-902.0.39.1)</li>\n<li><strong>CUDA/cuDNN version</strong>: n/a</li>\n<li><strong>GPU model and memory</strong>: n/a</li>\n<li><strong>Exact command to reproduce</strong>: <code>bazel build tensorflow/tools/graph_transforms:summarize_graph</code></li>\n</ul>\n<h3>Describe the problem</h3>\n<p>Build fails with the output in the section below. Removing <code>armeabi-v7a</code> from <code>third_party/jpeg/jpeg.BUILD</code> seems to resolve the issue. See output of <code>git diff</code> below.</p>\n<p>Building <code>summarize_graph</code> above fails fast, but I originally found the issue by trying to build <code>print_selective_registration_header</code> using the following command, which fails in ~90 seconds on my machine:</p>\n<div class=\"highlight highlight-source-shell\"><pre>bazel build tensorflow/tools/graph_transforms:summarize_graph</pre></div>\n<h3>Source code / logs</h3>\n<p>Output of build command:</p>\n<pre><code>WARNING: /private/var/tmp/_bazel_json/e38619818ff94aae50ac5b3bdbbe0f32/external/protobuf_archive/WORKSPACE:1: Workspace name in /private/var/tmp/_bazel_json/e38619818ff94aae50ac5b3bdbbe0f32/external/protobuf_archive/WORKSPACE (@com_google_protobuf) does not match the name given in the repository's definition (@protobuf_archive); this will cause a build error in future versions\nINFO: Analysed target //tensorflow/tools/graph_transforms:summarize_graph (0 packages loaded).\nINFO: Found 1 target...\nERROR: /private/var/tmp/_bazel_json/e38619818ff94aae50ac5b3bdbbe0f32/external/jpeg/BUILD:44:1: C++ compilation of rule '@jpeg//:jpeg' failed (Exit 1)\nerror: unknown target CPU 'armv7-a'\nTarget //tensorflow/tools/graph_transforms:summarize_graph failed to build\nUse --verbose_failures to see the command lines of failed build steps.\nINFO: Elapsed time: 0.877s, Critical Path: 0.18s\nFAILED: Build did NOT complete successfully\n</code></pre>\n<p>Diff of workaround via <code>git diff</code>:</p>\n<div class=\"highlight highlight-source-diff\"><pre><span class=\"pl-c1\">diff --git a/third_party/jpeg/jpeg.BUILD b/third_party/jpeg/jpeg.BUILD</span>\nindex 87a23925c4..fa6dd27a70 100644\n<span class=\"pl-md\">--- a/third_party/jpeg/jpeg.BUILD</span>\n<span class=\"pl-mi1\">+++ b/third_party/jpeg/jpeg.BUILD</span>\n<span class=\"pl-mdr\">@@ -28,12 +28,6 @@</span> libjpegturbo_copts = select({\n         \"-w\",\n     ],\n }) + select({\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>    \":armeabi-v7a\": [</span>\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>        \"-D__ARM_NEON__\",</span>\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>        \"-march=armv7-a\",</span>\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>        \"-mfloat-abi=softfp\",</span>\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>        \"-fprefetch-loop-arrays\",</span>\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>    ],</span>\n     \":linux_ppc64le\": [\n         \"-mcpu=power8\",\n         \"-mtune=power8\",\n<span class=\"pl-mdr\">@@ -125,7 +119,6 @@</span> cc_library(\n     visibility = [\"//visibility:public\"],\n     deps = select({\n         \":k8\": [\":simd_x86_64\"],\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>        \":armeabi-v7a\": [\":simd_armv7a\"],</span>\n         \":arm64-v8a\": [\":simd_armv8a\"],\n         \":linux_ppc64le\": [\":simd_altivec\"],\n         \"//conditions:default\": [\":simd_none\"],\n<span class=\"pl-mdr\">@@ -423,7 +416,6 @@</span> genrule(\n         \":windows\": \"cp $(location jconfig_win.h) $@\",\n         \":windows_msvc\": \"cp $(location jconfig_win.h) $@\",\n         \":k8\": \"cp $(location jconfig_nowin_simd.h) $@\",\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>        \":armeabi-v7a\": \"cp $(location jconfig_nowin_simd.h) $@\",</span>\n         \":arm64-v8a\": \"cp $(location jconfig_nowin_simd.h) $@\",\n         \":linux_ppc64le\": \"cp $(location jconfig_nowin_simd.h) $@\",\n         \"//conditions:default\": \"cp $(location jconfig_nowin_nosimd.h) $@\",\n<span class=\"pl-mdr\">@@ -524,11 +516,6 @@</span> config_setting(\n     values = {\"crosstool_top\": \"//external:android/crosstool\"},\n )\n \n<span class=\"pl-md\"><span class=\"pl-md\">-</span>config_setting(</span>\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>    name = \"armeabi-v7a\",</span>\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>    values = {\"android_cpu\": \"armeabi-v7a\"},</span>\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>)</span>\n<span class=\"pl-md\"><span class=\"pl-md\">-</span></span>\n config_setting(\n     name = \"arm64-v8a\",\n     values = {\"android_cpu\": \"arm64-v8a\"},</pre></div>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): No\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): macOS High Sierra 10.13.3\nTensorFlow installed from (source or binary): source\nTensorFlow version (use command below): 1.7.0\nPython version: 2.7.14\nBazel version (if compiling from source): 0.12.0-homebrew\nGCC/Compiler version (if compiling from source): Xcode 9.3: Apple LLVM version 9.1.0 (clang-902.0.39.1)\nCUDA/cuDNN version: n/a\nGPU model and memory: n/a\nExact command to reproduce: bazel build tensorflow/tools/graph_transforms:summarize_graph\n\nDescribe the problem\nBuild fails with the output in the section below. Removing armeabi-v7a from third_party/jpeg/jpeg.BUILD seems to resolve the issue. See output of git diff below.\nBuilding summarize_graph above fails fast, but I originally found the issue by trying to build print_selective_registration_header using the following command, which fails in ~90 seconds on my machine:\nbazel build tensorflow/tools/graph_transforms:summarize_graph\nSource code / logs\nOutput of build command:\nWARNING: /private/var/tmp/_bazel_json/e38619818ff94aae50ac5b3bdbbe0f32/external/protobuf_archive/WORKSPACE:1: Workspace name in /private/var/tmp/_bazel_json/e38619818ff94aae50ac5b3bdbbe0f32/external/protobuf_archive/WORKSPACE (@com_google_protobuf) does not match the name given in the repository's definition (@protobuf_archive); this will cause a build error in future versions\nINFO: Analysed target //tensorflow/tools/graph_transforms:summarize_graph (0 packages loaded).\nINFO: Found 1 target...\nERROR: /private/var/tmp/_bazel_json/e38619818ff94aae50ac5b3bdbbe0f32/external/jpeg/BUILD:44:1: C++ compilation of rule '@jpeg//:jpeg' failed (Exit 1)\nerror: unknown target CPU 'armv7-a'\nTarget //tensorflow/tools/graph_transforms:summarize_graph failed to build\nUse --verbose_failures to see the command lines of failed build steps.\nINFO: Elapsed time: 0.877s, Critical Path: 0.18s\nFAILED: Build did NOT complete successfully\n\nDiff of workaround via git diff:\ndiff --git a/third_party/jpeg/jpeg.BUILD b/third_party/jpeg/jpeg.BUILD\nindex 87a23925c4..fa6dd27a70 100644\n--- a/third_party/jpeg/jpeg.BUILD\n+++ b/third_party/jpeg/jpeg.BUILD\n@@ -28,12 +28,6 @@ libjpegturbo_copts = select({\n         \"-w\",\n     ],\n }) + select({\n-    \":armeabi-v7a\": [\n-        \"-D__ARM_NEON__\",\n-        \"-march=armv7-a\",\n-        \"-mfloat-abi=softfp\",\n-        \"-fprefetch-loop-arrays\",\n-    ],\n     \":linux_ppc64le\": [\n         \"-mcpu=power8\",\n         \"-mtune=power8\",\n@@ -125,7 +119,6 @@ cc_library(\n     visibility = [\"//visibility:public\"],\n     deps = select({\n         \":k8\": [\":simd_x86_64\"],\n-        \":armeabi-v7a\": [\":simd_armv7a\"],\n         \":arm64-v8a\": [\":simd_armv8a\"],\n         \":linux_ppc64le\": [\":simd_altivec\"],\n         \"//conditions:default\": [\":simd_none\"],\n@@ -423,7 +416,6 @@ genrule(\n         \":windows\": \"cp $(location jconfig_win.h) $@\",\n         \":windows_msvc\": \"cp $(location jconfig_win.h) $@\",\n         \":k8\": \"cp $(location jconfig_nowin_simd.h) $@\",\n-        \":armeabi-v7a\": \"cp $(location jconfig_nowin_simd.h) $@\",\n         \":arm64-v8a\": \"cp $(location jconfig_nowin_simd.h) $@\",\n         \":linux_ppc64le\": \"cp $(location jconfig_nowin_simd.h) $@\",\n         \"//conditions:default\": \"cp $(location jconfig_nowin_nosimd.h) $@\",\n@@ -524,11 +516,6 @@ config_setting(\n     values = {\"crosstool_top\": \"//external:android/crosstool\"},\n )\n \n-config_setting(\n-    name = \"armeabi-v7a\",\n-    values = {\"android_cpu\": \"armeabi-v7a\"},\n-)\n-\n config_setting(\n     name = \"arm64-v8a\",\n     values = {\"android_cpu\": \"arm64-v8a\"},", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: macOS High Sierra 10.13.3\r\n- **TensorFlow installed from (source or binary)**: source\r\n- **TensorFlow version (use command below)**: 1.7.0\r\n- **Python version**: 2.7.14\r\n- **Bazel version (if compiling from source)**: 0.12.0-homebrew\r\n- **GCC/Compiler version (if compiling from source)**: Xcode 9.3: Apple LLVM version 9.1.0 (clang-902.0.39.1)\r\n- **CUDA/cuDNN version**: n/a\r\n- **GPU model and memory**: n/a\r\n- **Exact command to reproduce**: `bazel build tensorflow/tools/graph_transforms:summarize_graph`\r\n\r\n### Describe the problem\r\nBuild fails with the output in the section below. Removing `armeabi-v7a` from `third_party/jpeg/jpeg.BUILD` seems to resolve the issue. See output of `git diff` below.\r\n\r\nBuilding `summarize_graph` above fails fast, but I originally found the issue by trying to build `print_selective_registration_header` using the following command, which fails in ~90 seconds on my machine:\r\n```bash\r\nbazel build tensorflow/tools/graph_transforms:summarize_graph\r\n```\r\n\r\n### Source code / logs\r\nOutput of build command:\r\n```\r\nWARNING: /private/var/tmp/_bazel_json/e38619818ff94aae50ac5b3bdbbe0f32/external/protobuf_archive/WORKSPACE:1: Workspace name in /private/var/tmp/_bazel_json/e38619818ff94aae50ac5b3bdbbe0f32/external/protobuf_archive/WORKSPACE (@com_google_protobuf) does not match the name given in the repository's definition (@protobuf_archive); this will cause a build error in future versions\r\nINFO: Analysed target //tensorflow/tools/graph_transforms:summarize_graph (0 packages loaded).\r\nINFO: Found 1 target...\r\nERROR: /private/var/tmp/_bazel_json/e38619818ff94aae50ac5b3bdbbe0f32/external/jpeg/BUILD:44:1: C++ compilation of rule '@jpeg//:jpeg' failed (Exit 1)\r\nerror: unknown target CPU 'armv7-a'\r\nTarget //tensorflow/tools/graph_transforms:summarize_graph failed to build\r\nUse --verbose_failures to see the command lines of failed build steps.\r\nINFO: Elapsed time: 0.877s, Critical Path: 0.18s\r\nFAILED: Build did NOT complete successfully\r\n```\r\n\r\nDiff of workaround via `git diff`:\r\n```diff\r\ndiff --git a/third_party/jpeg/jpeg.BUILD b/third_party/jpeg/jpeg.BUILD\r\nindex 87a23925c4..fa6dd27a70 100644\r\n--- a/third_party/jpeg/jpeg.BUILD\r\n+++ b/third_party/jpeg/jpeg.BUILD\r\n@@ -28,12 +28,6 @@ libjpegturbo_copts = select({\r\n         \"-w\",\r\n     ],\r\n }) + select({\r\n-    \":armeabi-v7a\": [\r\n-        \"-D__ARM_NEON__\",\r\n-        \"-march=armv7-a\",\r\n-        \"-mfloat-abi=softfp\",\r\n-        \"-fprefetch-loop-arrays\",\r\n-    ],\r\n     \":linux_ppc64le\": [\r\n         \"-mcpu=power8\",\r\n         \"-mtune=power8\",\r\n@@ -125,7 +119,6 @@ cc_library(\r\n     visibility = [\"//visibility:public\"],\r\n     deps = select({\r\n         \":k8\": [\":simd_x86_64\"],\r\n-        \":armeabi-v7a\": [\":simd_armv7a\"],\r\n         \":arm64-v8a\": [\":simd_armv8a\"],\r\n         \":linux_ppc64le\": [\":simd_altivec\"],\r\n         \"//conditions:default\": [\":simd_none\"],\r\n@@ -423,7 +416,6 @@ genrule(\r\n         \":windows\": \"cp $(location jconfig_win.h) $@\",\r\n         \":windows_msvc\": \"cp $(location jconfig_win.h) $@\",\r\n         \":k8\": \"cp $(location jconfig_nowin_simd.h) $@\",\r\n-        \":armeabi-v7a\": \"cp $(location jconfig_nowin_simd.h) $@\",\r\n         \":arm64-v8a\": \"cp $(location jconfig_nowin_simd.h) $@\",\r\n         \":linux_ppc64le\": \"cp $(location jconfig_nowin_simd.h) $@\",\r\n         \"//conditions:default\": \"cp $(location jconfig_nowin_nosimd.h) $@\",\r\n@@ -524,11 +516,6 @@ config_setting(\r\n     values = {\"crosstool_top\": \"//external:android/crosstool\"},\r\n )\r\n \r\n-config_setting(\r\n-    name = \"armeabi-v7a\",\r\n-    values = {\"android_cpu\": \"armeabi-v7a\"},\r\n-)\r\n-\r\n config_setting(\r\n     name = \"arm64-v8a\",\r\n     values = {\"android_cpu\": \"arm64-v8a\"},\r\n```"}