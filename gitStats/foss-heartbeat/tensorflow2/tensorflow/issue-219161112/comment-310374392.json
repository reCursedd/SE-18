{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/310374392", "html_url": "https://github.com/tensorflow/tensorflow/issues/8945#issuecomment-310374392", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8945", "id": 310374392, "node_id": "MDEyOklzc3VlQ29tbWVudDMxMDM3NDM5Mg==", "user": {"login": "sandipmgiri", "id": 16284232, "node_id": "MDQ6VXNlcjE2Mjg0MjMy", "avatar_url": "https://avatars0.githubusercontent.com/u/16284232?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sandipmgiri", "html_url": "https://github.com/sandipmgiri", "followers_url": "https://api.github.com/users/sandipmgiri/followers", "following_url": "https://api.github.com/users/sandipmgiri/following{/other_user}", "gists_url": "https://api.github.com/users/sandipmgiri/gists{/gist_id}", "starred_url": "https://api.github.com/users/sandipmgiri/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sandipmgiri/subscriptions", "organizations_url": "https://api.github.com/users/sandipmgiri/orgs", "repos_url": "https://api.github.com/users/sandipmgiri/repos", "events_url": "https://api.github.com/users/sandipmgiri/events{/privacy}", "received_events_url": "https://api.github.com/users/sandipmgiri/received_events", "type": "User", "site_admin": false}, "created_at": "2017-06-22T13:06:54Z", "updated_at": "2017-06-22T13:11:34Z", "author_association": "CONTRIBUTOR", "body_html": "<p>I reran the above test cases on high end vm, but still same test failures were observed (Looks like failures related to TF v1.0.1 and ppc64le platform).</p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=7946809\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/gunan\">@gunan</a>, as you said \"It is possible there is a bug with the code on ppc64?\"<br>\nI have done some investigation around these test failures :</p>\n<ol>\n<li>\n<p>//tensorflow/compiler/tests:pooling_ops_test_cpu<br>\nThe test expects <strong>avg_pool</strong> o/p as [ 7. , 8. , 9. , 11.5, 12.5, 13.5] but gets [ 7. , 8. , 9. , 11.5, 9. , 13.5] (4th entry is different)</p>\n<p>The error looks like :</p>\n</li>\n</ol>\n<pre><code>  F.\n  ======================================================================\n  FAIL: testAvgPoolSamePadding (__main__.PoolingTest)\n  ----------------------------------------------------------------------\n  Traceback (most recent call last):\n  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/compiler/tests/pooling_ops_test.py\", line 288, in testAvgPoolSamePadding\n    expected=expected_output)\n  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/compiler/tests/pooling_ops_test.py\", line 125, in _VerifyValues\n    data_format, expected)\n  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/compiler/tests/pooling_ops_test.py\", line 108, in _VerifyOneTest\n    self.assertAllClose(expected, actual.flatten(), rtol=1e-5, atol=1e-6)\n  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 485, in assertAllClose\n    np.testing.assert_allclose(a, b, rtol=rtol, atol=atol)\n  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 1411, in assert_allclose\n    verbose=verbose, header=header, equal_nan=equal_nan)\n  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 796, in assert_array_compare\n    raise AssertionError(msg)\n\n    AssertionError:\n    Not equal to tolerance rtol=1e-05, atol=1e-06\n    (mismatch 16.6666666667%)\n    x: array([ 7. , 8. , 9. , 11.5, 12.5, 13.5])\n    y: array([ 7. , 8. , 9. , 11.5, 9. , 13.5], dtype=float32)\n    ----------------------------------------------------------------------\n   Ran 2 tests in 0.368s\n\n   FAILED (failures=1)\n   not close where =  (array([4]),)\n   not close lhs =  [ 12.5]\n   not close rhs =  [ 9.]\n   not close dif =  [ 3.5]\n   not close tol =  [  9.10000017e-05]\n   dtype = float64, shape = (6,)\n\n</code></pre>\n<ol start=\"2\">\n<li>\n<p>//tensorflow/python/kernel_tests:summary_image_op_test</p>\n<p>This test is failing due to <strong>summary.image</strong> function returning incorrect value (0 vs expected 1)</p>\n<p>The error looks like :</p>\n</li>\n</ol>\n<pre><code>     F..\n     ======================================================================\n     FAIL: testImageSummary (__main__.SummaryImageOpTest)\n     ----------------------------------------------------------------------\n     Traceback (most recent call last):\n       File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/kernel_tests/summary_image_op_test.runfiles/org_tensorflow/tensorflow/python/kernel_tests/summary_image_op_test.py\", line 83, in testImageSummary\n         self.assertAllClose(image, adjusted[0])\n       File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/kernel_tests/summary_image_op_test.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 485, in assertAllClose\n         np.testing.assert_allclose(a, b, rtol=rtol, atol=atol)\n       File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 1411, in assert_allclose\n         verbose=verbose, header=header, equal_nan=equal_nan)\n       File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 796, in assert_array_compare\n         raise AssertionError(msg)\n\n         AssertionError:\n         Not equal to tolerance rtol=1e-06, atol=1e-06\n\n        (mismatch 2.85714285714%)\n\n     Expected                            Actual\n\n       ([[[[ ....                                  ([[[[ ....\n\n        [[ 136.],                                [[ 136.], \n         [ 106.],                                [ 106.],\n         [ 240.],                                [ 240.],\n         [ 125.],                                [ 125.],                              \n         [  47.],                                [  47.],\n         [ 105.],                                [ 105.],\n         [   1.]],                               [   0.]],\n\n        .....]]]                                      .....]]]\n         ----------------------------------------------------------------------\n         Ran 3 tests in 0.113s\n\n        FAILED (failures=1)\n        not close where =  (array([3]), array([6]), array([0]))\n        not close lhs =  [0]\n        not close rhs =  [ 1.]\n        not close dif =  [ 1.]\n        not close tol =  [  1.99999999e-06]\n        dtype = uint8, shape = (5, 7, 1)\n\n</code></pre>\n<ol start=\"3\">\n<li>\n<p>//tensorflow/python/kernel_tests:linalg_grad_test</p>\n<p>This test is failing due to  <strong>compute_gradient</strong>  function returning incorrect value (-0.27654076 vs expected -0.09766237)</p>\n<p>The error looks like :</p>\n</li>\n</ol>\n<pre><code>         ..F.........\n\t  ======================================================================\n\t  FAIL: test_MatrixSolveLsGradient_float32_10_10_1e-06 (__main__.MatrixBinaryFunctorGradientTest)\n\t  ----------------------------------------------------------------------\n\t  Traceback (most recent call last):\n\t  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/kernel_tests/linalg_grad_test.runfiles/org_tensorflow/tensorflow/python/kernel_tests/linalg_grad_test.py\", line 129, in Test\n    \t    self.assertAllClose(theoretical, numerical, atol=tol, rtol=tol)\n\t  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/kernel_tests/linalg_grad_test.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 485, in assertAllClose\n\t    np.testing.assert_allclose(a, b, rtol=rtol, atol=atol)\n\t  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 1411, in assert_allclose\n    \t    verbose=verbose, header=header, equal_nan=equal_nan)\n\t  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 796, in assert_array_compare\n\t    raise AssertionError(msg)\n  \n          AssertionError:\n\t  Not equal to tolerance rtol=0.16, atol=0.16\n\n\t  (mismatch 0.01%)\n\t   x: array([[-0.27454 ,  0.232044,  0.238228, ..., -0.034112, -0.373461, 0.033982],\n                         [-0.781968,  3.879236, -0.101676, ..., -2.040482, -3.555872,...\n \t   y: array([[-0.27545 ,  0.234431,  0.2381  , ..., -0.040039, -0.382814, 0.036853],\n          \t         [-0.782201,  3.879493, -0.102113, ..., -2.039877, -3.555654,...\n            ----------------------------------------------------------------------\n           Ran 12 tests in 1.460s\n\n          FAILED (failures=1)\n          not close where =  (array([40]), array([33]))\n          not close lhs =  [-0.27654076]\n          not close rhs =  [-0.09766237]\n          not close dif =  [ 0.1788784]\n          not close tol =  [ 0.17562598]\n          dtype = float32, shape = (100, 100)\n</code></pre>\n<ol start=\"4\">\n<li>\n<p>//tensorflow/contrib/image:image_ops_test</p>\n<p>This test is failing due to <strong>rotate</strong> function returning incorrect value (32 vs expected 33)<br>\nError looks like :</p>\n</li>\n</ol>\n<pre><code>        ======================================================================\n\tFAIL: test_rotate_even (__main__.ImageOpsTestGpu)\n\t----------------------------------------------------------------------\n\tTraceback (most recent call last):\n\t  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/contrib/image/image_ops_test.runfiles/org_tensorflow/tensorflow/contrib/image/python/kernel_tests/image_ops_test.py\", line 75, in test_rotate_even\n\t    [1, 7, 13, 19, 25, 31], [0, 6, 12, 18, 24, 30]]])\n\t  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/contrib/image/image_ops_test.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 535, in assertAllEqual\n\t    np.testing.assert_array_equal(a, b)\n\t  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 871, in assert_array_equal\n\t    verbose=verbose, header='Arrays are not equal')\n\t  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 796, in assert_array_compare\n\t    raise AssertionError(msg)\n\n\tAssertionError:\n\tArrays are not equal\n\t(mismatch 1.85185185185%)\n\n\n\tExpected =                                                                  Actual = \n\n\t[[[0,  1,  2,  3,  4,  5],                                             [[[ 0  1  2  3  4  5]  \n\t  [6,  7,  8,  9,  10, 11],                                             [ 6  7  8  9 10 11]\n\t  [12, 13, 14, 15, 16, 17],                                             [12 13 14 15 16 17]\n\t  [18, 19, 20, 21, 22, 23],                                             [18 19 20 21 22 23]\n\t  [24, 25, 26, 27, 28, 29],                                             [24 25 26 27 28 29] \n\t  [30, 31, 32, 33, 34, 35]],                                            [30 31 32 33 34 35]]\n\t [[0,  3,  4,  11, 17, 0],                                              [[ 0  3  4 11 17  0]\n\t  [2,  3,  9,  16, 23, 23],                                             [ 2  3  9 16 23 23]\n\t  [1,  8,  15, 21, 22, 29],                                             [ 1  8 15 21 22 29]\n\t  [6,  13, 20, 21, 27, 34],                                             [  6 13 20 20 27 34]   \n\t [12, 18, 19, 26, \"33\", 33],                                            [12 18 19 26 \"32\" 33]\n\t  [0,  18, 24, 31, 32, 0]],                                             [ 0 18 24 31 32  0]]         \n\t [[5,  11, 17, 23, 29, 35],                                             [[ 5 11 17 23 29 35] \n\t  [4,  10, 16, 22, 28, 34],                                             [ 4 10 16 22 28 34]\n\t  [3,  9,  15, 21, 27, 33],                                             [ 3  9 15 21 27 33]\n\t  [2,  8,  14, 20, 26, 32],                                             [ 2  8 14 20 26 32]\n\t  [1,  7,  13, 19, 25, 31],                                             [ 1  7 13 19 25 31]\n\t  [0,  6,  12, 18, 24, 30]]])                                           [ 0  6 12 18 24 30]]]\n          ----------------------------------------------------------------------\n         Ran 8 tests in 31.264s\n\n        FAILED (failures=2)\n       not equal where =  (array([1, 1]), array([3, 4]), array([3, 4]))\n       not equal lhs =  [20 32]\n       not equal rhs =  [21 33]\n       not equal where =  (array([1, 1]), array([3, 4]), array([3, 4]))\n       not equal lhs =  [20 32]\n       not equal rhs =  [21 33]\n\n</code></pre>\n<p>In above tests checking 2 arrays are equal or not (expected and actual) each array has 100+ entries, out of which only one entry mismatching and test fails.<br>\nHere very difficult to pinpoint the issue on power platform as all entries matching except one. For now I think better solution would be just change the tolerance as required by adding power specific condition (like I mentioned in previous comment). Please provide your view on this.Thanks!</p>", "body_text": "I reran the above test cases on high end vm, but still same test failures were observed (Looks like failures related to TF v1.0.1 and ppc64le platform).\n@gunan, as you said \"It is possible there is a bug with the code on ppc64?\"\nI have done some investigation around these test failures :\n\n\n//tensorflow/compiler/tests:pooling_ops_test_cpu\nThe test expects avg_pool o/p as [ 7. , 8. , 9. , 11.5, 12.5, 13.5] but gets [ 7. , 8. , 9. , 11.5, 9. , 13.5] (4th entry is different)\nThe error looks like :\n\n\n  F.\n  ======================================================================\n  FAIL: testAvgPoolSamePadding (__main__.PoolingTest)\n  ----------------------------------------------------------------------\n  Traceback (most recent call last):\n  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/compiler/tests/pooling_ops_test.py\", line 288, in testAvgPoolSamePadding\n    expected=expected_output)\n  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/compiler/tests/pooling_ops_test.py\", line 125, in _VerifyValues\n    data_format, expected)\n  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/compiler/tests/pooling_ops_test.py\", line 108, in _VerifyOneTest\n    self.assertAllClose(expected, actual.flatten(), rtol=1e-5, atol=1e-6)\n  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 485, in assertAllClose\n    np.testing.assert_allclose(a, b, rtol=rtol, atol=atol)\n  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 1411, in assert_allclose\n    verbose=verbose, header=header, equal_nan=equal_nan)\n  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 796, in assert_array_compare\n    raise AssertionError(msg)\n\n    AssertionError:\n    Not equal to tolerance rtol=1e-05, atol=1e-06\n    (mismatch 16.6666666667%)\n    x: array([ 7. , 8. , 9. , 11.5, 12.5, 13.5])\n    y: array([ 7. , 8. , 9. , 11.5, 9. , 13.5], dtype=float32)\n    ----------------------------------------------------------------------\n   Ran 2 tests in 0.368s\n\n   FAILED (failures=1)\n   not close where =  (array([4]),)\n   not close lhs =  [ 12.5]\n   not close rhs =  [ 9.]\n   not close dif =  [ 3.5]\n   not close tol =  [  9.10000017e-05]\n   dtype = float64, shape = (6,)\n\n\n\n\n//tensorflow/python/kernel_tests:summary_image_op_test\nThis test is failing due to summary.image function returning incorrect value (0 vs expected 1)\nThe error looks like :\n\n\n     F..\n     ======================================================================\n     FAIL: testImageSummary (__main__.SummaryImageOpTest)\n     ----------------------------------------------------------------------\n     Traceback (most recent call last):\n       File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/kernel_tests/summary_image_op_test.runfiles/org_tensorflow/tensorflow/python/kernel_tests/summary_image_op_test.py\", line 83, in testImageSummary\n         self.assertAllClose(image, adjusted[0])\n       File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/kernel_tests/summary_image_op_test.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 485, in assertAllClose\n         np.testing.assert_allclose(a, b, rtol=rtol, atol=atol)\n       File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 1411, in assert_allclose\n         verbose=verbose, header=header, equal_nan=equal_nan)\n       File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 796, in assert_array_compare\n         raise AssertionError(msg)\n\n         AssertionError:\n         Not equal to tolerance rtol=1e-06, atol=1e-06\n\n        (mismatch 2.85714285714%)\n\n     Expected                            Actual\n\n       ([[[[ ....                                  ([[[[ ....\n\n        [[ 136.],                                [[ 136.], \n         [ 106.],                                [ 106.],\n         [ 240.],                                [ 240.],\n         [ 125.],                                [ 125.],                              \n         [  47.],                                [  47.],\n         [ 105.],                                [ 105.],\n         [   1.]],                               [   0.]],\n\n        .....]]]                                      .....]]]\n         ----------------------------------------------------------------------\n         Ran 3 tests in 0.113s\n\n        FAILED (failures=1)\n        not close where =  (array([3]), array([6]), array([0]))\n        not close lhs =  [0]\n        not close rhs =  [ 1.]\n        not close dif =  [ 1.]\n        not close tol =  [  1.99999999e-06]\n        dtype = uint8, shape = (5, 7, 1)\n\n\n\n\n//tensorflow/python/kernel_tests:linalg_grad_test\nThis test is failing due to  compute_gradient  function returning incorrect value (-0.27654076 vs expected -0.09766237)\nThe error looks like :\n\n\n         ..F.........\n\t  ======================================================================\n\t  FAIL: test_MatrixSolveLsGradient_float32_10_10_1e-06 (__main__.MatrixBinaryFunctorGradientTest)\n\t  ----------------------------------------------------------------------\n\t  Traceback (most recent call last):\n\t  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/kernel_tests/linalg_grad_test.runfiles/org_tensorflow/tensorflow/python/kernel_tests/linalg_grad_test.py\", line 129, in Test\n    \t    self.assertAllClose(theoretical, numerical, atol=tol, rtol=tol)\n\t  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/kernel_tests/linalg_grad_test.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 485, in assertAllClose\n\t    np.testing.assert_allclose(a, b, rtol=rtol, atol=atol)\n\t  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 1411, in assert_allclose\n    \t    verbose=verbose, header=header, equal_nan=equal_nan)\n\t  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 796, in assert_array_compare\n\t    raise AssertionError(msg)\n  \n          AssertionError:\n\t  Not equal to tolerance rtol=0.16, atol=0.16\n\n\t  (mismatch 0.01%)\n\t   x: array([[-0.27454 ,  0.232044,  0.238228, ..., -0.034112, -0.373461, 0.033982],\n                         [-0.781968,  3.879236, -0.101676, ..., -2.040482, -3.555872,...\n \t   y: array([[-0.27545 ,  0.234431,  0.2381  , ..., -0.040039, -0.382814, 0.036853],\n          \t         [-0.782201,  3.879493, -0.102113, ..., -2.039877, -3.555654,...\n            ----------------------------------------------------------------------\n           Ran 12 tests in 1.460s\n\n          FAILED (failures=1)\n          not close where =  (array([40]), array([33]))\n          not close lhs =  [-0.27654076]\n          not close rhs =  [-0.09766237]\n          not close dif =  [ 0.1788784]\n          not close tol =  [ 0.17562598]\n          dtype = float32, shape = (100, 100)\n\n\n\n//tensorflow/contrib/image:image_ops_test\nThis test is failing due to rotate function returning incorrect value (32 vs expected 33)\nError looks like :\n\n\n        ======================================================================\n\tFAIL: test_rotate_even (__main__.ImageOpsTestGpu)\n\t----------------------------------------------------------------------\n\tTraceback (most recent call last):\n\t  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/contrib/image/image_ops_test.runfiles/org_tensorflow/tensorflow/contrib/image/python/kernel_tests/image_ops_test.py\", line 75, in test_rotate_even\n\t    [1, 7, 13, 19, 25, 31], [0, 6, 12, 18, 24, 30]]])\n\t  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/contrib/image/image_ops_test.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 535, in assertAllEqual\n\t    np.testing.assert_array_equal(a, b)\n\t  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 871, in assert_array_equal\n\t    verbose=verbose, header='Arrays are not equal')\n\t  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 796, in assert_array_compare\n\t    raise AssertionError(msg)\n\n\tAssertionError:\n\tArrays are not equal\n\t(mismatch 1.85185185185%)\n\n\n\tExpected =                                                                  Actual = \n\n\t[[[0,  1,  2,  3,  4,  5],                                             [[[ 0  1  2  3  4  5]  \n\t  [6,  7,  8,  9,  10, 11],                                             [ 6  7  8  9 10 11]\n\t  [12, 13, 14, 15, 16, 17],                                             [12 13 14 15 16 17]\n\t  [18, 19, 20, 21, 22, 23],                                             [18 19 20 21 22 23]\n\t  [24, 25, 26, 27, 28, 29],                                             [24 25 26 27 28 29] \n\t  [30, 31, 32, 33, 34, 35]],                                            [30 31 32 33 34 35]]\n\t [[0,  3,  4,  11, 17, 0],                                              [[ 0  3  4 11 17  0]\n\t  [2,  3,  9,  16, 23, 23],                                             [ 2  3  9 16 23 23]\n\t  [1,  8,  15, 21, 22, 29],                                             [ 1  8 15 21 22 29]\n\t  [6,  13, 20, 21, 27, 34],                                             [  6 13 20 20 27 34]   \n\t [12, 18, 19, 26, \"33\", 33],                                            [12 18 19 26 \"32\" 33]\n\t  [0,  18, 24, 31, 32, 0]],                                             [ 0 18 24 31 32  0]]         \n\t [[5,  11, 17, 23, 29, 35],                                             [[ 5 11 17 23 29 35] \n\t  [4,  10, 16, 22, 28, 34],                                             [ 4 10 16 22 28 34]\n\t  [3,  9,  15, 21, 27, 33],                                             [ 3  9 15 21 27 33]\n\t  [2,  8,  14, 20, 26, 32],                                             [ 2  8 14 20 26 32]\n\t  [1,  7,  13, 19, 25, 31],                                             [ 1  7 13 19 25 31]\n\t  [0,  6,  12, 18, 24, 30]]])                                           [ 0  6 12 18 24 30]]]\n          ----------------------------------------------------------------------\n         Ran 8 tests in 31.264s\n\n        FAILED (failures=2)\n       not equal where =  (array([1, 1]), array([3, 4]), array([3, 4]))\n       not equal lhs =  [20 32]\n       not equal rhs =  [21 33]\n       not equal where =  (array([1, 1]), array([3, 4]), array([3, 4]))\n       not equal lhs =  [20 32]\n       not equal rhs =  [21 33]\n\n\nIn above tests checking 2 arrays are equal or not (expected and actual) each array has 100+ entries, out of which only one entry mismatching and test fails.\nHere very difficult to pinpoint the issue on power platform as all entries matching except one. For now I think better solution would be just change the tolerance as required by adding power specific condition (like I mentioned in previous comment). Please provide your view on this.Thanks!", "body": "I reran the above test cases on high end vm, but still same test failures were observed (Looks like failures related to TF v1.0.1 and ppc64le platform).\r\n\r\n@gunan, as you said \"It is possible there is a bug with the code on ppc64?\"\r\nI have done some investigation around these test failures :  \r\n\r\n1. //tensorflow/compiler/tests:pooling_ops_test_cpu\r\n     The test expects **avg_pool** o/p as [ 7. , 8. , 9. , 11.5, 12.5, 13.5] but gets [ 7. , 8. , 9. , 11.5, 9. , 13.5] (4th entry is different)\r\n\r\n     The error looks like :\r\n```\r\n  F.\r\n  ======================================================================\r\n  FAIL: testAvgPoolSamePadding (__main__.PoolingTest)\r\n  ----------------------------------------------------------------------\r\n  Traceback (most recent call last):\r\n  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/compiler/tests/pooling_ops_test.py\", line 288, in testAvgPoolSamePadding\r\n    expected=expected_output)\r\n  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/compiler/tests/pooling_ops_test.py\", line 125, in _VerifyValues\r\n    data_format, expected)\r\n  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/compiler/tests/pooling_ops_test.py\", line 108, in _VerifyOneTest\r\n    self.assertAllClose(expected, actual.flatten(), rtol=1e-5, atol=1e-6)\r\n  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/compiler/tests/pooling_ops_test_cpu.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 485, in assertAllClose\r\n    np.testing.assert_allclose(a, b, rtol=rtol, atol=atol)\r\n  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 1411, in assert_allclose\r\n    verbose=verbose, header=header, equal_nan=equal_nan)\r\n  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 796, in assert_array_compare\r\n    raise AssertionError(msg)\r\n\r\n    AssertionError:\r\n    Not equal to tolerance rtol=1e-05, atol=1e-06\r\n    (mismatch 16.6666666667%)\r\n    x: array([ 7. , 8. , 9. , 11.5, 12.5, 13.5])\r\n    y: array([ 7. , 8. , 9. , 11.5, 9. , 13.5], dtype=float32)\r\n    ----------------------------------------------------------------------\r\n   Ran 2 tests in 0.368s\r\n\r\n   FAILED (failures=1)\r\n   not close where =  (array([4]),)\r\n   not close lhs =  [ 12.5]\r\n   not close rhs =  [ 9.]\r\n   not close dif =  [ 3.5]\r\n   not close tol =  [  9.10000017e-05]\r\n   dtype = float64, shape = (6,)\r\n\r\n```\r\n\r\n2. //tensorflow/python/kernel_tests:summary_image_op_test\r\n\r\n     This test is failing due to **summary.image** function returning incorrect value (0 vs expected 1) \r\n\r\n     The error looks like :\r\n  \r\n```\r\n     F..\r\n     ======================================================================\r\n     FAIL: testImageSummary (__main__.SummaryImageOpTest)\r\n     ----------------------------------------------------------------------\r\n     Traceback (most recent call last):\r\n       File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/kernel_tests/summary_image_op_test.runfiles/org_tensorflow/tensorflow/python/kernel_tests/summary_image_op_test.py\", line 83, in testImageSummary\r\n         self.assertAllClose(image, adjusted[0])\r\n       File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/kernel_tests/summary_image_op_test.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 485, in assertAllClose\r\n         np.testing.assert_allclose(a, b, rtol=rtol, atol=atol)\r\n       File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 1411, in assert_allclose\r\n         verbose=verbose, header=header, equal_nan=equal_nan)\r\n       File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 796, in assert_array_compare\r\n         raise AssertionError(msg)\r\n\r\n         AssertionError:\r\n         Not equal to tolerance rtol=1e-06, atol=1e-06\r\n\r\n        (mismatch 2.85714285714%)\r\n\r\n     Expected                            Actual\r\n\r\n       ([[[[ ....                                  ([[[[ ....\r\n\r\n        [[ 136.],                                [[ 136.], \r\n         [ 106.],                                [ 106.],\r\n         [ 240.],                                [ 240.],\r\n         [ 125.],                                [ 125.],                              \r\n         [  47.],                                [  47.],\r\n         [ 105.],                                [ 105.],\r\n         [   1.]],                               [   0.]],\r\n\r\n        .....]]]                                      .....]]]\r\n         ----------------------------------------------------------------------\r\n         Ran 3 tests in 0.113s\r\n\r\n        FAILED (failures=1)\r\n        not close where =  (array([3]), array([6]), array([0]))\r\n        not close lhs =  [0]\r\n        not close rhs =  [ 1.]\r\n        not close dif =  [ 1.]\r\n        not close tol =  [  1.99999999e-06]\r\n        dtype = uint8, shape = (5, 7, 1)\r\n\r\n```\r\n\r\n3. //tensorflow/python/kernel_tests:linalg_grad_test\r\n  \r\n\tThis test is failing due to  **compute_gradient**  function returning incorrect value (-0.27654076 vs expected -0.09766237) \r\n\r\n\r\n\t The error looks like :\r\n```\r\n         ..F.........\r\n\t  ======================================================================\r\n\t  FAIL: test_MatrixSolveLsGradient_float32_10_10_1e-06 (__main__.MatrixBinaryFunctorGradientTest)\r\n\t  ----------------------------------------------------------------------\r\n\t  Traceback (most recent call last):\r\n\t  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/kernel_tests/linalg_grad_test.runfiles/org_tensorflow/tensorflow/python/kernel_tests/linalg_grad_test.py\", line 129, in Test\r\n    \t    self.assertAllClose(theoretical, numerical, atol=tol, rtol=tol)\r\n\t  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/python/kernel_tests/linalg_grad_test.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 485, in assertAllClose\r\n\t    np.testing.assert_allclose(a, b, rtol=rtol, atol=atol)\r\n\t  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 1411, in assert_allclose\r\n    \t    verbose=verbose, header=header, equal_nan=equal_nan)\r\n\t  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 796, in assert_array_compare\r\n\t    raise AssertionError(msg)\r\n  \r\n          AssertionError:\r\n\t  Not equal to tolerance rtol=0.16, atol=0.16\r\n\r\n\t  (mismatch 0.01%)\r\n\t   x: array([[-0.27454 ,  0.232044,  0.238228, ..., -0.034112, -0.373461, 0.033982],\r\n                         [-0.781968,  3.879236, -0.101676, ..., -2.040482, -3.555872,...\r\n \t   y: array([[-0.27545 ,  0.234431,  0.2381  , ..., -0.040039, -0.382814, 0.036853],\r\n          \t         [-0.782201,  3.879493, -0.102113, ..., -2.039877, -3.555654,...\r\n            ----------------------------------------------------------------------\r\n           Ran 12 tests in 1.460s\r\n\r\n          FAILED (failures=1)\r\n          not close where =  (array([40]), array([33]))\r\n          not close lhs =  [-0.27654076]\r\n          not close rhs =  [-0.09766237]\r\n          not close dif =  [ 0.1788784]\r\n          not close tol =  [ 0.17562598]\r\n          dtype = float32, shape = (100, 100)\r\n```\r\n\r\n4. //tensorflow/contrib/image:image_ops_test\r\n\r\n\tThis test is failing due to **rotate** function returning incorrect value (32 vs expected 33)\r\n\tError looks like :\r\n```\r\n        ======================================================================\r\n\tFAIL: test_rotate_even (__main__.ImageOpsTestGpu)\r\n\t----------------------------------------------------------------------\r\n\tTraceback (most recent call last):\r\n\t  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/contrib/image/image_ops_test.runfiles/org_tensorflow/tensorflow/contrib/image/python/kernel_tests/image_ops_test.py\", line 75, in test_rotate_even\r\n\t    [1, 7, 13, 19, 25, 31], [0, 6, 12, 18, 24, 30]]])\r\n\t  File \"/root/.cache/bazel/_bazel_root/68a62076e91007a7908bc42a32e4cff9/execroot/tensorflow/bazel-out/local-opt/bin/tensorflow/contrib/image/image_ops_test.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 535, in assertAllEqual\r\n\t    np.testing.assert_array_equal(a, b)\r\n\t  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 871, in assert_array_equal\r\n\t    verbose=verbose, header='Arrays are not equal')\r\n\t  File \"/usr/lib64/python2.7/site-packages/numpy/testing/utils.py\", line 796, in assert_array_compare\r\n\t    raise AssertionError(msg)\r\n\r\n\tAssertionError:\r\n\tArrays are not equal\r\n\t(mismatch 1.85185185185%)\r\n\r\n\r\n\tExpected =                                                                  Actual = \r\n\r\n\t[[[0,  1,  2,  3,  4,  5],                                             [[[ 0  1  2  3  4  5]  \r\n\t  [6,  7,  8,  9,  10, 11],                                             [ 6  7  8  9 10 11]\r\n\t  [12, 13, 14, 15, 16, 17],                                             [12 13 14 15 16 17]\r\n\t  [18, 19, 20, 21, 22, 23],                                             [18 19 20 21 22 23]\r\n\t  [24, 25, 26, 27, 28, 29],                                             [24 25 26 27 28 29] \r\n\t  [30, 31, 32, 33, 34, 35]],                                            [30 31 32 33 34 35]]\r\n\t [[0,  3,  4,  11, 17, 0],                                              [[ 0  3  4 11 17  0]\r\n\t  [2,  3,  9,  16, 23, 23],                                             [ 2  3  9 16 23 23]\r\n\t  [1,  8,  15, 21, 22, 29],                                             [ 1  8 15 21 22 29]\r\n\t  [6,  13, 20, 21, 27, 34],                                             [  6 13 20 20 27 34]   \r\n\t [12, 18, 19, 26, \"33\", 33],                                            [12 18 19 26 \"32\" 33]\r\n\t  [0,  18, 24, 31, 32, 0]],                                             [ 0 18 24 31 32  0]]         \r\n\t [[5,  11, 17, 23, 29, 35],                                             [[ 5 11 17 23 29 35] \r\n\t  [4,  10, 16, 22, 28, 34],                                             [ 4 10 16 22 28 34]\r\n\t  [3,  9,  15, 21, 27, 33],                                             [ 3  9 15 21 27 33]\r\n\t  [2,  8,  14, 20, 26, 32],                                             [ 2  8 14 20 26 32]\r\n\t  [1,  7,  13, 19, 25, 31],                                             [ 1  7 13 19 25 31]\r\n\t  [0,  6,  12, 18, 24, 30]]])                                           [ 0  6 12 18 24 30]]]\r\n          ----------------------------------------------------------------------\r\n         Ran 8 tests in 31.264s\r\n\r\n        FAILED (failures=2)\r\n       not equal where =  (array([1, 1]), array([3, 4]), array([3, 4]))\r\n       not equal lhs =  [20 32]\r\n       not equal rhs =  [21 33]\r\n       not equal where =  (array([1, 1]), array([3, 4]), array([3, 4]))\r\n       not equal lhs =  [20 32]\r\n       not equal rhs =  [21 33]\r\n\r\n```\r\n\r\nIn above tests checking 2 arrays are equal or not (expected and actual) each array has 100+ entries, out of which only one entry mismatching and test fails.\r\nHere very difficult to pinpoint the issue on power platform as all entries matching except one. For now I think better solution would be just change the tolerance as required by adding power specific condition (like I mentioned in previous comment). Please provide your view on this.Thanks!\r\n\r\n"}