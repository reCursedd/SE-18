{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/307064569", "html_url": "https://github.com/tensorflow/tensorflow/issues/8945#issuecomment-307064569", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8945", "id": 307064569, "node_id": "MDEyOklzc3VlQ29tbWVudDMwNzA2NDU2OQ==", "user": {"login": "sandipmgiri", "id": 16284232, "node_id": "MDQ6VXNlcjE2Mjg0MjMy", "avatar_url": "https://avatars0.githubusercontent.com/u/16284232?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sandipmgiri", "html_url": "https://github.com/sandipmgiri", "followers_url": "https://api.github.com/users/sandipmgiri/followers", "following_url": "https://api.github.com/users/sandipmgiri/following{/other_user}", "gists_url": "https://api.github.com/users/sandipmgiri/gists{/gist_id}", "starred_url": "https://api.github.com/users/sandipmgiri/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sandipmgiri/subscriptions", "organizations_url": "https://api.github.com/users/sandipmgiri/orgs", "repos_url": "https://api.github.com/users/sandipmgiri/repos", "events_url": "https://api.github.com/users/sandipmgiri/events{/privacy}", "received_events_url": "https://api.github.com/users/sandipmgiri/received_events", "type": "User", "site_admin": false}, "created_at": "2017-06-08T10:29:28Z", "updated_at": "2017-06-08T10:59:18Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Hi <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=7946809\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/gunan\">@gunan</a>,  as you said \"need tolerance bounds to be loosened a little and test will pass\"</p>\n<p>For me 4 tests are passing after adjusting the tolerance and the details are as follows :</p>\n<ol>\n<li>\n<p><code>//tensorflow/compiler/tests:pooling_ops_test_cpu </code><br>\nNeed to change tolerance from <code>rtol=1e-05</code> to <code>rtol=1</code></p>\n</li>\n<li>\n<p><code>//tensorflow/python/kernel_tests:summary_image_op_test  </code><br>\nNeed to change tolerance from <code>rtol=1e-06</code> to <code>rtol=1</code></p>\n</li>\n<li>\n<p><code>//tensorflow/python/kernel_tests:linalg_grad_test   </code><br>\nTo pass this test need to add <code>0.01</code> in <code>rtol</code> i.e <code>rtol=tol+0.01</code> (initially <code>rtol=0.16</code> and now <code>0.17</code>)</p>\n</li>\n<li>\n<p><code>//tensorflow/contrib/image:image_ops_test</code><br>\nHere we need to change comparison function for <code>ppc64le</code> i.e. from <code>assertAllEqual </code> to<code> assertAllClose</code><br>\n(as we can not pass tolerance argument to <code>assertAllEqual</code> function)<br>\nOnce changed the comparison function pass<code>rtol = 1e-1</code>and test will execute successfully</p>\n</li>\n</ol>\n<p>Above tests are passed successfully on <code>X86</code> without changing the tolerance . But to pass these tests on <code>ppc64le</code> we need to adjust the tolerance (like we mentioned above).</p>\n<p>So as per my point of view - to implement above changes, we should add the power specific condition for these tests :<br>\ne.g. For test <code> //tensorflow/python/kernel_tests:linalg_grad_test</code> need following action :<br>\n<a href=\"https://github.com/tensorflow/tensorflow/blob/v1.0.1/tensorflow/python/kernel_tests/linalg_grad_test.py#L129\">https://github.com/tensorflow/tensorflow/blob/v1.0.1/tensorflow/python/kernel_tests/linalg_grad_test.py#L129</a></p>\n<p><code>self.assertAllClose(theoretical, numerical, atol=tol, rtol=tol)</code></p>\n<p>It could be changed to :</p>\n<pre><code>if platform.machine() == \"ppc64le\":\n     self.assertAllClose(theoretical, numerical, atol=tol+0.01, rtol=tol)\nelse \n    self.assertAllClose(theoretical, numerical, atol=tol, rtol=tol)\n</code></pre>\n<p>Please provide your comments/suggestions on this.Thanks!</p>", "body_text": "Hi @gunan,  as you said \"need tolerance bounds to be loosened a little and test will pass\"\nFor me 4 tests are passing after adjusting the tolerance and the details are as follows :\n\n\n//tensorflow/compiler/tests:pooling_ops_test_cpu \nNeed to change tolerance from rtol=1e-05 to rtol=1\n\n\n//tensorflow/python/kernel_tests:summary_image_op_test  \nNeed to change tolerance from rtol=1e-06 to rtol=1\n\n\n//tensorflow/python/kernel_tests:linalg_grad_test   \nTo pass this test need to add 0.01 in rtol i.e rtol=tol+0.01 (initially rtol=0.16 and now 0.17)\n\n\n//tensorflow/contrib/image:image_ops_test\nHere we need to change comparison function for ppc64le i.e. from assertAllEqual  to assertAllClose\n(as we can not pass tolerance argument to assertAllEqual function)\nOnce changed the comparison function passrtol = 1e-1and test will execute successfully\n\n\nAbove tests are passed successfully on X86 without changing the tolerance . But to pass these tests on ppc64le we need to adjust the tolerance (like we mentioned above).\nSo as per my point of view - to implement above changes, we should add the power specific condition for these tests :\ne.g. For test  //tensorflow/python/kernel_tests:linalg_grad_test need following action :\nhttps://github.com/tensorflow/tensorflow/blob/v1.0.1/tensorflow/python/kernel_tests/linalg_grad_test.py#L129\nself.assertAllClose(theoretical, numerical, atol=tol, rtol=tol)\nIt could be changed to :\nif platform.machine() == \"ppc64le\":\n     self.assertAllClose(theoretical, numerical, atol=tol+0.01, rtol=tol)\nelse \n    self.assertAllClose(theoretical, numerical, atol=tol, rtol=tol)\n\nPlease provide your comments/suggestions on this.Thanks!", "body": "Hi @gunan,  as you said \"need tolerance bounds to be loosened a little and test will pass\" \r\n\r\nFor me 4 tests are passing after adjusting the tolerance and the details are as follows :\r\n\r\n1.  `//tensorflow/compiler/tests:pooling_ops_test_cpu `\r\n    Need to change tolerance from `rtol=1e-05` to `rtol=1` \r\n\r\n2. ` //tensorflow/python/kernel_tests:summary_image_op_test   `    \r\n    Need to change tolerance from `rtol=1e-06` to `rtol=1` \r\n\r\n3.  `//tensorflow/python/kernel_tests:linalg_grad_test   `   \r\n    To pass this test need to add `0.01` in `rtol` i.e `rtol=tol+0.01` (initially `rtol=0.16` and now `0.17`)\r\n   \r\n4.  `//tensorflow/contrib/image:image_ops_test`           \r\n  Here we need to change comparison function for `ppc64le` i.e. from `assertAllEqual ` to` assertAllClose` \r\n  (as we can not pass tolerance argument to `assertAllEqual` function) \r\n  Once changed the comparison function pass` rtol = 1e-1 `and test will execute successfully\r\n\r\nAbove tests are passed successfully on `X86` without changing the tolerance . But to pass these tests on `ppc64le` we need to adjust the tolerance (like we mentioned above).\r\n\r\nSo as per my point of view - to implement above changes, we should add the power specific condition for these tests : \r\ne.g. For test ` //tensorflow/python/kernel_tests:linalg_grad_test` need following action : \r\nhttps://github.com/tensorflow/tensorflow/blob/v1.0.1/tensorflow/python/kernel_tests/linalg_grad_test.py#L129\r\n\r\n`self.assertAllClose(theoretical, numerical, atol=tol, rtol=tol)`\r\n\r\nIt could be changed to :\r\n\r\n```\r\nif platform.machine() == \"ppc64le\":\r\n     self.assertAllClose(theoretical, numerical, atol=tol+0.01, rtol=tol)\r\nelse \r\n    self.assertAllClose(theoretical, numerical, atol=tol, rtol=tol)\r\n```\r\n\r\nPlease provide your comments/suggestions on this.Thanks!"}