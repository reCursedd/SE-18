{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19568", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19568/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19568/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19568/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/19568", "id": 326717520, "node_id": "MDU6SXNzdWUzMjY3MTc1MjA=", "number": 19568, "title": "sess.run([train_step]) freezes when using batch_normalization and Collection Update", "user": {"login": "amirmazaheri1990", "id": 3743009, "node_id": "MDQ6VXNlcjM3NDMwMDk=", "avatar_url": "https://avatars1.githubusercontent.com/u/3743009?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amirmazaheri1990", "html_url": "https://github.com/amirmazaheri1990", "followers_url": "https://api.github.com/users/amirmazaheri1990/followers", "following_url": "https://api.github.com/users/amirmazaheri1990/following{/other_user}", "gists_url": "https://api.github.com/users/amirmazaheri1990/gists{/gist_id}", "starred_url": "https://api.github.com/users/amirmazaheri1990/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amirmazaheri1990/subscriptions", "organizations_url": "https://api.github.com/users/amirmazaheri1990/orgs", "repos_url": "https://api.github.com/users/amirmazaheri1990/repos", "events_url": "https://api.github.com/users/amirmazaheri1990/events{/privacy}", "received_events_url": "https://api.github.com/users/amirmazaheri1990/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": {"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 18, "created_at": "2018-05-26T07:24:03Z", "updated_at": "2018-11-11T18:39:42Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>Hi,</p>\n<p>I have faced a strange situation with Tensorflow. I explored a lot about this problem but just found one other thread (unsolved) on StackOverflow. (here: <a href=\"https://stackoverflow.com/questions/47047124/tf-layers-batch-normalization-freezes-during-sess-run-1-5-0-dev20171031\" rel=\"nofollow\">https://stackoverflow.com/questions/47047124/tf-layers-batch-normalization-freezes-during-sess-run-1-5-0-dev20171031</a>). So, I decided to ask it here.</p>\n<p>Basically, when I call sess.run(), it freezes. By freeze, I mean, the GPU utilization is zero, I get no errors and the process is on GPU (GPU memory is allocated).  I have the following code segment:</p>\n<pre><code>update_ops = tf.get_collection(tf.GraphKeys.UPDATE_OPS)\n  with tf.control_dependencies(update_ops):\n        train_step1 = optimizer1.minimize(loss = loss_fill +lossL2+ loss_detection,var_list=vars)\n</code></pre>\n<p>When I change this part to:</p>\n<pre><code>update_ops = tf.get_collection(tf.GraphKeys.UPDATE_OPS)\n     with tf.control_dependencies(update_ops):\n             pass\ntrain_step1 = optimizer1.minimize(loss = loss_fill +lossL2+ loss_detection,var_list=vars)\n</code></pre>\n<p>which basically ignores some necessary moving average updates, it doesn't freeze anymore. I have a lot of tf.layers.batch_normalization() instances in my code and this is the first time I am facing this issue.</p>\n<p>Thanks</p>", "body_text": "Hi,\nI have faced a strange situation with Tensorflow. I explored a lot about this problem but just found one other thread (unsolved) on StackOverflow. (here: https://stackoverflow.com/questions/47047124/tf-layers-batch-normalization-freezes-during-sess-run-1-5-0-dev20171031). So, I decided to ask it here.\nBasically, when I call sess.run(), it freezes. By freeze, I mean, the GPU utilization is zero, I get no errors and the process is on GPU (GPU memory is allocated).  I have the following code segment:\nupdate_ops = tf.get_collection(tf.GraphKeys.UPDATE_OPS)\n  with tf.control_dependencies(update_ops):\n        train_step1 = optimizer1.minimize(loss = loss_fill +lossL2+ loss_detection,var_list=vars)\n\nWhen I change this part to:\nupdate_ops = tf.get_collection(tf.GraphKeys.UPDATE_OPS)\n     with tf.control_dependencies(update_ops):\n             pass\ntrain_step1 = optimizer1.minimize(loss = loss_fill +lossL2+ loss_detection,var_list=vars)\n\nwhich basically ignores some necessary moving average updates, it doesn't freeze anymore. I have a lot of tf.layers.batch_normalization() instances in my code and this is the first time I am facing this issue.\nThanks", "body": "Hi,\r\n\r\nI have faced a strange situation with Tensorflow. I explored a lot about this problem but just found one other thread (unsolved) on StackOverflow. (here: https://stackoverflow.com/questions/47047124/tf-layers-batch-normalization-freezes-during-sess-run-1-5-0-dev20171031). So, I decided to ask it here.\r\n\r\nBasically, when I call sess.run(), it freezes. By freeze, I mean, the GPU utilization is zero, I get no errors and the process is on GPU (GPU memory is allocated).  I have the following code segment:\r\n```\r\nupdate_ops = tf.get_collection(tf.GraphKeys.UPDATE_OPS)\r\n  with tf.control_dependencies(update_ops):\r\n        train_step1 = optimizer1.minimize(loss = loss_fill +lossL2+ loss_detection,var_list=vars)\r\n```\r\n\r\nWhen I change this part to:\r\n```\r\nupdate_ops = tf.get_collection(tf.GraphKeys.UPDATE_OPS)\r\n     with tf.control_dependencies(update_ops):\r\n             pass\r\ntrain_step1 = optimizer1.minimize(loss = loss_fill +lossL2+ loss_detection,var_list=vars)\r\n```\r\n\r\nwhich basically ignores some necessary moving average updates, it doesn't freeze anymore. I have a lot of tf.layers.batch_normalization() instances in my code and this is the first time I am facing this issue.\r\n\r\nThanks\r\n\r\n"}