{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/224214267", "pull_request_review_id": 163527208, "id": 224214267, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNDIxNDI2Nw==", "diff_hunk": "@@ -1679,22 +1680,25 @@ def _swap_axis(logits, dim_index, last_index, name=None):\n \n   # If dim is not the last dimension, we have to do a transpose so that we can", "path": "tensorflow/python/ops/nn_ops.py", "position": 22, "original_position": 10, "commit_id": "fd9d2b0cb61b61ef8cf7e5b8459f20bfdfea127c", "original_commit_id": "980227aabdd20da19a8824d1f828e22fb8bf5c1e", "user": {"login": "hawkinsp", "id": 348932, "node_id": "MDQ6VXNlcjM0ODkzMg==", "avatar_url": "https://avatars0.githubusercontent.com/u/348932?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hawkinsp", "html_url": "https://github.com/hawkinsp", "followers_url": "https://api.github.com/users/hawkinsp/followers", "following_url": "https://api.github.com/users/hawkinsp/following{/other_user}", "gists_url": "https://api.github.com/users/hawkinsp/gists{/gist_id}", "starred_url": "https://api.github.com/users/hawkinsp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hawkinsp/subscriptions", "organizations_url": "https://api.github.com/users/hawkinsp/orgs", "repos_url": "https://api.github.com/users/hawkinsp/repos", "events_url": "https://api.github.com/users/hawkinsp/events{/privacy}", "received_events_url": "https://api.github.com/users/hawkinsp/received_events", "type": "User", "site_admin": false}, "body": "Thanks for the PR! But can't we do something even more direct here?\r\n\r\nThis code already assumes that shape.ndims is not None, and that dim is a Python integer. So I don't think we need to do this test as part of the graph \u2014\u00a0we can do it in Python instead, which is simpler and easier to understand. i.e., I think you can just write:\r\n\r\n```python\r\nif dim < -shape.ndims or dim >= shape.ndims:\r\n  raise ... etc.\r\n```\r\n\r\nThis would also give the caller a more usable backtrace from Python, rather than a somewhat more cryptic error when running the graph.", "created_at": "2018-10-10T19:38:27Z", "updated_at": "2018-10-13T17:20:54Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/22849#discussion_r224214267", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/22849", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/224214267"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/22849#discussion_r224214267"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/22849"}}, "body_html": "<p>Thanks for the PR! But can't we do something even more direct here?</p>\n<p>This code already assumes that shape.ndims is not None, and that dim is a Python integer. So I don't think we need to do this test as part of the graph \u2014\u00a0we can do it in Python instead, which is simpler and easier to understand. i.e., I think you can just write:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">if</span> dim <span class=\"pl-k\">&lt;</span> <span class=\"pl-k\">-</span>shape.ndims <span class=\"pl-k\">or</span> dim <span class=\"pl-k\">&gt;=</span> shape.ndims:\n  <span class=\"pl-k\">raise</span> <span class=\"pl-c1\">...</span> etc.</pre></div>\n<p>This would also give the caller a more usable backtrace from Python, rather than a somewhat more cryptic error when running the graph.</p>", "body_text": "Thanks for the PR! But can't we do something even more direct here?\nThis code already assumes that shape.ndims is not None, and that dim is a Python integer. So I don't think we need to do this test as part of the graph \u2014\u00a0we can do it in Python instead, which is simpler and easier to understand. i.e., I think you can just write:\nif dim < -shape.ndims or dim >= shape.ndims:\n  raise ... etc.\nThis would also give the caller a more usable backtrace from Python, rather than a somewhat more cryptic error when running the graph."}