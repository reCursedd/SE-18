{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/62931354", "pull_request_review_id": null, "id": 62931354, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyOTMxMzU0", "diff_hunk": "@@ -574,59 +574,16 @@ def _testDynamicEquivalentToStaticRNN(self, use_gpu, use_sequence_length):\n       sequence_length = None\n \n     ########### Step 1: Run static graph and generate readouts\n-    with self.test_session(use_gpu=use_gpu, graph=tf.Graph()) as sess:\n-      concat_inputs = tf.placeholder(tf.float32,\n-                                     shape=(time_steps, batch_size, input_size))\n-      inputs = tf.unpack(concat_inputs)\n-      initializer = tf.random_uniform_initializer(-0.01, 0.01, seed=self._seed)\n-\n-      cell = tf.nn.rnn_cell.LSTMCell(\n-          num_units, input_size, use_peepholes=True,\n-          initializer=initializer, num_proj=num_proj)\n-\n-      with tf.variable_scope(\"dynamic_scope\"):\n-        outputs_static, state_static = tf.nn.rnn(\n-            cell, inputs, sequence_length=sequence_length, dtype=tf.float32)\n-\n-      feeds = {concat_inputs: input_values}\n-\n-      # Initialize\n-      tf.initialize_all_variables().run(feed_dict=feeds)\n-\n-      # Generate gradients of sum of outputs w.r.t. inputs\n-      static_gradients = tf.gradients(\n-          outputs_static + [state_static], [concat_inputs])\n-\n-      # Generate gradients of individual outputs w.r.t. inputs\n-      static_individual_gradients = _flatten([\n-          tf.gradients(y, [concat_inputs])\n-          for y in [outputs_static[0],\n-                    outputs_static[-1],\n-                    state_static]])\n-\n-      # Generate gradients of individual variables w.r.t. inputs\n-      trainable_variables = tf.get_collection(tf.GraphKeys.TRAINABLE_VARIABLES)\n-      assert len(trainable_variables) > 1, (\n-          \"Count of trainable variables: %d\" % len(trainable_variables))\n-      # pylint: disable=bad-builtin\n-      static_individual_variable_gradients = _flatten([\n-          tf.gradients(y, trainable_variables)\n-          for y in [outputs_static[0],\n-                    outputs_static[-1],\n-                    state_static]])\n-\n-      # Test forward pass\n-      values_static = sess.run(outputs_static, feed_dict=feeds)\n-      (state_value_static,) = sess.run((state_static,), feed_dict=feeds)\n-\n-      # Test gradients to inputs and variables w.r.t. outputs & final state\n-      static_grad_values = sess.run(static_gradients, feed_dict=feeds)\n-\n-      static_individual_grad_values = sess.run(\n-          static_individual_gradients, feed_dict=feeds)\n+    initializer = tf.random_uniform_initializer(-0.01, 0.01, seed=self._seed)\n+    cell = tf.nn.rnn_cell.LSTMCell(\n+        num_units, input_size, use_peepholes=True,", "path": "tensorflow/python/kernel_tests/rnn_test.py", "position": 56, "original_position": 56, "commit_id": "258144b98730f99489437f6963737480be4f5a43", "original_commit_id": "fc40971bba82762fe413b5e7d6fe12a09722876b", "user": {"login": "wchan", "id": 1131892, "node_id": "MDQ6VXNlcjExMzE4OTI=", "avatar_url": "https://avatars1.githubusercontent.com/u/1131892?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wchan", "html_url": "https://github.com/wchan", "followers_url": "https://api.github.com/users/wchan/followers", "following_url": "https://api.github.com/users/wchan/following{/other_user}", "gists_url": "https://api.github.com/users/wchan/gists{/gist_id}", "starred_url": "https://api.github.com/users/wchan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wchan/subscriptions", "organizations_url": "https://api.github.com/users/wchan/orgs", "repos_url": "https://api.github.com/users/wchan/repos", "events_url": "https://api.github.com/users/wchan/events{/privacy}", "received_events_url": "https://api.github.com/users/wchan/received_events", "type": "User", "site_admin": false}, "body": "thats existing code. for tensorflow/python/kernel_tests/rnn_test.py\nhttps://github.com/tensorflow/tensorflow/pull/2002#discussion_r62930648 I\nonly refactored some of the benchmarking code so I can leverage it in my\ncontrib/../rnn_test.py\n\n## \n\nWilliam Chan\nCarnegie Mellon University\n(650) 450-9455\nwilliamchan.ca\n\nOn Wed, May 11, 2016 at 2:32 PM, ebrevdo notifications@github.com wrote:\n\n> In tensorflow/python/kernel_tests/rnn_test.py\n> https://github.com/tensorflow/tensorflow/pull/2002#discussion_r62930648:\n> \n> > -          for y in [outputs_static[0],\n> > -                    outputs_static[-1],\n> > \n> > ## \\-                    state_static]])\n> > -      # Test forward pass\n> > -      values_static = sess.run(outputs_static, feed_dict=feeds)\n> > \n> > ## \\-      (state_value_static,) = sess.run((state_static,), feed_dict=feeds)\n> > -      # Test gradients to inputs and variables w.r.t. outputs & final state\n> > \n> > ## \\-      static_grad_values = sess.run(static_gradients, feed_dict=feeds)\n> > -      static_individual_grad_values = sess.run(\n> > -          static_individual_gradients, feed_dict=feeds)\n> > -    initializer = tf.random_uniform_initializer(-0.01, 0.01, seed=self._seed)\n> > -    cell = tf.nn.rnn_cell.LSTMCell(\n> > -        num_units, input_size, use_peepholes=True,\n> \n> here you have use_peepholes = true. are you sure you want that?\n> \n> \u2014\n> You are receiving this because you were mentioned.\n> Reply to this email directly or view it on GitHub\n> https://github.com/tensorflow/tensorflow/pull/2002/files/fc40971bba82762fe413b5e7d6fe12a09722876b#r62930648\n", "created_at": "2016-05-11T21:35:59Z", "updated_at": "2016-05-18T21:31:18Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/2002#discussion_r62931354", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/2002", "author_association": "NONE", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/62931354"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/2002#discussion_r62931354"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/2002"}}, "body_html": "<p>thats existing code. for tensorflow/python/kernel_tests/rnn_test.py<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"148966307\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/2002\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/2002/hovercard?comment_id=62930648&amp;comment_type=review_comment\" href=\"https://github.com/tensorflow/tensorflow/pull/2002#discussion_r62930648\">#2002 (comment)</a> I<br>\nonly refactored some of the benchmarking code so I can leverage it in my<br>\ncontrib/../rnn_test.py</p>\n<h2></h2>\n<p>William Chan<br>\nCarnegie Mellon University<br>\n(650) 450-9455<br>\nwilliamchan.ca</p>\n<p>On Wed, May 11, 2016 at 2:32 PM, ebrevdo <a href=\"mailto:notifications@github.com\">notifications@github.com</a> wrote:</p>\n<blockquote>\n<p>In tensorflow/python/kernel_tests/rnn_test.py<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"148966307\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/2002\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/2002/hovercard?comment_id=62930648&amp;comment_type=review_comment\" href=\"https://github.com/tensorflow/tensorflow/pull/2002#discussion_r62930648\">#2002 (comment)</a>:</p>\n<blockquote>\n<ul>\n<li>\n<pre><code>     for y in [outputs_static[0],\n</code></pre>\n</li>\n<li>\n<pre><code>               outputs_static[-1],\n</code></pre>\n</li>\n</ul>\n<h2>-                    state_static]])</h2>\n<ul>\n<li>\n<pre><code> # Test forward pass\n</code></pre>\n</li>\n<li>\n<pre><code> values_static = sess.run(outputs_static, feed_dict=feeds)\n</code></pre>\n</li>\n</ul>\n<h2>-      (state_value_static,) = sess.run((state_static,), feed_dict=feeds)</h2>\n<ul>\n<li>\n<pre><code> # Test gradients to inputs and variables w.r.t. outputs &amp; final state\n</code></pre>\n</li>\n</ul>\n<h2>-      static_grad_values = sess.run(static_gradients, feed_dict=feeds)</h2>\n<ul>\n<li>\n<pre><code> static_individual_grad_values = sess.run(\n</code></pre>\n</li>\n<li>\n<pre><code>     static_individual_gradients, feed_dict=feeds)\n</code></pre>\n</li>\n<li>initializer = tf.random_uniform_initializer(-0.01, 0.01, seed=self._seed)</li>\n<li>cell = tf.nn.rnn_cell.LSTMCell(</li>\n<li>\n<pre><code>   num_units, input_size, use_peepholes=True,\n</code></pre>\n</li>\n</ul>\n</blockquote>\n<p>here you have use_peepholes = true. are you sure you want that?</p>\n<p>\u2014<br>\nYou are receiving this because you were mentioned.<br>\nReply to this email directly or view it on GitHub<br>\n<a href=\"https://github.com/tensorflow/tensorflow/pull/2002/files/fc40971bba82762fe413b5e7d6fe12a09722876b#r62930648\">https://github.com/tensorflow/tensorflow/pull/2002/files/fc40971bba82762fe413b5e7d6fe12a09722876b#r62930648</a></p>\n</blockquote>", "body_text": "thats existing code. for tensorflow/python/kernel_tests/rnn_test.py\n#2002 (comment) I\nonly refactored some of the benchmarking code so I can leverage it in my\ncontrib/../rnn_test.py\n\nWilliam Chan\nCarnegie Mellon University\n(650) 450-9455\nwilliamchan.ca\nOn Wed, May 11, 2016 at 2:32 PM, ebrevdo notifications@github.com wrote:\n\nIn tensorflow/python/kernel_tests/rnn_test.py\n#2002 (comment):\n\n\n\n     for y in [outputs_static[0],\n\n\n\n               outputs_static[-1],\n\n\n\n-                    state_static]])\n\n\n # Test forward pass\n\n\n\n values_static = sess.run(outputs_static, feed_dict=feeds)\n\n\n\n-      (state_value_static,) = sess.run((state_static,), feed_dict=feeds)\n\n\n # Test gradients to inputs and variables w.r.t. outputs & final state\n\n\n\n-      static_grad_values = sess.run(static_gradients, feed_dict=feeds)\n\n\n static_individual_grad_values = sess.run(\n\n\n\n     static_individual_gradients, feed_dict=feeds)\n\n\ninitializer = tf.random_uniform_initializer(-0.01, 0.01, seed=self._seed)\ncell = tf.nn.rnn_cell.LSTMCell(\n\n   num_units, input_size, use_peepholes=True,\n\n\n\n\nhere you have use_peepholes = true. are you sure you want that?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly or view it on GitHub\nhttps://github.com/tensorflow/tensorflow/pull/2002/files/fc40971bba82762fe413b5e7d6fe12a09722876b#r62930648"}