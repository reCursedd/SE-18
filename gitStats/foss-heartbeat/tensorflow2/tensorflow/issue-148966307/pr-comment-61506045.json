{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/61506045", "pull_request_review_id": null, "id": 61506045, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTA2MDQ1", "diff_hunk": "@@ -8,12 +8,37 @@ exports_files([\"LICENSE\"])\n \n package(default_visibility = [\"//tensorflow:__subpackages__\"])\n \n+load(\"//tensorflow:tensorflow.bzl\", \"tf_custom_op_library\")\n+load(\"//tensorflow:tensorflow.bzl\", \"tf_gen_op_libs\")\n+load(\"//tensorflow:tensorflow.bzl\", \"tf_gen_op_wrapper_py\")\n load(\"//tensorflow:tensorflow.bzl\", \"cuda_py_tests\")\n \n+tf_custom_op_library(\n+    name = \"python/ops/_lstm_ops.so\",\n+    srcs = [\n+        \"ops/lstm_ops.cc\",\n+    ],\n+    hdrs = [\"kernels/lstm_ops.h\"],\n+    gpu_srcs = [\n+        \"kernels/lstm_ops.cc\",", "path": "tensorflow/contrib/rnn/BUILD", "position": null, "original_position": 16, "commit_id": "258144b98730f99489437f6963737480be4f5a43", "original_commit_id": "36fb73b93c217d59a868524383b347104ce431dd", "user": {"login": "wchan", "id": 1131892, "node_id": "MDQ6VXNlcjExMzE4OTI=", "avatar_url": "https://avatars1.githubusercontent.com/u/1131892?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wchan", "html_url": "https://github.com/wchan", "followers_url": "https://api.github.com/users/wchan/followers", "following_url": "https://api.github.com/users/wchan/following{/other_user}", "gists_url": "https://api.github.com/users/wchan/gists{/gist_id}", "starred_url": "https://api.github.com/users/wchan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wchan/subscriptions", "organizations_url": "https://api.github.com/users/wchan/orgs", "repos_url": "https://api.github.com/users/wchan/repos", "events_url": "https://api.github.com/users/wchan/events{/privacy}", "received_events_url": "https://api.github.com/users/wchan/received_events", "type": "User", "site_admin": false}, "body": "edit: previous comment, i cant get it to build w/o --config=cuda ... i\nthink its cause we need to specify the hdrs or else it wont be able to pick\nit up?\n\ni still think we should do a tf_custom_kernel_library?\n\n## \n\nWilliam Chan\nCarnegie Mellon University\n(650) 450-9455\nwilliamchan.ca\n\nOn Thu, Apr 28, 2016 at 2:29 PM, William Chan williamchan@cmu.edu wrote:\n\n> nvm my last comment, i think i can get it to compile... not familiar\n> enough w/ blaze BUILD files, not clear to me how its able to automatically\n> pickup the header even tho we don't specify it in the cc_binary... fixing\n> other issues atm.\n> \n> ## \n> \n> William Chan\n> Carnegie Mellon University\n> (650) 450-9455\n> williamchan.ca\n> \n> On Thu, Apr 28, 2016 at 1:24 PM, William Chan williamchan@cmu.edu wrote:\n> \n> > where am i supposed to put the kernels/lstm_ops.cc ? srces doesn't work\n> > because it is used to build a binary which doesn't allow a header entry\n> > needed for the kernels/lstm_ops.cc?\n> > \n> > that's why i suggested earlier to refactor the tf_custom_op_library and\n> > into a tf_custom_kernel_library which builds two seperate cc_library, one\n> > for _gpu and one for the cpu case? isn't that the more correct approach?\n> > \n> > ## \n> > \n> > William Chan\n> > Carnegie Mellon University\n> > (650) 450-9455\n> > williamchan.ca\n> > \n> > On Thu, Apr 28, 2016 at 1:01 PM, Manjunath Kudlur <\n> > notifications@github.com> wrote:\n> > \n> > > In tensorflow/contrib/rnn/BUILD\n> > > https://github.com/tensorflow/tensorflow/pull/2002#discussion_r61492761\n> > > :\n> > > \n> > > >  load(\"//tensorflow:tensorflow.bzl\", \"cuda_py_tests\")\n> > > > \n> > > > +tf_custom_op_library(\n> > > > -    name = \"python/ops/_lstm_ops.so\",\n> > > > -    srcs = [\n> > > > -        \"ops/lstm_ops.cc\",\n> > > > -    ],\n> > > > -    hdrs = [\"kernels/lstm_ops.h\"],\n> > > > -    gpu_srcs = [\n> > > > -        \"kernels/lstm_ops.cc\",\n> > > \n> > > Nope. Only lstm_ops_gpu.cu.cc should go here.\n> > > \n> > > \u2014\n> > > You are receiving this because you were mentioned.\n> > > Reply to this email directly or view it on GitHub\n> > > https://github.com/tensorflow/tensorflow/pull/2002/files/36fb73b93c217d59a868524383b347104ce431dd#r61492761\n", "created_at": "2016-04-28T21:31:26Z", "updated_at": "2016-05-18T21:31:18Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/2002#discussion_r61506045", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/2002", "author_association": "NONE", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/61506045"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/2002#discussion_r61506045"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/2002"}}, "body_html": "<p>edit: previous comment, i cant get it to build w/o --config=cuda ... i<br>\nthink its cause we need to specify the hdrs or else it wont be able to pick<br>\nit up?</p>\n<p>i still think we should do a tf_custom_kernel_library?</p>\n<h2></h2>\n<p>William Chan<br>\nCarnegie Mellon University<br>\n(650) 450-9455<br>\nwilliamchan.ca</p>\n<p>On Thu, Apr 28, 2016 at 2:29 PM, William Chan <a href=\"mailto:williamchan@cmu.edu\">williamchan@cmu.edu</a> wrote:</p>\n<blockquote>\n<p>nvm my last comment, i think i can get it to compile... not familiar<br>\nenough w/ blaze BUILD files, not clear to me how its able to automatically<br>\npickup the header even tho we don't specify it in the cc_binary... fixing<br>\nother issues atm.</p>\n<h2></h2>\n<p>William Chan<br>\nCarnegie Mellon University<br>\n(650) 450-9455<br>\nwilliamchan.ca</p>\n<p>On Thu, Apr 28, 2016 at 1:24 PM, William Chan <a href=\"mailto:williamchan@cmu.edu\">williamchan@cmu.edu</a> wrote:</p>\n<blockquote>\n<p>where am i supposed to put the kernels/lstm_ops.cc ? srces doesn't work<br>\nbecause it is used to build a binary which doesn't allow a header entry<br>\nneeded for the kernels/lstm_ops.cc?</p>\n<p>that's why i suggested earlier to refactor the tf_custom_op_library and<br>\ninto a tf_custom_kernel_library which builds two seperate cc_library, one<br>\nfor _gpu and one for the cpu case? isn't that the more correct approach?</p>\n<h2></h2>\n<p>William Chan<br>\nCarnegie Mellon University<br>\n(650) 450-9455<br>\nwilliamchan.ca</p>\n<p>On Thu, Apr 28, 2016 at 1:01 PM, Manjunath Kudlur &lt;<br>\n<a href=\"mailto:notifications@github.com\">notifications@github.com</a>&gt; wrote:</p>\n<blockquote>\n<p>In tensorflow/contrib/rnn/BUILD<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"148966307\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/2002\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/2002/hovercard?comment_id=61492761&amp;comment_type=review_comment\" href=\"https://github.com/tensorflow/tensorflow/pull/2002#discussion_r61492761\">#2002 (comment)</a><br>\n:</p>\n<blockquote>\n<p>load(\"//tensorflow:tensorflow.bzl\", \"cuda_py_tests\")</p>\n<p>+tf_custom_op_library(</p>\n<ul>\n<li>name = \"python/ops/_lstm_ops.so\",</li>\n<li>srcs = [</li>\n<li>\n<pre><code>   \"ops/lstm_ops.cc\",\n</code></pre>\n</li>\n<li>],</li>\n<li>hdrs = [\"kernels/lstm_ops.h\"],</li>\n<li>gpu_srcs = [</li>\n<li>\n<pre><code>   \"kernels/lstm_ops.cc\",\n</code></pre>\n</li>\n</ul>\n</blockquote>\n<p>Nope. Only lstm_ops_gpu.cu.cc should go here.</p>\n<p>\u2014<br>\nYou are receiving this because you were mentioned.<br>\nReply to this email directly or view it on GitHub<br>\n<a href=\"https://github.com/tensorflow/tensorflow/pull/2002/files/36fb73b93c217d59a868524383b347104ce431dd#r61492761\">https://github.com/tensorflow/tensorflow/pull/2002/files/36fb73b93c217d59a868524383b347104ce431dd#r61492761</a></p>\n</blockquote>\n</blockquote>\n</blockquote>", "body_text": "edit: previous comment, i cant get it to build w/o --config=cuda ... i\nthink its cause we need to specify the hdrs or else it wont be able to pick\nit up?\ni still think we should do a tf_custom_kernel_library?\n\nWilliam Chan\nCarnegie Mellon University\n(650) 450-9455\nwilliamchan.ca\nOn Thu, Apr 28, 2016 at 2:29 PM, William Chan williamchan@cmu.edu wrote:\n\nnvm my last comment, i think i can get it to compile... not familiar\nenough w/ blaze BUILD files, not clear to me how its able to automatically\npickup the header even tho we don't specify it in the cc_binary... fixing\nother issues atm.\n\nWilliam Chan\nCarnegie Mellon University\n(650) 450-9455\nwilliamchan.ca\nOn Thu, Apr 28, 2016 at 1:24 PM, William Chan williamchan@cmu.edu wrote:\n\nwhere am i supposed to put the kernels/lstm_ops.cc ? srces doesn't work\nbecause it is used to build a binary which doesn't allow a header entry\nneeded for the kernels/lstm_ops.cc?\nthat's why i suggested earlier to refactor the tf_custom_op_library and\ninto a tf_custom_kernel_library which builds two seperate cc_library, one\nfor _gpu and one for the cpu case? isn't that the more correct approach?\n\nWilliam Chan\nCarnegie Mellon University\n(650) 450-9455\nwilliamchan.ca\nOn Thu, Apr 28, 2016 at 1:01 PM, Manjunath Kudlur <\nnotifications@github.com> wrote:\n\nIn tensorflow/contrib/rnn/BUILD\n#2002 (comment)\n:\n\nload(\"//tensorflow:tensorflow.bzl\", \"cuda_py_tests\")\n+tf_custom_op_library(\n\nname = \"python/ops/_lstm_ops.so\",\nsrcs = [\n\n   \"ops/lstm_ops.cc\",\n\n\n],\nhdrs = [\"kernels/lstm_ops.h\"],\ngpu_srcs = [\n\n   \"kernels/lstm_ops.cc\",\n\n\n\n\nNope. Only lstm_ops_gpu.cu.cc should go here.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly or view it on GitHub\nhttps://github.com/tensorflow/tensorflow/pull/2002/files/36fb73b93c217d59a868524383b347104ce431dd#r61492761"}