{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15835", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15835/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15835/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15835/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15835", "id": 285890858, "node_id": "MDU6SXNzdWUyODU4OTA4NTg=", "number": 15835, "title": "When data become large,parition variables can not initialized successfully", "user": {"login": "weidong8405347", "id": 12580804, "node_id": "MDQ6VXNlcjEyNTgwODA0", "avatar_url": "https://avatars1.githubusercontent.com/u/12580804?v=4", "gravatar_id": "", "url": "https://api.github.com/users/weidong8405347", "html_url": "https://github.com/weidong8405347", "followers_url": "https://api.github.com/users/weidong8405347/followers", "following_url": "https://api.github.com/users/weidong8405347/following{/other_user}", "gists_url": "https://api.github.com/users/weidong8405347/gists{/gist_id}", "starred_url": "https://api.github.com/users/weidong8405347/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/weidong8405347/subscriptions", "organizations_url": "https://api.github.com/users/weidong8405347/orgs", "repos_url": "https://api.github.com/users/weidong8405347/repos", "events_url": "https://api.github.com/users/weidong8405347/events{/privacy}", "received_events_url": "https://api.github.com/users/weidong8405347/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, {"login": "shivaniag", "id": 16565716, "node_id": "MDQ6VXNlcjE2NTY1NzE2", "avatar_url": "https://avatars1.githubusercontent.com/u/16565716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shivaniag", "html_url": "https://github.com/shivaniag", "followers_url": "https://api.github.com/users/shivaniag/followers", "following_url": "https://api.github.com/users/shivaniag/following{/other_user}", "gists_url": "https://api.github.com/users/shivaniag/gists{/gist_id}", "starred_url": "https://api.github.com/users/shivaniag/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shivaniag/subscriptions", "organizations_url": "https://api.github.com/users/shivaniag/orgs", "repos_url": "https://api.github.com/users/shivaniag/repos", "events_url": "https://api.github.com/users/shivaniag/events{/privacy}", "received_events_url": "https://api.github.com/users/shivaniag/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 12, "created_at": "2018-01-04T06:17:30Z", "updated_at": "2018-10-11T07:23:05Z", "closed_at": "2018-09-28T21:19:41Z", "author_association": "NONE", "body_html": "<p>i use tensorflow to distributed trainning models, i use the partition valriables to store an array data, when the data is not so bigger, everything looks ok,but when the array data become larger, when the session initialize, the partition variables can not initialized and the session will wait util time out.</p>\n<p>Describe the problem</p>\n<p>Describe the problem clearly here. Be sure to convey here why it's a bug in TensorFlow or a feature request. the feat_info can initialize successfully, but the adj_info cannot initialized. the adj_info is larger than feat_info</p>\n<p>i use monitored_session or supervisor to do the initialize_variables, when data is not so large, it will initialize successfully, my machine have more than 300GB memory is enough for the larger variable</p>\n<p>Have I written custom code<br>\nyes<br>\nOS Platform and Distribution<br>\nlinux platform<br>\nTensorFlow installed from<br>\nN/A<br>\nTensorFlow version<br>\nr1.4<br>\nBazel version<br>\nCUDA/cuDNN version<br>\nno gpu<br>\nGPU model and memory<br>\nno gpu<br>\nExact command to reproduce<br>\nN/A</p>\n<p>Source code / logs</p>\n<p>i use ps_num = 4, worker_num =4 and i also try some other distributed config, like ps_num=1, worker_num=4, the result is the same<br>\nsource code:<br>\nwith tf.device(tf.train.replica_device_setter(<br>\nworker_device=\"/job:worker/task:%d\" % task_id,<br>\ncluster=cluster_spec)):</p>\n<p>feat_info = tf.get_variable(\"feature_info\", (len(id_map),FLAGS.features_column), tf.float32, trainable=False, partitioner=tf.fixed_size_partitioner(num_workers))<br>\nadj_info = tf.get_variable(\"adj_info\", (len(id_map),FLAGS.max_degree), tf.int64, trainable=False, partitioner=tf.fixed_size_partitioner(num_workers))</p>\n<p>with tf.device('/job:worker/task:%d' %task_id):<br>\nadj_local = tf.Variable(tf.constant(minibatch.adj, dtype=tf.int64), trainable=False, name=\"adj_local\", collections=[tf.GraphKeys.LOCAL_VARIABLES])<br>\nfeat_local = tf.Variable(tf.constant(features, dtype=tf.float32), trainable=False, name=\"feat_local\", collections=[tf.GraphKeys.LOCAL_VARIABLES])</p>\n<p>length, begin, end = split_node_by_task(len(id_map), task_id, num_workers)<br>\nadj = tf.nn.embedding_lookup(adj_info, [x for x in range(begin, end)])<br>\nadj = adj_local</p>\n<p>feat = tf.nn.embedding_lookup(feat_info, [x for x in range(begin, end)])<br>\nfeat = feat_local<br>\nlog:<br>\n2017-12-08 23:54:17.377290: I tensorflow/core/distributed_runtime/master_session.cc:998] Start master session c2b3ba9b700261ba with config:<br>\nINFO:tensorflow:Waiting for model to be ready. Ready_for_local_init_op: None, ready: Variables not initialized: adj_info/part_0, adj_info/part_1, adj_info/part_2, adj_info/part_3, adj_info/part_4, adj_info/part_5, adj_info/part_6, adj_info/part_7, adj_info/part_8, adj_info/part_9, adj_info/part_10, adj_info/part_11, adj_info/part_12, adj_info/part_13, adj_info/part_14, adj_info/part_15<br>\n2017-12-09 00:00:35.637019: I tensorflow/core/distributed_runtime/master_session.cc:998] Start master session f35fcf332e3908ec with config:<br>\nINFO:tensorflow:Waiting for model to be ready. Ready_for_local_init_op: None, ready: Variables not initialized: adj_info/part_0, adj_info/part_1, adj_info/part_2, adj_info/part_3, adj_info/part_4, adj_info/part_5, adj_info/part_6, adj_info/part_7, adj_info/part_8, adj_info/part_9, adj_info/part_10, adj_info/part_11, adj_info/part_12, adj_info/part_13, adj_info/part_14, adj_info/part_15<br>\nand it will alway waiting adj_info to initialize</p>", "body_text": "i use tensorflow to distributed trainning models, i use the partition valriables to store an array data, when the data is not so bigger, everything looks ok,but when the array data become larger, when the session initialize, the partition variables can not initialized and the session will wait util time out.\nDescribe the problem\nDescribe the problem clearly here. Be sure to convey here why it's a bug in TensorFlow or a feature request. the feat_info can initialize successfully, but the adj_info cannot initialized. the adj_info is larger than feat_info\ni use monitored_session or supervisor to do the initialize_variables, when data is not so large, it will initialize successfully, my machine have more than 300GB memory is enough for the larger variable\nHave I written custom code\nyes\nOS Platform and Distribution\nlinux platform\nTensorFlow installed from\nN/A\nTensorFlow version\nr1.4\nBazel version\nCUDA/cuDNN version\nno gpu\nGPU model and memory\nno gpu\nExact command to reproduce\nN/A\nSource code / logs\ni use ps_num = 4, worker_num =4 and i also try some other distributed config, like ps_num=1, worker_num=4, the result is the same\nsource code:\nwith tf.device(tf.train.replica_device_setter(\nworker_device=\"/job:worker/task:%d\" % task_id,\ncluster=cluster_spec)):\nfeat_info = tf.get_variable(\"feature_info\", (len(id_map),FLAGS.features_column), tf.float32, trainable=False, partitioner=tf.fixed_size_partitioner(num_workers))\nadj_info = tf.get_variable(\"adj_info\", (len(id_map),FLAGS.max_degree), tf.int64, trainable=False, partitioner=tf.fixed_size_partitioner(num_workers))\nwith tf.device('/job:worker/task:%d' %task_id):\nadj_local = tf.Variable(tf.constant(minibatch.adj, dtype=tf.int64), trainable=False, name=\"adj_local\", collections=[tf.GraphKeys.LOCAL_VARIABLES])\nfeat_local = tf.Variable(tf.constant(features, dtype=tf.float32), trainable=False, name=\"feat_local\", collections=[tf.GraphKeys.LOCAL_VARIABLES])\nlength, begin, end = split_node_by_task(len(id_map), task_id, num_workers)\nadj = tf.nn.embedding_lookup(adj_info, [x for x in range(begin, end)])\nadj = adj_local\nfeat = tf.nn.embedding_lookup(feat_info, [x for x in range(begin, end)])\nfeat = feat_local\nlog:\n2017-12-08 23:54:17.377290: I tensorflow/core/distributed_runtime/master_session.cc:998] Start master session c2b3ba9b700261ba with config:\nINFO:tensorflow:Waiting for model to be ready. Ready_for_local_init_op: None, ready: Variables not initialized: adj_info/part_0, adj_info/part_1, adj_info/part_2, adj_info/part_3, adj_info/part_4, adj_info/part_5, adj_info/part_6, adj_info/part_7, adj_info/part_8, adj_info/part_9, adj_info/part_10, adj_info/part_11, adj_info/part_12, adj_info/part_13, adj_info/part_14, adj_info/part_15\n2017-12-09 00:00:35.637019: I tensorflow/core/distributed_runtime/master_session.cc:998] Start master session f35fcf332e3908ec with config:\nINFO:tensorflow:Waiting for model to be ready. Ready_for_local_init_op: None, ready: Variables not initialized: adj_info/part_0, adj_info/part_1, adj_info/part_2, adj_info/part_3, adj_info/part_4, adj_info/part_5, adj_info/part_6, adj_info/part_7, adj_info/part_8, adj_info/part_9, adj_info/part_10, adj_info/part_11, adj_info/part_12, adj_info/part_13, adj_info/part_14, adj_info/part_15\nand it will alway waiting adj_info to initialize", "body": "i use tensorflow to distributed trainning models, i use the partition valriables to store an array data, when the data is not so bigger, everything looks ok,but when the array data become larger, when the session initialize, the partition variables can not initialized and the session will wait util time out.\r\n\r\nDescribe the problem\r\n\r\nDescribe the problem clearly here. Be sure to convey here why it's a bug in TensorFlow or a feature request. the feat_info can initialize successfully, but the adj_info cannot initialized. the adj_info is larger than feat_info\r\n\r\n i use monitored_session or supervisor to do the initialize_variables, when data is not so large, it will initialize successfully, my machine have more than 300GB memory is enough for the larger variable\r\n\r\nHave I written custom code\r\nyes\r\nOS Platform and Distribution\r\nlinux platform\r\nTensorFlow installed from\r\nN/A\r\nTensorFlow version\r\nr1.4\r\nBazel version\r\nCUDA/cuDNN version\r\nno gpu\r\nGPU model and memory\r\nno gpu\r\nExact command to reproduce\r\nN/A\r\n\r\nSource code / logs\r\n\r\ni use ps_num = 4, worker_num =4 and i also try some other distributed config, like ps_num=1, worker_num=4, the result is the same\r\nsource code:\r\nwith tf.device(tf.train.replica_device_setter(\r\nworker_device=\"/job:worker/task:%d\" % task_id,\r\ncluster=cluster_spec)):\r\n\r\n  feat_info = tf.get_variable(\"feature_info\", (len(id_map),FLAGS.features_column), tf.float32, trainable=False, partitioner=tf.fixed_size_partitioner(num_workers))\r\n  adj_info = tf.get_variable(\"adj_info\", (len(id_map),FLAGS.max_degree), tf.int64, trainable=False, partitioner=tf.fixed_size_partitioner(num_workers))\r\n \r\n  with tf.device('/job:worker/task:%d' %task_id):\r\n      adj_local = tf.Variable(tf.constant(minibatch.adj, dtype=tf.int64), trainable=False, name=\"adj_local\", collections=[tf.GraphKeys.LOCAL_VARIABLES])\r\n      feat_local = tf.Variable(tf.constant(features, dtype=tf.float32), trainable=False, name=\"feat_local\", collections=[tf.GraphKeys.LOCAL_VARIABLES])\r\n \r\n  length, begin, end = split_node_by_task(len(id_map), task_id, num_workers)\r\n  adj = tf.nn.embedding_lookup(adj_info, [x for x in range(begin, end)])\r\n  adj = adj_local\r\n  \r\n  feat = tf.nn.embedding_lookup(feat_info, [x for x in range(begin, end)])\r\n  feat = feat_local\r\nlog:\r\n2017-12-08 23:54:17.377290: I tensorflow/core/distributed_runtime/master_session.cc:998] Start master session c2b3ba9b700261ba with config:\r\nINFO:tensorflow:Waiting for model to be ready. Ready_for_local_init_op: None, ready: Variables not initialized: adj_info/part_0, adj_info/part_1, adj_info/part_2, adj_info/part_3, adj_info/part_4, adj_info/part_5, adj_info/part_6, adj_info/part_7, adj_info/part_8, adj_info/part_9, adj_info/part_10, adj_info/part_11, adj_info/part_12, adj_info/part_13, adj_info/part_14, adj_info/part_15\r\n2017-12-09 00:00:35.637019: I tensorflow/core/distributed_runtime/master_session.cc:998] Start master session f35fcf332e3908ec with config:\r\nINFO:tensorflow:Waiting for model to be ready. Ready_for_local_init_op: None, ready: Variables not initialized: adj_info/part_0, adj_info/part_1, adj_info/part_2, adj_info/part_3, adj_info/part_4, adj_info/part_5, adj_info/part_6, adj_info/part_7, adj_info/part_8, adj_info/part_9, adj_info/part_10, adj_info/part_11, adj_info/part_12, adj_info/part_13, adj_info/part_14, adj_info/part_15\r\nand it will alway waiting adj_info to initialize"}