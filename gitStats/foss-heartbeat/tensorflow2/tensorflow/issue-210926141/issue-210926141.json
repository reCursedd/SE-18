{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7952", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7952/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7952/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7952/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/7952", "id": 210926141, "node_id": "MDU6SXNzdWUyMTA5MjYxNDE=", "number": 7952, "title": "[Java] Loading frozen graph causes a segfault", "user": {"login": "tianwang95", "id": 7917315, "node_id": "MDQ6VXNlcjc5MTczMTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/7917315?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tianwang95", "html_url": "https://github.com/tianwang95", "followers_url": "https://api.github.com/users/tianwang95/followers", "following_url": "https://api.github.com/users/tianwang95/following{/other_user}", "gists_url": "https://api.github.com/users/tianwang95/gists{/gist_id}", "starred_url": "https://api.github.com/users/tianwang95/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tianwang95/subscriptions", "organizations_url": "https://api.github.com/users/tianwang95/orgs", "repos_url": "https://api.github.com/users/tianwang95/repos", "events_url": "https://api.github.com/users/tianwang95/events{/privacy}", "received_events_url": "https://api.github.com/users/tianwang95/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}, {"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2017-02-28T22:50:58Z", "updated_at": "2017-03-22T15:20:22Z", "closed_at": "2017-03-11T02:47:12Z", "author_association": "NONE", "body_html": "<p>I froze then saved a tensorflow graph in python with <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/tools/freeze_graph.py\">freeze_graph.py</a> producing a single model.pb file.</p>\n<p>However, loading the graph in Java (where modelStream is an InputStream from reading the .pb file):</p>\n<pre><code>Graph g = new Graph();\nInputStream modelStream = new FileInputStream(\"/path/to/model.pb\");\ng.importGraphDef(IOUtils.toByteArray(modelStream);\n</code></pre>\n<p>causes a segfault:</p>\n<pre><code># A fatal error has been detected by the Java Runtime Environment:\n#\n#  SIGSEGV (0xb) at pc=0x0000000125526b1c, pid=6482, tid=7171\n#\n# JRE version: Java(TM) SE Runtime Environment (8.0_91-b14) (build 1.8.0_91-b14)\n# Java VM: Java HotSpot(TM) 64-Bit Server VM (25.91-b14 mixed mode bsd-amd64 compressed oops)\n# Problematic frame:\n# C  [libtensorflow_jni.dylib+0x1bfdb1c]  tensorflow::shape_inference::InferenceContext::WithRank(tensorflow::shape_inference::ShapeHandle, int, tensorflow::shape_inference::ShapeHandle*)+0x1c\n#\n</code></pre>\n<p>The same model.pb file loads and runs properly in Python.</p>\n<h3>Environment info</h3>\n<p>Operating System: MacOS Sierra 10.12.3<br>\nNative library for OSX downloaded from <a href=\"https://storage.googleapis.com/tensorflow/libtensorflow/libtensorflow_jni-cpu-darwin-x86_64-1.0.0-PREVIEW1.tar.gz\" rel=\"nofollow\">here</a> by following the <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/java/README.md\">readme on the Java Tensorflow repo</a></p>", "body_text": "I froze then saved a tensorflow graph in python with freeze_graph.py producing a single model.pb file.\nHowever, loading the graph in Java (where modelStream is an InputStream from reading the .pb file):\nGraph g = new Graph();\nInputStream modelStream = new FileInputStream(\"/path/to/model.pb\");\ng.importGraphDef(IOUtils.toByteArray(modelStream);\n\ncauses a segfault:\n# A fatal error has been detected by the Java Runtime Environment:\n#\n#  SIGSEGV (0xb) at pc=0x0000000125526b1c, pid=6482, tid=7171\n#\n# JRE version: Java(TM) SE Runtime Environment (8.0_91-b14) (build 1.8.0_91-b14)\n# Java VM: Java HotSpot(TM) 64-Bit Server VM (25.91-b14 mixed mode bsd-amd64 compressed oops)\n# Problematic frame:\n# C  [libtensorflow_jni.dylib+0x1bfdb1c]  tensorflow::shape_inference::InferenceContext::WithRank(tensorflow::shape_inference::ShapeHandle, int, tensorflow::shape_inference::ShapeHandle*)+0x1c\n#\n\nThe same model.pb file loads and runs properly in Python.\nEnvironment info\nOperating System: MacOS Sierra 10.12.3\nNative library for OSX downloaded from here by following the readme on the Java Tensorflow repo", "body": "I froze then saved a tensorflow graph in python with [freeze_graph.py](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/tools/freeze_graph.py) producing a single model.pb file.\r\n\r\nHowever, loading the graph in Java (where modelStream is an InputStream from reading the .pb file):\r\n```\r\nGraph g = new Graph();\r\nInputStream modelStream = new FileInputStream(\"/path/to/model.pb\");\r\ng.importGraphDef(IOUtils.toByteArray(modelStream);\r\n```\r\ncauses a segfault:\r\n```\r\n# A fatal error has been detected by the Java Runtime Environment:\r\n#\r\n#  SIGSEGV (0xb) at pc=0x0000000125526b1c, pid=6482, tid=7171\r\n#\r\n# JRE version: Java(TM) SE Runtime Environment (8.0_91-b14) (build 1.8.0_91-b14)\r\n# Java VM: Java HotSpot(TM) 64-Bit Server VM (25.91-b14 mixed mode bsd-amd64 compressed oops)\r\n# Problematic frame:\r\n# C  [libtensorflow_jni.dylib+0x1bfdb1c]  tensorflow::shape_inference::InferenceContext::WithRank(tensorflow::shape_inference::ShapeHandle, int, tensorflow::shape_inference::ShapeHandle*)+0x1c\r\n#\r\n```\r\nThe same model.pb file loads and runs properly in Python.\r\n\r\n### Environment info\r\nOperating System: MacOS Sierra 10.12.3\r\nNative library for OSX downloaded from [here](https://storage.googleapis.com/tensorflow/libtensorflow/libtensorflow_jni-cpu-darwin-x86_64-1.0.0-PREVIEW1.tar.gz) by following the [readme on the Java Tensorflow repo](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/java/README.md)"}