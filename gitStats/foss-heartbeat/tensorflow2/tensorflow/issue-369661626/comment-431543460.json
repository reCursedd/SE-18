{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/431543460", "html_url": "https://github.com/tensorflow/tensorflow/issues/22945#issuecomment-431543460", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22945", "id": 431543460, "node_id": "MDEyOklzc3VlQ29tbWVudDQzMTU0MzQ2MA==", "user": {"login": "bennix", "id": 124814, "node_id": "MDQ6VXNlcjEyNDgxNA==", "avatar_url": "https://avatars3.githubusercontent.com/u/124814?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bennix", "html_url": "https://github.com/bennix", "followers_url": "https://api.github.com/users/bennix/followers", "following_url": "https://api.github.com/users/bennix/following{/other_user}", "gists_url": "https://api.github.com/users/bennix/gists{/gist_id}", "starred_url": "https://api.github.com/users/bennix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bennix/subscriptions", "organizations_url": "https://api.github.com/users/bennix/orgs", "repos_url": "https://api.github.com/users/bennix/repos", "events_url": "https://api.github.com/users/bennix/events{/privacy}", "received_events_url": "https://api.github.com/users/bennix/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-20T03:03:38Z", "updated_at": "2018-10-20T03:03:38Z", "author_association": "NONE", "body_html": "<p>MacOS users do not upgrade to MacOS Mojave if you want to use tensorflow.<br>\nI use it on MacOS 10.13.6. with Xcode 9.2  CUDA 9.2</p>\n<p>Build with newest source code from github.</p>\n<p>I use anaconda so the \".bash_profile\" file is below:</p>\n<h1>added by Anaconda3 5.2.0 installer</h1>\n<p>export PATH=\"/Users/username/anaconda3/bin:$PATH\"</p>\n<p>export CUDA_HOME=/usr/local/cuda<br>\nexport DYLD_LIBRARY_PATH=/usr/local/cuda/lib:/usr/local/cuda/extras/CUPTI/lib:/Developer/NVIDIA/CUDA-9.2/lib<br>\nexport PATH=$DYLD_LIBRARY_PATH:$PATH:/Developer/NVIDIA/CUDA-9.2/bin</p>\n<p>[ Download NCCL v2.3.5, for CUDA 9.2, Sept 25, 2018 ]<br>\n<a href=\"https://developer.nvidia.com/nccl/nccl-download\" rel=\"nofollow\">https://developer.nvidia.com/nccl/nccl-download</a><br>\nNCCL 2.3.5 O/S agnostic and CUDA 9.2<br>\ntar xvf nccl_2.3.5-2+cuda9.2_x86_64.txz (cd ~/Downloads)<br>\ncd nccl_2.3.5-2+cuda9.2_x86_64/lib<br>\nsudo mv * /Developer/NVIDIA/CUDA-9.2/lib/<br>\ncd nccl_2.3.5-2+cuda9.2_x86_64/include<br>\nsudo mv nccl.h /Developer/NVIDIA/CUDA-9.2/include/<br>\ncd tensorflow/third_party/nccl/<br>\nln -s /Developer/NVIDIA/CUDA-9.2/include/nccl.h</p>\n<p>And Download CUDNN  and install to related path.</p>\n<p>Before building, just modify some files:</p>\n<p>Delete all  <strong>align</strong>(sizeof(T)) or  <strong>align</strong>(8)  in following three files:<br>\ntensorflow/core/kernels/depthwise_conv_op_gpu.cu.cc<br>\ntensorflow/core/kernels/split_lib_gpu.cu.cc<br>\ntensorflow/core/kernels/concat_lib_gpu_impl.cu.cc</p>\n<p>Disable linkopts = [\u201c-lgomp\u201d] in file:<br>\ntensorflow/third_party/gpus/cuda/BUILD.tpl</p>\n<p>Delete \"constexpr\" in \"constexpr Variant() noexcept = default; \" in file:<br>\ntensorflow/core/framework/variant.h</p>\n<p>Because NCCL will not work on Mac computer, we need delete each item contained nccl in<br>\ntensorflow/contrib/BUILD<br>\ntensorflow/contrib/distribute/python/BUILD<br>\ntensorflow/contrib/all_reduce/BUILD</p>\n<p>especially in tensorflow/contrib/BUILD , modified like following:</p>\n<p>\"\"//tensorflow/contrib/text:all_kernels\",<br>\n] + if_mpi([\"//tensorflow/contrib/mpi_collectives:mpi_collectives_py\"]) + select({<br>\n\"//tensorflow:android\": [],<br>\n\"<br>\nThese operation will disable nccl related function in tensorflow running on Mac.</p>\n<p>Then use</p>\n<ol>\n<li>\n<p>./configure</p>\n</li>\n<li>\n<p>bazel build --config=cuda --config=opt --action_env PATH --action_env LD_LIBRARY_PATH --action_env DYLD_LIBRARY_PATH //tensorflow/tools/pip_package:build_pip_package</p>\n</li>\n<li>\n<p>./bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg</p>\n</li>\n<li>\n<p>cd /tmp/tensorflow_pkg</p>\n</li>\n<li>\n<p>pip install tensorflow-1.12.0rc0-cp36-cp36m-macosx_10_7_x86_64.whl</p>\n</li>\n</ol>\n<p>Then try to run it. It will be OK!</p>", "body_text": "MacOS users do not upgrade to MacOS Mojave if you want to use tensorflow.\nI use it on MacOS 10.13.6. with Xcode 9.2  CUDA 9.2\nBuild with newest source code from github.\nI use anaconda so the \".bash_profile\" file is below:\nadded by Anaconda3 5.2.0 installer\nexport PATH=\"/Users/username/anaconda3/bin:$PATH\"\nexport CUDA_HOME=/usr/local/cuda\nexport DYLD_LIBRARY_PATH=/usr/local/cuda/lib:/usr/local/cuda/extras/CUPTI/lib:/Developer/NVIDIA/CUDA-9.2/lib\nexport PATH=$DYLD_LIBRARY_PATH:$PATH:/Developer/NVIDIA/CUDA-9.2/bin\n[ Download NCCL v2.3.5, for CUDA 9.2, Sept 25, 2018 ]\nhttps://developer.nvidia.com/nccl/nccl-download\nNCCL 2.3.5 O/S agnostic and CUDA 9.2\ntar xvf nccl_2.3.5-2+cuda9.2_x86_64.txz (cd ~/Downloads)\ncd nccl_2.3.5-2+cuda9.2_x86_64/lib\nsudo mv * /Developer/NVIDIA/CUDA-9.2/lib/\ncd nccl_2.3.5-2+cuda9.2_x86_64/include\nsudo mv nccl.h /Developer/NVIDIA/CUDA-9.2/include/\ncd tensorflow/third_party/nccl/\nln -s /Developer/NVIDIA/CUDA-9.2/include/nccl.h\nAnd Download CUDNN  and install to related path.\nBefore building, just modify some files:\nDelete all  align(sizeof(T)) or  align(8)  in following three files:\ntensorflow/core/kernels/depthwise_conv_op_gpu.cu.cc\ntensorflow/core/kernels/split_lib_gpu.cu.cc\ntensorflow/core/kernels/concat_lib_gpu_impl.cu.cc\nDisable linkopts = [\u201c-lgomp\u201d] in file:\ntensorflow/third_party/gpus/cuda/BUILD.tpl\nDelete \"constexpr\" in \"constexpr Variant() noexcept = default; \" in file:\ntensorflow/core/framework/variant.h\nBecause NCCL will not work on Mac computer, we need delete each item contained nccl in\ntensorflow/contrib/BUILD\ntensorflow/contrib/distribute/python/BUILD\ntensorflow/contrib/all_reduce/BUILD\nespecially in tensorflow/contrib/BUILD , modified like following:\n\"\"//tensorflow/contrib/text:all_kernels\",\n] + if_mpi([\"//tensorflow/contrib/mpi_collectives:mpi_collectives_py\"]) + select({\n\"//tensorflow:android\": [],\n\"\nThese operation will disable nccl related function in tensorflow running on Mac.\nThen use\n\n\n./configure\n\n\nbazel build --config=cuda --config=opt --action_env PATH --action_env LD_LIBRARY_PATH --action_env DYLD_LIBRARY_PATH //tensorflow/tools/pip_package:build_pip_package\n\n\n./bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg\n\n\ncd /tmp/tensorflow_pkg\n\n\npip install tensorflow-1.12.0rc0-cp36-cp36m-macosx_10_7_x86_64.whl\n\n\nThen try to run it. It will be OK!", "body": "MacOS users do not upgrade to MacOS Mojave if you want to use tensorflow.\r\n I use it on MacOS 10.13.6. with Xcode 9.2  CUDA 9.2\r\n\r\nBuild with newest source code from github.\r\n\r\nI use anaconda so the \".bash_profile\" file is below:\r\n\r\n# added by Anaconda3 5.2.0 installer\r\nexport PATH=\"/Users/username/anaconda3/bin:$PATH\"\r\n\r\nexport CUDA_HOME=/usr/local/cuda\r\nexport DYLD_LIBRARY_PATH=/usr/local/cuda/lib:/usr/local/cuda/extras/CUPTI/lib:/Developer/NVIDIA/CUDA-9.2/lib\r\nexport PATH=$DYLD_LIBRARY_PATH:$PATH:/Developer/NVIDIA/CUDA-9.2/bin\r\n\r\n[ Download NCCL v2.3.5, for CUDA 9.2, Sept 25, 2018 ]\r\nhttps://developer.nvidia.com/nccl/nccl-download\r\nNCCL 2.3.5 O/S agnostic and CUDA 9.2\r\ntar xvf nccl_2.3.5-2+cuda9.2_x86_64.txz (cd ~/Downloads)\r\ncd nccl_2.3.5-2+cuda9.2_x86_64/lib\r\nsudo mv * /Developer/NVIDIA/CUDA-9.2/lib/\r\ncd nccl_2.3.5-2+cuda9.2_x86_64/include\r\nsudo mv nccl.h /Developer/NVIDIA/CUDA-9.2/include/\r\ncd tensorflow/third_party/nccl/\r\nln -s /Developer/NVIDIA/CUDA-9.2/include/nccl.h\r\n\r\nAnd Download CUDNN  and install to related path.\r\n\r\nBefore building, just modify some files:\r\n\r\nDelete all  __align__(sizeof(T)) or  __align__(8)  in following three files:\r\ntensorflow/core/kernels/depthwise_conv_op_gpu.cu.cc\r\ntensorflow/core/kernels/split_lib_gpu.cu.cc\r\ntensorflow/core/kernels/concat_lib_gpu_impl.cu.cc\r\n\r\n\r\nDisable linkopts = [\u201c-lgomp\u201d] in file:\r\ntensorflow/third_party/gpus/cuda/BUILD.tpl\r\n\r\nDelete \"constexpr\" in \"constexpr Variant() noexcept = default; \" in file:\r\ntensorflow/core/framework/variant.h\r\n\r\nBecause NCCL will not work on Mac computer, we need delete each item contained nccl in \r\ntensorflow/contrib/BUILD\r\ntensorflow/contrib/distribute/python/BUILD\r\ntensorflow/contrib/all_reduce/BUILD\r\n\r\nespecially in tensorflow/contrib/BUILD , modified like following:\r\n\r\n\"\"//tensorflow/contrib/text:all_kernels\",\r\n    ] + if_mpi([\"//tensorflow/contrib/mpi_collectives:mpi_collectives_py\"]) + select({\r\n        \"//tensorflow:android\": [],\r\n\"\r\nThese operation will disable nccl related function in tensorflow running on Mac.\r\n\r\nThen use \r\n1. ./configure\r\n2. bazel build --config=cuda --config=opt --action_env PATH --action_env LD_LIBRARY_PATH --action_env DYLD_LIBRARY_PATH //tensorflow/tools/pip_package:build_pip_package\r\n3. ./bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg\r\n\r\n4. cd /tmp/tensorflow_pkg\r\n5. pip install tensorflow-1.12.0rc0-cp36-cp36m-macosx_10_7_x86_64.whl\r\n\r\nThen try to run it. It will be OK!\r\n\r\n\r\n\r\n\r\n\r\n\r\n"}