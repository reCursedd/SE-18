{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19761", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19761/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19761/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19761/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/19761", "id": 329291903, "node_id": "MDU6SXNzdWUzMjkyOTE5MDM=", "number": 19761, "title": "[bug]Function \"NumHyperthreadsPerCore\" may be forgotten to add into windows/port.cc", "user": {"login": "sxlllslgh", "id": 11386258, "node_id": "MDQ6VXNlcjExMzg2MjU4", "avatar_url": "https://avatars0.githubusercontent.com/u/11386258?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sxlllslgh", "html_url": "https://github.com/sxlllslgh", "followers_url": "https://api.github.com/users/sxlllslgh/followers", "following_url": "https://api.github.com/users/sxlllslgh/following{/other_user}", "gists_url": "https://api.github.com/users/sxlllslgh/gists{/gist_id}", "starred_url": "https://api.github.com/users/sxlllslgh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sxlllslgh/subscriptions", "organizations_url": "https://api.github.com/users/sxlllslgh/orgs", "repos_url": "https://api.github.com/users/sxlllslgh/repos", "events_url": "https://api.github.com/users/sxlllslgh/events{/privacy}", "received_events_url": "https://api.github.com/users/sxlllslgh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "robieta", "id": 13089297, "node_id": "MDQ6VXNlcjEzMDg5Mjk3", "avatar_url": "https://avatars0.githubusercontent.com/u/13089297?v=4", "gravatar_id": "", "url": "https://api.github.com/users/robieta", "html_url": "https://github.com/robieta", "followers_url": "https://api.github.com/users/robieta/followers", "following_url": "https://api.github.com/users/robieta/following{/other_user}", "gists_url": "https://api.github.com/users/robieta/gists{/gist_id}", "starred_url": "https://api.github.com/users/robieta/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/robieta/subscriptions", "organizations_url": "https://api.github.com/users/robieta/orgs", "repos_url": "https://api.github.com/users/robieta/repos", "events_url": "https://api.github.com/users/robieta/events{/privacy}", "received_events_url": "https://api.github.com/users/robieta/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "robieta", "id": 13089297, "node_id": "MDQ6VXNlcjEzMDg5Mjk3", "avatar_url": "https://avatars0.githubusercontent.com/u/13089297?v=4", "gravatar_id": "", "url": "https://api.github.com/users/robieta", "html_url": "https://github.com/robieta", "followers_url": "https://api.github.com/users/robieta/followers", "following_url": "https://api.github.com/users/robieta/following{/other_user}", "gists_url": "https://api.github.com/users/robieta/gists{/gist_id}", "starred_url": "https://api.github.com/users/robieta/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/robieta/subscriptions", "organizations_url": "https://api.github.com/users/robieta/orgs", "repos_url": "https://api.github.com/users/robieta/repos", "events_url": "https://api.github.com/users/robieta/events{/privacy}", "received_events_url": "https://api.github.com/users/robieta/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2018-06-05T03:46:02Z", "updated_at": "2018-07-29T13:11:24Z", "closed_at": "2018-07-20T12:47:23Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>I did not alter any code</strong>:</li>\n<li><strong>Windows 10 1803 (Ver. 17134.81)</strong>:</li>\n<li><strong>TensorFlow installed from source</strong>:</li>\n<li><strong>TensorFlow version: 1.8.0</strong>:</li>\n<li><strong>Python version: 3.6.4</strong>:</li>\n<li><strong>No Bazel</strong>:</li>\n<li><strong>Microsoft Visual Studio 2015</strong>:</li>\n<li><strong>CUDA 9.2.88 / cuDNN 7.1.4</strong>:</li>\n<li><strong>NVIDIA GTX 1070 8GB</strong>:</li>\n<li><strong>Build project \"tf_python_build_pip_package\" in Release configuration</strong>:</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>The project \"pywrap_tensorflow_internal\" failed to build, and error was:</p>\n<blockquote>\n<p>threadpool_device.obj : error LNK2019: unresolved external symbol \"int __cdecl tensorflow::port::NumHyperthreadsPerCore(void)\" (?NumHyperthreadsPerCore@port@tensorflow@@YAHXZ) in function \"public: _<em>cdecl tensorflow::ThreadPoolDevice::ThreadPoolDevice(struct tensorflow::SessionOptions const &amp;,class std::basic_string&lt;char,struct std::char_traits,class std::allocator &gt; const &amp;,class tensorflow::gtl::IntType&lt;struct tensorflow::Bytes_tag</em>,_<em>int64&gt;,class tensorflow::DeviceLocality const &amp;,class tensorflow::Allocator *)\" (??0ThreadPoolDevice@tensorflow@@QEAA@AEBUSessionOptions@1@AEBV?$basic_string@DU?$char_traits@D@std@<a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=627846\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/v\">@v</a>?$allocator@D@2@<a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=434613\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/std\">@std</a>@<a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=627846\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/v\">@v</a>?$IntType@UBytes_tag</em><a class=\"user-mention\" data-hovercard-type=\"organization\" data-hovercard-url=\"/orgs/tensorflow/hovercard\" href=\"https://github.com/tensorflow\">@tensorflow</a>@@_J@gtl@1@AEBVDeviceLocality@1@PEAVAllocator@1@<a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=49380\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/z\">@z</a>)</p>\n</blockquote>\n<p>Finally I found that function <code>NumHyperthreadsPerCore</code> was not implemented in <em><strong>tensorflow/core/platform/windows/port.cc</strong></em>, while it was implemented in <em><strong>tensorflow/core/platform/posix/port.cc</strong></em>. Then I copy this function from <strong><em>posix/port.cc</em></strong> to <strong><em>windows/port.cc</em></strong>, it worked.</p>\n<h3>Source code</h3>\n<p><strong><em>tensorflow/core/platform/posix/port.cc</em></strong> line 77-80:</p>\n<pre><code>int NumHyperthreadsPerCore() {\n    static const int ht_per_core = tensorflow::port::CPUIDNumSMT();\n    return (ht_per_core &gt; 0) ? ht_per_core : 1;\n}\n</code></pre>", "body_text": "System information\n\nI did not alter any code:\nWindows 10 1803 (Ver. 17134.81):\nTensorFlow installed from source:\nTensorFlow version: 1.8.0:\nPython version: 3.6.4:\nNo Bazel:\nMicrosoft Visual Studio 2015:\nCUDA 9.2.88 / cuDNN 7.1.4:\nNVIDIA GTX 1070 8GB:\nBuild project \"tf_python_build_pip_package\" in Release configuration:\n\nDescribe the problem\nThe project \"pywrap_tensorflow_internal\" failed to build, and error was:\n\nthreadpool_device.obj : error LNK2019: unresolved external symbol \"int __cdecl tensorflow::port::NumHyperthreadsPerCore(void)\" (?NumHyperthreadsPerCore@port@tensorflow@@YAHXZ) in function \"public: _cdecl tensorflow::ThreadPoolDevice::ThreadPoolDevice(struct tensorflow::SessionOptions const &,class std::basic_string<char,struct std::char_traits,class std::allocator > const &,class tensorflow::gtl::IntType<struct tensorflow::Bytes_tag,_int64>,class tensorflow::DeviceLocality const &,class tensorflow::Allocator *)\" (??0ThreadPoolDevice@tensorflow@@QEAA@AEBUSessionOptions@1@AEBV?$basic_string@DU?$char_traits@D@std@@v?$allocator@D@2@@std@@v?$IntType@UBytes_tag@tensorflow@@_J@gtl@1@AEBVDeviceLocality@1@PEAVAllocator@1@@z)\n\nFinally I found that function NumHyperthreadsPerCore was not implemented in tensorflow/core/platform/windows/port.cc, while it was implemented in tensorflow/core/platform/posix/port.cc. Then I copy this function from posix/port.cc to windows/port.cc, it worked.\nSource code\ntensorflow/core/platform/posix/port.cc line 77-80:\nint NumHyperthreadsPerCore() {\n    static const int ht_per_core = tensorflow::port::CPUIDNumSMT();\n    return (ht_per_core > 0) ? ht_per_core : 1;\n}", "body": "### System information\r\n- **I did not alter any code**:\r\n- **Windows 10 1803 (Ver. 17134.81)**:\r\n- **TensorFlow installed from source**:\r\n- **TensorFlow version: 1.8.0**:\r\n- **Python version: 3.6.4**: \r\n- **No Bazel**:\r\n- **Microsoft Visual Studio 2015**:\r\n- **CUDA 9.2.88 / cuDNN 7.1.4**:\r\n- **NVIDIA GTX 1070 8GB**:\r\n- **Build project \"tf_python_build_pip_package\" in Release configuration**:\r\n\r\n### Describe the problem\r\nThe project \"pywrap_tensorflow_internal\" failed to build, and error was:\r\n\r\n> threadpool_device.obj : error LNK2019: unresolved external symbol \"int __cdecl tensorflow::port::NumHyperthreadsPerCore(void)\" (?NumHyperthreadsPerCore@port@tensorflow@@YAHXZ) in function \"public: __cdecl tensorflow::ThreadPoolDevice::ThreadPoolDevice(struct tensorflow::SessionOptions const &,class std::basic_string<char,struct std::char_traits<char>,class std::allocator<char> > const &,class tensorflow::gtl::IntType<struct tensorflow::Bytes_tag_,__int64>,class tensorflow::DeviceLocality const &,class tensorflow::Allocator *)\" (??0ThreadPoolDevice@tensorflow@@QEAA@AEBUSessionOptions@1@AEBV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@V?$IntType@UBytes_tag_@tensorflow@@_J@gtl@1@AEBVDeviceLocality@1@PEAVAllocator@1@@Z)\r\n\r\nFinally I found that function `NumHyperthreadsPerCore` was not implemented in _**tensorflow/core/platform/windows/port.cc**_, while it was implemented in _**tensorflow/core/platform/posix/port.cc**_. Then I copy this function from **_posix/port.cc_** to **_windows/port.cc_**, it worked.\r\n\r\n### Source code\r\n**_tensorflow/core/platform/posix/port.cc_** line 77-80:\r\n```\r\nint NumHyperthreadsPerCore() {\r\n    static const int ht_per_core = tensorflow::port::CPUIDNumSMT();\r\n    return (ht_per_core > 0) ? ht_per_core : 1;\r\n}\r\n```\r\n"}