{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/197935855", "html_url": "https://github.com/tensorflow/tensorflow/issues/616#issuecomment-197935855", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/616", "id": 197935855, "node_id": "MDEyOklzc3VlQ29tbWVudDE5NzkzNTg1NQ==", "user": {"login": "po0ya", "id": 1000100, "node_id": "MDQ6VXNlcjEwMDAxMDA=", "avatar_url": "https://avatars3.githubusercontent.com/u/1000100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/po0ya", "html_url": "https://github.com/po0ya", "followers_url": "https://api.github.com/users/po0ya/followers", "following_url": "https://api.github.com/users/po0ya/following{/other_user}", "gists_url": "https://api.github.com/users/po0ya/gists{/gist_id}", "starred_url": "https://api.github.com/users/po0ya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/po0ya/subscriptions", "organizations_url": "https://api.github.com/users/po0ya/orgs", "repos_url": "https://api.github.com/users/po0ya/repos", "events_url": "https://api.github.com/users/po0ya/events{/privacy}", "received_events_url": "https://api.github.com/users/po0ya/received_events", "type": "User", "site_admin": false}, "created_at": "2016-03-17T15:36:47Z", "updated_at": "2016-03-17T15:53:53Z", "author_association": "NONE", "body_html": "<p>I'm facing the same problem as <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=16718087\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/yutachen\">@yutachen</a> when I call import_graph_def</p>\n<p>My function that saves the graph looks like:</p>\n<pre><code>def save_graph(inference_func,checkpoint_path,image_size,dest_path):\n    \"\"\" Saves a computation graph with all it's variables.\n    :param inference_func: the function that builds the graph and gets image input\n    :param checkpoint_path: the path to a checkpoint containing values of variables\n    :param image_size: the image input size\n    :param dest_path: file path to save the graph definition protocol buffer\n    :return:\n    \"\"\"\n\n    g = tf.Graph()\n    vars = {}\n    with g.as_default():\n        with tf.Session() as sess:\n            d = np.ones([1,conf.parts_avg_size[5][1],conf.parts_avg_size[5][0],3],dtype=np.float32)\n\n            input_data = tf.placeholder(tf.float32,shape=[1,image_size[1],image_size[0],3], name=\"input_placeholder\")\n            logits = inference_func(input_data)\n\n            init = tf.initialize_all_variables()\n            sess.run(init) #TODO for testing, remove later\n            saver = tf.train.Saver(tf.trainable_variables(),max_to_keep=0)\n            saver.restore(sess,checkpoint_path)\n\n            print sess.run(logits,{input_data:d})\n            for v in tf.trainable_variables():\n                vars[v.name] = sess.run(v)\n\n\n    g2 = tf.Graph()\n    consts = {}\n    with g2.as_default():\n        with tf.Session() as sess:\n            for k in vars.keys():\n                consts[k] = tf.constant(vars[k])\n            tf.import_graph_def(g.as_graph_def(),input_map={name:consts[name] for name in consts.keys()})\n\n            tf.train.write_graph(sess.graph_def,dest_path,'graph.pbtxt',False)\n\n    return os.path.join(dest_path,'graph.pbtxt')\n</code></pre>\n<p>and I'm getting<br>\n<code>ValueError: graph_def is invalid at node u'conv1/weigths/Assign': Input tensor 'conv1/weigths:0' Cannot convert a tensor of type float32 to an input of type float32_ref.</code></p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=8920899\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jonathanponce\">@jonathanponce</a> can you take a look?</p>", "body_text": "I'm facing the same problem as @yutachen when I call import_graph_def\nMy function that saves the graph looks like:\ndef save_graph(inference_func,checkpoint_path,image_size,dest_path):\n    \"\"\" Saves a computation graph with all it's variables.\n    :param inference_func: the function that builds the graph and gets image input\n    :param checkpoint_path: the path to a checkpoint containing values of variables\n    :param image_size: the image input size\n    :param dest_path: file path to save the graph definition protocol buffer\n    :return:\n    \"\"\"\n\n    g = tf.Graph()\n    vars = {}\n    with g.as_default():\n        with tf.Session() as sess:\n            d = np.ones([1,conf.parts_avg_size[5][1],conf.parts_avg_size[5][0],3],dtype=np.float32)\n\n            input_data = tf.placeholder(tf.float32,shape=[1,image_size[1],image_size[0],3], name=\"input_placeholder\")\n            logits = inference_func(input_data)\n\n            init = tf.initialize_all_variables()\n            sess.run(init) #TODO for testing, remove later\n            saver = tf.train.Saver(tf.trainable_variables(),max_to_keep=0)\n            saver.restore(sess,checkpoint_path)\n\n            print sess.run(logits,{input_data:d})\n            for v in tf.trainable_variables():\n                vars[v.name] = sess.run(v)\n\n\n    g2 = tf.Graph()\n    consts = {}\n    with g2.as_default():\n        with tf.Session() as sess:\n            for k in vars.keys():\n                consts[k] = tf.constant(vars[k])\n            tf.import_graph_def(g.as_graph_def(),input_map={name:consts[name] for name in consts.keys()})\n\n            tf.train.write_graph(sess.graph_def,dest_path,'graph.pbtxt',False)\n\n    return os.path.join(dest_path,'graph.pbtxt')\n\nand I'm getting\nValueError: graph_def is invalid at node u'conv1/weigths/Assign': Input tensor 'conv1/weigths:0' Cannot convert a tensor of type float32 to an input of type float32_ref.\n@jonathanponce can you take a look?", "body": "I'm facing the same problem as @yutachen when I call import_graph_def\n\nMy function that saves the graph looks like:\n\n```\ndef save_graph(inference_func,checkpoint_path,image_size,dest_path):\n    \"\"\" Saves a computation graph with all it's variables.\n    :param inference_func: the function that builds the graph and gets image input\n    :param checkpoint_path: the path to a checkpoint containing values of variables\n    :param image_size: the image input size\n    :param dest_path: file path to save the graph definition protocol buffer\n    :return:\n    \"\"\"\n\n    g = tf.Graph()\n    vars = {}\n    with g.as_default():\n        with tf.Session() as sess:\n            d = np.ones([1,conf.parts_avg_size[5][1],conf.parts_avg_size[5][0],3],dtype=np.float32)\n\n            input_data = tf.placeholder(tf.float32,shape=[1,image_size[1],image_size[0],3], name=\"input_placeholder\")\n            logits = inference_func(input_data)\n\n            init = tf.initialize_all_variables()\n            sess.run(init) #TODO for testing, remove later\n            saver = tf.train.Saver(tf.trainable_variables(),max_to_keep=0)\n            saver.restore(sess,checkpoint_path)\n\n            print sess.run(logits,{input_data:d})\n            for v in tf.trainable_variables():\n                vars[v.name] = sess.run(v)\n\n\n    g2 = tf.Graph()\n    consts = {}\n    with g2.as_default():\n        with tf.Session() as sess:\n            for k in vars.keys():\n                consts[k] = tf.constant(vars[k])\n            tf.import_graph_def(g.as_graph_def(),input_map={name:consts[name] for name in consts.keys()})\n\n            tf.train.write_graph(sess.graph_def,dest_path,'graph.pbtxt',False)\n\n    return os.path.join(dest_path,'graph.pbtxt')\n```\n\nand I'm getting\n`ValueError: graph_def is invalid at node u'conv1/weigths/Assign': Input tensor 'conv1/weigths:0' Cannot convert a tensor of type float32 to an input of type float32_ref.`\n\n@jonathanponce can you take a look?\n"}