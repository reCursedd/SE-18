{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/278095854", "html_url": "https://github.com/tensorflow/tensorflow/issues/7268#issuecomment-278095854", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7268", "id": 278095854, "node_id": "MDEyOklzc3VlQ29tbWVudDI3ODA5NTg1NA==", "user": {"login": "Montmorency", "id": 962924, "node_id": "MDQ6VXNlcjk2MjkyNA==", "avatar_url": "https://avatars2.githubusercontent.com/u/962924?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Montmorency", "html_url": "https://github.com/Montmorency", "followers_url": "https://api.github.com/users/Montmorency/followers", "following_url": "https://api.github.com/users/Montmorency/following{/other_user}", "gists_url": "https://api.github.com/users/Montmorency/gists{/gist_id}", "starred_url": "https://api.github.com/users/Montmorency/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Montmorency/subscriptions", "organizations_url": "https://api.github.com/users/Montmorency/orgs", "repos_url": "https://api.github.com/users/Montmorency/repos", "events_url": "https://api.github.com/users/Montmorency/events{/privacy}", "received_events_url": "https://api.github.com/users/Montmorency/received_events", "type": "User", "site_admin": false}, "created_at": "2017-02-07T18:30:44Z", "updated_at": "2017-02-07T18:30:44Z", "author_association": "NONE", "body_html": "<p>Thanks for response!<br>\nBazel</p>\n<pre><code> [bazel release 0.4.4- (@non-git)]\n</code></pre>\n<p>Distro</p>\n<pre><code>$cat /etc/issue\n  Scientific Linux release 6.6 (Carbon)\n  Kernel \\r on an \\m\n$uname -r\n  2.6.32-431.17.1.el6.x86_64\n$uname -i\n  x86_64\n$gcc --version\ngcc (GCC) 6.2.0\nCopyright (C) 2016 Free Software Foundation, Inc.\n\n</code></pre>\n<p>Update:<br>\nI had a closer look and started using a more recent compiler. The NFS is not an issue. Closer inspection of the output pointed to failure to do with JEMALLOC_THP and some undefined variable(MADV_NOHUGEPAGE). I think the cluster has an older linux kernel. I manually removed these flags from the jemalloc/BUILD file and compilation completed without any further issues:<br>\ndeleted:<br>\n\"#undef JEMALLOC_THP\": \"#define JEMALLOC_THP\",<br>\n\"#undef JEMALLOC_HAVE_SECURE_GETENV\": \"#define JEMALLOC_HAVE_SECURE_GETENV\",</p>\n<p>I removed the second flag when the build failed at linking stage I think this is related to an older version of openssl on the cluster which configure didn't seem to detect (getenv rather than secure_getenv). Training the models is fine with this build but I do still a strange glibc error when running model.predict_proba():</p>\n<p>*** glibc detected *** python: double free or corruption (!prev): 0x0000000001375da0 ***<br>\n======= Backtrace: =========<br>\n/lib64/libc.so.6[0x3168e75e66]<br>\n/lib64/libc.so.6[0x3168e789b3]<br>\n/lib64/ld-linux-x86-64.so.2(_dl_deallocate_tls+0x67)[0x31686112f7]<br>\n/lib64/libpthread.so.0[0x316920675d]<br>\n/lib64/libpthread.so.0[0x31692078ea]<br>\n/lib64/libpthread.so.0(pthread_join+0xd4)[0x31692081f4]<br>\n/opt/apps/compilers/gcc/6.2.0/lib64/libstdc++.so.6(_ZNSt6thread4joinEv+0x27)[0x7fbc4ea24a77]<br>\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(+0x248c310)[0x7fbc51186310]<br>\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow6thread10ThreadPool4ImplD0Ev+0x144)[0x7fbc51160594]<br>\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow10FileSystem16GetMatchingPathsERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEPSt6vectorIS6_SaIS6_EE+0x5ce)[0x7fbc511830de]<br>\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow3Env16GetMatchingPathsERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEPSt6vectorIS6_SaIS6_EE+0xab)[0x7fbc5117f7eb]<br>\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(+0x986bfb)[0x7fbc4f680bfb]<br>\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(+0x9877c4)[0x7fbc4f6817c4]</p>", "body_text": "Thanks for response!\nBazel\n [bazel release 0.4.4- (@non-git)]\n\nDistro\n$cat /etc/issue\n  Scientific Linux release 6.6 (Carbon)\n  Kernel \\r on an \\m\n$uname -r\n  2.6.32-431.17.1.el6.x86_64\n$uname -i\n  x86_64\n$gcc --version\ngcc (GCC) 6.2.0\nCopyright (C) 2016 Free Software Foundation, Inc.\n\n\nUpdate:\nI had a closer look and started using a more recent compiler. The NFS is not an issue. Closer inspection of the output pointed to failure to do with JEMALLOC_THP and some undefined variable(MADV_NOHUGEPAGE). I think the cluster has an older linux kernel. I manually removed these flags from the jemalloc/BUILD file and compilation completed without any further issues:\ndeleted:\n\"#undef JEMALLOC_THP\": \"#define JEMALLOC_THP\",\n\"#undef JEMALLOC_HAVE_SECURE_GETENV\": \"#define JEMALLOC_HAVE_SECURE_GETENV\",\nI removed the second flag when the build failed at linking stage I think this is related to an older version of openssl on the cluster which configure didn't seem to detect (getenv rather than secure_getenv). Training the models is fine with this build but I do still a strange glibc error when running model.predict_proba():\n*** glibc detected *** python: double free or corruption (!prev): 0x0000000001375da0 ***\n======= Backtrace: =========\n/lib64/libc.so.6[0x3168e75e66]\n/lib64/libc.so.6[0x3168e789b3]\n/lib64/ld-linux-x86-64.so.2(_dl_deallocate_tls+0x67)[0x31686112f7]\n/lib64/libpthread.so.0[0x316920675d]\n/lib64/libpthread.so.0[0x31692078ea]\n/lib64/libpthread.so.0(pthread_join+0xd4)[0x31692081f4]\n/opt/apps/compilers/gcc/6.2.0/lib64/libstdc++.so.6(_ZNSt6thread4joinEv+0x27)[0x7fbc4ea24a77]\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(+0x248c310)[0x7fbc51186310]\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow6thread10ThreadPool4ImplD0Ev+0x144)[0x7fbc51160594]\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow10FileSystem16GetMatchingPathsERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEPSt6vectorIS6_SaIS6_EE+0x5ce)[0x7fbc511830de]\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow3Env16GetMatchingPathsERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEPSt6vectorIS6_SaIS6_EE+0xab)[0x7fbc5117f7eb]\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(+0x986bfb)[0x7fbc4f680bfb]\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(+0x9877c4)[0x7fbc4f6817c4]", "body": "Thanks for response!\r\nBazel\r\n```\r\n [bazel release 0.4.4- (@non-git)]\r\n```\r\nDistro\r\n```\r\n$cat /etc/issue\r\n  Scientific Linux release 6.6 (Carbon)\r\n  Kernel \\r on an \\m\r\n$uname -r\r\n  2.6.32-431.17.1.el6.x86_64\r\n$uname -i\r\n  x86_64\r\n$gcc --version\r\ngcc (GCC) 6.2.0\r\nCopyright (C) 2016 Free Software Foundation, Inc.\r\n\r\n```\r\nUpdate: \r\nI had a closer look and started using a more recent compiler. The NFS is not an issue. Closer inspection of the output pointed to failure to do with JEMALLOC_THP and some undefined variable(MADV_NOHUGEPAGE). I think the cluster has an older linux kernel. I manually removed these flags from the jemalloc/BUILD file and compilation completed without any further issues:\r\ndeleted:\r\n\"#undef JEMALLOC_THP\": \"#define JEMALLOC_THP\",\r\n\"#undef JEMALLOC_HAVE_SECURE_GETENV\": \"#define JEMALLOC_HAVE_SECURE_GETENV\",\r\n\r\nI removed the second flag when the build failed at linking stage I think this is related to an older version of openssl on the cluster which configure didn't seem to detect (getenv rather than secure_getenv). Training the models is fine with this build but I do still a strange glibc error when running model.predict_proba():\r\n\r\n*** glibc detected *** python: double free or corruption (!prev): 0x0000000001375da0 ***\r\n======= Backtrace: =========\r\n/lib64/libc.so.6[0x3168e75e66]\r\n/lib64/libc.so.6[0x3168e789b3]\r\n/lib64/ld-linux-x86-64.so.2(_dl_deallocate_tls+0x67)[0x31686112f7]\r\n/lib64/libpthread.so.0[0x316920675d]\r\n/lib64/libpthread.so.0[0x31692078ea]\r\n/lib64/libpthread.so.0(pthread_join+0xd4)[0x31692081f4]\r\n/opt/apps/compilers/gcc/6.2.0/lib64/libstdc++.so.6(_ZNSt6thread4joinEv+0x27)[0x7fbc4ea24a77]\r\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(+0x248c310)[0x7fbc51186310]\r\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow6thread10ThreadPool4ImplD0Ev+0x144)[0x7fbc51160594]\r\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow10FileSystem16GetMatchingPathsERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEPSt6vectorIS6_SaIS6_EE+0x5ce)[0x7fbc511830de]\r\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(_ZN10tensorflow3Env16GetMatchingPathsERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEPSt6vectorIS6_SaIS6_EE+0xab)[0x7fbc5117f7eb]\r\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(+0x986bfb)[0x7fbc4f680bfb]\r\n/users/k1511981/.pyenv/versions/t2/lib/python2.7/site-packages/tensorflow/python/_pywrap_tensorflow.so(+0x9877c4)[0x7fbc4f6817c4]\r\n"}