{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20665", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20665/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20665/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20665/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/20665", "id": 339771147, "node_id": "MDExOlB1bGxSZXF1ZXN0MjAwMzQwNTk1", "number": 20665, "title": "Fix masking of beam ids in gather_tree_from_array", "user": {"login": "guillaumekln", "id": 4805513, "node_id": "MDQ6VXNlcjQ4MDU1MTM=", "avatar_url": "https://avatars3.githubusercontent.com/u/4805513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guillaumekln", "html_url": "https://github.com/guillaumekln", "followers_url": "https://api.github.com/users/guillaumekln/followers", "following_url": "https://api.github.com/users/guillaumekln/following{/other_user}", "gists_url": "https://api.github.com/users/guillaumekln/gists{/gist_id}", "starred_url": "https://api.github.com/users/guillaumekln/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guillaumekln/subscriptions", "organizations_url": "https://api.github.com/users/guillaumekln/orgs", "repos_url": "https://api.github.com/users/guillaumekln/repos", "events_url": "https://api.github.com/users/guillaumekln/events{/privacy}", "received_events_url": "https://api.github.com/users/guillaumekln/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}, {"id": 987666414, "node_id": "MDU6TGFiZWw5ODc2NjY0MTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/ready%20to%20pull", "name": "ready to pull", "color": "2cd643", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "qlzh727", "id": 5118881, "node_id": "MDQ6VXNlcjUxMTg4ODE=", "avatar_url": "https://avatars3.githubusercontent.com/u/5118881?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qlzh727", "html_url": "https://github.com/qlzh727", "followers_url": "https://api.github.com/users/qlzh727/followers", "following_url": "https://api.github.com/users/qlzh727/following{/other_user}", "gists_url": "https://api.github.com/users/qlzh727/gists{/gist_id}", "starred_url": "https://api.github.com/users/qlzh727/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qlzh727/subscriptions", "organizations_url": "https://api.github.com/users/qlzh727/orgs", "repos_url": "https://api.github.com/users/qlzh727/repos", "events_url": "https://api.github.com/users/qlzh727/events{/privacy}", "received_events_url": "https://api.github.com/users/qlzh727/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "qlzh727", "id": 5118881, "node_id": "MDQ6VXNlcjUxMTg4ODE=", "avatar_url": "https://avatars3.githubusercontent.com/u/5118881?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qlzh727", "html_url": "https://github.com/qlzh727", "followers_url": "https://api.github.com/users/qlzh727/followers", "following_url": "https://api.github.com/users/qlzh727/following{/other_user}", "gists_url": "https://api.github.com/users/qlzh727/gists{/gist_id}", "starred_url": "https://api.github.com/users/qlzh727/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qlzh727/subscriptions", "organizations_url": "https://api.github.com/users/qlzh727/orgs", "repos_url": "https://api.github.com/users/qlzh727/repos", "events_url": "https://api.github.com/users/qlzh727/events{/privacy}", "received_events_url": "https://api.github.com/users/qlzh727/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2018-07-10T09:51:49Z", "updated_at": "2018-07-13T19:59:45Z", "closed_at": "2018-07-13T18:36:43Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/20665", "html_url": "https://github.com/tensorflow/tensorflow/pull/20665", "diff_url": "https://github.com/tensorflow/tensorflow/pull/20665.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/20665.patch"}, "body_html": "<p>The <code>sequence_length</code> argument that is passed to the function is the<br>\nlengths of the <strong>reordered</strong> predictions and was incorrectly used to<br>\nmask beam ids <em>before</em> reordering. Instead, we can reorder beam ids<br>\nwithout caring about out of range steps and only select the reodered<br>\nids that are in bounds.</p>\n<p>The added test covers a beam trajectory that previously produced an<br>\nout of range error because <code>gather_tree</code> returned <code>end_token</code> (here<br>\n<code>beam_width + 1</code>) for some steps.</p>", "body_text": "The sequence_length argument that is passed to the function is the\nlengths of the reordered predictions and was incorrectly used to\nmask beam ids before reordering. Instead, we can reorder beam ids\nwithout caring about out of range steps and only select the reodered\nids that are in bounds.\nThe added test covers a beam trajectory that previously produced an\nout of range error because gather_tree returned end_token (here\nbeam_width + 1) for some steps.", "body": "The `sequence_length` argument that is passed to the function is the\r\nlengths of the **reordered** predictions and was incorrectly used to\r\nmask beam ids *before* reordering. Instead, we can reorder beam ids\r\nwithout caring about out of range steps and only select the reodered\r\nids that are in bounds.\r\n\r\nThe added test covers a beam trajectory that previously produced an\r\nout of range error because `gather_tree` returned `end_token` (here\r\n`beam_width + 1`) for some steps."}