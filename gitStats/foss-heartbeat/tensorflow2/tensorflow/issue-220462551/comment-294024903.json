{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/294024903", "html_url": "https://github.com/tensorflow/tensorflow/issues/9080#issuecomment-294024903", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9080", "id": 294024903, "node_id": "MDEyOklzc3VlQ29tbWVudDI5NDAyNDkwMw==", "user": {"login": "elefthei", "id": 766892, "node_id": "MDQ6VXNlcjc2Njg5Mg==", "avatar_url": "https://avatars0.githubusercontent.com/u/766892?v=4", "gravatar_id": "", "url": "https://api.github.com/users/elefthei", "html_url": "https://github.com/elefthei", "followers_url": "https://api.github.com/users/elefthei/followers", "following_url": "https://api.github.com/users/elefthei/following{/other_user}", "gists_url": "https://api.github.com/users/elefthei/gists{/gist_id}", "starred_url": "https://api.github.com/users/elefthei/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/elefthei/subscriptions", "organizations_url": "https://api.github.com/users/elefthei/orgs", "repos_url": "https://api.github.com/users/elefthei/repos", "events_url": "https://api.github.com/users/elefthei/events{/privacy}", "received_events_url": "https://api.github.com/users/elefthei/received_events", "type": "User", "site_admin": false}, "created_at": "2017-04-13T21:21:26Z", "updated_at": "2017-04-13T21:21:57Z", "author_association": "CONTRIBUTOR", "body_html": "<p>I investigated this a bit, it appears calling:</p>\n<p><code>tensorflow/core/common_runtime/gpu/gpu_device.cc:    cudaError_t err = cudaStreamAddCallback(*stream_, asyncFree, afData, 0);</code></p>\n<p>Gives an error 71</p>\n<blockquote>\n<p>cudaErrorNotSupported = 71<br>\nThis error indicates the attempted operation is not supported on the current system or device.</p>\n</blockquote>\n<p>Read more at: <a href=\"http://docs.nvidia.com/cuda/cuda-runtime-api/index.html#ixzz4eAO2YpQp\" rel=\"nofollow\">http://docs.nvidia.com/cuda/cuda-runtime-api/index.html#ixzz4eAO2YpQp</a></p>\n<p>I think this is probably from MPS since I run the same program on single process Cuda and <code>cudaStreamAddCallback</code> passes without errors.</p>\n<p>It seems that is the only place<br>\nthat <code>cudaStreamAddCallback</code> is called inside the whole tensorflow project, maybe can we find an MPS friendly implementation for <code>deallocate</code>.</p>", "body_text": "I investigated this a bit, it appears calling:\ntensorflow/core/common_runtime/gpu/gpu_device.cc:    cudaError_t err = cudaStreamAddCallback(*stream_, asyncFree, afData, 0);\nGives an error 71\n\ncudaErrorNotSupported = 71\nThis error indicates the attempted operation is not supported on the current system or device.\n\nRead more at: http://docs.nvidia.com/cuda/cuda-runtime-api/index.html#ixzz4eAO2YpQp\nI think this is probably from MPS since I run the same program on single process Cuda and cudaStreamAddCallback passes without errors.\nIt seems that is the only place\nthat cudaStreamAddCallback is called inside the whole tensorflow project, maybe can we find an MPS friendly implementation for deallocate.", "body": "I investigated this a bit, it appears calling:\r\n\r\n`tensorflow/core/common_runtime/gpu/gpu_device.cc:    cudaError_t err = cudaStreamAddCallback(*stream_, asyncFree, afData, 0);`\r\n\r\nGives an error 71 \r\n\r\n> cudaErrorNotSupported = 71\r\n> This error indicates the attempted operation is not supported on the current system or device.\r\n> \r\n\r\nRead more at: http://docs.nvidia.com/cuda/cuda-runtime-api/index.html#ixzz4eAO2YpQp \r\n\r\nI think this is probably from MPS since I run the same program on single process Cuda and `cudaStreamAddCallback` passes without errors. \r\n\r\nIt seems that is the only place\r\nthat `cudaStreamAddCallback` is called inside the whole tensorflow project, maybe can we find an MPS friendly implementation for `deallocate`."}