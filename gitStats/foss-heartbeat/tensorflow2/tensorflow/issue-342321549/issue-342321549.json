{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20923", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20923/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20923/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20923/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/20923", "id": 342321549, "node_id": "MDExOlB1bGxSZXF1ZXN0MjAyMjQ3Njkx", "number": 20923, "title": "Floating point type issue when computing extract images patches gradient", "user": {"login": "kekeblom", "id": 1204635, "node_id": "MDQ6VXNlcjEyMDQ2MzU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1204635?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kekeblom", "html_url": "https://github.com/kekeblom", "followers_url": "https://api.github.com/users/kekeblom/followers", "following_url": "https://api.github.com/users/kekeblom/following{/other_user}", "gists_url": "https://api.github.com/users/kekeblom/gists{/gist_id}", "starred_url": "https://api.github.com/users/kekeblom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kekeblom/subscriptions", "organizations_url": "https://api.github.com/users/kekeblom/orgs", "repos_url": "https://api.github.com/users/kekeblom/repos", "events_url": "https://api.github.com/users/kekeblom/events{/privacy}", "received_events_url": "https://api.github.com/users/kekeblom/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}, {"id": 987666414, "node_id": "MDU6TGFiZWw5ODc2NjY0MTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/ready%20to%20pull", "name": "ready to pull", "color": "2cd643", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "rmlarsen", "id": 16907534, "node_id": "MDQ6VXNlcjE2OTA3NTM0", "avatar_url": "https://avatars2.githubusercontent.com/u/16907534?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rmlarsen", "html_url": "https://github.com/rmlarsen", "followers_url": "https://api.github.com/users/rmlarsen/followers", "following_url": "https://api.github.com/users/rmlarsen/following{/other_user}", "gists_url": "https://api.github.com/users/rmlarsen/gists{/gist_id}", "starred_url": "https://api.github.com/users/rmlarsen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rmlarsen/subscriptions", "organizations_url": "https://api.github.com/users/rmlarsen/orgs", "repos_url": "https://api.github.com/users/rmlarsen/repos", "events_url": "https://api.github.com/users/rmlarsen/events{/privacy}", "received_events_url": "https://api.github.com/users/rmlarsen/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "rmlarsen", "id": 16907534, "node_id": "MDQ6VXNlcjE2OTA3NTM0", "avatar_url": "https://avatars2.githubusercontent.com/u/16907534?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rmlarsen", "html_url": "https://github.com/rmlarsen", "followers_url": "https://api.github.com/users/rmlarsen/followers", "following_url": "https://api.github.com/users/rmlarsen/following{/other_user}", "gists_url": "https://api.github.com/users/rmlarsen/gists{/gist_id}", "starred_url": "https://api.github.com/users/rmlarsen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rmlarsen/subscriptions", "organizations_url": "https://api.github.com/users/rmlarsen/orgs", "repos_url": "https://api.github.com/users/rmlarsen/repos", "events_url": "https://api.github.com/users/rmlarsen/events{/privacy}", "received_events_url": "https://api.github.com/users/rmlarsen/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2018-07-18T13:09:58Z", "updated_at": "2018-07-20T22:58:32Z", "closed_at": "2018-07-20T22:58:32Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/20923", "html_url": "https://github.com/tensorflow/tensorflow/pull/20923", "diff_url": "https://github.com/tensorflow/tensorflow/pull/20923.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/20923.patch"}, "body_html": "<p>I was using <code>tf.extract_image_patches</code> when I ran into this issue.</p>\n<p>It seems <code>sp_mat</code> here becomes a 32 bit floating point number as the sparse tensor inherits the floating point type from the values argument. If one is using float64 and the gradient is float64 computing the jacobian on the next line will result in the error \"TypeError: Input 'b' of 'SparseTensorDenseMatMul' Op has type float64 that does not match type float32 of argument 'a_values'\".</p>\n<p>Inheriting the floating point type from the gradient should fix the issue.</p>", "body_text": "I was using tf.extract_image_patches when I ran into this issue.\nIt seems sp_mat here becomes a 32 bit floating point number as the sparse tensor inherits the floating point type from the values argument. If one is using float64 and the gradient is float64 computing the jacobian on the next line will result in the error \"TypeError: Input 'b' of 'SparseTensorDenseMatMul' Op has type float64 that does not match type float32 of argument 'a_values'\".\nInheriting the floating point type from the gradient should fix the issue.", "body": "I was using `tf.extract_image_patches` when I ran into this issue. \r\n\r\nIt seems `sp_mat` here becomes a 32 bit floating point number as the sparse tensor inherits the floating point type from the values argument. If one is using float64 and the gradient is float64 computing the jacobian on the next line will result in the error \"TypeError: Input 'b' of 'SparseTensorDenseMatMul' Op has type float64 that does not match type float32 of argument 'a_values'\".\r\n\r\nInheriting the floating point type from the gradient should fix the issue."}