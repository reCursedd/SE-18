{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19268", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19268/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19268/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19268/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/19268", "id": 322799620, "node_id": "MDU6SXNzdWUzMjI3OTk2MjA=", "number": 19268, "title": "Error when freeze the graph", "user": {"login": "xav12358", "id": 12400238, "node_id": "MDQ6VXNlcjEyNDAwMjM4", "avatar_url": "https://avatars2.githubusercontent.com/u/12400238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xav12358", "html_url": "https://github.com/xav12358", "followers_url": "https://api.github.com/users/xav12358/followers", "following_url": "https://api.github.com/users/xav12358/following{/other_user}", "gists_url": "https://api.github.com/users/xav12358/gists{/gist_id}", "starred_url": "https://api.github.com/users/xav12358/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xav12358/subscriptions", "organizations_url": "https://api.github.com/users/xav12358/orgs", "repos_url": "https://api.github.com/users/xav12358/repos", "events_url": "https://api.github.com/users/xav12358/events{/privacy}", "received_events_url": "https://api.github.com/users/xav12358/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "tatatodd", "id": 5453737, "node_id": "MDQ6VXNlcjU0NTM3Mzc=", "avatar_url": "https://avatars3.githubusercontent.com/u/5453737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tatatodd", "html_url": "https://github.com/tatatodd", "followers_url": "https://api.github.com/users/tatatodd/followers", "following_url": "https://api.github.com/users/tatatodd/following{/other_user}", "gists_url": "https://api.github.com/users/tatatodd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tatatodd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tatatodd/subscriptions", "organizations_url": "https://api.github.com/users/tatatodd/orgs", "repos_url": "https://api.github.com/users/tatatodd/repos", "events_url": "https://api.github.com/users/tatatodd/events{/privacy}", "received_events_url": "https://api.github.com/users/tatatodd/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "tatatodd", "id": 5453737, "node_id": "MDQ6VXNlcjU0NTM3Mzc=", "avatar_url": "https://avatars3.githubusercontent.com/u/5453737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tatatodd", "html_url": "https://github.com/tatatodd", "followers_url": "https://api.github.com/users/tatatodd/followers", "following_url": "https://api.github.com/users/tatatodd/following{/other_user}", "gists_url": "https://api.github.com/users/tatatodd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tatatodd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tatatodd/subscriptions", "organizations_url": "https://api.github.com/users/tatatodd/orgs", "repos_url": "https://api.github.com/users/tatatodd/repos", "events_url": "https://api.github.com/users/tatatodd/events{/privacy}", "received_events_url": "https://api.github.com/users/tatatodd/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2018-05-14T12:41:36Z", "updated_at": "2018-10-05T21:55:16Z", "closed_at": "2018-10-05T21:55:16Z", "author_association": "NONE", "body_html": "<p>Information:</p>\n<ul>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Ubuntu 16.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary 1.5</li>\n<li><strong>Python version</strong>: 3.5</li>\n<li><strong>CUDA/cuDNN version</strong>: No</li>\n</ul>\n<p>Hello,</p>\n<p>I use a model, in my code I save the model with that command:<br>\n<code>                writer = tf.summary.FileWriter(\"/tmp/model4/MTCNN/\", self.sess.graph) saver = tf.train.Saver() #saver load pretrain model save_path = tf.train.Saver().save(self.sess, \"/tmp/model4/MTCNN/model.ckpt\")</code></p>\n<p>It generates me these files:</p>\n<pre><code>/tmp/model4/MTCNN/checkpoint\n/tmp/model4/MTCNN/events.out.tfevents.1526300275.xavier-Inspiron\n/tmp/model4/MTCNN/model.ckpt.data-00000-of-00001\n/tmp/model4/MTCNN/model.ckpt.index\n/tmp/model4/MTCNN/model.ckpt.meta\n</code></pre>\n<p>I reload this saved model and graph with that code:</p>\n<pre><code>               self.sess = tf.Session()\n                model_path = \"/tmp/model4/MTCNN/model.ckpt\"\n                model_path_p = \"/tmp/model4/MTCNN/\"\n                self.sess.run(tf.global_variables_initializer())\n                new_saver = tf.train.import_meta_graph(model_path + '.meta')\n                new_saver.restore(self.sess,tf.train.latest_checkpoint(model_path_p))\n</code></pre>\n<p>And this works properly. Now I want to freeze my model in pb file with that command:<br>\n<code>python3 ./tensorflow/python/tools/freeze_graph.py --input_checkpoint=/tmp/model4/MTCNN/model.ckpt.data-00000-of-00001 --input_meta_graph_def=/tmp/model4/MTCNN/model.ckpt.meta  --output_graph=frozen_graph.pb --output_node_names='pnet/conv4-2/BiasAdd'</code></p>\n<p>And I get that errors:</p>\n<p><code>2018-05-14 14:35:20.597234: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA 2018-05-14 14:35:20.598060: W tensorflow/core/util/tensor_slice_reader.cc:95] Could not open /tmp/model4/FaceFeature/model.ckpt.data-00000-of-00001: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator? Traceback (most recent call last): File \"./tensorflow/python/tools/freeze_graph.py\", line 360, in &lt;module&gt; app.run(main=main, argv=[sys.argv[0]] + unparsed) File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/platform/app.py\", line 48, in run _sys.exit(main(_sys.argv[:1] + flags_passthrough)) File \"./tensorflow/python/tools/freeze_graph.py\", line 254, in main FLAGS.saved_model_tags, FLAGS.checkpoint_version) File \"./tensorflow/python/tools/freeze_graph.py\", line 244, in freeze_graph saved_model_tags.split(\",\"), checkpoint_version=checkpoint_version) File \"./tensorflow/python/tools/freeze_graph.py\", line 119, in freeze_graph_with_def_protos reader = pywrap_tensorflow.NewCheckpointReader(input_checkpoint) File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/pywrap_tensorflow_internal.py\", line 150, in NewCheckpointReader return CheckpointReader(compat.as_bytes(filepattern), status) File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/errors_impl.py\", line 473, in __exit__ c_api.TF_GetCode(self.status.status)) tensorflow.python.framework.errors_impl.DataLossError: Unable to open table file /tmp/model4/FaceFeature/model.ckpt.data-00000-of-00001: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator? </code></p>", "body_text": "Information:\n\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Ubuntu 16.04\nTensorFlow installed from (source or binary): binary 1.5\nPython version: 3.5\nCUDA/cuDNN version: No\n\nHello,\nI use a model, in my code I save the model with that command:\n                writer = tf.summary.FileWriter(\"/tmp/model4/MTCNN/\", self.sess.graph) saver = tf.train.Saver() #saver load pretrain model save_path = tf.train.Saver().save(self.sess, \"/tmp/model4/MTCNN/model.ckpt\")\nIt generates me these files:\n/tmp/model4/MTCNN/checkpoint\n/tmp/model4/MTCNN/events.out.tfevents.1526300275.xavier-Inspiron\n/tmp/model4/MTCNN/model.ckpt.data-00000-of-00001\n/tmp/model4/MTCNN/model.ckpt.index\n/tmp/model4/MTCNN/model.ckpt.meta\n\nI reload this saved model and graph with that code:\n               self.sess = tf.Session()\n                model_path = \"/tmp/model4/MTCNN/model.ckpt\"\n                model_path_p = \"/tmp/model4/MTCNN/\"\n                self.sess.run(tf.global_variables_initializer())\n                new_saver = tf.train.import_meta_graph(model_path + '.meta')\n                new_saver.restore(self.sess,tf.train.latest_checkpoint(model_path_p))\n\nAnd this works properly. Now I want to freeze my model in pb file with that command:\npython3 ./tensorflow/python/tools/freeze_graph.py --input_checkpoint=/tmp/model4/MTCNN/model.ckpt.data-00000-of-00001 --input_meta_graph_def=/tmp/model4/MTCNN/model.ckpt.meta  --output_graph=frozen_graph.pb --output_node_names='pnet/conv4-2/BiasAdd'\nAnd I get that errors:\n2018-05-14 14:35:20.597234: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA 2018-05-14 14:35:20.598060: W tensorflow/core/util/tensor_slice_reader.cc:95] Could not open /tmp/model4/FaceFeature/model.ckpt.data-00000-of-00001: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator? Traceback (most recent call last): File \"./tensorflow/python/tools/freeze_graph.py\", line 360, in <module> app.run(main=main, argv=[sys.argv[0]] + unparsed) File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/platform/app.py\", line 48, in run _sys.exit(main(_sys.argv[:1] + flags_passthrough)) File \"./tensorflow/python/tools/freeze_graph.py\", line 254, in main FLAGS.saved_model_tags, FLAGS.checkpoint_version) File \"./tensorflow/python/tools/freeze_graph.py\", line 244, in freeze_graph saved_model_tags.split(\",\"), checkpoint_version=checkpoint_version) File \"./tensorflow/python/tools/freeze_graph.py\", line 119, in freeze_graph_with_def_protos reader = pywrap_tensorflow.NewCheckpointReader(input_checkpoint) File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/pywrap_tensorflow_internal.py\", line 150, in NewCheckpointReader return CheckpointReader(compat.as_bytes(filepattern), status) File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/errors_impl.py\", line 473, in __exit__ c_api.TF_GetCode(self.status.status)) tensorflow.python.framework.errors_impl.DataLossError: Unable to open table file /tmp/model4/FaceFeature/model.ckpt.data-00000-of-00001: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?", "body": "Information:\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Ubuntu 16.04\r\n- **TensorFlow installed from (source or binary)**: binary 1.5\r\n- **Python version**: 3.5\r\n- **CUDA/cuDNN version**: No\r\n\r\nHello,\r\n\r\nI use a model, in my code I save the model with that command:\r\n`                writer = tf.summary.FileWriter(\"/tmp/model4/MTCNN/\", self.sess.graph)\r\n                saver = tf.train.Saver() #saver load pretrain model\r\n                save_path = tf.train.Saver().save(self.sess, \"/tmp/model4/MTCNN/model.ckpt\")`\r\n\r\nIt generates me these files:\r\n```\r\n/tmp/model4/MTCNN/checkpoint\r\n/tmp/model4/MTCNN/events.out.tfevents.1526300275.xavier-Inspiron\r\n/tmp/model4/MTCNN/model.ckpt.data-00000-of-00001\r\n/tmp/model4/MTCNN/model.ckpt.index\r\n/tmp/model4/MTCNN/model.ckpt.meta\r\n```\r\n\r\nI reload this saved model and graph with that code:\r\n\r\n```\r\n               self.sess = tf.Session()\r\n                model_path = \"/tmp/model4/MTCNN/model.ckpt\"\r\n                model_path_p = \"/tmp/model4/MTCNN/\"\r\n                self.sess.run(tf.global_variables_initializer())\r\n                new_saver = tf.train.import_meta_graph(model_path + '.meta')\r\n                new_saver.restore(self.sess,tf.train.latest_checkpoint(model_path_p))\r\n```\r\n\r\nAnd this works properly. Now I want to freeze my model in pb file with that command:\r\n`python3 ./tensorflow/python/tools/freeze_graph.py --input_checkpoint=/tmp/model4/MTCNN/model.ckpt.data-00000-of-00001 --input_meta_graph_def=/tmp/model4/MTCNN/model.ckpt.meta  --output_graph=frozen_graph.pb --output_node_names='pnet/conv4-2/BiasAdd'`\r\n\r\nAnd I get that errors:\r\n\r\n`2018-05-14 14:35:20.597234: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\r\n2018-05-14 14:35:20.598060: W tensorflow/core/util/tensor_slice_reader.cc:95] Could not open /tmp/model4/FaceFeature/model.ckpt.data-00000-of-00001: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\r\nTraceback (most recent call last):\r\n  File \"./tensorflow/python/tools/freeze_graph.py\", line 360, in <module>\r\n    app.run(main=main, argv=[sys.argv[0]] + unparsed)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/platform/app.py\", line 48, in run\r\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\r\n  File \"./tensorflow/python/tools/freeze_graph.py\", line 254, in main\r\n    FLAGS.saved_model_tags, FLAGS.checkpoint_version)\r\n  File \"./tensorflow/python/tools/freeze_graph.py\", line 244, in freeze_graph\r\n    saved_model_tags.split(\",\"), checkpoint_version=checkpoint_version)\r\n  File \"./tensorflow/python/tools/freeze_graph.py\", line 119, in freeze_graph_with_def_protos\r\n    reader = pywrap_tensorflow.NewCheckpointReader(input_checkpoint)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/pywrap_tensorflow_internal.py\", line 150, in NewCheckpointReader\r\n    return CheckpointReader(compat.as_bytes(filepattern), status)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/errors_impl.py\", line 473, in __exit__\r\n    c_api.TF_GetCode(self.status.status))\r\ntensorflow.python.framework.errors_impl.DataLossError: Unable to open table file /tmp/model4/FaceFeature/model.ckpt.data-00000-of-00001: Data loss: not an sstable (bad magic number): perhaps your file is in a different file format and you need to use a different restore operator?\r\n`\r\n"}