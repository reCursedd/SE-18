{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/93797621", "pull_request_review_id": 14332868, "id": 93797621, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDkzNzk3NjIx", "diff_hunk": "@@ -274,50 +276,118 @@ cc_library(\n     nocopts = libjpegturbo_nocopts,\n )\n \n+expand_header_template(\n+    name = \"jconfig_win\",\n+    out = \"jconfig_win.h\",\n+    substitutions = {\n+        \"@JPEG_LIB_VERSION@\" : \"62\",\n+        \"@VERSION@\" : \"1.5.1\",\n+        \"@LIBJPEG_TURBO_VERSION_NUMBER@\" : \"1005001\",\n+        \"cmakedefine\" : \"define\",\n+        \"@BITS_IN_JSAMPLE@\" : \"8\",\n+    },\n+    template = \"win/jconfig.h.in\",\n+)\n+\n+expand_header_template(\n+    name = \"jconfigint_win\",\n+    out = \"jconfigint_win.h\",\n+    substitutions = {\n+        \"@VERSION@\" : \"1.5.1\",\n+        \"@BUILD@\" : \"20161115\",\n+        \"@CMAKE_PROJECT_NAME@\" : \"libjpeg-turbo\",\n+    },\n+    template = \"win/jconfigint.h.in\",\n+)\n+\n+jconfig_nowin_common_substitutions = {\n+    \"LIBJPEG_TURBO_VERSION 0\" : \"LIBJPEG_TURBO_VERSION 1.5.1\",\n+    \"LIBJPEG_TURBO_VERSION_NUMBER 0\" : \"LIBJPEG_TURBO_VERSION_NUMBER 1005001\",\n+    \"#undef C_ARITH_CODING_SUPPORTED\" : \"#define C_ARITH_CODING_SUPPORTED 1\",\n+    \"#undef D_ARITH_CODING_SUPPORTED\" : \"#define D_ARITH_CODING_SUPPORTED 1\",\n+    \"#undef HAVE_LOCALE_H\" : \"#define HAVE_LOCALE_H 1\",\n+    \"#undef HAVE_STDDEF_H\" : \"#define HAVE_STDDEF_H 1\",\n+    \"#undef HAVE_STDLIB_H\" : \"#define HAVE_STDLIB_H 1\",\n+    \"#undef HAVE_UNSIGNED_CHAR\" : \"#define HAVE_UNSIGNED_CHAR 1\",\n+    \"#undef HAVE_UNSIGNED_SHORT\" : \"#define HAVE_UNSIGNED_SHORT 1\",\n+    \"#undef INCOMPLETE_TYPES_BROKEN\" : \"\",\n+    \"#undef MEM_SRCDST_SUPPORTED\" : \"#define MEM_SRCDST_SUPPORTED 1\",\n+    \"#undef NEED_BSD_STRINGS\" : \"\",\n+    \"#undef NEED_SYS_TYPES_H\" : \"#define NEED_SYS_TYPES_H 1\",\n+    \"#undef __CHAR_UNSIGNED__\" : \"\",\n+    \"#undef const\" : \"\",\n+    \"#undef size_t\" : \"\",\n+    \"#undef RIGHT_SHIFT_IS_UNSIGNED\" : \"\",\n+}\n+\n+jconfig_nowin_simd_substitutions = jconfig_nowin_common_substitutions + {\n+    \"#undef WITH_SIMD\": \"#define WITH_SIMD 1\",\n+}\n+\n+jconfig_nowin_nosimd_substitutions = jconfig_nowin_common_substitutions + {\n+    \"#undef WITH_SIMD\": \"\",\n+}\n+\n+expand_header_template(\n+    name = \"jconfig_nowin_nosimd\",\n+    out = \"jconfig_nowin_nosimd.h\",\n+    substitutions = jconfig_nowin_nosimd_substitutions,\n+    template = \"jconfig.h.in\",\n+)\n+\n+expand_header_template(\n+    name = \"jconfig_nowin_simd\",\n+    out = \"jconfig_nowin_simd.h\",\n+    substitutions = jconfig_nowin_simd_substitutions,\n+    template = \"jconfig.h.in\",\n+)\n+\n+expand_header_template(\n+    name = \"jconfigint_nowin\",\n+    out = \"jconfigint_nowin.h\",\n+    substitutions = {\n+        \"#undef BUILD\" : \"#define BUILD \\\"20161115\\\"\",\n+        \"#undef inline\" : \"\",\n+        \"#undef INLINE\" : \"#define INLINE inline __attribute__((always_inline))\",\n+        \"#undef PACKAGE_NAME\" : \"#define PACKAGE_NAME \\\"libjpeg-turbo\\\"\",\n+        \"#undef VERSION\" : \"#define VERSION \\\"1.5.1\\\"\",\n+        \"#undef SIZEOF_SIZE_T\" : \"#if (__WORDSIZE==64 && !defined(__native_client__))\\n\" +\n+            \"#define SIZEOF_SIZE_T 8\\n\" +\n+            \"#else\\n\" +\n+            \"#define SIZEOF_SIZE_T 4\\n\" +\n+            \"#endif\\n\",\n+    },\n+    template = \"jconfigint.h.in\",\n+)\n+\n genrule(\n     name = \"configure\",\n     outs = [\"jconfig.h\"],\n-    cmd = \"cat <<'EOF' >$@\\n\" +\n-          \"#define JPEG_LIB_VERSION 62\\n\" +\n-          \"#define LIBJPEG_TURBO_VERSION 1.5.1\\n\" +\n-          \"#define LIBJPEG_TURBO_VERSION_NUMBER 1005001\\n\" +\n-          \"#define C_ARITH_CODING_SUPPORTED 1\\n\" +\n-          \"#define D_ARITH_CODING_SUPPORTED 1\\n\" +\n-          \"#define BITS_IN_JSAMPLE 8\\n\" +\n-          \"#define HAVE_LOCALE_H 1\\n\" +\n-          \"#define HAVE_STDDEF_H 1\\n\" +\n-          \"#define HAVE_STDLIB_H 1\\n\" +\n-          \"#define HAVE_UNSIGNED_CHAR 1\\n\" +\n-          \"#define HAVE_UNSIGNED_SHORT 1\\n\" +\n-          \"#define MEM_SRCDST_SUPPORTED 1\\n\" +\n-          \"#define NEED_SYS_TYPES_H 1\\n\" +\n-          select({\n-              \":k8\": \"#define WITH_SIMD 1\\n\",\n-              \":armeabi-v7a\": \"#define WITH_SIMD 1\\n\",\n-              \":arm64-v8a\": \"#define WITH_SIMD 1\\n\",\n-              \"//conditions:default\": \"\",\n-          }) +\n-          \"EOF\",\n+    srcs = [\n+        \":jconfig_win\",\n+        \":jconfig_nowin_nosimd\",\n+        \":jconfig_nowin_simd\",\n+    ],\n+    cmd = select({\n+        \":windows\": \"cp $(locations :jconfig_win) $(@D)/jconfig.h\",\n+        \":k8\": \"cp $(locations :jconfig_nowin_simd) $(@D)/jconfig.h\",\n+        \":armeabi-v7a\": \"cp $(locations :jconfig_nowin_simd) $(@D)/jconfig.h\",\n+        \":arm64-v8a\": \"cp $(locations :jconfig_nowin_simd) $(@D)/jconfig.h\",\n+        \"//conditions:default\": \"cp $(locations :jconfig_nowin_nosimd) $(@D)/jconfig.h\",\n+    }),\n )\n \n genrule(\n     name = \"configure_internal\",\n     outs = [\"jconfigint.h\"],\n-    cmd = \"cat <<'EOF' >$@\\n\" +\n-          \"#define BUILD \\\"20161115\\\"\\n\" +\n-          \"#ifdef _MSC_VER  /* Windows */\\n\" +\n-          \"#define INLINE __inline\\n\" +\n-          \"#else\\n\" +\n-          \"#define INLINE inline __attribute__((always_inline))\\n\" +\n-          \"#endif\\n\" +\n-          \"#define PACKAGE_NAME \\\"libjpeg-turbo\\\"\\n\" +\n-          \"#define VERSION \\\"1.5.1\\\"\\n\" +\n-          \"#if (__WORDSIZE==64 && !defined(__native_client__)) || defined(_WIN64)\\n\" +\n-          \"#define SIZEOF_SIZE_T 8\\n\" +\n-          \"#else\\n\" +\n-          \"#define SIZEOF_SIZE_T 4\\n\" +\n-          \"#endif\\n\" +\n-          \"EOF\",\n+    srcs = [\n+        \":jconfigint_win\",\n+        \":jconfigint_nowin\",\n+    ],\n+    cmd = select({\n+        \":windows\": \"cp $(locations :jconfigint_win) $(@D)/jconfigint.h\",", "path": "third_party/jpeg/jpeg.BUILD", "position": null, "original_position": 158, "commit_id": "9bffde4980cbe1a9a77d6ab6962ec89293e7f5b6", "original_commit_id": "1e9ed820139f489e17fee294d72a42522e6297bf", "user": {"login": "jart", "id": 49262, "node_id": "MDQ6VXNlcjQ5MjYy", "avatar_url": "https://avatars1.githubusercontent.com/u/49262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jart", "html_url": "https://github.com/jart", "followers_url": "https://api.github.com/users/jart/followers", "following_url": "https://api.github.com/users/jart/following{/other_user}", "gists_url": "https://api.github.com/users/jart/gists{/gist_id}", "starred_url": "https://api.github.com/users/jart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jart/subscriptions", "organizations_url": "https://api.github.com/users/jart/orgs", "repos_url": "https://api.github.com/users/jart/repos", "events_url": "https://api.github.com/users/jart/events{/privacy}", "received_events_url": "https://api.github.com/users/jart/received_events", "type": "User", "site_admin": false}, "body": "`$@` can be used for the output argument.", "created_at": "2016-12-23T19:49:04Z", "updated_at": "2016-12-24T05:04:17Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/6462#discussion_r93797621", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/6462", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/93797621"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/6462#discussion_r93797621"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/6462"}}, "body_html": "<p><code>$@</code> can be used for the output argument.</p>", "body_text": "$@ can be used for the output argument."}