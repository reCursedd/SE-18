{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16026", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16026/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16026/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16026/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/16026", "id": 287648073, "node_id": "MDU6SXNzdWUyODc2NDgwNzM=", "number": 16026, "title": "can't use mpi_allreduce op when tensors run on gpus", "user": {"login": "thzhao", "id": 16260616, "node_id": "MDQ6VXNlcjE2MjYwNjE2", "avatar_url": "https://avatars0.githubusercontent.com/u/16260616?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thzhao", "html_url": "https://github.com/thzhao", "followers_url": "https://api.github.com/users/thzhao/followers", "following_url": "https://api.github.com/users/thzhao/following{/other_user}", "gists_url": "https://api.github.com/users/thzhao/gists{/gist_id}", "starred_url": "https://api.github.com/users/thzhao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thzhao/subscriptions", "organizations_url": "https://api.github.com/users/thzhao/orgs", "repos_url": "https://api.github.com/users/thzhao/repos", "events_url": "https://api.github.com/users/thzhao/events{/privacy}", "received_events_url": "https://api.github.com/users/thzhao/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586558, "node_id": "MDU6TGFiZWw0MDQ1ODY1NTg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:community%20support", "name": "stat:community support", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "jart", "id": 49262, "node_id": "MDQ6VXNlcjQ5MjYy", "avatar_url": "https://avatars1.githubusercontent.com/u/49262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jart", "html_url": "https://github.com/jart", "followers_url": "https://api.github.com/users/jart/followers", "following_url": "https://api.github.com/users/jart/following{/other_user}", "gists_url": "https://api.github.com/users/jart/gists{/gist_id}", "starred_url": "https://api.github.com/users/jart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jart/subscriptions", "organizations_url": "https://api.github.com/users/jart/orgs", "repos_url": "https://api.github.com/users/jart/repos", "events_url": "https://api.github.com/users/jart/events{/privacy}", "received_events_url": "https://api.github.com/users/jart/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jart", "id": 49262, "node_id": "MDQ6VXNlcjQ5MjYy", "avatar_url": "https://avatars1.githubusercontent.com/u/49262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jart", "html_url": "https://github.com/jart", "followers_url": "https://api.github.com/users/jart/followers", "following_url": "https://api.github.com/users/jart/following{/other_user}", "gists_url": "https://api.github.com/users/jart/gists{/gist_id}", "starred_url": "https://api.github.com/users/jart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jart/subscriptions", "organizations_url": "https://api.github.com/users/jart/orgs", "repos_url": "https://api.github.com/users/jart/repos", "events_url": "https://api.github.com/users/jart/events{/privacy}", "received_events_url": "https://api.github.com/users/jart/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2018-01-11T02:59:49Z", "updated_at": "2018-05-07T09:09:20Z", "closed_at": "2018-05-04T00:07:13Z", "author_association": "NONE", "body_html": "<p>I compiled and installed new mpi_collective feature with openmpi3.0 on tensorflow 1.5.  When I use allreduce function to aggregate loss, I got segmentation fault errors. However, When I force code to run on CPU device, it's fine.</p>\n<p><strong>## here is my runtime environment.</strong><br>\n== cat /etc/issue ===============================================<br>\nLinux user-ubuntu 3.19.0-25-generic <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"115939021\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/26\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/26/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/26\">#26</a>~14.04.1-Ubuntu SMP Fri Jul 24 21:16:20 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux<br>\nVERSION=\"14.04.5 LTS, Trusty Tahr\"<br>\nVERSION_ID=\"14.04\"</p>\n<p>== are we in docker =============================================<br>\nNo</p>\n<p>== compiler =====================================================<br>\nc++ (Ubuntu 4.8.4-2ubuntu1~14.04.3) 4.8.4<br>\nCopyright (C) 2013 Free Software Foundation, Inc.<br>\nThis is free software; see the source for copying conditions.  There is NO<br>\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</p>\n<p>== uname -a =====================================================<br>\nLinux user-ubuntu 3.19.0-25-generic <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"115939021\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/26\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/26/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/26\">#26</a>~14.04.1-Ubuntu SMP Fri Jul 24 21:16:20 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux</p>\n<p>== check pips ===================================================<br>\nnumpy (1.13.3)<br>\nprotobuf (3.5.1)<br>\ntensorflow (1.5.0rc0)<br>\ntensorflow-tensorboard (0.4.0rc2)</p>\n<p>== tensorflow import ============================================<br>\ntf.VERSION = 1.5.0-rc0<br>\ntf.GIT_VERSION = unknown<br>\ntf.COMPILER_VERSION = unknown<br>\nSanity check: array([1], dtype=int32)</p>\n<p>== env ==========================================================<br>\nLD_LIBRARY_PATH is unset<br>\nDYLD_LIBRARY_PATH is unset</p>\n<p>== nvidia-smi ===================================================<br>\nWed Jan 10 21:56:08 2018<br>\n+-----------------------------------------------------------------------------+<br>\n| NVIDIA-SMI 375.66                 Driver Version: 375.66                    |<br>\n|-------------------------------+----------------------+----------------------+<br>\n| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |<br>\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |<br>\n|===============================+======================+======================|<br>\n|   0  Tesla P100-PCIE...  Off  | 0000:06:00.0     Off |                    0 |<br>\n| N/A   27C    P0    27W / 250W |      0MiB / 16276MiB |      0%      Default |<br>\n+-------------------------------+----------------------+----------------------+<br>\n|   1  Tesla P100-PCIE...  Off  | 0000:84:00.0     Off |                    0 |<br>\n| N/A   25C    P0    27W / 250W |      0MiB / 16276MiB |      3%      Default |<br>\n+-------------------------------+----------------------+----------------------+</p>\n<p>+-----------------------------------------------------------------------------+<br>\n| Processes:                                                       GPU Memory |<br>\n|  GPU       PID  Type  Process name                               Usage      |<br>\n|=============================================================================|<br>\n|  No running processes found                                                 |<br>\n+-----------------------------------------------------------------------------+</p>\n<p>== cuda libs  ===================================================<br>\n/usr/local/cuda-8.0/lib64/libcudart_static.a<br>\n/usr/local/cuda-8.0/lib64/libcudart.so.8.0.61<br>\n/usr/local/cuda-8.0/doc/man/man7/libcudart.so.7<br>\n/usr/local/cuda-8.0/doc/man/man7/libcudart.7<br>\n/usr/local/cuda-8.0/targets/x86_64-linux/lib/libcudart.so.8.0.61</p>\n<p><strong>##here is error.</strong></p>\n<p>tensor@user-ubuntu:~/tensorflow-r1.4/tensorflow/contrib/mpi_collectives$ mpirun -n 2 python mpi_simple_nn.py</p>\n<h2>2018-01-10 21:50:44.579981: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA<br>\n2018-01-10 21:50:44.580748: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA<br>\n2018-01-10 21:50:47.127209: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1206] Found device 0 with properties:<br>\nname: Tesla P100-PCIE-16GB major: 6 minor: 0 memoryClockRate(GHz): 1.3285<br>\npciBusID: 0000:06:00.0<br>\ntotalMemory: 15.89GiB freeMemory: 15.34GiB<br>\n2018-01-10 21:50:47.127952: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1206] Found device 0 with properties:<br>\nname: Tesla P100-PCIE-16GB major: 6 minor: 0 memoryClockRate(GHz): 1.3285<br>\npciBusID: 0000:06:00.0<br>\ntotalMemory: 15.89GiB freeMemory: 15.34GiB<br>\n2018-01-10 21:50:48.027960: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1206] Found device 1 with properties:<br>\nname: Tesla P100-PCIE-16GB major: 6 minor: 0 memoryClockRate(GHz): 1.3285<br>\npciBusID: 0000:84:00.0<br>\ntotalMemory: 15.89GiB freeMemory: 15.34GiB<br>\n2018-01-10 21:50:48.028762: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1206] Found device 1 with properties:<br>\nname: Tesla P100-PCIE-16GB major: 6 minor: 0 memoryClockRate(GHz): 1.3285<br>\npciBusID: 0000:84:00.0<br>\ntotalMemory: 15.89GiB freeMemory: 15.34GiB<br>\n2018-01-10 21:50:48.028835: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1221] Device peer to peer matrix<br>\n2018-01-10 21:50:48.028932: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1221] Device peer to peer matrix<br>\n2018-01-10 21:50:48.028886: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1227] DMA: 0 1<br>\n2018-01-10 21:50:48.028910: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1237] 0:   Y N<br>\n2018-01-10 21:50:48.028926: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1237] 1:   N Y<br>\n2018-01-10 21:50:48.028933: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1300] Adding visible gpu device 0<br>\n2018-01-10 21:50:48.028938: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1300] Adding visible gpu device 1<br>\n2018-01-10 21:50:48.028966: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1227] DMA: 0 1<br>\n2018-01-10 21:50:48.028974: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1237] 0:   Y N<br>\n2018-01-10 21:50:48.028979: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1237] 1:   N Y<br>\n2018-01-10 21:50:48.028994: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1300] Adding visible gpu device 0<br>\n2018-01-10 21:50:48.029000: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1300] Adding visible gpu device 1<br>\n2018-01-10 21:50:48.568865: I tensorflow/core/common_runtime/gpu/gpu_device.cc:987] Creating TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14824 MB memory) -&gt; physical GPU (device: 0, name: Tesla P100-PCIE-16GB, pci bus id: 0000:06:00.0, compute capability: 6.0)<br>\n2018-01-10 21:50:48.668728: I tensorflow/core/common_runtime/gpu/gpu_device.cc:987] Creating TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 553 MB memory) -&gt; physical GPU (device: 0, name: Tesla P100-PCIE-16GB, pci bus id: 0000:06:00.0, compute capability: 6.0)<br>\n2018-01-10 21:50:48.676343: I tensorflow/core/common_runtime/gpu/gpu_device.cc:987] Creating TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:1 with 14824 MB memory) -&gt; physical GPU (device: 1, name: Tesla P100-PCIE-16GB, pci bus id: 0000:84:00.0, compute capability: 6.0)<br>\n2018-01-10 21:50:48.708625: I tensorflow/core/common_runtime/gpu/gpu_device.cc:987] Creating TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:1 with 553 MB memory) -&gt; physical GPU (device: 1, name: Tesla P100-PCIE-16GB, pci bus id: 0000:84:00.0, compute capability: 6.0)<br>\nmy_rank  1<br>\nmy_rank  0<br>\n[user-ubuntu:49967] *** Process received signal ***<br>\n[user-ubuntu:49967] Signal: Segmentation fault (11)<br>\n[user-ubuntu:49967] Signal code: Invalid permissions (2)<br>\n[user-ubuntu:49967] Failing at address: 0x1042c005000<br>\n[user-ubuntu:49967] [ 0] /lib/x86_64-linux-gnu/libpthread.so.0(+0x10330)[0x7f2122752330]<br>\n[user-ubuntu:49967] [ 1] /lib/x86_64-linux-gnu/libc.so.6(+0x9ac36)[0x7f2122413c36]<br>\n[user-ubuntu:49967] [ 2] /usr/local/openmpi3/lib/openmpi/mca_btl_vader.so(mca_btl_vader_sendi+0x332)[0x7f1fd5d9b832]<br>\n[user-ubuntu:49967] [ 3] /usr/local/openmpi3/lib/openmpi/mca_pml_ob1.so(+0xb6eb)[0x7f1fd63c86eb]<br>\n[user-ubuntu:49967] [ 4] /usr/local/openmpi3/lib/openmpi/mca_pml_ob1.so(mca_pml_ob1_send+0x690)[0x7f1fd63ca130]<br>\n[user-ubuntu:49967] [ 5] /usr/local/openmpi3/lib/libmpi.so.40(PMPI_Send+0xf2)[0x7f1ffc59d062]<br>\n[user-ubuntu:49967] [ 6] /usr/local/lib/python2.7/dist-packages/tensorflow/contrib/mpi_collectives/python/ops/_mpi_ops.so(<em>ZN10tensorflow7contrib15mpi_collectives13RingAllreduceIN5Eigen9GpuDeviceEfEENS_6StatusEPNS_15OpKernelContextEPKNS_6TensorEPS8_SB</em>+0x14f)[0x7f21082b50bf]<br>\n[user-ubuntu:49967] [ 7] /usr/local/lib/python2.7/dist-packages/tensorflow/contrib/mpi_collectives/python/ops/_mpi_ops.so(+0x1cab9)[0x7f21082aaab9]<br>\n[user-ubuntu:49967] [ 8] /usr/local/lib/python2.7/dist-packages/tensorflow/contrib/mpi_collectives/python/ops/_mpi_ops.so(+0x23760)[0x7f21082b1760]<br>\n[user-ubuntu:49967] [ 9] /usr/lib/x86_64-linux-gnu/libstdc++.so.6(+0xb1a60)[0x7f1ff5c48a60]<br>\n[user-ubuntu:49967] [10] /lib/x86_64-linux-gnu/libpthread.so.0(+0x8184)[0x7f212274a184]<br>\n[user-ubuntu:49967] [11] /lib/x86_64-linux-gnu/libc.so.6(clone+0x6d)[0x7f2122476ffd]<br>\n[user-ubuntu:49967] *** End of error message ***</h2>\n<h2>Primary job  terminated normally, but 1 process returned<br>\na non-zero exit code. Per user-direction, the job has been aborted.</h2>\n<hr>\n<p>mpirun noticed that process rank 0 with PID 0 on node user-ubuntu exited on signal 11 (Segmentation fault)</p>", "body_text": "I compiled and installed new mpi_collective feature with openmpi3.0 on tensorflow 1.5.  When I use allreduce function to aggregate loss, I got segmentation fault errors. However, When I force code to run on CPU device, it's fine.\n## here is my runtime environment.\n== cat /etc/issue ===============================================\nLinux user-ubuntu 3.19.0-25-generic #26~14.04.1-Ubuntu SMP Fri Jul 24 21:16:20 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\nVERSION=\"14.04.5 LTS, Trusty Tahr\"\nVERSION_ID=\"14.04\"\n== are we in docker =============================================\nNo\n== compiler =====================================================\nc++ (Ubuntu 4.8.4-2ubuntu1~14.04.3) 4.8.4\nCopyright (C) 2013 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n== uname -a =====================================================\nLinux user-ubuntu 3.19.0-25-generic #26~14.04.1-Ubuntu SMP Fri Jul 24 21:16:20 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\n== check pips ===================================================\nnumpy (1.13.3)\nprotobuf (3.5.1)\ntensorflow (1.5.0rc0)\ntensorflow-tensorboard (0.4.0rc2)\n== tensorflow import ============================================\ntf.VERSION = 1.5.0-rc0\ntf.GIT_VERSION = unknown\ntf.COMPILER_VERSION = unknown\nSanity check: array([1], dtype=int32)\n== env ==========================================================\nLD_LIBRARY_PATH is unset\nDYLD_LIBRARY_PATH is unset\n== nvidia-smi ===================================================\nWed Jan 10 21:56:08 2018\n+-----------------------------------------------------------------------------+\n| NVIDIA-SMI 375.66                 Driver Version: 375.66                    |\n|-------------------------------+----------------------+----------------------+\n| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n|===============================+======================+======================|\n|   0  Tesla P100-PCIE...  Off  | 0000:06:00.0     Off |                    0 |\n| N/A   27C    P0    27W / 250W |      0MiB / 16276MiB |      0%      Default |\n+-------------------------------+----------------------+----------------------+\n|   1  Tesla P100-PCIE...  Off  | 0000:84:00.0     Off |                    0 |\n| N/A   25C    P0    27W / 250W |      0MiB / 16276MiB |      3%      Default |\n+-------------------------------+----------------------+----------------------+\n+-----------------------------------------------------------------------------+\n| Processes:                                                       GPU Memory |\n|  GPU       PID  Type  Process name                               Usage      |\n|=============================================================================|\n|  No running processes found                                                 |\n+-----------------------------------------------------------------------------+\n== cuda libs  ===================================================\n/usr/local/cuda-8.0/lib64/libcudart_static.a\n/usr/local/cuda-8.0/lib64/libcudart.so.8.0.61\n/usr/local/cuda-8.0/doc/man/man7/libcudart.so.7\n/usr/local/cuda-8.0/doc/man/man7/libcudart.7\n/usr/local/cuda-8.0/targets/x86_64-linux/lib/libcudart.so.8.0.61\n##here is error.\ntensor@user-ubuntu:~/tensorflow-r1.4/tensorflow/contrib/mpi_collectives$ mpirun -n 2 python mpi_simple_nn.py\n2018-01-10 21:50:44.579981: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\n2018-01-10 21:50:44.580748: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\n2018-01-10 21:50:47.127209: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1206] Found device 0 with properties:\nname: Tesla P100-PCIE-16GB major: 6 minor: 0 memoryClockRate(GHz): 1.3285\npciBusID: 0000:06:00.0\ntotalMemory: 15.89GiB freeMemory: 15.34GiB\n2018-01-10 21:50:47.127952: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1206] Found device 0 with properties:\nname: Tesla P100-PCIE-16GB major: 6 minor: 0 memoryClockRate(GHz): 1.3285\npciBusID: 0000:06:00.0\ntotalMemory: 15.89GiB freeMemory: 15.34GiB\n2018-01-10 21:50:48.027960: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1206] Found device 1 with properties:\nname: Tesla P100-PCIE-16GB major: 6 minor: 0 memoryClockRate(GHz): 1.3285\npciBusID: 0000:84:00.0\ntotalMemory: 15.89GiB freeMemory: 15.34GiB\n2018-01-10 21:50:48.028762: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1206] Found device 1 with properties:\nname: Tesla P100-PCIE-16GB major: 6 minor: 0 memoryClockRate(GHz): 1.3285\npciBusID: 0000:84:00.0\ntotalMemory: 15.89GiB freeMemory: 15.34GiB\n2018-01-10 21:50:48.028835: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1221] Device peer to peer matrix\n2018-01-10 21:50:48.028932: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1221] Device peer to peer matrix\n2018-01-10 21:50:48.028886: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1227] DMA: 0 1\n2018-01-10 21:50:48.028910: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1237] 0:   Y N\n2018-01-10 21:50:48.028926: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1237] 1:   N Y\n2018-01-10 21:50:48.028933: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1300] Adding visible gpu device 0\n2018-01-10 21:50:48.028938: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1300] Adding visible gpu device 1\n2018-01-10 21:50:48.028966: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1227] DMA: 0 1\n2018-01-10 21:50:48.028974: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1237] 0:   Y N\n2018-01-10 21:50:48.028979: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1237] 1:   N Y\n2018-01-10 21:50:48.028994: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1300] Adding visible gpu device 0\n2018-01-10 21:50:48.029000: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1300] Adding visible gpu device 1\n2018-01-10 21:50:48.568865: I tensorflow/core/common_runtime/gpu/gpu_device.cc:987] Creating TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14824 MB memory) -> physical GPU (device: 0, name: Tesla P100-PCIE-16GB, pci bus id: 0000:06:00.0, compute capability: 6.0)\n2018-01-10 21:50:48.668728: I tensorflow/core/common_runtime/gpu/gpu_device.cc:987] Creating TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 553 MB memory) -> physical GPU (device: 0, name: Tesla P100-PCIE-16GB, pci bus id: 0000:06:00.0, compute capability: 6.0)\n2018-01-10 21:50:48.676343: I tensorflow/core/common_runtime/gpu/gpu_device.cc:987] Creating TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:1 with 14824 MB memory) -> physical GPU (device: 1, name: Tesla P100-PCIE-16GB, pci bus id: 0000:84:00.0, compute capability: 6.0)\n2018-01-10 21:50:48.708625: I tensorflow/core/common_runtime/gpu/gpu_device.cc:987] Creating TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:1 with 553 MB memory) -> physical GPU (device: 1, name: Tesla P100-PCIE-16GB, pci bus id: 0000:84:00.0, compute capability: 6.0)\nmy_rank  1\nmy_rank  0\n[user-ubuntu:49967] *** Process received signal ***\n[user-ubuntu:49967] Signal: Segmentation fault (11)\n[user-ubuntu:49967] Signal code: Invalid permissions (2)\n[user-ubuntu:49967] Failing at address: 0x1042c005000\n[user-ubuntu:49967] [ 0] /lib/x86_64-linux-gnu/libpthread.so.0(+0x10330)[0x7f2122752330]\n[user-ubuntu:49967] [ 1] /lib/x86_64-linux-gnu/libc.so.6(+0x9ac36)[0x7f2122413c36]\n[user-ubuntu:49967] [ 2] /usr/local/openmpi3/lib/openmpi/mca_btl_vader.so(mca_btl_vader_sendi+0x332)[0x7f1fd5d9b832]\n[user-ubuntu:49967] [ 3] /usr/local/openmpi3/lib/openmpi/mca_pml_ob1.so(+0xb6eb)[0x7f1fd63c86eb]\n[user-ubuntu:49967] [ 4] /usr/local/openmpi3/lib/openmpi/mca_pml_ob1.so(mca_pml_ob1_send+0x690)[0x7f1fd63ca130]\n[user-ubuntu:49967] [ 5] /usr/local/openmpi3/lib/libmpi.so.40(PMPI_Send+0xf2)[0x7f1ffc59d062]\n[user-ubuntu:49967] [ 6] /usr/local/lib/python2.7/dist-packages/tensorflow/contrib/mpi_collectives/python/ops/_mpi_ops.so(ZN10tensorflow7contrib15mpi_collectives13RingAllreduceIN5Eigen9GpuDeviceEfEENS_6StatusEPNS_15OpKernelContextEPKNS_6TensorEPS8_SB+0x14f)[0x7f21082b50bf]\n[user-ubuntu:49967] [ 7] /usr/local/lib/python2.7/dist-packages/tensorflow/contrib/mpi_collectives/python/ops/_mpi_ops.so(+0x1cab9)[0x7f21082aaab9]\n[user-ubuntu:49967] [ 8] /usr/local/lib/python2.7/dist-packages/tensorflow/contrib/mpi_collectives/python/ops/_mpi_ops.so(+0x23760)[0x7f21082b1760]\n[user-ubuntu:49967] [ 9] /usr/lib/x86_64-linux-gnu/libstdc++.so.6(+0xb1a60)[0x7f1ff5c48a60]\n[user-ubuntu:49967] [10] /lib/x86_64-linux-gnu/libpthread.so.0(+0x8184)[0x7f212274a184]\n[user-ubuntu:49967] [11] /lib/x86_64-linux-gnu/libc.so.6(clone+0x6d)[0x7f2122476ffd]\n[user-ubuntu:49967] *** End of error message ***\nPrimary job  terminated normally, but 1 process returned\na non-zero exit code. Per user-direction, the job has been aborted.\n\nmpirun noticed that process rank 0 with PID 0 on node user-ubuntu exited on signal 11 (Segmentation fault)", "body": "I compiled and installed new mpi_collective feature with openmpi3.0 on tensorflow 1.5.  When I use allreduce function to aggregate loss, I got segmentation fault errors. However, When I force code to run on CPU device, it's fine. \r\n\r\n**## here is my runtime environment.**\r\n== cat /etc/issue ===============================================\r\nLinux user-ubuntu 3.19.0-25-generic #26~14.04.1-Ubuntu SMP Fri Jul 24 21:16:20 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\r\nVERSION=\"14.04.5 LTS, Trusty Tahr\"\r\nVERSION_ID=\"14.04\"\r\n\r\n== are we in docker =============================================\r\nNo\r\n\r\n== compiler =====================================================\r\nc++ (Ubuntu 4.8.4-2ubuntu1~14.04.3) 4.8.4\r\nCopyright (C) 2013 Free Software Foundation, Inc.\r\nThis is free software; see the source for copying conditions.  There is NO\r\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n\r\n== uname -a =====================================================\r\nLinux user-ubuntu 3.19.0-25-generic #26~14.04.1-Ubuntu SMP Fri Jul 24 21:16:20 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n== check pips ===================================================\r\nnumpy (1.13.3)\r\nprotobuf (3.5.1)\r\ntensorflow (1.5.0rc0)\r\ntensorflow-tensorboard (0.4.0rc2)\r\n\r\n== tensorflow import ============================================\r\ntf.VERSION = 1.5.0-rc0\r\ntf.GIT_VERSION = unknown\r\ntf.COMPILER_VERSION = unknown\r\nSanity check: array([1], dtype=int32)\r\n\r\n== env ==========================================================\r\nLD_LIBRARY_PATH is unset\r\nDYLD_LIBRARY_PATH is unset\r\n\r\n== nvidia-smi ===================================================\r\nWed Jan 10 21:56:08 2018       \r\n+-----------------------------------------------------------------------------+\r\n| NVIDIA-SMI 375.66                 Driver Version: 375.66                    |\r\n|-------------------------------+----------------------+----------------------+\r\n| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\r\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\r\n|===============================+======================+======================|\r\n|   0  Tesla P100-PCIE...  Off  | 0000:06:00.0     Off |                    0 |\r\n| N/A   27C    P0    27W / 250W |      0MiB / 16276MiB |      0%      Default |\r\n+-------------------------------+----------------------+----------------------+\r\n|   1  Tesla P100-PCIE...  Off  | 0000:84:00.0     Off |                    0 |\r\n| N/A   25C    P0    27W / 250W |      0MiB / 16276MiB |      3%      Default |\r\n+-------------------------------+----------------------+----------------------+\r\n                                                                               \r\n+-----------------------------------------------------------------------------+\r\n| Processes:                                                       GPU Memory |\r\n|  GPU       PID  Type  Process name                               Usage      |\r\n|=============================================================================|\r\n|  No running processes found                                                 |\r\n+-----------------------------------------------------------------------------+\r\n\r\n== cuda libs  ===================================================\r\n/usr/local/cuda-8.0/lib64/libcudart_static.a\r\n/usr/local/cuda-8.0/lib64/libcudart.so.8.0.61\r\n/usr/local/cuda-8.0/doc/man/man7/libcudart.so.7\r\n/usr/local/cuda-8.0/doc/man/man7/libcudart.7\r\n/usr/local/cuda-8.0/targets/x86_64-linux/lib/libcudart.so.8.0.61\r\n\r\n**##here is error.**\r\n\r\ntensor@user-ubuntu:~/tensorflow-r1.4/tensorflow/contrib/mpi_collectives$ mpirun -n 2 python mpi_simple_nn.py \r\n\r\n2018-01-10 21:50:44.579981: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\r\n2018-01-10 21:50:44.580748: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\r\n2018-01-10 21:50:47.127209: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1206] Found device 0 with properties: \r\nname: Tesla P100-PCIE-16GB major: 6 minor: 0 memoryClockRate(GHz): 1.3285\r\npciBusID: 0000:06:00.0\r\ntotalMemory: 15.89GiB freeMemory: 15.34GiB\r\n2018-01-10 21:50:47.127952: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1206] Found device 0 with properties: \r\nname: Tesla P100-PCIE-16GB major: 6 minor: 0 memoryClockRate(GHz): 1.3285\r\npciBusID: 0000:06:00.0\r\ntotalMemory: 15.89GiB freeMemory: 15.34GiB\r\n2018-01-10 21:50:48.027960: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1206] Found device 1 with properties: \r\nname: Tesla P100-PCIE-16GB major: 6 minor: 0 memoryClockRate(GHz): 1.3285\r\npciBusID: 0000:84:00.0\r\ntotalMemory: 15.89GiB freeMemory: 15.34GiB\r\n2018-01-10 21:50:48.028762: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1206] Found device 1 with properties: \r\nname: Tesla P100-PCIE-16GB major: 6 minor: 0 memoryClockRate(GHz): 1.3285\r\npciBusID: 0000:84:00.0\r\ntotalMemory: 15.89GiB freeMemory: 15.34GiB\r\n2018-01-10 21:50:48.028835: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1221] Device peer to peer matrix\r\n2018-01-10 21:50:48.028932: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1221] Device peer to peer matrix\r\n2018-01-10 21:50:48.028886: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1227] DMA: 0 1 \r\n2018-01-10 21:50:48.028910: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1237] 0:   Y N \r\n2018-01-10 21:50:48.028926: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1237] 1:   N Y \r\n2018-01-10 21:50:48.028933: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1300] Adding visible gpu device 0\r\n2018-01-10 21:50:48.028938: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1300] Adding visible gpu device 1\r\n2018-01-10 21:50:48.028966: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1227] DMA: 0 1 \r\n2018-01-10 21:50:48.028974: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1237] 0:   Y N \r\n2018-01-10 21:50:48.028979: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1237] 1:   N Y \r\n2018-01-10 21:50:48.028994: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1300] Adding visible gpu device 0\r\n2018-01-10 21:50:48.029000: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1300] Adding visible gpu device 1\r\n2018-01-10 21:50:48.568865: I tensorflow/core/common_runtime/gpu/gpu_device.cc:987] Creating TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14824 MB memory) -> physical GPU (device: 0, name: Tesla P100-PCIE-16GB, pci bus id: 0000:06:00.0, compute capability: 6.0)\r\n2018-01-10 21:50:48.668728: I tensorflow/core/common_runtime/gpu/gpu_device.cc:987] Creating TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 553 MB memory) -> physical GPU (device: 0, name: Tesla P100-PCIE-16GB, pci bus id: 0000:06:00.0, compute capability: 6.0)\r\n2018-01-10 21:50:48.676343: I tensorflow/core/common_runtime/gpu/gpu_device.cc:987] Creating TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:1 with 14824 MB memory) -> physical GPU (device: 1, name: Tesla P100-PCIE-16GB, pci bus id: 0000:84:00.0, compute capability: 6.0)\r\n2018-01-10 21:50:48.708625: I tensorflow/core/common_runtime/gpu/gpu_device.cc:987] Creating TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:1 with 553 MB memory) -> physical GPU (device: 1, name: Tesla P100-PCIE-16GB, pci bus id: 0000:84:00.0, compute capability: 6.0)\r\nmy_rank  1\r\nmy_rank  0\r\n[user-ubuntu:49967] *** Process received signal ***\r\n[user-ubuntu:49967] Signal: Segmentation fault (11)\r\n[user-ubuntu:49967] Signal code: Invalid permissions (2)\r\n[user-ubuntu:49967] Failing at address: 0x1042c005000\r\n[user-ubuntu:49967] [ 0] /lib/x86_64-linux-gnu/libpthread.so.0(+0x10330)[0x7f2122752330]\r\n[user-ubuntu:49967] [ 1] /lib/x86_64-linux-gnu/libc.so.6(+0x9ac36)[0x7f2122413c36]\r\n[user-ubuntu:49967] [ 2] /usr/local/openmpi3/lib/openmpi/mca_btl_vader.so(mca_btl_vader_sendi+0x332)[0x7f1fd5d9b832]\r\n[user-ubuntu:49967] [ 3] /usr/local/openmpi3/lib/openmpi/mca_pml_ob1.so(+0xb6eb)[0x7f1fd63c86eb]\r\n[user-ubuntu:49967] [ 4] /usr/local/openmpi3/lib/openmpi/mca_pml_ob1.so(mca_pml_ob1_send+0x690)[0x7f1fd63ca130]\r\n[user-ubuntu:49967] [ 5] /usr/local/openmpi3/lib/libmpi.so.40(PMPI_Send+0xf2)[0x7f1ffc59d062]\r\n[user-ubuntu:49967] [ 6] /usr/local/lib/python2.7/dist-packages/tensorflow/contrib/mpi_collectives/python/ops/_mpi_ops.so(_ZN10tensorflow7contrib15mpi_collectives13RingAllreduceIN5Eigen9GpuDeviceEfEENS_6StatusEPNS_15OpKernelContextEPKNS_6TensorEPS8_SB_+0x14f)[0x7f21082b50bf]\r\n[user-ubuntu:49967] [ 7] /usr/local/lib/python2.7/dist-packages/tensorflow/contrib/mpi_collectives/python/ops/_mpi_ops.so(+0x1cab9)[0x7f21082aaab9]\r\n[user-ubuntu:49967] [ 8] /usr/local/lib/python2.7/dist-packages/tensorflow/contrib/mpi_collectives/python/ops/_mpi_ops.so(+0x23760)[0x7f21082b1760]\r\n[user-ubuntu:49967] [ 9] /usr/lib/x86_64-linux-gnu/libstdc++.so.6(+0xb1a60)[0x7f1ff5c48a60]\r\n[user-ubuntu:49967] [10] /lib/x86_64-linux-gnu/libpthread.so.0(+0x8184)[0x7f212274a184]\r\n[user-ubuntu:49967] [11] /lib/x86_64-linux-gnu/libc.so.6(clone+0x6d)[0x7f2122476ffd]\r\n[user-ubuntu:49967] *** End of error message ***\r\n-------------------------------------------------------\r\nPrimary job  terminated normally, but 1 process returned\r\na non-zero exit code. Per user-direction, the job has been aborted.\r\n-------------------------------------------------------\r\n--------------------------------------------------------------------------\r\nmpirun noticed that process rank 0 with PID 0 on node user-ubuntu exited on signal 11 (Segmentation fault)"}