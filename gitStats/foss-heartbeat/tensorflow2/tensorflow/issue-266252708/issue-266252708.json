{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13790", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13790/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13790/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13790/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/13790", "id": 266252708, "node_id": "MDU6SXNzdWUyNjYyNTI3MDg=", "number": 13790, "title": "compile failure with --config=mkl", "user": {"login": "tycho", "id": 29616, "node_id": "MDQ6VXNlcjI5NjE2", "avatar_url": "https://avatars0.githubusercontent.com/u/29616?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tycho", "html_url": "https://github.com/tycho", "followers_url": "https://api.github.com/users/tycho/followers", "following_url": "https://api.github.com/users/tycho/following{/other_user}", "gists_url": "https://api.github.com/users/tycho/gists{/gist_id}", "starred_url": "https://api.github.com/users/tycho/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tycho/subscriptions", "organizations_url": "https://api.github.com/users/tycho/orgs", "repos_url": "https://api.github.com/users/tycho/repos", "events_url": "https://api.github.com/users/tycho/events{/privacy}", "received_events_url": "https://api.github.com/users/tycho/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-10-17T19:39:35Z", "updated_at": "2017-10-21T12:38:16Z", "closed_at": "2017-10-21T12:38:15Z", "author_association": "NONE", "body_html": "<p>Building from git <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/27767d8e9c1325979cf32ff5b81c10df9006fd57/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/27767d8e9c1325979cf32ff5b81c10df9006fd57\"><tt>27767d8</tt></a> with <code>TF_NEED_MKL=1</code> and <code>TF_DOWNLOAD_MKL=1</code>. It seems <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/d835d677ade78a41e0e097f67c87b6ab8588a90a/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/d835d677ade78a41e0e097f67c87b6ab8588a90a\"><tt>d835d67</tt></a> introduced a compile failure:</p>\n<pre><code>ERROR: /build/tensorflow-git/src/tensorflow-mkl/tensorflow/core/kernels/BUILD:819:1: C++ compilation of rule '//tensorflow/core/kernels:transpose_op' failed (Exit 1).\ntensorflow/core/kernels/mkl_transpose_op.cc:53:10: error: template-id 'MKLTranspose2D&lt;float&gt;' for 'tensorflow::Status tensorflow::MKLTranspose2D(char, const tensorflow::Tensor&amp;, tensorflow::Tensor*)' does not match any template declaration\n   Status MKLTranspose2D&lt;T&gt;(const char trans, const Tensor&amp; in, Tensor* out) { \\\n          ^~~~~~~~~~~~~~~~~\ntensorflow/core/kernels/mkl_transpose_op.cc:53:10: note: in definition of macro 'INSTANTIATE'\n   Status MKLTranspose2D&lt;T&gt;(const char trans, const Tensor&amp; in, Tensor* out) { \\\n          ^~~~~~~~~~~~~~\ntensorflow/core/kernels/mkl_transpose_op.cc:44:6: note: candidate is: template&lt;class T&gt; void tensorflow::{anonymous}::MKLTranspose2D(char, const tensorflow::Tensor&amp;, tensorflow::Tensor*)\n void MKLTranspose2D(const char trans, const Tensor&amp; in, Tensor* out) {}\n      ^~~~~~~~~~~~~~\ntensorflow/core/kernels/mkl_transpose_op.cc:122:1: error: expected '}' at end of input\n }  // namespace tensorflow\n ^\n</code></pre>\n<p>There are multiple problems in there. This patch gets it closer to compiling (correcting return type of <code>MKLTranspose2D</code> base template, adding missing line-continuation escape):</p>\n<div class=\"highlight highlight-source-diff\"><pre><span class=\"pl-c1\">diff --git a/tensorflow/core/kernels/mkl_transpose_op.cc b/tensorflow/core/kernels/mkl_transpose_op.cc</span>\nindex 89a1d5e8a..93da2a6ea 100644\n<span class=\"pl-md\">--- a/tensorflow/core/kernels/mkl_transpose_op.cc</span>\n<span class=\"pl-mi1\">+++ b/tensorflow/core/kernels/mkl_transpose_op.cc</span>\n<span class=\"pl-mdr\">@@ -41,7 +41,7 @@</span> namespace tensorflow {\n \n namespace {\n template &lt;typename T&gt;\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>void MKLTranspose2D(const char trans, const Tensor&amp; in, Tensor* out) {}</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>Status MKLTranspose2D(const char trans, const Tensor&amp; in, Tensor* out);</span>\n \n // Documentation here: https://software.intel.com/en-us/node/520863\n // Parameters: (ordering:row-major, operation:transpose, num_rows, num_cols,\n<span class=\"pl-mdr\">@@ -54,7 +54,7 @@</span> void MKLTranspose2D(const char trans, const Tensor&amp; in, Tensor* out) {}\n     mkl_##PREFIX##omatcopy('R', trans, in.dim_size(0), in.dim_size(1), 1,     \\\n                            in.flat&lt;T&gt;().data(), in.dim_size(1),               \\\n                            out-&gt;flat&lt;T&gt;().data(), in.dim_size(0));            \\\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>    return Status::OK();</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>    return Status::OK();                                                      \\</span>\n   }\n \n   INSTANTIATE(float, s)\n<span class=\"pl-mdr\">@@ -66,7 +66,7 @@</span> void MKLTranspose2D(const char trans, const Tensor&amp; in, Tensor* out) {}\n   static const char kMKLTranspose = 'T';\n   static const char kMKLConjugateTranspose = 'C';\n \n<span class=\"pl-md\"><span class=\"pl-md\">-</span>  }  // namespace tensorflow</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  }  // anonymous namespace</span>\n \n   Status MklTransposeCpuOp::DoTranspose(OpKernelContext* ctx, const Tensor&amp; in,\n                                         gtl::ArraySlice&lt;int32&gt; perm,</pre></div>\n<p>But I'm not sure how to handle this issue (conversion of the <code>alpha</code> argument into float/double/MKL_Complex8/MKL_Complex16):</p>\n<pre><code>ERROR: /home/steven/Development/misc-packages/tensorflow-git/src/tensorflow-mkl/tensorflow/core/kernels/BUILD:819:1: C++ compilation of rule '//tensorflow/core/kernels:transpose_op' failed (Exit 1).\ntensorflow/core/kernels/mkl_transpose_op.cc: In function 'tensorflow::Status tensorflow::{anonymous}::MKLTranspose2D(char, const tensorflow::Tensor&amp;, tensorflow::Tensor*) [with T = std::complex&lt;float&gt;]':\ntensorflow/core/kernels/mkl_transpose_op.cc:57:69: error: could not convert '1' from 'int' to 'MKL_Complex8 {aka _MKL_Complex8}'\n                                out-&gt;flat&lt;T&gt;().data(), in.dim_size(0));            \\\n                                                                     ^\ntensorflow/core/kernels/mkl_transpose_op.cc:63:5: note: in expansion of macro 'INSTANTIATE'\n     INSTANTIATE(complex64, c)\n     ^\ntensorflow/core/kernels/mkl_transpose_op.cc: In function 'tensorflow::Status tensorflow::{anonymous}::MKLTranspose2D(char, const tensorflow::Tensor&amp;, tensorflow::Tensor*) [with T = std::complex&lt;double&gt;]':\ntensorflow/core/kernels/mkl_transpose_op.cc:57:69: error: could not convert '1' from 'int' to 'MKL_Complex16 {aka _MKL_Complex16}'\n                                out-&gt;flat&lt;T&gt;().data(), in.dim_size(0));            \\\n                                                                     ^\ntensorflow/core/kernels/mkl_transpose_op.cc:64:5: note: in expansion of macro 'INSTANTIATE'\n     INSTANTIATE(complex128, z)\n     ^\ntensorflow/core/kernels/mkl_transpose_op.cc: At global scope:\ntensorflow/core/kernels/mkl_transpose_op.cc:95:10: error: 'template&lt;bool conjugate&gt; class tensorflow::MklConjugateTransposeCpuOp' used without template parameters\n   Status MklConjugateTransposeCpuOp::DoTranspose(OpKernelContext* ctx,\n          ^~~~~~~~~~~~~~~~~~~~~~~~~~\n</code></pre>", "body_text": "Building from git 27767d8 with TF_NEED_MKL=1 and TF_DOWNLOAD_MKL=1. It seems d835d67 introduced a compile failure:\nERROR: /build/tensorflow-git/src/tensorflow-mkl/tensorflow/core/kernels/BUILD:819:1: C++ compilation of rule '//tensorflow/core/kernels:transpose_op' failed (Exit 1).\ntensorflow/core/kernels/mkl_transpose_op.cc:53:10: error: template-id 'MKLTranspose2D<float>' for 'tensorflow::Status tensorflow::MKLTranspose2D(char, const tensorflow::Tensor&, tensorflow::Tensor*)' does not match any template declaration\n   Status MKLTranspose2D<T>(const char trans, const Tensor& in, Tensor* out) { \\\n          ^~~~~~~~~~~~~~~~~\ntensorflow/core/kernels/mkl_transpose_op.cc:53:10: note: in definition of macro 'INSTANTIATE'\n   Status MKLTranspose2D<T>(const char trans, const Tensor& in, Tensor* out) { \\\n          ^~~~~~~~~~~~~~\ntensorflow/core/kernels/mkl_transpose_op.cc:44:6: note: candidate is: template<class T> void tensorflow::{anonymous}::MKLTranspose2D(char, const tensorflow::Tensor&, tensorflow::Tensor*)\n void MKLTranspose2D(const char trans, const Tensor& in, Tensor* out) {}\n      ^~~~~~~~~~~~~~\ntensorflow/core/kernels/mkl_transpose_op.cc:122:1: error: expected '}' at end of input\n }  // namespace tensorflow\n ^\n\nThere are multiple problems in there. This patch gets it closer to compiling (correcting return type of MKLTranspose2D base template, adding missing line-continuation escape):\ndiff --git a/tensorflow/core/kernels/mkl_transpose_op.cc b/tensorflow/core/kernels/mkl_transpose_op.cc\nindex 89a1d5e8a..93da2a6ea 100644\n--- a/tensorflow/core/kernels/mkl_transpose_op.cc\n+++ b/tensorflow/core/kernels/mkl_transpose_op.cc\n@@ -41,7 +41,7 @@ namespace tensorflow {\n \n namespace {\n template <typename T>\n-void MKLTranspose2D(const char trans, const Tensor& in, Tensor* out) {}\n+Status MKLTranspose2D(const char trans, const Tensor& in, Tensor* out);\n \n // Documentation here: https://software.intel.com/en-us/node/520863\n // Parameters: (ordering:row-major, operation:transpose, num_rows, num_cols,\n@@ -54,7 +54,7 @@ void MKLTranspose2D(const char trans, const Tensor& in, Tensor* out) {}\n     mkl_##PREFIX##omatcopy('R', trans, in.dim_size(0), in.dim_size(1), 1,     \\\n                            in.flat<T>().data(), in.dim_size(1),               \\\n                            out->flat<T>().data(), in.dim_size(0));            \\\n-    return Status::OK();\n+    return Status::OK();                                                      \\\n   }\n \n   INSTANTIATE(float, s)\n@@ -66,7 +66,7 @@ void MKLTranspose2D(const char trans, const Tensor& in, Tensor* out) {}\n   static const char kMKLTranspose = 'T';\n   static const char kMKLConjugateTranspose = 'C';\n \n-  }  // namespace tensorflow\n+  }  // anonymous namespace\n \n   Status MklTransposeCpuOp::DoTranspose(OpKernelContext* ctx, const Tensor& in,\n                                         gtl::ArraySlice<int32> perm,\nBut I'm not sure how to handle this issue (conversion of the alpha argument into float/double/MKL_Complex8/MKL_Complex16):\nERROR: /home/steven/Development/misc-packages/tensorflow-git/src/tensorflow-mkl/tensorflow/core/kernels/BUILD:819:1: C++ compilation of rule '//tensorflow/core/kernels:transpose_op' failed (Exit 1).\ntensorflow/core/kernels/mkl_transpose_op.cc: In function 'tensorflow::Status tensorflow::{anonymous}::MKLTranspose2D(char, const tensorflow::Tensor&, tensorflow::Tensor*) [with T = std::complex<float>]':\ntensorflow/core/kernels/mkl_transpose_op.cc:57:69: error: could not convert '1' from 'int' to 'MKL_Complex8 {aka _MKL_Complex8}'\n                                out->flat<T>().data(), in.dim_size(0));            \\\n                                                                     ^\ntensorflow/core/kernels/mkl_transpose_op.cc:63:5: note: in expansion of macro 'INSTANTIATE'\n     INSTANTIATE(complex64, c)\n     ^\ntensorflow/core/kernels/mkl_transpose_op.cc: In function 'tensorflow::Status tensorflow::{anonymous}::MKLTranspose2D(char, const tensorflow::Tensor&, tensorflow::Tensor*) [with T = std::complex<double>]':\ntensorflow/core/kernels/mkl_transpose_op.cc:57:69: error: could not convert '1' from 'int' to 'MKL_Complex16 {aka _MKL_Complex16}'\n                                out->flat<T>().data(), in.dim_size(0));            \\\n                                                                     ^\ntensorflow/core/kernels/mkl_transpose_op.cc:64:5: note: in expansion of macro 'INSTANTIATE'\n     INSTANTIATE(complex128, z)\n     ^\ntensorflow/core/kernels/mkl_transpose_op.cc: At global scope:\ntensorflow/core/kernels/mkl_transpose_op.cc:95:10: error: 'template<bool conjugate> class tensorflow::MklConjugateTransposeCpuOp' used without template parameters\n   Status MklConjugateTransposeCpuOp::DoTranspose(OpKernelContext* ctx,\n          ^~~~~~~~~~~~~~~~~~~~~~~~~~", "body": "Building from git 27767d8e9c1325979cf32ff5b81c10df9006fd57 with `TF_NEED_MKL=1` and `TF_DOWNLOAD_MKL=1`. It seems d835d677ade78a41e0e097f67c87b6ab8588a90a introduced a compile failure:\r\n\r\n```\r\nERROR: /build/tensorflow-git/src/tensorflow-mkl/tensorflow/core/kernels/BUILD:819:1: C++ compilation of rule '//tensorflow/core/kernels:transpose_op' failed (Exit 1).\r\ntensorflow/core/kernels/mkl_transpose_op.cc:53:10: error: template-id 'MKLTranspose2D<float>' for 'tensorflow::Status tensorflow::MKLTranspose2D(char, const tensorflow::Tensor&, tensorflow::Tensor*)' does not match any template declaration\r\n   Status MKLTranspose2D<T>(const char trans, const Tensor& in, Tensor* out) { \\\r\n          ^~~~~~~~~~~~~~~~~\r\ntensorflow/core/kernels/mkl_transpose_op.cc:53:10: note: in definition of macro 'INSTANTIATE'\r\n   Status MKLTranspose2D<T>(const char trans, const Tensor& in, Tensor* out) { \\\r\n          ^~~~~~~~~~~~~~\r\ntensorflow/core/kernels/mkl_transpose_op.cc:44:6: note: candidate is: template<class T> void tensorflow::{anonymous}::MKLTranspose2D(char, const tensorflow::Tensor&, tensorflow::Tensor*)\r\n void MKLTranspose2D(const char trans, const Tensor& in, Tensor* out) {}\r\n      ^~~~~~~~~~~~~~\r\ntensorflow/core/kernels/mkl_transpose_op.cc:122:1: error: expected '}' at end of input\r\n }  // namespace tensorflow\r\n ^\r\n```\r\n\r\nThere are multiple problems in there. This patch gets it closer to compiling (correcting return type of `MKLTranspose2D` base template, adding missing line-continuation escape):\r\n\r\n```diff\r\ndiff --git a/tensorflow/core/kernels/mkl_transpose_op.cc b/tensorflow/core/kernels/mkl_transpose_op.cc\r\nindex 89a1d5e8a..93da2a6ea 100644\r\n--- a/tensorflow/core/kernels/mkl_transpose_op.cc\r\n+++ b/tensorflow/core/kernels/mkl_transpose_op.cc\r\n@@ -41,7 +41,7 @@ namespace tensorflow {\r\n \r\n namespace {\r\n template <typename T>\r\n-void MKLTranspose2D(const char trans, const Tensor& in, Tensor* out) {}\r\n+Status MKLTranspose2D(const char trans, const Tensor& in, Tensor* out);\r\n \r\n // Documentation here: https://software.intel.com/en-us/node/520863\r\n // Parameters: (ordering:row-major, operation:transpose, num_rows, num_cols,\r\n@@ -54,7 +54,7 @@ void MKLTranspose2D(const char trans, const Tensor& in, Tensor* out) {}\r\n     mkl_##PREFIX##omatcopy('R', trans, in.dim_size(0), in.dim_size(1), 1,     \\\r\n                            in.flat<T>().data(), in.dim_size(1),               \\\r\n                            out->flat<T>().data(), in.dim_size(0));            \\\r\n-    return Status::OK();\r\n+    return Status::OK();                                                      \\\r\n   }\r\n \r\n   INSTANTIATE(float, s)\r\n@@ -66,7 +66,7 @@ void MKLTranspose2D(const char trans, const Tensor& in, Tensor* out) {}\r\n   static const char kMKLTranspose = 'T';\r\n   static const char kMKLConjugateTranspose = 'C';\r\n \r\n-  }  // namespace tensorflow\r\n+  }  // anonymous namespace\r\n \r\n   Status MklTransposeCpuOp::DoTranspose(OpKernelContext* ctx, const Tensor& in,\r\n                                         gtl::ArraySlice<int32> perm,\r\n```\r\n\r\nBut I'm not sure how to handle this issue (conversion of the `alpha` argument into float/double/MKL_Complex8/MKL_Complex16):\r\n\r\n```\r\nERROR: /home/steven/Development/misc-packages/tensorflow-git/src/tensorflow-mkl/tensorflow/core/kernels/BUILD:819:1: C++ compilation of rule '//tensorflow/core/kernels:transpose_op' failed (Exit 1).\r\ntensorflow/core/kernels/mkl_transpose_op.cc: In function 'tensorflow::Status tensorflow::{anonymous}::MKLTranspose2D(char, const tensorflow::Tensor&, tensorflow::Tensor*) [with T = std::complex<float>]':\r\ntensorflow/core/kernels/mkl_transpose_op.cc:57:69: error: could not convert '1' from 'int' to 'MKL_Complex8 {aka _MKL_Complex8}'\r\n                                out->flat<T>().data(), in.dim_size(0));            \\\r\n                                                                     ^\r\ntensorflow/core/kernels/mkl_transpose_op.cc:63:5: note: in expansion of macro 'INSTANTIATE'\r\n     INSTANTIATE(complex64, c)\r\n     ^\r\ntensorflow/core/kernels/mkl_transpose_op.cc: In function 'tensorflow::Status tensorflow::{anonymous}::MKLTranspose2D(char, const tensorflow::Tensor&, tensorflow::Tensor*) [with T = std::complex<double>]':\r\ntensorflow/core/kernels/mkl_transpose_op.cc:57:69: error: could not convert '1' from 'int' to 'MKL_Complex16 {aka _MKL_Complex16}'\r\n                                out->flat<T>().data(), in.dim_size(0));            \\\r\n                                                                     ^\r\ntensorflow/core/kernels/mkl_transpose_op.cc:64:5: note: in expansion of macro 'INSTANTIATE'\r\n     INSTANTIATE(complex128, z)\r\n     ^\r\ntensorflow/core/kernels/mkl_transpose_op.cc: At global scope:\r\ntensorflow/core/kernels/mkl_transpose_op.cc:95:10: error: 'template<bool conjugate> class tensorflow::MklConjugateTransposeCpuOp' used without template parameters\r\n   Status MklConjugateTransposeCpuOp::DoTranspose(OpKernelContext* ctx,\r\n          ^~~~~~~~~~~~~~~~~~~~~~~~~~\r\n```"}