{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/229876937", "pull_request_review_id": 170483737, "id": 229876937, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyOTg3NjkzNw==", "diff_hunk": "@@ -398,8 +398,13 @@ Status GrpcServer::Stop() {\n       state_ = STOPPED;\n       return Status::OK();\n     case STARTED:\n-      return errors::Unimplemented(\n-          \"Clean shutdown is not currently implemented\");\n+      server_->Shutdown();\n+      master_service_->Shutdown();\n+      worker_service_->Shutdown();\n+      eager_service_->Shutdown();\n+      state_ = STOPPED;\n+      LOG(INFO) << \"Server stopped (target: \" << target() << \")\";\n+      return Status::OK();", "path": "tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc", "position": 12, "original_position": 12, "commit_id": "56576ad348dfb5a858864e95e87434e514693c81", "original_commit_id": "d7d33062ad24afa008962559c834a8b5eda83612", "user": {"login": "dmitrievanthony", "id": 1028969, "node_id": "MDQ6VXNlcjEwMjg5Njk=", "avatar_url": "https://avatars3.githubusercontent.com/u/1028969?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dmitrievanthony", "html_url": "https://github.com/dmitrievanthony", "followers_url": "https://api.github.com/users/dmitrievanthony/followers", "following_url": "https://api.github.com/users/dmitrievanthony/following{/other_user}", "gists_url": "https://api.github.com/users/dmitrievanthony/gists{/gist_id}", "starred_url": "https://api.github.com/users/dmitrievanthony/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dmitrievanthony/subscriptions", "organizations_url": "https://api.github.com/users/dmitrievanthony/orgs", "repos_url": "https://api.github.com/users/dmitrievanthony/repos", "events_url": "https://api.github.com/users/dmitrievanthony/events{/privacy}", "received_events_url": "https://api.github.com/users/dmitrievanthony/received_events", "type": "User", "site_admin": false}, "body": "Yes, I'm talking about linux process. I mentioned Apache Ignite just to describe the inspiration of the problem, don't think it has some specific requirements. The idea is to allow user to start a single java application (a java process) and do in this process something like:\r\n\r\n```java\r\nwhile (true) {\r\n  Server server = new Server(...);\r\n  server.start();\r\n  // do something...\r\n  server.stop();\r\n}\r\n```\r\n\r\nwithout memory leaks and hangs. We have the current implementation of that via starting and killing separate Python processes (with `start()` server functionality written in Python) from Java. It works, but seems a bit to tricky compare with an ability to `start` and `stop` servers inside a single java process.\r\n\r\n> Do you want to kill and restart a gRPC server in the same linux process?\r\n\r\nYes.", "created_at": "2018-10-31T21:38:08Z", "updated_at": "2018-11-01T07:32:14Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/23190#discussion_r229876937", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/23190", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/229876937"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/23190#discussion_r229876937"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/23190"}}, "body_html": "<p>Yes, I'm talking about linux process. I mentioned Apache Ignite just to describe the inspiration of the problem, don't think it has some specific requirements. The idea is to allow user to start a single java application (a java process) and do in this process something like:</p>\n<div class=\"highlight highlight-source-java\"><pre><span class=\"pl-k\">while</span> (<span class=\"pl-c1\">true</span>) {\n  <span class=\"pl-smi\">Server</span> server <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">Server</span>(<span class=\"pl-c1\">...</span>);\n  server<span class=\"pl-k\">.</span>start();\n  <span class=\"pl-c\"><span class=\"pl-c\">//</span> do something...</span>\n  server<span class=\"pl-k\">.</span>stop();\n}</pre></div>\n<p>without memory leaks and hangs. We have the current implementation of that via starting and killing separate Python processes (with <code>start()</code> server functionality written in Python) from Java. It works, but seems a bit to tricky compare with an ability to <code>start</code> and <code>stop</code> servers inside a single java process.</p>\n<blockquote>\n<p>Do you want to kill and restart a gRPC server in the same linux process?</p>\n</blockquote>\n<p>Yes.</p>", "body_text": "Yes, I'm talking about linux process. I mentioned Apache Ignite just to describe the inspiration of the problem, don't think it has some specific requirements. The idea is to allow user to start a single java application (a java process) and do in this process something like:\nwhile (true) {\n  Server server = new Server(...);\n  server.start();\n  // do something...\n  server.stop();\n}\nwithout memory leaks and hangs. We have the current implementation of that via starting and killing separate Python processes (with start() server functionality written in Python) from Java. It works, but seems a bit to tricky compare with an ability to start and stop servers inside a single java process.\n\nDo you want to kill and restart a gRPC server in the same linux process?\n\nYes.", "in_reply_to_id": 227438700}