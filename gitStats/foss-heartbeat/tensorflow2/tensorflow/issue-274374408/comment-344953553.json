{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/344953553", "html_url": "https://github.com/tensorflow/tensorflow/pull/14604#issuecomment-344953553", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14604", "id": 344953553, "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDk1MzU1Mw==", "user": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "created_at": "2017-11-16T15:15:48Z", "updated_at": "2017-11-16T15:15:48Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Reassigning this to <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=11547801\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/prb12\">@prb12</a>, since he knows the ins and outs of the logging path better than I do. A few quick observations though:</p>\n<ul>\n<li>\n<p>Instead of modifying the <code>BaseRendezvousMgr</code> and related classes to capture this information, please use the existing stubs in <code>GrpcWorkerCache</code>:</p>\n<p><div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/c0662f1620c2b97abb79b8ae6a8a30f7c7719475/tensorflow/core/distributed_runtime/rpc/grpc_worker_cache.cc#L86-L92\">tensorflow/tensorflow/core/distributed_runtime/rpc/grpc_worker_cache.cc</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n        Lines 86 to 92\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/c0662f1620c2b97abb79b8ae6a8a30f7c7719475\">c0662f1</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L86\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"86\"></td>\n          <td id=\"LC86\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-k\">void</span> <span class=\"pl-en\">SetLogging</span>(<span class=\"pl-k\">bool</span> v) <span class=\"pl-k\">override</span> { logger_.<span class=\"pl-c1\">SetLogging</span>(v); } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L87\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"87\"></td>\n          <td id=\"LC87\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L88\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"88\"></td>\n          <td id=\"LC88\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-k\">void</span> <span class=\"pl-en\">ClearLogs</span>() <span class=\"pl-k\">override</span> { logger_.<span class=\"pl-c1\">ClearLogs</span>(); } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L89\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"89\"></td>\n          <td id=\"LC89\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L90\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"90\"></td>\n          <td id=\"LC90\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-k\">bool</span> <span class=\"pl-en\">RetrieveLogs</span>(int64 step_id, StepStats* ss) <span class=\"pl-k\">override</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L91\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"91\"></td>\n          <td id=\"LC91\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">   <span class=\"pl-k\">return</span> logger_.<span class=\"pl-c1\">RetrieveLogs</span>(step_id, ss); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L92\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"92\"></td>\n          <td id=\"LC92\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>\n</li>\n<li>\n<p>The changes in <code>master_session.cc</code> are potentially controversial, because they could cause a lot of additional logging to be generated when <code>FULL_TRACE</code> is specified. We might need an additional <code>TraceLevel</code> for this case.</p>\n</li>\n<li>\n<p>Run <code>clang-format -style=Google</code> over the code to take care of style issues (which should trigger a failure in the presubmit).</p>\n</li>\n</ul>", "body_text": "Reassigning this to @prb12, since he knows the ins and outs of the logging path better than I do. A few quick observations though:\n\n\nInstead of modifying the BaseRendezvousMgr and related classes to capture this information, please use the existing stubs in GrpcWorkerCache:\n\n  \n    \n      tensorflow/tensorflow/core/distributed_runtime/rpc/grpc_worker_cache.cc\n    \n    \n        Lines 86 to 92\n      in\n      c0662f1\n    \n    \n    \n    \n\n        \n          \n           void SetLogging(bool v) override { logger_.SetLogging(v); } \n        \n\n        \n          \n            \n        \n\n        \n          \n           void ClearLogs() override { logger_.ClearLogs(); } \n        \n\n        \n          \n            \n        \n\n        \n          \n           bool RetrieveLogs(int64 step_id, StepStats* ss) override { \n        \n\n        \n          \n             return logger_.RetrieveLogs(step_id, ss); \n        \n\n        \n          \n           } \n        \n    \n  \n\n\n\n\nThe changes in master_session.cc are potentially controversial, because they could cause a lot of additional logging to be generated when FULL_TRACE is specified. We might need an additional TraceLevel for this case.\n\n\nRun clang-format -style=Google over the code to take care of style issues (which should trigger a failure in the presubmit).", "body": "Reassigning this to @prb12, since he knows the ins and outs of the logging path better than I do. A few quick observations though:\r\n\r\n* Instead of modifying the `BaseRendezvousMgr` and related classes to capture this information, please use the existing stubs in `GrpcWorkerCache`:\r\n\r\n  https://github.com/tensorflow/tensorflow/blob/c0662f1620c2b97abb79b8ae6a8a30f7c7719475/tensorflow/core/distributed_runtime/rpc/grpc_worker_cache.cc#L86-L92\r\n\r\n* The changes in `master_session.cc` are potentially controversial, because they could cause a lot of additional logging to be generated when `FULL_TRACE` is specified. We might need an additional `TraceLevel` for this case.\r\n\r\n* Run `clang-format -style=Google` over the code to take care of style issues (which should trigger a failure in the presubmit)."}