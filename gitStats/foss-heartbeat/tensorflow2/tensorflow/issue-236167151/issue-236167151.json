{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10730", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10730/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10730/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10730/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/10730", "id": 236167151, "node_id": "MDU6SXNzdWUyMzYxNjcxNTE=", "number": 10730, "title": "All the graph have an operation _Retval that makes the train loop slow", "user": {"login": "zhaoerchao", "id": 9522983, "node_id": "MDQ6VXNlcjk1MjI5ODM=", "avatar_url": "https://avatars3.githubusercontent.com/u/9522983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhaoerchao", "html_url": "https://github.com/zhaoerchao", "followers_url": "https://api.github.com/users/zhaoerchao/followers", "following_url": "https://api.github.com/users/zhaoerchao/following{/other_user}", "gists_url": "https://api.github.com/users/zhaoerchao/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhaoerchao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhaoerchao/subscriptions", "organizations_url": "https://api.github.com/users/zhaoerchao/orgs", "repos_url": "https://api.github.com/users/zhaoerchao/repos", "events_url": "https://api.github.com/users/zhaoerchao/events{/privacy}", "received_events_url": "https://api.github.com/users/zhaoerchao/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 17, "created_at": "2017-06-15T12:00:24Z", "updated_at": "2017-12-21T18:29:34Z", "closed_at": "2017-12-21T18:29:33Z", "author_association": "NONE", "body_html": "<p>I have tried to train the model in <a href=\"https://github.com/tensorflow/benchmarks/blob/master/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py\">tf_cnn_benchmarks.py</a> and <a href=\"https://github.com/tensorflow/models/blob/master/tutorials/image/cifar10/cifar10_multi_gpu_train.py\">cifar10_multi_gpu_train.py</a>.</p>\n<p>All the timelines results like the image bellow. There is an operation named '_Retval' in the end of training loop. But as we see, long idle time was leaved in the timeline. How can I make the training faster by getting rid of the operation '_Retval' ? Is there other method to let the gpu be at full power?</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/9522983/27180240-0e26c2f0-5205-11e7-9f7e-98be45a6a2b2.png\"><img src=\"https://user-images.githubusercontent.com/9522983/27180240-0e26c2f0-5205-11e7-9f7e-98be45a6a2b2.png\" alt=\"2017-06-15 19 57 31\" style=\"max-width:100%;\"></a><br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/9522983/27180242-120350fa-5205-11e7-89f1-5d3fe6261293.png\"><img src=\"https://user-images.githubusercontent.com/9522983/27180242-120350fa-5205-11e7-89f1-5d3fe6261293.png\" alt=\"2017-06-15 19 58 33\" style=\"max-width:100%;\"></a></p>\n<p>The images above were got by the script:</p>\n<p>python tf_cnn_benchmarks.py local_parameter_device=cpu --num_gpus=2 --batch_size=64 --model=vgg16 --variable_update=independent --optimizer=sgd --trace_file=/home/zhaoerchao/timeline_benchmark.json --distortions</p>", "body_text": "I have tried to train the model in tf_cnn_benchmarks.py and cifar10_multi_gpu_train.py.\nAll the timelines results like the image bellow. There is an operation named '_Retval' in the end of training loop. But as we see, long idle time was leaved in the timeline. How can I make the training faster by getting rid of the operation '_Retval' ? Is there other method to let the gpu be at full power?\n\n\nThe images above were got by the script:\npython tf_cnn_benchmarks.py local_parameter_device=cpu --num_gpus=2 --batch_size=64 --model=vgg16 --variable_update=independent --optimizer=sgd --trace_file=/home/zhaoerchao/timeline_benchmark.json --distortions", "body": "I have tried to train the model in [tf_cnn_benchmarks.py](https://github.com/tensorflow/benchmarks/blob/master/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py) and [cifar10_multi_gpu_train.py](https://github.com/tensorflow/models/blob/master/tutorials/image/cifar10/cifar10_multi_gpu_train.py).\r\n\r\nAll the timelines results like the image bellow. There is an operation named '_Retval' in the end of training loop. But as we see, long idle time was leaved in the timeline. How can I make the training faster by getting rid of the operation '_Retval' ? Is there other method to let the gpu be at full power?\r\n\r\n![2017-06-15 19 57 31](https://user-images.githubusercontent.com/9522983/27180240-0e26c2f0-5205-11e7-9f7e-98be45a6a2b2.png)\r\n![2017-06-15 19 58 33](https://user-images.githubusercontent.com/9522983/27180242-120350fa-5205-11e7-89f1-5d3fe6261293.png)\r\n\r\nThe images above were got by the script:\r\n\r\npython tf_cnn_benchmarks.py local_parameter_device=cpu --num_gpus=2 --batch_size=64 --model=vgg16 --variable_update=independent --optimizer=sgd --trace_file=/home/zhaoerchao/timeline_benchmark.json --distortions"}