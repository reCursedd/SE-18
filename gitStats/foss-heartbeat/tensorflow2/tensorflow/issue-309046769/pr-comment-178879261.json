{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/178879261", "pull_request_review_id": 109015596, "id": 178879261, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODg3OTI2MQ==", "diff_hunk": "@@ -299,6 +317,26 @@ else\n   sed \"s/^RUN git clone --branch=.* --depth=1/RUN git clone --branch=${TF_DOCKER_BUILD_DEVEL_BRANCH} --depth=1/\" \\\n       \"${ORIG_DOCKERFILE}\" > \"${DOCKERFILE}\"\n \n+  # Modify the devel Dockerfile to specify the MKL bazel build parameters\n+  if [[ \"${TF_DOCKER_BUILD_TYPE}\" == \"mkl\" ]]; then\n+    if sed -i -e 's/bazel build -c opt /bazel build -c opt --config=mkl /g' \"${DOCKERFILE}\"\n+    then\n+      echo \"Modified Dockerfile to add MKL support.\"\n+    else\n+      die \"FAILED to add MKL support to ${DOCKERFILE}.\"\n+    fi\n+  fi\n+\n+  # Modify the devel Dockerfile with bazel build options\n+  if [[ ! -z ${TF_BAZEL_BUILD_OPTIONS} ]]; then\n+    if sed -i -e \"s/--cxxopt=\\\"-D_GLIBCXX_USE_CXX11_ABI=0\\\" /--cxxopt=\\\"-D_GLIBCXX_USE_CXX11_ABI=0\\\" ${TF_BAZEL_BUILD_OPTIONS} /g\" \"${DOCKERFILE}\"", "path": "tensorflow/tools/docker/parameterized_docker_build.sh", "position": 75, "original_position": 66, "commit_id": "49cbab0811f201ee75bd62d8f9aa37f09a7b22da", "original_commit_id": "fdf55184fb07d2a2ac8496e83949ebe7dc5afbeb", "user": {"login": "claynerobison", "id": 23344461, "node_id": "MDQ6VXNlcjIzMzQ0NDYx", "avatar_url": "https://avatars1.githubusercontent.com/u/23344461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/claynerobison", "html_url": "https://github.com/claynerobison", "followers_url": "https://api.github.com/users/claynerobison/followers", "following_url": "https://api.github.com/users/claynerobison/following{/other_user}", "gists_url": "https://api.github.com/users/claynerobison/gists{/gist_id}", "starred_url": "https://api.github.com/users/claynerobison/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/claynerobison/subscriptions", "organizations_url": "https://api.github.com/users/claynerobison/orgs", "repos_url": "https://api.github.com/users/claynerobison/repos", "events_url": "https://api.github.com/users/claynerobison/events{/privacy}", "received_events_url": "https://api.github.com/users/claynerobison/received_events", "type": "User", "site_admin": false}, "body": "Same comment as above. I'm just following the pattern that the original authors were using, regardless of elegance. \r\n\r\nDockerfiles themselves can have variables that can be overridden on the docker build command. For example, if the following line is in a Dockerfile:\r\n\r\n`ARG WHL_DIR=/whl`\r\n\r\nthen when building the container, the caller can override the default value of WHL_DIR like this:\r\n\r\n`docker build --build-arg WHL_DIR=<some path> . -f <docker file>`\r\n\r\nThat would be more elegant in my opinion.", "created_at": "2018-04-03T16:10:05Z", "updated_at": "2018-04-20T22:13:51Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/18020#discussion_r178879261", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/18020", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/178879261"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/18020#discussion_r178879261"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/18020"}}, "body_html": "<p>Same comment as above. I'm just following the pattern that the original authors were using, regardless of elegance.</p>\n<p>Dockerfiles themselves can have variables that can be overridden on the docker build command. For example, if the following line is in a Dockerfile:</p>\n<p><code>ARG WHL_DIR=/whl</code></p>\n<p>then when building the container, the caller can override the default value of WHL_DIR like this:</p>\n<p><code>docker build --build-arg WHL_DIR=&lt;some path&gt; . -f &lt;docker file&gt;</code></p>\n<p>That would be more elegant in my opinion.</p>", "body_text": "Same comment as above. I'm just following the pattern that the original authors were using, regardless of elegance.\nDockerfiles themselves can have variables that can be overridden on the docker build command. For example, if the following line is in a Dockerfile:\nARG WHL_DIR=/whl\nthen when building the container, the caller can override the default value of WHL_DIR like this:\ndocker build --build-arg WHL_DIR=<some path> . -f <docker file>\nThat would be more elegant in my opinion.", "in_reply_to_id": 178732914}