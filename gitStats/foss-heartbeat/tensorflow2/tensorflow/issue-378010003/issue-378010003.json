{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23563", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23563/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23563/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23563/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23563", "id": 378010003, "node_id": "MDU6SXNzdWUzNzgwMTAwMDM=", "number": 23563, "title": "After Tflite toco, conv2d layer becomes depthwiseconv2d.", "user": {"login": "ZJPUBG", "id": 31113955, "node_id": "MDQ6VXNlcjMxMTEzOTU1", "avatar_url": "https://avatars2.githubusercontent.com/u/31113955?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ZJPUBG", "html_url": "https://github.com/ZJPUBG", "followers_url": "https://api.github.com/users/ZJPUBG/followers", "following_url": "https://api.github.com/users/ZJPUBG/following{/other_user}", "gists_url": "https://api.github.com/users/ZJPUBG/gists{/gist_id}", "starred_url": "https://api.github.com/users/ZJPUBG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ZJPUBG/subscriptions", "organizations_url": "https://api.github.com/users/ZJPUBG/orgs", "repos_url": "https://api.github.com/users/ZJPUBG/repos", "events_url": "https://api.github.com/users/ZJPUBG/events{/privacy}", "received_events_url": "https://api.github.com/users/ZJPUBG/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 750616506, "node_id": "MDU6TGFiZWw3NTA2MTY1MDY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:lite", "name": "comp:lite", "color": "0052cc", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-11-06T19:59:08Z", "updated_at": "2018-11-13T00:24:06Z", "closed_at": "2018-11-12T23:09:05Z", "author_association": "NONE", "body_html": "<p><strong>System information</strong></p>\n<ul>\n<li>Have I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes.</li>\n<li>OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 16.04</li>\n<li>Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: No.</li>\n<li>TensorFlow installed from (source or binary): binary</li>\n<li>TensorFlow version (use command below): 1.10.0</li>\n<li>Python version: 3.6.6</li>\n<li>Bazel version (if compiling from source):</li>\n<li>GCC/Compiler version (if compiling from source):</li>\n<li>CUDA/cuDNN version: on CPU</li>\n<li>GPU model and memory: on CPU</li>\n</ul>\n<p><strong>Describe the current behavior</strong><br>\nI'm using tensorflow speech_command example's tiny_conv model <a href=\"https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/speech_commands\">from here</a>. I've trained it and froze it (with quantization set to true) following <a href=\"https://www.tensorflow.org/tutorials/sequences/audio_recognition\" rel=\"nofollow\">the official tutorial</a>.<br>\nThe model itself is simple: one conv2d layer and one fully connected layer.<br>\nNow, I send the froze .pb file to tensorflow lite. I can successfully get the .tflite file. However, when I check the model, the original tiny_conv model's conv2d layer becomes a depthwiseconv2d layer.( I have tried several toco converts on other models, they do not have this behavior. ) I'm wondering how could this happen? I have the .pb model shown below, followed by the .tflite model:<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/31113955/48089764-10fd4300-e1ba-11e8-952c-3c25c854103e.JPG\"><img src=\"https://user-images.githubusercontent.com/31113955/48089764-10fd4300-e1ba-11e8-952c-3c25c854103e.JPG\" alt=\"freeze\" style=\"max-width:100%;\"></a><br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/31113955/48089771-165a8d80-e1ba-11e8-9558-2986b76dd9f8.JPG\"><img src=\"https://user-images.githubusercontent.com/31113955/48089771-165a8d80-e1ba-11e8-9558-2986b76dd9f8.JPG\" alt=\"tflite\" style=\"max-width:100%;\"></a><br>\nAs you can see, the conv2d layer becomes depthwiseconv2d.</p>\n<p><strong>Describe the expected behavior</strong><br>\nThe expected behavior is after toco, the .tflite still has one conv2d layer and one fully connected layer.</p>\n<p><strong>Code to reproduce the issue</strong><br>\nAfter training and freezing, in toco, I have following code:<br>\n`graph_def_file = \"my_frozen.pb\"     //This is the .pb file.<br>\ninput_arrays = [\"Reshape_1\"]        //This is the name of the input node<br>\noutput_arrays = [\"labels_softmax\"]  //This is the name of the ouput node</p>\n<p>//This is the main code to call toco<br>\nconverter = tf.contrib.lite.TocoConverter.from_frozen_graph(graph_def_file, input_arrays, output_arrays)<br>\n//Since fake quantization during training, we quantize the graph during converting<br>\nconverter.inference_type = tf.contrib.lite.constants.QUANTIZED_UINT8<br>\ninput_arrays = converter.get_input_arrays()<br>\nconverter.quantized_input_stats = {input_arrays[0] : (0., 2.)}  //mean, std_dev <a href=\"https://github.com/tensorflow/tensorflow/tree/master/tensorflow/lite/experimental/micro/examples/micro_speech\">from this tensorflow tutorial</a><br>\ntflite_model = converter.convert()<br>\nopen(\"tiny_conv.tflite\", \"wb\").write(tflite_model)   //The resulting .tflite file.`</p>\n<p><strong>Other info / logs</strong><br>\nInclude any logs or source code that would be helpful to diagnose the problem. If including tracebacks, please include the full traceback. Large logs and files should be attached.</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes.\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 16.04\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: No.\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below): 1.10.0\nPython version: 3.6.6\nBazel version (if compiling from source):\nGCC/Compiler version (if compiling from source):\nCUDA/cuDNN version: on CPU\nGPU model and memory: on CPU\n\nDescribe the current behavior\nI'm using tensorflow speech_command example's tiny_conv model from here. I've trained it and froze it (with quantization set to true) following the official tutorial.\nThe model itself is simple: one conv2d layer and one fully connected layer.\nNow, I send the froze .pb file to tensorflow lite. I can successfully get the .tflite file. However, when I check the model, the original tiny_conv model's conv2d layer becomes a depthwiseconv2d layer.( I have tried several toco converts on other models, they do not have this behavior. ) I'm wondering how could this happen? I have the .pb model shown below, followed by the .tflite model:\n\n\nAs you can see, the conv2d layer becomes depthwiseconv2d.\nDescribe the expected behavior\nThe expected behavior is after toco, the .tflite still has one conv2d layer and one fully connected layer.\nCode to reproduce the issue\nAfter training and freezing, in toco, I have following code:\n`graph_def_file = \"my_frozen.pb\"     //This is the .pb file.\ninput_arrays = [\"Reshape_1\"]        //This is the name of the input node\noutput_arrays = [\"labels_softmax\"]  //This is the name of the ouput node\n//This is the main code to call toco\nconverter = tf.contrib.lite.TocoConverter.from_frozen_graph(graph_def_file, input_arrays, output_arrays)\n//Since fake quantization during training, we quantize the graph during converting\nconverter.inference_type = tf.contrib.lite.constants.QUANTIZED_UINT8\ninput_arrays = converter.get_input_arrays()\nconverter.quantized_input_stats = {input_arrays[0] : (0., 2.)}  //mean, std_dev from this tensorflow tutorial\ntflite_model = converter.convert()\nopen(\"tiny_conv.tflite\", \"wb\").write(tflite_model)   //The resulting .tflite file.`\nOther info / logs\nInclude any logs or source code that would be helpful to diagnose the problem. If including tracebacks, please include the full traceback. Large logs and files should be attached.", "body": "**System information**\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes.\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 16.04\r\n- Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: No.\r\n- TensorFlow installed from (source or binary): binary\r\n- TensorFlow version (use command below): 1.10.0\r\n- Python version: 3.6.6\r\n- Bazel version (if compiling from source):\r\n- GCC/Compiler version (if compiling from source):\r\n- CUDA/cuDNN version: on CPU\r\n- GPU model and memory: on CPU\r\n\r\n**Describe the current behavior**\r\nI'm using tensorflow speech_command example's tiny_conv model [from here](https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/speech_commands). I've trained it and froze it (with quantization set to true) following [the official tutorial](https://www.tensorflow.org/tutorials/sequences/audio_recognition). \r\nThe model itself is simple: one conv2d layer and one fully connected layer.\r\nNow, I send the froze .pb file to tensorflow lite. I can successfully get the .tflite file. However, when I check the model, the original tiny_conv model's conv2d layer becomes a depthwiseconv2d layer.( I have tried several toco converts on other models, they do not have this behavior. ) I'm wondering how could this happen? I have the .pb model shown below, followed by the .tflite model:\r\n![freeze](https://user-images.githubusercontent.com/31113955/48089764-10fd4300-e1ba-11e8-952c-3c25c854103e.JPG)\r\n![tflite](https://user-images.githubusercontent.com/31113955/48089771-165a8d80-e1ba-11e8-9558-2986b76dd9f8.JPG)\r\nAs you can see, the conv2d layer becomes depthwiseconv2d.\r\n\r\n**Describe the expected behavior**\r\nThe expected behavior is after toco, the .tflite still has one conv2d layer and one fully connected layer.\r\n\r\n**Code to reproduce the issue**\r\nAfter training and freezing, in toco, I have following code:\r\n`graph_def_file = \"my_frozen.pb\"     //This is the .pb file.\r\ninput_arrays = [\"Reshape_1\"]        //This is the name of the input node\r\noutput_arrays = [\"labels_softmax\"]  //This is the name of the ouput node\r\n\r\n//This is the main code to call toco\r\nconverter = tf.contrib.lite.TocoConverter.from_frozen_graph(graph_def_file, input_arrays, output_arrays)\r\n//Since fake quantization during training, we quantize the graph during converting\r\nconverter.inference_type = tf.contrib.lite.constants.QUANTIZED_UINT8\r\ninput_arrays = converter.get_input_arrays()\r\nconverter.quantized_input_stats = {input_arrays[0] : (0., 2.)}  //mean, std_dev [from this tensorflow tutorial](https://github.com/tensorflow/tensorflow/tree/master/tensorflow/lite/experimental/micro/examples/micro_speech)\r\ntflite_model = converter.convert()\r\nopen(\"tiny_conv.tflite\", \"wb\").write(tflite_model)   //The resulting .tflite file.`\r\n\r\n**Other info / logs**\r\nInclude any logs or source code that would be helpful to diagnose the problem. If including tracebacks, please include the full traceback. Large logs and files should be attached.\r\n"}