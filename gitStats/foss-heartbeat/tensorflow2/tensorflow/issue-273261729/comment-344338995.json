{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/344338995", "html_url": "https://github.com/tensorflow/tensorflow/issues/14504#issuecomment-344338995", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14504", "id": 344338995, "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDMzODk5NQ==", "user": {"login": "droidicus", "id": 6981482, "node_id": "MDQ6VXNlcjY5ODE0ODI=", "avatar_url": "https://avatars2.githubusercontent.com/u/6981482?v=4", "gravatar_id": "", "url": "https://api.github.com/users/droidicus", "html_url": "https://github.com/droidicus", "followers_url": "https://api.github.com/users/droidicus/followers", "following_url": "https://api.github.com/users/droidicus/following{/other_user}", "gists_url": "https://api.github.com/users/droidicus/gists{/gist_id}", "starred_url": "https://api.github.com/users/droidicus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/droidicus/subscriptions", "organizations_url": "https://api.github.com/users/droidicus/orgs", "repos_url": "https://api.github.com/users/droidicus/repos", "events_url": "https://api.github.com/users/droidicus/events{/privacy}", "received_events_url": "https://api.github.com/users/droidicus/received_events", "type": "User", "site_admin": false}, "created_at": "2017-11-14T17:43:33Z", "updated_at": "2017-11-14T17:50:44Z", "author_association": "NONE", "body_html": "<p>Primary reference for the Keras model -&gt; Estimator: <a href=\"https://www.tensorflow.org/api_docs/python/tf/keras/estimator/model_to_estimator\" rel=\"nofollow\">https://www.tensorflow.org/api_docs/python/tf/keras/estimator/model_to_estimator</a><br>\nPrimary reference for the TF_CONFIG settings for cluster: <a href=\"https://www.tensorflow.org/api_docs/python/tf/estimator/train_and_evaluate\" rel=\"nofollow\">https://www.tensorflow.org/api_docs/python/tf/estimator/train_and_evaluate</a><br>\nPrimary reference for gcloud ml-engine: <a href=\"https://cloud.google.com/sdk/gcloud/reference/ml-engine/\" rel=\"nofollow\">https://cloud.google.com/sdk/gcloud/reference/ml-engine/</a></p>\n<p>I agree that the code snippet above will likely not proceed to completion when <code>simulate_cluster</code> is set to true even without the error shown above, since this is just simulating a single job (in this case master). It is rather intended to show that when the custer spec is set in the <code>TF_CONFIG</code> variable (as required by <code>tf.estimator.train_and_evaluate()</code>) the call to <code>tf.keras.estimator.model_to_estimator()</code> fails with an <code>InvalidArgumentError</code>.</p>\n<p>The code after the call to <code>tf.keras.estimator.model_to_estimator()</code> is there only to show that the estimator created from the keras model works correctly when <code>simulate_cluster</code> is set to false, and is not intended to show a full working distributed training solution. I do have a full solution, but it is much larger and multi-file, this was an attempt at a minimal example of the keras estimator error only.</p>\n<p>The full model training code is based on a working example in TFv1.3 using <code>tf.estimator.EstimatorSpec()</code> to manually create an estimator from a keras model ops, <code>tf.contrib.learn.Experiment()</code>, and <code>tf.contrib.learn.learn_runner.run()</code>. The hope here is to transition over to core functions since TFv1.4 now has them.</p>", "body_text": "Primary reference for the Keras model -> Estimator: https://www.tensorflow.org/api_docs/python/tf/keras/estimator/model_to_estimator\nPrimary reference for the TF_CONFIG settings for cluster: https://www.tensorflow.org/api_docs/python/tf/estimator/train_and_evaluate\nPrimary reference for gcloud ml-engine: https://cloud.google.com/sdk/gcloud/reference/ml-engine/\nI agree that the code snippet above will likely not proceed to completion when simulate_cluster is set to true even without the error shown above, since this is just simulating a single job (in this case master). It is rather intended to show that when the custer spec is set in the TF_CONFIG variable (as required by tf.estimator.train_and_evaluate()) the call to tf.keras.estimator.model_to_estimator() fails with an InvalidArgumentError.\nThe code after the call to tf.keras.estimator.model_to_estimator() is there only to show that the estimator created from the keras model works correctly when simulate_cluster is set to false, and is not intended to show a full working distributed training solution. I do have a full solution, but it is much larger and multi-file, this was an attempt at a minimal example of the keras estimator error only.\nThe full model training code is based on a working example in TFv1.3 using tf.estimator.EstimatorSpec() to manually create an estimator from a keras model ops, tf.contrib.learn.Experiment(), and tf.contrib.learn.learn_runner.run(). The hope here is to transition over to core functions since TFv1.4 now has them.", "body": "Primary reference for the Keras model -> Estimator: https://www.tensorflow.org/api_docs/python/tf/keras/estimator/model_to_estimator\r\nPrimary reference for the TF_CONFIG settings for cluster: https://www.tensorflow.org/api_docs/python/tf/estimator/train_and_evaluate\r\nPrimary reference for gcloud ml-engine: https://cloud.google.com/sdk/gcloud/reference/ml-engine/\r\n\r\nI agree that the code snippet above will likely not proceed to completion when ```simulate_cluster``` is set to true even without the error shown above, since this is just simulating a single job (in this case master). It is rather intended to show that when the custer spec is set in the ```TF_CONFIG``` variable (as required by ```tf.estimator.train_and_evaluate()```) the call to ```tf.keras.estimator.model_to_estimator()``` fails with an ```InvalidArgumentError```.\r\n\r\nThe code after the call to ```tf.keras.estimator.model_to_estimator()``` is there only to show that the estimator created from the keras model works correctly when ```simulate_cluster``` is set to false, and is not intended to show a full working distributed training solution. I do have a full solution, but it is much larger and multi-file, this was an attempt at a minimal example of the keras estimator error only.\r\n\r\nThe full model training code is based on a working example in TFv1.3 using ```tf.estimator.EstimatorSpec()``` to manually create an estimator from a keras model ops, ```tf.contrib.learn.Experiment()```, and ```tf.contrib.learn.learn_runner.run()```. The hope here is to transition over to core functions since TFv1.4 now has them."}