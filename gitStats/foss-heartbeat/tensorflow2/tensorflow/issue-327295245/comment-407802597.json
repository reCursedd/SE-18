{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/407802597", "html_url": "https://github.com/tensorflow/tensorflow/issues/19619#issuecomment-407802597", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19619", "id": 407802597, "node_id": "MDEyOklzc3VlQ29tbWVudDQwNzgwMjU5Nw==", "user": {"login": "yegord", "id": 1595829, "node_id": "MDQ6VXNlcjE1OTU4Mjk=", "avatar_url": "https://avatars1.githubusercontent.com/u/1595829?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yegord", "html_url": "https://github.com/yegord", "followers_url": "https://api.github.com/users/yegord/followers", "following_url": "https://api.github.com/users/yegord/following{/other_user}", "gists_url": "https://api.github.com/users/yegord/gists{/gist_id}", "starred_url": "https://api.github.com/users/yegord/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yegord/subscriptions", "organizations_url": "https://api.github.com/users/yegord/orgs", "repos_url": "https://api.github.com/users/yegord/repos", "events_url": "https://api.github.com/users/yegord/events{/privacy}", "received_events_url": "https://api.github.com/users/yegord/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-25T15:49:48Z", "updated_at": "2018-07-25T15:49:48Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Is the old way of creating an optimized graph with</p>\n<pre><code>    graph_def = trt.create_inference_graph(\n        input_graph_def=graph_def,\n        outputs=output_node_names,\n        max_batch_size=num_cameras,\n        max_workspace_size_bytes=1 &lt;&lt; 25, \n        precision_mode=precision_mode,\n        minimum_segment_size=10,  # minimum number of nodes in an engine,\n    )   \n</code></pre>\n<p>still supposed to work?</p>\n<p>I still get</p>\n<pre><code>Traceback (most recent call last):\n  File \"ros/src/perception/detection/tools/deploy.py\", line 294, in &lt;module&gt;\n    main()\n  File \"ros/src/perception/detection/tools/deploy.py\", line 40, in main\n    graph_def = _make_inference_graph(model, args.num_cameras)\n  File \"ros/src/perception/detection/tools/deploy.py\", line 270, in _make_inference_graph\n    minimum_segment_size=10,  # minimum number of nodes in an engine,\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/tensorrt/python/trt_convert.py\", line 153, in create_inference_graph\n    int(msg[0]))\ntensorflow.python.framework.errors_impl.NotFoundError: No attr named 'shape' in NodeDef:\n         [[Node: placeholders/image_0 = Placeholder[dtype=DT_UINT8]()]] for 'placeholders/image_0' (op: 'Placeholder') with input shapes: .\n</code></pre>\n<p>when I try to call create_inference_graph, even after the fix <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"341207692\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/20794\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/20794/hovercard\" href=\"https://github.com/tensorflow/tensorflow/pull/20794\">#20794</a>, on master (2791d58c2bbbce833a3de73503816d881a06cfe3).</p>\n<p>Do I need to run a couple of optimization passes before I call create_inference_graph (like here: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"327295245\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/19619\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/19619/hovercard?comment_id=405003062&amp;comment_type=issue_comment\" href=\"https://github.com/tensorflow/tensorflow/issues/19619#issuecomment-405003062\">#19619 (comment)</a>)? If yes, how do I do it outside session.run()? Maybe, there is a public manual on grappler and graph rewritings that you could recommend to read?</p>\n<p>Thank you.</p>", "body_text": "Is the old way of creating an optimized graph with\n    graph_def = trt.create_inference_graph(\n        input_graph_def=graph_def,\n        outputs=output_node_names,\n        max_batch_size=num_cameras,\n        max_workspace_size_bytes=1 << 25, \n        precision_mode=precision_mode,\n        minimum_segment_size=10,  # minimum number of nodes in an engine,\n    )   \n\nstill supposed to work?\nI still get\nTraceback (most recent call last):\n  File \"ros/src/perception/detection/tools/deploy.py\", line 294, in <module>\n    main()\n  File \"ros/src/perception/detection/tools/deploy.py\", line 40, in main\n    graph_def = _make_inference_graph(model, args.num_cameras)\n  File \"ros/src/perception/detection/tools/deploy.py\", line 270, in _make_inference_graph\n    minimum_segment_size=10,  # minimum number of nodes in an engine,\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/tensorrt/python/trt_convert.py\", line 153, in create_inference_graph\n    int(msg[0]))\ntensorflow.python.framework.errors_impl.NotFoundError: No attr named 'shape' in NodeDef:\n         [[Node: placeholders/image_0 = Placeholder[dtype=DT_UINT8]()]] for 'placeholders/image_0' (op: 'Placeholder') with input shapes: .\n\nwhen I try to call create_inference_graph, even after the fix #20794, on master (2791d58c2bbbce833a3de73503816d881a06cfe3).\nDo I need to run a couple of optimization passes before I call create_inference_graph (like here: #19619 (comment))? If yes, how do I do it outside session.run()? Maybe, there is a public manual on grappler and graph rewritings that you could recommend to read?\nThank you.", "body": "Is the old way of creating an optimized graph with\r\n```\r\n    graph_def = trt.create_inference_graph(\r\n        input_graph_def=graph_def,\r\n        outputs=output_node_names,\r\n        max_batch_size=num_cameras,\r\n        max_workspace_size_bytes=1 << 25, \r\n        precision_mode=precision_mode,\r\n        minimum_segment_size=10,  # minimum number of nodes in an engine,\r\n    )   \r\n```\r\nstill supposed to work?\r\n\r\nI still get\r\n```\r\nTraceback (most recent call last):\r\n  File \"ros/src/perception/detection/tools/deploy.py\", line 294, in <module>\r\n    main()\r\n  File \"ros/src/perception/detection/tools/deploy.py\", line 40, in main\r\n    graph_def = _make_inference_graph(model, args.num_cameras)\r\n  File \"ros/src/perception/detection/tools/deploy.py\", line 270, in _make_inference_graph\r\n    minimum_segment_size=10,  # minimum number of nodes in an engine,\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/tensorrt/python/trt_convert.py\", line 153, in create_inference_graph\r\n    int(msg[0]))\r\ntensorflow.python.framework.errors_impl.NotFoundError: No attr named 'shape' in NodeDef:\r\n         [[Node: placeholders/image_0 = Placeholder[dtype=DT_UINT8]()]] for 'placeholders/image_0' (op: 'Placeholder') with input shapes: .\r\n```\r\nwhen I try to call create_inference_graph, even after the fix https://github.com/tensorflow/tensorflow/pull/20794, on master (2791d58c2bbbce833a3de73503816d881a06cfe3).\r\n\r\nDo I need to run a couple of optimization passes before I call create_inference_graph (like here: https://github.com/tensorflow/tensorflow/issues/19619#issuecomment-405003062)? If yes, how do I do it outside session.run()? Maybe, there is a public manual on grappler and graph rewritings that you could recommend to read?\r\n\r\nThank you."}