{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11773", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11773/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11773/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11773/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/11773", "id": 245623493, "node_id": "MDExOlB1bGxSZXF1ZXN0MTMyNDQyNzQw", "number": 11773, "title": "Enable Android lib bazel build for mips and mips64", "user": {"login": "resec", "id": 4277636, "node_id": "MDQ6VXNlcjQyNzc2MzY=", "avatar_url": "https://avatars0.githubusercontent.com/u/4277636?v=4", "gravatar_id": "", "url": "https://api.github.com/users/resec", "html_url": "https://github.com/resec", "followers_url": "https://api.github.com/users/resec/followers", "following_url": "https://api.github.com/users/resec/following{/other_user}", "gists_url": "https://api.github.com/users/resec/gists{/gist_id}", "starred_url": "https://api.github.com/users/resec/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/resec/subscriptions", "organizations_url": "https://api.github.com/users/resec/orgs", "repos_url": "https://api.github.com/users/resec/repos", "events_url": "https://api.github.com/users/resec/events{/privacy}", "received_events_url": "https://api.github.com/users/resec/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-07-26T06:54:58Z", "updated_at": "2017-07-26T17:51:18Z", "closed_at": "2017-07-26T17:51:18Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/11773", "html_url": "https://github.com/tensorflow/tensorflow/pull/11773", "diff_url": "https://github.com/tensorflow/tensorflow/pull/11773.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/11773.patch"}, "body_html": "<p>Currently the Android .so lib bazel build is failing for <code>--cpu=mips</code> and <code>--cpu=mips64</code>. This PR is fixing this.</p>\n<p>The changes are:</p>\n<ul>\n<li>Add \"-latomic\" linkopt for <code>--cpu=mips</code>,  this is to avoid failing at the end for <code>undefined reference to '__atomic_*'</code> alike errors.</li>\n<li>Remove <code>-Os</code> optimization flag for <code>--cpu=mips</code> and <code>--cpu=mips64</code>, this is to avoid failing in compiling <code>tensorflow/core/lib/core/threadpool.o</code> for <code>failure memory model cannot be stronger than success memory model for '__atomic_compare_exchange'</code> errors.</li>\n<li>Added some hints in <code>tensorflow/workspace.bzl</code> for API level selection when compiling 64-bit lib.</li>\n</ul>\n<p>By checking online, seems there is a bug in gcc compiler (at least the gcc inside NDK r12b, I did try using newer NDK version, however since r13b, the default compiler is changed to clang, and bazel is only working with clang with NDK r13b or higher, as well as currently, compiling Tensorflow with clang is failing for some strange errors to me, so it did not work), that in some cases, <code>-Os</code> flag would crash the compiling. Removing <code>-Os</code> for <code>--cpu=mips</code> and <code>--cpu=mips64</code> is only a sub-optimal solution as the generated .so lib will be relatively bigger (but not much).</p>", "body_text": "Currently the Android .so lib bazel build is failing for --cpu=mips and --cpu=mips64. This PR is fixing this.\nThe changes are:\n\nAdd \"-latomic\" linkopt for --cpu=mips,  this is to avoid failing at the end for undefined reference to '__atomic_*' alike errors.\nRemove -Os optimization flag for --cpu=mips and --cpu=mips64, this is to avoid failing in compiling tensorflow/core/lib/core/threadpool.o for failure memory model cannot be stronger than success memory model for '__atomic_compare_exchange' errors.\nAdded some hints in tensorflow/workspace.bzl for API level selection when compiling 64-bit lib.\n\nBy checking online, seems there is a bug in gcc compiler (at least the gcc inside NDK r12b, I did try using newer NDK version, however since r13b, the default compiler is changed to clang, and bazel is only working with clang with NDK r13b or higher, as well as currently, compiling Tensorflow with clang is failing for some strange errors to me, so it did not work), that in some cases, -Os flag would crash the compiling. Removing -Os for --cpu=mips and --cpu=mips64 is only a sub-optimal solution as the generated .so lib will be relatively bigger (but not much).", "body": "Currently the Android .so lib bazel build is failing for `--cpu=mips` and `--cpu=mips64`. This PR is fixing this.\r\n\r\nThe changes are:\r\n\r\n- Add \"-latomic\" linkopt for `--cpu=mips`,  this is to avoid failing at the end for `undefined reference to '__atomic_*'` alike errors.\r\n- Remove `-Os` optimization flag for `--cpu=mips` and `--cpu=mips64`, this is to avoid failing in compiling `tensorflow/core/lib/core/threadpool.o` for `failure memory model cannot be stronger than success memory model for '__atomic_compare_exchange'` errors.\r\n- Added some hints in `tensorflow/workspace.bzl` for API level selection when compiling 64-bit lib.\r\n\r\nBy checking online, seems there is a bug in gcc compiler (at least the gcc inside NDK r12b, I did try using newer NDK version, however since r13b, the default compiler is changed to clang, and bazel is only working with clang with NDK r13b or higher, as well as currently, compiling Tensorflow with clang is failing for some strange errors to me, so it did not work), that in some cases, `-Os` flag would crash the compiling. Removing `-Os` for `--cpu=mips` and `--cpu=mips64` is only a sub-optimal solution as the generated .so lib will be relatively bigger (but not much)."}