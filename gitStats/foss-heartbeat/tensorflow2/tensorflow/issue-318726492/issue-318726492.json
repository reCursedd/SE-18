{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18962", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18962/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18962/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18962/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/18962", "id": 318726492, "node_id": "MDU6SXNzdWUzMTg3MjY0OTI=", "number": 18962, "title": "bug of tf.extract_image_patches", "user": {"login": "DC-Swind", "id": 5043628, "node_id": "MDQ6VXNlcjUwNDM2Mjg=", "avatar_url": "https://avatars2.githubusercontent.com/u/5043628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DC-Swind", "html_url": "https://github.com/DC-Swind", "followers_url": "https://api.github.com/users/DC-Swind/followers", "following_url": "https://api.github.com/users/DC-Swind/following{/other_user}", "gists_url": "https://api.github.com/users/DC-Swind/gists{/gist_id}", "starred_url": "https://api.github.com/users/DC-Swind/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DC-Swind/subscriptions", "organizations_url": "https://api.github.com/users/DC-Swind/orgs", "repos_url": "https://api.github.com/users/DC-Swind/repos", "events_url": "https://api.github.com/users/DC-Swind/events{/privacy}", "received_events_url": "https://api.github.com/users/DC-Swind/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": {"login": "shivaniag", "id": 16565716, "node_id": "MDQ6VXNlcjE2NTY1NzE2", "avatar_url": "https://avatars1.githubusercontent.com/u/16565716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shivaniag", "html_url": "https://github.com/shivaniag", "followers_url": "https://api.github.com/users/shivaniag/followers", "following_url": "https://api.github.com/users/shivaniag/following{/other_user}", "gists_url": "https://api.github.com/users/shivaniag/gists{/gist_id}", "starred_url": "https://api.github.com/users/shivaniag/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shivaniag/subscriptions", "organizations_url": "https://api.github.com/users/shivaniag/orgs", "repos_url": "https://api.github.com/users/shivaniag/repos", "events_url": "https://api.github.com/users/shivaniag/events{/privacy}", "received_events_url": "https://api.github.com/users/shivaniag/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "shivaniag", "id": 16565716, "node_id": "MDQ6VXNlcjE2NTY1NzE2", "avatar_url": "https://avatars1.githubusercontent.com/u/16565716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shivaniag", "html_url": "https://github.com/shivaniag", "followers_url": "https://api.github.com/users/shivaniag/followers", "following_url": "https://api.github.com/users/shivaniag/following{/other_user}", "gists_url": "https://api.github.com/users/shivaniag/gists{/gist_id}", "starred_url": "https://api.github.com/users/shivaniag/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shivaniag/subscriptions", "organizations_url": "https://api.github.com/users/shivaniag/orgs", "repos_url": "https://api.github.com/users/shivaniag/repos", "events_url": "https://api.github.com/users/shivaniag/events{/privacy}", "received_events_url": "https://api.github.com/users/shivaniag/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2018-04-29T15:37:52Z", "updated_at": "2018-11-22T18:56:13Z", "closed_at": null, "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>OS Platform and Distribution</strong>: Linux Ubuntu  16.04</li>\n<li><strong>TensorFlow installed from pip</strong>:</li>\n<li><strong>TensorFlow version</strong>: 1.5</li>\n<li><strong>Python version</strong>: 2.7</li>\n<li><strong>CUDA/cuDNN version</strong>: 8.0</li>\n<li><strong>Have I written custom code</strong>: N/A</li>\n<li><strong>Bazel version</strong>: N/A</li>\n<li><strong>GPU model and memory</strong>: N/A</li>\n<li><strong>Exact command to reproduce</strong>: N/A</li>\n</ul>\n<h3>the problem</h3>\n<p>I have a input \"x\" which size is (batch, width, height, chanel), because the height of data is variable. so x.get_shape() is (?, 20, ?, 64). I use the following code to do something like im2col:<br>\n<code>im2col = tf.extract_image_patches(x, ksizes=[1, 1, KERNEL_SIZE, 1], strides=[1, 1, 1, 1], rates=[1, 1, 1, 1], padding=\"SAME\") </code><br>\nthe output \"im2col\" lost some shape, so I use the following code to set_shape:<br>\n<code>im2col.set_shape([shape1, shape2, shape3, KERNEL_SIZE * shape4])</code><br>\nand then reshape im2col to (shape1, shape2, shape3, KERNEL_SIZE, shape4)</p>\n<p>In the process of building graph, errors arise when processing optimization algorithms (Adam).</p>\n<blockquote>\n<p>TypeError: unsupported operand type(s) for /: 'NoneType' and 'long'</p>\n</blockquote>\n<p>I'm sure the error is produced by tf.extract_image_patches. If I replace tf.extract_image_patches with tf.tile (to make the output size of tf.tile same as tf.extract_image_patches), graph will be built sucessfully.</p>\n<h3>Error message</h3>\n<p>Traceback (most recent call last):<br>\nFile \"/home/anaconda2/bin/t2t-trainer\", line 32, in <br>\ntf.app.run()<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 129, in run<br>\n_sys.exit(main(argv))<br>\nFile \"/home/anaconda2/bin/t2t-trainer\", line 28, in main<br>\nt2t_trainer.main(argv)<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/bin/t2t_trainer.py\", line 338, in main<br>\nexecute_schedule(exp)<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/bin/t2t_trainer.py\", line 288, in execute_schedule<br>\ngetattr(exp, FLAGS.schedule)()<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/contrib/learn/python/learn/experiment.py\", line 635, in train_and_evaluate<br>\nself.train(delay_secs=0)<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/contrib/learn/python/learn/experiment.py\", line 377, in train<br>\nsaving_listeners=self._saving_listeners)<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/contrib/learn/python/learn/experiment.py\", line 824, in _call_train<br>\nsaving_listeners=saving_listeners)<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 314, in train<br>\nloss = self._train_model(input_fn, hooks, saving_listeners)<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 743, in _train_model<br>\nfeatures, labels, model_fn_lib.ModeKeys.TRAIN, self.config)<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 725, in _call_model_fn<br>\nmodel_fn_results = self._model_fn(features=features, **kwargs)<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/utils/t2t_model.py\", line 886, in wrapping_model_fn<br>\nuse_tpu=use_tpu)<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/utils/t2t_model.py\", line 980, in estimator_model_fn<br>\nloss, num_async_replicas=num_async_replicas)<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/utils/t2t_model.py\", line 984, in estimator_spec_train<br>\ntrain_op = self.optimize(loss, num_async_replicas=num_async_replicas)<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/utils/t2t_model.py\", line 401, in optimize<br>\nloss, lr, self.hparams, use_tpu=common_layers.is_on_tpu())<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/utils/optimize.py\", line 68, in optimize<br>\ncolocate_gradients_with_ops=True)<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/contrib/layers/python/layers/optimizers.py\", line 241, in optimize_loss<br>\ncolocate_gradients_with_ops=colocate_gradients_with_ops)<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/utils/optimize.py\", line 110, in compute_gradients<br>\ngradients = self._opt.compute_gradients(loss, var_list, **kwargs)<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/training/optimizer.py\", line 456, in compute_gradients<br>\ncolocate_gradients_with_ops=colocate_gradients_with_ops)<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gradients_impl.py\", line 608, in gradients<br>\ngrad_scope, op, func_call, lambda: grad_fn(op, *out_grads))<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gradients_impl.py\", line 374, in _MaybeCompile<br>\nreturn grad_fn()  # Exit early<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gradients_impl.py\", line 608, in <br>\ngrad_scope, op, func_call, lambda: grad_fn(op, *out_grads))<br>\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/array_grad.py\", line 724, in _ExtractImagePatchesGrad<br>\ncols_out = int(ceil(cols_in / stride_h))<br>\nTypeError: unsupported operand type(s) for /: 'NoneType' and 'long'</p>", "body_text": "System information\n\nOS Platform and Distribution: Linux Ubuntu  16.04\nTensorFlow installed from pip:\nTensorFlow version: 1.5\nPython version: 2.7\nCUDA/cuDNN version: 8.0\nHave I written custom code: N/A\nBazel version: N/A\nGPU model and memory: N/A\nExact command to reproduce: N/A\n\nthe problem\nI have a input \"x\" which size is (batch, width, height, chanel), because the height of data is variable. so x.get_shape() is (?, 20, ?, 64). I use the following code to do something like im2col:\nim2col = tf.extract_image_patches(x, ksizes=[1, 1, KERNEL_SIZE, 1], strides=[1, 1, 1, 1], rates=[1, 1, 1, 1], padding=\"SAME\") \nthe output \"im2col\" lost some shape, so I use the following code to set_shape:\nim2col.set_shape([shape1, shape2, shape3, KERNEL_SIZE * shape4])\nand then reshape im2col to (shape1, shape2, shape3, KERNEL_SIZE, shape4)\nIn the process of building graph, errors arise when processing optimization algorithms (Adam).\n\nTypeError: unsupported operand type(s) for /: 'NoneType' and 'long'\n\nI'm sure the error is produced by tf.extract_image_patches. If I replace tf.extract_image_patches with tf.tile (to make the output size of tf.tile same as tf.extract_image_patches), graph will be built sucessfully.\nError message\nTraceback (most recent call last):\nFile \"/home/anaconda2/bin/t2t-trainer\", line 32, in \ntf.app.run()\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 129, in run\n_sys.exit(main(argv))\nFile \"/home/anaconda2/bin/t2t-trainer\", line 28, in main\nt2t_trainer.main(argv)\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/bin/t2t_trainer.py\", line 338, in main\nexecute_schedule(exp)\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/bin/t2t_trainer.py\", line 288, in execute_schedule\ngetattr(exp, FLAGS.schedule)()\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/contrib/learn/python/learn/experiment.py\", line 635, in train_and_evaluate\nself.train(delay_secs=0)\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/contrib/learn/python/learn/experiment.py\", line 377, in train\nsaving_listeners=self._saving_listeners)\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/contrib/learn/python/learn/experiment.py\", line 824, in _call_train\nsaving_listeners=saving_listeners)\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 314, in train\nloss = self._train_model(input_fn, hooks, saving_listeners)\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 743, in _train_model\nfeatures, labels, model_fn_lib.ModeKeys.TRAIN, self.config)\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 725, in _call_model_fn\nmodel_fn_results = self._model_fn(features=features, **kwargs)\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/utils/t2t_model.py\", line 886, in wrapping_model_fn\nuse_tpu=use_tpu)\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/utils/t2t_model.py\", line 980, in estimator_model_fn\nloss, num_async_replicas=num_async_replicas)\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/utils/t2t_model.py\", line 984, in estimator_spec_train\ntrain_op = self.optimize(loss, num_async_replicas=num_async_replicas)\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/utils/t2t_model.py\", line 401, in optimize\nloss, lr, self.hparams, use_tpu=common_layers.is_on_tpu())\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/utils/optimize.py\", line 68, in optimize\ncolocate_gradients_with_ops=True)\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/contrib/layers/python/layers/optimizers.py\", line 241, in optimize_loss\ncolocate_gradients_with_ops=colocate_gradients_with_ops)\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/utils/optimize.py\", line 110, in compute_gradients\ngradients = self._opt.compute_gradients(loss, var_list, **kwargs)\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/training/optimizer.py\", line 456, in compute_gradients\ncolocate_gradients_with_ops=colocate_gradients_with_ops)\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gradients_impl.py\", line 608, in gradients\ngrad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gradients_impl.py\", line 374, in _MaybeCompile\nreturn grad_fn()  # Exit early\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gradients_impl.py\", line 608, in \ngrad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\nFile \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/array_grad.py\", line 724, in _ExtractImagePatchesGrad\ncols_out = int(ceil(cols_in / stride_h))\nTypeError: unsupported operand type(s) for /: 'NoneType' and 'long'", "body": "### System information\r\n- **OS Platform and Distribution**: Linux Ubuntu  16.04\r\n- **TensorFlow installed from pip**:\r\n- **TensorFlow version**: 1.5\r\n- **Python version**: 2.7 \r\n- **CUDA/cuDNN version**: 8.0\r\n- **Have I written custom code**: N/A\r\n- **Bazel version**: N/A\r\n- **GPU model and memory**: N/A\r\n- **Exact command to reproduce**: N/A\r\n\r\n### the problem\r\nI have a input \"x\" which size is (batch, width, height, chanel), because the height of data is variable. so x.get_shape() is (?, 20, ?, 64). I use the following code to do something like im2col:\r\n`im2col = tf.extract_image_patches(x, ksizes=[1, 1, KERNEL_SIZE, 1], strides=[1, 1, 1, 1], rates=[1, 1, 1, 1], padding=\"SAME\")\r\n`\r\nthe output \"im2col\" lost some shape, so I use the following code to set_shape:\r\n `im2col.set_shape([shape1, shape2, shape3, KERNEL_SIZE * shape4])`\r\nand then reshape im2col to (shape1, shape2, shape3, KERNEL_SIZE, shape4)\r\n\r\nIn the process of building graph, errors arise when processing optimization algorithms (Adam).\r\n\r\n> TypeError: unsupported operand type(s) for /: 'NoneType' and 'long'\r\n\r\nI'm sure the error is produced by tf.extract_image_patches. If I replace tf.extract_image_patches with tf.tile (to make the output size of tf.tile same as tf.extract_image_patches), graph will be built sucessfully.\r\n\r\n### Error message\r\nTraceback (most recent call last):\r\n  File \"/home/anaconda2/bin/t2t-trainer\", line 32, in <module>\r\n    tf.app.run()\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 129, in run\r\n    _sys.exit(main(argv))\r\n  File \"/home/anaconda2/bin/t2t-trainer\", line 28, in main\r\n    t2t_trainer.main(argv)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/bin/t2t_trainer.py\", line 338, in main\r\n    execute_schedule(exp)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/bin/t2t_trainer.py\", line 288, in execute_schedule\r\n    getattr(exp, FLAGS.schedule)()\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/contrib/learn/python/learn/experiment.py\", line 635, in train_and_evaluate\r\n    self.train(delay_secs=0)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/contrib/learn/python/learn/experiment.py\", line 377, in train\r\n    saving_listeners=self._saving_listeners)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/contrib/learn/python/learn/experiment.py\", line 824, in _call_train\r\n    saving_listeners=saving_listeners)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 314, in train\r\n    loss = self._train_model(input_fn, hooks, saving_listeners)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 743, in _train_model\r\n    features, labels, model_fn_lib.ModeKeys.TRAIN, self.config)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 725, in _call_model_fn\r\n    model_fn_results = self._model_fn(features=features, **kwargs)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/utils/t2t_model.py\", line 886, in wrapping_model_fn\r\n    use_tpu=use_tpu)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/utils/t2t_model.py\", line 980, in estimator_model_fn\r\n    loss, num_async_replicas=num_async_replicas)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/utils/t2t_model.py\", line 984, in estimator_spec_train\r\n    train_op = self.optimize(loss, num_async_replicas=num_async_replicas)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/utils/t2t_model.py\", line 401, in optimize\r\n    loss, lr, self.hparams, use_tpu=common_layers.is_on_tpu())\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/utils/optimize.py\", line 68, in optimize\r\n    colocate_gradients_with_ops=True)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/contrib/layers/python/layers/optimizers.py\", line 241, in optimize_loss\r\n    colocate_gradients_with_ops=colocate_gradients_with_ops)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensor2tensor/utils/optimize.py\", line 110, in compute_gradients\r\n    gradients = self._opt.compute_gradients(loss, var_list, **kwargs)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/training/optimizer.py\", line 456, in compute_gradients\r\n    colocate_gradients_with_ops=colocate_gradients_with_ops)\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gradients_impl.py\", line 608, in gradients\r\n    grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gradients_impl.py\", line 374, in _MaybeCompile\r\n    return grad_fn()  # Exit early\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gradients_impl.py\", line 608, in <lambda>\r\n    grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\r\n  File \"/home/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/array_grad.py\", line 724, in _ExtractImagePatchesGrad\r\n    cols_out = int(ceil(cols_in / stride_h))\r\nTypeError: unsupported operand type(s) for /: 'NoneType' and 'long'\r\n\r\n"}