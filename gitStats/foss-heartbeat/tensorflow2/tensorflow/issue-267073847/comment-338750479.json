{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/338750479", "html_url": "https://github.com/tensorflow/tensorflow/issues/13847#issuecomment-338750479", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13847", "id": 338750479, "node_id": "MDEyOklzc3VlQ29tbWVudDMzODc1MDQ3OQ==", "user": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "created_at": "2017-10-23T18:19:14Z", "updated_at": "2017-10-23T18:19:14Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Yes, the difficulty of getting deterministic results is one of the reasons why we are recommending that people use <code>tf.data</code> instead of the queue-based APIs. For example, here's what your program would look like in <code>tf.data</code>:</p>\n<div class=\"highlight highlight-source-python\"><pre>a_dataset <span class=\"pl-k\">=</span> tf.data.Dataset.range(<span class=\"pl-c1\">30</span>).repeat()\nb_dataset <span class=\"pl-k\">=</span> tf.data.Dataset.range(<span class=\"pl-c1\">30</span>).repeat()\nbatched_dataset <span class=\"pl-k\">=</span> tf.data.Dataset.zip((a_dataset, b_dataset)).batch(<span class=\"pl-c1\">5</span>)\niterator <span class=\"pl-k\">=</span> batched_dataset.make_one_shot_iterator()\nat, bt <span class=\"pl-k\">=</span> iterator.get_next()\n\n<span class=\"pl-k\">with</span> tf.Session() <span class=\"pl-k\">as</span> sess:\n    <span class=\"pl-k\">try</span>:\n        <span class=\"pl-k\">for</span> i <span class=\"pl-k\">in</span> <span class=\"pl-c1\">range</span>(<span class=\"pl-c1\">150</span>):\n            av, bv <span class=\"pl-k\">=</span> sess.run([at, bt])\n            <span class=\"pl-k\">assert</span> <span class=\"pl-c1\">list</span>(av) <span class=\"pl-k\">==</span> <span class=\"pl-c1\">list</span>(bv), <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>queues derailed!<span class=\"pl-pds\">\"</span></span>\n    <span class=\"pl-k\">except</span> <span class=\"pl-c1\">Exception</span> <span class=\"pl-k\">as</span> e:\n        <span class=\"pl-c1\">print</span>((<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Exception in training: <span class=\"pl-c1\">{}</span><span class=\"pl-pds\">\"</span></span>).format(e))\n        <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>__<span class=\"pl-pds\">\"</span></span>,i,<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>__<span class=\"pl-pds\">\"</span></span>)\n        <span class=\"pl-c1\">print</span>(av)\n        <span class=\"pl-c1\">print</span>(bv)</pre></div>", "body_text": "Yes, the difficulty of getting deterministic results is one of the reasons why we are recommending that people use tf.data instead of the queue-based APIs. For example, here's what your program would look like in tf.data:\na_dataset = tf.data.Dataset.range(30).repeat()\nb_dataset = tf.data.Dataset.range(30).repeat()\nbatched_dataset = tf.data.Dataset.zip((a_dataset, b_dataset)).batch(5)\niterator = batched_dataset.make_one_shot_iterator()\nat, bt = iterator.get_next()\n\nwith tf.Session() as sess:\n    try:\n        for i in range(150):\n            av, bv = sess.run([at, bt])\n            assert list(av) == list(bv), \"queues derailed!\"\n    except Exception as e:\n        print((\"Exception in training: {}\").format(e))\n        print(\"__\",i,\"__\")\n        print(av)\n        print(bv)", "body": "Yes, the difficulty of getting deterministic results is one of the reasons why we are recommending that people use `tf.data` instead of the queue-based APIs. For example, here's what your program would look like in `tf.data`:\r\n\r\n```python\r\na_dataset = tf.data.Dataset.range(30).repeat()\r\nb_dataset = tf.data.Dataset.range(30).repeat()\r\nbatched_dataset = tf.data.Dataset.zip((a_dataset, b_dataset)).batch(5)\r\niterator = batched_dataset.make_one_shot_iterator()\r\nat, bt = iterator.get_next()\r\n\r\nwith tf.Session() as sess:\r\n    try:\r\n        for i in range(150):\r\n            av, bv = sess.run([at, bt])\r\n            assert list(av) == list(bv), \"queues derailed!\"\r\n    except Exception as e:\r\n        print((\"Exception in training: {}\").format(e))\r\n        print(\"__\",i,\"__\")\r\n        print(av)\r\n        print(bv)\r\n```"}