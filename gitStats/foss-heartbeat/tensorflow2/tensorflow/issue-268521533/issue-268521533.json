{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13980", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13980/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13980/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13980/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/13980", "id": 268521533, "node_id": "MDU6SXNzdWUyNjg1MjE1MzM=", "number": 13980, "title": "NadamOptimizer throws InvalidArgumentError (incompatible shapes)", "user": {"login": "strubell", "id": 3266999, "node_id": "MDQ6VXNlcjMyNjY5OTk=", "avatar_url": "https://avatars0.githubusercontent.com/u/3266999?v=4", "gravatar_id": "", "url": "https://api.github.com/users/strubell", "html_url": "https://github.com/strubell", "followers_url": "https://api.github.com/users/strubell/followers", "following_url": "https://api.github.com/users/strubell/following{/other_user}", "gists_url": "https://api.github.com/users/strubell/gists{/gist_id}", "starred_url": "https://api.github.com/users/strubell/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/strubell/subscriptions", "organizations_url": "https://api.github.com/users/strubell/orgs", "repos_url": "https://api.github.com/users/strubell/repos", "events_url": "https://api.github.com/users/strubell/events{/privacy}", "received_events_url": "https://api.github.com/users/strubell/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1097547147, "node_id": "MDU6TGFiZWwxMDk3NTQ3MTQ3", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:ops", "name": "comp:ops", "color": "0052cc", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "wt-huang", "id": 42785337, "node_id": "MDQ6VXNlcjQyNzg1MzM3", "avatar_url": "https://avatars0.githubusercontent.com/u/42785337?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wt-huang", "html_url": "https://github.com/wt-huang", "followers_url": "https://api.github.com/users/wt-huang/followers", "following_url": "https://api.github.com/users/wt-huang/following{/other_user}", "gists_url": "https://api.github.com/users/wt-huang/gists{/gist_id}", "starred_url": "https://api.github.com/users/wt-huang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wt-huang/subscriptions", "organizations_url": "https://api.github.com/users/wt-huang/orgs", "repos_url": "https://api.github.com/users/wt-huang/repos", "events_url": "https://api.github.com/users/wt-huang/events{/privacy}", "received_events_url": "https://api.github.com/users/wt-huang/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "wt-huang", "id": 42785337, "node_id": "MDQ6VXNlcjQyNzg1MzM3", "avatar_url": "https://avatars0.githubusercontent.com/u/42785337?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wt-huang", "html_url": "https://github.com/wt-huang", "followers_url": "https://api.github.com/users/wt-huang/followers", "following_url": "https://api.github.com/users/wt-huang/following{/other_user}", "gists_url": "https://api.github.com/users/wt-huang/gists{/gist_id}", "starred_url": "https://api.github.com/users/wt-huang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wt-huang/subscriptions", "organizations_url": "https://api.github.com/users/wt-huang/orgs", "repos_url": "https://api.github.com/users/wt-huang/repos", "events_url": "https://api.github.com/users/wt-huang/events{/privacy}", "received_events_url": "https://api.github.com/users/wt-huang/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2017-10-25T19:33:57Z", "updated_at": "2018-10-20T03:51:26Z", "closed_at": "2018-10-20T03:51:26Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: Yes, but this issue can be replicated by changing one line in the example script <code>word2vec_basic.py</code></li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Linux CentOS 7, MacOS High Sierra</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: ('v1.4.0-rc0-21-g1e25994', '1.4.0-rc1'). I also know someone who encountered this in the 1.3 release.</li>\n<li><strong>Python version</strong>: 2.7.10, 2.7.14</li>\n<li><strong>Bazel version (if compiling from source)</strong>: n/a</li>\n<li><strong>CUDA/cuDNN version</strong>: 8.0 / 6.0</li>\n<li><strong>GPU model and memory</strong>: Titan X 12gb</li>\n<li><strong>Exact command to reproduce</strong>:<br>\nChange line 190 in <code>tensorflow/examples/tutorials/word2vec/word2vec_basic.py</code> to:<br>\n<code>optimizer = tf.contrib.opt.NadamOptimizer(1.0).minimize(loss)</code>.<br>\nRun.</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>When I attempt to train a model with <code>tf.controb.opt.NadamOptimizer</code>, TensorFlow crashes with an InvalidArgumentError (Incompatible shapes: [105] vs. [50000]), which is thrown from the optimizer (in my code it's when trying to apply updates to the word embedding table.) It looks like it's trying to apply sparse updates to the embeddings using dense operations, causing a shape mismatch, or something along those lines. <code>AdamOptimizer</code> and <code>LazyAdamOptimizer</code> work fine.</p>\n<h3>Source code / logs</h3>\n<p>Traceback can be found <a href=\"https://gist.github.com/strubell/37897084888252989750b58260f76ff5\">here</a>.<br>\nThe error is easily replicable in the example script <code>word2vec_basic.py</code>.</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes, but this issue can be replicated by changing one line in the example script word2vec_basic.py\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux CentOS 7, MacOS High Sierra\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below): ('v1.4.0-rc0-21-g1e25994', '1.4.0-rc1'). I also know someone who encountered this in the 1.3 release.\nPython version: 2.7.10, 2.7.14\nBazel version (if compiling from source): n/a\nCUDA/cuDNN version: 8.0 / 6.0\nGPU model and memory: Titan X 12gb\nExact command to reproduce:\nChange line 190 in tensorflow/examples/tutorials/word2vec/word2vec_basic.py to:\noptimizer = tf.contrib.opt.NadamOptimizer(1.0).minimize(loss).\nRun.\n\nDescribe the problem\nWhen I attempt to train a model with tf.controb.opt.NadamOptimizer, TensorFlow crashes with an InvalidArgumentError (Incompatible shapes: [105] vs. [50000]), which is thrown from the optimizer (in my code it's when trying to apply updates to the word embedding table.) It looks like it's trying to apply sparse updates to the embeddings using dense operations, causing a shape mismatch, or something along those lines. AdamOptimizer and LazyAdamOptimizer work fine.\nSource code / logs\nTraceback can be found here.\nThe error is easily replicable in the example script word2vec_basic.py.", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: Yes, but this issue can be replicated by changing one line in the example script `word2vec_basic.py`\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux CentOS 7, MacOS High Sierra \r\n- **TensorFlow installed from (source or binary)**: binary\r\n- **TensorFlow version (use command below)**: ('v1.4.0-rc0-21-g1e25994', '1.4.0-rc1'). I also know someone who encountered this in the 1.3 release.\r\n- **Python version**: 2.7.10, 2.7.14\r\n- **Bazel version (if compiling from source)**: n/a\r\n- **CUDA/cuDNN version**: 8.0 / 6.0\r\n- **GPU model and memory**: Titan X 12gb\r\n- **Exact command to reproduce**:\r\nChange line 190 in `tensorflow/examples/tutorials/word2vec/word2vec_basic.py` to:\r\n`optimizer = tf.contrib.opt.NadamOptimizer(1.0).minimize(loss)`. \r\nRun.\r\n\r\n### Describe the problem\r\nWhen I attempt to train a model with `tf.controb.opt.NadamOptimizer`, TensorFlow crashes with an InvalidArgumentError (Incompatible shapes: [105] vs. [50000]), which is thrown from the optimizer (in my code it's when trying to apply updates to the word embedding table.) It looks like it's trying to apply sparse updates to the embeddings using dense operations, causing a shape mismatch, or something along those lines. `AdamOptimizer` and `LazyAdamOptimizer` work fine.\r\n\r\n### Source code / logs\r\nTraceback can be found [here](https://gist.github.com/strubell/37897084888252989750b58260f76ff5).\r\nThe error is easily replicable in the example script `word2vec_basic.py`.\r\n"}