{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15635", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15635/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15635/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15635/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15635", "id": 284509471, "node_id": "MDU6SXNzdWUyODQ1MDk0NzE=", "number": 15635, "title": "Android: Op type not registered 'GatherTree' in binary running on localhost.", "user": {"login": "warriorZH", "id": 11243544, "node_id": "MDQ6VXNlcjExMjQzNTQ0", "avatar_url": "https://avatars0.githubusercontent.com/u/11243544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/warriorZH", "html_url": "https://github.com/warriorZH", "followers_url": "https://api.github.com/users/warriorZH/followers", "following_url": "https://api.github.com/users/warriorZH/following{/other_user}", "gists_url": "https://api.github.com/users/warriorZH/gists{/gist_id}", "starred_url": "https://api.github.com/users/warriorZH/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/warriorZH/subscriptions", "organizations_url": "https://api.github.com/users/warriorZH/orgs", "repos_url": "https://api.github.com/users/warriorZH/repos", "events_url": "https://api.github.com/users/warriorZH/events{/privacy}", "received_events_url": "https://api.github.com/users/warriorZH/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "andrewharp", "id": 3376817, "node_id": "MDQ6VXNlcjMzNzY4MTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/3376817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewharp", "html_url": "https://github.com/andrewharp", "followers_url": "https://api.github.com/users/andrewharp/followers", "following_url": "https://api.github.com/users/andrewharp/following{/other_user}", "gists_url": "https://api.github.com/users/andrewharp/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewharp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewharp/subscriptions", "organizations_url": "https://api.github.com/users/andrewharp/orgs", "repos_url": "https://api.github.com/users/andrewharp/repos", "events_url": "https://api.github.com/users/andrewharp/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewharp/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "andrewharp", "id": 3376817, "node_id": "MDQ6VXNlcjMzNzY4MTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/3376817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewharp", "html_url": "https://github.com/andrewharp", "followers_url": "https://api.github.com/users/andrewharp/followers", "following_url": "https://api.github.com/users/andrewharp/following{/other_user}", "gists_url": "https://api.github.com/users/andrewharp/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewharp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewharp/subscriptions", "organizations_url": "https://api.github.com/users/andrewharp/orgs", "repos_url": "https://api.github.com/users/andrewharp/repos", "events_url": "https://api.github.com/users/andrewharp/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewharp/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2017-12-26T07:34:31Z", "updated_at": "2018-09-28T21:30:19Z", "closed_at": "2018-09-28T21:30:19Z", "author_association": "NONE", "body_html": "<hr>\n<h1>System information</h1>\n<ul>\n<li>**OS Platform and Distribution : Linux Ubuntu 14.04</li>\n<li>**TensorFlow installed from source</li>\n<li>**TensorFlow version 1.4.0</li>\n<li>**Python 2.7</li>\n<li>**Bazel version [bazel release 0.8.0]</li>\n<li>**GCC/Compiler version gcc version 4.9.4 (GCC)</li>\n<li>**CUDA/cuDNN (only for cpu)</li>\n</ul>\n<h1>Describe the problem</h1>\n<p>Hi.  I have tried to load the rnn model inside Android that I generated from python for machine translation. When I want to use beam_search in decode I meet an (can't find ** op) error at Android. I have tried below solutions but the error is continue.</p>\n<h2>solution 1:</h2>\n<p>use python script \u201ctensorflow/python/tools/print_selective_registration_header.py\u201d to create \"ops_to_register.h\", then copy it into \"tensorflow/core/framework/\", then generate \"//tensorflow/contrib/android:libtensorflow_inference.so\"</p>\n<h3>I change \"print_selective_registration_header.py\":</h3>\n<p><code>parser.add_argument( '--default_ops', type=str, #default='NoOp:NoOp,_Recv:RecvOp,_Send:SendOp', default='all',</code><br>\n...)</p>\n<h3>cmd like below:</h3>\n<p><code>bazel build tensorflow/python/tools:print_selective_registration_header &amp;&amp;   bazel-bin/tensorflow/python/tools/print_selective_registration_header     --graphs=/path/to/my/model/decode-model_1213_real_model_with_beam.pb &gt; ops_to_register.h</code><br>\n<code>bazel build -c opt --copt=\"-DSELECTIVE_REGISTRATION\"     --copt=\"-DSUPPORT_SELECTIVE_REGISTRATION\"   //tensorflow/contrib/android:libtensorflow_inference.so     --host_crosstool_top=@bazel_tools//tools/cpp:toolchain  --crosstool_top=//external:android/crosstool --cpu=armeabi-v7a</code></p>\n<h2>solution 2:</h2>\n<p>I met the same type of mistake before, and with \"Op type not registered ListDiff\" error. I find \"listdiff_op.cc\" is at \"tensorflow/core/kernels\". Then I add a line at \"tensorflow/core/kernels/BUILD\", and re-generate libtensorflow_inference.so to solve that error. But the \"beam_search_ops.cc\" is at \"tensorflow/contrib/seq2seq/kernels\", when I add it like \"ListDiff\" it's still reporting that error at android studio.</p>\n<h3>add line like below:</h3>\n<p><code>filegroup( name = \"android_extended_ops_group1\", srcs = [ \"listdiff_op.cc\", #\"//tensorflow/contrib/seq2seq/kernels/beam_search_ops.cc\", ...] )</code></p>\n<p>I need some help for solving this problem. thanks.</p>\n<h1>Source code / logs</h1>\n<h2>error log at android studio:</h2>\n<p><code>E/AndroidRuntime: FATAL EXCEPTION: main Process: com.example.phua.mt_1201, PID: 20817 java.lang.RuntimeException: Unable to start activity ComponentInfo{com.example.phua.mt_1201/com.example.phua.mt_1201.MainActivity}: org.tensorflow.TensorFlowException: Op type not registered 'GatherTree' in binary running on localhost. Make sure the Op and Kernel are registered in the binary running in this process. at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2955) at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3030) at android.app.ActivityThread.-wrap11(Unknown Source:0) at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1696) at android.os.Handler.dispatchMessage(Handler.java:105) at android.os.Looper.loop(Looper.java:164) at android.app.ActivityThread.main(ActivityThread.java:6938) at java.lang.reflect.Method.invoke(Native Method) at com.android.internal.os.Zygote$MethodAndArgsCaller.run(Zygote.java:327) at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1374) Caused by: org.tensorflow.TensorFlowException: Op type not registered 'GatherTree' in binary running on localhost. Make sure the Op and Kernel are registered in the binary running in this process. at org.tensorflow.Graph.importGraphDef(Native Method) at org.tensorflow.Graph.importGraphDef(Graph.java:118) at org.tensorflow.Graph.importGraphDef(Graph.java:102) at org.tensorflow.contrib.android.TensorFlowInferenceInterface.loadGraph(TensorFlowInferenceInterface.java:396) at org.tensorflow.contrib.android.TensorFlowInferenceInterface.&lt;init&gt;(TensorFlowInferenceInterface.java:97) at com.example.phua.mt_1201.tfonandroid.Loadmodel(tfonandroid.java:37) at com.example.phua.mt_1201.MainActivity.onCreate(MainActivity.java:52) at android.app.Activity.performCreate(Activity.java:7174) at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1220) at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2908) at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3030)\u00a0 at android.app.ActivityThread.-wrap11(Unknown Source:0)\u00a0 at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1696)\u00a0 at android.os.Handler.dispatchMessage(Handler.java:105)\u00a0 at android.os.Looper.loop(Looper.java:164)\u00a0 at android.app.ActivityThread.main(ActivityThread.java:6938)\u00a0</code></p>", "body_text": "System information\n\n**OS Platform and Distribution : Linux Ubuntu 14.04\n**TensorFlow installed from source\n**TensorFlow version 1.4.0\n**Python 2.7\n**Bazel version [bazel release 0.8.0]\n**GCC/Compiler version gcc version 4.9.4 (GCC)\n**CUDA/cuDNN (only for cpu)\n\nDescribe the problem\nHi.  I have tried to load the rnn model inside Android that I generated from python for machine translation. When I want to use beam_search in decode I meet an (can't find ** op) error at Android. I have tried below solutions but the error is continue.\nsolution 1:\nuse python script \u201ctensorflow/python/tools/print_selective_registration_header.py\u201d to create \"ops_to_register.h\", then copy it into \"tensorflow/core/framework/\", then generate \"//tensorflow/contrib/android:libtensorflow_inference.so\"\nI change \"print_selective_registration_header.py\":\nparser.add_argument( '--default_ops', type=str, #default='NoOp:NoOp,_Recv:RecvOp,_Send:SendOp', default='all',\n...)\ncmd like below:\nbazel build tensorflow/python/tools:print_selective_registration_header &&   bazel-bin/tensorflow/python/tools/print_selective_registration_header     --graphs=/path/to/my/model/decode-model_1213_real_model_with_beam.pb > ops_to_register.h\nbazel build -c opt --copt=\"-DSELECTIVE_REGISTRATION\"     --copt=\"-DSUPPORT_SELECTIVE_REGISTRATION\"   //tensorflow/contrib/android:libtensorflow_inference.so     --host_crosstool_top=@bazel_tools//tools/cpp:toolchain  --crosstool_top=//external:android/crosstool --cpu=armeabi-v7a\nsolution 2:\nI met the same type of mistake before, and with \"Op type not registered ListDiff\" error. I find \"listdiff_op.cc\" is at \"tensorflow/core/kernels\". Then I add a line at \"tensorflow/core/kernels/BUILD\", and re-generate libtensorflow_inference.so to solve that error. But the \"beam_search_ops.cc\" is at \"tensorflow/contrib/seq2seq/kernels\", when I add it like \"ListDiff\" it's still reporting that error at android studio.\nadd line like below:\nfilegroup( name = \"android_extended_ops_group1\", srcs = [ \"listdiff_op.cc\", #\"//tensorflow/contrib/seq2seq/kernels/beam_search_ops.cc\", ...] )\nI need some help for solving this problem. thanks.\nSource code / logs\nerror log at android studio:\nE/AndroidRuntime: FATAL EXCEPTION: main Process: com.example.phua.mt_1201, PID: 20817 java.lang.RuntimeException: Unable to start activity ComponentInfo{com.example.phua.mt_1201/com.example.phua.mt_1201.MainActivity}: org.tensorflow.TensorFlowException: Op type not registered 'GatherTree' in binary running on localhost. Make sure the Op and Kernel are registered in the binary running in this process. at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2955) at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3030) at android.app.ActivityThread.-wrap11(Unknown Source:0) at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1696) at android.os.Handler.dispatchMessage(Handler.java:105) at android.os.Looper.loop(Looper.java:164) at android.app.ActivityThread.main(ActivityThread.java:6938) at java.lang.reflect.Method.invoke(Native Method) at com.android.internal.os.Zygote$MethodAndArgsCaller.run(Zygote.java:327) at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1374) Caused by: org.tensorflow.TensorFlowException: Op type not registered 'GatherTree' in binary running on localhost. Make sure the Op and Kernel are registered in the binary running in this process. at org.tensorflow.Graph.importGraphDef(Native Method) at org.tensorflow.Graph.importGraphDef(Graph.java:118) at org.tensorflow.Graph.importGraphDef(Graph.java:102) at org.tensorflow.contrib.android.TensorFlowInferenceInterface.loadGraph(TensorFlowInferenceInterface.java:396) at org.tensorflow.contrib.android.TensorFlowInferenceInterface.<init>(TensorFlowInferenceInterface.java:97) at com.example.phua.mt_1201.tfonandroid.Loadmodel(tfonandroid.java:37) at com.example.phua.mt_1201.MainActivity.onCreate(MainActivity.java:52) at android.app.Activity.performCreate(Activity.java:7174) at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1220) at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2908) at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3030)\u00a0 at android.app.ActivityThread.-wrap11(Unknown Source:0)\u00a0 at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1696)\u00a0 at android.os.Handler.dispatchMessage(Handler.java:105)\u00a0 at android.os.Looper.loop(Looper.java:164)\u00a0 at android.app.ActivityThread.main(ActivityThread.java:6938)\u00a0", "body": "-----------------------\r\n\r\n# System information\r\n- **OS Platform and Distribution : Linux Ubuntu 14.04\r\n- **TensorFlow installed from source \r\n- **TensorFlow version 1.4.0\r\n- **Python 2.7\r\n- **Bazel version [bazel release 0.8.0]\r\n- **GCC/Compiler version gcc version 4.9.4 (GCC)\r\n- **CUDA/cuDNN (only for cpu)\r\n\r\n\r\n# Describe the problem\r\nHi.  I have tried to load the rnn model inside Android that I generated from python for machine translation. When I want to use beam_search in decode I meet an (can't find ** op) error at Android. I have tried below solutions but the error is continue.\r\n## solution 1:\r\nuse python script \u201ctensorflow/python/tools/print_selective_registration_header.py\u201d to create \"ops_to_register.h\", then copy it into \"tensorflow/core/framework/\", then generate \"//tensorflow/contrib/android:libtensorflow_inference.so\"\r\n### I change \"print_selective_registration_header.py\":\r\n`parser.add_argument(\r\n'--default_ops',\r\ntype=str,\r\n#default='NoOp:NoOp,_Recv:RecvOp,_Send:SendOp',\r\n default='all',`\r\n...)\r\n### cmd like below:\r\n`bazel build tensorflow/python/tools:print_selective_registration_header &&   bazel-bin/tensorflow/python/tools/print_selective_registration_header     --graphs=/path/to/my/model/decode-model_1213_real_model_with_beam.pb > ops_to_register.h`\r\n`bazel build -c opt --copt=\"-DSELECTIVE_REGISTRATION\"     --copt=\"-DSUPPORT_SELECTIVE_REGISTRATION\"   //tensorflow/contrib/android:libtensorflow_inference.so     --host_crosstool_top=@bazel_tools//tools/cpp:toolchain  --crosstool_top=//external:android/crosstool --cpu=armeabi-v7a`\r\n\r\n## solution 2:\r\nI met the same type of mistake before, and with \"Op type not registered ListDiff\" error. I find \"listdiff_op.cc\" is at \"tensorflow/core/kernels\". Then I add a line at \"tensorflow/core/kernels/BUILD\", and re-generate libtensorflow_inference.so to solve that error. But the \"beam_search_ops.cc\" is at \"tensorflow/contrib/seq2seq/kernels\", when I add it like \"ListDiff\" it's still reporting that error at android studio.\r\n### add line like below:\r\n` filegroup(\r\nname = \"android_extended_ops_group1\",\r\nsrcs = [\r\n\"listdiff_op.cc\",\r\n#\"//tensorflow/contrib/seq2seq/kernels/beam_search_ops.cc\",\r\n...]\r\n)\r\n`\r\n\r\nI need some help for solving this problem. thanks.\r\n\r\n# Source code / logs\r\n## error log at android studio:\r\n`E/AndroidRuntime: FATAL EXCEPTION: main\r\n                  Process: com.example.phua.mt_1201, PID: 20817\r\n                  java.lang.RuntimeException: Unable to start activity ComponentInfo{com.example.phua.mt_1201/com.example.phua.mt_1201.MainActivity}: org.tensorflow.TensorFlowException: Op type not registered 'GatherTree' in binary running on localhost. Make sure the Op and Kernel are registered in the binary running in this process.\r\n                      at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2955)\r\n                      at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3030)\r\n                      at android.app.ActivityThread.-wrap11(Unknown Source:0)\r\n                      at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1696)\r\n                      at android.os.Handler.dispatchMessage(Handler.java:105)\r\n                      at android.os.Looper.loop(Looper.java:164)\r\n                      at android.app.ActivityThread.main(ActivityThread.java:6938)\r\n                      at java.lang.reflect.Method.invoke(Native Method)\r\n                      at com.android.internal.os.Zygote$MethodAndArgsCaller.run(Zygote.java:327)\r\n                      at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1374)\r\n                   Caused by: org.tensorflow.TensorFlowException: Op type not registered 'GatherTree' in binary running on localhost. Make sure the Op and Kernel are registered in the binary running in this process.\r\n                      at org.tensorflow.Graph.importGraphDef(Native Method)\r\n                      at org.tensorflow.Graph.importGraphDef(Graph.java:118)\r\n                      at org.tensorflow.Graph.importGraphDef(Graph.java:102)\r\n                      at org.tensorflow.contrib.android.TensorFlowInferenceInterface.loadGraph(TensorFlowInferenceInterface.java:396)\r\n                      at org.tensorflow.contrib.android.TensorFlowInferenceInterface.<init>(TensorFlowInferenceInterface.java:97)\r\n                      at com.example.phua.mt_1201.tfonandroid.Loadmodel(tfonandroid.java:37)\r\n                      at com.example.phua.mt_1201.MainActivity.onCreate(MainActivity.java:52)\r\n                      at android.app.Activity.performCreate(Activity.java:7174)\r\n                      at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1220)\r\n                      at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2908)\r\n                      at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3030)\u00a0\r\n                      at android.app.ActivityThread.-wrap11(Unknown Source:0)\u00a0\r\n                      at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1696)\u00a0\r\n                      at android.os.Handler.dispatchMessage(Handler.java:105)\u00a0\r\n                      at android.os.Looper.loop(Looper.java:164)\u00a0\r\n                      at android.app.ActivityThread.main(ActivityThread.java:6938)\u00a0`\r\n\r\n\r\n"}