{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23423", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23423/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23423/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23423/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/23423", "id": 376295881, "node_id": "MDExOlB1bGxSZXF1ZXN0MjI3NTQ0Mjcy", "number": 23423, "title": "Should use '_train_distribution' because Estimator doesn't have attribute '_distribution'", "user": {"login": "RobinDong", "id": 1953397, "node_id": "MDQ6VXNlcjE5NTMzOTc=", "avatar_url": "https://avatars0.githubusercontent.com/u/1953397?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RobinDong", "html_url": "https://github.com/RobinDong", "followers_url": "https://api.github.com/users/RobinDong/followers", "following_url": "https://api.github.com/users/RobinDong/following{/other_user}", "gists_url": "https://api.github.com/users/RobinDong/gists{/gist_id}", "starred_url": "https://api.github.com/users/RobinDong/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RobinDong/subscriptions", "organizations_url": "https://api.github.com/users/RobinDong/orgs", "repos_url": "https://api.github.com/users/RobinDong/repos", "events_url": "https://api.github.com/users/RobinDong/events{/privacy}", "received_events_url": "https://api.github.com/users/RobinDong/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 390482148, "node_id": "MDU6TGFiZWwzOTA0ODIxNDg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/awaiting%20review", "name": "awaiting review", "color": "fef2c0", "default": false}, {"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}], "state": "open", "locked": false, "assignee": {"login": "akshaym", "id": 122911, "node_id": "MDQ6VXNlcjEyMjkxMQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/122911?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akshaym", "html_url": "https://github.com/akshaym", "followers_url": "https://api.github.com/users/akshaym/followers", "following_url": "https://api.github.com/users/akshaym/following{/other_user}", "gists_url": "https://api.github.com/users/akshaym/gists{/gist_id}", "starred_url": "https://api.github.com/users/akshaym/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akshaym/subscriptions", "organizations_url": "https://api.github.com/users/akshaym/orgs", "repos_url": "https://api.github.com/users/akshaym/repos", "events_url": "https://api.github.com/users/akshaym/events{/privacy}", "received_events_url": "https://api.github.com/users/akshaym/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "akshaym", "id": 122911, "node_id": "MDQ6VXNlcjEyMjkxMQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/122911?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akshaym", "html_url": "https://github.com/akshaym", "followers_url": "https://api.github.com/users/akshaym/followers", "following_url": "https://api.github.com/users/akshaym/following{/other_user}", "gists_url": "https://api.github.com/users/akshaym/gists{/gist_id}", "starred_url": "https://api.github.com/users/akshaym/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akshaym/subscriptions", "organizations_url": "https://api.github.com/users/akshaym/orgs", "repos_url": "https://api.github.com/users/akshaym/repos", "events_url": "https://api.github.com/users/akshaym/events{/privacy}", "received_events_url": "https://api.github.com/users/akshaym/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2018-11-01T08:17:23Z", "updated_at": "2018-11-19T23:29:43Z", "closed_at": null, "author_association": "NONE", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/23423", "html_url": "https://github.com/tensorflow/tensorflow/pull/23423", "diff_url": "https://github.com/tensorflow/tensorflow/pull/23423.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/23423.patch"}, "body_html": "<p>When I use tf.contrib.distribute.MirroredStrategy and training_hooks for one Estimator, like:</p>\n<pre><code>distribution = tf.contrib.distribute.MirroredStrategy(\n      [\"/device:GPU:0\", \"/device:GPU:1\"])\nconfig = tf.estimator.RunConfig(train_distribute=distribution,\n                                  eval_distribute=distribution)\nestimator = tf.estimator.Estimator(\n      model_fn=build_model_fn_optimizer(), config=config)\nestimator.train(input_fn=input_fn, steps=10)\n</code></pre>\n<p>and</p>\n<pre><code>    logging_hook = tf.train.LoggingTensorHook({'logits' : logits})\n    return tf.estimator.EstimatorSpec(mode, loss=loss_fn(), train_op=train_op, training_hooks = [logging_hook])\n</code></pre>\n<p>It will report error:</p>\n<pre><code>  File \"/usr/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 356, in train\n    loss = self._train_model(input_fn, hooks, saving_listeners)\n  File \"/usr/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1179, in _train_model\n    return self._train_model_distributed(input_fn, hooks, saving_listeners)\n  File \"/usr/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1309, in _train_model_distributed\n    grouped_estimator_spec.training_hooks)\n  File \"/usr/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1305, in get_hooks_from_the_first_device\n    for per_device_hook in per_device_hooks\n  File \"/usr/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1305, in &lt;listcomp&gt;\n    for per_device_hook in per_device_hooks\nAttributeError: 'Estimator' object has no attribute '_distribution'\n</code></pre>\n<p>The solution is using '_train_distribution' instead of '_distribution'</p>", "body_text": "When I use tf.contrib.distribute.MirroredStrategy and training_hooks for one Estimator, like:\ndistribution = tf.contrib.distribute.MirroredStrategy(\n      [\"/device:GPU:0\", \"/device:GPU:1\"])\nconfig = tf.estimator.RunConfig(train_distribute=distribution,\n                                  eval_distribute=distribution)\nestimator = tf.estimator.Estimator(\n      model_fn=build_model_fn_optimizer(), config=config)\nestimator.train(input_fn=input_fn, steps=10)\n\nand\n    logging_hook = tf.train.LoggingTensorHook({'logits' : logits})\n    return tf.estimator.EstimatorSpec(mode, loss=loss_fn(), train_op=train_op, training_hooks = [logging_hook])\n\nIt will report error:\n  File \"/usr/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 356, in train\n    loss = self._train_model(input_fn, hooks, saving_listeners)\n  File \"/usr/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1179, in _train_model\n    return self._train_model_distributed(input_fn, hooks, saving_listeners)\n  File \"/usr/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1309, in _train_model_distributed\n    grouped_estimator_spec.training_hooks)\n  File \"/usr/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1305, in get_hooks_from_the_first_device\n    for per_device_hook in per_device_hooks\n  File \"/usr/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1305, in <listcomp>\n    for per_device_hook in per_device_hooks\nAttributeError: 'Estimator' object has no attribute '_distribution'\n\nThe solution is using '_train_distribution' instead of '_distribution'", "body": "When I use tf.contrib.distribute.MirroredStrategy and training_hooks for one Estimator, like:\r\n\r\n```\r\ndistribution = tf.contrib.distribute.MirroredStrategy(\r\n      [\"/device:GPU:0\", \"/device:GPU:1\"])\r\nconfig = tf.estimator.RunConfig(train_distribute=distribution,\r\n                                  eval_distribute=distribution)\r\nestimator = tf.estimator.Estimator(\r\n      model_fn=build_model_fn_optimizer(), config=config)\r\nestimator.train(input_fn=input_fn, steps=10)\r\n```\r\n\r\nand\r\n\r\n```\r\n    logging_hook = tf.train.LoggingTensorHook({'logits' : logits})\r\n    return tf.estimator.EstimatorSpec(mode, loss=loss_fn(), train_op=train_op, training_hooks = [logging_hook])\r\n```\r\n\r\nIt will report error:\r\n```\r\n  File \"/usr/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 356, in train\r\n    loss = self._train_model(input_fn, hooks, saving_listeners)\r\n  File \"/usr/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1179, in _train_model\r\n    return self._train_model_distributed(input_fn, hooks, saving_listeners)\r\n  File \"/usr/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1309, in _train_model_distributed\r\n    grouped_estimator_spec.training_hooks)\r\n  File \"/usr/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1305, in get_hooks_from_the_first_device\r\n    for per_device_hook in per_device_hooks\r\n  File \"/usr/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 1305, in <listcomp>\r\n    for per_device_hook in per_device_hooks\r\nAttributeError: 'Estimator' object has no attribute '_distribution'\r\n```\r\n\r\nThe solution is using '_train_distribution' instead of '_distribution'\r\n "}