{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23431", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23431/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23431/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23431/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23431", "id": 376488312, "node_id": "MDU6SXNzdWUzNzY0ODgzMTI=", "number": 23431, "title": "tf keras model.save_weights not working with MirroredStrategy in 1.12", "user": {"login": "BenPoutine", "id": 44676431, "node_id": "MDQ6VXNlcjQ0Njc2NDMx", "avatar_url": "https://avatars1.githubusercontent.com/u/44676431?v=4", "gravatar_id": "", "url": "https://api.github.com/users/BenPoutine", "html_url": "https://github.com/BenPoutine", "followers_url": "https://api.github.com/users/BenPoutine/followers", "following_url": "https://api.github.com/users/BenPoutine/following{/other_user}", "gists_url": "https://api.github.com/users/BenPoutine/gists{/gist_id}", "starred_url": "https://api.github.com/users/BenPoutine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/BenPoutine/subscriptions", "organizations_url": "https://api.github.com/users/BenPoutine/orgs", "repos_url": "https://api.github.com/users/BenPoutine/repos", "events_url": "https://api.github.com/users/BenPoutine/events{/privacy}", "received_events_url": "https://api.github.com/users/BenPoutine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 996845227, "node_id": "MDU6TGFiZWw5OTY4NDUyMjc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:dist-strat", "name": "comp:dist-strat", "color": "0052cc", "default": false}], "state": "open", "locked": false, "assignee": {"login": "anj-s", "id": 32556631, "node_id": "MDQ6VXNlcjMyNTU2NjMx", "avatar_url": "https://avatars1.githubusercontent.com/u/32556631?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anj-s", "html_url": "https://github.com/anj-s", "followers_url": "https://api.github.com/users/anj-s/followers", "following_url": "https://api.github.com/users/anj-s/following{/other_user}", "gists_url": "https://api.github.com/users/anj-s/gists{/gist_id}", "starred_url": "https://api.github.com/users/anj-s/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anj-s/subscriptions", "organizations_url": "https://api.github.com/users/anj-s/orgs", "repos_url": "https://api.github.com/users/anj-s/repos", "events_url": "https://api.github.com/users/anj-s/events{/privacy}", "received_events_url": "https://api.github.com/users/anj-s/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "anj-s", "id": 32556631, "node_id": "MDQ6VXNlcjMyNTU2NjMx", "avatar_url": "https://avatars1.githubusercontent.com/u/32556631?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anj-s", "html_url": "https://github.com/anj-s", "followers_url": "https://api.github.com/users/anj-s/followers", "following_url": "https://api.github.com/users/anj-s/following{/other_user}", "gists_url": "https://api.github.com/users/anj-s/gists{/gist_id}", "starred_url": "https://api.github.com/users/anj-s/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anj-s/subscriptions", "organizations_url": "https://api.github.com/users/anj-s/orgs", "repos_url": "https://api.github.com/users/anj-s/repos", "events_url": "https://api.github.com/users/anj-s/events{/privacy}", "received_events_url": "https://api.github.com/users/anj-s/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2018-11-01T17:20:56Z", "updated_at": "2018-11-21T19:22:30Z", "closed_at": null, "author_association": "NONE", "body_html": "<p><strong>System information</strong></p>\n<ul>\n<li>Have I written custom code (as opposed to using a stock example script provided in TensorFlow):<br>\nYes, duplicated the minimal code from documentation snippet from <a href=\"https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/distribute#example-with-keras-api\">here</a></li>\n<li>OS Platform and Distribution (e.g., Linux Ubuntu 16.04):\"18.04.1 LTS (Bionic Beaver)\"</li>\n<li>Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:None</li>\n<li>TensorFlow installed from (source or binary): source and binary</li>\n<li>TensorFlow version (use command below): v1.12.0-rc2-0-g748435b8ef</li>\n<li>Python version: 3.6.6</li>\n<li>Bazel version (if compiling from source): 0.15.2</li>\n<li>GCC/Compiler version (if compiling from source): 6.4.0</li>\n<li>CUDA/cuDNN version: 9.0 / 7.3</li>\n<li>GPU model and memory: 2 x 1080-ti</li>\n</ul>\n<p><strong>Describe the current behavior</strong><br>\nCannot save a tf.keras model if trained with MirroredStrategy either by calling save_weight or by a tf.keras.callbacks.ModelCheckpoint, but does work if MirroredStrategy is not used.</p>\n<p><strong>Code to reproduce the issue</strong></p>\n<pre><code>inputs = tf.keras.layers.Input(shape=(1,))\npredictions = tf.keras.layers.Dense(1)(inputs)\nmodel = tf.keras.models.Model(inputs=inputs, outputs=predictions)\n\nfeatures = tf.data.Dataset.from_tensors([1.]).repeat(10000).batch(10)\nlabels = tf.data.Dataset.from_tensors([1.]).repeat(10000).batch(10)\ntrain_dataset = tf.data.Dataset.zip((features, labels))\n\ndistribution = tf.contrib.distribute.MirroredStrategy()\n\nmodel.compile(loss='categorical_crossentropy',\n              optimizer=tf.train.GradientDescentOptimizer(learning_rate=0.2),\n              distribute=distribution)\nmodel.fit(train_dataset, epochs=5, steps_per_epoch=10)\n</code></pre>\n<p>And adding:</p>\n<pre><code>model.save_weights('my_weight')\n</code></pre>\n<p>Error looks lite:</p>\n<pre><code>Traceback (most recent call last):\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/values.py\", line 72, in get\n    return self._index[device]\nKeyError: '/replica:0/task:0/device:CPU:0'\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"minimal_example.py\", line 17, in &lt;module&gt;\n    model.save_weights('my_weight')\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/engine/network.py\", line 1449, in save_weights\n    session = backend.get_session()\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/backend.py\", line 469, in get_session\n    _initialize_variables(session)\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/backend.py\", line 722, in _initialize_variables\n    variables = _get_variables(ops.get_default_graph())\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/backend.py\", line 716, in _get_variables\n    variables.update(opt.optimizer.variables())\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/training/optimizer.py\", line 787, in variables\n    optimizer_variables = [v for v in self._non_slot_variables()\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/training/optimizer.py\", line 788, in &lt;listcomp&gt;\n    if _from_current_graph(v)]\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/training/optimizer.py\", line 781, in _from_current_graph\n    return variable.op.graph is current_graph\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/values.py\", line 308, in op\n    return self.get().op\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/values.py\", line 76, in get\n    (device, self._index.keys(), device_util.current())), e)\n  File \"&lt;string&gt;\", line 3, in raise_from\nValueError: Device /replica:0/task:0/device:CPU:0 not found in dict_keys(['/replica:0/task:0/device:GPU:0', '/replica:0/task:0/device:GPU:1']) (current device )\n</code></pre>\n<p>Changing to:</p>\n<pre><code>checkpoint_path = \"my_weight\"\ncp_callback = tf.keras.callbacks.ModelCheckpoint(checkpoint_path,\n                                                 save_weights_only=True,\n                                                 verbose=1,\n                                                 period=1)\nmodel.fit(train_dataset,\n          epochs=5,\n          steps_per_epoch=10,\n          callbacks=[cp_callback])\n</code></pre>\n<p>Also does not work an end up with:</p>\n<pre><code>Epoch 1/5\n 1/10 [==&gt;...........................] - ETA: 4s - loss: 1.1921e-07\nEpoch 00001: saving model to model_dir/my_weight\nWARNING:tensorflow:You are accessing attribute _replicated_modelof the DistributedCallbackModel that may not have been set correctly.\nTraceback (most recent call last):\n  File \"minimal_example.py\", line 35, in &lt;module&gt;\n    callbacks=[cp_callback])\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/engine/training.py\", line 1624, in fit\n    validation_steps=validation_steps)\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/engine/training_distributed.py\", line 198, in fit_loop\n    callbacks.on_epoch_end(epoch, epoch_logs)\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/callbacks.py\", line 214, in on_epoch_end\n    callback.on_epoch_end(epoch, logs)\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/callbacks.py\", line 599, in on_epoch_end\n    self.model.save_weights(filepath, overwrite=True)\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/engine/training.py\", line 2336, in save_weights\n    self._replicated_model.save_weights(filepath, overwrite=overwrite,\nAttributeError: 'NoneType' object has no attribute 'save_weights'\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nYes, duplicated the minimal code from documentation snippet from here\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\"18.04.1 LTS (Bionic Beaver)\"\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:None\nTensorFlow installed from (source or binary): source and binary\nTensorFlow version (use command below): v1.12.0-rc2-0-g748435b8ef\nPython version: 3.6.6\nBazel version (if compiling from source): 0.15.2\nGCC/Compiler version (if compiling from source): 6.4.0\nCUDA/cuDNN version: 9.0 / 7.3\nGPU model and memory: 2 x 1080-ti\n\nDescribe the current behavior\nCannot save a tf.keras model if trained with MirroredStrategy either by calling save_weight or by a tf.keras.callbacks.ModelCheckpoint, but does work if MirroredStrategy is not used.\nCode to reproduce the issue\ninputs = tf.keras.layers.Input(shape=(1,))\npredictions = tf.keras.layers.Dense(1)(inputs)\nmodel = tf.keras.models.Model(inputs=inputs, outputs=predictions)\n\nfeatures = tf.data.Dataset.from_tensors([1.]).repeat(10000).batch(10)\nlabels = tf.data.Dataset.from_tensors([1.]).repeat(10000).batch(10)\ntrain_dataset = tf.data.Dataset.zip((features, labels))\n\ndistribution = tf.contrib.distribute.MirroredStrategy()\n\nmodel.compile(loss='categorical_crossentropy',\n              optimizer=tf.train.GradientDescentOptimizer(learning_rate=0.2),\n              distribute=distribution)\nmodel.fit(train_dataset, epochs=5, steps_per_epoch=10)\n\nAnd adding:\nmodel.save_weights('my_weight')\n\nError looks lite:\nTraceback (most recent call last):\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/values.py\", line 72, in get\n    return self._index[device]\nKeyError: '/replica:0/task:0/device:CPU:0'\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"minimal_example.py\", line 17, in <module>\n    model.save_weights('my_weight')\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/engine/network.py\", line 1449, in save_weights\n    session = backend.get_session()\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/backend.py\", line 469, in get_session\n    _initialize_variables(session)\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/backend.py\", line 722, in _initialize_variables\n    variables = _get_variables(ops.get_default_graph())\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/backend.py\", line 716, in _get_variables\n    variables.update(opt.optimizer.variables())\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/training/optimizer.py\", line 787, in variables\n    optimizer_variables = [v for v in self._non_slot_variables()\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/training/optimizer.py\", line 788, in <listcomp>\n    if _from_current_graph(v)]\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/training/optimizer.py\", line 781, in _from_current_graph\n    return variable.op.graph is current_graph\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/values.py\", line 308, in op\n    return self.get().op\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/values.py\", line 76, in get\n    (device, self._index.keys(), device_util.current())), e)\n  File \"<string>\", line 3, in raise_from\nValueError: Device /replica:0/task:0/device:CPU:0 not found in dict_keys(['/replica:0/task:0/device:GPU:0', '/replica:0/task:0/device:GPU:1']) (current device )\n\nChanging to:\ncheckpoint_path = \"my_weight\"\ncp_callback = tf.keras.callbacks.ModelCheckpoint(checkpoint_path,\n                                                 save_weights_only=True,\n                                                 verbose=1,\n                                                 period=1)\nmodel.fit(train_dataset,\n          epochs=5,\n          steps_per_epoch=10,\n          callbacks=[cp_callback])\n\nAlso does not work an end up with:\nEpoch 1/5\n 1/10 [==>...........................] - ETA: 4s - loss: 1.1921e-07\nEpoch 00001: saving model to model_dir/my_weight\nWARNING:tensorflow:You are accessing attribute _replicated_modelof the DistributedCallbackModel that may not have been set correctly.\nTraceback (most recent call last):\n  File \"minimal_example.py\", line 35, in <module>\n    callbacks=[cp_callback])\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/engine/training.py\", line 1624, in fit\n    validation_steps=validation_steps)\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/engine/training_distributed.py\", line 198, in fit_loop\n    callbacks.on_epoch_end(epoch, epoch_logs)\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/callbacks.py\", line 214, in on_epoch_end\n    callback.on_epoch_end(epoch, logs)\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/callbacks.py\", line 599, in on_epoch_end\n    self.model.save_weights(filepath, overwrite=True)\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/engine/training.py\", line 2336, in save_weights\n    self._replicated_model.save_weights(filepath, overwrite=overwrite,\nAttributeError: 'NoneType' object has no attribute 'save_weights'", "body": "**System information**\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow):\r\nYes, duplicated the minimal code from documentation snippet from [here](https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/distribute#example-with-keras-api)\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 16.04):\"18.04.1 LTS (Bionic Beaver)\"\r\n- Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:None\r\n- TensorFlow installed from (source or binary): source and binary\r\n- TensorFlow version (use command below): v1.12.0-rc2-0-g748435b8ef\r\n- Python version: 3.6.6\r\n- Bazel version (if compiling from source): 0.15.2\r\n- GCC/Compiler version (if compiling from source): 6.4.0\r\n- CUDA/cuDNN version: 9.0 / 7.3\r\n- GPU model and memory: 2 x 1080-ti\r\n\r\n\r\n**Describe the current behavior**\r\nCannot save a tf.keras model if trained with MirroredStrategy either by calling save_weight or by a tf.keras.callbacks.ModelCheckpoint, but does work if MirroredStrategy is not used.\r\n\r\n\r\n**Code to reproduce the issue**\r\n```\r\ninputs = tf.keras.layers.Input(shape=(1,))\r\npredictions = tf.keras.layers.Dense(1)(inputs)\r\nmodel = tf.keras.models.Model(inputs=inputs, outputs=predictions)\r\n\r\nfeatures = tf.data.Dataset.from_tensors([1.]).repeat(10000).batch(10)\r\nlabels = tf.data.Dataset.from_tensors([1.]).repeat(10000).batch(10)\r\ntrain_dataset = tf.data.Dataset.zip((features, labels))\r\n\r\ndistribution = tf.contrib.distribute.MirroredStrategy()\r\n\r\nmodel.compile(loss='categorical_crossentropy',\r\n              optimizer=tf.train.GradientDescentOptimizer(learning_rate=0.2),\r\n              distribute=distribution)\r\nmodel.fit(train_dataset, epochs=5, steps_per_epoch=10)\r\n```\r\nAnd adding:\r\n```\r\nmodel.save_weights('my_weight')\r\n```\r\nError looks lite:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/values.py\", line 72, in get\r\n    return self._index[device]\r\nKeyError: '/replica:0/task:0/device:CPU:0'\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"minimal_example.py\", line 17, in <module>\r\n    model.save_weights('my_weight')\r\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/engine/network.py\", line 1449, in save_weights\r\n    session = backend.get_session()\r\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/backend.py\", line 469, in get_session\r\n    _initialize_variables(session)\r\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/backend.py\", line 722, in _initialize_variables\r\n    variables = _get_variables(ops.get_default_graph())\r\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/backend.py\", line 716, in _get_variables\r\n    variables.update(opt.optimizer.variables())\r\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/training/optimizer.py\", line 787, in variables\r\n    optimizer_variables = [v for v in self._non_slot_variables()\r\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/training/optimizer.py\", line 788, in <listcomp>\r\n    if _from_current_graph(v)]\r\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/training/optimizer.py\", line 781, in _from_current_graph\r\n    return variable.op.graph is current_graph\r\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/values.py\", line 308, in op\r\n    return self.get().op\r\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/contrib/distribute/python/values.py\", line 76, in get\r\n    (device, self._index.keys(), device_util.current())), e)\r\n  File \"<string>\", line 3, in raise_from\r\nValueError: Device /replica:0/task:0/device:CPU:0 not found in dict_keys(['/replica:0/task:0/device:GPU:0', '/replica:0/task:0/device:GPU:1']) (current device )\r\n```\r\nChanging to:\r\n```\r\ncheckpoint_path = \"my_weight\"\r\ncp_callback = tf.keras.callbacks.ModelCheckpoint(checkpoint_path,\r\n                                                 save_weights_only=True,\r\n                                                 verbose=1,\r\n                                                 period=1)\r\nmodel.fit(train_dataset,\r\n          epochs=5,\r\n          steps_per_epoch=10,\r\n          callbacks=[cp_callback])\r\n```\r\nAlso does not work an end up with:\r\n```\r\nEpoch 1/5\r\n 1/10 [==>...........................] - ETA: 4s - loss: 1.1921e-07\r\nEpoch 00001: saving model to model_dir/my_weight\r\nWARNING:tensorflow:You are accessing attribute _replicated_modelof the DistributedCallbackModel that may not have been set correctly.\r\nTraceback (most recent call last):\r\n  File \"minimal_example.py\", line 35, in <module>\r\n    callbacks=[cp_callback])\r\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/engine/training.py\", line 1624, in fit\r\n    validation_steps=validation_steps)\r\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/engine/training_distributed.py\", line 198, in fit_loop\r\n    callbacks.on_epoch_end(epoch, epoch_logs)\r\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/callbacks.py\", line 214, in on_epoch_end\r\n    callback.on_epoch_end(epoch, logs)\r\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/callbacks.py\", line 599, in on_epoch_end\r\n    self.model.save_weights(filepath, overwrite=True)\r\n  File \"/home/BP/anaconda3/envs/tf12_gpu/lib/python3.6/site-packages/tensorflow/python/keras/engine/training.py\", line 2336, in save_weights\r\n    self._replicated_model.save_weights(filepath, overwrite=overwrite,\r\nAttributeError: 'NoneType' object has no attribute 'save_weights'\r\n```\r\n"}