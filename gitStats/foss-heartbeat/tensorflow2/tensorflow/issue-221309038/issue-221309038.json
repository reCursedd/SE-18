{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9169", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9169/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9169/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9169/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/9169", "id": 221309038, "node_id": "MDU6SXNzdWUyMjEzMDkwMzg=", "number": 9169, "title": "Loading LSTM \"SavedModel\" from golang results in crash", "user": {"login": "berset", "id": 1536596, "node_id": "MDQ6VXNlcjE1MzY1OTY=", "avatar_url": "https://avatars2.githubusercontent.com/u/1536596?v=4", "gravatar_id": "", "url": "https://api.github.com/users/berset", "html_url": "https://github.com/berset", "followers_url": "https://api.github.com/users/berset/followers", "following_url": "https://api.github.com/users/berset/following{/other_user}", "gists_url": "https://api.github.com/users/berset/gists{/gist_id}", "starred_url": "https://api.github.com/users/berset/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/berset/subscriptions", "organizations_url": "https://api.github.com/users/berset/orgs", "repos_url": "https://api.github.com/users/berset/repos", "events_url": "https://api.github.com/users/berset/events{/privacy}", "received_events_url": "https://api.github.com/users/berset/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-04-12T15:53:30Z", "updated_at": "2017-04-13T09:33:34Z", "closed_at": "2017-04-12T16:52:33Z", "author_association": "NONE", "body_html": "<p>NOTE: Issues that are not bugs or feature requests will be closed. Please ask usage questions on StackOverflow.</p>\n<h3>You must complete this information or else your issue will be closed</h3>\n<ul>\n<li><em>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)?</em>: Yes</li>\n<li><em>TensorFlow installed from (source or binary)?</em>: binary</li>\n<li><em>TensorFlow version</em>: 1.0.1</li>\n<li><em>Bazel version (if compiling from source)</em>: -</li>\n<li><em>CUDA/cuDNN version</em>: -</li>\n<li><em>GPU Model and Memory</em>: -</li>\n<li><em>Exact command to reproduce</em>: -</li>\n</ul>\n<h3>Describe the problem clearly</h3>\n<p>I have a 'saved model' of a NN that look like this (keras - model.summary()):</p>\n<pre><code>_________________________________________________________________\nLayer (type)                 Output Shape              Param #   \n=================================================================\ninput_1 (InputLayer)         (None, 15, 300)           0         \n_________________________________________________________________\nmasking_1 (Masking)          (None, 15, 300)           0         \n_________________________________________________________________\nlstm_1 (LSTM)                (None, 300)               721200    \n_________________________________________________________________\ndropout_1 (Dropout)          (None, 300)               0         \n_________________________________________________________________\ndense_1 (Dense)              (None, 145)               43645     \n_________________________________________________________________\nactivation_1 (Activation)    (None, 145)               0         \n=================================================================\nTotal params: 764,845.0\nTrainable params: 764,845.0\nNon-trainable params: 0.0\n_________________________________________________________________\n</code></pre>\n<p>When I try to load it using the golang bindings, it results in a crash:</p>\n<pre><code>$ go run example.go \nI tensorflow/cc/saved_model/loader.cc:194] Loading SavedModel from: ./load\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX2 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use FMA instructions, but these are available on your machine and could speed up CPU computations.\nI tensorflow/cc/saved_model/loader.cc:114] Restoring SavedModel bundle.\nI tensorflow/cc/saved_model/loader.cc:148] Running LegacyInitOp on SavedModel bundle.\nI tensorflow/cc/saved_model/loader.cc:238] Loading SavedModel: success. Took 150044 microseconds.\nfatal error: unexpected signal during runtime execution\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x8c1a6cc]\n\nruntime stack:\nruntime.throw(0x40cadf9, 0x2a)\n\t/usr/local/go/src/runtime/panic.go:596 +0x95\nruntime.sigpanic()\n\t/usr/local/go/src/runtime/signal_unix.go:274 +0x2db\n\ngoroutine 1 [syscall, locked to thread]:\nruntime.cgocall(0x4094920, 0xc420053dd0, 0x40cabb6)\n\t/usr/local/go/src/runtime/cgocall.go:131 +0xe2 fp=0xc420053d90 sp=0xc420053d50\ngithub.com/tensorflow/tensorflow/tensorflow/go._Cfunc_TF_LoadSessionFromSavedModel(0x4516690, 0x0, 0x45167c0, 0xc42000e030, 0x1, 0x4515e50, 0x0, 0x45135f0, 0x0)\n\tgithub.com/tensorflow/tensorflow/tensorflow/go/_obj/_cgo_gotypes.go:438 +0x51 fp=0xc420053dd0 sp=0xc420053d90\ngithub.com/tensorflow/tensorflow/tensorflow/go.LoadSavedModel.func1(0x4516690, 0x0, 0x45167c0, 0xc42000e030, 0x1, 0x4515e50, 0x0, 0x45135f0, 0x414d0f0)\n\t/Users/berset/git/gopath/src/github.com/tensorflow/tensorflow/tensorflow/go/saved_model.go:56 +0x156 fp=0xc420053e28 sp=0xc420053dd0\ngithub.com/tensorflow/tensorflow/tensorflow/go.LoadSavedModel(0x40c5552, 0x6, 0xc420053f68, 0x1, 0x1, 0x0, 0x0, 0x4124480, 0x40a49e0)\n\t/Users/berset/git/gopath/src/github.com/tensorflow/tensorflow/tensorflow/go/saved_model.go:56 +0x1b4 fp=0xc420053ed8 sp=0xc420053e28\nmain.main()\n\t/Users/berset/git/gopath/src/github.com/campanja/ssinet/example.go:9 +0x8e fp=0xc420053f88 sp=0xc420053ed8\nruntime.main()\n\t/usr/local/go/src/runtime/proc.go:185 +0x20a fp=0xc420053fe0 sp=0xc420053f88\nruntime.goexit()\n\t/usr/local/go/src/runtime/asm_amd64.s:2197 +0x1 fp=0xc420053fe8 sp=0xc420053fe0\n\ngoroutine 17 [syscall, locked to thread]:\nruntime.goexit()\n\t/usr/local/go/src/runtime/asm_amd64.s:2197 +0x1\nexit status 2\n$ \n</code></pre>\n<h3>Source Code / Logs</h3>\n<p>The go code looks like this:</p>\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    tf \"github.com/tensorflow/tensorflow/tensorflow/go\"\n)\n\nfunc main() {\n    m, err := tf.LoadSavedModel(\"./load\", []string{\"serve\"}, nil)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(m)\n    fmt.Println(\"load successful!\")\n}\n</code></pre>\n<p>I'm attaching a sample saved model and the code to generate the crash.</p>\n<p><a href=\"https://github.com/tensorflow/tensorflow/files/917065/sample.zip\">sample.zip</a></p>\n<p>I can use the same code/bundling process to save / load NNs with only Dense layers for example.<br>\nI also did try to printf debug this and I think the problem arises around the \"TensorArrayV3\" or \"TensorArrayReadV3\" or some such operation.</p>", "body_text": "NOTE: Issues that are not bugs or feature requests will be closed. Please ask usage questions on StackOverflow.\nYou must complete this information or else your issue will be closed\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow)?: Yes\nTensorFlow installed from (source or binary)?: binary\nTensorFlow version: 1.0.1\nBazel version (if compiling from source): -\nCUDA/cuDNN version: -\nGPU Model and Memory: -\nExact command to reproduce: -\n\nDescribe the problem clearly\nI have a 'saved model' of a NN that look like this (keras - model.summary()):\n_________________________________________________________________\nLayer (type)                 Output Shape              Param #   \n=================================================================\ninput_1 (InputLayer)         (None, 15, 300)           0         \n_________________________________________________________________\nmasking_1 (Masking)          (None, 15, 300)           0         \n_________________________________________________________________\nlstm_1 (LSTM)                (None, 300)               721200    \n_________________________________________________________________\ndropout_1 (Dropout)          (None, 300)               0         \n_________________________________________________________________\ndense_1 (Dense)              (None, 145)               43645     \n_________________________________________________________________\nactivation_1 (Activation)    (None, 145)               0         \n=================================================================\nTotal params: 764,845.0\nTrainable params: 764,845.0\nNon-trainable params: 0.0\n_________________________________________________________________\n\nWhen I try to load it using the golang bindings, it results in a crash:\n$ go run example.go \nI tensorflow/cc/saved_model/loader.cc:194] Loading SavedModel from: ./load\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX2 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use FMA instructions, but these are available on your machine and could speed up CPU computations.\nI tensorflow/cc/saved_model/loader.cc:114] Restoring SavedModel bundle.\nI tensorflow/cc/saved_model/loader.cc:148] Running LegacyInitOp on SavedModel bundle.\nI tensorflow/cc/saved_model/loader.cc:238] Loading SavedModel: success. Took 150044 microseconds.\nfatal error: unexpected signal during runtime execution\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x8c1a6cc]\n\nruntime stack:\nruntime.throw(0x40cadf9, 0x2a)\n\t/usr/local/go/src/runtime/panic.go:596 +0x95\nruntime.sigpanic()\n\t/usr/local/go/src/runtime/signal_unix.go:274 +0x2db\n\ngoroutine 1 [syscall, locked to thread]:\nruntime.cgocall(0x4094920, 0xc420053dd0, 0x40cabb6)\n\t/usr/local/go/src/runtime/cgocall.go:131 +0xe2 fp=0xc420053d90 sp=0xc420053d50\ngithub.com/tensorflow/tensorflow/tensorflow/go._Cfunc_TF_LoadSessionFromSavedModel(0x4516690, 0x0, 0x45167c0, 0xc42000e030, 0x1, 0x4515e50, 0x0, 0x45135f0, 0x0)\n\tgithub.com/tensorflow/tensorflow/tensorflow/go/_obj/_cgo_gotypes.go:438 +0x51 fp=0xc420053dd0 sp=0xc420053d90\ngithub.com/tensorflow/tensorflow/tensorflow/go.LoadSavedModel.func1(0x4516690, 0x0, 0x45167c0, 0xc42000e030, 0x1, 0x4515e50, 0x0, 0x45135f0, 0x414d0f0)\n\t/Users/berset/git/gopath/src/github.com/tensorflow/tensorflow/tensorflow/go/saved_model.go:56 +0x156 fp=0xc420053e28 sp=0xc420053dd0\ngithub.com/tensorflow/tensorflow/tensorflow/go.LoadSavedModel(0x40c5552, 0x6, 0xc420053f68, 0x1, 0x1, 0x0, 0x0, 0x4124480, 0x40a49e0)\n\t/Users/berset/git/gopath/src/github.com/tensorflow/tensorflow/tensorflow/go/saved_model.go:56 +0x1b4 fp=0xc420053ed8 sp=0xc420053e28\nmain.main()\n\t/Users/berset/git/gopath/src/github.com/campanja/ssinet/example.go:9 +0x8e fp=0xc420053f88 sp=0xc420053ed8\nruntime.main()\n\t/usr/local/go/src/runtime/proc.go:185 +0x20a fp=0xc420053fe0 sp=0xc420053f88\nruntime.goexit()\n\t/usr/local/go/src/runtime/asm_amd64.s:2197 +0x1 fp=0xc420053fe8 sp=0xc420053fe0\n\ngoroutine 17 [syscall, locked to thread]:\nruntime.goexit()\n\t/usr/local/go/src/runtime/asm_amd64.s:2197 +0x1\nexit status 2\n$ \n\nSource Code / Logs\nThe go code looks like this:\npackage main\n\nimport (\n    \"fmt\"\n    tf \"github.com/tensorflow/tensorflow/tensorflow/go\"\n)\n\nfunc main() {\n    m, err := tf.LoadSavedModel(\"./load\", []string{\"serve\"}, nil)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(m)\n    fmt.Println(\"load successful!\")\n}\n\nI'm attaching a sample saved model and the code to generate the crash.\nsample.zip\nI can use the same code/bundling process to save / load NNs with only Dense layers for example.\nI also did try to printf debug this and I think the problem arises around the \"TensorArrayV3\" or \"TensorArrayReadV3\" or some such operation.", "body": "NOTE: Issues that are not bugs or feature requests will be closed. Please ask usage questions on StackOverflow.\r\n\r\n### You must complete this information or else your issue will be closed\r\n- *Have I written custom code (as opposed to using a stock example script provided in TensorFlow)?*: Yes\r\n- *TensorFlow installed from (source or binary)?*: binary\r\n- *TensorFlow version*: 1.0.1\r\n- *Bazel version (if compiling from source)*: -\r\n- *CUDA/cuDNN version*: - \r\n- *GPU Model and Memory*: -\r\n- *Exact command to reproduce*: -\r\n\r\n### Describe the problem clearly\r\n\r\nI have a 'saved model' of a NN that look like this (keras - model.summary()):\r\n```\r\n_________________________________________________________________\r\nLayer (type)                 Output Shape              Param #   \r\n=================================================================\r\ninput_1 (InputLayer)         (None, 15, 300)           0         \r\n_________________________________________________________________\r\nmasking_1 (Masking)          (None, 15, 300)           0         \r\n_________________________________________________________________\r\nlstm_1 (LSTM)                (None, 300)               721200    \r\n_________________________________________________________________\r\ndropout_1 (Dropout)          (None, 300)               0         \r\n_________________________________________________________________\r\ndense_1 (Dense)              (None, 145)               43645     \r\n_________________________________________________________________\r\nactivation_1 (Activation)    (None, 145)               0         \r\n=================================================================\r\nTotal params: 764,845.0\r\nTrainable params: 764,845.0\r\nNon-trainable params: 0.0\r\n_________________________________________________________________\r\n```\r\nWhen I try to load it using the golang bindings, it results in a crash:\r\n```\r\n$ go run example.go \r\nI tensorflow/cc/saved_model/loader.cc:194] Loading SavedModel from: ./load\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX2 instructions, but these are available on your machine and could speed up CPU computations.\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use FMA instructions, but these are available on your machine and could speed up CPU computations.\r\nI tensorflow/cc/saved_model/loader.cc:114] Restoring SavedModel bundle.\r\nI tensorflow/cc/saved_model/loader.cc:148] Running LegacyInitOp on SavedModel bundle.\r\nI tensorflow/cc/saved_model/loader.cc:238] Loading SavedModel: success. Took 150044 microseconds.\r\nfatal error: unexpected signal during runtime execution\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x8c1a6cc]\r\n\r\nruntime stack:\r\nruntime.throw(0x40cadf9, 0x2a)\r\n\t/usr/local/go/src/runtime/panic.go:596 +0x95\r\nruntime.sigpanic()\r\n\t/usr/local/go/src/runtime/signal_unix.go:274 +0x2db\r\n\r\ngoroutine 1 [syscall, locked to thread]:\r\nruntime.cgocall(0x4094920, 0xc420053dd0, 0x40cabb6)\r\n\t/usr/local/go/src/runtime/cgocall.go:131 +0xe2 fp=0xc420053d90 sp=0xc420053d50\r\ngithub.com/tensorflow/tensorflow/tensorflow/go._Cfunc_TF_LoadSessionFromSavedModel(0x4516690, 0x0, 0x45167c0, 0xc42000e030, 0x1, 0x4515e50, 0x0, 0x45135f0, 0x0)\r\n\tgithub.com/tensorflow/tensorflow/tensorflow/go/_obj/_cgo_gotypes.go:438 +0x51 fp=0xc420053dd0 sp=0xc420053d90\r\ngithub.com/tensorflow/tensorflow/tensorflow/go.LoadSavedModel.func1(0x4516690, 0x0, 0x45167c0, 0xc42000e030, 0x1, 0x4515e50, 0x0, 0x45135f0, 0x414d0f0)\r\n\t/Users/berset/git/gopath/src/github.com/tensorflow/tensorflow/tensorflow/go/saved_model.go:56 +0x156 fp=0xc420053e28 sp=0xc420053dd0\r\ngithub.com/tensorflow/tensorflow/tensorflow/go.LoadSavedModel(0x40c5552, 0x6, 0xc420053f68, 0x1, 0x1, 0x0, 0x0, 0x4124480, 0x40a49e0)\r\n\t/Users/berset/git/gopath/src/github.com/tensorflow/tensorflow/tensorflow/go/saved_model.go:56 +0x1b4 fp=0xc420053ed8 sp=0xc420053e28\r\nmain.main()\r\n\t/Users/berset/git/gopath/src/github.com/campanja/ssinet/example.go:9 +0x8e fp=0xc420053f88 sp=0xc420053ed8\r\nruntime.main()\r\n\t/usr/local/go/src/runtime/proc.go:185 +0x20a fp=0xc420053fe0 sp=0xc420053f88\r\nruntime.goexit()\r\n\t/usr/local/go/src/runtime/asm_amd64.s:2197 +0x1 fp=0xc420053fe8 sp=0xc420053fe0\r\n\r\ngoroutine 17 [syscall, locked to thread]:\r\nruntime.goexit()\r\n\t/usr/local/go/src/runtime/asm_amd64.s:2197 +0x1\r\nexit status 2\r\n$ \r\n```\r\n\r\n\r\n### Source Code / Logs\r\n\r\nThe go code looks like this:\r\n\r\n```\r\npackage main\r\n\r\nimport (\r\n    \"fmt\"\r\n    tf \"github.com/tensorflow/tensorflow/tensorflow/go\"\r\n)\r\n\r\nfunc main() {\r\n    m, err := tf.LoadSavedModel(\"./load\", []string{\"serve\"}, nil)\r\n    if err != nil {\r\n        fmt.Println(err)\r\n    }\r\n    fmt.Println(m)\r\n    fmt.Println(\"load successful!\")\r\n}\r\n```\r\n\r\nI'm attaching a sample saved model and the code to generate the crash.\r\n\r\n[sample.zip](https://github.com/tensorflow/tensorflow/files/917065/sample.zip)\r\n\r\nI can use the same code/bundling process to save / load NNs with only Dense layers for example.\r\nI also did try to printf debug this and I think the problem arises around the \"TensorArrayV3\" or \"TensorArrayReadV3\" or some such operation."}