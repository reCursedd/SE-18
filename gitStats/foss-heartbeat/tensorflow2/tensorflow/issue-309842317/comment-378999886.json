{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/378999886", "html_url": "https://github.com/tensorflow/tensorflow/issues/18092#issuecomment-378999886", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18092", "id": 378999886, "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODk5OTg4Ng==", "user": {"login": "jthestness", "id": 28744304, "node_id": "MDQ6VXNlcjI4NzQ0MzA0", "avatar_url": "https://avatars0.githubusercontent.com/u/28744304?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jthestness", "html_url": "https://github.com/jthestness", "followers_url": "https://api.github.com/users/jthestness/followers", "following_url": "https://api.github.com/users/jthestness/following{/other_user}", "gists_url": "https://api.github.com/users/jthestness/gists{/gist_id}", "starred_url": "https://api.github.com/users/jthestness/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jthestness/subscriptions", "organizations_url": "https://api.github.com/users/jthestness/orgs", "repos_url": "https://api.github.com/users/jthestness/repos", "events_url": "https://api.github.com/users/jthestness/events{/privacy}", "received_events_url": "https://api.github.com/users/jthestness/received_events", "type": "User", "site_admin": false}, "created_at": "2018-04-05T16:41:28Z", "updated_at": "2018-04-05T16:41:28Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Ok, you're going to need to step through the chain of defining symbols across the libraries to see where there is a missing link. Check that the Tensorflow library you built points to the correct MPI library with <code>ldd &lt;path_to_tf_build&gt;/python/_pywrap_tensorflow_internal.so</code>. If that's correct, then check the mpi_collectives library: <code>ldd &lt;path_to_tf_build&gt;/contrib/mpi_collectives/python/ops/_mpi_ops.so</code> and then <code>objdump -t &lt;path_to_tf_build&gt;/contrib/mpi_collectives/python/ops/_mpi_ops.so | grep ompi_datatype_t</code>. The latter should show something like this (note \"F\" means the function is defined, you probably have a \"U\" or the functions are missing):</p>\n<pre><code>00000000000265f0 g     F .text\t0000000000000008              _ZN10tensorflow7contrib15mpi_collectives7MPITypeIxEEP15ompi_datatype_tv\n00000000000265e0 g     F .text\t0000000000000008              _ZN10tensorflow7contrib15mpi_collectives7MPITypeIiEEP15ompi_datatype_tv\n00000000000265d0 g     F .text\t0000000000000008              _ZN10tensorflow7contrib15mpi_collectives7MPITypeIfEEP15ompi_datatype_tv\n</code></pre>\n<p>If the function is not defined (\"U\" or missing), then something went wrong with the TF build. Be sure that you either opt 'yes' when prompted to configure the build with MPI or set the environment variable <code>TF_NEED_MPI=1</code> before configuring.</p>\n<p>Another thing you could try is to roll back to TF 1.5.0, which we have working internally. (We haven't tested 1.7.0-rc1, and unfortunately, the regressions architecture for TF doesn't permit us to run MPI tests, so changes to TF can break the mpi_collectives code).</p>", "body_text": "Ok, you're going to need to step through the chain of defining symbols across the libraries to see where there is a missing link. Check that the Tensorflow library you built points to the correct MPI library with ldd <path_to_tf_build>/python/_pywrap_tensorflow_internal.so. If that's correct, then check the mpi_collectives library: ldd <path_to_tf_build>/contrib/mpi_collectives/python/ops/_mpi_ops.so and then objdump -t <path_to_tf_build>/contrib/mpi_collectives/python/ops/_mpi_ops.so | grep ompi_datatype_t. The latter should show something like this (note \"F\" means the function is defined, you probably have a \"U\" or the functions are missing):\n00000000000265f0 g     F .text\t0000000000000008              _ZN10tensorflow7contrib15mpi_collectives7MPITypeIxEEP15ompi_datatype_tv\n00000000000265e0 g     F .text\t0000000000000008              _ZN10tensorflow7contrib15mpi_collectives7MPITypeIiEEP15ompi_datatype_tv\n00000000000265d0 g     F .text\t0000000000000008              _ZN10tensorflow7contrib15mpi_collectives7MPITypeIfEEP15ompi_datatype_tv\n\nIf the function is not defined (\"U\" or missing), then something went wrong with the TF build. Be sure that you either opt 'yes' when prompted to configure the build with MPI or set the environment variable TF_NEED_MPI=1 before configuring.\nAnother thing you could try is to roll back to TF 1.5.0, which we have working internally. (We haven't tested 1.7.0-rc1, and unfortunately, the regressions architecture for TF doesn't permit us to run MPI tests, so changes to TF can break the mpi_collectives code).", "body": "Ok, you're going to need to step through the chain of defining symbols across the libraries to see where there is a missing link. Check that the Tensorflow library you built points to the correct MPI library with `ldd <path_to_tf_build>/python/_pywrap_tensorflow_internal.so`. If that's correct, then check the mpi_collectives library: `ldd <path_to_tf_build>/contrib/mpi_collectives/python/ops/_mpi_ops.so` and then `objdump -t <path_to_tf_build>/contrib/mpi_collectives/python/ops/_mpi_ops.so | grep ompi_datatype_t`. The latter should show something like this (note \"F\" means the function is defined, you probably have a \"U\" or the functions are missing):\r\n\r\n```\r\n00000000000265f0 g     F .text\t0000000000000008              _ZN10tensorflow7contrib15mpi_collectives7MPITypeIxEEP15ompi_datatype_tv\r\n00000000000265e0 g     F .text\t0000000000000008              _ZN10tensorflow7contrib15mpi_collectives7MPITypeIiEEP15ompi_datatype_tv\r\n00000000000265d0 g     F .text\t0000000000000008              _ZN10tensorflow7contrib15mpi_collectives7MPITypeIfEEP15ompi_datatype_tv\r\n```\r\n\r\nIf the function is not defined (\"U\" or missing), then something went wrong with the TF build. Be sure that you either opt 'yes' when prompted to configure the build with MPI or set the environment variable `TF_NEED_MPI=1` before configuring.\r\n\r\nAnother thing you could try is to roll back to TF 1.5.0, which we have working internally. (We haven't tested 1.7.0-rc1, and unfortunately, the regressions architecture for TF doesn't permit us to run MPI tests, so changes to TF can break the mpi_collectives code)."}