{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18740", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18740/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18740/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18740/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/18740", "id": 316375770, "node_id": "MDU6SXNzdWUzMTYzNzU3NzA=", "number": 18740, "title": "Frequent \"Premature EOF\" error in LLVM archive when running bazel build", "user": {"login": "RichDubielzig", "id": 24554323, "node_id": "MDQ6VXNlcjI0NTU0MzIz", "avatar_url": "https://avatars2.githubusercontent.com/u/24554323?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RichDubielzig", "html_url": "https://github.com/RichDubielzig", "followers_url": "https://api.github.com/users/RichDubielzig/followers", "following_url": "https://api.github.com/users/RichDubielzig/following{/other_user}", "gists_url": "https://api.github.com/users/RichDubielzig/gists{/gist_id}", "starred_url": "https://api.github.com/users/RichDubielzig/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RichDubielzig/subscriptions", "organizations_url": "https://api.github.com/users/RichDubielzig/orgs", "repos_url": "https://api.github.com/users/RichDubielzig/repos", "events_url": "https://api.github.com/users/RichDubielzig/events{/privacy}", "received_events_url": "https://api.github.com/users/RichDubielzig/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-04-20T18:55:57Z", "updated_at": "2018-04-21T00:25:11Z", "closed_at": "2018-04-21T00:25:11Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:<br>\nPatches against tf dev tree</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nUbuntu 14.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>:<br>\nSource</li>\n<li><strong>TensorFlow version (use command below)</strong>:<br>\n1.6.0rc1 (last upstream commit <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/0abc4c9ecae912676f6070ca4b76b35c80351c26/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/0abc4c9ecae912676f6070ca4b76b35c80351c26\"><tt>0abc4c9</tt></a>)</li>\n<li><strong>Python version</strong>:<br>\nn/a</li>\n<li><strong>Bazel version (if compiling from source)</strong>:<br>\n0.11.1</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>:<br>\ngcc (Ubuntu 4.8.4-2ubuntu1~14.04.3) 4.8.4</li>\n<li><strong>CUDA/cuDNN version</strong>:<br>\nn/a</li>\n<li><strong>GPU model and memory</strong>:<br>\nn/a</li>\n<li><strong>Exact command to reproduce</strong>:<br>\nFrom the dockerfile:</li>\n</ul>\n<p>`<br>\nENV GCC_HOST_COMPILER_PATH \"/usr/bin/gcc\"<br>\nENV PYTHON_BIN_PATH \"/usr/bin/python3\"<br>\nENV PYTHON_LIB_PATH \"/usr/lib/python3/dist-packages\"<br>\nENV CC_OPT_FLAGS \"-march=native\"</p>\n<p>ENV TF_NEED_GCP 0<br>\nENV TF_NEED_GDR 0<br>\nENV TF_NEED_HDFS 0<br>\nENV TF_NEED_MKL 0<br>\nENV TF_NEED_MPI 0<br>\nENV TF_NEED_OPENCL 0<br>\nENV TF_NEED_CUDA 0<br>\nENV TF_ENABLE_XLA 1<br>\nENV TF_NEED_JEMALLOC 1<br>\nENV TF_NEED_VERBS 0<br>\nENV TF_NEED_S3 0</p>\n<p>WORKDIR /tmp/tensorflow-knureon</p>\n<p>RUN ./configure <br>\n&amp;&amp; bazel build --config=opt --config=kpi --copt=-mfma --copt=-mavx2 //tensorflow/tools/pip_package:build_pip_package <br>\n&amp;&amp; bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg<br>\n`</p>\n<h3>Describe the problem</h3>\n<p>About 60% of the time I try from console and 100% of the time our CI system attempts to build TensorFlow, this error is observed, always related to the LLVM archive:</p>\n<p><code>20-Apr-2018 11:43:32 | ERROR: /tmp/tensorflow-knureon/tensorflow/tools/pip_package/BUILD:85:1: no such package '@llvm//': java.io.IOException: Error downloading [https://mirror.bazel.build/github.com/llvm-mirror/llvm/archive/8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz, https://github.com/llvm-mirror/llvm/archive/8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz] to /root/.cache/bazel/_bazel_root/0726af6ab00d84b2e399e1660b859bdb/external/llvm/8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz: Premature EOF and referenced by '//tensorflow/tools/pip_package:licenses' -- | -- 20-Apr-2018 11:43:32 | ERROR: Analysis of target '//tensorflow/tools/pip_package:build_pip_package' failed; build aborted: no such package '@llvm//': java.io.IOException: Error downloading [https://mirror.bazel.build/github.com/llvm-mirror/llvm/archive/8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz, https://github.com/llvm-mirror/llvm/archive/8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz] to /root/.cache/bazel/_bazel_root/0726af6ab00d84b2e399e1660b859bdb/external/llvm/8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz: Premature EOF</code></p>\n<p>I can use wget to fetch the tarball from the github source from within the Docker container without issues and the tarball opens without any errors reported.  The sha256 hash of the tarball is the same as what is specified in workspace.bzl:</p>\n<p><code>sha256sum 8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz  63d4da54dc7bc9a79e2ad266d230f4f759520cccb344a2dd49c2c6383ab75285  8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz</code></p>\n<h3>Source code / logs</h3>\n<p><a href=\"https://github.com/tensorflow/tensorflow/files/1933283/TF-TFLOW-JOB1-170.log\">TF-TFLOW-JOB1-170.log</a></p>\n<p>I have searched StackOverflow and github for the issue and found bazel LLVM errors, but nothing that would return \"Premature EOF\"</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nPatches against tf dev tree\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nUbuntu 14.04\nTensorFlow installed from (source or binary):\nSource\nTensorFlow version (use command below):\n1.6.0rc1 (last upstream commit 0abc4c9)\nPython version:\nn/a\nBazel version (if compiling from source):\n0.11.1\nGCC/Compiler version (if compiling from source):\ngcc (Ubuntu 4.8.4-2ubuntu1~14.04.3) 4.8.4\nCUDA/cuDNN version:\nn/a\nGPU model and memory:\nn/a\nExact command to reproduce:\nFrom the dockerfile:\n\n`\nENV GCC_HOST_COMPILER_PATH \"/usr/bin/gcc\"\nENV PYTHON_BIN_PATH \"/usr/bin/python3\"\nENV PYTHON_LIB_PATH \"/usr/lib/python3/dist-packages\"\nENV CC_OPT_FLAGS \"-march=native\"\nENV TF_NEED_GCP 0\nENV TF_NEED_GDR 0\nENV TF_NEED_HDFS 0\nENV TF_NEED_MKL 0\nENV TF_NEED_MPI 0\nENV TF_NEED_OPENCL 0\nENV TF_NEED_CUDA 0\nENV TF_ENABLE_XLA 1\nENV TF_NEED_JEMALLOC 1\nENV TF_NEED_VERBS 0\nENV TF_NEED_S3 0\nWORKDIR /tmp/tensorflow-knureon\nRUN ./configure \n&& bazel build --config=opt --config=kpi --copt=-mfma --copt=-mavx2 //tensorflow/tools/pip_package:build_pip_package \n&& bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg\n`\nDescribe the problem\nAbout 60% of the time I try from console and 100% of the time our CI system attempts to build TensorFlow, this error is observed, always related to the LLVM archive:\n20-Apr-2018 11:43:32 | ERROR: /tmp/tensorflow-knureon/tensorflow/tools/pip_package/BUILD:85:1: no such package '@llvm//': java.io.IOException: Error downloading [https://mirror.bazel.build/github.com/llvm-mirror/llvm/archive/8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz, https://github.com/llvm-mirror/llvm/archive/8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz] to /root/.cache/bazel/_bazel_root/0726af6ab00d84b2e399e1660b859bdb/external/llvm/8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz: Premature EOF and referenced by '//tensorflow/tools/pip_package:licenses' -- | -- 20-Apr-2018 11:43:32 | ERROR: Analysis of target '//tensorflow/tools/pip_package:build_pip_package' failed; build aborted: no such package '@llvm//': java.io.IOException: Error downloading [https://mirror.bazel.build/github.com/llvm-mirror/llvm/archive/8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz, https://github.com/llvm-mirror/llvm/archive/8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz] to /root/.cache/bazel/_bazel_root/0726af6ab00d84b2e399e1660b859bdb/external/llvm/8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz: Premature EOF\nI can use wget to fetch the tarball from the github source from within the Docker container without issues and the tarball opens without any errors reported.  The sha256 hash of the tarball is the same as what is specified in workspace.bzl:\nsha256sum 8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz  63d4da54dc7bc9a79e2ad266d230f4f759520cccb344a2dd49c2c6383ab75285  8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz\nSource code / logs\nTF-TFLOW-JOB1-170.log\nI have searched StackOverflow and github for the issue and found bazel LLVM errors, but nothing that would return \"Premature EOF\"", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\nPatches against tf dev tree\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\nUbuntu 14.04\r\n- **TensorFlow installed from (source or binary)**:\r\nSource \r\n- **TensorFlow version (use command below)**:\r\n1.6.0rc1 (last upstream commit 0abc4c9ecae912676f6070ca4b76b35c80351c26)\r\n- **Python version**: \r\nn/a\r\n- **Bazel version (if compiling from source)**:\r\n0.11.1\r\n- **GCC/Compiler version (if compiling from source)**:\r\ngcc (Ubuntu 4.8.4-2ubuntu1~14.04.3) 4.8.4\r\n- **CUDA/cuDNN version**:\r\nn/a\r\n- **GPU model and memory**:\r\nn/a\r\n- **Exact command to reproduce**:\r\nFrom the dockerfile:\r\n\r\n\r\n`\r\nENV GCC_HOST_COMPILER_PATH \"/usr/bin/gcc\"\r\nENV PYTHON_BIN_PATH \"/usr/bin/python3\"\r\nENV PYTHON_LIB_PATH \"/usr/lib/python3/dist-packages\"\r\nENV CC_OPT_FLAGS \"-march=native\"\r\n\r\nENV TF_NEED_GCP 0\r\nENV TF_NEED_GDR 0\r\nENV TF_NEED_HDFS 0\r\nENV TF_NEED_MKL 0\r\nENV TF_NEED_MPI 0\r\nENV TF_NEED_OPENCL 0\r\nENV TF_NEED_CUDA 0\r\nENV TF_ENABLE_XLA 1\r\nENV TF_NEED_JEMALLOC 1\r\nENV TF_NEED_VERBS 0\r\nENV TF_NEED_S3 0\r\n\r\nWORKDIR /tmp/tensorflow-knureon\r\n\r\nRUN ./configure \\\r\n\t&& bazel build --config=opt --config=kpi --copt=-mfma --copt=-mavx2 //tensorflow/tools/pip_package:build_pip_package \\\r\n\t&& bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg\r\n`\r\n\r\n\r\n### Describe the problem\r\nAbout 60% of the time I try from console and 100% of the time our CI system attempts to build TensorFlow, this error is observed, always related to the LLVM archive:\r\n\r\n`\r\n20-Apr-2018 11:43:32 | ERROR: /tmp/tensorflow-knureon/tensorflow/tools/pip_package/BUILD:85:1: no such package '@llvm//': java.io.IOException: Error downloading [https://mirror.bazel.build/github.com/llvm-mirror/llvm/archive/8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz, https://github.com/llvm-mirror/llvm/archive/8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz] to /root/.cache/bazel/_bazel_root/0726af6ab00d84b2e399e1660b859bdb/external/llvm/8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz: Premature EOF and referenced by '//tensorflow/tools/pip_package:licenses'\r\n-- | --\r\n20-Apr-2018 11:43:32 | ERROR: Analysis of target '//tensorflow/tools/pip_package:build_pip_package' failed; build aborted: no such package '@llvm//': java.io.IOException: Error downloading [https://mirror.bazel.build/github.com/llvm-mirror/llvm/archive/8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz, https://github.com/llvm-mirror/llvm/archive/8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz] to /root/.cache/bazel/_bazel_root/0726af6ab00d84b2e399e1660b859bdb/external/llvm/8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz: Premature EOF\r\n`\r\n\r\nI can use wget to fetch the tarball from the github source from within the Docker container without issues and the tarball opens without any errors reported.  The sha256 hash of the tarball is the same as what is specified in workspace.bzl:\r\n\r\n`\r\nsha256sum 8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz \r\n63d4da54dc7bc9a79e2ad266d230f4f759520cccb344a2dd49c2c6383ab75285  8f7bcdf3c65b9a47e35653d525135beb18f3ac25.tar.gz\r\n`\r\n\r\n### Source code / logs\r\n[TF-TFLOW-JOB1-170.log](https://github.com/tensorflow/tensorflow/files/1933283/TF-TFLOW-JOB1-170.log)\r\n\r\n\r\nI have searched StackOverflow and github for the issue and found bazel LLVM errors, but nothing that would return \"Premature EOF\""}