{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9734", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9734/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9734/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9734/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/9734", "id": 226827820, "node_id": "MDU6SXNzdWUyMjY4Mjc4MjA=", "number": 9734, "title": "`tf.while_loop` Bug", "user": {"login": "RuofanKong", "id": 7396554, "node_id": "MDQ6VXNlcjczOTY1NTQ=", "avatar_url": "https://avatars3.githubusercontent.com/u/7396554?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RuofanKong", "html_url": "https://github.com/RuofanKong", "followers_url": "https://api.github.com/users/RuofanKong/followers", "following_url": "https://api.github.com/users/RuofanKong/following{/other_user}", "gists_url": "https://api.github.com/users/RuofanKong/gists{/gist_id}", "starred_url": "https://api.github.com/users/RuofanKong/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RuofanKong/subscriptions", "organizations_url": "https://api.github.com/users/RuofanKong/orgs", "repos_url": "https://api.github.com/users/RuofanKong/repos", "events_url": "https://api.github.com/users/RuofanKong/events{/privacy}", "received_events_url": "https://api.github.com/users/RuofanKong/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-05-07T04:42:47Z", "updated_at": "2017-05-07T17:12:31Z", "closed_at": "2017-05-07T17:12:31Z", "author_association": "NONE", "body_html": "<p>I found that <code>tf.while_loop(cond...)</code> has issues on its termination condition which <code>cond</code> is set by using method <code>tf.logical_or(t1, t2)</code>. If one of conditions <code>t1</code> or <code>t2</code> is satisfied, then while loop should break. But I noticed this is not true. The following is the code for testing and reproducing:</p>\n<pre><code>import tensorflow as tf\n\n\ndef condition(i, val):\n    # Termination condition.\n    return tf.logical_or(tf.less(i, 10), tf.less(val, 1))\n\n\ndef body(i, val):\n    # Mimic the body loop.\n    i += 1\n    val -= 0.2\n    return i, val\n\n# Build up graph.\ni = tf.Variable(0, trainable=False)\nvalue = tf.Variable(0.0, trainable=False)\ntrain_ops = tf.while_loop(condition, body, [i, value])\ninit_op = tf.global_variables_initializer()\n\n# Run tf session.\nsess = tf.Session()\nsess.run(init_op)\nprint(sess.run(train_ops))\n</code></pre>\n<p>The code logic is quite simple: Inside the termination condition, either <code>i &gt;= 10</code> or <code>value &gt;= 1</code> is satisfied, the loop should be terminated. Since <code>i</code> increments by 1 each iteration with initial <code>0</code>, and second condition is always <code>True</code>, so it should terminate after the 10th iteration. However, if you run the above code, you could see the while loop goes infinity. I also tried other termination condition like <code>tf.logical_or(tf.less(i, 10), tf.less(val, -0.5))</code> and got the same result (but should terminate after the third iteration, in which <code>val</code> decreases by 0.2 each iteration). But if you try <code>cond</code> like<code>tf.logical_or(tf.less(i, 10), tf.less(val, -100))</code>, it would terminate at the 10th iteration which is also not expected, because <code>val</code> initially is 0, which is greater -100 at the beginning. This means that one of conditions for <code>tf.logical_or(t1, t2)</code> may have bugs when it works with <code>tf.while_loop()</code>.</p>\n<p>P.S The above code runs on MacOS 10.12.4 with Python 3.5, and the issue can be reproduced with Tensorflow 0.12/1.0/1.1</p>", "body_text": "I found that tf.while_loop(cond...) has issues on its termination condition which cond is set by using method tf.logical_or(t1, t2). If one of conditions t1 or t2 is satisfied, then while loop should break. But I noticed this is not true. The following is the code for testing and reproducing:\nimport tensorflow as tf\n\n\ndef condition(i, val):\n    # Termination condition.\n    return tf.logical_or(tf.less(i, 10), tf.less(val, 1))\n\n\ndef body(i, val):\n    # Mimic the body loop.\n    i += 1\n    val -= 0.2\n    return i, val\n\n# Build up graph.\ni = tf.Variable(0, trainable=False)\nvalue = tf.Variable(0.0, trainable=False)\ntrain_ops = tf.while_loop(condition, body, [i, value])\ninit_op = tf.global_variables_initializer()\n\n# Run tf session.\nsess = tf.Session()\nsess.run(init_op)\nprint(sess.run(train_ops))\n\nThe code logic is quite simple: Inside the termination condition, either i >= 10 or value >= 1 is satisfied, the loop should be terminated. Since i increments by 1 each iteration with initial 0, and second condition is always True, so it should terminate after the 10th iteration. However, if you run the above code, you could see the while loop goes infinity. I also tried other termination condition like tf.logical_or(tf.less(i, 10), tf.less(val, -0.5)) and got the same result (but should terminate after the third iteration, in which val decreases by 0.2 each iteration). But if you try cond liketf.logical_or(tf.less(i, 10), tf.less(val, -100)), it would terminate at the 10th iteration which is also not expected, because val initially is 0, which is greater -100 at the beginning. This means that one of conditions for tf.logical_or(t1, t2) may have bugs when it works with tf.while_loop().\nP.S The above code runs on MacOS 10.12.4 with Python 3.5, and the issue can be reproduced with Tensorflow 0.12/1.0/1.1", "body": "I found that `tf.while_loop(cond...)` has issues on its termination condition which `cond` is set by using method `tf.logical_or(t1, t2)`. If one of conditions `t1` or `t2` is satisfied, then while loop should break. But I noticed this is not true. The following is the code for testing and reproducing:\r\n\r\n```\r\nimport tensorflow as tf\r\n\r\n\r\ndef condition(i, val):\r\n    # Termination condition.\r\n    return tf.logical_or(tf.less(i, 10), tf.less(val, 1))\r\n\r\n\r\ndef body(i, val):\r\n    # Mimic the body loop.\r\n    i += 1\r\n    val -= 0.2\r\n    return i, val\r\n\r\n# Build up graph.\r\ni = tf.Variable(0, trainable=False)\r\nvalue = tf.Variable(0.0, trainable=False)\r\ntrain_ops = tf.while_loop(condition, body, [i, value])\r\ninit_op = tf.global_variables_initializer()\r\n\r\n# Run tf session.\r\nsess = tf.Session()\r\nsess.run(init_op)\r\nprint(sess.run(train_ops))\r\n```\r\nThe code logic is quite simple: Inside the termination condition, either `i >= 10` or `value >= 1` is satisfied, the loop should be terminated. Since `i` increments by 1 each iteration with initial `0`, and second condition is always `True`, so it should terminate after the 10th iteration. However, if you run the above code, you could see the while loop goes infinity. I also tried other termination condition like `tf.logical_or(tf.less(i, 10), tf.less(val, -0.5))` and got the same result (but should terminate after the third iteration, in which `val` decreases by 0.2 each iteration). But if you try `cond` like`tf.logical_or(tf.less(i, 10), tf.less(val, -100))`, it would terminate at the 10th iteration which is also not expected, because `val` initially is 0, which is greater -100 at the beginning. This means that one of conditions for `tf.logical_or(t1, t2)` may have bugs when it works with `tf.while_loop()`.\r\n\r\nP.S The above code runs on MacOS 10.12.4 with Python 3.5, and the issue can be reproduced with Tensorflow 0.12/1.0/1.1"}