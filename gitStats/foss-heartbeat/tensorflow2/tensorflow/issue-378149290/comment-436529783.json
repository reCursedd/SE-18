{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/436529783", "html_url": "https://github.com/tensorflow/tensorflow/issues/23576#issuecomment-436529783", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23576", "id": 436529783, "node_id": "MDEyOklzc3VlQ29tbWVudDQzNjUyOTc4Mw==", "user": {"login": "kamwoh", "id": 17477159, "node_id": "MDQ6VXNlcjE3NDc3MTU5", "avatar_url": "https://avatars0.githubusercontent.com/u/17477159?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kamwoh", "html_url": "https://github.com/kamwoh", "followers_url": "https://api.github.com/users/kamwoh/followers", "following_url": "https://api.github.com/users/kamwoh/following{/other_user}", "gists_url": "https://api.github.com/users/kamwoh/gists{/gist_id}", "starred_url": "https://api.github.com/users/kamwoh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kamwoh/subscriptions", "organizations_url": "https://api.github.com/users/kamwoh/orgs", "repos_url": "https://api.github.com/users/kamwoh/repos", "events_url": "https://api.github.com/users/kamwoh/events{/privacy}", "received_events_url": "https://api.github.com/users/kamwoh/received_events", "type": "User", "site_admin": false}, "created_at": "2018-11-07T07:28:08Z", "updated_at": "2018-11-07T07:46:12Z", "author_association": "NONE", "body_html": "<p>freeze graph: <a href=\"https://gist.github.com/omimo/5d393ed5b64d2ca0c591e4da04af6009\">https://gist.github.com/omimo/5d393ed5b64d2ca0c591e4da04af6009</a></p>\n<p>tflite: <a href=\"https://stackoverflow.com/questions/49474549/can-i-convert-the-tensorflow-inception-pb-model-to-tflite-model\" rel=\"nofollow\">https://stackoverflow.com/questions/49474549/can-i-convert-the-tensorflow-inception-pb-model-to-tflite-model</a></p>\n<p>then i come out with below code to save the graph in pb format, when i restore, the pb file works perfectly</p>\n<pre><code>with self.sess.as_default():\n\n            frozen_graph_def = tf.graph_util.convert_variables_to_constants(\n                self.sess,\n                self.graph.as_graph_def(),\n                ['output']\n            )\n\n            for node in frozen_graph_def.node:\n                print(type(node), node.name)\n            with open(filepath, 'wb') as f:\n                f.write(frozen_graph_def.SerializeToString())\n</code></pre>\n<p>however, when i convert to tflite, the error happens, the below code is my way to convert to tflite</p>\n<pre><code>import os\n\nimport tensorflow as tf\n\ngraph_def_file = \"frozen_graph.pb\"\ninput_arrays = [\"input\"]\noutput_arrays = [\"output\"]\noutput_name = '{}.tflite'.format(os.path.basename(graph_def_file).split('.')[0])\n\nconverter = tf.contrib.lite.TocoConverter.from_frozen_graph(\n  graph_def_file, input_arrays, output_arrays)\nconverter.allow_custom_ops = True\ntflite_model = converter.convert()\n\nopen(output_name, \"wb\").write(tflite_model)\n</code></pre>\n<p>I thought there is something wrong with the python code, so I try command as well</p>\n<pre><code>#!/usr/bin/env bash\n\ntoco --input_file=frozen_graph.pb \\\n--input_format=TENSORFLOW_GRAPHDEF \\\n--output_format=TFLITE \\\n--output_file=frozen_graph.tflite \\\n--inference_type=FLOAT \\\n--input_type=FLOAT \\\n--input_arrays='input' \\\n--output_arrays='output' \\\n--input_shapes=1,400,400,3\n</code></pre>\n<p>both way return the same error</p>", "body_text": "freeze graph: https://gist.github.com/omimo/5d393ed5b64d2ca0c591e4da04af6009\ntflite: https://stackoverflow.com/questions/49474549/can-i-convert-the-tensorflow-inception-pb-model-to-tflite-model\nthen i come out with below code to save the graph in pb format, when i restore, the pb file works perfectly\nwith self.sess.as_default():\n\n            frozen_graph_def = tf.graph_util.convert_variables_to_constants(\n                self.sess,\n                self.graph.as_graph_def(),\n                ['output']\n            )\n\n            for node in frozen_graph_def.node:\n                print(type(node), node.name)\n            with open(filepath, 'wb') as f:\n                f.write(frozen_graph_def.SerializeToString())\n\nhowever, when i convert to tflite, the error happens, the below code is my way to convert to tflite\nimport os\n\nimport tensorflow as tf\n\ngraph_def_file = \"frozen_graph.pb\"\ninput_arrays = [\"input\"]\noutput_arrays = [\"output\"]\noutput_name = '{}.tflite'.format(os.path.basename(graph_def_file).split('.')[0])\n\nconverter = tf.contrib.lite.TocoConverter.from_frozen_graph(\n  graph_def_file, input_arrays, output_arrays)\nconverter.allow_custom_ops = True\ntflite_model = converter.convert()\n\nopen(output_name, \"wb\").write(tflite_model)\n\nI thought there is something wrong with the python code, so I try command as well\n#!/usr/bin/env bash\n\ntoco --input_file=frozen_graph.pb \\\n--input_format=TENSORFLOW_GRAPHDEF \\\n--output_format=TFLITE \\\n--output_file=frozen_graph.tflite \\\n--inference_type=FLOAT \\\n--input_type=FLOAT \\\n--input_arrays='input' \\\n--output_arrays='output' \\\n--input_shapes=1,400,400,3\n\nboth way return the same error", "body": "freeze graph: https://gist.github.com/omimo/5d393ed5b64d2ca0c591e4da04af6009\r\n\r\ntflite: https://stackoverflow.com/questions/49474549/can-i-convert-the-tensorflow-inception-pb-model-to-tflite-model\r\n\r\nthen i come out with below code to save the graph in pb format, when i restore, the pb file works perfectly\r\n```\r\nwith self.sess.as_default():\r\n\r\n            frozen_graph_def = tf.graph_util.convert_variables_to_constants(\r\n                self.sess,\r\n                self.graph.as_graph_def(),\r\n                ['output']\r\n            )\r\n\r\n            for node in frozen_graph_def.node:\r\n                print(type(node), node.name)\r\n            with open(filepath, 'wb') as f:\r\n                f.write(frozen_graph_def.SerializeToString())\r\n```\r\n\r\nhowever, when i convert to tflite, the error happens, the below code is my way to convert to tflite\r\n\r\n```\r\nimport os\r\n\r\nimport tensorflow as tf\r\n\r\ngraph_def_file = \"frozen_graph.pb\"\r\ninput_arrays = [\"input\"]\r\noutput_arrays = [\"output\"]\r\noutput_name = '{}.tflite'.format(os.path.basename(graph_def_file).split('.')[0])\r\n\r\nconverter = tf.contrib.lite.TocoConverter.from_frozen_graph(\r\n  graph_def_file, input_arrays, output_arrays)\r\nconverter.allow_custom_ops = True\r\ntflite_model = converter.convert()\r\n\r\nopen(output_name, \"wb\").write(tflite_model)\r\n```\r\nI thought there is something wrong with the python code, so I try command as well\r\n```\r\n#!/usr/bin/env bash\r\n\r\ntoco --input_file=frozen_graph.pb \\\r\n--input_format=TENSORFLOW_GRAPHDEF \\\r\n--output_format=TFLITE \\\r\n--output_file=frozen_graph.tflite \\\r\n--inference_type=FLOAT \\\r\n--input_type=FLOAT \\\r\n--input_arrays='input' \\\r\n--output_arrays='output' \\\r\n--input_shapes=1,400,400,3\r\n```\r\n\r\nboth way return the same error"}