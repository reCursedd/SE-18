{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/172739411", "pull_request_review_id": 101806360, "id": 172739411, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3MjczOTQxMQ==", "diff_hunk": "@@ -1084,6 +1084,76 @@ def testGLSTMCell(self):\n                             h_res, 1e-5)\n \n \n+class LayerNormBasicGRUCellTest(test.TestCase):\n+\n+  # NOTE: all the values in the current test case have been calculated.\n+\n+  def testMultiCellLayerNormBasicGRUCell(self):\n+    with self.test_session() as sess:\n+      with variable_scope.variable_scope(\"root\", initializer=init_ops.Identity()):\n+        x = array_ops.zeros([1, 3])\n+        h0 = array_ops.zeros([1, 3])\n+        h1 = array_ops.zeros([1, 3])\n+        state = (h0, h1)\n+        single_cell = lambda: contrib_rnn_cell.LayerNormBasicGRUCell(3)\n+        cell = rnn_cell.MultiRNNCell([single_cell() for _ in range(2)], state_is_tuple=True)\n+\n+        g, out_m = cell(x, state)\n+        sess.run([variables.global_variables_initializer()])\n+        res = sess.run([g, out_m], {\n+          x.name: np.array([[0, 1, 2]]),\n+          h0.name: 0.1 * np.asarray([[3, 4, 5]]),\n+          h1.name: 0.1 * np.asarray([[6, 7, 8]])\n+        })\n+\n+        expected_state0 = np.array([[0.0261896, 0.2, 0.8666091]])\n+        expected_state1 = np.array([[0.18898079, 0.26299422, 0.94606379]])\n+\n+        actual_h = res[0]\n+        actual_state0 = res[1][0]\n+        actual_state1 = res[1][1]\n+\n+        self.assertAllClose(expected_state1, actual_h, 1e-5)\n+        self.assertAllClose(expected_state0, actual_state0, 1e-5)\n+        self.assertAllClose(expected_state1, actual_state1, 1e-5)\n+\n+  def testLayerNormBasicGRUCellWithInputSizeDifferentThanNbUnits(self):\n+    with self.test_session() as sess:\n+      with variable_scope.variable_scope(\"root\", initializer=init_ops.Identity()):\n+        x = array_ops.zeros(\n+          [1, 3])\n+        h = array_ops.zeros([1, 2])\n+        cell = contrib_rnn_cell.LayerNormBasicGRUCell(2)\n+        g, out_m = cell(x, h)\n+        sess.run([variables.global_variables_initializer()])\n+        res = sess.run([g, out_m], {\n+          x.name: np.array([[1., 2., 3.]]),\n+          h.name: 0.1 * np.asarray([[4, 5]]),\n+        })\n+\n+        expected_h = np.array([[0.06287911, 0.82106697]])\n+        self.assertEqual(len(res), 2)\n+        self.assertAllClose(res[1], expected_h, 1e-5)\n+\n+  def testLayerNormBasicGRUCellWithoutLayerNorm(self):\n+    with self.test_session() as sess:\n+      with variable_scope.variable_scope(\"root\", initializer=init_ops.constant_initializer(0.5)):\n+        x = array_ops.zeros(\n+          [1, 3])\n+        h = array_ops.zeros([1, 3])\n+        cell = contrib_rnn_cell.LayerNormBasicGRUCell(3, layer_norm=False)\n+        g, out_m = cell(x, h)\n+        sess.run([variables.global_variables_initializer()])\n+        res = sess.run([g, out_m], {\n+          x.name: np.array([[1., 2., 3.]]),\n+          h.name: 0.1 * np.asarray([[4, 5, 6]]),\n+        })\n+\n+        expected_h = np.array([[0.99140896, 0.99281532, 0.99422168]])\n+        self.assertEqual(len(res), 2)\n+        self.assertAllClose(res[1], expected_h, 1e-5)", "path": "tensorflow/contrib/rnn/python/kernel_tests/rnn_cell_test.py", "position": null, "original_position": 71, "commit_id": "249443a3e718ca5367aac1a2f34b1ba42a79e195", "original_commit_id": "134510d9d80fbb7bb62b24f310c05573bd8fc642", "user": {"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}, "body": "ditto", "created_at": "2018-03-07T04:36:24Z", "updated_at": "2018-09-10T15:16:01Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/14578#discussion_r172739411", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/14578", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/172739411"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/14578#discussion_r172739411"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/14578"}}, "body_html": "<p>ditto</p>", "body_text": "ditto"}