{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19316", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19316/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19316/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19316/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/19316", "id": 323500300, "node_id": "MDU6SXNzdWUzMjM1MDAzMDA=", "number": 19316, "title": "[TF-Lite] densenet.pb at /contrib/lite/g3doc/models.md cannot be loaded", "user": {"login": "HwMohanLiu", "id": 34759453, "node_id": "MDQ6VXNlcjM0NzU5NDUz", "avatar_url": "https://avatars3.githubusercontent.com/u/34759453?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HwMohanLiu", "html_url": "https://github.com/HwMohanLiu", "followers_url": "https://api.github.com/users/HwMohanLiu/followers", "following_url": "https://api.github.com/users/HwMohanLiu/following{/other_user}", "gists_url": "https://api.github.com/users/HwMohanLiu/gists{/gist_id}", "starred_url": "https://api.github.com/users/HwMohanLiu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HwMohanLiu/subscriptions", "organizations_url": "https://api.github.com/users/HwMohanLiu/orgs", "repos_url": "https://api.github.com/users/HwMohanLiu/repos", "events_url": "https://api.github.com/users/HwMohanLiu/events{/privacy}", "received_events_url": "https://api.github.com/users/HwMohanLiu/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "jart", "id": 49262, "node_id": "MDQ6VXNlcjQ5MjYy", "avatar_url": "https://avatars1.githubusercontent.com/u/49262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jart", "html_url": "https://github.com/jart", "followers_url": "https://api.github.com/users/jart/followers", "following_url": "https://api.github.com/users/jart/following{/other_user}", "gists_url": "https://api.github.com/users/jart/gists{/gist_id}", "starred_url": "https://api.github.com/users/jart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jart/subscriptions", "organizations_url": "https://api.github.com/users/jart/orgs", "repos_url": "https://api.github.com/users/jart/repos", "events_url": "https://api.github.com/users/jart/events{/privacy}", "received_events_url": "https://api.github.com/users/jart/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jart", "id": 49262, "node_id": "MDQ6VXNlcjQ5MjYy", "avatar_url": "https://avatars1.githubusercontent.com/u/49262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jart", "html_url": "https://github.com/jart", "followers_url": "https://api.github.com/users/jart/followers", "following_url": "https://api.github.com/users/jart/following{/other_user}", "gists_url": "https://api.github.com/users/jart/gists{/gist_id}", "starred_url": "https://api.github.com/users/jart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jart/subscriptions", "organizations_url": "https://api.github.com/users/jart/orgs", "repos_url": "https://api.github.com/users/jart/repos", "events_url": "https://api.github.com/users/jart/events{/privacy}", "received_events_url": "https://api.github.com/users/jart/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2018-05-16T07:31:40Z", "updated_at": "2018-05-18T19:49:04Z", "closed_at": "2018-05-17T02:45:42Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: No</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Ubuntu 16.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: source</li>\n<li><strong>TensorFlow version (use command below)</strong>: r1.8</li>\n<li><strong>Python version</strong>:  2.7</li>\n<li><strong>Bazel version (if compiling from source)</strong>: 0.11.0</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: 4.9</li>\n<li><strong>CUDA/cuDNN version</strong>: no</li>\n<li><strong>GPU model and memory</strong>: no</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>The densenet.pb provided at <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/lite/g3doc/models.md\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/lite/g3doc/models.md</a><br>\ncannot be converted by toco command line. It can also not be loaded by GFile API.</p>\n<h3>Source code / logs</h3>\n<blockquote>\n<p>bazel-bin/tensorflow/contrib/lite/toco/toco <br>\n--input_file=\"densenet.pb\" <br>\n--output_file=\"quant_densenet.tflite\" <br>\n--input_format=TENSORFLOW_GRAPHDEF <br>\n--output_format=TFLITE <br>\n--inference_input_type=QUANTIZED_UINT8 <br>\n--inference_type=QUANTIZED_UINT8 <br>\n--input_shape=1,224,224,3 <br>\n--input_array=\"input\" <br>\n--output_array=\"final_dense\" <br>\n--allow_custom_ops <br>\n--default_ranges_min=0.0 <br>\n--default_ranges_max=6.0 <br>\n--mean_value=127.5 <br>\n--std_value=1.0</p>\n</blockquote>\n<blockquote>\n<p>[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/text_format.cc:288] Error parsing text-format tensorflow.GraphDef: 1:1: Invalid control characters encountered in text.<br>\n[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/text_format.cc:288] Error parsing text-format tensorflow.GraphDef: 1:2: Interpreting non ascii codepoint 139.<br>\n[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/text_format.cc:288] Error parsing text-format tensorflow.GraphDef: 1:2: Expected identifier, got: \u2039<br>\n2018-05-16 15:19:01.232421: F tensorflow/contrib/lite/toco/import_tensorflow.cc:2230] Check failed: ParseFromStringEitherTextOrBinary(input_file_contents, tf_graph.get())<br>\nAborted (core dumped)</p>\n</blockquote>\n<p>if using GFile python API to load the pb file:</p>\n<pre><code>def load_pb_graph(frozen_graph_file):\n    with tf.gfile.GFile(frozen_graph_file, 'rb') as f:\n        graph_def = tf.GraphDef()\n        graph_def.ParseFromString(f.read())\n    with tf.Graph().as_default() as graph:\n        tf.import_graph_def(graph_def, name=\"prefix\")\n\n    return graph, graph_def\n</code></pre>\n<blockquote>\n<p>Traceback (most recent call last):<br>\nFile \"GraphCheckerPB.py\", line 24, in <br>\ngraph, graph_def = load_pb_graph(in_pb_file)<br>\nFile \"GraphCheckerPB.py\", line 14, in load_pb_graph<br>\ngraph_def.ParseFromString(f.read())<br>\ngoogle.protobuf.message.DecodeError: Error parsing message</p>\n</blockquote>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): No\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Ubuntu 16.04\nTensorFlow installed from (source or binary): source\nTensorFlow version (use command below): r1.8\nPython version:  2.7\nBazel version (if compiling from source): 0.11.0\nGCC/Compiler version (if compiling from source): 4.9\nCUDA/cuDNN version: no\nGPU model and memory: no\nExact command to reproduce:\n\nDescribe the problem\nThe densenet.pb provided at https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/lite/g3doc/models.md\ncannot be converted by toco command line. It can also not be loaded by GFile API.\nSource code / logs\n\nbazel-bin/tensorflow/contrib/lite/toco/toco \n--input_file=\"densenet.pb\" \n--output_file=\"quant_densenet.tflite\" \n--input_format=TENSORFLOW_GRAPHDEF \n--output_format=TFLITE \n--inference_input_type=QUANTIZED_UINT8 \n--inference_type=QUANTIZED_UINT8 \n--input_shape=1,224,224,3 \n--input_array=\"input\" \n--output_array=\"final_dense\" \n--allow_custom_ops \n--default_ranges_min=0.0 \n--default_ranges_max=6.0 \n--mean_value=127.5 \n--std_value=1.0\n\n\n[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/text_format.cc:288] Error parsing text-format tensorflow.GraphDef: 1:1: Invalid control characters encountered in text.\n[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/text_format.cc:288] Error parsing text-format tensorflow.GraphDef: 1:2: Interpreting non ascii codepoint 139.\n[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/text_format.cc:288] Error parsing text-format tensorflow.GraphDef: 1:2: Expected identifier, got: \u2039\n2018-05-16 15:19:01.232421: F tensorflow/contrib/lite/toco/import_tensorflow.cc:2230] Check failed: ParseFromStringEitherTextOrBinary(input_file_contents, tf_graph.get())\nAborted (core dumped)\n\nif using GFile python API to load the pb file:\ndef load_pb_graph(frozen_graph_file):\n    with tf.gfile.GFile(frozen_graph_file, 'rb') as f:\n        graph_def = tf.GraphDef()\n        graph_def.ParseFromString(f.read())\n    with tf.Graph().as_default() as graph:\n        tf.import_graph_def(graph_def, name=\"prefix\")\n\n    return graph, graph_def\n\n\nTraceback (most recent call last):\nFile \"GraphCheckerPB.py\", line 24, in \ngraph, graph_def = load_pb_graph(in_pb_file)\nFile \"GraphCheckerPB.py\", line 14, in load_pb_graph\ngraph_def.ParseFromString(f.read())\ngoogle.protobuf.message.DecodeError: Error parsing message", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Ubuntu 16.04\r\n- **TensorFlow installed from (source or binary)**: source\r\n- **TensorFlow version (use command below)**: r1.8\r\n- **Python version**:  2.7\r\n- **Bazel version (if compiling from source)**: 0.11.0\r\n- **GCC/Compiler version (if compiling from source)**: 4.9\r\n- **CUDA/cuDNN version**: no\r\n- **GPU model and memory**: no\r\n- **Exact command to reproduce**: \r\n\r\n### Describe the problem\r\nThe densenet.pb provided at https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/lite/g3doc/models.md\r\ncannot be converted by toco command line. It can also not be loaded by GFile API.\r\n\r\n### Source code / logs\r\n> bazel-bin/tensorflow/contrib/lite/toco/toco \\\r\n--input_file=\"densenet.pb\" \\\r\n--output_file=\"quant_densenet.tflite\" \\\r\n--input_format=TENSORFLOW_GRAPHDEF \\\r\n--output_format=TFLITE \\\r\n--inference_input_type=QUANTIZED_UINT8 \\\r\n--inference_type=QUANTIZED_UINT8 \\\r\n--input_shape=1,224,224,3 \\\r\n--input_array=\"input\" \\\r\n--output_array=\"final_dense\" \\\r\n--allow_custom_ops \\\r\n--default_ranges_min=0.0 \\\r\n--default_ranges_max=6.0 \\\r\n--mean_value=127.5 \\\r\n--std_value=1.0 \r\n\r\n>[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/text_format.cc:288] Error parsing text-format tensorflow.GraphDef: 1:1: Invalid control characters encountered in text.\r\n>[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/text_format.cc:288] Error parsing text-format tensorflow.GraphDef: 1:2: Interpreting non ascii codepoint 139.\r\n>[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/text_format.cc:288] Error parsing text-format tensorflow.GraphDef: 1:2: Expected identifier, got: \u2039\r\n>2018-05-16 15:19:01.232421: F tensorflow/contrib/lite/toco/import_tensorflow.cc:2230] Check failed: ParseFromStringEitherTextOrBinary(input_file_contents, tf_graph.get())\r\nAborted (core dumped)\r\n\r\nif using GFile python API to load the pb file:\r\n\r\n```\r\ndef load_pb_graph(frozen_graph_file):\r\n    with tf.gfile.GFile(frozen_graph_file, 'rb') as f:\r\n        graph_def = tf.GraphDef()\r\n        graph_def.ParseFromString(f.read())\r\n    with tf.Graph().as_default() as graph:\r\n        tf.import_graph_def(graph_def, name=\"prefix\")\r\n\r\n    return graph, graph_def\r\n```\r\n\r\n>Traceback (most recent call last):\r\n  File \"GraphCheckerPB.py\", line 24, in <module>\r\n    graph, graph_def = load_pb_graph(in_pb_file)\r\n  File \"GraphCheckerPB.py\", line 14, in load_pb_graph\r\n    graph_def.ParseFromString(f.read())\r\ngoogle.protobuf.message.DecodeError: Error parsing message\r\n\r\n"}