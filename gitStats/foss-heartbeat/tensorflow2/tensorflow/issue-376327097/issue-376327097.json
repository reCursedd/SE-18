{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23425", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23425/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23425/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23425/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23425", "id": 376327097, "node_id": "MDU6SXNzdWUzNzYzMjcwOTc=", "number": 23425, "title": "NameError name 'uses_learning_phase' is not defined when using Keras TimeDistributed with batch_shape on Input", "user": {"login": "rickdzekman", "id": 5784312, "node_id": "MDQ6VXNlcjU3ODQzMTI=", "avatar_url": "https://avatars2.githubusercontent.com/u/5784312?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rickdzekman", "html_url": "https://github.com/rickdzekman", "followers_url": "https://api.github.com/users/rickdzekman/followers", "following_url": "https://api.github.com/users/rickdzekman/following{/other_user}", "gists_url": "https://api.github.com/users/rickdzekman/gists{/gist_id}", "starred_url": "https://api.github.com/users/rickdzekman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rickdzekman/subscriptions", "organizations_url": "https://api.github.com/users/rickdzekman/orgs", "repos_url": "https://api.github.com/users/rickdzekman/repos", "events_url": "https://api.github.com/users/rickdzekman/events{/privacy}", "received_events_url": "https://api.github.com/users/rickdzekman/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": {"login": "harshini-gadige", "id": 42781361, "node_id": "MDQ6VXNlcjQyNzgxMzYx", "avatar_url": "https://avatars1.githubusercontent.com/u/42781361?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harshini-gadige", "html_url": "https://github.com/harshini-gadige", "followers_url": "https://api.github.com/users/harshini-gadige/followers", "following_url": "https://api.github.com/users/harshini-gadige/following{/other_user}", "gists_url": "https://api.github.com/users/harshini-gadige/gists{/gist_id}", "starred_url": "https://api.github.com/users/harshini-gadige/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harshini-gadige/subscriptions", "organizations_url": "https://api.github.com/users/harshini-gadige/orgs", "repos_url": "https://api.github.com/users/harshini-gadige/repos", "events_url": "https://api.github.com/users/harshini-gadige/events{/privacy}", "received_events_url": "https://api.github.com/users/harshini-gadige/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "harshini-gadige", "id": 42781361, "node_id": "MDQ6VXNlcjQyNzgxMzYx", "avatar_url": "https://avatars1.githubusercontent.com/u/42781361?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harshini-gadige", "html_url": "https://github.com/harshini-gadige", "followers_url": "https://api.github.com/users/harshini-gadige/followers", "following_url": "https://api.github.com/users/harshini-gadige/following{/other_user}", "gists_url": "https://api.github.com/users/harshini-gadige/gists{/gist_id}", "starred_url": "https://api.github.com/users/harshini-gadige/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harshini-gadige/subscriptions", "organizations_url": "https://api.github.com/users/harshini-gadige/orgs", "repos_url": "https://api.github.com/users/harshini-gadige/repos", "events_url": "https://api.github.com/users/harshini-gadige/events{/privacy}", "received_events_url": "https://api.github.com/users/harshini-gadige/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2018-11-01T10:02:24Z", "updated_at": "2018-11-20T07:43:46Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>I have an LSTM layer where I am using <code>stateful=True</code>. As a result I need to specify <code>batch_shape</code> on my <code>Input</code> layers:</p>\n<pre><code>input_xs = tf.keras.layers.Input(batch_shape=(batch_size,seq_length))\n</code></pre>\n<p>I have a layer where I add a context vector to each input <em>at each timestep</em>. I currently achieve this with <code>TimeDistributed</code> and a <code>Lambda</code> layer as follows:</p>\n<pre><code>concatenator = tf.keras.layers.TimeDistributed(tf.keras.layers.Lambda(lambda x: tf.keras.layers.Concatenate()([x,concat_context])))\n</code></pre>\n<p>But the moment I added the <code>batch_shape</code> to my inputs I started getting the following error:</p>\n<pre><code>  File \"C:\\Program Files\\Python35\\lib\\site-packages\\tensorflow\\python\\keras\\engine\\base_layer.py\", line 769, in __call__\n    outputs = self.call(inputs, *args, **kwargs)\n  File \"C:\\Program Files\\Python35\\lib\\site-packages\\tensorflow\\python\\keras\\layers\\wrappers.py\", line 250, in call\n    unroll=False)\n  File \"C:\\Program Files\\Python35\\lib\\site-packages\\tensorflow\\python\\keras\\backend.py\", line 3193, in rnn\n    outputs, _ = step_function(inputs[0], initial_states + constants)\n  File \"C:\\Program Files\\Python35\\lib\\site-packages\\tensorflow\\python\\keras\\layers\\wrappers.py\", line 242, in step\n    uses_learning_phase)\nNameError: name 'uses_learning_phase' is not defined\n</code></pre>\n<p>This seems related to: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"185041391\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/keras-team/keras/issues/4178\" data-hovercard-type=\"issue\" data-hovercard-url=\"/keras-team/keras/issues/4178/hovercard\" href=\"https://github.com/keras-team/keras/issues/4178\">keras-team/keras#4178</a></p>\n<p>Would appreciate any thoughts on what is happening here.</p>", "body_text": "I have an LSTM layer where I am using stateful=True. As a result I need to specify batch_shape on my Input layers:\ninput_xs = tf.keras.layers.Input(batch_shape=(batch_size,seq_length))\n\nI have a layer where I add a context vector to each input at each timestep. I currently achieve this with TimeDistributed and a Lambda layer as follows:\nconcatenator = tf.keras.layers.TimeDistributed(tf.keras.layers.Lambda(lambda x: tf.keras.layers.Concatenate()([x,concat_context])))\n\nBut the moment I added the batch_shape to my inputs I started getting the following error:\n  File \"C:\\Program Files\\Python35\\lib\\site-packages\\tensorflow\\python\\keras\\engine\\base_layer.py\", line 769, in __call__\n    outputs = self.call(inputs, *args, **kwargs)\n  File \"C:\\Program Files\\Python35\\lib\\site-packages\\tensorflow\\python\\keras\\layers\\wrappers.py\", line 250, in call\n    unroll=False)\n  File \"C:\\Program Files\\Python35\\lib\\site-packages\\tensorflow\\python\\keras\\backend.py\", line 3193, in rnn\n    outputs, _ = step_function(inputs[0], initial_states + constants)\n  File \"C:\\Program Files\\Python35\\lib\\site-packages\\tensorflow\\python\\keras\\layers\\wrappers.py\", line 242, in step\n    uses_learning_phase)\nNameError: name 'uses_learning_phase' is not defined\n\nThis seems related to: keras-team/keras#4178\nWould appreciate any thoughts on what is happening here.", "body": "I have an LSTM layer where I am using `stateful=True`. As a result I need to specify `batch_shape` on my `Input` layers:\r\n\r\n    input_xs = tf.keras.layers.Input(batch_shape=(batch_size,seq_length))\r\n\r\nI have a layer where I add a context vector to each input *at each timestep*. I currently achieve this with `TimeDistributed` and a `Lambda` layer as follows:\r\n\r\n    concatenator = tf.keras.layers.TimeDistributed(tf.keras.layers.Lambda(lambda x: tf.keras.layers.Concatenate()([x,concat_context])))\r\n\r\nBut the moment I added the `batch_shape` to my inputs I started getting the following error:\r\n\r\n```\r\n  File \"C:\\Program Files\\Python35\\lib\\site-packages\\tensorflow\\python\\keras\\engine\\base_layer.py\", line 769, in __call__\r\n    outputs = self.call(inputs, *args, **kwargs)\r\n  File \"C:\\Program Files\\Python35\\lib\\site-packages\\tensorflow\\python\\keras\\layers\\wrappers.py\", line 250, in call\r\n    unroll=False)\r\n  File \"C:\\Program Files\\Python35\\lib\\site-packages\\tensorflow\\python\\keras\\backend.py\", line 3193, in rnn\r\n    outputs, _ = step_function(inputs[0], initial_states + constants)\r\n  File \"C:\\Program Files\\Python35\\lib\\site-packages\\tensorflow\\python\\keras\\layers\\wrappers.py\", line 242, in step\r\n    uses_learning_phase)\r\nNameError: name 'uses_learning_phase' is not defined\r\n```\r\n\r\nThis seems related to: https://github.com/keras-team/keras/issues/4178\r\n\r\nWould appreciate any thoughts on what is happening here."}