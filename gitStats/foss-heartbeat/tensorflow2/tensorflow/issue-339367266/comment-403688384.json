{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/403688384", "html_url": "https://github.com/tensorflow/tensorflow/issues/20642#issuecomment-403688384", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20642", "id": 403688384, "node_id": "MDEyOklzc3VlQ29tbWVudDQwMzY4ODM4NA==", "user": {"login": "fengyang0317", "id": 7965501, "node_id": "MDQ6VXNlcjc5NjU1MDE=", "avatar_url": "https://avatars3.githubusercontent.com/u/7965501?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fengyang0317", "html_url": "https://github.com/fengyang0317", "followers_url": "https://api.github.com/users/fengyang0317/followers", "following_url": "https://api.github.com/users/fengyang0317/following{/other_user}", "gists_url": "https://api.github.com/users/fengyang0317/gists{/gist_id}", "starred_url": "https://api.github.com/users/fengyang0317/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fengyang0317/subscriptions", "organizations_url": "https://api.github.com/users/fengyang0317/orgs", "repos_url": "https://api.github.com/users/fengyang0317/repos", "events_url": "https://api.github.com/users/fengyang0317/events{/privacy}", "received_events_url": "https://api.github.com/users/fengyang0317/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-10T03:29:03Z", "updated_at": "2018-07-10T03:30:54Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=15220929\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/tanzhenyu\">@tanzhenyu</a></p>\n<pre><code>import tensorflow as tf\nimport numpy as np\n\n\ndef model_fn(features, labels, mode, params):\n\n  def init_fn(scaffold, session):\n    pass\n\n  scaffold = tf.train.Scaffold(init_fn=init_fn)\n  return tf.estimator.EstimatorSpec(\n    mode=mode,\n    loss=labels[0],\n    train_op=tf.no_op(),\n    scaffold=scaffold\n  )\n\n\ndef input_fn():\n  dataset = tf.data.Dataset.from_tensors((np.zeros(10), np.zeros(1)))\n  dataset = dataset.repeat()\n  return dataset\n\n\ndef main(_):\n  distribution_strategy = tf.contrib.distribute.OneDeviceStrategy(\n    \"device:GPU:0\")\n\n  run_config = tf.estimator.RunConfig(train_distribute=distribution_strategy)\n\n  estimator = tf.estimator.Estimator(\n    model_fn=model_fn,\n    config=run_config\n  )\n\n  estimator.train(input_fn=input_fn, steps=10)\n\n\nif __name__ == '__main__':\n  tf.app.run()\n</code></pre>\n<p>I got the following error when running the above program.</p>\n<pre><code>Traceback (most recent call last):\n  File \"/home/yfeng23/test/tf/init_fn_test.py\", line 40, in &lt;module&gt;\n    tf.app.run()\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 126, in run\n    _sys.exit(main(argv))\n  File \"/home/yfeng23/test/tf/init_fn_test.py\", line 36, in main\n    estimator.train(input_fn=input_fn, steps=10)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 363, in train\n    loss = self._train_model(input_fn, hooks, saving_listeners)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 841, in _train_model\n    return self._train_model_distributed(input_fn, hooks, saving_listeners)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 978, in _train_model_distributed\n    saving_listeners)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 1057, in _train_with_estimator_spec\n    log_step_count_steps=self._config.log_step_count_steps) as mon_sess:\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 405, in MonitoredTrainingSession\n    stop_grace_period_secs=stop_grace_period_secs)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 816, in __init__\n    stop_grace_period_secs=stop_grace_period_secs)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 539, in __init__\n    self._sess = _RecoverableSession(self._coordinated_creator)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 1002, in __init__\n    _WrappedSession.__init__(self, self._create_session())\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 1007, in _create_session\n    return self._sess_creator.create_session()\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 696, in create_session\n    self.tf_sess = self._session_creator.create_session()\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 467, in create_session\n    init_fn=self._scaffold.init_fn)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/session_manager.py\", line 287, in prepare_session\n    init_fn(sess)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 163, in &lt;lambda&gt;\n    self._init_fn = lambda sess: init_fn(self, sess)\nTypeError: &lt;lambda&gt;() takes exactly 1 argument (2 given)\n</code></pre>", "body_text": "@tanzhenyu\nimport tensorflow as tf\nimport numpy as np\n\n\ndef model_fn(features, labels, mode, params):\n\n  def init_fn(scaffold, session):\n    pass\n\n  scaffold = tf.train.Scaffold(init_fn=init_fn)\n  return tf.estimator.EstimatorSpec(\n    mode=mode,\n    loss=labels[0],\n    train_op=tf.no_op(),\n    scaffold=scaffold\n  )\n\n\ndef input_fn():\n  dataset = tf.data.Dataset.from_tensors((np.zeros(10), np.zeros(1)))\n  dataset = dataset.repeat()\n  return dataset\n\n\ndef main(_):\n  distribution_strategy = tf.contrib.distribute.OneDeviceStrategy(\n    \"device:GPU:0\")\n\n  run_config = tf.estimator.RunConfig(train_distribute=distribution_strategy)\n\n  estimator = tf.estimator.Estimator(\n    model_fn=model_fn,\n    config=run_config\n  )\n\n  estimator.train(input_fn=input_fn, steps=10)\n\n\nif __name__ == '__main__':\n  tf.app.run()\n\nI got the following error when running the above program.\nTraceback (most recent call last):\n  File \"/home/yfeng23/test/tf/init_fn_test.py\", line 40, in <module>\n    tf.app.run()\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 126, in run\n    _sys.exit(main(argv))\n  File \"/home/yfeng23/test/tf/init_fn_test.py\", line 36, in main\n    estimator.train(input_fn=input_fn, steps=10)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 363, in train\n    loss = self._train_model(input_fn, hooks, saving_listeners)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 841, in _train_model\n    return self._train_model_distributed(input_fn, hooks, saving_listeners)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 978, in _train_model_distributed\n    saving_listeners)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 1057, in _train_with_estimator_spec\n    log_step_count_steps=self._config.log_step_count_steps) as mon_sess:\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 405, in MonitoredTrainingSession\n    stop_grace_period_secs=stop_grace_period_secs)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 816, in __init__\n    stop_grace_period_secs=stop_grace_period_secs)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 539, in __init__\n    self._sess = _RecoverableSession(self._coordinated_creator)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 1002, in __init__\n    _WrappedSession.__init__(self, self._create_session())\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 1007, in _create_session\n    return self._sess_creator.create_session()\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 696, in create_session\n    self.tf_sess = self._session_creator.create_session()\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 467, in create_session\n    init_fn=self._scaffold.init_fn)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/session_manager.py\", line 287, in prepare_session\n    init_fn(sess)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 163, in <lambda>\n    self._init_fn = lambda sess: init_fn(self, sess)\nTypeError: <lambda>() takes exactly 1 argument (2 given)", "body": "@tanzhenyu \r\n```\r\nimport tensorflow as tf\r\nimport numpy as np\r\n\r\n\r\ndef model_fn(features, labels, mode, params):\r\n\r\n  def init_fn(scaffold, session):\r\n    pass\r\n\r\n  scaffold = tf.train.Scaffold(init_fn=init_fn)\r\n  return tf.estimator.EstimatorSpec(\r\n    mode=mode,\r\n    loss=labels[0],\r\n    train_op=tf.no_op(),\r\n    scaffold=scaffold\r\n  )\r\n\r\n\r\ndef input_fn():\r\n  dataset = tf.data.Dataset.from_tensors((np.zeros(10), np.zeros(1)))\r\n  dataset = dataset.repeat()\r\n  return dataset\r\n\r\n\r\ndef main(_):\r\n  distribution_strategy = tf.contrib.distribute.OneDeviceStrategy(\r\n    \"device:GPU:0\")\r\n\r\n  run_config = tf.estimator.RunConfig(train_distribute=distribution_strategy)\r\n\r\n  estimator = tf.estimator.Estimator(\r\n    model_fn=model_fn,\r\n    config=run_config\r\n  )\r\n\r\n  estimator.train(input_fn=input_fn, steps=10)\r\n\r\n\r\nif __name__ == '__main__':\r\n  tf.app.run()\r\n```\r\n\r\nI got the following error when running the above program.\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/yfeng23/test/tf/init_fn_test.py\", line 40, in <module>\r\n    tf.app.run()\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 126, in run\r\n    _sys.exit(main(argv))\r\n  File \"/home/yfeng23/test/tf/init_fn_test.py\", line 36, in main\r\n    estimator.train(input_fn=input_fn, steps=10)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 363, in train\r\n    loss = self._train_model(input_fn, hooks, saving_listeners)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 841, in _train_model\r\n    return self._train_model_distributed(input_fn, hooks, saving_listeners)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 978, in _train_model_distributed\r\n    saving_listeners)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 1057, in _train_with_estimator_spec\r\n    log_step_count_steps=self._config.log_step_count_steps) as mon_sess:\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 405, in MonitoredTrainingSession\r\n    stop_grace_period_secs=stop_grace_period_secs)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 816, in __init__\r\n    stop_grace_period_secs=stop_grace_period_secs)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 539, in __init__\r\n    self._sess = _RecoverableSession(self._coordinated_creator)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 1002, in __init__\r\n    _WrappedSession.__init__(self, self._create_session())\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 1007, in _create_session\r\n    return self._sess_creator.create_session()\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 696, in create_session\r\n    self.tf_sess = self._session_creator.create_session()\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 467, in create_session\r\n    init_fn=self._scaffold.init_fn)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/session_manager.py\", line 287, in prepare_session\r\n    init_fn(sess)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/monitored_session.py\", line 163, in <lambda>\r\n    self._init_fn = lambda sess: init_fn(self, sess)\r\nTypeError: <lambda>() takes exactly 1 argument (2 given)\r\n```"}