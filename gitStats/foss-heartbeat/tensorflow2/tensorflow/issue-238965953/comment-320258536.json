{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/320258536", "html_url": "https://github.com/tensorflow/tensorflow/pull/11089#issuecomment-320258536", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11089", "id": 320258536, "node_id": "MDEyOklzc3VlQ29tbWVudDMyMDI1ODUzNg==", "user": {"login": "neuzxy", "id": 3285618, "node_id": "MDQ6VXNlcjMyODU2MTg=", "avatar_url": "https://avatars1.githubusercontent.com/u/3285618?v=4", "gravatar_id": "", "url": "https://api.github.com/users/neuzxy", "html_url": "https://github.com/neuzxy", "followers_url": "https://api.github.com/users/neuzxy/followers", "following_url": "https://api.github.com/users/neuzxy/following{/other_user}", "gists_url": "https://api.github.com/users/neuzxy/gists{/gist_id}", "starred_url": "https://api.github.com/users/neuzxy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/neuzxy/subscriptions", "organizations_url": "https://api.github.com/users/neuzxy/orgs", "repos_url": "https://api.github.com/users/neuzxy/repos", "events_url": "https://api.github.com/users/neuzxy/events{/privacy}", "received_events_url": "https://api.github.com/users/neuzxy/received_events", "type": "User", "site_admin": false}, "created_at": "2017-08-04T14:08:43Z", "updated_at": "2018-01-16T01:10:25Z", "author_association": "NONE", "body_html": "<p>Hi, <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=6932348\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/yongtang\">@yongtang</a> ,</p>\n<p>I wrote some small patches to do unit test for S3 file system, and I also found and fixed a bug through unit test. Please see <a href=\"https://github.com/neuzxy/tensorflow/tree/s3-ut\">my branch</a>. These patches are simple, you can refer them or pick up useful code.</p>\n<ul>\n<li><a href=\"https://github.com/neuzxy/tensorflow/commit/d4a297518c8027f3b365f5e3af2a759b8e48eacb\">Patch 1</a></li>\n</ul>\n<p>Split the header and source of s3_file_system.cc. To test s3_file_system.cc, I should create a S3FileSystem Object, but class S3FileSystem was defined in s3_file_system.cc. So I splited the header and source of s3_file_system.cc. Due to the indent problem, you may see the diff with confusion, you may infer <a href=\"https://gist.github.com/neuzxy/0ea925c053d25d54b4b722ab9d764616\"><code>this patch</code></a> to see the change in an easy way.</p>\n<ul>\n<li><a href=\"https://github.com/neuzxy/tensorflow/commit/7b35e561d45727056eb7af11e6ae94cc04792ed6\">Patch 2</a></li>\n</ul>\n<p>Fix a return status issue in RandomAccessFile::Read. When I tested the <code>NewAppendableFile</code> method and couldn't pass the test. I have contacted to the code contributor <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=529391\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/sswv\">@sswv</a> , he has confirmed the bug.</p>\n<ul>\n<li><a href=\"https://github.com/neuzxy/tensorflow/commit/aec29c77675dec4f58c03237fd1e5a3036056bc9\">Patch 3</a></li>\n</ul>\n<p>Add the unit test for S3 file system. I have created unit tests for all methods of class S3FileSystem and passed all tests in my environment. Before the test, you should configure <code>TFS3_ENDPOINT</code>, <code>TFS3_REGION</code>, <code>TFS3_USE_HTTPS</code>, <code>TFS3_VERIFY_SSL</code> and the tmp dir <code>S3_TMPDIR</code>. If you execute the test for more than once, you should empty <code>S3_TMPDIR</code> first.</p>\n<pre><code>bazel test \\\n    //tensorflow/contrib/s3:s3_file_system_test \\\n    --test_env=TFS3_ENDPOINT=$TFS3_ENDPOINT \\\n    --test_env=TFS3_REGION=$TFS3_REGION \\\n    --test_env=TFS3_USE_HTTPS=$TFS3_USE_HTTPS \\\n    --test_env=TFS3_VERIFY_SSL=$TFS3_VERIFY_SSL \\\n    --test_env=S3_TMPDIR=S3://test\n</code></pre>\n<p>It works well in my simple tests. However, I am a junior engineer, I wrote the unit test by referring hadoop_file_system_test.cc and gcs_file_system_test.cc. It would be great if the author or other contributors provide more solid unit test.</p>", "body_text": "Hi, @yongtang ,\nI wrote some small patches to do unit test for S3 file system, and I also found and fixed a bug through unit test. Please see my branch. These patches are simple, you can refer them or pick up useful code.\n\nPatch 1\n\nSplit the header and source of s3_file_system.cc. To test s3_file_system.cc, I should create a S3FileSystem Object, but class S3FileSystem was defined in s3_file_system.cc. So I splited the header and source of s3_file_system.cc. Due to the indent problem, you may see the diff with confusion, you may infer this patch to see the change in an easy way.\n\nPatch 2\n\nFix a return status issue in RandomAccessFile::Read. When I tested the NewAppendableFile method and couldn't pass the test. I have contacted to the code contributor @sswv , he has confirmed the bug.\n\nPatch 3\n\nAdd the unit test for S3 file system. I have created unit tests for all methods of class S3FileSystem and passed all tests in my environment. Before the test, you should configure TFS3_ENDPOINT, TFS3_REGION, TFS3_USE_HTTPS, TFS3_VERIFY_SSL and the tmp dir S3_TMPDIR. If you execute the test for more than once, you should empty S3_TMPDIR first.\nbazel test \\\n    //tensorflow/contrib/s3:s3_file_system_test \\\n    --test_env=TFS3_ENDPOINT=$TFS3_ENDPOINT \\\n    --test_env=TFS3_REGION=$TFS3_REGION \\\n    --test_env=TFS3_USE_HTTPS=$TFS3_USE_HTTPS \\\n    --test_env=TFS3_VERIFY_SSL=$TFS3_VERIFY_SSL \\\n    --test_env=S3_TMPDIR=S3://test\n\nIt works well in my simple tests. However, I am a junior engineer, I wrote the unit test by referring hadoop_file_system_test.cc and gcs_file_system_test.cc. It would be great if the author or other contributors provide more solid unit test.", "body": "Hi, @yongtang ,\r\n\r\nI wrote some small patches to do unit test for S3 file system, and I also found and fixed a bug through unit test. Please see [my branch](https://github.com/neuzxy/tensorflow/tree/s3-ut). These patches are simple, you can refer them or pick up useful code.\r\n\r\n- [Patch 1](https://github.com/neuzxy/tensorflow/commit/d4a297518c8027f3b365f5e3af2a759b8e48eacb)\r\n\r\nSplit the header and source of s3_file_system.cc. To test s3_file_system.cc, I should create a S3FileSystem Object, but class S3FileSystem was defined in s3_file_system.cc. So I splited the header and source of s3_file_system.cc. Due to the indent problem, you may see the diff with confusion, you may infer [`this patch`](https://gist.github.com/neuzxy/0ea925c053d25d54b4b722ab9d764616) to see the change in an easy way.\r\n\r\n- [Patch 2](https://github.com/neuzxy/tensorflow/commit/7b35e561d45727056eb7af11e6ae94cc04792ed6)\r\n\r\nFix a return status issue in RandomAccessFile::Read. When I tested the `NewAppendableFile` method and couldn't pass the test. I have contacted to the code contributor @sswv , he has confirmed the bug.\r\n\r\n- [Patch 3](https://github.com/neuzxy/tensorflow/commit/aec29c77675dec4f58c03237fd1e5a3036056bc9)\r\n\r\nAdd the unit test for S3 file system. I have created unit tests for all methods of class S3FileSystem and passed all tests in my environment. Before the test, you should configure `TFS3_ENDPOINT`, `TFS3_REGION`, `TFS3_USE_HTTPS`, `TFS3_VERIFY_SSL` and the tmp dir `S3_TMPDIR`. If you execute the test for more than once, you should empty `S3_TMPDIR` first.\r\n\r\n```\r\nbazel test \\\r\n    //tensorflow/contrib/s3:s3_file_system_test \\\r\n    --test_env=TFS3_ENDPOINT=$TFS3_ENDPOINT \\\r\n    --test_env=TFS3_REGION=$TFS3_REGION \\\r\n    --test_env=TFS3_USE_HTTPS=$TFS3_USE_HTTPS \\\r\n    --test_env=TFS3_VERIFY_SSL=$TFS3_VERIFY_SSL \\\r\n    --test_env=S3_TMPDIR=S3://test\r\n```\r\n\r\nIt works well in my simple tests. However, I am a junior engineer, I wrote the unit test by referring hadoop_file_system_test.cc and gcs_file_system_test.cc. It would be great if the author or other contributors provide more solid unit test.\r\n"}