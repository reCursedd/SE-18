{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11898", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11898/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11898/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11898/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/11898", "id": 246637161, "node_id": "MDExOlB1bGxSZXF1ZXN0MTMzMTYwNzUw", "number": 11898, "title": "Update the graph used in quantization tutorial", "user": {"login": "korrawat", "id": 23010630, "node_id": "MDQ6VXNlcjIzMDEwNjMw", "avatar_url": "https://avatars1.githubusercontent.com/u/23010630?v=4", "gravatar_id": "", "url": "https://api.github.com/users/korrawat", "html_url": "https://github.com/korrawat", "followers_url": "https://api.github.com/users/korrawat/followers", "following_url": "https://api.github.com/users/korrawat/following{/other_user}", "gists_url": "https://api.github.com/users/korrawat/gists{/gist_id}", "starred_url": "https://api.github.com/users/korrawat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/korrawat/subscriptions", "organizations_url": "https://api.github.com/users/korrawat/orgs", "repos_url": "https://api.github.com/users/korrawat/repos", "events_url": "https://api.github.com/users/korrawat/events{/privacy}", "received_events_url": "https://api.github.com/users/korrawat/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "suharshs", "id": 1450614, "node_id": "MDQ6VXNlcjE0NTA2MTQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/1450614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/suharshs", "html_url": "https://github.com/suharshs", "followers_url": "https://api.github.com/users/suharshs/followers", "following_url": "https://api.github.com/users/suharshs/following{/other_user}", "gists_url": "https://api.github.com/users/suharshs/gists{/gist_id}", "starred_url": "https://api.github.com/users/suharshs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/suharshs/subscriptions", "organizations_url": "https://api.github.com/users/suharshs/orgs", "repos_url": "https://api.github.com/users/suharshs/repos", "events_url": "https://api.github.com/users/suharshs/events{/privacy}", "received_events_url": "https://api.github.com/users/suharshs/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "suharshs", "id": 1450614, "node_id": "MDQ6VXNlcjE0NTA2MTQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/1450614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/suharshs", "html_url": "https://github.com/suharshs", "followers_url": "https://api.github.com/users/suharshs/followers", "following_url": "https://api.github.com/users/suharshs/following{/other_user}", "gists_url": "https://api.github.com/users/suharshs/gists{/gist_id}", "starred_url": "https://api.github.com/users/suharshs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/suharshs/subscriptions", "organizations_url": "https://api.github.com/users/suharshs/orgs", "repos_url": "https://api.github.com/users/suharshs/repos", "events_url": "https://api.github.com/users/suharshs/events{/privacy}", "received_events_url": "https://api.github.com/users/suharshs/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2017-07-31T03:42:30Z", "updated_at": "2017-08-10T00:54:03Z", "closed_at": "2017-08-10T00:54:02Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/11898", "html_url": "https://github.com/tensorflow/tensorflow/pull/11898", "diff_url": "https://github.com/tensorflow/tensorflow/pull/11898.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/11898.patch"}, "body_html": "<p><em>Another fix to quantization tutorial after <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"240530516\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/11285\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/11285/hovercard\" href=\"https://github.com/tensorflow/tensorflow/pull/11285\">#11285</a></em></p>\n<p>Currently, following the steps in the <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/docs_src/performance/quantization.md#how-can-you-quantize-your-models\">quantization tutorial</a> will lead to weird results as pointed out in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"239821393\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/11181\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/11181/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/11181\">#11181</a>. This is because the graph file and the evaluation script are unmatched.</p>\n<p>From this <a href=\"https://www.tensorflow.org/tutorials/image_recognition\" rel=\"nofollow\">image recognition tutorial</a>, there are two pretrained graphs with two evaluation scripts.</p>\n<ol>\n<li><code>classify_image_graph_def.pb</code> in <a href=\"http://download.tensorflow.org/models/image/imagenet/inception-2015-12-05.tgz\" rel=\"nofollow\"><code>inception-2015-12-05.tgz</code></a> is to be used with the (older) <a href=\"https://github.com/tensorflow/models/blob/master/tutorials/image/imagenet/classify_image.py\"><code>classify_image.py</code></a>.</li>\n<li><code>inception_v3_2016_08_28_frozen.pb</code> in <a href=\"https://storage.googleapis.com/download.tensorflow.org/models/inception_v3_2016_08_28_frozen.pb.tar.gz\" rel=\"nofollow\"><code>inception_v3_2016_08_28_frozen.pb.tar.gz</code></a> is to be used with <a href=\"https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/label_image\"><code>label_image</code></a>.</li>\n</ol>\n<p>The weird results came from using <code>classify_image_graph_def.pb</code> with <code>label_image</code>. The graphs are different (see also <a href=\"https://github.com/tensorflow/models/issues/1314\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/models/issues/1314/hovercard\">models#1314</a>), especially in the last layer. The two scripts extract information from the last layer in different ways, so it works with its corresponding graph but not the other.</p>\n<h3>Further changes?</h3>\n<ol>\n<li>In the <a href=\"https://www.tensorflow.org/tutorials/image_recognition\" rel=\"nofollow\">image recognition tutorial</a> (<a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/docs_src/tutorials/image_recognition.md\">source</a>), the usage of Python API points to option 1 (above) but the C++ API points to option 2. This might cause confusion as the two graphs/scripts are not equivalent. Now that there's a <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/label_image/label_image.py\">python implementation</a> of the newer <code>label_image</code> by <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=3395998\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/freedomtan\">@freedomtan</a>, should we update the tutorial to use this python implementation instead?</li>\n<li>Should this <a href=\"https://github.com/tensorflow/tensorflow/tree/master/tensorflow/tools/graph_transforms/README.md\">graph transform README</a> be updated as well? Currently it uses the 2015 pre-trained graph, hence <code>--inputs='Mul' --outputs='softmax'</code>. If it is updated to the 2016 graph, these should instead say <code>--inputs=input --outputs=InceptionV3/Predictions/Reshape_1</code>.</li>\n</ol>", "body_text": "Another fix to quantization tutorial after #11285\nCurrently, following the steps in the quantization tutorial will lead to weird results as pointed out in #11181. This is because the graph file and the evaluation script are unmatched.\nFrom this image recognition tutorial, there are two pretrained graphs with two evaluation scripts.\n\nclassify_image_graph_def.pb in inception-2015-12-05.tgz is to be used with the (older) classify_image.py.\ninception_v3_2016_08_28_frozen.pb in inception_v3_2016_08_28_frozen.pb.tar.gz is to be used with label_image.\n\nThe weird results came from using classify_image_graph_def.pb with label_image. The graphs are different (see also models#1314), especially in the last layer. The two scripts extract information from the last layer in different ways, so it works with its corresponding graph but not the other.\nFurther changes?\n\nIn the image recognition tutorial (source), the usage of Python API points to option 1 (above) but the C++ API points to option 2. This might cause confusion as the two graphs/scripts are not equivalent. Now that there's a python implementation of the newer label_image by @freedomtan, should we update the tutorial to use this python implementation instead?\nShould this graph transform README be updated as well? Currently it uses the 2015 pre-trained graph, hence --inputs='Mul' --outputs='softmax'. If it is updated to the 2016 graph, these should instead say --inputs=input --outputs=InceptionV3/Predictions/Reshape_1.", "body": "_Another fix to quantization tutorial after #11285_\r\n\r\nCurrently, following the steps in the [quantization tutorial](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/docs_src/performance/quantization.md#how-can-you-quantize-your-models) will lead to weird results as pointed out in #11181. This is because the graph file and the evaluation script are unmatched.\r\n\r\nFrom this [image recognition tutorial](https://www.tensorflow.org/tutorials/image_recognition), there are two pretrained graphs with two evaluation scripts.\r\n1. `classify_image_graph_def.pb` in [`inception-2015-12-05.tgz`](http://download.tensorflow.org/models/image/imagenet/inception-2015-12-05.tgz) is to be used with the (older) [`classify_image.py`](https://github.com/tensorflow/models/blob/master/tutorials/image/imagenet/classify_image.py).\r\n1. `inception_v3_2016_08_28_frozen.pb` in [`inception_v3_2016_08_28_frozen.pb.tar.gz`](https://storage.googleapis.com/download.tensorflow.org/models/inception_v3_2016_08_28_frozen.pb.tar.gz) is to be used with [`label_image`](https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/label_image).\r\n\r\nThe weird results came from using `classify_image_graph_def.pb` with `label_image`. The graphs are different (see also [models#1314](https://github.com/tensorflow/models/issues/1314)), especially in the last layer. The two scripts extract information from the last layer in different ways, so it works with its corresponding graph but not the other.\r\n\r\n### Further changes?\r\n1. In the [image recognition tutorial](https://www.tensorflow.org/tutorials/image_recognition) ([source](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/docs_src/tutorials/image_recognition.md)), the usage of Python API points to option 1 (above) but the C++ API points to option 2. This might cause confusion as the two graphs/scripts are not equivalent. Now that there's a [python implementation](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/label_image/label_image.py) of the newer `label_image` by @freedomtan, should we update the tutorial to use this python implementation instead?\r\n1. Should this [graph transform README](https://github.com/tensorflow/tensorflow/tree/master/tensorflow/tools/graph_transforms/README.md) be updated as well? Currently it uses the 2015 pre-trained graph, hence `--inputs='Mul' --outputs='softmax'`. If it is updated to the 2016 graph, these should instead say `--inputs=input --outputs=InceptionV3/Predictions/Reshape_1`."}