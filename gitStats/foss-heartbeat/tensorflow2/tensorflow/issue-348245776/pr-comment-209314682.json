{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/209314682", "pull_request_review_id": 145310887, "id": 209314682, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwOTMxNDY4Mg==", "diff_hunk": "@@ -975,25 +975,31 @@ def _TopKGrad(op, grad, _):\n   in_shape = array_ops.shape(op.inputs[0])\n   ind_shape = array_ops.shape(op.outputs[1])\n \n-  ind_lastdim = array_ops.gather(ind_shape, array_ops.size(ind_shape) - 1)\n+  # int32 is not supported on GPU hence up-casting\n+  ind_lastdim = array_ops.gather(math_ops.cast(\n+      ind_shape, dtypes.int64), array_ops.size(ind_shape) - 1)\n   # Flatten indices to 2D.\n   ind_2d = array_ops.reshape(op.outputs[1], array_ops.stack([-1, ind_lastdim]))\n \n-  in_lastdim = array_ops.gather(in_shape, array_ops.size(in_shape) - 1)\n+  in_lastdim = array_ops.gather(math_ops.cast(\n+      in_shape, dtypes.int64), array_ops.size(in_shape) - 1)\n   outerdim = array_ops.shape(ind_2d)[0]\n   # Compute linear indices (flattened to 1D).\n-  ind = array_ops.reshape(ind_2d + array_ops.expand_dims(\n-      math_ops.range(0, outerdim * in_lastdim, in_lastdim), -1), [-1])\n+  ind = array_ops.reshape(ind_2d + math_ops.cast(array_ops.expand_dims(\n+      math_ops.range(0, math_ops.cast(outerdim, dtypes.int64)\n+                     * in_lastdim, in_lastdim), -1\n+  ), dtypes.int32), [-1])", "path": "tensorflow/python/ops/nn_grad.py", "position": null, "original_position": 21, "commit_id": "b07f8211409f2b2e46ab539291e824f2b7865885", "original_commit_id": "b2470ca8a93a7a4bd960ba7dff65be74779c4f62", "user": {"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}, "body": "nit: can you move this first ')' up to the previous line?", "created_at": "2018-08-10T16:24:47Z", "updated_at": "2018-08-25T06:26:35Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/21436#discussion_r209314682", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/21436", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/209314682"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/21436#discussion_r209314682"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/21436"}}, "body_html": "<p>nit: can you move this first ')' up to the previous line?</p>", "body_text": "nit: can you move this first ')' up to the previous line?"}