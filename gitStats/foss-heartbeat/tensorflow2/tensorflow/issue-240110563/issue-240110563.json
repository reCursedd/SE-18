{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11240", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11240/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11240/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11240/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/11240", "id": 240110563, "node_id": "MDU6SXNzdWUyNDAxMTA1NjM=", "number": 11240, "title": "tf.control_dependencies does not work with variable initializer for read_value?", "user": {"login": "albertz", "id": 59132, "node_id": "MDQ6VXNlcjU5MTMy", "avatar_url": "https://avatars0.githubusercontent.com/u/59132?v=4", "gravatar_id": "", "url": "https://api.github.com/users/albertz", "html_url": "https://github.com/albertz", "followers_url": "https://api.github.com/users/albertz/followers", "following_url": "https://api.github.com/users/albertz/following{/other_user}", "gists_url": "https://api.github.com/users/albertz/gists{/gist_id}", "starred_url": "https://api.github.com/users/albertz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/albertz/subscriptions", "organizations_url": "https://api.github.com/users/albertz/orgs", "repos_url": "https://api.github.com/users/albertz/repos", "events_url": "https://api.github.com/users/albertz/events{/privacy}", "received_events_url": "https://api.github.com/users/albertz/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "alextp", "id": 5061, "node_id": "MDQ6VXNlcjUwNjE=", "avatar_url": "https://avatars0.githubusercontent.com/u/5061?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alextp", "html_url": "https://github.com/alextp", "followers_url": "https://api.github.com/users/alextp/followers", "following_url": "https://api.github.com/users/alextp/following{/other_user}", "gists_url": "https://api.github.com/users/alextp/gists{/gist_id}", "starred_url": "https://api.github.com/users/alextp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alextp/subscriptions", "organizations_url": "https://api.github.com/users/alextp/orgs", "repos_url": "https://api.github.com/users/alextp/repos", "events_url": "https://api.github.com/users/alextp/events{/privacy}", "received_events_url": "https://api.github.com/users/alextp/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "alextp", "id": 5061, "node_id": "MDQ6VXNlcjUwNjE=", "avatar_url": "https://avatars0.githubusercontent.com/u/5061?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alextp", "html_url": "https://github.com/alextp", "followers_url": "https://api.github.com/users/alextp/followers", "following_url": "https://api.github.com/users/alextp/following{/other_user}", "gists_url": "https://api.github.com/users/alextp/gists{/gist_id}", "starred_url": "https://api.github.com/users/alextp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alextp/subscriptions", "organizations_url": "https://api.github.com/users/alextp/orgs", "repos_url": "https://api.github.com/users/alextp/repos", "events_url": "https://api.github.com/users/alextp/events{/privacy}", "received_events_url": "https://api.github.com/users/alextp/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2017-07-03T09:08:06Z", "updated_at": "2017-07-26T18:02:18Z", "closed_at": "2017-07-26T18:02:18Z", "author_association": "NONE", "body_html": "<p>Consider this code:</p>\n<pre><code>def test_var_init():\n  v = tf.Variable(initial_value=2, trainable=False, name=\"test_var_init\")\n  with tf.control_dependencies([v.initializer]):\n    x = v.read_value()\n  assert x.eval() == 2\n</code></pre>\n<p>It should always succeed. However, it stochastically fails (maybe in about 75% of the runs or so), with the error:</p>\n<pre><code>FailedPreconditionError: Attempting to use uninitialized value test_var_init\n         [[Node: test_var_init/_0 = _Send[T=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_5_test_var_init\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](test_var_init)]]\n</code></pre>\n<p>TensorFlow v1.2.0-rc2-21-g12f033d, 1.2.0, installed via pip, on Ubuntu 16.04 Linux.<br>\nIt only seems to happen with GPU.</p>\n<p>I think on TF 1.1 and earlier this worked, although maybe for some reason the probability to fail was much lower there and I didn't notice it.</p>", "body_text": "Consider this code:\ndef test_var_init():\n  v = tf.Variable(initial_value=2, trainable=False, name=\"test_var_init\")\n  with tf.control_dependencies([v.initializer]):\n    x = v.read_value()\n  assert x.eval() == 2\n\nIt should always succeed. However, it stochastically fails (maybe in about 75% of the runs or so), with the error:\nFailedPreconditionError: Attempting to use uninitialized value test_var_init\n         [[Node: test_var_init/_0 = _Send[T=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_5_test_var_init\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](test_var_init)]]\n\nTensorFlow v1.2.0-rc2-21-g12f033d, 1.2.0, installed via pip, on Ubuntu 16.04 Linux.\nIt only seems to happen with GPU.\nI think on TF 1.1 and earlier this worked, although maybe for some reason the probability to fail was much lower there and I didn't notice it.", "body": "Consider this code:\r\n\r\n```\r\ndef test_var_init():\r\n  v = tf.Variable(initial_value=2, trainable=False, name=\"test_var_init\")\r\n  with tf.control_dependencies([v.initializer]):\r\n    x = v.read_value()\r\n  assert x.eval() == 2\r\n```\r\n\r\nIt should always succeed. However, it stochastically fails (maybe in about 75% of the runs or so), with the error:\r\n```\r\nFailedPreconditionError: Attempting to use uninitialized value test_var_init\r\n         [[Node: test_var_init/_0 = _Send[T=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_5_test_var_init\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](test_var_init)]]\r\n```\r\n\r\nTensorFlow v1.2.0-rc2-21-g12f033d, 1.2.0, installed via pip, on Ubuntu 16.04 Linux.\r\nIt only seems to happen with GPU.\r\n\r\nI think on TF 1.1 and earlier this worked, although maybe for some reason the probability to fail was much lower there and I didn't notice it.\r\n"}