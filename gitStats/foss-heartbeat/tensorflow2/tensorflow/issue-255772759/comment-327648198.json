{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/327648198", "html_url": "https://github.com/tensorflow/tensorflow/issues/12859#issuecomment-327648198", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12859", "id": 327648198, "node_id": "MDEyOklzc3VlQ29tbWVudDMyNzY0ODE5OA==", "user": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "created_at": "2017-09-07T00:28:24Z", "updated_at": "2017-09-07T00:30:29Z", "author_association": "CONTRIBUTOR", "body_html": "<p>This happens because the <code>init_op</code> is not run when the worker restarts from a checkpoint. The relevant implementation is <a href=\"https://github.com/tensorflow/tensorflow/blob/4a24db28868e3ec9c9bc7408b9f72862116d6d39/tensorflow/python/training/session_manager.py#L274\">in <code>SessionManager.prepare_session()</code></a>.</p>\n<p>I think for the purposes of the <code>MonitoredSession</code>, an initializable iterator is more like a \"local variable\" (which are reinitialized on each worker when they start) than a \"global variable\" (which are initialized once by the chief, and then restored from checkpoints). Could you try moving the initializer to the <code>Scaffold.local_init_op</code> and see if that fixes things?</p>\n<p>(This is clearly \"not great\". We're still figuring out a more elegant way to integrate Datasets with the <code>MonitoredSession</code> and <code>Estimator</code> APIs. Hopefully this suggestion works in the meantime.)</p>\n<p>/cc <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=19293677\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ispirmustafa\">@ispirmustafa</a> for <code>MonitoredSession</code> wisdom.</p>", "body_text": "This happens because the init_op is not run when the worker restarts from a checkpoint. The relevant implementation is in SessionManager.prepare_session().\nI think for the purposes of the MonitoredSession, an initializable iterator is more like a \"local variable\" (which are reinitialized on each worker when they start) than a \"global variable\" (which are initialized once by the chief, and then restored from checkpoints). Could you try moving the initializer to the Scaffold.local_init_op and see if that fixes things?\n(This is clearly \"not great\". We're still figuring out a more elegant way to integrate Datasets with the MonitoredSession and Estimator APIs. Hopefully this suggestion works in the meantime.)\n/cc @ispirmustafa for MonitoredSession wisdom.", "body": "This happens because the `init_op` is not run when the worker restarts from a checkpoint. The relevant implementation is [in `SessionManager.prepare_session()`](https://github.com/tensorflow/tensorflow/blob/4a24db28868e3ec9c9bc7408b9f72862116d6d39/tensorflow/python/training/session_manager.py#L274).\r\n\r\nI think for the purposes of the `MonitoredSession`, an initializable iterator is more like a \"local variable\" (which are reinitialized on each worker when they start) than a \"global variable\" (which are initialized once by the chief, and then restored from checkpoints). Could you try moving the initializer to the `Scaffold.local_init_op` and see if that fixes things?\r\n\r\n(This is clearly \"not great\". We're still figuring out a more elegant way to integrate Datasets with the `MonitoredSession` and `Estimator` APIs. Hopefully this suggestion works in the meantime.)\r\n\r\n/cc @ispirmustafa for `MonitoredSession` wisdom."}