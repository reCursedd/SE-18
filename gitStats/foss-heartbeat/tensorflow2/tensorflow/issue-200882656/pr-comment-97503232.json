{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/97503232", "pull_request_review_id": 18113489, "id": 97503232, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDk3NTAzMjMy", "diff_hunk": "@@ -846,5 +848,108 @@ def test_feeding_placeholder(self):\n       self.assertEqual(mon_sess.run(y), 2)\n \n \n+class ProfilerHookTest(test.TestCase):\n+\n+  def setUp(self):\n+    super(ProfilerHookTest, self).setUp()\n+    self.output_dir = tempfile.mkdtemp()\n+    self.graph = ops.Graph()\n+    self.filepattern = os.path.join(self.output_dir, \"timeline-*.json\")\n+    with self.graph.as_default():\n+      self.global_step = variables.get_or_create_global_step()\n+      self.train_op = state_ops.assign_add(self.global_step, 1)\n+\n+  def tearDown(self):\n+    super(ProfilerHookTest, self).tearDown()\n+    shutil.rmtree(self.output_dir, ignore_errors=True)\n+\n+  def countTimelineFiles(self):\n+    return len(gfile.Glob(self.filepattern))\n+\n+  def test_raise_in_both_secs_and_steps(self):\n+    with self.assertRaises(ValueError):\n+      basic_session_run_hooks.ProfilerHook(save_secs=10, save_steps=20)\n+\n+  def test_raise_in_none_secs_and_steps(self):\n+    with self.assertRaises(ValueError):\n+      basic_session_run_hooks.ProfilerHook(save_secs=None, save_steps=None)\n+\n+  def test_save_secs_saves_in_first_step(self):\n+    with self.graph.as_default():\n+      hook = basic_session_run_hooks.ProfilerHook(\n+          save_secs=2, output_dir=self.output_dir)\n+      hook.begin()\n+      with self.test_session() as sess:\n+        sess.run(variables_lib.global_variables_initializer())\n+        mon_sess = monitored_session._HookedSession(sess, [hook])\n+        mon_sess.run(self.train_op)\n+        self.assertEqual(1, self.countTimelineFiles())\n+\n+  @test.mock.patch('time.time')\n+  def test_save_secs_saves_periodically(self, mock_time):\n+    # Pick a fixed start time.\n+    current_time = 1484863632.320497\n+\n+    with self.graph.as_default():\n+      mock_time.return_value = current_time\n+      hook = basic_session_run_hooks.ProfilerHook(\n+          save_secs=2, output_dir=self.output_dir)\n+      hook.begin()\n+      with self.test_session(use_gpu=False) as sess:", "path": "tensorflow/python/training/basic_session_run_hooks_test.py", "position": null, "original_position": 67, "commit_id": "0af55e255e27d5ae3bfe64f93215ee91788101e4", "original_commit_id": "8bd9385d7dfd65fd66cb5fea3381af64c4139a64", "user": {"login": "darrengarvey", "id": 260360, "node_id": "MDQ6VXNlcjI2MDM2MA==", "avatar_url": "https://avatars0.githubusercontent.com/u/260360?v=4", "gravatar_id": "", "url": "https://api.github.com/users/darrengarvey", "html_url": "https://github.com/darrengarvey", "followers_url": "https://api.github.com/users/darrengarvey/followers", "following_url": "https://api.github.com/users/darrengarvey/following{/other_user}", "gists_url": "https://api.github.com/users/darrengarvey/gists{/gist_id}", "starred_url": "https://api.github.com/users/darrengarvey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/darrengarvey/subscriptions", "organizations_url": "https://api.github.com/users/darrengarvey/orgs", "repos_url": "https://api.github.com/users/darrengarvey/repos", "events_url": "https://api.github.com/users/darrengarvey/events{/privacy}", "received_events_url": "https://api.github.com/users/darrengarvey/received_events", "type": "User", "site_admin": false}, "body": "Thanks for the tip. That's cleaner now.", "created_at": "2017-01-24T09:24:24Z", "updated_at": "2017-02-06T09:22:03Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/6864#discussion_r97503232", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/6864", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/97503232"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/6864#discussion_r97503232"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/6864"}}, "body_html": "<p>Thanks for the tip. That's cleaner now.</p>", "body_text": "Thanks for the tip. That's cleaner now.", "in_reply_to_id": 97452666}