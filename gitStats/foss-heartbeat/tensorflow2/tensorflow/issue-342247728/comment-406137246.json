{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/406137246", "html_url": "https://github.com/tensorflow/tensorflow/issues/20914#issuecomment-406137246", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20914", "id": 406137246, "node_id": "MDEyOklzc3VlQ29tbWVudDQwNjEzNzI0Ng==", "user": {"login": "candyzone", "id": 7778833, "node_id": "MDQ6VXNlcjc3Nzg4MzM=", "avatar_url": "https://avatars0.githubusercontent.com/u/7778833?v=4", "gravatar_id": "", "url": "https://api.github.com/users/candyzone", "html_url": "https://github.com/candyzone", "followers_url": "https://api.github.com/users/candyzone/followers", "following_url": "https://api.github.com/users/candyzone/following{/other_user}", "gists_url": "https://api.github.com/users/candyzone/gists{/gist_id}", "starred_url": "https://api.github.com/users/candyzone/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/candyzone/subscriptions", "organizations_url": "https://api.github.com/users/candyzone/orgs", "repos_url": "https://api.github.com/users/candyzone/repos", "events_url": "https://api.github.com/users/candyzone/events{/privacy}", "received_events_url": "https://api.github.com/users/candyzone/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-19T02:46:20Z", "updated_at": "2018-07-19T07:20:49Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=19335798\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/agarwal-ashish\">@agarwal-ashish</a><br>\nwhen I use partitioned ResourceVariable, it will be go to Line176. Line181 'x' is already an tf.identity with \"v.device\", Line183 changes the device placement using another tf.identity. It makes the Identity OP placement with \"/device:CPU:0\", after build graph in python, TF will get the candidate Devices for Identity OP in c++, finally select the default device \"/job:ps/replica:0/task:0/device:CPU:0\" (<a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/common_runtime/placer.cc#L861\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/common_runtime/placer.cc#L861</a>), the same process happen in SaveV2 OP. It results OP placement imbalance.<br>\nOnly job:ps/task:0 has a SaveV2 OP, though I use the API <code>tf.train.Saver(sharded=True)</code>.<br>\nThe API <code>tf.train.Saver(sharded=True)</code> works well with Variable and non-partitioned ResourceVariable.<br>\nIs it by design?</p>", "body_text": "@agarwal-ashish\nwhen I use partitioned ResourceVariable, it will be go to Line176. Line181 'x' is already an tf.identity with \"v.device\", Line183 changes the device placement using another tf.identity. It makes the Identity OP placement with \"/device:CPU:0\", after build graph in python, TF will get the candidate Devices for Identity OP in c++, finally select the default device \"/job:ps/replica:0/task:0/device:CPU:0\" (https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/common_runtime/placer.cc#L861), the same process happen in SaveV2 OP. It results OP placement imbalance.\nOnly job:ps/task:0 has a SaveV2 OP, though I use the API tf.train.Saver(sharded=True).\nThe API tf.train.Saver(sharded=True) works well with Variable and non-partitioned ResourceVariable.\nIs it by design?", "body": "@agarwal-ashish \r\nwhen I use partitioned ResourceVariable, it will be go to Line176. Line181 'x' is already an tf.identity with \"v.device\", Line183 changes the device placement using another tf.identity. It makes the Identity OP placement with \"/device:CPU:0\", after build graph in python, TF will get the candidate Devices for Identity OP in c++, finally select the default device \"/job:ps/replica:0/task:0/device:CPU:0\" (https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/common_runtime/placer.cc#L861), the same process happen in SaveV2 OP. It results OP placement imbalance.\r\nOnly job:ps/task:0 has a SaveV2 OP, though I use the API `tf.train.Saver(sharded=True)`.\r\nThe API `tf.train.Saver(sharded=True)` works well with Variable and non-partitioned ResourceVariable.\r\nIs it by design?"}