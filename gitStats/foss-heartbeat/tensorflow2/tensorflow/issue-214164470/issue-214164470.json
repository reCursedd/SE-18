{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8403", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8403/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8403/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8403/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/8403", "id": 214164470, "node_id": "MDU6SXNzdWUyMTQxNjQ0NzA=", "number": 8403, "title": "C++ libtensorflow.so segfault on exit on Ubuntu 14.04 (no segfault on OSX)", "user": {"login": "dbarnes", "id": 5920715, "node_id": "MDQ6VXNlcjU5MjA3MTU=", "avatar_url": "https://avatars2.githubusercontent.com/u/5920715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dbarnes", "html_url": "https://github.com/dbarnes", "followers_url": "https://api.github.com/users/dbarnes/followers", "following_url": "https://api.github.com/users/dbarnes/following{/other_user}", "gists_url": "https://api.github.com/users/dbarnes/gists{/gist_id}", "starred_url": "https://api.github.com/users/dbarnes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dbarnes/subscriptions", "organizations_url": "https://api.github.com/users/dbarnes/orgs", "repos_url": "https://api.github.com/users/dbarnes/repos", "events_url": "https://api.github.com/users/dbarnes/events{/privacy}", "received_events_url": "https://api.github.com/users/dbarnes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473173351, "node_id": "MDU6TGFiZWw0NzMxNzMzNTE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:build/install", "name": "type:build/install", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "skye", "id": 88808, "node_id": "MDQ6VXNlcjg4ODA4", "avatar_url": "https://avatars1.githubusercontent.com/u/88808?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skye", "html_url": "https://github.com/skye", "followers_url": "https://api.github.com/users/skye/followers", "following_url": "https://api.github.com/users/skye/following{/other_user}", "gists_url": "https://api.github.com/users/skye/gists{/gist_id}", "starred_url": "https://api.github.com/users/skye/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skye/subscriptions", "organizations_url": "https://api.github.com/users/skye/orgs", "repos_url": "https://api.github.com/users/skye/repos", "events_url": "https://api.github.com/users/skye/events{/privacy}", "received_events_url": "https://api.github.com/users/skye/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "skye", "id": 88808, "node_id": "MDQ6VXNlcjg4ODA4", "avatar_url": "https://avatars1.githubusercontent.com/u/88808?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skye", "html_url": "https://github.com/skye", "followers_url": "https://api.github.com/users/skye/followers", "following_url": "https://api.github.com/users/skye/following{/other_user}", "gists_url": "https://api.github.com/users/skye/gists{/gist_id}", "starred_url": "https://api.github.com/users/skye/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skye/subscriptions", "organizations_url": "https://api.github.com/users/skye/orgs", "repos_url": "https://api.github.com/users/skye/repos", "events_url": "https://api.github.com/users/skye/events{/privacy}", "received_events_url": "https://api.github.com/users/skye/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 13, "created_at": "2017-03-14T18:24:55Z", "updated_at": "2018-01-05T22:45:10Z", "closed_at": "2018-01-05T22:45:09Z", "author_association": "NONE", "body_html": "<h3>Summary</h3>\n<p>When using libtensorflow.so in a C++ app a segfault occurs when exiting the app on Ubuntu 14.04 while on OSX Sierra this does not get thrown (both using Protobuf 3.2.0). The actual execution of the app is fine, successfully running data through the graph. Only the mentioned segfault when exiting. From the stacktrace you can see it occurs while a protobuf hastable is cleared by libtensorflow.so.</p>\n<h3>Environment info</h3>\n<p>Ubuntu 14.04</p>\n<p>Installed version of CUDA and cuDNN:<br>\nls -l /usr/local/cuda/lib64/libcud*<br>\n-rw-r--r-- 1 root    546K Sep 15 00:02 /usr/local/cuda/lib64/libcudadevrt.a<br>\nlrwxrwxrwx 1 root      16 Sep 15 00:05 /usr/local/cuda/lib64/libcudart.so -&gt; libcudart.so.8.0<br>\nlrwxrwxrwx 1 root      19 Sep 15 00:05 /usr/local/cuda/lib64/libcudart.so.8.0 -&gt; libcudart.so.8.0.44<br>\n-rw-r--r-- 1 root    406K Sep 15 00:02 /usr/local/cuda/lib64/libcudart.so.8.0.44<br>\n-rw-r--r-- 1 root    757K Sep 15 00:02 /usr/local/cuda/lib64/libcudart_static.a<br>\nlrwxrwxrwx 1 mtanner   13 Jul 27  2016 /usr/local/cuda/lib64/libcudnn.so -&gt; libcudnn.so.5*<br>\nlrwxrwxrwx 1 mtanner   17 Jul 27  2016 /usr/local/cuda/lib64/libcudnn.so.5 -&gt; libcudnn.so.5.1.5*<br>\n-rwxrwxr-x 1 mtanner  76M Jul 27  2016 /usr/local/cuda/lib64/libcudnn.so.5.1.5*<br>\n-rw-rw-r-- 1 mtanner  67M Jul 27  2016 /usr/local/cuda/lib64/libcudnn_static.a</p>\n<h3>Installed from source</h3>\n<ol>\n<li>The commit hash - <code>e895d5ca395c2362df4f5c8f08b68501b41f8a98</code> (from the r1.0 branch)</li>\n<li>The output of <code>bazel version</code> - Build label: 0.4.4 Build target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar Build time: Wed Feb 1 18:54:21 2017 (1485975261) Build timestamp: 1485975261 Build timestamp as int: 1485975261</li>\n<li>Workspace.bzl simply updated to point to a fixed protobuf 3.2.0 to match our system version</li>\n</ol>\n<pre><code>...\n  native.http_archive(\n      name = \"protobuf\",\n      urls = [\n          \"https://github.com/google/protobuf/archive/v3.2.0.tar.gz\",\n      ],\n      sha256 = \"2a25c2b71c707c5552ec9afdfb22532a93a339e1ca5d38f163fe4107af08c54c\",\n      strip_prefix = \"protobuf-3.2.0\",\n  )\n...\n</code></pre>\n<h3>Logs or other output that would be helpful</h3>\n<h4>protoc --version</h4>\n<pre><code>libprotoc 3.2.0\n</code></pre>\n<h4>gdb stacktrace (at the end of app execution)</h4>\n<pre><code>[Thread 0x7fffdcdc0700 (LWP 2193) exited]\nProgram received signal SIGSEGV, Segmentation fault.\n0x00007fffefed8ea3 in std::_Hashtable&lt;std::string, std::pair&lt;std::string const, google::protobuf::FieldDescriptorProto_Type&gt;, std::allocator&lt;std::pair&lt;std::string const, google::protobuf::FieldDescriptorProto_Type&gt; &gt;, std::__detail::_Select1st, std::equal_to&lt;std::string&gt;, google::protobuf::hash&lt;std::string&gt;, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits&lt;true, false, true&gt; &gt;::clear() () from /home/dbarnes/code/third_party/tensorflow/bazel-bin/tensorflow/libtensorflow.so\n(gdb)\n</code></pre>\n<h4>ldd libtensorflow.so</h4>\n<pre><code>ldd /home/dbarnes/code/third_party/tensorflow/bazel-bin/tensorflow/libtensorflow.so\n        linux-vdso.so.1 =&gt;  (0x00007ffe19bf6000)\n        libcudart.so.8.0 =&gt; /home/dbarnes/code/third_party/tensorflow/bazel-bin/tensorflow/../_solib_local/_U@local_Uconfig_Ucuda_S_Scuda_Ccudart___Uexternal_Slocal_Uconfig_Ucuda_Scuda_Slib/libcudart.so.8.0 (0x00007f92440ef000)\n        libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f9243eeb000)\n        libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007f9243be5000)\n        libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f92439c7000)\n        libstdc++.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007f92436c3000)\n        libgcc_s.so.1 =&gt; /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007f92434ad000)\n        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f92430e8000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f924ef6a000)\n        librt.so.1 =&gt; /lib/x86_64-linux-gnu/librt.so.1 (0x00007f9242ee0000)\n</code></pre>\n<p>I tried to make this brief but if any other info is helpful let me know.</p>\n<p>Cheers</p>", "body_text": "Summary\nWhen using libtensorflow.so in a C++ app a segfault occurs when exiting the app on Ubuntu 14.04 while on OSX Sierra this does not get thrown (both using Protobuf 3.2.0). The actual execution of the app is fine, successfully running data through the graph. Only the mentioned segfault when exiting. From the stacktrace you can see it occurs while a protobuf hastable is cleared by libtensorflow.so.\nEnvironment info\nUbuntu 14.04\nInstalled version of CUDA and cuDNN:\nls -l /usr/local/cuda/lib64/libcud*\n-rw-r--r-- 1 root    546K Sep 15 00:02 /usr/local/cuda/lib64/libcudadevrt.a\nlrwxrwxrwx 1 root      16 Sep 15 00:05 /usr/local/cuda/lib64/libcudart.so -> libcudart.so.8.0\nlrwxrwxrwx 1 root      19 Sep 15 00:05 /usr/local/cuda/lib64/libcudart.so.8.0 -> libcudart.so.8.0.44\n-rw-r--r-- 1 root    406K Sep 15 00:02 /usr/local/cuda/lib64/libcudart.so.8.0.44\n-rw-r--r-- 1 root    757K Sep 15 00:02 /usr/local/cuda/lib64/libcudart_static.a\nlrwxrwxrwx 1 mtanner   13 Jul 27  2016 /usr/local/cuda/lib64/libcudnn.so -> libcudnn.so.5*\nlrwxrwxrwx 1 mtanner   17 Jul 27  2016 /usr/local/cuda/lib64/libcudnn.so.5 -> libcudnn.so.5.1.5*\n-rwxrwxr-x 1 mtanner  76M Jul 27  2016 /usr/local/cuda/lib64/libcudnn.so.5.1.5*\n-rw-rw-r-- 1 mtanner  67M Jul 27  2016 /usr/local/cuda/lib64/libcudnn_static.a\nInstalled from source\n\nThe commit hash - e895d5ca395c2362df4f5c8f08b68501b41f8a98 (from the r1.0 branch)\nThe output of bazel version - Build label: 0.4.4 Build target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar Build time: Wed Feb 1 18:54:21 2017 (1485975261) Build timestamp: 1485975261 Build timestamp as int: 1485975261\nWorkspace.bzl simply updated to point to a fixed protobuf 3.2.0 to match our system version\n\n...\n  native.http_archive(\n      name = \"protobuf\",\n      urls = [\n          \"https://github.com/google/protobuf/archive/v3.2.0.tar.gz\",\n      ],\n      sha256 = \"2a25c2b71c707c5552ec9afdfb22532a93a339e1ca5d38f163fe4107af08c54c\",\n      strip_prefix = \"protobuf-3.2.0\",\n  )\n...\n\nLogs or other output that would be helpful\nprotoc --version\nlibprotoc 3.2.0\n\ngdb stacktrace (at the end of app execution)\n[Thread 0x7fffdcdc0700 (LWP 2193) exited]\nProgram received signal SIGSEGV, Segmentation fault.\n0x00007fffefed8ea3 in std::_Hashtable<std::string, std::pair<std::string const, google::protobuf::FieldDescriptorProto_Type>, std::allocator<std::pair<std::string const, google::protobuf::FieldDescriptorProto_Type> >, std::__detail::_Select1st, std::equal_to<std::string>, google::protobuf::hash<std::string>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::clear() () from /home/dbarnes/code/third_party/tensorflow/bazel-bin/tensorflow/libtensorflow.so\n(gdb)\n\nldd libtensorflow.so\nldd /home/dbarnes/code/third_party/tensorflow/bazel-bin/tensorflow/libtensorflow.so\n        linux-vdso.so.1 =>  (0x00007ffe19bf6000)\n        libcudart.so.8.0 => /home/dbarnes/code/third_party/tensorflow/bazel-bin/tensorflow/../_solib_local/_U@local_Uconfig_Ucuda_S_Scuda_Ccudart___Uexternal_Slocal_Uconfig_Ucuda_Scuda_Slib/libcudart.so.8.0 (0x00007f92440ef000)\n        libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f9243eeb000)\n        libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007f9243be5000)\n        libpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f92439c7000)\n        libstdc++.so.6 => /usr/lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007f92436c3000)\n        libgcc_s.so.1 => /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007f92434ad000)\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f92430e8000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f924ef6a000)\n        librt.so.1 => /lib/x86_64-linux-gnu/librt.so.1 (0x00007f9242ee0000)\n\nI tried to make this brief but if any other info is helpful let me know.\nCheers", "body": "### Summary\r\nWhen using libtensorflow.so in a C++ app a segfault occurs when exiting the app on Ubuntu 14.04 while on OSX Sierra this does not get thrown (both using Protobuf 3.2.0). The actual execution of the app is fine, successfully running data through the graph. Only the mentioned segfault when exiting. From the stacktrace you can see it occurs while a protobuf hastable is cleared by libtensorflow.so.\r\n\r\n### Environment info\r\nUbuntu 14.04\r\n\r\nInstalled version of CUDA and cuDNN: \r\nls -l /usr/local/cuda/lib64/libcud*  \r\n-rw-r--r-- 1 root    546K Sep 15 00:02 /usr/local/cuda/lib64/libcudadevrt.a\r\nlrwxrwxrwx 1 root      16 Sep 15 00:05 /usr/local/cuda/lib64/libcudart.so -> libcudart.so.8.0\r\nlrwxrwxrwx 1 root      19 Sep 15 00:05 /usr/local/cuda/lib64/libcudart.so.8.0 -> libcudart.so.8.0.44\r\n-rw-r--r-- 1 root    406K Sep 15 00:02 /usr/local/cuda/lib64/libcudart.so.8.0.44\r\n-rw-r--r-- 1 root    757K Sep 15 00:02 /usr/local/cuda/lib64/libcudart_static.a\r\nlrwxrwxrwx 1 mtanner   13 Jul 27  2016 /usr/local/cuda/lib64/libcudnn.so -> libcudnn.so.5*\r\nlrwxrwxrwx 1 mtanner   17 Jul 27  2016 /usr/local/cuda/lib64/libcudnn.so.5 -> libcudnn.so.5.1.5*\r\n-rwxrwxr-x 1 mtanner  76M Jul 27  2016 /usr/local/cuda/lib64/libcudnn.so.5.1.5*\r\n-rw-rw-r-- 1 mtanner  67M Jul 27  2016 /usr/local/cuda/lib64/libcudnn_static.a\r\n\r\n### Installed from source\r\n1. The commit hash - `e895d5ca395c2362df4f5c8f08b68501b41f8a98` (from the r1.0 branch)\r\n2. The output of `bazel version` - Build label: 0.4.4 Build target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar Build time: Wed Feb 1 18:54:21 2017 (1485975261) Build timestamp: 1485975261 Build timestamp as int: 1485975261\r\n3. Workspace.bzl simply updated to point to a fixed protobuf 3.2.0 to match our system version\r\n```\r\n...\r\n  native.http_archive(\r\n      name = \"protobuf\",\r\n      urls = [\r\n          \"https://github.com/google/protobuf/archive/v3.2.0.tar.gz\",\r\n      ],\r\n      sha256 = \"2a25c2b71c707c5552ec9afdfb22532a93a339e1ca5d38f163fe4107af08c54c\",\r\n      strip_prefix = \"protobuf-3.2.0\",\r\n  )\r\n...\r\n```\r\n\r\n### Logs or other output that would be helpful\r\n\r\n#### protoc --version\r\n```\r\nlibprotoc 3.2.0\r\n```\r\n\r\n#### gdb stacktrace (at the end of app execution)\r\n```\r\n[Thread 0x7fffdcdc0700 (LWP 2193) exited]\r\nProgram received signal SIGSEGV, Segmentation fault.\r\n0x00007fffefed8ea3 in std::_Hashtable<std::string, std::pair<std::string const, google::protobuf::FieldDescriptorProto_Type>, std::allocator<std::pair<std::string const, google::protobuf::FieldDescriptorProto_Type> >, std::__detail::_Select1st, std::equal_to<std::string>, google::protobuf::hash<std::string>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::clear() () from /home/dbarnes/code/third_party/tensorflow/bazel-bin/tensorflow/libtensorflow.so\r\n(gdb)\r\n```\r\n\r\n#### ldd libtensorflow.so\r\n```\r\nldd /home/dbarnes/code/third_party/tensorflow/bazel-bin/tensorflow/libtensorflow.so\r\n        linux-vdso.so.1 =>  (0x00007ffe19bf6000)\r\n        libcudart.so.8.0 => /home/dbarnes/code/third_party/tensorflow/bazel-bin/tensorflow/../_solib_local/_U@local_Uconfig_Ucuda_S_Scuda_Ccudart___Uexternal_Slocal_Uconfig_Ucuda_Scuda_Slib/libcudart.so.8.0 (0x00007f92440ef000)\r\n        libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f9243eeb000)\r\n        libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007f9243be5000)\r\n        libpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f92439c7000)\r\n        libstdc++.so.6 => /usr/lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007f92436c3000)\r\n        libgcc_s.so.1 => /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007f92434ad000)\r\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f92430e8000)\r\n        /lib64/ld-linux-x86-64.so.2 (0x00007f924ef6a000)\r\n        librt.so.1 => /lib/x86_64-linux-gnu/librt.so.1 (0x00007f9242ee0000)\r\n```\r\n\r\nI tried to make this brief but if any other info is helpful let me know.\r\n\r\nCheers\r\n"}