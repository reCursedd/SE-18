{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/272284212", "html_url": "https://github.com/tensorflow/tensorflow/issues/6809#issuecomment-272284212", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6809", "id": 272284212, "node_id": "MDEyOklzc3VlQ29tbWVudDI3MjI4NDIxMg==", "user": {"login": "Hebali", "id": 532817, "node_id": "MDQ6VXNlcjUzMjgxNw==", "avatar_url": "https://avatars1.githubusercontent.com/u/532817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Hebali", "html_url": "https://github.com/Hebali", "followers_url": "https://api.github.com/users/Hebali/followers", "following_url": "https://api.github.com/users/Hebali/following{/other_user}", "gists_url": "https://api.github.com/users/Hebali/gists{/gist_id}", "starred_url": "https://api.github.com/users/Hebali/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Hebali/subscriptions", "organizations_url": "https://api.github.com/users/Hebali/orgs", "repos_url": "https://api.github.com/users/Hebali/repos", "events_url": "https://api.github.com/users/Hebali/events{/privacy}", "received_events_url": "https://api.github.com/users/Hebali/received_events", "type": "User", "site_admin": false}, "created_at": "2017-01-12T21:09:32Z", "updated_at": "2017-01-12T21:10:37Z", "author_association": "NONE", "body_html": "<p>I'm also having trouble finding the correct compiler flags to enable SSE4.1, SSE4.2 and AVX instructions. If anyone has insights, I'd really appreciate it.</p>\n<p>Building on a Retina MBP with 2.6 GHz Intel Core i7 on Mac OS X El Capitan 10.11.6<br>\nfrom commit <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/d4b5c606fc9fbd1a20b5b113b4bc831f31d889a3/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/d4b5c606fc9fbd1a20b5b113b4bc831f31d889a3\"><tt>d4b5c60</tt></a> with this custom build rule:</p>\n<pre><code>cc_binary(\n    name = \"libtensorflow_all.so\",\n    linkshared = 1,\n    deps = [\n    \t\"//tensorflow/c:c_api\",\n        \"//tensorflow/cc:cc_ops\",\n        \"//tensorflow/core:framework_internal\",\n        \"//tensorflow/core:tensorflow\",\n    ],\n)\n</code></pre>\n<p>Based on <a href=\"http://stackoverflow.com/questions/41293077/how-to-compile-tensorflow-with-sse4-2-and-avx-instructions\" rel=\"nofollow\">this StackOverflow thread</a>, I tried:</p>\n<pre><code>bazel build -c opt --copt=-mavx --copt=-mavx2 --copt=-mfma --copt=-mfpmath=both --copt=-msse4.2 tensorflow:libtensorflow_all.so\n</code></pre>\n<p>which threw the compiler error:</p>\n<pre><code>ERROR: /private/var/tmp/_bazel_pjh/932673a2a7490816ef213d3cdb401ef6/external/gif_archive/BUILD:8:1: C++ compilation of rule '@gif_archive//:gif' failed: cc_wrapper.sh failed: error executing command external/local_config_cc/cc_wrapper.sh -U_FORTIFY_SOURCE '-D_FORTIFY_SOURCE=1' -fstack-protector -Wall -Wthread-safety -Wself-assign -fcolor-diagnostics -fno-omit-frame-pointer -g0 -O2 -DNDEBUG ... (remaining 33 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\nerror: unknown FP unit 'both'\n</code></pre>\n<p>I was able to compile with this modification:</p>\n<pre><code>bazel build -c opt --copt=-mavx --copt=-mavx2 --copt=-mfma --copt=-msse4.2 tensorflow:libtensorflow_all.so\n</code></pre>\n<p>but the resulting .so immediately crashed at runtime.</p>\n<p>I recompiled with the basic:</p>\n<pre><code>bazel build tensorflow:libtensorflow_all.so\n</code></pre>\n<p>but at runtime, I get the following warnings:</p>\n<pre><code>W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.\n</code></pre>\n<p>Thanks!</p>", "body_text": "I'm also having trouble finding the correct compiler flags to enable SSE4.1, SSE4.2 and AVX instructions. If anyone has insights, I'd really appreciate it.\nBuilding on a Retina MBP with 2.6 GHz Intel Core i7 on Mac OS X El Capitan 10.11.6\nfrom commit d4b5c60 with this custom build rule:\ncc_binary(\n    name = \"libtensorflow_all.so\",\n    linkshared = 1,\n    deps = [\n    \t\"//tensorflow/c:c_api\",\n        \"//tensorflow/cc:cc_ops\",\n        \"//tensorflow/core:framework_internal\",\n        \"//tensorflow/core:tensorflow\",\n    ],\n)\n\nBased on this StackOverflow thread, I tried:\nbazel build -c opt --copt=-mavx --copt=-mavx2 --copt=-mfma --copt=-mfpmath=both --copt=-msse4.2 tensorflow:libtensorflow_all.so\n\nwhich threw the compiler error:\nERROR: /private/var/tmp/_bazel_pjh/932673a2a7490816ef213d3cdb401ef6/external/gif_archive/BUILD:8:1: C++ compilation of rule '@gif_archive//:gif' failed: cc_wrapper.sh failed: error executing command external/local_config_cc/cc_wrapper.sh -U_FORTIFY_SOURCE '-D_FORTIFY_SOURCE=1' -fstack-protector -Wall -Wthread-safety -Wself-assign -fcolor-diagnostics -fno-omit-frame-pointer -g0 -O2 -DNDEBUG ... (remaining 33 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\nerror: unknown FP unit 'both'\n\nI was able to compile with this modification:\nbazel build -c opt --copt=-mavx --copt=-mavx2 --copt=-mfma --copt=-msse4.2 tensorflow:libtensorflow_all.so\n\nbut the resulting .so immediately crashed at runtime.\nI recompiled with the basic:\nbazel build tensorflow:libtensorflow_all.so\n\nbut at runtime, I get the following warnings:\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.\n\nThanks!", "body": "I'm also having trouble finding the correct compiler flags to enable SSE4.1, SSE4.2 and AVX instructions. If anyone has insights, I'd really appreciate it.\r\n\r\nBuilding on a Retina MBP with 2.6 GHz Intel Core i7 on Mac OS X El Capitan 10.11.6 \r\nfrom commit https://github.com/tensorflow/tensorflow/commit/d4b5c606fc9fbd1a20b5b113b4bc831f31d889a3 with this custom build rule:\r\n```\r\ncc_binary(\r\n    name = \"libtensorflow_all.so\",\r\n    linkshared = 1,\r\n    deps = [\r\n    \t\"//tensorflow/c:c_api\",\r\n        \"//tensorflow/cc:cc_ops\",\r\n        \"//tensorflow/core:framework_internal\",\r\n        \"//tensorflow/core:tensorflow\",\r\n    ],\r\n)\r\n```\r\n\r\nBased on [this StackOverflow thread](http://stackoverflow.com/questions/41293077/how-to-compile-tensorflow-with-sse4-2-and-avx-instructions), I tried:\r\n\r\n```\r\nbazel build -c opt --copt=-mavx --copt=-mavx2 --copt=-mfma --copt=-mfpmath=both --copt=-msse4.2 tensorflow:libtensorflow_all.so\r\n```\r\n\r\nwhich threw the compiler error:\r\n\r\n```\r\nERROR: /private/var/tmp/_bazel_pjh/932673a2a7490816ef213d3cdb401ef6/external/gif_archive/BUILD:8:1: C++ compilation of rule '@gif_archive//:gif' failed: cc_wrapper.sh failed: error executing command external/local_config_cc/cc_wrapper.sh -U_FORTIFY_SOURCE '-D_FORTIFY_SOURCE=1' -fstack-protector -Wall -Wthread-safety -Wself-assign -fcolor-diagnostics -fno-omit-frame-pointer -g0 -O2 -DNDEBUG ... (remaining 33 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\r\nerror: unknown FP unit 'both'\r\n```\r\n\r\nI was able to compile with this modification:\r\n```\r\nbazel build -c opt --copt=-mavx --copt=-mavx2 --copt=-mfma --copt=-msse4.2 tensorflow:libtensorflow_all.so\r\n```\r\n\r\nbut the resulting .so immediately crashed at runtime.\r\n\r\nI recompiled with the basic:\r\n```\r\nbazel build tensorflow:libtensorflow_all.so\r\n```\r\n\r\nbut at runtime, I get the following warnings:\r\n```\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.\r\n```\r\n\r\nThanks!"}