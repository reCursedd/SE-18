{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/409779940", "html_url": "https://github.com/tensorflow/tensorflow/issues/21230#issuecomment-409779940", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21230", "id": 409779940, "node_id": "MDEyOklzc3VlQ29tbWVudDQwOTc3OTk0MA==", "user": {"login": "pcub", "id": 7065417, "node_id": "MDQ6VXNlcjcwNjU0MTc=", "avatar_url": "https://avatars0.githubusercontent.com/u/7065417?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcub", "html_url": "https://github.com/pcub", "followers_url": "https://api.github.com/users/pcub/followers", "following_url": "https://api.github.com/users/pcub/following{/other_user}", "gists_url": "https://api.github.com/users/pcub/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcub/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcub/subscriptions", "organizations_url": "https://api.github.com/users/pcub/orgs", "repos_url": "https://api.github.com/users/pcub/repos", "events_url": "https://api.github.com/users/pcub/events{/privacy}", "received_events_url": "https://api.github.com/users/pcub/received_events", "type": "User", "site_admin": false}, "created_at": "2018-08-02T01:54:24Z", "updated_at": "2018-08-02T04:36:08Z", "author_association": "NONE", "body_html": "<p>yes, my network output nodes are:<br>\nshape of anchors (4, 1917) &lt;dtype: 'float32'&gt;<br>\nshape of box_encodings (1, 1917, 4) &lt;dtype: 'float32'&gt;<br>\nshape of class_predictions (1, 1917, 21) &lt;dtype: 'float32'&gt;<br>\ncode that I used to generate is:</p>\n<blockquote>\n<p>outputNodes = ['raw_outputs/box_encodings', 'raw_outputs/class_predictions', 'anchors']<br>\nPATH_TO_PB = \"model.pb\"<br>\ninput_checkpoint = \"model.ckpt\"<br>\ninputGraph = tf.GraphDef()<br>\nwith tf.gfile.GFile(PATH_TO_PB, 'rb') as fid:<br>\nserialized_graph = fid.read()<br>\ninputGraph.ParseFromString(serialized_graph)<br>\ntf.import_graph_def(inputGraph, name='')<br>\nnum_classes= 21<br>\nnms_score_threshold = {0.9}<br>\nnms_iou_threshold = {0.9}<br>\nmax_detections, max_classes_per_detection = 5, 2<br>\nscale_values = {}<br>\nscale_values['y_scale'] = {10.0}<br>\nscale_values['x_scale'] = {10.0}<br>\nscale_values['h_scale'] = {5.0}<br>\nscale_values['w_scale'] = {5.0}<br>\nfrozen_graph_def = exporter.freeze_graph_with_def_protos(<br>\ninput_graph_def=inputGraph,<br>\ninput_saver_def=\"\",<br>\ninput_checkpoint=input_checkpoint,<br>\noutput_node_names=','.join(outputNodes),<br>\nrestore_op_name='save/restore_all',<br>\nfilename_tensor_name='save/Const:0',<br>\nclear_devices=True,<br>\ninitializer_nodes='')<br>\nadd_postprocessing_op = True<br>\nif add_postprocessing_op:<br>\ntransformed_graph_def = export_tflite_ssd_graph_lib.append_postprocessing_op(frozen_graph_def, max_detections, max_classes_per_detection,nms_score_threshold, nms_iou_threshold, num_classes, scale_values)<br>\nelse:<br>\ntransformed_graph_def = frozen_graph_def<br>\nbinary_graph = 'tflite_graph.pb'<br>\nwith tf.gfile.GFile(binary_graph, 'wb') as f:<br>\nf.write(transformed_graph_def.SerializeToString())<br>\ntxt_graph = 'tflite_graph.pbtxt'<br>\nwith tf.gfile.GFile(txt_graph, 'w') as f:<br>\nf.write(str(transformed_graph_def))</p>\n</blockquote>\n<p>after generating detect.tflite and installing android apk, bboxes are exceed the image size and confidence values are not in range between 0 and 1.</p>", "body_text": "yes, my network output nodes are:\nshape of anchors (4, 1917) <dtype: 'float32'>\nshape of box_encodings (1, 1917, 4) <dtype: 'float32'>\nshape of class_predictions (1, 1917, 21) <dtype: 'float32'>\ncode that I used to generate is:\n\noutputNodes = ['raw_outputs/box_encodings', 'raw_outputs/class_predictions', 'anchors']\nPATH_TO_PB = \"model.pb\"\ninput_checkpoint = \"model.ckpt\"\ninputGraph = tf.GraphDef()\nwith tf.gfile.GFile(PATH_TO_PB, 'rb') as fid:\nserialized_graph = fid.read()\ninputGraph.ParseFromString(serialized_graph)\ntf.import_graph_def(inputGraph, name='')\nnum_classes= 21\nnms_score_threshold = {0.9}\nnms_iou_threshold = {0.9}\nmax_detections, max_classes_per_detection = 5, 2\nscale_values = {}\nscale_values['y_scale'] = {10.0}\nscale_values['x_scale'] = {10.0}\nscale_values['h_scale'] = {5.0}\nscale_values['w_scale'] = {5.0}\nfrozen_graph_def = exporter.freeze_graph_with_def_protos(\ninput_graph_def=inputGraph,\ninput_saver_def=\"\",\ninput_checkpoint=input_checkpoint,\noutput_node_names=','.join(outputNodes),\nrestore_op_name='save/restore_all',\nfilename_tensor_name='save/Const:0',\nclear_devices=True,\ninitializer_nodes='')\nadd_postprocessing_op = True\nif add_postprocessing_op:\ntransformed_graph_def = export_tflite_ssd_graph_lib.append_postprocessing_op(frozen_graph_def, max_detections, max_classes_per_detection,nms_score_threshold, nms_iou_threshold, num_classes, scale_values)\nelse:\ntransformed_graph_def = frozen_graph_def\nbinary_graph = 'tflite_graph.pb'\nwith tf.gfile.GFile(binary_graph, 'wb') as f:\nf.write(transformed_graph_def.SerializeToString())\ntxt_graph = 'tflite_graph.pbtxt'\nwith tf.gfile.GFile(txt_graph, 'w') as f:\nf.write(str(transformed_graph_def))\n\nafter generating detect.tflite and installing android apk, bboxes are exceed the image size and confidence values are not in range between 0 and 1.", "body": "yes, my network output nodes are:\r\nshape of anchors (4, 1917) <dtype: 'float32'>\r\nshape of box_encodings (1, 1917, 4) <dtype: 'float32'>\r\nshape of class_predictions (1, 1917, 21) <dtype: 'float32'>\r\ncode that I used to generate is:\r\n\r\n>outputNodes = ['raw_outputs/box_encodings', 'raw_outputs/class_predictions', 'anchors']\r\nPATH_TO_PB = \"model.pb\"\r\ninput_checkpoint = \"model.ckpt\"\r\ninputGraph = tf.GraphDef()\r\nwith tf.gfile.GFile(PATH_TO_PB, 'rb') as fid:\r\n    serialized_graph = fid.read()\r\n    inputGraph.ParseFromString(serialized_graph)\r\n    tf.import_graph_def(inputGraph, name='')\r\nnum_classes= 21\r\nnms_score_threshold = {0.9}\r\nnms_iou_threshold = {0.9}\r\nmax_detections, max_classes_per_detection = 5, 2\r\nscale_values = {}\r\nscale_values['y_scale'] = {10.0}\r\nscale_values['x_scale'] = {10.0}\r\nscale_values['h_scale'] = {5.0}\r\nscale_values['w_scale'] = {5.0}\r\nfrozen_graph_def = exporter.freeze_graph_with_def_protos(\r\n      input_graph_def=inputGraph,\r\n      input_saver_def=\"\",\r\n      input_checkpoint=input_checkpoint,\r\n      output_node_names=','.join(outputNodes),\r\n      restore_op_name='save/restore_all',\r\n      filename_tensor_name='save/Const:0',\r\n      clear_devices=True,\r\n      initializer_nodes='')\r\nadd_postprocessing_op = True\r\nif add_postprocessing_op:\r\n    transformed_graph_def = export_tflite_ssd_graph_lib.append_postprocessing_op(frozen_graph_def, max_detections, max_classes_per_detection,nms_score_threshold, nms_iou_threshold, num_classes, scale_values)\r\nelse:\r\n    transformed_graph_def = frozen_graph_def\r\nbinary_graph = 'tflite_graph.pb'\r\nwith tf.gfile.GFile(binary_graph, 'wb') as f:\r\n\tf.write(transformed_graph_def.SerializeToString())\r\ntxt_graph = 'tflite_graph.pbtxt'\r\nwith tf.gfile.GFile(txt_graph, 'w') as f:\r\n\tf.write(str(transformed_graph_def))\r\n\r\nafter generating detect.tflite and installing android apk, bboxes are exceed the image size and confidence values are not in range between 0 and 1.\r\n\r\n"}