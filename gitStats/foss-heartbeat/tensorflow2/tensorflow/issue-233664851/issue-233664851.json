{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10439", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10439/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10439/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10439/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/10439", "id": 233664851, "node_id": "MDU6SXNzdWUyMzM2NjQ4NTE=", "number": 10439, "title": "Different timelines on QueueDequeManyV2 in cpu and gpu installations", "user": {"login": "svetlov", "id": 1593310, "node_id": "MDQ6VXNlcjE1OTMzMTA=", "avatar_url": "https://avatars3.githubusercontent.com/u/1593310?v=4", "gravatar_id": "", "url": "https://api.github.com/users/svetlov", "html_url": "https://github.com/svetlov", "followers_url": "https://api.github.com/users/svetlov/followers", "following_url": "https://api.github.com/users/svetlov/following{/other_user}", "gists_url": "https://api.github.com/users/svetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/svetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/svetlov/subscriptions", "organizations_url": "https://api.github.com/users/svetlov/orgs", "repos_url": "https://api.github.com/users/svetlov/repos", "events_url": "https://api.github.com/users/svetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/svetlov/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "zheng-xq", "id": 15736910, "node_id": "MDQ6VXNlcjE1NzM2OTEw", "avatar_url": "https://avatars0.githubusercontent.com/u/15736910?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zheng-xq", "html_url": "https://github.com/zheng-xq", "followers_url": "https://api.github.com/users/zheng-xq/followers", "following_url": "https://api.github.com/users/zheng-xq/following{/other_user}", "gists_url": "https://api.github.com/users/zheng-xq/gists{/gist_id}", "starred_url": "https://api.github.com/users/zheng-xq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zheng-xq/subscriptions", "organizations_url": "https://api.github.com/users/zheng-xq/orgs", "repos_url": "https://api.github.com/users/zheng-xq/repos", "events_url": "https://api.github.com/users/zheng-xq/events{/privacy}", "received_events_url": "https://api.github.com/users/zheng-xq/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "zheng-xq", "id": 15736910, "node_id": "MDQ6VXNlcjE1NzM2OTEw", "avatar_url": "https://avatars0.githubusercontent.com/u/15736910?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zheng-xq", "html_url": "https://github.com/zheng-xq", "followers_url": "https://api.github.com/users/zheng-xq/followers", "following_url": "https://api.github.com/users/zheng-xq/following{/other_user}", "gists_url": "https://api.github.com/users/zheng-xq/gists{/gist_id}", "starred_url": "https://api.github.com/users/zheng-xq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zheng-xq/subscriptions", "organizations_url": "https://api.github.com/users/zheng-xq/orgs", "repos_url": "https://api.github.com/users/zheng-xq/repos", "events_url": "https://api.github.com/users/zheng-xq/events{/privacy}", "received_events_url": "https://api.github.com/users/zheng-xq/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 12, "created_at": "2017-06-05T18:04:17Z", "updated_at": "2018-05-17T10:09:59Z", "closed_at": "2018-05-17T10:09:59Z", "author_association": "NONE", "body_html": "<p>OS Platform and Distribution: Ubuntu 14.04<br>\nTensorFlow version:<br>\ncpu: ('v1.1.0-rc0-61-g1ec6ed5', '1.1.0')<br>\ngpu:  ('v1.1.0-rc0-61-g1ec6ed5', '1.1.0')</p>\n<p>CUDA/cuDNN: 8.0/5.0</p>\n<p>env: <a href=\"https://pastebin.com/f70fQ9Mw\" rel=\"nofollow\">https://pastebin.com/f70fQ9Mw</a></p>\n<p>I'm trying to fill queue of input data in additional thread in python, but obtain very strange timings for this operation, different for cpu and gpu version in 20 times. as you can see in full script, i forced device to cpu</p>\n<p>full script i'm using to fill queue: <a href=\"https://pastebin.com/Ny1QVZh2\" rel=\"nofollow\">https://pastebin.com/Ny1QVZh2</a></p>\n<p>key part:</p>\n<pre><code>    enqueue_op = queue.enqueue_many([queue_input_data, queue_input_target])\n    dequeue_op = queue.dequeue()\n \n    data_batch, target_batch = tf.train.batch(dequeue_op, batch_size=batch_size, capacity=10 * batch_size)\n \n    def enqueue(sess):\n        while True:\n            sess.run(enqueue_op, feed_dict={queue_input_data: data, queue_input_target: target})\n\n...\n\n    run_options = tf.RunOptions(timeout_in_ms=4000, trace_level=tf.RunOptions.FULL_TRACE)\n    run_metadata = tf.RunMetadata()\n    sess.run(\n        target_batch,\n        options=run_options,\n        run_metadata=run_metadata)\n \n    tl = timeline.Timeline(run_metadata.step_stats)\n    ctf = tl.generate_chrome_trace_format()\n    with open('timeline.json', 'w') as f:\n        f.write(ctf)\n</code></pre>\n<p>Steps to reproduce:</p>\n<pre><code># cpu only version\npip install https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-1.1.0-cp27-none-linux_x86_64.whl\npython read_feed_dict.py\nmv timeline.json timeline_cpu_version.json\n\npip uninstall tensorflow\n\n# gpu version\npip install https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.1.0-cp27-none-linux_x86_64.whl\npython read_feed_dict.py\nmv timeline.json timeline_gpu_version.json\n</code></pre>\n<p>cpu timeline:<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://cloud.githubusercontent.com/assets/1593310/26796368/f636b37e-4a31-11e7-8851-863e74643697.png\"><img src=\"https://cloud.githubusercontent.com/assets/1593310/26796368/f636b37e-4a31-11e7-8851-863e74643697.png\" alt=\"cpu\" style=\"max-width:100%;\"></a></p>\n<p>gpu timeline:<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://cloud.githubusercontent.com/assets/1593310/26796369/f640d688-4a31-11e7-989d-197a7f2499e7.png\"><img src=\"https://cloud.githubusercontent.com/assets/1593310/26796369/f640d688-4a31-11e7-989d-197a7f2499e7.png\" alt=\"gpu\" style=\"max-width:100%;\"></a></p>", "body_text": "OS Platform and Distribution: Ubuntu 14.04\nTensorFlow version:\ncpu: ('v1.1.0-rc0-61-g1ec6ed5', '1.1.0')\ngpu:  ('v1.1.0-rc0-61-g1ec6ed5', '1.1.0')\nCUDA/cuDNN: 8.0/5.0\nenv: https://pastebin.com/f70fQ9Mw\nI'm trying to fill queue of input data in additional thread in python, but obtain very strange timings for this operation, different for cpu and gpu version in 20 times. as you can see in full script, i forced device to cpu\nfull script i'm using to fill queue: https://pastebin.com/Ny1QVZh2\nkey part:\n    enqueue_op = queue.enqueue_many([queue_input_data, queue_input_target])\n    dequeue_op = queue.dequeue()\n \n    data_batch, target_batch = tf.train.batch(dequeue_op, batch_size=batch_size, capacity=10 * batch_size)\n \n    def enqueue(sess):\n        while True:\n            sess.run(enqueue_op, feed_dict={queue_input_data: data, queue_input_target: target})\n\n...\n\n    run_options = tf.RunOptions(timeout_in_ms=4000, trace_level=tf.RunOptions.FULL_TRACE)\n    run_metadata = tf.RunMetadata()\n    sess.run(\n        target_batch,\n        options=run_options,\n        run_metadata=run_metadata)\n \n    tl = timeline.Timeline(run_metadata.step_stats)\n    ctf = tl.generate_chrome_trace_format()\n    with open('timeline.json', 'w') as f:\n        f.write(ctf)\n\nSteps to reproduce:\n# cpu only version\npip install https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-1.1.0-cp27-none-linux_x86_64.whl\npython read_feed_dict.py\nmv timeline.json timeline_cpu_version.json\n\npip uninstall tensorflow\n\n# gpu version\npip install https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.1.0-cp27-none-linux_x86_64.whl\npython read_feed_dict.py\nmv timeline.json timeline_gpu_version.json\n\ncpu timeline:\n\ngpu timeline:", "body": "OS Platform and Distribution: Ubuntu 14.04\r\nTensorFlow version: \r\n    cpu: ('v1.1.0-rc0-61-g1ec6ed5', '1.1.0')\r\n    gpu:  ('v1.1.0-rc0-61-g1ec6ed5', '1.1.0')\r\n\r\nCUDA/cuDNN: 8.0/5.0\r\n\r\nenv: https://pastebin.com/f70fQ9Mw\r\n\r\nI'm trying to fill queue of input data in additional thread in python, but obtain very strange timings for this operation, different for cpu and gpu version in 20 times. as you can see in full script, i forced device to cpu \r\n\r\nfull script i'm using to fill queue: https://pastebin.com/Ny1QVZh2\r\n\r\nkey part:\r\n```\r\n    enqueue_op = queue.enqueue_many([queue_input_data, queue_input_target])\r\n    dequeue_op = queue.dequeue()\r\n \r\n    data_batch, target_batch = tf.train.batch(dequeue_op, batch_size=batch_size, capacity=10 * batch_size)\r\n \r\n    def enqueue(sess):\r\n        while True:\r\n            sess.run(enqueue_op, feed_dict={queue_input_data: data, queue_input_target: target})\r\n\r\n...\r\n\r\n    run_options = tf.RunOptions(timeout_in_ms=4000, trace_level=tf.RunOptions.FULL_TRACE)\r\n    run_metadata = tf.RunMetadata()\r\n    sess.run(\r\n        target_batch,\r\n        options=run_options,\r\n        run_metadata=run_metadata)\r\n \r\n    tl = timeline.Timeline(run_metadata.step_stats)\r\n    ctf = tl.generate_chrome_trace_format()\r\n    with open('timeline.json', 'w') as f:\r\n        f.write(ctf)\r\n```\r\nSteps to reproduce:\r\n```\r\n# cpu only version\r\npip install https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-1.1.0-cp27-none-linux_x86_64.whl\r\npython read_feed_dict.py\r\nmv timeline.json timeline_cpu_version.json\r\n\r\npip uninstall tensorflow\r\n\r\n# gpu version\r\npip install https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.1.0-cp27-none-linux_x86_64.whl\r\npython read_feed_dict.py\r\nmv timeline.json timeline_gpu_version.json\r\n```\r\ncpu timeline:\r\n![cpu](https://cloud.githubusercontent.com/assets/1593310/26796368/f636b37e-4a31-11e7-8851-863e74643697.png)\r\n\r\ngpu timeline:\r\n![gpu](https://cloud.githubusercontent.com/assets/1593310/26796369/f640d688-4a31-11e7-989d-197a7f2499e7.png)\r\n\r\n\r\n\r\n\r\n"}