{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8550", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8550/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8550/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8550/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/8550", "id": 215354152, "node_id": "MDU6SXNzdWUyMTUzNTQxNTI=", "number": 8550, "title": "Android \"TF Stylize\" demo crash with \"input_max_range must be larger than input_min_range\"", "user": {"login": "BrianOn99", "id": 8319689, "node_id": "MDQ6VXNlcjgzMTk2ODk=", "avatar_url": "https://avatars3.githubusercontent.com/u/8319689?v=4", "gravatar_id": "", "url": "https://api.github.com/users/BrianOn99", "html_url": "https://github.com/BrianOn99", "followers_url": "https://api.github.com/users/BrianOn99/followers", "following_url": "https://api.github.com/users/BrianOn99/following{/other_user}", "gists_url": "https://api.github.com/users/BrianOn99/gists{/gist_id}", "starred_url": "https://api.github.com/users/BrianOn99/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/BrianOn99/subscriptions", "organizations_url": "https://api.github.com/users/BrianOn99/orgs", "repos_url": "https://api.github.com/users/BrianOn99/repos", "events_url": "https://api.github.com/users/BrianOn99/events{/privacy}", "received_events_url": "https://api.github.com/users/BrianOn99/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "andrewharp", "id": 3376817, "node_id": "MDQ6VXNlcjMzNzY4MTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/3376817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewharp", "html_url": "https://github.com/andrewharp", "followers_url": "https://api.github.com/users/andrewharp/followers", "following_url": "https://api.github.com/users/andrewharp/following{/other_user}", "gists_url": "https://api.github.com/users/andrewharp/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewharp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewharp/subscriptions", "organizations_url": "https://api.github.com/users/andrewharp/orgs", "repos_url": "https://api.github.com/users/andrewharp/repos", "events_url": "https://api.github.com/users/andrewharp/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewharp/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "andrewharp", "id": 3376817, "node_id": "MDQ6VXNlcjMzNzY4MTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/3376817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewharp", "html_url": "https://github.com/andrewharp", "followers_url": "https://api.github.com/users/andrewharp/followers", "following_url": "https://api.github.com/users/andrewharp/following{/other_user}", "gists_url": "https://api.github.com/users/andrewharp/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewharp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewharp/subscriptions", "organizations_url": "https://api.github.com/users/andrewharp/orgs", "repos_url": "https://api.github.com/users/andrewharp/repos", "events_url": "https://api.github.com/users/andrewharp/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewharp/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 49, "created_at": "2017-03-20T08:29:22Z", "updated_at": "2018-08-06T02:31:03Z", "closed_at": "2018-08-06T02:30:44Z", "author_association": "NONE", "body_html": "<p>I have compiled and installed the demo app according to the instruction in the <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/android/README.md\">README</a>.  The \"TF Detect\" and \"TF Classify\" apps are working as expected.  However, starting the \"TF Stylize\" app, it always crashes in about 3 seconds.  The prebuilt apk crashes in the same way.  Here is the android logcat recorded:</p>\n<blockquote>\n<p>$ adb -s b80360c7 logcat  | grep Tensor<br>\nI/TensorFlowInferenceInterface( 6801): Checking to see if TensorFlow native methods are already loaded<br>\nI/TensorFlowInferenceInterface( 6801): TensorFlow native methods not found, attempting to load via tensorflow_inference<br>\nI/TensorFlowInferenceInterface( 6801): Successfully loaded TensorFlow native methods (RunStats error may be ignored)<br>\nI/TensorFlowInferenceInterface( 6801): Model load took 540ms, TensorFlow version: 1.0.1<br>\nI/TensorFlowInferenceInterface( 6801): Successfully loaded model from 'file:///android_asset/stylize_quantized.pb'<br>\nE/TensorFlowInferenceInterface( 6801): Failed to run TensorFlow inference with inputs:[input, style_num], outputs:[transformer/expand/conv3/conv/Sigmoid]<br>\nE/TensorFlowInferenceInterface( 6801): Inference exception: java.lang.IllegalArgumentException: input_max_range must be larger than input_min_range.<br>\nE/TensorFlowInferenceInterface( 6801):   [[Node: transformer/contract/conv1/Relu_eightbit_quantize_transformer/contract/conv1/InstanceNorm/batchnorm/add_1 = QuantizeV2[T=DT_QUINT8, mode=\"MIN_FIRST\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](transformer/contract/conv1/InstanceNorm/batchnorm/add_1, transformer/contract/conv1/Relu_eightbit_min_transformer/contract/conv1/InstanceNorm/batchnorm/add_1, transformer/contract/conv1/Relu_eightbit_max_transformer/contract/conv1/InstanceNorm/batchnorm/add_1)]]<br>\nE/AndroidRuntime( 6801):        at org.tensorflow.contrib.android.TensorFlowInferenceInterface.getTensor(TensorFlowInferenceInterface.java:486)<br>\nE/AndroidRuntime( 6801):        at org.tensorflow.contrib.android.TensorFlowInferenceInterface.readNodeIntoFloatBuffer(TensorFlowInferenceInterface.java:332)<br>\nE/AndroidRuntime( 6801):        at org.tensorflow.contrib.android.TensorFlowInferenceInterface.readNodeFloat(TensorFlowInferenceInterface.java:287)</p>\n</blockquote>\n<p>As can be inferred from the logcat, the problem happens in <code>tensorflow/core/kernels/quantize_op.cc</code> line 71.  The app is using a quantized model.  I found that <code>input_min_range</code> is set to be <code>inf</code>, and <code>input_max_range</code> is <code>-inf</code>, which is obviously wrong.</p>\n<p>What should be done to fix it?</p>\n<p>The crash appears on Samsung Galaxy S4, but does not appears on emulator with Intel CPU.</p>\n<p>[Edit]<br>\nWith more experiment I found that sometimes the apps works without crashing, about 1 out of 10 trials.</p>", "body_text": "I have compiled and installed the demo app according to the instruction in the README.  The \"TF Detect\" and \"TF Classify\" apps are working as expected.  However, starting the \"TF Stylize\" app, it always crashes in about 3 seconds.  The prebuilt apk crashes in the same way.  Here is the android logcat recorded:\n\n$ adb -s b80360c7 logcat  | grep Tensor\nI/TensorFlowInferenceInterface( 6801): Checking to see if TensorFlow native methods are already loaded\nI/TensorFlowInferenceInterface( 6801): TensorFlow native methods not found, attempting to load via tensorflow_inference\nI/TensorFlowInferenceInterface( 6801): Successfully loaded TensorFlow native methods (RunStats error may be ignored)\nI/TensorFlowInferenceInterface( 6801): Model load took 540ms, TensorFlow version: 1.0.1\nI/TensorFlowInferenceInterface( 6801): Successfully loaded model from 'file:///android_asset/stylize_quantized.pb'\nE/TensorFlowInferenceInterface( 6801): Failed to run TensorFlow inference with inputs:[input, style_num], outputs:[transformer/expand/conv3/conv/Sigmoid]\nE/TensorFlowInferenceInterface( 6801): Inference exception: java.lang.IllegalArgumentException: input_max_range must be larger than input_min_range.\nE/TensorFlowInferenceInterface( 6801):   [[Node: transformer/contract/conv1/Relu_eightbit_quantize_transformer/contract/conv1/InstanceNorm/batchnorm/add_1 = QuantizeV2[T=DT_QUINT8, mode=\"MIN_FIRST\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](transformer/contract/conv1/InstanceNorm/batchnorm/add_1, transformer/contract/conv1/Relu_eightbit_min_transformer/contract/conv1/InstanceNorm/batchnorm/add_1, transformer/contract/conv1/Relu_eightbit_max_transformer/contract/conv1/InstanceNorm/batchnorm/add_1)]]\nE/AndroidRuntime( 6801):        at org.tensorflow.contrib.android.TensorFlowInferenceInterface.getTensor(TensorFlowInferenceInterface.java:486)\nE/AndroidRuntime( 6801):        at org.tensorflow.contrib.android.TensorFlowInferenceInterface.readNodeIntoFloatBuffer(TensorFlowInferenceInterface.java:332)\nE/AndroidRuntime( 6801):        at org.tensorflow.contrib.android.TensorFlowInferenceInterface.readNodeFloat(TensorFlowInferenceInterface.java:287)\n\nAs can be inferred from the logcat, the problem happens in tensorflow/core/kernels/quantize_op.cc line 71.  The app is using a quantized model.  I found that input_min_range is set to be inf, and input_max_range is -inf, which is obviously wrong.\nWhat should be done to fix it?\nThe crash appears on Samsung Galaxy S4, but does not appears on emulator with Intel CPU.\n[Edit]\nWith more experiment I found that sometimes the apps works without crashing, about 1 out of 10 trials.", "body": "I have compiled and installed the demo app according to the instruction in the [README](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/android/README.md).  The \"TF Detect\" and \"TF Classify\" apps are working as expected.  However, starting the \"TF Stylize\" app, it always crashes in about 3 seconds.  The prebuilt apk crashes in the same way.  Here is the android logcat recorded:\r\n\r\n> $ adb -s b80360c7 logcat  | grep Tensor\r\nI/TensorFlowInferenceInterface( 6801): Checking to see if TensorFlow native methods are already loaded\r\nI/TensorFlowInferenceInterface( 6801): TensorFlow native methods not found, attempting to load via tensorflow_inference\r\nI/TensorFlowInferenceInterface( 6801): Successfully loaded TensorFlow native methods (RunStats error may be ignored)\r\nI/TensorFlowInferenceInterface( 6801): Model load took 540ms, TensorFlow version: 1.0.1\r\nI/TensorFlowInferenceInterface( 6801): Successfully loaded model from 'file:///android_asset/stylize_quantized.pb'\r\nE/TensorFlowInferenceInterface( 6801): Failed to run TensorFlow inference with inputs:[input, style_num], outputs:[transformer/expand/conv3/conv/Sigmoid]\r\nE/TensorFlowInferenceInterface( 6801): Inference exception: java.lang.IllegalArgumentException: input_max_range must be larger than input_min_range.\r\nE/TensorFlowInferenceInterface( 6801):   [[Node: transformer/contract/conv1/Relu_eightbit_quantize_transformer/contract/conv1/InstanceNorm/batchnorm/add_1 = QuantizeV2[T=DT_QUINT8, mode=\"MIN_FIRST\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](transformer/contract/conv1/InstanceNorm/batchnorm/add_1, transformer/contract/conv1/Relu_eightbit_min_transformer/contract/conv1/InstanceNorm/batchnorm/add_1, transformer/contract/conv1/Relu_eightbit_max_transformer/contract/conv1/InstanceNorm/batchnorm/add_1)]]\r\nE/AndroidRuntime( 6801):        at org.tensorflow.contrib.android.TensorFlowInferenceInterface.getTensor(TensorFlowInferenceInterface.java:486)\r\nE/AndroidRuntime( 6801):        at org.tensorflow.contrib.android.TensorFlowInferenceInterface.readNodeIntoFloatBuffer(TensorFlowInferenceInterface.java:332)\r\nE/AndroidRuntime( 6801):        at org.tensorflow.contrib.android.TensorFlowInferenceInterface.readNodeFloat(TensorFlowInferenceInterface.java:287)\r\n\r\nAs can be inferred from the logcat, the problem happens in `tensorflow/core/kernels/quantize_op.cc` line 71.  The app is using a quantized model.  I found that `input_min_range` is set to be `inf`, and `input_max_range` is `-inf`, which is obviously wrong.\r\n\r\nWhat should be done to fix it?\r\n\r\nThe crash appears on Samsung Galaxy S4, but does not appears on emulator with Intel CPU.\r\n\r\n[Edit]\r\nWith more experiment I found that sometimes the apps works without crashing, about 1 out of 10 trials."}