{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3825", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3825/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3825/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3825/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/3825", "id": 171236819, "node_id": "MDU6SXNzdWUxNzEyMzY4MTk=", "number": 3825, "title": "A bug with a default initialiser and tf.nn.rnn_cell.LSTMCell/tf.contrib.rnn.LSTMFusedCell", "user": {"login": "avostryakov", "id": 174194, "node_id": "MDQ6VXNlcjE3NDE5NA==", "avatar_url": "https://avatars2.githubusercontent.com/u/174194?v=4", "gravatar_id": "", "url": "https://api.github.com/users/avostryakov", "html_url": "https://github.com/avostryakov", "followers_url": "https://api.github.com/users/avostryakov/followers", "following_url": "https://api.github.com/users/avostryakov/following{/other_user}", "gists_url": "https://api.github.com/users/avostryakov/gists{/gist_id}", "starred_url": "https://api.github.com/users/avostryakov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/avostryakov/subscriptions", "organizations_url": "https://api.github.com/users/avostryakov/orgs", "repos_url": "https://api.github.com/users/avostryakov/repos", "events_url": "https://api.github.com/users/avostryakov/events{/privacy}", "received_events_url": "https://api.github.com/users/avostryakov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2016-08-15T18:58:16Z", "updated_at": "2016-09-19T22:30:10Z", "closed_at": "2016-09-19T22:30:10Z", "author_association": "NONE", "body_html": "<h3>Environment info</h3>\n<p>Operating System:<br>\nMac OS X 10.9.5</p>\n<p>Installed version of CUDA and cuDNN:<br>\n(please attach the output of <code>ls -l /path/to/cuda/lib/libcud*</code>):<br>\nNo CUDA</p>\n<p>If installed from binary pip package, provide:<br>\npip install <a href=\"http://ci.tensorflow.org/view/Nightly/job/nightly-matrix-cpu/TF_BUILD_CONTAINER_TYPE=CPU,TF_BUILD_IS_OPT=OPT,TF_BUILD_IS_PIP=PIP,TF_BUILD_PYTHON_VERSION=PYTHON2,label=mac1-slave/lastSuccessfulBuild/artifact/pip_test/whl/tensorflow-0.10.0rc0-py2-none-any.whl\" rel=\"nofollow\">http://ci.tensorflow.org/view/Nightly/job/nightly-matrix-cpu/TF_BUILD_CONTAINER_TYPE=CPU,TF_BUILD_IS_OPT=OPT,TF_BUILD_IS_PIP=PIP,TF_BUILD_PYTHON_VERSION=PYTHON2,label=mac1-slave/lastSuccessfulBuild/artifact/pip_test/whl/tensorflow-0.10.0rc0-py2-none-any.whl</a></p>\n<ol>\n<li>Which pip package you installed.</li>\n<li>The output from <code>python -c \"import tensorflow; print(tensorflow.__version__)\"</code>.<br>\n0.10.0rc0</li>\n</ol>\n<h3>Steps to reproduce</h3>\n<ol>\n<li>A minimum example to reproduce the bug:</li>\n</ol>\n<pre><code>import numpy as np\nimport tensorflow as tf\n\nwith tf.variable_scope(\"rnn\", initializer=tf.contrib.layers.xavier_initializer()):\n    out_cell = tf.nn.rnn_cell.LSTMCell(num_units=100, state_is_tuple=True, use_peepholes=True)\n    #out_cell = tf.contrib.rnn.LSTMFusedCell(num_units=100)\n    input_var = tf.placeholder(dtype=tf.float32, shape=(32, 50, 100))\n\n    d, _ = tf.nn.dynamic_rnn(out_cell, input_var, dtype=tf.float32, parallel_iterations=32,\n                                 scope=\"output_rnn\")\n    init = tf.initialize_all_variables()\n    with tf.Session() as sess:\n        input = np.random.uniform(-1.0, 1.0, [32, 50, 100])\n        sess.run(init)\n        o = sess.run([d], {input_var: input})\n\n</code></pre>\n<ol>\n<li>The same bug if you comment LSTMCell and uncomment LSTMFusedCell which was renamed to LSTMBlockCell recently</li>\n<li>If I remove \", initializer=tf.contrib.layers.xavier_initializer()\" in tf.variable_scope code will work without errrors with normal distribution by default. Or if I remove use_peepholes=True in LSTMCell the bug will disappear too.</li>\n</ol>\n<h3>What have you tried?</h3>\n<ol>\n<li></li>\n</ol>\n<h3>Logs or other output that would be helpful</h3>\n<p>Traceback (most recent call last):<br>\n....<br>\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 848, in dynamic_rnn<br>\ndtype=dtype)<br>\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 1015, in _dynamic_rnn_loop<br>\nswap_memory=swap_memory)<br>\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1992, in while_loop<br>\nresult = context.BuildLoop(cond, body, loop_vars)<br>\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1877, in BuildLoop<br>\npred, body, original_loop_vars, loop_vars)<br>\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1827, in _BuildLoop<br>\nbody_result = body(*packed_vars_for_body)<br>\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 1000, in _time_step<br>\n(output, new_state) = call_cell()<br>\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 986, in <br>\ncall_cell = lambda: cell(input_t, state)<br>\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/contrib/rnn/python/ops/lstm_ops.py\", line 443, in <strong>call</strong><br>\nwci = vs.get_variable(\"wci\", [self._num_units])<br>\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 830, in get_variable<br>\ncustom_getter=custom_getter)<br>\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 673, in get_variable<br>\ncustom_getter=custom_getter)<br>\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 217, in get_variable<br>\nvalidate_shape=validate_shape)<br>\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 202, in _true_getter<br>\ncaching_device=caching_device, validate_shape=validate_shape)<br>\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 536, in _get_single_variable<br>\nvalidate_shape=validate_shape)<br>\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 211, in <strong>init</strong><br>\ndtype=dtype)<br>\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 281, in _init_from_args<br>\nself._initial_value = ops.convert_to_tensor(initial_value(),<br>\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 526, in <br>\ninit_val = lambda: initializer(shape.as_list(), dtype=dtype)<br>\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/contrib/layers/python/layers/initializers.py\", line 114, in _initializer<br>\nfan_in = float(shape[-2])<br>\nIndexError: list index out of range<br>\nException TypeError: TypeError(\"'NoneType' object is not callable\",) in &lt;function _remove at 0x10248b6e0&gt; ignored</p>", "body_text": "Environment info\nOperating System:\nMac OS X 10.9.5\nInstalled version of CUDA and cuDNN:\n(please attach the output of ls -l /path/to/cuda/lib/libcud*):\nNo CUDA\nIf installed from binary pip package, provide:\npip install http://ci.tensorflow.org/view/Nightly/job/nightly-matrix-cpu/TF_BUILD_CONTAINER_TYPE=CPU,TF_BUILD_IS_OPT=OPT,TF_BUILD_IS_PIP=PIP,TF_BUILD_PYTHON_VERSION=PYTHON2,label=mac1-slave/lastSuccessfulBuild/artifact/pip_test/whl/tensorflow-0.10.0rc0-py2-none-any.whl\n\nWhich pip package you installed.\nThe output from python -c \"import tensorflow; print(tensorflow.__version__)\".\n0.10.0rc0\n\nSteps to reproduce\n\nA minimum example to reproduce the bug:\n\nimport numpy as np\nimport tensorflow as tf\n\nwith tf.variable_scope(\"rnn\", initializer=tf.contrib.layers.xavier_initializer()):\n    out_cell = tf.nn.rnn_cell.LSTMCell(num_units=100, state_is_tuple=True, use_peepholes=True)\n    #out_cell = tf.contrib.rnn.LSTMFusedCell(num_units=100)\n    input_var = tf.placeholder(dtype=tf.float32, shape=(32, 50, 100))\n\n    d, _ = tf.nn.dynamic_rnn(out_cell, input_var, dtype=tf.float32, parallel_iterations=32,\n                                 scope=\"output_rnn\")\n    init = tf.initialize_all_variables()\n    with tf.Session() as sess:\n        input = np.random.uniform(-1.0, 1.0, [32, 50, 100])\n        sess.run(init)\n        o = sess.run([d], {input_var: input})\n\n\n\nThe same bug if you comment LSTMCell and uncomment LSTMFusedCell which was renamed to LSTMBlockCell recently\nIf I remove \", initializer=tf.contrib.layers.xavier_initializer()\" in tf.variable_scope code will work without errrors with normal distribution by default. Or if I remove use_peepholes=True in LSTMCell the bug will disappear too.\n\nWhat have you tried?\n\n\n\nLogs or other output that would be helpful\nTraceback (most recent call last):\n....\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 848, in dynamic_rnn\ndtype=dtype)\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 1015, in _dynamic_rnn_loop\nswap_memory=swap_memory)\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1992, in while_loop\nresult = context.BuildLoop(cond, body, loop_vars)\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1877, in BuildLoop\npred, body, original_loop_vars, loop_vars)\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1827, in _BuildLoop\nbody_result = body(*packed_vars_for_body)\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 1000, in _time_step\n(output, new_state) = call_cell()\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 986, in \ncall_cell = lambda: cell(input_t, state)\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/contrib/rnn/python/ops/lstm_ops.py\", line 443, in call\nwci = vs.get_variable(\"wci\", [self._num_units])\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 830, in get_variable\ncustom_getter=custom_getter)\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 673, in get_variable\ncustom_getter=custom_getter)\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 217, in get_variable\nvalidate_shape=validate_shape)\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 202, in _true_getter\ncaching_device=caching_device, validate_shape=validate_shape)\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 536, in _get_single_variable\nvalidate_shape=validate_shape)\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 211, in init\ndtype=dtype)\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 281, in _init_from_args\nself._initial_value = ops.convert_to_tensor(initial_value(),\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 526, in \ninit_val = lambda: initializer(shape.as_list(), dtype=dtype)\nFile \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/contrib/layers/python/layers/initializers.py\", line 114, in _initializer\nfan_in = float(shape[-2])\nIndexError: list index out of range\nException TypeError: TypeError(\"'NoneType' object is not callable\",) in <function _remove at 0x10248b6e0> ignored", "body": "### Environment info\n\nOperating System:\nMac OS X 10.9.5 \n\nInstalled version of CUDA and cuDNN: \n(please attach the output of `ls -l /path/to/cuda/lib/libcud*`):\nNo CUDA\n\nIf installed from binary pip package, provide:\npip install http://ci.tensorflow.org/view/Nightly/job/nightly-matrix-cpu/TF_BUILD_CONTAINER_TYPE=CPU,TF_BUILD_IS_OPT=OPT,TF_BUILD_IS_PIP=PIP,TF_BUILD_PYTHON_VERSION=PYTHON2,label=mac1-slave/lastSuccessfulBuild/artifact/pip_test/whl/tensorflow-0.10.0rc0-py2-none-any.whl\n1. Which pip package you installed.\n2. The output from `python -c \"import tensorflow; print(tensorflow.__version__)\"`.\n   0.10.0rc0\n### Steps to reproduce\n1. A minimum example to reproduce the bug:\n\n```\nimport numpy as np\nimport tensorflow as tf\n\nwith tf.variable_scope(\"rnn\", initializer=tf.contrib.layers.xavier_initializer()):\n    out_cell = tf.nn.rnn_cell.LSTMCell(num_units=100, state_is_tuple=True, use_peepholes=True)\n    #out_cell = tf.contrib.rnn.LSTMFusedCell(num_units=100)\n    input_var = tf.placeholder(dtype=tf.float32, shape=(32, 50, 100))\n\n    d, _ = tf.nn.dynamic_rnn(out_cell, input_var, dtype=tf.float32, parallel_iterations=32,\n                                 scope=\"output_rnn\")\n    init = tf.initialize_all_variables()\n    with tf.Session() as sess:\n        input = np.random.uniform(-1.0, 1.0, [32, 50, 100])\n        sess.run(init)\n        o = sess.run([d], {input_var: input})\n\n```\n1. The same bug if you comment LSTMCell and uncomment LSTMFusedCell which was renamed to LSTMBlockCell recently\n2. If I remove \", initializer=tf.contrib.layers.xavier_initializer()\" in tf.variable_scope code will work without errrors with normal distribution by default. Or if I remove use_peepholes=True in LSTMCell the bug will disappear too.\n### What have you tried?\n\n1.\n### Logs or other output that would be helpful\n\nTraceback (most recent call last):\n....\n  File \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 848, in dynamic_rnn\n    dtype=dtype)\n  File \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 1015, in _dynamic_rnn_loop\n    swap_memory=swap_memory)\n  File \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1992, in while_loop\n    result = context.BuildLoop(cond, body, loop_vars)\n  File \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1877, in BuildLoop\n    pred, body, original_loop_vars, loop_vars)\n  File \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1827, in _BuildLoop\n    body_result = body(*packed_vars_for_body)\n  File \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 1000, in _time_step\n    (output, new_state) = call_cell()\n  File \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 986, in <lambda>\n    call_cell = lambda: cell(input_t, state)\n  File \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/contrib/rnn/python/ops/lstm_ops.py\", line 443, in __call__\n    wci = vs.get_variable(\"wci\", [self._num_units])\n  File \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 830, in get_variable\n    custom_getter=custom_getter)\n  File \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 673, in get_variable\n    custom_getter=custom_getter)\n  File \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 217, in get_variable\n    validate_shape=validate_shape)\n  File \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 202, in _true_getter\n    caching_device=caching_device, validate_shape=validate_shape)\n  File \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 536, in _get_single_variable\n    validate_shape=validate_shape)\n  File \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 211, in __init__\n    dtype=dtype)\n  File \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 281, in _init_from_args\n    self._initial_value = ops.convert_to_tensor(initial_value(),\n  File \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/python/ops/variable_scope.py\", line 526, in <lambda>\n    init_val = lambda: initializer(shape.as_list(), dtype=dtype)\n  File \"/Users/vostryakov/projects/senses/env/lib/python2.7/site-packages/tensorflow/contrib/layers/python/layers/initializers.py\", line 114, in _initializer\n    fan_in = float(shape[-2])\nIndexError: list index out of range\nException TypeError: TypeError(\"'NoneType' object is not callable\",) in <function _remove at 0x10248b6e0> ignored\n"}