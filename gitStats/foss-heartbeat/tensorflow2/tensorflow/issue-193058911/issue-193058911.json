{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6036", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6036/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6036/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6036/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/6036", "id": 193058911, "node_id": "MDU6SXNzdWUxOTMwNTg5MTE=", "number": 6036, "title": "File object not being closed properly in 6_lstm.ipynb", "user": {"login": "ronrest", "id": 10935663, "node_id": "MDQ6VXNlcjEwOTM1NjYz", "avatar_url": "https://avatars3.githubusercontent.com/u/10935663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronrest", "html_url": "https://github.com/ronrest", "followers_url": "https://api.github.com/users/ronrest/followers", "following_url": "https://api.github.com/users/ronrest/following{/other_user}", "gists_url": "https://api.github.com/users/ronrest/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronrest/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronrest/subscriptions", "organizations_url": "https://api.github.com/users/ronrest/orgs", "repos_url": "https://api.github.com/users/ronrest/repos", "events_url": "https://api.github.com/users/ronrest/events{/privacy}", "received_events_url": "https://api.github.com/users/ronrest/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2016-12-02T08:21:14Z", "updated_at": "2016-12-02T17:37:10Z", "closed_at": "2016-12-02T17:37:10Z", "author_association": "CONTRIBUTOR", "body_html": "<p>The <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/udacity/6_lstm.ipynb\"><strong>6_lstm.ipynb</strong></a> file contains the following code:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">def</span> <span class=\"pl-en\">read_data</span>(<span class=\"pl-smi\">filename</span>):\n  f <span class=\"pl-k\">=</span> zipfile.ZipFile(filename)\n  <span class=\"pl-k\">for</span> name <span class=\"pl-k\">in</span> f.namelist():\n    <span class=\"pl-k\">return</span> tf.compat.as_str(f.read(name))\n  f.close()</pre></div>\n<p>This code has the following issues:</p>\n<ul>\n<li>The file object <code>f</code> does not get to close properly, since the function is<br>\nexited before the <code>f.close()</code> method ever gets to be called.</li>\n<li>The <code>for</code> loop is uneccesary, since there is only one item in the zip file,<br>\n<em>and</em> since the <code>return</code> operator forces the loop to end on the first<br>\nloop anyway.</li>\n</ul>\n<p>I propose the following code instead:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">def</span> <span class=\"pl-en\">read_data</span>(<span class=\"pl-smi\">filename</span>):\n  <span class=\"pl-k\">with</span> zipfile.ZipFile(filename) <span class=\"pl-k\">as</span> f:\n    name <span class=\"pl-k\">=</span> f.namelist()[<span class=\"pl-c1\">0</span>]\n    data <span class=\"pl-k\">=</span> tf.compat.as_str(f.read(name))\n  <span class=\"pl-k\">return</span> data</pre></div>\n<p>This code fixes the issues in the following ways:</p>\n<ul>\n<li>The <code>with</code> statement will handle the file <code>f</code> being closed automatically, even<br>\nif there is an unexpected early termination.</li>\n<li>Since there is actually only one item in the zip file, then we can just get<br>\nthe zeroeth element in <code>f.namelist()</code></li>\n</ul>\n<p>I will create a pull request with this suggested code shortly.</p>", "body_text": "The 6_lstm.ipynb file contains the following code:\ndef read_data(filename):\n  f = zipfile.ZipFile(filename)\n  for name in f.namelist():\n    return tf.compat.as_str(f.read(name))\n  f.close()\nThis code has the following issues:\n\nThe file object f does not get to close properly, since the function is\nexited before the f.close() method ever gets to be called.\nThe for loop is uneccesary, since there is only one item in the zip file,\nand since the return operator forces the loop to end on the first\nloop anyway.\n\nI propose the following code instead:\ndef read_data(filename):\n  with zipfile.ZipFile(filename) as f:\n    name = f.namelist()[0]\n    data = tf.compat.as_str(f.read(name))\n  return data\nThis code fixes the issues in the following ways:\n\nThe with statement will handle the file f being closed automatically, even\nif there is an unexpected early termination.\nSince there is actually only one item in the zip file, then we can just get\nthe zeroeth element in f.namelist()\n\nI will create a pull request with this suggested code shortly.", "body": "The [**6_lstm.ipynb**](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/udacity/6_lstm.ipynb) file contains the following code: \r\n\r\n```python\r\ndef read_data(filename):\r\n  f = zipfile.ZipFile(filename)\r\n  for name in f.namelist():\r\n    return tf.compat.as_str(f.read(name))\r\n  f.close()\r\n```\r\n\r\nThis code has the following issues: \r\n\r\n- The file object `f` does not get to close properly, since the function is \r\n  exited before the `f.close()` method ever gets to be called. \r\n- The `for` loop is uneccesary, since there is only one item in the zip file, \r\n  *and* since the `return` operator forces the loop to end on the first \r\n  loop anyway. \r\n  \r\nI propose the following code instead: \r\n\r\n```python\r\ndef read_data(filename):\r\n  with zipfile.ZipFile(filename) as f:\r\n    name = f.namelist()[0]\r\n    data = tf.compat.as_str(f.read(name))\r\n  return data\r\n```\r\n\r\nThis code fixes the issues in the following ways: \r\n\r\n- The `with` statement will handle the file `f` being closed automatically, even \r\n  if there is an unexpected early termination. \r\n- Since there is actually only one item in the zip file, then we can just get \r\n  the zeroeth element in `f.namelist()`\r\n\r\nI will create a pull request with this suggested code shortly. "}