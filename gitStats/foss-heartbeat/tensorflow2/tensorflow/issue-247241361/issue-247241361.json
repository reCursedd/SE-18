{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11954", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11954/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11954/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11954/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/11954", "id": 247241361, "node_id": "MDU6SXNzdWUyNDcyNDEzNjE=", "number": 11954, "title": "Dilated convolution does not preserve tensor shape", "user": {"login": "haraldurt", "id": 8042058, "node_id": "MDQ6VXNlcjgwNDIwNTg=", "avatar_url": "https://avatars1.githubusercontent.com/u/8042058?v=4", "gravatar_id": "", "url": "https://api.github.com/users/haraldurt", "html_url": "https://github.com/haraldurt", "followers_url": "https://api.github.com/users/haraldurt/followers", "following_url": "https://api.github.com/users/haraldurt/following{/other_user}", "gists_url": "https://api.github.com/users/haraldurt/gists{/gist_id}", "starred_url": "https://api.github.com/users/haraldurt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/haraldurt/subscriptions", "organizations_url": "https://api.github.com/users/haraldurt/orgs", "repos_url": "https://api.github.com/users/haraldurt/repos", "events_url": "https://api.github.com/users/haraldurt/events{/privacy}", "received_events_url": "https://api.github.com/users/haraldurt/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2017-08-02T00:39:43Z", "updated_at": "2018-04-26T19:09:04Z", "closed_at": null, "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li>\n<p><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:<br>\nYes</p>\n</li>\n<li>\n<p><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nUbuntu 14.04.5 LTS</p>\n</li>\n<li>\n<p><strong>TensorFlow installed from (source or binary)</strong>:<br>\nSource</p>\n</li>\n<li>\n<p><strong>TensorFlow version (use command below)</strong>:<br>\n('unknown', '1.3.0-rc0')</p>\n</li>\n<li>\n<p><strong>Python version</strong>:<br>\n2.7.12</p>\n</li>\n<li>\n<p><strong>Exact command to reproduce</strong>:</p>\n</li>\n</ul>\n<pre><code>input_tensor = tf.placeholder(tf.float32, (10, None, 256, 3))\n\ndilated = tf.nn.convolution(input_tensor,\n                            tf.zeros((3, 1, 3, 16)),\n                            dilation_rate=[2, 1],\n                            padding='SAME')\n\nprint(dilated.get_shape()) # Displays: [10, ?, ?, 16], expected [10, ?, 256, 16]\n</code></pre>\n<h3>Describe the problem</h3>\n<p>The documentation for tf.nn.convolution has the spatial dimensions of the output given as:</p>\n<pre><code>If padding == \"SAME\": output_spatial_shape[i] = ceil(input_spatial_shape[i] / strides[i])\n</code></pre>\n<p>Which suggests that input_spatial_shape[0] should not affect output_spatial_shape[1], as is the case in the code block above.</p>\n<p>This problem arises when using dilated convolutions as part of a larger model containing recurrent layers, in which one spatial dimension is left undefined to allow for unrolling the recurrent layers out during training along the undefined dimension.</p>\n<p>This might be related to a <a href=\"https://github.com/tensorflow/tensorflow/issues/4742\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/4742/hovercard\">previously fixed problem with undefined batch sizes</a>.</p>", "body_text": "System information\n\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nYes\n\n\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nUbuntu 14.04.5 LTS\n\n\nTensorFlow installed from (source or binary):\nSource\n\n\nTensorFlow version (use command below):\n('unknown', '1.3.0-rc0')\n\n\nPython version:\n2.7.12\n\n\nExact command to reproduce:\n\n\ninput_tensor = tf.placeholder(tf.float32, (10, None, 256, 3))\n\ndilated = tf.nn.convolution(input_tensor,\n                            tf.zeros((3, 1, 3, 16)),\n                            dilation_rate=[2, 1],\n                            padding='SAME')\n\nprint(dilated.get_shape()) # Displays: [10, ?, ?, 16], expected [10, ?, 256, 16]\n\nDescribe the problem\nThe documentation for tf.nn.convolution has the spatial dimensions of the output given as:\nIf padding == \"SAME\": output_spatial_shape[i] = ceil(input_spatial_shape[i] / strides[i])\n\nWhich suggests that input_spatial_shape[0] should not affect output_spatial_shape[1], as is the case in the code block above.\nThis problem arises when using dilated convolutions as part of a larger model containing recurrent layers, in which one spatial dimension is left undefined to allow for unrolling the recurrent layers out during training along the undefined dimension.\nThis might be related to a previously fixed problem with undefined batch sizes.", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\nYes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\nUbuntu 14.04.5 LTS\r\n- **TensorFlow installed from (source or binary)**:\r\nSource\r\n- **TensorFlow version (use command below)**:\r\n('unknown', '1.3.0-rc0')\r\n- **Python version**: \r\n2.7.12\r\n\r\n- **Exact command to reproduce**:\r\n```\r\ninput_tensor = tf.placeholder(tf.float32, (10, None, 256, 3))\r\n\r\ndilated = tf.nn.convolution(input_tensor,\r\n                            tf.zeros((3, 1, 3, 16)),\r\n                            dilation_rate=[2, 1],\r\n                            padding='SAME')\r\n\r\nprint(dilated.get_shape()) # Displays: [10, ?, ?, 16], expected [10, ?, 256, 16]\r\n```\r\n\r\n### Describe the problem\r\nThe documentation for tf.nn.convolution has the spatial dimensions of the output given as:\r\n\r\n```\r\nIf padding == \"SAME\": output_spatial_shape[i] = ceil(input_spatial_shape[i] / strides[i])\r\n```\r\n\r\nWhich suggests that input_spatial_shape[0] should not affect output_spatial_shape[1], as is the case in the code block above.\r\n\r\nThis problem arises when using dilated convolutions as part of a larger model containing recurrent layers, in which one spatial dimension is left undefined to allow for unrolling the recurrent layers out during training along the undefined dimension.\r\n\r\nThis might be related to a [previously fixed problem with undefined batch sizes](https://github.com/tensorflow/tensorflow/issues/4742).\r\n"}