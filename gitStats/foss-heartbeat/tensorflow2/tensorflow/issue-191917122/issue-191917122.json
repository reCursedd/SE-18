{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5892", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5892/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5892/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5892/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/5892", "id": 191917122, "node_id": "MDU6SXNzdWUxOTE5MTcxMjI=", "number": 5892, "title": "Huge network traffic between parameter server and worker", "user": {"login": "fesun", "id": 23738439, "node_id": "MDQ6VXNlcjIzNzM4NDM5", "avatar_url": "https://avatars3.githubusercontent.com/u/23738439?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fesun", "html_url": "https://github.com/fesun", "followers_url": "https://api.github.com/users/fesun/followers", "following_url": "https://api.github.com/users/fesun/following{/other_user}", "gists_url": "https://api.github.com/users/fesun/gists{/gist_id}", "starred_url": "https://api.github.com/users/fesun/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fesun/subscriptions", "organizations_url": "https://api.github.com/users/fesun/orgs", "repos_url": "https://api.github.com/users/fesun/repos", "events_url": "https://api.github.com/users/fesun/events{/privacy}", "received_events_url": "https://api.github.com/users/fesun/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2016-11-28T04:27:30Z", "updated_at": "2016-11-29T19:06:38Z", "closed_at": "2016-11-29T19:06:38Z", "author_association": "CONTRIBUTOR", "body_html": "<p>hi, we found huge network traffic between parameter server and worker during distributed dnn training. our model has one embedding layer with 40M sparse features, those features are spitted into 20 groups and each group full-connected to one 5-dimension vector, so for sparse part, total parameter count is 200M. we used tf.nn.embedding_lookup_sparse to retrieve sparse parameters. however, with one parameter server one worker, parameter will send about 700M to worker for one batch, this traffic is very close to whole parameter size.<br>\nhere is our code for sparse part:</p>\n<pre><code>W_embeddings = []\nfor i in range(1, FLAGS.feature_group_count):\n    W_embeddings.append(tf.get_variable(\"W_embedding_%d\" % (i-1), [feature_dimensions[i], FLAGS.embedding_count], partitioner=tf.min_max_variable_partitioner(ps_count)))\n\nembedding_tensors = []\nfor i in range(len(W_embeddings)):\n    embedding_tensors.append(tf.nn.embedding_lookup_sparse(W_embeddings[i],sp_ids=feature_groups[i+1],sp_weights=None,combiner=\"sum\"))\n</code></pre>\n<p>python version is Ubuntu 3.4.3, tensorflow 0.11.0 is downloaded following official site using pip3.<br>\nI searched and found no one reported this kind of issue before, i am not sure whether we are using tensorflow incorrectly or something wrong with our environment, any idea about how to fix this?</p>", "body_text": "hi, we found huge network traffic between parameter server and worker during distributed dnn training. our model has one embedding layer with 40M sparse features, those features are spitted into 20 groups and each group full-connected to one 5-dimension vector, so for sparse part, total parameter count is 200M. we used tf.nn.embedding_lookup_sparse to retrieve sparse parameters. however, with one parameter server one worker, parameter will send about 700M to worker for one batch, this traffic is very close to whole parameter size.\nhere is our code for sparse part:\nW_embeddings = []\nfor i in range(1, FLAGS.feature_group_count):\n    W_embeddings.append(tf.get_variable(\"W_embedding_%d\" % (i-1), [feature_dimensions[i], FLAGS.embedding_count], partitioner=tf.min_max_variable_partitioner(ps_count)))\n\nembedding_tensors = []\nfor i in range(len(W_embeddings)):\n    embedding_tensors.append(tf.nn.embedding_lookup_sparse(W_embeddings[i],sp_ids=feature_groups[i+1],sp_weights=None,combiner=\"sum\"))\n\npython version is Ubuntu 3.4.3, tensorflow 0.11.0 is downloaded following official site using pip3.\nI searched and found no one reported this kind of issue before, i am not sure whether we are using tensorflow incorrectly or something wrong with our environment, any idea about how to fix this?", "body": "hi, we found huge network traffic between parameter server and worker during distributed dnn training. our model has one embedding layer with 40M sparse features, those features are spitted into 20 groups and each group full-connected to one 5-dimension vector, so for sparse part, total parameter count is 200M. we used tf.nn.embedding_lookup_sparse to retrieve sparse parameters. however, with one parameter server one worker, parameter will send about 700M to worker for one batch, this traffic is very close to whole parameter size.\r\nhere is our code for sparse part:\r\n\r\n```\r\nW_embeddings = []\r\nfor i in range(1, FLAGS.feature_group_count):\r\n    W_embeddings.append(tf.get_variable(\"W_embedding_%d\" % (i-1), [feature_dimensions[i], FLAGS.embedding_count], partitioner=tf.min_max_variable_partitioner(ps_count)))\r\n\r\nembedding_tensors = []\r\nfor i in range(len(W_embeddings)):\r\n    embedding_tensors.append(tf.nn.embedding_lookup_sparse(W_embeddings[i],sp_ids=feature_groups[i+1],sp_weights=None,combiner=\"sum\"))\r\n```\r\n\r\npython version is Ubuntu 3.4.3, tensorflow 0.11.0 is downloaded following official site using pip3.\r\nI searched and found no one reported this kind of issue before, i am not sure whether we are using tensorflow incorrectly or something wrong with our environment, any idea about how to fix this?\r\n"}