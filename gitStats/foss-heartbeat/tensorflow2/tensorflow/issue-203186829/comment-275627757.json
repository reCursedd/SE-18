{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/275627757", "html_url": "https://github.com/tensorflow/tensorflow/issues/7065#issuecomment-275627757", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7065", "id": 275627757, "node_id": "MDEyOklzc3VlQ29tbWVudDI3NTYyNzc1Nw==", "user": {"login": "SeguinBe", "id": 7132817, "node_id": "MDQ6VXNlcjcxMzI4MTc=", "avatar_url": "https://avatars0.githubusercontent.com/u/7132817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SeguinBe", "html_url": "https://github.com/SeguinBe", "followers_url": "https://api.github.com/users/SeguinBe/followers", "following_url": "https://api.github.com/users/SeguinBe/following{/other_user}", "gists_url": "https://api.github.com/users/SeguinBe/gists{/gist_id}", "starred_url": "https://api.github.com/users/SeguinBe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SeguinBe/subscriptions", "organizations_url": "https://api.github.com/users/SeguinBe/orgs", "repos_url": "https://api.github.com/users/SeguinBe/repos", "events_url": "https://api.github.com/users/SeguinBe/events{/privacy}", "received_events_url": "https://api.github.com/users/SeguinBe/received_events", "type": "User", "site_admin": false}, "created_at": "2017-01-27T09:51:57Z", "updated_at": "2017-01-27T10:01:49Z", "author_association": "NONE", "body_html": "<div class=\"highlight highlight-source-python\"><pre>input_images <span class=\"pl-k\">=</span> tf.Variable(tf.random_uniform((<span class=\"pl-c1\">16</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">224</span>, <span class=\"pl-c1\">224</span>), <span class=\"pl-v\">maxval</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">255</span>))\n<span class=\"pl-k\">with</span> slim.arg_scope([slim.conv2d, slim.max_pool2d], <span class=\"pl-v\">data_format</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>NCHW<span class=\"pl-pds\">'</span></span>):\n    preds, _ <span class=\"pl-k\">=</span> nets.vgg.vgg_16(input_images, <span class=\"pl-v\">is_training</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">False</span>, <span class=\"pl-v\">spatial_squeeze</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">False</span>)\ninit_op <span class=\"pl-k\">=</span> tf.global_variables_initializer()\n\nconfig <span class=\"pl-k\">=</span> tf.ConfigProto(<span class=\"pl-v\">log_device_placement</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>)\nsess <span class=\"pl-k\">=</span> tf.InteractiveSession(<span class=\"pl-v\">config</span><span class=\"pl-k\">=</span>config)\nsess.run(init_op)</pre></div>\n<p>Using <code>data_format='NHWC'</code> and size [X, 224, 224, 3] I still get <strong>160ms</strong> and with the <code>data_format='NCHW'</code> it is slightly better at <strong>150ms</strong>...</p>\n<p>I have to note that the fc6-fc7 are implemented as convolution in the TF version, will try if modifying them to pure matrix-multiplication changes anything</p>", "body_text": "input_images = tf.Variable(tf.random_uniform((16, 3, 224, 224), maxval=255))\nwith slim.arg_scope([slim.conv2d, slim.max_pool2d], data_format='NCHW'):\n    preds, _ = nets.vgg.vgg_16(input_images, is_training=False, spatial_squeeze=False)\ninit_op = tf.global_variables_initializer()\n\nconfig = tf.ConfigProto(log_device_placement=True)\nsess = tf.InteractiveSession(config=config)\nsess.run(init_op)\nUsing data_format='NHWC' and size [X, 224, 224, 3] I still get 160ms and with the data_format='NCHW' it is slightly better at 150ms...\nI have to note that the fc6-fc7 are implemented as convolution in the TF version, will try if modifying them to pure matrix-multiplication changes anything", "body": "```python\r\ninput_images = tf.Variable(tf.random_uniform((16, 3, 224, 224), maxval=255))\r\nwith slim.arg_scope([slim.conv2d, slim.max_pool2d], data_format='NCHW'):\r\n    preds, _ = nets.vgg.vgg_16(input_images, is_training=False, spatial_squeeze=False)\r\ninit_op = tf.global_variables_initializer()\r\n\r\nconfig = tf.ConfigProto(log_device_placement=True)\r\nsess = tf.InteractiveSession(config=config)\r\nsess.run(init_op)\r\n```\r\n\r\nUsing `data_format='NHWC'` and size [X, 224, 224, 3] I still get **160ms** and with the `data_format='NCHW'` it is slightly better at **150ms**...\r\n\r\nI have to note that the fc6-fc7 are implemented as convolution in the TF version, will try if modifying them to pure matrix-multiplication changes anything"}