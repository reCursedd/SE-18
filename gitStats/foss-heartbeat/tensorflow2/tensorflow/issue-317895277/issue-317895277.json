{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18890", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18890/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18890/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18890/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/18890", "id": 317895277, "node_id": "MDU6SXNzdWUzMTc4OTUyNzc=", "number": 18890, "title": "failed to allocate tensors on mobile device", "user": {"login": "guy6656", "id": 34881059, "node_id": "MDQ6VXNlcjM0ODgxMDU5", "avatar_url": "https://avatars2.githubusercontent.com/u/34881059?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guy6656", "html_url": "https://github.com/guy6656", "followers_url": "https://api.github.com/users/guy6656/followers", "following_url": "https://api.github.com/users/guy6656/following{/other_user}", "gists_url": "https://api.github.com/users/guy6656/gists{/gist_id}", "starred_url": "https://api.github.com/users/guy6656/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guy6656/subscriptions", "organizations_url": "https://api.github.com/users/guy6656/orgs", "repos_url": "https://api.github.com/users/guy6656/repos", "events_url": "https://api.github.com/users/guy6656/events{/privacy}", "received_events_url": "https://api.github.com/users/guy6656/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 750616506, "node_id": "MDU6TGFiZWw3NTA2MTY1MDY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:lite", "name": "comp:lite", "color": "0052cc", "default": false}, {"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "aselle", "id": 326106, "node_id": "MDQ6VXNlcjMyNjEwNg==", "avatar_url": "https://avatars1.githubusercontent.com/u/326106?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aselle", "html_url": "https://github.com/aselle", "followers_url": "https://api.github.com/users/aselle/followers", "following_url": "https://api.github.com/users/aselle/following{/other_user}", "gists_url": "https://api.github.com/users/aselle/gists{/gist_id}", "starred_url": "https://api.github.com/users/aselle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aselle/subscriptions", "organizations_url": "https://api.github.com/users/aselle/orgs", "repos_url": "https://api.github.com/users/aselle/repos", "events_url": "https://api.github.com/users/aselle/events{/privacy}", "received_events_url": "https://api.github.com/users/aselle/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "aselle", "id": 326106, "node_id": "MDQ6VXNlcjMyNjEwNg==", "avatar_url": "https://avatars1.githubusercontent.com/u/326106?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aselle", "html_url": "https://github.com/aselle", "followers_url": "https://api.github.com/users/aselle/followers", "following_url": "https://api.github.com/users/aselle/following{/other_user}", "gists_url": "https://api.github.com/users/aselle/gists{/gist_id}", "starred_url": "https://api.github.com/users/aselle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aselle/subscriptions", "organizations_url": "https://api.github.com/users/aselle/orgs", "repos_url": "https://api.github.com/users/aselle/repos", "events_url": "https://api.github.com/users/aselle/events{/privacy}", "received_events_url": "https://api.github.com/users/aselle/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 14, "created_at": "2018-04-26T06:35:40Z", "updated_at": "2018-08-06T21:17:14Z", "closed_at": "2018-08-06T21:17:14Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<p>I minimize the model to very simple model with one input, convolution layer and pool is the output.<br>\nI work on Ubuntu 16.04<br>\nI compile TensorFlow Lite from source with Bazel<br>\nTensorFlow version is 1.8<br>\nPython 3.6<br>\nBazel version 0.10.0<br>\nGCC/Compiler version - gcc (Ubuntu 5.4.0-6ubuntu1~16.04.6) 5.4.0 20160609<br>\nWorking on CPU</p>\n<h3>Describe the problem</h3>\n<p>I am trying to run my Tensorflow model on samsung galaxy s9,<br>\nI trained model with TensorFlow freeze it and convert it to .tflite model file with toco.<br>\nI am running CPP program on the phone according to documentation and load the .tflite model file:</p>\n<pre><code>std::unique_ptr&lt;tflite::FlatBufferModel&gt; model(tflite::FlatBufferModel::BuildFromFile(modelFile));\nif (!model) {\n    printf(\"Failed to mmap model %s\\n\", g_modelFile);\n}\nmodel-&gt;error_reporter();\ntflite::ops::builtin::BuiltinOpResolver resolver;\nstd::unique_ptr&lt;tflite::Interpreter&gt; interpreter;\ntflite::InterpreterBuilder(*model, resolver)(&amp;interpreter);\nif (!interpreter) {\n    printf(\"Failed to construct interpreter\\n\");\n}\ninterpreter-&gt;UseNNAPI(false);\nif (interpreter-&gt;AllocateTensors() != kTfLiteOk) {\n    printf(\"Failed to allocate tensors!\\n\");\n}\n</code></pre>\n<p>I succeed to initialize the model but failed to run <strong>interpreter-&gt;AllocateTensors()</strong><br>\nThere is no print of why it failed to allocate the tensors, just my print that the function failed</p>\n<pre><code>if (interpreter-&gt;AllocateTensors() != kTfLiteOk) {\n    printf(\"Failed to allocate tensors!\\n\");\n}\n</code></pre>\n<p>I minimized my model to include only reshape, convolution layer and pool and still failed to run AllocateTensors</p>\n<p>Output with debug information:</p>\n<p>resolved reporter<br>\ntensors size: 8<br>\nnodes size: 3<br>\ninputs: 1<br>\ninput(0) name: patches<br>\ninput(1) name: (null)<br>\nReshape, 237552, 1, 0.000000, 0<br>\nReshape/shape, 16, 2, 0.000000, 0<br>\nconv1/Relu, 1861632, 1, 0.000000, 0<br>\nconv1/convolution_bias, 128, 1, 0.000000, 0<br>\nconv1/kernel, 3456, 1, 0.000000, 0<br>\ninput/patches-input, 237552, 1, 0.000000, 0<br>\noutput, 465408, 1, 0.000000, 0<br>\npatches, 4, 1, 0.000000, 0</p>\n<p><strong>Failed to allocate tensors!</strong></p>", "body_text": "System information\nI minimize the model to very simple model with one input, convolution layer and pool is the output.\nI work on Ubuntu 16.04\nI compile TensorFlow Lite from source with Bazel\nTensorFlow version is 1.8\nPython 3.6\nBazel version 0.10.0\nGCC/Compiler version - gcc (Ubuntu 5.4.0-6ubuntu1~16.04.6) 5.4.0 20160609\nWorking on CPU\nDescribe the problem\nI am trying to run my Tensorflow model on samsung galaxy s9,\nI trained model with TensorFlow freeze it and convert it to .tflite model file with toco.\nI am running CPP program on the phone according to documentation and load the .tflite model file:\nstd::unique_ptr<tflite::FlatBufferModel> model(tflite::FlatBufferModel::BuildFromFile(modelFile));\nif (!model) {\n    printf(\"Failed to mmap model %s\\n\", g_modelFile);\n}\nmodel->error_reporter();\ntflite::ops::builtin::BuiltinOpResolver resolver;\nstd::unique_ptr<tflite::Interpreter> interpreter;\ntflite::InterpreterBuilder(*model, resolver)(&interpreter);\nif (!interpreter) {\n    printf(\"Failed to construct interpreter\\n\");\n}\ninterpreter->UseNNAPI(false);\nif (interpreter->AllocateTensors() != kTfLiteOk) {\n    printf(\"Failed to allocate tensors!\\n\");\n}\n\nI succeed to initialize the model but failed to run interpreter->AllocateTensors()\nThere is no print of why it failed to allocate the tensors, just my print that the function failed\nif (interpreter->AllocateTensors() != kTfLiteOk) {\n    printf(\"Failed to allocate tensors!\\n\");\n}\n\nI minimized my model to include only reshape, convolution layer and pool and still failed to run AllocateTensors\nOutput with debug information:\nresolved reporter\ntensors size: 8\nnodes size: 3\ninputs: 1\ninput(0) name: patches\ninput(1) name: (null)\nReshape, 237552, 1, 0.000000, 0\nReshape/shape, 16, 2, 0.000000, 0\nconv1/Relu, 1861632, 1, 0.000000, 0\nconv1/convolution_bias, 128, 1, 0.000000, 0\nconv1/kernel, 3456, 1, 0.000000, 0\ninput/patches-input, 237552, 1, 0.000000, 0\noutput, 465408, 1, 0.000000, 0\npatches, 4, 1, 0.000000, 0\nFailed to allocate tensors!", "body": "### System information\r\nI minimize the model to very simple model with one input, convolution layer and pool is the output.\r\nI work on Ubuntu 16.04\r\nI compile TensorFlow Lite from source with Bazel\r\nTensorFlow version is 1.8\r\nPython 3.6\r\nBazel version 0.10.0\r\nGCC/Compiler version - gcc (Ubuntu 5.4.0-6ubuntu1~16.04.6) 5.4.0 20160609\r\nWorking on CPU\r\n\r\n\r\n### Describe the problem\r\nI am trying to run my Tensorflow model on samsung galaxy s9, \r\nI trained model with TensorFlow freeze it and convert it to .tflite model file with toco.\r\nI am running CPP program on the phone according to documentation and load the .tflite model file:\r\n\r\n    std::unique_ptr<tflite::FlatBufferModel> model(tflite::FlatBufferModel::BuildFromFile(modelFile));\r\n    if (!model) {\r\n        printf(\"Failed to mmap model %s\\n\", g_modelFile);\r\n    }\r\n    model->error_reporter();\r\n    tflite::ops::builtin::BuiltinOpResolver resolver;\r\n    std::unique_ptr<tflite::Interpreter> interpreter;\r\n    tflite::InterpreterBuilder(*model, resolver)(&interpreter);\r\n    if (!interpreter) {\r\n        printf(\"Failed to construct interpreter\\n\");\r\n    }\r\n    interpreter->UseNNAPI(false);\r\n    if (interpreter->AllocateTensors() != kTfLiteOk) {\r\n        printf(\"Failed to allocate tensors!\\n\");\r\n    }\r\n\r\n\r\nI succeed to initialize the model but failed to run **interpreter->AllocateTensors()**\r\nThere is no print of why it failed to allocate the tensors, just my print that the function failed\r\n\r\n    if (interpreter->AllocateTensors() != kTfLiteOk) {\r\n        printf(\"Failed to allocate tensors!\\n\");\r\n    }\r\n\r\nI minimized my model to include only reshape, convolution layer and pool and still failed to run AllocateTensors\r\n\r\nOutput with debug information:\r\n\r\nresolved reporter\r\ntensors size: 8\r\nnodes size: 3\r\ninputs: 1\r\ninput(0) name: patches\r\ninput(1) name: (null)\r\nReshape, 237552, 1, 0.000000, 0\r\nReshape/shape, 16, 2, 0.000000, 0\r\nconv1/Relu, 1861632, 1, 0.000000, 0\r\nconv1/convolution_bias, 128, 1, 0.000000, 0\r\nconv1/kernel, 3456, 1, 0.000000, 0\r\ninput/patches-input, 237552, 1, 0.000000, 0\r\noutput, 465408, 1, 0.000000, 0\r\npatches, 4, 1, 0.000000, 0\r\n\r\n**Failed to allocate tensors!**"}