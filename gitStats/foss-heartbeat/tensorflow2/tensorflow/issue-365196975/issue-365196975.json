{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22631", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22631/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22631/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22631/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/22631", "id": 365196975, "node_id": "MDU6SXNzdWUzNjUxOTY5NzU=", "number": 22631, "title": "\"Not found: Resource does not exist\" exception thrown in runtime", "user": {"login": "dy-octa", "id": 13358837, "node_id": "MDQ6VXNlcjEzMzU4ODM3", "avatar_url": "https://avatars2.githubusercontent.com/u/13358837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dy-octa", "html_url": "https://github.com/dy-octa", "followers_url": "https://api.github.com/users/dy-octa/followers", "following_url": "https://api.github.com/users/dy-octa/following{/other_user}", "gists_url": "https://api.github.com/users/dy-octa/gists{/gist_id}", "starred_url": "https://api.github.com/users/dy-octa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dy-octa/subscriptions", "organizations_url": "https://api.github.com/users/dy-octa/orgs", "repos_url": "https://api.github.com/users/dy-octa/repos", "events_url": "https://api.github.com/users/dy-octa/events{/privacy}", "received_events_url": "https://api.github.com/users/dy-octa/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": {"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2018-09-30T06:26:07Z", "updated_at": "2018-11-22T18:58:56Z", "closed_at": null, "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: Yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Linux Ubuntu 16.04</li>\n<li><strong>Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device</strong>: .</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.9.0</li>\n<li><strong>Python version</strong>: 3.5.0</li>\n<li><strong>Bazel version (if compiling from source)</strong>: /</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: /</li>\n<li><strong>CUDA/cuDNN version</strong>: 9.1</li>\n<li><strong>GPU model and memory</strong>: Tesla M40 24GB, Tesla P100 16GB</li>\n<li><strong>Exact command to reproduce</strong>: /</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>An exception is produced when I try to run a slightly modified version of a implementation of Tacotron-2(<a href=\"https://github.com/Rayhane-mamah/Tacotron-2.git\">https://github.com/Rayhane-mamah/Tacotron-2.git</a>). The problem can be reproduced with batch size=32 or 48, but not with batch size=64, either on single or multiple GPUs.<br>\nExact the same exception may occur on another model of my own, when the batch size is large enough.<br>\nIn my implementation variables (VariableV2 ops) are placed on CPU0, while other ops are placed on GPU towers.<br>\nThe problem looks similar with <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"357258416\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/22094\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/22094/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/22094\">#22094</a></p>\n<p><strong>Update</strong><br>\nThe problems only occurs when colocate_gradients_with_ops=True in gradients computation.</p>\n<h3>Source code / logs</h3>\n<p>2018-09-29 05:10:28.440837: W tensorflow/core/framework/op_kernel.cc:1318] OP_REQUIRES failed at tensor_array_ops.cc:121 : Not found: Resource __per_step_11/_tensor_arraysmodel/tower_2/tacotron/decoder/TensorArray_3/N10tensorflow11TensorArrayE does not exist.<br>\nExiting due to exception: Resource __per_step_11/_tensor_arraysmodel/tower_2/tacotron/decoder/TensorArray_3/N10tensorflow11TensorArrayE does not exist.<br>\n[[Node: model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3 = TensorArrayGradV3[_class=[\"loc:<a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=21049823\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/model\">@model</a>...yScatterV3\"], source=\"model/tower_2/gradients\", _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](model/tower_2/tacotron/decoder/TensorArray/_231, model/tower_2/tacotron/decoder/while/Exit_1/_1161)]]<br>\n[[Node: model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch/_1982 = _Send<a href=\"model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch\">T=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device_incarnation=1, tensor_name=\"edge_14621...amicStitch\", _device=\"/job:localhost/replica:0/task:0/device:GPU:1\"</a>]]</p>\n<p>Caused by op 'model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3', defined at:<br>\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 369, in <br>\nmain()<br>\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 365, in main<br>\ntrain(log_dir, args)<br>\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 231, in train<br>\nmodel.add_gradients()<br>\nFile \"/tmp/apprunner/.working/runtime/app/models/tacotron.py\", line 256, in add_gradients<br>\ngrad_vars = optimizer.compute_gradients(self.loss, colocate_gradients_with_ops=True)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 511, in compute_gradients<br>\ncolocate_gradients_with_ops=colocate_gradients_with_ops)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 532, in gradients<br>\ngate_gradients, aggregation_method, stop_gradients)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 701, in _GradientsHelper<br>\nlambda: grad_fn(op, *out_grads))<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 396, in _MaybeCompile<br>\nreturn grad_fn()  # Exit early<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 701, in <br>\nlambda: grad_fn(op, *out_grads))<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_grad.py\", line 161, in _TensorArrayGatherGrad<br>\n.grad(source=grad_source, flow=flow))<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 812, in grad<br>\nreturn self._implementation.grad(source, flow=flow, name=name)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 239, in grad<br>\nhandle=self._handle, source=source, flow_in=flow, name=name)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 6229, in tensor_array_grad_v3<br>\nname=name)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper<br>\nop_def=op_def)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 3414, in create_op<br>\nop_def=op_def)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1740, in <strong>init</strong><br>\nself._traceback = self._graph._extract_stack()  # pylint: disable=protected-access</p>\n<p>...which was originally created as op 'model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3', defined at:<br>\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 369, in <br>\nmain()<br>\n[elided 0 identical lines from previous traceback]<br>\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 365, in main<br>\ntrain(log_dir, args)<br>\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 229, in train<br>\nfeeder.target_lengths, global_step=global_step)<br>\nFile \"/tmp/apprunner/.working/runtime/app/models/tacotron.py\", line 115, in initialize<br>\nmaximum_iterations=max_iters)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 329, in dynamic_decode<br>\nfinal_outputs = nest.map_structure(lambda ta: ta.stack(), final_outputs_ta)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/util/nest.py\", line 374, in map_structure<br>\nstructure[0], [func(*x) for x in entries])<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/util/nest.py\", line 374, in <br>\nstructure[0], [func(*x) for x in entries])<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 329, in <br>\nfinal_outputs = nest.map_structure(lambda ta: ta.stack(), final_outputs_ta)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 856, in stack<br>\nreturn self._implementation.stack(name=name)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 289, in stack<br>\nreturn self.gather(math_ops.range(0, self.size()), name=name)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 303, in gather<br>\nelement_shape=element_shape)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 6018, in tensor_array_gather_v3<br>\nflow_in=flow_in, dtype=dtype, element_shape=element_shape, name=name)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper<br>\nop_def=op_def)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 3414, in create_op<br>\nop_def=op_def)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1740, in <strong>init</strong><br>\nself._traceback = self._graph._extract_stack()  # pylint: disable=protected-access</p>\n<p>NotFoundError (see above for traceback): Resource __per_step_11/_tensor_arraysmodel/tower_2/tacotron/decoder/TensorArray_3/N10tensorflow11TensorArrayE does not exist.<br>\n[[Node: model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3 = TensorArrayGradV3[_class=[\"loc:<a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=21049823\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/model\">@model</a>...yScatterV3\"], source=\"model/tower_2/gradients\", _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](model/tower_2/tacotron/decoder/TensorArray/_231, model/tower_2/tacotron/decoder/while/Exit_1/_1161)]]<br>\n[[Node: model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch/_1982 = _Send<a href=\"model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch\">T=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device_incarnation=1, tensor_name=\"edge_14621...amicStitch\", _device=\"/job:localhost/replica:0/task:0/device:GPU:1\"</a>]]</p>\n<p>Traceback (most recent call last):<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1322, in _do_call<br>\nreturn fn(*args)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1307, in _run_fn<br>\noptions, feed_dict, fetch_list, target_list, run_metadata)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1409, in _call_tf_sessionrun<br>\nrun_metadata)<br>\ntensorflow.python.framework.errors_impl.NotFoundError: Resource __per_step_11/_tensor_arraysmodel/tower_2/tacotron/decoder/TensorArray_3/N10tensorflow11TensorArrayE does not exist.<br>\n[[Node: model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3 = TensorArrayGradV3[_class=[\"loc:<a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=21049823\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/model\">@model</a>...yScatterV3\"], source=\"model/tower_2/gradients\", _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](model/tower_2/tacotron/decoder/TensorArray/_231, model/tower_2/tacotron/decoder/while/Exit_1/_1161)]]<br>\n[[Node: model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch/_1982 = _Send<a href=\"model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch\">T=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device_incarnation=1, tensor_name=\"edge_14621...amicStitch\", _device=\"/job:localhost/replica:0/task:0/device:GPU:1\"</a>]]</p>\n<p>During handling of the above exception, another exception occurred:</p>\n<p>Traceback (most recent call last):<br>\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 283, in train<br>\nstep, loss, _, target_lengths = sess.run([global_step, avg_loss, train_op, feeder.target_lengths])<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 900, in run<br>\nrun_metadata_ptr)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1135, in _run<br>\nfeed_dict_tensor, options, run_metadata)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1316, in _do_run<br>\nrun_metadata)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1335, in _do_call<br>\nraise type(e)(node_def, op, message)<br>\ntensorflow.python.framework.errors_impl.NotFoundError: Resource __per_step_11/_tensor_arraysmodel/tower_2/tacotron/decoder/TensorArray_3/N10tensorflow11TensorArrayE does not exist.<br>\n[[Node: model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3 = TensorArrayGradV3[_class=[\"loc:<a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=21049823\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/model\">@model</a>...yScatterV3\"], source=\"model/tower_2/gradients\", _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](model/tower_2/tacotron/decoder/TensorArray/_231, model/tower_2/tacotron/decoder/while/Exit_1/_1161)]]<br>\n[[Node: model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch/_1982 = _Send<a href=\"model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch\">T=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device_incarnation=1, tensor_name=\"edge_14621...amicStitch\", _device=\"/job:localhost/replica:0/task:0/device:GPU:1\"</a>]]</p>\n<p>Caused by op 'model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3', defined at:<br>\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 369, in <br>\nmain()<br>\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 365, in main<br>\ntrain(log_dir, args)<br>\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 231, in train<br>\nmodel.add_gradients()<br>\nFile \"/tmp/apprunner/.working/runtime/app/models/tacotron.py\", line 256, in add_gradients<br>\ngrad_vars = optimizer.compute_gradients(self.loss, colocate_gradients_with_ops=True)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 511, in compute_gradients<br>\ncolocate_gradients_with_ops=colocate_gradients_with_ops)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 532, in gradients<br>\ngate_gradients, aggregation_method, stop_gradients)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 701, in _GradientsHelper<br>\nlambda: grad_fn(op, *out_grads))<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 396, in _MaybeCompile<br>\nreturn grad_fn()  # Exit early<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 701, in <br>\nlambda: grad_fn(op, *out_grads))<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_grad.py\", line 161, in _TensorArrayGatherGrad<br>\n.grad(source=grad_source, flow=flow))<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 812, in grad<br>\nreturn self._implementation.grad(source, flow=flow, name=name)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 239, in grad<br>\nhandle=self._handle, source=source, flow_in=flow, name=name)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 6229, in tensor_array_grad_v3<br>\nname=name)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper<br>\nop_def=op_def)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 3414, in create_op<br>\nop_def=op_def)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1740, in <strong>init</strong><br>\nself._traceback = self._graph._extract_stack()  # pylint: disable=protected-access</p>\n<p>...which was originally created as op 'model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3', defined at:<br>\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 369, in <br>\nmain()<br>\n[elided 0 identical lines from previous traceback]<br>\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 365, in main<br>\ntrain(log_dir, args)<br>\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 229, in train<br>\nfeeder.target_lengths, global_step=global_step)<br>\nFile \"/tmp/apprunner/.working/runtime/app/models/tacotron.py\", line 115, in initialize<br>\nmaximum_iterations=max_iters)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 329, in dynamic_decode<br>\nfinal_outputs = nest.map_structure(lambda ta: ta.stack(), final_outputs_ta)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/util/nest.py\", line 374, in map_structure<br>\nstructure[0], [func(*x) for x in entries])<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/util/nest.py\", line 374, in <br>\nstructure[0], [func(*x) for x in entries])<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 329, in <br>\nfinal_outputs = nest.map_structure(lambda ta: ta.stack(), final_outputs_ta)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 856, in stack<br>\nreturn self._implementation.stack(name=name)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 289, in stack<br>\nreturn self.gather(math_ops.range(0, self.size()), name=name)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 303, in gather<br>\nelement_shape=element_shape)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 6018, in tensor_array_gather_v3<br>\nflow_in=flow_in, dtype=dtype, element_shape=element_shape, name=name)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper<br>\nop_def=op_def)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 3414, in create_op<br>\nop_def=op_def)<br>\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1740, in <strong>init</strong><br>\nself._traceback = self._graph._extract_stack()  # pylint: disable=protected-access</p>\n<p>NotFoundError (see above for traceback): Resource __per_step_11/_tensor_arraysmodel/tower_2/tacotron/decoder/TensorArray_3/N10tensorflow11TensorArrayE does not exist.<br>\n[[Node: model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3 = TensorArrayGradV3[_class=[\"loc:<a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=21049823\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/model\">@model</a>...yScatterV3\"], source=\"model/tower_2/gradients\", _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](model/tower_2/tacotron/decoder/TensorArray/_231, model/tower_2/tacotron/decoder/while/Exit_1/_1161)]]<br>\n[[Node: model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch/_1982 = _Send<a href=\"model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch\">T=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device_incarnation=1, tensor_name=\"edge_14621...amicStitch\", _device=\"/job:localhost/replica:0/task:0/device:GPU:1\"</a>]]</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 16.04\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: .\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below): 1.9.0\nPython version: 3.5.0\nBazel version (if compiling from source): /\nGCC/Compiler version (if compiling from source): /\nCUDA/cuDNN version: 9.1\nGPU model and memory: Tesla M40 24GB, Tesla P100 16GB\nExact command to reproduce: /\n\nDescribe the problem\nAn exception is produced when I try to run a slightly modified version of a implementation of Tacotron-2(https://github.com/Rayhane-mamah/Tacotron-2.git). The problem can be reproduced with batch size=32 or 48, but not with batch size=64, either on single or multiple GPUs.\nExact the same exception may occur on another model of my own, when the batch size is large enough.\nIn my implementation variables (VariableV2 ops) are placed on CPU0, while other ops are placed on GPU towers.\nThe problem looks similar with #22094\nUpdate\nThe problems only occurs when colocate_gradients_with_ops=True in gradients computation.\nSource code / logs\n2018-09-29 05:10:28.440837: W tensorflow/core/framework/op_kernel.cc:1318] OP_REQUIRES failed at tensor_array_ops.cc:121 : Not found: Resource __per_step_11/_tensor_arraysmodel/tower_2/tacotron/decoder/TensorArray_3/N10tensorflow11TensorArrayE does not exist.\nExiting due to exception: Resource __per_step_11/_tensor_arraysmodel/tower_2/tacotron/decoder/TensorArray_3/N10tensorflow11TensorArrayE does not exist.\n[[Node: model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3 = TensorArrayGradV3[_class=[\"loc:@model...yScatterV3\"], source=\"model/tower_2/gradients\", _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](model/tower_2/tacotron/decoder/TensorArray/_231, model/tower_2/tacotron/decoder/while/Exit_1/_1161)]]\n[[Node: model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch/_1982 = _SendT=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device_incarnation=1, tensor_name=\"edge_14621...amicStitch\", _device=\"/job:localhost/replica:0/task:0/device:GPU:1\"]]\nCaused by op 'model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3', defined at:\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 369, in \nmain()\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 365, in main\ntrain(log_dir, args)\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 231, in train\nmodel.add_gradients()\nFile \"/tmp/apprunner/.working/runtime/app/models/tacotron.py\", line 256, in add_gradients\ngrad_vars = optimizer.compute_gradients(self.loss, colocate_gradients_with_ops=True)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 511, in compute_gradients\ncolocate_gradients_with_ops=colocate_gradients_with_ops)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 532, in gradients\ngate_gradients, aggregation_method, stop_gradients)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 701, in _GradientsHelper\nlambda: grad_fn(op, *out_grads))\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 396, in _MaybeCompile\nreturn grad_fn()  # Exit early\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 701, in \nlambda: grad_fn(op, *out_grads))\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_grad.py\", line 161, in _TensorArrayGatherGrad\n.grad(source=grad_source, flow=flow))\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 812, in grad\nreturn self._implementation.grad(source, flow=flow, name=name)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 239, in grad\nhandle=self._handle, source=source, flow_in=flow, name=name)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 6229, in tensor_array_grad_v3\nname=name)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\nop_def=op_def)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 3414, in create_op\nop_def=op_def)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1740, in init\nself._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\n...which was originally created as op 'model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3', defined at:\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 369, in \nmain()\n[elided 0 identical lines from previous traceback]\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 365, in main\ntrain(log_dir, args)\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 229, in train\nfeeder.target_lengths, global_step=global_step)\nFile \"/tmp/apprunner/.working/runtime/app/models/tacotron.py\", line 115, in initialize\nmaximum_iterations=max_iters)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 329, in dynamic_decode\nfinal_outputs = nest.map_structure(lambda ta: ta.stack(), final_outputs_ta)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/util/nest.py\", line 374, in map_structure\nstructure[0], [func(*x) for x in entries])\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/util/nest.py\", line 374, in \nstructure[0], [func(*x) for x in entries])\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 329, in \nfinal_outputs = nest.map_structure(lambda ta: ta.stack(), final_outputs_ta)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 856, in stack\nreturn self._implementation.stack(name=name)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 289, in stack\nreturn self.gather(math_ops.range(0, self.size()), name=name)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 303, in gather\nelement_shape=element_shape)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 6018, in tensor_array_gather_v3\nflow_in=flow_in, dtype=dtype, element_shape=element_shape, name=name)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\nop_def=op_def)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 3414, in create_op\nop_def=op_def)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1740, in init\nself._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\nNotFoundError (see above for traceback): Resource __per_step_11/_tensor_arraysmodel/tower_2/tacotron/decoder/TensorArray_3/N10tensorflow11TensorArrayE does not exist.\n[[Node: model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3 = TensorArrayGradV3[_class=[\"loc:@model...yScatterV3\"], source=\"model/tower_2/gradients\", _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](model/tower_2/tacotron/decoder/TensorArray/_231, model/tower_2/tacotron/decoder/while/Exit_1/_1161)]]\n[[Node: model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch/_1982 = _SendT=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device_incarnation=1, tensor_name=\"edge_14621...amicStitch\", _device=\"/job:localhost/replica:0/task:0/device:GPU:1\"]]\nTraceback (most recent call last):\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1322, in _do_call\nreturn fn(*args)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1307, in _run_fn\noptions, feed_dict, fetch_list, target_list, run_metadata)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1409, in _call_tf_sessionrun\nrun_metadata)\ntensorflow.python.framework.errors_impl.NotFoundError: Resource __per_step_11/_tensor_arraysmodel/tower_2/tacotron/decoder/TensorArray_3/N10tensorflow11TensorArrayE does not exist.\n[[Node: model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3 = TensorArrayGradV3[_class=[\"loc:@model...yScatterV3\"], source=\"model/tower_2/gradients\", _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](model/tower_2/tacotron/decoder/TensorArray/_231, model/tower_2/tacotron/decoder/while/Exit_1/_1161)]]\n[[Node: model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch/_1982 = _SendT=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device_incarnation=1, tensor_name=\"edge_14621...amicStitch\", _device=\"/job:localhost/replica:0/task:0/device:GPU:1\"]]\nDuring handling of the above exception, another exception occurred:\nTraceback (most recent call last):\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 283, in train\nstep, loss, _, target_lengths = sess.run([global_step, avg_loss, train_op, feeder.target_lengths])\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 900, in run\nrun_metadata_ptr)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1135, in _run\nfeed_dict_tensor, options, run_metadata)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1316, in _do_run\nrun_metadata)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1335, in _do_call\nraise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.NotFoundError: Resource __per_step_11/_tensor_arraysmodel/tower_2/tacotron/decoder/TensorArray_3/N10tensorflow11TensorArrayE does not exist.\n[[Node: model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3 = TensorArrayGradV3[_class=[\"loc:@model...yScatterV3\"], source=\"model/tower_2/gradients\", _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](model/tower_2/tacotron/decoder/TensorArray/_231, model/tower_2/tacotron/decoder/while/Exit_1/_1161)]]\n[[Node: model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch/_1982 = _SendT=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device_incarnation=1, tensor_name=\"edge_14621...amicStitch\", _device=\"/job:localhost/replica:0/task:0/device:GPU:1\"]]\nCaused by op 'model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3', defined at:\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 369, in \nmain()\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 365, in main\ntrain(log_dir, args)\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 231, in train\nmodel.add_gradients()\nFile \"/tmp/apprunner/.working/runtime/app/models/tacotron.py\", line 256, in add_gradients\ngrad_vars = optimizer.compute_gradients(self.loss, colocate_gradients_with_ops=True)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 511, in compute_gradients\ncolocate_gradients_with_ops=colocate_gradients_with_ops)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 532, in gradients\ngate_gradients, aggregation_method, stop_gradients)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 701, in _GradientsHelper\nlambda: grad_fn(op, *out_grads))\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 396, in _MaybeCompile\nreturn grad_fn()  # Exit early\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 701, in \nlambda: grad_fn(op, *out_grads))\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_grad.py\", line 161, in _TensorArrayGatherGrad\n.grad(source=grad_source, flow=flow))\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 812, in grad\nreturn self._implementation.grad(source, flow=flow, name=name)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 239, in grad\nhandle=self._handle, source=source, flow_in=flow, name=name)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 6229, in tensor_array_grad_v3\nname=name)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\nop_def=op_def)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 3414, in create_op\nop_def=op_def)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1740, in init\nself._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\n...which was originally created as op 'model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3', defined at:\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 369, in \nmain()\n[elided 0 identical lines from previous traceback]\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 365, in main\ntrain(log_dir, args)\nFile \"/tmp/apprunner/.working/runtime/app/train.py\", line 229, in train\nfeeder.target_lengths, global_step=global_step)\nFile \"/tmp/apprunner/.working/runtime/app/models/tacotron.py\", line 115, in initialize\nmaximum_iterations=max_iters)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 329, in dynamic_decode\nfinal_outputs = nest.map_structure(lambda ta: ta.stack(), final_outputs_ta)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/util/nest.py\", line 374, in map_structure\nstructure[0], [func(*x) for x in entries])\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/util/nest.py\", line 374, in \nstructure[0], [func(*x) for x in entries])\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 329, in \nfinal_outputs = nest.map_structure(lambda ta: ta.stack(), final_outputs_ta)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 856, in stack\nreturn self._implementation.stack(name=name)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 289, in stack\nreturn self.gather(math_ops.range(0, self.size()), name=name)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 303, in gather\nelement_shape=element_shape)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 6018, in tensor_array_gather_v3\nflow_in=flow_in, dtype=dtype, element_shape=element_shape, name=name)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\nop_def=op_def)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 3414, in create_op\nop_def=op_def)\nFile \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1740, in init\nself._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\nNotFoundError (see above for traceback): Resource __per_step_11/_tensor_arraysmodel/tower_2/tacotron/decoder/TensorArray_3/N10tensorflow11TensorArrayE does not exist.\n[[Node: model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3 = TensorArrayGradV3[_class=[\"loc:@model...yScatterV3\"], source=\"model/tower_2/gradients\", _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](model/tower_2/tacotron/decoder/TensorArray/_231, model/tower_2/tacotron/decoder/while/Exit_1/_1161)]]\n[[Node: model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch/_1982 = _SendT=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device_incarnation=1, tensor_name=\"edge_14621...amicStitch\", _device=\"/job:localhost/replica:0/task:0/device:GPU:1\"]]", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: Yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Ubuntu 16.04\r\n- **Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device**: .\r\n- **TensorFlow installed from (source or binary)**: binary\r\n- **TensorFlow version (use command below)**: 1.9.0\r\n- **Python version**: 3.5.0\r\n- **Bazel version (if compiling from source)**: /\r\n- **GCC/Compiler version (if compiling from source)**: /\r\n- **CUDA/cuDNN version**: 9.1\r\n- **GPU model and memory**: Tesla M40 24GB, Tesla P100 16GB\r\n- **Exact command to reproduce**: /\r\n\r\n### Describe the problem\r\nAn exception is produced when I try to run a slightly modified version of a implementation of Tacotron-2(https://github.com/Rayhane-mamah/Tacotron-2.git). The problem can be reproduced with batch size=32 or 48, but not with batch size=64, either on single or multiple GPUs.\r\nExact the same exception may occur on another model of my own, when the batch size is large enough.\r\nIn my implementation variables (VariableV2 ops) are placed on CPU0, while other ops are placed on GPU towers.\r\nThe problem looks similar with https://github.com/tensorflow/tensorflow/issues/22094\r\n\r\n**Update**\r\nThe problems only occurs when colocate_gradients_with_ops=True in gradients computation.\r\n### Source code / logs\r\n2018-09-29 05:10:28.440837: W tensorflow/core/framework/op_kernel.cc:1318] OP_REQUIRES failed at tensor_array_ops.cc:121 : Not found: Resource __per_step_11/_tensor_arraysmodel/tower_2/tacotron/decoder/TensorArray_3/N10tensorflow11TensorArrayE does not exist.\r\nExiting due to exception: Resource __per_step_11/_tensor_arraysmodel/tower_2/tacotron/decoder/TensorArray_3/N10tensorflow11TensorArrayE does not exist.\r\n\t [[Node: model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3 = TensorArrayGradV3[_class=[\"loc:@model...yScatterV3\"], source=\"model/tower_2/gradients\", _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](model/tower_2/tacotron/decoder/TensorArray/_231, model/tower_2/tacotron/decoder/while/Exit_1/_1161)]]\r\n\t [[Node: model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch/_1982 = _Send[T=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device_incarnation=1, tensor_name=\"edge_14621...amicStitch\", _device=\"/job:localhost/replica:0/task:0/device:GPU:1\"](model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch)]]\r\n\r\nCaused by op 'model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3', defined at:\r\n  File \"/tmp/apprunner/.working/runtime/app/train.py\", line 369, in <module>\r\n    main()\r\n  File \"/tmp/apprunner/.working/runtime/app/train.py\", line 365, in main\r\n    train(log_dir, args)\r\n  File \"/tmp/apprunner/.working/runtime/app/train.py\", line 231, in train\r\n    model.add_gradients()\r\n  File \"/tmp/apprunner/.working/runtime/app/models/tacotron.py\", line 256, in add_gradients\r\n    grad_vars = optimizer.compute_gradients(self.loss, colocate_gradients_with_ops=True)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 511, in compute_gradients\r\n    colocate_gradients_with_ops=colocate_gradients_with_ops)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 532, in gradients\r\n    gate_gradients, aggregation_method, stop_gradients)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 701, in _GradientsHelper\r\n    lambda: grad_fn(op, *out_grads))\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 396, in _MaybeCompile\r\n    return grad_fn()  # Exit early\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 701, in <lambda>\r\n    lambda: grad_fn(op, *out_grads))\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_grad.py\", line 161, in _TensorArrayGatherGrad\r\n    .grad(source=grad_source, flow=flow))\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 812, in grad\r\n    return self._implementation.grad(source, flow=flow, name=name)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 239, in grad\r\n    handle=self._handle, source=source, flow_in=flow, name=name)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 6229, in tensor_array_grad_v3\r\n    name=name)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 3414, in create_op\r\n    op_def=op_def)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1740, in __init__\r\n    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\r\n\r\n...which was originally created as op 'model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3', defined at:\r\n  File \"/tmp/apprunner/.working/runtime/app/train.py\", line 369, in <module>\r\n    main()\r\n[elided 0 identical lines from previous traceback]\r\n  File \"/tmp/apprunner/.working/runtime/app/train.py\", line 365, in main\r\n    train(log_dir, args)\r\n  File \"/tmp/apprunner/.working/runtime/app/train.py\", line 229, in train\r\n    feeder.target_lengths, global_step=global_step)\r\n  File \"/tmp/apprunner/.working/runtime/app/models/tacotron.py\", line 115, in initialize\r\n    maximum_iterations=max_iters)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 329, in dynamic_decode\r\n    final_outputs = nest.map_structure(lambda ta: ta.stack(), final_outputs_ta)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/util/nest.py\", line 374, in map_structure\r\n    structure[0], [func(*x) for x in entries])\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/util/nest.py\", line 374, in <listcomp>\r\n    structure[0], [func(*x) for x in entries])\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 329, in <lambda>\r\n    final_outputs = nest.map_structure(lambda ta: ta.stack(), final_outputs_ta)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 856, in stack\r\n    return self._implementation.stack(name=name)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 289, in stack\r\n    return self.gather(math_ops.range(0, self.size()), name=name)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 303, in gather\r\n    element_shape=element_shape)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 6018, in tensor_array_gather_v3\r\n    flow_in=flow_in, dtype=dtype, element_shape=element_shape, name=name)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 3414, in create_op\r\n    op_def=op_def)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1740, in __init__\r\n    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\r\n\r\nNotFoundError (see above for traceback): Resource __per_step_11/_tensor_arraysmodel/tower_2/tacotron/decoder/TensorArray_3/N10tensorflow11TensorArrayE does not exist.\r\n\t [[Node: model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3 = TensorArrayGradV3[_class=[\"loc:@model...yScatterV3\"], source=\"model/tower_2/gradients\", _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](model/tower_2/tacotron/decoder/TensorArray/_231, model/tower_2/tacotron/decoder/while/Exit_1/_1161)]]\r\n\t [[Node: model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch/_1982 = _Send[T=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device_incarnation=1, tensor_name=\"edge_14621...amicStitch\", _device=\"/job:localhost/replica:0/task:0/device:GPU:1\"](model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch)]]\r\n\r\nTraceback (most recent call last):\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1322, in _do_call\r\n    return fn(*args)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1307, in _run_fn\r\n    options, feed_dict, fetch_list, target_list, run_metadata)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1409, in _call_tf_sessionrun\r\n    run_metadata)\r\ntensorflow.python.framework.errors_impl.NotFoundError: Resource __per_step_11/_tensor_arraysmodel/tower_2/tacotron/decoder/TensorArray_3/N10tensorflow11TensorArrayE does not exist.\r\n\t [[Node: model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3 = TensorArrayGradV3[_class=[\"loc:@model...yScatterV3\"], source=\"model/tower_2/gradients\", _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](model/tower_2/tacotron/decoder/TensorArray/_231, model/tower_2/tacotron/decoder/while/Exit_1/_1161)]]\r\n\t [[Node: model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch/_1982 = _Send[T=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device_incarnation=1, tensor_name=\"edge_14621...amicStitch\", _device=\"/job:localhost/replica:0/task:0/device:GPU:1\"](model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch)]]\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/tmp/apprunner/.working/runtime/app/train.py\", line 283, in train\r\n    step, loss, _, target_lengths = sess.run([global_step, avg_loss, train_op, feeder.target_lengths])\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 900, in run\r\n    run_metadata_ptr)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1135, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1316, in _do_run\r\n    run_metadata)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1335, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.NotFoundError: Resource __per_step_11/_tensor_arraysmodel/tower_2/tacotron/decoder/TensorArray_3/N10tensorflow11TensorArrayE does not exist.\r\n\t [[Node: model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3 = TensorArrayGradV3[_class=[\"loc:@model...yScatterV3\"], source=\"model/tower_2/gradients\", _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](model/tower_2/tacotron/decoder/TensorArray/_231, model/tower_2/tacotron/decoder/while/Exit_1/_1161)]]\r\n\t [[Node: model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch/_1982 = _Send[T=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device_incarnation=1, tensor_name=\"edge_14621...amicStitch\", _device=\"/job:localhost/replica:0/task:0/device:GPU:1\"](model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch)]]\r\n\r\nCaused by op 'model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3', defined at:\r\n  File \"/tmp/apprunner/.working/runtime/app/train.py\", line 369, in <module>\r\n    main()\r\n  File \"/tmp/apprunner/.working/runtime/app/train.py\", line 365, in main\r\n    train(log_dir, args)\r\n  File \"/tmp/apprunner/.working/runtime/app/train.py\", line 231, in train\r\n    model.add_gradients()\r\n  File \"/tmp/apprunner/.working/runtime/app/models/tacotron.py\", line 256, in add_gradients\r\n    grad_vars = optimizer.compute_gradients(self.loss, colocate_gradients_with_ops=True)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 511, in compute_gradients\r\n    colocate_gradients_with_ops=colocate_gradients_with_ops)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 532, in gradients\r\n    gate_gradients, aggregation_method, stop_gradients)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 701, in _GradientsHelper\r\n    lambda: grad_fn(op, *out_grads))\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 396, in _MaybeCompile\r\n    return grad_fn()  # Exit early\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gradients_impl.py\", line 701, in <lambda>\r\n    lambda: grad_fn(op, *out_grads))\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_grad.py\", line 161, in _TensorArrayGatherGrad\r\n    .grad(source=grad_source, flow=flow))\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 812, in grad\r\n    return self._implementation.grad(source, flow=flow, name=name)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 239, in grad\r\n    handle=self._handle, source=source, flow_in=flow, name=name)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 6229, in tensor_array_grad_v3\r\n    name=name)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 3414, in create_op\r\n    op_def=op_def)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1740, in __init__\r\n    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\r\n\r\n...which was originally created as op 'model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3', defined at:\r\n  File \"/tmp/apprunner/.working/runtime/app/train.py\", line 369, in <module>\r\n    main()\r\n[elided 0 identical lines from previous traceback]\r\n  File \"/tmp/apprunner/.working/runtime/app/train.py\", line 365, in main\r\n    train(log_dir, args)\r\n  File \"/tmp/apprunner/.working/runtime/app/train.py\", line 229, in train\r\n    feeder.target_lengths, global_step=global_step)\r\n  File \"/tmp/apprunner/.working/runtime/app/models/tacotron.py\", line 115, in initialize\r\n    maximum_iterations=max_iters)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 329, in dynamic_decode\r\n    final_outputs = nest.map_structure(lambda ta: ta.stack(), final_outputs_ta)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/util/nest.py\", line 374, in map_structure\r\n    structure[0], [func(*x) for x in entries])\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/util/nest.py\", line 374, in <listcomp>\r\n    structure[0], [func(*x) for x in entries])\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/contrib/seq2seq/python/ops/decoder.py\", line 329, in <lambda>\r\n    final_outputs = nest.map_structure(lambda ta: ta.stack(), final_outputs_ta)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 856, in stack\r\n    return self._implementation.stack(name=name)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 289, in stack\r\n    return self.gather(math_ops.range(0, self.size()), name=name)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/tensor_array_ops.py\", line 303, in gather\r\n    element_shape=element_shape)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 6018, in tensor_array_gather_v3\r\n    flow_in=flow_in, dtype=dtype, element_shape=element_shape, name=name)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 3414, in create_op\r\n    op_def=op_def)\r\n  File \"/tmp/apprunner/.working/runtime/env/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1740, in __init__\r\n    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\r\n\r\nNotFoundError (see above for traceback): Resource __per_step_11/_tensor_arraysmodel/tower_2/tacotron/decoder/TensorArray_3/N10tensorflow11TensorArrayE does not exist.\r\n\t [[Node: model/tower_2/gradients/model/tower_2/tacotron/decoder/TensorArrayStack/TensorArrayGatherV3_grad/TensorArrayGrad/TensorArrayGradV3 = TensorArrayGradV3[_class=[\"loc:@model...yScatterV3\"], source=\"model/tower_2/gradients\", _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](model/tower_2/tacotron/decoder/TensorArray/_231, model/tower_2/tacotron/decoder/while/Exit_1/_1161)]]\r\n\t [[Node: model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch/_1982 = _Send[T=DT_INT32, client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:1\", send_device_incarnation=1, tensor_name=\"edge_14621...amicStitch\", _device=\"/job:localhost/replica:0/task:0/device:GPU:1\"](model/tower_1/gradients/model/tower_1/tacotron/postnet_conv/conv1d_3/batch_normalization/moments/mean_grad/DynamicStitch)]]\r\n"}