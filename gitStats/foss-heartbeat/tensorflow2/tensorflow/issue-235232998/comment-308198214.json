{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/308198214", "html_url": "https://github.com/tensorflow/tensorflow/issues/10648#issuecomment-308198214", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10648", "id": 308198214, "node_id": "MDEyOklzc3VlQ29tbWVudDMwODE5ODIxNA==", "user": {"login": "andrewjylee", "id": 10519688, "node_id": "MDQ6VXNlcjEwNTE5Njg4", "avatar_url": "https://avatars1.githubusercontent.com/u/10519688?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewjylee", "html_url": "https://github.com/andrewjylee", "followers_url": "https://api.github.com/users/andrewjylee/followers", "following_url": "https://api.github.com/users/andrewjylee/following{/other_user}", "gists_url": "https://api.github.com/users/andrewjylee/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewjylee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewjylee/subscriptions", "organizations_url": "https://api.github.com/users/andrewjylee/orgs", "repos_url": "https://api.github.com/users/andrewjylee/repos", "events_url": "https://api.github.com/users/andrewjylee/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewjylee/received_events", "type": "User", "site_admin": false}, "created_at": "2017-06-13T17:57:44Z", "updated_at": "2017-06-13T18:06:26Z", "author_association": "NONE", "body_html": "<p>Yes - I don't see the problem in v1.1 or higher. However, our team is heavily using v1.0 and we won't be able to upgrade everything anytime soon....</p>\n<p>For what it's worth, I found a temporary fix:</p>\n<p>I have a train() method, in which i have something like</p>\n<pre><code>def train(self, ...):\n    self.get_model(...)\n    self.fit(...)\n</code></pre>\n<p>in which get_model() builds the model:</p>\n<pre><code>def get_model(self, ...):\n    tf.reset_default_graph()\n    self.tf_graph = tf.Graph()\n    with self.tf_graph.as_default():\n        build graph...(this is where I use tf.contrib.rnn)\n</code></pre>\n<p>and fit() trains the model:</p>\n<pre><code>def fit(self, ...):\n    with self.tf_graph.as_default():\n        self.sess = tf.Session()\n        self.sess.run(...)\n</code></pre>\n<p>The temporary fix I added was in train():</p>\n<pre><code>def train(self, ...):\n    _ = tf.Session()   # adding this makes the segfault go away\n    self.get_model(...)\n    self.fit(...)\n</code></pre>\n<p>What's interesting is the session returned from _ = tf.Session() is never used anywhere, because in fit() I make a new session and use that session.</p>\n<p>Hopefully this helps anyone who's also stuck in v1.0 for the moment...</p>", "body_text": "Yes - I don't see the problem in v1.1 or higher. However, our team is heavily using v1.0 and we won't be able to upgrade everything anytime soon....\nFor what it's worth, I found a temporary fix:\nI have a train() method, in which i have something like\ndef train(self, ...):\n    self.get_model(...)\n    self.fit(...)\n\nin which get_model() builds the model:\ndef get_model(self, ...):\n    tf.reset_default_graph()\n    self.tf_graph = tf.Graph()\n    with self.tf_graph.as_default():\n        build graph...(this is where I use tf.contrib.rnn)\n\nand fit() trains the model:\ndef fit(self, ...):\n    with self.tf_graph.as_default():\n        self.sess = tf.Session()\n        self.sess.run(...)\n\nThe temporary fix I added was in train():\ndef train(self, ...):\n    _ = tf.Session()   # adding this makes the segfault go away\n    self.get_model(...)\n    self.fit(...)\n\nWhat's interesting is the session returned from _ = tf.Session() is never used anywhere, because in fit() I make a new session and use that session.\nHopefully this helps anyone who's also stuck in v1.0 for the moment...", "body": "Yes - I don't see the problem in v1.1 or higher. However, our team is heavily using v1.0 and we won't be able to upgrade everything anytime soon....\r\n\r\nFor what it's worth, I found a temporary fix:\r\n\r\nI have a train() method, in which i have something like\r\n\r\n```\r\ndef train(self, ...):\r\n    self.get_model(...)\r\n    self.fit(...)\r\n```\r\n\r\nin which get_model() builds the model:\r\n\r\n```\r\ndef get_model(self, ...):\r\n    tf.reset_default_graph()\r\n    self.tf_graph = tf.Graph()\r\n    with self.tf_graph.as_default():\r\n        build graph...(this is where I use tf.contrib.rnn)\r\n```\r\n\r\nand fit() trains the model:\r\n\r\n```\r\ndef fit(self, ...):\r\n    with self.tf_graph.as_default():\r\n        self.sess = tf.Session()\r\n        self.sess.run(...)\r\n```\r\n\r\n\r\n\r\nThe temporary fix I added was in train():\r\n\r\n```\r\ndef train(self, ...):\r\n    _ = tf.Session()   # adding this makes the segfault go away\r\n    self.get_model(...)\r\n    self.fit(...)\r\n```\r\n\r\n\r\nWhat's interesting is the session returned from _ = tf.Session() is never used anywhere, because in fit() I make a new session and use that session. \r\n\r\nHopefully this helps anyone who's also stuck in v1.0 for the moment...\r\n\r\n\r\n"}