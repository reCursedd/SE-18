{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/415124686", "html_url": "https://github.com/tensorflow/tensorflow/issues/21738#issuecomment-415124686", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21738", "id": 415124686, "node_id": "MDEyOklzc3VlQ29tbWVudDQxNTEyNDY4Ng==", "user": {"login": "omalleyt12", "id": 29100818, "node_id": "MDQ6VXNlcjI5MTAwODE4", "avatar_url": "https://avatars3.githubusercontent.com/u/29100818?v=4", "gravatar_id": "", "url": "https://api.github.com/users/omalleyt12", "html_url": "https://github.com/omalleyt12", "followers_url": "https://api.github.com/users/omalleyt12/followers", "following_url": "https://api.github.com/users/omalleyt12/following{/other_user}", "gists_url": "https://api.github.com/users/omalleyt12/gists{/gist_id}", "starred_url": "https://api.github.com/users/omalleyt12/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/omalleyt12/subscriptions", "organizations_url": "https://api.github.com/users/omalleyt12/orgs", "repos_url": "https://api.github.com/users/omalleyt12/repos", "events_url": "https://api.github.com/users/omalleyt12/events{/privacy}", "received_events_url": "https://api.github.com/users/omalleyt12/received_events", "type": "User", "site_admin": false}, "created_at": "2018-08-22T18:03:28Z", "updated_at": "2018-08-22T18:03:28Z", "author_association": "NONE", "body_html": "<p>Hi <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=8188686\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/kmadhugit\">@kmadhugit</a>, it looks like the default values for some tf.keras initializers are different than those in external Keras, causing this problem. I have a fix in progress, in the meantime you can get the desired behavior with:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\n<span class=\"pl-k\">from</span> tensorflow.python.keras.layers <span class=\"pl-k\">import</span> Flatten,Dense,Dropout\n<span class=\"pl-k\">from</span> tensorflow.python.keras.models <span class=\"pl-k\">import</span> Sequential\n<span class=\"pl-k\">from</span> tensorflow.python.keras.initializers <span class=\"pl-k\">import</span> RandomUniform\n\nmnist <span class=\"pl-k\">=</span> tf.keras.datasets.mnist\n\n(x_train, y_train),(x_test, y_test) <span class=\"pl-k\">=</span> mnist.load_data()\nx_train, x_test <span class=\"pl-k\">=</span> x_train <span class=\"pl-k\">/</span> <span class=\"pl-c1\">255.0</span>, x_test <span class=\"pl-k\">/</span> <span class=\"pl-c1\">255.0</span>\n\n<span class=\"pl-k\">import</span> keras\n<span class=\"pl-c1\">print</span>(<span class=\"pl-s\">f</span><span class=\"pl-pds\">'</span><span class=\"pl-s\">tf version = </span><span class=\"pl-c1\">{</span>tf.<span class=\"pl-c1\">__version__</span><span class=\"pl-c1\">}</span><span class=\"pl-s\"> </span><span class=\"pl-pds\">'</span>)\n\nmodel <span class=\"pl-k\">=</span> Sequential([\n  Flatten(<span class=\"pl-v\">input_shape</span><span class=\"pl-k\">=</span>(<span class=\"pl-c1\">28</span>,<span class=\"pl-c1\">28</span>)),\n  Dense(<span class=\"pl-c1\">512</span>, <span class=\"pl-v\">kernel_initializer</span><span class=\"pl-k\">=</span>RandomUniform(<span class=\"pl-v\">minval</span><span class=\"pl-k\">=</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">0.05</span>, <span class=\"pl-v\">maxval</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">0.05</span>), <span class=\"pl-v\">activation</span><span class=\"pl-k\">=</span>tf.nn.relu),\n  Dropout(<span class=\"pl-c1\">0.2</span>),\n  Dense(<span class=\"pl-c1\">10</span>, <span class=\"pl-v\">kernel_initializer</span><span class=\"pl-k\">=</span>RandomUniform(<span class=\"pl-v\">minval</span><span class=\"pl-k\">=</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">0.05</span>, <span class=\"pl-v\">maxval</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">0.05</span>), <span class=\"pl-v\">activation</span><span class=\"pl-k\">=</span>tf.nn.softmax)\n])\n\n\nmodel.compile(<span class=\"pl-v\">optimizer</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>adam<span class=\"pl-pds\">'</span></span>,\n              <span class=\"pl-v\">loss</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>sparse_categorical_crossentropy<span class=\"pl-pds\">'</span></span>,\n              <span class=\"pl-v\">metrics</span><span class=\"pl-k\">=</span>[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>accuracy<span class=\"pl-pds\">'</span></span>])\n\nmodel.fit(x_train, y_train, <span class=\"pl-v\">epochs</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">1</span>)\nmodel.evaluate(x_test, y_test)</pre></div>\n<p>I'll update this thread when the fix is available</p>", "body_text": "Hi @kmadhugit, it looks like the default values for some tf.keras initializers are different than those in external Keras, causing this problem. I have a fix in progress, in the meantime you can get the desired behavior with:\nimport tensorflow as tf\n\nfrom tensorflow.python.keras.layers import Flatten,Dense,Dropout\nfrom tensorflow.python.keras.models import Sequential\nfrom tensorflow.python.keras.initializers import RandomUniform\n\nmnist = tf.keras.datasets.mnist\n\n(x_train, y_train),(x_test, y_test) = mnist.load_data()\nx_train, x_test = x_train / 255.0, x_test / 255.0\n\nimport keras\nprint(f'tf version = {tf.__version__} ')\n\nmodel = Sequential([\n  Flatten(input_shape=(28,28)),\n  Dense(512, kernel_initializer=RandomUniform(minval=-0.05, maxval=0.05), activation=tf.nn.relu),\n  Dropout(0.2),\n  Dense(10, kernel_initializer=RandomUniform(minval=-0.05, maxval=0.05), activation=tf.nn.softmax)\n])\n\n\nmodel.compile(optimizer='adam',\n              loss='sparse_categorical_crossentropy',\n              metrics=['accuracy'])\n\nmodel.fit(x_train, y_train, epochs=1)\nmodel.evaluate(x_test, y_test)\nI'll update this thread when the fix is available", "body": "Hi @kmadhugit, it looks like the default values for some tf.keras initializers are different than those in external Keras, causing this problem. I have a fix in progress, in the meantime you can get the desired behavior with:\r\n\r\n```python\r\nimport tensorflow as tf\r\n\r\nfrom tensorflow.python.keras.layers import Flatten,Dense,Dropout\r\nfrom tensorflow.python.keras.models import Sequential\r\nfrom tensorflow.python.keras.initializers import RandomUniform\r\n\r\nmnist = tf.keras.datasets.mnist\r\n\r\n(x_train, y_train),(x_test, y_test) = mnist.load_data()\r\nx_train, x_test = x_train / 255.0, x_test / 255.0\r\n\r\nimport keras\r\nprint(f'tf version = {tf.__version__} ')\r\n\r\nmodel = Sequential([\r\n  Flatten(input_shape=(28,28)),\r\n  Dense(512, kernel_initializer=RandomUniform(minval=-0.05, maxval=0.05), activation=tf.nn.relu),\r\n  Dropout(0.2),\r\n  Dense(10, kernel_initializer=RandomUniform(minval=-0.05, maxval=0.05), activation=tf.nn.softmax)\r\n])\r\n\r\n\r\nmodel.compile(optimizer='adam',\r\n              loss='sparse_categorical_crossentropy',\r\n              metrics=['accuracy'])\r\n\r\nmodel.fit(x_train, y_train, epochs=1)\r\nmodel.evaluate(x_test, y_test)\r\n```\r\n\r\nI'll update this thread when the fix is available\r\n"}