{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5334", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5334/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5334/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5334/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/5334", "id": 186611285, "node_id": "MDU6SXNzdWUxODY2MTEyODU=", "number": 5334, "title": "tensorboard raises `FailedPreconditionError`", "user": {"login": "woodshop", "id": 4654379, "node_id": "MDQ6VXNlcjQ2NTQzNzk=", "avatar_url": "https://avatars3.githubusercontent.com/u/4654379?v=4", "gravatar_id": "", "url": "https://api.github.com/users/woodshop", "html_url": "https://github.com/woodshop", "followers_url": "https://api.github.com/users/woodshop/followers", "following_url": "https://api.github.com/users/woodshop/following{/other_user}", "gists_url": "https://api.github.com/users/woodshop/gists{/gist_id}", "starred_url": "https://api.github.com/users/woodshop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/woodshop/subscriptions", "organizations_url": "https://api.github.com/users/woodshop/orgs", "repos_url": "https://api.github.com/users/woodshop/repos", "events_url": "https://api.github.com/users/woodshop/events{/privacy}", "received_events_url": "https://api.github.com/users/woodshop/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}, {"id": 473173351, "node_id": "MDU6TGFiZWw0NzMxNzMzNTE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:build/install", "name": "type:build/install", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-11-01T18:34:06Z", "updated_at": "2016-11-02T21:33:41Z", "closed_at": "2016-11-02T13:49:17Z", "author_association": "NONE", "body_html": "<h2>Description</h2>\n<p>Tensorboard always raises the exception <code>FailedPreconditionError</code> in my environment. I have it running with parameter <code>logdir</code> pointing to a directory that is tracking active experiments. Tensorboard raises an exception after a few minutes with a Traceback similar to the following:</p>\n<div class=\"highlight highlight-source-shell\"><pre>tensorboard --debug --logdir <span class=\"pl-c1\">.</span>\nI tensorflow/stream_executor/dso_loader.cc:125] successfully opened CUDA library libcublas.so locally\nI tensorflow/stream_executor/dso_loader.cc:125] successfully opened CUDA library libcudnn.so locally\nI tensorflow/stream_executor/dso_loader.cc:125] successfully opened CUDA library libcufft.so locally\nI tensorflow/stream_executor/dso_loader.cc:125] successfully opened CUDA library libcuda.so.1 locally\nI tensorflow/stream_executor/dso_loader.cc:125] successfully opened CUDA library libcurand.so locally\nINFO:tensorflow:TensorBoard is <span class=\"pl-k\">in</span> debug mode.\nINFO:tensorflow:Starting TensorBoard <span class=\"pl-k\">in</span> directory /media/data/sarroff/experiments/source_separation/logdir3\nINFO:tensorflow:TensorBoard path_to_run is: {<span class=\"pl-s\"><span class=\"pl-pds\">'</span>/media/data/sarroff/experiments/source_separation/logdir3<span class=\"pl-pds\">'</span></span>: None}\nINFO:tensorflow:TensorBoard is tag: 33\nStarting TensorBoard 33 on port 6006\n(You can navigate to http://127.0.1.1:6006)\nINFO:tensorflow:Adding events from directory /media/data/sarroff/experiments/source_separation/logdir3/train/161031224434\nINFO:tensorflow:Constructing EventAccumulator <span class=\"pl-k\">for</span> /media/data/sarroff/experiments/source_separation/logdir3/train/161031224434\nDEBUG:tensorflow:Opening a record reader pointing at /media/data/sarroff/experiments/source_separation/logdir3/train/161031224434/events.out.tfevents.1477968276.eltopo\nDEBUG:tensorflow:No more events <span class=\"pl-k\">in</span> /media/data/sarroff/experiments/source_separation/logdir3/train/161031224434/events.out.tfevents.1477968276.eltopo\nINFO:tensorflow:No path found after /media/data/sarroff/experiments/source_separation/logdir3/train/161031224434/events.out.tfevents.1477968276.eltopo\nINFO:tensorflow:Multiplexer <span class=\"pl-k\">done</span> loading. Load took 49.9 secs\n\n... <span class=\"pl-k\">&lt;</span>snip<span class=\"pl-k\">&gt;</span> ...\n\nException <span class=\"pl-k\">in</span> thread Thread-1:\nTraceback (most recent call last):\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/threading.py<span class=\"pl-pds\">\"</span></span>, line 801, <span class=\"pl-k\">in</span> __bootstrap_inner\n    <span class=\"pl-en\">self.run</span>()\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/threading.py<span class=\"pl-pds\">\"</span></span>, line 754, <span class=\"pl-k\">in</span> run\n    self.__target(<span class=\"pl-k\">*</span>self.__args, <span class=\"pl-k\">**</span>self.__kwargs)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/tensorboard/backend/server.py<span class=\"pl-pds\">\"</span></span>, line 126, <span class=\"pl-k\">in</span> _ReloadForever\n    ReloadMultiplexer(multiplexer, path_to_run)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/tensorboard/backend/server.py<span class=\"pl-pds\">\"</span></span>, line 100, <span class=\"pl-k\">in</span> ReloadMultiplexer\n    multiplexer.AddRunsFromDirectory(path, name)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/summary/event_multiplexer.py<span class=\"pl-pds\">\"</span></span>, line 178, <span class=\"pl-k\">in</span> AddRunsFromDirectory\n    <span class=\"pl-k\">for</span> <span class=\"pl-smi\">subdir</span> <span class=\"pl-k\">in</span> GetLogdirSubdirectories(path):\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/summary/event_multiplexer.py<span class=\"pl-pds\">\"</span></span>, line 396, <span class=\"pl-k\">in</span> <span class=\"pl-k\">&lt;</span>genexpr<span class=\"pl-k\">&gt;</span>\n    subdir\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/summary/impl/io_wrapper.py<span class=\"pl-pds\">\"</span></span>, line 50, <span class=\"pl-k\">in</span> ListRecursively\n    <span class=\"pl-k\">for</span> <span class=\"pl-smi\">dir_path, _, filenames</span> <span class=\"pl-k\">in</span> gfile.Walk(top):\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/lib/io/file_io.py<span class=\"pl-pds\">\"</span></span>, line 415, <span class=\"pl-k\">in</span> walk\n    listing = list_directory(top)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/lib/io/file_io.py<span class=\"pl-pds\">\"</span></span>, line 391, <span class=\"pl-k\">in</span> list_directory\n    file_list = get_matching_files(os.path.join(compat.as_str_any(dirname), <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>*<span class=\"pl-pds\">\"</span></span>))\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/lib/io/file_io.py<span class=\"pl-pds\">\"</span></span>, line 260, <span class=\"pl-k\">in</span> get_matching_files\n    compat.as_bytes(filename), status)]\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/contextlib.py<span class=\"pl-pds\">\"</span></span>, line 24, <span class=\"pl-k\">in</span> __exit__\n    <span class=\"pl-en\">self.gen.next</span>()\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/framework/errors.py<span class=\"pl-pds\">\"</span></span>, line 463, <span class=\"pl-k\">in</span> raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\nFailedPreconditionError: /media/data/sarroff/experiments/source_separation/logdir3/train/161031224434/model.ckpt-263550.index</pre></div>\n<p>The accompanying exception message mentions a different file every time and the exception is raised at some arbitrary time after execution. It is therefore not easy to replicate my issue deterministically.</p>\n<h2>Environment</h2>\n<p>Ubuntu 16.04LTS<br>\nTensorFlow commit <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/1fcd6d1294564066c6f92b121a3aaf4ed186dc1a/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/1fcd6d1294564066c6f92b121a3aaf4ed186dc1a\"><tt>1fcd6d1</tt></a></p>\n<h2>Proposed Cause</h2>\n<p>This is just a guess; I'm not too familiar with the code: The exception is raised in <code>FileSystem::GetMatchingPaths</code>. Perhaps, while traversing the directory, some files get incorrectly marked as directories. If so, then the error probably happens during the call to <code>opendir</code> in <code>PosixFileSystem::GetChildren</code>. Error codes which are mapped to <code>FailedPreconditionError</code> are listed in <code>tensorflow/core/platform/posix/error.cc</code>. A likely error code causing the exception is <code>ENOTDIR</code>. I don't have an explanation as to why files would occasionally be incorrectly marked as directories. Perhaps there is a problem unique to my environment.</p>\n<p>I've also noticed the recent Issue <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"182612666\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/4921\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/4921/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/4921\">#4921</a>, which specifically mentions problems with <code>FileSystem::GetMatchingPaths</code>. Perhaps this issue is connected with that one.</p>", "body_text": "Description\nTensorboard always raises the exception FailedPreconditionError in my environment. I have it running with parameter logdir pointing to a directory that is tracking active experiments. Tensorboard raises an exception after a few minutes with a Traceback similar to the following:\ntensorboard --debug --logdir .\nI tensorflow/stream_executor/dso_loader.cc:125] successfully opened CUDA library libcublas.so locally\nI tensorflow/stream_executor/dso_loader.cc:125] successfully opened CUDA library libcudnn.so locally\nI tensorflow/stream_executor/dso_loader.cc:125] successfully opened CUDA library libcufft.so locally\nI tensorflow/stream_executor/dso_loader.cc:125] successfully opened CUDA library libcuda.so.1 locally\nI tensorflow/stream_executor/dso_loader.cc:125] successfully opened CUDA library libcurand.so locally\nINFO:tensorflow:TensorBoard is in debug mode.\nINFO:tensorflow:Starting TensorBoard in directory /media/data/sarroff/experiments/source_separation/logdir3\nINFO:tensorflow:TensorBoard path_to_run is: {'/media/data/sarroff/experiments/source_separation/logdir3': None}\nINFO:tensorflow:TensorBoard is tag: 33\nStarting TensorBoard 33 on port 6006\n(You can navigate to http://127.0.1.1:6006)\nINFO:tensorflow:Adding events from directory /media/data/sarroff/experiments/source_separation/logdir3/train/161031224434\nINFO:tensorflow:Constructing EventAccumulator for /media/data/sarroff/experiments/source_separation/logdir3/train/161031224434\nDEBUG:tensorflow:Opening a record reader pointing at /media/data/sarroff/experiments/source_separation/logdir3/train/161031224434/events.out.tfevents.1477968276.eltopo\nDEBUG:tensorflow:No more events in /media/data/sarroff/experiments/source_separation/logdir3/train/161031224434/events.out.tfevents.1477968276.eltopo\nINFO:tensorflow:No path found after /media/data/sarroff/experiments/source_separation/logdir3/train/161031224434/events.out.tfevents.1477968276.eltopo\nINFO:tensorflow:Multiplexer done loading. Load took 49.9 secs\n\n... <snip> ...\n\nException in thread Thread-1:\nTraceback (most recent call last):\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/threading.py\", line 801, in __bootstrap_inner\n    self.run()\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/threading.py\", line 754, in run\n    self.__target(*self.__args, **self.__kwargs)\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/tensorboard/backend/server.py\", line 126, in _ReloadForever\n    ReloadMultiplexer(multiplexer, path_to_run)\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/tensorboard/backend/server.py\", line 100, in ReloadMultiplexer\n    multiplexer.AddRunsFromDirectory(path, name)\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/summary/event_multiplexer.py\", line 178, in AddRunsFromDirectory\n    for subdir in GetLogdirSubdirectories(path):\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/summary/event_multiplexer.py\", line 396, in <genexpr>\n    subdir\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/summary/impl/io_wrapper.py\", line 50, in ListRecursively\n    for dir_path, _, filenames in gfile.Walk(top):\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/lib/io/file_io.py\", line 415, in walk\n    listing = list_directory(top)\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/lib/io/file_io.py\", line 391, in list_directory\n    file_list = get_matching_files(os.path.join(compat.as_str_any(dirname), \"*\"))\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/lib/io/file_io.py\", line 260, in get_matching_files\n    compat.as_bytes(filename), status)]\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/contextlib.py\", line 24, in __exit__\n    self.gen.next()\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/framework/errors.py\", line 463, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\nFailedPreconditionError: /media/data/sarroff/experiments/source_separation/logdir3/train/161031224434/model.ckpt-263550.index\nThe accompanying exception message mentions a different file every time and the exception is raised at some arbitrary time after execution. It is therefore not easy to replicate my issue deterministically.\nEnvironment\nUbuntu 16.04LTS\nTensorFlow commit 1fcd6d1\nProposed Cause\nThis is just a guess; I'm not too familiar with the code: The exception is raised in FileSystem::GetMatchingPaths. Perhaps, while traversing the directory, some files get incorrectly marked as directories. If so, then the error probably happens during the call to opendir in PosixFileSystem::GetChildren. Error codes which are mapped to FailedPreconditionError are listed in tensorflow/core/platform/posix/error.cc. A likely error code causing the exception is ENOTDIR. I don't have an explanation as to why files would occasionally be incorrectly marked as directories. Perhaps there is a problem unique to my environment.\nI've also noticed the recent Issue #4921, which specifically mentions problems with FileSystem::GetMatchingPaths. Perhaps this issue is connected with that one.", "body": "## Description\r\nTensorboard always raises the exception `FailedPreconditionError` in my environment. I have it running with parameter `logdir` pointing to a directory that is tracking active experiments. Tensorboard raises an exception after a few minutes with a Traceback similar to the following:\r\n```bash\r\ntensorboard --debug --logdir .\r\nI tensorflow/stream_executor/dso_loader.cc:125] successfully opened CUDA library libcublas.so locally\r\nI tensorflow/stream_executor/dso_loader.cc:125] successfully opened CUDA library libcudnn.so locally\r\nI tensorflow/stream_executor/dso_loader.cc:125] successfully opened CUDA library libcufft.so locally\r\nI tensorflow/stream_executor/dso_loader.cc:125] successfully opened CUDA library libcuda.so.1 locally\r\nI tensorflow/stream_executor/dso_loader.cc:125] successfully opened CUDA library libcurand.so locally\r\nINFO:tensorflow:TensorBoard is in debug mode.\r\nINFO:tensorflow:Starting TensorBoard in directory /media/data/sarroff/experiments/source_separation/logdir3\r\nINFO:tensorflow:TensorBoard path_to_run is: {'/media/data/sarroff/experiments/source_separation/logdir3': None}\r\nINFO:tensorflow:TensorBoard is tag: 33\r\nStarting TensorBoard 33 on port 6006\r\n(You can navigate to http://127.0.1.1:6006)\r\nINFO:tensorflow:Adding events from directory /media/data/sarroff/experiments/source_separation/logdir3/train/161031224434\r\nINFO:tensorflow:Constructing EventAccumulator for /media/data/sarroff/experiments/source_separation/logdir3/train/161031224434\r\nDEBUG:tensorflow:Opening a record reader pointing at /media/data/sarroff/experiments/source_separation/logdir3/train/161031224434/events.out.tfevents.1477968276.eltopo\r\nDEBUG:tensorflow:No more events in /media/data/sarroff/experiments/source_separation/logdir3/train/161031224434/events.out.tfevents.1477968276.eltopo\r\nINFO:tensorflow:No path found after /media/data/sarroff/experiments/source_separation/logdir3/train/161031224434/events.out.tfevents.1477968276.eltopo\r\nINFO:tensorflow:Multiplexer done loading. Load took 49.9 secs\r\n\r\n... <snip> ...\r\n\r\nException in thread Thread-1:\r\nTraceback (most recent call last):\r\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/threading.py\", line 801, in __bootstrap_inner\r\n    self.run()\r\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/threading.py\", line 754, in run\r\n    self.__target(*self.__args, **self.__kwargs)\r\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/tensorboard/backend/server.py\", line 126, in _ReloadForever\r\n    ReloadMultiplexer(multiplexer, path_to_run)\r\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/tensorboard/backend/server.py\", line 100, in ReloadMultiplexer\r\n    multiplexer.AddRunsFromDirectory(path, name)\r\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/summary/event_multiplexer.py\", line 178, in AddRunsFromDirectory\r\n    for subdir in GetLogdirSubdirectories(path):\r\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/summary/event_multiplexer.py\", line 396, in <genexpr>\r\n    subdir\r\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/summary/impl/io_wrapper.py\", line 50, in ListRecursively\r\n    for dir_path, _, filenames in gfile.Walk(top):\r\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/lib/io/file_io.py\", line 415, in walk\r\n    listing = list_directory(top)\r\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/lib/io/file_io.py\", line 391, in list_directory\r\n    file_list = get_matching_files(os.path.join(compat.as_str_any(dirname), \"*\"))\r\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/lib/io/file_io.py\", line 260, in get_matching_files\r\n    compat.as_bytes(filename), status)]\r\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/contextlib.py\", line 24, in __exit__\r\n    self.gen.next()\r\n  File \"/home/sarroff/anaconda2/envs/tensorflow/lib/python2.7/site-packages/tensorflow/python/framework/errors.py\", line 463, in raise_exception_on_not_ok_status\r\n    pywrap_tensorflow.TF_GetCode(status))\r\nFailedPreconditionError: /media/data/sarroff/experiments/source_separation/logdir3/train/161031224434/model.ckpt-263550.index\r\n```\r\nThe accompanying exception message mentions a different file every time and the exception is raised at some arbitrary time after execution. It is therefore not easy to replicate my issue deterministically.\r\n\r\n## Environment\r\nUbuntu 16.04LTS\r\nTensorFlow commit 1fcd6d1294564066c6f92b121a3aaf4ed186dc1a\r\n\r\n\r\n## Proposed Cause\r\nThis is just a guess; I'm not too familiar with the code: The exception is raised in `FileSystem::GetMatchingPaths`. Perhaps, while traversing the directory, some files get incorrectly marked as directories. If so, then the error probably happens during the call to `opendir` in `PosixFileSystem::GetChildren`. Error codes which are mapped to `FailedPreconditionError` are listed in `tensorflow/core/platform/posix/error.cc`. A likely error code causing the exception is `ENOTDIR`. I don't have an explanation as to why files would occasionally be incorrectly marked as directories. Perhaps there is a problem unique to my environment.\r\n\r\nI've also noticed the recent Issue https://github.com/tensorflow/tensorflow/issues/4921, which specifically mentions problems with `FileSystem::GetMatchingPaths`. Perhaps this issue is connected with that one."}