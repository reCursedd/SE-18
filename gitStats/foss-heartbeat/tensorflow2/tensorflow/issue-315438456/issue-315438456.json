{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18648", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18648/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18648/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18648/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/18648", "id": 315438456, "node_id": "MDU6SXNzdWUzMTU0Mzg0NTY=", "number": 18648, "title": "eager scatter_nd forward works with incorrect code", "user": {"login": "mbosnjak", "id": 5557898, "node_id": "MDQ6VXNlcjU1NTc4OTg=", "avatar_url": "https://avatars1.githubusercontent.com/u/5557898?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mbosnjak", "html_url": "https://github.com/mbosnjak", "followers_url": "https://api.github.com/users/mbosnjak/followers", "following_url": "https://api.github.com/users/mbosnjak/following{/other_user}", "gists_url": "https://api.github.com/users/mbosnjak/gists{/gist_id}", "starred_url": "https://api.github.com/users/mbosnjak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mbosnjak/subscriptions", "organizations_url": "https://api.github.com/users/mbosnjak/orgs", "repos_url": "https://api.github.com/users/mbosnjak/repos", "events_url": "https://api.github.com/users/mbosnjak/events{/privacy}", "received_events_url": "https://api.github.com/users/mbosnjak/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "alextp", "id": 5061, "node_id": "MDQ6VXNlcjUwNjE=", "avatar_url": "https://avatars0.githubusercontent.com/u/5061?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alextp", "html_url": "https://github.com/alextp", "followers_url": "https://api.github.com/users/alextp/followers", "following_url": "https://api.github.com/users/alextp/following{/other_user}", "gists_url": "https://api.github.com/users/alextp/gists{/gist_id}", "starred_url": "https://api.github.com/users/alextp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alextp/subscriptions", "organizations_url": "https://api.github.com/users/alextp/orgs", "repos_url": "https://api.github.com/users/alextp/repos", "events_url": "https://api.github.com/users/alextp/events{/privacy}", "received_events_url": "https://api.github.com/users/alextp/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "alextp", "id": 5061, "node_id": "MDQ6VXNlcjUwNjE=", "avatar_url": "https://avatars0.githubusercontent.com/u/5061?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alextp", "html_url": "https://github.com/alextp", "followers_url": "https://api.github.com/users/alextp/followers", "following_url": "https://api.github.com/users/alextp/following{/other_user}", "gists_url": "https://api.github.com/users/alextp/gists{/gist_id}", "starred_url": "https://api.github.com/users/alextp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alextp/subscriptions", "organizations_url": "https://api.github.com/users/alextp/orgs", "repos_url": "https://api.github.com/users/alextp/repos", "events_url": "https://api.github.com/users/alextp/events{/privacy}", "received_events_url": "https://api.github.com/users/alextp/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2018-04-18T11:21:53Z", "updated_at": "2018-05-15T20:35:33Z", "closed_at": "2018-05-15T20:35:33Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:<br>\ncode, see below</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nOSX 10.12.6</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>:<br>\nbinary</li>\n<li><strong>TensorFlow version (use command below)</strong>:<br>\nv1.7.0-3-g024aecf414 1.7.0</li>\n<li><strong>Python version</strong>:<br>\n3.6.1</li>\n<li><strong>Bazel version (if compiling from source)</strong>:<br>\nN/A</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>:<br>\nN/A</li>\n<li><strong>CUDA/cuDNN version</strong>:<br>\nN/A</li>\n<li><strong>GPU model and memory</strong>:<br>\nN/A</li>\n<li><strong>Exact command to reproduce</strong>:<br>\nsee code below</li>\n</ul>\n<h3>Source code / logs</h3>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n<span class=\"pl-k\">import</span> tensorflow.contrib.eager <span class=\"pl-k\">as</span> tfe\n\ntfe.enable_eager_execution()\n\nx_var <span class=\"pl-k\">=</span> tfe.Variable(tf.random_uniform([<span class=\"pl-c1\">10</span>]))\ny_var <span class=\"pl-k\">=</span> tfe.Variable(tf.random_uniform([<span class=\"pl-c1\">10</span>]))\n\n<span class=\"pl-k\">with</span> tfe.GradientTape() <span class=\"pl-k\">as</span> tape:\n    dot <span class=\"pl-k\">=</span> tf.scatter_nd(<span class=\"pl-v\">indices</span><span class=\"pl-k\">=</span>[<span class=\"pl-c1\">0</span>],  <span class=\"pl-c\"><span class=\"pl-c\">#</span> this should be indices=[[0]]</span>\n                        <span class=\"pl-v\">updates</span><span class=\"pl-k\">=</span>[tf.einsum(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>i,i-&gt;<span class=\"pl-pds\">'</span></span>, x_var, y_var)],\n                        <span class=\"pl-v\">shape</span><span class=\"pl-k\">=</span>[<span class=\"pl-c1\">1</span>])\n<span class=\"pl-c1\">print</span>(dot)\ngradient <span class=\"pl-k\">=</span> tape.gradient(dot, [x_var, y_var])\n<span class=\"pl-c1\">print</span>(gradient)</pre></div>\n<p>Error traceback:</p>\n<pre><code>Traceback (most recent call last):\n  File \"/Users/m/workspace/bug/experimental/bug.py\", line 31, in &lt;module&gt;\n    gradient = tape.gradient(dot, [x_var, y_var])\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/eager/backprop.py\", line 764, in gradient\n    output_gradients=output_gradients)\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/eager/imperative_grad.py\", line 65, in imperative_grad\n    tape._tape, vspace, target, sources, output_gradients, status)  # pylint: disable=protected-access\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/eager/backprop.py\", line 141, in grad_fn\n    op_inputs, op_outputs, orig_outputs)\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/eager/backprop.py\", line 109, in _magic_gradient_function\n    return grad_fn(mock_op, *out_grads)\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/ops/array_grad.py\", line 39, in _PackGrad\n    return array_ops.unstack(grad, num=op.get_attr(\"N\"), axis=op.get_attr(\"axis\"))\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/ops/array_ops.py\", line 1084, in unstack\n    return gen_array_ops.unpack(value, num=num, axis=axis, name=name)\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 8741, in unpack\n    _six.raise_from(_core._status_to_exception(e.code, message), None)\n  File \"&lt;string&gt;\", line 3, in raise_from\ntensorflow.python.framework.errors_impl.InvalidArgumentError: axis = 0 not in [0, 0) [Op:Unpack] name: unstack\n</code></pre>\n<h3>Describe the problem</h3>\n<p>This is erroneous code which runs half-way. It will still calculate the forward pass, but fail on the backward pass. This does not happen with static graph tensorflow, where you get a correct error that tensor shapes are not matching.</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\ncode, see below\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nOSX 10.12.6\nTensorFlow installed from (source or binary):\nbinary\nTensorFlow version (use command below):\nv1.7.0-3-g024aecf414 1.7.0\nPython version:\n3.6.1\nBazel version (if compiling from source):\nN/A\nGCC/Compiler version (if compiling from source):\nN/A\nCUDA/cuDNN version:\nN/A\nGPU model and memory:\nN/A\nExact command to reproduce:\nsee code below\n\nSource code / logs\nimport tensorflow as tf\nimport tensorflow.contrib.eager as tfe\n\ntfe.enable_eager_execution()\n\nx_var = tfe.Variable(tf.random_uniform([10]))\ny_var = tfe.Variable(tf.random_uniform([10]))\n\nwith tfe.GradientTape() as tape:\n    dot = tf.scatter_nd(indices=[0],  # this should be indices=[[0]]\n                        updates=[tf.einsum('i,i->', x_var, y_var)],\n                        shape=[1])\nprint(dot)\ngradient = tape.gradient(dot, [x_var, y_var])\nprint(gradient)\nError traceback:\nTraceback (most recent call last):\n  File \"/Users/m/workspace/bug/experimental/bug.py\", line 31, in <module>\n    gradient = tape.gradient(dot, [x_var, y_var])\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/eager/backprop.py\", line 764, in gradient\n    output_gradients=output_gradients)\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/eager/imperative_grad.py\", line 65, in imperative_grad\n    tape._tape, vspace, target, sources, output_gradients, status)  # pylint: disable=protected-access\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/eager/backprop.py\", line 141, in grad_fn\n    op_inputs, op_outputs, orig_outputs)\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/eager/backprop.py\", line 109, in _magic_gradient_function\n    return grad_fn(mock_op, *out_grads)\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/ops/array_grad.py\", line 39, in _PackGrad\n    return array_ops.unstack(grad, num=op.get_attr(\"N\"), axis=op.get_attr(\"axis\"))\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/ops/array_ops.py\", line 1084, in unstack\n    return gen_array_ops.unpack(value, num=num, axis=axis, name=name)\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 8741, in unpack\n    _six.raise_from(_core._status_to_exception(e.code, message), None)\n  File \"<string>\", line 3, in raise_from\ntensorflow.python.framework.errors_impl.InvalidArgumentError: axis = 0 not in [0, 0) [Op:Unpack] name: unstack\n\nDescribe the problem\nThis is erroneous code which runs half-way. It will still calculate the forward pass, but fail on the backward pass. This does not happen with static graph tensorflow, where you get a correct error that tensor shapes are not matching.", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\ncode, see below\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\nOSX 10.12.6\r\n- **TensorFlow installed from (source or binary)**:\r\nbinary\r\n- **TensorFlow version (use command below)**:\r\nv1.7.0-3-g024aecf414 1.7.0\r\n- **Python version**: \r\n3.6.1\r\n- **Bazel version (if compiling from source)**:\r\nN/A\r\n- **GCC/Compiler version (if compiling from source)**:\r\nN/A\r\n- **CUDA/cuDNN version**:\r\nN/A\r\n- **GPU model and memory**:\r\nN/A\r\n- **Exact command to reproduce**:\r\nsee code below\r\n\r\n\r\n### Source code / logs\r\n\r\n```python\r\nimport tensorflow as tf\r\nimport tensorflow.contrib.eager as tfe\r\n\r\ntfe.enable_eager_execution()\r\n\r\nx_var = tfe.Variable(tf.random_uniform([10]))\r\ny_var = tfe.Variable(tf.random_uniform([10]))\r\n\r\nwith tfe.GradientTape() as tape:\r\n    dot = tf.scatter_nd(indices=[0],  # this should be indices=[[0]]\r\n                        updates=[tf.einsum('i,i->', x_var, y_var)],\r\n                        shape=[1])\r\nprint(dot)\r\ngradient = tape.gradient(dot, [x_var, y_var])\r\nprint(gradient)\r\n```\r\n\r\nError traceback:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/Users/m/workspace/bug/experimental/bug.py\", line 31, in <module>\r\n    gradient = tape.gradient(dot, [x_var, y_var])\r\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/eager/backprop.py\", line 764, in gradient\r\n    output_gradients=output_gradients)\r\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/eager/imperative_grad.py\", line 65, in imperative_grad\r\n    tape._tape, vspace, target, sources, output_gradients, status)  # pylint: disable=protected-access\r\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/eager/backprop.py\", line 141, in grad_fn\r\n    op_inputs, op_outputs, orig_outputs)\r\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/eager/backprop.py\", line 109, in _magic_gradient_function\r\n    return grad_fn(mock_op, *out_grads)\r\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/ops/array_grad.py\", line 39, in _PackGrad\r\n    return array_ops.unstack(grad, num=op.get_attr(\"N\"), axis=op.get_attr(\"axis\"))\r\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/ops/array_ops.py\", line 1084, in unstack\r\n    return gen_array_ops.unpack(value, num=num, axis=axis, name=name)\r\n  File \"/Users/m/workspace/bug/venv/lib/python3.6/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 8741, in unpack\r\n    _six.raise_from(_core._status_to_exception(e.code, message), None)\r\n  File \"<string>\", line 3, in raise_from\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: axis = 0 not in [0, 0) [Op:Unpack] name: unstack\r\n```\r\n\r\n### Describe the problem\r\n\r\nThis is erroneous code which runs half-way. It will still calculate the forward pass, but fail on the backward pass. This does not happen with static graph tensorflow, where you get a correct error that tensor shapes are not matching."}