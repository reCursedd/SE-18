{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15844", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15844/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15844/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15844/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15844", "id": 285955567, "node_id": "MDU6SXNzdWUyODU5NTU1Njc=", "number": 15844, "title": "MonitoredTrainingSession aborts without error or exeption", "user": {"login": "lhlmgr", "id": 400331, "node_id": "MDQ6VXNlcjQwMDMzMQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/400331?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lhlmgr", "html_url": "https://github.com/lhlmgr", "followers_url": "https://api.github.com/users/lhlmgr/followers", "following_url": "https://api.github.com/users/lhlmgr/following{/other_user}", "gists_url": "https://api.github.com/users/lhlmgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lhlmgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lhlmgr/subscriptions", "organizations_url": "https://api.github.com/users/lhlmgr/orgs", "repos_url": "https://api.github.com/users/lhlmgr/repos", "events_url": "https://api.github.com/users/lhlmgr/events{/privacy}", "received_events_url": "https://api.github.com/users/lhlmgr/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-01-04T11:29:10Z", "updated_at": "2018-01-05T21:07:25Z", "closed_at": "2018-01-05T21:07:25Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:<br>\nNo</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nLinux Ubuntu 16.04.3</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>:<br>\nbinary, pip install</li>\n<li><strong>TensorFlow version (use command below)</strong>:<br>\nv1.4.0-19-ga52c8d9 1.4.1</li>\n<li><strong>Python version</strong>:<br>\nPython 3.6.3 :: Anaconda, Inc.</li>\n<li><strong>Bazel version (if compiling from source)</strong>:</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>:</li>\n<li><strong>CUDA/cuDNN version</strong>:<br>\ncuda_8.0.61.2, libcudnn.so.6.0.21</li>\n<li><strong>GPU model and memory</strong>:<br>\nTitan-X, 32GB</li>\n<li><strong>Exact command to reproduce</strong>:<br>\nDuring some training runs, this script just ends after few epochs with printing 'eval done'. It doesn't print any error nor an exception. In other runs, with the same setup in runs through. How could this happen that the for-loop stops even the epochs is smaller than 100?</li>\n</ul>\n<p>Edit: I tried it also without the try-except block around the <code>MonitoredTrainingSession</code>, but it was the same: no exception, no error, epoch ~ 15 and printing \"eval done\"</p>\n<div class=\"highlight highlight-source-python\"><pre>    tf.logging.set_verbosity(tf.logging.<span class=\"pl-c1\">INFO</span>)\n    os.environ[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>TF_CPP_MIN_LOG_LEVEL<span class=\"pl-pds\">'</span></span>] <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>0<span class=\"pl-pds\">'</span></span>\n\n    listener_eval <span class=\"pl-k\">=</span> ExampleCheckpointSaverListener(<span class=\"pl-v\">fun_after_save</span><span class=\"pl-k\">=</span>eval_model)\n    listener_generate <span class=\"pl-k\">=</span> ExampleCheckpointSaverListener(<span class=\"pl-v\">fun_after_save</span><span class=\"pl-k\">=</span>generate)\n    hooks_train <span class=\"pl-k\">=</span> [\n      tf.train.SummarySaverHook(<span class=\"pl-v\">output_dir</span><span class=\"pl-k\">=</span>model_path, <span class=\"pl-v\">save_secs</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">60</span>, <span class=\"pl-v\">scaffold</span><span class=\"pl-k\">=</span>scaffold_train),\n      tf.train.LoggingTensorHook(train_log_tensors, <span class=\"pl-v\">every_n_secs</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">30</span>),\n      tf.train.CheckpointSaverHook(<span class=\"pl-v\">checkpoint_dir</span><span class=\"pl-k\">=</span>model_path, <span class=\"pl-v\">save_secs</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">600</span>, <span class=\"pl-v\">scaffold</span><span class=\"pl-k\">=</span>scaffold_train,\n                                   <span class=\"pl-v\">listeners</span><span class=\"pl-k\">=</span>[listener_eval, listener_generate])\n    ]\n\n    <span class=\"pl-k\">try</span>:\n      <span class=\"pl-k\">with</span> tf.train.MonitoredTrainingSession(<span class=\"pl-v\">is_chief</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>, <span class=\"pl-v\">checkpoint_dir</span><span class=\"pl-k\">=</span>model_path, <span class=\"pl-v\">save_checkpoint_secs</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">None</span>,\n                                             <span class=\"pl-v\">hooks</span><span class=\"pl-k\">=</span>hooks_train, <span class=\"pl-v\">save_summaries_secs</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">None</span>, <span class=\"pl-v\">save_summaries_steps</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">None</span>,\n                                             <span class=\"pl-v\">config</span><span class=\"pl-k\">=</span>sess_config, <span class=\"pl-v\">scaffold</span><span class=\"pl-k\">=</span>scaffold_train, <span class=\"pl-v\">log_step_count_steps</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">1000</span>, <span class=\"pl-v\">stop_grace_period_secs</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">20</span>) <span class=\"pl-k\">as</span> sess:\n\n        <span class=\"pl-k\">for</span> epochs <span class=\"pl-k\">in</span> <span class=\"pl-c1\">range</span>(<span class=\"pl-c1\">0</span>, <span class=\"pl-c1\">100</span>):\n          <span class=\"pl-c1\">print</span>(epochs)\n          <span class=\"pl-k\">try</span>:\n            <span class=\"pl-k\">while</span> <span class=\"pl-c1\">True</span>:\n              sess.run([train_op])\n          <span class=\"pl-k\">except</span> tf.errors.OutOfRangeError <span class=\"pl-k\">as</span> e:\n            <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Epoch <span class=\"pl-c1\">%d</span> end.<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">%</span> epochs)\n            sess.run(train_reader.iterator.initializer)\n    <span class=\"pl-k\">except</span>:\n      <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>MonitoredTrainingSession<span class=\"pl-pds\">\"</span></span>)\n      <span class=\"pl-c1\">print</span>(sys.exc_info())\n\n    <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>eval done<span class=\"pl-pds\">\"</span></span>)</pre></div>\n<p><a href=\"https://github.com/tensorflow/tensorflow/files/1603159/tf_env.txt\">tf_env.txt</a></p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nNo\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nLinux Ubuntu 16.04.3\nTensorFlow installed from (source or binary):\nbinary, pip install\nTensorFlow version (use command below):\nv1.4.0-19-ga52c8d9 1.4.1\nPython version:\nPython 3.6.3 :: Anaconda, Inc.\nBazel version (if compiling from source):\nGCC/Compiler version (if compiling from source):\nCUDA/cuDNN version:\ncuda_8.0.61.2, libcudnn.so.6.0.21\nGPU model and memory:\nTitan-X, 32GB\nExact command to reproduce:\nDuring some training runs, this script just ends after few epochs with printing 'eval done'. It doesn't print any error nor an exception. In other runs, with the same setup in runs through. How could this happen that the for-loop stops even the epochs is smaller than 100?\n\nEdit: I tried it also without the try-except block around the MonitoredTrainingSession, but it was the same: no exception, no error, epoch ~ 15 and printing \"eval done\"\n    tf.logging.set_verbosity(tf.logging.INFO)\n    os.environ['TF_CPP_MIN_LOG_LEVEL'] = '0'\n\n    listener_eval = ExampleCheckpointSaverListener(fun_after_save=eval_model)\n    listener_generate = ExampleCheckpointSaverListener(fun_after_save=generate)\n    hooks_train = [\n      tf.train.SummarySaverHook(output_dir=model_path, save_secs=60, scaffold=scaffold_train),\n      tf.train.LoggingTensorHook(train_log_tensors, every_n_secs=30),\n      tf.train.CheckpointSaverHook(checkpoint_dir=model_path, save_secs=600, scaffold=scaffold_train,\n                                   listeners=[listener_eval, listener_generate])\n    ]\n\n    try:\n      with tf.train.MonitoredTrainingSession(is_chief=True, checkpoint_dir=model_path, save_checkpoint_secs=None,\n                                             hooks=hooks_train, save_summaries_secs=None, save_summaries_steps=None,\n                                             config=sess_config, scaffold=scaffold_train, log_step_count_steps=1000, stop_grace_period_secs=20) as sess:\n\n        for epochs in range(0, 100):\n          print(epochs)\n          try:\n            while True:\n              sess.run([train_op])\n          except tf.errors.OutOfRangeError as e:\n            print(\"Epoch %d end.\" % epochs)\n            sess.run(train_reader.iterator.initializer)\n    except:\n      print(\"MonitoredTrainingSession\")\n      print(sys.exc_info())\n\n    print(\"eval done\")\ntf_env.txt", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\nNo \r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\nLinux Ubuntu 16.04.3\r\n- **TensorFlow installed from (source or binary)**:\r\nbinary, pip install\r\n- **TensorFlow version (use command below)**:\r\nv1.4.0-19-ga52c8d9 1.4.1\r\n- **Python version**: \r\nPython 3.6.3 :: Anaconda, Inc.\r\n- **Bazel version (if compiling from source)**:\r\n- **GCC/Compiler version (if compiling from source)**:\r\n- **CUDA/cuDNN version**:\r\ncuda_8.0.61.2, libcudnn.so.6.0.21\r\n- **GPU model and memory**:\r\nTitan-X, 32GB\r\n- **Exact command to reproduce**:\r\nDuring some training runs, this script just ends after few epochs with printing 'eval done'. It doesn't print any error nor an exception. In other runs, with the same setup in runs through. How could this happen that the for-loop stops even the epochs is smaller than 100?\r\n\r\nEdit: I tried it also without the try-except block around the `MonitoredTrainingSession`, but it was the same: no exception, no error, epoch ~ 15 and printing \"eval done\"\r\n\r\n\r\n```python\r\n    tf.logging.set_verbosity(tf.logging.INFO)\r\n    os.environ['TF_CPP_MIN_LOG_LEVEL'] = '0'\r\n\r\n    listener_eval = ExampleCheckpointSaverListener(fun_after_save=eval_model)\r\n    listener_generate = ExampleCheckpointSaverListener(fun_after_save=generate)\r\n    hooks_train = [\r\n      tf.train.SummarySaverHook(output_dir=model_path, save_secs=60, scaffold=scaffold_train),\r\n      tf.train.LoggingTensorHook(train_log_tensors, every_n_secs=30),\r\n      tf.train.CheckpointSaverHook(checkpoint_dir=model_path, save_secs=600, scaffold=scaffold_train,\r\n                                   listeners=[listener_eval, listener_generate])\r\n    ]\r\n\r\n    try:\r\n      with tf.train.MonitoredTrainingSession(is_chief=True, checkpoint_dir=model_path, save_checkpoint_secs=None,\r\n                                             hooks=hooks_train, save_summaries_secs=None, save_summaries_steps=None,\r\n                                             config=sess_config, scaffold=scaffold_train, log_step_count_steps=1000, stop_grace_period_secs=20) as sess:\r\n\r\n        for epochs in range(0, 100):\r\n          print(epochs)\r\n          try:\r\n            while True:\r\n              sess.run([train_op])\r\n          except tf.errors.OutOfRangeError as e:\r\n            print(\"Epoch %d end.\" % epochs)\r\n            sess.run(train_reader.iterator.initializer)\r\n    except:\r\n      print(\"MonitoredTrainingSession\")\r\n      print(sys.exc_info())\r\n\r\n    print(\"eval done\")\r\n```\r\n\r\n[tf_env.txt](https://github.com/tensorflow/tensorflow/files/1603159/tf_env.txt)\r\n\r\n\r\n  "}