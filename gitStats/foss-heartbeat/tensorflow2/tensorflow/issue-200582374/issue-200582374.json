{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6824", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6824/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6824/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6824/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/6824", "id": 200582374, "node_id": "MDU6SXNzdWUyMDA1ODIzNzQ=", "number": 6824, "title": "tf.einsum fails on evaluation in some cases", "user": {"login": "jihunchoi", "id": 1898501, "node_id": "MDQ6VXNlcjE4OTg1MDE=", "avatar_url": "https://avatars2.githubusercontent.com/u/1898501?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jihunchoi", "html_url": "https://github.com/jihunchoi", "followers_url": "https://api.github.com/users/jihunchoi/followers", "following_url": "https://api.github.com/users/jihunchoi/following{/other_user}", "gists_url": "https://api.github.com/users/jihunchoi/gists{/gist_id}", "starred_url": "https://api.github.com/users/jihunchoi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jihunchoi/subscriptions", "organizations_url": "https://api.github.com/users/jihunchoi/orgs", "repos_url": "https://api.github.com/users/jihunchoi/repos", "events_url": "https://api.github.com/users/jihunchoi/events{/privacy}", "received_events_url": "https://api.github.com/users/jihunchoi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473173272, "node_id": "MDU6TGFiZWw0NzMxNzMyNzI=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:feature", "name": "type:feature", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "drpngx", "id": 20959853, "node_id": "MDQ6VXNlcjIwOTU5ODUz", "avatar_url": "https://avatars1.githubusercontent.com/u/20959853?v=4", "gravatar_id": "", "url": "https://api.github.com/users/drpngx", "html_url": "https://github.com/drpngx", "followers_url": "https://api.github.com/users/drpngx/followers", "following_url": "https://api.github.com/users/drpngx/following{/other_user}", "gists_url": "https://api.github.com/users/drpngx/gists{/gist_id}", "starred_url": "https://api.github.com/users/drpngx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/drpngx/subscriptions", "organizations_url": "https://api.github.com/users/drpngx/orgs", "repos_url": "https://api.github.com/users/drpngx/repos", "events_url": "https://api.github.com/users/drpngx/events{/privacy}", "received_events_url": "https://api.github.com/users/drpngx/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "drpngx", "id": 20959853, "node_id": "MDQ6VXNlcjIwOTU5ODUz", "avatar_url": "https://avatars1.githubusercontent.com/u/20959853?v=4", "gravatar_id": "", "url": "https://api.github.com/users/drpngx", "html_url": "https://github.com/drpngx", "followers_url": "https://api.github.com/users/drpngx/followers", "following_url": "https://api.github.com/users/drpngx/following{/other_user}", "gists_url": "https://api.github.com/users/drpngx/gists{/gist_id}", "starred_url": "https://api.github.com/users/drpngx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/drpngx/subscriptions", "organizations_url": "https://api.github.com/users/drpngx/orgs", "repos_url": "https://api.github.com/users/drpngx/repos", "events_url": "https://api.github.com/users/drpngx/events{/privacy}", "received_events_url": "https://api.github.com/users/drpngx/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2017-01-13T09:22:11Z", "updated_at": "2017-04-06T07:11:41Z", "closed_at": "2017-01-14T04:02:13Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Hello,<br>\nI was a user of 'reshape-matmul-reshape' approach, however it felt me a bit messy, so I am trying some alternatives that do this automatically.<br>\nI had tried <code>tf.tensordot</code> before, however it did not work well when shapes are partially known (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"199136431\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/6682\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/6682/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/6682\">#6682</a>).<br>\nAs an alternative, I tried to use <code>tf.einsum</code>.<br>\nHowever, similar to <code>tf.tensordot</code>, it cannot handle some variables with partially-known-shape, for instance, the below codes fails on evaluation.</p>\n<pre><code>a = tf.placeholder('float32', shape=[None, None, 100])\nb = tf.placeholder('float32', shape=[100, 300])\nresult_einsum = tf.einsum('ijk,kl-&gt;ijl', a, b)\na_value = np.random.randn(10, 20, 100)\nb_value = np.random.randn(100, 300)\nsess.run(result_einsum, {a: a_value, b: b_value})  # failure\n</code></pre>\n<p>This is the error message:</p>\n<pre><code>InvalidArgumentError (see above for traceback): only one input size may be -1, not both 0 and 1\n         [[Node: Reshape_5 = Reshape[T=DT_FLOAT, Tshape=DT_INT32, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](MatMul_3, Reshape_5/shape)]]\n</code></pre>", "body_text": "Hello,\nI was a user of 'reshape-matmul-reshape' approach, however it felt me a bit messy, so I am trying some alternatives that do this automatically.\nI had tried tf.tensordot before, however it did not work well when shapes are partially known (#6682).\nAs an alternative, I tried to use tf.einsum.\nHowever, similar to tf.tensordot, it cannot handle some variables with partially-known-shape, for instance, the below codes fails on evaluation.\na = tf.placeholder('float32', shape=[None, None, 100])\nb = tf.placeholder('float32', shape=[100, 300])\nresult_einsum = tf.einsum('ijk,kl->ijl', a, b)\na_value = np.random.randn(10, 20, 100)\nb_value = np.random.randn(100, 300)\nsess.run(result_einsum, {a: a_value, b: b_value})  # failure\n\nThis is the error message:\nInvalidArgumentError (see above for traceback): only one input size may be -1, not both 0 and 1\n         [[Node: Reshape_5 = Reshape[T=DT_FLOAT, Tshape=DT_INT32, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](MatMul_3, Reshape_5/shape)]]", "body": "Hello,\r\nI was a user of 'reshape-matmul-reshape' approach, however it felt me a bit messy, so I am trying some alternatives that do this automatically.\r\nI had tried `tf.tensordot` before, however it did not work well when shapes are partially known (#6682).\r\nAs an alternative, I tried to use `tf.einsum`.\r\nHowever, similar to `tf.tensordot`, it cannot handle some variables with partially-known-shape, for instance, the below codes fails on evaluation.\r\n\r\n```\r\na = tf.placeholder('float32', shape=[None, None, 100])\r\nb = tf.placeholder('float32', shape=[100, 300])\r\nresult_einsum = tf.einsum('ijk,kl->ijl', a, b)\r\na_value = np.random.randn(10, 20, 100)\r\nb_value = np.random.randn(100, 300)\r\nsess.run(result_einsum, {a: a_value, b: b_value})  # failure\r\n```\r\n\r\n\r\nThis is the error message:\r\n```\r\nInvalidArgumentError (see above for traceback): only one input size may be -1, not both 0 and 1\r\n         [[Node: Reshape_5 = Reshape[T=DT_FLOAT, Tshape=DT_INT32, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](MatMul_3, Reshape_5/shape)]]\r\n```"}