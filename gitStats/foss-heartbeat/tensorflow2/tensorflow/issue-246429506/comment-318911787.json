{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/318911787", "html_url": "https://github.com/tensorflow/tensorflow/issues/11856#issuecomment-318911787", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11856", "id": 318911787, "node_id": "MDEyOklzc3VlQ29tbWVudDMxODkxMTc4Nw==", "user": {"login": "yaroslavvb", "id": 23068, "node_id": "MDQ6VXNlcjIzMDY4", "avatar_url": "https://avatars3.githubusercontent.com/u/23068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yaroslavvb", "html_url": "https://github.com/yaroslavvb", "followers_url": "https://api.github.com/users/yaroslavvb/followers", "following_url": "https://api.github.com/users/yaroslavvb/following{/other_user}", "gists_url": "https://api.github.com/users/yaroslavvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/yaroslavvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yaroslavvb/subscriptions", "organizations_url": "https://api.github.com/users/yaroslavvb/orgs", "repos_url": "https://api.github.com/users/yaroslavvb/repos", "events_url": "https://api.github.com/users/yaroslavvb/events{/privacy}", "received_events_url": "https://api.github.com/users/yaroslavvb/received_events", "type": "User", "site_admin": false}, "created_at": "2017-07-30T16:10:12Z", "updated_at": "2017-07-31T15:52:56Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4221553\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/chihuahua\">@chihuahua</a> replacing the line with <code>tf.assign(v, v.read_value() + 1)</code> will refer to the proper read node.</p>\n<p>The issue is that the tensor is retrieved from <code>_snapshot</code> in <a href=\"https://github.com/tensorflow/tensorflow/blob/faf7c32ab27dad24d2d806a16d1371ecb4671fc8/tensorflow/python/ops/variables.py#L367\">AsTensor</a> which is initialized during variable construction. For a more sweeping fix one might modify <code>AsTensor</code> to check whether you are inside any active context managers for control dependencies, and if so, create a new read node <code>read_value</code> rather than referring to the snapshot. That might get complicated (ie, what if someone is inside control dependency context referring to variable in a long loop? That explodes the graph)</p>", "body_text": "@chihuahua replacing the line with tf.assign(v, v.read_value() + 1) will refer to the proper read node.\nThe issue is that the tensor is retrieved from _snapshot in AsTensor which is initialized during variable construction. For a more sweeping fix one might modify AsTensor to check whether you are inside any active context managers for control dependencies, and if so, create a new read node read_value rather than referring to the snapshot. That might get complicated (ie, what if someone is inside control dependency context referring to variable in a long loop? That explodes the graph)", "body": "@chihuahua replacing the line with `tf.assign(v, v.read_value() + 1)` will refer to the proper read node.\r\n\r\nThe issue is that the tensor is retrieved from `_snapshot` in [AsTensor](https://github.com/tensorflow/tensorflow/blob/faf7c32ab27dad24d2d806a16d1371ecb4671fc8/tensorflow/python/ops/variables.py#L367) which is initialized during variable construction. For a more sweeping fix one might modify `AsTensor` to check whether you are inside any active context managers for control dependencies, and if so, create a new read node `read_value` rather than referring to the snapshot. That might get complicated (ie, what if someone is inside control dependency context referring to variable in a long loop? That explodes the graph)"}