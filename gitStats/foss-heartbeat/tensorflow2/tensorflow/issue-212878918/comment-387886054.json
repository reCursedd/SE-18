{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/387886054", "html_url": "https://github.com/tensorflow/tensorflow/issues/8220#issuecomment-387886054", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8220", "id": 387886054, "node_id": "MDEyOklzc3VlQ29tbWVudDM4Nzg4NjA1NA==", "user": {"login": "breckuh", "id": 37387936, "node_id": "MDQ6VXNlcjM3Mzg3OTM2", "avatar_url": "https://avatars0.githubusercontent.com/u/37387936?v=4", "gravatar_id": "", "url": "https://api.github.com/users/breckuh", "html_url": "https://github.com/breckuh", "followers_url": "https://api.github.com/users/breckuh/followers", "following_url": "https://api.github.com/users/breckuh/following{/other_user}", "gists_url": "https://api.github.com/users/breckuh/gists{/gist_id}", "starred_url": "https://api.github.com/users/breckuh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/breckuh/subscriptions", "organizations_url": "https://api.github.com/users/breckuh/orgs", "repos_url": "https://api.github.com/users/breckuh/repos", "events_url": "https://api.github.com/users/breckuh/events{/privacy}", "received_events_url": "https://api.github.com/users/breckuh/received_events", "type": "User", "site_admin": false}, "created_at": "2018-05-09T21:48:44Z", "updated_at": "2018-05-09T21:48:56Z", "author_association": "NONE", "body_html": "<p>I am also running into this issue. Multiprocessing works  <strong>unless</strong> I first run a session in the parent thread. I've tried moving the \"import tensorflow\" statement to the function as <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=35952525\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/Lancerchiang\">@Lancerchiang</a> suggested with no luck. Below is my minimal repro with 4 test cases.</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> os\n<span class=\"pl-k\">import</span> tensorflow\n<span class=\"pl-k\">from</span> multiprocessing.pool <span class=\"pl-k\">import</span> Pool\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">runInSubprocess</span>(<span class=\"pl-smi\">somearg</span>):\n    <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>Training model on process id <span class=\"pl-c1\">{}</span>.<span class=\"pl-pds\">'</span></span>.format(os.getpid()))\n    <span class=\"pl-k\">with</span> tensorflow.Session() <span class=\"pl-k\">as</span> sess:\n        sess.run(tensorflow.global_variables_initializer())\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> This Hangs:</span>\nrunInSubprocess(<span class=\"pl-c1\">2</span>)\nPool(<span class=\"pl-v\">processes</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">2</span>).map(runInSubprocess, [<span class=\"pl-c1\">1</span>,<span class=\"pl-c1\">2</span>])\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> This works:</span>\nrunInSubprocess(<span class=\"pl-c1\">2</span>)\nrunInSubprocess(<span class=\"pl-c1\">2</span>)\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> This works:</span>\nPool(<span class=\"pl-v\">processes</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">2</span>).map(runInSubprocess, [<span class=\"pl-c1\">1</span>,<span class=\"pl-c1\">2</span>])\nPool(<span class=\"pl-v\">processes</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">2</span>).map(runInSubprocess, [<span class=\"pl-c1\">1</span>,<span class=\"pl-c1\">2</span>])\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> This works:</span>\nPool(<span class=\"pl-v\">processes</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">2</span>).map(runInSubprocess, [<span class=\"pl-c1\">1</span>,<span class=\"pl-c1\">2</span>])\nrunInSubprocess(<span class=\"pl-c1\">2</span>)</pre></div>", "body_text": "I am also running into this issue. Multiprocessing works  unless I first run a session in the parent thread. I've tried moving the \"import tensorflow\" statement to the function as @Lancerchiang suggested with no luck. Below is my minimal repro with 4 test cases.\nimport os\nimport tensorflow\nfrom multiprocessing.pool import Pool\n\ndef runInSubprocess(somearg):\n    print('Training model on process id {}.'.format(os.getpid()))\n    with tensorflow.Session() as sess:\n        sess.run(tensorflow.global_variables_initializer())\n\n# This Hangs:\nrunInSubprocess(2)\nPool(processes=2).map(runInSubprocess, [1,2])\n\n# This works:\nrunInSubprocess(2)\nrunInSubprocess(2)\n\n# This works:\nPool(processes=2).map(runInSubprocess, [1,2])\nPool(processes=2).map(runInSubprocess, [1,2])\n\n# This works:\nPool(processes=2).map(runInSubprocess, [1,2])\nrunInSubprocess(2)", "body": "I am also running into this issue. Multiprocessing works  **unless** I first run a session in the parent thread. I've tried moving the \"import tensorflow\" statement to the function as @Lancerchiang suggested with no luck. Below is my minimal repro with 4 test cases. \r\n\r\n```python\r\nimport os\r\nimport tensorflow\r\nfrom multiprocessing.pool import Pool\r\n\r\ndef runInSubprocess(somearg):\r\n    print('Training model on process id {}.'.format(os.getpid()))\r\n    with tensorflow.Session() as sess:\r\n        sess.run(tensorflow.global_variables_initializer())\r\n\r\n# This Hangs:\r\nrunInSubprocess(2)\r\nPool(processes=2).map(runInSubprocess, [1,2])\r\n\r\n# This works:\r\nrunInSubprocess(2)\r\nrunInSubprocess(2)\r\n\r\n# This works:\r\nPool(processes=2).map(runInSubprocess, [1,2])\r\nPool(processes=2).map(runInSubprocess, [1,2])\r\n\r\n# This works:\r\nPool(processes=2).map(runInSubprocess, [1,2])\r\nrunInSubprocess(2)\r\n```"}