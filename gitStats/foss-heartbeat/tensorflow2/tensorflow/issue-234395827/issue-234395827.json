{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10517", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10517/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10517/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10517/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/10517", "id": 234395827, "node_id": "MDU6SXNzdWUyMzQzOTU4Mjc=", "number": 10517, "title": "TensorFlow Convolution Code Optmization", "user": {"login": "ashokbugude", "id": 10016848, "node_id": "MDQ6VXNlcjEwMDE2ODQ4", "avatar_url": "https://avatars3.githubusercontent.com/u/10016848?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ashokbugude", "html_url": "https://github.com/ashokbugude", "followers_url": "https://api.github.com/users/ashokbugude/followers", "following_url": "https://api.github.com/users/ashokbugude/following{/other_user}", "gists_url": "https://api.github.com/users/ashokbugude/gists{/gist_id}", "starred_url": "https://api.github.com/users/ashokbugude/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ashokbugude/subscriptions", "organizations_url": "https://api.github.com/users/ashokbugude/orgs", "repos_url": "https://api.github.com/users/ashokbugude/repos", "events_url": "https://api.github.com/users/ashokbugude/events{/privacy}", "received_events_url": "https://api.github.com/users/ashokbugude/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-06-08T02:40:24Z", "updated_at": "2017-06-08T13:21:02Z", "closed_at": "2017-06-08T13:21:02Z", "author_association": "NONE", "body_html": "<p>I am using C++ version of TensorFLow and have built 'TensorFlow for Android' successfully using below command<br>\n'bazel build -c opt //tensorflow/examples/android:tensorflow_demo'<br>\nas described in <a href=\"https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android#bazel\">https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android#bazel</a></p>\n<p>I am trying to optimize the convolution code. Below are the issues faced</p>\n<ol>\n<li>\n<p>Unable to find the exact location of convolution code.<br>\nI am able to debug the code till below function in</p>\n<p>'return choose(<br>\nCond&lt;internal::traits::Layout == ColMajor&gt;(),<br>\nkernel.reshape(kernel_dims)<br>\n.contract(input<br>\n.extract_image_patches(<br>\nkernelRows, kernelCols, row_stride, col_stride,<br>\nrow_in_stride, col_in_stride, padding_type)<br>\n.reshape(pre_contract_dims),<br>\ncontract_dims)<br>\n.reshape(post_contract_dims),<br>\ninput<br>\n.extract_image_patches(kernelRows, kernelCols, row_stride, col_stride,<br>\nrow_in_stride, col_in_stride, padding_type)<br>\n.reshape(pre_contract_dims)<br>\n.contract(kernel.reshape(kernel_dims), contract_dims)<br>\n.reshape(post_contract_dims));'</p>\n</li>\n</ol>\n<p>as present in <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/eigen_spatial_convolutions.h\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/eigen_spatial_convolutions.h</a></p>\n<p>I have few questions related to the above function.</p>\n<p>1.1 Is the above function really performing convolution ? If so where is the code ?<br>\n1.2 Is contraction (contract function ) same as convolution ? If both convolution and contraction are same, why is the contract operation being performed to both input and kernel matrix ?<br>\n1.3 Where are the definitions of functions - choose, reshape, contract ,extract image patches etc ?</p>\n<ol start=\"2\">\n<li>Unable to extract data (matrices ) from input and kernel matrix .This is in reference to the same page<br>\n<a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/eigen_spatial_convolutions.h\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/eigen_spatial_convolutions.h</a></li>\n</ol>\n<p>2.1 I have found a line of code 'kern(kernel);' at line no 946 in the above page. Can I know the location definition of the above function ?</p>\n<p>2.2 I am unable to extract input and kernel matrices from the corresponding 4d tensors(input and kernel) as a float array, as i would like to try optimizing the convolution code using parallel processing.I have looked at <a href=\"https://www.tensorflow.org/api_docs/cc/class/tensorflow/tensor\" rel=\"nofollow\">https://www.tensorflow.org/api_docs/cc/class/tensorflow/tensor</a>  but I coudn'yt find any method to convert Tensor Matrices from Tensor 4D to an array.</p>\n<p>Please help me in answering the above questions</p>", "body_text": "I am using C++ version of TensorFLow and have built 'TensorFlow for Android' successfully using below command\n'bazel build -c opt //tensorflow/examples/android:tensorflow_demo'\nas described in https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android#bazel\nI am trying to optimize the convolution code. Below are the issues faced\n\n\nUnable to find the exact location of convolution code.\nI am able to debug the code till below function in\n'return choose(\nCond<internal::traits::Layout == ColMajor>(),\nkernel.reshape(kernel_dims)\n.contract(input\n.extract_image_patches(\nkernelRows, kernelCols, row_stride, col_stride,\nrow_in_stride, col_in_stride, padding_type)\n.reshape(pre_contract_dims),\ncontract_dims)\n.reshape(post_contract_dims),\ninput\n.extract_image_patches(kernelRows, kernelCols, row_stride, col_stride,\nrow_in_stride, col_in_stride, padding_type)\n.reshape(pre_contract_dims)\n.contract(kernel.reshape(kernel_dims), contract_dims)\n.reshape(post_contract_dims));'\n\n\nas present in https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/eigen_spatial_convolutions.h\nI have few questions related to the above function.\n1.1 Is the above function really performing convolution ? If so where is the code ?\n1.2 Is contraction (contract function ) same as convolution ? If both convolution and contraction are same, why is the contract operation being performed to both input and kernel matrix ?\n1.3 Where are the definitions of functions - choose, reshape, contract ,extract image patches etc ?\n\nUnable to extract data (matrices ) from input and kernel matrix .This is in reference to the same page\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/eigen_spatial_convolutions.h\n\n2.1 I have found a line of code 'kern(kernel);' at line no 946 in the above page. Can I know the location definition of the above function ?\n2.2 I am unable to extract input and kernel matrices from the corresponding 4d tensors(input and kernel) as a float array, as i would like to try optimizing the convolution code using parallel processing.I have looked at https://www.tensorflow.org/api_docs/cc/class/tensorflow/tensor  but I coudn'yt find any method to convert Tensor Matrices from Tensor 4D to an array.\nPlease help me in answering the above questions", "body": "I am using C++ version of TensorFLow and have built 'TensorFlow for Android' successfully using below command\r\n'bazel build -c opt //tensorflow/examples/android:tensorflow_demo'\r\n as described in https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android#bazel\r\n\r\nI am trying to optimize the convolution code. Below are the issues faced\r\n\r\n1. Unable to find the exact location of convolution code. \r\n    I am able to debug the code till below function in  \r\n\r\n   'return choose(\r\n      Cond<internal::traits<Input>::Layout == ColMajor>(),\r\n      kernel.reshape(kernel_dims)\r\n          .contract(input\r\n                        .extract_image_patches(\r\n                            kernelRows, kernelCols, row_stride, col_stride,\r\n                            row_in_stride, col_in_stride, padding_type)\r\n                        .reshape(pre_contract_dims),\r\n                    contract_dims)\r\n          .reshape(post_contract_dims),\r\n      input\r\n          .extract_image_patches(kernelRows, kernelCols, row_stride, col_stride,\r\n                                 row_in_stride, col_in_stride, padding_type)\r\n          .reshape(pre_contract_dims)\r\n          .contract(kernel.reshape(kernel_dims), contract_dims)\r\n          .reshape(post_contract_dims));'\r\n\r\nas present in https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/eigen_spatial_convolutions.h\r\n\r\nI have few questions related to the above function.\r\n\r\n1.1 Is the above function really performing convolution ? If so where is the code ?\r\n1.2 Is contraction (contract function ) same as convolution ? If both convolution and contraction are same, why is the contract operation being performed to both input and kernel matrix ?\r\n1.3 Where are the definitions of functions - choose, reshape, contract ,extract image patches etc ?\r\n\r\n2. Unable to extract data (matrices ) from input and kernel matrix .This is in reference to the same page\r\n https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/eigen_spatial_convolutions.h \r\n\r\n2.1 I have found a line of code 'kern(kernel);' at line no 946 in the above page. Can I know the location definition of the above function ?\r\n\r\n2.2 I am unable to extract input and kernel matrices from the corresponding 4d tensors(input and kernel) as a float array, as i would like to try optimizing the convolution code using parallel processing.I have looked at https://www.tensorflow.org/api_docs/cc/class/tensorflow/tensor  but I coudn'yt find any method to convert Tensor Matrices from Tensor 4D to an array. \r\n\r\nPlease help me in answering the above questions\r\n\r\n  \r\n\r\n\r\n"}