{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20515", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20515/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20515/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20515/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/20515", "id": 337861680, "node_id": "MDU6SXNzdWUzMzc4NjE2ODA=", "number": 20515, "title": " TFLite Demo mobilenet_ssd ", "user": {"login": "WenguoLi", "id": 31765154, "node_id": "MDQ6VXNlcjMxNzY1MTU0", "avatar_url": "https://avatars0.githubusercontent.com/u/31765154?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WenguoLi", "html_url": "https://github.com/WenguoLi", "followers_url": "https://api.github.com/users/WenguoLi/followers", "following_url": "https://api.github.com/users/WenguoLi/following{/other_user}", "gists_url": "https://api.github.com/users/WenguoLi/gists{/gist_id}", "starred_url": "https://api.github.com/users/WenguoLi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WenguoLi/subscriptions", "organizations_url": "https://api.github.com/users/WenguoLi/orgs", "repos_url": "https://api.github.com/users/WenguoLi/repos", "events_url": "https://api.github.com/users/WenguoLi/events{/privacy}", "received_events_url": "https://api.github.com/users/WenguoLi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 750616506, "node_id": "MDU6TGFiZWw3NTA2MTY1MDY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:lite", "name": "comp:lite", "color": "0052cc", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "karmel", "id": 667809, "node_id": "MDQ6VXNlcjY2NzgwOQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/667809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/karmel", "html_url": "https://github.com/karmel", "followers_url": "https://api.github.com/users/karmel/followers", "following_url": "https://api.github.com/users/karmel/following{/other_user}", "gists_url": "https://api.github.com/users/karmel/gists{/gist_id}", "starred_url": "https://api.github.com/users/karmel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/karmel/subscriptions", "organizations_url": "https://api.github.com/users/karmel/orgs", "repos_url": "https://api.github.com/users/karmel/repos", "events_url": "https://api.github.com/users/karmel/events{/privacy}", "received_events_url": "https://api.github.com/users/karmel/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "karmel", "id": 667809, "node_id": "MDQ6VXNlcjY2NzgwOQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/667809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/karmel", "html_url": "https://github.com/karmel", "followers_url": "https://api.github.com/users/karmel/followers", "following_url": "https://api.github.com/users/karmel/following{/other_user}", "gists_url": "https://api.github.com/users/karmel/gists{/gist_id}", "starred_url": "https://api.github.com/users/karmel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/karmel/subscriptions", "organizations_url": "https://api.github.com/users/karmel/orgs", "repos_url": "https://api.github.com/users/karmel/repos", "events_url": "https://api.github.com/users/karmel/events{/privacy}", "received_events_url": "https://api.github.com/users/karmel/received_events", "type": "User", "site_admin": false}, {"login": "achowdhery", "id": 4723042, "node_id": "MDQ6VXNlcjQ3MjMwNDI=", "avatar_url": "https://avatars3.githubusercontent.com/u/4723042?v=4", "gravatar_id": "", "url": "https://api.github.com/users/achowdhery", "html_url": "https://github.com/achowdhery", "followers_url": "https://api.github.com/users/achowdhery/followers", "following_url": "https://api.github.com/users/achowdhery/following{/other_user}", "gists_url": "https://api.github.com/users/achowdhery/gists{/gist_id}", "starred_url": "https://api.github.com/users/achowdhery/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/achowdhery/subscriptions", "organizations_url": "https://api.github.com/users/achowdhery/orgs", "repos_url": "https://api.github.com/users/achowdhery/repos", "events_url": "https://api.github.com/users/achowdhery/events{/privacy}", "received_events_url": "https://api.github.com/users/achowdhery/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2018-07-03T11:37:52Z", "updated_at": "2018-07-18T00:13:27Z", "closed_at": "2018-07-18T00:13:27Z", "author_association": "NONE", "body_html": "<p>How are mobilenet_ssd.tflite and <a href=\"https://storage.googleapis.com/download.tensorflow.org/models/tflite/coco_ssd_mobilenet_v1_1.0_quant_2018_06_29.zip\" rel=\"nofollow\">detect.tflite</a>  converted  in the newest <a href=\"https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/lite/examples/android\">TFLite Demo </a>?</p>\n<p>Previously, I converted that model by following <a href=\"https://github.com/tensorflow/tensorflow/issues/15633#issuecomment-377652630\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/15633/hovercard\">this instructions</a>,  but now,  I see that there are 4 outputs in TFLiteObjectDetectionAPIModel in the source code <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/lite/examples/android/app/src/main/java/org/tensorflow/demo/TFLiteObjectDetectionAPIModel.java\">TFLiteObjectDetectionAPIModel.java</a>,</p>\n<p><code>    d.tfLite.setNumThreads(NUM_THREADS); d.outputLocations = new float[1][NUM_DETECTIONS][4]; d.outputClasses = new float[1][NUM_DETECTIONS]; d.outputScores = new float[1][NUM_DETECTIONS]; d.numDetections = new float[1];</code></p>\n<p>the previously converted model can't be used.</p>\n<p>I tried the following instructions, but the error occurred.</p>\n<p><code>bazel run --config=opt \\ //tensorflow/contrib/lite/toco:toco -- \\ --input_file=${MODEL_PATH}/frozen_inference_graph_stripped.pb \\ --output_file=${MODEL_PATH}/ssd_mobilenet_v1_float.tflite \\ --input_format=TENSORFLOW_GRAPHDEF \\ --output_format=TFLITE \\ --inference_type=FLOAT \\ --input_shapes=1,300,300,3 \\ --input_arrays=Preprocessor/sub \\ --output_arrays=detection_boxes,detection_scores,detection_classes,num_detections \\ --dump_graphviz=${MODEL_PATH} </code></p>\n<p>.......<br>\n2018-07-03 19:35:14.798049: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1090] Converting unsupported operation: TensorArrayGatherV3<br>\n2018-07-03 19:35:14.798066: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1090] Converting unsupported operation: TensorArrayGatherV3<br>\n2018-07-03 19:35:14.798080: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1090] Converting unsupported operation: TensorArrayGatherV3<br>\n2018-07-03 19:35:15.248275: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before Removing unused ops: 4096 operators, 6814 arrays (0 quantized)<br>\n2018-07-03 19:35:15.563598: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After Removing unused ops pass 1: 4053 operators, 6719 arrays (0 quantized)<br>\n2018-07-03 19:35:15.977287: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before general graph transformations: 4053 operators, 6719 arrays (0 quantized)<br>\n2018-07-03 19:35:16.225122: F tensorflow/contrib/lite/toco/graph_transformations/resolve_tensorflow_switch.cc:95] Check failed: other_op-&gt;type == OperatorType::kMerge<br>\nAborted (core dumped)</p>\n<p>Who can help ?</p>\n<p>Thanks!</p>", "body_text": "How are mobilenet_ssd.tflite and detect.tflite  converted  in the newest TFLite Demo ?\nPreviously, I converted that model by following this instructions,  but now,  I see that there are 4 outputs in TFLiteObjectDetectionAPIModel in the source code TFLiteObjectDetectionAPIModel.java,\n    d.tfLite.setNumThreads(NUM_THREADS); d.outputLocations = new float[1][NUM_DETECTIONS][4]; d.outputClasses = new float[1][NUM_DETECTIONS]; d.outputScores = new float[1][NUM_DETECTIONS]; d.numDetections = new float[1];\nthe previously converted model can't be used.\nI tried the following instructions, but the error occurred.\nbazel run --config=opt \\ //tensorflow/contrib/lite/toco:toco -- \\ --input_file=${MODEL_PATH}/frozen_inference_graph_stripped.pb \\ --output_file=${MODEL_PATH}/ssd_mobilenet_v1_float.tflite \\ --input_format=TENSORFLOW_GRAPHDEF \\ --output_format=TFLITE \\ --inference_type=FLOAT \\ --input_shapes=1,300,300,3 \\ --input_arrays=Preprocessor/sub \\ --output_arrays=detection_boxes,detection_scores,detection_classes,num_detections \\ --dump_graphviz=${MODEL_PATH} \n.......\n2018-07-03 19:35:14.798049: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1090] Converting unsupported operation: TensorArrayGatherV3\n2018-07-03 19:35:14.798066: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1090] Converting unsupported operation: TensorArrayGatherV3\n2018-07-03 19:35:14.798080: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1090] Converting unsupported operation: TensorArrayGatherV3\n2018-07-03 19:35:15.248275: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before Removing unused ops: 4096 operators, 6814 arrays (0 quantized)\n2018-07-03 19:35:15.563598: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After Removing unused ops pass 1: 4053 operators, 6719 arrays (0 quantized)\n2018-07-03 19:35:15.977287: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before general graph transformations: 4053 operators, 6719 arrays (0 quantized)\n2018-07-03 19:35:16.225122: F tensorflow/contrib/lite/toco/graph_transformations/resolve_tensorflow_switch.cc:95] Check failed: other_op->type == OperatorType::kMerge\nAborted (core dumped)\nWho can help ?\nThanks!", "body": "How are mobilenet_ssd.tflite and [detect.tflite](https://storage.googleapis.com/download.tensorflow.org/models/tflite/coco_ssd_mobilenet_v1_1.0_quant_2018_06_29.zip)  converted  in the newest [TFLite Demo ](https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/lite/examples/android)?\r\n\r\nPreviously, I converted that model by following [this instructions](https://github.com/tensorflow/tensorflow/issues/15633#issuecomment-377652630),  but now,  I see that there are 4 outputs in TFLiteObjectDetectionAPIModel in the source code [TFLiteObjectDetectionAPIModel.java](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/lite/examples/android/app/src/main/java/org/tensorflow/demo/TFLiteObjectDetectionAPIModel.java), \r\n\r\n`    d.tfLite.setNumThreads(NUM_THREADS);\r\n    d.outputLocations = new float[1][NUM_DETECTIONS][4];\r\n    d.outputClasses = new float[1][NUM_DETECTIONS];\r\n    d.outputScores = new float[1][NUM_DETECTIONS];\r\n    d.numDetections = new float[1];`\r\n\r\nthe previously converted model can't be used.\r\n\r\nI tried the following instructions, but the error occurred.\r\n\r\n`bazel run --config=opt \\\r\n  //tensorflow/contrib/lite/toco:toco -- \\\r\n  --input_file=${MODEL_PATH}/frozen_inference_graph_stripped.pb \\\r\n  --output_file=${MODEL_PATH}/ssd_mobilenet_v1_float.tflite \\\r\n  --input_format=TENSORFLOW_GRAPHDEF \\\r\n  --output_format=TFLITE \\\r\n  --inference_type=FLOAT \\\r\n  --input_shapes=1,300,300,3 \\\r\n  --input_arrays=Preprocessor/sub \\\r\n  --output_arrays=detection_boxes,detection_scores,detection_classes,num_detections \\\r\n  --dump_graphviz=${MODEL_PATH} `\r\n\r\n.......\r\n2018-07-03 19:35:14.798049: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1090] Converting unsupported operation: TensorArrayGatherV3\r\n2018-07-03 19:35:14.798066: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1090] Converting unsupported operation: TensorArrayGatherV3\r\n2018-07-03 19:35:14.798080: I tensorflow/contrib/lite/toco/import_tensorflow.cc:1090] Converting unsupported operation: TensorArrayGatherV3\r\n2018-07-03 19:35:15.248275: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before Removing unused ops: 4096 operators, 6814 arrays (0 quantized)\r\n2018-07-03 19:35:15.563598: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] After Removing unused ops pass 1: 4053 operators, 6719 arrays (0 quantized)\r\n2018-07-03 19:35:15.977287: I tensorflow/contrib/lite/toco/graph_transformations/graph_transformations.cc:39] Before general graph transformations: 4053 operators, 6719 arrays (0 quantized)\r\n2018-07-03 19:35:16.225122: F tensorflow/contrib/lite/toco/graph_transformations/resolve_tensorflow_switch.cc:95] Check failed: other_op->type == OperatorType::kMerge \r\nAborted (core dumped)\r\n\r\nWho can help ?\r\n\r\nThanks!\r\n"}