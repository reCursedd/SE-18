{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/410835786", "html_url": "https://github.com/tensorflow/tensorflow/issues/17684#issuecomment-410835786", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17684", "id": 410835786, "node_id": "MDEyOklzc3VlQ29tbWVudDQxMDgzNTc4Ng==", "user": {"login": "ychen404", "id": 22212046, "node_id": "MDQ6VXNlcjIyMjEyMDQ2", "avatar_url": "https://avatars3.githubusercontent.com/u/22212046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ychen404", "html_url": "https://github.com/ychen404", "followers_url": "https://api.github.com/users/ychen404/followers", "following_url": "https://api.github.com/users/ychen404/following{/other_user}", "gists_url": "https://api.github.com/users/ychen404/gists{/gist_id}", "starred_url": "https://api.github.com/users/ychen404/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ychen404/subscriptions", "organizations_url": "https://api.github.com/users/ychen404/orgs", "repos_url": "https://api.github.com/users/ychen404/repos", "events_url": "https://api.github.com/users/ychen404/events{/privacy}", "received_events_url": "https://api.github.com/users/ychen404/received_events", "type": "User", "site_admin": false}, "created_at": "2018-08-06T20:04:04Z", "updated_at": "2018-08-06T20:04:04Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=14019923\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/GarryLau\">@GarryLau</a><br>\nHi Garry,</p>\n<p>I am able to use the code you provided to create the eval.pbtxt.<br>\nBut I still don't understand how to use eval pbtxt for freezing.<br>\nIs the graph retrieved from the checkpoint file? If I need to use the eval pbtxt, should I use the eval gbtxt directly in the freeze script?<br>\nFollowing is the code I used to freeze my model.</p>\n<pre><code>import tensorflow as tf\n from tensorflow.python.framework import graph_util\n import os,sys\n output_node_names = \"MobilenetV1/Predictions/Reshape\"\n saver = tf.train.import_meta_graph('/home/users/saman/yitao/tensorflow_android/models/research/slim/batch_32/model.ckpt-156300.meta', clear_devices=True)\n \n graph = tf.get_default_graph()\n input_graph_def = graph.as_graph_def()\n sess = tf.Session()\n saver.restore(sess, \"/home/users/saman/yitao/tensorflow_android/models/research/slim/batch_32/model.ckpt-156300\")\n output_graph_def = graph_util.convert_variables_to_constants(\n             sess, # The session is used to retrieve the weights\n             input_graph_def, # The graph_def is used to retrieve the nodes\n             output_node_names.split(\",\") # The output node names are used to select the usefull nodes\n )\n output_graph=\"frozen-model-conv6-bat-32.pb\"\n with tf.gfile.GFile(output_graph, \"wb\") as f:\n     f.write(output_graph_def.SerializeToString())\n \n sess.close()\n</code></pre>", "body_text": "@GarryLau\nHi Garry,\nI am able to use the code you provided to create the eval.pbtxt.\nBut I still don't understand how to use eval pbtxt for freezing.\nIs the graph retrieved from the checkpoint file? If I need to use the eval pbtxt, should I use the eval gbtxt directly in the freeze script?\nFollowing is the code I used to freeze my model.\nimport tensorflow as tf\n from tensorflow.python.framework import graph_util\n import os,sys\n output_node_names = \"MobilenetV1/Predictions/Reshape\"\n saver = tf.train.import_meta_graph('/home/users/saman/yitao/tensorflow_android/models/research/slim/batch_32/model.ckpt-156300.meta', clear_devices=True)\n \n graph = tf.get_default_graph()\n input_graph_def = graph.as_graph_def()\n sess = tf.Session()\n saver.restore(sess, \"/home/users/saman/yitao/tensorflow_android/models/research/slim/batch_32/model.ckpt-156300\")\n output_graph_def = graph_util.convert_variables_to_constants(\n             sess, # The session is used to retrieve the weights\n             input_graph_def, # The graph_def is used to retrieve the nodes\n             output_node_names.split(\",\") # The output node names are used to select the usefull nodes\n )\n output_graph=\"frozen-model-conv6-bat-32.pb\"\n with tf.gfile.GFile(output_graph, \"wb\") as f:\n     f.write(output_graph_def.SerializeToString())\n \n sess.close()", "body": "@GarryLau \r\nHi Garry, \r\n\r\nI am able to use the code you provided to create the eval.pbtxt. \r\nBut I still don't understand how to use eval pbtxt for freezing.  \r\nIs the graph retrieved from the checkpoint file? If I need to use the eval pbtxt, should I use the eval gbtxt directly in the freeze script? \r\nFollowing is the code I used to freeze my model. \r\n```\r\nimport tensorflow as tf\r\n from tensorflow.python.framework import graph_util\r\n import os,sys\r\n output_node_names = \"MobilenetV1/Predictions/Reshape\"\r\n saver = tf.train.import_meta_graph('/home/users/saman/yitao/tensorflow_android/models/research/slim/batch_32/model.ckpt-156300.meta', clear_devices=True)\r\n \r\n graph = tf.get_default_graph()\r\n input_graph_def = graph.as_graph_def()\r\n sess = tf.Session()\r\n saver.restore(sess, \"/home/users/saman/yitao/tensorflow_android/models/research/slim/batch_32/model.ckpt-156300\")\r\n output_graph_def = graph_util.convert_variables_to_constants(\r\n             sess, # The session is used to retrieve the weights\r\n             input_graph_def, # The graph_def is used to retrieve the nodes\r\n             output_node_names.split(\",\") # The output node names are used to select the usefull nodes\r\n )\r\n output_graph=\"frozen-model-conv6-bat-32.pb\"\r\n with tf.gfile.GFile(output_graph, \"wb\") as f:\r\n     f.write(output_graph_def.SerializeToString())\r\n \r\n sess.close()\r\n```\r\n\r\n\r\n"}