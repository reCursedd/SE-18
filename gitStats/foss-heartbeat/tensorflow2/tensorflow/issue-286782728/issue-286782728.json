{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15949", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15949/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15949/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15949/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15949", "id": 286782728, "node_id": "MDU6SXNzdWUyODY3ODI3Mjg=", "number": 15949, "title": "Building TensorFlow on Windows: patch and rm", "user": {"login": "EricHallahan", "id": 16454294, "node_id": "MDQ6VXNlcjE2NDU0Mjk0", "avatar_url": "https://avatars2.githubusercontent.com/u/16454294?v=4", "gravatar_id": "", "url": "https://api.github.com/users/EricHallahan", "html_url": "https://github.com/EricHallahan", "followers_url": "https://api.github.com/users/EricHallahan/followers", "following_url": "https://api.github.com/users/EricHallahan/following{/other_user}", "gists_url": "https://api.github.com/users/EricHallahan/gists{/gist_id}", "starred_url": "https://api.github.com/users/EricHallahan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/EricHallahan/subscriptions", "organizations_url": "https://api.github.com/users/EricHallahan/orgs", "repos_url": "https://api.github.com/users/EricHallahan/repos", "events_url": "https://api.github.com/users/EricHallahan/events{/privacy}", "received_events_url": "https://api.github.com/users/EricHallahan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473173351, "node_id": "MDU6TGFiZWw0NzMxNzMzNTE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:build/install", "name": "type:build/install", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "meteorcloudy", "id": 4171702, "node_id": "MDQ6VXNlcjQxNzE3MDI=", "avatar_url": "https://avatars2.githubusercontent.com/u/4171702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meteorcloudy", "html_url": "https://github.com/meteorcloudy", "followers_url": "https://api.github.com/users/meteorcloudy/followers", "following_url": "https://api.github.com/users/meteorcloudy/following{/other_user}", "gists_url": "https://api.github.com/users/meteorcloudy/gists{/gist_id}", "starred_url": "https://api.github.com/users/meteorcloudy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meteorcloudy/subscriptions", "organizations_url": "https://api.github.com/users/meteorcloudy/orgs", "repos_url": "https://api.github.com/users/meteorcloudy/repos", "events_url": "https://api.github.com/users/meteorcloudy/events{/privacy}", "received_events_url": "https://api.github.com/users/meteorcloudy/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "meteorcloudy", "id": 4171702, "node_id": "MDQ6VXNlcjQxNzE3MDI=", "avatar_url": "https://avatars2.githubusercontent.com/u/4171702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meteorcloudy", "html_url": "https://github.com/meteorcloudy", "followers_url": "https://api.github.com/users/meteorcloudy/followers", "following_url": "https://api.github.com/users/meteorcloudy/following{/other_user}", "gists_url": "https://api.github.com/users/meteorcloudy/gists{/gist_id}", "starred_url": "https://api.github.com/users/meteorcloudy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meteorcloudy/subscriptions", "organizations_url": "https://api.github.com/users/meteorcloudy/orgs", "repos_url": "https://api.github.com/users/meteorcloudy/repos", "events_url": "https://api.github.com/users/meteorcloudy/events{/privacy}", "received_events_url": "https://api.github.com/users/meteorcloudy/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2018-01-08T15:32:59Z", "updated_at": "2018-01-12T01:43:52Z", "closed_at": "2018-01-12T01:43:52Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code</strong>: Yes, provided below.</li>\n<li><strong>OS Platform and Distribution</strong>: Windows 10 1709, Build 16299.192</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: Binary, Attempting source build of master</li>\n<li><strong>TensorFlow version</strong>: 1.4.0</li>\n<li><strong>Python version</strong>: 3.6</li>\n<li><strong>Bazel version</strong>:  0.9.0</li>\n<li><strong>GCC/Compiler version</strong>:  MSYS2 Shell, GCC unknown.</li>\n<li><strong>CUDA/cuDNN version</strong>: N/A</li>\n<li><strong>GPU model and memory</strong>: N/A, CPU is i7-8550U, 8 GB memory</li>\n<li><strong>Exact command to reproduce</strong>: Any <code>bazel build</code> on Windows. Please see Description.</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>Building TensorFlow on Windows has been a struggle with compatibility due to the fact that for many, MSYS will not run <code>patch</code> when installed from the MSYS2 shell. I have found a reliable way to resolve the issue: using Choco to install <code>patch</code>, moving patch.exe to a folder FOLDERNAME within its default directory, and then running %FOLDERNAME%/patch.exe with the flag <code>--binary</code> (to use CR LF line breaks) with a custom batch script compiled into a executable.</p>\n<p><code>bazel build</code> now completes <code>patch</code> commands without issue. But as it often is, another hurdle exists to the finish line. Bazel now attempts to recursively force remove a file using <code>rm -rf</code>, which obviously does not exist as a package in Choco as a bash command. MSYS will run it, but not from the command line.</p>\n<p>Is there any way to get around the use of <code>rm</code>, or make a compatible solution for Windows using <code>del</code>?</p>\n<p>I have ensured that <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"285870376\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/15829\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/15829/hovercard\" href=\"https://github.com/tensorflow/tensorflow/pull/15829\">#15829</a> has been installed. Still fails</p>\n<p>If this is better left to the Bazel developers, please close this issue.</p>\n<h3>Source code</h3>\n<h4>patch.bat</h4>\n<div class=\"highlight highlight-source-shell\"><pre>start C:<span class=\"pl-cce\">\\P</span>rogramData<span class=\"pl-cce\">\\c</span>hocolatey<span class=\"pl-cce\">\\l</span>ib<span class=\"pl-cce\">\\p</span>atch<span class=\"pl-cce\">\\t</span>ools<span class=\"pl-cce\">\\b</span>in<span class=\"pl-cce\">\\%</span>FOLDERNAME%<span class=\"pl-cce\">\\p</span>atch.exe --binary\n<span class=\"pl-c1\">exit</span></pre></div>\n<h3>Logs</h3>\n<div class=\"highlight highlight-source-shell\"><pre>C:<span class=\"pl-cce\">\\t</span>ensorflow<span class=\"pl-k\">&gt;</span>bazel build --config=mkl --config=monolithic -c opt --copt=-march=native --copt=-mmmx --copt=-msse --copt=-msse2 --copt=-msse3 --copt=-mssse3 --copt=-msse4.1 --copt=-msse4.2 --copt=-mavx --copt=-mavx2 --copt=-maes --copt=-mfpmath=both //tensorflow/tools/pip_package:build_pip_package\n<span class=\"pl-c\"><span class=\"pl-c\">#</span>ERROR: C:/tensorflow/tensorflow/python/BUILD:4646:1: no such package '@cython//': Traceback (most recent call last):</span>\n        File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>C:/tensorflow/third_party/repo.bzl<span class=\"pl-pds\">\"</span></span>, line 86\n                _apply_delete(ctx, ctx.attr.delete)\n        File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>C:/tensorflow/third_party/repo.bzl<span class=\"pl-pds\">\"</span></span>, line 68, <span class=\"pl-k\">in</span> _apply_delete\n                _execute_and_check_ret_code(ctx, cmd)\n        File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>C:/tensorflow/third_party/repo.bzl<span class=\"pl-pds\">\"</span></span>, line 44, <span class=\"pl-k\">in</span> _execute_and_check_ret_code\n                fail(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Non-zero return code({1}) when ...))</span>\n<span class=\"pl-s\">Non-zero return code(127) when executing 'C:\\msys64\\usr\\bin\\bash.exe -c rm -rf C:/users/eric/appdata/local/temp/_bazel_eric/x1e5egqw/external/cython/BUILD.bazel':</span>\n<span class=\"pl-s\">Stdout:</span>\n<span class=\"pl-s\">Stderr: /usr/bin/bash: rm: command not found</span>\n<span class=\"pl-s\"> and referenced by '//tensorflow/python:framework/fast_tensor_util.pyx_cython_translation'</span>\n<span class=\"pl-s\">ERROR: Analysis of target '//tensorflow/tools/pip_package:build_pip_package' failed; build aborted: Loading failed</span>\n<span class=\"pl-s\">INFO: Elapsed time: 61.324s</span>\n<span class=\"pl-s\">FAILED: Build did NOT complete successfully (92 packages loaded)</span></pre></div>", "body_text": "System information\n\nHave I written custom code: Yes, provided below.\nOS Platform and Distribution: Windows 10 1709, Build 16299.192\nTensorFlow installed from (source or binary): Binary, Attempting source build of master\nTensorFlow version: 1.4.0\nPython version: 3.6\nBazel version:  0.9.0\nGCC/Compiler version:  MSYS2 Shell, GCC unknown.\nCUDA/cuDNN version: N/A\nGPU model and memory: N/A, CPU is i7-8550U, 8 GB memory\nExact command to reproduce: Any bazel build on Windows. Please see Description.\n\nDescribe the problem\nBuilding TensorFlow on Windows has been a struggle with compatibility due to the fact that for many, MSYS will not run patch when installed from the MSYS2 shell. I have found a reliable way to resolve the issue: using Choco to install patch, moving patch.exe to a folder FOLDERNAME within its default directory, and then running %FOLDERNAME%/patch.exe with the flag --binary (to use CR LF line breaks) with a custom batch script compiled into a executable.\nbazel build now completes patch commands without issue. But as it often is, another hurdle exists to the finish line. Bazel now attempts to recursively force remove a file using rm -rf, which obviously does not exist as a package in Choco as a bash command. MSYS will run it, but not from the command line.\nIs there any way to get around the use of rm, or make a compatible solution for Windows using del?\nI have ensured that #15829 has been installed. Still fails\nIf this is better left to the Bazel developers, please close this issue.\nSource code\npatch.bat\nstart C:\\ProgramData\\chocolatey\\lib\\patch\\tools\\bin\\%FOLDERNAME%\\patch.exe --binary\nexit\nLogs\nC:\\tensorflow>bazel build --config=mkl --config=monolithic -c opt --copt=-march=native --copt=-mmmx --copt=-msse --copt=-msse2 --copt=-msse3 --copt=-mssse3 --copt=-msse4.1 --copt=-msse4.2 --copt=-mavx --copt=-mavx2 --copt=-maes --copt=-mfpmath=both //tensorflow/tools/pip_package:build_pip_package\n#ERROR: C:/tensorflow/tensorflow/python/BUILD:4646:1: no such package '@cython//': Traceback (most recent call last):\n        File \"C:/tensorflow/third_party/repo.bzl\", line 86\n                _apply_delete(ctx, ctx.attr.delete)\n        File \"C:/tensorflow/third_party/repo.bzl\", line 68, in _apply_delete\n                _execute_and_check_ret_code(ctx, cmd)\n        File \"C:/tensorflow/third_party/repo.bzl\", line 44, in _execute_and_check_ret_code\n                fail(\"Non-zero return code({1}) when ...))\nNon-zero return code(127) when executing 'C:\\msys64\\usr\\bin\\bash.exe -c rm -rf C:/users/eric/appdata/local/temp/_bazel_eric/x1e5egqw/external/cython/BUILD.bazel':\nStdout:\nStderr: /usr/bin/bash: rm: command not found\n and referenced by '//tensorflow/python:framework/fast_tensor_util.pyx_cython_translation'\nERROR: Analysis of target '//tensorflow/tools/pip_package:build_pip_package' failed; build aborted: Loading failed\nINFO: Elapsed time: 61.324s\nFAILED: Build did NOT complete successfully (92 packages loaded)", "body": "### System information\r\n- **Have I written custom code**: Yes, provided below.\r\n- **OS Platform and Distribution**: Windows 10 1709, Build 16299.192\r\n- **TensorFlow installed from (source or binary)**: Binary, Attempting source build of master\r\n- **TensorFlow version**: 1.4.0\r\n- **Python version**: 3.6\r\n- **Bazel version**:  0.9.0\r\n- **GCC/Compiler version**:  MSYS2 Shell, GCC unknown.\r\n- **CUDA/cuDNN version**: N/A\r\n- **GPU model and memory**: N/A, CPU is i7-8550U, 8 GB memory\r\n- **Exact command to reproduce**: Any `bazel build` on Windows. Please see Description.\r\n\r\n### Describe the problem\r\nBuilding TensorFlow on Windows has been a struggle with compatibility due to the fact that for many, MSYS will not run `patch` when installed from the MSYS2 shell. I have found a reliable way to resolve the issue: using Choco to install `patch`, moving patch.exe to a folder FOLDERNAME within its default directory, and then running %FOLDERNAME%/patch.exe with the flag `--binary` (to use CR LF line breaks) with a custom batch script compiled into a executable.\r\n\r\n`bazel build` now completes `patch` commands without issue. But as it often is, another hurdle exists to the finish line. Bazel now attempts to recursively force remove a file using `rm -rf`, which obviously does not exist as a package in Choco as a bash command. MSYS will run it, but not from the command line.\r\n\r\nIs there any way to get around the use of `rm`, or make a compatible solution for Windows using `del`?\r\n\r\nI have ensured that #15829 has been installed. Still fails\r\n\r\nIf this is better left to the Bazel developers, please close this issue. \r\n\r\n### Source code\r\n\r\n#### patch.bat\r\n``` sh\r\nstart C:\\ProgramData\\chocolatey\\lib\\patch\\tools\\bin\\%FOLDERNAME%\\patch.exe --binary\r\nexit\r\n```\r\n\r\n### Logs\r\n``` sh\r\nC:\\tensorflow>bazel build --config=mkl --config=monolithic -c opt --copt=-march=native --copt=-mmmx --copt=-msse --copt=-msse2 --copt=-msse3 --copt=-mssse3 --copt=-msse4.1 --copt=-msse4.2 --copt=-mavx --copt=-mavx2 --copt=-maes --copt=-mfpmath=both //tensorflow/tools/pip_package:build_pip_package\r\n#ERROR: C:/tensorflow/tensorflow/python/BUILD:4646:1: no such package '@cython//': Traceback (most recent call last):\r\n        File \"C:/tensorflow/third_party/repo.bzl\", line 86\r\n                _apply_delete(ctx, ctx.attr.delete)\r\n        File \"C:/tensorflow/third_party/repo.bzl\", line 68, in _apply_delete\r\n                _execute_and_check_ret_code(ctx, cmd)\r\n        File \"C:/tensorflow/third_party/repo.bzl\", line 44, in _execute_and_check_ret_code\r\n                fail(\"Non-zero return code({1}) when ...))\r\nNon-zero return code(127) when executing 'C:\\msys64\\usr\\bin\\bash.exe -c rm -rf C:/users/eric/appdata/local/temp/_bazel_eric/x1e5egqw/external/cython/BUILD.bazel':\r\nStdout:\r\nStderr: /usr/bin/bash: rm: command not found\r\n and referenced by '//tensorflow/python:framework/fast_tensor_util.pyx_cython_translation'\r\nERROR: Analysis of target '//tensorflow/tools/pip_package:build_pip_package' failed; build aborted: Loading failed\r\nINFO: Elapsed time: 61.324s\r\nFAILED: Build did NOT complete successfully (92 packages loaded)\r\n```\r\n\r\n  "}