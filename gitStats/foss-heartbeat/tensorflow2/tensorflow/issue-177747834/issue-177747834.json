{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4451", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4451/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4451/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4451/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/4451", "id": 177747834, "node_id": "MDU6SXNzdWUxNzc3NDc4MzQ=", "number": 4451, "title": "TensorFlow demo app crashes with my own model", "user": {"login": "fninsiima", "id": 5743896, "node_id": "MDQ6VXNlcjU3NDM4OTY=", "avatar_url": "https://avatars0.githubusercontent.com/u/5743896?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fninsiima", "html_url": "https://github.com/fninsiima", "followers_url": "https://api.github.com/users/fninsiima/followers", "following_url": "https://api.github.com/users/fninsiima/following{/other_user}", "gists_url": "https://api.github.com/users/fninsiima/gists{/gist_id}", "starred_url": "https://api.github.com/users/fninsiima/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fninsiima/subscriptions", "organizations_url": "https://api.github.com/users/fninsiima/orgs", "repos_url": "https://api.github.com/users/fninsiima/repos", "events_url": "https://api.github.com/users/fninsiima/events{/privacy}", "received_events_url": "https://api.github.com/users/fninsiima/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "andrewharp", "id": 3376817, "node_id": "MDQ6VXNlcjMzNzY4MTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/3376817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewharp", "html_url": "https://github.com/andrewharp", "followers_url": "https://api.github.com/users/andrewharp/followers", "following_url": "https://api.github.com/users/andrewharp/following{/other_user}", "gists_url": "https://api.github.com/users/andrewharp/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewharp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewharp/subscriptions", "organizations_url": "https://api.github.com/users/andrewharp/orgs", "repos_url": "https://api.github.com/users/andrewharp/repos", "events_url": "https://api.github.com/users/andrewharp/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewharp/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "andrewharp", "id": 3376817, "node_id": "MDQ6VXNlcjMzNzY4MTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/3376817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewharp", "html_url": "https://github.com/andrewharp", "followers_url": "https://api.github.com/users/andrewharp/followers", "following_url": "https://api.github.com/users/andrewharp/following{/other_user}", "gists_url": "https://api.github.com/users/andrewharp/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewharp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewharp/subscriptions", "organizations_url": "https://api.github.com/users/andrewharp/orgs", "repos_url": "https://api.github.com/users/andrewharp/repos", "events_url": "https://api.github.com/users/andrewharp/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewharp/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 15, "created_at": "2016-09-19T10:12:38Z", "updated_at": "2018-07-10T08:48:37Z", "closed_at": "2016-09-19T19:01:46Z", "author_association": "NONE", "body_html": "<h3>What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?</h3>\n<p><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"135957980\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/1269\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/1269/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/1269\">#1269</a></p>\n<h3>Environment info</h3>\n<p>Operating System: Linux ubuntu</p>\n<p>If installed from source, provide</p>\n<ol>\n<li>The commit hash (<code>git rev-parse HEAD</code>)<br>\n<a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/ce3572a08b9ecfa5c8dd94921c2011f37b58e608/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/ce3572a08b9ecfa5c8dd94921c2011f37b58e608\"><tt>ce3572a</tt></a></li>\n</ol>\n<h3>If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)</h3>\n<ol>\n<li>Followin this tutorial: <a href=\"https://www.tensorflow.org/versions/r0.9/how_tos/image_retraining/index.html\" rel=\"nofollow\">https://www.tensorflow.org/versions/r0.9/how_tos/image_retraining/index.html</a><br>\nI built a model via transfer learning using custom images.</li>\n<li>I edited WORKSPACE and built demo.apk<br>\nApp crashed.</li>\n<li>Then i used inception5h.zip  as referenced in <a href=\"https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android\">https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android</a>.<br>\nThe app run without any problem.</li>\n</ol>\n<h3>What other attempted solutions have you tried?</h3>\n<p>Then i looked at issue <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"135957980\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/1269\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/1269/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/1269\">#1269</a> for guidance.</p>\n<ol>\n<li>---Edited tensorflowImagelistener.java---</li>\n</ol>\n<div class=\"highlight highlight-source-java\"><pre>  <span class=\"pl-k\">private</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">final</span> <span class=\"pl-k\">int</span> <span class=\"pl-c1\">NUM_CLASSES</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">4</span>; <span class=\"pl-c\"><span class=\"pl-c\">//</span>1001;</span>\n  <span class=\"pl-k\">private</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">final</span> <span class=\"pl-k\">int</span> <span class=\"pl-c1\">INPUT_SIZE</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">299</span>; <span class=\"pl-c\"><span class=\"pl-c\">//</span>224</span>\n  <span class=\"pl-k\">private</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">final</span> <span class=\"pl-k\">int</span> <span class=\"pl-c1\">IMAGE_MEAN</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">128</span>; <span class=\"pl-c\"><span class=\"pl-c\">//</span>117</span>\n  <span class=\"pl-k\">private</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">final</span> <span class=\"pl-k\">float</span> <span class=\"pl-c1\">IMAGE_STD</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">128</span>; <span class=\"pl-c\"><span class=\"pl-c\">//</span>1;</span>\n  <span class=\"pl-k\">private</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> <span class=\"pl-c1\">INPUT_NAME</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Mul:0<span class=\"pl-pds\">\"</span></span>; <span class=\"pl-c\"><span class=\"pl-c\">//</span>\"input:0\"; </span>\n  <span class=\"pl-k\">private</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> <span class=\"pl-c1\">OUTPUT_NAME</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>final_result:0<span class=\"pl-pds\">\"</span></span>; <span class=\"pl-c\"><span class=\"pl-c\">//</span>\"output:0\";</span></pre></div>\n<ol>\n<li>---I even stripped the graph using strip_unused.py using ----</li>\n</ol>\n<div class=\"highlight highlight-source-shell\"><pre>  bazel build tensorflow/python/tools:strip_unused\n  bazel-bin/tensorflow/python/tools/strip_unused --input_graph=/tmp/inception.pb   --output_graph=/tmp/stripped_inception.pb --input_node_names=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Mul:0<span class=\"pl-pds\">\"</span></span> --output_node_names=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>final_result<span class=\"pl-pds\">\"</span></span> --input_binary=true</pre></div>\n<ol>\n<li>--In strip_unused_lib.py i added if else clause as referenced by <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4357323\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/dmirk\">@dmirk</a> quick-n-dirty from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"135957980\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/1269\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/1269/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/1269\">#1269</a>---</li>\n</ol>\n<div class=\"highlight highlight-source-python\"><pre>      <span class=\"pl-k\">if</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>jpeg<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">in</span> node.op.lower():\n        placeholder_node.attr[<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>dtype<span class=\"pl-pds\">\"</span></span>].CopyFrom(tf.AttrValue(\n            <span class=\"pl-v\">type</span><span class=\"pl-k\">=</span>tf.uint8.as_datatype_enum))\n      <span class=\"pl-k\">else</span>:\n        placeholder_node.attr[<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>dtype<span class=\"pl-pds\">\"</span></span>].CopyFrom(tf.AttrValue(\n            <span class=\"pl-v\">type</span><span class=\"pl-k\">=</span>placeholder_type_enum))</pre></div>\n<ol>\n<li>For some reason i still got this error. See attached<br>\n<a href=\"https://github.com/tensorflow/tensorflow/files/479719/oldlogcat.txt\">oldlogcat.txt</a></li>\n</ol>\n<div class=\"highlight highlight-source-shell\"><pre>tensorflow_jni.cc:304 Error during inference: Invalid argument: No OpKernel was registered to support Op <span class=\"pl-s\"><span class=\"pl-pds\">'</span>DecodeJpeg<span class=\"pl-pds\">'</span></span> with these attrs.  Registered kernels:</pre></div>\n<ol>\n<li>As a last resort i did this modification to tensorflow_jni.cc as referenced in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"135957980\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/1269\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/1269/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/1269\">#1269</a>. See attached <a href=\"https://github.com/tensorflow/tensorflow/files/479718/logcat.txt\">logcat.txt</a></li>\n</ol>\n<div class=\"highlight highlight-source-c++\"><pre>      <span class=\"pl-c\"><span class=\"pl-c\">//</span> Copy 3 values</span>\n      <span class=\"pl-en\">input_tensor_mapped</span>(<span class=\"pl-c1\">0</span>, i, j, <span class=\"pl-c1\">0</span>) =\n          (<span class=\"pl-k\">static_cast</span>&lt;<span class=\"pl-k\">float</span>&gt;(src-&gt;red) - g_image_mean) / g_image_mean;<span class=\"pl-c\"><span class=\"pl-c\">//</span>g_image_std;</span>\n      <span class=\"pl-en\">input_tensor_mapped</span>(<span class=\"pl-c1\">0</span>, i, j, <span class=\"pl-c1\">1</span>) =\n          (<span class=\"pl-k\">static_cast</span>&lt;<span class=\"pl-k\">float</span>&gt;(src-&gt;green) - g_image_mean) / g_image_mean;<span class=\"pl-c\"><span class=\"pl-c\">//</span>g_image_std;</span>\n      <span class=\"pl-en\">input_tensor_mapped</span>(<span class=\"pl-c1\">0</span>, i, j, <span class=\"pl-c1\">2</span>) =\n          (<span class=\"pl-k\">static_cast</span>&lt;<span class=\"pl-k\">float</span>&gt;(src-&gt;blue) - g_image_mean) / g_image_mean;<span class=\"pl-c\"><span class=\"pl-c\">//</span>g_image_std;</span></pre></div>\n<p>but i think this dint help any much. however i dint find the opkernel error</p>\n<h3>Logs or other output that would be helpful</h3>", "body_text": "What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\n#1269\nEnvironment info\nOperating System: Linux ubuntu\nIf installed from source, provide\n\nThe commit hash (git rev-parse HEAD)\nce3572a\n\nIf possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\n\nFollowin this tutorial: https://www.tensorflow.org/versions/r0.9/how_tos/image_retraining/index.html\nI built a model via transfer learning using custom images.\nI edited WORKSPACE and built demo.apk\nApp crashed.\nThen i used inception5h.zip  as referenced in https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android.\nThe app run without any problem.\n\nWhat other attempted solutions have you tried?\nThen i looked at issue #1269 for guidance.\n\n---Edited tensorflowImagelistener.java---\n\n  private static final int NUM_CLASSES = 4; //1001;\n  private static final int INPUT_SIZE = 299; //224\n  private static final int IMAGE_MEAN = 128; //117\n  private static final float IMAGE_STD = 128; //1;\n  private static final String INPUT_NAME = \"Mul:0\"; //\"input:0\"; \n  private static final String OUTPUT_NAME = \"final_result:0\"; //\"output:0\";\n\n---I even stripped the graph using strip_unused.py using ----\n\n  bazel build tensorflow/python/tools:strip_unused\n  bazel-bin/tensorflow/python/tools/strip_unused --input_graph=/tmp/inception.pb   --output_graph=/tmp/stripped_inception.pb --input_node_names=\"Mul:0\" --output_node_names=\"final_result\" --input_binary=true\n\n--In strip_unused_lib.py i added if else clause as referenced by @dmirk quick-n-dirty from #1269---\n\n      if \"jpeg\" in node.op.lower():\n        placeholder_node.attr[\"dtype\"].CopyFrom(tf.AttrValue(\n            type=tf.uint8.as_datatype_enum))\n      else:\n        placeholder_node.attr[\"dtype\"].CopyFrom(tf.AttrValue(\n            type=placeholder_type_enum))\n\nFor some reason i still got this error. See attached\noldlogcat.txt\n\ntensorflow_jni.cc:304 Error during inference: Invalid argument: No OpKernel was registered to support Op 'DecodeJpeg' with these attrs.  Registered kernels:\n\nAs a last resort i did this modification to tensorflow_jni.cc as referenced in #1269. See attached logcat.txt\n\n      // Copy 3 values\n      input_tensor_mapped(0, i, j, 0) =\n          (static_cast<float>(src->red) - g_image_mean) / g_image_mean;//g_image_std;\n      input_tensor_mapped(0, i, j, 1) =\n          (static_cast<float>(src->green) - g_image_mean) / g_image_mean;//g_image_std;\n      input_tensor_mapped(0, i, j, 2) =\n          (static_cast<float>(src->blue) - g_image_mean) / g_image_mean;//g_image_std;\nbut i think this dint help any much. however i dint find the opkernel error\nLogs or other output that would be helpful", "body": "### What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\n\nhttps://github.com/tensorflow/tensorflow/issues/1269\n### Environment info\n\nOperating System: Linux ubuntu\n\nIf installed from source, provide \n1. The commit hash (`git rev-parse HEAD`) \n   ce3572a08b9ecfa5c8dd94921c2011f37b58e608\n### If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\n1. Followin this tutorial: https://www.tensorflow.org/versions/r0.9/how_tos/image_retraining/index.html\n   I built a model via transfer learning using custom images. \n2. I edited WORKSPACE and built demo.apk\n   App crashed.\n3. Then i used inception5h.zip  as referenced in https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android.\n   The app run without any problem.\n### What other attempted solutions have you tried?\n\nThen i looked at issue https://github.com/tensorflow/tensorflow/issues/1269 for guidance.\n1.    ---Edited tensorflowImagelistener.java---\n\n``` java\n  private static final int NUM_CLASSES = 4; //1001;\n  private static final int INPUT_SIZE = 299; //224\n  private static final int IMAGE_MEAN = 128; //117\n  private static final float IMAGE_STD = 128; //1;\n  private static final String INPUT_NAME = \"Mul:0\"; //\"input:0\"; \n  private static final String OUTPUT_NAME = \"final_result:0\"; //\"output:0\";\n```\n1. ---I even stripped the graph using strip_unused.py using ----\n\n``` sh\n  bazel build tensorflow/python/tools:strip_unused\n  bazel-bin/tensorflow/python/tools/strip_unused --input_graph=/tmp/inception.pb   --output_graph=/tmp/stripped_inception.pb --input_node_names=\"Mul:0\" --output_node_names=\"final_result\" --input_binary=true\n```\n1. --In strip_unused_lib.py i added if else clause as referenced by @dmirk quick-n-dirty from #1269---\n\n``` python\n      if \"jpeg\" in node.op.lower():\n        placeholder_node.attr[\"dtype\"].CopyFrom(tf.AttrValue(\n            type=tf.uint8.as_datatype_enum))\n      else:\n        placeholder_node.attr[\"dtype\"].CopyFrom(tf.AttrValue(\n            type=placeholder_type_enum))\n```\n1. For some reason i still got this error. See attached \n   [oldlogcat.txt](https://github.com/tensorflow/tensorflow/files/479719/oldlogcat.txt)\n\n``` sh\ntensorflow_jni.cc:304 Error during inference: Invalid argument: No OpKernel was registered to support Op 'DecodeJpeg' with these attrs.  Registered kernels:\n```\n1. As a last resort i did this modification to tensorflow_jni.cc as referenced in #1269. See attached [logcat.txt](https://github.com/tensorflow/tensorflow/files/479718/logcat.txt)\n\n``` cc\n      // Copy 3 values\n      input_tensor_mapped(0, i, j, 0) =\n          (static_cast<float>(src->red) - g_image_mean) / g_image_mean;//g_image_std;\n      input_tensor_mapped(0, i, j, 1) =\n          (static_cast<float>(src->green) - g_image_mean) / g_image_mean;//g_image_std;\n      input_tensor_mapped(0, i, j, 2) =\n          (static_cast<float>(src->blue) - g_image_mean) / g_image_mean;//g_image_std;\n```\n\nbut i think this dint help any much. however i dint find the opkernel error\n### Logs or other output that would be helpful\n"}