{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/415870937", "html_url": "https://github.com/tensorflow/tensorflow/issues/21714#issuecomment-415870937", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21714", "id": 415870937, "node_id": "MDEyOklzc3VlQ29tbWVudDQxNTg3MDkzNw==", "user": {"login": "gargn", "id": 1900612, "node_id": "MDQ6VXNlcjE5MDA2MTI=", "avatar_url": "https://avatars2.githubusercontent.com/u/1900612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gargn", "html_url": "https://github.com/gargn", "followers_url": "https://api.github.com/users/gargn/followers", "following_url": "https://api.github.com/users/gargn/following{/other_user}", "gists_url": "https://api.github.com/users/gargn/gists{/gist_id}", "starred_url": "https://api.github.com/users/gargn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gargn/subscriptions", "organizations_url": "https://api.github.com/users/gargn/orgs", "repos_url": "https://api.github.com/users/gargn/repos", "events_url": "https://api.github.com/users/gargn/events{/privacy}", "received_events_url": "https://api.github.com/users/gargn/received_events", "type": "User", "site_admin": false}, "created_at": "2018-08-24T20:16:30Z", "updated_at": "2018-08-24T21:42:39Z", "author_association": "MEMBER", "body_html": "<p>To answer your original question - ExpandDims is supported in TOCO when the input tensor has a static shape.</p>\n<p>However, I am having trouble reproducing your issue from the frozen graph you provided. I tried running the command below on the tf-nightly build (installed via <code>pip install tf-nightly</code>) and I got an error stating that RandomUniform is not supported. When I added the <code>--allow_custom_ops</code> flag, TOCO converted the model without error.</p>\n<pre><code>tflite_convert \\\n--graph_def_file=$TENSORFLOW_FILE \\\n--input_arrays=input_x \\\n--output_arrays=output/predictions \\\n--input_shapes=1,40 \\\n--output_file=$TFLITE_FILE\n</code></pre>\n<p>A few changes I did have to make from your original command:</p>\n<ol>\n<li>I removed <code>--input_type=INT</code>. The supported flags are listed <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/lite/toco/g3doc/cmdline_reference.md\">here</a>. It is possible you intended on using <code>--inference_input_type</code>. <code>--inference_input_type=QUANTIZED_UINT8</code> is used for models where the input is quantized but the model is a float model.</li>\n<li>I changed the <code>input_shapes</code> from <code>1,78</code> to <code>1,40</code>.</li>\n</ol>\n<p>Just to summarize, I was able to run the following command without TOCO reporting an error:</p>\n<pre><code>tflite_convert \\\n--graph_def_file=$TENSORFLOW_FILE \\\n--input_arrays=input_x \\\n--output_arrays=output/predictions \\\n--input_shapes=1,40 \\\n--output_file=$TFLITE_FILE \\\n--allow_custom_ops\n</code></pre>\n<p>Also, just as a note, <code>tflite_convert</code> is aliased to the same tool as <code>toco</code>. I use <code>tflite_convert</code> for my commands because that is what we use in our documentation.</p>\n<p>Can you try running your model with the tf-nightly build instead of 1.10 and see if you get the same results?</p>", "body_text": "To answer your original question - ExpandDims is supported in TOCO when the input tensor has a static shape.\nHowever, I am having trouble reproducing your issue from the frozen graph you provided. I tried running the command below on the tf-nightly build (installed via pip install tf-nightly) and I got an error stating that RandomUniform is not supported. When I added the --allow_custom_ops flag, TOCO converted the model without error.\ntflite_convert \\\n--graph_def_file=$TENSORFLOW_FILE \\\n--input_arrays=input_x \\\n--output_arrays=output/predictions \\\n--input_shapes=1,40 \\\n--output_file=$TFLITE_FILE\n\nA few changes I did have to make from your original command:\n\nI removed --input_type=INT. The supported flags are listed here. It is possible you intended on using --inference_input_type. --inference_input_type=QUANTIZED_UINT8 is used for models where the input is quantized but the model is a float model.\nI changed the input_shapes from 1,78 to 1,40.\n\nJust to summarize, I was able to run the following command without TOCO reporting an error:\ntflite_convert \\\n--graph_def_file=$TENSORFLOW_FILE \\\n--input_arrays=input_x \\\n--output_arrays=output/predictions \\\n--input_shapes=1,40 \\\n--output_file=$TFLITE_FILE \\\n--allow_custom_ops\n\nAlso, just as a note, tflite_convert is aliased to the same tool as toco. I use tflite_convert for my commands because that is what we use in our documentation.\nCan you try running your model with the tf-nightly build instead of 1.10 and see if you get the same results?", "body": "To answer your original question - ExpandDims is supported in TOCO when the input tensor has a static shape.\r\n\r\nHowever, I am having trouble reproducing your issue from the frozen graph you provided. I tried running the command below on the tf-nightly build (installed via `pip install tf-nightly`) and I got an error stating that RandomUniform is not supported. When I added the `--allow_custom_ops` flag, TOCO converted the model without error.\r\n```\r\ntflite_convert \\\r\n--graph_def_file=$TENSORFLOW_FILE \\\r\n--input_arrays=input_x \\\r\n--output_arrays=output/predictions \\\r\n--input_shapes=1,40 \\\r\n--output_file=$TFLITE_FILE\r\n```\r\n\r\nA few changes I did have to make from your original command:\r\n1. I removed `--input_type=INT`. The supported flags are listed [here](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/lite/toco/g3doc/cmdline_reference.md). It is possible you intended on using `--inference_input_type`. `--inference_input_type=QUANTIZED_UINT8` is used for models where the input is quantized but the model is a float model.\r\n2. I changed the `input_shapes` from `1,78` to `1,40`.\r\n\r\nJust to summarize, I was able to run the following command without TOCO reporting an error:\r\n```\r\ntflite_convert \\\r\n--graph_def_file=$TENSORFLOW_FILE \\\r\n--input_arrays=input_x \\\r\n--output_arrays=output/predictions \\\r\n--input_shapes=1,40 \\\r\n--output_file=$TFLITE_FILE \\\r\n--allow_custom_ops\r\n```\r\n\r\nAlso, just as a note, `tflite_convert` is aliased to the same tool as `toco`. I use `tflite_convert` for my commands because that is what we use in our documentation.\r\n\r\nCan you try running your model with the tf-nightly build instead of 1.10 and see if you get the same results?"}