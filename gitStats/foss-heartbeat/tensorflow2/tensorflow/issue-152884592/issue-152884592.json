{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2210", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2210/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2210/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2210/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/2210", "id": 152884592, "node_id": "MDU6SXNzdWUxNTI4ODQ1OTI=", "number": 2210, "title": "Sharing a GPU between tensorflow and another cuda code.", "user": {"login": "mrvahdat", "id": 5694429, "node_id": "MDQ6VXNlcjU2OTQ0Mjk=", "avatar_url": "https://avatars2.githubusercontent.com/u/5694429?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrvahdat", "html_url": "https://github.com/mrvahdat", "followers_url": "https://api.github.com/users/mrvahdat/followers", "following_url": "https://api.github.com/users/mrvahdat/following{/other_user}", "gists_url": "https://api.github.com/users/mrvahdat/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrvahdat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrvahdat/subscriptions", "organizations_url": "https://api.github.com/users/mrvahdat/orgs", "repos_url": "https://api.github.com/users/mrvahdat/repos", "events_url": "https://api.github.com/users/mrvahdat/events{/privacy}", "received_events_url": "https://api.github.com/users/mrvahdat/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 284463744, "node_id": "MDU6TGFiZWwyODQ0NjM3NDQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cuda", "name": "cuda", "color": "f7c6c7", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2016-05-03T22:00:59Z", "updated_at": "2017-05-12T19:35:48Z", "closed_at": "2016-06-28T18:45:17Z", "author_association": "NONE", "body_html": "<p>Hello,</p>\n<p>I am trying to run tensorflow and another cuda code in the same python script. My script is coded such that it iteratively uses the other cuda code to generate bunch of samples and then it uses tensorflow to process them. The tensoflow session is always open while doing these iterations.</p>\n<p>The problem is that in tensorflow 0.7, I get the following error when the session is closing (exiting python):</p>\n<p>F tensorflow/stream_executor/cuda/cuda_driver.cc:302] current context was not created by the StreamExecutor cuda_driver API: 0x2eb5c50; a CUDA runtime call was likely performed without using a StreamExecutor context</p>\n<p>And, in tensorflow 0.8, I get another error in middle of run:</p>\n<p>*** Error in `python': munmap_chunk(): invalid pointer: 0x00007ffea63b7380 ***<br>\nAborted (core dumped)</p>\n<p>I have modified my other cuda code to use cuda's Stream Executor context but this did not solve any of these issues. I'm also pretty sure my cuda code does not have any memory leak. If I replace my cuda code with its cpu version or the tensorflow operations with numpy counterparts every thing works perfectly. I have also limited gpu memory for TF using:</p>\n<p>tf.GPUOptions(per_process_gpu_memory_fraction=0.5)</p>\n<p>I am wondering if we actually can share a single GPU between tenorflow and another cuda code in the same script? If so, is there any particular protocol that I should follow.</p>", "body_text": "Hello,\nI am trying to run tensorflow and another cuda code in the same python script. My script is coded such that it iteratively uses the other cuda code to generate bunch of samples and then it uses tensorflow to process them. The tensoflow session is always open while doing these iterations.\nThe problem is that in tensorflow 0.7, I get the following error when the session is closing (exiting python):\nF tensorflow/stream_executor/cuda/cuda_driver.cc:302] current context was not created by the StreamExecutor cuda_driver API: 0x2eb5c50; a CUDA runtime call was likely performed without using a StreamExecutor context\nAnd, in tensorflow 0.8, I get another error in middle of run:\n*** Error in `python': munmap_chunk(): invalid pointer: 0x00007ffea63b7380 ***\nAborted (core dumped)\nI have modified my other cuda code to use cuda's Stream Executor context but this did not solve any of these issues. I'm also pretty sure my cuda code does not have any memory leak. If I replace my cuda code with its cpu version or the tensorflow operations with numpy counterparts every thing works perfectly. I have also limited gpu memory for TF using:\ntf.GPUOptions(per_process_gpu_memory_fraction=0.5)\nI am wondering if we actually can share a single GPU between tenorflow and another cuda code in the same script? If so, is there any particular protocol that I should follow.", "body": "Hello,\n\nI am trying to run tensorflow and another cuda code in the same python script. My script is coded such that it iteratively uses the other cuda code to generate bunch of samples and then it uses tensorflow to process them. The tensoflow session is always open while doing these iterations.\n\nThe problem is that in tensorflow 0.7, I get the following error when the session is closing (exiting python):\n\nF tensorflow/stream_executor/cuda/cuda_driver.cc:302] current context was not created by the StreamExecutor cuda_driver API: 0x2eb5c50; a CUDA runtime call was likely performed without using a StreamExecutor context\n\nAnd, in tensorflow 0.8, I get another error in middle of run:\n\n**\\* Error in `python': munmap_chunk(): invalid pointer: 0x00007ffea63b7380 ***\nAborted (core dumped)\n\nI have modified my other cuda code to use cuda's Stream Executor context but this did not solve any of these issues. I'm also pretty sure my cuda code does not have any memory leak. If I replace my cuda code with its cpu version or the tensorflow operations with numpy counterparts every thing works perfectly. I have also limited gpu memory for TF using: \n\ntf.GPUOptions(per_process_gpu_memory_fraction=0.5)\n\nI am wondering if we actually can share a single GPU between tenorflow and another cuda code in the same script? If so, is there any particular protocol that I should follow.\n"}