{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/409080814", "html_url": "https://github.com/tensorflow/tensorflow/issues/21259#issuecomment-409080814", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21259", "id": 409080814, "node_id": "MDEyOklzc3VlQ29tbWVudDQwOTA4MDgxNA==", "user": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-31T03:16:12Z", "updated_at": "2018-07-31T03:16:12Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Without the code of your <code>data.instance_as_tensor()</code> function it is difficult to say, but I think the bug might be in that function.</p>\n<p>For example, the following trivial code combines <code>Dataset.map()</code> and <code>Dataset.padded_batch()</code> without error:</p>\n<div class=\"highlight highlight-source-python\"><pre>dataset <span class=\"pl-k\">=</span> tf.data.Dataset.from_tensor_slices([<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">4</span>])\ndataset <span class=\"pl-k\">=</span> dataset.shuffle(<span class=\"pl-c1\">10</span>)\ndataset <span class=\"pl-k\">=</span> dataset.map(<span class=\"pl-k\">lambda</span> <span class=\"pl-smi\">a</span>: ([[[a]]], a))\ndataset <span class=\"pl-k\">=</span> dataset.repeat(<span class=\"pl-c1\">3</span>)\ndataset <span class=\"pl-k\">=</span> dataset.padded_batch(<span class=\"pl-c1\">2</span>, <span class=\"pl-v\">padded_shapes</span><span class=\"pl-k\">=</span>([<span class=\"pl-c1\">None</span>, <span class=\"pl-c1\">None</span>, <span class=\"pl-c1\">None</span>], []))</pre></div>\n<p>The most likely cause is that your <code>data.instance_as_tensor()</code> function does not return a pair of tensors as expected.</p>", "body_text": "Without the code of your data.instance_as_tensor() function it is difficult to say, but I think the bug might be in that function.\nFor example, the following trivial code combines Dataset.map() and Dataset.padded_batch() without error:\ndataset = tf.data.Dataset.from_tensor_slices([1, 2, 3, 4])\ndataset = dataset.shuffle(10)\ndataset = dataset.map(lambda a: ([[[a]]], a))\ndataset = dataset.repeat(3)\ndataset = dataset.padded_batch(2, padded_shapes=([None, None, None], []))\nThe most likely cause is that your data.instance_as_tensor() function does not return a pair of tensors as expected.", "body": "Without the code of your `data.instance_as_tensor()` function it is difficult to say, but I think the bug might be in that function.\r\n\r\nFor example, the following trivial code combines `Dataset.map()` and `Dataset.padded_batch()` without error:\r\n\r\n```python\r\ndataset = tf.data.Dataset.from_tensor_slices([1, 2, 3, 4])\r\ndataset = dataset.shuffle(10)\r\ndataset = dataset.map(lambda a: ([[[a]]], a))\r\ndataset = dataset.repeat(3)\r\ndataset = dataset.padded_batch(2, padded_shapes=([None, None, None], []))\r\n```\r\n\r\nThe most likely cause is that your `data.instance_as_tensor()` function does not return a pair of tensors as expected."}