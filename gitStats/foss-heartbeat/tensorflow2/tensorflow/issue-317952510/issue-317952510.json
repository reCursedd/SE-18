{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18894", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18894/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18894/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18894/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/18894", "id": 317952510, "node_id": "MDU6SXNzdWUzMTc5NTI1MTA=", "number": 18894, "title": "TfLite Image classification score is not consistent it keeps increasing for same image untill it reaches to some saturation(actual score)", "user": {"login": "princekumar15", "id": 16951935, "node_id": "MDQ6VXNlcjE2OTUxOTM1", "avatar_url": "https://avatars2.githubusercontent.com/u/16951935?v=4", "gravatar_id": "", "url": "https://api.github.com/users/princekumar15", "html_url": "https://github.com/princekumar15", "followers_url": "https://api.github.com/users/princekumar15/followers", "following_url": "https://api.github.com/users/princekumar15/following{/other_user}", "gists_url": "https://api.github.com/users/princekumar15/gists{/gist_id}", "starred_url": "https://api.github.com/users/princekumar15/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/princekumar15/subscriptions", "organizations_url": "https://api.github.com/users/princekumar15/orgs", "repos_url": "https://api.github.com/users/princekumar15/repos", "events_url": "https://api.github.com/users/princekumar15/events{/privacy}", "received_events_url": "https://api.github.com/users/princekumar15/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 750616506, "node_id": "MDU6TGFiZWw3NTA2MTY1MDY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:lite", "name": "comp:lite", "color": "0052cc", "default": false}, {"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "aselle", "id": 326106, "node_id": "MDQ6VXNlcjMyNjEwNg==", "avatar_url": "https://avatars1.githubusercontent.com/u/326106?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aselle", "html_url": "https://github.com/aselle", "followers_url": "https://api.github.com/users/aselle/followers", "following_url": "https://api.github.com/users/aselle/following{/other_user}", "gists_url": "https://api.github.com/users/aselle/gists{/gist_id}", "starred_url": "https://api.github.com/users/aselle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aselle/subscriptions", "organizations_url": "https://api.github.com/users/aselle/orgs", "repos_url": "https://api.github.com/users/aselle/repos", "events_url": "https://api.github.com/users/aselle/events{/privacy}", "received_events_url": "https://api.github.com/users/aselle/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "aselle", "id": 326106, "node_id": "MDQ6VXNlcjMyNjEwNg==", "avatar_url": "https://avatars1.githubusercontent.com/u/326106?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aselle", "html_url": "https://github.com/aselle", "followers_url": "https://api.github.com/users/aselle/followers", "following_url": "https://api.github.com/users/aselle/following{/other_user}", "gists_url": "https://api.github.com/users/aselle/gists{/gist_id}", "starred_url": "https://api.github.com/users/aselle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aselle/subscriptions", "organizations_url": "https://api.github.com/users/aselle/orgs", "repos_url": "https://api.github.com/users/aselle/repos", "events_url": "https://api.github.com/users/aselle/events{/privacy}", "received_events_url": "https://api.github.com/users/aselle/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2018-04-26T09:42:24Z", "updated_at": "2018-08-06T21:51:30Z", "closed_at": "2018-08-06T21:15:33Z", "author_association": "NONE", "body_html": "<p>With same instance of 'interpreter' score is getting increased for same image until it reaches at some saturation.<br>\n<code>Interpreter tflite = new Interpreter(loadModelFile(context));</code></p>\n<p>Create Instance for ImageClassifier and use the same instance to classify Frame and run inference for the same image.</p>\n<pre><code>ImageClassifier(Activity activity) throws IOException {\n    tflite = new Interpreter(loadModelFile(activity));\n    labelList = loadLabelList(activity);\n    imgData =\n        ByteBuffer.allocateDirect(\n            DIM_BATCH_SIZE\n                * getImageSizeX()\n                * getImageSizeY()\n                * DIM_PIXEL_SIZE\n                * getNumBytesPerChannel());\n    imgData.order(ByteOrder.nativeOrder());\n    filterLabelProbArray = new float[FILTER_STAGES][getNumLabels()];\n    Log.d(TAG, \"Created a Tensorflow Lite Image Classifier.\");\n  }\n</code></pre>\n<p>Classifies a frame for the same image. Same image can be picked up from the Sd card.</p>\n<pre><code>private void classifyImage() {\n    if (classifier == null || getActivity() == null || cameraDevice == null) {\n      showToast(\"Uninitialized Classifier or invalid context.\");\n      return;\n    }\n    String imgPath =  \"/storage/emulated/0/DCIM/test.jpg\";\n    Log.d(\"Image Path is %s\", imgPath);\n    Bitmap bitmap = BitmapFactory.decodeFile(imgPath);\n    Bitmap newbitmap = Bitmap.createScaledBitmap(bitmap, 299, 299, false);\n    String textToShow = classifier.classifyFrame(newbitmap);\n    bitmap.recycle();\n    showToast(textToShow);\n  }\n</code></pre>\n<p>At the first time when application gets launched score the image classification is 0.06 and then again if we called classifyImage() on some event click score gets increased to 0.13 and with same process it keeps increasing until it reached to 0.86(saturation).</p>\n<p>I am not sure why its happening but it happened for both type of TfLite models inceptionV3 and MobileNet.</p>", "body_text": "With same instance of 'interpreter' score is getting increased for same image until it reaches at some saturation.\nInterpreter tflite = new Interpreter(loadModelFile(context));\nCreate Instance for ImageClassifier and use the same instance to classify Frame and run inference for the same image.\nImageClassifier(Activity activity) throws IOException {\n    tflite = new Interpreter(loadModelFile(activity));\n    labelList = loadLabelList(activity);\n    imgData =\n        ByteBuffer.allocateDirect(\n            DIM_BATCH_SIZE\n                * getImageSizeX()\n                * getImageSizeY()\n                * DIM_PIXEL_SIZE\n                * getNumBytesPerChannel());\n    imgData.order(ByteOrder.nativeOrder());\n    filterLabelProbArray = new float[FILTER_STAGES][getNumLabels()];\n    Log.d(TAG, \"Created a Tensorflow Lite Image Classifier.\");\n  }\n\nClassifies a frame for the same image. Same image can be picked up from the Sd card.\nprivate void classifyImage() {\n    if (classifier == null || getActivity() == null || cameraDevice == null) {\n      showToast(\"Uninitialized Classifier or invalid context.\");\n      return;\n    }\n    String imgPath =  \"/storage/emulated/0/DCIM/test.jpg\";\n    Log.d(\"Image Path is %s\", imgPath);\n    Bitmap bitmap = BitmapFactory.decodeFile(imgPath);\n    Bitmap newbitmap = Bitmap.createScaledBitmap(bitmap, 299, 299, false);\n    String textToShow = classifier.classifyFrame(newbitmap);\n    bitmap.recycle();\n    showToast(textToShow);\n  }\n\nAt the first time when application gets launched score the image classification is 0.06 and then again if we called classifyImage() on some event click score gets increased to 0.13 and with same process it keeps increasing until it reached to 0.86(saturation).\nI am not sure why its happening but it happened for both type of TfLite models inceptionV3 and MobileNet.", "body": "With same instance of 'interpreter' score is getting increased for same image until it reaches at some saturation.\r\n`Interpreter tflite = new Interpreter(loadModelFile(context));`\r\n\r\nCreate Instance for ImageClassifier and use the same instance to classify Frame and run inference for the same image.\r\n```\r\nImageClassifier(Activity activity) throws IOException {\r\n    tflite = new Interpreter(loadModelFile(activity));\r\n    labelList = loadLabelList(activity);\r\n    imgData =\r\n        ByteBuffer.allocateDirect(\r\n            DIM_BATCH_SIZE\r\n                * getImageSizeX()\r\n                * getImageSizeY()\r\n                * DIM_PIXEL_SIZE\r\n                * getNumBytesPerChannel());\r\n    imgData.order(ByteOrder.nativeOrder());\r\n    filterLabelProbArray = new float[FILTER_STAGES][getNumLabels()];\r\n    Log.d(TAG, \"Created a Tensorflow Lite Image Classifier.\");\r\n  }\r\n```\r\n\r\nClassifies a frame for the same image. Same image can be picked up from the Sd card.\r\n\r\n```\r\nprivate void classifyImage() {\r\n    if (classifier == null || getActivity() == null || cameraDevice == null) {\r\n      showToast(\"Uninitialized Classifier or invalid context.\");\r\n      return;\r\n    }\r\n    String imgPath =  \"/storage/emulated/0/DCIM/test.jpg\";\r\n    Log.d(\"Image Path is %s\", imgPath);\r\n    Bitmap bitmap = BitmapFactory.decodeFile(imgPath);\r\n    Bitmap newbitmap = Bitmap.createScaledBitmap(bitmap, 299, 299, false);\r\n    String textToShow = classifier.classifyFrame(newbitmap);\r\n    bitmap.recycle();\r\n    showToast(textToShow);\r\n  }\r\n```\r\n\r\nAt the first time when application gets launched score the image classification is 0.06 and then again if we called classifyImage() on some event click score gets increased to 0.13 and with same process it keeps increasing until it reached to 0.86(saturation).\r\n\r\nI am not sure why its happening but it happened for both type of TfLite models inceptionV3 and MobileNet."}