{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/356538134", "html_url": "https://github.com/tensorflow/tensorflow/issues/15897#issuecomment-356538134", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15897", "id": 356538134, "node_id": "MDEyOklzc3VlQ29tbWVudDM1NjUzODEzNA==", "user": {"login": "egborbe", "id": 28956112, "node_id": "MDQ6VXNlcjI4OTU2MTEy", "avatar_url": "https://avatars1.githubusercontent.com/u/28956112?v=4", "gravatar_id": "", "url": "https://api.github.com/users/egborbe", "html_url": "https://github.com/egborbe", "followers_url": "https://api.github.com/users/egborbe/followers", "following_url": "https://api.github.com/users/egborbe/following{/other_user}", "gists_url": "https://api.github.com/users/egborbe/gists{/gist_id}", "starred_url": "https://api.github.com/users/egborbe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/egborbe/subscriptions", "organizations_url": "https://api.github.com/users/egborbe/orgs", "repos_url": "https://api.github.com/users/egborbe/repos", "events_url": "https://api.github.com/users/egborbe/events{/privacy}", "received_events_url": "https://api.github.com/users/egborbe/received_events", "type": "User", "site_admin": false}, "created_at": "2018-01-10T08:47:11Z", "updated_at": "2018-01-10T08:47:11Z", "author_association": "NONE", "body_html": "<p>this is the nvprof output<br>\nType  Time(%)      Time     Calls       Avg       Min       Max  Name<br>\nGPU activities:   34.28%  797.43ms       301  2.6493ms  2.6269ms  2.6636ms  volta_fp16_s884cudnn_fp16_256x64_ldg8_relu_f2f_exp_small_nhwc2nchw_tn_v1<br>\n30.73%  714.84ms       301  2.3749ms  2.3708ms  2.3818ms  volta_fp16_s884cudnn_fp16_128x128_ldg8_relu_f2f_exp_small_nhwc2nchw_tn_v1<br>\n21.63%  503.23ms      1204  417.96us  3.0400us  1.2488ms  void nchwToNhwcKernel&lt;__half, __half, float, bool=1&gt;(int, int, int, int, __half const <em>, __half</em>, float, float)</p>\n<p>and this is the code I used<br>\nimport tensorflow as tf<br>\nimport time</p>\n<p>df='NCHW'<br>\ndef net(dt, filt):<br>\na=tf.random_uniform((16,1,256,256), dtype=dt)<br>\nf=tf.random_uniform((filt,filt,1,64), dtype=dt)<br>\na=tf.nn.conv2d(a,f,[1,1,1,1],'SAME',data_format=df)<br>\nf=tf.random_uniform((filt,filt,64,128), dtype=dt)<br>\nf2=tf.random_uniform((filt,filt,128,64), dtype=dt)<br>\nfor i in range(100):<br>\na=tf.nn.conv2d(a,f,[1,1,1,1],padding='SAME',data_format=df)<br>\na=tf.nn.conv2d(a,f2,[1,1,1,1],padding='SAME',data_format=df)<br>\na=tf.reduce_sum(a)<br>\nreturn a<br>\nf16=net(tf.float16,3)</p>\n<p>s=tf.Session()<br>\ns.run(tf.global_variables_initializer())<br>\n#input(\"press key\")<br>\nfor i in range(3):<br>\ns1=time.time()<br>\nx=s.run(f16)<br>\ne1=time.time()<br>\nprint(\"FP16\",(e1-s1)*1000)</p>", "body_text": "this is the nvprof output\nType  Time(%)      Time     Calls       Avg       Min       Max  Name\nGPU activities:   34.28%  797.43ms       301  2.6493ms  2.6269ms  2.6636ms  volta_fp16_s884cudnn_fp16_256x64_ldg8_relu_f2f_exp_small_nhwc2nchw_tn_v1\n30.73%  714.84ms       301  2.3749ms  2.3708ms  2.3818ms  volta_fp16_s884cudnn_fp16_128x128_ldg8_relu_f2f_exp_small_nhwc2nchw_tn_v1\n21.63%  503.23ms      1204  417.96us  3.0400us  1.2488ms  void nchwToNhwcKernel<__half, __half, float, bool=1>(int, int, int, int, __half const , __half, float, float)\nand this is the code I used\nimport tensorflow as tf\nimport time\ndf='NCHW'\ndef net(dt, filt):\na=tf.random_uniform((16,1,256,256), dtype=dt)\nf=tf.random_uniform((filt,filt,1,64), dtype=dt)\na=tf.nn.conv2d(a,f,[1,1,1,1],'SAME',data_format=df)\nf=tf.random_uniform((filt,filt,64,128), dtype=dt)\nf2=tf.random_uniform((filt,filt,128,64), dtype=dt)\nfor i in range(100):\na=tf.nn.conv2d(a,f,[1,1,1,1],padding='SAME',data_format=df)\na=tf.nn.conv2d(a,f2,[1,1,1,1],padding='SAME',data_format=df)\na=tf.reduce_sum(a)\nreturn a\nf16=net(tf.float16,3)\ns=tf.Session()\ns.run(tf.global_variables_initializer())\n#input(\"press key\")\nfor i in range(3):\ns1=time.time()\nx=s.run(f16)\ne1=time.time()\nprint(\"FP16\",(e1-s1)*1000)", "body": "this is the nvprof output\r\n            Type  Time(%)      Time     Calls       Avg       Min       Max  Name\r\n GPU activities:   34.28%  797.43ms       301  2.6493ms  2.6269ms  2.6636ms  volta_fp16_s884cudnn_fp16_256x64_ldg8_relu_f2f_exp_small_nhwc2nchw_tn_v1\r\n                   30.73%  714.84ms       301  2.3749ms  2.3708ms  2.3818ms  volta_fp16_s884cudnn_fp16_128x128_ldg8_relu_f2f_exp_small_nhwc2nchw_tn_v1\r\n                   21.63%  503.23ms      1204  417.96us  3.0400us  1.2488ms  void nchwToNhwcKernel<__half, __half, float, bool=1>(int, int, int, int, __half const *, __half*, float, float)\r\n \r\n\r\nand this is the code I used\r\nimport tensorflow as tf\r\nimport time\r\n\r\ndf='NCHW'\r\ndef net(dt, filt):\r\n    a=tf.random_uniform((16,1,256,256), dtype=dt)\r\n    f=tf.random_uniform((filt,filt,1,64), dtype=dt)\r\n    a=tf.nn.conv2d(a,f,[1,1,1,1],'SAME',data_format=df)\r\n    f=tf.random_uniform((filt,filt,64,128), dtype=dt)\r\n    f2=tf.random_uniform((filt,filt,128,64), dtype=dt)\r\n    for i in range(100):\r\n        a=tf.nn.conv2d(a,f,[1,1,1,1],padding='SAME',data_format=df)\r\n        a=tf.nn.conv2d(a,f2,[1,1,1,1],padding='SAME',data_format=df)\r\n    a=tf.reduce_sum(a)\r\n    return a\r\nf16=net(tf.float16,3)\r\n\r\ns=tf.Session()\r\ns.run(tf.global_variables_initializer())\r\n#input(\"press key\")\r\nfor i in range(3):\r\n    s1=time.time()\r\n    x=s.run(f16)\r\n    e1=time.time()\r\n    print(\"FP16\",(e1-s1)*1000)\r\n"}