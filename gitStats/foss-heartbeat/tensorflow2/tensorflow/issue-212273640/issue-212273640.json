{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8141", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8141/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8141/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8141/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/8141", "id": 212273640, "node_id": "MDU6SXNzdWUyMTIyNzM2NDA=", "number": 8141, "title": "Error Compiling with XLA", "user": {"login": "lwogulis", "id": 13294147, "node_id": "MDQ6VXNlcjEzMjk0MTQ3", "avatar_url": "https://avatars0.githubusercontent.com/u/13294147?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lwogulis", "html_url": "https://github.com/lwogulis", "followers_url": "https://api.github.com/users/lwogulis/followers", "following_url": "https://api.github.com/users/lwogulis/following{/other_user}", "gists_url": "https://api.github.com/users/lwogulis/gists{/gist_id}", "starred_url": "https://api.github.com/users/lwogulis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lwogulis/subscriptions", "organizations_url": "https://api.github.com/users/lwogulis/orgs", "repos_url": "https://api.github.com/users/lwogulis/repos", "events_url": "https://api.github.com/users/lwogulis/events{/privacy}", "received_events_url": "https://api.github.com/users/lwogulis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-03-06T22:43:31Z", "updated_at": "2017-03-10T21:24:41Z", "closed_at": "2017-03-10T21:24:41Z", "author_association": "NONE", "body_html": "<p>I'm attempting to build Tensorflow from source with XLA, and am not able to run my test code. My test code:</p>\n<pre><code>def main(_):\n    config = tf.ConfigProto(log_device_placement=True)\n    jit_level = 0 \n    if FLAGS.xla:\n        # Turns on XLA JIT compilation.\n        jit_level = tf.OptimizerOptions.ON_1\n\n    config.graph_options.optimizer_options.global_jit_level = jit_level\n    # Creates a session with log_device_placement set to True.\n    with tf.Session(config=config) as sess:\n        # Creates a graph.\n        with tf.device('/job:localhost/replica:0/task:0/device:XLA_CPU:0'):\n            a = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[2, 3], name='a')\n            b = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[3, 2], name='b')\n            c = tf.matmul(a, b)\n\n        # Runs the op.\n        print(sess.run(c))\n</code></pre>\n<p>The error I get:</p>\n<pre><code>$ TF_XLA_FLAGS=--xla_generate_hlo_graph=.* python xla_test.py\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE3 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX2 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use FMA instructions, but these are available on your machine and could speed up CPU computations.\nDevice mapping: no known devices.\nI tensorflow/core/common_runtime/direct_session.cc:257] Device mapping:\n\nTraceback (most recent call last):\n  File \"xla_test.py\", line 49, in &lt;module&gt;\n    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 44, in run\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\n  File \"xla_test.py\", line 37, in main\n    run_metadata=run_metadata))\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 767, in run\n    run_metadata_ptr)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 965, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1015, in _do_run\n    target_list, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1035, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Cannot assign a device to node 'MatMul': Could not satisfy explicit device specification '/job:localhost/replica:0/task:0/device:XLA_CPU:0' because no devices matching that specification are registered in this process; available devices: /job:localhost/replica:0/task:0/cpu:0\n\t [[Node: MatMul = MatMul[T=DT_FLOAT, transpose_a=false, transpose_b=false, _device=\"/job:localhost/replica:0/task:0/device:XLA_CPU:0\"](a, b)]]\n\nCaused by op u'MatMul', defined at:\n  File \"xla_test.py\", line 49, in &lt;module&gt;\n    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 44, in run\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\n  File \"xla_test.py\", line 33, in main\n    c = tf.matmul(a, b)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/math_ops.py\", line 1855, in matmul\n    a, b, transpose_a=transpose_a, transpose_b=transpose_b, name=name)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_math_ops.py\", line 1454, in _mat_mul\n    transpose_b=transpose_b, name=name)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2395, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\n    self._traceback = _extract_stack()\n\nInvalidArgumentError (see above for traceback): Cannot assign a device to node 'MatMul': Could not satisfy explicit device specification '/job:localhost/replica:0/task:0/device:XLA_CPU:0' because no devices matching that specification are registered in this process; available devices: /job:localhost/replica:0/task:0/cpu:0\n\t [[Node: MatMul = MatMul[T=DT_FLOAT, transpose_a=false, transpose_b=false, _device=\"/job:localhost/replica:0/task:0/device:XLA_CPU:0\"](a, b)]]\n\n</code></pre>\n<p>Building with:</p>\n<pre><code>PYTHON_BIN_PATH=/usr/bin/python3 TF_NEED_GCP=0 TF_NEED_HDFS=0 PYTHON_LIB_PATH=/usr/lib/python3/dist-packages TF_NEED_OPENCL=0 TF_NEED_CUDA=0 TF_ENABLE_XLA=1 TF_NEED_JEMALLOC=1 CC_OPT_FLAGS=\"-march=native\" ./configure &amp;&amp; \\\nbazel build --config=opt //tensorflow/tools/pip_package:build_pip_package &amp;&amp; \\\nbazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg &amp;&amp; \\\nsudo pip3 install --upgrade /tmp/tensorflow_pkg/tensorflow-1.0.0*.whl\n</code></pre>\n<p>I am working on the master branch</p>\n<pre><code>$ git log | head -1\ncommit e6f547e4645f4922c50abb7d0506b1f9a6bd81c7\n$ git branch\n* master\n</code></pre>\n<p>I've posted on stackoverflow: <a href=\"http://stackoverflow.com/questions/42541323/error-running-tensorflow-with-xla\" rel=\"nofollow\">http://stackoverflow.com/questions/42541323/error-running-tensorflow-with-xla</a></p>", "body_text": "I'm attempting to build Tensorflow from source with XLA, and am not able to run my test code. My test code:\ndef main(_):\n    config = tf.ConfigProto(log_device_placement=True)\n    jit_level = 0 \n    if FLAGS.xla:\n        # Turns on XLA JIT compilation.\n        jit_level = tf.OptimizerOptions.ON_1\n\n    config.graph_options.optimizer_options.global_jit_level = jit_level\n    # Creates a session with log_device_placement set to True.\n    with tf.Session(config=config) as sess:\n        # Creates a graph.\n        with tf.device('/job:localhost/replica:0/task:0/device:XLA_CPU:0'):\n            a = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[2, 3], name='a')\n            b = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[3, 2], name='b')\n            c = tf.matmul(a, b)\n\n        # Runs the op.\n        print(sess.run(c))\n\nThe error I get:\n$ TF_XLA_FLAGS=--xla_generate_hlo_graph=.* python xla_test.py\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE3 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX2 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use FMA instructions, but these are available on your machine and could speed up CPU computations.\nDevice mapping: no known devices.\nI tensorflow/core/common_runtime/direct_session.cc:257] Device mapping:\n\nTraceback (most recent call last):\n  File \"xla_test.py\", line 49, in <module>\n    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 44, in run\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\n  File \"xla_test.py\", line 37, in main\n    run_metadata=run_metadata))\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 767, in run\n    run_metadata_ptr)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 965, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1015, in _do_run\n    target_list, options, run_metadata)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1035, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Cannot assign a device to node 'MatMul': Could not satisfy explicit device specification '/job:localhost/replica:0/task:0/device:XLA_CPU:0' because no devices matching that specification are registered in this process; available devices: /job:localhost/replica:0/task:0/cpu:0\n\t [[Node: MatMul = MatMul[T=DT_FLOAT, transpose_a=false, transpose_b=false, _device=\"/job:localhost/replica:0/task:0/device:XLA_CPU:0\"](a, b)]]\n\nCaused by op u'MatMul', defined at:\n  File \"xla_test.py\", line 49, in <module>\n    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 44, in run\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\n  File \"xla_test.py\", line 33, in main\n    c = tf.matmul(a, b)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/math_ops.py\", line 1855, in matmul\n    a, b, transpose_a=transpose_a, transpose_b=transpose_b, name=name)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_math_ops.py\", line 1454, in _mat_mul\n    transpose_b=transpose_b, name=name)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2395, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\n    self._traceback = _extract_stack()\n\nInvalidArgumentError (see above for traceback): Cannot assign a device to node 'MatMul': Could not satisfy explicit device specification '/job:localhost/replica:0/task:0/device:XLA_CPU:0' because no devices matching that specification are registered in this process; available devices: /job:localhost/replica:0/task:0/cpu:0\n\t [[Node: MatMul = MatMul[T=DT_FLOAT, transpose_a=false, transpose_b=false, _device=\"/job:localhost/replica:0/task:0/device:XLA_CPU:0\"](a, b)]]\n\n\nBuilding with:\nPYTHON_BIN_PATH=/usr/bin/python3 TF_NEED_GCP=0 TF_NEED_HDFS=0 PYTHON_LIB_PATH=/usr/lib/python3/dist-packages TF_NEED_OPENCL=0 TF_NEED_CUDA=0 TF_ENABLE_XLA=1 TF_NEED_JEMALLOC=1 CC_OPT_FLAGS=\"-march=native\" ./configure && \\\nbazel build --config=opt //tensorflow/tools/pip_package:build_pip_package && \\\nbazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg && \\\nsudo pip3 install --upgrade /tmp/tensorflow_pkg/tensorflow-1.0.0*.whl\n\nI am working on the master branch\n$ git log | head -1\ncommit e6f547e4645f4922c50abb7d0506b1f9a6bd81c7\n$ git branch\n* master\n\nI've posted on stackoverflow: http://stackoverflow.com/questions/42541323/error-running-tensorflow-with-xla", "body": "I'm attempting to build Tensorflow from source with XLA, and am not able to run my test code. My test code: \r\n```\r\ndef main(_):\r\n    config = tf.ConfigProto(log_device_placement=True)\r\n    jit_level = 0 \r\n    if FLAGS.xla:\r\n        # Turns on XLA JIT compilation.\r\n        jit_level = tf.OptimizerOptions.ON_1\r\n\r\n    config.graph_options.optimizer_options.global_jit_level = jit_level\r\n    # Creates a session with log_device_placement set to True.\r\n    with tf.Session(config=config) as sess:\r\n        # Creates a graph.\r\n        with tf.device('/job:localhost/replica:0/task:0/device:XLA_CPU:0'):\r\n            a = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[2, 3], name='a')\r\n            b = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[3, 2], name='b')\r\n            c = tf.matmul(a, b)\r\n\r\n        # Runs the op.\r\n        print(sess.run(c))\r\n```\r\nThe error I get:\r\n```\r\n$ TF_XLA_FLAGS=--xla_generate_hlo_graph=.* python xla_test.py\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE3 instructions, but these are available on your machine and could speed up CPU computations.\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX2 instructions, but these are available on your machine and could speed up CPU computations.\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use FMA instructions, but these are available on your machine and could speed up CPU computations.\r\nDevice mapping: no known devices.\r\nI tensorflow/core/common_runtime/direct_session.cc:257] Device mapping:\r\n\r\nTraceback (most recent call last):\r\n  File \"xla_test.py\", line 49, in <module>\r\n    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 44, in run\r\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\r\n  File \"xla_test.py\", line 37, in main\r\n    run_metadata=run_metadata))\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 767, in run\r\n    run_metadata_ptr)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 965, in _run\r\n    feed_dict_string, options, run_metadata)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1015, in _do_run\r\n    target_list, options, run_metadata)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1035, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Cannot assign a device to node 'MatMul': Could not satisfy explicit device specification '/job:localhost/replica:0/task:0/device:XLA_CPU:0' because no devices matching that specification are registered in this process; available devices: /job:localhost/replica:0/task:0/cpu:0\r\n\t [[Node: MatMul = MatMul[T=DT_FLOAT, transpose_a=false, transpose_b=false, _device=\"/job:localhost/replica:0/task:0/device:XLA_CPU:0\"](a, b)]]\r\n\r\nCaused by op u'MatMul', defined at:\r\n  File \"xla_test.py\", line 49, in <module>\r\n    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/platform/app.py\", line 44, in run\r\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\r\n  File \"xla_test.py\", line 33, in main\r\n    c = tf.matmul(a, b)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/math_ops.py\", line 1855, in matmul\r\n    a, b, transpose_a=transpose_a, transpose_b=transpose_b, name=name)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_math_ops.py\", line 1454, in _mat_mul\r\n    transpose_b=transpose_b, name=name)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\r\n    op_def=op_def)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2395, in create_op\r\n    original_op=self._default_original_op, op_def=op_def)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\r\n    self._traceback = _extract_stack()\r\n\r\nInvalidArgumentError (see above for traceback): Cannot assign a device to node 'MatMul': Could not satisfy explicit device specification '/job:localhost/replica:0/task:0/device:XLA_CPU:0' because no devices matching that specification are registered in this process; available devices: /job:localhost/replica:0/task:0/cpu:0\r\n\t [[Node: MatMul = MatMul[T=DT_FLOAT, transpose_a=false, transpose_b=false, _device=\"/job:localhost/replica:0/task:0/device:XLA_CPU:0\"](a, b)]]\r\n\r\n```\r\n\r\nBuilding with:\r\n```\r\nPYTHON_BIN_PATH=/usr/bin/python3 TF_NEED_GCP=0 TF_NEED_HDFS=0 PYTHON_LIB_PATH=/usr/lib/python3/dist-packages TF_NEED_OPENCL=0 TF_NEED_CUDA=0 TF_ENABLE_XLA=1 TF_NEED_JEMALLOC=1 CC_OPT_FLAGS=\"-march=native\" ./configure && \\\r\nbazel build --config=opt //tensorflow/tools/pip_package:build_pip_package && \\\r\nbazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg && \\\r\nsudo pip3 install --upgrade /tmp/tensorflow_pkg/tensorflow-1.0.0*.whl\r\n```\r\n\r\nI am working on the master branch\r\n```\r\n$ git log | head -1\r\ncommit e6f547e4645f4922c50abb7d0506b1f9a6bd81c7\r\n$ git branch\r\n* master\r\n```\r\n\r\nI've posted on stackoverflow: http://stackoverflow.com/questions/42541323/error-running-tensorflow-with-xla"}