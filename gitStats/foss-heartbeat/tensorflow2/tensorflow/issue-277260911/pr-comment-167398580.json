{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/167398580", "pull_request_review_id": 95621898, "id": 167398580, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2NzM5ODU4MA==", "diff_hunk": "@@ -373,22 +374,23 @@ seed2: An second seed to avoid seed collision.\n REGISTER_OP(\"ComputeAccidentalHits\")\n     .Input(\"true_classes: int64\")\n     .Input(\"sampled_candidates: int64\")\n+    .Input(\"num_true: int32\")\n     .Output(\"indices: int32\")\n     .Output(\"ids: int64\")\n     .Output(\"weights: float\")\n-    .Attr(\"num_true: int\")\n     .Attr(\"seed: int = 0\")\n     .Attr(\"seed2: int = 0\")\n     .SetShapeFn([](InferenceContext* c) {\n-      int64 num_true;", "path": "tensorflow/core/ops/candidate_sampling_ops.cc", "position": 197, "original_position": 197, "commit_id": "2b8be38ac4a57699904dc501fe7270c2b58177b6", "original_commit_id": "7ae527af3b23681496a2f265e936821a98f8da23", "user": {"login": "MtDersvan", "id": 7069222, "node_id": "MDQ6VXNlcjcwNjkyMjI=", "avatar_url": "https://avatars3.githubusercontent.com/u/7069222?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MtDersvan", "html_url": "https://github.com/MtDersvan", "followers_url": "https://api.github.com/users/MtDersvan/followers", "following_url": "https://api.github.com/users/MtDersvan/following{/other_user}", "gists_url": "https://api.github.com/users/MtDersvan/gists{/gist_id}", "starred_url": "https://api.github.com/users/MtDersvan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MtDersvan/subscriptions", "organizations_url": "https://api.github.com/users/MtDersvan/orgs", "repos_url": "https://api.github.com/users/MtDersvan/repos", "events_url": "https://api.github.com/users/MtDersvan/events{/privacy}", "received_events_url": "https://api.github.com/users/MtDersvan/received_events", "type": "User", "site_admin": false}, "body": "btw, I tried to add `HostMemory`:\r\n~~~c++\r\nREGISTER_KERNEL_BUILDER(\r\n    Name(\"ComputeAccidentalHits\")\r\n    .Device(DEVICE_CPU)\r\n    .HostMemory(\"num_true\"),\r\n    ComputeAccidentalHitsOp);\r\n~~~\r\nBut I am still getting `Segmentation fault (core dumped)`, any time I try to access tensor data via `c->input_tensor(2);` \r\nI think this is the main blocker.\r\n\r\nAlso, I think there needs to be an additional handling case a side from `WithValue` when `num_true` is undefined or a placeholder.", "created_at": "2018-02-10T13:04:09Z", "updated_at": "2018-02-10T13:04:09Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/14928#discussion_r167398580", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/14928", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/167398580"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/14928#discussion_r167398580"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/14928"}}, "body_html": "<p>btw, I tried to add <code>HostMemory</code>:</p>\n<div class=\"highlight highlight-source-c++\"><pre><span class=\"pl-en\">REGISTER_KERNEL_BUILDER</span>(\n    <span class=\"pl-en\">Name</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ComputeAccidentalHits<span class=\"pl-pds\">\"</span></span>)\n    .Device(DEVICE_CPU)\n    .HostMemory(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>num_true<span class=\"pl-pds\">\"</span></span>),\n    ComputeAccidentalHitsOp);</pre></div>\n<p>But I am still getting <code>Segmentation fault (core dumped)</code>, any time I try to access tensor data via <code>c-&gt;input_tensor(2);</code><br>\nI think this is the main blocker.</p>\n<p>Also, I think there needs to be an additional handling case a side from <code>WithValue</code> when <code>num_true</code> is undefined or a placeholder.</p>", "body_text": "btw, I tried to add HostMemory:\nREGISTER_KERNEL_BUILDER(\n    Name(\"ComputeAccidentalHits\")\n    .Device(DEVICE_CPU)\n    .HostMemory(\"num_true\"),\n    ComputeAccidentalHitsOp);\nBut I am still getting Segmentation fault (core dumped), any time I try to access tensor data via c->input_tensor(2);\nI think this is the main blocker.\nAlso, I think there needs to be an additional handling case a side from WithValue when num_true is undefined or a placeholder.", "in_reply_to_id": 154553724}