{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/337083514", "html_url": "https://github.com/tensorflow/tensorflow/issues/13764#issuecomment-337083514", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13764", "id": 337083514, "node_id": "MDEyOklzc3VlQ29tbWVudDMzNzA4MzUxNA==", "user": {"login": "vishvananda", "id": 142222, "node_id": "MDQ6VXNlcjE0MjIyMg==", "avatar_url": "https://avatars2.githubusercontent.com/u/142222?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vishvananda", "html_url": "https://github.com/vishvananda", "followers_url": "https://api.github.com/users/vishvananda/followers", "following_url": "https://api.github.com/users/vishvananda/following{/other_user}", "gists_url": "https://api.github.com/users/vishvananda/gists{/gist_id}", "starred_url": "https://api.github.com/users/vishvananda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vishvananda/subscriptions", "organizations_url": "https://api.github.com/users/vishvananda/orgs", "repos_url": "https://api.github.com/users/vishvananda/repos", "events_url": "https://api.github.com/users/vishvananda/events{/privacy}", "received_events_url": "https://api.github.com/users/vishvananda/received_events", "type": "User", "site_admin": false}, "created_at": "2017-10-17T00:40:19Z", "updated_at": "2017-10-17T00:43:14Z", "author_association": "CONTRIBUTOR", "body_html": "<p>It looks like this is due to the fact that TF_TensorData returns nil if no data is allocated. Assuming this is correct behavior and nil needs to be checked for on the go side then the following patch fixes the problem:</p>\n<pre><code>diff --git a/tensorflow/go/tensor.go b/tensorflow/go/tensor.go\nindex e8fa21a..6cbf759 100644\n--- a/tensorflow/go/tensor.go\n+++ b/tensorflow/go/tensor.go\n@@ -205,6 +205,9 @@ func (t *Tensor) WriteContentsTo(w io.Writer) (int64, error) {\n func tensorData(c *C.TF_Tensor) []byte {\n        // See: https://github.com/golang/go/wiki/cgo#turning-c-arrays-into-go-slices\n        cbytes := C.TF_TensorData(c)\n+       if cbytes == nil {\n+               return nil\n+       }\n        length := int(C.TF_TensorByteSize(c))\n        slice := (*[1 &lt;&lt; 30]byte)(unsafe.Pointer(cbytes))[:length:length]\n        return slice\n</code></pre>", "body_text": "It looks like this is due to the fact that TF_TensorData returns nil if no data is allocated. Assuming this is correct behavior and nil needs to be checked for on the go side then the following patch fixes the problem:\ndiff --git a/tensorflow/go/tensor.go b/tensorflow/go/tensor.go\nindex e8fa21a..6cbf759 100644\n--- a/tensorflow/go/tensor.go\n+++ b/tensorflow/go/tensor.go\n@@ -205,6 +205,9 @@ func (t *Tensor) WriteContentsTo(w io.Writer) (int64, error) {\n func tensorData(c *C.TF_Tensor) []byte {\n        // See: https://github.com/golang/go/wiki/cgo#turning-c-arrays-into-go-slices\n        cbytes := C.TF_TensorData(c)\n+       if cbytes == nil {\n+               return nil\n+       }\n        length := int(C.TF_TensorByteSize(c))\n        slice := (*[1 << 30]byte)(unsafe.Pointer(cbytes))[:length:length]\n        return slice", "body": "It looks like this is due to the fact that TF_TensorData returns nil if no data is allocated. Assuming this is correct behavior and nil needs to be checked for on the go side then the following patch fixes the problem:\r\n```\r\ndiff --git a/tensorflow/go/tensor.go b/tensorflow/go/tensor.go\r\nindex e8fa21a..6cbf759 100644\r\n--- a/tensorflow/go/tensor.go\r\n+++ b/tensorflow/go/tensor.go\r\n@@ -205,6 +205,9 @@ func (t *Tensor) WriteContentsTo(w io.Writer) (int64, error) {\r\n func tensorData(c *C.TF_Tensor) []byte {\r\n        // See: https://github.com/golang/go/wiki/cgo#turning-c-arrays-into-go-slices\r\n        cbytes := C.TF_TensorData(c)\r\n+       if cbytes == nil {\r\n+               return nil\r\n+       }\r\n        length := int(C.TF_TensorByteSize(c))\r\n        slice := (*[1 << 30]byte)(unsafe.Pointer(cbytes))[:length:length]\r\n        return slice\r\n```"}