{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1311", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1311/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1311/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1311/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/1311", "id": 136830789, "node_id": "MDU6SXNzdWUxMzY4MzA3ODk=", "number": 1311, "title": "dynamic_rnn incompatible with BasicRNNCell, GRUCell, and BasicLSTMCell", "user": {"login": "nryant", "id": 716377, "node_id": "MDQ6VXNlcjcxNjM3Nw==", "avatar_url": "https://avatars3.githubusercontent.com/u/716377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nryant", "html_url": "https://github.com/nryant", "followers_url": "https://api.github.com/users/nryant/followers", "following_url": "https://api.github.com/users/nryant/following{/other_user}", "gists_url": "https://api.github.com/users/nryant/gists{/gist_id}", "starred_url": "https://api.github.com/users/nryant/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nryant/subscriptions", "organizations_url": "https://api.github.com/users/nryant/orgs", "repos_url": "https://api.github.com/users/nryant/repos", "events_url": "https://api.github.com/users/nryant/events{/privacy}", "received_events_url": "https://api.github.com/users/nryant/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2016-02-26T22:20:53Z", "updated_at": "2016-03-01T18:57:48Z", "closed_at": "2016-03-01T18:57:48Z", "author_association": "NONE", "body_html": "<h3>Description</h3>\n<p>I've been playing around with <code>rnn.dynamic_rnn</code> and have thus far only had success with it when using <code>rnn_cell.BasicLSTMCell</code> instances. When using any other cell, a <code>TypeError</code> is raised. Looking at the traceback, the culprit appears to be the calls to <code>rnn_cell.linear</code> at each time step, which fail when <code>rnn_cell.linear</code> attempts to get the shape of its input slice. This, in turn, fails because the input slices are produced from a <code>TensorArray</code> and have shape <code>&lt;unknown&gt;</code>.</p>\n<h3>Environment info</h3>\n<p>Operating System: Ubuntu 14.04 LTS<br>\nInstalled from source at:  <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/b88971051fbc49fa1e0b91ec1b0b60defa11697e/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/b88971051fbc49fa1e0b91ec1b0b60defa11697e\"><tt>b889710</tt></a></p>\n<h3>Steps to reproduce</h3>\n<p>The following will attempt to call <code>dynamic_rnn</code> with three different cells, catch the <code>TypeError</code> that is raised, then print the exception + traceback to stdout.</p>\n<pre><code>import sys\nimport traceback\nimport tensorflow as tf\nfrom tensorflow.python.ops.rnn import dynamic_rnn\n\ninputs = tf.placeholder('float32', [None, None, 32])\nmbsz = tf.shape(inputs)[0]\nmax_seq_len = tf.shape(inputs)[1]\nsequence_length = tf.fill(tf.expand_dims(mbsz, 0), max_seq_len)\n\nn_units = 32\ncells = [tf.nn.rnn_cell.BasicRNNCell(n_units),\n    tf.nn.rnn_cell.GRUCell(n_units),\n    tf.nn.rnn_cell.BasicLSTMCell(n_units)]\nfor cell in cells:\n    print('='*40)\n    print('Attempting with: %s' % cell.__class__.__name__)\n    print('='*40)\n    try:\n        rnn_out, _ = dynamic_rnn(cell, inputs, sequence_length, dtype='float32')\n    except TypeError as e:\n        tb = sys.exc_traceback\n        traceback.print_exception(TypeError, e, tb)\n        print('\\n'*3)\n</code></pre>\n<h3>Output of above snippet</h3>\n<pre><code>I tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcublas.so.7.0 locally\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcudnn.so.4.0.4 locally\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcufft.so.7.0 locally\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcuda.so.1 locally\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcurand.so.7.0 locally\n========================================\nAttempting with: BasicRNNCell\n========================================\nTraceback (most recent call last):\n  File \"&lt;ipython-input-1-aa87c2141668&gt;\", line 20, in &lt;module&gt;\n    rnn_out, _ = dynamic_rnn(cell, inputs, sequence_length, dtype='float32')\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 432, in dynamic_rnn\n    parallel_iterations=parallel_iterations)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 501, in _dynamic_rnn_loop\n    parallel_iterations=parallel_iterations)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1590, in While\n    result = context.BuildLoop(cond, body, loop_vars)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1507, in BuildLoop\n    body_result = body(*vars_for_body_with_tensor_arrays)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 491, in _time_step\n    zero_output, state, lambda: cell(input_t, state))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 218, in _rnn_step\n    time &lt; max_sequence_length, call_cell, empty_update)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1210, in cond\n    res_t = context_t.BuildCondBranch(fn1)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1133, in BuildCondBranch\n    r = fn()\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 491, in &lt;lambda&gt;\n    zero_output, state, lambda: cell(input_t, state))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell.py\", line 122, in __call__\n    output = tanh(linear([inputs, state], self._num_units, True))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell.py\", line 692, in linear\n    shapes = [a.get_shape().as_list() for a in args]\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_shape.py\", line 738, in as_list\n    return [dim.value for dim in self._dims]\nTypeError: 'NoneType' object is not iterable\n\n\n\n\n========================================\nAttempting with: GRUCell\n========================================\nTraceback (most recent call last):\n  File \"&lt;ipython-input-1-aa87c2141668&gt;\", line 20, in &lt;module&gt;\n    rnn_out, _ = dynamic_rnn(cell, inputs, sequence_length, dtype='float32')\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 432, in dynamic_rnn\n    parallel_iterations=parallel_iterations)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 501, in _dynamic_rnn_loop\n    parallel_iterations=parallel_iterations)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1590, in While\n    result = context.BuildLoop(cond, body, loop_vars)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1507, in BuildLoop\n    body_result = body(*vars_for_body_with_tensor_arrays)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 491, in _time_step\n    zero_output, state, lambda: cell(input_t, state))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 218, in _rnn_step\n    time &lt; max_sequence_length, call_cell, empty_update)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1210, in cond\n    res_t = context_t.BuildCondBranch(fn1)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1133, in BuildCondBranch\n    r = fn()\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 491, in &lt;lambda&gt;\n    zero_output, state, lambda: cell(input_t, state))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell.py\", line 151, in __call__\n    2 * self._num_units, True, 1.0))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell.py\", line 692, in linear\n    shapes = [a.get_shape().as_list() for a in args]\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_shape.py\", line 738, in as_list\n    return [dim.value for dim in self._dims]\nTypeError: 'NoneType' object is not iterable\n\n\n\n\n========================================\nAttempting with: BasicLSTMCell\n========================================\nTraceback (most recent call last):\n  File \"&lt;ipython-input-1-aa87c2141668&gt;\", line 20, in &lt;module&gt;\n    rnn_out, _ = dynamic_rnn(cell, inputs, sequence_length, dtype='float32')\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 432, in dynamic_rnn\n    parallel_iterations=parallel_iterations)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 501, in _dynamic_rnn_loop\n    parallel_iterations=parallel_iterations)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1590, in While\n    result = context.BuildLoop(cond, body, loop_vars)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1507, in BuildLoop\n    body_result = body(*vars_for_body_with_tensor_arrays)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 491, in _time_step\n    zero_output, state, lambda: cell(input_t, state))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 218, in _rnn_step\n    time &lt; max_sequence_length, call_cell, empty_update)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1210, in cond\n    res_t = context_t.BuildCondBranch(fn1)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1133, in BuildCondBranch\n    r = fn()\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 491, in &lt;lambda&gt;\n    zero_output, state, lambda: cell(input_t, state))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell.py\", line 203, in __call__\n    concat = linear([inputs, h], 4 * self._num_units, True)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell.py\", line 692, in linear\n    shapes = [a.get_shape().as_list() for a in args]\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_shape.py\", line 738, in as_list\n    return [dim.value for dim in self._dims]\nTypeError: 'NoneType' object is not iterable\n</code></pre>", "body_text": "Description\nI've been playing around with rnn.dynamic_rnn and have thus far only had success with it when using rnn_cell.BasicLSTMCell instances. When using any other cell, a TypeError is raised. Looking at the traceback, the culprit appears to be the calls to rnn_cell.linear at each time step, which fail when rnn_cell.linear attempts to get the shape of its input slice. This, in turn, fails because the input slices are produced from a TensorArray and have shape <unknown>.\nEnvironment info\nOperating System: Ubuntu 14.04 LTS\nInstalled from source at:  b889710\nSteps to reproduce\nThe following will attempt to call dynamic_rnn with three different cells, catch the TypeError that is raised, then print the exception + traceback to stdout.\nimport sys\nimport traceback\nimport tensorflow as tf\nfrom tensorflow.python.ops.rnn import dynamic_rnn\n\ninputs = tf.placeholder('float32', [None, None, 32])\nmbsz = tf.shape(inputs)[0]\nmax_seq_len = tf.shape(inputs)[1]\nsequence_length = tf.fill(tf.expand_dims(mbsz, 0), max_seq_len)\n\nn_units = 32\ncells = [tf.nn.rnn_cell.BasicRNNCell(n_units),\n    tf.nn.rnn_cell.GRUCell(n_units),\n    tf.nn.rnn_cell.BasicLSTMCell(n_units)]\nfor cell in cells:\n    print('='*40)\n    print('Attempting with: %s' % cell.__class__.__name__)\n    print('='*40)\n    try:\n        rnn_out, _ = dynamic_rnn(cell, inputs, sequence_length, dtype='float32')\n    except TypeError as e:\n        tb = sys.exc_traceback\n        traceback.print_exception(TypeError, e, tb)\n        print('\\n'*3)\n\nOutput of above snippet\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcublas.so.7.0 locally\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcudnn.so.4.0.4 locally\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcufft.so.7.0 locally\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcuda.so.1 locally\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcurand.so.7.0 locally\n========================================\nAttempting with: BasicRNNCell\n========================================\nTraceback (most recent call last):\n  File \"<ipython-input-1-aa87c2141668>\", line 20, in <module>\n    rnn_out, _ = dynamic_rnn(cell, inputs, sequence_length, dtype='float32')\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 432, in dynamic_rnn\n    parallel_iterations=parallel_iterations)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 501, in _dynamic_rnn_loop\n    parallel_iterations=parallel_iterations)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1590, in While\n    result = context.BuildLoop(cond, body, loop_vars)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1507, in BuildLoop\n    body_result = body(*vars_for_body_with_tensor_arrays)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 491, in _time_step\n    zero_output, state, lambda: cell(input_t, state))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 218, in _rnn_step\n    time < max_sequence_length, call_cell, empty_update)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1210, in cond\n    res_t = context_t.BuildCondBranch(fn1)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1133, in BuildCondBranch\n    r = fn()\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 491, in <lambda>\n    zero_output, state, lambda: cell(input_t, state))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell.py\", line 122, in __call__\n    output = tanh(linear([inputs, state], self._num_units, True))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell.py\", line 692, in linear\n    shapes = [a.get_shape().as_list() for a in args]\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_shape.py\", line 738, in as_list\n    return [dim.value for dim in self._dims]\nTypeError: 'NoneType' object is not iterable\n\n\n\n\n========================================\nAttempting with: GRUCell\n========================================\nTraceback (most recent call last):\n  File \"<ipython-input-1-aa87c2141668>\", line 20, in <module>\n    rnn_out, _ = dynamic_rnn(cell, inputs, sequence_length, dtype='float32')\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 432, in dynamic_rnn\n    parallel_iterations=parallel_iterations)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 501, in _dynamic_rnn_loop\n    parallel_iterations=parallel_iterations)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1590, in While\n    result = context.BuildLoop(cond, body, loop_vars)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1507, in BuildLoop\n    body_result = body(*vars_for_body_with_tensor_arrays)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 491, in _time_step\n    zero_output, state, lambda: cell(input_t, state))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 218, in _rnn_step\n    time < max_sequence_length, call_cell, empty_update)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1210, in cond\n    res_t = context_t.BuildCondBranch(fn1)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1133, in BuildCondBranch\n    r = fn()\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 491, in <lambda>\n    zero_output, state, lambda: cell(input_t, state))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell.py\", line 151, in __call__\n    2 * self._num_units, True, 1.0))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell.py\", line 692, in linear\n    shapes = [a.get_shape().as_list() for a in args]\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_shape.py\", line 738, in as_list\n    return [dim.value for dim in self._dims]\nTypeError: 'NoneType' object is not iterable\n\n\n\n\n========================================\nAttempting with: BasicLSTMCell\n========================================\nTraceback (most recent call last):\n  File \"<ipython-input-1-aa87c2141668>\", line 20, in <module>\n    rnn_out, _ = dynamic_rnn(cell, inputs, sequence_length, dtype='float32')\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 432, in dynamic_rnn\n    parallel_iterations=parallel_iterations)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 501, in _dynamic_rnn_loop\n    parallel_iterations=parallel_iterations)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1590, in While\n    result = context.BuildLoop(cond, body, loop_vars)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1507, in BuildLoop\n    body_result = body(*vars_for_body_with_tensor_arrays)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 491, in _time_step\n    zero_output, state, lambda: cell(input_t, state))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 218, in _rnn_step\n    time < max_sequence_length, call_cell, empty_update)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1210, in cond\n    res_t = context_t.BuildCondBranch(fn1)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1133, in BuildCondBranch\n    r = fn()\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 491, in <lambda>\n    zero_output, state, lambda: cell(input_t, state))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell.py\", line 203, in __call__\n    concat = linear([inputs, h], 4 * self._num_units, True)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell.py\", line 692, in linear\n    shapes = [a.get_shape().as_list() for a in args]\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_shape.py\", line 738, in as_list\n    return [dim.value for dim in self._dims]\nTypeError: 'NoneType' object is not iterable", "body": "### Description\n\nI've been playing around with `rnn.dynamic_rnn` and have thus far only had success with it when using `rnn_cell.BasicLSTMCell` instances. When using any other cell, a `TypeError` is raised. Looking at the traceback, the culprit appears to be the calls to `rnn_cell.linear` at each time step, which fail when `rnn_cell.linear` attempts to get the shape of its input slice. This, in turn, fails because the input slices are produced from a `TensorArray` and have shape `<unknown>`.\n### Environment info\n\nOperating System: Ubuntu 14.04 LTS\nInstalled from source at:  b88971051fbc49fa1e0b91ec1b0b60defa11697e\n### Steps to reproduce\n\nThe following will attempt to call `dynamic_rnn` with three different cells, catch the `TypeError` that is raised, then print the exception + traceback to stdout.\n\n```\nimport sys\nimport traceback\nimport tensorflow as tf\nfrom tensorflow.python.ops.rnn import dynamic_rnn\n\ninputs = tf.placeholder('float32', [None, None, 32])\nmbsz = tf.shape(inputs)[0]\nmax_seq_len = tf.shape(inputs)[1]\nsequence_length = tf.fill(tf.expand_dims(mbsz, 0), max_seq_len)\n\nn_units = 32\ncells = [tf.nn.rnn_cell.BasicRNNCell(n_units),\n    tf.nn.rnn_cell.GRUCell(n_units),\n    tf.nn.rnn_cell.BasicLSTMCell(n_units)]\nfor cell in cells:\n    print('='*40)\n    print('Attempting with: %s' % cell.__class__.__name__)\n    print('='*40)\n    try:\n        rnn_out, _ = dynamic_rnn(cell, inputs, sequence_length, dtype='float32')\n    except TypeError as e:\n        tb = sys.exc_traceback\n        traceback.print_exception(TypeError, e, tb)\n        print('\\n'*3)\n```\n### Output of above snippet\n\n```\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcublas.so.7.0 locally\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcudnn.so.4.0.4 locally\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcufft.so.7.0 locally\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcuda.so.1 locally\nI tensorflow/stream_executor/dso_loader.cc:105] successfully opened CUDA library libcurand.so.7.0 locally\n========================================\nAttempting with: BasicRNNCell\n========================================\nTraceback (most recent call last):\n  File \"<ipython-input-1-aa87c2141668>\", line 20, in <module>\n    rnn_out, _ = dynamic_rnn(cell, inputs, sequence_length, dtype='float32')\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 432, in dynamic_rnn\n    parallel_iterations=parallel_iterations)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 501, in _dynamic_rnn_loop\n    parallel_iterations=parallel_iterations)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1590, in While\n    result = context.BuildLoop(cond, body, loop_vars)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1507, in BuildLoop\n    body_result = body(*vars_for_body_with_tensor_arrays)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 491, in _time_step\n    zero_output, state, lambda: cell(input_t, state))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 218, in _rnn_step\n    time < max_sequence_length, call_cell, empty_update)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1210, in cond\n    res_t = context_t.BuildCondBranch(fn1)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1133, in BuildCondBranch\n    r = fn()\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 491, in <lambda>\n    zero_output, state, lambda: cell(input_t, state))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell.py\", line 122, in __call__\n    output = tanh(linear([inputs, state], self._num_units, True))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell.py\", line 692, in linear\n    shapes = [a.get_shape().as_list() for a in args]\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_shape.py\", line 738, in as_list\n    return [dim.value for dim in self._dims]\nTypeError: 'NoneType' object is not iterable\n\n\n\n\n========================================\nAttempting with: GRUCell\n========================================\nTraceback (most recent call last):\n  File \"<ipython-input-1-aa87c2141668>\", line 20, in <module>\n    rnn_out, _ = dynamic_rnn(cell, inputs, sequence_length, dtype='float32')\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 432, in dynamic_rnn\n    parallel_iterations=parallel_iterations)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 501, in _dynamic_rnn_loop\n    parallel_iterations=parallel_iterations)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1590, in While\n    result = context.BuildLoop(cond, body, loop_vars)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1507, in BuildLoop\n    body_result = body(*vars_for_body_with_tensor_arrays)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 491, in _time_step\n    zero_output, state, lambda: cell(input_t, state))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 218, in _rnn_step\n    time < max_sequence_length, call_cell, empty_update)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1210, in cond\n    res_t = context_t.BuildCondBranch(fn1)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1133, in BuildCondBranch\n    r = fn()\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 491, in <lambda>\n    zero_output, state, lambda: cell(input_t, state))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell.py\", line 151, in __call__\n    2 * self._num_units, True, 1.0))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell.py\", line 692, in linear\n    shapes = [a.get_shape().as_list() for a in args]\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_shape.py\", line 738, in as_list\n    return [dim.value for dim in self._dims]\nTypeError: 'NoneType' object is not iterable\n\n\n\n\n========================================\nAttempting with: BasicLSTMCell\n========================================\nTraceback (most recent call last):\n  File \"<ipython-input-1-aa87c2141668>\", line 20, in <module>\n    rnn_out, _ = dynamic_rnn(cell, inputs, sequence_length, dtype='float32')\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 432, in dynamic_rnn\n    parallel_iterations=parallel_iterations)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 501, in _dynamic_rnn_loop\n    parallel_iterations=parallel_iterations)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1590, in While\n    result = context.BuildLoop(cond, body, loop_vars)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1507, in BuildLoop\n    body_result = body(*vars_for_body_with_tensor_arrays)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 491, in _time_step\n    zero_output, state, lambda: cell(input_t, state))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 218, in _rnn_step\n    time < max_sequence_length, call_cell, empty_update)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1210, in cond\n    res_t = context_t.BuildCondBranch(fn1)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/control_flow_ops.py\", line 1133, in BuildCondBranch\n    r = fn()\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn.py\", line 491, in <lambda>\n    zero_output, state, lambda: cell(input_t, state))\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell.py\", line 203, in __call__\n    concat = linear([inputs, h], 4 * self._num_units, True)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/rnn_cell.py\", line 692, in linear\n    shapes = [a.get_shape().as_list() for a in args]\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_shape.py\", line 738, in as_list\n    return [dim.value for dim in self._dims]\nTypeError: 'NoneType' object is not iterable\n```\n"}