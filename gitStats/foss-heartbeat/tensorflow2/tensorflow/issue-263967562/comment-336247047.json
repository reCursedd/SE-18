{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/336247047", "html_url": "https://github.com/tensorflow/tensorflow/issues/13591#issuecomment-336247047", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13591", "id": 336247047, "node_id": "MDEyOklzc3VlQ29tbWVudDMzNjI0NzA0Nw==", "user": {"login": "reedwm", "id": 6510203, "node_id": "MDQ6VXNlcjY1MTAyMDM=", "avatar_url": "https://avatars2.githubusercontent.com/u/6510203?v=4", "gravatar_id": "", "url": "https://api.github.com/users/reedwm", "html_url": "https://github.com/reedwm", "followers_url": "https://api.github.com/users/reedwm/followers", "following_url": "https://api.github.com/users/reedwm/following{/other_user}", "gists_url": "https://api.github.com/users/reedwm/gists{/gist_id}", "starred_url": "https://api.github.com/users/reedwm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/reedwm/subscriptions", "organizations_url": "https://api.github.com/users/reedwm/orgs", "repos_url": "https://api.github.com/users/reedwm/repos", "events_url": "https://api.github.com/users/reedwm/events{/privacy}", "received_events_url": "https://api.github.com/users/reedwm/received_events", "type": "User", "site_admin": false}, "created_at": "2017-10-12T19:51:43Z", "updated_at": "2017-10-12T19:51:43Z", "author_association": "MEMBER", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=26417094\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ybsave\">@ybsave</a> What implementation of ResNet101 were you using? When I run ResNet101 using <a href=\"https://github.com/tensorflow/benchmarks/tree/master/scripts/tf_cnn_benchmarks\">tf_cnn_benchmarks.py</a>, the maximum batch size I can run with on my 8GB GTX 1080 is 61. The command line I use is</p>\n<pre><code>python tf_cnn_benchmarks.py --model=resnet101 --batch_size=61\n</code></pre>\n<p>Also, you mentioned other frameworks could be run with higher batch sizes. What are those frameworks?</p>\n<p>When I run ResNet1010 using a batch size of 62, the logs have</p>\n<pre><code>2017-10-12 12:49:09.307354: W tensorflow/stream_executor/cuda/cuda_dnn.cc:2223] \n2017-10-12 12:49:19.307640: W tensorflow/core/common_runtime/bfc_allocator.cc:273] Allocator (GPU_0_bfc) ran out of memory trying to allocate 23.73MiB.  Current allocation summary follows.\n2017-10-12 12:49:19.307857: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (256): \tTotal Chunks: 467, Chunks in use: 225. 116.8KiB allocated for chunks. 56.2KiB in use in bin. 22.0KiB client-requested in use in bin.\n2017-10-12 12:49:19.307889: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (512): \tTotal Chunks: 107, Chunks in use: 96. 53.5KiB allocated for chunks. 48.0KiB in use in bin. 48.0KiB client-requested in use in bin.\n2017-10-12 12:49:19.307913: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (1024): \tTotal Chunks: 603, Chunks in use: 601. 603.2KiB allocated for chunks. 601.2KiB in use in bin. 601.0KiB client-requested in use in bin.\n2017-10-12 12:49:19.307936: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (2048): \tTotal Chunks: 136, Chunks in use: 134. 273.5KiB allocated for chunks. 269.5KiB in use in bin. 268.0KiB client-requested in use in bin.\n2017-10-12 12:49:19.307957: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (4096): \tTotal Chunks: 291, Chunks in use: 291. 1.14MiB allocated for chunks. 1.14MiB in use in bin. 1.14MiB client-requested in use in bin.\n2017-10-12 12:49:19.307978: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (8192): \tTotal Chunks: 47, Chunks in use: 46. 379.0KiB allocated for chunks. 371.0KiB in use in bin. 368.0KiB client-requested in use in bin.\n2017-10-12 12:49:19.308019: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (16384): \tTotal Chunks: 2, Chunks in use: 2. 32.0KiB allocated for chunks. 32.0KiB in use in bin. 32.0KiB client-requested in use in bin.\n2017-10-12 12:49:19.308038: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (32768): \tTotal Chunks: 1, Chunks in use: 1. 36.8KiB allocated for chunks. 36.8KiB in use in bin. 36.8KiB client-requested in use in bin.\n2017-10-12 12:49:19.308056: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (65536): \tTotal Chunks: 13, Chunks in use: 13. 897.2KiB allocated for chunks. 897.2KiB in use in bin. 804.8KiB client-requested in use in bin.\n2017-10-12 12:49:19.308074: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (131072): \tTotal Chunks: 7, Chunks in use: 7. 1.06MiB allocated for chunks. 1.06MiB in use in bin. 976.0KiB client-requested in use in bin.\n2017-10-12 12:49:19.308092: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (262144): \tTotal Chunks: 15, Chunks in use: 15. 3.75MiB allocated for chunks. 3.75MiB in use in bin. 3.64MiB client-requested in use in bin.\n2017-10-12 12:49:19.308109: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (524288): \tTotal Chunks: 13, Chunks in use: 12. 7.55MiB allocated for chunks. 6.56MiB in use in bin. 6.50MiB client-requested in use in bin.\n2017-10-12 12:49:19.308127: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (1048576): \tTotal Chunks: 90, Chunks in use: 90. 90.25MiB allocated for chunks. 90.25MiB in use in bin. 90.00MiB client-requested in use in bin.\n2017-10-12 12:49:19.308145: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (2097152): \tTotal Chunks: 48, Chunks in use: 48. 109.25MiB allocated for chunks. 109.25MiB in use in bin. 107.00MiB client-requested in use in bin.\n2017-10-12 12:49:19.308164: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (4194304): \tTotal Chunks: 25, Chunks in use: 25. 129.02MiB allocated for chunks. 129.02MiB in use in bin. 121.59MiB client-requested in use in bin.\n2017-10-12 12:49:19.308181: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (8388608): \tTotal Chunks: 102, Chunks in use: 101. 1.20GiB allocated for chunks. 1.19GiB in use in bin. 1.14GiB client-requested in use in bin.\n2017-10-12 12:49:19.308200: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (16777216): \tTotal Chunks: 20, Chunks in use: 20. 481.38MiB allocated for chunks. 481.38MiB in use in bin. 462.82MiB client-requested in use in bin.\n2017-10-12 12:49:19.308217: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (33554432): \tTotal Chunks: 65, Chunks in use: 65. 2.95GiB allocated for chunks. 2.95GiB in use in bin. 2.90GiB client-requested in use in bin.\n2017-10-12 12:49:19.308236: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (67108864): \tTotal Chunks: 9, Chunks in use: 9. 854.44MiB allocated for chunks. 854.44MiB in use in bin. 854.44MiB client-requested in use in bin.\n2017-10-12 12:49:19.308253: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (134217728): \tTotal Chunks: 9, Chunks in use: 9. 1.62GiB allocated for chunks. 1.62GiB in use in bin. 1.62GiB client-requested in use in bin.\n2017-10-12 12:49:19.308270: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (268435456): \tTotal Chunks: 0, Chunks in use: 0. 0B allocated for chunks. 0B in use in bin. 0B client-requested in use in bin.\n</code></pre>\n<p>Since for each bin, the \"client-requested in use in bin\" is almost as high as \"use in bin\", this issue of only using half a chunk is not occurring.</p>", "body_text": "@ybsave What implementation of ResNet101 were you using? When I run ResNet101 using tf_cnn_benchmarks.py, the maximum batch size I can run with on my 8GB GTX 1080 is 61. The command line I use is\npython tf_cnn_benchmarks.py --model=resnet101 --batch_size=61\n\nAlso, you mentioned other frameworks could be run with higher batch sizes. What are those frameworks?\nWhen I run ResNet1010 using a batch size of 62, the logs have\n2017-10-12 12:49:09.307354: W tensorflow/stream_executor/cuda/cuda_dnn.cc:2223] \n2017-10-12 12:49:19.307640: W tensorflow/core/common_runtime/bfc_allocator.cc:273] Allocator (GPU_0_bfc) ran out of memory trying to allocate 23.73MiB.  Current allocation summary follows.\n2017-10-12 12:49:19.307857: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (256): \tTotal Chunks: 467, Chunks in use: 225. 116.8KiB allocated for chunks. 56.2KiB in use in bin. 22.0KiB client-requested in use in bin.\n2017-10-12 12:49:19.307889: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (512): \tTotal Chunks: 107, Chunks in use: 96. 53.5KiB allocated for chunks. 48.0KiB in use in bin. 48.0KiB client-requested in use in bin.\n2017-10-12 12:49:19.307913: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (1024): \tTotal Chunks: 603, Chunks in use: 601. 603.2KiB allocated for chunks. 601.2KiB in use in bin. 601.0KiB client-requested in use in bin.\n2017-10-12 12:49:19.307936: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (2048): \tTotal Chunks: 136, Chunks in use: 134. 273.5KiB allocated for chunks. 269.5KiB in use in bin. 268.0KiB client-requested in use in bin.\n2017-10-12 12:49:19.307957: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (4096): \tTotal Chunks: 291, Chunks in use: 291. 1.14MiB allocated for chunks. 1.14MiB in use in bin. 1.14MiB client-requested in use in bin.\n2017-10-12 12:49:19.307978: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (8192): \tTotal Chunks: 47, Chunks in use: 46. 379.0KiB allocated for chunks. 371.0KiB in use in bin. 368.0KiB client-requested in use in bin.\n2017-10-12 12:49:19.308019: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (16384): \tTotal Chunks: 2, Chunks in use: 2. 32.0KiB allocated for chunks. 32.0KiB in use in bin. 32.0KiB client-requested in use in bin.\n2017-10-12 12:49:19.308038: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (32768): \tTotal Chunks: 1, Chunks in use: 1. 36.8KiB allocated for chunks. 36.8KiB in use in bin. 36.8KiB client-requested in use in bin.\n2017-10-12 12:49:19.308056: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (65536): \tTotal Chunks: 13, Chunks in use: 13. 897.2KiB allocated for chunks. 897.2KiB in use in bin. 804.8KiB client-requested in use in bin.\n2017-10-12 12:49:19.308074: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (131072): \tTotal Chunks: 7, Chunks in use: 7. 1.06MiB allocated for chunks. 1.06MiB in use in bin. 976.0KiB client-requested in use in bin.\n2017-10-12 12:49:19.308092: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (262144): \tTotal Chunks: 15, Chunks in use: 15. 3.75MiB allocated for chunks. 3.75MiB in use in bin. 3.64MiB client-requested in use in bin.\n2017-10-12 12:49:19.308109: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (524288): \tTotal Chunks: 13, Chunks in use: 12. 7.55MiB allocated for chunks. 6.56MiB in use in bin. 6.50MiB client-requested in use in bin.\n2017-10-12 12:49:19.308127: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (1048576): \tTotal Chunks: 90, Chunks in use: 90. 90.25MiB allocated for chunks. 90.25MiB in use in bin. 90.00MiB client-requested in use in bin.\n2017-10-12 12:49:19.308145: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (2097152): \tTotal Chunks: 48, Chunks in use: 48. 109.25MiB allocated for chunks. 109.25MiB in use in bin. 107.00MiB client-requested in use in bin.\n2017-10-12 12:49:19.308164: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (4194304): \tTotal Chunks: 25, Chunks in use: 25. 129.02MiB allocated for chunks. 129.02MiB in use in bin. 121.59MiB client-requested in use in bin.\n2017-10-12 12:49:19.308181: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (8388608): \tTotal Chunks: 102, Chunks in use: 101. 1.20GiB allocated for chunks. 1.19GiB in use in bin. 1.14GiB client-requested in use in bin.\n2017-10-12 12:49:19.308200: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (16777216): \tTotal Chunks: 20, Chunks in use: 20. 481.38MiB allocated for chunks. 481.38MiB in use in bin. 462.82MiB client-requested in use in bin.\n2017-10-12 12:49:19.308217: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (33554432): \tTotal Chunks: 65, Chunks in use: 65. 2.95GiB allocated for chunks. 2.95GiB in use in bin. 2.90GiB client-requested in use in bin.\n2017-10-12 12:49:19.308236: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (67108864): \tTotal Chunks: 9, Chunks in use: 9. 854.44MiB allocated for chunks. 854.44MiB in use in bin. 854.44MiB client-requested in use in bin.\n2017-10-12 12:49:19.308253: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (134217728): \tTotal Chunks: 9, Chunks in use: 9. 1.62GiB allocated for chunks. 1.62GiB in use in bin. 1.62GiB client-requested in use in bin.\n2017-10-12 12:49:19.308270: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (268435456): \tTotal Chunks: 0, Chunks in use: 0. 0B allocated for chunks. 0B in use in bin. 0B client-requested in use in bin.\n\nSince for each bin, the \"client-requested in use in bin\" is almost as high as \"use in bin\", this issue of only using half a chunk is not occurring.", "body": "@ybsave What implementation of ResNet101 were you using? When I run ResNet101 using [tf_cnn_benchmarks.py](https://github.com/tensorflow/benchmarks/tree/master/scripts/tf_cnn_benchmarks), the maximum batch size I can run with on my 8GB GTX 1080 is 61. The command line I use is\r\n\r\n```\r\npython tf_cnn_benchmarks.py --model=resnet101 --batch_size=61\r\n```\r\n\r\nAlso, you mentioned other frameworks could be run with higher batch sizes. What are those frameworks?\r\n\r\nWhen I run ResNet1010 using a batch size of 62, the logs have\r\n\r\n```\r\n2017-10-12 12:49:09.307354: W tensorflow/stream_executor/cuda/cuda_dnn.cc:2223] \r\n2017-10-12 12:49:19.307640: W tensorflow/core/common_runtime/bfc_allocator.cc:273] Allocator (GPU_0_bfc) ran out of memory trying to allocate 23.73MiB.  Current allocation summary follows.\r\n2017-10-12 12:49:19.307857: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (256): \tTotal Chunks: 467, Chunks in use: 225. 116.8KiB allocated for chunks. 56.2KiB in use in bin. 22.0KiB client-requested in use in bin.\r\n2017-10-12 12:49:19.307889: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (512): \tTotal Chunks: 107, Chunks in use: 96. 53.5KiB allocated for chunks. 48.0KiB in use in bin. 48.0KiB client-requested in use in bin.\r\n2017-10-12 12:49:19.307913: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (1024): \tTotal Chunks: 603, Chunks in use: 601. 603.2KiB allocated for chunks. 601.2KiB in use in bin. 601.0KiB client-requested in use in bin.\r\n2017-10-12 12:49:19.307936: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (2048): \tTotal Chunks: 136, Chunks in use: 134. 273.5KiB allocated for chunks. 269.5KiB in use in bin. 268.0KiB client-requested in use in bin.\r\n2017-10-12 12:49:19.307957: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (4096): \tTotal Chunks: 291, Chunks in use: 291. 1.14MiB allocated for chunks. 1.14MiB in use in bin. 1.14MiB client-requested in use in bin.\r\n2017-10-12 12:49:19.307978: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (8192): \tTotal Chunks: 47, Chunks in use: 46. 379.0KiB allocated for chunks. 371.0KiB in use in bin. 368.0KiB client-requested in use in bin.\r\n2017-10-12 12:49:19.308019: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (16384): \tTotal Chunks: 2, Chunks in use: 2. 32.0KiB allocated for chunks. 32.0KiB in use in bin. 32.0KiB client-requested in use in bin.\r\n2017-10-12 12:49:19.308038: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (32768): \tTotal Chunks: 1, Chunks in use: 1. 36.8KiB allocated for chunks. 36.8KiB in use in bin. 36.8KiB client-requested in use in bin.\r\n2017-10-12 12:49:19.308056: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (65536): \tTotal Chunks: 13, Chunks in use: 13. 897.2KiB allocated for chunks. 897.2KiB in use in bin. 804.8KiB client-requested in use in bin.\r\n2017-10-12 12:49:19.308074: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (131072): \tTotal Chunks: 7, Chunks in use: 7. 1.06MiB allocated for chunks. 1.06MiB in use in bin. 976.0KiB client-requested in use in bin.\r\n2017-10-12 12:49:19.308092: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (262144): \tTotal Chunks: 15, Chunks in use: 15. 3.75MiB allocated for chunks. 3.75MiB in use in bin. 3.64MiB client-requested in use in bin.\r\n2017-10-12 12:49:19.308109: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (524288): \tTotal Chunks: 13, Chunks in use: 12. 7.55MiB allocated for chunks. 6.56MiB in use in bin. 6.50MiB client-requested in use in bin.\r\n2017-10-12 12:49:19.308127: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (1048576): \tTotal Chunks: 90, Chunks in use: 90. 90.25MiB allocated for chunks. 90.25MiB in use in bin. 90.00MiB client-requested in use in bin.\r\n2017-10-12 12:49:19.308145: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (2097152): \tTotal Chunks: 48, Chunks in use: 48. 109.25MiB allocated for chunks. 109.25MiB in use in bin. 107.00MiB client-requested in use in bin.\r\n2017-10-12 12:49:19.308164: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (4194304): \tTotal Chunks: 25, Chunks in use: 25. 129.02MiB allocated for chunks. 129.02MiB in use in bin. 121.59MiB client-requested in use in bin.\r\n2017-10-12 12:49:19.308181: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (8388608): \tTotal Chunks: 102, Chunks in use: 101. 1.20GiB allocated for chunks. 1.19GiB in use in bin. 1.14GiB client-requested in use in bin.\r\n2017-10-12 12:49:19.308200: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (16777216): \tTotal Chunks: 20, Chunks in use: 20. 481.38MiB allocated for chunks. 481.38MiB in use in bin. 462.82MiB client-requested in use in bin.\r\n2017-10-12 12:49:19.308217: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (33554432): \tTotal Chunks: 65, Chunks in use: 65. 2.95GiB allocated for chunks. 2.95GiB in use in bin. 2.90GiB client-requested in use in bin.\r\n2017-10-12 12:49:19.308236: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (67108864): \tTotal Chunks: 9, Chunks in use: 9. 854.44MiB allocated for chunks. 854.44MiB in use in bin. 854.44MiB client-requested in use in bin.\r\n2017-10-12 12:49:19.308253: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (134217728): \tTotal Chunks: 9, Chunks in use: 9. 1.62GiB allocated for chunks. 1.62GiB in use in bin. 1.62GiB client-requested in use in bin.\r\n2017-10-12 12:49:19.308270: I tensorflow/core/common_runtime/bfc_allocator.cc:627] Bin (268435456): \tTotal Chunks: 0, Chunks in use: 0. 0B allocated for chunks. 0B in use in bin. 0B client-requested in use in bin.\r\n```\r\n\r\nSince for each bin, the \"client-requested in use in bin\" is almost as high as \"use in bin\", this issue of only using half a chunk is not occurring."}