{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/293411074", "html_url": "https://github.com/tensorflow/tensorflow/pull/8999#issuecomment-293411074", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8999", "id": 293411074, "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzQxMTA3NA==", "user": {"login": "samjabrahams", "id": 11607205, "node_id": "MDQ6VXNlcjExNjA3MjA1", "avatar_url": "https://avatars0.githubusercontent.com/u/11607205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/samjabrahams", "html_url": "https://github.com/samjabrahams", "followers_url": "https://api.github.com/users/samjabrahams/followers", "following_url": "https://api.github.com/users/samjabrahams/following{/other_user}", "gists_url": "https://api.github.com/users/samjabrahams/gists{/gist_id}", "starred_url": "https://api.github.com/users/samjabrahams/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/samjabrahams/subscriptions", "organizations_url": "https://api.github.com/users/samjabrahams/orgs", "repos_url": "https://api.github.com/users/samjabrahams/repos", "events_url": "https://api.github.com/users/samjabrahams/events{/privacy}", "received_events_url": "https://api.github.com/users/samjabrahams/received_events", "type": "User", "site_admin": false}, "created_at": "2017-04-11T21:50:53Z", "updated_at": "2017-04-11T21:50:53Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=20959853\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/drpngx\">@drpngx</a> - agreed on figuring out a way to properly test these. Originally this was just to fix some regressions, but it's better to follow through and try to get the entire tool up-to-spec. I made a few tweaks to the existing <code>quantize_graph_test.py</code> file to help get that ball rolling. Notes on the current changes:</p>\n<ul>\n<li>Changed <code>self.already_visited.get(...)</code> to <code>if current_node.name in self.already_visited</code> to <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/quantization/quantize_graph.py#L510-L511\">keep existing pattern consistent</a></li>\n<li>As <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/quantization/quantize_graph_test.py#L165-L173\">@petewarden notes</a>- we can't actually use the <code>'rounded'</code> mode right now as there is no <code>RoundToSteps</code> Op. We can still run the <code>GraphRewriter</code> to check that the recursion no longer fails.</li>\n<li>I created a test for the <code>'quantize'</code> mode (and set it to use the <code>QuantizeV2</code> Op), but I'm getting some failures for several of the tests. I've attached the failure log below.</li>\n</ul>\n<p><a href=\"https://github.com/tensorflow/tensorflow/files/914756/test.txt\">Test failure log</a></p>\n<p>I'll try to spend more time on this over the next week or two.</p>\n<p>(Additionally, I had a rebase hiccup, which caused the CLA issue; should be fixed now).</p>", "body_text": "@drpngx - agreed on figuring out a way to properly test these. Originally this was just to fix some regressions, but it's better to follow through and try to get the entire tool up-to-spec. I made a few tweaks to the existing quantize_graph_test.py file to help get that ball rolling. Notes on the current changes:\n\nChanged self.already_visited.get(...) to if current_node.name in self.already_visited to keep existing pattern consistent\nAs @petewarden notes- we can't actually use the 'rounded' mode right now as there is no RoundToSteps Op. We can still run the GraphRewriter to check that the recursion no longer fails.\nI created a test for the 'quantize' mode (and set it to use the QuantizeV2 Op), but I'm getting some failures for several of the tests. I've attached the failure log below.\n\nTest failure log\nI'll try to spend more time on this over the next week or two.\n(Additionally, I had a rebase hiccup, which caused the CLA issue; should be fixed now).", "body": "@drpngx - agreed on figuring out a way to properly test these. Originally this was just to fix some regressions, but it's better to follow through and try to get the entire tool up-to-spec. I made a few tweaks to the existing `quantize_graph_test.py` file to help get that ball rolling. Notes on the current changes:\r\n\r\n* Changed `self.already_visited.get(...)` to `if current_node.name in self.already_visited` to [keep existing pattern consistent](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/quantization/quantize_graph.py#L510-L511)\r\n* As [@petewarden notes](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/quantization/quantize_graph_test.py#L165-L173)- we can't actually use the `'rounded'` mode right now as there is no `RoundToSteps` Op. We can still run the `GraphRewriter` to check that the recursion no longer fails.\r\n* I created a test for the `'quantize'` mode (and set it to use the `QuantizeV2` Op), but I'm getting some failures for several of the tests. I've attached the failure log below.\r\n\r\n[Test failure log](https://github.com/tensorflow/tensorflow/files/914756/test.txt)\r\n\r\nI'll try to spend more time on this over the next week or two.\r\n\r\n(Additionally, I had a rebase hiccup, which caused the CLA issue; should be fixed now)."}