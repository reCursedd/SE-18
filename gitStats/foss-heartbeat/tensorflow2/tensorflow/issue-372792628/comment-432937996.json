{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/432937996", "html_url": "https://github.com/tensorflow/tensorflow/issues/23179#issuecomment-432937996", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23179", "id": 432937996, "node_id": "MDEyOklzc3VlQ29tbWVudDQzMjkzNzk5Ng==", "user": {"login": "delock", "id": 19373651, "node_id": "MDQ6VXNlcjE5MzczNjUx", "avatar_url": "https://avatars2.githubusercontent.com/u/19373651?v=4", "gravatar_id": "", "url": "https://api.github.com/users/delock", "html_url": "https://github.com/delock", "followers_url": "https://api.github.com/users/delock/followers", "following_url": "https://api.github.com/users/delock/following{/other_user}", "gists_url": "https://api.github.com/users/delock/gists{/gist_id}", "starred_url": "https://api.github.com/users/delock/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/delock/subscriptions", "organizations_url": "https://api.github.com/users/delock/orgs", "repos_url": "https://api.github.com/users/delock/repos", "events_url": "https://api.github.com/users/delock/events{/privacy}", "received_events_url": "https://api.github.com/users/delock/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-25T07:04:03Z", "updated_at": "2018-10-25T07:04:03Z", "author_association": "NONE", "body_html": "<p>Here is a code snipet that reproduce this problem.</p>\n<pre><code>import tensorflow as tf                                                     \ndataset = tf.data.Dataset.range(10000)                                      \ndataset = dataset.filter(lambda x: tf.less(tf.random_uniform([1]), 0.05)[0])\ndataset = dataset.repeat()                                                  \ndataset = dataset.shuffle(buffer_size=100000)                               \n                                                                            \nwith tf.Session() as sess:                                                  \n    value = dataset.make_one_shot_iterator().get_next()                     \n    sess.run(value)                                                         \n\n</code></pre>\n<p>The time output of this program:</p>\n<pre><code>~/test/tf_dataset$ time python3 tf_dataset.py \n2018-10-25 15:01:57.602520: I tensorflow/core/common_runtime/process_util.cc:69] Creating new thread pool with default inter op setting: 2. Tune using inter_op_parallelism_threads for best performance.\n2018-10-25 15:02:07.623575: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:97] Filling up shuffle buffer (this may take a while): 22660 of 100000\n2018-10-25 15:02:17.623406: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:97] Filling up shuffle buffer (this may take a while): 45551 of 100000\n2018-10-25 15:02:27.624088: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:97] Filling up shuffle buffer (this may take a while): 68033 of 100000\n2018-10-25 15:02:37.624411: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:97] Filling up shuffle buffer (this may take a while): 90821 of 100000\n2018-10-25 15:02:41.167028: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:135] Shuffle buffer filled.\n\nreal    0m45.482s\nuser    1m18.749s\nsys     0m15.244s\n\n</code></pre>", "body_text": "Here is a code snipet that reproduce this problem.\nimport tensorflow as tf                                                     \ndataset = tf.data.Dataset.range(10000)                                      \ndataset = dataset.filter(lambda x: tf.less(tf.random_uniform([1]), 0.05)[0])\ndataset = dataset.repeat()                                                  \ndataset = dataset.shuffle(buffer_size=100000)                               \n                                                                            \nwith tf.Session() as sess:                                                  \n    value = dataset.make_one_shot_iterator().get_next()                     \n    sess.run(value)                                                         \n\n\nThe time output of this program:\n~/test/tf_dataset$ time python3 tf_dataset.py \n2018-10-25 15:01:57.602520: I tensorflow/core/common_runtime/process_util.cc:69] Creating new thread pool with default inter op setting: 2. Tune using inter_op_parallelism_threads for best performance.\n2018-10-25 15:02:07.623575: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:97] Filling up shuffle buffer (this may take a while): 22660 of 100000\n2018-10-25 15:02:17.623406: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:97] Filling up shuffle buffer (this may take a while): 45551 of 100000\n2018-10-25 15:02:27.624088: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:97] Filling up shuffle buffer (this may take a while): 68033 of 100000\n2018-10-25 15:02:37.624411: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:97] Filling up shuffle buffer (this may take a while): 90821 of 100000\n2018-10-25 15:02:41.167028: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:135] Shuffle buffer filled.\n\nreal    0m45.482s\nuser    1m18.749s\nsys     0m15.244s", "body": "Here is a code snipet that reproduce this problem.\r\n```\r\nimport tensorflow as tf                                                     \r\ndataset = tf.data.Dataset.range(10000)                                      \r\ndataset = dataset.filter(lambda x: tf.less(tf.random_uniform([1]), 0.05)[0])\r\ndataset = dataset.repeat()                                                  \r\ndataset = dataset.shuffle(buffer_size=100000)                               \r\n                                                                            \r\nwith tf.Session() as sess:                                                  \r\n    value = dataset.make_one_shot_iterator().get_next()                     \r\n    sess.run(value)                                                         \r\n\r\n```\r\nThe time output of this program:\r\n```\r\n~/test/tf_dataset$ time python3 tf_dataset.py \r\n2018-10-25 15:01:57.602520: I tensorflow/core/common_runtime/process_util.cc:69] Creating new thread pool with default inter op setting: 2. Tune using inter_op_parallelism_threads for best performance.\r\n2018-10-25 15:02:07.623575: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:97] Filling up shuffle buffer (this may take a while): 22660 of 100000\r\n2018-10-25 15:02:17.623406: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:97] Filling up shuffle buffer (this may take a while): 45551 of 100000\r\n2018-10-25 15:02:27.624088: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:97] Filling up shuffle buffer (this may take a while): 68033 of 100000\r\n2018-10-25 15:02:37.624411: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:97] Filling up shuffle buffer (this may take a while): 90821 of 100000\r\n2018-10-25 15:02:41.167028: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:135] Shuffle buffer filled.\r\n\r\nreal    0m45.482s\r\nuser    1m18.749s\r\nsys     0m15.244s\r\n\r\n```"}