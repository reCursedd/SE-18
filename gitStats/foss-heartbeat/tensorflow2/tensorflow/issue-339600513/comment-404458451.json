{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/404458451", "html_url": "https://github.com/tensorflow/tensorflow/issues/20651#issuecomment-404458451", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20651", "id": 404458451, "node_id": "MDEyOklzc3VlQ29tbWVudDQwNDQ1ODQ1MQ==", "user": {"login": "mattiasarro", "id": 53719, "node_id": "MDQ6VXNlcjUzNzE5", "avatar_url": "https://avatars0.githubusercontent.com/u/53719?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mattiasarro", "html_url": "https://github.com/mattiasarro", "followers_url": "https://api.github.com/users/mattiasarro/followers", "following_url": "https://api.github.com/users/mattiasarro/following{/other_user}", "gists_url": "https://api.github.com/users/mattiasarro/gists{/gist_id}", "starred_url": "https://api.github.com/users/mattiasarro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mattiasarro/subscriptions", "organizations_url": "https://api.github.com/users/mattiasarro/orgs", "repos_url": "https://api.github.com/users/mattiasarro/repos", "events_url": "https://api.github.com/users/mattiasarro/events{/privacy}", "received_events_url": "https://api.github.com/users/mattiasarro/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-12T09:56:32Z", "updated_at": "2018-07-12T09:56:32Z", "author_association": "NONE", "body_html": "<p>I came to the same conclusion, though in my case the error was (using tensorflow-gpu==1.9.0-rc2 on MLE with 4 GPUs):</p>\n<pre><code>Traceback (most recent call last): \nFile \"/usr/lib/python2.7/runpy.py\", line 174, in _run_module_as_main \"__main__\", fname, loader, pkg_name) \nFile \"/usr/lib/python2.7/runpy.py\", line 72, in _run_code exec code in run_globals \nFile \"/root/.local/lib/python2.7/site-packages/trainer/controller.py\", line 144, in &lt;module&gt; train(estimator) \nFile \"/root/.local/lib/python2.7/site-packages/trainer/controller.py\", line 28, in train throttle_secs=hparams.throttle_secs, \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/training.py\", line 454, in train_and_evaluate return executor.run() \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/training.py\", line 565, in run getattr(self, task_to_run)() \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/training.py\", line 622, in run_master self._start_distributed_training(saving_listeners=saving_listeners) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/training.py\", line 776, in _start_distributed_training saving_listeners=saving_listeners) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 375, in train loss = self._train_model(input_fn, hooks, saving_listeners) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1131, in _train_model return self._train_model_distributed(input_fn, hooks, saving_listeners) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1171, in _train_model_distributed self.config) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/training/distribute.py\", line 811, in call_for_each_tower return self._call_for_each_tower(fn, *args, **kwargs) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/mirrored_strategy.py\", line 279, in _call_for_each_tower coord.join(threads) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/training/coordinator.py\", line 389, in join six.reraise(*self._exc_info_to_raise) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/training/coordinator.py\", line 297, in stop_on_exception yield \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/mirrored_strategy.py\", line 262, in _call_for_each_tower {t.device: t.merge_args for t in threads}) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/values.py\", line 471, in regroup for i in range(len(v0))) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/values.py\", line 471, in &lt;genexpr&gt; for i in range(len(v0))) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/values.py\", line 462, in regroup (len(v), len(v0), v, v0)) AssertionError: len(v) == 18, len(v0) == 14, v: [...], v0: [...]\n</code></pre>\n<p>The difference between v and v0 is that v contains 4 variables not present in v0.</p>\n<p>v:</p>\n<pre><code>[(&lt;tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7b10&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights:0' shape=(868, 10) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_1:0' shape=(868, 10) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_2:0' shape=(868, 10) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_3:0' shape=(868, 10) dtype=float32&gt;})), (&lt;tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7bd0&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights:0' shape=(291, 6) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_1:0' shape=(291, 6) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_2:0' shape=(291, 6) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_3:0' shape=(291, 6) dtype=float32&gt;})), (&lt;tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7c10&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights:0' shape=(1001, 8) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_1:0' shape=(1001, 8) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_2:0' shape=(1001, 8) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_3:0' shape=(1001, 8) dtype=float32&gt;})), (&lt;tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7d10&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights:0' shape=(8001, 8) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_1:0' shape=(8001, 8) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_2:0' shape=(8001, 8) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_3:0' shape=(8001, 8) dtype=float32&gt;})), (&lt;tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/AddN_4:0' shape=(139, 784) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/layers/0/weights:0' shape=(139, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/layers/0/weights/replica_1:0' shape=(139, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/layers/0/weights/replica_2:0' shape=(139, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/layers/0/weights/replica_3:0' shape=(139, 784) dtype=float32&gt;})), (&lt;tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/tower_1/deep/layers/0/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/layers/0/biases:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/layers/0/biases/replica_1:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/layers/0/biases/replica_2:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/layers/0/biases/replica_3:0' shape=(784,) dtype=float32&gt;})), (&lt;tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/AddN_3:0' shape=(784, 784) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/layers/1/weights:0' shape=(784, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/layers/1/weights/replica_1:0' shape=(784, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/layers/1/weights/replica_2:0' shape=(784, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/layers/1/weights/replica_3:0' shape=(784, 784) dtype=float32&gt;})), (&lt;tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/tower_1/deep/layers/1/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/layers/1/biases:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/layers/1/biases/replica_1:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/layers/1/biases/replica_2:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/layers/1/biases/replica_3:0' shape=(784,) dtype=float32&gt;})), (&lt;tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/AddN_2:0' shape=(784, 784) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/layers/2/weights:0' shape=(784, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/layers/2/weights/replica_1:0' shape=(784, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/layers/2/weights/replica_2:0' shape=(784, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/layers/2/weights/replica_3:0' shape=(784, 784) dtype=float32&gt;})), (&lt;tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/tower_1/deep/layers/2/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/layers/2/biases:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/layers/2/biases/replica_1:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/layers/2/biases/replica_2:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/layers/2/biases/replica_3:0' shape=(784,) dtype=float32&gt;})), (&lt;tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/AddN_1:0' shape=(784, 784) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/layers/3/weights:0' shape=(784, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/layers/3/weights/replica_1:0' shape=(784, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/layers/3/weights/replica_2:0' shape=(784, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/layers/3/weights/replica_3:0' shape=(784, 784) dtype=float32&gt;})), (&lt;tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/tower_1/deep/layers/3/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/layers/3/biases:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/layers/3/biases/replica_1:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/layers/3/biases/replica_2:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/layers/3/biases/replica_3:0' shape=(784,) dtype=float32&gt;})), (&lt;tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/AddN:0' shape=(784, 836) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/exclusive/weights:0' shape=(784, 836) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/exclusive/weights/replica_1:0' shape=(784, 836) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/exclusive/weights/replica_2:0' shape=(784, 836) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/exclusive/weights/replica_3:0' shape=(784, 836) dtype=float32&gt;})), (&lt;tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/tower_1/deep/exclusive/BiasAdd_grad/tuple/control_dependency_1:0' shape=(836,) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/exclusive/biases:0' shape=(836,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/exclusive/biases/replica_1:0' shape=(836,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/exclusive/biases/replica_2:0' shape=(836,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/exclusive/biases/replica_3:0' shape=(836,) dtype=float32&gt;})), (&lt;tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7b10&gt;,\n\n\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights:0' shape=(868, 10) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_1:0' shape=(868, 10) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_2:0' shape=(868, 10) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_3:0' shape=(868, 10) dtype=float32&gt;})), (&lt;tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7bd0&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights:0' shape=(291, 6) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_1:0' shape=(291, 6) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_2:0' shape=(291, 6) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_3:0' shape=(291, 6) dtype=float32&gt;})), (&lt;tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7c10&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights:0' shape=(1001, 8) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_1:0' shape=(1001, 8) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_2:0' shape=(1001, 8) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_3:0' shape=(1001, 8) dtype=float32&gt;})), (&lt;tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7d10&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights:0' shape=(8001, 8) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_1:0' shape=(8001, 8) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_2:0' shape=(8001, 8) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_3:0' shape=(8001, 8) dtype=float32&gt;}))], \n</code></pre>\n<p>v0:</p>\n<pre><code>[(&lt;tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fe47b59d0&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights:0' shape=(868, 10) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_1:0' shape=(868, 10) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_2:0' shape=(868, 10) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_3:0' shape=(868, 10) dtype=float32&gt;})), (&lt;tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fe47b5a90&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights:0' shape=(291, 6) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_1:0' shape=(291, 6) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_2:0' shape=(291, 6) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_3:0' shape=(291, 6) dtype=float32&gt;})), (&lt;tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fe47b5ad0&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights:0' shape=(1001, 8) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_1:0' shape=(1001, 8) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_2:0' shape=(1001, 8) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_3:0' shape=(1001, 8) dtype=float32&gt;})), (&lt;tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fe47b5bd0&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights:0' shape=(8001, 8) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_1:0' shape=(8001, 8) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_2:0' shape=(8001, 8) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_3:0' shape=(8001, 8) dtype=float32&gt;})), (&lt;tf.Tensor 'deep_exclusive_optimizer/gradients/AddN_4:0' shape=(139, 784) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/layers/0/weights:0' shape=(139, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/layers/0/weights/replica_1:0' shape=(139, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/layers/0/weights/replica_2:0' shape=(139, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/layers/0/weights/replica_3:0' shape=(139, 784) dtype=float32&gt;})), (&lt;tf.Tensor 'deep_exclusive_optimizer/gradients/deep/layers/0/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/layers/0/biases:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/layers/0/biases/replica_1:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/layers/0/biases/replica_2:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/layers/0/biases/replica_3:0' shape=(784,) dtype=float32&gt;})), (&lt;tf.Tensor 'deep_exclusive_optimizer/gradients/AddN_3:0' shape=(784, 784) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/layers/1/weights:0' shape=(784, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/layers/1/weights/replica_1:0' shape=(784, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/layers/1/weights/replica_2:0' shape=(784, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/layers/1/weights/replica_3:0' shape=(784, 784) dtype=float32&gt;})), (&lt;tf.Tensor 'deep_exclusive_optimizer/gradients/deep/layers/1/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/layers/1/biases:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/layers/1/biases/replica_1:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/layers/1/biases/replica_2:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/layers/1/biases/replica_3:0' shape=(784,) dtype=float32&gt;})), (&lt;tf.Tensor 'deep_exclusive_optimizer/gradients/AddN_2:0' shape=(784, 784) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/layers/2/weights:0' shape=(784, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/layers/2/weights/replica_1:0' shape=(784, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/layers/2/weights/replica_2:0' shape=(784, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/layers/2/weights/replica_3:0' shape=(784, 784) dtype=float32&gt;})), (&lt;tf.Tensor 'deep_exclusive_optimizer/gradients/deep/layers/2/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/layers/2/biases:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/layers/2/biases/replica_1:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/layers/2/biases/replica_2:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/layers/2/biases/replica_3:0' shape=(784,) dtype=float32&gt;})), (&lt;tf.Tensor 'deep_exclusive_optimizer/gradients/AddN_1:0' shape=(784, 784) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/layers/3/weights:0' shape=(784, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/layers/3/weights/replica_1:0' shape=(784, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/layers/3/weights/replica_2:0' shape=(784, 784) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/layers/3/weights/replica_3:0' shape=(784, 784) dtype=float32&gt;})), (&lt;tf.Tensor 'deep_exclusive_optimizer/gradients/deep/layers/3/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/layers/3/biases:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/layers/3/biases/replica_1:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/layers/3/biases/replica_2:0' shape=(784,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/layers/3/biases/replica_3:0' shape=(784,) dtype=float32&gt;})), (&lt;tf.Tensor 'deep_exclusive_optimizer/gradients/AddN:0' shape=(784, 836) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/exclusive/weights:0' shape=(784, 836) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/exclusive/weights/replica_1:0' shape=(784, 836) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/exclusive/weights/replica_2:0' shape=(784, 836) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/exclusive/weights/replica_3:0' shape=(784, 836) dtype=float32&gt;})), (&lt;tf.Tensor 'deep_exclusive_optimizer/gradients/deep/exclusive/BiasAdd_grad/tuple/control_dependency_1:0' shape=(836,) dtype=float32&gt;,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': &lt;tf.Variable 'deep/exclusive/biases:0' shape=(836,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:1': &lt;tf.Variable 'deep/exclusive/biases/replica_1:0' shape=(836,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:2': &lt;tf.Variable 'deep/exclusive/biases/replica_2:0' shape=(836,) dtype=float32&gt;\n/replica:0/task:0/device:GPU:3': &lt;tf.Variable 'deep/exclusive/biases/replica_3:0' shape=(836,) dtype=float32&gt;}))]\n</code></pre>\n<p>All 4 variables are present twice in v, and are <code>embedding_weights</code> variables created using <code>tf.feature_column.input_layer</code>. My model_fn is similar to the <a href=\"https://github.com/tensorflow/tensorflow/blob/r1.9/tensorflow/python/estimator/canned/dnn.py#L86\">canned DNN classifier</a>; swapping embedding-based inputs (tf.feature_column.embedding_column) for 1-hot inputs (tf.feature_column.categorical_column_with_identity) bypasses this issue.</p>", "body_text": "I came to the same conclusion, though in my case the error was (using tensorflow-gpu==1.9.0-rc2 on MLE with 4 GPUs):\nTraceback (most recent call last): \nFile \"/usr/lib/python2.7/runpy.py\", line 174, in _run_module_as_main \"__main__\", fname, loader, pkg_name) \nFile \"/usr/lib/python2.7/runpy.py\", line 72, in _run_code exec code in run_globals \nFile \"/root/.local/lib/python2.7/site-packages/trainer/controller.py\", line 144, in <module> train(estimator) \nFile \"/root/.local/lib/python2.7/site-packages/trainer/controller.py\", line 28, in train throttle_secs=hparams.throttle_secs, \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/training.py\", line 454, in train_and_evaluate return executor.run() \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/training.py\", line 565, in run getattr(self, task_to_run)() \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/training.py\", line 622, in run_master self._start_distributed_training(saving_listeners=saving_listeners) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/training.py\", line 776, in _start_distributed_training saving_listeners=saving_listeners) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 375, in train loss = self._train_model(input_fn, hooks, saving_listeners) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1131, in _train_model return self._train_model_distributed(input_fn, hooks, saving_listeners) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1171, in _train_model_distributed self.config) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/training/distribute.py\", line 811, in call_for_each_tower return self._call_for_each_tower(fn, *args, **kwargs) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/mirrored_strategy.py\", line 279, in _call_for_each_tower coord.join(threads) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/training/coordinator.py\", line 389, in join six.reraise(*self._exc_info_to_raise) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/python/training/coordinator.py\", line 297, in stop_on_exception yield \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/mirrored_strategy.py\", line 262, in _call_for_each_tower {t.device: t.merge_args for t in threads}) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/values.py\", line 471, in regroup for i in range(len(v0))) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/values.py\", line 471, in <genexpr> for i in range(len(v0))) \nFile \"/root/.local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/values.py\", line 462, in regroup (len(v), len(v0), v, v0)) AssertionError: len(v) == 18, len(v0) == 14, v: [...], v0: [...]\n\nThe difference between v and v0 is that v contains 4 variables not present in v0.\nv:\n[(<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7b10>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights:0' shape=(868, 10) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_1:0' shape=(868, 10) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_2:0' shape=(868, 10) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_3:0' shape=(868, 10) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7bd0>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights:0' shape=(291, 6) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_1:0' shape=(291, 6) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_2:0' shape=(291, 6) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_3:0' shape=(291, 6) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7c10>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights:0' shape=(1001, 8) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_1:0' shape=(1001, 8) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_2:0' shape=(1001, 8) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_3:0' shape=(1001, 8) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7d10>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights:0' shape=(8001, 8) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_1:0' shape=(8001, 8) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_2:0' shape=(8001, 8) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_3:0' shape=(8001, 8) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/AddN_4:0' shape=(139, 784) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/0/weights:0' shape=(139, 784) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/0/weights/replica_1:0' shape=(139, 784) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/0/weights/replica_2:0' shape=(139, 784) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/0/weights/replica_3:0' shape=(139, 784) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/tower_1/deep/layers/0/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/0/biases:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/0/biases/replica_1:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/0/biases/replica_2:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/0/biases/replica_3:0' shape=(784,) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/AddN_3:0' shape=(784, 784) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/1/weights:0' shape=(784, 784) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/1/weights/replica_1:0' shape=(784, 784) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/1/weights/replica_2:0' shape=(784, 784) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/1/weights/replica_3:0' shape=(784, 784) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/tower_1/deep/layers/1/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/1/biases:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/1/biases/replica_1:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/1/biases/replica_2:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/1/biases/replica_3:0' shape=(784,) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/AddN_2:0' shape=(784, 784) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/2/weights:0' shape=(784, 784) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/2/weights/replica_1:0' shape=(784, 784) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/2/weights/replica_2:0' shape=(784, 784) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/2/weights/replica_3:0' shape=(784, 784) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/tower_1/deep/layers/2/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/2/biases:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/2/biases/replica_1:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/2/biases/replica_2:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/2/biases/replica_3:0' shape=(784,) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/AddN_1:0' shape=(784, 784) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/3/weights:0' shape=(784, 784) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/3/weights/replica_1:0' shape=(784, 784) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/3/weights/replica_2:0' shape=(784, 784) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/3/weights/replica_3:0' shape=(784, 784) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/tower_1/deep/layers/3/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/3/biases:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/3/biases/replica_1:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/3/biases/replica_2:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/3/biases/replica_3:0' shape=(784,) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/AddN:0' shape=(784, 836) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/exclusive/weights:0' shape=(784, 836) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/exclusive/weights/replica_1:0' shape=(784, 836) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/exclusive/weights/replica_2:0' shape=(784, 836) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/exclusive/weights/replica_3:0' shape=(784, 836) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/tower_1/deep/exclusive/BiasAdd_grad/tuple/control_dependency_1:0' shape=(836,) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/exclusive/biases:0' shape=(836,) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/exclusive/biases/replica_1:0' shape=(836,) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/exclusive/biases/replica_2:0' shape=(836,) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/exclusive/biases/replica_3:0' shape=(836,) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7b10>,\n\n\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights:0' shape=(868, 10) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_1:0' shape=(868, 10) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_2:0' shape=(868, 10) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_3:0' shape=(868, 10) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7bd0>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights:0' shape=(291, 6) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_1:0' shape=(291, 6) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_2:0' shape=(291, 6) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_3:0' shape=(291, 6) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7c10>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights:0' shape=(1001, 8) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_1:0' shape=(1001, 8) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_2:0' shape=(1001, 8) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_3:0' shape=(1001, 8) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7d10>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights:0' shape=(8001, 8) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_1:0' shape=(8001, 8) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_2:0' shape=(8001, 8) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_3:0' shape=(8001, 8) dtype=float32>}))], \n\nv0:\n[(<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fe47b59d0>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights:0' shape=(868, 10) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_1:0' shape=(868, 10) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_2:0' shape=(868, 10) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_3:0' shape=(868, 10) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fe47b5a90>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights:0' shape=(291, 6) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_1:0' shape=(291, 6) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_2:0' shape=(291, 6) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_3:0' shape=(291, 6) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fe47b5ad0>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights:0' shape=(1001, 8) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_1:0' shape=(1001, 8) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_2:0' shape=(1001, 8) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_3:0' shape=(1001, 8) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fe47b5bd0>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights:0' shape=(8001, 8) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_1:0' shape=(8001, 8) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_2:0' shape=(8001, 8) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_3:0' shape=(8001, 8) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/AddN_4:0' shape=(139, 784) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/0/weights:0' shape=(139, 784) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/0/weights/replica_1:0' shape=(139, 784) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/0/weights/replica_2:0' shape=(139, 784) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/0/weights/replica_3:0' shape=(139, 784) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/deep/layers/0/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/0/biases:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/0/biases/replica_1:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/0/biases/replica_2:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/0/biases/replica_3:0' shape=(784,) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/AddN_3:0' shape=(784, 784) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/1/weights:0' shape=(784, 784) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/1/weights/replica_1:0' shape=(784, 784) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/1/weights/replica_2:0' shape=(784, 784) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/1/weights/replica_3:0' shape=(784, 784) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/deep/layers/1/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/1/biases:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/1/biases/replica_1:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/1/biases/replica_2:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/1/biases/replica_3:0' shape=(784,) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/AddN_2:0' shape=(784, 784) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/2/weights:0' shape=(784, 784) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/2/weights/replica_1:0' shape=(784, 784) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/2/weights/replica_2:0' shape=(784, 784) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/2/weights/replica_3:0' shape=(784, 784) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/deep/layers/2/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/2/biases:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/2/biases/replica_1:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/2/biases/replica_2:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/2/biases/replica_3:0' shape=(784,) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/AddN_1:0' shape=(784, 784) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/3/weights:0' shape=(784, 784) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/3/weights/replica_1:0' shape=(784, 784) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/3/weights/replica_2:0' shape=(784, 784) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/3/weights/replica_3:0' shape=(784, 784) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/deep/layers/3/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/3/biases:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/3/biases/replica_1:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/3/biases/replica_2:0' shape=(784,) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/3/biases/replica_3:0' shape=(784,) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/AddN:0' shape=(784, 836) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/exclusive/weights:0' shape=(784, 836) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/exclusive/weights/replica_1:0' shape=(784, 836) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/exclusive/weights/replica_2:0' shape=(784, 836) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/exclusive/weights/replica_3:0' shape=(784, 836) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/deep/exclusive/BiasAdd_grad/tuple/control_dependency_1:0' shape=(836,) dtype=float32>,\n\nMirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/exclusive/biases:0' shape=(836,) dtype=float32>\n/replica:0/task:0/device:GPU:1': <tf.Variable 'deep/exclusive/biases/replica_1:0' shape=(836,) dtype=float32>\n/replica:0/task:0/device:GPU:2': <tf.Variable 'deep/exclusive/biases/replica_2:0' shape=(836,) dtype=float32>\n/replica:0/task:0/device:GPU:3': <tf.Variable 'deep/exclusive/biases/replica_3:0' shape=(836,) dtype=float32>}))]\n\nAll 4 variables are present twice in v, and are embedding_weights variables created using tf.feature_column.input_layer. My model_fn is similar to the canned DNN classifier; swapping embedding-based inputs (tf.feature_column.embedding_column) for 1-hot inputs (tf.feature_column.categorical_column_with_identity) bypasses this issue.", "body": "I came to the same conclusion, though in my case the error was (using tensorflow-gpu==1.9.0-rc2 on MLE with 4 GPUs):\r\n\r\n    Traceback (most recent call last): \r\n    File \"/usr/lib/python2.7/runpy.py\", line 174, in _run_module_as_main \"__main__\", fname, loader, pkg_name) \r\n    File \"/usr/lib/python2.7/runpy.py\", line 72, in _run_code exec code in run_globals \r\n    File \"/root/.local/lib/python2.7/site-packages/trainer/controller.py\", line 144, in <module> train(estimator) \r\n    File \"/root/.local/lib/python2.7/site-packages/trainer/controller.py\", line 28, in train throttle_secs=hparams.throttle_secs, \r\n    File \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/training.py\", line 454, in train_and_evaluate return executor.run() \r\n    File \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/training.py\", line 565, in run getattr(self, task_to_run)() \r\n    File \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/training.py\", line 622, in run_master self._start_distributed_training(saving_listeners=saving_listeners) \r\n    File \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/training.py\", line 776, in _start_distributed_training saving_listeners=saving_listeners) \r\n    File \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 375, in train loss = self._train_model(input_fn, hooks, saving_listeners) \r\n    File \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1131, in _train_model return self._train_model_distributed(input_fn, hooks, saving_listeners) \r\n    File \"/root/.local/lib/python2.7/site-packages/tensorflow/python/estimator/estimator.py\", line 1171, in _train_model_distributed self.config) \r\n    File \"/root/.local/lib/python2.7/site-packages/tensorflow/python/training/distribute.py\", line 811, in call_for_each_tower return self._call_for_each_tower(fn, *args, **kwargs) \r\n    File \"/root/.local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/mirrored_strategy.py\", line 279, in _call_for_each_tower coord.join(threads) \r\n    File \"/root/.local/lib/python2.7/site-packages/tensorflow/python/training/coordinator.py\", line 389, in join six.reraise(*self._exc_info_to_raise) \r\n    File \"/root/.local/lib/python2.7/site-packages/tensorflow/python/training/coordinator.py\", line 297, in stop_on_exception yield \r\n    File \"/root/.local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/mirrored_strategy.py\", line 262, in _call_for_each_tower {t.device: t.merge_args for t in threads}) \r\n    File \"/root/.local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/values.py\", line 471, in regroup for i in range(len(v0))) \r\n    File \"/root/.local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/values.py\", line 471, in <genexpr> for i in range(len(v0))) \r\n    File \"/root/.local/lib/python2.7/site-packages/tensorflow/contrib/distribute/python/values.py\", line 462, in regroup (len(v), len(v0), v, v0)) AssertionError: len(v) == 18, len(v0) == 14, v: [...], v0: [...]\r\n\r\nThe difference between v and v0 is that v contains 4 variables not present in v0. \r\n\r\nv:\r\n\r\n    [(<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7b10>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights:0' shape=(868, 10) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_1:0' shape=(868, 10) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_2:0' shape=(868, 10) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_3:0' shape=(868, 10) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7bd0>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights:0' shape=(291, 6) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_1:0' shape=(291, 6) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_2:0' shape=(291, 6) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_3:0' shape=(291, 6) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7c10>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights:0' shape=(1001, 8) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_1:0' shape=(1001, 8) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_2:0' shape=(1001, 8) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_3:0' shape=(1001, 8) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7d10>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights:0' shape=(8001, 8) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_1:0' shape=(8001, 8) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_2:0' shape=(8001, 8) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_3:0' shape=(8001, 8) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/AddN_4:0' shape=(139, 784) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/0/weights:0' shape=(139, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/0/weights/replica_1:0' shape=(139, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/0/weights/replica_2:0' shape=(139, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/0/weights/replica_3:0' shape=(139, 784) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/tower_1/deep/layers/0/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/0/biases:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/0/biases/replica_1:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/0/biases/replica_2:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/0/biases/replica_3:0' shape=(784,) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/AddN_3:0' shape=(784, 784) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/1/weights:0' shape=(784, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/1/weights/replica_1:0' shape=(784, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/1/weights/replica_2:0' shape=(784, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/1/weights/replica_3:0' shape=(784, 784) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/tower_1/deep/layers/1/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/1/biases:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/1/biases/replica_1:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/1/biases/replica_2:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/1/biases/replica_3:0' shape=(784,) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/AddN_2:0' shape=(784, 784) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/2/weights:0' shape=(784, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/2/weights/replica_1:0' shape=(784, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/2/weights/replica_2:0' shape=(784, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/2/weights/replica_3:0' shape=(784, 784) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/tower_1/deep/layers/2/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/2/biases:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/2/biases/replica_1:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/2/biases/replica_2:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/2/biases/replica_3:0' shape=(784,) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/AddN_1:0' shape=(784, 784) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/3/weights:0' shape=(784, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/3/weights/replica_1:0' shape=(784, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/3/weights/replica_2:0' shape=(784, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/3/weights/replica_3:0' shape=(784, 784) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/tower_1/deep/layers/3/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/3/biases:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/3/biases/replica_1:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/3/biases/replica_2:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/3/biases/replica_3:0' shape=(784,) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/AddN:0' shape=(784, 836) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/exclusive/weights:0' shape=(784, 836) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/exclusive/weights/replica_1:0' shape=(784, 836) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/exclusive/weights/replica_2:0' shape=(784, 836) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/exclusive/weights/replica_3:0' shape=(784, 836) dtype=float32>})), (<tf.Tensor 'tower_1/deep_exclusive_optimizer/gradients/tower_1/deep/exclusive/BiasAdd_grad/tuple/control_dependency_1:0' shape=(836,) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/exclusive/biases:0' shape=(836,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/exclusive/biases/replica_1:0' shape=(836,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/exclusive/biases/replica_2:0' shape=(836,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/exclusive/biases/replica_3:0' shape=(836,) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7b10>,\r\n\r\n\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights:0' shape=(868, 10) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_1:0' shape=(868, 10) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_2:0' shape=(868, 10) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_3:0' shape=(868, 10) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7bd0>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights:0' shape=(291, 6) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_1:0' shape=(291, 6) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_2:0' shape=(291, 6) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_3:0' shape=(291, 6) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7c10>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights:0' shape=(1001, 8) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_1:0' shape=(1001, 8) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_2:0' shape=(1001, 8) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_3:0' shape=(1001, 8) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fdc4c7d10>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights:0' shape=(8001, 8) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_1:0' shape=(8001, 8) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_2:0' shape=(8001, 8) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_3:0' shape=(8001, 8) dtype=float32>}))], \r\n\r\nv0:\r\n\r\n    [(<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fe47b59d0>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights:0' shape=(868, 10) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_1:0' shape=(868, 10) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_2:0' shape=(868, 10) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/brand_embedding/embedding_weights/replica_3:0' shape=(868, 10) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fe47b5a90>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights:0' shape=(291, 6) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_1:0' shape=(291, 6) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_2:0' shape=(291, 6) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_category_embedding/embedding_weights/replica_3:0' shape=(291, 6) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fe47b5ad0>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights:0' shape=(1001, 8) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_1:0' shape=(1001, 8) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_2:0' shape=(1001, 8) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/meta_rawCategory_idx_embedding/embedding_weights/replica_3:0' shape=(1001, 8) dtype=float32>})), (<tensorflow.python.framework.ops.IndexedSlices object at 0x7f9fe47b5bd0>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights:0' shape=(8001, 8) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_1:0' shape=(8001, 8) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_2:0' shape=(8001, 8) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/input_from_feature_columns/input_layer/title_refined_idx_embedding/embedding_weights/replica_3:0' shape=(8001, 8) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/AddN_4:0' shape=(139, 784) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/0/weights:0' shape=(139, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/0/weights/replica_1:0' shape=(139, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/0/weights/replica_2:0' shape=(139, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/0/weights/replica_3:0' shape=(139, 784) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/deep/layers/0/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/0/biases:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/0/biases/replica_1:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/0/biases/replica_2:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/0/biases/replica_3:0' shape=(784,) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/AddN_3:0' shape=(784, 784) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/1/weights:0' shape=(784, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/1/weights/replica_1:0' shape=(784, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/1/weights/replica_2:0' shape=(784, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/1/weights/replica_3:0' shape=(784, 784) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/deep/layers/1/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/1/biases:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/1/biases/replica_1:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/1/biases/replica_2:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/1/biases/replica_3:0' shape=(784,) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/AddN_2:0' shape=(784, 784) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/2/weights:0' shape=(784, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/2/weights/replica_1:0' shape=(784, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/2/weights/replica_2:0' shape=(784, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/2/weights/replica_3:0' shape=(784, 784) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/deep/layers/2/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/2/biases:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/2/biases/replica_1:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/2/biases/replica_2:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/2/biases/replica_3:0' shape=(784,) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/AddN_1:0' shape=(784, 784) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/3/weights:0' shape=(784, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/3/weights/replica_1:0' shape=(784, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/3/weights/replica_2:0' shape=(784, 784) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/3/weights/replica_3:0' shape=(784, 784) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/deep/layers/3/BiasAdd_grad/tuple/control_dependency_1:0' shape=(784,) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/layers/3/biases:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/layers/3/biases/replica_1:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/layers/3/biases/replica_2:0' shape=(784,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/layers/3/biases/replica_3:0' shape=(784,) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/AddN:0' shape=(784, 836) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/exclusive/weights:0' shape=(784, 836) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/exclusive/weights/replica_1:0' shape=(784, 836) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/exclusive/weights/replica_2:0' shape=(784, 836) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/exclusive/weights/replica_3:0' shape=(784, 836) dtype=float32>})), (<tf.Tensor 'deep_exclusive_optimizer/gradients/deep/exclusive/BiasAdd_grad/tuple/control_dependency_1:0' shape=(836,) dtype=float32>,\r\n\r\n    MirroredVariable({'/replica:0/task:0/device:GPU:0': <tf.Variable 'deep/exclusive/biases:0' shape=(836,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:1': <tf.Variable 'deep/exclusive/biases/replica_1:0' shape=(836,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:2': <tf.Variable 'deep/exclusive/biases/replica_2:0' shape=(836,) dtype=float32>\r\n    /replica:0/task:0/device:GPU:3': <tf.Variable 'deep/exclusive/biases/replica_3:0' shape=(836,) dtype=float32>}))]\r\n\r\nAll 4 variables are present twice in v, and are `embedding_weights` variables created using `tf.feature_column.input_layer`. My model_fn is similar to the [canned DNN classifier](https://github.com/tensorflow/tensorflow/blob/r1.9/tensorflow/python/estimator/canned/dnn.py#L86); swapping embedding-based inputs (tf.feature_column.embedding_column) for 1-hot inputs (tf.feature_column.categorical_column_with_identity) bypasses this issue."}