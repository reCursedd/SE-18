{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13863", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13863/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13863/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13863/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/13863", "id": 267264777, "node_id": "MDExOlB1bGxSZXF1ZXN0MTQ3ODY2MTc3", "number": 13863, "title": "Fix crash when `int64` axis is passed to `tf.reduce_sum`", "user": {"login": "yongtang", "id": 6932348, "node_id": "MDQ6VXNlcjY5MzIzNDg=", "avatar_url": "https://avatars0.githubusercontent.com/u/6932348?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yongtang", "html_url": "https://github.com/yongtang", "followers_url": "https://api.github.com/users/yongtang/followers", "following_url": "https://api.github.com/users/yongtang/following{/other_user}", "gists_url": "https://api.github.com/users/yongtang/gists{/gist_id}", "starred_url": "https://api.github.com/users/yongtang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yongtang/subscriptions", "organizations_url": "https://api.github.com/users/yongtang/orgs", "repos_url": "https://api.github.com/users/yongtang/repos", "events_url": "https://api.github.com/users/yongtang/events{/privacy}", "received_events_url": "https://api.github.com/users/yongtang/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "vrv", "id": 463737, "node_id": "MDQ6VXNlcjQ2MzczNw==", "avatar_url": "https://avatars0.githubusercontent.com/u/463737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vrv", "html_url": "https://github.com/vrv", "followers_url": "https://api.github.com/users/vrv/followers", "following_url": "https://api.github.com/users/vrv/following{/other_user}", "gists_url": "https://api.github.com/users/vrv/gists{/gist_id}", "starred_url": "https://api.github.com/users/vrv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vrv/subscriptions", "organizations_url": "https://api.github.com/users/vrv/orgs", "repos_url": "https://api.github.com/users/vrv/repos", "events_url": "https://api.github.com/users/vrv/events{/privacy}", "received_events_url": "https://api.github.com/users/vrv/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "vrv", "id": 463737, "node_id": "MDQ6VXNlcjQ2MzczNw==", "avatar_url": "https://avatars0.githubusercontent.com/u/463737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vrv", "html_url": "https://github.com/vrv", "followers_url": "https://api.github.com/users/vrv/followers", "following_url": "https://api.github.com/users/vrv/following{/other_user}", "gists_url": "https://api.github.com/users/vrv/gists{/gist_id}", "starred_url": "https://api.github.com/users/vrv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vrv/subscriptions", "organizations_url": "https://api.github.com/users/vrv/orgs", "repos_url": "https://api.github.com/users/vrv/repos", "events_url": "https://api.github.com/users/vrv/events{/privacy}", "received_events_url": "https://api.github.com/users/vrv/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2017-10-20T18:31:16Z", "updated_at": "2017-10-21T15:08:55Z", "closed_at": "2017-10-21T00:40:41Z", "author_association": "MEMBER", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13863", "html_url": "https://github.com/tensorflow/tensorflow/pull/13863", "diff_url": "https://github.com/tensorflow/tensorflow/pull/13863.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/13863.patch"}, "body_html": "<p>This fix tries to fix the crash triggered by <code>int64</code> axis passed to <code>tf.reduce_sum</code>:</p>\n<pre><code>ubuntu@ubuntu:~/tensorflow2$ (cd &amp;&amp; python)\nPython 2.7.12 (default, Nov 19 2016, 06:48:10)\n[GCC 5.4.0 20160609] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n&gt;&gt;&gt; import tensorflow as tf\n&gt;&gt;&gt; v = tf.reduce_sum([1,2,3], tf.constant(0, tf.int64))\n2017-10-20 15:55:06.993430: F tensorflow/core/framework/tensor.cc:601] Check failed: dtype() == expected_dtype (9 vs. 3)\nubuntu@ubuntu:~/tensorflow2$\n</code></pre>\n<p>The issue is caused by the fact that shape inference in <code>common_shape_fns.cc</code> only assumes int32 without proper handling of diffent types. In <code>math_ops.cc</code> both int32 and int64 are mentioned.</p>\n<p>NOTE that this fix does not address the issue that int64 is not supported. To allow int64 axis it is more than adding a template in <code>ReductionOp</code> as the type of the axis seems to be decided by some other ways in Eigen. Will investigate that later.</p>\n<p>This fix merely fixed the crash so that an error message will return without exit from the python program \"No OpKernel was registered to support Op 'Sum' with these attrs\".</p>\n<p>Still, its worth to at least allow the program not to exit in case an error happens.</p>\n<p>Signed-off-by: Yong Tang <a href=\"mailto:yong.tang.github@outlook.com\">yong.tang.github@outlook.com</a></p>", "body_text": "This fix tries to fix the crash triggered by int64 axis passed to tf.reduce_sum:\nubuntu@ubuntu:~/tensorflow2$ (cd && python)\nPython 2.7.12 (default, Nov 19 2016, 06:48:10)\n[GCC 5.4.0 20160609] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import tensorflow as tf\n>>> v = tf.reduce_sum([1,2,3], tf.constant(0, tf.int64))\n2017-10-20 15:55:06.993430: F tensorflow/core/framework/tensor.cc:601] Check failed: dtype() == expected_dtype (9 vs. 3)\nubuntu@ubuntu:~/tensorflow2$\n\nThe issue is caused by the fact that shape inference in common_shape_fns.cc only assumes int32 without proper handling of diffent types. In math_ops.cc both int32 and int64 are mentioned.\nNOTE that this fix does not address the issue that int64 is not supported. To allow int64 axis it is more than adding a template in ReductionOp as the type of the axis seems to be decided by some other ways in Eigen. Will investigate that later.\nThis fix merely fixed the crash so that an error message will return without exit from the python program \"No OpKernel was registered to support Op 'Sum' with these attrs\".\nStill, its worth to at least allow the program not to exit in case an error happens.\nSigned-off-by: Yong Tang yong.tang.github@outlook.com", "body": "This fix tries to fix the crash triggered by `int64` axis passed to `tf.reduce_sum`:\r\n```\r\nubuntu@ubuntu:~/tensorflow2$ (cd && python)\r\nPython 2.7.12 (default, Nov 19 2016, 06:48:10)\r\n[GCC 5.4.0 20160609] on linux2\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import tensorflow as tf\r\n>>> v = tf.reduce_sum([1,2,3], tf.constant(0, tf.int64))\r\n2017-10-20 15:55:06.993430: F tensorflow/core/framework/tensor.cc:601] Check failed: dtype() == expected_dtype (9 vs. 3)\r\nubuntu@ubuntu:~/tensorflow2$\r\n```\r\n\r\nThe issue is caused by the fact that shape inference in `common_shape_fns.cc` only assumes int32 without proper handling of diffent types. In `math_ops.cc` both int32 and int64 are mentioned.\r\n\r\nNOTE that this fix does not address the issue that int64 is not supported. To allow int64 axis it is more than adding a template in `ReductionOp` as the type of the axis seems to be decided by some other ways in Eigen. Will investigate that later.\r\n\r\nThis fix merely fixed the crash so that an error message will return without exit from the python program \"No OpKernel was registered to support Op 'Sum' with these attrs\".\r\n\r\nStill, its worth to at least allow the program not to exit in case an error happens.\r\n\r\nSigned-off-by: Yong Tang <yong.tang.github@outlook.com>"}