{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/193574171", "pull_request_review_id": 126573170, "id": 193574171, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5MzU3NDE3MQ==", "diff_hunk": "@@ -743,24 +743,51 @@ set(api_init_list_file \"${tensorflow_source_dir}/api_init_files_list.txt\")\n file(WRITE \"${api_init_list_file}\" \"${api_init_files}\")\n \n # Run create_python_api.py to generate __init__.py files.\n-add_custom_command(\n-      OUTPUT ${api_init_files}\n-      DEPENDS tf_python_ops tf_python_copy_scripts_to_destination pywrap_tensorflow_internal tf_python_touchup_modules tf_extension_ops\n-\n-      # tensorflow/__init__.py depends on files generated in this step. So, remove it while\n-      # this step is running since the files aren't there yet.\n-      COMMAND ${CMAKE_COMMAND} -E remove -f ${CMAKE_CURRENT_BINARY_DIR}/tf_python/tensorflow/__init__.py\n-\n-      # Run create_python_api.py to generate API init files.\n-      COMMAND ${CMAKE_COMMAND} -E env PYTHONPATH=${CMAKE_CURRENT_BINARY_DIR}/tf_python ${PYTHON_EXECUTABLE}\n-              \"${CMAKE_CURRENT_BINARY_DIR}/tf_python/tensorflow/tools/api/generator/create_python_api.py\"\n-              \"--root_init_template=${CMAKE_CURRENT_BINARY_DIR}/tf_python/tensorflow/api_template.__init__.py\"\n-              \"--apidir=${CMAKE_CURRENT_BINARY_DIR}/tf_python/tensorflow\"\n-              \"${api_init_list_file}\"\n-\n-      COMMENT \"Generating __init__.py files for Python API.\"\n-      WORKING_DIRECTORY \"${CMAKE_CURRENT_BINARY_DIR}/tf_python\"\n-)\n+if (tensorflow_ENABLE_MKL_SUPPORT)\n+    # add mkl dist dlls to system path for python\n+    # TODO: In current cmake version, PY_RUNTIME_ENV behaves strange with multiple paths,\n+    # so we have to specify only one path in it to work around the issue. We need this if/else\n+    # to protect overwriting CUDA environments\n+    set(PY_RUNTIME_ENV ${mkl_BIN_DIRS})\n+    add_custom_command(", "path": "tensorflow/contrib/cmake/tf_python.cmake", "position": 39, "original_position": 28, "commit_id": "0eaef273d91f149cae8a0a45893a4af32735bdee", "original_commit_id": "f63d264a977784a7ea9bc41b132689e9df630eca", "user": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "body": "Why is this code moved inside the `if(tensorflow_ENABLE_MKL_SUPPORT)` block and replicated in the `else()` block?\r\n\r\nAs far as I can tell it is identical in both branches, so please revert it to the top level if possible.", "created_at": "2018-06-06T22:06:12Z", "updated_at": "2018-06-13T08:40:26Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/19715#discussion_r193574171", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/19715", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/193574171"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/19715#discussion_r193574171"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/19715"}}, "body_html": "<p>Why is this code moved inside the <code>if(tensorflow_ENABLE_MKL_SUPPORT)</code> block and replicated in the <code>else()</code> block?</p>\n<p>As far as I can tell it is identical in both branches, so please revert it to the top level if possible.</p>", "body_text": "Why is this code moved inside the if(tensorflow_ENABLE_MKL_SUPPORT) block and replicated in the else() block?\nAs far as I can tell it is identical in both branches, so please revert it to the top level if possible."}