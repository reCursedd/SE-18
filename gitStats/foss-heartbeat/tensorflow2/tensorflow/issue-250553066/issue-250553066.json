{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12319", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12319/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12319/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12319/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/12319", "id": 250553066, "node_id": "MDU6SXNzdWUyNTA1NTMwNjY=", "number": 12319, "title": "session_t->Create() Failed using tensorflow exported model on IOS", "user": {"login": "jakajacky", "id": 16397721, "node_id": "MDQ6VXNlcjE2Mzk3NzIx", "avatar_url": "https://avatars0.githubusercontent.com/u/16397721?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakajacky", "html_url": "https://github.com/jakajacky", "followers_url": "https://api.github.com/users/jakajacky/followers", "following_url": "https://api.github.com/users/jakajacky/following{/other_user}", "gists_url": "https://api.github.com/users/jakajacky/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakajacky/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakajacky/subscriptions", "organizations_url": "https://api.github.com/users/jakajacky/orgs", "repos_url": "https://api.github.com/users/jakajacky/repos", "events_url": "https://api.github.com/users/jakajacky/events{/privacy}", "received_events_url": "https://api.github.com/users/jakajacky/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2017-08-16T08:44:15Z", "updated_at": "2017-12-20T02:38:38Z", "closed_at": "2017-12-20T02:38:38Z", "author_association": "NONE", "body_html": "<p>Please go to Stack Overflow for help and support:</p>\n<p><a href=\"https://stackoverflow.com/questions/tagged/tensorflow\" rel=\"nofollow\">https://stackoverflow.com/questions/tagged/tensorflow</a></p>\n<p>If you open a GitHub issue, here is our policy:</p>\n<ol>\n<li>It must be a bug or a feature request.</li>\n<li>The form below must be filled out.</li>\n<li>It shouldn't be a TensorBoard issue. Those go <a href=\"https://github.com/tensorflow/tensorboard/issues\">here</a>.</li>\n</ol>\n<p><strong>Here's why we have that policy</strong>: TensorFlow developers respond to issues. We want to focus on work that benefits the whole community, e.g., fixing bugs and adding features. Support only helps individuals. GitHub also notifies thousands of people when issues are filed. We want them to see you communicating an interesting problem, rather than being redirected to Stack Overflow.</p>\n<hr>\n<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: YES</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nGenerating Tensorflow model:  Ubuntu 16.04 LTS (GNU/Linux 4.4.0-91-generic x86_64)<br>\nLoad Tensorflow model: macOS 10.12 Sierra</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: TensorFlow is installed from source</li>\n<li><strong>TensorFlow version (use command below)</strong>: TensorFlow version 1.2.0</li>\n<li><strong>Python version</strong>: Python version 3.5</li>\n<li><strong>Bazel version (if compiling from source)</strong>: Bazel version  0.5.3</li>\n<li><strong>CUDA/cuDNN version</strong>: None</li>\n<li><strong>GPU model and memory</strong>: NA</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>Error happen when call \"status = session_t-&gt;Create(graph)\"</p>\n<p>error message:<br>\n2017-08-16 13:22:27.692781+0800 CameraExample[6322:2753781] Error adding graph to session: No OpKernel was registered to support Op 'RandomUniform' with these attrs.  Registered devices: [CPU], Registered kernels:<br>\n</p>\n<h3>Source code / logs</h3>\n<h2>Export models as *.pb file: (In python)<br>\nself.saver.save(self.sess, self.my_path_to_model + \"model.ckpt\", global_step=i)<br>\noutput_graph_def = tf.graph_util.convert_variables_to_constants(self.sess,self.sess.graph_def,output_node_names=['models_simple/y_conv'])<br>\nwith tf.gfile.FastGFile(self.my_path_to_model+ 'graph.pb', mode = 'wb') as f:<br>\nf.write(output_graph_def.SerializeToString())</h2>\n<p>IOS:</p>\n<h2>use the following operations to process exported model</h2>\n<p>#Call freeze_graph, synthesize graph.pb and CKPT, generate frozen.pb<br>\nbazel-bin/tensorflow/python/tools/freeze_graph <br>\n--input_graph=XXXX/graph.pb <br>\n--input_checkpoint=XXXX/model.ckpt-0 <br>\n--output_node_names=models_simple/Placeholder,models_simple/y_conv <br>\n--input_binary <br>\n--output_graph=XXXX/frozen.pb</p>\n<p>#Call optimize_for_inference, reduce the operation, replace the calculation can not run in the iOS version, generate inference.pb<br>\nbazel-bin/tensorflow/python/tools/optimize_for_inference <br>\n--input=XXXX/frozen.pb <br>\n--output=XXXX/inference.pb <br>\n--input_names=models_simple/Placeholder <br>\n--output_names=models_simple/y_conv <br>\n--frozen_graph=True</p>\n<h2>#Call quantize_graph to further optimize the graph, generate rounded_graph.pb<br>\nbazel-bin/tensorflow/tools/quantization/quantize_graph <br>\n--input=XXXX/inference.pb <br>\n--output=XXXX/rounded_graph.pb <br>\n--output_node_names=models_simple/y_conv <br>\n--mode=weights_rounded</h2>\n<p>Then, execute the following code, (BOOL)loadGraphFromPath executed successfully, but error raised at \"status = session_t-&gt;Create(graph)\"</p>\n<ul>\n<li>\n<p>(BOOL)loadGraphFromPath:(NSString *)path<br>\n{<br>\nauto status = ReadBinaryProto(tensorflow::Env::Default(), path.fileSystemRepresentation, &amp;graph);<br>\nif (!status.ok()) {<br>\nNSLog(@\"Error reading graph: %s\", status.error_message().c_str());<br>\nreturn NO;<br>\n}</p>\n<p>// This prints out the names of the nodes in the graph.<br>\nauto nodeCount = graph.node_size();<br>\nNSLog(@\"Node count: %d\", nodeCount);<br>\nfor (auto i = 0; i &lt; nodeCount; ++i) {<br>\nauto node = graph.node(i);<br>\nNSLog(@\"Node %d: %s '%s'\", i, node.op().c_str(), node.name().c_str());<br>\n}</p>\n<p>return YES;<br>\n}</p>\n</li>\n</ul>\n<p>create tf session:</p>\n<ul>\n<li>\n<p>(BOOL)createSession<br>\n{<br>\ntensorflow::SessionOptions options;<br>\nauto status = tensorflow::NewSession(options, &amp;session_t);<br>\nif (!status.ok()) {<br>\nNSLog(@\"Error creating session: %s\", status.error_message().c_str());<br>\nreturn NO;<br>\n}</p>\n<p>status = session_t-&gt;Create(graph);<br>\nif (!status.ok()) {<br>\n// error<br>\nNSLog(@\"Error adding graph to session: %s\", status.error_message().c_str());<br>\nreturn NO;<br>\n}</p>\n<p>return YES;<br>\n}</p>\n</li>\n</ul>\n<p>error message:<br>\n2017-08-16 13:22:27.692781+0800 CameraExample[6322:2753781] Error adding graph to session: No OpKernel was registered to support Op 'RandomUniform' with these attrs.  Registered devices: [CPU], Registered kernels:<br>\n</p>\n<pre><code> [[Node: dropout/random_uniform/RandomUniform = RandomUniform[T=DT_INT32, dtype=DT_FLOAT, seed=87654321, seed2=24](dropout/Shape)]]\n</code></pre>\n<h1>It seems that RandomUniform was not supported on iOS , but when I called freeze_graph, those which are not supported on iOS should be deleted. What can I do for this problem?</h1>", "body_text": "Please go to Stack Overflow for help and support:\nhttps://stackoverflow.com/questions/tagged/tensorflow\nIf you open a GitHub issue, here is our policy:\n\nIt must be a bug or a feature request.\nThe form below must be filled out.\nIt shouldn't be a TensorBoard issue. Those go here.\n\nHere's why we have that policy: TensorFlow developers respond to issues. We want to focus on work that benefits the whole community, e.g., fixing bugs and adding features. Support only helps individuals. GitHub also notifies thousands of people when issues are filed. We want them to see you communicating an interesting problem, rather than being redirected to Stack Overflow.\n\nSystem information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): YES\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nGenerating Tensorflow model:  Ubuntu 16.04 LTS (GNU/Linux 4.4.0-91-generic x86_64)\nLoad Tensorflow model: macOS 10.12 Sierra\nTensorFlow installed from (source or binary): TensorFlow is installed from source\nTensorFlow version (use command below): TensorFlow version 1.2.0\nPython version: Python version 3.5\nBazel version (if compiling from source): Bazel version  0.5.3\nCUDA/cuDNN version: None\nGPU model and memory: NA\nExact command to reproduce:\n\nDescribe the problem\nError happen when call \"status = session_t->Create(graph)\"\nerror message:\n2017-08-16 13:22:27.692781+0800 CameraExample[6322:2753781] Error adding graph to session: No OpKernel was registered to support Op 'RandomUniform' with these attrs.  Registered devices: [CPU], Registered kernels:\n\nSource code / logs\nExport models as *.pb file: (In python)\nself.saver.save(self.sess, self.my_path_to_model + \"model.ckpt\", global_step=i)\noutput_graph_def = tf.graph_util.convert_variables_to_constants(self.sess,self.sess.graph_def,output_node_names=['models_simple/y_conv'])\nwith tf.gfile.FastGFile(self.my_path_to_model+ 'graph.pb', mode = 'wb') as f:\nf.write(output_graph_def.SerializeToString())\nIOS:\nuse the following operations to process exported model\n#Call freeze_graph, synthesize graph.pb and CKPT, generate frozen.pb\nbazel-bin/tensorflow/python/tools/freeze_graph \n--input_graph=XXXX/graph.pb \n--input_checkpoint=XXXX/model.ckpt-0 \n--output_node_names=models_simple/Placeholder,models_simple/y_conv \n--input_binary \n--output_graph=XXXX/frozen.pb\n#Call optimize_for_inference, reduce the operation, replace the calculation can not run in the iOS version, generate inference.pb\nbazel-bin/tensorflow/python/tools/optimize_for_inference \n--input=XXXX/frozen.pb \n--output=XXXX/inference.pb \n--input_names=models_simple/Placeholder \n--output_names=models_simple/y_conv \n--frozen_graph=True\n#Call quantize_graph to further optimize the graph, generate rounded_graph.pb\nbazel-bin/tensorflow/tools/quantization/quantize_graph \n--input=XXXX/inference.pb \n--output=XXXX/rounded_graph.pb \n--output_node_names=models_simple/y_conv \n--mode=weights_rounded\nThen, execute the following code, (BOOL)loadGraphFromPath executed successfully, but error raised at \"status = session_t->Create(graph)\"\n\n\n(BOOL)loadGraphFromPath:(NSString *)path\n{\nauto status = ReadBinaryProto(tensorflow::Env::Default(), path.fileSystemRepresentation, &graph);\nif (!status.ok()) {\nNSLog(@\"Error reading graph: %s\", status.error_message().c_str());\nreturn NO;\n}\n// This prints out the names of the nodes in the graph.\nauto nodeCount = graph.node_size();\nNSLog(@\"Node count: %d\", nodeCount);\nfor (auto i = 0; i < nodeCount; ++i) {\nauto node = graph.node(i);\nNSLog(@\"Node %d: %s '%s'\", i, node.op().c_str(), node.name().c_str());\n}\nreturn YES;\n}\n\n\ncreate tf session:\n\n\n(BOOL)createSession\n{\ntensorflow::SessionOptions options;\nauto status = tensorflow::NewSession(options, &session_t);\nif (!status.ok()) {\nNSLog(@\"Error creating session: %s\", status.error_message().c_str());\nreturn NO;\n}\nstatus = session_t->Create(graph);\nif (!status.ok()) {\n// error\nNSLog(@\"Error adding graph to session: %s\", status.error_message().c_str());\nreturn NO;\n}\nreturn YES;\n}\n\n\nerror message:\n2017-08-16 13:22:27.692781+0800 CameraExample[6322:2753781] Error adding graph to session: No OpKernel was registered to support Op 'RandomUniform' with these attrs.  Registered devices: [CPU], Registered kernels:\n\n [[Node: dropout/random_uniform/RandomUniform = RandomUniform[T=DT_INT32, dtype=DT_FLOAT, seed=87654321, seed2=24](dropout/Shape)]]\n\nIt seems that RandomUniform was not supported on iOS , but when I called freeze_graph, those which are not supported on iOS should be deleted. What can I do for this problem?", "body": "Please go to Stack Overflow for help and support:\r\n\r\nhttps://stackoverflow.com/questions/tagged/tensorflow\r\n\r\nIf you open a GitHub issue, here is our policy:\r\n\r\n1. It must be a bug or a feature request.\r\n2. The form below must be filled out.\r\n3. It shouldn't be a TensorBoard issue. Those go [here](https://github.com/tensorflow/tensorboard/issues).\r\n\r\n**Here's why we have that policy**: TensorFlow developers respond to issues. We want to focus on work that benefits the whole community, e.g., fixing bugs and adding features. Support only helps individuals. GitHub also notifies thousands of people when issues are filed. We want them to see you communicating an interesting problem, rather than being redirected to Stack Overflow.\r\n\r\n------------------------\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: YES\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: \r\nGenerating Tensorflow model:  Ubuntu 16.04 LTS (GNU/Linux 4.4.0-91-generic x86_64)\r\nLoad Tensorflow model: macOS 10.12 Sierra\r\n- **TensorFlow installed from (source or binary)**: TensorFlow is installed from source\r\n- **TensorFlow version (use command below)**: TensorFlow version 1.2.0\r\n- **Python version**: Python version 3.5\r\n- **Bazel version (if compiling from source)**: Bazel version  0.5.3\r\n- **CUDA/cuDNN version**: None\r\n- **GPU model and memory**: NA\r\n- **Exact command to reproduce**:\r\n\r\n\r\n### Describe the problem\r\nError happen when call \"status = session_t->Create(graph)\"\r\n\r\nerror message:\r\n2017-08-16 13:22:27.692781+0800 CameraExample[6322:2753781] Error adding graph to session: No OpKernel was registered to support Op 'RandomUniform' with these attrs.  Registered devices: [CPU], Registered kernels:\r\n  <no registered kernels>\r\n\r\n\r\n### Source code / logs\r\nExport models as *.pb file: (In python)\r\nself.saver.save(self.sess, self.my_path_to_model + \"model.ckpt\", global_step=i)\r\n\t\toutput_graph_def = tf.graph_util.convert_variables_to_constants(self.sess,self.sess.graph_def,output_node_names=['models_simple/y_conv'])\r\n\t\t\twith tf.gfile.FastGFile(self.my_path_to_model+ 'graph.pb', mode = 'wb') as f:\r\n\t\t\t\tf.write(output_graph_def.SerializeToString())\r\n------------------------------------------------------------------------------------\r\nIOS:\r\n\r\nuse the following operations to process exported model\r\n ------------------------------------------------------------------------------------\r\n#Call freeze_graph, synthesize graph.pb and CKPT, generate frozen.pb\r\nbazel-bin/tensorflow/python/tools/freeze_graph \\\r\n  --input_graph=XXXX/graph.pb \\\r\n  --input_checkpoint=XXXX/model.ckpt-0 \\\r\n  --output_node_names=models_simple/Placeholder,models_simple/y_conv \\\r\n  --input_binary \\\r\n  --output_graph=XXXX/frozen.pb\r\n\r\n#Call optimize_for_inference, reduce the operation, replace the calculation can not run in the iOS version, generate inference.pb\r\nbazel-bin/tensorflow/python/tools/optimize_for_inference \\\r\n  --input=XXXX/frozen.pb \\\r\n  --output=XXXX/inference.pb \\\r\n  --input_names=models_simple/Placeholder \\\r\n  --output_names=models_simple/y_conv \\\r\n  --frozen_graph=True\r\n\r\n#Call quantize_graph to further optimize the graph, generate rounded_graph.pb\r\nbazel-bin/tensorflow/tools/quantization/quantize_graph \\\r\n  --input=XXXX/inference.pb \\\r\n  --output=XXXX/rounded_graph.pb \\\r\n  --output_node_names=models_simple/y_conv \\\r\n  --mode=weights_rounded\r\n-------------------------------------------------------------------------------------------\r\n\r\nThen, execute the following code, (BOOL)loadGraphFromPath executed successfully, but error raised at \"status = session_t->Create(graph)\"\r\n\r\n- (BOOL)loadGraphFromPath:(NSString *)path\r\n{\r\n  auto status = ReadBinaryProto(tensorflow::Env::Default(), path.fileSystemRepresentation, &graph);\r\n  if (!status.ok()) {\r\n    NSLog(@\"Error reading graph: %s\", status.error_message().c_str());\r\n    return NO;\r\n  }\r\n  \r\n  // This prints out the names of the nodes in the graph.\r\n  auto nodeCount = graph.node_size();\r\n  NSLog(@\"Node count: %d\", nodeCount);\r\n  for (auto i = 0; i < nodeCount; ++i) {\r\n    auto node = graph.node(i);\r\n    NSLog(@\"Node %d: %s '%s'\", i, node.op().c_str(), node.name().c_str());\r\n  }\r\n  \r\n  return YES;\r\n}\r\n\r\ncreate tf session:\r\n- (BOOL)createSession\r\n{\r\n  tensorflow::SessionOptions options;\r\n  auto status = tensorflow::NewSession(options, &session_t);\r\n  if (!status.ok()) {\r\n    NSLog(@\"Error creating session: %s\", status.error_message().c_str());\r\n    return NO;\r\n  }\r\n  \r\n  status = session_t->Create(graph);\r\n  if (!status.ok()) {\r\n  // error\r\n    NSLog(@\"Error adding graph to session: %s\", status.error_message().c_str());\r\n    return NO;\r\n  }\r\n  \r\n  return YES;\r\n}\r\n\r\nerror message:\r\n2017-08-16 13:22:27.692781+0800 CameraExample[6322:2753781] Error adding graph to session: No OpKernel was registered to support Op 'RandomUniform' with these attrs.  Registered devices: [CPU], Registered kernels:\r\n  <no registered kernels>\r\n\r\n\t [[Node: dropout/random_uniform/RandomUniform = RandomUniform[T=DT_INT32, dtype=DT_FLOAT, seed=87654321, seed2=24](dropout/Shape)]]\r\n\r\n# It seems that RandomUniform was not supported on iOS , but when I called freeze_graph, those which are not supported on iOS should be deleted. What can I do for this problem?\r\n"}