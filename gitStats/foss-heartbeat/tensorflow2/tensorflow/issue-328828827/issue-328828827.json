{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19721", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19721/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19721/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19721/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/19721", "id": 328828827, "node_id": "MDU6SXNzdWUzMjg4Mjg4Mjc=", "number": 19721, "title": "UnicodeDecodeError while loading trained model through import_meta_graph function.", "user": {"login": "sekharvth", "id": 37143160, "node_id": "MDQ6VXNlcjM3MTQzMTYw", "avatar_url": "https://avatars3.githubusercontent.com/u/37143160?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sekharvth", "html_url": "https://github.com/sekharvth", "followers_url": "https://api.github.com/users/sekharvth/followers", "following_url": "https://api.github.com/users/sekharvth/following{/other_user}", "gists_url": "https://api.github.com/users/sekharvth/gists{/gist_id}", "starred_url": "https://api.github.com/users/sekharvth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sekharvth/subscriptions", "organizations_url": "https://api.github.com/users/sekharvth/orgs", "repos_url": "https://api.github.com/users/sekharvth/repos", "events_url": "https://api.github.com/users/sekharvth/events{/privacy}", "received_events_url": "https://api.github.com/users/sekharvth/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-06-03T13:29:01Z", "updated_at": "2018-06-03T17:20:05Z", "closed_at": "2018-06-03T17:20:05Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:</li>\n</ul>\n<p>Yes.</p>\n<ul>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:</li>\n</ul>\n<p>Windows 10 Home, but using online Jupyter Notebook environment for coding purposes</p>\n<ul>\n<li><strong>TensorFlow version (use command below)</strong>:</li>\n</ul>\n<p>Version : 1.8.0</p>\n<ul>\n<li><strong>Python version</strong>:</li>\n</ul>\n<p>3.6.3</p>\n<ul>\n<li><strong>Bazel version (if compiling from source)</strong>:</li>\n</ul>\n<p>N/A</p>\n<ul>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>:</li>\n</ul>\n<p>N/A</p>\n<ul>\n<li><strong>CUDA/cuDNN version</strong>:</li>\n</ul>\n<p>N/A</p>\n<ul>\n<li><strong>GPU model and memory</strong>:</li>\n</ul>\n<p>Tesla K80, 11.5 GB RAM</p>\n<ul>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<p>new_saver = tf.train.import_meta_graph('model-21-epochs.meta')</p>\n<h3>Describe the problem</h3>\n<p>I trained a text classification model on an online Jupyter Notebook, and saved models at each epoch to evaluate the best performing one. On the notebook itself, after the training session is over, running the tf.train.import_meta_graph() function seemed to work fine.</p>\n<p><strong>I then downloaded all 3 files : the .meta file, the .data-00000-of-00001 file and the .index file</strong> and on running it locally on my machine, I get a UnicodeDecodeError like this :</p>\n<pre><code>2018-06-03 17:46:04.730649: I T:\\src\\github\\tensorflow\\tensorflow\\core\\platform\\cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2\nTraceback (most recent call last):\n  File \"code.py\", line 14, in &lt;module&gt;\n    new_saver = tf.train.import_meta_graph('model-31.meta')\n  File \"C:\\Users\\sekha\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow\\python\\training\\saver.py\", line 1947, in import_meta_graph\n    meta_graph_def = meta_graph.read_meta_graph_file(meta_graph_or_file)\n  File \"C:\\Users\\sekha\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow\\python\\framework\\meta_graph.py\", line 643, in read_meta_graph_file\n    text_format.Merge(file_content.decode(\"utf-8\"), meta_graph_def)\nUnicodeDecodeError: 'utf-8' codec can't decode byte 0xc3 in position 1: invalid continuation byte\n</code></pre>\n<p>The online notebook only stores files on it for a certain amount of time, and after that they are deleted. So I uploaded the meta file on the notebook again, to see if the problem persisted on a new session ( session on the notebook, not used in the tensorflow 'session' lingo ) in the notebook. And it gave me the same error then too.</p>\n<p>An issue almost identical to this one has been raised fairly recently in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"326746091\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/19573\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/19573/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/19573\">#19573</a> but there hasn't been an update at all. And this was asked on StackOverflow too, to which the response was that it might be a bug  and github was the place for it, as can be seen in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"326746091\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/19573\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/19573/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/19573\">#19573</a>.</p>\n<p>For reference, this is the entire inference portion of the code:</p>\n<pre><code>graph = tf.Graph()\nwith tf.Session(graph = graph) as sess: \n    \n      new_saver = tf.train.import_meta_graph('/content/runs/1527946417/checkpoints/model-31.meta') \n      new_saver.restore(sess, ('/content/runs/1527946417/checkpoints/model-31'))\n      sess.run(tf.tables_initializer())\n      e = (graph.get_operations())\n \n      arr_placeholder = graph.get_operation_by_name('arr_placeholder/inp_array').outputs[0]\n      str_placeholder = graph.get_tensor_by_name('str_placeholder/inp_string:0')\n      dropout_keep_prob = graph.get_operation_by_name('dropout_keep_prob/keep_prob').outputs[0]\n      \n      logis = (graph.get_operation_by_name('logits/scores')).outputs[0]\n\n      a =  (sess.run(logis, feed_dict = {arr_placeholder : x_dev, dropout_keep_prob : 1.0, str_placeholder : ls[4731:]}))\n</code></pre>\n<p>So is it the case that saved models and meta graphs only be restored from the directory it was saved to during the training phase? Is it impossible to run inference on a pre-trained model downloaded from an online source?</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\n\nYes.\n\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\n\nWindows 10 Home, but using online Jupyter Notebook environment for coding purposes\n\nTensorFlow version (use command below):\n\nVersion : 1.8.0\n\nPython version:\n\n3.6.3\n\nBazel version (if compiling from source):\n\nN/A\n\nGCC/Compiler version (if compiling from source):\n\nN/A\n\nCUDA/cuDNN version:\n\nN/A\n\nGPU model and memory:\n\nTesla K80, 11.5 GB RAM\n\nExact command to reproduce:\n\nnew_saver = tf.train.import_meta_graph('model-21-epochs.meta')\nDescribe the problem\nI trained a text classification model on an online Jupyter Notebook, and saved models at each epoch to evaluate the best performing one. On the notebook itself, after the training session is over, running the tf.train.import_meta_graph() function seemed to work fine.\nI then downloaded all 3 files : the .meta file, the .data-00000-of-00001 file and the .index file and on running it locally on my machine, I get a UnicodeDecodeError like this :\n2018-06-03 17:46:04.730649: I T:\\src\\github\\tensorflow\\tensorflow\\core\\platform\\cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2\nTraceback (most recent call last):\n  File \"code.py\", line 14, in <module>\n    new_saver = tf.train.import_meta_graph('model-31.meta')\n  File \"C:\\Users\\sekha\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow\\python\\training\\saver.py\", line 1947, in import_meta_graph\n    meta_graph_def = meta_graph.read_meta_graph_file(meta_graph_or_file)\n  File \"C:\\Users\\sekha\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow\\python\\framework\\meta_graph.py\", line 643, in read_meta_graph_file\n    text_format.Merge(file_content.decode(\"utf-8\"), meta_graph_def)\nUnicodeDecodeError: 'utf-8' codec can't decode byte 0xc3 in position 1: invalid continuation byte\n\nThe online notebook only stores files on it for a certain amount of time, and after that they are deleted. So I uploaded the meta file on the notebook again, to see if the problem persisted on a new session ( session on the notebook, not used in the tensorflow 'session' lingo ) in the notebook. And it gave me the same error then too.\nAn issue almost identical to this one has been raised fairly recently in #19573 but there hasn't been an update at all. And this was asked on StackOverflow too, to which the response was that it might be a bug  and github was the place for it, as can be seen in #19573.\nFor reference, this is the entire inference portion of the code:\ngraph = tf.Graph()\nwith tf.Session(graph = graph) as sess: \n    \n      new_saver = tf.train.import_meta_graph('/content/runs/1527946417/checkpoints/model-31.meta') \n      new_saver.restore(sess, ('/content/runs/1527946417/checkpoints/model-31'))\n      sess.run(tf.tables_initializer())\n      e = (graph.get_operations())\n \n      arr_placeholder = graph.get_operation_by_name('arr_placeholder/inp_array').outputs[0]\n      str_placeholder = graph.get_tensor_by_name('str_placeholder/inp_string:0')\n      dropout_keep_prob = graph.get_operation_by_name('dropout_keep_prob/keep_prob').outputs[0]\n      \n      logis = (graph.get_operation_by_name('logits/scores')).outputs[0]\n\n      a =  (sess.run(logis, feed_dict = {arr_placeholder : x_dev, dropout_keep_prob : 1.0, str_placeholder : ls[4731:]}))\n\nSo is it the case that saved models and meta graphs only be restored from the directory it was saved to during the training phase? Is it impossible to run inference on a pre-trained model downloaded from an online source?", "body": "\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\n\r\nYes.\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\n\r\nWindows 10 Home, but using online Jupyter Notebook environment for coding purposes\r\n\r\n- **TensorFlow version (use command below)**:\r\n\r\nVersion : 1.8.0\r\n- **Python version**: \r\n\r\n3.6.3\r\n- **Bazel version (if compiling from source)**:\r\n\r\nN/A\r\n- **GCC/Compiler version (if compiling from source)**:\r\n\r\nN/A\r\n- **CUDA/cuDNN version**:\r\n\r\nN/A\r\n- **GPU model and memory**:\r\n\r\nTesla K80, 11.5 GB RAM\r\n- **Exact command to reproduce**:\r\n\r\nnew_saver = tf.train.import_meta_graph('model-21-epochs.meta')\r\n\r\n\r\n### Describe the problem\r\n\r\nI trained a text classification model on an online Jupyter Notebook, and saved models at each epoch to evaluate the best performing one. On the notebook itself, after the training session is over, running the tf.train.import_meta_graph() function seemed to work fine. \r\n\r\n**I then downloaded all 3 files : the .meta file, the .data-00000-of-00001 file and the .index file** and on running it locally on my machine, I get a UnicodeDecodeError like this : \r\n\r\n```\r\n2018-06-03 17:46:04.730649: I T:\\src\\github\\tensorflow\\tensorflow\\core\\platform\\cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2\r\nTraceback (most recent call last):\r\n  File \"code.py\", line 14, in <module>\r\n    new_saver = tf.train.import_meta_graph('model-31.meta')\r\n  File \"C:\\Users\\sekha\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow\\python\\training\\saver.py\", line 1947, in import_meta_graph\r\n    meta_graph_def = meta_graph.read_meta_graph_file(meta_graph_or_file)\r\n  File \"C:\\Users\\sekha\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\tensorflow\\python\\framework\\meta_graph.py\", line 643, in read_meta_graph_file\r\n    text_format.Merge(file_content.decode(\"utf-8\"), meta_graph_def)\r\nUnicodeDecodeError: 'utf-8' codec can't decode byte 0xc3 in position 1: invalid continuation byte\r\n```\r\nThe online notebook only stores files on it for a certain amount of time, and after that they are deleted. So I uploaded the meta file on the notebook again, to see if the problem persisted on a new session ( session on the notebook, not used in the tensorflow 'session' lingo ) in the notebook. And it gave me the same error then too. \r\n\r\nAn issue almost identical to this one has been raised fairly recently in #19573 but there hasn't been an update at all. And this was asked on StackOverflow too, to which the response was that it might be a bug  and github was the place for it, as can be seen in #19573. \r\n\r\nFor reference, this is the entire inference portion of the code:\r\n\r\n  ```\r\ngraph = tf.Graph()\r\n  with tf.Session(graph = graph) as sess: \r\n      \r\n        new_saver = tf.train.import_meta_graph('/content/runs/1527946417/checkpoints/model-31.meta') \r\n        new_saver.restore(sess, ('/content/runs/1527946417/checkpoints/model-31'))\r\n        sess.run(tf.tables_initializer())\r\n        e = (graph.get_operations())\r\n   \r\n        arr_placeholder = graph.get_operation_by_name('arr_placeholder/inp_array').outputs[0]\r\n        str_placeholder = graph.get_tensor_by_name('str_placeholder/inp_string:0')\r\n        dropout_keep_prob = graph.get_operation_by_name('dropout_keep_prob/keep_prob').outputs[0]\r\n        \r\n        logis = (graph.get_operation_by_name('logits/scores')).outputs[0]\r\n\r\n        a =  (sess.run(logis, feed_dict = {arr_placeholder : x_dev, dropout_keep_prob : 1.0, str_placeholder : ls[4731:]}))\r\n```\r\n\r\nSo is it the case that saved models and meta graphs only be restored from the directory it was saved to during the training phase? Is it impossible to run inference on a pre-trained model downloaded from an online source?"}