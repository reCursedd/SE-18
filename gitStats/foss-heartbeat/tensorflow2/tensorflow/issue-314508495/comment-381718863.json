{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/381718863", "html_url": "https://github.com/tensorflow/tensorflow/issues/18543#issuecomment-381718863", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18543", "id": 381718863, "node_id": "MDEyOklzc3VlQ29tbWVudDM4MTcxODg2Mw==", "user": {"login": "mistaguy", "id": 416610, "node_id": "MDQ6VXNlcjQxNjYxMA==", "avatar_url": "https://avatars2.githubusercontent.com/u/416610?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mistaguy", "html_url": "https://github.com/mistaguy", "followers_url": "https://api.github.com/users/mistaguy/followers", "following_url": "https://api.github.com/users/mistaguy/following{/other_user}", "gists_url": "https://api.github.com/users/mistaguy/gists{/gist_id}", "starred_url": "https://api.github.com/users/mistaguy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mistaguy/subscriptions", "organizations_url": "https://api.github.com/users/mistaguy/orgs", "repos_url": "https://api.github.com/users/mistaguy/repos", "events_url": "https://api.github.com/users/mistaguy/events{/privacy}", "received_events_url": "https://api.github.com/users/mistaguy/received_events", "type": "User", "site_admin": false}, "created_at": "2018-04-16T19:20:33Z", "updated_at": "2018-04-16T19:20:33Z", "author_association": "NONE", "body_html": "<p>Have I written custom code: <strong>NO</strong><br>\nOS Platform and Distribution:  <strong>Google clound ML Engine</strong><br>\nTensorFlow installed from: I don't understand<br>\nTensorFlow version: 1.5<br>\nBazel version: N/A<br>\nCUDA/cuDNN version: N/A<br>\nGPU model and memory: N/A<br>\nExact command to reproduce: I scheduled a training job on google cloud ml Engine using this command</p>\n<pre><code>gcloud ml-engine jobs submit training insectacon_frcnn_`date +%s` \\\n    --runtime-version 1.5 \\\n    --job-dir=${TRAIN_DIR} \\\n    --packages object_detection-0.1.tar.gz,slim-0.1.tar.gz \\\n    --module-name object_detection.train \\\n    --region us-central1 \\\n    --scale-tier BASIC_GPU \\\n    --config gcloud.yaml \\\n    -- \\\n    --train_dir=${TRAIN_DIR} \\\n    --pipeline_config_path=${PIPELINE_CONFIG_PATH}\n</code></pre>\n<p>here is the <code>gcloud.yaml</code></p>\n<pre><code>trainingInput:\n  runtimeVersion: \"1.5\"\n  scaleTier: BASIC\n</code></pre>\n<p>here is the pipeline</p>\n<pre><code># Faster R-CNN with Resnet-101 (v1), configured for Pascal VOC Dataset.\n# Users should configure the fine_tune_checkpoint field in the train config as\n# well as the label_map_path and input_path fields in the train_input_reader and\n# eval_input_reader. Search for \"PATH_TO_BE_CONFIGURED\" to find the fields that\n# should be configured.\n\nmodel {\n  faster_rcnn {\n    num_classes: 1\n    image_resizer {\n      keep_aspect_ratio_resizer {\n        min_dimension: 768\n        max_dimension: 1024\n      }\n    }\n    feature_extractor {\n      type: 'faster_rcnn_resnet101'\n      first_stage_features_stride: 16\n    }\n    first_stage_anchor_generator {\n      grid_anchor_generator {\n        scales: [0.25, 0.5, 1.0, 2.0]\n        aspect_ratios: [0.5, 1.0, 2.0]\n        height_stride: 16\n        width_stride: 16\n      }\n    }\n    first_stage_box_predictor_conv_hyperparams {\n      op: CONV\n      regularizer {\n        l2_regularizer {\n          weight: 0.0\n        }\n      }\n      initializer {\n        truncated_normal_initializer {\n          stddev: 0.01\n        }\n      }\n    }\n    first_stage_nms_score_threshold: 0.0\n    first_stage_nms_iou_threshold: 0.7\n    first_stage_max_proposals: 300\n    first_stage_localization_loss_weight: 2.0\n    first_stage_objectness_loss_weight: 1.0\n    initial_crop_size: 14\n    maxpool_kernel_size: 2\n    maxpool_stride: 2\n    second_stage_box_predictor {\n      mask_rcnn_box_predictor {\n        use_dropout: false\n        dropout_keep_probability: 1.0\n        fc_hyperparams {\n          op: FC\n          regularizer {\n            l2_regularizer {\n              weight: 0.0\n            }\n          }\n          initializer {\n            variance_scaling_initializer {\n              factor: 1.0\n              uniform: true\n              mode: FAN_AVG\n            }\n          }\n        }\n      }\n    }\n    second_stage_post_processing {\n      batch_non_max_suppression {\n        score_threshold: 0.0\n        iou_threshold: 0.5\n        max_detections_per_class: 100\n        max_total_detections: 300\n      }\n      score_converter: SOFTMAX\n    }\n    second_stage_localization_loss_weight: 2.0\n    second_stage_classification_loss_weight: 1.0\n  }\n}\n\ntrain_config: {\n  batch_size: 1\n  optimizer {\n    momentum_optimizer: {\n      learning_rate: {\n        manual_step_learning_rate {\n          initial_learning_rate: 0.0003\n          schedule {\n            step: 50000\n            learning_rate: .00003\n          }\n          schedule {\n            step: 120000\n            learning_rate: .000003\n          }\n        }\n      }\n      momentum_optimizer_value: 0.9\n    }\n    use_moving_average: false\n  }\n  gradient_clipping_by_norm: 10.0\n  fine_tune_checkpoint: \"gs://insectacon-200911-mlengine/insectacon_v1/model.ckpt-20000\"\n  from_detection_checkpoint: true\n  num_steps: 20050\n  data_augmentation_options {\n    random_horizontal_flip {\n    }\n  }\n}\n\ntrain_input_reader: {\n  tf_record_input_reader {\n    input_path: \"gs://insectacon-200911-mlengine/data/pascal.train.record\"\n  }\n  label_map_path: \"gs://insectacon-200911-mlengine/data/map.pbtxt\"\n  queue_capacity: 500\n  min_after_dequeue: 250\n}\n\neval_config: {\n  num_examples: 53\n}\n\neval_input_reader: {\n  tf_record_input_reader {\n    input_path: \"gs://insectacon-200911-mlengine/data/pascal.eval.record\"\n  }\n  label_map_path: \"gs://insectacon-200911-mlengine/data/map.pbtxt\"\n  shuffle: false\n  num_readers: 1\n  queue_capacity: 500\n  min_after_dequeue: 250\n}\n</code></pre>", "body_text": "Have I written custom code: NO\nOS Platform and Distribution:  Google clound ML Engine\nTensorFlow installed from: I don't understand\nTensorFlow version: 1.5\nBazel version: N/A\nCUDA/cuDNN version: N/A\nGPU model and memory: N/A\nExact command to reproduce: I scheduled a training job on google cloud ml Engine using this command\ngcloud ml-engine jobs submit training insectacon_frcnn_`date +%s` \\\n    --runtime-version 1.5 \\\n    --job-dir=${TRAIN_DIR} \\\n    --packages object_detection-0.1.tar.gz,slim-0.1.tar.gz \\\n    --module-name object_detection.train \\\n    --region us-central1 \\\n    --scale-tier BASIC_GPU \\\n    --config gcloud.yaml \\\n    -- \\\n    --train_dir=${TRAIN_DIR} \\\n    --pipeline_config_path=${PIPELINE_CONFIG_PATH}\n\nhere is the gcloud.yaml\ntrainingInput:\n  runtimeVersion: \"1.5\"\n  scaleTier: BASIC\n\nhere is the pipeline\n# Faster R-CNN with Resnet-101 (v1), configured for Pascal VOC Dataset.\n# Users should configure the fine_tune_checkpoint field in the train config as\n# well as the label_map_path and input_path fields in the train_input_reader and\n# eval_input_reader. Search for \"PATH_TO_BE_CONFIGURED\" to find the fields that\n# should be configured.\n\nmodel {\n  faster_rcnn {\n    num_classes: 1\n    image_resizer {\n      keep_aspect_ratio_resizer {\n        min_dimension: 768\n        max_dimension: 1024\n      }\n    }\n    feature_extractor {\n      type: 'faster_rcnn_resnet101'\n      first_stage_features_stride: 16\n    }\n    first_stage_anchor_generator {\n      grid_anchor_generator {\n        scales: [0.25, 0.5, 1.0, 2.0]\n        aspect_ratios: [0.5, 1.0, 2.0]\n        height_stride: 16\n        width_stride: 16\n      }\n    }\n    first_stage_box_predictor_conv_hyperparams {\n      op: CONV\n      regularizer {\n        l2_regularizer {\n          weight: 0.0\n        }\n      }\n      initializer {\n        truncated_normal_initializer {\n          stddev: 0.01\n        }\n      }\n    }\n    first_stage_nms_score_threshold: 0.0\n    first_stage_nms_iou_threshold: 0.7\n    first_stage_max_proposals: 300\n    first_stage_localization_loss_weight: 2.0\n    first_stage_objectness_loss_weight: 1.0\n    initial_crop_size: 14\n    maxpool_kernel_size: 2\n    maxpool_stride: 2\n    second_stage_box_predictor {\n      mask_rcnn_box_predictor {\n        use_dropout: false\n        dropout_keep_probability: 1.0\n        fc_hyperparams {\n          op: FC\n          regularizer {\n            l2_regularizer {\n              weight: 0.0\n            }\n          }\n          initializer {\n            variance_scaling_initializer {\n              factor: 1.0\n              uniform: true\n              mode: FAN_AVG\n            }\n          }\n        }\n      }\n    }\n    second_stage_post_processing {\n      batch_non_max_suppression {\n        score_threshold: 0.0\n        iou_threshold: 0.5\n        max_detections_per_class: 100\n        max_total_detections: 300\n      }\n      score_converter: SOFTMAX\n    }\n    second_stage_localization_loss_weight: 2.0\n    second_stage_classification_loss_weight: 1.0\n  }\n}\n\ntrain_config: {\n  batch_size: 1\n  optimizer {\n    momentum_optimizer: {\n      learning_rate: {\n        manual_step_learning_rate {\n          initial_learning_rate: 0.0003\n          schedule {\n            step: 50000\n            learning_rate: .00003\n          }\n          schedule {\n            step: 120000\n            learning_rate: .000003\n          }\n        }\n      }\n      momentum_optimizer_value: 0.9\n    }\n    use_moving_average: false\n  }\n  gradient_clipping_by_norm: 10.0\n  fine_tune_checkpoint: \"gs://insectacon-200911-mlengine/insectacon_v1/model.ckpt-20000\"\n  from_detection_checkpoint: true\n  num_steps: 20050\n  data_augmentation_options {\n    random_horizontal_flip {\n    }\n  }\n}\n\ntrain_input_reader: {\n  tf_record_input_reader {\n    input_path: \"gs://insectacon-200911-mlengine/data/pascal.train.record\"\n  }\n  label_map_path: \"gs://insectacon-200911-mlengine/data/map.pbtxt\"\n  queue_capacity: 500\n  min_after_dequeue: 250\n}\n\neval_config: {\n  num_examples: 53\n}\n\neval_input_reader: {\n  tf_record_input_reader {\n    input_path: \"gs://insectacon-200911-mlengine/data/pascal.eval.record\"\n  }\n  label_map_path: \"gs://insectacon-200911-mlengine/data/map.pbtxt\"\n  shuffle: false\n  num_readers: 1\n  queue_capacity: 500\n  min_after_dequeue: 250\n}", "body": "Have I written custom code: **NO**\r\nOS Platform and Distribution:  **Google clound ML Engine**\r\nTensorFlow installed from: I don't understand\r\nTensorFlow version: 1.5\r\nBazel version: N/A\r\nCUDA/cuDNN version: N/A\r\nGPU model and memory: N/A\r\nExact command to reproduce: I scheduled a training job on google cloud ml Engine using this command \r\n```\r\ngcloud ml-engine jobs submit training insectacon_frcnn_`date +%s` \\\r\n    --runtime-version 1.5 \\\r\n    --job-dir=${TRAIN_DIR} \\\r\n    --packages object_detection-0.1.tar.gz,slim-0.1.tar.gz \\\r\n    --module-name object_detection.train \\\r\n    --region us-central1 \\\r\n    --scale-tier BASIC_GPU \\\r\n    --config gcloud.yaml \\\r\n    -- \\\r\n    --train_dir=${TRAIN_DIR} \\\r\n    --pipeline_config_path=${PIPELINE_CONFIG_PATH}\r\n```\r\n\r\nhere is the `gcloud.yaml`\r\n\r\n```\r\ntrainingInput:\r\n  runtimeVersion: \"1.5\"\r\n  scaleTier: BASIC\r\n```\r\nhere is the pipeline\r\n\r\n```\r\n# Faster R-CNN with Resnet-101 (v1), configured for Pascal VOC Dataset.\r\n# Users should configure the fine_tune_checkpoint field in the train config as\r\n# well as the label_map_path and input_path fields in the train_input_reader and\r\n# eval_input_reader. Search for \"PATH_TO_BE_CONFIGURED\" to find the fields that\r\n# should be configured.\r\n\r\nmodel {\r\n  faster_rcnn {\r\n    num_classes: 1\r\n    image_resizer {\r\n      keep_aspect_ratio_resizer {\r\n        min_dimension: 768\r\n        max_dimension: 1024\r\n      }\r\n    }\r\n    feature_extractor {\r\n      type: 'faster_rcnn_resnet101'\r\n      first_stage_features_stride: 16\r\n    }\r\n    first_stage_anchor_generator {\r\n      grid_anchor_generator {\r\n        scales: [0.25, 0.5, 1.0, 2.0]\r\n        aspect_ratios: [0.5, 1.0, 2.0]\r\n        height_stride: 16\r\n        width_stride: 16\r\n      }\r\n    }\r\n    first_stage_box_predictor_conv_hyperparams {\r\n      op: CONV\r\n      regularizer {\r\n        l2_regularizer {\r\n          weight: 0.0\r\n        }\r\n      }\r\n      initializer {\r\n        truncated_normal_initializer {\r\n          stddev: 0.01\r\n        }\r\n      }\r\n    }\r\n    first_stage_nms_score_threshold: 0.0\r\n    first_stage_nms_iou_threshold: 0.7\r\n    first_stage_max_proposals: 300\r\n    first_stage_localization_loss_weight: 2.0\r\n    first_stage_objectness_loss_weight: 1.0\r\n    initial_crop_size: 14\r\n    maxpool_kernel_size: 2\r\n    maxpool_stride: 2\r\n    second_stage_box_predictor {\r\n      mask_rcnn_box_predictor {\r\n        use_dropout: false\r\n        dropout_keep_probability: 1.0\r\n        fc_hyperparams {\r\n          op: FC\r\n          regularizer {\r\n            l2_regularizer {\r\n              weight: 0.0\r\n            }\r\n          }\r\n          initializer {\r\n            variance_scaling_initializer {\r\n              factor: 1.0\r\n              uniform: true\r\n              mode: FAN_AVG\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    second_stage_post_processing {\r\n      batch_non_max_suppression {\r\n        score_threshold: 0.0\r\n        iou_threshold: 0.5\r\n        max_detections_per_class: 100\r\n        max_total_detections: 300\r\n      }\r\n      score_converter: SOFTMAX\r\n    }\r\n    second_stage_localization_loss_weight: 2.0\r\n    second_stage_classification_loss_weight: 1.0\r\n  }\r\n}\r\n\r\ntrain_config: {\r\n  batch_size: 1\r\n  optimizer {\r\n    momentum_optimizer: {\r\n      learning_rate: {\r\n        manual_step_learning_rate {\r\n          initial_learning_rate: 0.0003\r\n          schedule {\r\n            step: 50000\r\n            learning_rate: .00003\r\n          }\r\n          schedule {\r\n            step: 120000\r\n            learning_rate: .000003\r\n          }\r\n        }\r\n      }\r\n      momentum_optimizer_value: 0.9\r\n    }\r\n    use_moving_average: false\r\n  }\r\n  gradient_clipping_by_norm: 10.0\r\n  fine_tune_checkpoint: \"gs://insectacon-200911-mlengine/insectacon_v1/model.ckpt-20000\"\r\n  from_detection_checkpoint: true\r\n  num_steps: 20050\r\n  data_augmentation_options {\r\n    random_horizontal_flip {\r\n    }\r\n  }\r\n}\r\n\r\ntrain_input_reader: {\r\n  tf_record_input_reader {\r\n    input_path: \"gs://insectacon-200911-mlengine/data/pascal.train.record\"\r\n  }\r\n  label_map_path: \"gs://insectacon-200911-mlengine/data/map.pbtxt\"\r\n  queue_capacity: 500\r\n  min_after_dequeue: 250\r\n}\r\n\r\neval_config: {\r\n  num_examples: 53\r\n}\r\n\r\neval_input_reader: {\r\n  tf_record_input_reader {\r\n    input_path: \"gs://insectacon-200911-mlengine/data/pascal.eval.record\"\r\n  }\r\n  label_map_path: \"gs://insectacon-200911-mlengine/data/map.pbtxt\"\r\n  shuffle: false\r\n  num_readers: 1\r\n  queue_capacity: 500\r\n  min_after_dequeue: 250\r\n}\r\n```\r\n"}