{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19049", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19049/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19049/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19049/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/19049", "id": 319848917, "node_id": "MDU6SXNzdWUzMTk4NDg5MTc=", "number": 19049, "title": "Memory Leak when tf.Session run on the sliced tensor", "user": {"login": "chychen", "id": 5878561, "node_id": "MDQ6VXNlcjU4Nzg1NjE=", "avatar_url": "https://avatars3.githubusercontent.com/u/5878561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chychen", "html_url": "https://github.com/chychen", "followers_url": "https://api.github.com/users/chychen/followers", "following_url": "https://api.github.com/users/chychen/following{/other_user}", "gists_url": "https://api.github.com/users/chychen/gists{/gist_id}", "starred_url": "https://api.github.com/users/chychen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chychen/subscriptions", "organizations_url": "https://api.github.com/users/chychen/orgs", "repos_url": "https://api.github.com/users/chychen/repos", "events_url": "https://api.github.com/users/chychen/events{/privacy}", "received_events_url": "https://api.github.com/users/chychen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "open", "locked": false, "assignee": {"login": "rmlarsen", "id": 16907534, "node_id": "MDQ6VXNlcjE2OTA3NTM0", "avatar_url": "https://avatars2.githubusercontent.com/u/16907534?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rmlarsen", "html_url": "https://github.com/rmlarsen", "followers_url": "https://api.github.com/users/rmlarsen/followers", "following_url": "https://api.github.com/users/rmlarsen/following{/other_user}", "gists_url": "https://api.github.com/users/rmlarsen/gists{/gist_id}", "starred_url": "https://api.github.com/users/rmlarsen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rmlarsen/subscriptions", "organizations_url": "https://api.github.com/users/rmlarsen/orgs", "repos_url": "https://api.github.com/users/rmlarsen/repos", "events_url": "https://api.github.com/users/rmlarsen/events{/privacy}", "received_events_url": "https://api.github.com/users/rmlarsen/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "rmlarsen", "id": 16907534, "node_id": "MDQ6VXNlcjE2OTA3NTM0", "avatar_url": "https://avatars2.githubusercontent.com/u/16907534?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rmlarsen", "html_url": "https://github.com/rmlarsen", "followers_url": "https://api.github.com/users/rmlarsen/followers", "following_url": "https://api.github.com/users/rmlarsen/following{/other_user}", "gists_url": "https://api.github.com/users/rmlarsen/gists{/gist_id}", "starred_url": "https://api.github.com/users/rmlarsen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rmlarsen/subscriptions", "organizations_url": "https://api.github.com/users/rmlarsen/orgs", "repos_url": "https://api.github.com/users/rmlarsen/repos", "events_url": "https://api.github.com/users/rmlarsen/events{/privacy}", "received_events_url": "https://api.github.com/users/rmlarsen/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2018-05-03T09:34:32Z", "updated_at": "2018-11-22T18:56:26Z", "closed_at": null, "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Linux Ubuntu 16.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: v1.5.0-0-g37aa430d84 1.5.0</li>\n<li><strong>Python version</strong>: 3.6</li>\n<li><strong>CUDA/cuDNN version</strong>: release 9.0, V9.0.176</li>\n<li><strong>GPU model and memory</strong>: 1070 8G</li>\n</ul>\n<h3>Describe the Feature Request</h3>\n<p>For current version of Tensorflow, it will leak memory if we evaluate the sliced tensor as attached code and images, which isn't intuitive and hard to debug. It seems like the unused part of tensor will leak memory because there is no python object reference on it. I am not sure whether it could fixed or not, maybe it could show warning at least.</p>\n<h3>Source code / logs</h3>\n<p><code>import tensorflow as tf</code><br>\n<code>from pympler.tracker import SummaryTracker</code><br>\n<code>tracker = SummaryTracker()</code><br>\n<code>a = tf.zeros([3,4,5])</code><br>\n<code>sess = tf.Session()</code></p>\n<p><code>def leak_version():</code><br>\n<code>____return sess.run(a[0,0])</code></p>\n<p><code>def safe_version():</code><br>\n<code>____return sess.run(a)[0,0]</code></p>\n<p><code>for i in range(10):</code><br>\n<code>____tracker.print_diff()</code><br>\n<code>____# b = safe_version()</code><br>\n<code>____b = leak_version()</code></p>\n<h4>Trace of the Leak</h4>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/5878561/39568787-ed1af628-4ef5-11e8-80a0-b1e532b8c81c.png\"><img src=\"https://user-images.githubusercontent.com/5878561/39568787-ed1af628-4ef5-11e8-80a0-b1e532b8c81c.png\" alt=\"image\" style=\"max-width:100%;\"></a></p>\n<h4>Leak Version : visualize the object reference graph on object 'b' with depth=5 by Library objgraph</h4>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/5878561/39569067-adc03b18-4ef6-11e8-8d68-b5dee8a89eb0.png\"><img src=\"https://user-images.githubusercontent.com/5878561/39569067-adc03b18-4ef6-11e8-8d68-b5dee8a89eb0.png\" alt=\"image\" style=\"max-width:100%;\"></a></p>\n<h4>Safe Version : visualize the object reference graph on object 'b' with depth=5 by Library objgraph</h4>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/5878561/39568928-57ccc000-4ef6-11e8-871d-7507a6dfefb4.png\"><img src=\"https://user-images.githubusercontent.com/5878561/39568928-57ccc000-4ef6-11e8-871d-7507a6dfefb4.png\" alt=\"image\" style=\"max-width:100%;\"></a></p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 16.04\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below): v1.5.0-0-g37aa430d84 1.5.0\nPython version: 3.6\nCUDA/cuDNN version: release 9.0, V9.0.176\nGPU model and memory: 1070 8G\n\nDescribe the Feature Request\nFor current version of Tensorflow, it will leak memory if we evaluate the sliced tensor as attached code and images, which isn't intuitive and hard to debug. It seems like the unused part of tensor will leak memory because there is no python object reference on it. I am not sure whether it could fixed or not, maybe it could show warning at least.\nSource code / logs\nimport tensorflow as tf\nfrom pympler.tracker import SummaryTracker\ntracker = SummaryTracker()\na = tf.zeros([3,4,5])\nsess = tf.Session()\ndef leak_version():\n____return sess.run(a[0,0])\ndef safe_version():\n____return sess.run(a)[0,0]\nfor i in range(10):\n____tracker.print_diff()\n____# b = safe_version()\n____b = leak_version()\nTrace of the Leak\n\nLeak Version : visualize the object reference graph on object 'b' with depth=5 by Library objgraph\n\nSafe Version : visualize the object reference graph on object 'b' with depth=5 by Library objgraph", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Ubuntu 16.04\r\n- **TensorFlow installed from (source or binary)**: binary\r\n- **TensorFlow version (use command below)**: v1.5.0-0-g37aa430d84 1.5.0\r\n- **Python version**: 3.6\r\n- **CUDA/cuDNN version**: release 9.0, V9.0.176\r\n- **GPU model and memory**: 1070 8G\r\n\r\n### Describe the Feature Request\r\nFor current version of Tensorflow, it will leak memory if we evaluate the sliced tensor as attached code and images, which isn't intuitive and hard to debug. It seems like the unused part of tensor will leak memory because there is no python object reference on it. I am not sure whether it could fixed or not, maybe it could show warning at least.\r\n\r\n### Source code / logs\r\n\r\n`import tensorflow as tf`\r\n`from pympler.tracker import SummaryTracker`\r\n`tracker = SummaryTracker()`\r\n`a = tf.zeros([3,4,5])`\r\n`sess = tf.Session()`\r\n\r\n`def leak_version():`\r\n`____return sess.run(a[0,0])`\r\n\r\n`def safe_version():`\r\n`____return sess.run(a)[0,0]` \r\n\r\n`for i in range(10):`\r\n`____tracker.print_diff()`\r\n`____# b = safe_version()`\r\n`____b = leak_version()`\r\n\r\n#### Trace of the Leak\r\n![image](https://user-images.githubusercontent.com/5878561/39568787-ed1af628-4ef5-11e8-80a0-b1e532b8c81c.png)\r\n\r\n#### Leak Version : visualize the object reference graph on object 'b' with depth=5 by Library objgraph\r\n![image](https://user-images.githubusercontent.com/5878561/39569067-adc03b18-4ef6-11e8-8d68-b5dee8a89eb0.png)\r\n\r\n#### Safe Version : visualize the object reference graph on object 'b' with depth=5 by Library objgraph\r\n![image](https://user-images.githubusercontent.com/5878561/39568928-57ccc000-4ef6-11e8-871d-7507a6dfefb4.png)\r\n\r\n"}