{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11884", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11884/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11884/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11884/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/11884", "id": 246589863, "node_id": "MDU6SXNzdWUyNDY1ODk4NjM=", "number": 11884, "title": "Bazel build failure with gpu version", "user": {"login": "uglybachelor", "id": 12999684, "node_id": "MDQ6VXNlcjEyOTk5Njg0", "avatar_url": "https://avatars3.githubusercontent.com/u/12999684?v=4", "gravatar_id": "", "url": "https://api.github.com/users/uglybachelor", "html_url": "https://github.com/uglybachelor", "followers_url": "https://api.github.com/users/uglybachelor/followers", "following_url": "https://api.github.com/users/uglybachelor/following{/other_user}", "gists_url": "https://api.github.com/users/uglybachelor/gists{/gist_id}", "starred_url": "https://api.github.com/users/uglybachelor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/uglybachelor/subscriptions", "organizations_url": "https://api.github.com/users/uglybachelor/orgs", "repos_url": "https://api.github.com/users/uglybachelor/repos", "events_url": "https://api.github.com/users/uglybachelor/events{/privacy}", "received_events_url": "https://api.github.com/users/uglybachelor/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-07-30T15:15:49Z", "updated_at": "2017-09-29T16:17:39Z", "closed_at": "2017-07-31T00:12:47Z", "author_association": "NONE", "body_html": "<hr>\n<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:<br>\nNo</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nLinux Ubuntu 16.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>:<br>\nsource</li>\n<li><strong>TensorFlow version (use command below)</strong>:<br>\n1.2.0, I'm installing from tha master branch</li>\n<li><strong>Python version</strong>:<br>\n2.7</li>\n<li><strong>Bazel version (if compiling from source)</strong>:<br>\n0.5.3</li>\n<li><strong>CUDA/cuDNN version</strong>:<br>\n5.1</li>\n<li><strong>GPU model and memory</strong>:<br>\nGTX1060 6G</li>\n<li><strong>Exact command to reproduce</strong>:<br>\n<code>bazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package</code></li>\n</ul>\n<h3>Describe the problem</h3>\n<p>I followed every step from the installing &amp; configuration page at tf official <a href=\"https://www.tensorflow.org/install/install_sources#ConfigureInstallation\" rel=\"nofollow\">website</a>. But when I came the bazel build step, I ran into the problem showed in the error logs below.</p>\n<p>I should mention that:</p>\n<ol>\n<li>I choosed cuda support in the <code>./configure</code> step, you can find the configure details below as well.</li>\n<li>I previously installed the cpu version of tensorflow on the same computer and it worked fine. Now I've uninstalled it of course.</li>\n</ol>\n<h3>Source code / logs</h3>\n<p>My configuration:</p>\n<pre><code>Please specify the location of python. [Default is /usr/bin/python]: \nFound possible Python library paths:\n/usr/local/lib/python2.7/dist-packages\n/usr/lib/python2.7/dist-packages\nPlease input the desired Python library path to use.  Default is /usr/local/lib/python2.7/dist-packages\nDo you wish to build TensorFlow with jemalloc as malloc support? [Y/n]: \njemalloc as malloc support will be enabled for TensorFlow.\n\nDo you wish to build TensorFlow with Google Cloud Platform support? [y/N]: \nNo Google Cloud Platform support will be enabled for TensorFlow.\n\nDo you wish to build TensorFlow with Hadoop File System support? [y/N]: \nNo Hadoop File System support will be enabled for TensorFlow.\n\nDo you wish to build TensorFlow with XLA JIT support? [y/N]: \nNo XLA JIT support will be enabled for TensorFlow.\n\nDo you wish to build TensorFlow with VERBS support? [y/N]: \nNo VERBS support will be enabled for TensorFlow.\n\nDo you wish to build TensorFlow with OpenCL support? [y/N]: \nNo OpenCL support will be enabled for TensorFlow.\n\nDo you wish to build TensorFlow with CUDA support? [y/N]: y\nCUDA support will be enabled for TensorFlow.\n\nPlease specify the CUDA SDK version you want to use, e.g. 7.0. [Leave empty to default to CUDA 8.0]: \nPlease specify the location where CUDA 8.0 toolkit is installed. Refer to README.md for more details. [Default is /usr/local/cuda]: \n\"Please specify the cuDNN version you want to use. [Leave empty to default to cuDNN 6.0]: 5\nPlease specify the location where cuDNN 5 library is installed. Refer to README.md for more details. [Default is /usr/local/cuda]:\nPlease specify a list of comma-separated Cuda compute capabilities you want to build with.\nYou can find the compute capability of your device at: https://developer.nvidia.com/cuda-gpus.\nPlease note that each additional compute capability significantly increases your build time and binary size. [Default is: 6.1]\nDo you want to use clang as CUDA compiler? [y/N]: \nnvcc will be used as CUDA compiler.\n\nPlease specify which gcc should be used by nvcc as the host compiler. [Default is /usr/bin/gcc]: \nDo you wish to build TensorFlow with MPI support? [y/N]: \nNo MPI support will be enabled for TensorFlow.\n\nPlease specify optimization flags to use during compilation when bazel option \"--config=opt\" is specified [Default is -march=native]: \nAdd \"--config=mkl\" to your bazel command to build with MKL support.\nPlease note that MKL on MacOS or windows is still not supported.\nIf you would like to use a local MKL instead of downloading, please set the environment variable \"TF_MKL_ROOT\" every time before build.\nConfiguration finished\n\n</code></pre>\n<p>My command which introduced the error below:<br>\n<code>bazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package</code></p>\n<p>My error message:</p>\n<pre><code>.......\nERROR: Skipping '//tensorflow/tools/pip_package:build_pip_package': error loading package 'tensorflow/tools/pip_package': Encountered error while reading extension file 'cuda/build_defs.bzl': no such package '@local_config_cuda//cuda': Traceback (most recent call last):\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 1039\n\t\t_create_local_cuda_repository(repository_ctx)\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 976, in _create_local_cuda_repository\n\t\t_host_compiler_includes(repository_ctx, cc)\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 145, in _host_compiler_includes\n\t\tget_cxx_inc_directories(repository_ctx, cc)\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 120, in get_cxx_inc_directories\n\t\tset(includes_cpp)\ndepsets cannot contain mutable items\nWARNING: Target pattern parsing failed.\nERROR: error loading package 'tensorflow/tools/pip_package': Encountered error while reading extension file 'cuda/build_defs.bzl': no such package '@local_config_cuda//cuda': Traceback (most recent call last):\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 1039\n\t\t_create_local_cuda_repository(repository_ctx)\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 976, in _create_local_cuda_repository\n\t\t_host_compiler_includes(repository_ctx, cc)\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 145, in _host_compiler_includes\n\t\tget_cxx_inc_directories(repository_ctx, cc)\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 120, in get_cxx_inc_directories\n\t\tset(includes_cpp)\ndepsets cannot contain mutable items\nINFO: Elapsed time: 5.610s\nFAILED: Build did NOT complete successfully (0 packages loaded)\n    currently loading: tensorflow/tools/pip_package\n\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nNo\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nLinux Ubuntu 16.04\nTensorFlow installed from (source or binary):\nsource\nTensorFlow version (use command below):\n1.2.0, I'm installing from tha master branch\nPython version:\n2.7\nBazel version (if compiling from source):\n0.5.3\nCUDA/cuDNN version:\n5.1\nGPU model and memory:\nGTX1060 6G\nExact command to reproduce:\nbazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package\n\nDescribe the problem\nI followed every step from the installing & configuration page at tf official website. But when I came the bazel build step, I ran into the problem showed in the error logs below.\nI should mention that:\n\nI choosed cuda support in the ./configure step, you can find the configure details below as well.\nI previously installed the cpu version of tensorflow on the same computer and it worked fine. Now I've uninstalled it of course.\n\nSource code / logs\nMy configuration:\nPlease specify the location of python. [Default is /usr/bin/python]: \nFound possible Python library paths:\n/usr/local/lib/python2.7/dist-packages\n/usr/lib/python2.7/dist-packages\nPlease input the desired Python library path to use.  Default is /usr/local/lib/python2.7/dist-packages\nDo you wish to build TensorFlow with jemalloc as malloc support? [Y/n]: \njemalloc as malloc support will be enabled for TensorFlow.\n\nDo you wish to build TensorFlow with Google Cloud Platform support? [y/N]: \nNo Google Cloud Platform support will be enabled for TensorFlow.\n\nDo you wish to build TensorFlow with Hadoop File System support? [y/N]: \nNo Hadoop File System support will be enabled for TensorFlow.\n\nDo you wish to build TensorFlow with XLA JIT support? [y/N]: \nNo XLA JIT support will be enabled for TensorFlow.\n\nDo you wish to build TensorFlow with VERBS support? [y/N]: \nNo VERBS support will be enabled for TensorFlow.\n\nDo you wish to build TensorFlow with OpenCL support? [y/N]: \nNo OpenCL support will be enabled for TensorFlow.\n\nDo you wish to build TensorFlow with CUDA support? [y/N]: y\nCUDA support will be enabled for TensorFlow.\n\nPlease specify the CUDA SDK version you want to use, e.g. 7.0. [Leave empty to default to CUDA 8.0]: \nPlease specify the location where CUDA 8.0 toolkit is installed. Refer to README.md for more details. [Default is /usr/local/cuda]: \n\"Please specify the cuDNN version you want to use. [Leave empty to default to cuDNN 6.0]: 5\nPlease specify the location where cuDNN 5 library is installed. Refer to README.md for more details. [Default is /usr/local/cuda]:\nPlease specify a list of comma-separated Cuda compute capabilities you want to build with.\nYou can find the compute capability of your device at: https://developer.nvidia.com/cuda-gpus.\nPlease note that each additional compute capability significantly increases your build time and binary size. [Default is: 6.1]\nDo you want to use clang as CUDA compiler? [y/N]: \nnvcc will be used as CUDA compiler.\n\nPlease specify which gcc should be used by nvcc as the host compiler. [Default is /usr/bin/gcc]: \nDo you wish to build TensorFlow with MPI support? [y/N]: \nNo MPI support will be enabled for TensorFlow.\n\nPlease specify optimization flags to use during compilation when bazel option \"--config=opt\" is specified [Default is -march=native]: \nAdd \"--config=mkl\" to your bazel command to build with MKL support.\nPlease note that MKL on MacOS or windows is still not supported.\nIf you would like to use a local MKL instead of downloading, please set the environment variable \"TF_MKL_ROOT\" every time before build.\nConfiguration finished\n\n\nMy command which introduced the error below:\nbazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package\nMy error message:\n.......\nERROR: Skipping '//tensorflow/tools/pip_package:build_pip_package': error loading package 'tensorflow/tools/pip_package': Encountered error while reading extension file 'cuda/build_defs.bzl': no such package '@local_config_cuda//cuda': Traceback (most recent call last):\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 1039\n\t\t_create_local_cuda_repository(repository_ctx)\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 976, in _create_local_cuda_repository\n\t\t_host_compiler_includes(repository_ctx, cc)\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 145, in _host_compiler_includes\n\t\tget_cxx_inc_directories(repository_ctx, cc)\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 120, in get_cxx_inc_directories\n\t\tset(includes_cpp)\ndepsets cannot contain mutable items\nWARNING: Target pattern parsing failed.\nERROR: error loading package 'tensorflow/tools/pip_package': Encountered error while reading extension file 'cuda/build_defs.bzl': no such package '@local_config_cuda//cuda': Traceback (most recent call last):\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 1039\n\t\t_create_local_cuda_repository(repository_ctx)\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 976, in _create_local_cuda_repository\n\t\t_host_compiler_includes(repository_ctx, cc)\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 145, in _host_compiler_includes\n\t\tget_cxx_inc_directories(repository_ctx, cc)\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 120, in get_cxx_inc_directories\n\t\tset(includes_cpp)\ndepsets cannot contain mutable items\nINFO: Elapsed time: 5.610s\nFAILED: Build did NOT complete successfully (0 packages loaded)\n    currently loading: tensorflow/tools/pip_package", "body": "\r\n------------------------\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: \r\nNo\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\nLinux Ubuntu 16.04\r\n- **TensorFlow installed from (source or binary)**:\r\nsource\r\n- **TensorFlow version (use command below)**:\r\n1.2.0, I'm installing from tha master branch\r\n- **Python version**: \r\n2.7\r\n- **Bazel version (if compiling from source)**:\r\n0.5.3\r\n- **CUDA/cuDNN version**:\r\n5.1\r\n- **GPU model and memory**:\r\nGTX1060 6G\r\n- **Exact command to reproduce**:\r\n`bazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package`\r\n\r\n### Describe the problem\r\nI followed every step from the installing & configuration page at tf official [website](https://www.tensorflow.org/install/install_sources#ConfigureInstallation). But when I came the bazel build step, I ran into the problem showed in the error logs below.\r\n\r\nI should mention that:\r\n\r\n1. I choosed cuda support in the ` ./configure ` step, you can find the configure details below as well.\r\n2. I previously installed the cpu version of tensorflow on the same computer and it worked fine. Now I've uninstalled it of course.\r\n\r\n### Source code / logs\r\n\r\n\r\nMy configuration:\r\n```\r\nPlease specify the location of python. [Default is /usr/bin/python]: \r\nFound possible Python library paths:\r\n/usr/local/lib/python2.7/dist-packages\r\n/usr/lib/python2.7/dist-packages\r\nPlease input the desired Python library path to use.  Default is /usr/local/lib/python2.7/dist-packages\r\nDo you wish to build TensorFlow with jemalloc as malloc support? [Y/n]: \r\njemalloc as malloc support will be enabled for TensorFlow.\r\n\r\nDo you wish to build TensorFlow with Google Cloud Platform support? [y/N]: \r\nNo Google Cloud Platform support will be enabled for TensorFlow.\r\n\r\nDo you wish to build TensorFlow with Hadoop File System support? [y/N]: \r\nNo Hadoop File System support will be enabled for TensorFlow.\r\n\r\nDo you wish to build TensorFlow with XLA JIT support? [y/N]: \r\nNo XLA JIT support will be enabled for TensorFlow.\r\n\r\nDo you wish to build TensorFlow with VERBS support? [y/N]: \r\nNo VERBS support will be enabled for TensorFlow.\r\n\r\nDo you wish to build TensorFlow with OpenCL support? [y/N]: \r\nNo OpenCL support will be enabled for TensorFlow.\r\n\r\nDo you wish to build TensorFlow with CUDA support? [y/N]: y\r\nCUDA support will be enabled for TensorFlow.\r\n\r\nPlease specify the CUDA SDK version you want to use, e.g. 7.0. [Leave empty to default to CUDA 8.0]: \r\nPlease specify the location where CUDA 8.0 toolkit is installed. Refer to README.md for more details. [Default is /usr/local/cuda]: \r\n\"Please specify the cuDNN version you want to use. [Leave empty to default to cuDNN 6.0]: 5\r\nPlease specify the location where cuDNN 5 library is installed. Refer to README.md for more details. [Default is /usr/local/cuda]:\r\nPlease specify a list of comma-separated Cuda compute capabilities you want to build with.\r\nYou can find the compute capability of your device at: https://developer.nvidia.com/cuda-gpus.\r\nPlease note that each additional compute capability significantly increases your build time and binary size. [Default is: 6.1]\r\nDo you want to use clang as CUDA compiler? [y/N]: \r\nnvcc will be used as CUDA compiler.\r\n\r\nPlease specify which gcc should be used by nvcc as the host compiler. [Default is /usr/bin/gcc]: \r\nDo you wish to build TensorFlow with MPI support? [y/N]: \r\nNo MPI support will be enabled for TensorFlow.\r\n\r\nPlease specify optimization flags to use during compilation when bazel option \"--config=opt\" is specified [Default is -march=native]: \r\nAdd \"--config=mkl\" to your bazel command to build with MKL support.\r\nPlease note that MKL on MacOS or windows is still not supported.\r\nIf you would like to use a local MKL instead of downloading, please set the environment variable \"TF_MKL_ROOT\" every time before build.\r\nConfiguration finished\r\n\r\n```\r\nMy command which introduced the error below:\r\n`bazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package`\r\n\r\nMy error message:\r\n\r\n```\r\n.......\r\nERROR: Skipping '//tensorflow/tools/pip_package:build_pip_package': error loading package 'tensorflow/tools/pip_package': Encountered error while reading extension file 'cuda/build_defs.bzl': no such package '@local_config_cuda//cuda': Traceback (most recent call last):\r\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 1039\r\n\t\t_create_local_cuda_repository(repository_ctx)\r\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 976, in _create_local_cuda_repository\r\n\t\t_host_compiler_includes(repository_ctx, cc)\r\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 145, in _host_compiler_includes\r\n\t\tget_cxx_inc_directories(repository_ctx, cc)\r\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 120, in get_cxx_inc_directories\r\n\t\tset(includes_cpp)\r\ndepsets cannot contain mutable items\r\nWARNING: Target pattern parsing failed.\r\nERROR: error loading package 'tensorflow/tools/pip_package': Encountered error while reading extension file 'cuda/build_defs.bzl': no such package '@local_config_cuda//cuda': Traceback (most recent call last):\r\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 1039\r\n\t\t_create_local_cuda_repository(repository_ctx)\r\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 976, in _create_local_cuda_repository\r\n\t\t_host_compiler_includes(repository_ctx, cc)\r\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 145, in _host_compiler_includes\r\n\t\tget_cxx_inc_directories(repository_ctx, cc)\r\n\tFile \"/home/zzh/tensorflow/third_party/gpus/cuda_configure.bzl\", line 120, in get_cxx_inc_directories\r\n\t\tset(includes_cpp)\r\ndepsets cannot contain mutable items\r\nINFO: Elapsed time: 5.610s\r\nFAILED: Build did NOT complete successfully (0 packages loaded)\r\n    currently loading: tensorflow/tools/pip_package\r\n\r\n```\r\n"}