{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/427165426", "html_url": "https://github.com/tensorflow/tensorflow/issues/22682#issuecomment-427165426", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22682", "id": 427165426, "node_id": "MDEyOklzc3VlQ29tbWVudDQyNzE2NTQyNg==", "user": {"login": "ChengshuLi", "id": 6732996, "node_id": "MDQ6VXNlcjY3MzI5OTY=", "avatar_url": "https://avatars2.githubusercontent.com/u/6732996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChengshuLi", "html_url": "https://github.com/ChengshuLi", "followers_url": "https://api.github.com/users/ChengshuLi/followers", "following_url": "https://api.github.com/users/ChengshuLi/following{/other_user}", "gists_url": "https://api.github.com/users/ChengshuLi/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChengshuLi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChengshuLi/subscriptions", "organizations_url": "https://api.github.com/users/ChengshuLi/orgs", "repos_url": "https://api.github.com/users/ChengshuLi/repos", "events_url": "https://api.github.com/users/ChengshuLi/events{/privacy}", "received_events_url": "https://api.github.com/users/ChengshuLi/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-04T20:53:10Z", "updated_at": "2018-10-04T20:53:10Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=31743510\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/aaroey\">@aaroey</a> Thank you for your help.</p>\n<p>After I <code>pip install --upgrade tf-nightly-gpu</code>, the original problem was solved. However, I barely saw any speed gain for FP16.</p>\n<p>I tried to convert the model to INT8, and got the following error:</p>\n<pre><code>2018-10-04 13:48:44.155956: I tensorflow/contrib/tensorrt/kernels/trt_engine_op.cc:578] Starting calibration thread on device 0, Calibration Resource @ 0x7f3920000b80\npython: helpers.cpp:56: nvinfer1::DimsCHW nvinfer1::getCHW(const nvinfer1::Dims&amp;): Assertion `d.nbDims &gt;= 3' failed.\nfish: Job 2, \u201cpython tf_to_trt.py\u201d terminated by signal SIGABRT (Abort)\n</code></pre>\n<p>Here is part of my source code (modified from <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/tensorrt/test/test_tftrt.py\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/tensorrt/test/test_tftrt.py</a>)</p>\n<pre><code>        int8_calib_gdef = trt.create_inference_graph(\n            input_graph_def=orig_graph,\n            outputs=output_node_name,\n            max_batch_size=1000,\n            max_workspace_size_bytes=1 &lt;&lt; 25,\n            precision_mode=precision,\n            minimum_segment_size=2,\n            is_dynamic_op=False,\n            maximum_cached_engines=1)\n        _ = execute_calibration(int8_calib_gdef)\n        return trt.calib_graph_to_infer_graph(int8_calib_gdef)\n</code></pre>\n<p>Similar issues have also been posted on NVIDIA Developer Forum <a href=\"https://devtalk.nvidia.com/default/topic/1042165/assertion-d-nbdims-gt-3-failed-with-int8-mode/?offset=1\" rel=\"nofollow\">post1</a> and <a href=\"https://devtalk.nvidia.com/default/topic/1038306/tensorrt/nvinfer1-dimschw-nvinfer1-getchw-const-nvinfer1-dims-amp-assertion-d-nbdims-gt-3-failed-/?offset=2#5286167\" rel=\"nofollow\">post2</a>, but it has not be solved yet.</p>\n<p>I really appreciate your help. Thanks a ton!</p>", "body_text": "@aaroey Thank you for your help.\nAfter I pip install --upgrade tf-nightly-gpu, the original problem was solved. However, I barely saw any speed gain for FP16.\nI tried to convert the model to INT8, and got the following error:\n2018-10-04 13:48:44.155956: I tensorflow/contrib/tensorrt/kernels/trt_engine_op.cc:578] Starting calibration thread on device 0, Calibration Resource @ 0x7f3920000b80\npython: helpers.cpp:56: nvinfer1::DimsCHW nvinfer1::getCHW(const nvinfer1::Dims&): Assertion `d.nbDims >= 3' failed.\nfish: Job 2, \u201cpython tf_to_trt.py\u201d terminated by signal SIGABRT (Abort)\n\nHere is part of my source code (modified from https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/tensorrt/test/test_tftrt.py)\n        int8_calib_gdef = trt.create_inference_graph(\n            input_graph_def=orig_graph,\n            outputs=output_node_name,\n            max_batch_size=1000,\n            max_workspace_size_bytes=1 << 25,\n            precision_mode=precision,\n            minimum_segment_size=2,\n            is_dynamic_op=False,\n            maximum_cached_engines=1)\n        _ = execute_calibration(int8_calib_gdef)\n        return trt.calib_graph_to_infer_graph(int8_calib_gdef)\n\nSimilar issues have also been posted on NVIDIA Developer Forum post1 and post2, but it has not be solved yet.\nI really appreciate your help. Thanks a ton!", "body": "@aaroey Thank you for your help.\r\n\r\nAfter I `pip install --upgrade tf-nightly-gpu`, the original problem was solved. However, I barely saw any speed gain for FP16.\r\n\r\nI tried to convert the model to INT8, and got the following error:\r\n```\r\n2018-10-04 13:48:44.155956: I tensorflow/contrib/tensorrt/kernels/trt_engine_op.cc:578] Starting calibration thread on device 0, Calibration Resource @ 0x7f3920000b80\r\npython: helpers.cpp:56: nvinfer1::DimsCHW nvinfer1::getCHW(const nvinfer1::Dims&): Assertion `d.nbDims >= 3' failed.\r\nfish: Job 2, \u201cpython tf_to_trt.py\u201d terminated by signal SIGABRT (Abort)\r\n```\r\nHere is part of my source code (modified from https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/tensorrt/test/test_tftrt.py)\r\n```\r\n        int8_calib_gdef = trt.create_inference_graph(\r\n            input_graph_def=orig_graph,\r\n            outputs=output_node_name,\r\n            max_batch_size=1000,\r\n            max_workspace_size_bytes=1 << 25,\r\n            precision_mode=precision,\r\n            minimum_segment_size=2,\r\n            is_dynamic_op=False,\r\n            maximum_cached_engines=1)\r\n        _ = execute_calibration(int8_calib_gdef)\r\n        return trt.calib_graph_to_infer_graph(int8_calib_gdef)\r\n```\r\nSimilar issues have also been posted on NVIDIA Developer Forum [post1]( https://devtalk.nvidia.com/default/topic/1042165/assertion-d-nbdims-gt-3-failed-with-int8-mode/?offset=1) and [post2](https://devtalk.nvidia.com/default/topic/1038306/tensorrt/nvinfer1-dimschw-nvinfer1-getchw-const-nvinfer1-dims-amp-assertion-d-nbdims-gt-3-failed-/?offset=2#5286167), but it has not be solved yet. \r\n\r\nI really appreciate your help. Thanks a ton! \r\n\r\n\r\n\r\n\r\n"}