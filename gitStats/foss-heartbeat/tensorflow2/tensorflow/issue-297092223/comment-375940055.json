{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/375940055", "html_url": "https://github.com/tensorflow/tensorflow/issues/17009#issuecomment-375940055", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17009", "id": 375940055, "node_id": "MDEyOklzc3VlQ29tbWVudDM3NTk0MDA1NQ==", "user": {"login": "peterwilliams97", "id": 103773, "node_id": "MDQ6VXNlcjEwMzc3Mw==", "avatar_url": "https://avatars0.githubusercontent.com/u/103773?v=4", "gravatar_id": "", "url": "https://api.github.com/users/peterwilliams97", "html_url": "https://github.com/peterwilliams97", "followers_url": "https://api.github.com/users/peterwilliams97/followers", "following_url": "https://api.github.com/users/peterwilliams97/following{/other_user}", "gists_url": "https://api.github.com/users/peterwilliams97/gists{/gist_id}", "starred_url": "https://api.github.com/users/peterwilliams97/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/peterwilliams97/subscriptions", "organizations_url": "https://api.github.com/users/peterwilliams97/orgs", "repos_url": "https://api.github.com/users/peterwilliams97/repos", "events_url": "https://api.github.com/users/peterwilliams97/events{/privacy}", "received_events_url": "https://api.github.com/users/peterwilliams97/received_events", "type": "User", "site_admin": false}, "created_at": "2018-03-25T02:16:14Z", "updated_at": "2018-03-25T03:32:34Z", "author_association": "NONE", "body_html": "<p>I saw this again today under similar circumstances to my last comment</p>\n<pre><code> File \"/home/pcadmin/code/Butt-Head-Astronomer/toxic/mod_rec_word_char.py\", line 89, in get_model2\n    x = Bidirectional(Rec(n_hidden, return_sequences=True), name='c_bidi')(x)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/keras/layers/wrappers.py\", line 324, in __call__\n    return super(Bidirectional, self).__call__(inputs, **kwargs)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/keras/engine/topology.py\", line 617, in __call__\n    output = self.call(inputs, **kwargs)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/keras/layers/wrappers.py\", line 385, in call\n    y_rev = self.backward_layer.call(inputs, **kwargs)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/keras/layers/cudnn_recurrent.py\", line 90, in call\n    output, states = self._process_batch(inputs, initial_state)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/keras/layers/cudnn_recurrent.py\", line 297, in _process_batch\n    is_training=True)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/cudnn_rnn/python/ops/cudnn_rnn_ops.py\", line 1555, in __call__\n    seed=self._seed)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/cudnn_rnn/python/ops/cudnn_rnn_ops.py\", line 944, in _cudnn_rnn_no_input_c\n    direction, dropout, seed, name)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/cudnn_rnn/python/ops/cudnn_rnn_ops.py\", line 858, in _cudnn_rnn\n    name=name)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/cudnn_rnn/ops/gen_cudnn_rnn_ops.py\", line 107, in cudnn_rnn\n    is_training=is_training, name=name)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\n    op_def=op_def)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 3160, in create_op\n    op_def=op_def)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1625, in __init__\n    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\n\nInternalError (see above for traceback): Failed to call ThenRnnForward\n         [[Node: c_bidi_24/CudnnRNN_1 = CudnnRNN[T=DT_FLOAT, direction=\"unidirectional\", dropout=0, input_mode=\"linear_input\", is_training=true, rnn_mode=\"gru\", seed=234, seed2=0, _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"](c_bidi_24/transpose_2, c_bidi_24/ExpandDims_1, w_bidi_24/Const, c_bidi_24/concat_1)]]\n         [[Node: output_24/Sigmoid/_5943 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device_incarnation=1, tensor_name=\"edge_571_output_24/Sigmoid\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"]()]]\n</code></pre>\n<p>The Keras description of the model is</p>\n<pre><code>__________________________________________________________________________________________________\nLayer (type)                    Output Shape         Param #     Connected to                     \n==================================================================================================\nw_inp (InputLayer)              (None, 150)          0                                            \n__________________________________________________________________________________________________\nc_inp (InputLayer)              (None, 600)          0                                            \n__________________________________________________________________________________________________\nw_emb (Embedding)               (None, 150, 300)     45000000    w_inp[0][0]                      \n__________________________________________________________________________________________________\nc_emb (Embedding)               (None, 600, 25)      25000       c_inp[0][0]                      \n__________________________________________________________________________________________________\nw_drop (SpatialDropout1D)       (None, 150, 300)     0           w_emb[0][0]                      \n__________________________________________________________________________________________________\nc_drop (SpatialDropout1D)       (None, 600, 25)      0           c_emb[0][0]                      \n__________________________________________________________________________________________________\nw_bidi (Bidirectional)          (None, 150, 256)     330240      w_drop[0][0]                     \n__________________________________________________________________________________________________\nc_bidi (Bidirectional)          (None, 600, 256)     119040      c_drop[0][0]                     \n__________________________________________________________________________________________________\nw_ave (GlobalAveragePooling1D)  (None, 256)          0           w_bidi[0][0]                     \n__________________________________________________________________________________________________\nw_max (GlobalMaxPooling1D)      (None, 256)          0           w_bidi[0][0]                     \n__________________________________________________________________________________________________\nc_ave (GlobalAveragePooling1D)  (None, 256)          0           c_bidi[0][0]                     \n__________________________________________________________________________________________________\nc_max (GlobalMaxPooling1D)      (None, 256)          0           c_bidi[0][0]                     \n__________________________________________________________________________________________________\nw_conc (Concatenate)            (None, 512)          0           w_ave[0][0]                      \n                                                                 w_max[0][0]                      \n__________________________________________________________________________________________________\nc_conc (Concatenate)            (None, 512)          0           c_ave[0][0]                      \n                                                                 c_max[0][0]                      \n__________________________________________________________________________________________________\nw_c_conc (Concatenate)          (None, 1024)         0           w_conc[0][0]                     \n                                                                 c_conc[0][0]                     \n__________________________________________________________________________________________________\noutput (Dense)                  (None, 6)            6150        w_c_conc[0][0]                   \n==================================================================================================\nTotal params: 45,480,430\nTrainable params: 480,430\nNon-trainable params: 45,000,000\n__________________________________________________________________________________________________\n</code></pre>\n<p><code>nvidia-smi</code> output after the crash is</p>\n<pre><code>+-----------------------------------------------------------------------------+\n| NVIDIA-SMI 390.30                 Driver Version: 390.30                    |\n|-------------------------------+----------------------+----------------------+\n| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n|===============================+======================+======================|\n|   0  Tesla K80           Off  | 00000000:00:04.0 Off |                    0 |\n| N/A   29C    P8    30W / 149W |     15MiB / 11441MiB |      0%      Default |\n+-------------------------------+----------------------+----------------------+\n                                                                               \n+-----------------------------------------------------------------------------+\n| Processes:                                                       GPU Memory |\n|  GPU       PID   Type   Process name                             Usage      |\n|=============================================================================|\n|    0      1511      G   /usr/lib/xorg/Xorg                            15MiB |\n+-----------------------------------------------------------------------------+\n</code></pre>", "body_text": "I saw this again today under similar circumstances to my last comment\n File \"/home/pcadmin/code/Butt-Head-Astronomer/toxic/mod_rec_word_char.py\", line 89, in get_model2\n    x = Bidirectional(Rec(n_hidden, return_sequences=True), name='c_bidi')(x)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/keras/layers/wrappers.py\", line 324, in __call__\n    return super(Bidirectional, self).__call__(inputs, **kwargs)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/keras/engine/topology.py\", line 617, in __call__\n    output = self.call(inputs, **kwargs)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/keras/layers/wrappers.py\", line 385, in call\n    y_rev = self.backward_layer.call(inputs, **kwargs)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/keras/layers/cudnn_recurrent.py\", line 90, in call\n    output, states = self._process_batch(inputs, initial_state)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/keras/layers/cudnn_recurrent.py\", line 297, in _process_batch\n    is_training=True)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/cudnn_rnn/python/ops/cudnn_rnn_ops.py\", line 1555, in __call__\n    seed=self._seed)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/cudnn_rnn/python/ops/cudnn_rnn_ops.py\", line 944, in _cudnn_rnn_no_input_c\n    direction, dropout, seed, name)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/cudnn_rnn/python/ops/cudnn_rnn_ops.py\", line 858, in _cudnn_rnn\n    name=name)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/cudnn_rnn/ops/gen_cudnn_rnn_ops.py\", line 107, in cudnn_rnn\n    is_training=is_training, name=name)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\n    op_def=op_def)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 3160, in create_op\n    op_def=op_def)\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1625, in __init__\n    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\n\nInternalError (see above for traceback): Failed to call ThenRnnForward\n         [[Node: c_bidi_24/CudnnRNN_1 = CudnnRNN[T=DT_FLOAT, direction=\"unidirectional\", dropout=0, input_mode=\"linear_input\", is_training=true, rnn_mode=\"gru\", seed=234, seed2=0, _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"](c_bidi_24/transpose_2, c_bidi_24/ExpandDims_1, w_bidi_24/Const, c_bidi_24/concat_1)]]\n         [[Node: output_24/Sigmoid/_5943 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device_incarnation=1, tensor_name=\"edge_571_output_24/Sigmoid\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"]()]]\n\nThe Keras description of the model is\n__________________________________________________________________________________________________\nLayer (type)                    Output Shape         Param #     Connected to                     \n==================================================================================================\nw_inp (InputLayer)              (None, 150)          0                                            \n__________________________________________________________________________________________________\nc_inp (InputLayer)              (None, 600)          0                                            \n__________________________________________________________________________________________________\nw_emb (Embedding)               (None, 150, 300)     45000000    w_inp[0][0]                      \n__________________________________________________________________________________________________\nc_emb (Embedding)               (None, 600, 25)      25000       c_inp[0][0]                      \n__________________________________________________________________________________________________\nw_drop (SpatialDropout1D)       (None, 150, 300)     0           w_emb[0][0]                      \n__________________________________________________________________________________________________\nc_drop (SpatialDropout1D)       (None, 600, 25)      0           c_emb[0][0]                      \n__________________________________________________________________________________________________\nw_bidi (Bidirectional)          (None, 150, 256)     330240      w_drop[0][0]                     \n__________________________________________________________________________________________________\nc_bidi (Bidirectional)          (None, 600, 256)     119040      c_drop[0][0]                     \n__________________________________________________________________________________________________\nw_ave (GlobalAveragePooling1D)  (None, 256)          0           w_bidi[0][0]                     \n__________________________________________________________________________________________________\nw_max (GlobalMaxPooling1D)      (None, 256)          0           w_bidi[0][0]                     \n__________________________________________________________________________________________________\nc_ave (GlobalAveragePooling1D)  (None, 256)          0           c_bidi[0][0]                     \n__________________________________________________________________________________________________\nc_max (GlobalMaxPooling1D)      (None, 256)          0           c_bidi[0][0]                     \n__________________________________________________________________________________________________\nw_conc (Concatenate)            (None, 512)          0           w_ave[0][0]                      \n                                                                 w_max[0][0]                      \n__________________________________________________________________________________________________\nc_conc (Concatenate)            (None, 512)          0           c_ave[0][0]                      \n                                                                 c_max[0][0]                      \n__________________________________________________________________________________________________\nw_c_conc (Concatenate)          (None, 1024)         0           w_conc[0][0]                     \n                                                                 c_conc[0][0]                     \n__________________________________________________________________________________________________\noutput (Dense)                  (None, 6)            6150        w_c_conc[0][0]                   \n==================================================================================================\nTotal params: 45,480,430\nTrainable params: 480,430\nNon-trainable params: 45,000,000\n__________________________________________________________________________________________________\n\nnvidia-smi output after the crash is\n+-----------------------------------------------------------------------------+\n| NVIDIA-SMI 390.30                 Driver Version: 390.30                    |\n|-------------------------------+----------------------+----------------------+\n| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n|===============================+======================+======================|\n|   0  Tesla K80           Off  | 00000000:00:04.0 Off |                    0 |\n| N/A   29C    P8    30W / 149W |     15MiB / 11441MiB |      0%      Default |\n+-------------------------------+----------------------+----------------------+\n                                                                               \n+-----------------------------------------------------------------------------+\n| Processes:                                                       GPU Memory |\n|  GPU       PID   Type   Process name                             Usage      |\n|=============================================================================|\n|    0      1511      G   /usr/lib/xorg/Xorg                            15MiB |\n+-----------------------------------------------------------------------------+", "body": "I saw this again today under similar circumstances to my last comment\r\n```\r\n File \"/home/pcadmin/code/Butt-Head-Astronomer/toxic/mod_rec_word_char.py\", line 89, in get_model2\r\n    x = Bidirectional(Rec(n_hidden, return_sequences=True), name='c_bidi')(x)\r\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/keras/layers/wrappers.py\", line 324, in __call__\r\n    return super(Bidirectional, self).__call__(inputs, **kwargs)\r\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/keras/engine/topology.py\", line 617, in __call__\r\n    output = self.call(inputs, **kwargs)\r\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/keras/layers/wrappers.py\", line 385, in call\r\n    y_rev = self.backward_layer.call(inputs, **kwargs)\r\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/keras/layers/cudnn_recurrent.py\", line 90, in call\r\n    output, states = self._process_batch(inputs, initial_state)\r\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/keras/layers/cudnn_recurrent.py\", line 297, in _process_batch\r\n    is_training=True)\r\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/cudnn_rnn/python/ops/cudnn_rnn_ops.py\", line 1555, in __call__\r\n    seed=self._seed)\r\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/cudnn_rnn/python/ops/cudnn_rnn_ops.py\", line 944, in _cudnn_rnn_no_input_c\r\n    direction, dropout, seed, name)\r\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/cudnn_rnn/python/ops/cudnn_rnn_ops.py\", line 858, in _cudnn_rnn\r\n    name=name)\r\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/contrib/cudnn_rnn/ops/gen_cudnn_rnn_ops.py\", line 107, in cudnn_rnn\r\n    is_training=is_training, name=name)\r\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 3160, in create_op\r\n    op_def=op_def)\r\n  File \"/home/pcadmin/anaconda3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1625, in __init__\r\n    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\r\n\r\nInternalError (see above for traceback): Failed to call ThenRnnForward\r\n         [[Node: c_bidi_24/CudnnRNN_1 = CudnnRNN[T=DT_FLOAT, direction=\"unidirectional\", dropout=0, input_mode=\"linear_input\", is_training=true, rnn_mode=\"gru\", seed=234, seed2=0, _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"](c_bidi_24/transpose_2, c_bidi_24/ExpandDims_1, w_bidi_24/Const, c_bidi_24/concat_1)]]\r\n         [[Node: output_24/Sigmoid/_5943 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device_incarnation=1, tensor_name=\"edge_571_output_24/Sigmoid\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"]()]]\r\n```\r\n\r\nThe Keras description of the model is\r\n```\r\n__________________________________________________________________________________________________\r\nLayer (type)                    Output Shape         Param #     Connected to                     \r\n==================================================================================================\r\nw_inp (InputLayer)              (None, 150)          0                                            \r\n__________________________________________________________________________________________________\r\nc_inp (InputLayer)              (None, 600)          0                                            \r\n__________________________________________________________________________________________________\r\nw_emb (Embedding)               (None, 150, 300)     45000000    w_inp[0][0]                      \r\n__________________________________________________________________________________________________\r\nc_emb (Embedding)               (None, 600, 25)      25000       c_inp[0][0]                      \r\n__________________________________________________________________________________________________\r\nw_drop (SpatialDropout1D)       (None, 150, 300)     0           w_emb[0][0]                      \r\n__________________________________________________________________________________________________\r\nc_drop (SpatialDropout1D)       (None, 600, 25)      0           c_emb[0][0]                      \r\n__________________________________________________________________________________________________\r\nw_bidi (Bidirectional)          (None, 150, 256)     330240      w_drop[0][0]                     \r\n__________________________________________________________________________________________________\r\nc_bidi (Bidirectional)          (None, 600, 256)     119040      c_drop[0][0]                     \r\n__________________________________________________________________________________________________\r\nw_ave (GlobalAveragePooling1D)  (None, 256)          0           w_bidi[0][0]                     \r\n__________________________________________________________________________________________________\r\nw_max (GlobalMaxPooling1D)      (None, 256)          0           w_bidi[0][0]                     \r\n__________________________________________________________________________________________________\r\nc_ave (GlobalAveragePooling1D)  (None, 256)          0           c_bidi[0][0]                     \r\n__________________________________________________________________________________________________\r\nc_max (GlobalMaxPooling1D)      (None, 256)          0           c_bidi[0][0]                     \r\n__________________________________________________________________________________________________\r\nw_conc (Concatenate)            (None, 512)          0           w_ave[0][0]                      \r\n                                                                 w_max[0][0]                      \r\n__________________________________________________________________________________________________\r\nc_conc (Concatenate)            (None, 512)          0           c_ave[0][0]                      \r\n                                                                 c_max[0][0]                      \r\n__________________________________________________________________________________________________\r\nw_c_conc (Concatenate)          (None, 1024)         0           w_conc[0][0]                     \r\n                                                                 c_conc[0][0]                     \r\n__________________________________________________________________________________________________\r\noutput (Dense)                  (None, 6)            6150        w_c_conc[0][0]                   \r\n==================================================================================================\r\nTotal params: 45,480,430\r\nTrainable params: 480,430\r\nNon-trainable params: 45,000,000\r\n__________________________________________________________________________________________________\r\n```\r\n`nvidia-smi` output after the crash is \r\n```\r\n+-----------------------------------------------------------------------------+\r\n| NVIDIA-SMI 390.30                 Driver Version: 390.30                    |\r\n|-------------------------------+----------------------+----------------------+\r\n| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\r\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\r\n|===============================+======================+======================|\r\n|   0  Tesla K80           Off  | 00000000:00:04.0 Off |                    0 |\r\n| N/A   29C    P8    30W / 149W |     15MiB / 11441MiB |      0%      Default |\r\n+-------------------------------+----------------------+----------------------+\r\n                                                                               \r\n+-----------------------------------------------------------------------------+\r\n| Processes:                                                       GPU Memory |\r\n|  GPU       PID   Type   Process name                             Usage      |\r\n|=============================================================================|\r\n|    0      1511      G   /usr/lib/xorg/Xorg                            15MiB |\r\n+-----------------------------------------------------------------------------+\r\n```"}