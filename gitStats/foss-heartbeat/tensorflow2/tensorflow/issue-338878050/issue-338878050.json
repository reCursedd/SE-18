{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20587", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20587/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20587/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20587/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/20587", "id": 338878050, "node_id": "MDU6SXNzdWUzMzg4NzgwNTA=", "number": 20587, "title": "log_prob() for tf.distributions.Dirichlet returns values > 0", "user": {"login": "josago", "id": 4659933, "node_id": "MDQ6VXNlcjQ2NTk5MzM=", "avatar_url": "https://avatars3.githubusercontent.com/u/4659933?v=4", "gravatar_id": "", "url": "https://api.github.com/users/josago", "html_url": "https://github.com/josago", "followers_url": "https://api.github.com/users/josago/followers", "following_url": "https://api.github.com/users/josago/following{/other_user}", "gists_url": "https://api.github.com/users/josago/gists{/gist_id}", "starred_url": "https://api.github.com/users/josago/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/josago/subscriptions", "organizations_url": "https://api.github.com/users/josago/orgs", "repos_url": "https://api.github.com/users/josago/repos", "events_url": "https://api.github.com/users/josago/events{/privacy}", "received_events_url": "https://api.github.com/users/josago/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "skye", "id": 88808, "node_id": "MDQ6VXNlcjg4ODA4", "avatar_url": "https://avatars1.githubusercontent.com/u/88808?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skye", "html_url": "https://github.com/skye", "followers_url": "https://api.github.com/users/skye/followers", "following_url": "https://api.github.com/users/skye/following{/other_user}", "gists_url": "https://api.github.com/users/skye/gists{/gist_id}", "starred_url": "https://api.github.com/users/skye/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skye/subscriptions", "organizations_url": "https://api.github.com/users/skye/orgs", "repos_url": "https://api.github.com/users/skye/repos", "events_url": "https://api.github.com/users/skye/events{/privacy}", "received_events_url": "https://api.github.com/users/skye/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "skye", "id": 88808, "node_id": "MDQ6VXNlcjg4ODA4", "avatar_url": "https://avatars1.githubusercontent.com/u/88808?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skye", "html_url": "https://github.com/skye", "followers_url": "https://api.github.com/users/skye/followers", "following_url": "https://api.github.com/users/skye/following{/other_user}", "gists_url": "https://api.github.com/users/skye/gists{/gist_id}", "starred_url": "https://api.github.com/users/skye/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skye/subscriptions", "organizations_url": "https://api.github.com/users/skye/orgs", "repos_url": "https://api.github.com/users/skye/repos", "events_url": "https://api.github.com/users/skye/events{/privacy}", "received_events_url": "https://api.github.com/users/skye/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2018-07-06T09:54:54Z", "updated_at": "2018-07-15T19:17:01Z", "closed_at": "2018-07-09T11:13:54Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: Yes</li>\n<li><strong>OS Platform and Distribution</strong>: Debian Stretch, 64 bits</li>\n<li><strong>TensorFlow installed from</strong>: virtualenv / pip</li>\n<li><strong>TensorFlow version</strong>: 1.9.0rc2</li>\n<li><strong>Python version</strong>: 3.5</li>\n<li><strong>Bazel version</strong>: N/A</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: N/A</li>\n<li><strong>CUDA/cuDNN version</strong>: 9.0/7.0</li>\n<li><strong>GPU model and memory</strong>: Geforce GTX 1080 Ti, 11172 MiB</li>\n<li><strong>Exact command to reproduce</strong>: See the description and source code below.</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>The method log_prob() for tf.distributions.Dirichlet sometimes returns values greater than 0, which is not mathematically possible.</p>\n<h3>Source code / logs</h3>\n<p>Piece of code that fails:</p>\n<pre><code>dist = tf.distributions.Dirichlet(\n    tf.exp(log_alphas),\n    validate_args=True,\n    allow_nan_stats=False,\n)\n\nobjective = tf.reduce_sum(dist.log_prob(target))\n</code></pre>\n<p>Manual solution that works properly, using the mathematical definition for the Dirichlet:</p>\n<pre><code>def dirichlet_log_prob(log_alphas, x):\n    return tf.reduce_sum(\n        tf.lgamma(tf.reduce_logsumexp(log_alphas, axis=1)) +\n        tf.reduce_sum(tf.multiply(tf.exp(log_alphas) - 1, tf.log(x)) - tf.lgamma(log_alphas), axis=1)\n    )\n\nobjective = dirichlet_log_prob(log_alphas, target)\n</code></pre>\n<p>Data used in both examples:</p>\n<pre><code>log_alphas = [\n    [-1.6231717, -2.112546 , -2.1379914, -2.0885904, -1.9052815, -1.759051 ],\n    [-1.4579483, -1.8557736, -1.9981235, -1.8574138, -1.5318792, -1.3888079],\n    [-1.4608178, -1.8787189, -1.9842598, -1.8636204, -1.6005809, -1.4765729],\n    [-1.4781257, -1.8943347, -2.0051253, -1.880945 , -1.613416 , -1.4802316],\n    [-1.447619 , -1.9153082, -1.9177424, -1.8622615, -1.7686105, -1.712473 ],\n    [-1.490995 , -2.0010724, -2.0137913, -1.9128757, -1.8797761, -1.8842031],\n    [-1.5973192, -2.0856535, -2.1033392, -2.0476089, -1.9143845, -1.8061923],\n    [-1.5467792, -2.0158603, -2.0372252, -1.9859502, -1.8327508, -1.7130013]\n]\ntarget = [\n    [2.7760255e-01, 3.2513769e-06, 3.6051267e-01, 3.2513769e-06, 8.0276497e-02, 2.8160176e-01],\n    [6.5851367e-01, 3.4333350e-06, 1.7245641e-01, 3.4333350e-06, 2.1149343e-02, 1.4787373e-01],\n    [3.1866562e-02, 2.0533266e-02, 3.3333222e-06, 2.0566598e-02, 6.1813128e-01, 3.0889896e-01],\n    [3.4036295e-06, 1.3675784e-01, 3.4036295e-06, 8.6322856e-01, 3.4036295e-06, 3.4036295e-06],\n    [1.6921267e-01, 2.1246435e-02, 7.6704454e-01, 2.1246435e-02, 2.1246435e-02, 3.4490965e-06],\n    [3.4373238e-06, 4.7641307e-02, 3.4373238e-06, 9.5234495e-01, 3.4373238e-06, 3.4373238e-06],\n    [1.3007499e-01, 4.5678858e-02, 6.3374266e-02, 7.3981225e-01, 3.4293435e-06, 2.1056170e-02],\n    [5.3522962e-01, 3.5806104e-06, 1.7695376e-01, 3.5806104e-06, 4.4113118e-02, 2.4369633e-01]\n]\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes\nOS Platform and Distribution: Debian Stretch, 64 bits\nTensorFlow installed from: virtualenv / pip\nTensorFlow version: 1.9.0rc2\nPython version: 3.5\nBazel version: N/A\nGCC/Compiler version (if compiling from source): N/A\nCUDA/cuDNN version: 9.0/7.0\nGPU model and memory: Geforce GTX 1080 Ti, 11172 MiB\nExact command to reproduce: See the description and source code below.\n\nDescribe the problem\nThe method log_prob() for tf.distributions.Dirichlet sometimes returns values greater than 0, which is not mathematically possible.\nSource code / logs\nPiece of code that fails:\ndist = tf.distributions.Dirichlet(\n    tf.exp(log_alphas),\n    validate_args=True,\n    allow_nan_stats=False,\n)\n\nobjective = tf.reduce_sum(dist.log_prob(target))\n\nManual solution that works properly, using the mathematical definition for the Dirichlet:\ndef dirichlet_log_prob(log_alphas, x):\n    return tf.reduce_sum(\n        tf.lgamma(tf.reduce_logsumexp(log_alphas, axis=1)) +\n        tf.reduce_sum(tf.multiply(tf.exp(log_alphas) - 1, tf.log(x)) - tf.lgamma(log_alphas), axis=1)\n    )\n\nobjective = dirichlet_log_prob(log_alphas, target)\n\nData used in both examples:\nlog_alphas = [\n    [-1.6231717, -2.112546 , -2.1379914, -2.0885904, -1.9052815, -1.759051 ],\n    [-1.4579483, -1.8557736, -1.9981235, -1.8574138, -1.5318792, -1.3888079],\n    [-1.4608178, -1.8787189, -1.9842598, -1.8636204, -1.6005809, -1.4765729],\n    [-1.4781257, -1.8943347, -2.0051253, -1.880945 , -1.613416 , -1.4802316],\n    [-1.447619 , -1.9153082, -1.9177424, -1.8622615, -1.7686105, -1.712473 ],\n    [-1.490995 , -2.0010724, -2.0137913, -1.9128757, -1.8797761, -1.8842031],\n    [-1.5973192, -2.0856535, -2.1033392, -2.0476089, -1.9143845, -1.8061923],\n    [-1.5467792, -2.0158603, -2.0372252, -1.9859502, -1.8327508, -1.7130013]\n]\ntarget = [\n    [2.7760255e-01, 3.2513769e-06, 3.6051267e-01, 3.2513769e-06, 8.0276497e-02, 2.8160176e-01],\n    [6.5851367e-01, 3.4333350e-06, 1.7245641e-01, 3.4333350e-06, 2.1149343e-02, 1.4787373e-01],\n    [3.1866562e-02, 2.0533266e-02, 3.3333222e-06, 2.0566598e-02, 6.1813128e-01, 3.0889896e-01],\n    [3.4036295e-06, 1.3675784e-01, 3.4036295e-06, 8.6322856e-01, 3.4036295e-06, 3.4036295e-06],\n    [1.6921267e-01, 2.1246435e-02, 7.6704454e-01, 2.1246435e-02, 2.1246435e-02, 3.4490965e-06],\n    [3.4373238e-06, 4.7641307e-02, 3.4373238e-06, 9.5234495e-01, 3.4373238e-06, 3.4373238e-06],\n    [1.3007499e-01, 4.5678858e-02, 6.3374266e-02, 7.3981225e-01, 3.4293435e-06, 2.1056170e-02],\n    [5.3522962e-01, 3.5806104e-06, 1.7695376e-01, 3.5806104e-06, 4.4113118e-02, 2.4369633e-01]\n]", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: Yes\r\n- **OS Platform and Distribution**: Debian Stretch, 64 bits\r\n- **TensorFlow installed from**: virtualenv / pip\r\n- **TensorFlow version**: 1.9.0rc2\r\n- **Python version**: 3.5\r\n- **Bazel version**: N/A\r\n- **GCC/Compiler version (if compiling from source)**: N/A\r\n- **CUDA/cuDNN version**: 9.0/7.0\r\n- **GPU model and memory**: Geforce GTX 1080 Ti, 11172 MiB\r\n- **Exact command to reproduce**: See the description and source code below.\r\n\r\n### Describe the problem\r\nThe method log_prob() for tf.distributions.Dirichlet sometimes returns values greater than 0, which is not mathematically possible.\r\n\r\n### Source code / logs\r\nPiece of code that fails:\r\n\r\n```\r\ndist = tf.distributions.Dirichlet(\r\n    tf.exp(log_alphas),\r\n    validate_args=True,\r\n    allow_nan_stats=False,\r\n)\r\n\r\nobjective = tf.reduce_sum(dist.log_prob(target))\r\n```\r\n\r\nManual solution that works properly, using the mathematical definition for the Dirichlet:\r\n\r\n```\r\ndef dirichlet_log_prob(log_alphas, x):\r\n    return tf.reduce_sum(\r\n        tf.lgamma(tf.reduce_logsumexp(log_alphas, axis=1)) +\r\n        tf.reduce_sum(tf.multiply(tf.exp(log_alphas) - 1, tf.log(x)) - tf.lgamma(log_alphas), axis=1)\r\n    )\r\n\r\nobjective = dirichlet_log_prob(log_alphas, target)\r\n```\r\n\r\nData used in both examples:\r\n\r\n```\r\nlog_alphas = [\r\n    [-1.6231717, -2.112546 , -2.1379914, -2.0885904, -1.9052815, -1.759051 ],\r\n    [-1.4579483, -1.8557736, -1.9981235, -1.8574138, -1.5318792, -1.3888079],\r\n    [-1.4608178, -1.8787189, -1.9842598, -1.8636204, -1.6005809, -1.4765729],\r\n    [-1.4781257, -1.8943347, -2.0051253, -1.880945 , -1.613416 , -1.4802316],\r\n    [-1.447619 , -1.9153082, -1.9177424, -1.8622615, -1.7686105, -1.712473 ],\r\n    [-1.490995 , -2.0010724, -2.0137913, -1.9128757, -1.8797761, -1.8842031],\r\n    [-1.5973192, -2.0856535, -2.1033392, -2.0476089, -1.9143845, -1.8061923],\r\n    [-1.5467792, -2.0158603, -2.0372252, -1.9859502, -1.8327508, -1.7130013]\r\n]\r\ntarget = [\r\n    [2.7760255e-01, 3.2513769e-06, 3.6051267e-01, 3.2513769e-06, 8.0276497e-02, 2.8160176e-01],\r\n    [6.5851367e-01, 3.4333350e-06, 1.7245641e-01, 3.4333350e-06, 2.1149343e-02, 1.4787373e-01],\r\n    [3.1866562e-02, 2.0533266e-02, 3.3333222e-06, 2.0566598e-02, 6.1813128e-01, 3.0889896e-01],\r\n    [3.4036295e-06, 1.3675784e-01, 3.4036295e-06, 8.6322856e-01, 3.4036295e-06, 3.4036295e-06],\r\n    [1.6921267e-01, 2.1246435e-02, 7.6704454e-01, 2.1246435e-02, 2.1246435e-02, 3.4490965e-06],\r\n    [3.4373238e-06, 4.7641307e-02, 3.4373238e-06, 9.5234495e-01, 3.4373238e-06, 3.4373238e-06],\r\n    [1.3007499e-01, 4.5678858e-02, 6.3374266e-02, 7.3981225e-01, 3.4293435e-06, 2.1056170e-02],\r\n    [5.3522962e-01, 3.5806104e-06, 1.7695376e-01, 3.5806104e-06, 4.4113118e-02, 2.4369633e-01]\r\n]\r\n```"}