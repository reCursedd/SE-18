{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/152363445", "pull_request_review_id": 78214514, "id": 152363445, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1MjM2MzQ0NQ==", "diff_hunk": "@@ -360,6 +377,66 @@ class ScopedCublasPointerMode {\n   bool ok_;                       // Whether the change was successful.\n };\n \n+#if CUDA_VERSION >= 9000\n+// cuBLAS has interfaces that permit computations to use the Tensor Cores\n+// available in Volta hardware. This must be enabled via the\n+// cublasGet/SetMathMode APIs.\n+//\n+// This helper sets the cuBLAS math mode to a desired value for a cuBLAS call\n+// you are about to perform in a given scope.\n+//\n+// The prior cuBLAS math mode is retained and restored when this object goes\n+// out of scope.\n+class ScopedCublasMathMode {\n+ public:\n+  // Note that, because the setting of the cublas math mode is fallible,\n+  // construction of this scoped datatype must be paired with a call to\n+  // Init().\n+  //\n+  // Parameters:\n+  //  handle: The cublas library handle to act upon in setting the math mode.\n+  explicit ScopedCublasMathMode(CUDAExecutor *parent, cublasHandle_t handle)\n+      : parent_(parent), handle_(handle), ok_(false) {}\n+\n+  // Attempts the switch to the requested scoped math mode, new_mode.\n+  //\n+  // Note that when false is returned, an appropriate error has already been\n+  // logged.\n+  bool Init(cublasMath_t new_mode) {\n+    cublasStatus_t ret = wrap::cublasGetMathMode(parent_, handle_, &old_mode_);\n+    if (ret != CUBLAS_STATUS_SUCCESS) {\n+      LOG(ERROR) << \"failed to get old cublas math mode: \" << ToString(ret);\n+      return ok_ = false;\n+    }\n+\n+    ret = wrap::cublasSetMathMode(parent_, handle_, new_mode);\n+    if (ret != CUBLAS_STATUS_SUCCESS) {\n+      LOG(ERROR) << \"failed to set new cublas math mode: \" << ToString(ret);", "path": "tensorflow/stream_executor/cuda/cuda_blas.cc", "position": 77, "original_position": 76, "commit_id": "80d3e858255e1d829b927b5996b5cce091b390ec", "original_commit_id": "9492b542df43ea49b160af15793be02e2f3fb376", "user": {"login": "nluehr", "id": 1873655, "node_id": "MDQ6VXNlcjE4NzM2NTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1873655?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nluehr", "html_url": "https://github.com/nluehr", "followers_url": "https://api.github.com/users/nluehr/followers", "following_url": "https://api.github.com/users/nluehr/following{/other_user}", "gists_url": "https://api.github.com/users/nluehr/gists{/gist_id}", "starred_url": "https://api.github.com/users/nluehr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nluehr/subscriptions", "organizations_url": "https://api.github.com/users/nluehr/orgs", "repos_url": "https://api.github.com/users/nluehr/repos", "events_url": "https://api.github.com/users/nluehr/events{/privacy}", "received_events_url": "https://api.github.com/users/nluehr/received_events", "type": "User", "site_admin": false}, "body": "Propagation is already in place as the callers check for a false return value.", "created_at": "2017-11-21T18:32:02Z", "updated_at": "2017-12-13T19:25:08Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/13451#discussion_r152363445", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13451", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/152363445"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/13451#discussion_r152363445"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13451"}}, "body_html": "<p>Propagation is already in place as the callers check for a false return value.</p>", "body_text": "Propagation is already in place as the callers check for a false return value.", "in_reply_to_id": 150130586}