{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22069", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22069/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22069/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22069/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/22069", "id": 356998088, "node_id": "MDU6SXNzdWUzNTY5OTgwODg=", "number": 22069, "title": "freeze_graph.py with --input_saved_model argument gives `IOError: SavedModel file does not exist`", "user": {"login": "chrisrapson", "id": 4982550, "node_id": "MDQ6VXNlcjQ5ODI1NTA=", "avatar_url": "https://avatars2.githubusercontent.com/u/4982550?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chrisrapson", "html_url": "https://github.com/chrisrapson", "followers_url": "https://api.github.com/users/chrisrapson/followers", "following_url": "https://api.github.com/users/chrisrapson/following{/other_user}", "gists_url": "https://api.github.com/users/chrisrapson/gists{/gist_id}", "starred_url": "https://api.github.com/users/chrisrapson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chrisrapson/subscriptions", "organizations_url": "https://api.github.com/users/chrisrapson/orgs", "repos_url": "https://api.github.com/users/chrisrapson/repos", "events_url": "https://api.github.com/users/chrisrapson/events{/privacy}", "received_events_url": "https://api.github.com/users/chrisrapson/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": {"login": "karmel", "id": 667809, "node_id": "MDQ6VXNlcjY2NzgwOQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/667809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/karmel", "html_url": "https://github.com/karmel", "followers_url": "https://api.github.com/users/karmel/followers", "following_url": "https://api.github.com/users/karmel/following{/other_user}", "gists_url": "https://api.github.com/users/karmel/gists{/gist_id}", "starred_url": "https://api.github.com/users/karmel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/karmel/subscriptions", "organizations_url": "https://api.github.com/users/karmel/orgs", "repos_url": "https://api.github.com/users/karmel/repos", "events_url": "https://api.github.com/users/karmel/events{/privacy}", "received_events_url": "https://api.github.com/users/karmel/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "karmel", "id": 667809, "node_id": "MDQ6VXNlcjY2NzgwOQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/667809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/karmel", "html_url": "https://github.com/karmel", "followers_url": "https://api.github.com/users/karmel/followers", "following_url": "https://api.github.com/users/karmel/following{/other_user}", "gists_url": "https://api.github.com/users/karmel/gists{/gist_id}", "starred_url": "https://api.github.com/users/karmel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/karmel/subscriptions", "organizations_url": "https://api.github.com/users/karmel/orgs", "repos_url": "https://api.github.com/users/karmel/repos", "events_url": "https://api.github.com/users/karmel/events{/privacy}", "received_events_url": "https://api.github.com/users/karmel/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2018-09-04T22:25:14Z", "updated_at": "2018-11-22T18:58:25Z", "closed_at": null, "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:<br>\nno</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nUbuntu 18.04</li>\n<li><strong>Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device</strong>:<br>\nn/a</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>:<br>\npip</li>\n<li><strong>TensorFlow version (use command below)</strong>:<br>\n1.10.1</li>\n<li><strong>Python version</strong>:<br>\n2.7.15rc1</li>\n<li><strong>Bazel version (if compiling from source)</strong>:<br>\nn/a</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>:<br>\nn/a</li>\n<li><strong>CUDA/cuDNN version</strong>:<br>\nn/a</li>\n<li><strong>GPU model and memory</strong>:<br>\nn/a</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<pre><code>#first, train the model with\npython tensorflow/models/research/deeplab/train.py \\\n    --logtostderr \\\n    --clone_on_cpu=True \\\n    --training_number_of_steps=900 \\ # 90000 \\\n    --train_split=\"train\" \\\n    --model_variant=\"mobilenet_v2\" \\\n    --atrous_rates=6 \\\n    --atrous_rates=12 \\\n    --atrous_rates=18 \\\n    --output_stride=16 \\\n    --decoder_output_stride=4 \\\n    --train_crop_size=128 \\\n    --train_crop_size=128 \\\n    --train_batch_size=1 \\\n    --dataset=\"cityscapes\" \\\n    --tf_initial_checkpoint=${PATH_TO_INITIAL_CHECKPOINT} \\\n    --train_logdir=${PATH_TO_TRAIN_DIR} \\\n    --dataset_dir=${PATH_TO_DATASET}\n\n#then try to freeze the output\npython tensorflow/python/tools/freeze_graph.py \\\n     --input_saved_model=${PATH_TO_TRAIN_DIR} \\\n     --output_graph=${PATH_TO_TRAIN_DIR}/frozen_graph.pb \\\n     --output_node_names=MobilenetV2/expanded_conv_16/output\n</code></pre>\n<h3>Describe the problem</h3>\n<p>The first problem is that the train.py script seems to change the structure of the graph. Specifically, the input and output nodes from the <code>initial_checkpoint</code> are missing. The normal <code>output_node_names</code> such as softmax, predictions etc do not appear in the trained graph.pbtxt, which is why I have used <code>MobilenetV2/expanded_conv_16/output</code>. The ImageTensor also does not appear as an input_node.<br>\nHowever, the problem with missing nodes is not the focus of this issue.</p>\n<p>The second problem is that <code>freeze_graph.ph</code> with the <code>--input_saved_model</code> option gives</p>\n<pre><code>Traceback (most recent call last):\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/tools/freeze_graph.py\", line 382, in &lt;module&gt;\n    run_main()\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/tools/freeze_graph.py\", line 379, in run_main\n    app.run(main=my_main, argv=[sys.argv[0]] + unparsed)\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 125, in run\n    _sys.exit(main(argv))\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/tools/freeze_graph.py\", line 378, in &lt;lambda&gt;\n    my_main = lambda unused_args: main(unused_args, flags)\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/tools/freeze_graph.py\", line 272, in main\n    flags.saved_model_tags, checkpoint_version)\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/tools/freeze_graph.py\", line 229, in freeze_graph\n    input_saved_model_dir, saved_model_tags).graph_def\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/tools/saved_model_utils.py\", line 42, in get_meta_graph_def\n    saved_model = reader.read_saved_model(saved_model_dir)\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/contrib/saved_model/python/saved_model/reader.py\", line 55, in read_saved_model\n    raise IOError(\"SavedModel file does not exist at: %s\" % saved_model_dir)\nIOError: SavedModel file does not exist at: /path/given/in/PATH_TO_TRAIN_DIR\n\n$ls ${PATH_TO_TRAIN_DIR}\n-rw-r--r-- 1 username username    21786 Sep  3 15:28 model.ckpt-0.index\n-rw-r--r-- 1 username username 21955616 Sep  3 15:28 model.ckpt-0.data-00000-of-00001\n-rw-r--r-- 1 username username  3070908 Sep  3 15:28 model.ckpt-0.meta\n-rw-r--r-- 1 username username  6081043 Sep  4 10:54 graph.pbtxt\n-rw-r--r-- 1 username username 21955616 Sep  4 10:54 model.ckpt-900.data-00000-of-00001\n-rw-r--r-- 1 username username    21786 Sep  4 10:54 model.ckpt-900.index\n-rw-r--r-- 1 username username  3070908 Sep  4 10:54 model.ckpt-900.meta\n-rw-r--r-- 1 username username      541 Sep  4 10:54 checkpoint\n\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nno\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nUbuntu 18.04\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:\nn/a\nTensorFlow installed from (source or binary):\npip\nTensorFlow version (use command below):\n1.10.1\nPython version:\n2.7.15rc1\nBazel version (if compiling from source):\nn/a\nGCC/Compiler version (if compiling from source):\nn/a\nCUDA/cuDNN version:\nn/a\nGPU model and memory:\nn/a\nExact command to reproduce:\n\n#first, train the model with\npython tensorflow/models/research/deeplab/train.py \\\n    --logtostderr \\\n    --clone_on_cpu=True \\\n    --training_number_of_steps=900 \\ # 90000 \\\n    --train_split=\"train\" \\\n    --model_variant=\"mobilenet_v2\" \\\n    --atrous_rates=6 \\\n    --atrous_rates=12 \\\n    --atrous_rates=18 \\\n    --output_stride=16 \\\n    --decoder_output_stride=4 \\\n    --train_crop_size=128 \\\n    --train_crop_size=128 \\\n    --train_batch_size=1 \\\n    --dataset=\"cityscapes\" \\\n    --tf_initial_checkpoint=${PATH_TO_INITIAL_CHECKPOINT} \\\n    --train_logdir=${PATH_TO_TRAIN_DIR} \\\n    --dataset_dir=${PATH_TO_DATASET}\n\n#then try to freeze the output\npython tensorflow/python/tools/freeze_graph.py \\\n     --input_saved_model=${PATH_TO_TRAIN_DIR} \\\n     --output_graph=${PATH_TO_TRAIN_DIR}/frozen_graph.pb \\\n     --output_node_names=MobilenetV2/expanded_conv_16/output\n\nDescribe the problem\nThe first problem is that the train.py script seems to change the structure of the graph. Specifically, the input and output nodes from the initial_checkpoint are missing. The normal output_node_names such as softmax, predictions etc do not appear in the trained graph.pbtxt, which is why I have used MobilenetV2/expanded_conv_16/output. The ImageTensor also does not appear as an input_node.\nHowever, the problem with missing nodes is not the focus of this issue.\nThe second problem is that freeze_graph.ph with the --input_saved_model option gives\nTraceback (most recent call last):\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/tools/freeze_graph.py\", line 382, in <module>\n    run_main()\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/tools/freeze_graph.py\", line 379, in run_main\n    app.run(main=my_main, argv=[sys.argv[0]] + unparsed)\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 125, in run\n    _sys.exit(main(argv))\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/tools/freeze_graph.py\", line 378, in <lambda>\n    my_main = lambda unused_args: main(unused_args, flags)\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/tools/freeze_graph.py\", line 272, in main\n    flags.saved_model_tags, checkpoint_version)\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/tools/freeze_graph.py\", line 229, in freeze_graph\n    input_saved_model_dir, saved_model_tags).graph_def\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/tools/saved_model_utils.py\", line 42, in get_meta_graph_def\n    saved_model = reader.read_saved_model(saved_model_dir)\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/contrib/saved_model/python/saved_model/reader.py\", line 55, in read_saved_model\n    raise IOError(\"SavedModel file does not exist at: %s\" % saved_model_dir)\nIOError: SavedModel file does not exist at: /path/given/in/PATH_TO_TRAIN_DIR\n\n$ls ${PATH_TO_TRAIN_DIR}\n-rw-r--r-- 1 username username    21786 Sep  3 15:28 model.ckpt-0.index\n-rw-r--r-- 1 username username 21955616 Sep  3 15:28 model.ckpt-0.data-00000-of-00001\n-rw-r--r-- 1 username username  3070908 Sep  3 15:28 model.ckpt-0.meta\n-rw-r--r-- 1 username username  6081043 Sep  4 10:54 graph.pbtxt\n-rw-r--r-- 1 username username 21955616 Sep  4 10:54 model.ckpt-900.data-00000-of-00001\n-rw-r--r-- 1 username username    21786 Sep  4 10:54 model.ckpt-900.index\n-rw-r--r-- 1 username username  3070908 Sep  4 10:54 model.ckpt-900.meta\n-rw-r--r-- 1 username username      541 Sep  4 10:54 checkpoint", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\nno\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\nUbuntu 18.04\r\n- **Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device**:\r\nn/a\r\n- **TensorFlow installed from (source or binary)**:\r\npip\r\n- **TensorFlow version (use command below)**:\r\n1.10.1\r\n- **Python version**:\r\n2.7.15rc1\r\n- **Bazel version (if compiling from source)**:\r\nn/a\r\n- **GCC/Compiler version (if compiling from source)**:\r\nn/a\r\n- **CUDA/cuDNN version**:\r\nn/a\r\n- **GPU model and memory**:\r\nn/a\r\n- **Exact command to reproduce**:\r\n```\r\n#first, train the model with\r\npython tensorflow/models/research/deeplab/train.py \\\r\n    --logtostderr \\\r\n    --clone_on_cpu=True \\\r\n    --training_number_of_steps=900 \\ # 90000 \\\r\n    --train_split=\"train\" \\\r\n    --model_variant=\"mobilenet_v2\" \\\r\n    --atrous_rates=6 \\\r\n    --atrous_rates=12 \\\r\n    --atrous_rates=18 \\\r\n    --output_stride=16 \\\r\n    --decoder_output_stride=4 \\\r\n    --train_crop_size=128 \\\r\n    --train_crop_size=128 \\\r\n    --train_batch_size=1 \\\r\n    --dataset=\"cityscapes\" \\\r\n    --tf_initial_checkpoint=${PATH_TO_INITIAL_CHECKPOINT} \\\r\n    --train_logdir=${PATH_TO_TRAIN_DIR} \\\r\n    --dataset_dir=${PATH_TO_DATASET}\r\n\r\n#then try to freeze the output\r\npython tensorflow/python/tools/freeze_graph.py \\\r\n     --input_saved_model=${PATH_TO_TRAIN_DIR} \\\r\n     --output_graph=${PATH_TO_TRAIN_DIR}/frozen_graph.pb \\\r\n     --output_node_names=MobilenetV2/expanded_conv_16/output\r\n```\r\n\r\n### Describe the problem\r\nThe first problem is that the train.py script seems to change the structure of the graph. Specifically, the input and output nodes from the `initial_checkpoint` are missing. The normal `output_node_names` such as softmax, predictions etc do not appear in the trained graph.pbtxt, which is why I have used `MobilenetV2/expanded_conv_16/output`. The ImageTensor also does not appear as an input_node.\r\nHowever, the problem with missing nodes is not the focus of this issue.\r\n\r\nThe second problem is that `freeze_graph.ph` with the `--input_saved_model` option gives \r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/tools/freeze_graph.py\", line 382, in <module>\r\n    run_main()\r\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/tools/freeze_graph.py\", line 379, in run_main\r\n    app.run(main=my_main, argv=[sys.argv[0]] + unparsed)\r\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 125, in run\r\n    _sys.exit(main(argv))\r\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/tools/freeze_graph.py\", line 378, in <lambda>\r\n    my_main = lambda unused_args: main(unused_args, flags)\r\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/tools/freeze_graph.py\", line 272, in main\r\n    flags.saved_model_tags, checkpoint_version)\r\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/tools/freeze_graph.py\", line 229, in freeze_graph\r\n    input_saved_model_dir, saved_model_tags).graph_def\r\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/python/tools/saved_model_utils.py\", line 42, in get_meta_graph_def\r\n    saved_model = reader.read_saved_model(saved_model_dir)\r\n  File \"/home/username/.local/lib/python2.7/site-packages/tensorflow/contrib/saved_model/python/saved_model/reader.py\", line 55, in read_saved_model\r\n    raise IOError(\"SavedModel file does not exist at: %s\" % saved_model_dir)\r\nIOError: SavedModel file does not exist at: /path/given/in/PATH_TO_TRAIN_DIR\r\n\r\n$ls ${PATH_TO_TRAIN_DIR}\r\n-rw-r--r-- 1 username username    21786 Sep  3 15:28 model.ckpt-0.index\r\n-rw-r--r-- 1 username username 21955616 Sep  3 15:28 model.ckpt-0.data-00000-of-00001\r\n-rw-r--r-- 1 username username  3070908 Sep  3 15:28 model.ckpt-0.meta\r\n-rw-r--r-- 1 username username  6081043 Sep  4 10:54 graph.pbtxt\r\n-rw-r--r-- 1 username username 21955616 Sep  4 10:54 model.ckpt-900.data-00000-of-00001\r\n-rw-r--r-- 1 username username    21786 Sep  4 10:54 model.ckpt-900.index\r\n-rw-r--r-- 1 username username  3070908 Sep  4 10:54 model.ckpt-900.meta\r\n-rw-r--r-- 1 username username      541 Sep  4 10:54 checkpoint\r\n\r\n```\r\n"}