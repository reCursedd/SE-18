{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15715", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15715/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15715/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15715/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15715", "id": 285064802, "node_id": "MDU6SXNzdWUyODUwNjQ4MDI=", "number": 15715, "title": "ValueError: Batch length of predictions should be same", "user": {"login": "PierreBoyeau", "id": 23222597, "node_id": "MDQ6VXNlcjIzMjIyNTk3", "avatar_url": "https://avatars3.githubusercontent.com/u/23222597?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PierreBoyeau", "html_url": "https://github.com/PierreBoyeau", "followers_url": "https://api.github.com/users/PierreBoyeau/followers", "following_url": "https://api.github.com/users/PierreBoyeau/following{/other_user}", "gists_url": "https://api.github.com/users/PierreBoyeau/gists{/gist_id}", "starred_url": "https://api.github.com/users/PierreBoyeau/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PierreBoyeau/subscriptions", "organizations_url": "https://api.github.com/users/PierreBoyeau/orgs", "repos_url": "https://api.github.com/users/PierreBoyeau/repos", "events_url": "https://api.github.com/users/PierreBoyeau/events{/privacy}", "received_events_url": "https://api.github.com/users/PierreBoyeau/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-12-29T09:53:08Z", "updated_at": "2018-03-14T04:24:09Z", "closed_at": "2017-12-29T15:56:21Z", "author_association": "NONE", "body_html": "<p>Hi,</p>\n<p>I'm trying to visualize the output of a convolutional autoencoder using TensorFlow Estimator API.<br>\nI use 64*64 images stored in a Numpy array as input, and use <code>tf.estimator.inputs.numpy_input_fn</code> to feed this input to my estimator.<br>\nEverything works perfectly fine during training, but as soon as I try to do predictions, it seems that I have an issue with my input_fn.<br>\nPlease forgive me in advance, I am not 100% sure this is a bug, but I think I have tried everything I had in mind.</p>\n<pre><code>input_fn = tf.estimator.inputs.numpy_input_fn(\n    x={\"x\": train_data},\n    y=None,\n    batch_size=8,\n    num_epochs=None,\n    shuffle=True)\n\nautoencoder = tf.estimator.Estimator(model_fn=autoencoder_model_fn, model_dir=model_dir)\ntensors_to_log = {\"loss\": \"loss\"}\nlogging_hook = tf.train.LoggingTensorHook(tensors=tensors_to_log, every_n_iter=1000)\n\nautoencoder.train(\n    input_fn=input_fn,\n    steps=50000,\n    hooks=[logging_hook])\n\ninput_fn_predict = tf.estimator.inputs.numpy_input_fn(\n    x={\"x\": train_data},\n    y=None,\n    batch_size=1,\n    num_epochs=None,\n    shuffle=False)\npredictions = autoencoder.predict(input_fn=input_fn_predict)\npredictions = [p['decoded_image'] for p in predictions]\nprint predictions[0].shape\n</code></pre>\n<p>I tried among other things to set <code>batch_size</code> to the same value for both input_fn, but it doesn't work and I get the following error :</p>\n<div class=\"highlight highlight-source-shell\"><pre>Traceback (most recent call last):\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>AutoEncoder.py<span class=\"pl-pds\">\"</span></span>, line 164, <span class=\"pl-k\">in</span> <span class=\"pl-k\">&lt;</span>module<span class=\"pl-k\">&gt;</span>\n    <span class=\"pl-en\">main</span>()\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>AutoEncoder.py<span class=\"pl-pds\">\"</span></span>, line 157, <span class=\"pl-k\">in</span> main\n    predictions = [p[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>decoded_image<span class=\"pl-pds\">'</span></span>] <span class=\"pl-k\">for</span> <span class=\"pl-smi\">p</span> <span class=\"pl-k\">in</span> predictions]\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py<span class=\"pl-pds\">\"</span></span>, line 425, <span class=\"pl-k\">in</span> predict\n    <span class=\"pl-k\">for</span> <span class=\"pl-smi\">i</span> <span class=\"pl-k\">in</span> range(self._extract_batch_length(preds_evaluated)):\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py<span class=\"pl-pds\">\"</span></span>, line 592, <span class=\"pl-k\">in</span> _extract_batch_length\n    <span class=\"pl-s\"><span class=\"pl-pds\">'</span>different batch length then others.<span class=\"pl-pds\">'</span></span> % key)\nValueError: Batch length of predictions should be same. features has different batch length <span class=\"pl-k\">then</span> others.</pre></div>\n<p>Can anybody see what's wrong?<br>\nThanks in advance :)</p>", "body_text": "Hi,\nI'm trying to visualize the output of a convolutional autoencoder using TensorFlow Estimator API.\nI use 64*64 images stored in a Numpy array as input, and use tf.estimator.inputs.numpy_input_fn to feed this input to my estimator.\nEverything works perfectly fine during training, but as soon as I try to do predictions, it seems that I have an issue with my input_fn.\nPlease forgive me in advance, I am not 100% sure this is a bug, but I think I have tried everything I had in mind.\ninput_fn = tf.estimator.inputs.numpy_input_fn(\n    x={\"x\": train_data},\n    y=None,\n    batch_size=8,\n    num_epochs=None,\n    shuffle=True)\n\nautoencoder = tf.estimator.Estimator(model_fn=autoencoder_model_fn, model_dir=model_dir)\ntensors_to_log = {\"loss\": \"loss\"}\nlogging_hook = tf.train.LoggingTensorHook(tensors=tensors_to_log, every_n_iter=1000)\n\nautoencoder.train(\n    input_fn=input_fn,\n    steps=50000,\n    hooks=[logging_hook])\n\ninput_fn_predict = tf.estimator.inputs.numpy_input_fn(\n    x={\"x\": train_data},\n    y=None,\n    batch_size=1,\n    num_epochs=None,\n    shuffle=False)\npredictions = autoencoder.predict(input_fn=input_fn_predict)\npredictions = [p['decoded_image'] for p in predictions]\nprint predictions[0].shape\n\nI tried among other things to set batch_size to the same value for both input_fn, but it doesn't work and I get the following error :\nTraceback (most recent call last):\n  File \"AutoEncoder.py\", line 164, in <module>\n    main()\n  File \"AutoEncoder.py\", line 157, in main\n    predictions = [p['decoded_image'] for p in predictions]\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 425, in predict\n    for i in range(self._extract_batch_length(preds_evaluated)):\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 592, in _extract_batch_length\n    'different batch length then others.' % key)\nValueError: Batch length of predictions should be same. features has different batch length then others.\nCan anybody see what's wrong?\nThanks in advance :)", "body": "Hi,\r\n\r\nI'm trying to visualize the output of a convolutional autoencoder using TensorFlow Estimator API.\r\nI use 64*64 images stored in a Numpy array as input, and use `tf.estimator.inputs.numpy_input_fn` to feed this input to my estimator.\r\nEverything works perfectly fine during training, but as soon as I try to do predictions, it seems that I have an issue with my input_fn.\r\nPlease forgive me in advance, I am not 100% sure this is a bug, but I think I have tried everything I had in mind.\r\n\r\n```\r\ninput_fn = tf.estimator.inputs.numpy_input_fn(\r\n    x={\"x\": train_data},\r\n    y=None,\r\n    batch_size=8,\r\n    num_epochs=None,\r\n    shuffle=True)\r\n\r\nautoencoder = tf.estimator.Estimator(model_fn=autoencoder_model_fn, model_dir=model_dir)\r\ntensors_to_log = {\"loss\": \"loss\"}\r\nlogging_hook = tf.train.LoggingTensorHook(tensors=tensors_to_log, every_n_iter=1000)\r\n\r\nautoencoder.train(\r\n    input_fn=input_fn,\r\n    steps=50000,\r\n    hooks=[logging_hook])\r\n\r\ninput_fn_predict = tf.estimator.inputs.numpy_input_fn(\r\n    x={\"x\": train_data},\r\n    y=None,\r\n    batch_size=1,\r\n    num_epochs=None,\r\n    shuffle=False)\r\npredictions = autoencoder.predict(input_fn=input_fn_predict)\r\npredictions = [p['decoded_image'] for p in predictions]\r\nprint predictions[0].shape\r\n```\r\nI tried among other things to set `batch_size` to the same value for both input_fn, but it doesn't work and I get the following error : \r\n```bash \r\nTraceback (most recent call last):\r\n  File \"AutoEncoder.py\", line 164, in <module>\r\n    main()\r\n  File \"AutoEncoder.py\", line 157, in main\r\n    predictions = [p['decoded_image'] for p in predictions]\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 425, in predict\r\n    for i in range(self._extract_batch_length(preds_evaluated)):\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 592, in _extract_batch_length\r\n    'different batch length then others.' % key)\r\nValueError: Batch length of predictions should be same. features has different batch length then others.\r\n```\r\n\r\nCan anybody see what's wrong?\r\nThanks in advance :) "}