{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/55007189", "pull_request_review_id": null, "id": 55007189, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDA3MTg5", "diff_hunk": "@@ -0,0 +1,293 @@\n+#!/usr/bin/env bash\n+# Copyright 2016 Google Inc. All Rights Reserved.\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+# ==============================================================================\n+#\n+# Build the Python PIP installation package for TensorFlow\n+# and run the Python unit tests from the source code on the installation\n+#\n+# Usage:\n+#   test_installation.sh [--virtualenv]\n+#\n+# If the flag --virtualenv is set, the script will use \"python\" as the Python\n+# binary path. Otherwise, it will use tools/python_bin_path.sh to determine\n+# the Python binary path.\n+#\n+# When executing the Python unit tests, the script obeys the shell\n+# variables: PY_TEST_WHITELIST, PY_TEST_BLACKLIST, PY_TEST_GPU_BLACKLIST,\n+#\n+# To select only a subset of the Python tests to run, set the environment\n+# variable PY_TEST_WHITELIST, e.g.,\n+#   PY_TEST_WHITELIST=\"tensorflow/python/kernel_tests/shape_ops_test.py\"\n+# Separate the tests with a colon (:). Leave this environment variable empty\n+# to disable the whitelist.\n+#\n+# You can also ignore a set of the tests by using the environment variable\n+# PY_TEST_BLACKLIST. For example, you can include in PY_TEST_BLACKLIST the\n+# tests that depend on Python modules in TensorFlow source that are not\n+# exported publicly.\n+#\n+# In addition, you can put blacklist for only GPU build inthe environment\n+# variable PY_TEST_GPU_BLACKLIST.\n+#\n+# TF_BUILD_BAZEL_CLEAN, if set to any non-empty and non-0 value, directs the\n+# script to perform bazel clean prior to main build and test steps.\n+#\n+# If the environmental variable NO_TEST_ON_INSTALL is set to any non-empty\n+# value, the script will exit after the pip install step.\n+\n+# =============================================================================\n+# Test blacklist: General\n+#\n+# tensorflow/python/framework/ops_test.py\n+#   depends on depends on \"test_ops\", which is defined in a C++ file wrapped as\n+#   a .py file through the Bazel rule \u201ctf_gen_ops_wrapper_py\u201d.\n+# tensorflow/util/protobuf/compare_test.py:\n+#   depends on compare_test_pb2 defined outside Python\n+# tensorflow/python/framework/device_test.py:\n+#   depends on CheckValid() and ToString(), both defined externally\n+#\n+PY_TEST_BLACKLIST=\"${PY_TEST_BLACKLIST}:\"\\\n+\"tensorflow/python/framework/ops_test.py:\"\\\n+\"tensorflow/python/util/protobuf/compare_test.py:\"\\\n+\"tensorflow/python/framework/device_test.py\"\n+\n+# Test blacklist: GPU-only\n+PY_TEST_GPU_BLACKLIST=\"${PY_TEST_GPU_BLACKLIST}:\"\\\n+\"tensorflow/python/framework/function_test.py\"\n+\n+# =============================================================================\n+\n+\n+# Helper functions\n+# Get the absolute path from a path\n+abs_path() {\n+  [[ $1 = /* ]] && echo \"$1\" || echo \"$PWD/${1#./}\"\n+}\n+\n+\n+die() {\n+  echo $@\n+  exit 1\n+}\n+\n+\n+# Obtain the path to Python binary\n+# source tools/python_bin_path.sh\n+if [[ \"$1\" == \"--virtualenv\" ]]; then\n+  PYTHON_BIN_PATH=\"$(which python)\"\n+else\n+  source tools/python_bin_path.sh\n+  # Assume: PYTHON_BIN_PATH is exported by the script above\n+fi\n+\n+if [[ -z \"${PYTHON_BIN_PATH}\" ]]; then\n+  die \"PYTHON_BIN_PATH was not provided. If this is not virtualenv, \"\\\n+\"did you run configure?\"\n+fi\n+\n+# Determine the major and minor versions of Python being used (e.g., 2.7)\n+# This info will be useful for determining the directory of the local pip\n+# installation of Python\n+PY_MAJOR_MINOR_VER=$(${PYTHON_BIN_PATH} -V 2>&1 | awk '{print $NF}' | cut -d. -f-2)\n+\n+echo \"Python binary path to be used in PIP install-test: ${PYTHON_BIN_PATH} \"\\\n+\"(Major.Minor version: ${PY_MAJOR_MINOR_VER})\"\n+\n+\n+# Directory from which the unit-test files will be run\n+PY_TEST_DIR_REL=\"pip_test/tests\"\n+PY_TEST_DIR=$(abs_path ${PY_TEST_DIR_REL})  # Get absolute path\n+rm -rf ${PY_TEST_DIR} && mkdir -p ${PY_TEST_DIR}\n+\n+# Create test log directory\n+PY_TEST_LOG_DIR_REL=${PY_TEST_DIR_REL}/logs\n+PY_TEST_LOG_DIR=$(abs_path ${PY_TEST_LOG_DIR_REL})  # Absolute path\n+\n+mkdir ${PY_TEST_LOG_DIR}\n+\n+\n+# Copy source files that are required by the tests but are not included in the\n+# PIP package\n+\n+# Look for local Python library directory\n+LIB_PYTHON_DIR=\"\"\n+\n+pushd /tmp > /dev/null\n+TF_FILE=$(\"${PYTHON_BIN_PATH}\" -c \"import tensorflow as tf; print(tf.__file__)\") \\\n+|| die \"FAILED: Unable to import tensorflow in python: ${PYTHON_BIN_PATH}\"\n+popd > /dev/null\n+\n+# A typical value of TF_FILE would be:\n+#   /usr/local/lib/python2.7/dist-packages/tensorflow/__init__.pyc\n+LIB_PYTHON_DIR=$(dirname $(dirname $(dirname \"${TF_FILE}\")))\n+\n+if [[ -z ${LIB_PYTHON_DIR} ]]; then\n+  die \"Failed to find Python library directory where TensorFlow is installed.\"\n+else\n+  echo \"Found Python library directory where TensorFlow is installed: \"\\\n+\"${LIB_PYTHON_DIR}\"\n+fi\n+\n+PACKAGES_DIR=$(ls -d ${LIB_PYTHON_DIR}/*-packages | head -1)", "path": "tensorflow/tools/ci_build/builds/test_installation.sh", "position": null, "original_position": 143, "commit_id": "8082cf2ffdfab0842b479bdec214d7463322fe50", "original_commit_id": "0de5a91dfca931c900a025647aac6ae0a95bd375", "user": {"login": "jendap", "id": 567848, "node_id": "MDQ6VXNlcjU2Nzg0OA==", "avatar_url": "https://avatars0.githubusercontent.com/u/567848?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jendap", "html_url": "https://github.com/jendap", "followers_url": "https://api.github.com/users/jendap/followers", "following_url": "https://api.github.com/users/jendap/following{/other_user}", "gists_url": "https://api.github.com/users/jendap/gists{/gist_id}", "starred_url": "https://api.github.com/users/jendap/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jendap/subscriptions", "organizations_url": "https://api.github.com/users/jendap/orgs", "repos_url": "https://api.github.com/users/jendap/repos", "events_url": "https://api.github.com/users/jendap/events{/privacy}", "received_events_url": "https://api.github.com/users/jendap/received_events", "type": "User", "site_admin": false}, "body": "Why are the 20 lines above and bellow so complicated? The PACKAGES_DIR computation currently looks fragile. Would this work?\nTF_INSTALLATION_PATH=$(dirname $(\"${PYTHON_BIN_PATH}\" -c \"import tensorflow as tf; print(tf.**file**)\"))\n\nNote: No need of PACKAGES_DIR in the first place as TF_INSTALLATION_PATH=${PACKAGES_DIR}/tensorflow\n\nAnd everything from pushd can be gone.\n", "created_at": "2016-03-04T09:25:05Z", "updated_at": "2016-03-05T00:18:04Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/1380#discussion_r55007189", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/1380", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/55007189"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/1380#discussion_r55007189"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/1380"}}, "body_html": "<p>Why are the 20 lines above and bellow so complicated? The PACKAGES_DIR computation currently looks fragile. Would this work?<br>\nTF_INSTALLATION_PATH=$(dirname $(\"${PYTHON_BIN_PATH}\" -c \"import tensorflow as tf; print(tf.<strong>file</strong>)\"))</p>\n<p>Note: No need of PACKAGES_DIR in the first place as TF_INSTALLATION_PATH=${PACKAGES_DIR}/tensorflow</p>\n<p>And everything from pushd can be gone.</p>", "body_text": "Why are the 20 lines above and bellow so complicated? The PACKAGES_DIR computation currently looks fragile. Would this work?\nTF_INSTALLATION_PATH=$(dirname $(\"${PYTHON_BIN_PATH}\" -c \"import tensorflow as tf; print(tf.file)\"))\nNote: No need of PACKAGES_DIR in the first place as TF_INSTALLATION_PATH=${PACKAGES_DIR}/tensorflow\nAnd everything from pushd can be gone."}