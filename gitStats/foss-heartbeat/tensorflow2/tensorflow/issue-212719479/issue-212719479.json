{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8196", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8196/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8196/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8196/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/8196", "id": 212719479, "node_id": "MDU6SXNzdWUyMTI3MTk0Nzk=", "number": 8196, "title": "tf.py_func treating result different on Windows and Ubuntu in Tensorflow 1.0", "user": {"login": "andreas-eberle", "id": 9267365, "node_id": "MDQ6VXNlcjkyNjczNjU=", "avatar_url": "https://avatars0.githubusercontent.com/u/9267365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andreas-eberle", "html_url": "https://github.com/andreas-eberle", "followers_url": "https://api.github.com/users/andreas-eberle/followers", "following_url": "https://api.github.com/users/andreas-eberle/following{/other_user}", "gists_url": "https://api.github.com/users/andreas-eberle/gists{/gist_id}", "starred_url": "https://api.github.com/users/andreas-eberle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andreas-eberle/subscriptions", "organizations_url": "https://api.github.com/users/andreas-eberle/orgs", "repos_url": "https://api.github.com/users/andreas-eberle/repos", "events_url": "https://api.github.com/users/andreas-eberle/events{/privacy}", "received_events_url": "https://api.github.com/users/andreas-eberle/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "zffchen78", "id": 7943790, "node_id": "MDQ6VXNlcjc5NDM3OTA=", "avatar_url": "https://avatars3.githubusercontent.com/u/7943790?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zffchen78", "html_url": "https://github.com/zffchen78", "followers_url": "https://api.github.com/users/zffchen78/followers", "following_url": "https://api.github.com/users/zffchen78/following{/other_user}", "gists_url": "https://api.github.com/users/zffchen78/gists{/gist_id}", "starred_url": "https://api.github.com/users/zffchen78/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zffchen78/subscriptions", "organizations_url": "https://api.github.com/users/zffchen78/orgs", "repos_url": "https://api.github.com/users/zffchen78/repos", "events_url": "https://api.github.com/users/zffchen78/events{/privacy}", "received_events_url": "https://api.github.com/users/zffchen78/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "zffchen78", "id": 7943790, "node_id": "MDQ6VXNlcjc5NDM3OTA=", "avatar_url": "https://avatars3.githubusercontent.com/u/7943790?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zffchen78", "html_url": "https://github.com/zffchen78", "followers_url": "https://api.github.com/users/zffchen78/followers", "following_url": "https://api.github.com/users/zffchen78/following{/other_user}", "gists_url": "https://api.github.com/users/zffchen78/gists{/gist_id}", "starred_url": "https://api.github.com/users/zffchen78/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zffchen78/subscriptions", "organizations_url": "https://api.github.com/users/zffchen78/orgs", "repos_url": "https://api.github.com/users/zffchen78/repos", "events_url": "https://api.github.com/users/zffchen78/events{/privacy}", "received_events_url": "https://api.github.com/users/zffchen78/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2017-03-08T12:21:30Z", "updated_at": "2017-03-25T06:36:03Z", "closed_at": "2017-03-25T06:36:03Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>Description</h3>\n<p>I'm using tf.py_func in my data fetching pipeline. The applied function basically calculates an int from an int. When I run the tensorflow code, it works on my Windows 10 development laptop, but fails on the Ubuntu server with an error that the python function would return an int64 instead of the expected int32. It is the same behavior for both, the CPU and the GPU backend.</p>\n<p>I would expect tensorflow to behave the same across different platforms. Am I doing something wrong or is this a bug?</p>\n<h3>Environment info</h3>\n<p>Operating Systems:</p>\n<ul>\n<li>\n<p>Windows 10: Python 3.5.2; Tensorflow 1.0.1 (I tried both, CPU and GPU) installed via pip; CUDA 8.0, cudnn 5.1</p>\n<p><a href=\"https://gist.github.com/andreas-eberle/76dfaeb8467dd3b520aa8390bd2b5d33\">https://gist.github.com/andreas-eberle/76dfaeb8467dd3b520aa8390bd2b5d33</a></p>\n</li>\n<li>\n<p>Ubuntu 14.04: Python 3.4.3 (I cannot update it because the server is managed); Tensorflow 1.0.0 (there seems to be no 1.0.1 for Ubuntu) (I tried both, CPU and GPU) installed via pip (<a href=\"https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-1.0.0-cp34-cp34m-linux_x86_64.whl\" rel=\"nofollow\">https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-1.0.0-cp34-cp34m-linux_x86_64.whl</a>); CUDA 8.0, cudnn 5.1</p>\n<p><a href=\"https://gist.github.com/andreas-eberle/fbba8fdb73bff433d89ece9a1946f269\">https://gist.github.com/andreas-eberle/fbba8fdb73bff433d89ece9a1946f269</a></p>\n</li>\n</ul>\n<h3>Minimal reproducible example</h3>\n<pre><code>import tensorflow as tf\n\n\ndef multiply_by_2(value):\n    return value * 2\n\n\nsess = tf.InteractiveSession()\n\ninput_pl = tf.placeholder(tf.int32, [])\n\nresult_tensor = tf.py_func(multiply_by_2, [input_pl], [tf.int32])[0]\n\nresult_value = sess.run([result_tensor], feed_dict={input_pl: 6})\n\nprint(result_value)\n</code></pre>\n<h4>Output on Windows (using tensorflow-cpu)</h4>\n<pre><code>D:\\programs\\python3.5\\python.exe D:/development/private/masters/pReId-mentor/pipeline/BugTest.py\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"BestSplits\" device_type: \"CPU\"') for unknown op: BestSplits\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"CountExtremelyRandomStats\" device_type: \"CPU\"') for unknown op: CountExtremelyRandomStats\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"FinishedNodes\" device_type: \"CPU\"') for unknown op: FinishedNodes\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"GrowTree\" device_type: \"CPU\"') for unknown op: GrowTree\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"ReinterpretStringToFloat\" device_type: \"CPU\"') for unknown op: ReinterpretStringToFloat\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"SampleInputs\" device_type: \"CPU\"') for unknown op: SampleInputs\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"ScatterAddNdim\" device_type: \"CPU\"') for unknown op: ScatterAddNdim\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"TopNInsert\" device_type: \"CPU\"') for unknown op: TopNInsert\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"TopNRemove\" device_type: \"CPU\"') for unknown op: TopNRemove\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"TreePredictions\" device_type: \"CPU\"') for unknown op: TreePredictions\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"UpdateFertileSlots\" device_type: \"CPU\"') for unknown op: UpdateFertileSlots\n[12]\n</code></pre>\n<h4>Output on Ubuntu server (using tensorflow-cpu)</h4>\n<pre><code>aeberle@i14s35:~/development/pReId-mentor$ python3 pipeline/BugTest.py\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE3 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX2 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use FMA instructions, but these are available on your machine and could speed up CPU computations.\nTraceback (most recent call last):\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1022, in _do_call\n    return fn(*args)\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1004, in _run_fn\n    status, run_metadata)\n  File \"/usr/lib/python3.4/contextlib.py\", line 66, in __exit__\n    next(self.gen)\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/framework/errors_impl.py\", line 469, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors_impl.InvalidArgumentError: 0-th value returned by pyfunc_0 is int64, but expects int32\n         [[Node: PyFunc = PyFunc[Tin=[DT_INT32], Tout=[DT_INT32], token=\"pyfunc_0\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](_recv_Placeholder_0)]]\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"pipeline/BugTest.py\", line 14, in &lt;module&gt;\n    result_value = sess.run([result_tensor], feed_dict={input_pl: 6})\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 767, in run\n    run_metadata_ptr)\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 965, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1015, in _do_run\n    target_list, options, run_metadata)\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1035, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InvalidArgumentError: 0-th value returned by pyfunc_0 is int64, but expects int32\n         [[Node: PyFunc = PyFunc[Tin=[DT_INT32], Tout=[DT_INT32], token=\"pyfunc_0\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](_recv_Placeholder_0)]]\n\nCaused by op 'PyFunc', defined at:\n  File \"pipeline/BugTest.py\", line 12, in &lt;module&gt;\n    result_tensor = tf.py_func(multiply_by_2, [input_pl], [tf.int32])[0]\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/ops/script_ops.py\", line 192, in py_func\n    input=inp, token=token, Tout=Tout, name=name)\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/ops/gen_script_ops.py\", line 40, in _py_func\n    name=name)\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\n    op_def=op_def)\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/framework/ops.py\", line 2395, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\n    self._traceback = _extract_stack()\n\nInvalidArgumentError (see above for traceback): 0-th value returned by pyfunc_0 is int64, but expects int32\n         [[Node: PyFunc = PyFunc[Tin=[DT_INT32], Tout=[DT_INT32], token=\"pyfunc_0\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](_recv_Placeholder_0)]]\n</code></pre>", "body_text": "Description\nI'm using tf.py_func in my data fetching pipeline. The applied function basically calculates an int from an int. When I run the tensorflow code, it works on my Windows 10 development laptop, but fails on the Ubuntu server with an error that the python function would return an int64 instead of the expected int32. It is the same behavior for both, the CPU and the GPU backend.\nI would expect tensorflow to behave the same across different platforms. Am I doing something wrong or is this a bug?\nEnvironment info\nOperating Systems:\n\n\nWindows 10: Python 3.5.2; Tensorflow 1.0.1 (I tried both, CPU and GPU) installed via pip; CUDA 8.0, cudnn 5.1\nhttps://gist.github.com/andreas-eberle/76dfaeb8467dd3b520aa8390bd2b5d33\n\n\nUbuntu 14.04: Python 3.4.3 (I cannot update it because the server is managed); Tensorflow 1.0.0 (there seems to be no 1.0.1 for Ubuntu) (I tried both, CPU and GPU) installed via pip (https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-1.0.0-cp34-cp34m-linux_x86_64.whl); CUDA 8.0, cudnn 5.1\nhttps://gist.github.com/andreas-eberle/fbba8fdb73bff433d89ece9a1946f269\n\n\nMinimal reproducible example\nimport tensorflow as tf\n\n\ndef multiply_by_2(value):\n    return value * 2\n\n\nsess = tf.InteractiveSession()\n\ninput_pl = tf.placeholder(tf.int32, [])\n\nresult_tensor = tf.py_func(multiply_by_2, [input_pl], [tf.int32])[0]\n\nresult_value = sess.run([result_tensor], feed_dict={input_pl: 6})\n\nprint(result_value)\n\nOutput on Windows (using tensorflow-cpu)\nD:\\programs\\python3.5\\python.exe D:/development/private/masters/pReId-mentor/pipeline/BugTest.py\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"BestSplits\" device_type: \"CPU\"') for unknown op: BestSplits\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"CountExtremelyRandomStats\" device_type: \"CPU\"') for unknown op: CountExtremelyRandomStats\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"FinishedNodes\" device_type: \"CPU\"') for unknown op: FinishedNodes\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"GrowTree\" device_type: \"CPU\"') for unknown op: GrowTree\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"ReinterpretStringToFloat\" device_type: \"CPU\"') for unknown op: ReinterpretStringToFloat\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"SampleInputs\" device_type: \"CPU\"') for unknown op: SampleInputs\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"ScatterAddNdim\" device_type: \"CPU\"') for unknown op: ScatterAddNdim\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"TopNInsert\" device_type: \"CPU\"') for unknown op: TopNInsert\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"TopNRemove\" device_type: \"CPU\"') for unknown op: TopNRemove\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"TreePredictions\" device_type: \"CPU\"') for unknown op: TreePredictions\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"UpdateFertileSlots\" device_type: \"CPU\"') for unknown op: UpdateFertileSlots\n[12]\n\nOutput on Ubuntu server (using tensorflow-cpu)\naeberle@i14s35:~/development/pReId-mentor$ python3 pipeline/BugTest.py\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE3 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX2 instructions, but these are available on your machine and could speed up CPU computations.\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use FMA instructions, but these are available on your machine and could speed up CPU computations.\nTraceback (most recent call last):\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1022, in _do_call\n    return fn(*args)\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1004, in _run_fn\n    status, run_metadata)\n  File \"/usr/lib/python3.4/contextlib.py\", line 66, in __exit__\n    next(self.gen)\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/framework/errors_impl.py\", line 469, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors_impl.InvalidArgumentError: 0-th value returned by pyfunc_0 is int64, but expects int32\n         [[Node: PyFunc = PyFunc[Tin=[DT_INT32], Tout=[DT_INT32], token=\"pyfunc_0\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](_recv_Placeholder_0)]]\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"pipeline/BugTest.py\", line 14, in <module>\n    result_value = sess.run([result_tensor], feed_dict={input_pl: 6})\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 767, in run\n    run_metadata_ptr)\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 965, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1015, in _do_run\n    target_list, options, run_metadata)\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1035, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InvalidArgumentError: 0-th value returned by pyfunc_0 is int64, but expects int32\n         [[Node: PyFunc = PyFunc[Tin=[DT_INT32], Tout=[DT_INT32], token=\"pyfunc_0\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](_recv_Placeholder_0)]]\n\nCaused by op 'PyFunc', defined at:\n  File \"pipeline/BugTest.py\", line 12, in <module>\n    result_tensor = tf.py_func(multiply_by_2, [input_pl], [tf.int32])[0]\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/ops/script_ops.py\", line 192, in py_func\n    input=inp, token=token, Tout=Tout, name=name)\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/ops/gen_script_ops.py\", line 40, in _py_func\n    name=name)\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\n    op_def=op_def)\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/framework/ops.py\", line 2395, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\n    self._traceback = _extract_stack()\n\nInvalidArgumentError (see above for traceback): 0-th value returned by pyfunc_0 is int64, but expects int32\n         [[Node: PyFunc = PyFunc[Tin=[DT_INT32], Tout=[DT_INT32], token=\"pyfunc_0\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](_recv_Placeholder_0)]]", "body": "### Description\r\n\r\nI'm using tf.py_func in my data fetching pipeline. The applied function basically calculates an int from an int. When I run the tensorflow code, it works on my Windows 10 development laptop, but fails on the Ubuntu server with an error that the python function would return an int64 instead of the expected int32. It is the same behavior for both, the CPU and the GPU backend. \r\n\r\nI would expect tensorflow to behave the same across different platforms. Am I doing something wrong or is this a bug?\r\n\r\n### Environment info\r\nOperating Systems:\r\n\r\n* Windows 10: Python 3.5.2; Tensorflow 1.0.1 (I tried both, CPU and GPU) installed via pip; CUDA 8.0, cudnn 5.1\r\n\r\n   https://gist.github.com/andreas-eberle/76dfaeb8467dd3b520aa8390bd2b5d33\r\n\r\n* Ubuntu 14.04: Python 3.4.3 (I cannot update it because the server is managed); Tensorflow 1.0.0 (there seems to be no 1.0.1 for Ubuntu) (I tried both, CPU and GPU) installed via pip (https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-1.0.0-cp34-cp34m-linux_x86_64.whl); CUDA 8.0, cudnn 5.1\r\n\r\n   https://gist.github.com/andreas-eberle/fbba8fdb73bff433d89ece9a1946f269\r\n\r\n### Minimal reproducible example\r\n```\r\nimport tensorflow as tf\r\n\r\n\r\ndef multiply_by_2(value):\r\n    return value * 2\r\n\r\n\r\nsess = tf.InteractiveSession()\r\n\r\ninput_pl = tf.placeholder(tf.int32, [])\r\n\r\nresult_tensor = tf.py_func(multiply_by_2, [input_pl], [tf.int32])[0]\r\n\r\nresult_value = sess.run([result_tensor], feed_dict={input_pl: 6})\r\n\r\nprint(result_value)\r\n```\r\n\r\n#### Output on Windows (using tensorflow-cpu)\r\n```\r\nD:\\programs\\python3.5\\python.exe D:/development/private/masters/pReId-mentor/pipeline/BugTest.py\r\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"BestSplits\" device_type: \"CPU\"') for unknown op: BestSplits\r\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"CountExtremelyRandomStats\" device_type: \"CPU\"') for unknown op: CountExtremelyRandomStats\r\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"FinishedNodes\" device_type: \"CPU\"') for unknown op: FinishedNodes\r\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"GrowTree\" device_type: \"CPU\"') for unknown op: GrowTree\r\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"ReinterpretStringToFloat\" device_type: \"CPU\"') for unknown op: ReinterpretStringToFloat\r\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"SampleInputs\" device_type: \"CPU\"') for unknown op: SampleInputs\r\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"ScatterAddNdim\" device_type: \"CPU\"') for unknown op: ScatterAddNdim\r\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"TopNInsert\" device_type: \"CPU\"') for unknown op: TopNInsert\r\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"TopNRemove\" device_type: \"CPU\"') for unknown op: TopNRemove\r\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"TreePredictions\" device_type: \"CPU\"') for unknown op: TreePredictions\r\nE c:\\tf_jenkins\\home\\workspace\\release-win\\device\\cpu\\os\\windows\\tensorflow\\core\\framework\\op_kernel.cc:943] OpKernel ('op: \"UpdateFertileSlots\" device_type: \"CPU\"') for unknown op: UpdateFertileSlots\r\n[12]\r\n```\r\n\r\n#### Output on Ubuntu server (using tensorflow-cpu)\r\n```\r\naeberle@i14s35:~/development/pReId-mentor$ python3 pipeline/BugTest.py\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE3 instructions, but these are available on your machine and could speed up CPU computations.\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX2 instructions, but these are available on your machine and could speed up CPU computations.\r\nW tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use FMA instructions, but these are available on your machine and could speed up CPU computations.\r\nTraceback (most recent call last):\r\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1022, in _do_call\r\n    return fn(*args)\r\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1004, in _run_fn\r\n    status, run_metadata)\r\n  File \"/usr/lib/python3.4/contextlib.py\", line 66, in __exit__\r\n    next(self.gen)\r\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/framework/errors_impl.py\", line 469, in raise_exception_on_not_ok_status\r\n    pywrap_tensorflow.TF_GetCode(status))\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: 0-th value returned by pyfunc_0 is int64, but expects int32\r\n         [[Node: PyFunc = PyFunc[Tin=[DT_INT32], Tout=[DT_INT32], token=\"pyfunc_0\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](_recv_Placeholder_0)]]\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"pipeline/BugTest.py\", line 14, in <module>\r\n    result_value = sess.run([result_tensor], feed_dict={input_pl: 6})\r\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 767, in run\r\n    run_metadata_ptr)\r\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 965, in _run\r\n    feed_dict_string, options, run_metadata)\r\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1015, in _do_run\r\n    target_list, options, run_metadata)\r\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1035, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: 0-th value returned by pyfunc_0 is int64, but expects int32\r\n         [[Node: PyFunc = PyFunc[Tin=[DT_INT32], Tout=[DT_INT32], token=\"pyfunc_0\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](_recv_Placeholder_0)]]\r\n\r\nCaused by op 'PyFunc', defined at:\r\n  File \"pipeline/BugTest.py\", line 12, in <module>\r\n    result_tensor = tf.py_func(multiply_by_2, [input_pl], [tf.int32])[0]\r\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/ops/script_ops.py\", line 192, in py_func\r\n    input=inp, token=token, Tout=Tout, name=name)\r\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/ops/gen_script_ops.py\", line 40, in _py_func\r\n    name=name)\r\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\r\n    op_def=op_def)\r\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/framework/ops.py\", line 2395, in create_op\r\n    original_op=self._default_original_op, op_def=op_def)\r\n  File \"/home/aeberle/.local/lib/python3.4/site-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\r\n    self._traceback = _extract_stack()\r\n\r\nInvalidArgumentError (see above for traceback): 0-th value returned by pyfunc_0 is int64, but expects int32\r\n         [[Node: PyFunc = PyFunc[Tin=[DT_INT32], Tout=[DT_INT32], token=\"pyfunc_0\", _device=\"/job:localhost/replica:0/task:0/cpu:0\"](_recv_Placeholder_0)]]\r\n```\r\n"}