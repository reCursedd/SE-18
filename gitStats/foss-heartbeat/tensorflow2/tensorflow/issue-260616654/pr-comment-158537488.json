{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/158537488", "pull_request_review_id": 85371045, "id": 158537488, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1ODUzNzQ4OA==", "diff_hunk": "@@ -445,15 +520,49 @@ def _maybe_merge_batch_beams(self, t, s):\n       A reshaped version of t with shape `[batch_size, beam_width] + s`.\n \n     Raises:\n-      TypeError: If `t` is an instance of `TensorArray`.\n       ValueError:  If the rank of `t` is not statically known.\n     \"\"\"\n+    if isinstance(t, tensor_array_ops.TensorArray):\n+      return t\n     _check_maybe(t)\n     if t.shape.ndims >= 2:\n       return self._merge_batch_beams(t, s)\n     else:\n       return t\n \n+  def _maybe_sort_array_beams(self, t, parent_ids, sequence_length):\n+    \"\"\"Maybe sorts beams within a `TensorArray`.\n+\n+    Args:\n+      t: A `TensorArray` of size `max_time` that contains `Tensor`s of shape\n+        `[batch_size, beam_width, s]` or `[batch_size * beam_width, s]` where\n+        `s` is the depth shape.\n+      parent_ids: The parent ids of shape `[max_time, batch_size, beam_width]`.\n+      sequence_length: The sequence length of shape `[batch_size, beam_width]`.\n+\n+    Returns:\n+      A `TensorArray` where beams are sorted in each `Tensor` or `t` itself if it\n+      is not a `TensorArray` or does not meet shape requirements.\n+    \"\"\"\n+    if (not isinstance(t, tensor_array_ops.TensorArray)\n+        or not t._infer_shape or not t._element_shape):  # pylint: disable=protected-access\n+      return t\n+    shape = t._element_shape[0]  # pylint: disable=protected-access\n+    batch_size = tensor_util.constant_value(self._batch_size)", "path": "tensorflow/contrib/seq2seq/python/ops/beam_search_decoder.py", "position": null, "original_position": 163, "commit_id": "d3eb228f1db2d60caf380833684944ce12203634", "original_commit_id": "16da288ad0dd8a191f0bb6b3ee14aca6e0c4f8d8", "user": {"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}, "body": "this may be None;' in which case the test at L554 is ill defined.", "created_at": "2017-12-22T18:17:52Z", "updated_at": "2018-03-17T07:09:51Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/13312#discussion_r158537488", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13312", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/158537488"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/13312#discussion_r158537488"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13312"}}, "body_html": "<p>this may be None;' in which case the test at L554 is ill defined.</p>", "body_text": "this may be None;' in which case the test at L554 is ill defined."}