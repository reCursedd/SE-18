{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/161837021", "pull_request_review_id": 89189979, "id": 161837021, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MTgzNzAyMQ==", "diff_hunk": "@@ -560,20 +599,12 @@ def _maybe_sort_array_beams(self, t, parent_ids, sequence_length):\n       return t\n     shape = t._element_shape[0]\n     # pylint: enable=protected-access\n-    batch_size = tensor_util.constant_value(self._batch_size)\n-    reshaped_shape = tensor_shape.TensorShape(\n-        [batch_size, self._beam_width, None])\n-    if (shape.ndims >= 1 and shape[0] == batch_size * self._beam_width\n-        or shape.ndims >= 2\n-        and shape[0] == batch_size and shape[1] == self._beam_width):\n+    _check_static_batch_beam_maybe(\n+        shape, tensor_util.constant_value(self._batch_size), self._beam_width)\n+    t = t.stack()", "path": "tensorflow/contrib/seq2seq/python/ops/beam_search_decoder.py", "position": null, "original_position": 80, "commit_id": "d3eb228f1db2d60caf380833684944ce12203634", "original_commit_id": "a1ceaf8ba5f7820edca92ff9e61d4a28251a5b9e", "user": {"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}, "body": "you may want to move the stack inside the control_dependencies.  sometimes people use element_shapes that have an unknown primary dimension, and they use `.concat()` instead of `.stack()`.  if someone's doing that, then this stack will fail because the individual elements have different shapes.  if you move the stack inside the control dependencies, they'll get a much better error message at runtime.", "created_at": "2018-01-16T17:57:20Z", "updated_at": "2018-03-17T07:09:51Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/13312#discussion_r161837021", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13312", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/161837021"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/13312#discussion_r161837021"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13312"}}, "body_html": "<p>you may want to move the stack inside the control_dependencies.  sometimes people use element_shapes that have an unknown primary dimension, and they use <code>.concat()</code> instead of <code>.stack()</code>.  if someone's doing that, then this stack will fail because the individual elements have different shapes.  if you move the stack inside the control dependencies, they'll get a much better error message at runtime.</p>", "body_text": "you may want to move the stack inside the control_dependencies.  sometimes people use element_shapes that have an unknown primary dimension, and they use .concat() instead of .stack().  if someone's doing that, then this stack will fail because the individual elements have different shapes.  if you move the stack inside the control dependencies, they'll get a much better error message at runtime."}