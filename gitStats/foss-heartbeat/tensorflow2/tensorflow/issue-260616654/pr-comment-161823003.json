{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/161823003", "pull_request_review_id": 89173419, "id": 161823003, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MTgyMzAwMw==", "diff_hunk": "@@ -445,15 +517,55 @@ def _maybe_merge_batch_beams(self, t, s):\n       A reshaped version of t with shape `[batch_size, beam_width] + s`.\n \n     Raises:\n-      TypeError: If `t` is an instance of `TensorArray`.\n       ValueError:  If the rank of `t` is not statically known.\n     \"\"\"\n+    if isinstance(t, tensor_array_ops.TensorArray):\n+      return t\n     _check_maybe(t)\n     if t.shape.ndims >= 2:\n       return self._merge_batch_beams(t, s)\n     else:\n       return t\n \n+  def _maybe_sort_array_beams(self, t, parent_ids, sequence_length):\n+    \"\"\"Maybe sorts beams within a `TensorArray`.\n+\n+    Args:\n+      t: A `TensorArray` of size `max_time` that contains `Tensor`s of shape\n+        `[batch_size, beam_width, s]` or `[batch_size * beam_width, s]` where\n+        `s` is the depth shape.\n+      parent_ids: The parent ids of shape `[max_time, batch_size, beam_width]`.\n+      sequence_length: The sequence length of shape `[batch_size, beam_width]`.\n+\n+    Returns:\n+      A `TensorArray` where beams are sorted in each `Tensor` or `t` itself if it\n+      is not a `TensorArray` or does not meet shape requirements.\n+    \"\"\"\n+    if not isinstance(t, tensor_array_ops.TensorArray):\n+      return t\n+    if (not t._infer_shape or not t._element_shape\n+        or t._element_shape[0].ndims is None or t._element_shape[0].ndims < 1):  # pylint: disable=protected-access\n+      tf.logging.warn(\"The cell state contains a TensorArray that is not \"", "path": "tensorflow/contrib/seq2seq/python/ops/beam_search_decoder.py", "position": null, "original_position": 160, "commit_id": "d3eb228f1db2d60caf380833684944ce12203634", "original_commit_id": "10a222c5c97679995df66c386954d024f039c630", "user": {"login": "guillaumekln", "id": 4805513, "node_id": "MDQ6VXNlcjQ4MDU1MTM=", "avatar_url": "https://avatars3.githubusercontent.com/u/4805513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guillaumekln", "html_url": "https://github.com/guillaumekln", "followers_url": "https://api.github.com/users/guillaumekln/followers", "following_url": "https://api.github.com/users/guillaumekln/following{/other_user}", "gists_url": "https://api.github.com/users/guillaumekln/gists{/gist_id}", "starred_url": "https://api.github.com/users/guillaumekln/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guillaumekln/subscriptions", "organizations_url": "https://api.github.com/users/guillaumekln/orgs", "repos_url": "https://api.github.com/users/guillaumekln/repos", "events_url": "https://api.github.com/users/guillaumekln/events{/privacy}", "received_events_url": "https://api.github.com/users/guillaumekln/received_events", "type": "User", "site_admin": false}, "body": "This is done.", "created_at": "2018-01-16T17:05:53Z", "updated_at": "2018-03-17T07:09:51Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/13312#discussion_r161823003", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13312", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/161823003"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/13312#discussion_r161823003"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/13312"}}, "body_html": "<p>This is done.</p>", "body_text": "This is done.", "in_reply_to_id": 160486059}