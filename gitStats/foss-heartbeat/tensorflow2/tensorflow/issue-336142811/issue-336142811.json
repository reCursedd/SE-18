{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20337", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20337/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20337/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20337/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/20337", "id": 336142811, "node_id": "MDU6SXNzdWUzMzYxNDI4MTE=", "number": 20337, "title": "profiler add_step make import_meta_graph error", "user": {"login": "hxsnow10", "id": 5416620, "node_id": "MDQ6VXNlcjU0MTY2MjA=", "avatar_url": "https://avatars2.githubusercontent.com/u/5416620?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hxsnow10", "html_url": "https://github.com/hxsnow10", "followers_url": "https://api.github.com/users/hxsnow10/followers", "following_url": "https://api.github.com/users/hxsnow10/following{/other_user}", "gists_url": "https://api.github.com/users/hxsnow10/gists{/gist_id}", "starred_url": "https://api.github.com/users/hxsnow10/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hxsnow10/subscriptions", "organizations_url": "https://api.github.com/users/hxsnow10/orgs", "repos_url": "https://api.github.com/users/hxsnow10/repos", "events_url": "https://api.github.com/users/hxsnow10/events{/privacy}", "received_events_url": "https://api.github.com/users/hxsnow10/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "cy89", "id": 29663194, "node_id": "MDQ6VXNlcjI5NjYzMTk0", "avatar_url": "https://avatars0.githubusercontent.com/u/29663194?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cy89", "html_url": "https://github.com/cy89", "followers_url": "https://api.github.com/users/cy89/followers", "following_url": "https://api.github.com/users/cy89/following{/other_user}", "gists_url": "https://api.github.com/users/cy89/gists{/gist_id}", "starred_url": "https://api.github.com/users/cy89/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cy89/subscriptions", "organizations_url": "https://api.github.com/users/cy89/orgs", "repos_url": "https://api.github.com/users/cy89/repos", "events_url": "https://api.github.com/users/cy89/events{/privacy}", "received_events_url": "https://api.github.com/users/cy89/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "cy89", "id": 29663194, "node_id": "MDQ6VXNlcjI5NjYzMTk0", "avatar_url": "https://avatars0.githubusercontent.com/u/29663194?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cy89", "html_url": "https://github.com/cy89", "followers_url": "https://api.github.com/users/cy89/followers", "following_url": "https://api.github.com/users/cy89/following{/other_user}", "gists_url": "https://api.github.com/users/cy89/gists{/gist_id}", "starred_url": "https://api.github.com/users/cy89/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cy89/subscriptions", "organizations_url": "https://api.github.com/users/cy89/orgs", "repos_url": "https://api.github.com/users/cy89/repos", "events_url": "https://api.github.com/users/cy89/events{/privacy}", "received_events_url": "https://api.github.com/users/cy89/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2018-06-27T09:13:09Z", "updated_at": "2018-09-28T21:19:16Z", "closed_at": "2018-09-28T21:19:16Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Centos 7</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary</li>\n<li><strong>TensorFlow version (use command below)</strong>:</li>\n<li><strong>Python version</strong>:<br>\ntf.VERSION = 1.8.0<br>\ntf.GIT_VERSION = v1.8.0-0-g93bc2e2072<br>\ntf.COMPILER_VERSION = v1.8.0-0-g93bc2e2072</li>\n<li><strong>GPU</strong>\uff1a<strong>as i test, \uff08gpu-tf, gpu-sess\uff09or (cpu-tf,cpu-sess)\uff0c    this error will always occur.</strong></li>\n</ul>\n<h3>Produce</h3>\n<ol>\n<li>prepare data<br>\ncp ner_data /ceph_ai/xiahong/data/ -rf</li>\n<li>python train.py -i example_configs/ner_config.py<br>\nnotice MODEL_PATH</li>\n<li>test follow 2 commands<br>\n-* python predict.py -i {MODEL_PATH}-0<br>\n-* python predict.py -i {MODEL_PATH}-34   (should fail load model if run add step, else works)</li>\n</ol>\n<p>comments train.py 86 \"profiler.add_step(step=step, run_meta=run_metadata)\" and try 2,3 again.</p>\n<h3>Describe the problem</h3>\n<p>after run profiler add_step,<br>\nthe saver.save file cannot import_meta_graph</p>\n<h3>Source code / logs</h3>\n<pre><code>Traceback (most recent call last):\n  File \"predict.py\", line 126, in &lt;module&gt;\n    tag_model=Classifier(args.model_path)\n  File \"predict.py\", line 50, in __init__\n    self.tf_model=TFModel(sess,model_path,inputs,outputs)\n  File \"/dockerdata/xiahong/tf_text_modeling-master/text_modeling/tf_utils/predict.py\", line 8, in __init__\n    saver = tf.train.import_meta_graph(\"{}.meta\".format(model_path), clear_devices=True)\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/training/saver.py\", line 1955, in import_meta_graph\n    **kwargs)\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/framework/meta_graph.py\", line 743, in import_scoped_meta_graph\n    producer_op_list=producer_op_list)\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/util/deprecation.py\", line 432, in new_func\n    return func(*args, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 493, in import_graph_def\n    raise ValueError(str(e))\nValueError: Can not squeeze dim[1], expected a dimension of 1, got 200 for 'cond_2/Squeeze' (op: 'Squeeze') with input shapes: [500,200,19].\n</code></pre>\n<p>without train.py line 86, it works well.</p>\n<p><a href=\"https://github.com/tensorflow/tensorflow/files/2140517/ner_data.zip\">ner_data.zip</a><br>\n<a href=\"https://github.com/tensorflow/tensorflow/files/2140519/text_modeling.zip\">text_modeling.zip</a></p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Centos 7\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below):\nPython version:\ntf.VERSION = 1.8.0\ntf.GIT_VERSION = v1.8.0-0-g93bc2e2072\ntf.COMPILER_VERSION = v1.8.0-0-g93bc2e2072\nGPU\uff1aas i test, \uff08gpu-tf, gpu-sess\uff09or (cpu-tf,cpu-sess)\uff0c    this error will always occur.\n\nProduce\n\nprepare data\ncp ner_data /ceph_ai/xiahong/data/ -rf\npython train.py -i example_configs/ner_config.py\nnotice MODEL_PATH\ntest follow 2 commands\n-* python predict.py -i {MODEL_PATH}-0\n-* python predict.py -i {MODEL_PATH}-34   (should fail load model if run add step, else works)\n\ncomments train.py 86 \"profiler.add_step(step=step, run_meta=run_metadata)\" and try 2,3 again.\nDescribe the problem\nafter run profiler add_step,\nthe saver.save file cannot import_meta_graph\nSource code / logs\nTraceback (most recent call last):\n  File \"predict.py\", line 126, in <module>\n    tag_model=Classifier(args.model_path)\n  File \"predict.py\", line 50, in __init__\n    self.tf_model=TFModel(sess,model_path,inputs,outputs)\n  File \"/dockerdata/xiahong/tf_text_modeling-master/text_modeling/tf_utils/predict.py\", line 8, in __init__\n    saver = tf.train.import_meta_graph(\"{}.meta\".format(model_path), clear_devices=True)\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/training/saver.py\", line 1955, in import_meta_graph\n    **kwargs)\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/framework/meta_graph.py\", line 743, in import_scoped_meta_graph\n    producer_op_list=producer_op_list)\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/util/deprecation.py\", line 432, in new_func\n    return func(*args, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 493, in import_graph_def\n    raise ValueError(str(e))\nValueError: Can not squeeze dim[1], expected a dimension of 1, got 200 for 'cond_2/Squeeze' (op: 'Squeeze') with input shapes: [500,200,19].\n\nwithout train.py line 86, it works well.\nner_data.zip\ntext_modeling.zip", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Centos 7\r\n- **TensorFlow installed from (source or binary)**: binary\r\n- **TensorFlow version (use command below)**: \r\n- **Python version**: \r\ntf.VERSION = 1.8.0\r\ntf.GIT_VERSION = v1.8.0-0-g93bc2e2072\r\ntf.COMPILER_VERSION = v1.8.0-0-g93bc2e2072\r\n- **GPU**\uff1a**as i test, \uff08gpu-tf, gpu-sess\uff09or (cpu-tf,cpu-sess)\uff0c    this error will always occur.**\r\n\r\n### Produce\r\n1. prepare data\r\ncp ner_data /ceph_ai/xiahong/data/ -rf\r\n2. python train.py -i example_configs/ner_config.py\r\nnotice MODEL_PATH\r\n3. test follow 2 commands\r\n-* python predict.py -i {MODEL_PATH}-0\r\n-* python predict.py -i {MODEL_PATH}-34   (should fail load model if run add step, else works)\r\n\r\ncomments train.py 86 \"profiler.add_step(step=step, run_meta=run_metadata)\" and try 2,3 again.\r\n\r\n### Describe the problem\r\nafter run profiler add_step, \r\nthe saver.save file cannot import_meta_graph \r\n\r\n### Source code / logs\r\n```\r\nTraceback (most recent call last):\r\n  File \"predict.py\", line 126, in <module>\r\n    tag_model=Classifier(args.model_path)\r\n  File \"predict.py\", line 50, in __init__\r\n    self.tf_model=TFModel(sess,model_path,inputs,outputs)\r\n  File \"/dockerdata/xiahong/tf_text_modeling-master/text_modeling/tf_utils/predict.py\", line 8, in __init__\r\n    saver = tf.train.import_meta_graph(\"{}.meta\".format(model_path), clear_devices=True)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/training/saver.py\", line 1955, in import_meta_graph\r\n    **kwargs)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/framework/meta_graph.py\", line 743, in import_scoped_meta_graph\r\n    producer_op_list=producer_op_list)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/util/deprecation.py\", line 432, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"/usr/lib/python2.7/site-packages/tensorflow/python/framework/importer.py\", line 493, in import_graph_def\r\n    raise ValueError(str(e))\r\nValueError: Can not squeeze dim[1], expected a dimension of 1, got 200 for 'cond_2/Squeeze' (op: 'Squeeze') with input shapes: [500,200,19].\r\n```\r\n without train.py line 86, it works well.\r\n\r\n[ner_data.zip](https://github.com/tensorflow/tensorflow/files/2140517/ner_data.zip)\r\n[text_modeling.zip](https://github.com/tensorflow/tensorflow/files/2140519/text_modeling.zip)\r\n\r\n"}