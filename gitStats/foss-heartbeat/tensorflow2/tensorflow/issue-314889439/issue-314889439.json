{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18583", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18583/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18583/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18583/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/18583", "id": 314889439, "node_id": "MDU6SXNzdWUzMTQ4ODk0Mzk=", "number": 18583, "title": "Fail to save the checkpoint with dataset Iterator saveable when using shuffle", "user": {"login": "tobegit3hub", "id": 2715000, "node_id": "MDQ6VXNlcjI3MTUwMDA=", "avatar_url": "https://avatars0.githubusercontent.com/u/2715000?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tobegit3hub", "html_url": "https://github.com/tobegit3hub", "followers_url": "https://api.github.com/users/tobegit3hub/followers", "following_url": "https://api.github.com/users/tobegit3hub/following{/other_user}", "gists_url": "https://api.github.com/users/tobegit3hub/gists{/gist_id}", "starred_url": "https://api.github.com/users/tobegit3hub/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tobegit3hub/subscriptions", "organizations_url": "https://api.github.com/users/tobegit3hub/orgs", "repos_url": "https://api.github.com/users/tobegit3hub/repos", "events_url": "https://api.github.com/users/tobegit3hub/events{/privacy}", "received_events_url": "https://api.github.com/users/tobegit3hub/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "tobegit3hub", "id": 2715000, "node_id": "MDQ6VXNlcjI3MTUwMDA=", "avatar_url": "https://avatars0.githubusercontent.com/u/2715000?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tobegit3hub", "html_url": "https://github.com/tobegit3hub", "followers_url": "https://api.github.com/users/tobegit3hub/followers", "following_url": "https://api.github.com/users/tobegit3hub/following{/other_user}", "gists_url": "https://api.github.com/users/tobegit3hub/gists{/gist_id}", "starred_url": "https://api.github.com/users/tobegit3hub/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tobegit3hub/subscriptions", "organizations_url": "https://api.github.com/users/tobegit3hub/orgs", "repos_url": "https://api.github.com/users/tobegit3hub/repos", "events_url": "https://api.github.com/users/tobegit3hub/events{/privacy}", "received_events_url": "https://api.github.com/users/tobegit3hub/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "tobegit3hub", "id": 2715000, "node_id": "MDQ6VXNlcjI3MTUwMDA=", "avatar_url": "https://avatars0.githubusercontent.com/u/2715000?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tobegit3hub", "html_url": "https://github.com/tobegit3hub", "followers_url": "https://api.github.com/users/tobegit3hub/followers", "following_url": "https://api.github.com/users/tobegit3hub/following{/other_user}", "gists_url": "https://api.github.com/users/tobegit3hub/gists{/gist_id}", "starred_url": "https://api.github.com/users/tobegit3hub/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tobegit3hub/subscriptions", "organizations_url": "https://api.github.com/users/tobegit3hub/orgs", "repos_url": "https://api.github.com/users/tobegit3hub/repos", "events_url": "https://api.github.com/users/tobegit3hub/events{/privacy}", "received_events_url": "https://api.github.com/users/tobegit3hub/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 13, "created_at": "2018-04-17T03:11:56Z", "updated_at": "2018-08-03T01:45:31Z", "closed_at": "2018-08-02T22:20:57Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>System information</h3>\n<p>== cat /etc/issue ===============================================<br>\nDarwin mbp-2.local 17.5.0 Darwin Kernel Version 17.5.0: Mon Mar  5 22:24:32 PST 2018; root:xnu-4570.51.1~1/RELEASE_X86_64 x86_64<br>\nMac OS X 10.13.4</p>\n<p>== are we in docker =============================================<br>\nNo</p>\n<p>== compiler =====================================================<br>\nApple LLVM version 9.1.0 (clang-902.0.39.1)<br>\nTarget: x86_64-apple-darwin17.5.0<br>\nThread model: posix<br>\nInstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin</p>\n<p>== uname -a =====================================================<br>\nDarwin mbp-2.local 17.5.0 Darwin Kernel Version 17.5.0: Mon Mar  5 22:24:32 PST 2018; root:xnu-4570.51.1~1/RELEASE_X86_64 x86_64</p>\n<p>== check pips ===================================================<br>\nnumpy (1.14.2)<br>\nprotobuf (3.5.2.post1)<br>\nsimple-tensorflow-serving (0.2.6, /usr/local/lib/python2.7/site-packages/simple_tensorflow_serving-0.2.6-py2.7.egg)<br>\ntensorflow (1.7.0)<br>\ntensorflow-hub (0.1.0)<br>\ntensorflow-model-analysis (0.6.0)<br>\ntensorflow-serving-api (1.0.0)<br>\ntensorflow-tensorboard (1.5.0)<br>\ntensorflow-transform (0.6.0)<br>\ntensorflowjs (0.1.0)<br>\ntensorflowonspark (1.0.0)</p>\n<p>== check for virtualenv =========================================<br>\nFalse</p>\n<p>== tensorflow import ============================================<br>\ntf.VERSION = 1.7.0<br>\ntf.GIT_VERSION = v1.7.0-3-g024aecf414<br>\ntf.COMPILER_VERSION = v1.7.0-3-g024aecf414<br>\nSanity check: array([1], dtype=int32)<br>\n/usr/local/lib/python2.7/site-packages/h5py/<strong>init</strong>.py:36: FutureWarning: Conversion of the second argument of issubdtype from <code>float</code> to <code>np.floating</code> is deprecated. In future, it will be treated as <code>np .float64 == np.dtype(float).type</code>.<br>\nfrom ._conv import register_converters as _register_converters</p>\n<p>== env ==========================================================<br>\nLD_LIBRARY_PATH is unset<br>\nDYLD_LIBRARY_PATH is unset</p>\n<p>== nvidia-smi ===================================================<br>\na.sh: line 105: nvidia-smi: command not found</p>\n<p>== cuda libs  ===================================================</p>\n<h3>Describe the problem</h3>\n<p>We follow the <a href=\"https://www.tensorflow.org/programmers_guide/datasets#saving_iterator_state\" rel=\"nofollow\">official document</a> to save the checkpoint with dataset Iterator saveable but it fails. Maybe the implementation of serializing <code>iterator_ops</code> is not released in public repo.</p>\n<h3>Source code / logs</h3>\n<pre><code>dataset = tf.data.Dataset.from_tensor_slices((image_list_placeholder, label_list_placeholder))\niterator = dataset.make_initializable_iterator()\nsaveable = tf.contrib.data.make_saveable_from_iterator(iterator)\ntf.add_to_collection(tf.GraphKeys.SAVEABLE_OBJECTS, saveable)\nsaver = tf.train.Saver()\n\nwith tf.Session() as sess:\n  saver.save(sess, checkpoint_file, global_step=step_value)\n</code></pre>\n<p>Here is the error log.</p>\n<pre><code>2018-04-17 11:02:40.756347: W tensorflow/core/framework/op_kernel.cc:1273] OP_REQUIRES failed at iterator_ops.cc:1049 : Unimplemented: AsGraphDefInternal\nTraceback (most recent call last):\n  File \"./mnist_train.py\", line 181, in &lt;module&gt;\n    main(parse_args())\n  File \"./mnist_train.py\", line 156, in main\n    saver.save(sess, checkpoint_file, global_step=step_value)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/training/saver.py\", line 1676, in save\n    {self.saver_def.filename_tensor_name: checkpoint_file})\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 905, in run\n    run_metadata_ptr)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1140, in _run\n    feed_dict_tensor, options, run_metadata)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1321, in _do_run\n    run_metadata)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1340, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.UnimplementedError: AsGraphDefInternal\n         [[Node: SerializeIterator = SerializeIterator[_device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](Iterator)]]\n</code></pre>", "body_text": "System information\n== cat /etc/issue ===============================================\nDarwin mbp-2.local 17.5.0 Darwin Kernel Version 17.5.0: Mon Mar  5 22:24:32 PST 2018; root:xnu-4570.51.1~1/RELEASE_X86_64 x86_64\nMac OS X 10.13.4\n== are we in docker =============================================\nNo\n== compiler =====================================================\nApple LLVM version 9.1.0 (clang-902.0.39.1)\nTarget: x86_64-apple-darwin17.5.0\nThread model: posix\nInstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin\n== uname -a =====================================================\nDarwin mbp-2.local 17.5.0 Darwin Kernel Version 17.5.0: Mon Mar  5 22:24:32 PST 2018; root:xnu-4570.51.1~1/RELEASE_X86_64 x86_64\n== check pips ===================================================\nnumpy (1.14.2)\nprotobuf (3.5.2.post1)\nsimple-tensorflow-serving (0.2.6, /usr/local/lib/python2.7/site-packages/simple_tensorflow_serving-0.2.6-py2.7.egg)\ntensorflow (1.7.0)\ntensorflow-hub (0.1.0)\ntensorflow-model-analysis (0.6.0)\ntensorflow-serving-api (1.0.0)\ntensorflow-tensorboard (1.5.0)\ntensorflow-transform (0.6.0)\ntensorflowjs (0.1.0)\ntensorflowonspark (1.0.0)\n== check for virtualenv =========================================\nFalse\n== tensorflow import ============================================\ntf.VERSION = 1.7.0\ntf.GIT_VERSION = v1.7.0-3-g024aecf414\ntf.COMPILER_VERSION = v1.7.0-3-g024aecf414\nSanity check: array([1], dtype=int32)\n/usr/local/lib/python2.7/site-packages/h5py/init.py:36: FutureWarning: Conversion of the second argument of issubdtype from float to np.floating is deprecated. In future, it will be treated as np .float64 == np.dtype(float).type.\nfrom ._conv import register_converters as _register_converters\n== env ==========================================================\nLD_LIBRARY_PATH is unset\nDYLD_LIBRARY_PATH is unset\n== nvidia-smi ===================================================\na.sh: line 105: nvidia-smi: command not found\n== cuda libs  ===================================================\nDescribe the problem\nWe follow the official document to save the checkpoint with dataset Iterator saveable but it fails. Maybe the implementation of serializing iterator_ops is not released in public repo.\nSource code / logs\ndataset = tf.data.Dataset.from_tensor_slices((image_list_placeholder, label_list_placeholder))\niterator = dataset.make_initializable_iterator()\nsaveable = tf.contrib.data.make_saveable_from_iterator(iterator)\ntf.add_to_collection(tf.GraphKeys.SAVEABLE_OBJECTS, saveable)\nsaver = tf.train.Saver()\n\nwith tf.Session() as sess:\n  saver.save(sess, checkpoint_file, global_step=step_value)\n\nHere is the error log.\n2018-04-17 11:02:40.756347: W tensorflow/core/framework/op_kernel.cc:1273] OP_REQUIRES failed at iterator_ops.cc:1049 : Unimplemented: AsGraphDefInternal\nTraceback (most recent call last):\n  File \"./mnist_train.py\", line 181, in <module>\n    main(parse_args())\n  File \"./mnist_train.py\", line 156, in main\n    saver.save(sess, checkpoint_file, global_step=step_value)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/training/saver.py\", line 1676, in save\n    {self.saver_def.filename_tensor_name: checkpoint_file})\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 905, in run\n    run_metadata_ptr)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1140, in _run\n    feed_dict_tensor, options, run_metadata)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1321, in _do_run\n    run_metadata)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1340, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.UnimplementedError: AsGraphDefInternal\n         [[Node: SerializeIterator = SerializeIterator[_device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](Iterator)]]", "body": "\r\n### System information\r\n== cat /etc/issue ===============================================\r\nDarwin mbp-2.local 17.5.0 Darwin Kernel Version 17.5.0: Mon Mar  5 22:24:32 PST 2018; root:xnu-4570.51.1~1/RELEASE_X86_64 x86_64\r\nMac OS X 10.13.4\r\n\r\n== are we in docker =============================================\r\nNo\r\n\r\n== compiler =====================================================\r\nApple LLVM version 9.1.0 (clang-902.0.39.1)\r\nTarget: x86_64-apple-darwin17.5.0\r\nThread model: posix\r\nInstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin\r\n\r\n== uname -a =====================================================\r\nDarwin mbp-2.local 17.5.0 Darwin Kernel Version 17.5.0: Mon Mar  5 22:24:32 PST 2018; root:xnu-4570.51.1~1/RELEASE_X86_64 x86_64\r\n\r\n== check pips ===================================================\r\nnumpy (1.14.2)\r\nprotobuf (3.5.2.post1)\r\nsimple-tensorflow-serving (0.2.6, /usr/local/lib/python2.7/site-packages/simple_tensorflow_serving-0.2.6-py2.7.egg)\r\ntensorflow (1.7.0)\r\ntensorflow-hub (0.1.0)\r\ntensorflow-model-analysis (0.6.0)\r\ntensorflow-serving-api (1.0.0)\r\ntensorflow-tensorboard (1.5.0)\r\ntensorflow-transform (0.6.0)\r\ntensorflowjs (0.1.0)\r\ntensorflowonspark (1.0.0)\r\n\r\n== check for virtualenv =========================================\r\nFalse\r\n\r\n== tensorflow import ============================================\r\ntf.VERSION = 1.7.0\r\ntf.GIT_VERSION = v1.7.0-3-g024aecf414\r\ntf.COMPILER_VERSION = v1.7.0-3-g024aecf414\r\nSanity check: array([1], dtype=int32)\r\n/usr/local/lib/python2.7/site-packages/h5py/__init__.py:36: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np\r\n.float64 == np.dtype(float).type`.\r\n  from ._conv import register_converters as _register_converters\r\n\r\n== env ==========================================================\r\nLD_LIBRARY_PATH is unset\r\nDYLD_LIBRARY_PATH is unset\r\n\r\n== nvidia-smi ===================================================\r\na.sh: line 105: nvidia-smi: command not found\r\n\r\n== cuda libs  ===================================================\r\n\r\n### Describe the problem\r\n\r\nWe follow the [official document](https://www.tensorflow.org/programmers_guide/datasets#saving_iterator_state) to save the checkpoint with dataset Iterator saveable but it fails. Maybe the implementation of serializing `iterator_ops` is not released in public repo.\r\n\r\n### Source code / logs\r\n\r\n```\r\ndataset = tf.data.Dataset.from_tensor_slices((image_list_placeholder, label_list_placeholder))\r\niterator = dataset.make_initializable_iterator()\r\nsaveable = tf.contrib.data.make_saveable_from_iterator(iterator)\r\ntf.add_to_collection(tf.GraphKeys.SAVEABLE_OBJECTS, saveable)\r\nsaver = tf.train.Saver()\r\n\r\nwith tf.Session() as sess:\r\n  saver.save(sess, checkpoint_file, global_step=step_value)\r\n```\r\n\r\nHere is the error log.\r\n\r\n```\r\n2018-04-17 11:02:40.756347: W tensorflow/core/framework/op_kernel.cc:1273] OP_REQUIRES failed at iterator_ops.cc:1049 : Unimplemented: AsGraphDefInternal\r\nTraceback (most recent call last):\r\n  File \"./mnist_train.py\", line 181, in <module>\r\n    main(parse_args())\r\n  File \"./mnist_train.py\", line 156, in main\r\n    saver.save(sess, checkpoint_file, global_step=step_value)\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/training/saver.py\", line 1676, in save\r\n    {self.saver_def.filename_tensor_name: checkpoint_file})\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 905, in run\r\n    run_metadata_ptr)\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1140, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1321, in _do_run\r\n    run_metadata)\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1340, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.UnimplementedError: AsGraphDefInternal\r\n         [[Node: SerializeIterator = SerializeIterator[_device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](Iterator)]]\r\n```\r\n"}