{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/178319046", "pull_request_review_id": 108366501, "id": 178319046, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODMxOTA0Ng==", "diff_hunk": "@@ -539,12 +539,36 @@ def norm(tensor,\n \n   with ops.name_scope(name, 'norm', [tensor]):\n     tensor = ops.convert_to_tensor(tensor)\n+\n     if ord in ['fro', 'euclidean', 2, 2.0]:\n-      # TODO(rmlarsen): Move 2-norm to a separate clause once we support it for\n-      # matrices.\n-      result = math_ops.sqrt(\n-          math_ops.reduce_sum(\n-              tensor * math_ops.conj(tensor), axis, keepdims=True))\n+      if is_matrix_norm and ord in [2, 2.0]:\n+        rank = array_ops.rank(tensor)\n+        positive_axis = functional_ops.map_fn(\n+            lambda i: control_flow_ops.cond(i >= 0, lambda: i, lambda: i + rank),\n+            ops.convert_to_tensor(axis))\n+        axes = math_ops.range(rank)\n+        perm_before = array_ops.concat(\n+            [array_ops.setdiff1d(axes, positive_axis)[0], positive_axis],\n+            axis=0)\n+        perm_after = functional_ops.map_fn(\n+            lambda i: math_ops.cast(\n+                array_ops.squeeze(\n+                    array_ops.where(math_ops.equal(perm_before, i))),\n+                dtype=dtypes.int32), axes)\n+        permed = array_ops.transpose(tensor, perm=perm_before)\n+        matrix_2_norm = array_ops.expand_dims(\n+            math_ops.reduce_max(\n+                math_ops.cast(", "path": "tensorflow/python/ops/linalg_ops.py", "position": null, "original_position": 64, "commit_id": "ed260b6e7f87938eae34de67e4df3ebb36451806", "original_commit_id": "ab3b1705bc2c546eb3607876fcdcc45902552346", "user": {"login": "rmlarsen", "id": 16907534, "node_id": "MDQ6VXNlcjE2OTA3NTM0", "avatar_url": "https://avatars2.githubusercontent.com/u/16907534?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rmlarsen", "html_url": "https://github.com/rmlarsen", "followers_url": "https://api.github.com/users/rmlarsen/followers", "following_url": "https://api.github.com/users/rmlarsen/following{/other_user}", "gists_url": "https://api.github.com/users/rmlarsen/gists{/gist_id}", "starred_url": "https://api.github.com/users/rmlarsen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rmlarsen/subscriptions", "organizations_url": "https://api.github.com/users/rmlarsen/orgs", "repos_url": "https://api.github.com/users/rmlarsen/repos", "events_url": "https://api.github.com/users/rmlarsen/events{/privacy}", "received_events_url": "https://api.github.com/users/rmlarsen/received_events", "type": "User", "site_admin": false}, "body": "Please don't cast, but use abs to support complex matrices. gen_linalg_ops.svd returns singular values with the same type as the input. (We should perhaps change that.)", "created_at": "2018-03-30T16:08:12Z", "updated_at": "2018-04-17T08:22:16Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/17740#discussion_r178319046", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/17740", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/178319046"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/17740#discussion_r178319046"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/17740"}}, "body_html": "<p>Please don't cast, but use abs to support complex matrices. gen_linalg_ops.svd returns singular values with the same type as the input. (We should perhaps change that.)</p>", "body_text": "Please don't cast, but use abs to support complex matrices. gen_linalg_ops.svd returns singular values with the same type as the input. (We should perhaps change that.)"}