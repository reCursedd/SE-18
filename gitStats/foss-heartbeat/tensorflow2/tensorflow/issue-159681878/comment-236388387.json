{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/236388387", "html_url": "https://github.com/tensorflow/tensorflow/issues/2787#issuecomment-236388387", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2787", "id": 236388387, "node_id": "MDEyOklzc3VlQ29tbWVudDIzNjM4ODM4Nw==", "user": {"login": "thomasquintana", "id": 1891840, "node_id": "MDQ6VXNlcjE4OTE4NDA=", "avatar_url": "https://avatars3.githubusercontent.com/u/1891840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thomasquintana", "html_url": "https://github.com/thomasquintana", "followers_url": "https://api.github.com/users/thomasquintana/followers", "following_url": "https://api.github.com/users/thomasquintana/following{/other_user}", "gists_url": "https://api.github.com/users/thomasquintana/gists{/gist_id}", "starred_url": "https://api.github.com/users/thomasquintana/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thomasquintana/subscriptions", "organizations_url": "https://api.github.com/users/thomasquintana/orgs", "repos_url": "https://api.github.com/users/thomasquintana/repos", "events_url": "https://api.github.com/users/thomasquintana/events{/privacy}", "received_events_url": "https://api.github.com/users/thomasquintana/received_events", "type": "User", "site_admin": false}, "created_at": "2016-07-30T20:30:30Z", "updated_at": "2016-08-01T14:51:53Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1794715\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ebrevdo\">@ebrevdo</a> I just tried with 0.10.0rc0 and I still have the same issue.</p>\n<p><code>ValueError: Inconsistent shapes: saw (?, 2560) but expected (?, 2560) (and infer_shape=True)</code></p>\n<p>I will add that in my case I have nested scans. In the inner scan the 0 axis is None and in the outer scan the 1 axis is None. The exception is raised on the outer scan.</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">def</span> <span class=\"pl-en\">step</span>(<span class=\"pl-smi\">_</span>, <span class=\"pl-smi\">step_input</span>):\n    flattened <span class=\"pl-k\">=</span> tf.reshape(step_input, [<span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">1</span>])\n    flattened <span class=\"pl-k\">=</span> tf.pad(flattened, [[<span class=\"pl-c1\">0</span>, <span class=\"pl-c1\">self</span>.tau], [<span class=\"pl-c1\">0</span>, <span class=\"pl-c1\">0</span>]])\n    windows <span class=\"pl-k\">=</span> tf.transpose(tf.gather(flattened, indices))\n    windows <span class=\"pl-k\">=</span> tf.reshape(windows, [<span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">self</span>.tau <span class=\"pl-k\">+</span> <span class=\"pl-c1\">1</span>, n_features])\n    <span class=\"pl-k\">return</span> tf.reduce_sum(\n      tf.scan(<span class=\"pl-k\">lambda</span> <span class=\"pl-smi\">a</span>, <span class=\"pl-smi\">x</span>: tf.mul(x, kernel), windows), <span class=\"pl-v\">reduction_indices</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">1</span>\n    )\n\n<span class=\"pl-k\">return</span> tf.scan(step, inputs, <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span>scope.name)</pre></div>", "body_text": "@ebrevdo I just tried with 0.10.0rc0 and I still have the same issue.\nValueError: Inconsistent shapes: saw (?, 2560) but expected (?, 2560) (and infer_shape=True)\nI will add that in my case I have nested scans. In the inner scan the 0 axis is None and in the outer scan the 1 axis is None. The exception is raised on the outer scan.\ndef step(_, step_input):\n    flattened = tf.reshape(step_input, [-1, 1])\n    flattened = tf.pad(flattened, [[0, self.tau], [0, 0]])\n    windows = tf.transpose(tf.gather(flattened, indices))\n    windows = tf.reshape(windows, [-1, self.tau + 1, n_features])\n    return tf.reduce_sum(\n      tf.scan(lambda a, x: tf.mul(x, kernel), windows), reduction_indices=1\n    )\n\nreturn tf.scan(step, inputs, name=scope.name)", "body": "@ebrevdo I just tried with 0.10.0rc0 and I still have the same issue.\n\n`ValueError: Inconsistent shapes: saw (?, 2560) but expected (?, 2560) (and infer_shape=True)`\n\nI will add that in my case I have nested scans. In the inner scan the 0 axis is None and in the outer scan the 1 axis is None. The exception is raised on the outer scan.\n\n``` python\ndef step(_, step_input):\n    flattened = tf.reshape(step_input, [-1, 1])\n    flattened = tf.pad(flattened, [[0, self.tau], [0, 0]])\n    windows = tf.transpose(tf.gather(flattened, indices))\n    windows = tf.reshape(windows, [-1, self.tau + 1, n_features])\n    return tf.reduce_sum(\n      tf.scan(lambda a, x: tf.mul(x, kernel), windows), reduction_indices=1\n    )\n\nreturn tf.scan(step, inputs, name=scope.name)\n```\n"}