{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/270081760", "html_url": "https://github.com/tensorflow/tensorflow/issues/6561#issuecomment-270081760", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6561", "id": 270081760, "node_id": "MDEyOklzc3VlQ29tbWVudDI3MDA4MTc2MA==", "user": {"login": "AlexandreBriot", "id": 22516726, "node_id": "MDQ6VXNlcjIyNTE2NzI2", "avatar_url": "https://avatars3.githubusercontent.com/u/22516726?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AlexandreBriot", "html_url": "https://github.com/AlexandreBriot", "followers_url": "https://api.github.com/users/AlexandreBriot/followers", "following_url": "https://api.github.com/users/AlexandreBriot/following{/other_user}", "gists_url": "https://api.github.com/users/AlexandreBriot/gists{/gist_id}", "starred_url": "https://api.github.com/users/AlexandreBriot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AlexandreBriot/subscriptions", "organizations_url": "https://api.github.com/users/AlexandreBriot/orgs", "repos_url": "https://api.github.com/users/AlexandreBriot/repos", "events_url": "https://api.github.com/users/AlexandreBriot/events{/privacy}", "received_events_url": "https://api.github.com/users/AlexandreBriot/received_events", "type": "User", "site_admin": false}, "created_at": "2017-01-03T10:02:20Z", "updated_at": "2017-01-03T10:03:05Z", "author_association": "NONE", "body_html": "<p>Thanks for your answer !<br>\nI tried to run optimze_for_inference.py.<br>\nIt works to remove the unneeded input nodes but it also removed other nodes at the end of the GraphDef before the output node. Do you have any idea about what I could have done wrong ?</p>\n<p>Here is how I proceed</p>\n<pre><code>from tensorflow.python.tools import optimize_for_inference_lib\nwith tf.gfile.FastGFile(\"/home/alexandre/tf_files/retrained_graph.pb\", 'rb') as f:\n    graph_def = tf.GraphDef()\n    graph_def.ParseFromString(f.read())\n    _ = tf.import_graph_def(graph_def, name='')\noutput_graph_def = optimize_for_inference_lib.optimize_for_inference(\n    graph_def,\n    ['Mul'],\n    ['final_result'],\n    tf.float32.as_datatype_enum)\n</code></pre>\n<p>Then printing the first and last nodes names of my out_graph_def</p>\n<pre><code>print(output_graph_def.node[0].name)\nprint(output_graph_def.node[-1].name)\n</code></pre>\n<p>I get</p>\n<pre><code>Mul\nmixed_10/tower_2/conv/batchnorm\n</code></pre>\n<p>Which is OK for input but KO for output</p>", "body_text": "Thanks for your answer !\nI tried to run optimze_for_inference.py.\nIt works to remove the unneeded input nodes but it also removed other nodes at the end of the GraphDef before the output node. Do you have any idea about what I could have done wrong ?\nHere is how I proceed\nfrom tensorflow.python.tools import optimize_for_inference_lib\nwith tf.gfile.FastGFile(\"/home/alexandre/tf_files/retrained_graph.pb\", 'rb') as f:\n    graph_def = tf.GraphDef()\n    graph_def.ParseFromString(f.read())\n    _ = tf.import_graph_def(graph_def, name='')\noutput_graph_def = optimize_for_inference_lib.optimize_for_inference(\n    graph_def,\n    ['Mul'],\n    ['final_result'],\n    tf.float32.as_datatype_enum)\n\nThen printing the first and last nodes names of my out_graph_def\nprint(output_graph_def.node[0].name)\nprint(output_graph_def.node[-1].name)\n\nI get\nMul\nmixed_10/tower_2/conv/batchnorm\n\nWhich is OK for input but KO for output", "body": "Thanks for your answer !\r\nI tried to run optimze_for_inference.py.\r\nIt works to remove the unneeded input nodes but it also removed other nodes at the end of the GraphDef before the output node. Do you have any idea about what I could have done wrong ? \r\n\r\nHere is how I proceed\r\n```\r\nfrom tensorflow.python.tools import optimize_for_inference_lib\r\nwith tf.gfile.FastGFile(\"/home/alexandre/tf_files/retrained_graph.pb\", 'rb') as f:\r\n    graph_def = tf.GraphDef()\r\n    graph_def.ParseFromString(f.read())\r\n    _ = tf.import_graph_def(graph_def, name='')\r\noutput_graph_def = optimize_for_inference_lib.optimize_for_inference(\r\n    graph_def,\r\n    ['Mul'],\r\n    ['final_result'],\r\n    tf.float32.as_datatype_enum)\r\n```\r\nThen printing the first and last nodes names of my out_graph_def \r\n```\r\nprint(output_graph_def.node[0].name)\r\nprint(output_graph_def.node[-1].name)\r\n```\r\nI get \r\n\r\n```\r\nMul\r\nmixed_10/tower_2/conv/batchnorm\r\n```\r\n\r\nWhich is OK for input but KO for output\r\n\r\n\r\n"}