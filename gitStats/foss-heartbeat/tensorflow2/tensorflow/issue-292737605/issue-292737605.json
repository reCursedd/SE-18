{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16580", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16580/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16580/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16580/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/16580", "id": 292737605, "node_id": "MDExOlB1bGxSZXF1ZXN0MTY1OTQ2ODY5", "number": 16580, "title": "Ensure bash is invoked as a login shell on windows otherwise fixups fail.", "user": {"login": "andykernahan", "id": 63398, "node_id": "MDQ6VXNlcjYzMzk4", "avatar_url": "https://avatars3.githubusercontent.com/u/63398?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andykernahan", "html_url": "https://github.com/andykernahan", "followers_url": "https://api.github.com/users/andykernahan/followers", "following_url": "https://api.github.com/users/andykernahan/following{/other_user}", "gists_url": "https://api.github.com/users/andykernahan/gists{/gist_id}", "starred_url": "https://api.github.com/users/andykernahan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andykernahan/subscriptions", "organizations_url": "https://api.github.com/users/andykernahan/orgs", "repos_url": "https://api.github.com/users/andykernahan/repos", "events_url": "https://api.github.com/users/andykernahan/events{/privacy}", "received_events_url": "https://api.github.com/users/andykernahan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-01-30T10:52:42Z", "updated_at": "2018-02-06T15:55:32Z", "closed_at": "2018-02-05T23:33:51Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/16580", "html_url": "https://github.com/tensorflow/tensorflow/pull/16580", "diff_url": "https://github.com/tensorflow/tensorflow/pull/16580.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/16580.patch"}, "body_html": "<p>Hi,</p>\n<p>This PR contains a small fix to <code>repo.bzl</code> to ensure that bash is invoked as a login shell on Windows. Otherwise, depending on the <code>tf_http_archive</code> execution, bash fails to find <code>rm</code> and/or <code>patch</code>. Note this issue only manifests itself when Bazel is invoked from a Windows command prompt.</p>\n<p><strong>E.g.</strong></p>\n<pre><code>ERROR: Skipping '//tensorflow:libtensorflow.so': error loading package 'tensorflow': Encountered error while reading extension file 'protobuf.bzl': no such package '@protobuf_archive//': Traceback (most recent call last):\n        File \"&lt;redacted&gt;/third_party/repo.bzl\", line 88\n                _apply_patch(ctx, ctx.attr.patch_file)\n        File \"&lt;redacted&gt;/third_party/repo.bzl\", line 59, in _apply_patch\n                _execute_and_check_ret_code(ctx, cmd)\n        File \"&lt;redacted&gt;/third_party/repo.bzl\", line 44, in _execute_and_check_ret_code\n                fail(\"Non-zero return code({1}) when ...))\nNon-zero return code(127) when executing 'C:\\tools\\msys64\\usr\\bin\\bash.exe -c patch -p1 -d &lt;redacted&gt;/4bwywwqm/external/protobuf_archive -i &lt;redacted&gt;/third_party/protobuf/add_noinlines.patch':\nStdout:\nStderr: /usr/bin/bash: patch: command not found\n</code></pre>\n<p><strong>Environment</strong></p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Version</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>OS</td>\n<td>Win10-Ent</td>\n</tr>\n<tr>\n<td>Bazel</td>\n<td>0.8.1</td>\n</tr>\n<tr>\n<td>msys2</td>\n<td>msys2-x86_64-20161025</td>\n</tr>\n</tbody>\n</table>\n<p>Cheers,</p>\n<p>Andy</p>", "body_text": "Hi,\nThis PR contains a small fix to repo.bzl to ensure that bash is invoked as a login shell on Windows. Otherwise, depending on the tf_http_archive execution, bash fails to find rm and/or patch. Note this issue only manifests itself when Bazel is invoked from a Windows command prompt.\nE.g.\nERROR: Skipping '//tensorflow:libtensorflow.so': error loading package 'tensorflow': Encountered error while reading extension file 'protobuf.bzl': no such package '@protobuf_archive//': Traceback (most recent call last):\n        File \"<redacted>/third_party/repo.bzl\", line 88\n                _apply_patch(ctx, ctx.attr.patch_file)\n        File \"<redacted>/third_party/repo.bzl\", line 59, in _apply_patch\n                _execute_and_check_ret_code(ctx, cmd)\n        File \"<redacted>/third_party/repo.bzl\", line 44, in _execute_and_check_ret_code\n                fail(\"Non-zero return code({1}) when ...))\nNon-zero return code(127) when executing 'C:\\tools\\msys64\\usr\\bin\\bash.exe -c patch -p1 -d <redacted>/4bwywwqm/external/protobuf_archive -i <redacted>/third_party/protobuf/add_noinlines.patch':\nStdout:\nStderr: /usr/bin/bash: patch: command not found\n\nEnvironment\n\n\n\n\nVersion\n\n\n\n\nOS\nWin10-Ent\n\n\nBazel\n0.8.1\n\n\nmsys2\nmsys2-x86_64-20161025\n\n\n\nCheers,\nAndy", "body": "Hi,\r\n\r\nThis PR contains a small fix to `repo.bzl` to ensure that bash is invoked as a login shell on Windows. Otherwise, depending on the `tf_http_archive` execution, bash fails to find `rm` and/or `patch`. Note this issue only manifests itself when Bazel is invoked from a Windows command prompt.\r\n\r\n**E.g.**\r\n```\r\nERROR: Skipping '//tensorflow:libtensorflow.so': error loading package 'tensorflow': Encountered error while reading extension file 'protobuf.bzl': no such package '@protobuf_archive//': Traceback (most recent call last):\r\n        File \"<redacted>/third_party/repo.bzl\", line 88\r\n                _apply_patch(ctx, ctx.attr.patch_file)\r\n        File \"<redacted>/third_party/repo.bzl\", line 59, in _apply_patch\r\n                _execute_and_check_ret_code(ctx, cmd)\r\n        File \"<redacted>/third_party/repo.bzl\", line 44, in _execute_and_check_ret_code\r\n                fail(\"Non-zero return code({1}) when ...))\r\nNon-zero return code(127) when executing 'C:\\tools\\msys64\\usr\\bin\\bash.exe -c patch -p1 -d <redacted>/4bwywwqm/external/protobuf_archive -i <redacted>/third_party/protobuf/add_noinlines.patch':\r\nStdout:\r\nStderr: /usr/bin/bash: patch: command not found\r\n```\r\n**Environment**\r\n\r\n||Version|\r\n|--|--|\r\n|OS|Win10-Ent|\r\n|Bazel|0.8.1|\r\n|msys2|msys2-x86_64-20161025|\r\n\r\nCheers,\r\n\r\nAndy"}