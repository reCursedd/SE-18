{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/425599787", "html_url": "https://github.com/tensorflow/tensorflow/pull/22493#issuecomment-425599787", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22493", "id": 425599787, "node_id": "MDEyOklzc3VlQ29tbWVudDQyNTU5OTc4Nw==", "user": {"login": "cuixiaom", "id": 29615281, "node_id": "MDQ6VXNlcjI5NjE1Mjgx", "avatar_url": "https://avatars2.githubusercontent.com/u/29615281?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuixiaom", "html_url": "https://github.com/cuixiaom", "followers_url": "https://api.github.com/users/cuixiaom/followers", "following_url": "https://api.github.com/users/cuixiaom/following{/other_user}", "gists_url": "https://api.github.com/users/cuixiaom/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuixiaom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuixiaom/subscriptions", "organizations_url": "https://api.github.com/users/cuixiaom/orgs", "repos_url": "https://api.github.com/users/cuixiaom/repos", "events_url": "https://api.github.com/users/cuixiaom/events{/privacy}", "received_events_url": "https://api.github.com/users/cuixiaom/received_events", "type": "User", "site_admin": false}, "created_at": "2018-09-29T00:24:20Z", "updated_at": "2018-09-29T00:24:20Z", "author_association": "CONTRIBUTOR", "body_html": "<blockquote>\n<p>Also, what do you plan to do with MKL ops that just replace TF ops (without graph rewrite)? For example, the <code>Transpose</code> op?<br>\n<a href=\"https://github.com/tensorflow/tensorflow/blob/cc83067469bc30bba55932c587f31ef68f15792f/tensorflow/core/kernels/transpose_op.cc#L221-L246\">tensorflow/tensorflow/core/kernels/transpose_op.cc</a></p>\n<p>Lines 221 to 246 in <a href=\"/tensorflow/tensorflow/commit/cc83067469bc30bba55932c587f31ef68f15792f\">cc83067</a></p>\n<p>#if defined(INTEL_MKL) &amp;&amp; defined(ENABLE_MKL)<br>\n#define REGISTER(T)                                   \\<br>\nREGISTER_KERNEL_BUILDER(Name(\"Transpose\")           \\<br>\n.Device(DEVICE_CPU)     \\<br>\n.TypeConstraint(\"T\") \\<br>\n.HostMemory(\"perm\"),    \\<br>\nMklTransposeCpuOp);         \\<br>\nREGISTER_KERNEL_BUILDER(Name(\"ConjugateTranspose\")  \\<br>\n.Device(DEVICE_CPU)     \\<br>\n.TypeConstraint(\"T\") \\<br>\n.HostMemory(\"perm\"),    \\<br>\nMklConjugateTransposeCpuOp);</p>\n<p>#else  // INTEL_MKL &amp;&amp; ENABLE_MKL<br>\n#define REGISTER(T)                                   \\<br>\nREGISTER_KERNEL_BUILDER(Name(\"Transpose\")           \\<br>\n.Device(DEVICE_CPU)     \\<br>\n.TypeConstraint(\"T\") \\<br>\n.HostMemory(\"perm\"),    \\<br>\nTransposeCpuOp);            \\<br>\nREGISTER_KERNEL_BUILDER(Name(\"ConjugateTranspose\")  \\<br>\n.Device(DEVICE_CPU)     \\<br>\n.TypeConstraint(\"T\") \\<br>\n.HostMemory(\"perm\"),    \\<br>\nConjugateTransposeCpuOp);<br>\n#endif  // INTEL_MKL &amp;&amp; ENABLE_MKL</p>\n</blockquote>\n<p>We will have another PR to disable those ops, since they are different implementation with MKLDNN based ops.</p>", "body_text": "Also, what do you plan to do with MKL ops that just replace TF ops (without graph rewrite)? For example, the Transpose op?\ntensorflow/tensorflow/core/kernels/transpose_op.cc\nLines 221 to 246 in cc83067\n#if defined(INTEL_MKL) && defined(ENABLE_MKL)\n#define REGISTER(T)                                   \\\nREGISTER_KERNEL_BUILDER(Name(\"Transpose\")           \\\n.Device(DEVICE_CPU)     \\\n.TypeConstraint(\"T\") \\\n.HostMemory(\"perm\"),    \\\nMklTransposeCpuOp);         \\\nREGISTER_KERNEL_BUILDER(Name(\"ConjugateTranspose\")  \\\n.Device(DEVICE_CPU)     \\\n.TypeConstraint(\"T\") \\\n.HostMemory(\"perm\"),    \\\nMklConjugateTransposeCpuOp);\n#else  // INTEL_MKL && ENABLE_MKL\n#define REGISTER(T)                                   \\\nREGISTER_KERNEL_BUILDER(Name(\"Transpose\")           \\\n.Device(DEVICE_CPU)     \\\n.TypeConstraint(\"T\") \\\n.HostMemory(\"perm\"),    \\\nTransposeCpuOp);            \\\nREGISTER_KERNEL_BUILDER(Name(\"ConjugateTranspose\")  \\\n.Device(DEVICE_CPU)     \\\n.TypeConstraint(\"T\") \\\n.HostMemory(\"perm\"),    \\\nConjugateTransposeCpuOp);\n#endif  // INTEL_MKL && ENABLE_MKL\n\nWe will have another PR to disable those ops, since they are different implementation with MKLDNN based ops.", "body": "> Also, what do you plan to do with MKL ops that just replace TF ops (without graph rewrite)? For example, the `Transpose` op?\r\n> [tensorflow/tensorflow/core/kernels/transpose_op.cc](https://github.com/tensorflow/tensorflow/blob/cc83067469bc30bba55932c587f31ef68f15792f/tensorflow/core/kernels/transpose_op.cc#L221-L246)\r\n> \r\n> Lines 221 to 246 in [cc83067](/tensorflow/tensorflow/commit/cc83067469bc30bba55932c587f31ef68f15792f)\r\n> \r\n>  #if defined(INTEL_MKL) && defined(ENABLE_MKL) \r\n>  #define REGISTER(T)                                   \\ \r\n>    REGISTER_KERNEL_BUILDER(Name(\"Transpose\")           \\ \r\n>                                .Device(DEVICE_CPU)     \\ \r\n>                                .TypeConstraint<T>(\"T\") \\ \r\n>                                .HostMemory(\"perm\"),    \\ \r\n>                            MklTransposeCpuOp);         \\ \r\n>    REGISTER_KERNEL_BUILDER(Name(\"ConjugateTranspose\")  \\ \r\n>                                .Device(DEVICE_CPU)     \\ \r\n>                                .TypeConstraint<T>(\"T\") \\ \r\n>                                .HostMemory(\"perm\"),    \\ \r\n>                            MklConjugateTransposeCpuOp); \r\n>   \r\n>  #else  // INTEL_MKL && ENABLE_MKL \r\n>  #define REGISTER(T)                                   \\ \r\n>    REGISTER_KERNEL_BUILDER(Name(\"Transpose\")           \\ \r\n>                                .Device(DEVICE_CPU)     \\ \r\n>                                .TypeConstraint<T>(\"T\") \\ \r\n>                                .HostMemory(\"perm\"),    \\ \r\n>                            TransposeCpuOp);            \\ \r\n>    REGISTER_KERNEL_BUILDER(Name(\"ConjugateTranspose\")  \\ \r\n>                                .Device(DEVICE_CPU)     \\ \r\n>                                .TypeConstraint<T>(\"T\") \\ \r\n>                                .HostMemory(\"perm\"),    \\ \r\n>                            ConjugateTransposeCpuOp); \r\n>  #endif  // INTEL_MKL && ENABLE_MKL\r\n\r\nWe will have another PR to disable those ops, since they are different implementation with MKLDNN based ops."}