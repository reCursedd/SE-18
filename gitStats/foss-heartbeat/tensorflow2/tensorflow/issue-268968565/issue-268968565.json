{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14014", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14014/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14014/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14014/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/14014", "id": 268968565, "node_id": "MDU6SXNzdWUyNjg5Njg1NjU=", "number": 14014, "title": "Proposal: Compiling TF 1.4.0 GPU w/ CMAKE on Linux x64", "user": {"login": "myungjoo", "id": 1109011, "node_id": "MDQ6VXNlcjExMDkwMTE=", "avatar_url": "https://avatars3.githubusercontent.com/u/1109011?v=4", "gravatar_id": "", "url": "https://api.github.com/users/myungjoo", "html_url": "https://github.com/myungjoo", "followers_url": "https://api.github.com/users/myungjoo/followers", "following_url": "https://api.github.com/users/myungjoo/following{/other_user}", "gists_url": "https://api.github.com/users/myungjoo/gists{/gist_id}", "starred_url": "https://api.github.com/users/myungjoo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/myungjoo/subscriptions", "organizations_url": "https://api.github.com/users/myungjoo/orgs", "repos_url": "https://api.github.com/users/myungjoo/repos", "events_url": "https://api.github.com/users/myungjoo/events{/privacy}", "received_events_url": "https://api.github.com/users/myungjoo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "shivaniag", "id": 16565716, "node_id": "MDQ6VXNlcjE2NTY1NzE2", "avatar_url": "https://avatars1.githubusercontent.com/u/16565716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shivaniag", "html_url": "https://github.com/shivaniag", "followers_url": "https://api.github.com/users/shivaniag/followers", "following_url": "https://api.github.com/users/shivaniag/following{/other_user}", "gists_url": "https://api.github.com/users/shivaniag/gists{/gist_id}", "starred_url": "https://api.github.com/users/shivaniag/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shivaniag/subscriptions", "organizations_url": "https://api.github.com/users/shivaniag/orgs", "repos_url": "https://api.github.com/users/shivaniag/repos", "events_url": "https://api.github.com/users/shivaniag/events{/privacy}", "received_events_url": "https://api.github.com/users/shivaniag/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "shivaniag", "id": 16565716, "node_id": "MDQ6VXNlcjE2NTY1NzE2", "avatar_url": "https://avatars1.githubusercontent.com/u/16565716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shivaniag", "html_url": "https://github.com/shivaniag", "followers_url": "https://api.github.com/users/shivaniag/followers", "following_url": "https://api.github.com/users/shivaniag/following{/other_user}", "gists_url": "https://api.github.com/users/shivaniag/gists{/gist_id}", "starred_url": "https://api.github.com/users/shivaniag/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shivaniag/subscriptions", "organizations_url": "https://api.github.com/users/shivaniag/orgs", "repos_url": "https://api.github.com/users/shivaniag/repos", "events_url": "https://api.github.com/users/shivaniag/events{/privacy}", "received_events_url": "https://api.github.com/users/shivaniag/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 20, "created_at": "2017-10-27T02:23:18Z", "updated_at": "2018-04-25T19:07:56Z", "closed_at": "2018-04-25T19:07:56Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Currently, I have been playing with the cmake scripts of TensorFlow-GPU to make it CMAKE-buildable in a bare-metal x64 Linux. (isolated environment, without the internet, w/ OBS)<br>\n(I'm trying CMAKE because I don't want to port Java)</p>\n<p>It's almost done (need code clean) and I'll probably send Pull-Request next week. However, there are a few things I want to check before I write additional features besides simply make it able to build with CMAKE for TF-GPU in Linux.</p>\n<ol>\n<li>\n<p>Tensorflow is statically linking to pre-installed devel packages. I think in some cases, it might be better to do dynamic linking (use .so) to other libraries (to save some memory and storage size). May I simply add an option like \"tensorflow_USE_SHARED_LIBS_CUDA\"? (e.g., cuda, nccl, ...)</p>\n</li>\n<li>\n<p>Tensorflow is downloading a lot of external packages and use them \"statically\", which is pretty awful for some people. I'd like to make it use shared libraries as well (maybe along with some version restrictions). May I simply add an option like \"tensorflow_USE_SHARD_LIBS_JSONCPP\", which disables downloading \"JSONCPP\" as well?</p>\n</li>\n</ol>\n<p>Some additional benefit with these might be reduced memory requirement for building tensorflow; memory consumption of tensorflow-build gets dangerous at the last step with <code>ld</code>. Probably, for now, I may simply need to be satisfied with letting <code>make</code> reduce <code>-j#</code> only for <code>ld</code> steps.</p>\n<p>CC: <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=82404\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/leemgs\">@leemgs</a><br>\nSTATUS: failing at the last step. (without <code>-Dtensorflow_BUILD_SHARED_LIB</code>, it works anyway)</p>\n<pre><code>...\n[ 2457s] /usr/lib64/gcc/x86_64-tizen-linux-gnu/6.2.1/../../../../x86_64-tizen-linux-gnu/bin/ld: libtf_core_gpu_kernels.a(tf_core_gpu_kernels_generated_beam_search_ops_gpu.cu.cc.o): relocation R_X86_64_32 against `.data' can not be used when making a shared object; recompile with -fPIC\n[ 2457s] /usr/lib64/gcc/x86_64-tizen-linux-gnu/6.2.1/../../../../x86_64-tizen-linux-gnu/bin/ld: libtf_core_gpu_kernels.a(tf_core_gpu_kernels_generated_resampler_ops_gpu.cu.cc.o): relocation R_X86_64_32 against `.data' can not be used when making a shared object; recompile with -fPIC\n[ 2457s] /usr/lib64/gcc/x86_64-tizen-linux-gnu/6.2.1/../../../../x86_64-tizen-linux-gnu/bin/ld: final link failed: Nonrepresentable section on output\n[ 2457s] collect2: error: ld returned 1 exit status\n[ 2457s] CMakeFiles/tensorflow.dir/build.make:2235: recipe for target 'libtensorflow.so' failed\n[ 2457s] make[2]: *** [libtensorflow.so] Error 1\n[ 2457s] CMakeFiles/Makefile2:82: recipe for target 'CMakeFiles/tensorflow.dir/all' failed\n[ 2457s] make[1]: *** [CMakeFiles/tensorflow.dir/all] Error 2\n[ 2457s] make[1]: *** Waiting for unfinished jobs....\n[ 2458s] [100%] Linking CXX shared library libpywrap_tensorflow_internal.so\n[ 2474s] [100%] Built target grpc_tensorflow_server\n[ 2474s] [100%] Built target transform_graph\n</code></pre>\n<p>-- STATUS UPDATE: build successful w/ <code>-Dtensorflow_BUILD_SHARED_LIB=ON</code> as well.</p>", "body_text": "Currently, I have been playing with the cmake scripts of TensorFlow-GPU to make it CMAKE-buildable in a bare-metal x64 Linux. (isolated environment, without the internet, w/ OBS)\n(I'm trying CMAKE because I don't want to port Java)\nIt's almost done (need code clean) and I'll probably send Pull-Request next week. However, there are a few things I want to check before I write additional features besides simply make it able to build with CMAKE for TF-GPU in Linux.\n\n\nTensorflow is statically linking to pre-installed devel packages. I think in some cases, it might be better to do dynamic linking (use .so) to other libraries (to save some memory and storage size). May I simply add an option like \"tensorflow_USE_SHARED_LIBS_CUDA\"? (e.g., cuda, nccl, ...)\n\n\nTensorflow is downloading a lot of external packages and use them \"statically\", which is pretty awful for some people. I'd like to make it use shared libraries as well (maybe along with some version restrictions). May I simply add an option like \"tensorflow_USE_SHARD_LIBS_JSONCPP\", which disables downloading \"JSONCPP\" as well?\n\n\nSome additional benefit with these might be reduced memory requirement for building tensorflow; memory consumption of tensorflow-build gets dangerous at the last step with ld. Probably, for now, I may simply need to be satisfied with letting make reduce -j# only for ld steps.\nCC: @leemgs\nSTATUS: failing at the last step. (without -Dtensorflow_BUILD_SHARED_LIB, it works anyway)\n...\n[ 2457s] /usr/lib64/gcc/x86_64-tizen-linux-gnu/6.2.1/../../../../x86_64-tizen-linux-gnu/bin/ld: libtf_core_gpu_kernels.a(tf_core_gpu_kernels_generated_beam_search_ops_gpu.cu.cc.o): relocation R_X86_64_32 against `.data' can not be used when making a shared object; recompile with -fPIC\n[ 2457s] /usr/lib64/gcc/x86_64-tizen-linux-gnu/6.2.1/../../../../x86_64-tizen-linux-gnu/bin/ld: libtf_core_gpu_kernels.a(tf_core_gpu_kernels_generated_resampler_ops_gpu.cu.cc.o): relocation R_X86_64_32 against `.data' can not be used when making a shared object; recompile with -fPIC\n[ 2457s] /usr/lib64/gcc/x86_64-tizen-linux-gnu/6.2.1/../../../../x86_64-tizen-linux-gnu/bin/ld: final link failed: Nonrepresentable section on output\n[ 2457s] collect2: error: ld returned 1 exit status\n[ 2457s] CMakeFiles/tensorflow.dir/build.make:2235: recipe for target 'libtensorflow.so' failed\n[ 2457s] make[2]: *** [libtensorflow.so] Error 1\n[ 2457s] CMakeFiles/Makefile2:82: recipe for target 'CMakeFiles/tensorflow.dir/all' failed\n[ 2457s] make[1]: *** [CMakeFiles/tensorflow.dir/all] Error 2\n[ 2457s] make[1]: *** Waiting for unfinished jobs....\n[ 2458s] [100%] Linking CXX shared library libpywrap_tensorflow_internal.so\n[ 2474s] [100%] Built target grpc_tensorflow_server\n[ 2474s] [100%] Built target transform_graph\n\n-- STATUS UPDATE: build successful w/ -Dtensorflow_BUILD_SHARED_LIB=ON as well.", "body": "Currently, I have been playing with the cmake scripts of TensorFlow-GPU to make it CMAKE-buildable in a bare-metal x64 Linux. (isolated environment, without the internet, w/ OBS)\r\n(I'm trying CMAKE because I don't want to port Java)\r\n\r\nIt's almost done (need code clean) and I'll probably send Pull-Request next week. However, there are a few things I want to check before I write additional features besides simply make it able to build with CMAKE for TF-GPU in Linux.\r\n\r\n1. Tensorflow is statically linking to pre-installed devel packages. I think in some cases, it might be better to do dynamic linking (use .so) to other libraries (to save some memory and storage size). May I simply add an option like \"tensorflow_USE_SHARED_LIBS_CUDA\"? (e.g., cuda, nccl, ...)\r\n\r\n2. Tensorflow is downloading a lot of external packages and use them \"statically\", which is pretty awful for some people. I'd like to make it use shared libraries as well (maybe along with some version restrictions). May I simply add an option like \"tensorflow_USE_SHARD_LIBS_JSONCPP\", which disables downloading \"JSONCPP\" as well?\r\n\r\nSome additional benefit with these might be reduced memory requirement for building tensorflow; memory consumption of tensorflow-build gets dangerous at the last step with ```ld```. Probably, for now, I may simply need to be satisfied with letting ```make``` reduce ```-j#``` only for ```ld``` steps.\r\n\r\n\r\nCC: @leemgs\r\nSTATUS: failing at the last step. (without ```-Dtensorflow_BUILD_SHARED_LIB```, it works anyway)\r\n```\r\n...\r\n[ 2457s] /usr/lib64/gcc/x86_64-tizen-linux-gnu/6.2.1/../../../../x86_64-tizen-linux-gnu/bin/ld: libtf_core_gpu_kernels.a(tf_core_gpu_kernels_generated_beam_search_ops_gpu.cu.cc.o): relocation R_X86_64_32 against `.data' can not be used when making a shared object; recompile with -fPIC\r\n[ 2457s] /usr/lib64/gcc/x86_64-tizen-linux-gnu/6.2.1/../../../../x86_64-tizen-linux-gnu/bin/ld: libtf_core_gpu_kernels.a(tf_core_gpu_kernels_generated_resampler_ops_gpu.cu.cc.o): relocation R_X86_64_32 against `.data' can not be used when making a shared object; recompile with -fPIC\r\n[ 2457s] /usr/lib64/gcc/x86_64-tizen-linux-gnu/6.2.1/../../../../x86_64-tizen-linux-gnu/bin/ld: final link failed: Nonrepresentable section on output\r\n[ 2457s] collect2: error: ld returned 1 exit status\r\n[ 2457s] CMakeFiles/tensorflow.dir/build.make:2235: recipe for target 'libtensorflow.so' failed\r\n[ 2457s] make[2]: *** [libtensorflow.so] Error 1\r\n[ 2457s] CMakeFiles/Makefile2:82: recipe for target 'CMakeFiles/tensorflow.dir/all' failed\r\n[ 2457s] make[1]: *** [CMakeFiles/tensorflow.dir/all] Error 2\r\n[ 2457s] make[1]: *** Waiting for unfinished jobs....\r\n[ 2458s] [100%] Linking CXX shared library libpywrap_tensorflow_internal.so\r\n[ 2474s] [100%] Built target grpc_tensorflow_server\r\n[ 2474s] [100%] Built target transform_graph\r\n```\r\n\r\n-- STATUS UPDATE: build successful w/ ```-Dtensorflow_BUILD_SHARED_LIB=ON``` as well."}