{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/354637821", "html_url": "https://github.com/tensorflow/tensorflow/issues/15589#issuecomment-354637821", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15589", "id": 354637821, "node_id": "MDEyOklzc3VlQ29tbWVudDM1NDYzNzgyMQ==", "user": {"login": "m3bm3b", "id": 10168793, "node_id": "MDQ6VXNlcjEwMTY4Nzkz", "avatar_url": "https://avatars0.githubusercontent.com/u/10168793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m3bm3b", "html_url": "https://github.com/m3bm3b", "followers_url": "https://api.github.com/users/m3bm3b/followers", "following_url": "https://api.github.com/users/m3bm3b/following{/other_user}", "gists_url": "https://api.github.com/users/m3bm3b/gists{/gist_id}", "starred_url": "https://api.github.com/users/m3bm3b/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m3bm3b/subscriptions", "organizations_url": "https://api.github.com/users/m3bm3b/orgs", "repos_url": "https://api.github.com/users/m3bm3b/repos", "events_url": "https://api.github.com/users/m3bm3b/events{/privacy}", "received_events_url": "https://api.github.com/users/m3bm3b/received_events", "type": "User", "site_admin": false}, "created_at": "2018-01-01T05:48:49Z", "updated_at": "2018-01-01T05:48:49Z", "author_association": "NONE", "body_html": "<p>Thanks.  That confirms that the pointer to the SessionState is bad: it is nil (the value of register rdi),<br>\nthus causing the mutex code to fail as soon as it is used.<br>\n(The mutex is the first field in the SessionState, so its address is the same as the SessionState object.)</p>\n<p>As far as I can see, nothing is setting the session_state anywhere in ConstantFolding::EvaluateNode<br>\nin tensorflow/core/grappler/optimizers/constant_folding.cc</p>\n<p>Alas, I don't know whether the problem is that the session state pointer isn't valid,<br>\nor that the GetSessionHandleOp code is assuming that the value is valid without<br>\nfirst testing it.  The spec for the OpKernelContext in op_kernel.h is not especially clear.<br>\n<a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=49262\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jart\">@jart</a> Do you know?  Or know who would know?</p>", "body_text": "Thanks.  That confirms that the pointer to the SessionState is bad: it is nil (the value of register rdi),\nthus causing the mutex code to fail as soon as it is used.\n(The mutex is the first field in the SessionState, so its address is the same as the SessionState object.)\nAs far as I can see, nothing is setting the session_state anywhere in ConstantFolding::EvaluateNode\nin tensorflow/core/grappler/optimizers/constant_folding.cc\nAlas, I don't know whether the problem is that the session state pointer isn't valid,\nor that the GetSessionHandleOp code is assuming that the value is valid without\nfirst testing it.  The spec for the OpKernelContext in op_kernel.h is not especially clear.\n@jart Do you know?  Or know who would know?", "body": "Thanks.  That confirms that the pointer to the SessionState is bad: it is nil (the value of register rdi),\r\nthus causing the mutex code to fail as soon as it is used.\r\n(The mutex is the first field in the SessionState, so its address is the same as the SessionState object.)\r\n\r\nAs far as I can see, nothing is setting the session_state anywhere in ConstantFolding::EvaluateNode\r\nin tensorflow/core/grappler/optimizers/constant_folding.cc\r\n\r\nAlas, I don't know whether the problem is that the session state pointer isn't valid,\r\nor that the GetSessionHandleOp code is assuming that the value is valid without\r\nfirst testing it.  The spec for the OpKernelContext in op_kernel.h is not especially clear.\r\n@jart Do you know?  Or know who would know?"}