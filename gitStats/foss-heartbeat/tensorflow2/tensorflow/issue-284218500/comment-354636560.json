{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/354636560", "html_url": "https://github.com/tensorflow/tensorflow/issues/15589#issuecomment-354636560", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15589", "id": 354636560, "node_id": "MDEyOklzc3VlQ29tbWVudDM1NDYzNjU2MA==", "user": {"login": "mkmatlock", "id": 391221, "node_id": "MDQ6VXNlcjM5MTIyMQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/391221?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mkmatlock", "html_url": "https://github.com/mkmatlock", "followers_url": "https://api.github.com/users/mkmatlock/followers", "following_url": "https://api.github.com/users/mkmatlock/following{/other_user}", "gists_url": "https://api.github.com/users/mkmatlock/gists{/gist_id}", "starred_url": "https://api.github.com/users/mkmatlock/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mkmatlock/subscriptions", "organizations_url": "https://api.github.com/users/mkmatlock/orgs", "repos_url": "https://api.github.com/users/mkmatlock/repos", "events_url": "https://api.github.com/users/mkmatlock/events{/privacy}", "received_events_url": "https://api.github.com/users/mkmatlock/received_events", "type": "User", "site_admin": false}, "created_at": "2018-01-01T04:49:25Z", "updated_at": "2018-01-01T04:49:25Z", "author_association": "NONE", "body_html": "<p>I collected the requested data. This time I had to reproduce the bug in a docker container running ubuntu 16.04 instead of in our production environment as I've already downgraded. The same segfault with the same stacktrace occurs.</p>\n<p>Here is the output of disas:</p>\n<pre><code>(gdb) disas\nDump of assembler code for function _ZN5nsync13nsync_mu_lockEPNS_11nsync_mu_s_E:\n   0x00007fffececc2f0 &lt;+0&gt;:\tpush   %rbp\n   0x00007fffececc2f1 &lt;+1&gt;:\tmov    $0x1,%edx\n   0x00007fffececc2f6 &lt;+6&gt;:\txor    %eax,%eax\n   0x00007fffececc2f8 &lt;+8&gt;:\tmov    %rsp,%rbp\n   0x00007fffececc2fb &lt;+11&gt;:\tpush   %rbx\n   0x00007fffececc2fc &lt;+12&gt;:\tsub    $0x28,%rsp\n   0x00007fffececc300 &lt;+16&gt;:\tmovl   $0x0,-0x18(%rbp)\n=&gt; 0x00007fffececc307 &lt;+23&gt;:\tlock cmpxchg %edx,(%rdi)\n   0x00007fffececc30b &lt;+27&gt;:\tje     0x7fffececc348 &lt;_ZN5nsync13nsync_mu_lockEPNS_11nsync_mu_s_E+88&gt;\n   0x00007fffececc30d &lt;+29&gt;:\tmov    %eax,-0x18(%rbp)\n   0x00007fffececc310 &lt;+32&gt;:\tmov    (%rdi),%eax\n   0x00007fffececc312 &lt;+34&gt;:\ttest   $0xffffff41,%eax\n   0x00007fffececc317 &lt;+39&gt;:\tje     0x7fffececc34f &lt;_ZN5nsync13nsync_mu_lockEPNS_11nsync_mu_s_E+95&gt;\n   0x00007fffececc319 &lt;+41&gt;:\tmov    %rdi,-0x28(%rbp)\n   0x00007fffececc31d &lt;+45&gt;:\tcallq  0x7fffeb1c2b50 &lt;_ZN5nsync17nsync_waiter_new_Ev@plt&gt;\n   0x00007fffececc322 &lt;+50&gt;:\tmov    0x10cbe27(%rip),%rdx        # 0x7fffedf98150\n   0x00007fffececc329 &lt;+57&gt;:\tmov    -0x28(%rbp),%rdi\n---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---\n   0x00007fffececc32d &lt;+61&gt;:\tmov    %rax,%rbx\n   0x00007fffececc330 &lt;+64&gt;:\tmov    %rax,%rsi\n   0x00007fffececc333 &lt;+67&gt;:\tmov    (%rdx),%rcx\n   0x00007fffececc336 &lt;+70&gt;:\txor    %edx,%edx\n   0x00007fffececc338 &lt;+72&gt;:\tcallq  0x7fffeb1c2b90 &lt;_ZN5nsync19nsync_mu_lock_slow_EPNS_11nsync_mu_s_EPNS_6waiterEjPNS_11lock_type_sE@plt&gt;\n   0x00007fffececc33d &lt;+77&gt;:\tmov    %rbx,%rdi\n   0x00007fffececc340 &lt;+80&gt;:\tcallq  0x7fffeb1c2b60 &lt;_ZN5nsync18nsync_waiter_free_EPNS_6waiterE@plt&gt;\n   0x00007fffececc345 &lt;+85&gt;:\tnopl   (%rax)\n   0x00007fffececc348 &lt;+88&gt;:\tadd    $0x28,%rsp\n   0x00007fffececc34c &lt;+92&gt;:\tpop    %rbx\n   0x00007fffececc34d &lt;+93&gt;:\tpop    %rbp\n   0x00007fffececc34e &lt;+94&gt;:\tretq\n   0x00007fffececc34f &lt;+95&gt;:\tlea    0x1(%rax),%edx\n   0x00007fffececc352 &lt;+98&gt;:\tmov    %eax,-0x14(%rbp)\n   0x00007fffececc355 &lt;+101&gt;:\tand    $0xffffffdf,%edx\n   0x00007fffececc358 &lt;+104&gt;:\tlock cmpxchg %edx,(%rdi)\n   0x00007fffececc35c &lt;+108&gt;:\tje     0x7fffececc348 &lt;_ZN5nsync13nsync_mu_lockEPNS_11nsync_mu_s_E+88&gt;\n   0x00007fffececc35e &lt;+110&gt;:\tmov    %eax,-0x14(%rbp)\n   0x00007fffececc361 &lt;+113&gt;:\tjmp    0x7fffececc319 &lt;_ZN5nsync13nsync_mu_lockEPNS_11nsync_mu_s_E+41&gt;\n---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---\nEnd of assembler dump.\n</code></pre>\n<p>And info reg:</p>\n<pre><code>(gdb) info reg\nrax            0x0\t0\nrbx            0x0\t0\nrcx            0x0\t0\nrdx            0x1\t1\nrsi            0x0\t0\nrdi            0x0\t0\nrbp            0x7fffffffa630\t0x7fffffffa630\nrsp            0x7fffffffa600\t0x7fffffffa600\nr8             0x555555a19960\t93824997235040\nr9             0x7fffea514dd0\t140737124584912\nr10            0x0\t0\nr11            0x7ffff6e97f50\t140737335885648\nr12            0x7fffffffaa60\t140737488333408\nr13            0x555555bc1280\t93824998969984\nr14            0x555555de5560\t93825001215328\nr15            0x7fffffffb0e0\t140737488335072\nrip            0x7fffececc307\t0x7fffececc307 &lt;nsync::nsync_mu_lock(nsync::nsync_mu_s_*)+23&gt;\neflags         0x10206\t[ PF IF RF ]\ncs             0x33\t51\nss             0x2b\t43\nds             0x0\t0\nes             0x0\t0\n---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---\nfs             0x0\t0\ngs             0x0\t0\n</code></pre>", "body_text": "I collected the requested data. This time I had to reproduce the bug in a docker container running ubuntu 16.04 instead of in our production environment as I've already downgraded. The same segfault with the same stacktrace occurs.\nHere is the output of disas:\n(gdb) disas\nDump of assembler code for function _ZN5nsync13nsync_mu_lockEPNS_11nsync_mu_s_E:\n   0x00007fffececc2f0 <+0>:\tpush   %rbp\n   0x00007fffececc2f1 <+1>:\tmov    $0x1,%edx\n   0x00007fffececc2f6 <+6>:\txor    %eax,%eax\n   0x00007fffececc2f8 <+8>:\tmov    %rsp,%rbp\n   0x00007fffececc2fb <+11>:\tpush   %rbx\n   0x00007fffececc2fc <+12>:\tsub    $0x28,%rsp\n   0x00007fffececc300 <+16>:\tmovl   $0x0,-0x18(%rbp)\n=> 0x00007fffececc307 <+23>:\tlock cmpxchg %edx,(%rdi)\n   0x00007fffececc30b <+27>:\tje     0x7fffececc348 <_ZN5nsync13nsync_mu_lockEPNS_11nsync_mu_s_E+88>\n   0x00007fffececc30d <+29>:\tmov    %eax,-0x18(%rbp)\n   0x00007fffececc310 <+32>:\tmov    (%rdi),%eax\n   0x00007fffececc312 <+34>:\ttest   $0xffffff41,%eax\n   0x00007fffececc317 <+39>:\tje     0x7fffececc34f <_ZN5nsync13nsync_mu_lockEPNS_11nsync_mu_s_E+95>\n   0x00007fffececc319 <+41>:\tmov    %rdi,-0x28(%rbp)\n   0x00007fffececc31d <+45>:\tcallq  0x7fffeb1c2b50 <_ZN5nsync17nsync_waiter_new_Ev@plt>\n   0x00007fffececc322 <+50>:\tmov    0x10cbe27(%rip),%rdx        # 0x7fffedf98150\n   0x00007fffececc329 <+57>:\tmov    -0x28(%rbp),%rdi\n---Type <return> to continue, or q <return> to quit---\n   0x00007fffececc32d <+61>:\tmov    %rax,%rbx\n   0x00007fffececc330 <+64>:\tmov    %rax,%rsi\n   0x00007fffececc333 <+67>:\tmov    (%rdx),%rcx\n   0x00007fffececc336 <+70>:\txor    %edx,%edx\n   0x00007fffececc338 <+72>:\tcallq  0x7fffeb1c2b90 <_ZN5nsync19nsync_mu_lock_slow_EPNS_11nsync_mu_s_EPNS_6waiterEjPNS_11lock_type_sE@plt>\n   0x00007fffececc33d <+77>:\tmov    %rbx,%rdi\n   0x00007fffececc340 <+80>:\tcallq  0x7fffeb1c2b60 <_ZN5nsync18nsync_waiter_free_EPNS_6waiterE@plt>\n   0x00007fffececc345 <+85>:\tnopl   (%rax)\n   0x00007fffececc348 <+88>:\tadd    $0x28,%rsp\n   0x00007fffececc34c <+92>:\tpop    %rbx\n   0x00007fffececc34d <+93>:\tpop    %rbp\n   0x00007fffececc34e <+94>:\tretq\n   0x00007fffececc34f <+95>:\tlea    0x1(%rax),%edx\n   0x00007fffececc352 <+98>:\tmov    %eax,-0x14(%rbp)\n   0x00007fffececc355 <+101>:\tand    $0xffffffdf,%edx\n   0x00007fffececc358 <+104>:\tlock cmpxchg %edx,(%rdi)\n   0x00007fffececc35c <+108>:\tje     0x7fffececc348 <_ZN5nsync13nsync_mu_lockEPNS_11nsync_mu_s_E+88>\n   0x00007fffececc35e <+110>:\tmov    %eax,-0x14(%rbp)\n   0x00007fffececc361 <+113>:\tjmp    0x7fffececc319 <_ZN5nsync13nsync_mu_lockEPNS_11nsync_mu_s_E+41>\n---Type <return> to continue, or q <return> to quit---\nEnd of assembler dump.\n\nAnd info reg:\n(gdb) info reg\nrax            0x0\t0\nrbx            0x0\t0\nrcx            0x0\t0\nrdx            0x1\t1\nrsi            0x0\t0\nrdi            0x0\t0\nrbp            0x7fffffffa630\t0x7fffffffa630\nrsp            0x7fffffffa600\t0x7fffffffa600\nr8             0x555555a19960\t93824997235040\nr9             0x7fffea514dd0\t140737124584912\nr10            0x0\t0\nr11            0x7ffff6e97f50\t140737335885648\nr12            0x7fffffffaa60\t140737488333408\nr13            0x555555bc1280\t93824998969984\nr14            0x555555de5560\t93825001215328\nr15            0x7fffffffb0e0\t140737488335072\nrip            0x7fffececc307\t0x7fffececc307 <nsync::nsync_mu_lock(nsync::nsync_mu_s_*)+23>\neflags         0x10206\t[ PF IF RF ]\ncs             0x33\t51\nss             0x2b\t43\nds             0x0\t0\nes             0x0\t0\n---Type <return> to continue, or q <return> to quit---\nfs             0x0\t0\ngs             0x0\t0", "body": "I collected the requested data. This time I had to reproduce the bug in a docker container running ubuntu 16.04 instead of in our production environment as I've already downgraded. The same segfault with the same stacktrace occurs.\r\n\r\nHere is the output of disas:\r\n\r\n```\r\n(gdb) disas\r\nDump of assembler code for function _ZN5nsync13nsync_mu_lockEPNS_11nsync_mu_s_E:\r\n   0x00007fffececc2f0 <+0>:\tpush   %rbp\r\n   0x00007fffececc2f1 <+1>:\tmov    $0x1,%edx\r\n   0x00007fffececc2f6 <+6>:\txor    %eax,%eax\r\n   0x00007fffececc2f8 <+8>:\tmov    %rsp,%rbp\r\n   0x00007fffececc2fb <+11>:\tpush   %rbx\r\n   0x00007fffececc2fc <+12>:\tsub    $0x28,%rsp\r\n   0x00007fffececc300 <+16>:\tmovl   $0x0,-0x18(%rbp)\r\n=> 0x00007fffececc307 <+23>:\tlock cmpxchg %edx,(%rdi)\r\n   0x00007fffececc30b <+27>:\tje     0x7fffececc348 <_ZN5nsync13nsync_mu_lockEPNS_11nsync_mu_s_E+88>\r\n   0x00007fffececc30d <+29>:\tmov    %eax,-0x18(%rbp)\r\n   0x00007fffececc310 <+32>:\tmov    (%rdi),%eax\r\n   0x00007fffececc312 <+34>:\ttest   $0xffffff41,%eax\r\n   0x00007fffececc317 <+39>:\tje     0x7fffececc34f <_ZN5nsync13nsync_mu_lockEPNS_11nsync_mu_s_E+95>\r\n   0x00007fffececc319 <+41>:\tmov    %rdi,-0x28(%rbp)\r\n   0x00007fffececc31d <+45>:\tcallq  0x7fffeb1c2b50 <_ZN5nsync17nsync_waiter_new_Ev@plt>\r\n   0x00007fffececc322 <+50>:\tmov    0x10cbe27(%rip),%rdx        # 0x7fffedf98150\r\n   0x00007fffececc329 <+57>:\tmov    -0x28(%rbp),%rdi\r\n---Type <return> to continue, or q <return> to quit---\r\n   0x00007fffececc32d <+61>:\tmov    %rax,%rbx\r\n   0x00007fffececc330 <+64>:\tmov    %rax,%rsi\r\n   0x00007fffececc333 <+67>:\tmov    (%rdx),%rcx\r\n   0x00007fffececc336 <+70>:\txor    %edx,%edx\r\n   0x00007fffececc338 <+72>:\tcallq  0x7fffeb1c2b90 <_ZN5nsync19nsync_mu_lock_slow_EPNS_11nsync_mu_s_EPNS_6waiterEjPNS_11lock_type_sE@plt>\r\n   0x00007fffececc33d <+77>:\tmov    %rbx,%rdi\r\n   0x00007fffececc340 <+80>:\tcallq  0x7fffeb1c2b60 <_ZN5nsync18nsync_waiter_free_EPNS_6waiterE@plt>\r\n   0x00007fffececc345 <+85>:\tnopl   (%rax)\r\n   0x00007fffececc348 <+88>:\tadd    $0x28,%rsp\r\n   0x00007fffececc34c <+92>:\tpop    %rbx\r\n   0x00007fffececc34d <+93>:\tpop    %rbp\r\n   0x00007fffececc34e <+94>:\tretq\r\n   0x00007fffececc34f <+95>:\tlea    0x1(%rax),%edx\r\n   0x00007fffececc352 <+98>:\tmov    %eax,-0x14(%rbp)\r\n   0x00007fffececc355 <+101>:\tand    $0xffffffdf,%edx\r\n   0x00007fffececc358 <+104>:\tlock cmpxchg %edx,(%rdi)\r\n   0x00007fffececc35c <+108>:\tje     0x7fffececc348 <_ZN5nsync13nsync_mu_lockEPNS_11nsync_mu_s_E+88>\r\n   0x00007fffececc35e <+110>:\tmov    %eax,-0x14(%rbp)\r\n   0x00007fffececc361 <+113>:\tjmp    0x7fffececc319 <_ZN5nsync13nsync_mu_lockEPNS_11nsync_mu_s_E+41>\r\n---Type <return> to continue, or q <return> to quit---\r\nEnd of assembler dump.\r\n```\r\n\r\nAnd info reg:\r\n\r\n```\r\n(gdb) info reg\r\nrax            0x0\t0\r\nrbx            0x0\t0\r\nrcx            0x0\t0\r\nrdx            0x1\t1\r\nrsi            0x0\t0\r\nrdi            0x0\t0\r\nrbp            0x7fffffffa630\t0x7fffffffa630\r\nrsp            0x7fffffffa600\t0x7fffffffa600\r\nr8             0x555555a19960\t93824997235040\r\nr9             0x7fffea514dd0\t140737124584912\r\nr10            0x0\t0\r\nr11            0x7ffff6e97f50\t140737335885648\r\nr12            0x7fffffffaa60\t140737488333408\r\nr13            0x555555bc1280\t93824998969984\r\nr14            0x555555de5560\t93825001215328\r\nr15            0x7fffffffb0e0\t140737488335072\r\nrip            0x7fffececc307\t0x7fffececc307 <nsync::nsync_mu_lock(nsync::nsync_mu_s_*)+23>\r\neflags         0x10206\t[ PF IF RF ]\r\ncs             0x33\t51\r\nss             0x2b\t43\r\nds             0x0\t0\r\nes             0x0\t0\r\n---Type <return> to continue, or q <return> to quit---\r\nfs             0x0\t0\r\ngs             0x0\t0\r\n```"}