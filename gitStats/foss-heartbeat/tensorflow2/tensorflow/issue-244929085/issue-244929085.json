{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11695", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11695/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11695/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11695/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/11695", "id": 244929085, "node_id": "MDU6SXNzdWUyNDQ5MjkwODU=", "number": 11695, "title": "Makefile build fails on OSX: -lprotobuf not found", "user": {"login": "vikrantt", "id": 2448637, "node_id": "MDQ6VXNlcjI0NDg2Mzc=", "avatar_url": "https://avatars1.githubusercontent.com/u/2448637?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vikrantt", "html_url": "https://github.com/vikrantt", "followers_url": "https://api.github.com/users/vikrantt/followers", "following_url": "https://api.github.com/users/vikrantt/following{/other_user}", "gists_url": "https://api.github.com/users/vikrantt/gists{/gist_id}", "starred_url": "https://api.github.com/users/vikrantt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vikrantt/subscriptions", "organizations_url": "https://api.github.com/users/vikrantt/orgs", "repos_url": "https://api.github.com/users/vikrantt/repos", "events_url": "https://api.github.com/users/vikrantt/events{/privacy}", "received_events_url": "https://api.github.com/users/vikrantt/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": {"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2017-07-23T18:58:54Z", "updated_at": "2018-11-12T18:51:04Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>Please go to Stack Overflow for help and support:</p>\n<p><a href=\"http://stackoverflow.com/questions/tagged/tensorflow\" rel=\"nofollow\">http://stackoverflow.com/questions/tagged/tensorflow</a></p>\n<p>If you open a GitHub issue, here is our policy:</p>\n<ol>\n<li>It must be a bug or a feature request.</li>\n<li>The form below must be filled out.</li>\n<li>It shouldn't be a TensorBoard issue. Those go <a href=\"https://github.com/tensorflow/tensorboard/issues\">here</a>.</li>\n</ol>\n<p><strong>Here's why we have that policy</strong>: TensorFlow developers respond to issues. We want to focus on work that benefits the whole community, e.g., fixing bugs and adding features. Support only helps individuals. GitHub also notifies thousands of people when issues are filed. We want them to see you communicating an interesting problem, rather than being redirected to Stack Overflow.</p>\n<hr>\n<h3>System information</h3>\n<ul>\n<li>\n<p><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:<br>\nNo. Using the provided Makefile build system.</p>\n</li>\n<li>\n<p><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nMac OS X 10.12.6</p>\n</li>\n<li>\n<p><strong>TensorFlow installed from (source or binary)</strong>:<br>\nSource - r 1.3</p>\n</li>\n<li>\n<p><strong>TensorFlow version (use command below)</strong>:<br>\nr1.3</p>\n</li>\n<li>\n<p><strong>Bazel version (if compiling from source)</strong>:<br>\nBuild label: 0.5.2-homebrew</p>\n</li>\n<li>\n<p><strong>Exact command to reproduce</strong>:<br>\n<code>sh /tensorflow/contrib/makefile/build_all_linux.sh  </code></p>\n</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>I think there is a bug in the make files when building for OSX. Actually, the build finishes ok but the scripts give a linked error when compiling the provided benchmark program.<br>\nThe error given is:</p>\n<pre><code>ld: library not found for -lprotobuf\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n\n</code></pre>\n<h3>Source code / logs</h3>\n<p>This is the line where error occurs:</p>\n<pre><code>gcc --std=c++11 -DIS_SLIM_BUILD -fno-exceptions -DNDEBUG -O3 -march=native -I. -Itf_build/tensorflow/tensorflow/contrib/makefile/downloads/ -Itf_build/tensorflow/tensorflow/contrib/makefile/downloads/eigen -Itf_build/tensorflow/tensorflow/contrib/makefile/downloads/gemmlowp -Itf_build/tensorflow/tensorflow/contrib/makefile/gen/proto/ -Itf_build/tensorflow/tensorflow/contrib/makefile/gen/proto_text/ -Itf_build/tensorflow/tensorflow/contrib/makefile/gen/protobuf-host/include -I/usr/local/include \\\n\t-o tf_build/tensorflow/tensorflow/contrib/makefile/gen/bin/benchmark tf_build/tensorflow/tensorflow/contrib/makefile/gen/obj/tensorflow/core/util/reporter.o tf_build/tensorflow/tensorflow/contrib/makefile/gen/obj/tensorflow/tools/benchmark/benchmark_model.o tf_build/tensorflow/tensorflow/contrib/makefile/gen/obj/tensorflow/tools/benchmark/benchmark_model_main.o \\\n\t tf_build/tensorflow/tensorflow/contrib/makefile/gen/lib/libtensorflow-core.a -L/usr/local/lib -all_load -lstdc++ -lprotobuf -lz -lm\n</code></pre>\n<p>As you can see towards the end it links against -lprotobuf, however, it does not give the path to the library (It's missing <code>-L/some-path/tensorflow/contrib/makefile/gen/protobuf-host/lib</code>). When I manually compile the program, instead of using the makefile, and pass the library path, it works fine.</p>\n<p>It is easy to fix by modifying the lines 186 onwards in the Makefile from:</p>\n<pre><code>ifeq ($(TARGET),OSX)\n\tLDFLAGS += -all_load\nendif\n</code></pre>\n<p>to</p>\n<pre><code>ifeq ($(TARGET),OSX)\n\tLDFLAGS += -all_load\nifeq ($(HAS_GEN_HOST_PROTOC),true)\n\tLIBFLAGS += -L$(MAKEFILE_DIR)/gen/protobuf-host/lib\n\texport LD_LIBRARY_PATH=$(MAKEFILE_DIR)/gen/protobuf-host/lib\nendif\n</code></pre>\n<p>Another related issue is that I get a whole bunch of warnings from ranlib about some of the built libraries having no symbol. Any comments on that will also be appreciated:</p>\n<pre><code>/Library/Developer/CommandLineTools/usr/bin/ranlib: file: /fullpath/tensorflow/tensorflow/contrib/makefile/gen/lib/libtensorflow-core.a(mkl_layout_pass.o) has no symbols\n/Library/Developer/CommandLineTools/usr/bin/ranlib: file: /fullpath/tensorflow/tensorflow/contrib/makefile/gen/lib/libtensorflow-core.a(mkl_tfconversion_pass.o) has no symbols\n/Library/Developer/CommandLineTools/usr/bin/ranlib: file: /fullpath/tensorflow/tensorflow/contrib/makefile/gen/lib/libtensorflow-core.a(cupti_wrapper.o) has no symbols\n/Library/Developer/CommandLineTools/usr/bin/ranlib: file: /fullpath/tensorflow/tensorflow/contrib/makefile/gen/lib/libtensorflow-core.a(android_armv7a_cpu_utils_helper.o) has no symbols\n\n</code></pre>\n<p>Thanks.</p>", "body_text": "Please go to Stack Overflow for help and support:\nhttp://stackoverflow.com/questions/tagged/tensorflow\nIf you open a GitHub issue, here is our policy:\n\nIt must be a bug or a feature request.\nThe form below must be filled out.\nIt shouldn't be a TensorBoard issue. Those go here.\n\nHere's why we have that policy: TensorFlow developers respond to issues. We want to focus on work that benefits the whole community, e.g., fixing bugs and adding features. Support only helps individuals. GitHub also notifies thousands of people when issues are filed. We want them to see you communicating an interesting problem, rather than being redirected to Stack Overflow.\n\nSystem information\n\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nNo. Using the provided Makefile build system.\n\n\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nMac OS X 10.12.6\n\n\nTensorFlow installed from (source or binary):\nSource - r 1.3\n\n\nTensorFlow version (use command below):\nr1.3\n\n\nBazel version (if compiling from source):\nBuild label: 0.5.2-homebrew\n\n\nExact command to reproduce:\nsh /tensorflow/contrib/makefile/build_all_linux.sh  \n\n\nDescribe the problem\nI think there is a bug in the make files when building for OSX. Actually, the build finishes ok but the scripts give a linked error when compiling the provided benchmark program.\nThe error given is:\nld: library not found for -lprotobuf\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n\n\nSource code / logs\nThis is the line where error occurs:\ngcc --std=c++11 -DIS_SLIM_BUILD -fno-exceptions -DNDEBUG -O3 -march=native -I. -Itf_build/tensorflow/tensorflow/contrib/makefile/downloads/ -Itf_build/tensorflow/tensorflow/contrib/makefile/downloads/eigen -Itf_build/tensorflow/tensorflow/contrib/makefile/downloads/gemmlowp -Itf_build/tensorflow/tensorflow/contrib/makefile/gen/proto/ -Itf_build/tensorflow/tensorflow/contrib/makefile/gen/proto_text/ -Itf_build/tensorflow/tensorflow/contrib/makefile/gen/protobuf-host/include -I/usr/local/include \\\n\t-o tf_build/tensorflow/tensorflow/contrib/makefile/gen/bin/benchmark tf_build/tensorflow/tensorflow/contrib/makefile/gen/obj/tensorflow/core/util/reporter.o tf_build/tensorflow/tensorflow/contrib/makefile/gen/obj/tensorflow/tools/benchmark/benchmark_model.o tf_build/tensorflow/tensorflow/contrib/makefile/gen/obj/tensorflow/tools/benchmark/benchmark_model_main.o \\\n\t tf_build/tensorflow/tensorflow/contrib/makefile/gen/lib/libtensorflow-core.a -L/usr/local/lib -all_load -lstdc++ -lprotobuf -lz -lm\n\nAs you can see towards the end it links against -lprotobuf, however, it does not give the path to the library (It's missing -L/some-path/tensorflow/contrib/makefile/gen/protobuf-host/lib). When I manually compile the program, instead of using the makefile, and pass the library path, it works fine.\nIt is easy to fix by modifying the lines 186 onwards in the Makefile from:\nifeq ($(TARGET),OSX)\n\tLDFLAGS += -all_load\nendif\n\nto\nifeq ($(TARGET),OSX)\n\tLDFLAGS += -all_load\nifeq ($(HAS_GEN_HOST_PROTOC),true)\n\tLIBFLAGS += -L$(MAKEFILE_DIR)/gen/protobuf-host/lib\n\texport LD_LIBRARY_PATH=$(MAKEFILE_DIR)/gen/protobuf-host/lib\nendif\n\nAnother related issue is that I get a whole bunch of warnings from ranlib about some of the built libraries having no symbol. Any comments on that will also be appreciated:\n/Library/Developer/CommandLineTools/usr/bin/ranlib: file: /fullpath/tensorflow/tensorflow/contrib/makefile/gen/lib/libtensorflow-core.a(mkl_layout_pass.o) has no symbols\n/Library/Developer/CommandLineTools/usr/bin/ranlib: file: /fullpath/tensorflow/tensorflow/contrib/makefile/gen/lib/libtensorflow-core.a(mkl_tfconversion_pass.o) has no symbols\n/Library/Developer/CommandLineTools/usr/bin/ranlib: file: /fullpath/tensorflow/tensorflow/contrib/makefile/gen/lib/libtensorflow-core.a(cupti_wrapper.o) has no symbols\n/Library/Developer/CommandLineTools/usr/bin/ranlib: file: /fullpath/tensorflow/tensorflow/contrib/makefile/gen/lib/libtensorflow-core.a(android_armv7a_cpu_utils_helper.o) has no symbols\n\n\nThanks.", "body": "Please go to Stack Overflow for help and support:\r\n\r\nhttp://stackoverflow.com/questions/tagged/tensorflow\r\n\r\nIf you open a GitHub issue, here is our policy:\r\n\r\n1. It must be a bug or a feature request.\r\n2. The form below must be filled out.\r\n3. It shouldn't be a TensorBoard issue. Those go [here](https://github.com/tensorflow/tensorboard/issues).\r\n\r\n**Here's why we have that policy**: TensorFlow developers respond to issues. We want to focus on work that benefits the whole community, e.g., fixing bugs and adding features. Support only helps individuals. GitHub also notifies thousands of people when issues are filed. We want them to see you communicating an interesting problem, rather than being redirected to Stack Overflow.\r\n\r\n------------------------\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\nNo. Using the provided Makefile build system. \r\n\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\nMac OS X 10.12.6\r\n\r\n- **TensorFlow installed from (source or binary)**:\r\nSource - r 1.3\r\n\r\n- **TensorFlow version (use command below)**:\r\nr1.3\r\n\r\n- **Bazel version (if compiling from source)**:\r\nBuild label: 0.5.2-homebrew\r\n\r\n- **Exact command to reproduce**:\r\n`sh /tensorflow/contrib/makefile/build_all_linux.sh \r\n`\r\n### Describe the problem\r\nI think there is a bug in the make files when building for OSX. Actually, the build finishes ok but the scripts give a linked error when compiling the provided benchmark program. \r\nThe error given is:\r\n\r\n```\r\nld: library not found for -lprotobuf\r\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\r\n\r\n```\r\n\r\n### Source code / logs\r\nThis is the line where error occurs:\r\n```\r\ngcc --std=c++11 -DIS_SLIM_BUILD -fno-exceptions -DNDEBUG -O3 -march=native -I. -Itf_build/tensorflow/tensorflow/contrib/makefile/downloads/ -Itf_build/tensorflow/tensorflow/contrib/makefile/downloads/eigen -Itf_build/tensorflow/tensorflow/contrib/makefile/downloads/gemmlowp -Itf_build/tensorflow/tensorflow/contrib/makefile/gen/proto/ -Itf_build/tensorflow/tensorflow/contrib/makefile/gen/proto_text/ -Itf_build/tensorflow/tensorflow/contrib/makefile/gen/protobuf-host/include -I/usr/local/include \\\r\n\t-o tf_build/tensorflow/tensorflow/contrib/makefile/gen/bin/benchmark tf_build/tensorflow/tensorflow/contrib/makefile/gen/obj/tensorflow/core/util/reporter.o tf_build/tensorflow/tensorflow/contrib/makefile/gen/obj/tensorflow/tools/benchmark/benchmark_model.o tf_build/tensorflow/tensorflow/contrib/makefile/gen/obj/tensorflow/tools/benchmark/benchmark_model_main.o \\\r\n\t tf_build/tensorflow/tensorflow/contrib/makefile/gen/lib/libtensorflow-core.a -L/usr/local/lib -all_load -lstdc++ -lprotobuf -lz -lm\r\n```\r\n\r\nAs you can see towards the end it links against -lprotobuf, however, it does not give the path to the library (It's missing `-L/some-path/tensorflow/contrib/makefile/gen/protobuf-host/lib`). When I manually compile the program, instead of using the makefile, and pass the library path, it works fine. \r\n\r\nIt is easy to fix by modifying the lines 186 onwards in the Makefile from:\r\n\r\n```\r\nifeq ($(TARGET),OSX)\r\n\tLDFLAGS += -all_load\r\nendif\r\n```\r\nto\r\n```\r\nifeq ($(TARGET),OSX)\r\n\tLDFLAGS += -all_load\r\nifeq ($(HAS_GEN_HOST_PROTOC),true)\r\n\tLIBFLAGS += -L$(MAKEFILE_DIR)/gen/protobuf-host/lib\r\n\texport LD_LIBRARY_PATH=$(MAKEFILE_DIR)/gen/protobuf-host/lib\r\nendif\r\n```\r\nAnother related issue is that I get a whole bunch of warnings from ranlib about some of the built libraries having no symbol. Any comments on that will also be appreciated:\r\n\r\n```\r\n/Library/Developer/CommandLineTools/usr/bin/ranlib: file: /fullpath/tensorflow/tensorflow/contrib/makefile/gen/lib/libtensorflow-core.a(mkl_layout_pass.o) has no symbols\r\n/Library/Developer/CommandLineTools/usr/bin/ranlib: file: /fullpath/tensorflow/tensorflow/contrib/makefile/gen/lib/libtensorflow-core.a(mkl_tfconversion_pass.o) has no symbols\r\n/Library/Developer/CommandLineTools/usr/bin/ranlib: file: /fullpath/tensorflow/tensorflow/contrib/makefile/gen/lib/libtensorflow-core.a(cupti_wrapper.o) has no symbols\r\n/Library/Developer/CommandLineTools/usr/bin/ranlib: file: /fullpath/tensorflow/tensorflow/contrib/makefile/gen/lib/libtensorflow-core.a(android_armv7a_cpu_utils_helper.o) has no symbols\r\n\r\n```\r\n\r\nThanks."}