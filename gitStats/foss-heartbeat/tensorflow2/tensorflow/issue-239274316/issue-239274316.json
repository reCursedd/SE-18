{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11121", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11121/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11121/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11121/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/11121", "id": 239274316, "node_id": "MDU6SXNzdWUyMzkyNzQzMTY=", "number": 11121, "title": "reset_default_graph awkwardly breaks graph nesting.", "user": {"login": "Thenerdstation", "id": 8702042, "node_id": "MDQ6VXNlcjg3MDIwNDI=", "avatar_url": "https://avatars0.githubusercontent.com/u/8702042?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Thenerdstation", "html_url": "https://github.com/Thenerdstation", "followers_url": "https://api.github.com/users/Thenerdstation/followers", "following_url": "https://api.github.com/users/Thenerdstation/following{/other_user}", "gists_url": "https://api.github.com/users/Thenerdstation/gists{/gist_id}", "starred_url": "https://api.github.com/users/Thenerdstation/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Thenerdstation/subscriptions", "organizations_url": "https://api.github.com/users/Thenerdstation/orgs", "repos_url": "https://api.github.com/users/Thenerdstation/repos", "events_url": "https://api.github.com/users/Thenerdstation/events{/privacy}", "received_events_url": "https://api.github.com/users/Thenerdstation/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2017-06-28T19:45:17Z", "updated_at": "2017-07-05T15:43:49Z", "closed_at": "2017-07-05T15:43:49Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Linux Ubuntu 16.04</strong>:</li>\n<li><strong>TF version 1.1.0, though it should still be present in master</strong>:</li>\n</ul>\n<h3>Bug</h3>\n<p>Running this:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\ng <span class=\"pl-k\">=</span> tf.Graph()\n<span class=\"pl-k\">with</span> g.as_default():\n  tf.reset_default_graph()\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> Build something...</span>\n  a <span class=\"pl-k\">=</span> tf.constant(<span class=\"pl-c1\">1.0</span>)\n  b <span class=\"pl-k\">=</span> tf.constant(<span class=\"pl-c1\">1.0</span>)\n  c <span class=\"pl-k\">=</span> a <span class=\"pl-k\">+</span> b\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> Bug happens on exit of the with statement</span></pre></div>\n<p>Causes this</p>\n<pre><code>---------------------------------------------------------------------------\nIndexError                                Traceback (most recent call last)\n&lt;ipython-input-1-af7c5ed96704&gt; in &lt;module&gt;()\n      7   a = tf.constant(1.0)\n      8   b = tf.constant(1.0)\n----&gt; 9   c = a + b\n\n/usr/lib/python3.5/contextlib.py in __exit__(self, type, value, traceback)\n     64         if type is None:\n     65             try:\n---&gt; 66                 next(self.gen)\n     67             except StopIteration:\n     68                 return\n\n/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py in get_controller(self, default)\n   3626     finally:\n   3627       if self._enforce_nesting:\n-&gt; 3628         if self.stack[-1] is not default:\n   3629           raise AssertionError(\n   3630               \"Nesting violated for default stack of %s objects\"\n\nIndexError: list index out of range\n</code></pre>\n<p>This bug causes a confusing error message. The stack should either include the new default graph created by reset_default_graph or a warning/error message should happen when you reset the default within nested graphs.</p>", "body_text": "System information\n\nLinux Ubuntu 16.04:\nTF version 1.1.0, though it should still be present in master:\n\nBug\nRunning this:\nimport tensorflow as tf\n\ng = tf.Graph()\nwith g.as_default():\n  tf.reset_default_graph()\n  # Build something...\n  a = tf.constant(1.0)\n  b = tf.constant(1.0)\n  c = a + b\n  # Bug happens on exit of the with statement\nCauses this\n---------------------------------------------------------------------------\nIndexError                                Traceback (most recent call last)\n<ipython-input-1-af7c5ed96704> in <module>()\n      7   a = tf.constant(1.0)\n      8   b = tf.constant(1.0)\n----> 9   c = a + b\n\n/usr/lib/python3.5/contextlib.py in __exit__(self, type, value, traceback)\n     64         if type is None:\n     65             try:\n---> 66                 next(self.gen)\n     67             except StopIteration:\n     68                 return\n\n/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py in get_controller(self, default)\n   3626     finally:\n   3627       if self._enforce_nesting:\n-> 3628         if self.stack[-1] is not default:\n   3629           raise AssertionError(\n   3630               \"Nesting violated for default stack of %s objects\"\n\nIndexError: list index out of range\n\nThis bug causes a confusing error message. The stack should either include the new default graph created by reset_default_graph or a warning/error message should happen when you reset the default within nested graphs.", "body": "\r\n### System information\r\n- **Linux Ubuntu 16.04**:\r\n- **TF version 1.1.0, though it should still be present in master**:\r\n\r\n### Bug\r\nRunning this:\r\n```python\r\nimport tensorflow as tf\r\n\r\ng = tf.Graph()\r\nwith g.as_default():\r\n  tf.reset_default_graph()\r\n  # Build something...\r\n  a = tf.constant(1.0)\r\n  b = tf.constant(1.0)\r\n  c = a + b\r\n  # Bug happens on exit of the with statement\r\n```\r\nCauses this\r\n\r\n```\r\n---------------------------------------------------------------------------\r\nIndexError                                Traceback (most recent call last)\r\n<ipython-input-1-af7c5ed96704> in <module>()\r\n      7   a = tf.constant(1.0)\r\n      8   b = tf.constant(1.0)\r\n----> 9   c = a + b\r\n\r\n/usr/lib/python3.5/contextlib.py in __exit__(self, type, value, traceback)\r\n     64         if type is None:\r\n     65             try:\r\n---> 66                 next(self.gen)\r\n     67             except StopIteration:\r\n     68                 return\r\n\r\n/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py in get_controller(self, default)\r\n   3626     finally:\r\n   3627       if self._enforce_nesting:\r\n-> 3628         if self.stack[-1] is not default:\r\n   3629           raise AssertionError(\r\n   3630               \"Nesting violated for default stack of %s objects\"\r\n\r\nIndexError: list index out of range\r\n```\r\n\r\nThis bug causes a confusing error message. The stack should either include the new default graph created by reset_default_graph or a warning/error message should happen when you reset the default within nested graphs."}