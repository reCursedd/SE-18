{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12876", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12876/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12876/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12876/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/12876", "id": 255899683, "node_id": "MDU6SXNzdWUyNTU4OTk2ODM=", "number": 12876, "title": "Reading float value from tfrecord, return a not same value.", "user": {"login": "TechBK", "id": 8995895, "node_id": "MDQ6VXNlcjg5OTU4OTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/8995895?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TechBK", "html_url": "https://github.com/TechBK", "followers_url": "https://api.github.com/users/TechBK/followers", "following_url": "https://api.github.com/users/TechBK/following{/other_user}", "gists_url": "https://api.github.com/users/TechBK/gists{/gist_id}", "starred_url": "https://api.github.com/users/TechBK/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TechBK/subscriptions", "organizations_url": "https://api.github.com/users/TechBK/orgs", "repos_url": "https://api.github.com/users/TechBK/repos", "events_url": "https://api.github.com/users/TechBK/events{/privacy}", "received_events_url": "https://api.github.com/users/TechBK/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2017-09-07T11:06:05Z", "updated_at": "2018-11-03T19:02:16Z", "closed_at": "2017-09-09T18:29:58Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li>OS Platform and Distribution: Linux Ubuntu 16.04)</li>\n<li>TensorFlow installed from: <a href=\"https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.3.0-cp36-cp36m-linux_x86_64.whl\" rel=\"nofollow\">binary</a></li>\n<li>TensorFlow version: v1.3.0-rc2-20-g0787eee 1.3.0</li>\n<li>Python version: Python 3.6.2 :: Continuum Analytics, Inc.</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>When i read feature <code>label</code> with <code>float</code> type from tfrecord, it return not same value. Example:</p>\n<ul>\n<li><code>3.3 -&gt; 3.29999995</code></li>\n<li><code>3.7 -&gt; 3.70000005</code></li>\n<li><code>4.9 -&gt; 4.9000001</code></li>\n</ul>\n<p>Here, code make <code>Example</code>:</p>\n<pre><code>def make_example(s0, s1, label):\n    ex = tf.train.SequenceExample()\n    ex.context.feature[\"len_s0\"].int64_list.value.append(len(s0))\n    ex.context.feature[\"len_s1\"].int64_list.value.append(len(s1))\n    ex.context.feature[\"label\"].float_list.value.append(label)# HERE: the feature are `float` type\n\n    for w in s0:\n        ex.feature_lists.feature_list[\"s0\"].feature.add().int64_list.value.append(w)\n    for w in s1:\n        ex.feature_lists.feature_list[\"s1\"].feature.add().int64_list.value.append(w)\n\n    return ex\n</code></pre>\n<p>Parsing function:</p>\n<pre><code>def _parse_function(example_proto):\n    context_features = {\n        \"len_s0\": tf.FixedLenFeature((), dtype=tf.int64),\n        \"len_s1\": tf.FixedLenFeature((), dtype=tf.int64),\n        \"label\": tf.FixedLenFeature((), dtype=tf.float32) # HERE: the feature are `float` type\n    }\n    sequence_features = {\n        \"s0\": tf.FixedLenSequenceFeature((), dtype=tf.int64),\n        \"s1\": tf.FixedLenSequenceFeature((), dtype=tf.int64)\n    }\n\n    context_parsed, sequence_parsed = tf.parse_single_sequence_example(\n        serialized=example_proto,\n        context_features=context_features,\n        sequence_features=sequence_features\n    )\n\n    len_s0 = tf.cast(context_parsed['len_s0'], dtype=tf.int8)\n    len_s1 = tf.cast(context_parsed['len_s1'], dtype=tf.int8)\n    # label = tf.convert_to_tensor(context_parsed['label'], dtype=tf.float32)\n    # label = tf.round(context_parsed['label'])\n    label = context_parsed['label']\n    s0 = tf.cast(sequence_parsed['s0'], dtype=tf.int32)\n    s1 = tf.cast(sequence_parsed['s1'], dtype=tf.int32)\n\n    return {\"len_s0\": len_s0, \"s0\": s0, \"len_s1\": len_s1, \"s1\": s1}, label\n</code></pre>\n<p>When i call <code>result = tf.contrib.learn.run_n({\"label\": label}) </code>, it return:</p>\n<pre><code>{'label': array([ 3.29999995], dtype=float32)} # right value: 3.3\n{'label': array([ 3.70000005], dtype=float32)} # right value: 3.7\n{'label': array([ 4.9000001], dtype=float32)} # right value: 4.9\n</code></pre>\n<p>Some one can help me? Plzz told me some ways to fix it.</p>", "body_text": "System information\n\nOS Platform and Distribution: Linux Ubuntu 16.04)\nTensorFlow installed from: binary\nTensorFlow version: v1.3.0-rc2-20-g0787eee 1.3.0\nPython version: Python 3.6.2 :: Continuum Analytics, Inc.\n\nDescribe the problem\nWhen i read feature label with float type from tfrecord, it return not same value. Example:\n\n3.3 -> 3.29999995\n3.7 -> 3.70000005\n4.9 -> 4.9000001\n\nHere, code make Example:\ndef make_example(s0, s1, label):\n    ex = tf.train.SequenceExample()\n    ex.context.feature[\"len_s0\"].int64_list.value.append(len(s0))\n    ex.context.feature[\"len_s1\"].int64_list.value.append(len(s1))\n    ex.context.feature[\"label\"].float_list.value.append(label)# HERE: the feature are `float` type\n\n    for w in s0:\n        ex.feature_lists.feature_list[\"s0\"].feature.add().int64_list.value.append(w)\n    for w in s1:\n        ex.feature_lists.feature_list[\"s1\"].feature.add().int64_list.value.append(w)\n\n    return ex\n\nParsing function:\ndef _parse_function(example_proto):\n    context_features = {\n        \"len_s0\": tf.FixedLenFeature((), dtype=tf.int64),\n        \"len_s1\": tf.FixedLenFeature((), dtype=tf.int64),\n        \"label\": tf.FixedLenFeature((), dtype=tf.float32) # HERE: the feature are `float` type\n    }\n    sequence_features = {\n        \"s0\": tf.FixedLenSequenceFeature((), dtype=tf.int64),\n        \"s1\": tf.FixedLenSequenceFeature((), dtype=tf.int64)\n    }\n\n    context_parsed, sequence_parsed = tf.parse_single_sequence_example(\n        serialized=example_proto,\n        context_features=context_features,\n        sequence_features=sequence_features\n    )\n\n    len_s0 = tf.cast(context_parsed['len_s0'], dtype=tf.int8)\n    len_s1 = tf.cast(context_parsed['len_s1'], dtype=tf.int8)\n    # label = tf.convert_to_tensor(context_parsed['label'], dtype=tf.float32)\n    # label = tf.round(context_parsed['label'])\n    label = context_parsed['label']\n    s0 = tf.cast(sequence_parsed['s0'], dtype=tf.int32)\n    s1 = tf.cast(sequence_parsed['s1'], dtype=tf.int32)\n\n    return {\"len_s0\": len_s0, \"s0\": s0, \"len_s1\": len_s1, \"s1\": s1}, label\n\nWhen i call result = tf.contrib.learn.run_n({\"label\": label}) , it return:\n{'label': array([ 3.29999995], dtype=float32)} # right value: 3.3\n{'label': array([ 3.70000005], dtype=float32)} # right value: 3.7\n{'label': array([ 4.9000001], dtype=float32)} # right value: 4.9\n\nSome one can help me? Plzz told me some ways to fix it.", "body": "### System information\r\n- OS Platform and Distribution: Linux Ubuntu 16.04)\r\n- TensorFlow installed from: [binary](https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.3.0-cp36-cp36m-linux_x86_64.whl)\r\n- TensorFlow version: v1.3.0-rc2-20-g0787eee 1.3.0\r\n- Python version: Python 3.6.2 :: Continuum Analytics, Inc.\r\n\r\n### Describe the problem\r\nWhen i read feature `label` with `float` type from tfrecord, it return not same value. Example:\r\n- `3.3 -> 3.29999995`\r\n- `3.7 -> 3.70000005`\r\n- `4.9 -> 4.9000001`\r\n\r\nHere, code make `Example`:\r\n```\r\ndef make_example(s0, s1, label):\r\n    ex = tf.train.SequenceExample()\r\n    ex.context.feature[\"len_s0\"].int64_list.value.append(len(s0))\r\n    ex.context.feature[\"len_s1\"].int64_list.value.append(len(s1))\r\n    ex.context.feature[\"label\"].float_list.value.append(label)# HERE: the feature are `float` type\r\n\r\n    for w in s0:\r\n        ex.feature_lists.feature_list[\"s0\"].feature.add().int64_list.value.append(w)\r\n    for w in s1:\r\n        ex.feature_lists.feature_list[\"s1\"].feature.add().int64_list.value.append(w)\r\n\r\n    return ex\r\n```\r\nParsing function:\r\n```\r\ndef _parse_function(example_proto):\r\n    context_features = {\r\n        \"len_s0\": tf.FixedLenFeature((), dtype=tf.int64),\r\n        \"len_s1\": tf.FixedLenFeature((), dtype=tf.int64),\r\n        \"label\": tf.FixedLenFeature((), dtype=tf.float32) # HERE: the feature are `float` type\r\n    }\r\n    sequence_features = {\r\n        \"s0\": tf.FixedLenSequenceFeature((), dtype=tf.int64),\r\n        \"s1\": tf.FixedLenSequenceFeature((), dtype=tf.int64)\r\n    }\r\n\r\n    context_parsed, sequence_parsed = tf.parse_single_sequence_example(\r\n        serialized=example_proto,\r\n        context_features=context_features,\r\n        sequence_features=sequence_features\r\n    )\r\n\r\n    len_s0 = tf.cast(context_parsed['len_s0'], dtype=tf.int8)\r\n    len_s1 = tf.cast(context_parsed['len_s1'], dtype=tf.int8)\r\n    # label = tf.convert_to_tensor(context_parsed['label'], dtype=tf.float32)\r\n    # label = tf.round(context_parsed['label'])\r\n    label = context_parsed['label']\r\n    s0 = tf.cast(sequence_parsed['s0'], dtype=tf.int32)\r\n    s1 = tf.cast(sequence_parsed['s1'], dtype=tf.int32)\r\n\r\n    return {\"len_s0\": len_s0, \"s0\": s0, \"len_s1\": len_s1, \"s1\": s1}, label\r\n```\r\nWhen i call `result = tf.contrib.learn.run_n({\"label\": label}) `, it return:\r\n```\r\n{'label': array([ 3.29999995], dtype=float32)} # right value: 3.3\r\n{'label': array([ 3.70000005], dtype=float32)} # right value: 3.7\r\n{'label': array([ 4.9000001], dtype=float32)} # right value: 4.9\r\n```\r\n\r\nSome one can help me? Plzz told me some ways to fix it."}