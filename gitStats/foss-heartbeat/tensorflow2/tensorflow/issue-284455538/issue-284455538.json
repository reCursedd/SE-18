{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15627", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15627/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15627/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15627/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15627", "id": 284455538, "node_id": "MDU6SXNzdWUyODQ0NTU1Mzg=", "number": 15627, "title": "Cannot compute output tensor of tf.keras.layers.Lambda + tf.unstack", "user": {"login": "kzm4269", "id": 7009040, "node_id": "MDQ6VXNlcjcwMDkwNDA=", "avatar_url": "https://avatars1.githubusercontent.com/u/7009040?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kzm4269", "html_url": "https://github.com/kzm4269", "followers_url": "https://api.github.com/users/kzm4269/followers", "following_url": "https://api.github.com/users/kzm4269/following{/other_user}", "gists_url": "https://api.github.com/users/kzm4269/gists{/gist_id}", "starred_url": "https://api.github.com/users/kzm4269/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kzm4269/subscriptions", "organizations_url": "https://api.github.com/users/kzm4269/orgs", "repos_url": "https://api.github.com/users/kzm4269/repos", "events_url": "https://api.github.com/users/kzm4269/events{/privacy}", "received_events_url": "https://api.github.com/users/kzm4269/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-12-25T15:34:14Z", "updated_at": "2018-09-27T00:49:12Z", "closed_at": "2017-12-25T19:50:58Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code</strong>: Yes</li>\n<li><strong>OS Platform and Distribution</strong>: Ubuntu 16.04</li>\n<li><strong>TensorFlow installed from</strong>: binary</li>\n<li><strong>TensorFlow version</strong>: tf-nightly 1.5.0-dev20171224</li>\n<li><strong>Python version</strong>: 3.5.4</li>\n</ul>\n<h3>Source code</h3>\n<p>This is a tiny code that creates a model which stacks and unpacks input tensors.</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n<span class=\"pl-k\">from</span> tensorflow.python <span class=\"pl-k\">import</span> keras\n\nx <span class=\"pl-k\">=</span> [keras.layers.Input([<span class=\"pl-c1\">2</span>]) <span class=\"pl-k\">for</span> _ <span class=\"pl-k\">in</span> <span class=\"pl-c1\">range</span>(<span class=\"pl-c1\">3</span>)]\nh <span class=\"pl-k\">=</span> keras.layers.Lambda(<span class=\"pl-k\">lambda</span> <span class=\"pl-smi\">inputs</span>: tf.stack(inputs, <span class=\"pl-v\">axis</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">1</span>))(x)\ny <span class=\"pl-k\">=</span> keras.layers.Lambda(<span class=\"pl-k\">lambda</span> <span class=\"pl-smi\">inputs</span>: tf.unstack(inputs, <span class=\"pl-v\">axis</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">1</span>))(h)\n\nmodel <span class=\"pl-k\">=</span> keras.models.Model(x, y)\nmodel.compile(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>adam<span class=\"pl-pds\">'</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">'</span>mse<span class=\"pl-pds\">'</span></span>)</pre></div>\n<p>This code raises a <code>AssertionError</code>.</p>\n<pre><code>Traceback (most recent call last):\n  File \"example.py\", line 9, in &lt;module&gt;\n    model.compile('adam', 'mse')\n  File \".../tf-nightly/lib/python3.5/site-packages/tensorflow/python/keras/_impl/keras/engine/training.py\", line 681, in compile\n    masks = self.compute_mask(self.inputs, mask=None)\n  File \".../tf-nightly/lib/python3.5/site-packages/tensorflow/python/keras/_impl/keras/engine/topology.py\", line 787, in compute_mask\n    _, output_masks = self._run_internal_graph(inputs, masks)\n  File \".../tf-nightly/lib/python3.5/site-packages/tensorflow/python/layers/network.py\", line 927, in _run_internal_graph\n    assert str(id(x)) in tensor_map, 'Could not compute output ' + str(x)\nAssertionError: Could not compute output Tensor(\"lambda_1/unstack:1\", shape=(?, 2), dtype=float32)\n</code></pre>", "body_text": "System information\n\nHave I written custom code: Yes\nOS Platform and Distribution: Ubuntu 16.04\nTensorFlow installed from: binary\nTensorFlow version: tf-nightly 1.5.0-dev20171224\nPython version: 3.5.4\n\nSource code\nThis is a tiny code that creates a model which stacks and unpacks input tensors.\nimport tensorflow as tf\nfrom tensorflow.python import keras\n\nx = [keras.layers.Input([2]) for _ in range(3)]\nh = keras.layers.Lambda(lambda inputs: tf.stack(inputs, axis=1))(x)\ny = keras.layers.Lambda(lambda inputs: tf.unstack(inputs, axis=1))(h)\n\nmodel = keras.models.Model(x, y)\nmodel.compile('adam', 'mse')\nThis code raises a AssertionError.\nTraceback (most recent call last):\n  File \"example.py\", line 9, in <module>\n    model.compile('adam', 'mse')\n  File \".../tf-nightly/lib/python3.5/site-packages/tensorflow/python/keras/_impl/keras/engine/training.py\", line 681, in compile\n    masks = self.compute_mask(self.inputs, mask=None)\n  File \".../tf-nightly/lib/python3.5/site-packages/tensorflow/python/keras/_impl/keras/engine/topology.py\", line 787, in compute_mask\n    _, output_masks = self._run_internal_graph(inputs, masks)\n  File \".../tf-nightly/lib/python3.5/site-packages/tensorflow/python/layers/network.py\", line 927, in _run_internal_graph\n    assert str(id(x)) in tensor_map, 'Could not compute output ' + str(x)\nAssertionError: Could not compute output Tensor(\"lambda_1/unstack:1\", shape=(?, 2), dtype=float32)", "body": "### System information\r\n- **Have I written custom code**: Yes\r\n- **OS Platform and Distribution**: Ubuntu 16.04\r\n- **TensorFlow installed from**: binary\r\n- **TensorFlow version**: tf-nightly 1.5.0-dev20171224\r\n- **Python version**: 3.5.4\r\n\r\n### Source code\r\n\r\nThis is a tiny code that creates a model which stacks and unpacks input tensors.\r\n\r\n```python\r\nimport tensorflow as tf\r\nfrom tensorflow.python import keras\r\n\r\nx = [keras.layers.Input([2]) for _ in range(3)]\r\nh = keras.layers.Lambda(lambda inputs: tf.stack(inputs, axis=1))(x)\r\ny = keras.layers.Lambda(lambda inputs: tf.unstack(inputs, axis=1))(h)\r\n\r\nmodel = keras.models.Model(x, y)\r\nmodel.compile('adam', 'mse')\r\n```\r\n\r\nThis code raises a `AssertionError`.\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"example.py\", line 9, in <module>\r\n    model.compile('adam', 'mse')\r\n  File \".../tf-nightly/lib/python3.5/site-packages/tensorflow/python/keras/_impl/keras/engine/training.py\", line 681, in compile\r\n    masks = self.compute_mask(self.inputs, mask=None)\r\n  File \".../tf-nightly/lib/python3.5/site-packages/tensorflow/python/keras/_impl/keras/engine/topology.py\", line 787, in compute_mask\r\n    _, output_masks = self._run_internal_graph(inputs, masks)\r\n  File \".../tf-nightly/lib/python3.5/site-packages/tensorflow/python/layers/network.py\", line 927, in _run_internal_graph\r\n    assert str(id(x)) in tensor_map, 'Could not compute output ' + str(x)\r\nAssertionError: Could not compute output Tensor(\"lambda_1/unstack:1\", shape=(?, 2), dtype=float32)\r\n```"}