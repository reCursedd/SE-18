{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/260835376", "html_url": "https://github.com/tensorflow/tensorflow/issues/5611#issuecomment-260835376", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5611", "id": 260835376, "node_id": "MDEyOklzc3VlQ29tbWVudDI2MDgzNTM3Ng==", "user": {"login": "413029811", "id": 7954014, "node_id": "MDQ6VXNlcjc5NTQwMTQ=", "avatar_url": "https://avatars2.githubusercontent.com/u/7954014?v=4", "gravatar_id": "", "url": "https://api.github.com/users/413029811", "html_url": "https://github.com/413029811", "followers_url": "https://api.github.com/users/413029811/followers", "following_url": "https://api.github.com/users/413029811/following{/other_user}", "gists_url": "https://api.github.com/users/413029811/gists{/gist_id}", "starred_url": "https://api.github.com/users/413029811/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/413029811/subscriptions", "organizations_url": "https://api.github.com/users/413029811/orgs", "repos_url": "https://api.github.com/users/413029811/repos", "events_url": "https://api.github.com/users/413029811/events{/privacy}", "received_events_url": "https://api.github.com/users/413029811/received_events", "type": "User", "site_admin": false}, "created_at": "2016-11-16T02:25:58Z", "updated_at": "2016-11-16T02:25:58Z", "author_association": "NONE", "body_html": "<p>I added -fembed-bitcode in Makefile like this:<br>\nifeq ($(IOS_ARCH),ARMV7)<br>\n-fembed-bitcode<br>\nCXXFLAGS += -miphoneos-version-min=$(MIN_SDK_VERSION) <br>\n-arch armv7 <br>\n-D__thread= <br>\n-DUSE_GEMM_FOR_CONV <br>\n-Wno-c++11-narrowing <br>\n-mno-thumb <br>\n-DTF_LEAN_BINARY <br>\n-D__ANDROID_TYPES_SLIM__ <br>\n-fno-exceptions <br>\n-isysroot <br>\n${IPHONEOS_SYSROOT}<br>\nLDFLAGS := -arch armv7 <br>\n-miphoneos-version-min=${MIN_SDK_VERSION} <br>\n-framework Accelerate <br>\n-Xlinker -S <br>\n-Xlinker -x <br>\n-Xlinker -dead_strip <br>\n-all_load <br>\n-L$(GENDIR)protobuf_ios/lib <br>\n-lz<br>\nendif<br>\nifeq ($(IOS_ARCH),ARMV7S)<br>\n-fembed-bitcode<br>\nCXXFLAGS += -miphoneos-version-min=$(MIN_SDK_VERSION) <br>\n-arch armv7s <br>\n-D__thread= <br>\n-DUSE_GEMM_FOR_CONV <br>\n-Wno-c++11-narrowing <br>\n-mno-thumb <br>\n-DTF_LEAN_BINARY <br>\n-D__ANDROID_TYPES_SLIM__ <br>\n-fno-exceptions <br>\n-isysroot <br>\n${IPHONEOS_SYSROOT}<br>\nLDFLAGS := -arch armv7s <br>\n-miphoneos-version-min=${MIN_SDK_VERSION} <br>\n-framework Accelerate <br>\n-Xlinker -S <br>\n-Xlinker -x <br>\n-Xlinker -dead_strip <br>\n-all_load <br>\n-L$(GENDIR)protobuf_ios/lib <br>\n-lz<br>\nendif<br>\nifeq ($(IOS_ARCH),ARM64)<br>\n-fembed-bitcode<br>\nCXXFLAGS += -miphoneos-version-min=$(MIN_SDK_VERSION) <br>\n-arch arm64 <br>\n-D__thread= <br>\n-DUSE_GEMM_FOR_CONV <br>\n-Wno-c++11-narrowing <br>\n-DTF_LEAN_BINARY <br>\n-D__ANDROID_TYPES_SLIM__ <br>\n-fno-exceptions <br>\n-isysroot <br>\n${IPHONEOS_SYSROOT}<br>\nLDFLAGS := -arch arm64 <br>\n-miphoneos-version-min=${MIN_SDK_VERSION} <br>\n-framework Accelerate <br>\n-Xlinker -S <br>\n-Xlinker -x <br>\n-Xlinker -dead_strip <br>\n-all_load <br>\n-L$(GENDIR)protobuf_ios/lib <br>\n-lz<br>\nendif<br>\nifeq ($(IOS_ARCH),I386)<br>\n-fembed-bitcode<br>\nCXXFLAGS += -mios-simulator-version-min=$(MIN_SDK_VERSION) <br>\n-arch i386 <br>\n-D__thread= <br>\n-DUSE_GEMM_FOR_CONV <br>\n-Wno-c++11-narrowing <br>\n-DTF_LEAN_BINARY <br>\n-D__ANDROID_TYPES_SLIM__ <br>\n-fno-exceptions <br>\n-isysroot <br>\n${IPHONESIMULATOR_SYSROOT}<br>\nLDFLAGS := -arch i386 <br>\n-mios-simulator-version-min=${MIN_SDK_VERSION} <br>\n-framework Accelerate <br>\n-Xlinker -S <br>\n-Xlinker -x <br>\n-Xlinker -dead_strip <br>\n-all_load <br>\n-L$(GENDIR)protobuf_ios/lib <br>\n-lz<br>\nendif<br>\nifeq ($(IOS_ARCH),X86_64)<br>\n-fembed-bitcode<br>\nCXXFLAGS += -mios-simulator-version-min=$(MIN_SDK_VERSION) <br>\n-arch x86_64 <br>\n-D__thread= <br>\n-DUSE_GEMM_FOR_CONV <br>\n-Wno-c++11-narrowing <br>\n-DTF_LEAN_BINARY <br>\n-D__ANDROID_TYPES_SLIM__ <br>\n-fno-exceptions <br>\n-isysroot <br>\n${IPHONESIMULATOR_SYSROOT}<br>\nLDFLAGS := -arch x86_64 <br>\n-mios-simulator-version-min=${MIN_SDK_VERSION} <br>\n-framework Accelerate <br>\n-Xlinker -S <br>\n-Xlinker -x <br>\n-Xlinker -dead_strip <br>\n-all_load <br>\n-L$(GENDIR)protobuf_ios/lib <br>\n-lz<br>\nendif</p>\n<p>When I tried to run compile_ios_tensorflow.sh, command line printed:<br>\n/tensorflow/tensorflow/contrib/makefile/gen/lib/ios_ARMV7/libtensorflow-core-armv7.a(version_info.o), archive member 'version_info.o' with length 936 is not mach-o or llvm bitcode for architecture armv7<br>\nclang: error: linker command failed with exit code 1 (use -v to see invocation)<br>\nmake: *** [tensorflow/tensorflow/contrib/makefile/gen/bin/ios_ARMV7/benchmark] Error 1</p>\n<ul>\n<li>'[' 2 -ne 0 ']'</li>\n<li>echo 'armv7 compilation failed.'<br>\narmv7 compilation failed.</li>\n<li>exit 1</li>\n</ul>", "body_text": "I added -fembed-bitcode in Makefile like this:\nifeq ($(IOS_ARCH),ARMV7)\n-fembed-bitcode\nCXXFLAGS += -miphoneos-version-min=$(MIN_SDK_VERSION) \n-arch armv7 \n-D__thread= \n-DUSE_GEMM_FOR_CONV \n-Wno-c++11-narrowing \n-mno-thumb \n-DTF_LEAN_BINARY \n-D__ANDROID_TYPES_SLIM__ \n-fno-exceptions \n-isysroot \n${IPHONEOS_SYSROOT}\nLDFLAGS := -arch armv7 \n-miphoneos-version-min=${MIN_SDK_VERSION} \n-framework Accelerate \n-Xlinker -S \n-Xlinker -x \n-Xlinker -dead_strip \n-all_load \n-L$(GENDIR)protobuf_ios/lib \n-lz\nendif\nifeq ($(IOS_ARCH),ARMV7S)\n-fembed-bitcode\nCXXFLAGS += -miphoneos-version-min=$(MIN_SDK_VERSION) \n-arch armv7s \n-D__thread= \n-DUSE_GEMM_FOR_CONV \n-Wno-c++11-narrowing \n-mno-thumb \n-DTF_LEAN_BINARY \n-D__ANDROID_TYPES_SLIM__ \n-fno-exceptions \n-isysroot \n${IPHONEOS_SYSROOT}\nLDFLAGS := -arch armv7s \n-miphoneos-version-min=${MIN_SDK_VERSION} \n-framework Accelerate \n-Xlinker -S \n-Xlinker -x \n-Xlinker -dead_strip \n-all_load \n-L$(GENDIR)protobuf_ios/lib \n-lz\nendif\nifeq ($(IOS_ARCH),ARM64)\n-fembed-bitcode\nCXXFLAGS += -miphoneos-version-min=$(MIN_SDK_VERSION) \n-arch arm64 \n-D__thread= \n-DUSE_GEMM_FOR_CONV \n-Wno-c++11-narrowing \n-DTF_LEAN_BINARY \n-D__ANDROID_TYPES_SLIM__ \n-fno-exceptions \n-isysroot \n${IPHONEOS_SYSROOT}\nLDFLAGS := -arch arm64 \n-miphoneos-version-min=${MIN_SDK_VERSION} \n-framework Accelerate \n-Xlinker -S \n-Xlinker -x \n-Xlinker -dead_strip \n-all_load \n-L$(GENDIR)protobuf_ios/lib \n-lz\nendif\nifeq ($(IOS_ARCH),I386)\n-fembed-bitcode\nCXXFLAGS += -mios-simulator-version-min=$(MIN_SDK_VERSION) \n-arch i386 \n-D__thread= \n-DUSE_GEMM_FOR_CONV \n-Wno-c++11-narrowing \n-DTF_LEAN_BINARY \n-D__ANDROID_TYPES_SLIM__ \n-fno-exceptions \n-isysroot \n${IPHONESIMULATOR_SYSROOT}\nLDFLAGS := -arch i386 \n-mios-simulator-version-min=${MIN_SDK_VERSION} \n-framework Accelerate \n-Xlinker -S \n-Xlinker -x \n-Xlinker -dead_strip \n-all_load \n-L$(GENDIR)protobuf_ios/lib \n-lz\nendif\nifeq ($(IOS_ARCH),X86_64)\n-fembed-bitcode\nCXXFLAGS += -mios-simulator-version-min=$(MIN_SDK_VERSION) \n-arch x86_64 \n-D__thread= \n-DUSE_GEMM_FOR_CONV \n-Wno-c++11-narrowing \n-DTF_LEAN_BINARY \n-D__ANDROID_TYPES_SLIM__ \n-fno-exceptions \n-isysroot \n${IPHONESIMULATOR_SYSROOT}\nLDFLAGS := -arch x86_64 \n-mios-simulator-version-min=${MIN_SDK_VERSION} \n-framework Accelerate \n-Xlinker -S \n-Xlinker -x \n-Xlinker -dead_strip \n-all_load \n-L$(GENDIR)protobuf_ios/lib \n-lz\nendif\nWhen I tried to run compile_ios_tensorflow.sh, command line printed:\n/tensorflow/tensorflow/contrib/makefile/gen/lib/ios_ARMV7/libtensorflow-core-armv7.a(version_info.o), archive member 'version_info.o' with length 936 is not mach-o or llvm bitcode for architecture armv7\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\nmake: *** [tensorflow/tensorflow/contrib/makefile/gen/bin/ios_ARMV7/benchmark] Error 1\n\n'[' 2 -ne 0 ']'\necho 'armv7 compilation failed.'\narmv7 compilation failed.\nexit 1", "body": "I added -fembed-bitcode in Makefile like this:\n       ifeq ($(IOS_ARCH),ARMV7)\n        -fembed-bitcode\\\n        CXXFLAGS += -miphoneos-version-min=$(MIN_SDK_VERSION) \\\n        -arch armv7 \\\n        -D__thread= \\\n        -DUSE_GEMM_FOR_CONV \\\n        -Wno-c++11-narrowing \\\n        -mno-thumb \\\n        -DTF_LEAN_BINARY \\\n        -D__ANDROID_TYPES_SLIM__ \\\n        -fno-exceptions \\\n        -isysroot \\\n        ${IPHONEOS_SYSROOT}\n        LDFLAGS := -arch armv7 \\\n        -miphoneos-version-min=${MIN_SDK_VERSION} \\\n        -framework Accelerate \\\n        -Xlinker -S \\\n        -Xlinker -x \\\n        -Xlinker -dead_strip \\\n        -all_load \\\n        -L$(GENDIR)protobuf_ios/lib \\\n        -lz\n    endif\n    ifeq ($(IOS_ARCH),ARMV7S)\n        -fembed-bitcode\\\n        CXXFLAGS += -miphoneos-version-min=$(MIN_SDK_VERSION) \\\n        -arch armv7s \\\n        -D__thread= \\\n        -DUSE_GEMM_FOR_CONV \\\n        -Wno-c++11-narrowing \\\n        -mno-thumb \\\n        -DTF_LEAN_BINARY \\\n        -D__ANDROID_TYPES_SLIM__ \\\n        -fno-exceptions \\\n        -isysroot \\\n        ${IPHONEOS_SYSROOT}\n        LDFLAGS := -arch armv7s \\\n        -miphoneos-version-min=${MIN_SDK_VERSION} \\\n        -framework Accelerate \\\n        -Xlinker -S \\\n        -Xlinker -x \\\n        -Xlinker -dead_strip \\\n        -all_load \\\n        -L$(GENDIR)protobuf_ios/lib \\\n        -lz\n    endif\n    ifeq ($(IOS_ARCH),ARM64)\n        -fembed-bitcode\\\n        CXXFLAGS += -miphoneos-version-min=$(MIN_SDK_VERSION) \\\n        -arch arm64 \\\n        -D__thread= \\\n        -DUSE_GEMM_FOR_CONV \\\n        -Wno-c++11-narrowing \\\n        -DTF_LEAN_BINARY \\\n        -D__ANDROID_TYPES_SLIM__ \\\n        -fno-exceptions \\\n        -isysroot \\\n        ${IPHONEOS_SYSROOT}\n        LDFLAGS := -arch arm64 \\\n        -miphoneos-version-min=${MIN_SDK_VERSION} \\\n        -framework Accelerate \\\n        -Xlinker -S \\\n        -Xlinker -x \\\n        -Xlinker -dead_strip \\\n        -all_load \\\n        -L$(GENDIR)protobuf_ios/lib \\\n        -lz\n    endif\n    ifeq ($(IOS_ARCH),I386)\n        -fembed-bitcode\\\n        CXXFLAGS += -mios-simulator-version-min=$(MIN_SDK_VERSION) \\\n        -arch i386 \\\n        -D__thread= \\\n        -DUSE_GEMM_FOR_CONV \\\n        -Wno-c++11-narrowing \\\n        -DTF_LEAN_BINARY \\\n        -D__ANDROID_TYPES_SLIM__ \\\n        -fno-exceptions \\\n        -isysroot \\\n        ${IPHONESIMULATOR_SYSROOT}\n        LDFLAGS := -arch i386 \\\n        -mios-simulator-version-min=${MIN_SDK_VERSION} \\\n        -framework Accelerate \\\n        -Xlinker -S \\\n        -Xlinker -x \\\n        -Xlinker -dead_strip \\\n        -all_load \\\n        -L$(GENDIR)protobuf_ios/lib \\\n        -lz\n    endif\n    ifeq ($(IOS_ARCH),X86_64)\n        -fembed-bitcode\\\n        CXXFLAGS += -mios-simulator-version-min=$(MIN_SDK_VERSION) \\\n        -arch x86_64 \\\n        -D__thread= \\\n        -DUSE_GEMM_FOR_CONV \\\n        -Wno-c++11-narrowing \\\n        -DTF_LEAN_BINARY \\\n        -D__ANDROID_TYPES_SLIM__ \\\n        -fno-exceptions \\\n        -isysroot \\\n        ${IPHONESIMULATOR_SYSROOT}\n        LDFLAGS := -arch x86_64 \\\n        -mios-simulator-version-min=${MIN_SDK_VERSION} \\\n        -framework Accelerate \\\n        -Xlinker -S \\\n        -Xlinker -x \\\n        -Xlinker -dead_strip \\\n        -all_load \\\n        -L$(GENDIR)protobuf_ios/lib \\\n        -lz\n    endif\n\nWhen I tried to run compile_ios_tensorflow.sh, command line printed:\n/tensorflow/tensorflow/contrib/makefile/gen/lib/ios_ARMV7/libtensorflow-core-armv7.a(version_info.o), archive member 'version_info.o' with length 936 is not mach-o or llvm bitcode for architecture armv7\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\nmake: **\\* [tensorflow/tensorflow/contrib/makefile/gen/bin/ios_ARMV7/benchmark] Error 1\n- '[' 2 -ne 0 ']'\n- echo 'armv7 compilation failed.'\n  armv7 compilation failed.\n- exit 1\n"}