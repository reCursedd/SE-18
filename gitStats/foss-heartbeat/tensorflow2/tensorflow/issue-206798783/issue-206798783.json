{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7414", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7414/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7414/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7414/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/7414", "id": 206798783, "node_id": "MDU6SXNzdWUyMDY3OTg3ODM=", "number": 7414, "title": "extract_image_patches gradient only works with float32", "user": {"login": "markvdw", "id": 4289538, "node_id": "MDQ6VXNlcjQyODk1Mzg=", "avatar_url": "https://avatars3.githubusercontent.com/u/4289538?v=4", "gravatar_id": "", "url": "https://api.github.com/users/markvdw", "html_url": "https://github.com/markvdw", "followers_url": "https://api.github.com/users/markvdw/followers", "following_url": "https://api.github.com/users/markvdw/following{/other_user}", "gists_url": "https://api.github.com/users/markvdw/gists{/gist_id}", "starred_url": "https://api.github.com/users/markvdw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/markvdw/subscriptions", "organizations_url": "https://api.github.com/users/markvdw/orgs", "repos_url": "https://api.github.com/users/markvdw/repos", "events_url": "https://api.github.com/users/markvdw/events{/privacy}", "received_events_url": "https://api.github.com/users/markvdw/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-02-10T13:41:55Z", "updated_at": "2017-03-03T23:42:48Z", "closed_at": "2017-03-03T23:42:48Z", "author_association": "NONE", "body_html": "<p><code>tf.extract_image_patches()</code> works well with <code>tf.float64</code>, however its gradient requires that <code>tf.float32</code>s are passed. Otherwise <code>tf.gradients()</code> raises:<br>\n<code>TypeError: Input 'b' of 'SparseTensorDenseMatMul' Op has type float64 that does not match type float32 of argument 'a_values'.</code>.</p>\n<p>Here is an example of the offending code. If I take the gradient with respect to <code>X</code> without casting, I get the error above.</p>\n<pre><code>castX = tf.cast(X, tf.float32, name=\"castX\")  # This is needed to get it working\npatches = tf.extract_image_patches(tf.reshape(castX, [-1, self.img_size[0], self.img_size[1], 1], name=\"rX\"),\n                                   [1, self.patch_size[0], self.patch_size[1], 1],\n                                   [1, 1, 1, 1],\n                                   [1, 1, 1, 1], \"VALID\")\nshp = tf.shape(patches)\nreturn tf.cast(tf.reshape(patches, [shp[0], shp[1] * shp[2], shp[3]]), float_type)\n</code></pre>", "body_text": "tf.extract_image_patches() works well with tf.float64, however its gradient requires that tf.float32s are passed. Otherwise tf.gradients() raises:\nTypeError: Input 'b' of 'SparseTensorDenseMatMul' Op has type float64 that does not match type float32 of argument 'a_values'..\nHere is an example of the offending code. If I take the gradient with respect to X without casting, I get the error above.\ncastX = tf.cast(X, tf.float32, name=\"castX\")  # This is needed to get it working\npatches = tf.extract_image_patches(tf.reshape(castX, [-1, self.img_size[0], self.img_size[1], 1], name=\"rX\"),\n                                   [1, self.patch_size[0], self.patch_size[1], 1],\n                                   [1, 1, 1, 1],\n                                   [1, 1, 1, 1], \"VALID\")\nshp = tf.shape(patches)\nreturn tf.cast(tf.reshape(patches, [shp[0], shp[1] * shp[2], shp[3]]), float_type)", "body": "`tf.extract_image_patches()` works well with `tf.float64`, however its gradient requires that `tf.float32`s are passed. Otherwise `tf.gradients()` raises:\r\n`TypeError: Input 'b' of 'SparseTensorDenseMatMul' Op has type float64 that does not match type float32 of argument 'a_values'.`.\r\n\r\nHere is an example of the offending code. If I take the gradient with respect to `X` without casting, I get the error above.\r\n```\r\ncastX = tf.cast(X, tf.float32, name=\"castX\")  # This is needed to get it working\r\npatches = tf.extract_image_patches(tf.reshape(castX, [-1, self.img_size[0], self.img_size[1], 1], name=\"rX\"),\r\n                                   [1, self.patch_size[0], self.patch_size[1], 1],\r\n                                   [1, 1, 1, 1],\r\n                                   [1, 1, 1, 1], \"VALID\")\r\nshp = tf.shape(patches)\r\nreturn tf.cast(tf.reshape(patches, [shp[0], shp[1] * shp[2], shp[3]]), float_type)\r\n```"}