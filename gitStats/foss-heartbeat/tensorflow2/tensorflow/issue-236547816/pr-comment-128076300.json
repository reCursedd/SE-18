{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/128076300", "pull_request_review_id": 50722141, "id": 128076300, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyODA3NjMwMA==", "diff_hunk": "@@ -455,78 +444,41 @@ private void setStyle(final ImageSlider slider, final float value) {\n     }\n   }\n \n-  @Override\n-  public void onImageAvailable(final ImageReader reader) {\n-    Image image = null;\n-\n-    try {\n-      image = reader.acquireLatestImage();\n-\n-      if (image == null) {\n-        return;\n-      }\n-\n-      if (computing) {\n-        image.close();\n-        return;\n-      }\n-\n-      if (desiredSize != initializedSize) {\n-        LOGGER.i(\n-            \"Initializing at size preview size %dx%d, stylize size %d\",\n-            previewWidth, previewHeight, desiredSize);\n-        rgbBytes = new int[previewWidth * previewHeight];\n-        rgbFrameBitmap = Bitmap.createBitmap(previewWidth, previewHeight, Config.ARGB_8888);\n-        croppedBitmap = Bitmap.createBitmap(desiredSize, desiredSize, Config.ARGB_8888);\n-\n-        frameToCropTransform =\n-            ImageUtils.getTransformationMatrix(\n-                previewWidth, previewHeight,\n-                desiredSize, desiredSize,\n-                sensorOrientation, true);\n-\n-        cropToFrameTransform = new Matrix();\n-        frameToCropTransform.invert(cropToFrameTransform);\n-\n-        yuvBytes = new byte[3][];\n-\n-        intValues = new int[desiredSize * desiredSize];\n-        floatValues = new float[desiredSize * desiredSize * 3];\n-        initializedSize = desiredSize;\n-      }\n-\n-      computing = true;\n+  private void resetPreviewBuffers() {\n+    croppedBitmap = Bitmap.createBitmap(desiredSize, desiredSize, Config.ARGB_8888);\n \n-      Trace.beginSection(\"imageAvailable\");\n+    frameToCropTransform = ImageUtils.getTransformationMatrix(\n+        previewWidth, previewHeight,\n+        desiredSize, desiredSize,\n+        sensorOrientation, true);\n \n-      final Plane[] planes = image.getPlanes();\n-      fillBytes(planes, yuvBytes);\n-\n-      final int yRowStride = planes[0].getRowStride();\n-      final int uvRowStride = planes[1].getRowStride();\n-      final int uvPixelStride = planes[1].getPixelStride();\n-\n-      ImageUtils.convertYUV420ToARGB8888(\n-          yuvBytes[0],\n-          yuvBytes[1],\n-          yuvBytes[2],\n-          previewWidth,\n-          previewHeight,\n-          yRowStride,\n-          uvRowStride,\n-          uvPixelStride,\n-          rgbBytes);\n+    cropToFrameTransform = new Matrix();\n+    frameToCropTransform.invert(cropToFrameTransform);\n+    yuvBytes = new byte[3][];\n+    intValues = new int[desiredSize * desiredSize];\n+    floatValues = new float[desiredSize * desiredSize * 3];\n+    initializedSize = desiredSize;\n+  }\n \n-      image.close();\n-    } catch (final Exception e) {\n-      if (image != null) {\n-        image.close();\n-      }\n-      LOGGER.e(e, \"Exception!\");\n-      Trace.endSection();\n-      return;\n+  protected void processImageRGBbytes(int[] rgbBytes ) {\n+    if (desiredSize != initializedSize) {\n+      LOGGER.i(", "path": "tensorflow/examples/android/src/org/tensorflow/demo/StylizeActivity.java", "position": 155, "original_position": 155, "commit_id": "f27bd3caaa379e998160cb43f2693e358d7c34ed", "original_commit_id": "731c6f57a4a56f510d3f19ca0246b0efd9dda34c", "user": {"login": "andrewharp", "id": 3376817, "node_id": "MDQ6VXNlcjMzNzY4MTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/3376817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewharp", "html_url": "https://github.com/andrewharp", "followers_url": "https://api.github.com/users/andrewharp/followers", "following_url": "https://api.github.com/users/andrewharp/following{/other_user}", "gists_url": "https://api.github.com/users/andrewharp/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewharp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewharp/subscriptions", "organizations_url": "https://api.github.com/users/andrewharp/orgs", "repos_url": "https://api.github.com/users/andrewharp/repos", "events_url": "https://api.github.com/users/andrewharp/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewharp/received_events", "type": "User", "site_admin": false}, "body": "Not sure I understand github's behavior here -- is this method actually removed? Why does it still show up here when viewing \"all commits\", but not when I try to edit/view the file by itself?\r\n\r\n@osdamv The log message should be indented 4 spaces here.\r\n\r\n@drpngx If I can see all the cumulative commits together in the \"files changed\" view, do you know why I can't directly edit the latest version of it in the branch here? \"View\" and \"edit\" show me a different file than the side-by-side view.\r\n", "created_at": "2017-07-18T19:45:56Z", "updated_at": "2017-07-19T19:16:13Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/10771#discussion_r128076300", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/10771", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/128076300"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/10771#discussion_r128076300"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/10771"}}, "body_html": "<p>Not sure I understand github's behavior here -- is this method actually removed? Why does it still show up here when viewing \"all commits\", but not when I try to edit/view the file by itself?</p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4120796\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/osdamv\">@osdamv</a> The log message should be indented 4 spaces here.</p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=20959853\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/drpngx\">@drpngx</a> If I can see all the cumulative commits together in the \"files changed\" view, do you know why I can't directly edit the latest version of it in the branch here? \"View\" and \"edit\" show me a different file than the side-by-side view.</p>", "body_text": "Not sure I understand github's behavior here -- is this method actually removed? Why does it still show up here when viewing \"all commits\", but not when I try to edit/view the file by itself?\n@osdamv The log message should be indented 4 spaces here.\n@drpngx If I can see all the cumulative commits together in the \"files changed\" view, do you know why I can't directly edit the latest version of it in the branch here? \"View\" and \"edit\" show me a different file than the side-by-side view."}