{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8227", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8227/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8227/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8227/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/8227", "id": 212916412, "node_id": "MDU6SXNzdWUyMTI5MTY0MTI=", "number": 8227, "title": "[feature] Smarter Handling of Image Data Format", "user": {"login": "cancan101", "id": 51059, "node_id": "MDQ6VXNlcjUxMDU5", "avatar_url": "https://avatars1.githubusercontent.com/u/51059?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cancan101", "html_url": "https://github.com/cancan101", "followers_url": "https://api.github.com/users/cancan101/followers", "following_url": "https://api.github.com/users/cancan101/following{/other_user}", "gists_url": "https://api.github.com/users/cancan101/gists{/gist_id}", "starred_url": "https://api.github.com/users/cancan101/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cancan101/subscriptions", "organizations_url": "https://api.github.com/users/cancan101/orgs", "repos_url": "https://api.github.com/users/cancan101/repos", "events_url": "https://api.github.com/users/cancan101/events{/privacy}", "received_events_url": "https://api.github.com/users/cancan101/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}, {"id": 473173272, "node_id": "MDU6TGFiZWw0NzMxNzMyNzI=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:feature", "name": "type:feature", "color": "159b2e", "default": false}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2017-03-09T02:19:59Z", "updated_at": "2017-09-19T07:09:36Z", "closed_at": null, "author_association": "CONTRIBUTOR", "body_html": "<p>Right now the responsibility of choosing image data format (i.e. the representation of batches of image) is that of the data scientist (ie model writer). I suggest there should a solution in TF to move this to the optimizer (XLA perhaps?) or worst cast Op writer.</p>\n<p>For some background:</p>\n<p>Currently Tensorflow supports <code>NCHW</code> and <code>NHWC</code> (though other formats like <a href=\"https://github.com/soumith/convnet-benchmarks/issues/66#issuecomment-155944875\" data-hovercard-type=\"issue\" data-hovercard-url=\"/soumith/convnet-benchmarks/issues/66/hovercard\">CHWN</a> might be possible down the road). Many of the Ops support both formats. That being said, the docs say:</p>\n<blockquote>\n<p>The best practice is to build models that work with both NCHW and NHWC as it is common to train using NCHW on GPU, and then do inference with NHWC on CPU.</p>\n</blockquote>\n<p>This requires the user to have to do some \"wrangling\" (e.g. loading the checkpoint of weights and re-buidling graph in Python) to map from one image format to another. Further this must be done with some knowledge of the platform on which the graph will be executed (ie which ops are defined, and if both, which is faster)?</p>\n<p>Right now model builder must <a href=\"https://github.com/tensorflow/tensorflow/issues/8137\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/8137/hovercard\">build the model to take in channel order and pass that around</a>. Ideally the model could be written once with enough meta information attached to the graph to allow optimizers after the fact (ie at inference time on other platforms) to choose the best representation. Further even at training time, it would be great if the data scientist didn't need to be concerned with image data format (ie dimension ordering) and could use abstractions for accessing results that took care of data access.</p>\n<p>I don't have a clear proposal of how to clean this up, but this seems like a potential pain point, or a the very least results in people leaving performance on the table both when training and at inference.</p>\n<p><strong>TL; DR</strong> Many data scientists just want to write CNNs without thinking about tensor layouts.</p>", "body_text": "Right now the responsibility of choosing image data format (i.e. the representation of batches of image) is that of the data scientist (ie model writer). I suggest there should a solution in TF to move this to the optimizer (XLA perhaps?) or worst cast Op writer.\nFor some background:\nCurrently Tensorflow supports NCHW and NHWC (though other formats like CHWN might be possible down the road). Many of the Ops support both formats. That being said, the docs say:\n\nThe best practice is to build models that work with both NCHW and NHWC as it is common to train using NCHW on GPU, and then do inference with NHWC on CPU.\n\nThis requires the user to have to do some \"wrangling\" (e.g. loading the checkpoint of weights and re-buidling graph in Python) to map from one image format to another. Further this must be done with some knowledge of the platform on which the graph will be executed (ie which ops are defined, and if both, which is faster)?\nRight now model builder must build the model to take in channel order and pass that around. Ideally the model could be written once with enough meta information attached to the graph to allow optimizers after the fact (ie at inference time on other platforms) to choose the best representation. Further even at training time, it would be great if the data scientist didn't need to be concerned with image data format (ie dimension ordering) and could use abstractions for accessing results that took care of data access.\nI don't have a clear proposal of how to clean this up, but this seems like a potential pain point, or a the very least results in people leaving performance on the table both when training and at inference.\nTL; DR Many data scientists just want to write CNNs without thinking about tensor layouts.", "body": "Right now the responsibility of choosing image data format (i.e. the representation of batches of image) is that of the data scientist (ie model writer). I suggest there should a solution in TF to move this to the optimizer (XLA perhaps?) or worst cast Op writer.\r\n\r\nFor some background:\r\n\r\nCurrently Tensorflow supports `NCHW` and `NHWC` (though other formats like [CHWN](https://github.com/soumith/convnet-benchmarks/issues/66#issuecomment-155944875) might be possible down the road). Many of the Ops support both formats. That being said, the docs say:\r\n>The best practice is to build models that work with both NCHW and NHWC as it is common to train using NCHW on GPU, and then do inference with NHWC on CPU.\r\n\r\nThis requires the user to have to do some \"wrangling\" (e.g. loading the checkpoint of weights and re-buidling graph in Python) to map from one image format to another. Further this must be done with some knowledge of the platform on which the graph will be executed (ie which ops are defined, and if both, which is faster)?\r\n\r\nRight now model builder must [build the model to take in channel order and pass that around](https://github.com/tensorflow/tensorflow/issues/8137). Ideally the model could be written once with enough meta information attached to the graph to allow optimizers after the fact (ie at inference time on other platforms) to choose the best representation. Further even at training time, it would be great if the data scientist didn't need to be concerned with image data format (ie dimension ordering) and could use abstractions for accessing results that took care of data access.\r\n\r\nI don't have a clear proposal of how to clean this up, but this seems like a potential pain point, or a the very least results in people leaving performance on the table both when training and at inference. \r\n\r\n**TL; DR** Many data scientists just want to write CNNs without thinking about tensor layouts."}