{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23299", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23299/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23299/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23299/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23299", "id": 374443261, "node_id": "MDU6SXNzdWUzNzQ0NDMyNjE=", "number": 23299, "title": "`tf.keras.layers.Bidirectional` does not work under eager execution mode", "user": {"login": "huan", "id": 1361891, "node_id": "MDQ6VXNlcjEzNjE4OTE=", "avatar_url": "https://avatars3.githubusercontent.com/u/1361891?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huan", "html_url": "https://github.com/huan", "followers_url": "https://api.github.com/users/huan/followers", "following_url": "https://api.github.com/users/huan/following{/other_user}", "gists_url": "https://api.github.com/users/huan/gists{/gist_id}", "starred_url": "https://api.github.com/users/huan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huan/subscriptions", "organizations_url": "https://api.github.com/users/huan/orgs", "repos_url": "https://api.github.com/users/huan/repos", "events_url": "https://api.github.com/users/huan/events{/privacy}", "received_events_url": "https://api.github.com/users/huan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 736653459, "node_id": "MDU6TGFiZWw3MzY2NTM0NTk=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:eager", "name": "comp:eager", "color": "0052cc", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "alextp", "id": 5061, "node_id": "MDQ6VXNlcjUwNjE=", "avatar_url": "https://avatars0.githubusercontent.com/u/5061?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alextp", "html_url": "https://github.com/alextp", "followers_url": "https://api.github.com/users/alextp/followers", "following_url": "https://api.github.com/users/alextp/following{/other_user}", "gists_url": "https://api.github.com/users/alextp/gists{/gist_id}", "starred_url": "https://api.github.com/users/alextp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alextp/subscriptions", "organizations_url": "https://api.github.com/users/alextp/orgs", "repos_url": "https://api.github.com/users/alextp/repos", "events_url": "https://api.github.com/users/alextp/events{/privacy}", "received_events_url": "https://api.github.com/users/alextp/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "alextp", "id": 5061, "node_id": "MDQ6VXNlcjUwNjE=", "avatar_url": "https://avatars0.githubusercontent.com/u/5061?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alextp", "html_url": "https://github.com/alextp", "followers_url": "https://api.github.com/users/alextp/followers", "following_url": "https://api.github.com/users/alextp/following{/other_user}", "gists_url": "https://api.github.com/users/alextp/gists{/gist_id}", "starred_url": "https://api.github.com/users/alextp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alextp/subscriptions", "organizations_url": "https://api.github.com/users/alextp/orgs", "repos_url": "https://api.github.com/users/alextp/repos", "events_url": "https://api.github.com/users/alextp/events{/privacy}", "received_events_url": "https://api.github.com/users/alextp/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2018-10-26T15:49:37Z", "updated_at": "2018-11-21T01:38:47Z", "closed_at": "2018-11-20T17:19:44Z", "author_association": "NONE", "body_html": "<p><strong>System information</strong></p>\n<ul>\n<li>Have I written custom code (as opposed to using a stock example script provided in TensorFlow): NO</li>\n<li>OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Mac OS X 10.12.6</li>\n<li>Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: NO</li>\n<li>TensorFlow installed from (source or binary): BINARY</li>\n<li>TensorFlow version (use command below): v1.12.0-rc0-17-g7b08198113 1.12.0-rc1</li>\n<li>Python version: 3.6.5</li>\n<li>Bazel version (if compiling from source): NA</li>\n<li>GCC/Compiler version (if compiling from source): NA</li>\n<li>CUDA/cuDNN version: NA</li>\n<li>GPU model and memory: NA</li>\n</ul>\n<p><strong>Describe the current behavior</strong></p>\n<p>A very simple model with <code>Bidirectional</code> layer will stop work after we enable the eager execution mode.</p>\n<p><strong>Describe the expected behavior</strong></p>\n<p>Code should work with eager execution mode.</p>\n<p><strong>Code to reproduce the issue</strong></p>\n<p>The following code will be able to reprorduce this problem:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n<span class=\"pl-k\">import</span> numpy <span class=\"pl-k\">as</span> np\n\ntf.enable_eager_execution()\n\nx <span class=\"pl-k\">=</span> tf.keras.layers.Input(<span class=\"pl-v\">shape</span><span class=\"pl-k\">=</span>(<span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">1</span>))\ny <span class=\"pl-k\">=</span> tf.keras.layers.Bidirectional(\n    tf.keras.layers.LSTM(<span class=\"pl-c1\">1</span>, <span class=\"pl-v\">return_state</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>)\n)(x)\n\nmodel <span class=\"pl-k\">=</span> tf.keras.Model(<span class=\"pl-v\">inputs</span><span class=\"pl-k\">=</span>x, <span class=\"pl-v\">outputs</span><span class=\"pl-k\">=</span>y)\n\ndata <span class=\"pl-k\">=</span> np.array([<span class=\"pl-c1\">0.1</span>, <span class=\"pl-c1\">0.2</span>]).reshape((<span class=\"pl-c1\">1</span>, <span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">1</span>))\n<span class=\"pl-c1\">print</span>(model.predict(data))</pre></div>\n<p>However, if we comment out the <code>tf.enable_eager_execution()</code>, then it will work as expected:</p>\n<p><strong>Other info / logs</strong></p>\n<p>The error message(with eager execution enabled) is:</p>\n<pre><code>Traceback (most recent call last):\n  File \"src/t.py\", line 11, in &lt;module&gt;\n    )(x)\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/layers/wrappers.py\", line 473, in __call__\n    return super(Bidirectional, self).__call__(inputs, **kwargs)\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/engine/base_layer.py\", line 769, in __call__\n    output_shapes = self.compute_output_shape(input_shapes)\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/utils/tf_utils.py\", line 149, in wrapper\n    output_shape = fn(instance, input_shape)\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/layers/wrappers.py\", line 444, in compute_output_shape\n    input_shape).as_list())\nAttributeError: 'list' object has no attribute 'as_list'\n</code></pre>\n<p>After we disable the eager execution, then the above code works as expected.</p>\n<pre><code>[array([[0.01535364, 0.04371894]], dtype=float32), array([[0.01535364]], dtype=float32), array([[0.03121366]], dtype=float32), array([[0.04371894]], dtype=float32), array([[0.09061633]], dtype=float32)]\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): NO\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Mac OS X 10.12.6\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: NO\nTensorFlow installed from (source or binary): BINARY\nTensorFlow version (use command below): v1.12.0-rc0-17-g7b08198113 1.12.0-rc1\nPython version: 3.6.5\nBazel version (if compiling from source): NA\nGCC/Compiler version (if compiling from source): NA\nCUDA/cuDNN version: NA\nGPU model and memory: NA\n\nDescribe the current behavior\nA very simple model with Bidirectional layer will stop work after we enable the eager execution mode.\nDescribe the expected behavior\nCode should work with eager execution mode.\nCode to reproduce the issue\nThe following code will be able to reprorduce this problem:\nimport tensorflow as tf\nimport numpy as np\n\ntf.enable_eager_execution()\n\nx = tf.keras.layers.Input(shape=(2, 1))\ny = tf.keras.layers.Bidirectional(\n    tf.keras.layers.LSTM(1, return_state=True)\n)(x)\n\nmodel = tf.keras.Model(inputs=x, outputs=y)\n\ndata = np.array([0.1, 0.2]).reshape((1, -1, 1))\nprint(model.predict(data))\nHowever, if we comment out the tf.enable_eager_execution(), then it will work as expected:\nOther info / logs\nThe error message(with eager execution enabled) is:\nTraceback (most recent call last):\n  File \"src/t.py\", line 11, in <module>\n    )(x)\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/layers/wrappers.py\", line 473, in __call__\n    return super(Bidirectional, self).__call__(inputs, **kwargs)\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/engine/base_layer.py\", line 769, in __call__\n    output_shapes = self.compute_output_shape(input_shapes)\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/utils/tf_utils.py\", line 149, in wrapper\n    output_shape = fn(instance, input_shape)\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/layers/wrappers.py\", line 444, in compute_output_shape\n    input_shape).as_list())\nAttributeError: 'list' object has no attribute 'as_list'\n\nAfter we disable the eager execution, then the above code works as expected.\n[array([[0.01535364, 0.04371894]], dtype=float32), array([[0.01535364]], dtype=float32), array([[0.03121366]], dtype=float32), array([[0.04371894]], dtype=float32), array([[0.09061633]], dtype=float32)]", "body": "**System information**\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow): NO\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Mac OS X 10.12.6\r\n- Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: NO\r\n- TensorFlow installed from (source or binary): BINARY\r\n- TensorFlow version (use command below): v1.12.0-rc0-17-g7b08198113 1.12.0-rc1\r\n- Python version: 3.6.5\r\n- Bazel version (if compiling from source): NA\r\n- GCC/Compiler version (if compiling from source): NA\r\n- CUDA/cuDNN version: NA\r\n- GPU model and memory: NA\r\n\r\n**Describe the current behavior**\r\n\r\nA very simple model with `Bidirectional` layer will stop work after we enable the eager execution mode.\r\n\r\n**Describe the expected behavior**\r\n\r\nCode should work with eager execution mode.\r\n\r\n**Code to reproduce the issue**\r\n\r\nThe following code will be able to reprorduce this problem:\r\n\r\n```py\r\nimport tensorflow as tf\r\nimport numpy as np\r\n\r\ntf.enable_eager_execution()\r\n\r\nx = tf.keras.layers.Input(shape=(2, 1))\r\ny = tf.keras.layers.Bidirectional(\r\n    tf.keras.layers.LSTM(1, return_state=True)\r\n)(x)\r\n\r\nmodel = tf.keras.Model(inputs=x, outputs=y)\r\n\r\ndata = np.array([0.1, 0.2]).reshape((1, -1, 1))\r\nprint(model.predict(data))\r\n```\r\nHowever, if we comment out the `tf.enable_eager_execution()`, then it will work as expected:\r\n\r\n**Other info / logs**\r\n\r\nThe error message(with eager execution enabled) is:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"src/t.py\", line 11, in <module>\r\n    )(x)\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/layers/wrappers.py\", line 473, in __call__\r\n    return super(Bidirectional, self).__call__(inputs, **kwargs)\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/engine/base_layer.py\", line 769, in __call__\r\n    output_shapes = self.compute_output_shape(input_shapes)\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/utils/tf_utils.py\", line 149, in wrapper\r\n    output_shape = fn(instance, input_shape)\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/layers/wrappers.py\", line 444, in compute_output_shape\r\n    input_shape).as_list())\r\nAttributeError: 'list' object has no attribute 'as_list'\r\n```\r\n\r\nAfter we disable the eager execution, then the above code works as expected.\r\n\r\n```\r\n[array([[0.01535364, 0.04371894]], dtype=float32), array([[0.01535364]], dtype=float32), array([[0.03121366]], dtype=float32), array([[0.04371894]], dtype=float32), array([[0.09061633]], dtype=float32)]\r\n```"}