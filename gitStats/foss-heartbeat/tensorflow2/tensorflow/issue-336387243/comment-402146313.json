{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/402146313", "html_url": "https://github.com/tensorflow/tensorflow/issues/20361#issuecomment-402146313", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20361", "id": 402146313, "node_id": "MDEyOklzc3VlQ29tbWVudDQwMjE0NjMxMw==", "user": {"login": "npanpaliya", "id": 14196089, "node_id": "MDQ6VXNlcjE0MTk2MDg5", "avatar_url": "https://avatars3.githubusercontent.com/u/14196089?v=4", "gravatar_id": "", "url": "https://api.github.com/users/npanpaliya", "html_url": "https://github.com/npanpaliya", "followers_url": "https://api.github.com/users/npanpaliya/followers", "following_url": "https://api.github.com/users/npanpaliya/following{/other_user}", "gists_url": "https://api.github.com/users/npanpaliya/gists{/gist_id}", "starred_url": "https://api.github.com/users/npanpaliya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/npanpaliya/subscriptions", "organizations_url": "https://api.github.com/users/npanpaliya/orgs", "repos_url": "https://api.github.com/users/npanpaliya/repos", "events_url": "https://api.github.com/users/npanpaliya/events{/privacy}", "received_events_url": "https://api.github.com/users/npanpaliya/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-03T12:53:49Z", "updated_at": "2018-07-03T12:58:20Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Further debugging this on both x86 and ppc64le, I found some weirdness on x86 and ppc64le behaving appropriately -<br>\nBelow is the code snippet from optimized_ops.h which is executed when testcase \"ResizeBilinearOpTest.TwoDimensionalResizeWithTwoBatches8Bit\" is run.</p>\n<pre><code>template &lt;typename T&gt;\ninline void ResizeBilinearGenericSmallChannel(\n    const T* input_data, const Dims&lt;4&gt;&amp; input_dims, T* output_data,\n    const Dims&lt;4&gt;&amp; output_dims, int32 batches, int32 input_height,\n    int32 input_width, int32 depth, int32 output_height, int32 output_width,\n    float height_scale, float width_scale) {\n          for (int32 d = 0; d &lt; depth; d++) {\n          const T* input_ptr = &amp;input_data[d];\n          float fOutput = input_ptr[input_offset[0]] * scale[0] +\n                                         input_ptr[input_offset[1]] * scale[1] +\n                                         input_ptr[input_offset[2]] * scale[2] +\n                                         input_ptr[input_offset[3]] * scale[3];\n          *output_ptr = static_cast&lt;T&gt;(fOutput);\n          LOG(INFO) &lt;&lt; \"Uint8 Output:  \" &lt;&lt; +*output_ptr;\n          LOG(INFO) &lt;&lt; \"Float Output:  \" &lt;&lt; fOutput;\n          output_ptr++;          \n        }\n    }\n</code></pre>\n<p>For the mentioned  testcase, the above for loop runs for 18 times. For the 17th item, I get different values for uint8 and float on x86. Below are the logs I printed for the mentioned test case -</p>\n<p>On ppc64le -</p>\n<pre><code>2018-07-03 12:32:46.008931: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  3\n2018-07-03 12:32:46.008937: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  3\n2018-07-03 12:32:46.008942: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  5\n2018-07-03 12:32:46.008948: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  5\n2018-07-03 12:32:46.008953: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  6\n2018-07-03 12:32:46.008959: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  6\n2018-07-03 12:32:46.008964: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  7\n2018-07-03 12:32:46.008969: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  7\n2018-07-03 12:32:46.008974: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  9\n2018-07-03 12:32:46.008980: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  9\n2018-07-03 12:32:46.008985: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  10\n2018-07-03 12:32:46.008992: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  10\n2018-07-03 12:32:46.008997: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  9\n2018-07-03 12:32:46.009003: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  9\n2018-07-03 12:32:46.009008: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  11\n2018-07-03 12:32:46.009013: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  11\n2018-07-03 12:32:46.009019: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  12\n2018-07-03 12:32:46.009024: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  12\n2018-07-03 12:32:46.009029: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  4\n2018-07-03 12:32:46.009035: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  4\n2018-07-03 12:32:46.009040: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  8\n2018-07-03 12:32:46.009046: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  8\n2018-07-03 12:32:46.009051: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  10\n2018-07-03 12:32:46.009057: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  10\n2018-07-03 12:32:46.009062: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  8\n2018-07-03 12:32:46.009067: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  8\n2018-07-03 12:32:46.009072: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  12\n2018-07-03 12:32:46.009078: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  12\n2018-07-03 12:32:46.009083: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  14\n2018-07-03 12:32:46.009089: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  14\n2018-07-03 12:32:46.009096: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  10\n2018-07-03 12:32:46.009101: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  10\n2018-07-03 12:32:46.009106: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  14\n2018-07-03 12:32:46.009112: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  14\n2018-07-03 12:32:46.009117: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  16\n2018-07-03 12:32:46.009123: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  16\n</code></pre>\n<p>On x86 -</p>\n<pre><code>2018-07-03 12:32:33.869341: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  3\n2018-07-03 12:32:33.869435: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  3\n2018-07-03 12:32:33.869449: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  5\n2018-07-03 12:32:33.869458: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  5\n2018-07-03 12:32:33.869468: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  6\n2018-07-03 12:32:33.869476: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  6\n2018-07-03 12:32:33.869484: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  7\n2018-07-03 12:32:33.869492: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  7\n2018-07-03 12:32:33.869501: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  9\n2018-07-03 12:32:33.869509: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  9\n2018-07-03 12:32:33.869518: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  10\n2018-07-03 12:32:33.869527: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  10\n2018-07-03 12:32:33.869536: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  9\n2018-07-03 12:32:33.869544: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  9\n2018-07-03 12:32:33.869553: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  11\n2018-07-03 12:32:33.869561: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  11\n2018-07-03 12:32:33.869569: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  12\n2018-07-03 12:32:33.869578: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  12\n2018-07-03 12:32:33.869587: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  4\n2018-07-03 12:32:33.869595: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  4\n2018-07-03 12:32:33.869603: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  8\n2018-07-03 12:32:33.869611: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  8\n2018-07-03 12:32:33.869620: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  10\n2018-07-03 12:32:33.869628: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  10\n2018-07-03 12:32:33.869637: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  8\n2018-07-03 12:32:33.869645: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  8\n2018-07-03 12:32:33.869653: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  12\n2018-07-03 12:32:33.869661: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  12\n2018-07-03 12:32:33.869670: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  14\n2018-07-03 12:32:33.869678: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  14\n2018-07-03 12:32:33.869687: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  10\n2018-07-03 12:32:33.869695: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  10\n2018-07-03 12:32:33.869713: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  13\n2018-07-03 12:32:33.869723: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  14\n2018-07-03 12:32:33.869732: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  16\n2018-07-03 12:32:33.869740: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  16\n</code></pre>\n<p>And the test case's expected output is designed as per uint8 value which is 13 at the index 17. However, the same test case with same inputs is also written for float datatype and it has 14 at the 17th index in the expected output.<br>\nLooks like either it is some casting issue on x86 or I'm missing something here. Could anyone please help me?</p>", "body_text": "Further debugging this on both x86 and ppc64le, I found some weirdness on x86 and ppc64le behaving appropriately -\nBelow is the code snippet from optimized_ops.h which is executed when testcase \"ResizeBilinearOpTest.TwoDimensionalResizeWithTwoBatches8Bit\" is run.\ntemplate <typename T>\ninline void ResizeBilinearGenericSmallChannel(\n    const T* input_data, const Dims<4>& input_dims, T* output_data,\n    const Dims<4>& output_dims, int32 batches, int32 input_height,\n    int32 input_width, int32 depth, int32 output_height, int32 output_width,\n    float height_scale, float width_scale) {\n          for (int32 d = 0; d < depth; d++) {\n          const T* input_ptr = &input_data[d];\n          float fOutput = input_ptr[input_offset[0]] * scale[0] +\n                                         input_ptr[input_offset[1]] * scale[1] +\n                                         input_ptr[input_offset[2]] * scale[2] +\n                                         input_ptr[input_offset[3]] * scale[3];\n          *output_ptr = static_cast<T>(fOutput);\n          LOG(INFO) << \"Uint8 Output:  \" << +*output_ptr;\n          LOG(INFO) << \"Float Output:  \" << fOutput;\n          output_ptr++;          \n        }\n    }\n\nFor the mentioned  testcase, the above for loop runs for 18 times. For the 17th item, I get different values for uint8 and float on x86. Below are the logs I printed for the mentioned test case -\nOn ppc64le -\n2018-07-03 12:32:46.008931: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  3\n2018-07-03 12:32:46.008937: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  3\n2018-07-03 12:32:46.008942: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  5\n2018-07-03 12:32:46.008948: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  5\n2018-07-03 12:32:46.008953: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  6\n2018-07-03 12:32:46.008959: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  6\n2018-07-03 12:32:46.008964: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  7\n2018-07-03 12:32:46.008969: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  7\n2018-07-03 12:32:46.008974: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  9\n2018-07-03 12:32:46.008980: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  9\n2018-07-03 12:32:46.008985: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  10\n2018-07-03 12:32:46.008992: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  10\n2018-07-03 12:32:46.008997: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  9\n2018-07-03 12:32:46.009003: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  9\n2018-07-03 12:32:46.009008: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  11\n2018-07-03 12:32:46.009013: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  11\n2018-07-03 12:32:46.009019: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  12\n2018-07-03 12:32:46.009024: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  12\n2018-07-03 12:32:46.009029: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  4\n2018-07-03 12:32:46.009035: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  4\n2018-07-03 12:32:46.009040: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  8\n2018-07-03 12:32:46.009046: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  8\n2018-07-03 12:32:46.009051: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  10\n2018-07-03 12:32:46.009057: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  10\n2018-07-03 12:32:46.009062: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  8\n2018-07-03 12:32:46.009067: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  8\n2018-07-03 12:32:46.009072: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  12\n2018-07-03 12:32:46.009078: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  12\n2018-07-03 12:32:46.009083: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  14\n2018-07-03 12:32:46.009089: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  14\n2018-07-03 12:32:46.009096: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  10\n2018-07-03 12:32:46.009101: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  10\n2018-07-03 12:32:46.009106: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  14\n2018-07-03 12:32:46.009112: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  14\n2018-07-03 12:32:46.009117: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  16\n2018-07-03 12:32:46.009123: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  16\n\nOn x86 -\n2018-07-03 12:32:33.869341: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  3\n2018-07-03 12:32:33.869435: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  3\n2018-07-03 12:32:33.869449: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  5\n2018-07-03 12:32:33.869458: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  5\n2018-07-03 12:32:33.869468: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  6\n2018-07-03 12:32:33.869476: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  6\n2018-07-03 12:32:33.869484: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  7\n2018-07-03 12:32:33.869492: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  7\n2018-07-03 12:32:33.869501: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  9\n2018-07-03 12:32:33.869509: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  9\n2018-07-03 12:32:33.869518: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  10\n2018-07-03 12:32:33.869527: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  10\n2018-07-03 12:32:33.869536: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  9\n2018-07-03 12:32:33.869544: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  9\n2018-07-03 12:32:33.869553: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  11\n2018-07-03 12:32:33.869561: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  11\n2018-07-03 12:32:33.869569: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  12\n2018-07-03 12:32:33.869578: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  12\n2018-07-03 12:32:33.869587: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  4\n2018-07-03 12:32:33.869595: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  4\n2018-07-03 12:32:33.869603: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  8\n2018-07-03 12:32:33.869611: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  8\n2018-07-03 12:32:33.869620: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  10\n2018-07-03 12:32:33.869628: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  10\n2018-07-03 12:32:33.869637: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  8\n2018-07-03 12:32:33.869645: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  8\n2018-07-03 12:32:33.869653: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  12\n2018-07-03 12:32:33.869661: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  12\n2018-07-03 12:32:33.869670: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  14\n2018-07-03 12:32:33.869678: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  14\n2018-07-03 12:32:33.869687: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  10\n2018-07-03 12:32:33.869695: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  10\n2018-07-03 12:32:33.869713: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  13\n2018-07-03 12:32:33.869723: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  14\n2018-07-03 12:32:33.869732: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  16\n2018-07-03 12:32:33.869740: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  16\n\nAnd the test case's expected output is designed as per uint8 value which is 13 at the index 17. However, the same test case with same inputs is also written for float datatype and it has 14 at the 17th index in the expected output.\nLooks like either it is some casting issue on x86 or I'm missing something here. Could anyone please help me?", "body": "Further debugging this on both x86 and ppc64le, I found some weirdness on x86 and ppc64le behaving appropriately -\r\nBelow is the code snippet from optimized_ops.h which is executed when testcase \"ResizeBilinearOpTest.TwoDimensionalResizeWithTwoBatches8Bit\" is run.\r\n\r\n```\r\ntemplate <typename T>\r\ninline void ResizeBilinearGenericSmallChannel(\r\n    const T* input_data, const Dims<4>& input_dims, T* output_data,\r\n    const Dims<4>& output_dims, int32 batches, int32 input_height,\r\n    int32 input_width, int32 depth, int32 output_height, int32 output_width,\r\n    float height_scale, float width_scale) {\r\n          for (int32 d = 0; d < depth; d++) {\r\n          const T* input_ptr = &input_data[d];\r\n          float fOutput = input_ptr[input_offset[0]] * scale[0] +\r\n                                         input_ptr[input_offset[1]] * scale[1] +\r\n                                         input_ptr[input_offset[2]] * scale[2] +\r\n                                         input_ptr[input_offset[3]] * scale[3];\r\n          *output_ptr = static_cast<T>(fOutput);\r\n          LOG(INFO) << \"Uint8 Output:  \" << +*output_ptr;\r\n          LOG(INFO) << \"Float Output:  \" << fOutput;\r\n          output_ptr++;          \r\n        }\r\n    }\r\n```\r\n\r\nFor the mentioned  testcase, the above for loop runs for 18 times. For the 17th item, I get different values for uint8 and float on x86. Below are the logs I printed for the mentioned test case -\r\n\r\nOn ppc64le -\r\n```\r\n2018-07-03 12:32:46.008931: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  3\r\n2018-07-03 12:32:46.008937: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  3\r\n2018-07-03 12:32:46.008942: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  5\r\n2018-07-03 12:32:46.008948: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  5\r\n2018-07-03 12:32:46.008953: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  6\r\n2018-07-03 12:32:46.008959: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  6\r\n2018-07-03 12:32:46.008964: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  7\r\n2018-07-03 12:32:46.008969: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  7\r\n2018-07-03 12:32:46.008974: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  9\r\n2018-07-03 12:32:46.008980: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  9\r\n2018-07-03 12:32:46.008985: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  10\r\n2018-07-03 12:32:46.008992: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  10\r\n2018-07-03 12:32:46.008997: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  9\r\n2018-07-03 12:32:46.009003: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  9\r\n2018-07-03 12:32:46.009008: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  11\r\n2018-07-03 12:32:46.009013: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  11\r\n2018-07-03 12:32:46.009019: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  12\r\n2018-07-03 12:32:46.009024: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  12\r\n2018-07-03 12:32:46.009029: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  4\r\n2018-07-03 12:32:46.009035: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  4\r\n2018-07-03 12:32:46.009040: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  8\r\n2018-07-03 12:32:46.009046: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  8\r\n2018-07-03 12:32:46.009051: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  10\r\n2018-07-03 12:32:46.009057: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  10\r\n2018-07-03 12:32:46.009062: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  8\r\n2018-07-03 12:32:46.009067: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  8\r\n2018-07-03 12:32:46.009072: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  12\r\n2018-07-03 12:32:46.009078: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  12\r\n2018-07-03 12:32:46.009083: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  14\r\n2018-07-03 12:32:46.009089: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  14\r\n2018-07-03 12:32:46.009096: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  10\r\n2018-07-03 12:32:46.009101: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  10\r\n2018-07-03 12:32:46.009106: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  14\r\n2018-07-03 12:32:46.009112: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  14\r\n2018-07-03 12:32:46.009117: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5522] Uint8 Output:  16\r\n2018-07-03 12:32:46.009123: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5524] Float Output:  16\r\n```\r\n\r\n\r\nOn x86 -\r\n```\r\n2018-07-03 12:32:33.869341: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  3\r\n2018-07-03 12:32:33.869435: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  3\r\n2018-07-03 12:32:33.869449: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  5\r\n2018-07-03 12:32:33.869458: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  5\r\n2018-07-03 12:32:33.869468: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  6\r\n2018-07-03 12:32:33.869476: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  6\r\n2018-07-03 12:32:33.869484: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  7\r\n2018-07-03 12:32:33.869492: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  7\r\n2018-07-03 12:32:33.869501: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  9\r\n2018-07-03 12:32:33.869509: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  9\r\n2018-07-03 12:32:33.869518: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  10\r\n2018-07-03 12:32:33.869527: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  10\r\n2018-07-03 12:32:33.869536: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  9\r\n2018-07-03 12:32:33.869544: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  9\r\n2018-07-03 12:32:33.869553: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  11\r\n2018-07-03 12:32:33.869561: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  11\r\n2018-07-03 12:32:33.869569: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  12\r\n2018-07-03 12:32:33.869578: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  12\r\n2018-07-03 12:32:33.869587: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  4\r\n2018-07-03 12:32:33.869595: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  4\r\n2018-07-03 12:32:33.869603: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  8\r\n2018-07-03 12:32:33.869611: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  8\r\n2018-07-03 12:32:33.869620: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  10\r\n2018-07-03 12:32:33.869628: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  10\r\n2018-07-03 12:32:33.869637: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  8\r\n2018-07-03 12:32:33.869645: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  8\r\n2018-07-03 12:32:33.869653: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  12\r\n2018-07-03 12:32:33.869661: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  12\r\n2018-07-03 12:32:33.869670: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  14\r\n2018-07-03 12:32:33.869678: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  14\r\n2018-07-03 12:32:33.869687: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  10\r\n2018-07-03 12:32:33.869695: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  10\r\n2018-07-03 12:32:33.869713: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  13\r\n2018-07-03 12:32:33.869723: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  14\r\n2018-07-03 12:32:33.869732: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5519] Uint8 Output:  16\r\n2018-07-03 12:32:33.869740: I ./tensorflow/contrib/lite/kernels/internal/optimized/optimized_ops.h:5521] Float Output:  16\r\n```\r\n\r\nAnd the test case's expected output is designed as per uint8 value which is 13 at the index 17. However, the same test case with same inputs is also written for float datatype and it has 14 at the 17th index in the expected output. \r\nLooks like either it is some casting issue on x86 or I'm missing something here. Could anyone please help me?"}