{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13381", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13381/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13381/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13381/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/13381", "id": 261684176, "node_id": "MDU6SXNzdWUyNjE2ODQxNzY=", "number": 13381, "title": "tf.train.Saver setting `max_to_keep` parameter to 0 or None unintended behavior", "user": {"login": "nrhine1", "id": 372326, "node_id": "MDQ6VXNlcjM3MjMyNg==", "avatar_url": "https://avatars2.githubusercontent.com/u/372326?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrhine1", "html_url": "https://github.com/nrhine1", "followers_url": "https://api.github.com/users/nrhine1/followers", "following_url": "https://api.github.com/users/nrhine1/following{/other_user}", "gists_url": "https://api.github.com/users/nrhine1/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrhine1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrhine1/subscriptions", "organizations_url": "https://api.github.com/users/nrhine1/orgs", "repos_url": "https://api.github.com/users/nrhine1/repos", "events_url": "https://api.github.com/users/nrhine1/events{/privacy}", "received_events_url": "https://api.github.com/users/nrhine1/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-09-29T15:44:39Z", "updated_at": "2018-06-15T05:37:17Z", "closed_at": "2017-10-08T23:58:05Z", "author_association": "NONE", "body_html": "<p>As the <a href=\"https://www.tensorflow.org/api_docs/python/tf/train/Saver\" rel=\"nofollow\">tf.train.Saver</a> documentation says:</p>\n<p>\"<code>max_to_keep</code> indicates the maximum number of recent checkpoint files to keep. As new files are created, older files are deleted. If None or 0, all checkpoint files are kept. Defaults to 5 (that is, the 5 most recent checkpoint files are kept.)\"</p>\n<p>However, when I use <code>max_to_keep=0</code>, the <code>checkpoint</code> file attribute <code>all_model_checkpoint_paths</code> only records the most recent checkpoint file (and I'm unable to load older checkpoint files). I believe this is due to the block:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">if</span> <span class=\"pl-c1\">len</span>(<span class=\"pl-c1\">self</span>._last_checkpoints) <span class=\"pl-k\">&gt;</span> <span class=\"pl-c1\">self</span>.saver_def.max_to_keep:\n    <span class=\"pl-c1\">self</span>._checkpoints_to_be_deleted.append(<span class=\"pl-c1\">self</span>._last_checkpoints.pop(<span class=\"pl-c1\">0</span>))</pre></div>\n<p>It should probably instead read something like:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">if</span> <span class=\"pl-c1\">len</span>(<span class=\"pl-c1\">self</span>._last_checkpoints) <span class=\"pl-k\">&gt;</span> <span class=\"pl-c1\">self</span>.saver_def.max_to_keep <span class=\"pl-k\">&gt;</span> <span class=\"pl-c1\">0</span>:\n    <span class=\"pl-c1\">self</span>._checkpoints_to_be_deleted.append(<span class=\"pl-c1\">self</span>._last_checkpoints.pop(<span class=\"pl-c1\">0</span>))</pre></div>", "body_text": "As the tf.train.Saver documentation says:\n\"max_to_keep indicates the maximum number of recent checkpoint files to keep. As new files are created, older files are deleted. If None or 0, all checkpoint files are kept. Defaults to 5 (that is, the 5 most recent checkpoint files are kept.)\"\nHowever, when I use max_to_keep=0, the checkpoint file attribute all_model_checkpoint_paths only records the most recent checkpoint file (and I'm unable to load older checkpoint files). I believe this is due to the block:\nif len(self._last_checkpoints) > self.saver_def.max_to_keep:\n    self._checkpoints_to_be_deleted.append(self._last_checkpoints.pop(0))\nIt should probably instead read something like:\nif len(self._last_checkpoints) > self.saver_def.max_to_keep > 0:\n    self._checkpoints_to_be_deleted.append(self._last_checkpoints.pop(0))", "body": "As the [tf.train.Saver](https://www.tensorflow.org/api_docs/python/tf/train/Saver) documentation says:\r\n\r\n\"`max_to_keep` indicates the maximum number of recent checkpoint files to keep. As new files are created, older files are deleted. If None or 0, all checkpoint files are kept. Defaults to 5 (that is, the 5 most recent checkpoint files are kept.)\"\r\n\r\nHowever, when I use `max_to_keep=0`, the `checkpoint` file attribute `all_model_checkpoint_paths` only records the most recent checkpoint file (and I'm unable to load older checkpoint files). I believe this is due to the block:\r\n\r\n```python\r\nif len(self._last_checkpoints) > self.saver_def.max_to_keep:\r\n    self._checkpoints_to_be_deleted.append(self._last_checkpoints.pop(0))\r\n```\r\n\r\nIt should probably instead read something like:\r\n\r\n```python\r\nif len(self._last_checkpoints) > self.saver_def.max_to_keep > 0:\r\n    self._checkpoints_to_be_deleted.append(self._last_checkpoints.pop(0))\r\n```"}