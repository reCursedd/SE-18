{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/87929713", "pull_request_review_id": 8520366, "id": 87929713, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg3OTI5NzEz", "diff_hunk": "@@ -25,84 +25,62 @@\n class DecodeImageOpTest(tf.test.TestCase):\n \n   def testGif(self):\n-    # GIF encoded 2x2 image\n-    image_bytes = (b'GIF89a\\x02\\x00\\x02\\x00\\xf1\\x01\\x00\\x00\\x00\\x00\\xff\\xff\\xff'\n-                   b'\\xff\\xff\\xff\\x00\\x00\\x00!\\xf9\\x04\\x00\\x00\\x00\\x00\\x00,\\x00'\n-                   b'\\x00\\x00\\x00\\x02\\x00\\x02\\x00\\x00\\x02\\x03D4\\x05\\x00;')\n-    expected_values = np.array([[[[  0,   0,   0], [255, 255, 255]],\n-                                [[255, 255, 255], [0, 0, 0]]]], \n-                                dtype=np.uint8)\n-    decode = tf.image.decode_image(image_bytes)\n-    with self.test_session():\n-      decoded_pixels = decode.eval()\n-      self.assertAllEqual(decoded_pixels, expected_values)\n+    # Read some real GIFs\n+    prefix = 'tensorflow/core/lib/gif/testdata/'\n+    filename = 'scan.gif'\n+    WIDTH = 20\n+    HEIGHT = 40\n+    STRIDE = 5\n+    shape = (12, HEIGHT, WIDTH, 3)\n+\n+    with self.test_session(use_gpu=True) as sess:\n+      gif0 = tf.read_file(prefix + filename)\n+      image0 = tf.image.decode_image(gif0)\n+      image1 = tf.image.decode_gif(gif0)\n+      gif0, image0, image1 = sess.run([gif0, image0, image1])\n+\n+      self.assertEqual(image0.shape, shape)\n+      self.assertAllEqual(image0, image1)\n+\n+      for frame_idx, frame in enumerate(image0):\n+        gt = np.zeros(shape[1:], dtype=np.uint8)\n+        start = frame_idx * STRIDE\n+        end = (frame_idx + 1) * STRIDE\n+        if end <= WIDTH:\n+          gt[:, start:end, :] = 255\n+        else:\n+          start -= WIDTH\n+          end -= WIDTH\n+          gt[start:end, :, :] = 255", "path": "tensorflow/python/kernel_tests/decode_image_op_test.py", "position": 55, "original_position": 41, "commit_id": "30a964bda83860f7398189669c3cd44afed1c0d8", "original_commit_id": "0879d37555f509410c24e5ef383be19931942ca2", "user": {"login": "samjabrahams", "id": 11607205, "node_id": "MDQ6VXNlcjExNjA3MjA1", "avatar_url": "https://avatars0.githubusercontent.com/u/11607205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/samjabrahams", "html_url": "https://github.com/samjabrahams", "followers_url": "https://api.github.com/users/samjabrahams/followers", "following_url": "https://api.github.com/users/samjabrahams/following{/other_user}", "gists_url": "https://api.github.com/users/samjabrahams/gists{/gist_id}", "starred_url": "https://api.github.com/users/samjabrahams/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/samjabrahams/subscriptions", "organizations_url": "https://api.github.com/users/samjabrahams/orgs", "repos_url": "https://api.github.com/users/samjabrahams/repos", "events_url": "https://api.github.com/users/samjabrahams/events{/privacy}", "received_events_url": "https://api.github.com/users/samjabrahams/received_events", "type": "User", "site_admin": false}, "body": "I grabbed this from the GIF tests in python/ops/image_ops_test.py. The [test image](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/lib/gif/testdata/scan.gif) is a multi-framed image of a white bar travelling across a black background. It looks like this test starts with an all-black (zeros) array and then fills in the appropriate pixels with white (255) depending on which frame it is and then checks to make sure that the read pixels match.\n\nI can comment an explanation in or remove this check if you want.\n", "created_at": "2016-11-15T01:08:01Z", "updated_at": "2016-11-30T21:00:32Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/4222#discussion_r87929713", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/4222", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/87929713"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/4222#discussion_r87929713"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/4222"}}, "body_html": "<p>I grabbed this from the GIF tests in python/ops/image_ops_test.py. The <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/lib/gif/testdata/scan.gif\">test image</a> is a multi-framed image of a white bar travelling across a black background. It looks like this test starts with an all-black (zeros) array and then fills in the appropriate pixels with white (255) depending on which frame it is and then checks to make sure that the read pixels match.</p>\n<p>I can comment an explanation in or remove this check if you want.</p>", "body_text": "I grabbed this from the GIF tests in python/ops/image_ops_test.py. The test image is a multi-framed image of a white bar travelling across a black background. It looks like this test starts with an all-black (zeros) array and then fills in the appropriate pixels with white (255) depending on which frame it is and then checks to make sure that the read pixels match.\nI can comment an explanation in or remove this check if you want.", "in_reply_to_id": 87928136}