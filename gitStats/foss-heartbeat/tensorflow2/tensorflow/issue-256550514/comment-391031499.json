{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/391031499", "html_url": "https://github.com/tensorflow/tensorflow/issues/12951#issuecomment-391031499", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12951", "id": 391031499, "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTAzMTQ5OQ==", "user": {"login": "ravi9", "id": 4837253, "node_id": "MDQ6VXNlcjQ4MzcyNTM=", "avatar_url": "https://avatars3.githubusercontent.com/u/4837253?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ravi9", "html_url": "https://github.com/ravi9", "followers_url": "https://api.github.com/users/ravi9/followers", "following_url": "https://api.github.com/users/ravi9/following{/other_user}", "gists_url": "https://api.github.com/users/ravi9/gists{/gist_id}", "starred_url": "https://api.github.com/users/ravi9/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ravi9/subscriptions", "organizations_url": "https://api.github.com/users/ravi9/orgs", "repos_url": "https://api.github.com/users/ravi9/repos", "events_url": "https://api.github.com/users/ravi9/events{/privacy}", "received_events_url": "https://api.github.com/users/ravi9/received_events", "type": "User", "site_admin": false}, "created_at": "2018-05-22T15:20:56Z", "updated_at": "2018-05-22T16:09:15Z", "author_association": "NONE", "body_html": "<p>Updated instructions with latest TF, If there is still an issue like below</p>\n<pre><code>...libmklml_intel.so: error: undefined reference to 'dlopen'\n...libmklml_intel.so: error: undefined reference to 'dlerror'\n...libmklml_intel.so: error: undefined reference to 'dlsym'\n...libmklml_intel.so: error: undefined reference to 'dladdr'\ncollect2: error: ld returned 1 exit status\n</code></pre>\n<p>The linker is unable to find <code>libdl.so</code>. For a work around, you need a private copy of MKL with the missing library included in. Follow the steps below.</p>\n<ol>\n<li>Download the version of MKL used by the version of Tensorflow you are compiling, you can get the URL from the file <code>tensorflow/workspace.bzl</code>, search for <code>mkl_repository</code>.</li>\n</ol>\n<pre><code>wget https://github.com/intel/mkl-dnn/releases/download/v0.14/mklml_lnx_2018.0.3.20180406.tgz\ntar -xf mklml_lnx_2018.0.3.20180406.tgz\n</code></pre>\n<ol start=\"2\">\n<li>Find the shared library libdl.so on your system ( it is usually in /usr/lib/) and copy over to the lib folder of the copy of MKL that you downloaded.</li>\n</ol>\n<pre><code>#If you donot have locate, install locate tool and update the database for mlocate\nyum install -y mlocate\nupdatedb\n\n#Find the location of libdl.so\nlocate libdl.so\n# output would look like below\n# /usr/lib64/libdl.so\n# /usr/lib64/libdl.so.2\n\n#Usually libdl.so is a sym link, find the actual file.\nll /usr/lib64/libdl.so.2 \n#lrwxrwxrwx. 1 root root 10 Apr  7 11:38 /usr/lib64/libdl.so.2 -&gt; libdl-2.17.so\n\n#Copy the libdl-2.17.so file to the downloaded MKL lib folder as libdl.so\ncp /usr/lib64/libdl-2.17.so &lt;path_to_mklml_lnx_2018.0.3.20180406&gt;/lib/libdl.so \n</code></pre>\n<ol start=\"3\">\n<li>Set the environment variable TF_MKL_ROOT to point to the copy of MKL from step above.</li>\n</ol>\n<pre><code>export TF_MKL_ROOT=&lt;path_to_mklml_lnx_2018.0.3.20180406&gt;/\n</code></pre>\n<ol start=\"4\">\n<li>Modify the file <code>tensorflow/third_party/mkl/BUILD</code> to add the line <code>linkopts = [\"-ldl\",],</code> after the line  <code>name = \"intel_binary_blob\",</code>. It should look like below</li>\n</ol>\n<pre><code>cc_library(\n    name = \"intel_binary_blob\",\n    linkopts = [\"-ldl\",],\n    visibility = [\"//visibility:public\"],\n    deps = select({\n</code></pre>\n<ol start=\"5\">\n<li>Modify the file <code>tensorflow/third_party/mkl/mkl.BUILD</code> to add the line <code>\"lib/libdl.so\"</code>, after the line <code>name = \"mkl_libs_linux\", srcs = [</code>. It should look like below</li>\n</ol>\n<pre><code>cc_library(\n    name = \"mkl_libs_linux\",\n    srcs = [\n        \"lib/libdl.so\",\n        \"lib/libiomp5.so\",\n        \"lib/libmklml_intel.so\",\n    ],\n    visibility = [\"//visibility:public\"],\n)\n</code></pre>\n<ol start=\"6\">\n<li>run configure and build</li>\n</ol>", "body_text": "Updated instructions with latest TF, If there is still an issue like below\n...libmklml_intel.so: error: undefined reference to 'dlopen'\n...libmklml_intel.so: error: undefined reference to 'dlerror'\n...libmklml_intel.so: error: undefined reference to 'dlsym'\n...libmklml_intel.so: error: undefined reference to 'dladdr'\ncollect2: error: ld returned 1 exit status\n\nThe linker is unable to find libdl.so. For a work around, you need a private copy of MKL with the missing library included in. Follow the steps below.\n\nDownload the version of MKL used by the version of Tensorflow you are compiling, you can get the URL from the file tensorflow/workspace.bzl, search for mkl_repository.\n\nwget https://github.com/intel/mkl-dnn/releases/download/v0.14/mklml_lnx_2018.0.3.20180406.tgz\ntar -xf mklml_lnx_2018.0.3.20180406.tgz\n\n\nFind the shared library libdl.so on your system ( it is usually in /usr/lib/) and copy over to the lib folder of the copy of MKL that you downloaded.\n\n#If you donot have locate, install locate tool and update the database for mlocate\nyum install -y mlocate\nupdatedb\n\n#Find the location of libdl.so\nlocate libdl.so\n# output would look like below\n# /usr/lib64/libdl.so\n# /usr/lib64/libdl.so.2\n\n#Usually libdl.so is a sym link, find the actual file.\nll /usr/lib64/libdl.so.2 \n#lrwxrwxrwx. 1 root root 10 Apr  7 11:38 /usr/lib64/libdl.so.2 -> libdl-2.17.so\n\n#Copy the libdl-2.17.so file to the downloaded MKL lib folder as libdl.so\ncp /usr/lib64/libdl-2.17.so <path_to_mklml_lnx_2018.0.3.20180406>/lib/libdl.so \n\n\nSet the environment variable TF_MKL_ROOT to point to the copy of MKL from step above.\n\nexport TF_MKL_ROOT=<path_to_mklml_lnx_2018.0.3.20180406>/\n\n\nModify the file tensorflow/third_party/mkl/BUILD to add the line linkopts = [\"-ldl\",], after the line  name = \"intel_binary_blob\",. It should look like below\n\ncc_library(\n    name = \"intel_binary_blob\",\n    linkopts = [\"-ldl\",],\n    visibility = [\"//visibility:public\"],\n    deps = select({\n\n\nModify the file tensorflow/third_party/mkl/mkl.BUILD to add the line \"lib/libdl.so\", after the line name = \"mkl_libs_linux\", srcs = [. It should look like below\n\ncc_library(\n    name = \"mkl_libs_linux\",\n    srcs = [\n        \"lib/libdl.so\",\n        \"lib/libiomp5.so\",\n        \"lib/libmklml_intel.so\",\n    ],\n    visibility = [\"//visibility:public\"],\n)\n\n\nrun configure and build", "body": "Updated instructions with latest TF, If there is still an issue like below\r\n```\r\n...libmklml_intel.so: error: undefined reference to 'dlopen'\r\n...libmklml_intel.so: error: undefined reference to 'dlerror'\r\n...libmklml_intel.so: error: undefined reference to 'dlsym'\r\n...libmklml_intel.so: error: undefined reference to 'dladdr'\r\ncollect2: error: ld returned 1 exit status\r\n```\r\nThe linker is unable to find `libdl.so`. For a work around, you need a private copy of MKL with the missing library included in. Follow the steps below.\r\n\r\n1. Download the version of MKL used by the version of Tensorflow you are compiling, you can get the URL from the file `tensorflow/workspace.bzl`, search for `mkl_repository`.\r\n\r\n```\r\nwget https://github.com/intel/mkl-dnn/releases/download/v0.14/mklml_lnx_2018.0.3.20180406.tgz\r\ntar -xf mklml_lnx_2018.0.3.20180406.tgz\r\n```\r\n\r\n2. Find the shared library libdl.so on your system ( it is usually in /usr/lib/) and copy over to the lib folder of the copy of MKL that you downloaded.\r\n```\r\n#If you donot have locate, install locate tool and update the database for mlocate\r\nyum install -y mlocate\r\nupdatedb\r\n\r\n#Find the location of libdl.so\r\nlocate libdl.so\r\n# output would look like below\r\n# /usr/lib64/libdl.so\r\n# /usr/lib64/libdl.so.2\r\n\r\n#Usually libdl.so is a sym link, find the actual file.\r\nll /usr/lib64/libdl.so.2 \r\n#lrwxrwxrwx. 1 root root 10 Apr  7 11:38 /usr/lib64/libdl.so.2 -> libdl-2.17.so\r\n\r\n#Copy the libdl-2.17.so file to the downloaded MKL lib folder as libdl.so\r\ncp /usr/lib64/libdl-2.17.so <path_to_mklml_lnx_2018.0.3.20180406>/lib/libdl.so \r\n```\r\n3. Set the environment variable TF_MKL_ROOT to point to the copy of MKL from step above.\r\n```\r\nexport TF_MKL_ROOT=<path_to_mklml_lnx_2018.0.3.20180406>/\r\n```\r\n\r\n4. Modify the file `tensorflow/third_party/mkl/BUILD` to add the line `linkopts = [\"-ldl\",],` after the line  `name = \"intel_binary_blob\",`. It should look like below\r\n```\r\ncc_library(\r\n    name = \"intel_binary_blob\",\r\n    linkopts = [\"-ldl\",],\r\n    visibility = [\"//visibility:public\"],\r\n    deps = select({\r\n```\r\n\r\n5. Modify the file `tensorflow/third_party/mkl/mkl.BUILD` to add the line `\"lib/libdl.so\"`, after the line `name = \"mkl_libs_linux\", srcs = [`. It should look like below\r\n```\r\ncc_library(\r\n    name = \"mkl_libs_linux\",\r\n    srcs = [\r\n        \"lib/libdl.so\",\r\n        \"lib/libiomp5.so\",\r\n        \"lib/libmklml_intel.so\",\r\n    ],\r\n    visibility = [\"//visibility:public\"],\r\n)\r\n```\r\n\r\n6. run configure and build\r\n"}