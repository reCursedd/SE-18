{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/362464811", "html_url": "https://github.com/tensorflow/tensorflow/issues/12951#issuecomment-362464811", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12951", "id": 362464811, "node_id": "MDEyOklzc3VlQ29tbWVudDM2MjQ2NDgxMQ==", "user": {"login": "pavanky", "id": 364829, "node_id": "MDQ6VXNlcjM2NDgyOQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/364829?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pavanky", "html_url": "https://github.com/pavanky", "followers_url": "https://api.github.com/users/pavanky/followers", "following_url": "https://api.github.com/users/pavanky/following{/other_user}", "gists_url": "https://api.github.com/users/pavanky/gists{/gist_id}", "starred_url": "https://api.github.com/users/pavanky/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pavanky/subscriptions", "organizations_url": "https://api.github.com/users/pavanky/orgs", "repos_url": "https://api.github.com/users/pavanky/repos", "events_url": "https://api.github.com/users/pavanky/events{/privacy}", "received_events_url": "https://api.github.com/users/pavanky/received_events", "type": "User", "site_admin": false}, "created_at": "2018-02-02T02:15:37Z", "updated_at": "2018-03-19T22:05:58Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=23486130\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/tfboyd\">@tfboyd</a> This issue still happens when mkl is enabled on  <a href=\"https://github.com/tensorflow/tensorflow/archive/v1.5.0.zip\">tensorflow 1.5.0 release</a> for the following configuration:</p>\n<ul>\n<li>Centos 7 docker image</li>\n<li>Devtoolset 6</li>\n<li>Python 27</li>\n<li>bazel 0.8.0</li>\n</ul>\n<p>Some of the things I tried:</p>\n<ul>\n<li>Passing <code>--linkopt=-ldl</code> to <code>bazel build</code>.</li>\n<li>Patch <code>mk/BUILD</code> to accept <code>linkopts = [\"-ldl\"]</code></li>\n<li>Patch <code>tf_extension_linkopts</code> in <code>tensorflow/tensorflow.bzl</code> to <code>return [\"-ldl\"]</code>.</li>\n</ul>\n<p>None of them seem to work.</p>\n<hr>\n<p>The command used to build:</p>\n<pre><code>export CC_OPT_FLAGS=\"-march=x86-64\"\n\nexport TF_NEED_GCP=\"1\"\nexport TF_NEED_MKL=\"1\"\nexport TF_NEED_JEMALLOC=\"0\"\nexport TF_NEED_HDFS=\"1\"\nexport TF_NEED_S3=\"0\"\nexport TF_NEED_GDR=\"0\"\nexport TF_NEED_CUDA=\"0\"\nexport TF_ENABLE_XLA=\"0\"\nexport TF_NEED_VERBS=\"0\"\nexport TF_NEED_OPENCL=\"0\"\nexport TF_NEED_MPI=0\n\nbazel clean\n./configure\n\nbazel build -c opt \\\n      --copt=-mfpmath=both --config=mkl \\\n      //tensorflow/tools/pip_package:build_pip_package\n      //tensorflow/java:tensorflow \\\n      //tensorflow/java:libtensorflow_jni\n</code></pre>", "body_text": "@tfboyd This issue still happens when mkl is enabled on  tensorflow 1.5.0 release for the following configuration:\n\nCentos 7 docker image\nDevtoolset 6\nPython 27\nbazel 0.8.0\n\nSome of the things I tried:\n\nPassing --linkopt=-ldl to bazel build.\nPatch mk/BUILD to accept linkopts = [\"-ldl\"]\nPatch tf_extension_linkopts in tensorflow/tensorflow.bzl to return [\"-ldl\"].\n\nNone of them seem to work.\n\nThe command used to build:\nexport CC_OPT_FLAGS=\"-march=x86-64\"\n\nexport TF_NEED_GCP=\"1\"\nexport TF_NEED_MKL=\"1\"\nexport TF_NEED_JEMALLOC=\"0\"\nexport TF_NEED_HDFS=\"1\"\nexport TF_NEED_S3=\"0\"\nexport TF_NEED_GDR=\"0\"\nexport TF_NEED_CUDA=\"0\"\nexport TF_ENABLE_XLA=\"0\"\nexport TF_NEED_VERBS=\"0\"\nexport TF_NEED_OPENCL=\"0\"\nexport TF_NEED_MPI=0\n\nbazel clean\n./configure\n\nbazel build -c opt \\\n      --copt=-mfpmath=both --config=mkl \\\n      //tensorflow/tools/pip_package:build_pip_package\n      //tensorflow/java:tensorflow \\\n      //tensorflow/java:libtensorflow_jni", "body": "@tfboyd This issue still happens when mkl is enabled on  [tensorflow 1.5.0 release](https://github.com/tensorflow/tensorflow/archive/v1.5.0.zip) for the following configuration:\r\n\r\n- Centos 7 docker image \r\n- Devtoolset 6 \r\n- Python 27\r\n- bazel 0.8.0\r\n\r\nSome of the things I tried:\r\n- Passing `--linkopt=-ldl` to `bazel build`.\r\n- Patch `mk/BUILD` to accept `linkopts = [\"-ldl\"]`\r\n- Patch `tf_extension_linkopts` in `tensorflow/tensorflow.bzl` to `return [\"-ldl\"]`.\r\n\r\nNone of them seem to work. \r\n\r\n----\r\n\r\nThe command used to build:\r\n\r\n```\r\nexport CC_OPT_FLAGS=\"-march=x86-64\"\r\n\r\nexport TF_NEED_GCP=\"1\"\r\nexport TF_NEED_MKL=\"1\"\r\nexport TF_NEED_JEMALLOC=\"0\"\r\nexport TF_NEED_HDFS=\"1\"\r\nexport TF_NEED_S3=\"0\"\r\nexport TF_NEED_GDR=\"0\"\r\nexport TF_NEED_CUDA=\"0\"\r\nexport TF_ENABLE_XLA=\"0\"\r\nexport TF_NEED_VERBS=\"0\"\r\nexport TF_NEED_OPENCL=\"0\"\r\nexport TF_NEED_MPI=0\r\n\r\nbazel clean\r\n./configure\r\n\r\nbazel build -c opt \\\r\n      --copt=-mfpmath=both --config=mkl \\\r\n      //tensorflow/tools/pip_package:build_pip_package\r\n      //tensorflow/java:tensorflow \\\r\n      //tensorflow/java:libtensorflow_jni\r\n```"}