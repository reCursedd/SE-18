{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/375487389", "html_url": "https://github.com/tensorflow/tensorflow/issues/12951#issuecomment-375487389", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12951", "id": 375487389, "node_id": "MDEyOklzc3VlQ29tbWVudDM3NTQ4NzM4OQ==", "user": {"login": "agramesh1", "id": 25374808, "node_id": "MDQ6VXNlcjI1Mzc0ODA4", "avatar_url": "https://avatars3.githubusercontent.com/u/25374808?v=4", "gravatar_id": "", "url": "https://api.github.com/users/agramesh1", "html_url": "https://github.com/agramesh1", "followers_url": "https://api.github.com/users/agramesh1/followers", "following_url": "https://api.github.com/users/agramesh1/following{/other_user}", "gists_url": "https://api.github.com/users/agramesh1/gists{/gist_id}", "starred_url": "https://api.github.com/users/agramesh1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/agramesh1/subscriptions", "organizations_url": "https://api.github.com/users/agramesh1/orgs", "repos_url": "https://api.github.com/users/agramesh1/repos", "events_url": "https://api.github.com/users/agramesh1/events{/privacy}", "received_events_url": "https://api.github.com/users/agramesh1/received_events", "type": "User", "site_admin": false}, "created_at": "2018-03-22T23:11:06Z", "updated_at": "2018-03-22T23:33:53Z", "author_association": "CONTRIBUTOR", "body_html": "<p>On some systems, esp. a few Ubuntu versions we have seen Tensorflow fail to build due to missing libraries when compiling with \u2013config=mkl. You will see errors similar to this</p>\n<pre><code>libmklml_intel.so: error: undefined reference to 'dladdr' \n</code></pre>\n<p>The linker is unable to find libdl.so. For a work around, you need a private copy of MKL with the missing library included in. Follow the steps below.</p>\n<ol>\n<li>\n<p>Download the version of MKL used by the version of Tensorflow you are compiling, you can get the URL from the file tensorflow/workspace.bzl, search for mkl_repository.</p>\n</li>\n<li>\n<p>Find the shared library libdl.so on your system ( it is usually in /usr/lib/) and copy over to the lib folder of the copy of MKL that you downloaded.</p>\n</li>\n<li>\n<p>Set the environment variable TF_MKL_ROOT to  point to the copy of MKL from step above.</p>\n</li>\n<li>\n<p>Modify the file third_party/mkl/BUILD as follows</p>\n</li>\n<li>\n<p>add a line containing the following  linkopts = [\"-ldl\",],  after the line containing   name = \"intel_binary_blob\",</p>\n</li>\n</ol>\n<p>6  add a line containing \"@mkl//:libdl.so\",  after the line containing srcs = if_mkl([</p>\n<ol start=\"7\">\n<li>run configure and build</li>\n</ol>\n<p>We tried many ways to pass the -ldl flag through bazel but none of them worked, this is the best solution we have.</p>", "body_text": "On some systems, esp. a few Ubuntu versions we have seen Tensorflow fail to build due to missing libraries when compiling with \u2013config=mkl. You will see errors similar to this\nlibmklml_intel.so: error: undefined reference to 'dladdr' \n\nThe linker is unable to find libdl.so. For a work around, you need a private copy of MKL with the missing library included in. Follow the steps below.\n\n\nDownload the version of MKL used by the version of Tensorflow you are compiling, you can get the URL from the file tensorflow/workspace.bzl, search for mkl_repository.\n\n\nFind the shared library libdl.so on your system ( it is usually in /usr/lib/) and copy over to the lib folder of the copy of MKL that you downloaded.\n\n\nSet the environment variable TF_MKL_ROOT to  point to the copy of MKL from step above.\n\n\nModify the file third_party/mkl/BUILD as follows\n\n\nadd a line containing the following  linkopts = [\"-ldl\",],  after the line containing   name = \"intel_binary_blob\",\n\n\n6  add a line containing \"@mkl//:libdl.so\",  after the line containing srcs = if_mkl([\n\nrun configure and build\n\nWe tried many ways to pass the -ldl flag through bazel but none of them worked, this is the best solution we have.", "body": "On some systems, esp. a few Ubuntu versions we have seen Tensorflow fail to build due to missing libraries when compiling with \u2013config=mkl. You will see errors similar to this\r\n```\r\nlibmklml_intel.so: error: undefined reference to 'dladdr' \r\n```\r\nThe linker is unable to find libdl.so. For a work around, you need a private copy of MKL with the missing library included in. Follow the steps below. \r\n\r\n1. Download the version of MKL used by the version of Tensorflow you are compiling, you can get the URL from the file tensorflow/workspace.bzl, search for mkl_repository.\r\n\r\n2.  Find the shared library libdl.so on your system ( it is usually in /usr/lib/) and copy over to the lib folder of the copy of MKL that you downloaded.\r\n\r\n3.  Set the environment variable TF_MKL_ROOT to  point to the copy of MKL from step above.\r\n\r\n4.  Modify the file third_party/mkl/BUILD as follows\r\n\r\n5. add a line containing the following  linkopts = [\"-ldl\",],  after the line containing   name = \"intel_binary_blob\", \r\n\r\n6  add a line containing \"@mkl//:libdl.so\",  after the line containing srcs = if_mkl([ \r\n\r\n7. run configure and build\r\n\r\nWe tried many ways to pass the -ldl flag through bazel but none of them worked, this is the best solution we have."}