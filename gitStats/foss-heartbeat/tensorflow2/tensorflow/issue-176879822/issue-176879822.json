{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4380", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4380/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4380/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4380/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/4380", "id": 176879822, "node_id": "MDU6SXNzdWUxNzY4Nzk4MjI=", "number": 4380, "title": "TensorFlow master build failing: error: invalid initialization of reference ", "user": {"login": "Nayana-ibm", "id": 20816038, "node_id": "MDQ6VXNlcjIwODE2MDM4", "avatar_url": "https://avatars0.githubusercontent.com/u/20816038?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nayana-ibm", "html_url": "https://github.com/Nayana-ibm", "followers_url": "https://api.github.com/users/Nayana-ibm/followers", "following_url": "https://api.github.com/users/Nayana-ibm/following{/other_user}", "gists_url": "https://api.github.com/users/Nayana-ibm/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nayana-ibm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nayana-ibm/subscriptions", "organizations_url": "https://api.github.com/users/Nayana-ibm/orgs", "repos_url": "https://api.github.com/users/Nayana-ibm/repos", "events_url": "https://api.github.com/users/Nayana-ibm/events{/privacy}", "received_events_url": "https://api.github.com/users/Nayana-ibm/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2016-09-14T11:13:30Z", "updated_at": "2016-09-16T08:45:12Z", "closed_at": "2016-09-15T22:02:19Z", "author_association": "CONTRIBUTOR", "body_html": "<p>We are building TensorFlow master (commit id  <a href=\"https://github.com/tensorflow/tensorflow/commit/461caa86137aee3d2e40843ea308c216f10c4655\">461caa8</a> ) using bazel on 64 bit platform.</p>\n<p>We need a fix for 64 bit platform as mentioned in  <a href=\"https://github.com/google/protobuf/pull/1044\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/protocolbuffers/protobuf/pull/1044/hovercard\">#1044</a> in google/protobuf. So we tried to change the protobuf commit id used in <code>tensorflow/workspace.bzl</code> file with recent protobuf commit id as mentioned below.</p>\n<pre><code>+++ b/tensorflow/workspace.bzl\n@@ -88,7 +88,8 @@ def tf_workspace(path_prefix = \"\", tf_repo_name = \"\"):\n\u00a0\u00a0\u00a0native.git_repository(\n\u00a0\u00a0\u00a0\u00a0\u00a0name = \"protobuf\",\n\u00a0\u00a0\u00a0\u00a0\u00a0remote = \"https://github.com/google/protobuf\",\n- commit = \"ed87c1fe2c6e1633cadb62cf54b2723b2b25c280\",\n+# commit = \"ed87c1fe2c6e1633cadb62cf54b2723b2b25c280\",\n+ commit = \"c59473d53eafadd126502657e5c5c33e952b67ed\",\n\u00a0\u00a0\u00a0)\n</code></pre>\n<p>But TensorFlow build is failing with below errors:</p>\n<pre><code>\nERROR: /home/test/tensorflow_proto_commit/tensorflow/tensorflow/core/BUILD:941:1: C++ compilation of rule '//tensorflow/core:framework_internal' failed: gcc failed: error executing command /opt/gccgo/bin/gcc -U_FORTIFY_SOURCE '-D_FORTIFY_SOURCE=1' -fstack-protector -Wall -Wl,-z,-relro,-z,now -B/opt/gccgo/bin -B/usr/bin -Wunused-but-set-parameter -Wno-free-nonheap-object ... (remaining 108 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\n\ntensorflow/core/example/feature_util.cc: In function 'const typename tensorflow::internal::RepeatedFieldTrait&lt;FeatureType&gt;::Type&amp; tensorflow::GetFeatureValues(const string&amp;, const tensorflow::Example&amp;) [with FeatureType = long long int; typename tensorflow::internal::RepeatedFieldTrait&lt;FeatureType&gt;::Type = google::protobuf::RepeatedField&lt;long long int&gt;; std::__cxx11::string = std::__cxx11::basic_string&lt;char&gt;]':\ntensorflow/core/example/feature_util.cc:54:66: error: invalid initialization of reference of type 'const google::protobuf::RepeatedField&lt;long long int&gt;&amp;' from expression of type 'const google::protobuf::RepeatedField&lt;long int&gt;'\n   return example.features().feature().at(name).int64_list().value();\n                                                                  ^\ntensorflow/core/example/feature_util.cc: In function 'typename tensorflow::internal::RepeatedFieldTrait&lt;FeatureType&gt;::Type* tensorflow::GetFeatureValues(const string&amp;, tensorflow::Example*) [with FeatureType = long long int; typename tensorflow::internal::RepeatedFieldTrait&lt;FeatureType&gt;::Type = google::protobuf::RepeatedField&lt;long long int&gt;; std::__cxx11::string = std::__cxx11::basic_string&lt;char&gt;]':\ntensorflow/core/example/feature_util.cc:62:23: error: cannot convert 'google::protobuf::RepeatedField&lt;long int&gt;*' to 'google::protobuf::RepeatedField&lt;long long int&gt;*' in return\n       -&gt;mutable_value();\n                       ^\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\n\n</code></pre>\n<p>Is there any specific protobuf commit id to be used with TensorFlow?<br>\nWe could build TensorFlow without making any change in <code>tensorflow/workspace.bzl</code> and manually adding fix for 64 bit platform in  <code>external/protobuf/src/google/protobuf/stubs/atomicops_internals_generic_gcc.h</code> .</p>\n<p>We need to use protobuf with commit id <a href=\"https://github.com/google/protobuf/commit/c59473d53eafadd126502657e5c5c33e952b67ed\">c59473d</a> or recent , where a fix for 64 bit platform has been committed.</p>\n<p><strong>Environment info</strong></p>\n<p>Operating System: <strong>RedHat , Ubuntu</strong></p>\n<p>Installed version of CUDA and cuDNN:  <strong>Not installed</strong></p>\n<p>The output from <code>python -c \"import tensorflow; print(tensorflow.__version__)\"</code>. <strong>master</strong></p>\n<p>If installed from source, provide</p>\n<ol>\n<li>The commit hash (<code>git rev-parse HEAD</code>)  <a href=\"https://github.com/tensorflow/tensorflow/commit/461caa86137aee3d2e40843ea308c216f10c4655\">461caa8</a></li>\n<li>The output of <code>bazel version</code> <strong>master branch (0.3.1-2016-09-12)</strong></li>\n</ol>\n<p>Steps to Reproduce:<br>\nbazel build -c opt //tensorflow/tools/pip_package:build_pip_package</p>", "body_text": "We are building TensorFlow master (commit id  461caa8 ) using bazel on 64 bit platform.\nWe need a fix for 64 bit platform as mentioned in  #1044 in google/protobuf. So we tried to change the protobuf commit id used in tensorflow/workspace.bzl file with recent protobuf commit id as mentioned below.\n+++ b/tensorflow/workspace.bzl\n@@ -88,7 +88,8 @@ def tf_workspace(path_prefix = \"\", tf_repo_name = \"\"):\n\u00a0\u00a0\u00a0native.git_repository(\n\u00a0\u00a0\u00a0\u00a0\u00a0name = \"protobuf\",\n\u00a0\u00a0\u00a0\u00a0\u00a0remote = \"https://github.com/google/protobuf\",\n- commit = \"ed87c1fe2c6e1633cadb62cf54b2723b2b25c280\",\n+# commit = \"ed87c1fe2c6e1633cadb62cf54b2723b2b25c280\",\n+ commit = \"c59473d53eafadd126502657e5c5c33e952b67ed\",\n\u00a0\u00a0\u00a0)\n\nBut TensorFlow build is failing with below errors:\n\nERROR: /home/test/tensorflow_proto_commit/tensorflow/tensorflow/core/BUILD:941:1: C++ compilation of rule '//tensorflow/core:framework_internal' failed: gcc failed: error executing command /opt/gccgo/bin/gcc -U_FORTIFY_SOURCE '-D_FORTIFY_SOURCE=1' -fstack-protector -Wall -Wl,-z,-relro,-z,now -B/opt/gccgo/bin -B/usr/bin -Wunused-but-set-parameter -Wno-free-nonheap-object ... (remaining 108 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\n\ntensorflow/core/example/feature_util.cc: In function 'const typename tensorflow::internal::RepeatedFieldTrait<FeatureType>::Type& tensorflow::GetFeatureValues(const string&, const tensorflow::Example&) [with FeatureType = long long int; typename tensorflow::internal::RepeatedFieldTrait<FeatureType>::Type = google::protobuf::RepeatedField<long long int>; std::__cxx11::string = std::__cxx11::basic_string<char>]':\ntensorflow/core/example/feature_util.cc:54:66: error: invalid initialization of reference of type 'const google::protobuf::RepeatedField<long long int>&' from expression of type 'const google::protobuf::RepeatedField<long int>'\n   return example.features().feature().at(name).int64_list().value();\n                                                                  ^\ntensorflow/core/example/feature_util.cc: In function 'typename tensorflow::internal::RepeatedFieldTrait<FeatureType>::Type* tensorflow::GetFeatureValues(const string&, tensorflow::Example*) [with FeatureType = long long int; typename tensorflow::internal::RepeatedFieldTrait<FeatureType>::Type = google::protobuf::RepeatedField<long long int>; std::__cxx11::string = std::__cxx11::basic_string<char>]':\ntensorflow/core/example/feature_util.cc:62:23: error: cannot convert 'google::protobuf::RepeatedField<long int>*' to 'google::protobuf::RepeatedField<long long int>*' in return\n       ->mutable_value();\n                       ^\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\n\n\nIs there any specific protobuf commit id to be used with TensorFlow?\nWe could build TensorFlow without making any change in tensorflow/workspace.bzl and manually adding fix for 64 bit platform in  external/protobuf/src/google/protobuf/stubs/atomicops_internals_generic_gcc.h .\nWe need to use protobuf with commit id c59473d or recent , where a fix for 64 bit platform has been committed.\nEnvironment info\nOperating System: RedHat , Ubuntu\nInstalled version of CUDA and cuDNN:  Not installed\nThe output from python -c \"import tensorflow; print(tensorflow.__version__)\". master\nIf installed from source, provide\n\nThe commit hash (git rev-parse HEAD)  461caa8\nThe output of bazel version master branch (0.3.1-2016-09-12)\n\nSteps to Reproduce:\nbazel build -c opt //tensorflow/tools/pip_package:build_pip_package", "body": "We are building TensorFlow master (commit id  [461caa8](https://github.com/tensorflow/tensorflow/commit/461caa86137aee3d2e40843ea308c216f10c4655) ) using bazel on 64 bit platform. \n\nWe need a fix for 64 bit platform as mentioned in  [#1044](https://github.com/google/protobuf/pull/1044) in google/protobuf. So we tried to change the protobuf commit id used in `tensorflow/workspace.bzl` file with recent protobuf commit id as mentioned below.  \n\n```\n+++ b/tensorflow/workspace.bzl\n@@ -88,7 +88,8 @@ def tf_workspace(path_prefix = \"\", tf_repo_name = \"\"):\n\u00a0\u00a0\u00a0native.git_repository(\n\u00a0\u00a0\u00a0\u00a0\u00a0name = \"protobuf\",\n\u00a0\u00a0\u00a0\u00a0\u00a0remote = \"https://github.com/google/protobuf\",\n- commit = \"ed87c1fe2c6e1633cadb62cf54b2723b2b25c280\",\n+# commit = \"ed87c1fe2c6e1633cadb62cf54b2723b2b25c280\",\n+ commit = \"c59473d53eafadd126502657e5c5c33e952b67ed\",\n\u00a0\u00a0\u00a0)\n```\n\nBut TensorFlow build is failing with below errors: \n\n```\n\nERROR: /home/test/tensorflow_proto_commit/tensorflow/tensorflow/core/BUILD:941:1: C++ compilation of rule '//tensorflow/core:framework_internal' failed: gcc failed: error executing command /opt/gccgo/bin/gcc -U_FORTIFY_SOURCE '-D_FORTIFY_SOURCE=1' -fstack-protector -Wall -Wl,-z,-relro,-z,now -B/opt/gccgo/bin -B/usr/bin -Wunused-but-set-parameter -Wno-free-nonheap-object ... (remaining 108 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\n\ntensorflow/core/example/feature_util.cc: In function 'const typename tensorflow::internal::RepeatedFieldTrait<FeatureType>::Type& tensorflow::GetFeatureValues(const string&, const tensorflow::Example&) [with FeatureType = long long int; typename tensorflow::internal::RepeatedFieldTrait<FeatureType>::Type = google::protobuf::RepeatedField<long long int>; std::__cxx11::string = std::__cxx11::basic_string<char>]':\ntensorflow/core/example/feature_util.cc:54:66: error: invalid initialization of reference of type 'const google::protobuf::RepeatedField<long long int>&' from expression of type 'const google::protobuf::RepeatedField<long int>'\n   return example.features().feature().at(name).int64_list().value();\n                                                                  ^\ntensorflow/core/example/feature_util.cc: In function 'typename tensorflow::internal::RepeatedFieldTrait<FeatureType>::Type* tensorflow::GetFeatureValues(const string&, tensorflow::Example*) [with FeatureType = long long int; typename tensorflow::internal::RepeatedFieldTrait<FeatureType>::Type = google::protobuf::RepeatedField<long long int>; std::__cxx11::string = std::__cxx11::basic_string<char>]':\ntensorflow/core/example/feature_util.cc:62:23: error: cannot convert 'google::protobuf::RepeatedField<long int>*' to 'google::protobuf::RepeatedField<long long int>*' in return\n       ->mutable_value();\n                       ^\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\n\n```\n\nIs there any specific protobuf commit id to be used with TensorFlow?\nWe could build TensorFlow without making any change in `tensorflow/workspace.bzl` and manually adding fix for 64 bit platform in  `external/protobuf/src/google/protobuf/stubs/atomicops_internals_generic_gcc.h` .\n\nWe need to use protobuf with commit id [c59473d](https://github.com/google/protobuf/commit/c59473d53eafadd126502657e5c5c33e952b67ed) or recent , where a fix for 64 bit platform has been committed. \n\n**Environment info**\n\nOperating System: **RedHat , Ubuntu**\n\nInstalled version of CUDA and cuDNN:  **Not installed** \n\nThe output from `python -c \"import tensorflow; print(tensorflow.__version__)\"`. **master**\n\nIf installed from source, provide \n1. The commit hash (`git rev-parse HEAD`)  [461caa8](https://github.com/tensorflow/tensorflow/commit/461caa86137aee3d2e40843ea308c216f10c4655)\n2. The output of `bazel version` **master branch (0.3.1-2016-09-12)**\n\nSteps to Reproduce:\nbazel build -c opt //tensorflow/tools/pip_package:build_pip_package\n"}