{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/197950565", "pull_request_review_id": 131794119, "id": 197950565, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5Nzk1MDU2NQ==", "diff_hunk": "@@ -18,131 +18,332 @@\n from __future__ import division\n from __future__ import print_function\n \n-import warnings\n+import itertools\n import numpy as np\n+import six\n+import warnings\n+from collections import namedtuple\n \n from tensorflow.contrib import tensorrt as trt\n-from tensorflow.core.protobuf import config_pb2 as cpb2\n-from tensorflow.python.framework import constant_op as cop\n-from tensorflow.python.framework import dtypes as dtypes\n-from tensorflow.python.framework import importer as importer\n-from tensorflow.python.framework import ops as ops\n+from tensorflow.core.protobuf import config_pb2\n+from tensorflow.core.protobuf import rewriter_config_pb2\n+from tensorflow.python.framework import constant_op\n+from tensorflow.python.framework import dtypes\n+from tensorflow.python.framework import graph_io\n+from tensorflow.python.framework import importer\n+from tensorflow.python.framework import ops\n from tensorflow.python.framework import test_util\n-from tensorflow.python.ops import array_ops as aops\n-from tensorflow.python.ops import nn as nn\n-from tensorflow.python.ops import nn_ops as nn_ops\n-from tensorflow.python.platform import googletest\n+from tensorflow.python.ops import array_ops\n+from tensorflow.python.ops import math_ops\n+from tensorflow.python.ops import nn\n+from tensorflow.python.ops import nn_ops\n+from tensorflow.python.platform import test\n+# from tensorflow.python.platform import tf_logging\n \n+INPUT_NAME = \"input\"\n+OUTPUT_NAME = \"output\"\n+INPUT_DIMS = [100, 24, 24, 2]\n+MODE_FP32 = \"FP32\"\n+MODE_FP16 = \"FP16\"\n+MODE_INT8 = \"INT8\"\n \n-class IntegrationTest(test_util.TensorFlowTestCase):\n-  \"\"\"Class to test Tensorflow-TensorRT integration.\"\"\"\n+if six.PY2:\n+  to_bytes = lambda s: s\n+  to_string = lambda s: s\n+else:\n+  to_bytes = lambda s: s.encode(\"utf-8\", errors=\"surrogateescape\")\n+  to_string = lambda s: s.decode(\"utf-8\")\n \n-  def setUp(self):\n-    \"\"\"Setup method.\"\"\"\n-    super(IntegrationTest, self).setUp()\n-    warnings.simplefilter(\"always\")\n-    inp_dims = (100, 24, 24, 2)\n-    self._input = np.random.random_sample(inp_dims)\n-    self._original_graph = self.get_simple_graph_def()\n-    self._gpu_options = cpb2.GPUOptions(per_process_gpu_memory_fraction=0.50)\n-    self._config = cpb2.ConfigProto(gpu_options=self._gpu_options)\n-    self._reference = self.run_graph(self._original_graph, self._input)\n-\n-  def get_simple_graph_def(self):\n-    \"\"\"Create a simple graph and return its graph_def.\"\"\"\n-    g = ops.Graph()\n-    with g.as_default():\n-      a = aops.placeholder(\n-          dtype=dtypes.float32, shape=(None, 24, 24, 2), name=\"input\")\n-      e = cop.constant(\n+\n+def GetSingleEngineGraphDef():", "path": "tensorflow/contrib/tensorrt/test/tf_trt_integration_test.py", "position": null, "original_position": 71, "commit_id": "0338a600fc2475fee1beb1d5a4779746b7b6ae4d", "original_commit_id": "5b1ba1d98c0b820d5b1b9633aef9494293b7e5fd", "user": {"login": "aaroey", "id": 31743510, "node_id": "MDQ6VXNlcjMxNzQzNTEw", "avatar_url": "https://avatars0.githubusercontent.com/u/31743510?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aaroey", "html_url": "https://github.com/aaroey", "followers_url": "https://api.github.com/users/aaroey/followers", "following_url": "https://api.github.com/users/aaroey/following{/other_user}", "gists_url": "https://api.github.com/users/aaroey/gists{/gist_id}", "starred_url": "https://api.github.com/users/aaroey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aaroey/subscriptions", "organizations_url": "https://api.github.com/users/aaroey/orgs", "repos_url": "https://api.github.com/users/aaroey/repos", "events_url": "https://api.github.com/users/aaroey/events{/privacy}", "received_events_url": "https://api.github.com/users/aaroey/received_events", "type": "User", "site_admin": false}, "body": "Done.", "created_at": "2018-06-25T21:37:31Z", "updated_at": "2018-06-25T22:43:04Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/20285#discussion_r197950565", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/20285", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/197950565"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/20285#discussion_r197950565"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/20285"}}, "body_html": "<p>Done.</p>", "body_text": "Done.", "in_reply_to_id": 197904192}