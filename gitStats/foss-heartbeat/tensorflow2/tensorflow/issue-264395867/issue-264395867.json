{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13616", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13616/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13616/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13616/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/13616", "id": 264395867, "node_id": "MDU6SXNzdWUyNjQzOTU4Njc=", "number": 13616, "title": "Force tensor evaluation inside while-loop, scan and others.", "user": {"login": "awav", "id": 24483645, "node_id": "MDQ6VXNlcjI0NDgzNjQ1", "avatar_url": "https://avatars0.githubusercontent.com/u/24483645?v=4", "gravatar_id": "", "url": "https://api.github.com/users/awav", "html_url": "https://github.com/awav", "followers_url": "https://api.github.com/users/awav/followers", "following_url": "https://api.github.com/users/awav/following{/other_user}", "gists_url": "https://api.github.com/users/awav/gists{/gist_id}", "starred_url": "https://api.github.com/users/awav/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/awav/subscriptions", "organizations_url": "https://api.github.com/users/awav/orgs", "repos_url": "https://api.github.com/users/awav/repos", "events_url": "https://api.github.com/users/awav/events{/privacy}", "received_events_url": "https://api.github.com/users/awav/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 30, "created_at": "2017-10-10T22:21:20Z", "updated_at": "2018-11-05T23:21:37Z", "closed_at": "2017-10-15T19:17:15Z", "author_association": "NONE", "body_html": "<p>Hello everyone,</p>\n<p>I had big plans for <code>tf.while_loop</code> until I discovered that it is impossible to re-evaluate tensor inside it. Let's dive into the the issue and potential useful feature:</p>\n<div class=\"highlight highlight-source-python\"><pre>In [<span class=\"pl-c1\">13</span>]: <span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n    <span class=\"pl-c1\">...</span>: <span class=\"pl-k\">import</span> numpy <span class=\"pl-k\">as</span> np\n    <span class=\"pl-c1\">...</span>:\n    <span class=\"pl-c1\">...</span>: <span class=\"pl-k\">def</span> <span class=\"pl-en\">cond</span>(<span class=\"pl-smi\">i</span>, <span class=\"pl-smi\">_x</span>, <span class=\"pl-smi\">_sq</span>):\n    <span class=\"pl-c1\">...</span>:       <span class=\"pl-k\">return</span> tf.less(i, <span class=\"pl-c1\">10</span>)\n    <span class=\"pl-c1\">...</span>:\n    <span class=\"pl-c1\">...</span>: <span class=\"pl-k\">def</span> <span class=\"pl-en\">gen_body</span>(<span class=\"pl-smi\">v</span>):\n    <span class=\"pl-c1\">...</span>:     <span class=\"pl-k\">def</span> <span class=\"pl-en\">body</span>(<span class=\"pl-smi\">i</span>, <span class=\"pl-smi\">x</span>, <span class=\"pl-smi\">sq</span>):\n    <span class=\"pl-c1\">...</span>:         x <span class=\"pl-k\">=</span> tf.Print(x, [x, sq], <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>x and sq: <span class=\"pl-pds\">\"</span></span>)\n    <span class=\"pl-c1\">...</span>:         v_assign <span class=\"pl-k\">=</span> v.assign(x <span class=\"pl-k\">+</span> <span class=\"pl-c1\">1</span>)\n    <span class=\"pl-c1\">...</span>:         v_assign <span class=\"pl-k\">=</span> tf.Print(v_assign, [v_assign], <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>v_assign: <span class=\"pl-pds\">\"</span></span>)\n    <span class=\"pl-c1\">...</span>:         <span class=\"pl-k\">with</span> tf.control_dependencies([v_assign]):\n    <span class=\"pl-c1\">...</span>:             sq_neg <span class=\"pl-k\">=</span> tf.negative(sq)\n    <span class=\"pl-c1\">...</span>:         sq_neg <span class=\"pl-k\">=</span> tf.Print(sq_neg, [i, sq_neg], <span class=\"pl-v\">message</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>i and sq_neg:<span class=\"pl-pds\">'</span></span>)\n    <span class=\"pl-c1\">...</span>:         <span class=\"pl-k\">return</span> tf.add(i, <span class=\"pl-c1\">1</span>), sq_neg, sq\n    <span class=\"pl-c1\">...</span>:     <span class=\"pl-k\">return</span> body\n    <span class=\"pl-c1\">...</span>:\n\nIn [<span class=\"pl-c1\">14</span>]: sess <span class=\"pl-k\">=</span> tf.InteractiveSession()\n\nIn [<span class=\"pl-c1\">15</span>]: i <span class=\"pl-k\">=</span> tf.Variable(<span class=\"pl-c1\">0</span>)\n    <span class=\"pl-c1\">...</span>: v <span class=\"pl-k\">=</span> tf.Variable(<span class=\"pl-c1\">2</span>)\n    <span class=\"pl-c1\">...</span>: sq <span class=\"pl-k\">=</span> tf.square(v)\n    <span class=\"pl-c1\">...</span>: l <span class=\"pl-k\">=</span> tf.while_loop(cond, gen_body(v), (i, v, sq))\n    <span class=\"pl-c1\">...</span>: sess.run(tf.global_variables_initializer())\n    <span class=\"pl-c1\">...</span>: sess.run(l)\n    <span class=\"pl-c1\">...</span>:\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.819271</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] x <span class=\"pl-k\">and</span> sq: [<span class=\"pl-c1\">2</span>][<span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.819405</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] v_assign: [<span class=\"pl-c1\">3</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.819466</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] i <span class=\"pl-k\">and</span> sq_neg:[<span class=\"pl-c1\">0</span>][<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.819553</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] x <span class=\"pl-k\">and</span> sq: [<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>][<span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.819615</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] v_assign: [<span class=\"pl-k\">-</span><span class=\"pl-c1\">3</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.819680</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] i <span class=\"pl-k\">and</span> sq_neg:[<span class=\"pl-c1\">1</span>][<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.819827</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] x <span class=\"pl-k\">and</span> sq: [<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>][<span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.819885</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] v_assign: [<span class=\"pl-k\">-</span><span class=\"pl-c1\">3</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.819932</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] i <span class=\"pl-k\">and</span> sq_neg:[<span class=\"pl-c1\">2</span>][<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820034</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] x <span class=\"pl-k\">and</span> sq: [<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>][<span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820094</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] v_assign: [<span class=\"pl-k\">-</span><span class=\"pl-c1\">3</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820111</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] i <span class=\"pl-k\">and</span> sq_neg:[<span class=\"pl-c1\">3</span>][<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820162</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] x <span class=\"pl-k\">and</span> sq: [<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>][<span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820250</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] v_assign: [<span class=\"pl-k\">-</span><span class=\"pl-c1\">3</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820265</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] i <span class=\"pl-k\">and</span> sq_neg:[<span class=\"pl-c1\">4</span>][<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820315</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] x <span class=\"pl-k\">and</span> sq: [<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>][<span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820379</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] v_assign: [<span class=\"pl-k\">-</span><span class=\"pl-c1\">3</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820408</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] i <span class=\"pl-k\">and</span> sq_neg:[<span class=\"pl-c1\">5</span>][<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820428</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] x <span class=\"pl-k\">and</span> sq: [<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>][<span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820438</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] v_assign: [<span class=\"pl-k\">-</span><span class=\"pl-c1\">3</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820446</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] i <span class=\"pl-k\">and</span> sq_neg:[<span class=\"pl-c1\">6</span>][<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820464</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] x <span class=\"pl-k\">and</span> sq: [<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>][<span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820490</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] v_assign: [<span class=\"pl-k\">-</span><span class=\"pl-c1\">3</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820500</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] i <span class=\"pl-k\">and</span> sq_neg:[<span class=\"pl-c1\">7</span>][<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820519</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] x <span class=\"pl-k\">and</span> sq: [<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>][<span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820532</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] v_assign: [<span class=\"pl-k\">-</span><span class=\"pl-c1\">3</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820542</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] i <span class=\"pl-k\">and</span> sq_neg:[<span class=\"pl-c1\">8</span>][<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820559</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] x <span class=\"pl-k\">and</span> sq: [<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>][<span class=\"pl-c1\">4</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820580</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] v_assign: [<span class=\"pl-k\">-</span><span class=\"pl-c1\">3</span>]\n<span class=\"pl-c1\">2017</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span><span class=\"pl-k\">-</span><span class=\"pl-c1\">10</span> <span class=\"pl-c1\">22</span>:<span class=\"pl-c1\">59</span>:<span class=\"pl-c1\">44.820593</span>: I tensorflow<span class=\"pl-k\">/</span>core<span class=\"pl-k\">/</span>kernels<span class=\"pl-k\">/</span>logging_ops.cc:<span class=\"pl-c1\">79</span>] i <span class=\"pl-k\">and</span> sq_neg:[<span class=\"pl-c1\">9</span>][<span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>]\nOut[<span class=\"pl-c1\">15</span>]: (<span class=\"pl-c1\">10</span>, <span class=\"pl-k\">-</span><span class=\"pl-c1\">4</span>, <span class=\"pl-c1\">4</span>)</pre></div>\n<p>I created <code>v</code> variable and tensor <code>sq</code> which equals to <code>v^2</code>. In fact, we don't have control over them, they are our input as <code>x</code> and <code>y</code> and we know that <code>y</code> depends on <code>x</code>. I would like to assign new value inside TensorFlow loop to <code>x</code> (equavalent to <code>v</code> at example) and evaluate fresh <code>y</code> (<code>sq</code> inside example) at each iteration of the loop. Meanwhile we can do other evaluations inside <code>while_loop</code>, but most important is that I need to update <code>x</code> and get updated <code>y</code>. Currently, assigning operation doesn't propagate updates down to the dependant nodes and it shouldn't, but when someone calls tensor depending on value which were updated via assign inside <code>while_loop</code>, I suppose the tensor node must detect this change and evaluate new tensor value again.</p>\n<p>Thanks!</p>", "body_text": "Hello everyone,\nI had big plans for tf.while_loop until I discovered that it is impossible to re-evaluate tensor inside it. Let's dive into the the issue and potential useful feature:\nIn [13]: import tensorflow as tf\n    ...: import numpy as np\n    ...:\n    ...: def cond(i, _x, _sq):\n    ...:       return tf.less(i, 10)\n    ...:\n    ...: def gen_body(v):\n    ...:     def body(i, x, sq):\n    ...:         x = tf.Print(x, [x, sq], \"x and sq: \")\n    ...:         v_assign = v.assign(x + 1)\n    ...:         v_assign = tf.Print(v_assign, [v_assign], \"v_assign: \")\n    ...:         with tf.control_dependencies([v_assign]):\n    ...:             sq_neg = tf.negative(sq)\n    ...:         sq_neg = tf.Print(sq_neg, [i, sq_neg], message='i and sq_neg:')\n    ...:         return tf.add(i, 1), sq_neg, sq\n    ...:     return body\n    ...:\n\nIn [14]: sess = tf.InteractiveSession()\n\nIn [15]: i = tf.Variable(0)\n    ...: v = tf.Variable(2)\n    ...: sq = tf.square(v)\n    ...: l = tf.while_loop(cond, gen_body(v), (i, v, sq))\n    ...: sess.run(tf.global_variables_initializer())\n    ...: sess.run(l)\n    ...:\n2017-10-10 22:59:44.819271: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [2][4]\n2017-10-10 22:59:44.819405: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [3]\n2017-10-10 22:59:44.819466: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[0][-4]\n2017-10-10 22:59:44.819553: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [-4][4]\n2017-10-10 22:59:44.819615: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [-3]\n2017-10-10 22:59:44.819680: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[1][-4]\n2017-10-10 22:59:44.819827: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [-4][4]\n2017-10-10 22:59:44.819885: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [-3]\n2017-10-10 22:59:44.819932: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[2][-4]\n2017-10-10 22:59:44.820034: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [-4][4]\n2017-10-10 22:59:44.820094: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [-3]\n2017-10-10 22:59:44.820111: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[3][-4]\n2017-10-10 22:59:44.820162: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [-4][4]\n2017-10-10 22:59:44.820250: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [-3]\n2017-10-10 22:59:44.820265: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[4][-4]\n2017-10-10 22:59:44.820315: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [-4][4]\n2017-10-10 22:59:44.820379: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [-3]\n2017-10-10 22:59:44.820408: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[5][-4]\n2017-10-10 22:59:44.820428: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [-4][4]\n2017-10-10 22:59:44.820438: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [-3]\n2017-10-10 22:59:44.820446: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[6][-4]\n2017-10-10 22:59:44.820464: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [-4][4]\n2017-10-10 22:59:44.820490: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [-3]\n2017-10-10 22:59:44.820500: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[7][-4]\n2017-10-10 22:59:44.820519: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [-4][4]\n2017-10-10 22:59:44.820532: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [-3]\n2017-10-10 22:59:44.820542: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[8][-4]\n2017-10-10 22:59:44.820559: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [-4][4]\n2017-10-10 22:59:44.820580: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [-3]\n2017-10-10 22:59:44.820593: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[9][-4]\nOut[15]: (10, -4, 4)\nI created v variable and tensor sq which equals to v^2. In fact, we don't have control over them, they are our input as x and y and we know that y depends on x. I would like to assign new value inside TensorFlow loop to x (equavalent to v at example) and evaluate fresh y (sq inside example) at each iteration of the loop. Meanwhile we can do other evaluations inside while_loop, but most important is that I need to update x and get updated y. Currently, assigning operation doesn't propagate updates down to the dependant nodes and it shouldn't, but when someone calls tensor depending on value which were updated via assign inside while_loop, I suppose the tensor node must detect this change and evaluate new tensor value again.\nThanks!", "body": "Hello everyone,\r\n\r\nI had big plans for `tf.while_loop` until I discovered that it is impossible to re-evaluate tensor inside it. Let's dive into the the issue and potential useful feature:\r\n\r\n```python\r\nIn [13]: import tensorflow as tf\r\n    ...: import numpy as np\r\n    ...:\r\n    ...: def cond(i, _x, _sq):\r\n    ...:       return tf.less(i, 10)\r\n    ...:\r\n    ...: def gen_body(v):\r\n    ...:     def body(i, x, sq):\r\n    ...:         x = tf.Print(x, [x, sq], \"x and sq: \")\r\n    ...:         v_assign = v.assign(x + 1)\r\n    ...:         v_assign = tf.Print(v_assign, [v_assign], \"v_assign: \")\r\n    ...:         with tf.control_dependencies([v_assign]):\r\n    ...:             sq_neg = tf.negative(sq)\r\n    ...:         sq_neg = tf.Print(sq_neg, [i, sq_neg], message='i and sq_neg:')\r\n    ...:         return tf.add(i, 1), sq_neg, sq\r\n    ...:     return body\r\n    ...:\r\n\r\nIn [14]: sess = tf.InteractiveSession()\r\n\r\nIn [15]: i = tf.Variable(0)\r\n    ...: v = tf.Variable(2)\r\n    ...: sq = tf.square(v)\r\n    ...: l = tf.while_loop(cond, gen_body(v), (i, v, sq))\r\n    ...: sess.run(tf.global_variables_initializer())\r\n    ...: sess.run(l)\r\n    ...:\r\n2017-10-10 22:59:44.819271: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [2][4]\r\n2017-10-10 22:59:44.819405: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [3]\r\n2017-10-10 22:59:44.819466: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[0][-4]\r\n2017-10-10 22:59:44.819553: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [-4][4]\r\n2017-10-10 22:59:44.819615: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [-3]\r\n2017-10-10 22:59:44.819680: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[1][-4]\r\n2017-10-10 22:59:44.819827: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [-4][4]\r\n2017-10-10 22:59:44.819885: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [-3]\r\n2017-10-10 22:59:44.819932: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[2][-4]\r\n2017-10-10 22:59:44.820034: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [-4][4]\r\n2017-10-10 22:59:44.820094: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [-3]\r\n2017-10-10 22:59:44.820111: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[3][-4]\r\n2017-10-10 22:59:44.820162: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [-4][4]\r\n2017-10-10 22:59:44.820250: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [-3]\r\n2017-10-10 22:59:44.820265: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[4][-4]\r\n2017-10-10 22:59:44.820315: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [-4][4]\r\n2017-10-10 22:59:44.820379: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [-3]\r\n2017-10-10 22:59:44.820408: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[5][-4]\r\n2017-10-10 22:59:44.820428: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [-4][4]\r\n2017-10-10 22:59:44.820438: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [-3]\r\n2017-10-10 22:59:44.820446: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[6][-4]\r\n2017-10-10 22:59:44.820464: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [-4][4]\r\n2017-10-10 22:59:44.820490: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [-3]\r\n2017-10-10 22:59:44.820500: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[7][-4]\r\n2017-10-10 22:59:44.820519: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [-4][4]\r\n2017-10-10 22:59:44.820532: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [-3]\r\n2017-10-10 22:59:44.820542: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[8][-4]\r\n2017-10-10 22:59:44.820559: I tensorflow/core/kernels/logging_ops.cc:79] x and sq: [-4][4]\r\n2017-10-10 22:59:44.820580: I tensorflow/core/kernels/logging_ops.cc:79] v_assign: [-3]\r\n2017-10-10 22:59:44.820593: I tensorflow/core/kernels/logging_ops.cc:79] i and sq_neg:[9][-4]\r\nOut[15]: (10, -4, 4)\r\n```\r\n\r\nI created `v` variable and tensor `sq` which equals to `v^2`. In fact, we don't have control over them, they are our input as `x` and `y` and we know that `y` depends on `x`. I would like to assign new value inside TensorFlow loop to `x` (equavalent to `v` at example) and evaluate fresh `y` (`sq` inside example) at each iteration of the loop. Meanwhile we can do other evaluations inside `while_loop`, but most important is that I need to update `x` and get updated `y`. Currently, assigning operation doesn't propagate updates down to the dependant nodes and it shouldn't, but when someone calls tensor depending on value which were updated via assign inside `while_loop`, I suppose the tensor node must detect this change and evaluate new tensor value again.\r\n\r\nThanks!"}