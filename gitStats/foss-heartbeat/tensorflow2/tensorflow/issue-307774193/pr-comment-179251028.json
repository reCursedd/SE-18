{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/179251028", "pull_request_review_id": 109460608, "id": 179251028, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTI1MTAyOA==", "diff_hunk": "@@ -49,8 +51,22 @@ thread::ThreadPool* ComputePool(const SessionOptions& options) {\n int32 NumInterOpThreadsFromSessionOptions(const SessionOptions& options) {\n   const int32 t = options.config.inter_op_parallelism_threads();\n   if (t != 0) return t;\n+#ifdef INTEL_MKL\n+  // MKL library executes ops in parallel using OMP threads\n+  // Set inter_op conservatively to avoid thread oversubscription that could \n+  // lead to severe perf degradations and OMP resource exhaustion\n+  const int mkl_intra_op = omp_get_max_threads();\n+  CHECK_GE(mkl_intra_op, 1);\n+  const int32 mkl_inter_op = std::ceil(", "path": "tensorflow/core/common_runtime/process_util.cc", "position": null, "original_position": 19, "commit_id": "2ef8e85e7d572d6cbbec2eea66df8462914a2908", "original_commit_id": "b3e956b5aa424b2fdcb91d1a673f62788567f97c", "user": {"login": "jbobba", "id": 21375855, "node_id": "MDQ6VXNlcjIxMzc1ODU1", "avatar_url": "https://avatars1.githubusercontent.com/u/21375855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jbobba", "html_url": "https://github.com/jbobba", "followers_url": "https://api.github.com/users/jbobba/followers", "following_url": "https://api.github.com/users/jbobba/following{/other_user}", "gists_url": "https://api.github.com/users/jbobba/gists{/gist_id}", "starred_url": "https://api.github.com/users/jbobba/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jbobba/subscriptions", "organizations_url": "https://api.github.com/users/jbobba/orgs", "repos_url": "https://api.github.com/users/jbobba/repos", "events_url": "https://api.github.com/users/jbobba/events{/privacy}", "received_events_url": "https://api.github.com/users/jbobba/received_events", "type": "User", "site_admin": false}, "body": "Agree that this is conservative. For most of the models we have worked with, inter_op 1 seems to be good enough until data layer comes in to the picture at which point, inter_op 2 or higher seems better. I'm willing to bump it up to 2 though. ", "created_at": "2018-04-04T19:07:49Z", "updated_at": "2018-04-04T22:10:03Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/17931#discussion_r179251028", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/17931", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/179251028"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/17931#discussion_r179251028"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/17931"}}, "body_html": "<p>Agree that this is conservative. For most of the models we have worked with, inter_op 1 seems to be good enough until data layer comes in to the picture at which point, inter_op 2 or higher seems better. I'm willing to bump it up to 2 though.</p>", "body_text": "Agree that this is conservative. For most of the models we have worked with, inter_op 1 seems to be good enough until data layer comes in to the picture at which point, inter_op 2 or higher seems better. I'm willing to bump it up to 2 though.", "in_reply_to_id": 179229940}