{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3270", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3270/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3270/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3270/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/3270", "id": 164821206, "node_id": "MDU6SXNzdWUxNjQ4MjEyMDY=", "number": 3270, "title": "Loading Multiple models into the same session of tensorflow", "user": {"login": "suraj1990", "id": 5551707, "node_id": "MDQ6VXNlcjU1NTE3MDc=", "avatar_url": "https://avatars2.githubusercontent.com/u/5551707?v=4", "gravatar_id": "", "url": "https://api.github.com/users/suraj1990", "html_url": "https://github.com/suraj1990", "followers_url": "https://api.github.com/users/suraj1990/followers", "following_url": "https://api.github.com/users/suraj1990/following{/other_user}", "gists_url": "https://api.github.com/users/suraj1990/gists{/gist_id}", "starred_url": "https://api.github.com/users/suraj1990/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/suraj1990/subscriptions", "organizations_url": "https://api.github.com/users/suraj1990/orgs", "repos_url": "https://api.github.com/users/suraj1990/repos", "events_url": "https://api.github.com/users/suraj1990/events{/privacy}", "received_events_url": "https://api.github.com/users/suraj1990/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 29, "created_at": "2016-07-11T12:02:43Z", "updated_at": "2018-08-28T11:24:22Z", "closed_at": "2016-07-13T17:18:46Z", "author_association": "NONE", "body_html": "<p>I have trained two models. en-fr and fr-en models. The fr-en model has different vocab size compared to the en-fr model. The first model is being loaded properly. It crashes while loading the second one. I have trained both the models separately. Please check the log file attached to see the error logs. kindly tell me the right way to go ahead.</p>\n<p>I want to create a webservice for en-rf and fr-en translation. I ahve to load the models in a session for this, which is causing the problem. below is the piece of code. I am using the translate.py provided by tensorflow and the methods available in it.</p>\n<pre><code>`global en_fr_sess\n\n if en_fr_sess==None:\n en_fr_sess = tf.Session()\n\n global en_fr_model\n global en_fr_en_vocab_path\n global en_fr_fr_vocab_path\n\n en_fr_model = create_model(en_fr_sess, True)\n en_fr_model.batch_size = 1  \n fr_en_model = fr_en_create_model(en_fr_sess, True)\n fr_en_model.batch_size = 1`\n</code></pre>\n<p>I am able to run both the models separately and generate the translations. However, when I try to load both the models in the same session or even a different session one after the other, I get the following error</p>\n<pre><code>`ValueError: Variable embedding_attention_seq2seq/RNN/EmbeddingWrapper/embedding already exists, disallowed. Did you mean to set reuse=True in VarScope? Originally defined at:`\n`File \"/usr/local/lib/python2.7/dist-packages/tensorflow/models/rnn/translate/seq2seq_model.py\", line 113, in seq2seq_f\nfeed_previous=do_decode)`\n`File \"/usr/local/lib/python2.7/dist-packages/tensorflow/models/rnn/translate/seq2seq_model.py\", line 136, in &lt;lambda&gt;\nself.target_weights, buckets, lambda x, y: seq2seq_f(x, y, True),`\n`File \"/usr/local/lib/python2.7/dist-packages/tensorflow/models/rnn/translate/seq2seq_model.py\", line 137, in __init__\nsoftmax_loss_function=softmax_loss_function)`\n</code></pre>\n<p>Please find the detailed log file attached too. Kindly give me the inputs on how to proceed further.<br>\n<a href=\"https://github.com/tensorflow/tensorflow/files/357036/out.txt\">out.txt</a></p>", "body_text": "I have trained two models. en-fr and fr-en models. The fr-en model has different vocab size compared to the en-fr model. The first model is being loaded properly. It crashes while loading the second one. I have trained both the models separately. Please check the log file attached to see the error logs. kindly tell me the right way to go ahead.\nI want to create a webservice for en-rf and fr-en translation. I ahve to load the models in a session for this, which is causing the problem. below is the piece of code. I am using the translate.py provided by tensorflow and the methods available in it.\n`global en_fr_sess\n\n if en_fr_sess==None:\n en_fr_sess = tf.Session()\n\n global en_fr_model\n global en_fr_en_vocab_path\n global en_fr_fr_vocab_path\n\n en_fr_model = create_model(en_fr_sess, True)\n en_fr_model.batch_size = 1  \n fr_en_model = fr_en_create_model(en_fr_sess, True)\n fr_en_model.batch_size = 1`\n\nI am able to run both the models separately and generate the translations. However, when I try to load both the models in the same session or even a different session one after the other, I get the following error\n`ValueError: Variable embedding_attention_seq2seq/RNN/EmbeddingWrapper/embedding already exists, disallowed. Did you mean to set reuse=True in VarScope? Originally defined at:`\n`File \"/usr/local/lib/python2.7/dist-packages/tensorflow/models/rnn/translate/seq2seq_model.py\", line 113, in seq2seq_f\nfeed_previous=do_decode)`\n`File \"/usr/local/lib/python2.7/dist-packages/tensorflow/models/rnn/translate/seq2seq_model.py\", line 136, in <lambda>\nself.target_weights, buckets, lambda x, y: seq2seq_f(x, y, True),`\n`File \"/usr/local/lib/python2.7/dist-packages/tensorflow/models/rnn/translate/seq2seq_model.py\", line 137, in __init__\nsoftmax_loss_function=softmax_loss_function)`\n\nPlease find the detailed log file attached too. Kindly give me the inputs on how to proceed further.\nout.txt", "body": "I have trained two models. en-fr and fr-en models. The fr-en model has different vocab size compared to the en-fr model. The first model is being loaded properly. It crashes while loading the second one. I have trained both the models separately. Please check the log file attached to see the error logs. kindly tell me the right way to go ahead.\n\nI want to create a webservice for en-rf and fr-en translation. I ahve to load the models in a session for this, which is causing the problem. below is the piece of code. I am using the translate.py provided by tensorflow and the methods available in it.\n\n```\n`global en_fr_sess\n\n if en_fr_sess==None:\n en_fr_sess = tf.Session()\n\n global en_fr_model\n global en_fr_en_vocab_path\n global en_fr_fr_vocab_path\n\n en_fr_model = create_model(en_fr_sess, True)\n en_fr_model.batch_size = 1  \n fr_en_model = fr_en_create_model(en_fr_sess, True)\n fr_en_model.batch_size = 1`\n```\n\nI am able to run both the models separately and generate the translations. However, when I try to load both the models in the same session or even a different session one after the other, I get the following error\n\n```\n`ValueError: Variable embedding_attention_seq2seq/RNN/EmbeddingWrapper/embedding already exists, disallowed. Did you mean to set reuse=True in VarScope? Originally defined at:`\n`File \"/usr/local/lib/python2.7/dist-packages/tensorflow/models/rnn/translate/seq2seq_model.py\", line 113, in seq2seq_f\nfeed_previous=do_decode)`\n`File \"/usr/local/lib/python2.7/dist-packages/tensorflow/models/rnn/translate/seq2seq_model.py\", line 136, in <lambda>\nself.target_weights, buckets, lambda x, y: seq2seq_f(x, y, True),`\n`File \"/usr/local/lib/python2.7/dist-packages/tensorflow/models/rnn/translate/seq2seq_model.py\", line 137, in __init__\nsoftmax_loss_function=softmax_loss_function)`\n```\n\nPlease find the detailed log file attached too. Kindly give me the inputs on how to proceed further. \n[out.txt](https://github.com/tensorflow/tensorflow/files/357036/out.txt)\n"}