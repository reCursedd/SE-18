{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/229845620", "html_url": "https://github.com/tensorflow/tensorflow/issues/2654#issuecomment-229845620", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2654", "id": 229845620, "node_id": "MDEyOklzc3VlQ29tbWVudDIyOTg0NTYyMA==", "user": {"login": "domluna", "id": 1907223, "node_id": "MDQ6VXNlcjE5MDcyMjM=", "avatar_url": "https://avatars2.githubusercontent.com/u/1907223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/domluna", "html_url": "https://github.com/domluna", "followers_url": "https://api.github.com/users/domluna/followers", "following_url": "https://api.github.com/users/domluna/following{/other_user}", "gists_url": "https://api.github.com/users/domluna/gists{/gist_id}", "starred_url": "https://api.github.com/users/domluna/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/domluna/subscriptions", "organizations_url": "https://api.github.com/users/domluna/orgs", "repos_url": "https://api.github.com/users/domluna/repos", "events_url": "https://api.github.com/users/domluna/events{/privacy}", "received_events_url": "https://api.github.com/users/domluna/received_events", "type": "User", "site_admin": false}, "created_at": "2016-07-01T03:27:10Z", "updated_at": "2016-07-01T03:27:40Z", "author_association": "NONE", "body_html": "<p>So an update on this. The <code>finalize</code> method is great I'm using it on all my code now to make sure nothing sketchy is going on.</p>\n<p>I think I found the problem with this particular code and it might be an issue with Keras. When I call <code>train_on_batch</code> on a Keras model.</p>\n<p>The culprit being</p>\n<p><a href=\"https://github.com/fchollet/keras/blob/a1610eb2747e2020b9460b1f60e6e750d253fffb/keras/engine/training.py#L673\">https://github.com/fchollet/keras/blob/a1610eb2747e2020b9460b1f60e6e750d253fffb/keras/engine/training.py#L673</a></p>\n<p>After some more digging it appears <code>K.gradients</code> and in turn <code>tf.gradients</code> is being called each time this is called.</p>", "body_text": "So an update on this. The finalize method is great I'm using it on all my code now to make sure nothing sketchy is going on.\nI think I found the problem with this particular code and it might be an issue with Keras. When I call train_on_batch on a Keras model.\nThe culprit being\nhttps://github.com/fchollet/keras/blob/a1610eb2747e2020b9460b1f60e6e750d253fffb/keras/engine/training.py#L673\nAfter some more digging it appears K.gradients and in turn tf.gradients is being called each time this is called.", "body": "So an update on this. The `finalize` method is great I'm using it on all my code now to make sure nothing sketchy is going on.\n\nI think I found the problem with this particular code and it might be an issue with Keras. When I call `train_on_batch` on a Keras model.\n\nThe culprit being \n\nhttps://github.com/fchollet/keras/blob/a1610eb2747e2020b9460b1f60e6e750d253fffb/keras/engine/training.py#L673\n\nAfter some more digging it appears `K.gradients` and in turn `tf.gradients` is being called each time this is called.\n"}