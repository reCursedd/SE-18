{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/108042982", "pull_request_review_id": 29053985, "id": 108042982, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEwODA0Mjk4Mg==", "diff_hunk": "@@ -43,25 +43,26 @@ Status InputBuffer::FillBuffer() {\n \n Status InputBuffer::ReadLine(string* result) {\n   result->clear();\n-  int i;\n   Status s;\n-  for (i = 0;; i++) {\n-    if (pos_ == limit_) {\n-      // Get more data into buffer\n-      s = FillBuffer();\n-      if (limit_ == buf_) {\n-        break;\n+  do {\n+    size_t buf_remain = limit_ - pos_;\n+    char* newline = (char*)memchr(pos_, '\\n', buf_remain);\n+    if (newline != nullptr) {\n+      size_t result_len = newline - pos_;\n+      result->append(pos_, result_len);\n+      pos_ = newline + 1;\n+      if (!result->empty() && result->back() == '\\r') {\n+        result->resize(result->size() - 1);\n       }\n-    }\n-    char c = *pos_++;\n-    if (c == '\\n') {\n-      // We don't append the '\\n' to *result\n       return Status::OK();\n     }\n-    // We don't append '\\r' to *result\n-    if (c != '\\r') {\n-      *result += c;\n-    }\n+    if (buf_remain > 0) result->append(pos_, buf_remain);\n+    // Get more data into buffer\n+    s = FillBuffer();\n+    assert(pos_ == buf_);", "path": "tensorflow/core/lib/io/inputbuffer.cc", "position": null, "original_position": 35, "commit_id": "dc7e4b175c591e40b77bcf0551a4b47ec9b5dc44", "original_commit_id": "0eaf87709c6c7ebe06b9214d4fbf3f8fe55bf649", "user": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "body": "One minor change, sorry: can you replace this line with `DCHECK_EQ(pos_, buf_);` to match the style of the rest of the codebase? Thanks!", "created_at": "2017-03-25T19:06:26Z", "updated_at": "2017-03-26T02:10:39Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/8534#discussion_r108042982", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/8534", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/108042982"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/8534#discussion_r108042982"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/8534"}}, "body_html": "<p>One minor change, sorry: can you replace this line with <code>DCHECK_EQ(pos_, buf_);</code> to match the style of the rest of the codebase? Thanks!</p>", "body_text": "One minor change, sorry: can you replace this line with DCHECK_EQ(pos_, buf_); to match the style of the rest of the codebase? Thanks!"}