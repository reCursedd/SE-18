{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/426498992", "html_url": "https://github.com/tensorflow/tensorflow/issues/22636#issuecomment-426498992", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22636", "id": 426498992, "node_id": "MDEyOklzc3VlQ29tbWVudDQyNjQ5ODk5Mg==", "user": {"login": "nehaljwani", "id": 1779189, "node_id": "MDQ6VXNlcjE3NzkxODk=", "avatar_url": "https://avatars0.githubusercontent.com/u/1779189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nehaljwani", "html_url": "https://github.com/nehaljwani", "followers_url": "https://api.github.com/users/nehaljwani/followers", "following_url": "https://api.github.com/users/nehaljwani/following{/other_user}", "gists_url": "https://api.github.com/users/nehaljwani/gists{/gist_id}", "starred_url": "https://api.github.com/users/nehaljwani/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nehaljwani/subscriptions", "organizations_url": "https://api.github.com/users/nehaljwani/orgs", "repos_url": "https://api.github.com/users/nehaljwani/repos", "events_url": "https://api.github.com/users/nehaljwani/events{/privacy}", "received_events_url": "https://api.github.com/users/nehaljwani/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-03T03:17:33Z", "updated_at": "2018-10-03T03:17:33Z", "author_association": "CONTRIBUTOR", "body_html": "<p>How is the custom implementation for <code>clock_gettime</code> being used? I don't see it in the source code anywhere. I am asking that because the build failed for me and I had to apply this patch:</p>\n<div class=\"highlight highlight-source-diff\"><pre><span class=\"pl-c1\">diff --git a/tensorflow/core/platform/posix/env_time.cc b/tensorflow/core/platform/posix/env_time.cc</span>\nindex 59a67b1..88f8a6c 100644\n<span class=\"pl-md\">--- a/tensorflow/core/platform/posix/env_time.cc</span>\n<span class=\"pl-mi1\">+++ b/tensorflow/core/platform/posix/env_time.cc</span>\n<span class=\"pl-mdr\">@@ -18,6 +18,23 @@</span> limitations under the License.\n\n #include \"tensorflow/core/platform/env_time.h\"\n\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>// Slightly pruned version of https://gist.github.com/alfwatt/3588c5aa1f7a1ef7a3bb</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>// Copyright (c) 2015-2018 Alf Watt - Open Source - https://opensource.org/licenses/MIT</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>#if defined __APPLE__</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>#include &lt;mach/clock.h&gt;</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>#include &lt;mach/mach.h&gt;</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>int alt_clock_gettime (int clock_id, timespec *ts) {</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  clock_serv_t cclock;</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  mach_timespec_t mts;</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  host_get_clock_service (mach_host_self (), clock_id, &amp;cclock);</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  clock_get_time (cclock, &amp;mts);</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  mach_port_deallocate (mach_task_self (), cclock);</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  ts-&gt;tv_sec = mts.tv_sec;</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  ts-&gt;tv_nsec = mts.tv_nsec;</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>  return 0;</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>}</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>#endif</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n namespace tensorflow {\n\n namespace {\n<span class=\"pl-mdr\">@@ -28,7 +45,11 @@</span> class PosixEnvTime : public EnvTime {\n\n   uint64 NowNanos() override {\n     struct timespec ts;\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>#if defined __APPLE__ &amp;&amp; __MAC_OS_X_VERSION_MIN_REQUIRED &lt; 101200 // less than macOS 10.12</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>    alt_clock_gettime(CALENDAR_CLOCK, &amp;ts);</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>#else</span>\n     clock_gettime(CLOCK_REALTIME, &amp;ts);\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>#endif</span>\n     return (static_cast&lt;uint64&gt;(ts.tv_sec) * kSecondsToNanos +\n             static_cast&lt;uint64&gt;(ts.tv_nsec));\n   }\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>-</span>\n2.5.4 (Apple Git-61)</pre></div>", "body_text": "How is the custom implementation for clock_gettime being used? I don't see it in the source code anywhere. I am asking that because the build failed for me and I had to apply this patch:\ndiff --git a/tensorflow/core/platform/posix/env_time.cc b/tensorflow/core/platform/posix/env_time.cc\nindex 59a67b1..88f8a6c 100644\n--- a/tensorflow/core/platform/posix/env_time.cc\n+++ b/tensorflow/core/platform/posix/env_time.cc\n@@ -18,6 +18,23 @@ limitations under the License.\n\n #include \"tensorflow/core/platform/env_time.h\"\n\n+// Slightly pruned version of https://gist.github.com/alfwatt/3588c5aa1f7a1ef7a3bb\n+// Copyright (c) 2015-2018 Alf Watt - Open Source - https://opensource.org/licenses/MIT\n+#if defined __APPLE__\n+#include <mach/clock.h>\n+#include <mach/mach.h>\n+int alt_clock_gettime (int clock_id, timespec *ts) {\n+  clock_serv_t cclock;\n+  mach_timespec_t mts;\n+  host_get_clock_service (mach_host_self (), clock_id, &cclock);\n+  clock_get_time (cclock, &mts);\n+  mach_port_deallocate (mach_task_self (), cclock);\n+  ts->tv_sec = mts.tv_sec;\n+  ts->tv_nsec = mts.tv_nsec;\n+  return 0;\n+}\n+#endif\n+\n namespace tensorflow {\n\n namespace {\n@@ -28,7 +45,11 @@ class PosixEnvTime : public EnvTime {\n\n   uint64 NowNanos() override {\n     struct timespec ts;\n+#if defined __APPLE__ && __MAC_OS_X_VERSION_MIN_REQUIRED < 101200 // less than macOS 10.12\n+    alt_clock_gettime(CALENDAR_CLOCK, &ts);\n+#else\n     clock_gettime(CLOCK_REALTIME, &ts);\n+#endif\n     return (static_cast<uint64>(ts.tv_sec) * kSecondsToNanos +\n             static_cast<uint64>(ts.tv_nsec));\n   }\n--\n2.5.4 (Apple Git-61)", "body": "How is the custom implementation for `clock_gettime` being used? I don't see it in the source code anywhere. I am asking that because the build failed for me and I had to apply this patch:\r\n```patch\r\ndiff --git a/tensorflow/core/platform/posix/env_time.cc b/tensorflow/core/platform/posix/env_time.cc\r\nindex 59a67b1..88f8a6c 100644\r\n--- a/tensorflow/core/platform/posix/env_time.cc\r\n+++ b/tensorflow/core/platform/posix/env_time.cc\r\n@@ -18,6 +18,23 @@ limitations under the License.\r\n\r\n #include \"tensorflow/core/platform/env_time.h\"\r\n\r\n+// Slightly pruned version of https://gist.github.com/alfwatt/3588c5aa1f7a1ef7a3bb\r\n+// Copyright (c) 2015-2018 Alf Watt - Open Source - https://opensource.org/licenses/MIT\r\n+#if defined __APPLE__\r\n+#include <mach/clock.h>\r\n+#include <mach/mach.h>\r\n+int alt_clock_gettime (int clock_id, timespec *ts) {\r\n+  clock_serv_t cclock;\r\n+  mach_timespec_t mts;\r\n+  host_get_clock_service (mach_host_self (), clock_id, &cclock);\r\n+  clock_get_time (cclock, &mts);\r\n+  mach_port_deallocate (mach_task_self (), cclock);\r\n+  ts->tv_sec = mts.tv_sec;\r\n+  ts->tv_nsec = mts.tv_nsec;\r\n+  return 0;\r\n+}\r\n+#endif\r\n+\r\n namespace tensorflow {\r\n\r\n namespace {\r\n@@ -28,7 +45,11 @@ class PosixEnvTime : public EnvTime {\r\n\r\n   uint64 NowNanos() override {\r\n     struct timespec ts;\r\n+#if defined __APPLE__ && __MAC_OS_X_VERSION_MIN_REQUIRED < 101200 // less than macOS 10.12\r\n+    alt_clock_gettime(CALENDAR_CLOCK, &ts);\r\n+#else\r\n     clock_gettime(CLOCK_REALTIME, &ts);\r\n+#endif\r\n     return (static_cast<uint64>(ts.tv_sec) * kSecondsToNanos +\r\n             static_cast<uint64>(ts.tv_nsec));\r\n   }\r\n--\r\n2.5.4 (Apple Git-61)\r\n```"}