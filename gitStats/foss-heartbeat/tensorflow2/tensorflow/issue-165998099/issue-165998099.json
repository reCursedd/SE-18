{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3352", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3352/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3352/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3352/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/3352", "id": 165998099, "node_id": "MDU6SXNzdWUxNjU5OTgwOTk=", "number": 3352, "title": "iOS Example with fine-tuned inception network memory error & quantization attempt", "user": {"login": "thrunlab", "id": 13158681, "node_id": "MDQ6VXNlcjEzMTU4Njgx", "avatar_url": "https://avatars1.githubusercontent.com/u/13158681?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thrunlab", "html_url": "https://github.com/thrunlab", "followers_url": "https://api.github.com/users/thrunlab/followers", "following_url": "https://api.github.com/users/thrunlab/following{/other_user}", "gists_url": "https://api.github.com/users/thrunlab/gists{/gist_id}", "starred_url": "https://api.github.com/users/thrunlab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thrunlab/subscriptions", "organizations_url": "https://api.github.com/users/thrunlab/orgs", "repos_url": "https://api.github.com/users/thrunlab/repos", "events_url": "https://api.github.com/users/thrunlab/events{/privacy}", "received_events_url": "https://api.github.com/users/thrunlab/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2016-07-17T21:51:49Z", "updated_at": "2016-09-28T19:59:18Z", "closed_at": "2016-09-28T19:59:18Z", "author_association": "NONE", "body_html": "<p>For bugs or installation issues, please provide the following information.<br>\nThe more information you provide, the more easily we will be able to offer<br>\nhelp and advice.</p>\n<h3>Environment info</h3>\n<p>Operating System: iOS</p>\n<h3>Steps to reproduce</h3>\n<ol>\n<li>\n<p>Follow the contrib/makefile/README to install the tensorflow iOS core lib</p>\n</li>\n<li>\n<p>Create my own model using flower's example and shards (<a href=\"https://github.com/tensorflow/models/tree/master/inception\">https://github.com/tensorflow/models/tree/master/inception</a>)</p>\n</li>\n<li>\n<p>Create inference graph by removing shard preprocessing ops and replacing them with:<br>\ninput_ = tf.placeholder(tf.float32, shape=(1, FLAGS.image_size, FLAGS.image_size, 3),<br>\nname='input')<br>\nlogits, _ = inception_model.inference(input_, FLAGS.num_classes + 1)<br>\nsoftmax = tf.nn.softmax(logits, name='softmax')</p>\n<p>And loading a saved checkpoint, restoring it, then writing out a graph def.</p>\n</li>\n<li>\n<p>Apply tensorflow/python/tools/freeze_graph on  graph def</p>\n</li>\n<li>\n<p>Apply tensorflow/python/tools/strip_unused on graph def</p>\n</li>\n<li>\n<p>Copy graph def and labels file into camera example</p>\n</li>\n<li>\n<p>Change objective-C image preprocessing to 299x299, with std &amp; image_mean of 128.</p>\n</li>\n</ol>\n<h3>What have you tried?</h3>\n<ol>\n<li>Running the 'simple' example on the grace hopper image. This works fine</li>\n<li>Running the 'camera' example. This crashes after 3 seconds of the app being open with the output below:</li>\n</ol>\n<h3>Logs or other output that would be helpful</h3>\n<p>/tensorflow/tensorflow/contrib/ios_examples/skinscan/tensorflow_utils.mm:130] Session created.<br>\n/tensorflow/tensorflow/contrib/ios_examples/skinscan/tensorflow_utils.mm:133] Graph created.<br>\ntensorflow/tensorflow/contrib/ios_examples/skinscan/CameraExampleViewController.mm:306] Running model failed:Invalid argument: Session was not created with a graph before Run()!<br>\n2016-07-17 15:47:44.317 CameraExample[1109:39568] Received memory warning.</p>\n<p>It appears that this issue is similar to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"160887253\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/2927\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/2927/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/2927\">#2927</a> . I tried quantizing the graph (tensorflow/contrib/quantization/tools/quantize_graph with --mode=weights), but then ran into a 'quantize ops dont exist' type of error on iOS. It seems those ops need to be built by modifying tensorflow/contrib/makefile/tf_cc_files.txt and tensorflow/contrib/makefile/proto_text_pb_h_files.txt. I have attempting including into both every non-test file and header located in tensorflow/contrib/quantization/kernels, but am running into build-rule errors from the makefile. Unfortunately, I have little knowledge of adjusting makefiles for this type of application.</p>", "body_text": "For bugs or installation issues, please provide the following information.\nThe more information you provide, the more easily we will be able to offer\nhelp and advice.\nEnvironment info\nOperating System: iOS\nSteps to reproduce\n\n\nFollow the contrib/makefile/README to install the tensorflow iOS core lib\n\n\nCreate my own model using flower's example and shards (https://github.com/tensorflow/models/tree/master/inception)\n\n\nCreate inference graph by removing shard preprocessing ops and replacing them with:\ninput_ = tf.placeholder(tf.float32, shape=(1, FLAGS.image_size, FLAGS.image_size, 3),\nname='input')\nlogits, _ = inception_model.inference(input_, FLAGS.num_classes + 1)\nsoftmax = tf.nn.softmax(logits, name='softmax')\nAnd loading a saved checkpoint, restoring it, then writing out a graph def.\n\n\nApply tensorflow/python/tools/freeze_graph on  graph def\n\n\nApply tensorflow/python/tools/strip_unused on graph def\n\n\nCopy graph def and labels file into camera example\n\n\nChange objective-C image preprocessing to 299x299, with std & image_mean of 128.\n\n\nWhat have you tried?\n\nRunning the 'simple' example on the grace hopper image. This works fine\nRunning the 'camera' example. This crashes after 3 seconds of the app being open with the output below:\n\nLogs or other output that would be helpful\n/tensorflow/tensorflow/contrib/ios_examples/skinscan/tensorflow_utils.mm:130] Session created.\n/tensorflow/tensorflow/contrib/ios_examples/skinscan/tensorflow_utils.mm:133] Graph created.\ntensorflow/tensorflow/contrib/ios_examples/skinscan/CameraExampleViewController.mm:306] Running model failed:Invalid argument: Session was not created with a graph before Run()!\n2016-07-17 15:47:44.317 CameraExample[1109:39568] Received memory warning.\nIt appears that this issue is similar to #2927 . I tried quantizing the graph (tensorflow/contrib/quantization/tools/quantize_graph with --mode=weights), but then ran into a 'quantize ops dont exist' type of error on iOS. It seems those ops need to be built by modifying tensorflow/contrib/makefile/tf_cc_files.txt and tensorflow/contrib/makefile/proto_text_pb_h_files.txt. I have attempting including into both every non-test file and header located in tensorflow/contrib/quantization/kernels, but am running into build-rule errors from the makefile. Unfortunately, I have little knowledge of adjusting makefiles for this type of application.", "body": "For bugs or installation issues, please provide the following information.\nThe more information you provide, the more easily we will be able to offer\nhelp and advice.\n### Environment info\n\nOperating System: iOS\n### Steps to reproduce\n1. Follow the contrib/makefile/README to install the tensorflow iOS core lib\n2. Create my own model using flower's example and shards (https://github.com/tensorflow/models/tree/master/inception)\n3. Create inference graph by removing shard preprocessing ops and replacing them with:\n   input_ = tf.placeholder(tf.float32, shape=(1, FLAGS.image_size, FLAGS.image_size, 3),\n            name='input')\n   logits, _ = inception_model.inference(input_, FLAGS.num_classes + 1)\n   softmax = tf.nn.softmax(logits, name='softmax')\n   \n   And loading a saved checkpoint, restoring it, then writing out a graph def.\n4. Apply tensorflow/python/tools/freeze_graph on  graph def\n5. Apply tensorflow/python/tools/strip_unused on graph def\n6. Copy graph def and labels file into camera example\n7. Change objective-C image preprocessing to 299x299, with std & image_mean of 128.\n### What have you tried?\n1. Running the 'simple' example on the grace hopper image. This works fine\n2. Running the 'camera' example. This crashes after 3 seconds of the app being open with the output below:\n### Logs or other output that would be helpful\n\n/tensorflow/tensorflow/contrib/ios_examples/skinscan/tensorflow_utils.mm:130] Session created.\n/tensorflow/tensorflow/contrib/ios_examples/skinscan/tensorflow_utils.mm:133] Graph created.\ntensorflow/tensorflow/contrib/ios_examples/skinscan/CameraExampleViewController.mm:306] Running model failed:Invalid argument: Session was not created with a graph before Run()!\n2016-07-17 15:47:44.317 CameraExample[1109:39568] Received memory warning.\n\nIt appears that this issue is similar to #2927 . I tried quantizing the graph (tensorflow/contrib/quantization/tools/quantize_graph with --mode=weights), but then ran into a 'quantize ops dont exist' type of error on iOS. It seems those ops need to be built by modifying tensorflow/contrib/makefile/tf_cc_files.txt and tensorflow/contrib/makefile/proto_text_pb_h_files.txt. I have attempting including into both every non-test file and header located in tensorflow/contrib/quantization/kernels, but am running into build-rule errors from the makefile. Unfortunately, I have little knowledge of adjusting makefiles for this type of application.\n"}