{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8564", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8564/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8564/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8564/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/8564", "id": 215551990, "node_id": "MDU6SXNzdWUyMTU1NTE5OTA=", "number": 8564, "title": "`tf.test.compute_gradient` gives error when computation involves TensorArrays", "user": {"login": "drasmuss", "id": 1952220, "node_id": "MDQ6VXNlcjE5NTIyMjA=", "avatar_url": "https://avatars1.githubusercontent.com/u/1952220?v=4", "gravatar_id": "", "url": "https://api.github.com/users/drasmuss", "html_url": "https://github.com/drasmuss", "followers_url": "https://api.github.com/users/drasmuss/followers", "following_url": "https://api.github.com/users/drasmuss/following{/other_user}", "gists_url": "https://api.github.com/users/drasmuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/drasmuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/drasmuss/subscriptions", "organizations_url": "https://api.github.com/users/drasmuss/orgs", "repos_url": "https://api.github.com/users/drasmuss/repos", "events_url": "https://api.github.com/users/drasmuss/events{/privacy}", "received_events_url": "https://api.github.com/users/drasmuss/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "open", "locked": false, "assignee": {"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 10, "created_at": "2017-03-20T20:53:44Z", "updated_at": "2018-11-23T18:37:59Z", "closed_at": null, "author_association": "CONTRIBUTOR", "body_html": "<h3>If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)</h3>\n<div class=\"highlight highlight-source-python\"><pre>a <span class=\"pl-k\">=</span> tf.TensorArray(tf.float32, <span class=\"pl-v\">size</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">1</span>)\nx <span class=\"pl-k\">=</span> tf.ones(<span class=\"pl-c1\">5</span>)\na <span class=\"pl-k\">=</span> a.write(<span class=\"pl-c1\">0</span>, x)\ny <span class=\"pl-k\">=</span> a.stack()\n\ngrads <span class=\"pl-k\">=</span> tf.gradients(y, x)\n\n<span class=\"pl-k\">with</span> tf.Session() <span class=\"pl-k\">as</span> sess:\n    <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>y<span class=\"pl-pds\">\"</span></span>)\n    <span class=\"pl-c1\">print</span>(sess.run(y))\n\n    <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>grad<span class=\"pl-pds\">\"</span></span>)\n    <span class=\"pl-c1\">print</span>(sess.run(grads))\n\n    <span class=\"pl-c\"><span class=\"pl-c\">#</span> gives error:</span>\n    tf.test.compute_gradient(x, (<span class=\"pl-c1\">5</span>,), y, (<span class=\"pl-c1\">5</span>,))</pre></div>\n<p>The gradient calculation (<code>sess.run(grads)</code>) works fine, it is just something to do with how the gradients are being calculated within <code>tf.test.compute_gradients</code>.  Here is the stack trace:</p>\n<pre><code>File \"...\\tensorflow\\python\\ops\\gradient_checker.py\", line 312, in compute_gradient\n    dx, dy = _compute_dx_and_dy(x, y, y_shape)\n  File \"...\\tensorflow\\python\\ops\\gradient_checker.py\", line 193, in _compute_dx_and_dy\n    grads = gradients.gradients(y, x, dy)\n  File \"...\\tensorflow\\python\\ops\\gradients_impl.py\", line 560, in gradients\n    grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\n  File \"...\\tensorflow\\python\\ops\\gradients_impl.py\", line 368, in _MaybeCompile\n    return grad_fn()  # Exit early\n  File \"...\\tensorflow\\python\\ops\\gradients_impl.py\", line 560, in &lt;lambda&gt;\n    grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\n  File \"...\\tensorflow\\python\\ops\\tensor_array_grad.py\", line 158, in _TensorArrayGatherGrad\n    grad_source = _GetGradSource(grad)\n  File \"...\\tensorflow\\python\\ops\\tensor_array_grad.py\", line 74, in _GetGradSource\n    \", got: %s\" % op_or_tensor.name)\nValueError: Expected op/tensor name to start with gradients (excluding scope), got: Identity:0\n</code></pre>", "body_text": "If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\na = tf.TensorArray(tf.float32, size=1)\nx = tf.ones(5)\na = a.write(0, x)\ny = a.stack()\n\ngrads = tf.gradients(y, x)\n\nwith tf.Session() as sess:\n    print(\"y\")\n    print(sess.run(y))\n\n    print(\"grad\")\n    print(sess.run(grads))\n\n    # gives error:\n    tf.test.compute_gradient(x, (5,), y, (5,))\nThe gradient calculation (sess.run(grads)) works fine, it is just something to do with how the gradients are being calculated within tf.test.compute_gradients.  Here is the stack trace:\nFile \"...\\tensorflow\\python\\ops\\gradient_checker.py\", line 312, in compute_gradient\n    dx, dy = _compute_dx_and_dy(x, y, y_shape)\n  File \"...\\tensorflow\\python\\ops\\gradient_checker.py\", line 193, in _compute_dx_and_dy\n    grads = gradients.gradients(y, x, dy)\n  File \"...\\tensorflow\\python\\ops\\gradients_impl.py\", line 560, in gradients\n    grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\n  File \"...\\tensorflow\\python\\ops\\gradients_impl.py\", line 368, in _MaybeCompile\n    return grad_fn()  # Exit early\n  File \"...\\tensorflow\\python\\ops\\gradients_impl.py\", line 560, in <lambda>\n    grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\n  File \"...\\tensorflow\\python\\ops\\tensor_array_grad.py\", line 158, in _TensorArrayGatherGrad\n    grad_source = _GetGradSource(grad)\n  File \"...\\tensorflow\\python\\ops\\tensor_array_grad.py\", line 74, in _GetGradSource\n    \", got: %s\" % op_or_tensor.name)\nValueError: Expected op/tensor name to start with gradients (excluding scope), got: Identity:0", "body": "### If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\r\n\r\n``` python\r\na = tf.TensorArray(tf.float32, size=1)\r\nx = tf.ones(5)\r\na = a.write(0, x)\r\ny = a.stack()\r\n\r\ngrads = tf.gradients(y, x)\r\n\r\nwith tf.Session() as sess:\r\n    print(\"y\")\r\n    print(sess.run(y))\r\n\r\n    print(\"grad\")\r\n    print(sess.run(grads))\r\n\r\n    # gives error:\r\n    tf.test.compute_gradient(x, (5,), y, (5,))\r\n```\r\n\r\nThe gradient calculation (`sess.run(grads)`) works fine, it is just something to do with how the gradients are being calculated within `tf.test.compute_gradients`.  Here is the stack trace:\r\n```\r\nFile \"...\\tensorflow\\python\\ops\\gradient_checker.py\", line 312, in compute_gradient\r\n    dx, dy = _compute_dx_and_dy(x, y, y_shape)\r\n  File \"...\\tensorflow\\python\\ops\\gradient_checker.py\", line 193, in _compute_dx_and_dy\r\n    grads = gradients.gradients(y, x, dy)\r\n  File \"...\\tensorflow\\python\\ops\\gradients_impl.py\", line 560, in gradients\r\n    grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\r\n  File \"...\\tensorflow\\python\\ops\\gradients_impl.py\", line 368, in _MaybeCompile\r\n    return grad_fn()  # Exit early\r\n  File \"...\\tensorflow\\python\\ops\\gradients_impl.py\", line 560, in <lambda>\r\n    grad_scope, op, func_call, lambda: grad_fn(op, *out_grads))\r\n  File \"...\\tensorflow\\python\\ops\\tensor_array_grad.py\", line 158, in _TensorArrayGatherGrad\r\n    grad_source = _GetGradSource(grad)\r\n  File \"...\\tensorflow\\python\\ops\\tensor_array_grad.py\", line 74, in _GetGradSource\r\n    \", got: %s\" % op_or_tensor.name)\r\nValueError: Expected op/tensor name to start with gradients (excluding scope), got: Identity:0\r\n```"}