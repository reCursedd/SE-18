{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/313724238", "html_url": "https://github.com/tensorflow/tensorflow/issues/11275#issuecomment-313724238", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11275", "id": 313724238, "node_id": "MDEyOklzc3VlQ29tbWVudDMxMzcyNDIzOA==", "user": {"login": "patrikohlsson", "id": 5068038, "node_id": "MDQ6VXNlcjUwNjgwMzg=", "avatar_url": "https://avatars1.githubusercontent.com/u/5068038?v=4", "gravatar_id": "", "url": "https://api.github.com/users/patrikohlsson", "html_url": "https://github.com/patrikohlsson", "followers_url": "https://api.github.com/users/patrikohlsson/followers", "following_url": "https://api.github.com/users/patrikohlsson/following{/other_user}", "gists_url": "https://api.github.com/users/patrikohlsson/gists{/gist_id}", "starred_url": "https://api.github.com/users/patrikohlsson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/patrikohlsson/subscriptions", "organizations_url": "https://api.github.com/users/patrikohlsson/orgs", "repos_url": "https://api.github.com/users/patrikohlsson/repos", "events_url": "https://api.github.com/users/patrikohlsson/events{/privacy}", "received_events_url": "https://api.github.com/users/patrikohlsson/received_events", "type": "User", "site_admin": false}, "created_at": "2017-07-07T16:06:14Z", "updated_at": "2017-07-10T09:02:34Z", "author_association": "NONE", "body_html": "<p>I'm having the same issue with tfcompile and tf.nn.dynamic_rnn.</p>\n<p>OS:<br>\nUbuntu 16.04<br>\nTF version:<br>\n1.2.1 built from source without GPU support and no XLA JIT.</p>\n<p>Test case:</p>\n<div class=\"highlight highlight-source-python\"><pre>xin <span class=\"pl-k\">=</span> tf.placeholder(tf.float32, [<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">10</span>, <span class=\"pl-c1\">10</span>], <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>input<span class=\"pl-pds\">'</span></span>)\ncell <span class=\"pl-k\">=</span> tf.contrib.rnn.LSTMCell(<span class=\"pl-c1\">512</span>)\nout, _ <span class=\"pl-k\">=</span> tf.nn.dynamic_rnn(cell, xin, <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>tf.float32)\nout <span class=\"pl-k\">=</span> tf.identity(out, <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>output<span class=\"pl-pds\">'</span></span>)\n\nsess <span class=\"pl-k\">=</span> tf.Session()\nsess.run(tf.global_variables_initializer())\n\nsaver <span class=\"pl-k\">=</span> tf.train.Saver()\nsaver.save(sess, <span class=\"pl-s\"><span class=\"pl-pds\">'</span>outgraph<span class=\"pl-pds\">'</span></span>)</pre></div>\n<p>outgraph.config.pbtxt:</p>\n<pre><code>feed {\n  id {\n    node_name: \"input\"\n  }\n  shape {\n    dim { size: 1 }\n    dim { size: 10 }\n    dim { size: 10 }\n  }\n}\n\nfetch {\n  id {\n    node_name: \"output\"\n  }\n}\n</code></pre>\n<p>BUILD file:</p>\n<div class=\"highlight highlight-source-python\"><pre>load(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>//tensorflow/compiler/aot:tfcompile.bzl<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>tf_library<span class=\"pl-pds\">\"</span></span>)\n\ntf_library(\n  <span class=\"pl-v\">name</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>test_dyn_rnn<span class=\"pl-pds\">\"</span></span>,\n  <span class=\"pl-v\">cpp_class</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>TestDynRNN<span class=\"pl-pds\">\"</span></span>,\n  <span class=\"pl-v\">graph</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>outgraph.pb<span class=\"pl-pds\">\"</span></span>,\n  <span class=\"pl-v\">config</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>outgraph.config.pbtxt<span class=\"pl-pds\">\"</span></span>,\n  <span class=\"pl-v\">freeze_checkpoint</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>outgraph.ckpt<span class=\"pl-pds\">\"</span></span>\n)</pre></div>\n<p>Command:<br>\n<code>bazel build //tensorflow/compiler/aot/tests/test_dyn_rnn:test_dyn_rnn</code></p>\n<p>The build command results in <code>INVALID ARGUMENTS: Missing Exit successor to encoder/rnn/while/Switch</code>.<br>\nSwapping to <code>tf.nn.static_rnn</code> works however.</p>\n<p><a href=\"https://gist.github.com/patrikohlsson/955a059d1f89c5339dd6d28d24c7f914\">Here's</a> a complete example.</p>", "body_text": "I'm having the same issue with tfcompile and tf.nn.dynamic_rnn.\nOS:\nUbuntu 16.04\nTF version:\n1.2.1 built from source without GPU support and no XLA JIT.\nTest case:\nxin = tf.placeholder(tf.float32, [1, 10, 10], name='input')\ncell = tf.contrib.rnn.LSTMCell(512)\nout, _ = tf.nn.dynamic_rnn(cell, xin, dtype=tf.float32)\nout = tf.identity(out, name='output')\n\nsess = tf.Session()\nsess.run(tf.global_variables_initializer())\n\nsaver = tf.train.Saver()\nsaver.save(sess, 'outgraph')\noutgraph.config.pbtxt:\nfeed {\n  id {\n    node_name: \"input\"\n  }\n  shape {\n    dim { size: 1 }\n    dim { size: 10 }\n    dim { size: 10 }\n  }\n}\n\nfetch {\n  id {\n    node_name: \"output\"\n  }\n}\n\nBUILD file:\nload(\"//tensorflow/compiler/aot:tfcompile.bzl\", \"tf_library\")\n\ntf_library(\n  name = \"test_dyn_rnn\",\n  cpp_class = \"TestDynRNN\",\n  graph = \"outgraph.pb\",\n  config = \"outgraph.config.pbtxt\",\n  freeze_checkpoint = \"outgraph.ckpt\"\n)\nCommand:\nbazel build //tensorflow/compiler/aot/tests/test_dyn_rnn:test_dyn_rnn\nThe build command results in INVALID ARGUMENTS: Missing Exit successor to encoder/rnn/while/Switch.\nSwapping to tf.nn.static_rnn works however.\nHere's a complete example.", "body": "I'm having the same issue with tfcompile and tf.nn.dynamic_rnn.\r\n\r\nOS:\r\nUbuntu 16.04\r\nTF version:\r\n1.2.1 built from source without GPU support and no XLA JIT.\r\n\r\nTest case:\r\n```python\r\nxin = tf.placeholder(tf.float32, [1, 10, 10], name='input')\r\ncell = tf.contrib.rnn.LSTMCell(512)\r\nout, _ = tf.nn.dynamic_rnn(cell, xin, dtype=tf.float32)\r\nout = tf.identity(out, name='output')\r\n\r\nsess = tf.Session()\r\nsess.run(tf.global_variables_initializer())\r\n\r\nsaver = tf.train.Saver()\r\nsaver.save(sess, 'outgraph')\r\n```\r\n\r\noutgraph.config.pbtxt:\r\n```\r\nfeed {\r\n  id {\r\n    node_name: \"input\"\r\n  }\r\n  shape {\r\n    dim { size: 1 }\r\n    dim { size: 10 }\r\n    dim { size: 10 }\r\n  }\r\n}\r\n\r\nfetch {\r\n  id {\r\n    node_name: \"output\"\r\n  }\r\n}\r\n```\r\n\r\nBUILD file:\r\n```python\r\nload(\"//tensorflow/compiler/aot:tfcompile.bzl\", \"tf_library\")\r\n\r\ntf_library(\r\n  name = \"test_dyn_rnn\",\r\n  cpp_class = \"TestDynRNN\",\r\n  graph = \"outgraph.pb\",\r\n  config = \"outgraph.config.pbtxt\",\r\n  freeze_checkpoint = \"outgraph.ckpt\"\r\n)\r\n```\r\n\r\nCommand:\r\n`bazel build //tensorflow/compiler/aot/tests/test_dyn_rnn:test_dyn_rnn`\r\n\r\nThe build command results in `INVALID ARGUMENTS: Missing Exit successor to encoder/rnn/while/Switch`.\r\nSwapping to `tf.nn.static_rnn` works however.\r\n\r\n[Here's](https://gist.github.com/patrikohlsson/955a059d1f89c5339dd6d28d24c7f914) a complete example."}