{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14801", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14801/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14801/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14801/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/14801", "id": 276130886, "node_id": "MDU6SXNzdWUyNzYxMzA4ODY=", "number": 14801, "title": "On the way to latest CMake, VS2017, CUDA 9, cudNN 7, Win10", "user": {"login": "sylvain-bougnoux", "id": 6706662, "node_id": "MDQ6VXNlcjY3MDY2NjI=", "avatar_url": "https://avatars1.githubusercontent.com/u/6706662?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sylvain-bougnoux", "html_url": "https://github.com/sylvain-bougnoux", "followers_url": "https://api.github.com/users/sylvain-bougnoux/followers", "following_url": "https://api.github.com/users/sylvain-bougnoux/following{/other_user}", "gists_url": "https://api.github.com/users/sylvain-bougnoux/gists{/gist_id}", "starred_url": "https://api.github.com/users/sylvain-bougnoux/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sylvain-bougnoux/subscriptions", "organizations_url": "https://api.github.com/users/sylvain-bougnoux/orgs", "repos_url": "https://api.github.com/users/sylvain-bougnoux/repos", "events_url": "https://api.github.com/users/sylvain-bougnoux/events{/privacy}", "received_events_url": "https://api.github.com/users/sylvain-bougnoux/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586558, "node_id": "MDU6TGFiZWw0MDQ1ODY1NTg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:community%20support", "name": "stat:community support", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "gunan", "id": 7946809, "node_id": "MDQ6VXNlcjc5NDY4MDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/7946809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gunan", "html_url": "https://github.com/gunan", "followers_url": "https://api.github.com/users/gunan/followers", "following_url": "https://api.github.com/users/gunan/following{/other_user}", "gists_url": "https://api.github.com/users/gunan/gists{/gist_id}", "starred_url": "https://api.github.com/users/gunan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gunan/subscriptions", "organizations_url": "https://api.github.com/users/gunan/orgs", "repos_url": "https://api.github.com/users/gunan/repos", "events_url": "https://api.github.com/users/gunan/events{/privacy}", "received_events_url": "https://api.github.com/users/gunan/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "gunan", "id": 7946809, "node_id": "MDQ6VXNlcjc5NDY4MDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/7946809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gunan", "html_url": "https://github.com/gunan", "followers_url": "https://api.github.com/users/gunan/followers", "following_url": "https://api.github.com/users/gunan/following{/other_user}", "gists_url": "https://api.github.com/users/gunan/gists{/gist_id}", "starred_url": "https://api.github.com/users/gunan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gunan/subscriptions", "organizations_url": "https://api.github.com/users/gunan/orgs", "repos_url": "https://api.github.com/users/gunan/repos", "events_url": "https://api.github.com/users/gunan/events{/privacy}", "received_events_url": "https://api.github.com/users/gunan/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2017-11-22T16:30:20Z", "updated_at": "2017-11-30T07:31:59Z", "closed_at": "2017-11-30T00:49:50Z", "author_association": "NONE", "body_html": "<p>As many of us (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"269996549\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/14126\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/14126/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/14126\">#14126</a>,<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"275089746\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/14691\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/14691/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/14691\">#14691</a>,<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"248135560\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/12052\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/12052/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/12052\">#12052</a>), I am trying to get TF1.4 build successfully on windows using the latest version of everything. As far as I can judge <strong>I could do it</strong> but with some hacks. As it is too long for me to complete, I would like to share what I did for help finalizing. It is too early for a PR.</p>\n<p>I am using CMake 3.9.6 (though 3.10 came out). I have low cmake skill level.<br>\nI am not trying the python bindings.<br>\nVS2017 is the community edition.</p>\n<p>Without GPU it is easy. The only issue is the heap overflow (C1002 or C1006 <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"239041379\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/11096\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/11096/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/11096\">#11096</a>). The trick is to reduce parallel build by <code>msbuild /m:4 /p:CL_MPCount=2 ...</code> such that 4*2 is approximately the number of core you really have (at least it worked for me). Using <code>/Zm2000</code> did not work for me, despite a lot of available memory (32G).</p>\n<p>With GPU it is more tricky: the <code>tf_core_gpu_kernels.vcxproj</code> does not compile at all. AFAIU, the CMake strategy changed from v3.6, to allow parallel computing. CUDA is now treated as another language. Without modifications nvcc simply returns with code error 1 (or nothing happen I am not sure). Here are my modifications (from v1.4).</p>\n<p>From <code>tensorflow/tensorflow/contrib/cmake/</code><br>\n1/ adapt <code>cmakelists.txt</code> a little:</p>\n<ul>\n<li>Change <code>CUDA 8.0</code> to <code>CUDA 9.0</code> l.223.</li>\n<li>Add <code>enable_language(\"CUDA\")</code> l.224.</li>\n<li><strong>The <code>set(CUDA_NVCC_FLAGS ...)</code> directives do not work anymore</strong>. See below.</li>\n<li>Add capabilities 6.0 and 6.1 in l.232, as well l.246. Might not be needed (it is only for performance).</li>\n<li>Change <code>64_80</code> to <code>64_90</code> and <code>64_6</code> to <code>64_7</code> l.247 and 248, similarly in l.272-276.</li>\n</ul>\n<p>2/ in <code>tf_core_kernels.cmake</code>:</p>\n<ul>\n<li>Add <code>set_source_files_properties(${tf_core_gpu_kernels_srcs} PROPERTIES LANGUAGE CUDA)</code> to recognize '.cu.cc' extensions as cuda files in l.209.</li>\n<li>Rename <code>cuda_add_library(...)</code> as <code>add_library(...)</code> l.210.</li>\n</ul>\n<p>3/ edit <strong>(this is the trick)</strong> <code>tf_core_gpu_kernels.vcxproj</code>, in the release section:</p>\n<ul>\n<li>Encompass cl.exe flags, ie <code>/bigobj /nologo ... -Ob2</code>  with the <code>-Xcompiler=\"/bigobj ... -Ob2\"</code> directive l.147. These former flags are for the c++ compiler not for nvcc and result in the crash.</li>\n<li>Add just before <code>--expt-relaxed-constexpr</code>, still in the <code>AdditionalOptions</code>.</li>\n<li>Switch <code>PerformDeviceLink</code>from <code>false</code> to <code>true</code> l.164.</li>\n</ul>\n<p>Then everything compile (msbuild on  tf_tutorials_example_trainer.vcxproj) (and this tuto works). The remaining point before PR is to avoid third step, i.e. give the right directives to nvcc, by understanding how the CUDA_NVCC_FLAGS works, and add the linking. Hope this solution will work without missing symbols (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"196378243\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/6396\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/6396/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/6396\">#6396</a>).</p>\n<p>Otherwise it is a nightmare: both CUDA 8 and CMake 3.6 are not aware of VS2017. CMake compilation is not incremental (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"270841160\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/14194\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/14194/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/14194\">#14194</a>) and takes about 4-5H (could use precompiled headers especially in tf_core_kernels)...</p>", "body_text": "As many of us (#14126,#14691,#12052), I am trying to get TF1.4 build successfully on windows using the latest version of everything. As far as I can judge I could do it but with some hacks. As it is too long for me to complete, I would like to share what I did for help finalizing. It is too early for a PR.\nI am using CMake 3.9.6 (though 3.10 came out). I have low cmake skill level.\nI am not trying the python bindings.\nVS2017 is the community edition.\nWithout GPU it is easy. The only issue is the heap overflow (C1002 or C1006 #11096). The trick is to reduce parallel build by msbuild /m:4 /p:CL_MPCount=2 ... such that 4*2 is approximately the number of core you really have (at least it worked for me). Using /Zm2000 did not work for me, despite a lot of available memory (32G).\nWith GPU it is more tricky: the tf_core_gpu_kernels.vcxproj does not compile at all. AFAIU, the CMake strategy changed from v3.6, to allow parallel computing. CUDA is now treated as another language. Without modifications nvcc simply returns with code error 1 (or nothing happen I am not sure). Here are my modifications (from v1.4).\nFrom tensorflow/tensorflow/contrib/cmake/\n1/ adapt cmakelists.txt a little:\n\nChange CUDA 8.0 to CUDA 9.0 l.223.\nAdd enable_language(\"CUDA\") l.224.\nThe set(CUDA_NVCC_FLAGS ...) directives do not work anymore. See below.\nAdd capabilities 6.0 and 6.1 in l.232, as well l.246. Might not be needed (it is only for performance).\nChange 64_80 to 64_90 and 64_6 to 64_7 l.247 and 248, similarly in l.272-276.\n\n2/ in tf_core_kernels.cmake:\n\nAdd set_source_files_properties(${tf_core_gpu_kernels_srcs} PROPERTIES LANGUAGE CUDA) to recognize '.cu.cc' extensions as cuda files in l.209.\nRename cuda_add_library(...) as add_library(...) l.210.\n\n3/ edit (this is the trick) tf_core_gpu_kernels.vcxproj, in the release section:\n\nEncompass cl.exe flags, ie /bigobj /nologo ... -Ob2  with the -Xcompiler=\"/bigobj ... -Ob2\" directive l.147. These former flags are for the c++ compiler not for nvcc and result in the crash.\nAdd just before --expt-relaxed-constexpr, still in the AdditionalOptions.\nSwitch PerformDeviceLinkfrom false to true l.164.\n\nThen everything compile (msbuild on  tf_tutorials_example_trainer.vcxproj) (and this tuto works). The remaining point before PR is to avoid third step, i.e. give the right directives to nvcc, by understanding how the CUDA_NVCC_FLAGS works, and add the linking. Hope this solution will work without missing symbols (#6396).\nOtherwise it is a nightmare: both CUDA 8 and CMake 3.6 are not aware of VS2017. CMake compilation is not incremental (#14194) and takes about 4-5H (could use precompiled headers especially in tf_core_kernels)...", "body": "As many of us (#14126,#14691,#12052), I am trying to get TF1.4 build successfully on windows using the latest version of everything. As far as I can judge **I could do it** but with some hacks. As it is too long for me to complete, I would like to share what I did for help finalizing. It is too early for a PR.\r\n\r\nI am using CMake 3.9.6 (though 3.10 came out). I have low cmake skill level.\r\nI am not trying the python bindings.\r\nVS2017 is the community edition.\r\n\r\nWithout GPU it is easy. The only issue is the heap overflow (C1002 or C1006 #11096). The trick is to reduce parallel build by `msbuild /m:4 /p:CL_MPCount=2 ...` such that 4*2 is approximately the number of core you really have (at least it worked for me). Using `/Zm2000` did not work for me, despite a lot of available memory (32G).\r\n\r\nWith GPU it is more tricky: the `tf_core_gpu_kernels.vcxproj` does not compile at all. AFAIU, the CMake strategy changed from v3.6, to allow parallel computing. CUDA is now treated as another language. Without modifications nvcc simply returns with code error 1 (or nothing happen I am not sure). Here are my modifications (from v1.4).\r\n\r\nFrom `tensorflow/tensorflow/contrib/cmake/`\r\n1/ adapt `cmakelists.txt` a little: \r\n- Change `CUDA 8.0` to `CUDA 9.0` l.223.\r\n- Add `enable_language(\"CUDA\")` l.224.\r\n- **The `set(CUDA_NVCC_FLAGS ...)` directives do not work anymore**. See below.\r\n- Add capabilities 6.0 and 6.1 in l.232, as well l.246. Might not be needed (it is only for performance).\r\n- Change `64_80` to `64_90` and `64_6` to `64_7` l.247 and 248, similarly in l.272-276.\r\n\r\n2/ in `tf_core_kernels.cmake`:\r\n- Add `set_source_files_properties(${tf_core_gpu_kernels_srcs} PROPERTIES LANGUAGE CUDA)` to recognize '.cu.cc' extensions as cuda files in l.209.\r\n- Rename `cuda_add_library(...)` as `add_library(...)` l.210.\r\n\r\n3/ edit **(this is the trick)** `tf_core_gpu_kernels.vcxproj`, in the release section:\r\n- Encompass cl.exe flags, ie `/bigobj /nologo ... -Ob2`  with the `-Xcompiler=\"/bigobj ... -Ob2\"` directive l.147. These former flags are for the c++ compiler not for nvcc and result in the crash.\r\n- Add just before `--expt-relaxed-constexpr`, still in the `AdditionalOptions`.\r\n- Switch `PerformDeviceLink`from `false` to `true` l.164.\r\n\r\nThen everything compile (msbuild on  tf_tutorials_example_trainer.vcxproj) (and this tuto works). The remaining point before PR is to avoid third step, i.e. give the right directives to nvcc, by understanding how the CUDA_NVCC_FLAGS works, and add the linking. Hope this solution will work without missing symbols (#6396).\r\n\r\nOtherwise it is a nightmare: both CUDA 8 and CMake 3.6 are not aware of VS2017. CMake compilation is not incremental (#14194) and takes about 4-5H (could use precompiled headers especially in tf_core_kernels)...\r\n"}