{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/430580719", "html_url": "https://github.com/tensorflow/tensorflow/issues/22889#issuecomment-430580719", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22889", "id": 430580719, "node_id": "MDEyOklzc3VlQ29tbWVudDQzMDU4MDcxOQ==", "user": {"login": "magnofel", "id": 18593247, "node_id": "MDQ6VXNlcjE4NTkzMjQ3", "avatar_url": "https://avatars1.githubusercontent.com/u/18593247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/magnofel", "html_url": "https://github.com/magnofel", "followers_url": "https://api.github.com/users/magnofel/followers", "following_url": "https://api.github.com/users/magnofel/following{/other_user}", "gists_url": "https://api.github.com/users/magnofel/gists{/gist_id}", "starred_url": "https://api.github.com/users/magnofel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/magnofel/subscriptions", "organizations_url": "https://api.github.com/users/magnofel/orgs", "repos_url": "https://api.github.com/users/magnofel/repos", "events_url": "https://api.github.com/users/magnofel/events{/privacy}", "received_events_url": "https://api.github.com/users/magnofel/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-17T10:45:44Z", "updated_at": "2018-10-17T11:23:12Z", "author_association": "NONE", "body_html": "<p>have same problem. Stuck after variable initialization.</p>\n<p>Have I written custom code: N/A<br>\nOS Platform and Distribution: Ubuntu 18.04<br>\nTensorFlow installed from: (pip install tensorflow-gpu)<br>\nTensorFlow version: 1.11.0<br>\nBazel version: N/A<br>\nGPU model and memory: 1080ti<br>\nExact command to reproduce: see code below<br>\nMobile device: N/A<br>\nCUDA/cuDNN version: cuda 10.0 with cudnn7.3.1.20</p>\n<pre><code>import tensorflow as tf\ndef model_fn(features, labels, mode):\n  layer = tf.layers.Dense(1)\n  logits = layer(features)\n\n  if mode == tf.estimator.ModeKeys.PREDICT:\n    predictions = {\"logits\": logits}\n    return tf.estimator.EstimatorSpec(mode, predictions=predictions)\n\n  loss = tf.losses.mean_squared_error(\n      labels=labels, predictions=tf.reshape(logits, []))\n\n  if mode == tf.estimator.ModeKeys.EVAL:\n    return tf.estimator.EstimatorSpec(mode, loss=loss)\n\n  if mode == tf.estimator.ModeKeys.TRAIN:\n    train_op = tf.train.GradientDescentOptimizer(0.2).minimize(loss)\n    return tf.estimator.EstimatorSpec(mode, loss=loss, train_op=train_op)\n\ndef input_fn():\n  features = tf.data.Dataset.from_tensors([[1.]]).repeat(100)\n  labels = tf.data.Dataset.from_tensors(1.).repeat(100)\n  return tf.data.Dataset.zip((features, labels))\n\n\ndistribution = tf.contrib.distribute.MirroredStrategy()\nconfig = tf.estimator.RunConfig(train_distribute=distribution)\nclassifier = tf.estimator.Estimator(model_fn=model_fn, config=config)\nclassifier.train(input_fn=input_fn)\nclassifier.evaluate(input_fn=input_fn)\n</code></pre>\n<p>output:</p>\n<pre><code>INFO:tensorflow:Initializing RunConfig with distribution strategies.\nINFO:tensorflow:Not using Distribute Coordinator.\nWARNING:tensorflow:Using temporary folder as model directory: /tmp/tmpcqwt3jg0\nINFO:tensorflow:Using config: {'_model_dir': '/tmp/tmpcqwt3jg0', '_tf_random_seed': None, '_save_summary_steps': 100, '_save_checkpoints_steps': None, '_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true\ngraph_options {\n  rewrite_options {\n    meta_optimizer_iterations: ONE\n  }\n}\n, '_keep_checkpoint_max': 5, '_keep_checkpoint_every_n_hours': 10000, '_log_step_count_steps': 100, '_train_distribute': &lt;tensorflow.contrib.distribute.python.mirrored_strategy.MirroredStrategy object at 0x7fe0e5733e80&gt;, '_device_fn': None, '_protocol': None, '_eval_distribute': None, '_experimental_distribute': None, '_service': None, '_cluster_spec': &lt;tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe0e5733f98&gt;, '_task_type': 'worker', '_task_id': 0, '_global_id_in_cluster': 0, '_master': '', '_evaluation_master': '', '_is_chief': True, '_num_ps_replicas': 0, '_num_worker_replicas': 1, '_distribute_coordinator_mode': None}\nINFO:tensorflow:Device is available but not used by distribute strategy: /device:CPU:0\nINFO:tensorflow:Configured nccl all-reduce.\nINFO:tensorflow:Calling model_fn.\nINFO:tensorflow:Calling model_fn.\nINFO:tensorflow:Calling model_fn.\nINFO:tensorflow:Calling model_fn.\nINFO:tensorflow:batch_all_reduce invoked for batches size = 2 with algorithm = nccl, num_packs = 1, agg_small_grads_max_bytes = 0 and agg_small_grads_max_group = 10\nINFO:tensorflow:Done calling model_fn.\nINFO:tensorflow:Done calling model_fn.\nINFO:tensorflow:Done calling model_fn.\nINFO:tensorflow:Done calling model_fn.\nINFO:tensorflow:Create CheckpointSaverHook.\nINFO:tensorflow:Graph was finalized.\nINFO:tensorflow:Running local_init_op.\nINFO:tensorflow:Done running local_init_op.\nINFO:tensorflow:Saving checkpoints for 0 into /tmp/tmpcqwt3jg0/model.ckpt.\nINFO:tensorflow:Initialize system\n</code></pre>", "body_text": "have same problem. Stuck after variable initialization.\nHave I written custom code: N/A\nOS Platform and Distribution: Ubuntu 18.04\nTensorFlow installed from: (pip install tensorflow-gpu)\nTensorFlow version: 1.11.0\nBazel version: N/A\nGPU model and memory: 1080ti\nExact command to reproduce: see code below\nMobile device: N/A\nCUDA/cuDNN version: cuda 10.0 with cudnn7.3.1.20\nimport tensorflow as tf\ndef model_fn(features, labels, mode):\n  layer = tf.layers.Dense(1)\n  logits = layer(features)\n\n  if mode == tf.estimator.ModeKeys.PREDICT:\n    predictions = {\"logits\": logits}\n    return tf.estimator.EstimatorSpec(mode, predictions=predictions)\n\n  loss = tf.losses.mean_squared_error(\n      labels=labels, predictions=tf.reshape(logits, []))\n\n  if mode == tf.estimator.ModeKeys.EVAL:\n    return tf.estimator.EstimatorSpec(mode, loss=loss)\n\n  if mode == tf.estimator.ModeKeys.TRAIN:\n    train_op = tf.train.GradientDescentOptimizer(0.2).minimize(loss)\n    return tf.estimator.EstimatorSpec(mode, loss=loss, train_op=train_op)\n\ndef input_fn():\n  features = tf.data.Dataset.from_tensors([[1.]]).repeat(100)\n  labels = tf.data.Dataset.from_tensors(1.).repeat(100)\n  return tf.data.Dataset.zip((features, labels))\n\n\ndistribution = tf.contrib.distribute.MirroredStrategy()\nconfig = tf.estimator.RunConfig(train_distribute=distribution)\nclassifier = tf.estimator.Estimator(model_fn=model_fn, config=config)\nclassifier.train(input_fn=input_fn)\nclassifier.evaluate(input_fn=input_fn)\n\noutput:\nINFO:tensorflow:Initializing RunConfig with distribution strategies.\nINFO:tensorflow:Not using Distribute Coordinator.\nWARNING:tensorflow:Using temporary folder as model directory: /tmp/tmpcqwt3jg0\nINFO:tensorflow:Using config: {'_model_dir': '/tmp/tmpcqwt3jg0', '_tf_random_seed': None, '_save_summary_steps': 100, '_save_checkpoints_steps': None, '_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true\ngraph_options {\n  rewrite_options {\n    meta_optimizer_iterations: ONE\n  }\n}\n, '_keep_checkpoint_max': 5, '_keep_checkpoint_every_n_hours': 10000, '_log_step_count_steps': 100, '_train_distribute': <tensorflow.contrib.distribute.python.mirrored_strategy.MirroredStrategy object at 0x7fe0e5733e80>, '_device_fn': None, '_protocol': None, '_eval_distribute': None, '_experimental_distribute': None, '_service': None, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe0e5733f98>, '_task_type': 'worker', '_task_id': 0, '_global_id_in_cluster': 0, '_master': '', '_evaluation_master': '', '_is_chief': True, '_num_ps_replicas': 0, '_num_worker_replicas': 1, '_distribute_coordinator_mode': None}\nINFO:tensorflow:Device is available but not used by distribute strategy: /device:CPU:0\nINFO:tensorflow:Configured nccl all-reduce.\nINFO:tensorflow:Calling model_fn.\nINFO:tensorflow:Calling model_fn.\nINFO:tensorflow:Calling model_fn.\nINFO:tensorflow:Calling model_fn.\nINFO:tensorflow:batch_all_reduce invoked for batches size = 2 with algorithm = nccl, num_packs = 1, agg_small_grads_max_bytes = 0 and agg_small_grads_max_group = 10\nINFO:tensorflow:Done calling model_fn.\nINFO:tensorflow:Done calling model_fn.\nINFO:tensorflow:Done calling model_fn.\nINFO:tensorflow:Done calling model_fn.\nINFO:tensorflow:Create CheckpointSaverHook.\nINFO:tensorflow:Graph was finalized.\nINFO:tensorflow:Running local_init_op.\nINFO:tensorflow:Done running local_init_op.\nINFO:tensorflow:Saving checkpoints for 0 into /tmp/tmpcqwt3jg0/model.ckpt.\nINFO:tensorflow:Initialize system", "body": "have same problem. Stuck after variable initialization.\r\n\r\n\r\n\r\nHave I written custom code: N/A\r\nOS Platform and Distribution: Ubuntu 18.04\r\nTensorFlow installed from: (pip install tensorflow-gpu)\r\nTensorFlow version: 1.11.0\r\nBazel version: N/A\r\nGPU model and memory: 1080ti\r\nExact command to reproduce: see code below\r\nMobile device: N/A\r\nCUDA/cuDNN version: cuda 10.0 with cudnn7.3.1.20\r\n\r\n\r\n```\r\nimport tensorflow as tf\r\ndef model_fn(features, labels, mode):\r\n  layer = tf.layers.Dense(1)\r\n  logits = layer(features)\r\n\r\n  if mode == tf.estimator.ModeKeys.PREDICT:\r\n    predictions = {\"logits\": logits}\r\n    return tf.estimator.EstimatorSpec(mode, predictions=predictions)\r\n\r\n  loss = tf.losses.mean_squared_error(\r\n      labels=labels, predictions=tf.reshape(logits, []))\r\n\r\n  if mode == tf.estimator.ModeKeys.EVAL:\r\n    return tf.estimator.EstimatorSpec(mode, loss=loss)\r\n\r\n  if mode == tf.estimator.ModeKeys.TRAIN:\r\n    train_op = tf.train.GradientDescentOptimizer(0.2).minimize(loss)\r\n    return tf.estimator.EstimatorSpec(mode, loss=loss, train_op=train_op)\r\n\r\ndef input_fn():\r\n  features = tf.data.Dataset.from_tensors([[1.]]).repeat(100)\r\n  labels = tf.data.Dataset.from_tensors(1.).repeat(100)\r\n  return tf.data.Dataset.zip((features, labels))\r\n\r\n\r\ndistribution = tf.contrib.distribute.MirroredStrategy()\r\nconfig = tf.estimator.RunConfig(train_distribute=distribution)\r\nclassifier = tf.estimator.Estimator(model_fn=model_fn, config=config)\r\nclassifier.train(input_fn=input_fn)\r\nclassifier.evaluate(input_fn=input_fn)\r\n```\r\n\r\n\r\n\r\noutput:\r\n\r\n```\r\nINFO:tensorflow:Initializing RunConfig with distribution strategies.\r\nINFO:tensorflow:Not using Distribute Coordinator.\r\nWARNING:tensorflow:Using temporary folder as model directory: /tmp/tmpcqwt3jg0\r\nINFO:tensorflow:Using config: {'_model_dir': '/tmp/tmpcqwt3jg0', '_tf_random_seed': None, '_save_summary_steps': 100, '_save_checkpoints_steps': None, '_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true\r\ngraph_options {\r\n  rewrite_options {\r\n    meta_optimizer_iterations: ONE\r\n  }\r\n}\r\n, '_keep_checkpoint_max': 5, '_keep_checkpoint_every_n_hours': 10000, '_log_step_count_steps': 100, '_train_distribute': <tensorflow.contrib.distribute.python.mirrored_strategy.MirroredStrategy object at 0x7fe0e5733e80>, '_device_fn': None, '_protocol': None, '_eval_distribute': None, '_experimental_distribute': None, '_service': None, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe0e5733f98>, '_task_type': 'worker', '_task_id': 0, '_global_id_in_cluster': 0, '_master': '', '_evaluation_master': '', '_is_chief': True, '_num_ps_replicas': 0, '_num_worker_replicas': 1, '_distribute_coordinator_mode': None}\r\nINFO:tensorflow:Device is available but not used by distribute strategy: /device:CPU:0\r\nINFO:tensorflow:Configured nccl all-reduce.\r\nINFO:tensorflow:Calling model_fn.\r\nINFO:tensorflow:Calling model_fn.\r\nINFO:tensorflow:Calling model_fn.\r\nINFO:tensorflow:Calling model_fn.\r\nINFO:tensorflow:batch_all_reduce invoked for batches size = 2 with algorithm = nccl, num_packs = 1, agg_small_grads_max_bytes = 0 and agg_small_grads_max_group = 10\r\nINFO:tensorflow:Done calling model_fn.\r\nINFO:tensorflow:Done calling model_fn.\r\nINFO:tensorflow:Done calling model_fn.\r\nINFO:tensorflow:Done calling model_fn.\r\nINFO:tensorflow:Create CheckpointSaverHook.\r\nINFO:tensorflow:Graph was finalized.\r\nINFO:tensorflow:Running local_init_op.\r\nINFO:tensorflow:Done running local_init_op.\r\nINFO:tensorflow:Saving checkpoints for 0 into /tmp/tmpcqwt3jg0/model.ckpt.\r\nINFO:tensorflow:Initialize system\r\n```"}