{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/310284269", "html_url": "https://github.com/tensorflow/tensorflow/issues/9724#issuecomment-310284269", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9724", "id": 310284269, "node_id": "MDEyOklzc3VlQ29tbWVudDMxMDI4NDI2OQ==", "user": {"login": "xiusir", "id": 23228998, "node_id": "MDQ6VXNlcjIzMjI4OTk4", "avatar_url": "https://avatars2.githubusercontent.com/u/23228998?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xiusir", "html_url": "https://github.com/xiusir", "followers_url": "https://api.github.com/users/xiusir/followers", "following_url": "https://api.github.com/users/xiusir/following{/other_user}", "gists_url": "https://api.github.com/users/xiusir/gists{/gist_id}", "starred_url": "https://api.github.com/users/xiusir/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xiusir/subscriptions", "organizations_url": "https://api.github.com/users/xiusir/orgs", "repos_url": "https://api.github.com/users/xiusir/repos", "events_url": "https://api.github.com/users/xiusir/events{/privacy}", "received_events_url": "https://api.github.com/users/xiusir/received_events", "type": "User", "site_admin": false}, "created_at": "2017-06-22T06:03:30Z", "updated_at": "2017-06-22T06:08:24Z", "author_association": "NONE", "body_html": "<p>Same Problem.<br>\n<a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=161459\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/petewarden\">@petewarden</a></p>\n<p>I use freeze_graph to export my model to a file named \"frozen.pb\". But Found that the accuracy of predictions on frozen.pb is very poor.</p>\n<p>I know the problem maybe MovingAverage not included in frozen.pb or not loaded in prediction.</p>\n<p>When I use model.ckpt files to restore model for evaluating, if i call tf.train.ExponentialMovingAverage(0.999); variables_to_restore = variable_averages.variables_to_restore(); saver = tf.train.Saver(variables_to_restore) , then the accuracy is good as expected, else the accuracy is bad.</p>\n<p>So How To export a binary model which performance is the same as the one restored from checkpoint files? I want to use \".pb\" files in Android Devices.</p>\n<p>Thank you!</p>\n<p>Freeze Command:</p>\n<pre><code>~/bazel-bin/tensorflow/python/tools/freeze_graph \\\n  --input_graph=./graph.pbtxt \\\n  --input_checkpoint=./model.ckpt-100000 \\\n  --output_graph=frozen.pb \\\n  --output_node_names=output  \\\n  --restore_op_name=save/restore_all \\\n  --clear_devices\n</code></pre>\n<p><a href=\"https://stackoverflow.com/questions/44690363/how-to-use-tf-train-exponentialmovingaverage-in-android-ios\" rel=\"nofollow\">More code at StackOverflow</a></p>", "body_text": "Same Problem.\n@petewarden\nI use freeze_graph to export my model to a file named \"frozen.pb\". But Found that the accuracy of predictions on frozen.pb is very poor.\nI know the problem maybe MovingAverage not included in frozen.pb or not loaded in prediction.\nWhen I use model.ckpt files to restore model for evaluating, if i call tf.train.ExponentialMovingAverage(0.999); variables_to_restore = variable_averages.variables_to_restore(); saver = tf.train.Saver(variables_to_restore) , then the accuracy is good as expected, else the accuracy is bad.\nSo How To export a binary model which performance is the same as the one restored from checkpoint files? I want to use \".pb\" files in Android Devices.\nThank you!\nFreeze Command:\n~/bazel-bin/tensorflow/python/tools/freeze_graph \\\n  --input_graph=./graph.pbtxt \\\n  --input_checkpoint=./model.ckpt-100000 \\\n  --output_graph=frozen.pb \\\n  --output_node_names=output  \\\n  --restore_op_name=save/restore_all \\\n  --clear_devices\n\nMore code at StackOverflow", "body": "Same Problem.   \r\n@petewarden \r\n\r\nI use freeze_graph to export my model to a file named \"frozen.pb\". But Found that the accuracy of predictions on frozen.pb is very poor.\r\n\r\nI know the problem maybe MovingAverage not included in frozen.pb or not loaded in prediction.\r\n\r\nWhen I use model.ckpt files to restore model for evaluating, if i call tf.train.ExponentialMovingAverage(0.999); variables_to_restore = variable_averages.variables_to_restore(); saver = tf.train.Saver(variables_to_restore) , then the accuracy is good as expected, else the accuracy is bad.\r\n\r\nSo How To export a binary model which performance is the same as the one restored from checkpoint files? I want to use \".pb\" files in Android Devices.\r\n\r\nThank you!\r\n\r\nFreeze Command:\r\n```\r\n~/bazel-bin/tensorflow/python/tools/freeze_graph \\\r\n  --input_graph=./graph.pbtxt \\\r\n  --input_checkpoint=./model.ckpt-100000 \\\r\n  --output_graph=frozen.pb \\\r\n  --output_node_names=output  \\\r\n  --restore_op_name=save/restore_all \\\r\n  --clear_devices\r\n```\r\n[More code at StackOverflow](https://stackoverflow.com/questions/44690363/how-to-use-tf-train-exponentialmovingaverage-in-android-ios)\r\n"}