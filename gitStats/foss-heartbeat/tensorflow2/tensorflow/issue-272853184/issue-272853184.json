{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14442", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14442/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14442/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14442/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/14442", "id": 272853184, "node_id": "MDU6SXNzdWUyNzI4NTMxODQ=", "number": 14442, "title": "Session.run() hangs in child thread if something was executed in main thread first", "user": {"login": "JosPolfliet", "id": 12380065, "node_id": "MDQ6VXNlcjEyMzgwMDY1", "avatar_url": "https://avatars0.githubusercontent.com/u/12380065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JosPolfliet", "html_url": "https://github.com/JosPolfliet", "followers_url": "https://api.github.com/users/JosPolfliet/followers", "following_url": "https://api.github.com/users/JosPolfliet/following{/other_user}", "gists_url": "https://api.github.com/users/JosPolfliet/gists{/gist_id}", "starred_url": "https://api.github.com/users/JosPolfliet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JosPolfliet/subscriptions", "organizations_url": "https://api.github.com/users/JosPolfliet/orgs", "repos_url": "https://api.github.com/users/JosPolfliet/repos", "events_url": "https://api.github.com/users/JosPolfliet/events{/privacy}", "received_events_url": "https://api.github.com/users/JosPolfliet/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-11-10T08:16:12Z", "updated_at": "2017-11-10T16:06:06Z", "closed_at": "2017-11-10T16:06:06Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: Yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Confirmed on Mac OS X (10.12.6) + Ubuntu 16.04 on GCP</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: v1.4.0-rc1-11-g130a514 1.4.0</li>\n<li><strong>Python version</strong>: Anaconda Python 3.6.1</li>\n<li><strong>GPU model and memory</strong>: no gpu</li>\n</ul>\n<h3>Describe the problem</h3>\n<p><code>Session.run()</code> hangs in thread if it has executed something in the main thread. If we don't execute the first <code>calculate_something()</code> in the main thread- or execute it after we submitted to the pool, everything works. Only when first calculating something in the main thread, and then in the child thread does tensorflow hang.</p>\n<h3>Reproducing example</h3>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">from</span> concurrent.futures <span class=\"pl-k\">import</span> ProcessPoolExecutor <span class=\"pl-k\">as</span> ProcessPool\n\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">calculate_something</span>():\n    <span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\n    <span class=\"pl-k\">with</span> tf.Session() <span class=\"pl-k\">as</span> sess:\n        a <span class=\"pl-k\">=</span> tf.constant(<span class=\"pl-c1\">2</span>)\n        b <span class=\"pl-k\">=</span> tf.constant(<span class=\"pl-c1\">3</span>)\n\n        <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>a=2, b=3<span class=\"pl-pds\">\"</span></span>)\n        <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Addition with constants: <span class=\"pl-c1\">%i</span><span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">%</span> sess.run(a<span class=\"pl-k\">+</span>b))\n        <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Multiplication with constants: <span class=\"pl-c1\">%i</span><span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">%</span> sess.run(a<span class=\"pl-k\">*</span>b))\n\ncalculate_something()\n\npool <span class=\"pl-k\">=</span> ProcessPool(<span class=\"pl-c1\">1</span>)\npool.submit(calculate_something)</pre></div>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Confirmed on Mac OS X (10.12.6) + Ubuntu 16.04 on GCP\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below): v1.4.0-rc1-11-g130a514 1.4.0\nPython version: Anaconda Python 3.6.1\nGPU model and memory: no gpu\n\nDescribe the problem\nSession.run() hangs in thread if it has executed something in the main thread. If we don't execute the first calculate_something() in the main thread- or execute it after we submitted to the pool, everything works. Only when first calculating something in the main thread, and then in the child thread does tensorflow hang.\nReproducing example\nfrom concurrent.futures import ProcessPoolExecutor as ProcessPool\n\n\ndef calculate_something():\n    import tensorflow as tf\n\n    with tf.Session() as sess:\n        a = tf.constant(2)\n        b = tf.constant(3)\n\n        print(\"a=2, b=3\")\n        print(\"Addition with constants: %i\" % sess.run(a+b))\n        print(\"Multiplication with constants: %i\" % sess.run(a*b))\n\ncalculate_something()\n\npool = ProcessPool(1)\npool.submit(calculate_something)", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: Yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Confirmed on Mac OS X (10.12.6) + Ubuntu 16.04 on GCP\r\n- **TensorFlow installed from (source or binary)**: binary\r\n- **TensorFlow version (use command below)**: v1.4.0-rc1-11-g130a514 1.4.0\r\n- **Python version**: Anaconda Python 3.6.1 \r\n- **GPU model and memory**: no gpu\r\n\r\n### Describe the problem\r\n`Session.run()` hangs in thread if it has executed something in the main thread. If we don't execute the first `calculate_something()` in the main thread- or execute it after we submitted to the pool, everything works. Only when first calculating something in the main thread, and then in the child thread does tensorflow hang. \r\n\r\n### Reproducing example\r\n```python\r\nfrom concurrent.futures import ProcessPoolExecutor as ProcessPool\r\n\r\n\r\ndef calculate_something():\r\n    import tensorflow as tf\r\n\r\n    with tf.Session() as sess:\r\n        a = tf.constant(2)\r\n        b = tf.constant(3)\r\n\r\n        print(\"a=2, b=3\")\r\n        print(\"Addition with constants: %i\" % sess.run(a+b))\r\n        print(\"Multiplication with constants: %i\" % sess.run(a*b))\r\n\r\ncalculate_something()\r\n\r\npool = ProcessPool(1)\r\npool.submit(calculate_something)\r\n```\r\n"}