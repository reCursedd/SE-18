{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15198", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15198/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15198/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15198/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15198", "id": 280349713, "node_id": "MDU6SXNzdWUyODAzNDk3MTM=", "number": 15198, "title": "Missing documentation for using the Dataset API in combination with image summaries", "user": {"login": "stecklin", "id": 6171989, "node_id": "MDQ6VXNlcjYxNzE5ODk=", "avatar_url": "https://avatars2.githubusercontent.com/u/6171989?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stecklin", "html_url": "https://github.com/stecklin", "followers_url": "https://api.github.com/users/stecklin/followers", "following_url": "https://api.github.com/users/stecklin/following{/other_user}", "gists_url": "https://api.github.com/users/stecklin/gists{/gist_id}", "starred_url": "https://api.github.com/users/stecklin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stecklin/subscriptions", "organizations_url": "https://api.github.com/users/stecklin/orgs", "repos_url": "https://api.github.com/users/stecklin/repos", "events_url": "https://api.github.com/users/stecklin/events{/privacy}", "received_events_url": "https://api.github.com/users/stecklin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 284443156, "node_id": "MDU6TGFiZWwyODQ0NDMxNTY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:docs", "name": "type:docs", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "MarkDaoust", "id": 1414837, "node_id": "MDQ6VXNlcjE0MTQ4Mzc=", "avatar_url": "https://avatars1.githubusercontent.com/u/1414837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MarkDaoust", "html_url": "https://github.com/MarkDaoust", "followers_url": "https://api.github.com/users/MarkDaoust/followers", "following_url": "https://api.github.com/users/MarkDaoust/following{/other_user}", "gists_url": "https://api.github.com/users/MarkDaoust/gists{/gist_id}", "starred_url": "https://api.github.com/users/MarkDaoust/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MarkDaoust/subscriptions", "organizations_url": "https://api.github.com/users/MarkDaoust/orgs", "repos_url": "https://api.github.com/users/MarkDaoust/repos", "events_url": "https://api.github.com/users/MarkDaoust/events{/privacy}", "received_events_url": "https://api.github.com/users/MarkDaoust/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "MarkDaoust", "id": 1414837, "node_id": "MDQ6VXNlcjE0MTQ4Mzc=", "avatar_url": "https://avatars1.githubusercontent.com/u/1414837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MarkDaoust", "html_url": "https://github.com/MarkDaoust", "followers_url": "https://api.github.com/users/MarkDaoust/followers", "following_url": "https://api.github.com/users/MarkDaoust/following{/other_user}", "gists_url": "https://api.github.com/users/MarkDaoust/gists{/gist_id}", "starred_url": "https://api.github.com/users/MarkDaoust/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MarkDaoust/subscriptions", "organizations_url": "https://api.github.com/users/MarkDaoust/orgs", "repos_url": "https://api.github.com/users/MarkDaoust/repos", "events_url": "https://api.github.com/users/MarkDaoust/events{/privacy}", "received_events_url": "https://api.github.com/users/MarkDaoust/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2017-12-08T02:32:28Z", "updated_at": "2018-01-15T21:06:34Z", "closed_at": "2018-01-15T21:06:34Z", "author_association": "NONE", "body_html": "<p>The <code>Dataset</code> API is now the recommended input pipeline, however I am missing some guidance on how to include summaries of my images.</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">def</span> <span class=\"pl-en\">get_data</span>():\n  dataset <span class=\"pl-k\">=</span> FixedLengthRecordDataset(<span class=\"pl-c1\">...</span>)\n  dataset <span class=\"pl-k\">=</span> dataset.map(parse_dataset, <span class=\"pl-c1\">...</span>)\n  <span class=\"pl-k\">if</span> is_training:\n    dataset <span class=\"pl-k\">=</span> dataset.map(preprocess_for_train, <span class=\"pl-c1\">...</span>)\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> Do shuffling, batching...</span>\n  <span class=\"pl-k\">return</span> dataset\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">preprocess_for_train</span>(<span class=\"pl-smi\">image</span>, <span class=\"pl-smi\">label</span>):\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> Do preprocessing...</span>\n  image <span class=\"pl-k\">=</span> tf.image.random_flip_left_right(image)\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> Add summary</span>\n  tf.summary.image(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>preprocessed_image<span class=\"pl-pds\">'</span></span>, tf.expand_dims(image, <span class=\"pl-c1\">0</span>))\n  <span class=\"pl-k\">return</span> image, label</pre></div>\n<p>This is what I would do intuitively, but since <code>map()</code> uses a different thread and therefore a different <code>tf.Graph</code> instance (?), the summaries are lost.</p>\n<p>What is the recommended way of adding image summaries when using the <code>Dataset</code> API? I would like to request a comment / example on that in the official docs.</p>", "body_text": "The Dataset API is now the recommended input pipeline, however I am missing some guidance on how to include summaries of my images.\ndef get_data():\n  dataset = FixedLengthRecordDataset(...)\n  dataset = dataset.map(parse_dataset, ...)\n  if is_training:\n    dataset = dataset.map(preprocess_for_train, ...)\n  # Do shuffling, batching...\n  return dataset\n\ndef preprocess_for_train(image, label):\n  # Do preprocessing...\n  image = tf.image.random_flip_left_right(image)\n  # Add summary\n  tf.summary.image('preprocessed_image', tf.expand_dims(image, 0))\n  return image, label\nThis is what I would do intuitively, but since map() uses a different thread and therefore a different tf.Graph instance (?), the summaries are lost.\nWhat is the recommended way of adding image summaries when using the Dataset API? I would like to request a comment / example on that in the official docs.", "body": "The `Dataset` API is now the recommended input pipeline, however I am missing some guidance on how to include summaries of my images.\r\n\r\n```python\r\ndef get_data():\r\n  dataset = FixedLengthRecordDataset(...)\r\n  dataset = dataset.map(parse_dataset, ...)\r\n  if is_training:\r\n    dataset = dataset.map(preprocess_for_train, ...)\r\n  # Do shuffling, batching...\r\n  return dataset\r\n\r\ndef preprocess_for_train(image, label):\r\n  # Do preprocessing...\r\n  image = tf.image.random_flip_left_right(image)\r\n  # Add summary\r\n  tf.summary.image('preprocessed_image', tf.expand_dims(image, 0))\r\n  return image, label\r\n```\r\n\r\nThis is what I would do intuitively, but since `map()` uses a different thread and therefore a different `tf.Graph` instance (?), the summaries are lost.\r\n\r\nWhat is the recommended way of adding image summaries when using the `Dataset` API? I would like to request a comment / example on that in the official docs. "}