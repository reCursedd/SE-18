{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/427266322", "html_url": "https://github.com/tensorflow/tensorflow/pull/22429#issuecomment-427266322", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22429", "id": 427266322, "node_id": "MDEyOklzc3VlQ29tbWVudDQyNzI2NjMyMg==", "user": {"login": "feihugis", "id": 5057740, "node_id": "MDQ6VXNlcjUwNTc3NDA=", "avatar_url": "https://avatars3.githubusercontent.com/u/5057740?v=4", "gravatar_id": "", "url": "https://api.github.com/users/feihugis", "html_url": "https://github.com/feihugis", "followers_url": "https://api.github.com/users/feihugis/followers", "following_url": "https://api.github.com/users/feihugis/following{/other_user}", "gists_url": "https://api.github.com/users/feihugis/gists{/gist_id}", "starred_url": "https://api.github.com/users/feihugis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/feihugis/subscriptions", "organizations_url": "https://api.github.com/users/feihugis/orgs", "repos_url": "https://api.github.com/users/feihugis/repos", "events_url": "https://api.github.com/users/feihugis/events{/privacy}", "received_events_url": "https://api.github.com/users/feihugis/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-05T07:02:53Z", "updated_at": "2018-10-05T07:54:27Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1072079\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jsimsa\">@jsimsa</a> All the comments are addressed except the following three. Please find my explanation in below. Could you help review these changes (two commits) and run the tests?</p>\n<pre><code>------------------------------------\nLine 268 (Iterator.UpdateIterator):\n          counter.Wait();\n\nApparently we have a new utility method to help with code like this: tensorflow/core/lib/core/threadpool.h?l=62-69\n------------------------------------\n</code></pre>\n<p><strong>Reply</strong>: If we use the threadpool, the thread pool needs to be created several times. The current implementation may be better.</p>\n<pre><code>------------------------------------\nLine 298 (Dataset.Iterator):\n      string current_pattern_ GUARDED_BY(mu_);\n\nDoes this need to be part of the iterator state? (Instead accessing `dataset()-&gt;patterns_[current_pattern_index_]` would save a copy, and slightly simplify the iterator state.)\n========================================================================\n</code></pre>\n<p><strong>Reply</strong>: <code>current_pattern_</code> is necessary here because <code>current_pattern_</code> may be different from <code>dataset()-&gt;patterns_[current_pattern_index_]</code> in some cases. For example, <a href=\"https://github.com/tensorflow/tensorflow/blob/156ae3e2a85e77f842edb0e18373c8d2b903230c/tensorflow/core/kernels/data/matching_files_dataset_op.cc#L137-L140\">these code</a> will make them different but we could not directly update <code>patterns_</code> as it needs to be same with users' input patterns.</p>\n<pre><code>------------------------------------\nLine 277 (Iterator.UpdateIterator):\n            }\n\nShould we return child_dir_status? It looks like we swallow it and when we return `ret` on L291 we're returning the status of fs-&gt;GetChildren() (which may well be OK, even though we're \"bailing\" with an error here).\n------------------------------------\n</code></pre>\n<p><strong>Reply</strong>: For the <code>child_dir_status</code> is <code>errors::Cancelled(\"Operation not needed\")</code>, it is actually not an error. It indicates that we can ignore this child file/directory to avoid the unnecessary search. I think the current <code>bailing</code> implementation is OK.</p>", "body_text": "@jsimsa All the comments are addressed except the following three. Please find my explanation in below. Could you help review these changes (two commits) and run the tests?\n------------------------------------\nLine 268 (Iterator.UpdateIterator):\n          counter.Wait();\n\nApparently we have a new utility method to help with code like this: tensorflow/core/lib/core/threadpool.h?l=62-69\n------------------------------------\n\nReply: If we use the threadpool, the thread pool needs to be created several times. The current implementation may be better.\n------------------------------------\nLine 298 (Dataset.Iterator):\n      string current_pattern_ GUARDED_BY(mu_);\n\nDoes this need to be part of the iterator state? (Instead accessing `dataset()->patterns_[current_pattern_index_]` would save a copy, and slightly simplify the iterator state.)\n========================================================================\n\nReply: current_pattern_ is necessary here because current_pattern_ may be different from dataset()->patterns_[current_pattern_index_] in some cases. For example, these code will make them different but we could not directly update patterns_ as it needs to be same with users' input patterns.\n------------------------------------\nLine 277 (Iterator.UpdateIterator):\n            }\n\nShould we return child_dir_status? It looks like we swallow it and when we return `ret` on L291 we're returning the status of fs->GetChildren() (which may well be OK, even though we're \"bailing\" with an error here).\n------------------------------------\n\nReply: For the child_dir_status is errors::Cancelled(\"Operation not needed\"), it is actually not an error. It indicates that we can ignore this child file/directory to avoid the unnecessary search. I think the current bailing implementation is OK.", "body": "@jsimsa All the comments are addressed except the following three. Please find my explanation in below. Could you help review these changes (two commits) and run the tests?\r\n\r\n```\r\n------------------------------------\r\nLine 268 (Iterator.UpdateIterator):\r\n          counter.Wait();\r\n\r\nApparently we have a new utility method to help with code like this: tensorflow/core/lib/core/threadpool.h?l=62-69\r\n------------------------------------\r\n```\r\n**Reply**: If we use the threadpool, the thread pool needs to be created several times. The current implementation may be better. \r\n\r\n```\r\n------------------------------------\r\nLine 298 (Dataset.Iterator):\r\n      string current_pattern_ GUARDED_BY(mu_);\r\n\r\nDoes this need to be part of the iterator state? (Instead accessing `dataset()->patterns_[current_pattern_index_]` would save a copy, and slightly simplify the iterator state.)\r\n========================================================================\r\n```\r\n**Reply**: `current_pattern_` is necessary here because `current_pattern_` may be different from `dataset()->patterns_[current_pattern_index_]` in some cases. For example, [these code](https://github.com/tensorflow/tensorflow/blob/156ae3e2a85e77f842edb0e18373c8d2b903230c/tensorflow/core/kernels/data/matching_files_dataset_op.cc#L137-L140) will make them different but we could not directly update `patterns_` as it needs to be same with users' input patterns.\r\n\r\n```\r\n------------------------------------\r\nLine 277 (Iterator.UpdateIterator):\r\n            }\r\n\r\nShould we return child_dir_status? It looks like we swallow it and when we return `ret` on L291 we're returning the status of fs->GetChildren() (which may well be OK, even though we're \"bailing\" with an error here).\r\n------------------------------------\r\n```\r\n**Reply**: For the `child_dir_status` is `errors::Cancelled(\"Operation not needed\")`, it is actually not an error. It indicates that we can ignore this child file/directory to avoid the unnecessary search. I think the current `bailing` implementation is OK.\r\n\r\n "}