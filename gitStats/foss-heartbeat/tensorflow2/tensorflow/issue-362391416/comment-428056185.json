{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/428056185", "html_url": "https://github.com/tensorflow/tensorflow/pull/22429#issuecomment-428056185", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22429", "id": 428056185, "node_id": "MDEyOklzc3VlQ29tbWVudDQyODA1NjE4NQ==", "user": {"login": "feihugis", "id": 5057740, "node_id": "MDQ6VXNlcjUwNTc3NDA=", "avatar_url": "https://avatars3.githubusercontent.com/u/5057740?v=4", "gravatar_id": "", "url": "https://api.github.com/users/feihugis", "html_url": "https://github.com/feihugis", "followers_url": "https://api.github.com/users/feihugis/followers", "following_url": "https://api.github.com/users/feihugis/following{/other_user}", "gists_url": "https://api.github.com/users/feihugis/gists{/gist_id}", "starred_url": "https://api.github.com/users/feihugis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/feihugis/subscriptions", "organizations_url": "https://api.github.com/users/feihugis/orgs", "repos_url": "https://api.github.com/users/feihugis/repos", "events_url": "https://api.github.com/users/feihugis/events{/privacy}", "received_events_url": "https://api.github.com/users/feihugis/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-09T04:31:59Z", "updated_at": "2018-10-09T15:31:14Z", "author_association": "CONTRIBUTOR", "body_html": "<blockquote>\n<p>If that's the case, I would not make the change I suggested because I think that we should return <code>NotFoundError</code> iff there is no match for any of the patterns.</p>\n<p>Looking at your code, I we currently return non-ok status when either <code>env()-&gt;GetFileSystemForFile</code> fails (line 216) or <code>fs-&gt;GetChildren</code> fails (line 236).</p>\n<p>I suggest you add temporary log statements that tells us what the returned status at these lines is which will likely help us identify the root cause of the failures.</p>\n<p>I think that you will ultimately need to treat <code>NotFoundError</code> differently from other non-ok statuses. For all non-ok status other that <code>NotFoundError</code> we should propagate this to the caller right away (as opposed to continue doing other work which can also result in an error that will be discarded). For <code>NotFoundError</code>, we should skip over these and only return <code>NotFoundError</code> to the caller if all patterns evaluated to an empty set of files.</p>\n</blockquote>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1072079\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jsimsa\">@jsimsa</a> Thanks very much for your comments and suggestions! The temporary logs have been added for debugging. Could you help run the tests?</p>\n<p>Yes, a better way is needed to handle different kinds of non-ok statuses as you suggest. Will do it after figuring out the root cause of the current failures.</p>\n<p>Sorry about the commits. I rebased my code and then I was required to push the commit with <code>force</code>, which makes all the commit history display again here. The last four commits are created after the internal review.</p>\n<hr>\n<p>It looks like the failures are caused by <a href=\"https://github.com/tensorflow/tensorflow/blob/597f04e949285f7e72682c7c3a6ed656a5aedb1e/tensorflow/core/kernels/data/matching_files_dataset_op.cc#L129-L132\">these code</a>. It works wrong on Windows. The right implementation for Windows may need to be like <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/platform/windows/windows_file_system.cc#L489-L505\">this</a>, which first converts <code>\\</code> to <code>/</code> and then utlizes the general helper function at <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/platform/file_system_helper.cc#L55\">here</a>.</p>", "body_text": "If that's the case, I would not make the change I suggested because I think that we should return NotFoundError iff there is no match for any of the patterns.\nLooking at your code, I we currently return non-ok status when either env()->GetFileSystemForFile fails (line 216) or fs->GetChildren fails (line 236).\nI suggest you add temporary log statements that tells us what the returned status at these lines is which will likely help us identify the root cause of the failures.\nI think that you will ultimately need to treat NotFoundError differently from other non-ok statuses. For all non-ok status other that NotFoundError we should propagate this to the caller right away (as opposed to continue doing other work which can also result in an error that will be discarded). For NotFoundError, we should skip over these and only return NotFoundError to the caller if all patterns evaluated to an empty set of files.\n\n@jsimsa Thanks very much for your comments and suggestions! The temporary logs have been added for debugging. Could you help run the tests?\nYes, a better way is needed to handle different kinds of non-ok statuses as you suggest. Will do it after figuring out the root cause of the current failures.\nSorry about the commits. I rebased my code and then I was required to push the commit with force, which makes all the commit history display again here. The last four commits are created after the internal review.\n\nIt looks like the failures are caused by these code. It works wrong on Windows. The right implementation for Windows may need to be like this, which first converts \\ to / and then utlizes the general helper function at here.", "body": "> If that's the case, I would not make the change I suggested because I think that we should return `NotFoundError` iff there is no match for any of the patterns.\r\n> \r\n> Looking at your code, I we currently return non-ok status when either `env()->GetFileSystemForFile` fails (line 216) or `fs->GetChildren` fails (line 236).\r\n> \r\n> I suggest you add temporary log statements that tells us what the returned status at these lines is which will likely help us identify the root cause of the failures.\r\n> \r\n> I think that you will ultimately need to treat `NotFoundError` differently from other non-ok statuses. For all non-ok status other that `NotFoundError` we should propagate this to the caller right away (as opposed to continue doing other work which can also result in an error that will be discarded). For `NotFoundError`, we should skip over these and only return `NotFoundError` to the caller if all patterns evaluated to an empty set of files.\r\n\r\n@jsimsa Thanks very much for your comments and suggestions! The temporary logs have been added for debugging. Could you help run the tests?\r\n\r\nYes, a better way is needed to handle different kinds of non-ok statuses as you suggest. Will do it after figuring out the root cause of the current failures.\r\n\r\nSorry about the commits. I rebased my code and then I was required to push the commit with `force`, which makes all the commit history display again here. The last four commits are created after the internal review.\r\n\r\n---\r\nIt looks like the failures are caused by [these code](https://github.com/tensorflow/tensorflow/blob/597f04e949285f7e72682c7c3a6ed656a5aedb1e/tensorflow/core/kernels/data/matching_files_dataset_op.cc#L129-L132). It works wrong on Windows. The right implementation for Windows may need to be like [this](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/platform/windows/windows_file_system.cc#L489-L505), which first converts `\\` to `/` and then utlizes the general helper function at [here](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/platform/file_system_helper.cc#L55).  \r\n"}