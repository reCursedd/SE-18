{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22498", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22498/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22498/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22498/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/22498", "id": 363487896, "node_id": "MDU6SXNzdWUzNjM0ODc4OTY=", "number": 22498, "title": "Writing a SavedModel on Windows with long file path fails", "user": {"login": "HedgehogCode", "id": 6631116, "node_id": "MDQ6VXNlcjY2MzExMTY=", "avatar_url": "https://avatars1.githubusercontent.com/u/6631116?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HedgehogCode", "html_url": "https://github.com/HedgehogCode", "followers_url": "https://api.github.com/users/HedgehogCode/followers", "following_url": "https://api.github.com/users/HedgehogCode/following{/other_user}", "gists_url": "https://api.github.com/users/HedgehogCode/gists{/gist_id}", "starred_url": "https://api.github.com/users/HedgehogCode/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HedgehogCode/subscriptions", "organizations_url": "https://api.github.com/users/HedgehogCode/orgs", "repos_url": "https://api.github.com/users/HedgehogCode/repos", "events_url": "https://api.github.com/users/HedgehogCode/events{/privacy}", "received_events_url": "https://api.github.com/users/HedgehogCode/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": {"login": "wt-huang", "id": 42785337, "node_id": "MDQ6VXNlcjQyNzg1MzM3", "avatar_url": "https://avatars0.githubusercontent.com/u/42785337?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wt-huang", "html_url": "https://github.com/wt-huang", "followers_url": "https://api.github.com/users/wt-huang/followers", "following_url": "https://api.github.com/users/wt-huang/following{/other_user}", "gists_url": "https://api.github.com/users/wt-huang/gists{/gist_id}", "starred_url": "https://api.github.com/users/wt-huang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wt-huang/subscriptions", "organizations_url": "https://api.github.com/users/wt-huang/orgs", "repos_url": "https://api.github.com/users/wt-huang/repos", "events_url": "https://api.github.com/users/wt-huang/events{/privacy}", "received_events_url": "https://api.github.com/users/wt-huang/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "wt-huang", "id": 42785337, "node_id": "MDQ6VXNlcjQyNzg1MzM3", "avatar_url": "https://avatars0.githubusercontent.com/u/42785337?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wt-huang", "html_url": "https://github.com/wt-huang", "followers_url": "https://api.github.com/users/wt-huang/followers", "following_url": "https://api.github.com/users/wt-huang/following{/other_user}", "gists_url": "https://api.github.com/users/wt-huang/gists{/gist_id}", "starred_url": "https://api.github.com/users/wt-huang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wt-huang/subscriptions", "organizations_url": "https://api.github.com/users/wt-huang/orgs", "repos_url": "https://api.github.com/users/wt-huang/repos", "events_url": "https://api.github.com/users/wt-huang/events{/privacy}", "received_events_url": "https://api.github.com/users/wt-huang/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 14, "created_at": "2018-09-25T09:30:26Z", "updated_at": "2018-11-16T09:01:05Z", "closed_at": null, "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code</strong>: Yes, see below.</li>\n<li><strong>OS Platform and Distribution</strong>: Windows 10 Enterprise 64Bit (10.0.16299)</li>\n<li><strong>Mobile device</strong>: N/A</li>\n<li><strong>TensorFlow installed from</strong>: Binary</li>\n<li><strong>TensorFlow version</strong>: b'v1.10.0-rc1-19-g656e7a2b34' 1.10.0</li>\n<li><strong>Python version</strong>: 3.5.5</li>\n<li><strong>Bazel version</strong>: N/A</li>\n<li><strong>GCC/Compiler version</strong>: N/A</li>\n<li><strong>CUDA/cuDNN version</strong>: N/A</li>\n<li><strong>GPU model and memory</strong>: N/A</li>\n<li><strong>Exact command to reproduce</strong>: Run the provided script on Windows</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>When exporting a SavedModel to a directory with a rather long path the maximum file path length of Windows (260 chars) gets exceeded while creating temporary variable files and the process fails because it can't find the file (See attachments for the full log):</p>\n<pre><code>NotFoundError (see above for traceback): Failed to create a NewWriteableFile: C:\\reallylongpath\\barfoobarfoobarfoobarfoobarfoobarfoo\\barfoobarfoobarfoobarfoobarfoobarfoo\\barfoobarfoobarfoobarfoobarfoobarfoo\\barfoobarfoo\\variables\\variables_temp_cbd5fe79f07a4790a08e7c2adf1ed95b/part-00000-of-00001.data-00000-of-00001.tempstate12448200021531902965 : The system cannot find the path specified.\n</code></pre>\n<p>The usual workaround to prepend <code>'\\\\\\\\?\\\\'</code> to the path (like described <a href=\"https://stackoverflow.com/a/3557977\" rel=\"nofollow\">here</a>) doesn't work (See attachments).</p>\n<h3>Source code / logs</h3>\n<p><strong>Code to reproduce:</strong></p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Long export path (should be at least 140 chars long)</span>\nexport_dir <span class=\"pl-k\">=</span> <span class=\"pl-sr\"><span class=\"pl-k\">r</span><span class=\"pl-pds\">'</span>C:<span class=\"pl-cce\">\\r</span>eallylongpath<span class=\"pl-c1\">\\b</span>arfoobarfoobarfoobarfoobarfoobarfoo<span class=\"pl-c1\">\\b</span>arfoobarfoobarfoobarfoobarfoobarfoo<span class=\"pl-c1\">\\b</span>arfoobarfoobarfoobarfoobarfoobarfoo<span class=\"pl-c1\">\\b</span>arfoobarfoo<span class=\"pl-pds\">'</span></span>\n<span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>Export dir lenght: <span class=\"pl-c1\">{}</span><span class=\"pl-pds\">'</span></span>.format(<span class=\"pl-c1\">len</span>(export_dir)))\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Build an easy graph with variables</span>\nx <span class=\"pl-k\">=</span> tf.constant(<span class=\"pl-c1\">2</span>)\nw <span class=\"pl-k\">=</span> tf.Variable(<span class=\"pl-c1\">3</span>)\ny <span class=\"pl-k\">=</span> tf.multiply(x, w)\n\n<span class=\"pl-k\">with</span> tf.Session() <span class=\"pl-k\">as</span> sess:\n    <span class=\"pl-c\"><span class=\"pl-c\">#</span> Initialize the variable</span>\n    sess.run(w.initializer)\n\n    <span class=\"pl-c\"><span class=\"pl-c\">#</span> Save as a SavedModel</span>\n    tf.saved_model.simple_save(sess,\n                               export_dir,\n                               <span class=\"pl-v\">inputs</span><span class=\"pl-k\">=</span>{<span class=\"pl-s\"><span class=\"pl-pds\">'</span>x<span class=\"pl-pds\">'</span></span>: x },\n                               <span class=\"pl-v\">outputs</span><span class=\"pl-k\">=</span>{<span class=\"pl-s\"><span class=\"pl-pds\">'</span>y<span class=\"pl-pds\">'</span></span>: y })</pre></div>\n<p><strong>Logs:</strong><br>\nFull log:<br>\n<a href=\"https://github.com/tensorflow/tensorflow/files/2414582/log.txt\">log.txt</a></p>\n<p>Full log with <code>'\\\\\\\\?\\\\'</code> prefix:<br>\n<a href=\"https://github.com/tensorflow/tensorflow/files/2414583/log_prefix_0.txt\">log_prefix_0.txt</a></p>\n<p>Full log with <code>'\\\\?\\'</code> prefix:<br>\n<a href=\"https://github.com/tensorflow/tensorflow/files/2414584/log_prefix_1.txt\">log_prefix_1.txt</a></p>", "body_text": "System information\n\nHave I written custom code: Yes, see below.\nOS Platform and Distribution: Windows 10 Enterprise 64Bit (10.0.16299)\nMobile device: N/A\nTensorFlow installed from: Binary\nTensorFlow version: b'v1.10.0-rc1-19-g656e7a2b34' 1.10.0\nPython version: 3.5.5\nBazel version: N/A\nGCC/Compiler version: N/A\nCUDA/cuDNN version: N/A\nGPU model and memory: N/A\nExact command to reproduce: Run the provided script on Windows\n\nDescribe the problem\nWhen exporting a SavedModel to a directory with a rather long path the maximum file path length of Windows (260 chars) gets exceeded while creating temporary variable files and the process fails because it can't find the file (See attachments for the full log):\nNotFoundError (see above for traceback): Failed to create a NewWriteableFile: C:\\reallylongpath\\barfoobarfoobarfoobarfoobarfoobarfoo\\barfoobarfoobarfoobarfoobarfoobarfoo\\barfoobarfoobarfoobarfoobarfoobarfoo\\barfoobarfoo\\variables\\variables_temp_cbd5fe79f07a4790a08e7c2adf1ed95b/part-00000-of-00001.data-00000-of-00001.tempstate12448200021531902965 : The system cannot find the path specified.\n\nThe usual workaround to prepend '\\\\\\\\?\\\\' to the path (like described here) doesn't work (See attachments).\nSource code / logs\nCode to reproduce:\nimport tensorflow as tf\n\n# Long export path (should be at least 140 chars long)\nexport_dir = r'C:\\reallylongpath\\barfoobarfoobarfoobarfoobarfoobarfoo\\barfoobarfoobarfoobarfoobarfoobarfoo\\barfoobarfoobarfoobarfoobarfoobarfoo\\barfoobarfoo'\nprint('Export dir lenght: {}'.format(len(export_dir)))\n\n# Build an easy graph with variables\nx = tf.constant(2)\nw = tf.Variable(3)\ny = tf.multiply(x, w)\n\nwith tf.Session() as sess:\n    # Initialize the variable\n    sess.run(w.initializer)\n\n    # Save as a SavedModel\n    tf.saved_model.simple_save(sess,\n                               export_dir,\n                               inputs={'x': x },\n                               outputs={'y': y })\nLogs:\nFull log:\nlog.txt\nFull log with '\\\\\\\\?\\\\' prefix:\nlog_prefix_0.txt\nFull log with '\\\\?\\' prefix:\nlog_prefix_1.txt", "body": "### System information\r\n- **Have I written custom code**: Yes, see below.\r\n- **OS Platform and Distribution**: Windows 10 Enterprise 64Bit (10.0.16299)\r\n- **Mobile device**: N/A\r\n- **TensorFlow installed from**: Binary\r\n- **TensorFlow version**: b'v1.10.0-rc1-19-g656e7a2b34' 1.10.0\r\n- **Python version**: 3.5.5\r\n- **Bazel version**: N/A\r\n- **GCC/Compiler version**: N/A\r\n- **CUDA/cuDNN version**: N/A\r\n- **GPU model and memory**: N/A\r\n- **Exact command to reproduce**: Run the provided script on Windows\r\n\r\n\r\n### Describe the problem\r\nWhen exporting a SavedModel to a directory with a rather long path the maximum file path length of Windows (260 chars) gets exceeded while creating temporary variable files and the process fails because it can't find the file (See attachments for the full log):\r\n```\r\nNotFoundError (see above for traceback): Failed to create a NewWriteableFile: C:\\reallylongpath\\barfoobarfoobarfoobarfoobarfoobarfoo\\barfoobarfoobarfoobarfoobarfoobarfoo\\barfoobarfoobarfoobarfoobarfoobarfoo\\barfoobarfoo\\variables\\variables_temp_cbd5fe79f07a4790a08e7c2adf1ed95b/part-00000-of-00001.data-00000-of-00001.tempstate12448200021531902965 : The system cannot find the path specified.\r\n```\r\nThe usual workaround to prepend `'\\\\\\\\?\\\\'` to the path (like described [here](https://stackoverflow.com/a/3557977)) doesn't work (See attachments).\r\n\r\n### Source code / logs\r\n\r\n__Code to reproduce:__\r\n```python\r\nimport tensorflow as tf\r\n\r\n# Long export path (should be at least 140 chars long)\r\nexport_dir = r'C:\\reallylongpath\\barfoobarfoobarfoobarfoobarfoobarfoo\\barfoobarfoobarfoobarfoobarfoobarfoo\\barfoobarfoobarfoobarfoobarfoobarfoo\\barfoobarfoo'\r\nprint('Export dir lenght: {}'.format(len(export_dir)))\r\n\r\n# Build an easy graph with variables\r\nx = tf.constant(2)\r\nw = tf.Variable(3)\r\ny = tf.multiply(x, w)\r\n\r\nwith tf.Session() as sess:\r\n    # Initialize the variable\r\n    sess.run(w.initializer)\r\n\r\n    # Save as a SavedModel\r\n    tf.saved_model.simple_save(sess,\r\n                               export_dir,\r\n                               inputs={'x': x },\r\n                               outputs={'y': y })\r\n```\r\n\r\n__Logs:__\r\nFull log:\r\n[log.txt](https://github.com/tensorflow/tensorflow/files/2414582/log.txt)\r\n\r\nFull log with `'\\\\\\\\?\\\\'` prefix:\r\n[log_prefix_0.txt](https://github.com/tensorflow/tensorflow/files/2414583/log_prefix_0.txt)\r\n\r\nFull log with `'\\\\?\\'` prefix:\r\n[log_prefix_1.txt](https://github.com/tensorflow/tensorflow/files/2414584/log_prefix_1.txt)\r\n"}