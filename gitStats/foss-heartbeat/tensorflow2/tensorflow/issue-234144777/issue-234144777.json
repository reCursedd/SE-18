{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10486", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10486/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10486/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10486/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/10486", "id": 234144777, "node_id": "MDU6SXNzdWUyMzQxNDQ3Nzc=", "number": 10486, "title": "[BUG] control_dependencies + sess.run(tf.global_variables_initializer())", "user": {"login": "morgangiraud", "id": 1278248, "node_id": "MDQ6VXNlcjEyNzgyNDg=", "avatar_url": "https://avatars0.githubusercontent.com/u/1278248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/morgangiraud", "html_url": "https://github.com/morgangiraud", "followers_url": "https://api.github.com/users/morgangiraud/followers", "following_url": "https://api.github.com/users/morgangiraud/following{/other_user}", "gists_url": "https://api.github.com/users/morgangiraud/gists{/gist_id}", "starred_url": "https://api.github.com/users/morgangiraud/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/morgangiraud/subscriptions", "organizations_url": "https://api.github.com/users/morgangiraud/orgs", "repos_url": "https://api.github.com/users/morgangiraud/repos", "events_url": "https://api.github.com/users/morgangiraud/events{/privacy}", "received_events_url": "https://api.github.com/users/morgangiraud/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-06-07T09:19:35Z", "updated_at": "2017-06-08T15:51:48Z", "closed_at": "2017-06-08T15:51:48Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>OS Platform and Distribution</strong>: Linux Ubuntu 16.04 and mac osx</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: pip install tensorflow</li>\n<li><strong>TensorFlow version (use command below)</strong>: v1.1.0-rc0-61-g1ec6ed5 and 1.1.0</li>\n</ul>\n<p>Hi TF team, I've stumbled upon a strange behaviour that I believe is a bug:</p>\n<p>If I try to run the code below i end up with : <code>FailedPreconditionError (see above for traceback): Attempting to use uninitialized value timestep [[Node: AssignAdd = AssignAdd[T=DT_INT32, _class=[\"loc:@timestep\"], use_locking=false, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](timestep, AssignAdd/value)]]</code></p>\n<p>If I remove the <code>tf.zeros_like(Qs_t)</code> statement (as in the commented line), the problem disappears.</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\n<span class=\"pl-k\">with</span> tf.Graph().as_default():\n    Qs_t <span class=\"pl-k\">=</span> tf.ones([<span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">2</span>], <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>tf.float32)\n    timestep <span class=\"pl-k\">=</span> tf.Variable(<span class=\"pl-c1\">0</span>, <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>tf.int32, <span class=\"pl-v\">trainable</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">False</span>, <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>timestep<span class=\"pl-pds\">\"</span></span>)\n    inc_t <span class=\"pl-k\">=</span> tf.assign_add(timestep, <span class=\"pl-c1\">1</span>)\n    <span class=\"pl-k\">with</span> tf.control_dependencies([inc_t]):\n        Ns_t <span class=\"pl-k\">=</span> tf.Variable(tf.zeros_like(Qs_t), <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>tf.float32, <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>N<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-v\">trainable</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">False</span>)\n        <span class=\"pl-c\"><span class=\"pl-c\">#</span> Ns_t = tf.Variable(0., dtype=tf.float32, name=\"N\", trainable=False)</span>\n\n    <span class=\"pl-k\">with</span> tf.Session() <span class=\"pl-k\">as</span> sess:\n        sess.run(tf.global_variables_initializer())</pre></div>", "body_text": "System information\n\nOS Platform and Distribution: Linux Ubuntu 16.04 and mac osx\nTensorFlow installed from (source or binary): pip install tensorflow\nTensorFlow version (use command below): v1.1.0-rc0-61-g1ec6ed5 and 1.1.0\n\nHi TF team, I've stumbled upon a strange behaviour that I believe is a bug:\nIf I try to run the code below i end up with : FailedPreconditionError (see above for traceback): Attempting to use uninitialized value timestep [[Node: AssignAdd = AssignAdd[T=DT_INT32, _class=[\"loc:@timestep\"], use_locking=false, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](timestep, AssignAdd/value)]]\nIf I remove the tf.zeros_like(Qs_t) statement (as in the commented line), the problem disappears.\nimport tensorflow as tf\n\nwith tf.Graph().as_default():\n    Qs_t = tf.ones([3, 2], dtype=tf.float32)\n    timestep = tf.Variable(0, dtype=tf.int32, trainable=False, name=\"timestep\")\n    inc_t = tf.assign_add(timestep, 1)\n    with tf.control_dependencies([inc_t]):\n        Ns_t = tf.Variable(tf.zeros_like(Qs_t), dtype=tf.float32, name=\"N\", trainable=False)\n        # Ns_t = tf.Variable(0., dtype=tf.float32, name=\"N\", trainable=False)\n\n    with tf.Session() as sess:\n        sess.run(tf.global_variables_initializer())", "body": "### System information\r\n- **OS Platform and Distribution**: Linux Ubuntu 16.04 and mac osx\r\n- **TensorFlow installed from (source or binary)**: pip install tensorflow\r\n- **TensorFlow version (use command below)**: v1.1.0-rc0-61-g1ec6ed5 and 1.1.0\r\n\r\nHi TF team, I've stumbled upon a strange behaviour that I believe is a bug:\r\n\r\nIf I try to run the code below i end up with : `FailedPreconditionError (see above for traceback): Attempting to use uninitialized value timestep\r\n\t [[Node: AssignAdd = AssignAdd[T=DT_INT32, _class=[\"loc:@timestep\"], use_locking=false, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](timestep, AssignAdd/value)]]`\r\n\r\nIf I remove the `tf.zeros_like(Qs_t)` statement (as in the commented line), the problem disappears.\r\n\r\n```python\r\nimport tensorflow as tf\r\n\r\nwith tf.Graph().as_default():\r\n    Qs_t = tf.ones([3, 2], dtype=tf.float32)\r\n    timestep = tf.Variable(0, dtype=tf.int32, trainable=False, name=\"timestep\")\r\n    inc_t = tf.assign_add(timestep, 1)\r\n    with tf.control_dependencies([inc_t]):\r\n        Ns_t = tf.Variable(tf.zeros_like(Qs_t), dtype=tf.float32, name=\"N\", trainable=False)\r\n        # Ns_t = tf.Variable(0., dtype=tf.float32, name=\"N\", trainable=False)\r\n\r\n    with tf.Session() as sess:\r\n        sess.run(tf.global_variables_initializer())\r\n```\r\n\r\n\r\n"}