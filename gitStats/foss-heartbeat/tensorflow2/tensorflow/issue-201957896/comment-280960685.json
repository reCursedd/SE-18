{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/280960685", "html_url": "https://github.com/tensorflow/tensorflow/issues/6961#issuecomment-280960685", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6961", "id": 280960685, "node_id": "MDEyOklzc3VlQ29tbWVudDI4MDk2MDY4NQ==", "user": {"login": "yaroslavvb", "id": 23068, "node_id": "MDQ6VXNlcjIzMDY4", "avatar_url": "https://avatars3.githubusercontent.com/u/23068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yaroslavvb", "html_url": "https://github.com/yaroslavvb", "followers_url": "https://api.github.com/users/yaroslavvb/followers", "following_url": "https://api.github.com/users/yaroslavvb/following{/other_user}", "gists_url": "https://api.github.com/users/yaroslavvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/yaroslavvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yaroslavvb/subscriptions", "organizations_url": "https://api.github.com/users/yaroslavvb/orgs", "repos_url": "https://api.github.com/users/yaroslavvb/repos", "events_url": "https://api.github.com/users/yaroslavvb/events{/privacy}", "received_events_url": "https://api.github.com/users/yaroslavvb/received_events", "type": "User", "site_admin": false}, "created_at": "2017-02-19T23:57:54Z", "updated_at": "2017-02-19T23:58:15Z", "author_association": "CONTRIBUTOR", "body_html": "<p>TensorFlow already has checks for cycles, but cycles caused by <code>Defun/_symbolic_gradient</code> are not caught</p>\n<p>IE, for the following code <code>TF_ExtendGraph</code> returns bad status with message <code>3 nodes in a cycle</code></p>\n<pre><code>import tensorflow as tf\nimport tensorflow.contrib.graph_editor as ge\n\ndef run_after(a, b):\n  a = a.op\n  b = b.op\n  already_after = (b in a.control_inputs) or (b in [i.op for i in a.inputs])\n\n  if already_after:\n    return 0\n  ge.reroute.add_control_inputs(a, [b])\n  return 1\n\ntf.reset_default_graph()\na = tf.ones(())\nb = tf.ones(())\nc = tf.ones(())\nrun_after(a, b)\nrun_after(b, c)\nrun_after(c, a)\n\nsess = tf.Session()\nsess.run(a)\n</code></pre>\n<p>error</p>\n<pre><code>InvalidArgumentError                      Traceback (most recent call last)\n/Users/yaroslav/anaconda/envs/tim-jan17/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\n   1029     try:\n-&gt; 1030       return fn(*args)\n   1031     except errors.OpError as e:\n\n/Users/yaroslav/anaconda/envs/tim-jan17/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run_fn(session, feed_dict, fetch_list, target_list, options, run_metadata)\n   1007       # Ensure any changes to the graph are reflected in the runtime.\n-&gt; 1008       self._extend_graph()\n   1009       with errors.raise_exception_on_not_ok_status() as status:\n\n/Users/yaroslav/anaconda/envs/tim-jan17/lib/python3.5/site-packages/tensorflow/python/client/session.py in _extend_graph(self)\n   1056           tf_session.TF_ExtendGraph(\n-&gt; 1057               self._session, graph_def.SerializeToString(), status)\n   1058         self._opened = True\n\n/Users/yaroslav/anaconda/envs/tim-jan17/lib/python3.5/contextlib.py in __exit__(self, type, value, traceback)\n     65             try:\n---&gt; 66                 next(self.gen)\n     67             except StopIteration:\n\n/Users/yaroslav/anaconda/envs/tim-jan17/lib/python3.5/site-packages/tensorflow/python/framework/errors_impl.py in raise_exception_on_not_ok_status()\n    468           compat.as_text(pywrap_tensorflow.TF_Message(status)),\n--&gt; 469           pywrap_tensorflow.TF_GetCode(status))\n    470   finally:\n\nInvalidArgumentError: 3 nodes in a cycle\n\n</code></pre>", "body_text": "TensorFlow already has checks for cycles, but cycles caused by Defun/_symbolic_gradient are not caught\nIE, for the following code TF_ExtendGraph returns bad status with message 3 nodes in a cycle\nimport tensorflow as tf\nimport tensorflow.contrib.graph_editor as ge\n\ndef run_after(a, b):\n  a = a.op\n  b = b.op\n  already_after = (b in a.control_inputs) or (b in [i.op for i in a.inputs])\n\n  if already_after:\n    return 0\n  ge.reroute.add_control_inputs(a, [b])\n  return 1\n\ntf.reset_default_graph()\na = tf.ones(())\nb = tf.ones(())\nc = tf.ones(())\nrun_after(a, b)\nrun_after(b, c)\nrun_after(c, a)\n\nsess = tf.Session()\nsess.run(a)\n\nerror\nInvalidArgumentError                      Traceback (most recent call last)\n/Users/yaroslav/anaconda/envs/tim-jan17/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\n   1029     try:\n-> 1030       return fn(*args)\n   1031     except errors.OpError as e:\n\n/Users/yaroslav/anaconda/envs/tim-jan17/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run_fn(session, feed_dict, fetch_list, target_list, options, run_metadata)\n   1007       # Ensure any changes to the graph are reflected in the runtime.\n-> 1008       self._extend_graph()\n   1009       with errors.raise_exception_on_not_ok_status() as status:\n\n/Users/yaroslav/anaconda/envs/tim-jan17/lib/python3.5/site-packages/tensorflow/python/client/session.py in _extend_graph(self)\n   1056           tf_session.TF_ExtendGraph(\n-> 1057               self._session, graph_def.SerializeToString(), status)\n   1058         self._opened = True\n\n/Users/yaroslav/anaconda/envs/tim-jan17/lib/python3.5/contextlib.py in __exit__(self, type, value, traceback)\n     65             try:\n---> 66                 next(self.gen)\n     67             except StopIteration:\n\n/Users/yaroslav/anaconda/envs/tim-jan17/lib/python3.5/site-packages/tensorflow/python/framework/errors_impl.py in raise_exception_on_not_ok_status()\n    468           compat.as_text(pywrap_tensorflow.TF_Message(status)),\n--> 469           pywrap_tensorflow.TF_GetCode(status))\n    470   finally:\n\nInvalidArgumentError: 3 nodes in a cycle", "body": "TensorFlow already has checks for cycles, but cycles caused by `Defun/_symbolic_gradient` are not caught\r\n\r\nIE, for the following code `TF_ExtendGraph` returns bad status with message `3 nodes in a cycle` \r\n\r\n```\r\nimport tensorflow as tf\r\nimport tensorflow.contrib.graph_editor as ge\r\n\r\ndef run_after(a, b):\r\n  a = a.op\r\n  b = b.op\r\n  already_after = (b in a.control_inputs) or (b in [i.op for i in a.inputs])\r\n\r\n  if already_after:\r\n    return 0\r\n  ge.reroute.add_control_inputs(a, [b])\r\n  return 1\r\n\r\ntf.reset_default_graph()\r\na = tf.ones(())\r\nb = tf.ones(())\r\nc = tf.ones(())\r\nrun_after(a, b)\r\nrun_after(b, c)\r\nrun_after(c, a)\r\n\r\nsess = tf.Session()\r\nsess.run(a)\r\n```\r\nerror\r\n```\r\nInvalidArgumentError                      Traceback (most recent call last)\r\n/Users/yaroslav/anaconda/envs/tim-jan17/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\r\n   1029     try:\r\n-> 1030       return fn(*args)\r\n   1031     except errors.OpError as e:\r\n\r\n/Users/yaroslav/anaconda/envs/tim-jan17/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run_fn(session, feed_dict, fetch_list, target_list, options, run_metadata)\r\n   1007       # Ensure any changes to the graph are reflected in the runtime.\r\n-> 1008       self._extend_graph()\r\n   1009       with errors.raise_exception_on_not_ok_status() as status:\r\n\r\n/Users/yaroslav/anaconda/envs/tim-jan17/lib/python3.5/site-packages/tensorflow/python/client/session.py in _extend_graph(self)\r\n   1056           tf_session.TF_ExtendGraph(\r\n-> 1057               self._session, graph_def.SerializeToString(), status)\r\n   1058         self._opened = True\r\n\r\n/Users/yaroslav/anaconda/envs/tim-jan17/lib/python3.5/contextlib.py in __exit__(self, type, value, traceback)\r\n     65             try:\r\n---> 66                 next(self.gen)\r\n     67             except StopIteration:\r\n\r\n/Users/yaroslav/anaconda/envs/tim-jan17/lib/python3.5/site-packages/tensorflow/python/framework/errors_impl.py in raise_exception_on_not_ok_status()\r\n    468           compat.as_text(pywrap_tensorflow.TF_Message(status)),\r\n--> 469           pywrap_tensorflow.TF_GetCode(status))\r\n    470   finally:\r\n\r\nInvalidArgumentError: 3 nodes in a cycle\r\n\r\n```"}