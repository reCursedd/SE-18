{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/376505210", "html_url": "https://github.com/tensorflow/tensorflow/issues/17958#issuecomment-376505210", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17958", "id": 376505210, "node_id": "MDEyOklzc3VlQ29tbWVudDM3NjUwNTIxMA==", "user": {"login": "kvanhoey", "id": 22071874, "node_id": "MDQ6VXNlcjIyMDcxODc0", "avatar_url": "https://avatars2.githubusercontent.com/u/22071874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kvanhoey", "html_url": "https://github.com/kvanhoey", "followers_url": "https://api.github.com/users/kvanhoey/followers", "following_url": "https://api.github.com/users/kvanhoey/following{/other_user}", "gists_url": "https://api.github.com/users/kvanhoey/gists{/gist_id}", "starred_url": "https://api.github.com/users/kvanhoey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kvanhoey/subscriptions", "organizations_url": "https://api.github.com/users/kvanhoey/orgs", "repos_url": "https://api.github.com/users/kvanhoey/repos", "events_url": "https://api.github.com/users/kvanhoey/events{/privacy}", "received_events_url": "https://api.github.com/users/kvanhoey/received_events", "type": "User", "site_admin": false}, "created_at": "2018-03-27T12:23:53Z", "updated_at": "2018-03-27T12:23:53Z", "author_association": "NONE", "body_html": "<p>Hi,</p>\n<p>Thanks for following up so fast.<br>\nI just upgraded to TF 1.6 (all other elements unchanged, same machine and libraries). Results are indeed better (see output below): ~2ms vs. ~4.5ms. But more importantly, iterations occur in constant time: they do not slow down progressively within the epoch anymore.<br>\nOnly the very last iteration of each epoch seems slower, which is probably for the reshuffling, thus is reasonable. Testing on my (more complex) MNIST pipeline shows the same constant-time behavior.</p>\n<p>So IMO: problem solved. Thanks a lot for the help and quick feedback.</p>\n<blockquote>\n<p>=== START TEST WITH SHUFFLING DISABLED ===<br>\n2018-03-27 14:15:01.349378: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA<br>\n2018-03-27 14:15:01.546811: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1212] Found device 0 with properties:<br>\nname: GeForce GTX 1060 6GB major: 6 minor: 1 memoryClockRate(GHz): 1.7715<br>\npciBusID: 0000:01:00.0<br>\ntotalMemory: 5.93GiB freeMemory: 4.97GiB<br>\n2018-03-27 14:15:01.546838: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1312] Adding visible gpu devices: 0<br>\n2018-03-27 14:15:01.720048: I tensorflow/core/common_runtime/gpu/gpu_device.cc:993] Creating TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 4731 MB memory) -&gt; physical GPU (device: 0, name: GeForce GTX 1060 6GB, pci bus id: 0000:01:00.0, compute capability: 6.1)<br>\niteration 99: last 100 iterations took 1.94ms<br>\niteration 199: last 100 iterations took 1.83ms<br>\niteration 299: last 100 iterations took 1.93ms<br>\niteration 399: last 100 iterations took 1.54ms<br>\niteration 499: last 100 iterations took 1.73ms<br>\niteration 599: last 100 iterations took 1.67ms<br>\niteration 699: last 100 iterations took 1.69ms<br>\niteration 799: last 100 iterations took 1.90ms<br>\niteration 899: last 100 iterations took 1.68ms<br>\niteration 999: last 100 iterations took 1.71ms<br>\nStart new epoch<br>\niteration 1099: last 100 iterations took 1.68ms<br>\niteration 1199: last 100 iterations took 1.68ms<br>\niteration 1299: last 100 iterations took 1.69ms<br>\niteration 1399: last 100 iterations took 2.45ms<br>\niteration 1499: last 100 iterations took 1.92ms<br>\niteration 1599: last 100 iterations took 1.91ms<br>\niteration 1699: last 100 iterations took 1.92ms<br>\niteration 1799: last 100 iterations took 2.12ms<br>\niteration 1899: last 100 iterations took 2.12ms<br>\niteration 1999: last 100 iterations took 2.33ms<br>\nStart new epoch<br>\niteration 2099: last 100 iterations took 1.90ms<br>\niteration 2199: last 100 iterations took 1.87ms<br>\niteration 2299: last 100 iterations took 1.94ms<br>\niteration 2399: last 100 iterations took 2.19ms<br>\niteration 2499: last 100 iterations took 2.15ms<br>\niteration 2599: last 100 iterations took 1.81ms<br>\niteration 2699: last 100 iterations took 1.85ms<br>\niteration 2799: last 100 iterations took 1.75ms<br>\niteration 2899: last 100 iterations took 2.09ms<br>\niteration 2999: last 100 iterations took 1.82ms</p>\n</blockquote>\n<blockquote>\n<p>=== START TEST WITH SHUFFLING ENABLED ===<br>\n2018-03-27 14:15:07.661802: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1312] Adding visible gpu devices: 0<br>\n2018-03-27 14:15:07.662148: I tensorflow/core/common_runtime/gpu/gpu_device.cc:993] Creating TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 4729 MB memory) -&gt; physical GPU (device: 0, name: GeForce GTX 1060 6GB, pci bus id: 0000:01:00.0, compute capability: 6.1)<br>\niteration 99: last 100 iterations took 4.15ms<br>\niteration 199: last 100 iterations took 4.53ms<br>\niteration 299: last 100 iterations took 4.72ms<br>\niteration 399: last 100 iterations took 4.59ms<br>\niteration 499: last 100 iterations took 5.01ms<br>\niteration 599: last 100 iterations took 5.68ms<br>\niteration 699: last 100 iterations took 6.49ms<br>\niteration 799: last 100 iterations took 5.92ms<br>\niteration 899: last 100 iterations took 5.43ms<br>\niteration 999: last 100 iterations took 10.18ms<br>\nStart new epoch<br>\niteration 1099: last 100 iterations took 4.94ms<br>\niteration 1199: last 100 iterations took 4.93ms<br>\niteration 1299: last 100 iterations took 4.53ms<br>\niteration 1399: last 100 iterations took 5.31ms<br>\niteration 1499: last 100 iterations took 4.73ms<br>\niteration 1599: last 100 iterations took 5.34ms<br>\niteration 1699: last 100 iterations took 4.74ms<br>\niteration 1799: last 100 iterations took 4.90ms<br>\niteration 1899: last 100 iterations took 4.81ms<br>\niteration 1999: last 100 iterations took 11.58ms<br>\nStart new epoch<br>\niteration 2099: last 100 iterations took 4.64ms<br>\niteration 2199: last 100 iterations took 3.89ms<br>\niteration 2299: last 100 iterations took 4.05ms<br>\niteration 2399: last 100 iterations took 4.15ms<br>\niteration 2499: last 100 iterations took 4.28ms<br>\niteration 2599: last 100 iterations took 4.45ms<br>\niteration 2699: last 100 iterations took 4.69ms<br>\niteration 2799: last 100 iterations took 4.83ms<br>\niteration 2899: last 100 iterations took 4.86ms<br>\niteration 2999: last 100 iterations took 11.96ms</p>\n</blockquote>", "body_text": "Hi,\nThanks for following up so fast.\nI just upgraded to TF 1.6 (all other elements unchanged, same machine and libraries). Results are indeed better (see output below): ~2ms vs. ~4.5ms. But more importantly, iterations occur in constant time: they do not slow down progressively within the epoch anymore.\nOnly the very last iteration of each epoch seems slower, which is probably for the reshuffling, thus is reasonable. Testing on my (more complex) MNIST pipeline shows the same constant-time behavior.\nSo IMO: problem solved. Thanks a lot for the help and quick feedback.\n\n=== START TEST WITH SHUFFLING DISABLED ===\n2018-03-27 14:15:01.349378: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\n2018-03-27 14:15:01.546811: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1212] Found device 0 with properties:\nname: GeForce GTX 1060 6GB major: 6 minor: 1 memoryClockRate(GHz): 1.7715\npciBusID: 0000:01:00.0\ntotalMemory: 5.93GiB freeMemory: 4.97GiB\n2018-03-27 14:15:01.546838: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1312] Adding visible gpu devices: 0\n2018-03-27 14:15:01.720048: I tensorflow/core/common_runtime/gpu/gpu_device.cc:993] Creating TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 4731 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1060 6GB, pci bus id: 0000:01:00.0, compute capability: 6.1)\niteration 99: last 100 iterations took 1.94ms\niteration 199: last 100 iterations took 1.83ms\niteration 299: last 100 iterations took 1.93ms\niteration 399: last 100 iterations took 1.54ms\niteration 499: last 100 iterations took 1.73ms\niteration 599: last 100 iterations took 1.67ms\niteration 699: last 100 iterations took 1.69ms\niteration 799: last 100 iterations took 1.90ms\niteration 899: last 100 iterations took 1.68ms\niteration 999: last 100 iterations took 1.71ms\nStart new epoch\niteration 1099: last 100 iterations took 1.68ms\niteration 1199: last 100 iterations took 1.68ms\niteration 1299: last 100 iterations took 1.69ms\niteration 1399: last 100 iterations took 2.45ms\niteration 1499: last 100 iterations took 1.92ms\niteration 1599: last 100 iterations took 1.91ms\niteration 1699: last 100 iterations took 1.92ms\niteration 1799: last 100 iterations took 2.12ms\niteration 1899: last 100 iterations took 2.12ms\niteration 1999: last 100 iterations took 2.33ms\nStart new epoch\niteration 2099: last 100 iterations took 1.90ms\niteration 2199: last 100 iterations took 1.87ms\niteration 2299: last 100 iterations took 1.94ms\niteration 2399: last 100 iterations took 2.19ms\niteration 2499: last 100 iterations took 2.15ms\niteration 2599: last 100 iterations took 1.81ms\niteration 2699: last 100 iterations took 1.85ms\niteration 2799: last 100 iterations took 1.75ms\niteration 2899: last 100 iterations took 2.09ms\niteration 2999: last 100 iterations took 1.82ms\n\n\n=== START TEST WITH SHUFFLING ENABLED ===\n2018-03-27 14:15:07.661802: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1312] Adding visible gpu devices: 0\n2018-03-27 14:15:07.662148: I tensorflow/core/common_runtime/gpu/gpu_device.cc:993] Creating TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 4729 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1060 6GB, pci bus id: 0000:01:00.0, compute capability: 6.1)\niteration 99: last 100 iterations took 4.15ms\niteration 199: last 100 iterations took 4.53ms\niteration 299: last 100 iterations took 4.72ms\niteration 399: last 100 iterations took 4.59ms\niteration 499: last 100 iterations took 5.01ms\niteration 599: last 100 iterations took 5.68ms\niteration 699: last 100 iterations took 6.49ms\niteration 799: last 100 iterations took 5.92ms\niteration 899: last 100 iterations took 5.43ms\niteration 999: last 100 iterations took 10.18ms\nStart new epoch\niteration 1099: last 100 iterations took 4.94ms\niteration 1199: last 100 iterations took 4.93ms\niteration 1299: last 100 iterations took 4.53ms\niteration 1399: last 100 iterations took 5.31ms\niteration 1499: last 100 iterations took 4.73ms\niteration 1599: last 100 iterations took 5.34ms\niteration 1699: last 100 iterations took 4.74ms\niteration 1799: last 100 iterations took 4.90ms\niteration 1899: last 100 iterations took 4.81ms\niteration 1999: last 100 iterations took 11.58ms\nStart new epoch\niteration 2099: last 100 iterations took 4.64ms\niteration 2199: last 100 iterations took 3.89ms\niteration 2299: last 100 iterations took 4.05ms\niteration 2399: last 100 iterations took 4.15ms\niteration 2499: last 100 iterations took 4.28ms\niteration 2599: last 100 iterations took 4.45ms\niteration 2699: last 100 iterations took 4.69ms\niteration 2799: last 100 iterations took 4.83ms\niteration 2899: last 100 iterations took 4.86ms\niteration 2999: last 100 iterations took 11.96ms", "body": "Hi,\r\n\r\nThanks for following up so fast.\r\nI just upgraded to TF 1.6 (all other elements unchanged, same machine and libraries). Results are indeed better (see output below): ~2ms vs. ~4.5ms. But more importantly, iterations occur in constant time: they do not slow down progressively within the epoch anymore.\r\nOnly the very last iteration of each epoch seems slower, which is probably for the reshuffling, thus is reasonable. Testing on my (more complex) MNIST pipeline shows the same constant-time behavior.\r\n\r\nSo IMO: problem solved. Thanks a lot for the help and quick feedback.\r\n\r\n>    === START TEST WITH SHUFFLING DISABLED === \r\n2018-03-27 14:15:01.349378: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\r\n2018-03-27 14:15:01.546811: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1212] Found device 0 with properties: \r\nname: GeForce GTX 1060 6GB major: 6 minor: 1 memoryClockRate(GHz): 1.7715\r\npciBusID: 0000:01:00.0\r\ntotalMemory: 5.93GiB freeMemory: 4.97GiB\r\n2018-03-27 14:15:01.546838: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1312] Adding visible gpu devices: 0\r\n2018-03-27 14:15:01.720048: I tensorflow/core/common_runtime/gpu/gpu_device.cc:993] Creating TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 4731 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1060 6GB, pci bus id: 0000:01:00.0, compute capability: 6.1)\r\niteration 99: last 100 iterations took 1.94ms\r\niteration 199: last 100 iterations took 1.83ms\r\niteration 299: last 100 iterations took 1.93ms\r\niteration 399: last 100 iterations took 1.54ms\r\niteration 499: last 100 iterations took 1.73ms\r\niteration 599: last 100 iterations took 1.67ms\r\niteration 699: last 100 iterations took 1.69ms\r\niteration 799: last 100 iterations took 1.90ms\r\niteration 899: last 100 iterations took 1.68ms\r\niteration 999: last 100 iterations took 1.71ms\r\nStart new epoch\r\niteration 1099: last 100 iterations took 1.68ms\r\niteration 1199: last 100 iterations took 1.68ms\r\niteration 1299: last 100 iterations took 1.69ms\r\niteration 1399: last 100 iterations took 2.45ms\r\niteration 1499: last 100 iterations took 1.92ms\r\niteration 1599: last 100 iterations took 1.91ms\r\niteration 1699: last 100 iterations took 1.92ms\r\niteration 1799: last 100 iterations took 2.12ms\r\niteration 1899: last 100 iterations took 2.12ms\r\niteration 1999: last 100 iterations took 2.33ms\r\nStart new epoch\r\niteration 2099: last 100 iterations took 1.90ms\r\niteration 2199: last 100 iterations took 1.87ms\r\niteration 2299: last 100 iterations took 1.94ms\r\niteration 2399: last 100 iterations took 2.19ms\r\niteration 2499: last 100 iterations took 2.15ms\r\niteration 2599: last 100 iterations took 1.81ms\r\niteration 2699: last 100 iterations took 1.85ms\r\niteration 2799: last 100 iterations took 1.75ms\r\niteration 2899: last 100 iterations took 2.09ms\r\niteration 2999: last 100 iterations took 1.82ms\r\n\r\n>    === START TEST WITH SHUFFLING ENABLED === \r\n2018-03-27 14:15:07.661802: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1312] Adding visible gpu devices: 0\r\n2018-03-27 14:15:07.662148: I tensorflow/core/common_runtime/gpu/gpu_device.cc:993] Creating TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 4729 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1060 6GB, pci bus id: 0000:01:00.0, compute capability: 6.1)\r\niteration 99: last 100 iterations took 4.15ms\r\niteration 199: last 100 iterations took 4.53ms\r\niteration 299: last 100 iterations took 4.72ms\r\niteration 399: last 100 iterations took 4.59ms\r\niteration 499: last 100 iterations took 5.01ms\r\niteration 599: last 100 iterations took 5.68ms\r\niteration 699: last 100 iterations took 6.49ms\r\niteration 799: last 100 iterations took 5.92ms\r\niteration 899: last 100 iterations took 5.43ms\r\niteration 999: last 100 iterations took 10.18ms\r\nStart new epoch\r\niteration 1099: last 100 iterations took 4.94ms\r\niteration 1199: last 100 iterations took 4.93ms\r\niteration 1299: last 100 iterations took 4.53ms\r\niteration 1399: last 100 iterations took 5.31ms\r\niteration 1499: last 100 iterations took 4.73ms\r\niteration 1599: last 100 iterations took 5.34ms\r\niteration 1699: last 100 iterations took 4.74ms\r\niteration 1799: last 100 iterations took 4.90ms\r\niteration 1899: last 100 iterations took 4.81ms\r\niteration 1999: last 100 iterations took 11.58ms\r\nStart new epoch\r\niteration 2099: last 100 iterations took 4.64ms\r\niteration 2199: last 100 iterations took 3.89ms\r\niteration 2299: last 100 iterations took 4.05ms\r\niteration 2399: last 100 iterations took 4.15ms\r\niteration 2499: last 100 iterations took 4.28ms\r\niteration 2599: last 100 iterations took 4.45ms\r\niteration 2699: last 100 iterations took 4.69ms\r\niteration 2799: last 100 iterations took 4.83ms\r\niteration 2899: last 100 iterations took 4.86ms\r\niteration 2999: last 100 iterations took 11.96ms\r\n\r\n"}