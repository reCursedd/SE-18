{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/371751084", "html_url": "https://github.com/tensorflow/tensorflow/issues/14203#issuecomment-371751084", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14203", "id": 371751084, "node_id": "MDEyOklzc3VlQ29tbWVudDM3MTc1MTA4NA==", "user": {"login": "yangsiyu007", "id": 9201966, "node_id": "MDQ6VXNlcjkyMDE5NjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/9201966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yangsiyu007", "html_url": "https://github.com/yangsiyu007", "followers_url": "https://api.github.com/users/yangsiyu007/followers", "following_url": "https://api.github.com/users/yangsiyu007/following{/other_user}", "gists_url": "https://api.github.com/users/yangsiyu007/gists{/gist_id}", "starred_url": "https://api.github.com/users/yangsiyu007/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yangsiyu007/subscriptions", "organizations_url": "https://api.github.com/users/yangsiyu007/orgs", "repos_url": "https://api.github.com/users/yangsiyu007/repos", "events_url": "https://api.github.com/users/yangsiyu007/events{/privacy}", "received_events_url": "https://api.github.com/users/yangsiyu007/received_events", "type": "User", "site_admin": false}, "created_at": "2018-03-09T08:50:10Z", "updated_at": "2018-03-09T08:50:10Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=16018\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/asimshankar\">@asimshankar</a> can we please reopen this issue, I've encountered it as well and here's the details:</p>\n<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: followed example code</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: macos 10.13.1</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.6.0</li>\n<li><strong>Python version</strong>: 3.6.4</li>\n<li><strong>Bazel version (if compiling from source)</strong>:</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>:</li>\n<li><strong>CUDA/cuDNN version</strong>: N/A</li>\n<li><strong>GPU model and memory</strong>: N/A</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<pre><code>from keras_contrib.applications.densenet import DenseNetImageNet161\nimport keras.optimizers\nimport tensorflow as tf\n\ntarget_img_size = (224, 224, 3)\nmodel = DenseNetImageNet161(input_shape=target_img_size)\nmodel.compile(optimizer=keras.optimizers.Adam(lr=1e-4), loss='categorical_crossentropy',\n                  metrics=['accuracy'])\n\nestimator = tf.keras.estimator.model_to_estimator(keras_model=model, model_dir='/path/to/dir')\n</code></pre>\n<h3>Describe the problem</h3>\n<p>When I run the above script, it gives the error that <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=18616051\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/KirtoXX\">@KirtoXX</a> mentioned (see traceback below).</p>\n<p>It seems to be <a href=\"https://github.com/keras-team/keras/issues/9310\" data-hovercard-type=\"issue\" data-hovercard-url=\"/keras-team/keras/issues/9310/hovercard\">this exact issue referenced in keras</a>. It seems that if the model was built with standard keras, then model_to_estimator() can't really be used, which would make model_to_estimator() not very helpful for using many pre-trained models.</p>\n<h3>Source code / logs</h3>\n<p>...<br>\nUsing TensorFlow backend.<br>\n2018-03-09 00:46:36.080703: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA<br>\nWeights for the model were loaded successfully<br>\nTraceback (most recent call last):<br>\nFile \"/Users/siyuyang/Source/Repos/AI4E_IARPAfMoW/scripts/temp.py\", line 15, in <br>\nestimator = tf.keras.estimator.model_to_estimator(keras_model=model, model_dir='/path/to/dir')<br>\nFile \"/Users/siyuyang/Source/Repos/AI4E_IARPAfMoW/env/lib/python3.6/site-packages/tensorflow/python/keras/_impl/keras/estimator.py\", line 302, in model_to_estimator<br>\n_save_first_checkpoint(keras_model, est, custom_objects, keras_weights)<br>\nFile \"/Users/siyuyang/Source/Repos/AI4E_IARPAfMoW/env/lib/python3.6/site-packages/tensorflow/python/keras/_impl/keras/estimator.py\", line 231, in _save_first_checkpoint<br>\ncustom_objects)<br>\nFile \"/Users/siyuyang/Source/Repos/AI4E_IARPAfMoW/env/lib/python3.6/site-packages/tensorflow/python/keras/_impl/keras/estimator.py\", line 111, in _clone_and_build_model<br>\nmodel = models.clone_model(keras_model, input_tensors=input_tensors)<br>\nFile \"/Users/siyuyang/Source/Repos/AI4E_IARPAfMoW/env/lib/python3.6/site-packages/tensorflow/python/keras/_impl/keras/models.py\", line 1557, in clone_model<br>\nreturn _clone_functional_model(model, input_tensors=input_tensors)<br>\nFile \"/Users/siyuyang/Source/Repos/AI4E_IARPAfMoW/env/lib/python3.6/site-packages/tensorflow/python/keras/_impl/keras/models.py\", line 1361, in _clone_functional_model<br>\n'to be a <code>Model</code> instance, got ', model)<br>\nValueError: ('Expected <code>model</code> argument to be a <code>Model</code> instance, got ', &lt;keras.engine.training.Model object at 0x10e616588&gt;)</p>", "body_text": "@asimshankar can we please reopen this issue, I've encountered it as well and here's the details:\nSystem information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): followed example code\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): macos 10.13.1\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below): 1.6.0\nPython version: 3.6.4\nBazel version (if compiling from source):\nGCC/Compiler version (if compiling from source):\nCUDA/cuDNN version: N/A\nGPU model and memory: N/A\nExact command to reproduce:\n\nfrom keras_contrib.applications.densenet import DenseNetImageNet161\nimport keras.optimizers\nimport tensorflow as tf\n\ntarget_img_size = (224, 224, 3)\nmodel = DenseNetImageNet161(input_shape=target_img_size)\nmodel.compile(optimizer=keras.optimizers.Adam(lr=1e-4), loss='categorical_crossentropy',\n                  metrics=['accuracy'])\n\nestimator = tf.keras.estimator.model_to_estimator(keras_model=model, model_dir='/path/to/dir')\n\nDescribe the problem\nWhen I run the above script, it gives the error that @KirtoXX mentioned (see traceback below).\nIt seems to be this exact issue referenced in keras. It seems that if the model was built with standard keras, then model_to_estimator() can't really be used, which would make model_to_estimator() not very helpful for using many pre-trained models.\nSource code / logs\n...\nUsing TensorFlow backend.\n2018-03-09 00:46:36.080703: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\nWeights for the model were loaded successfully\nTraceback (most recent call last):\nFile \"/Users/siyuyang/Source/Repos/AI4E_IARPAfMoW/scripts/temp.py\", line 15, in \nestimator = tf.keras.estimator.model_to_estimator(keras_model=model, model_dir='/path/to/dir')\nFile \"/Users/siyuyang/Source/Repos/AI4E_IARPAfMoW/env/lib/python3.6/site-packages/tensorflow/python/keras/_impl/keras/estimator.py\", line 302, in model_to_estimator\n_save_first_checkpoint(keras_model, est, custom_objects, keras_weights)\nFile \"/Users/siyuyang/Source/Repos/AI4E_IARPAfMoW/env/lib/python3.6/site-packages/tensorflow/python/keras/_impl/keras/estimator.py\", line 231, in _save_first_checkpoint\ncustom_objects)\nFile \"/Users/siyuyang/Source/Repos/AI4E_IARPAfMoW/env/lib/python3.6/site-packages/tensorflow/python/keras/_impl/keras/estimator.py\", line 111, in _clone_and_build_model\nmodel = models.clone_model(keras_model, input_tensors=input_tensors)\nFile \"/Users/siyuyang/Source/Repos/AI4E_IARPAfMoW/env/lib/python3.6/site-packages/tensorflow/python/keras/_impl/keras/models.py\", line 1557, in clone_model\nreturn _clone_functional_model(model, input_tensors=input_tensors)\nFile \"/Users/siyuyang/Source/Repos/AI4E_IARPAfMoW/env/lib/python3.6/site-packages/tensorflow/python/keras/_impl/keras/models.py\", line 1361, in _clone_functional_model\n'to be a Model instance, got ', model)\nValueError: ('Expected model argument to be a Model instance, got ', <keras.engine.training.Model object at 0x10e616588>)", "body": "@asimshankar can we please reopen this issue, I've encountered it as well and here's the details:\r\n\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: followed example code\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: macos 10.13.1\r\n- **TensorFlow installed from (source or binary)**: binary\r\n- **TensorFlow version (use command below)**: 1.6.0\r\n- **Python version**: 3.6.4\r\n- **Bazel version (if compiling from source)**:\r\n- **GCC/Compiler version (if compiling from source)**:\r\n- **CUDA/cuDNN version**: N/A\r\n- **GPU model and memory**: N/A\r\n- **Exact command to reproduce**:\r\n```\r\nfrom keras_contrib.applications.densenet import DenseNetImageNet161\r\nimport keras.optimizers\r\nimport tensorflow as tf\r\n\r\ntarget_img_size = (224, 224, 3)\r\nmodel = DenseNetImageNet161(input_shape=target_img_size)\r\nmodel.compile(optimizer=keras.optimizers.Adam(lr=1e-4), loss='categorical_crossentropy',\r\n                  metrics=['accuracy'])\r\n\r\nestimator = tf.keras.estimator.model_to_estimator(keras_model=model, model_dir='/path/to/dir')\r\n```\r\n\r\n### Describe the problem\r\nWhen I run the above script, it gives the error that @KirtoXX mentioned (see traceback below).\r\n\r\nIt seems to be [this exact issue referenced in keras](https://github.com/keras-team/keras/issues/9310). It seems that if the model was built with standard keras, then model_to_estimator() can't really be used, which would make model_to_estimator() not very helpful for using many pre-trained models.\r\n\r\n### Source code / logs\r\n...\r\nUsing TensorFlow backend.\r\n2018-03-09 00:46:36.080703: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\r\nWeights for the model were loaded successfully\r\nTraceback (most recent call last):\r\n  File \"/Users/siyuyang/Source/Repos/AI4E_IARPAfMoW/scripts/temp.py\", line 15, in <module>\r\n    estimator = tf.keras.estimator.model_to_estimator(keras_model=model, model_dir='/path/to/dir')\r\n  File \"/Users/siyuyang/Source/Repos/AI4E_IARPAfMoW/env/lib/python3.6/site-packages/tensorflow/python/keras/_impl/keras/estimator.py\", line 302, in model_to_estimator\r\n    _save_first_checkpoint(keras_model, est, custom_objects, keras_weights)\r\n  File \"/Users/siyuyang/Source/Repos/AI4E_IARPAfMoW/env/lib/python3.6/site-packages/tensorflow/python/keras/_impl/keras/estimator.py\", line 231, in _save_first_checkpoint\r\n    custom_objects)\r\n  File \"/Users/siyuyang/Source/Repos/AI4E_IARPAfMoW/env/lib/python3.6/site-packages/tensorflow/python/keras/_impl/keras/estimator.py\", line 111, in _clone_and_build_model\r\n    model = models.clone_model(keras_model, input_tensors=input_tensors)\r\n  File \"/Users/siyuyang/Source/Repos/AI4E_IARPAfMoW/env/lib/python3.6/site-packages/tensorflow/python/keras/_impl/keras/models.py\", line 1557, in clone_model\r\n    return _clone_functional_model(model, input_tensors=input_tensors)\r\n  File \"/Users/siyuyang/Source/Repos/AI4E_IARPAfMoW/env/lib/python3.6/site-packages/tensorflow/python/keras/_impl/keras/models.py\", line 1361, in _clone_functional_model\r\n    'to be a `Model` instance, got ', model)\r\nValueError: ('Expected `model` argument to be a `Model` instance, got ', <keras.engine.training.Model object at 0x10e616588>)"}