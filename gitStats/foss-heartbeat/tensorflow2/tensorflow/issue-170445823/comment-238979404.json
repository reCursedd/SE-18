{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/238979404", "html_url": "https://github.com/tensorflow/tensorflow/issues/3731#issuecomment-238979404", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3731", "id": 238979404, "node_id": "MDEyOklzc3VlQ29tbWVudDIzODk3OTQwNA==", "user": {"login": "yaroslavvb", "id": 23068, "node_id": "MDQ6VXNlcjIzMDY4", "avatar_url": "https://avatars3.githubusercontent.com/u/23068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yaroslavvb", "html_url": "https://github.com/yaroslavvb", "followers_url": "https://api.github.com/users/yaroslavvb/followers", "following_url": "https://api.github.com/users/yaroslavvb/following{/other_user}", "gists_url": "https://api.github.com/users/yaroslavvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/yaroslavvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yaroslavvb/subscriptions", "organizations_url": "https://api.github.com/users/yaroslavvb/orgs", "repos_url": "https://api.github.com/users/yaroslavvb/repos", "events_url": "https://api.github.com/users/yaroslavvb/events{/privacy}", "received_events_url": "https://api.github.com/users/yaroslavvb/received_events", "type": "User", "site_admin": false}, "created_at": "2016-08-10T19:36:39Z", "updated_at": "2016-08-10T19:36:39Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Shape inference there<br>\n<div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/2a10e469d70827ede21c0bb5d0a46aac97404d4c/tensorflow/python/ops/array_ops.py#L772\">tensorflow/tensorflow/python/ops/array_ops.py</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n         Line 772\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/2a10e469d70827ede21c0bb5d0a46aac97404d4c\">2a10e46</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L772\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"772\"></td>\n          <td id=\"LC772\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> input_shape.insert(op.get_attr(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>axis<span class=\"pl-pds\">\"</span></span>), <span class=\"pl-c1\">len</span>(op.inputs)) </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<br>\ndoesn't have special logic for negative axis<br>\ninput_shape.insert(op.get_attr(\"axis\"), len(op.inputs))</p>\n<p>So if axis is \"-1\", it just does \"shapelist.insert(-1, stuff)\"<br>\nIt should probably mirror the logic from the C++ implementation<br>\nGetAxisForPackAndUnpack<br>\n<div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/2a10e469d70827ede21c0bb5d0a46aac97404d4c/tensorflow/core/ops/array_ops.cc#L30\">tensorflow/tensorflow/core/ops/array_ops.cc</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n         Line 30\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/2a10e469d70827ede21c0bb5d0a46aac97404d4c\">2a10e46</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L30\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"30\"></td>\n          <td id=\"LC30\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> Status <span class=\"pl-en\">GetAxisForPackAndUnpack</span>(InferenceContext* c, int32 rank_after_pack, </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>\n<p>On Wed, Aug 10, 2016 at 12:19 PM, Jeremiah Lowin <a href=\"mailto:notifications@github.com\">notifications@github.com</a><br>\nwrote:</p>\n<blockquote>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=70511\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/girving\">@girving</a> <a href=\"https://github.com/girving\">https://github.com/girving</a> Yep, I think you're right:</p>\n<p>In [163]: tf.pack(x, 4).eval().shape<br>\nOut[163]: (2, 3, 4, 5, 10)</p>\n<p>In [164]: tf.pack(x, -1).eval().shape<br>\nOut[164]: (2, 3, 4, 5, 10)</p>\n<p>In [165]: tf.pack(x, -1)<br>\nOut[165]: &lt;tf.Tensor 'pack_105:0' shape=(2, 3, 4, 10, 5) dtype=float64&gt;</p>\n<p>And indeed, trying to eval the unpack/pack combination at the end of my<br>\nsnippet raises a shape mismatch error.</p>\n<p>\u2014<br>\nYou are receiving this because you are subscribed to this thread.<br>\nReply to this email directly, view it on GitHub<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"170445823\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/3731\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/3731/hovercard?comment_id=238974490&amp;comment_type=issue_comment\" href=\"https://github.com/tensorflow/tensorflow/issues/3731#issuecomment-238974490\">#3731 (comment)</a>,<br>\nor mute the thread<br>\n<a href=\"https://github.com/notifications/unsubscribe-auth/AABaHJt2-3N-yWkNjx9a7qr_LRmkQV4Yks5qeiQygaJpZM4JhRBe\">https://github.com/notifications/unsubscribe-auth/AABaHJt2-3N-yWkNjx9a7qr_LRmkQV4Yks5qeiQygaJpZM4JhRBe</a><br>\n.</p>\n</blockquote>", "body_text": "Shape inference there\n\n  \n    \n      tensorflow/tensorflow/python/ops/array_ops.py\n    \n    \n         Line 772\n      in\n      2a10e46\n    \n    \n    \n    \n\n        \n          \n           input_shape.insert(op.get_attr(\"axis\"), len(op.inputs)) \n        \n    \n  \n\n\ndoesn't have special logic for negative axis\ninput_shape.insert(op.get_attr(\"axis\"), len(op.inputs))\nSo if axis is \"-1\", it just does \"shapelist.insert(-1, stuff)\"\nIt should probably mirror the logic from the C++ implementation\nGetAxisForPackAndUnpack\n\n  \n    \n      tensorflow/tensorflow/core/ops/array_ops.cc\n    \n    \n         Line 30\n      in\n      2a10e46\n    \n    \n    \n    \n\n        \n          \n           Status GetAxisForPackAndUnpack(InferenceContext* c, int32 rank_after_pack, \n        \n    \n  \n\n\nOn Wed, Aug 10, 2016 at 12:19 PM, Jeremiah Lowin notifications@github.com\nwrote:\n\n@girving https://github.com/girving Yep, I think you're right:\nIn [163]: tf.pack(x, 4).eval().shape\nOut[163]: (2, 3, 4, 5, 10)\nIn [164]: tf.pack(x, -1).eval().shape\nOut[164]: (2, 3, 4, 5, 10)\nIn [165]: tf.pack(x, -1)\nOut[165]: <tf.Tensor 'pack_105:0' shape=(2, 3, 4, 10, 5) dtype=float64>\nAnd indeed, trying to eval the unpack/pack combination at the end of my\nsnippet raises a shape mismatch error.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\n#3731 (comment),\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AABaHJt2-3N-yWkNjx9a7qr_LRmkQV4Yks5qeiQygaJpZM4JhRBe\n.", "body": "Shape inference there\nhttps://github.com/tensorflow/tensorflow/blob/2a10e469d70827ede21c0bb5d0a46aac97404d4c/tensorflow/python/ops/array_ops.py#L772\ndoesn't have special logic for negative axis\ninput_shape.insert(op.get_attr(\"axis\"), len(op.inputs))\n\nSo if axis is \"-1\", it just does \"shapelist.insert(-1, stuff)\"\nIt should probably mirror the logic from the C++ implementation\nGetAxisForPackAndUnpack\nhttps://github.com/tensorflow/tensorflow/blob/2a10e469d70827ede21c0bb5d0a46aac97404d4c/tensorflow/core/ops/array_ops.cc#L30\n\nOn Wed, Aug 10, 2016 at 12:19 PM, Jeremiah Lowin notifications@github.com\nwrote:\n\n> @girving https://github.com/girving Yep, I think you're right:\n> \n> In [163]: tf.pack(x, 4).eval().shape\n> Out[163]: (2, 3, 4, 5, 10)\n> \n> In [164]: tf.pack(x, -1).eval().shape\n> Out[164]: (2, 3, 4, 5, 10)\n> \n> In [165]: tf.pack(x, -1)\n> Out[165]: <tf.Tensor 'pack_105:0' shape=(2, 3, 4, 10, 5) dtype=float64>\n> \n> And indeed, trying to eval the unpack/pack combination at the end of my\n> snippet raises a shape mismatch error.\n> \n> \u2014\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> https://github.com/tensorflow/tensorflow/issues/3731#issuecomment-238974490,\n> or mute the thread\n> https://github.com/notifications/unsubscribe-auth/AABaHJt2-3N-yWkNjx9a7qr_LRmkQV4Yks5qeiQygaJpZM4JhRBe\n> .\n"}