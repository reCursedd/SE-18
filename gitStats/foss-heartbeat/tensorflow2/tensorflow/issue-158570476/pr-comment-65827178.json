{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/65827178", "pull_request_review_id": null, "id": 65827178, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1ODI3MTc4", "diff_hunk": "@@ -0,0 +1,169 @@\n+#  Copyright 2015-present The Scikit Flow Authors. All Rights Reserved.\n+#\n+#  Licensed under the Apache License, Version 2.0 (the \"License\");\n+#  you may not use this file except in compliance with the License.\n+#  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+#  Unless required by applicable law or agreed to in writing, software\n+#  distributed under the License is distributed on an \"AS IS\" BASIS,\n+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+#  See the License for the specific language governing permissions and\n+#  limitations under the License.\n+import numpy as np\n+import pandas as pd\n+import tensorflow as tf\n+from tensorflow.python.framework import dtypes\n+from tensorflow.contrib import learn\n+from sklearn.metrics import mean_squared_error\n+\n+\n+LOG_DIR = './ops_logs'\n+TRAINING_STEPS = 10000\n+BATCH_SIZE = 10\n+PRINT_STEPS = TRAINING_STEPS / 1000\n+\n+\n+def sin_cos(x):\n+    return pd.DataFrame(dict(a=np.sin(x), b=np.cos(x)), index=x)\n+\n+\n+def rnn_data(data, time_steps, labels=False):\n+    \"\"\"\n+    creates new data frame based on previous observation\n+      * example:\n+        l = [1, 2, 3, 4, 5]\n+        time_steps = 2\n+        -> labels == False [[1, 2], [2, 3], [3, 4]]\n+        -> labels == True [2, 3, 4, 5]\n+    \"\"\"\n+    rnn_df = []\n+    for i in range(len(data) - time_steps):\n+        if labels:\n+            try:\n+                rnn_df.append(data.iloc[i + time_steps].as_matrix())\n+            except AttributeError:\n+                rnn_df.append(data.iloc[i + time_steps])\n+        else:\n+            data_ = data.iloc[i: i + time_steps].as_matrix()\n+            rnn_df.append(data_ if len(data_.shape) > 1 else [[i] for i in data_])\n+    return np.array(rnn_df)\n+\n+\n+def split_data(data, val_size=0.1, test_size=0.1):\n+    \"\"\"\n+    splits data to training, validation and testing parts\n+    \"\"\"\n+    ntest = int(round(len(data) * (1 - test_size)))\n+    nval = int(round(len(data.iloc[:ntest]) * (1 - val_size)))\n+\n+    df_train, df_val, df_test = data.iloc[:nval], data.iloc[nval:ntest], data.iloc[ntest:]\n+\n+    return df_train, df_val, df_test\n+\n+\n+def prepare_data(data, time_steps, labels=False, val_size=0.1, test_size=0.1):\n+    \"\"\"\n+    Given the number of `time_steps` and some data,\n+    prepares training, validation and test data for an lstm cell.\n+    \"\"\"\n+    df_train, df_val, df_test = split_data(data, val_size, test_size)\n+    return (rnn_data(df_train, time_steps, labels=labels),\n+            rnn_data(df_val, time_steps, labels=labels),\n+            rnn_data(df_test, time_steps, labels=labels))\n+\n+\n+def generate_data(fct, x, time_steps, seperate=False):\n+    \"\"\"generates data with based on a function fct\"\"\"\n+    data = fct(x)\n+    if not isinstance(data, pd.DataFrame):\n+        data = pd.DataFrame(data)\n+    train_x, val_x, test_x = prepare_data(data['a'] if seperate else data, time_steps)\n+    train_y, val_y, test_y = prepare_data(data['b'] if seperate else data, time_steps, labels=True)\n+    return dict(train=train_x, val=val_x, test=test_x), dict(train=train_y, val=val_y, test=test_y)\n+\n+\n+def lstm_model(time_steps, rnn_layers, dense_layers=None):\n+    \"\"\"\n+    Creates a deep model based on:\n+        * stacked lstm cells\n+        * an optional dense layers\n+    :param time_steps: the number of time steps the model will be looking at.\n+    :param rnn_layers: list of int or dict\n+                         * list of int: the steps used to instantiate the `BasicLSTMCell` cell\n+                         * list of dict: [{steps: int, keep_prob: int}, ...]\n+    :param dense_layers: list of nodes for each layer\n+    :return: the model definition\n+    \"\"\"\n+\n+    def lstm_cells(layers):", "path": "tensorflow/examples/skflow/lstm_regression.py", "position": null, "original_position": 100, "commit_id": "c1b0ad805542026707452e88bcdecdb3c9e8e950", "original_commit_id": "8e118809acb8e8d530de46c35954eae55f32cb67", "user": {"login": "ilblackdragon", "id": 175486, "node_id": "MDQ6VXNlcjE3NTQ4Ng==", "avatar_url": "https://avatars2.githubusercontent.com/u/175486?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ilblackdragon", "html_url": "https://github.com/ilblackdragon", "followers_url": "https://api.github.com/users/ilblackdragon/followers", "following_url": "https://api.github.com/users/ilblackdragon/following{/other_user}", "gists_url": "https://api.github.com/users/ilblackdragon/gists{/gist_id}", "starred_url": "https://api.github.com/users/ilblackdragon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ilblackdragon/subscriptions", "organizations_url": "https://api.github.com/users/ilblackdragon/orgs", "repos_url": "https://api.github.com/users/ilblackdragon/repos", "events_url": "https://api.github.com/users/ilblackdragon/events{/privacy}", "received_events_url": "https://api.github.com/users/ilblackdragon/received_events", "type": "User", "site_admin": false}, "body": "you can move `lstm_cells` and `dnn_layers` outside of the function just to make this function more readable.\n", "created_at": "2016-06-05T23:29:37Z", "updated_at": "2016-06-07T10:33:31Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/2674#discussion_r65827178", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/2674", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/65827178"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/2674#discussion_r65827178"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/2674"}}, "body_html": "<p>you can move <code>lstm_cells</code> and <code>dnn_layers</code> outside of the function just to make this function more readable.</p>", "body_text": "you can move lstm_cells and dnn_layers outside of the function just to make this function more readable."}