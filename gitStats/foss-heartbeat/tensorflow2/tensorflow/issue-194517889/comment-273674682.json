{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/273674682", "html_url": "https://github.com/tensorflow/tensorflow/pull/6205#issuecomment-273674682", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6205", "id": 273674682, "node_id": "MDEyOklzc3VlQ29tbWVudDI3MzY3NDY4Mg==", "user": {"login": "MycChiu", "id": 6672514, "node_id": "MDQ6VXNlcjY2NzI1MTQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/6672514?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MycChiu", "html_url": "https://github.com/MycChiu", "followers_url": "https://api.github.com/users/MycChiu/followers", "following_url": "https://api.github.com/users/MycChiu/following{/other_user}", "gists_url": "https://api.github.com/users/MycChiu/gists{/gist_id}", "starred_url": "https://api.github.com/users/MycChiu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MycChiu/subscriptions", "organizations_url": "https://api.github.com/users/MycChiu/orgs", "repos_url": "https://api.github.com/users/MycChiu/repos", "events_url": "https://api.github.com/users/MycChiu/events{/privacy}", "received_events_url": "https://api.github.com/users/MycChiu/received_events", "type": "User", "site_admin": false}, "created_at": "2017-01-19T03:46:02Z", "updated_at": "2017-01-19T03:46:02Z", "author_association": "NONE", "body_html": "<p>OK, this most recent commit is as far as I can go, with this, if I run<br>\n<code>bazel build -c opt --config=cuda //tensorflow/contrib/layers:layer_norm_fused_op_kernel</code><br>\nI would get this error:</p>\n<pre><code>ERROR: /home/dizizmaname/tensorflow/tensorflow/contrib/layers/kernels/BUILD:36:1: C++ compilation of rule '//tensorflow/contrib/layers/kernels:layer_norm_fused_kernel' failed: crosstool_wrapper_driver_is_not_gcc failed: error executing command external/local_config_cuda/crosstool/clang/bin/crosstool_wrapper_driver_is_not_gcc -U_FORTIFY_SOURCE '-D_FORTIFY_SOURCE=1' -fstack-protector -fPIE -Wall -Wunused-but-set-parameter ... (remaining 61 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\nIn file included from ./third_party/eigen3/unsupported/Eigen/CXX11/Tensor:4:0,\n                 from tensorflow/contrib/layers/kernels/layer_norm_fused_op_gpu.cu.cc:23:\nexternal/eigen_archive/unsupported/Eigen/CXX11/Tensor:84:26: fatal error: cuda_runtime.h: No such file or directory\n #include &lt;cuda_runtime.h&gt;\n                          ^\ncompilation terminated.\nTarget //tensorflow/contrib/layers:layer_norm_fused_op_kernel failed to build\n</code></pre>\n<p>I think I was not clear enough in my last comment; what I meant was I didn't know where to put <code>layer_norm_fused_op_gpu.cu.cc</code>, if I put it in cc_library's srcs,like what I am doing in this commit, it would give the above error. If I put it in tf_custom_op_library like this:</p>\n<pre><code>tf_custom_op_library(\n    name = \"python/ops/_layer_norm_fused_op.so\",\n    srcs = [\n        \"ops/layer_norm_fused_op.cc\",\n        ],\n    gpu_srcs = [\n        \"kernels/layer_norm_fused_op_gpu.cu.cc\",\n       ],\n    deps = [\n        \"//tensorflow/contrib/layers/kernels:layer_norm_fused_kernel\",\n    ]\n)\n</code></pre>\n<p>it would give me the following error:</p>\n<pre><code>ERROR: /home/dizizmaname/tensorflow/tensorflow/contrib/layers/BUILD:77:1: Label '//tensorflow/contrib/layers:kernels/layer_norm_fused_op_gpu.cu.cc' crosses boundary of subpackage 'tensorflow/contrib/layers/kernels' (perhaps you meant to put the colon here: '//tensorflow/contrib/layers/kernels:layer_norm_fused_op_gpu.cu.cc'?).\n</code></pre>", "body_text": "OK, this most recent commit is as far as I can go, with this, if I run\nbazel build -c opt --config=cuda //tensorflow/contrib/layers:layer_norm_fused_op_kernel\nI would get this error:\nERROR: /home/dizizmaname/tensorflow/tensorflow/contrib/layers/kernels/BUILD:36:1: C++ compilation of rule '//tensorflow/contrib/layers/kernels:layer_norm_fused_kernel' failed: crosstool_wrapper_driver_is_not_gcc failed: error executing command external/local_config_cuda/crosstool/clang/bin/crosstool_wrapper_driver_is_not_gcc -U_FORTIFY_SOURCE '-D_FORTIFY_SOURCE=1' -fstack-protector -fPIE -Wall -Wunused-but-set-parameter ... (remaining 61 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\nIn file included from ./third_party/eigen3/unsupported/Eigen/CXX11/Tensor:4:0,\n                 from tensorflow/contrib/layers/kernels/layer_norm_fused_op_gpu.cu.cc:23:\nexternal/eigen_archive/unsupported/Eigen/CXX11/Tensor:84:26: fatal error: cuda_runtime.h: No such file or directory\n #include <cuda_runtime.h>\n                          ^\ncompilation terminated.\nTarget //tensorflow/contrib/layers:layer_norm_fused_op_kernel failed to build\n\nI think I was not clear enough in my last comment; what I meant was I didn't know where to put layer_norm_fused_op_gpu.cu.cc, if I put it in cc_library's srcs,like what I am doing in this commit, it would give the above error. If I put it in tf_custom_op_library like this:\ntf_custom_op_library(\n    name = \"python/ops/_layer_norm_fused_op.so\",\n    srcs = [\n        \"ops/layer_norm_fused_op.cc\",\n        ],\n    gpu_srcs = [\n        \"kernels/layer_norm_fused_op_gpu.cu.cc\",\n       ],\n    deps = [\n        \"//tensorflow/contrib/layers/kernels:layer_norm_fused_kernel\",\n    ]\n)\n\nit would give me the following error:\nERROR: /home/dizizmaname/tensorflow/tensorflow/contrib/layers/BUILD:77:1: Label '//tensorflow/contrib/layers:kernels/layer_norm_fused_op_gpu.cu.cc' crosses boundary of subpackage 'tensorflow/contrib/layers/kernels' (perhaps you meant to put the colon here: '//tensorflow/contrib/layers/kernels:layer_norm_fused_op_gpu.cu.cc'?).", "body": "OK, this most recent commit is as far as I can go, with this, if I run\r\n`bazel build -c opt --config=cuda //tensorflow/contrib/layers:layer_norm_fused_op_kernel`\r\nI would get this error:\r\n```\r\nERROR: /home/dizizmaname/tensorflow/tensorflow/contrib/layers/kernels/BUILD:36:1: C++ compilation of rule '//tensorflow/contrib/layers/kernels:layer_norm_fused_kernel' failed: crosstool_wrapper_driver_is_not_gcc failed: error executing command external/local_config_cuda/crosstool/clang/bin/crosstool_wrapper_driver_is_not_gcc -U_FORTIFY_SOURCE '-D_FORTIFY_SOURCE=1' -fstack-protector -fPIE -Wall -Wunused-but-set-parameter ... (remaining 61 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\r\nIn file included from ./third_party/eigen3/unsupported/Eigen/CXX11/Tensor:4:0,\r\n                 from tensorflow/contrib/layers/kernels/layer_norm_fused_op_gpu.cu.cc:23:\r\nexternal/eigen_archive/unsupported/Eigen/CXX11/Tensor:84:26: fatal error: cuda_runtime.h: No such file or directory\r\n #include <cuda_runtime.h>\r\n                          ^\r\ncompilation terminated.\r\nTarget //tensorflow/contrib/layers:layer_norm_fused_op_kernel failed to build\r\n```\r\nI think I was not clear enough in my last comment; what I meant was I didn't know where to put `layer_norm_fused_op_gpu.cu.cc`, if I put it in cc_library's srcs,like what I am doing in this commit, it would give the above error. If I put it in tf_custom_op_library like this:\r\n```\r\ntf_custom_op_library(\r\n    name = \"python/ops/_layer_norm_fused_op.so\",\r\n    srcs = [\r\n        \"ops/layer_norm_fused_op.cc\",\r\n        ],\r\n    gpu_srcs = [\r\n        \"kernels/layer_norm_fused_op_gpu.cu.cc\",\r\n       ],\r\n    deps = [\r\n        \"//tensorflow/contrib/layers/kernels:layer_norm_fused_kernel\",\r\n    ]\r\n)\r\n```\r\nit would give me the following error:\r\n```\r\nERROR: /home/dizizmaname/tensorflow/tensorflow/contrib/layers/BUILD:77:1: Label '//tensorflow/contrib/layers:kernels/layer_norm_fused_op_gpu.cu.cc' crosses boundary of subpackage 'tensorflow/contrib/layers/kernels' (perhaps you meant to put the colon here: '//tensorflow/contrib/layers/kernels:layer_norm_fused_op_gpu.cu.cc'?).\r\n```"}