{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18459", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18459/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18459/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18459/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/18459", "id": 313711692, "node_id": "MDU6SXNzdWUzMTM3MTE2OTI=", "number": 18459, "title": "crop_and_resize on gpu in eager mode fails", "user": {"login": "cruvadom", "id": 15376926, "node_id": "MDQ6VXNlcjE1Mzc2OTI2", "avatar_url": "https://avatars0.githubusercontent.com/u/15376926?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cruvadom", "html_url": "https://github.com/cruvadom", "followers_url": "https://api.github.com/users/cruvadom/followers", "following_url": "https://api.github.com/users/cruvadom/following{/other_user}", "gists_url": "https://api.github.com/users/cruvadom/gists{/gist_id}", "starred_url": "https://api.github.com/users/cruvadom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cruvadom/subscriptions", "organizations_url": "https://api.github.com/users/cruvadom/orgs", "repos_url": "https://api.github.com/users/cruvadom/repos", "events_url": "https://api.github.com/users/cruvadom/events{/privacy}", "received_events_url": "https://api.github.com/users/cruvadom/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 736653459, "node_id": "MDU6TGFiZWw3MzY2NTM0NTk=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:eager", "name": "comp:eager", "color": "0052cc", "default": false}, {"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "rohan100jain", "id": 144114, "node_id": "MDQ6VXNlcjE0NDExNA==", "avatar_url": "https://avatars2.githubusercontent.com/u/144114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rohan100jain", "html_url": "https://github.com/rohan100jain", "followers_url": "https://api.github.com/users/rohan100jain/followers", "following_url": "https://api.github.com/users/rohan100jain/following{/other_user}", "gists_url": "https://api.github.com/users/rohan100jain/gists{/gist_id}", "starred_url": "https://api.github.com/users/rohan100jain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rohan100jain/subscriptions", "organizations_url": "https://api.github.com/users/rohan100jain/orgs", "repos_url": "https://api.github.com/users/rohan100jain/repos", "events_url": "https://api.github.com/users/rohan100jain/events{/privacy}", "received_events_url": "https://api.github.com/users/rohan100jain/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "rohan100jain", "id": 144114, "node_id": "MDQ6VXNlcjE0NDExNA==", "avatar_url": "https://avatars2.githubusercontent.com/u/144114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rohan100jain", "html_url": "https://github.com/rohan100jain", "followers_url": "https://api.github.com/users/rohan100jain/followers", "following_url": "https://api.github.com/users/rohan100jain/following{/other_user}", "gists_url": "https://api.github.com/users/rohan100jain/gists{/gist_id}", "starred_url": "https://api.github.com/users/rohan100jain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rohan100jain/subscriptions", "organizations_url": "https://api.github.com/users/rohan100jain/orgs", "repos_url": "https://api.github.com/users/rohan100jain/repos", "events_url": "https://api.github.com/users/rohan100jain/events{/privacy}", "received_events_url": "https://api.github.com/users/rohan100jain/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2018-04-12T12:46:39Z", "updated_at": "2018-09-15T18:37:51Z", "closed_at": "2018-09-15T18:29:35Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:<br>\nNo</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nLinux Ubuntu 16.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>:<br>\nusing pip</li>\n<li><strong>TensorFlow version (use command below)</strong>:<br>\n('v1.7.0-3-g024aecf414', '1.7.0')</li>\n<li><strong>Python version</strong>:<br>\n2.7</li>\n<li><strong>Bazel version (if compiling from source)</strong>:</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>:</li>\n<li><strong>CUDA/cuDNN version</strong>:<br>\nCuda 9, Cudnn 7</li>\n<li><strong>GPU model and memory</strong>:<br>\nGeForce GTX 745, 4GB</li>\n<li><strong>Exact command to reproduce</strong>:<br>\nimport tensorflow as tf, numpy as np<br>\ntf.enable_eager_execution()<br>\nimages = np.random.uniform(size=[1, 28, 28, 1]).astype('float32')<br>\nwith tf.device('gpu:0'):<br>\ntf.image.crop_and_resize(images, boxes=[(0, 0, 0.9, 0.5)], box_ind=[0], crop_size=[20, 20])</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>When using <code>tf.image.crop_and_resize</code> in eager mode with the gpu, getting the error that says <code>box_index</code> has wrong values, where values are actually fine.</p>\n<p>See the reproduction code above. Works without the gpu, or without eager mode.<br>\nLooks similar to <a href=\"url\">https://github.com/tensorflow/tensorflow/issues/10618</a></p>\n<p>Error message:<br>\n2018-04-12 14:44:57.137104: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA<br>\n2018-04-12 14:44:57.542554: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:898] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br>\n2018-04-12 14:44:57.542970: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1344] Found device 0 with properties:<br>\nname: GeForce GTX 745 major: 5 minor: 0 memoryClockRate(GHz): 1.0325<br>\npciBusID: 0000:01:00.0<br>\ntotalMemory: 3.95GiB freeMemory: 3.92GiB<br>\n2018-04-12 14:44:57.542987: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1423] Adding visible gpu devices: 0<br>\n2018-04-12 14:44:57.688951: I tensorflow/core/common_runtime/gpu/gpu_device.cc:911] Device interconnect StreamExecutor with strength 1 edge matrix:<br>\n2018-04-12 14:44:57.688973: I tensorflow/core/common_runtime/gpu/gpu_device.cc:917]      0<br>\n2018-04-12 14:44:57.688982: I tensorflow/core/common_runtime/gpu/gpu_device.cc:930] 0:   N<br>\n2018-04-12 14:44:57.689139: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1041] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 3713 MB memory) -&gt; physical GPU (device: 0, name: GeForce GTX 745, pci bus id: 0000:01:00.0, compute capability: 5.0)<br>\nTraceback (most recent call last):<br>\nFile \"\", line 2, in <br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_image_ops.py\", line 368, in crop_and_resize<br>\nextrapolation_value=extrapolation_value, name=name)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_image_ops.py\", line 396, in crop_and_resize_eager_fallback<br>\nattrs=_attrs, ctx=_ctx, name=name)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/eager/execute.py\", line 66, in quick_execute<br>\nsix.raise_from(core._status_to_exception(e.code, message), None)<br>\nFile \"/usr/local/lib/python2.7/dist-packages/six.py\", line 737, in raise_from<br>\nraise value<br>\ntensorflow.python.framework.errors_impl.OutOfRangeError: box_index has values outside [0, batch_size) [Op:CropAndResize]</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nNo\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nLinux Ubuntu 16.04\nTensorFlow installed from (source or binary):\nusing pip\nTensorFlow version (use command below):\n('v1.7.0-3-g024aecf414', '1.7.0')\nPython version:\n2.7\nBazel version (if compiling from source):\nGCC/Compiler version (if compiling from source):\nCUDA/cuDNN version:\nCuda 9, Cudnn 7\nGPU model and memory:\nGeForce GTX 745, 4GB\nExact command to reproduce:\nimport tensorflow as tf, numpy as np\ntf.enable_eager_execution()\nimages = np.random.uniform(size=[1, 28, 28, 1]).astype('float32')\nwith tf.device('gpu:0'):\ntf.image.crop_and_resize(images, boxes=[(0, 0, 0.9, 0.5)], box_ind=[0], crop_size=[20, 20])\n\nDescribe the problem\nWhen using tf.image.crop_and_resize in eager mode with the gpu, getting the error that says box_index has wrong values, where values are actually fine.\nSee the reproduction code above. Works without the gpu, or without eager mode.\nLooks similar to https://github.com/tensorflow/tensorflow/issues/10618\nError message:\n2018-04-12 14:44:57.137104: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\n2018-04-12 14:44:57.542554: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:898] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2018-04-12 14:44:57.542970: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1344] Found device 0 with properties:\nname: GeForce GTX 745 major: 5 minor: 0 memoryClockRate(GHz): 1.0325\npciBusID: 0000:01:00.0\ntotalMemory: 3.95GiB freeMemory: 3.92GiB\n2018-04-12 14:44:57.542987: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1423] Adding visible gpu devices: 0\n2018-04-12 14:44:57.688951: I tensorflow/core/common_runtime/gpu/gpu_device.cc:911] Device interconnect StreamExecutor with strength 1 edge matrix:\n2018-04-12 14:44:57.688973: I tensorflow/core/common_runtime/gpu/gpu_device.cc:917]      0\n2018-04-12 14:44:57.688982: I tensorflow/core/common_runtime/gpu/gpu_device.cc:930] 0:   N\n2018-04-12 14:44:57.689139: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1041] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 3713 MB memory) -> physical GPU (device: 0, name: GeForce GTX 745, pci bus id: 0000:01:00.0, compute capability: 5.0)\nTraceback (most recent call last):\nFile \"\", line 2, in \nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_image_ops.py\", line 368, in crop_and_resize\nextrapolation_value=extrapolation_value, name=name)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_image_ops.py\", line 396, in crop_and_resize_eager_fallback\nattrs=_attrs, ctx=_ctx, name=name)\nFile \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/eager/execute.py\", line 66, in quick_execute\nsix.raise_from(core._status_to_exception(e.code, message), None)\nFile \"/usr/local/lib/python2.7/dist-packages/six.py\", line 737, in raise_from\nraise value\ntensorflow.python.framework.errors_impl.OutOfRangeError: box_index has values outside [0, batch_size) [Op:CropAndResize]", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\nNo\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\n Linux Ubuntu 16.04\r\n- **TensorFlow installed from (source or binary)**:\r\nusing pip\r\n- **TensorFlow version (use command below)**:\r\n('v1.7.0-3-g024aecf414', '1.7.0')\r\n- **Python version**: \r\n2.7\r\n- **Bazel version (if compiling from source)**:\r\n- **GCC/Compiler version (if compiling from source)**:\r\n- **CUDA/cuDNN version**:\r\nCuda 9, Cudnn 7\r\n- **GPU model and memory**:\r\nGeForce GTX 745, 4GB\r\n- **Exact command to reproduce**:\r\nimport tensorflow as tf, numpy as np\r\ntf.enable_eager_execution()\r\nimages = np.random.uniform(size=[1, 28, 28, 1]).astype('float32')\r\nwith tf.device('gpu:0'):\r\n  tf.image.crop_and_resize(images, boxes=[(0, 0, 0.9, 0.5)], box_ind=[0], crop_size=[20, 20])\r\n\r\n### Describe the problem\r\nWhen using `tf.image.crop_and_resize` in eager mode with the gpu, getting the error that says `box_index` has wrong values, where values are actually fine. \r\n\r\nSee the reproduction code above. Works without the gpu, or without eager mode. \r\nLooks similar to [https://github.com/tensorflow/tensorflow/issues/10618](url)\r\n\r\nError message:\r\n2018-04-12 14:44:57.137104: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\r\n2018-04-12 14:44:57.542554: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:898] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2018-04-12 14:44:57.542970: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1344] Found device 0 with properties: \r\nname: GeForce GTX 745 major: 5 minor: 0 memoryClockRate(GHz): 1.0325\r\npciBusID: 0000:01:00.0\r\ntotalMemory: 3.95GiB freeMemory: 3.92GiB\r\n2018-04-12 14:44:57.542987: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1423] Adding visible gpu devices: 0\r\n2018-04-12 14:44:57.688951: I tensorflow/core/common_runtime/gpu/gpu_device.cc:911] Device interconnect StreamExecutor with strength 1 edge matrix:\r\n2018-04-12 14:44:57.688973: I tensorflow/core/common_runtime/gpu/gpu_device.cc:917]      0 \r\n2018-04-12 14:44:57.688982: I tensorflow/core/common_runtime/gpu/gpu_device.cc:930] 0:   N \r\n2018-04-12 14:44:57.689139: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1041] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 3713 MB memory) -> physical GPU (device: 0, name: GeForce GTX 745, pci bus id: 0000:01:00.0, compute capability: 5.0)\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 2, in <module>\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_image_ops.py\", line 368, in crop_and_resize\r\n    extrapolation_value=extrapolation_value, name=name)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_image_ops.py\", line 396, in crop_and_resize_eager_fallback\r\n    attrs=_attrs, ctx=_ctx, name=name)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/eager/execute.py\", line 66, in quick_execute\r\n    six.raise_from(core._status_to_exception(e.code, message), None)\r\n  File \"/usr/local/lib/python2.7/dist-packages/six.py\", line 737, in raise_from\r\n    raise value\r\ntensorflow.python.framework.errors_impl.OutOfRangeError: box_index has values outside [0, batch_size) [Op:CropAndResize]\r\n"}