{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19951", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19951/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19951/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19951/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/19951", "id": 331714958, "node_id": "MDU6SXNzdWUzMzE3MTQ5NTg=", "number": 19951, "title": "Bazel Build transform_graph failing to find inputs/outputs ", "user": {"login": "ashermancinelli", "id": 30530525, "node_id": "MDQ6VXNlcjMwNTMwNTI1", "avatar_url": "https://avatars1.githubusercontent.com/u/30530525?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ashermancinelli", "html_url": "https://github.com/ashermancinelli", "followers_url": "https://api.github.com/users/ashermancinelli/followers", "following_url": "https://api.github.com/users/ashermancinelli/following{/other_user}", "gists_url": "https://api.github.com/users/ashermancinelli/gists{/gist_id}", "starred_url": "https://api.github.com/users/ashermancinelli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ashermancinelli/subscriptions", "organizations_url": "https://api.github.com/users/ashermancinelli/orgs", "repos_url": "https://api.github.com/users/ashermancinelli/repos", "events_url": "https://api.github.com/users/ashermancinelli/events{/privacy}", "received_events_url": "https://api.github.com/users/ashermancinelli/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-06-12T19:06:23Z", "updated_at": "2018-09-17T10:53:55Z", "closed_at": "2018-06-12T20:59:23Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: No</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: OSX HS 10.13.4</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.8</li>\n<li><strong>Python version</strong>: 3.65</li>\n<li><strong>CUDA/cuDNN version</strong>: 9.0</li>\n<li><strong>GPU model and memory</strong>: Tesla V100 16g x2</li>\n</ul>\n<h3>Describe The Problem</h3>\n<p>Using retrained Inception V3 model.<br>\nI have used the exact scripts from the docs to fold the graph and optimize for mobile, yet it keeps failing. I ran <code>./configure</code> and built the <code>transform_graph</code> function as specified. Running the function with:</p>\n<pre><code>bazel-bin/tensorflow/tools/graph_transforms/transform_graph \\\n--in_graph=/path/frozen.pb \\\n--out_graph=/path/optimized.pb \\\n--inputs=\u201cinput\u201d \\\n--outputs=\u201cnew_output_layer/probability\u201d \\\n--transforms='\n  strip_unused_nodes(type=float, shape=\"1,299,299,3\")\n  remove_nodes(op=Identity, op=CheckNumerics)\n  fold_constants(ignore_errors=true)\n  fold_batch_norms\n  fold_old_batch_norms'\n</code></pre>\n<p>gives the error: <code>Input node \u2018new_output_layer/probability\u2019 not found in graph</code> (full trace below) even though I know I specified the tensor names correctly. For some reason it seems to be looking for an input node under my output node's name even though the output node's name is rightly under <code>--outputs</code>. Inspecting the graph with <code>bazel-bin/tensorflow/tools/graph_transforms/summarize_graph --in_graph=/path/frozen.pb</code> gives:</p>\n<pre><code>Found 1 possible inputs: (name=input, type=float(1), shape=[?,299,299,3]) \nNo variables spotted.\nFound 1 possible outputs: (name=new_output_layer/probability, op=Softmax) \nFound 21826166 (21.83M) const parameters, 0 (0) variable parameters, and 191 control_edges\n</code></pre>\n<p>confirming that my names are correct.</p>\n<h3>Full Logs/Code</h3>\n<p>Inspect_graph:<br>\n<code>$ bazel-bin/tensorflow/tools/graph_transforms/summarize_graph --in_graph=/Users/manc568/Documents/projects/tf-threeclass/pbdir/frozen.pb</code></p>\n<pre><code>Found 1 possible inputs: (name=input, type=float(1), shape=[?,299,299,3]) \nNo variables spotted.\nFound 1 possible outputs: (name=new_output_layer/probability, op=Softmax) \nFound 21826166 (21.83M) const parameters, 0 (0) variable parameters, and 191 control_edges\nOp types used: 849 Switch, 679 Const, 569 Identity, 188 FusedBatchNorm, 95 Merge, 94 Conv2D, 94 Relu, 15 ConcatV2, 10 AvgPool, 4 MaxPool, 2 Add, 2 Mul, 1 BiasAdd, 1 Placeholder, 1 MatMul, 1 RandomUniform, 1 RealDiv, 1 Floor, 1 Shape, 1 Softmax, 1 Squeeze, 1 Sub, 1 PlaceholderWithDefault\nTo use with tensorflow/tools/benchmark:benchmark_model try these arguments:\nbazel run tensorflow/tools/benchmark:benchmark_model -- --graph=/Users/manc568/Documents/projects/tf-threeclass/pbdir/frozen.pb --show_flops --input_layer=input --input_layer_type=float --input_layer_shape=-1,299,299,3 --output_layer=new_output_layer/probability\n</code></pre>\n<p>Transform_graph:</p>\n<pre><code>$ bazel-bin/tensorflow/tools/graph_transforms/transform_graph \\\n--in_graph=/Users/manc568/Documents/projects/tf-threeclass/pbdir/frozen.pb \\\n--out_graph=/Users/manc568/Documents/projects/tf-threeclass/pbdir/optimized_inception_graph.pb \\\n--inputs=\u201cinput\u201d \\\n--outputs=\u201cnew_output_layer/probability\u201d \\\n--transforms='\n  strip_unused_nodes(type=float, shape=\"1,299,299,3\")\n  remove_nodes(op=Identity, op=CheckNumerics)\n  fold_constants(ignore_errors=true)\n  fold_batch_norms\n  fold_old_batch_norms\n  quantize_weights' \n</code></pre>\n<pre><code>2018-06-12 11:38:14.293873: I tensorflow/tools/graph_transforms/transform_graph.cc:318] Applying strip_unused_nodes\n2018-06-12 11:38:14.297407: E tensorflow/tools/graph_transforms/transform_graph.cc:264] Input node \u201cnew_output_layer/probability\u201d not found in graph\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): No\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): OSX HS 10.13.4\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below): 1.8\nPython version: 3.65\nCUDA/cuDNN version: 9.0\nGPU model and memory: Tesla V100 16g x2\n\nDescribe The Problem\nUsing retrained Inception V3 model.\nI have used the exact scripts from the docs to fold the graph and optimize for mobile, yet it keeps failing. I ran ./configure and built the transform_graph function as specified. Running the function with:\nbazel-bin/tensorflow/tools/graph_transforms/transform_graph \\\n--in_graph=/path/frozen.pb \\\n--out_graph=/path/optimized.pb \\\n--inputs=\u201cinput\u201d \\\n--outputs=\u201cnew_output_layer/probability\u201d \\\n--transforms='\n  strip_unused_nodes(type=float, shape=\"1,299,299,3\")\n  remove_nodes(op=Identity, op=CheckNumerics)\n  fold_constants(ignore_errors=true)\n  fold_batch_norms\n  fold_old_batch_norms'\n\ngives the error: Input node \u2018new_output_layer/probability\u2019 not found in graph (full trace below) even though I know I specified the tensor names correctly. For some reason it seems to be looking for an input node under my output node's name even though the output node's name is rightly under --outputs. Inspecting the graph with bazel-bin/tensorflow/tools/graph_transforms/summarize_graph --in_graph=/path/frozen.pb gives:\nFound 1 possible inputs: (name=input, type=float(1), shape=[?,299,299,3]) \nNo variables spotted.\nFound 1 possible outputs: (name=new_output_layer/probability, op=Softmax) \nFound 21826166 (21.83M) const parameters, 0 (0) variable parameters, and 191 control_edges\n\nconfirming that my names are correct.\nFull Logs/Code\nInspect_graph:\n$ bazel-bin/tensorflow/tools/graph_transforms/summarize_graph --in_graph=/Users/manc568/Documents/projects/tf-threeclass/pbdir/frozen.pb\nFound 1 possible inputs: (name=input, type=float(1), shape=[?,299,299,3]) \nNo variables spotted.\nFound 1 possible outputs: (name=new_output_layer/probability, op=Softmax) \nFound 21826166 (21.83M) const parameters, 0 (0) variable parameters, and 191 control_edges\nOp types used: 849 Switch, 679 Const, 569 Identity, 188 FusedBatchNorm, 95 Merge, 94 Conv2D, 94 Relu, 15 ConcatV2, 10 AvgPool, 4 MaxPool, 2 Add, 2 Mul, 1 BiasAdd, 1 Placeholder, 1 MatMul, 1 RandomUniform, 1 RealDiv, 1 Floor, 1 Shape, 1 Softmax, 1 Squeeze, 1 Sub, 1 PlaceholderWithDefault\nTo use with tensorflow/tools/benchmark:benchmark_model try these arguments:\nbazel run tensorflow/tools/benchmark:benchmark_model -- --graph=/Users/manc568/Documents/projects/tf-threeclass/pbdir/frozen.pb --show_flops --input_layer=input --input_layer_type=float --input_layer_shape=-1,299,299,3 --output_layer=new_output_layer/probability\n\nTransform_graph:\n$ bazel-bin/tensorflow/tools/graph_transforms/transform_graph \\\n--in_graph=/Users/manc568/Documents/projects/tf-threeclass/pbdir/frozen.pb \\\n--out_graph=/Users/manc568/Documents/projects/tf-threeclass/pbdir/optimized_inception_graph.pb \\\n--inputs=\u201cinput\u201d \\\n--outputs=\u201cnew_output_layer/probability\u201d \\\n--transforms='\n  strip_unused_nodes(type=float, shape=\"1,299,299,3\")\n  remove_nodes(op=Identity, op=CheckNumerics)\n  fold_constants(ignore_errors=true)\n  fold_batch_norms\n  fold_old_batch_norms\n  quantize_weights' \n\n2018-06-12 11:38:14.293873: I tensorflow/tools/graph_transforms/transform_graph.cc:318] Applying strip_unused_nodes\n2018-06-12 11:38:14.297407: E tensorflow/tools/graph_transforms/transform_graph.cc:264] Input node \u201cnew_output_layer/probability\u201d not found in graph", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: OSX HS 10.13.4\r\n- **TensorFlow installed from (source or binary)**: binary\r\n- **TensorFlow version (use command below)**: 1.8\r\n- **Python version**: 3.65\r\n- **CUDA/cuDNN version**: 9.0\r\n- **GPU model and memory**: Tesla V100 16g x2\r\n\r\n### Describe The Problem\r\nUsing retrained Inception V3 model.\r\nI have used the exact scripts from the docs to fold the graph and optimize for mobile, yet it keeps failing. I ran `./configure` and built the `transform_graph` function as specified. Running the function with:\r\n```\r\nbazel-bin/tensorflow/tools/graph_transforms/transform_graph \\\r\n--in_graph=/path/frozen.pb \\\r\n--out_graph=/path/optimized.pb \\\r\n--inputs=\u201cinput\u201d \\\r\n--outputs=\u201cnew_output_layer/probability\u201d \\\r\n--transforms='\r\n  strip_unused_nodes(type=float, shape=\"1,299,299,3\")\r\n  remove_nodes(op=Identity, op=CheckNumerics)\r\n  fold_constants(ignore_errors=true)\r\n  fold_batch_norms\r\n  fold_old_batch_norms'\r\n```\r\ngives the error: `Input node \u2018new_output_layer/probability\u2019 not found in graph` (full trace below) even though I know I specified the tensor names correctly. For some reason it seems to be looking for an input node under my output node's name even though the output node's name is rightly under `--outputs`. Inspecting the graph with `bazel-bin/tensorflow/tools/graph_transforms/summarize_graph --in_graph=/path/frozen.pb` gives:\r\n```\r\nFound 1 possible inputs: (name=input, type=float(1), shape=[?,299,299,3]) \r\nNo variables spotted.\r\nFound 1 possible outputs: (name=new_output_layer/probability, op=Softmax) \r\nFound 21826166 (21.83M) const parameters, 0 (0) variable parameters, and 191 control_edges\r\n```\r\nconfirming that my names are correct. \r\n\r\n### Full Logs/Code\r\nInspect_graph:\r\n`$ bazel-bin/tensorflow/tools/graph_transforms/summarize_graph --in_graph=/Users/manc568/Documents/projects/tf-threeclass/pbdir/frozen.pb`\r\n```\r\nFound 1 possible inputs: (name=input, type=float(1), shape=[?,299,299,3]) \r\nNo variables spotted.\r\nFound 1 possible outputs: (name=new_output_layer/probability, op=Softmax) \r\nFound 21826166 (21.83M) const parameters, 0 (0) variable parameters, and 191 control_edges\r\nOp types used: 849 Switch, 679 Const, 569 Identity, 188 FusedBatchNorm, 95 Merge, 94 Conv2D, 94 Relu, 15 ConcatV2, 10 AvgPool, 4 MaxPool, 2 Add, 2 Mul, 1 BiasAdd, 1 Placeholder, 1 MatMul, 1 RandomUniform, 1 RealDiv, 1 Floor, 1 Shape, 1 Softmax, 1 Squeeze, 1 Sub, 1 PlaceholderWithDefault\r\nTo use with tensorflow/tools/benchmark:benchmark_model try these arguments:\r\nbazel run tensorflow/tools/benchmark:benchmark_model -- --graph=/Users/manc568/Documents/projects/tf-threeclass/pbdir/frozen.pb --show_flops --input_layer=input --input_layer_type=float --input_layer_shape=-1,299,299,3 --output_layer=new_output_layer/probability\r\n```\r\nTransform_graph:\r\n```\r\n$ bazel-bin/tensorflow/tools/graph_transforms/transform_graph \\\r\n--in_graph=/Users/manc568/Documents/projects/tf-threeclass/pbdir/frozen.pb \\\r\n--out_graph=/Users/manc568/Documents/projects/tf-threeclass/pbdir/optimized_inception_graph.pb \\\r\n--inputs=\u201cinput\u201d \\\r\n--outputs=\u201cnew_output_layer/probability\u201d \\\r\n--transforms='\r\n  strip_unused_nodes(type=float, shape=\"1,299,299,3\")\r\n  remove_nodes(op=Identity, op=CheckNumerics)\r\n  fold_constants(ignore_errors=true)\r\n  fold_batch_norms\r\n  fold_old_batch_norms\r\n  quantize_weights' \r\n```\r\n```\r\n2018-06-12 11:38:14.293873: I tensorflow/tools/graph_transforms/transform_graph.cc:318] Applying strip_unused_nodes\r\n2018-06-12 11:38:14.297407: E tensorflow/tools/graph_transforms/transform_graph.cc:264] Input node \u201cnew_output_layer/probability\u201d not found in graph\r\n```"}