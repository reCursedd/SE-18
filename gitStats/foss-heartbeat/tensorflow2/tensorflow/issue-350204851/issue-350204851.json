{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21585", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21585/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21585/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21585/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/21585", "id": 350204851, "node_id": "MDU6SXNzdWUzNTAyMDQ4NTE=", "number": 21585, "title": "Freezing a graph from a .pb file", "user": {"login": "NylaWorker", "id": 25090956, "node_id": "MDQ6VXNlcjI1MDkwOTU2", "avatar_url": "https://avatars2.githubusercontent.com/u/25090956?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NylaWorker", "html_url": "https://github.com/NylaWorker", "followers_url": "https://api.github.com/users/NylaWorker/followers", "following_url": "https://api.github.com/users/NylaWorker/following{/other_user}", "gists_url": "https://api.github.com/users/NylaWorker/gists{/gist_id}", "starred_url": "https://api.github.com/users/NylaWorker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NylaWorker/subscriptions", "organizations_url": "https://api.github.com/users/NylaWorker/orgs", "repos_url": "https://api.github.com/users/NylaWorker/repos", "events_url": "https://api.github.com/users/NylaWorker/events{/privacy}", "received_events_url": "https://api.github.com/users/NylaWorker/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "cy89", "id": 29663194, "node_id": "MDQ6VXNlcjI5NjYzMTk0", "avatar_url": "https://avatars0.githubusercontent.com/u/29663194?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cy89", "html_url": "https://github.com/cy89", "followers_url": "https://api.github.com/users/cy89/followers", "following_url": "https://api.github.com/users/cy89/following{/other_user}", "gists_url": "https://api.github.com/users/cy89/gists{/gist_id}", "starred_url": "https://api.github.com/users/cy89/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cy89/subscriptions", "organizations_url": "https://api.github.com/users/cy89/orgs", "repos_url": "https://api.github.com/users/cy89/repos", "events_url": "https://api.github.com/users/cy89/events{/privacy}", "received_events_url": "https://api.github.com/users/cy89/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "cy89", "id": 29663194, "node_id": "MDQ6VXNlcjI5NjYzMTk0", "avatar_url": "https://avatars0.githubusercontent.com/u/29663194?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cy89", "html_url": "https://github.com/cy89", "followers_url": "https://api.github.com/users/cy89/followers", "following_url": "https://api.github.com/users/cy89/following{/other_user}", "gists_url": "https://api.github.com/users/cy89/gists{/gist_id}", "starred_url": "https://api.github.com/users/cy89/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cy89/subscriptions", "organizations_url": "https://api.github.com/users/cy89/orgs", "repos_url": "https://api.github.com/users/cy89/repos", "events_url": "https://api.github.com/users/cy89/events{/privacy}", "received_events_url": "https://api.github.com/users/cy89/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2018-08-13T21:42:27Z", "updated_at": "2018-08-15T20:17:12Z", "closed_at": "2018-08-15T20:02:52Z", "author_association": "NONE", "body_html": "<p>Hello!<br>\nThis is not a bug or a feature request but I cannot find answers on stackoverflow and have tried multiple ways of fixing this. This is my stack-overflow question: <a href=\"https://stackoverflow.com/questions/51826706/tensorflow-load-a-pb-file-and-then-save-it-as-a-frozen-graph-issues\" rel=\"nofollow\">https://stackoverflow.com/questions/51826706/tensorflow-load-a-pb-file-and-then-save-it-as-a-frozen-graph-issues</a><br>\nI went to the discussion forums and after finding some bugs in that code got redirected here.<br>\nThis is the code that I have tried:</p>\n<pre><code>import tensorflow as tf\nimport sys\nfrom tensorflow.python.platform import gfile\n\nfrom tensorflow.core.protobuf import saved_model_pb2\nfrom tensorflow.python.util import compat\nconstant_values = {}\n\nwith tf.Session() as sess:\n    model_filename ='saved_model.pb'\n    with gfile.FastGFile(model_filename, 'rb') as f:\n\n      \tdata = compat.as_bytes(f.read())# reads binary\n      \tsm = saved_model_pb2.SavedModel()\n        print(sm)\n      \tsm.ParseFromString(data)# parses through file. \n      \tprint(sm)\n      \tif 1 != len(sm.meta_graphs):\n      \t\tprint('More than one graph found. Not sure which to write')\n      \t\tsys.exit(1)\n            \n        # Attempt at initializing the variables here \n        g_in = tf.import_graph_def(sm.meta_graphs[0].graph_def)\n        constant_ops = [op for op in sess.graph.get_operations() if op.type == \"Const\"]\n        for constant_op in constant_ops:\n            constant_values[constant_op.name] = sess.run(constant_op.outputs[0])\n            \n        # Creating frozen graph.\n        output_graph = \"frozen_grapha.pb\"\n        output_nodes = [n.name for n in tf.get_default_graph().as_graph_def().node]\n        output_graph_def = tf.graph_util.convert_variables_to_constants(\n           sess, # The session is used to retrieve the weights\n           sess.graph_def,\n           output_nodes# The output node names are used to select the usefull nodes\n        ) \n\n        # Finally we serialize and dump the output graph to the filesystem\n        with tf.gfile.GFile(output_graph, \"wb\") as f:\n            f.write(output_graph_def.SerializeToString())\n        print(\"%d ops in the final graph.\" % len(output_graph_def.node))\n        print(g_in)\nLOGDIR='.'\ntrain_writer = tf.summary.FileWriter(LOGDIR)\ntrain_writer.add_graph(sess.graph)\n\n</code></pre>\n<p>The error I get:</p>\n<pre><code>\ntensorflow.python.framework.errors_impl.FailedPreconditionError: Attempting to use uninitialized value NAME_OF_NODE_IN_GRAPH\n</code></pre>\n<p>Thank you for your time!</p>", "body_text": "Hello!\nThis is not a bug or a feature request but I cannot find answers on stackoverflow and have tried multiple ways of fixing this. This is my stack-overflow question: https://stackoverflow.com/questions/51826706/tensorflow-load-a-pb-file-and-then-save-it-as-a-frozen-graph-issues\nI went to the discussion forums and after finding some bugs in that code got redirected here.\nThis is the code that I have tried:\nimport tensorflow as tf\nimport sys\nfrom tensorflow.python.platform import gfile\n\nfrom tensorflow.core.protobuf import saved_model_pb2\nfrom tensorflow.python.util import compat\nconstant_values = {}\n\nwith tf.Session() as sess:\n    model_filename ='saved_model.pb'\n    with gfile.FastGFile(model_filename, 'rb') as f:\n\n      \tdata = compat.as_bytes(f.read())# reads binary\n      \tsm = saved_model_pb2.SavedModel()\n        print(sm)\n      \tsm.ParseFromString(data)# parses through file. \n      \tprint(sm)\n      \tif 1 != len(sm.meta_graphs):\n      \t\tprint('More than one graph found. Not sure which to write')\n      \t\tsys.exit(1)\n            \n        # Attempt at initializing the variables here \n        g_in = tf.import_graph_def(sm.meta_graphs[0].graph_def)\n        constant_ops = [op for op in sess.graph.get_operations() if op.type == \"Const\"]\n        for constant_op in constant_ops:\n            constant_values[constant_op.name] = sess.run(constant_op.outputs[0])\n            \n        # Creating frozen graph.\n        output_graph = \"frozen_grapha.pb\"\n        output_nodes = [n.name for n in tf.get_default_graph().as_graph_def().node]\n        output_graph_def = tf.graph_util.convert_variables_to_constants(\n           sess, # The session is used to retrieve the weights\n           sess.graph_def,\n           output_nodes# The output node names are used to select the usefull nodes\n        ) \n\n        # Finally we serialize and dump the output graph to the filesystem\n        with tf.gfile.GFile(output_graph, \"wb\") as f:\n            f.write(output_graph_def.SerializeToString())\n        print(\"%d ops in the final graph.\" % len(output_graph_def.node))\n        print(g_in)\nLOGDIR='.'\ntrain_writer = tf.summary.FileWriter(LOGDIR)\ntrain_writer.add_graph(sess.graph)\n\n\nThe error I get:\n\ntensorflow.python.framework.errors_impl.FailedPreconditionError: Attempting to use uninitialized value NAME_OF_NODE_IN_GRAPH\n\nThank you for your time!", "body": "Hello!\r\nThis is not a bug or a feature request but I cannot find answers on stackoverflow and have tried multiple ways of fixing this. This is my stack-overflow question: https://stackoverflow.com/questions/51826706/tensorflow-load-a-pb-file-and-then-save-it-as-a-frozen-graph-issues\r\nI went to the discussion forums and after finding some bugs in that code got redirected here. \r\nThis is the code that I have tried:\r\n```\r\nimport tensorflow as tf\r\nimport sys\r\nfrom tensorflow.python.platform import gfile\r\n\r\nfrom tensorflow.core.protobuf import saved_model_pb2\r\nfrom tensorflow.python.util import compat\r\nconstant_values = {}\r\n\r\nwith tf.Session() as sess:\r\n    model_filename ='saved_model.pb'\r\n    with gfile.FastGFile(model_filename, 'rb') as f:\r\n\r\n      \tdata = compat.as_bytes(f.read())# reads binary\r\n      \tsm = saved_model_pb2.SavedModel()\r\n        print(sm)\r\n      \tsm.ParseFromString(data)# parses through file. \r\n      \tprint(sm)\r\n      \tif 1 != len(sm.meta_graphs):\r\n      \t\tprint('More than one graph found. Not sure which to write')\r\n      \t\tsys.exit(1)\r\n            \r\n        # Attempt at initializing the variables here \r\n        g_in = tf.import_graph_def(sm.meta_graphs[0].graph_def)\r\n        constant_ops = [op for op in sess.graph.get_operations() if op.type == \"Const\"]\r\n        for constant_op in constant_ops:\r\n            constant_values[constant_op.name] = sess.run(constant_op.outputs[0])\r\n            \r\n        # Creating frozen graph.\r\n        output_graph = \"frozen_grapha.pb\"\r\n        output_nodes = [n.name for n in tf.get_default_graph().as_graph_def().node]\r\n        output_graph_def = tf.graph_util.convert_variables_to_constants(\r\n           sess, # The session is used to retrieve the weights\r\n           sess.graph_def,\r\n           output_nodes# The output node names are used to select the usefull nodes\r\n        ) \r\n\r\n        # Finally we serialize and dump the output graph to the filesystem\r\n        with tf.gfile.GFile(output_graph, \"wb\") as f:\r\n            f.write(output_graph_def.SerializeToString())\r\n        print(\"%d ops in the final graph.\" % len(output_graph_def.node))\r\n        print(g_in)\r\nLOGDIR='.'\r\ntrain_writer = tf.summary.FileWriter(LOGDIR)\r\ntrain_writer.add_graph(sess.graph)\r\n\r\n```\r\n\r\nThe error I get:\r\n```\r\n\r\ntensorflow.python.framework.errors_impl.FailedPreconditionError: Attempting to use uninitialized value NAME_OF_NODE_IN_GRAPH\r\n```\r\n\r\nThank you for your time!"}