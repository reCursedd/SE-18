{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/239646852", "html_url": "https://github.com/tensorflow/tensorflow/issues/3786#issuecomment-239646852", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3786", "id": 239646852, "node_id": "MDEyOklzc3VlQ29tbWVudDIzOTY0Njg1Mg==", "user": {"login": "wurrego", "id": 21013135, "node_id": "MDQ6VXNlcjIxMDEzMTM1", "avatar_url": "https://avatars1.githubusercontent.com/u/21013135?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wurrego", "html_url": "https://github.com/wurrego", "followers_url": "https://api.github.com/users/wurrego/followers", "following_url": "https://api.github.com/users/wurrego/following{/other_user}", "gists_url": "https://api.github.com/users/wurrego/gists{/gist_id}", "starred_url": "https://api.github.com/users/wurrego/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wurrego/subscriptions", "organizations_url": "https://api.github.com/users/wurrego/orgs", "repos_url": "https://api.github.com/users/wurrego/repos", "events_url": "https://api.github.com/users/wurrego/events{/privacy}", "received_events_url": "https://api.github.com/users/wurrego/received_events", "type": "User", "site_admin": false}, "created_at": "2016-08-13T23:22:50Z", "updated_at": "2016-08-14T00:32:15Z", "author_association": "NONE", "body_html": "<p>[RESOLVED] Same error, same setup: Ubuntu 16.04, gcc 5.4, GTX 1080 - 367.35,  CUDA 8.0.27.1, CuDNN 5.1.5, and current master of TF.   capability v6.1</p>\n<p>Searching for h2log1p reveals it isn't there ..<br>\ngrep -rnw /path/to/cuda/include -e \"h2log1p\"</p>\n<p>but in /path/to/cuda/include/cuda_fp16.h you can find the declarations for h2log ... which is why the declare statement in PacketMathHalf.h was probably added<br>\n#if defined <strong>CUDACC_VER</strong> &amp;&amp; <strong>CUDACC_VER</strong> &gt;= 80000 &amp;&amp; defined <strong>CUDA_ARCH</strong> &amp;&amp; <strong>CUDA_ARCH</strong> &gt;= 530.</p>\n<p>Steps:</p>\n<ol>\n<li><em>git clone --recurse-submodules <a href=\"https://github.com/tensorflow/tensorflow\">https://github.com/tensorflow/tensorflow</a></em></li>\n<li>edit tensorflow/third_party/gpus/crosstool/CROSSTOL and add:<br>\n<strong><code>cxx_builtin_include_directory: \"path/to/cuda/include\"</code></strong>     (note: symlink did not work, use actual path)</li>\n<li><em>bazel build -c opt --config=cuda //tensorflow/tools/pip_package:build_pip_package</em></li>\n<li>This will take awhile but eventually fail due to above error \"undefined h2log1p\"</li>\n<li>locate PacketMathHalf.h and edit it</li>\n<li>comment out:   <strong><code>// return h2log1p(a);</code></strong></li>\n<li>paste in:<br>\n<strong><code>float a1 = __low2float(a); float a2 = __high2float(a); float r1 = log1pf(a1); float r2 = log1pf(a2); return __floats2half2_rn(r1, r2);</code></strong></li>\n<li><em>bazel build -c opt --config=cuda //tensorflow/tools/pip_package:build_pip_package</em></li>\n<li><em>bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg</em></li>\n<li>The name of the .whl file will depend on your platform.</li>\n<li><em>sudo pip install /tmp/tensorflow_pkg/tensorflow-0.10.0rc0-py2-none-any.whl</em></li>\n<li>test with<br>\ncd tensorflow/models/image/mnist<br>\npython convolutional.py</li>\n</ol>", "body_text": "[RESOLVED] Same error, same setup: Ubuntu 16.04, gcc 5.4, GTX 1080 - 367.35,  CUDA 8.0.27.1, CuDNN 5.1.5, and current master of TF.   capability v6.1\nSearching for h2log1p reveals it isn't there ..\ngrep -rnw /path/to/cuda/include -e \"h2log1p\"\nbut in /path/to/cuda/include/cuda_fp16.h you can find the declarations for h2log ... which is why the declare statement in PacketMathHalf.h was probably added\n#if defined CUDACC_VER && CUDACC_VER >= 80000 && defined CUDA_ARCH && CUDA_ARCH >= 530.\nSteps:\n\ngit clone --recurse-submodules https://github.com/tensorflow/tensorflow\nedit tensorflow/third_party/gpus/crosstool/CROSSTOL and add:\ncxx_builtin_include_directory: \"path/to/cuda/include\"     (note: symlink did not work, use actual path)\nbazel build -c opt --config=cuda //tensorflow/tools/pip_package:build_pip_package\nThis will take awhile but eventually fail due to above error \"undefined h2log1p\"\nlocate PacketMathHalf.h and edit it\ncomment out:   // return h2log1p(a);\npaste in:\nfloat a1 = __low2float(a); float a2 = __high2float(a); float r1 = log1pf(a1); float r2 = log1pf(a2); return __floats2half2_rn(r1, r2);\nbazel build -c opt --config=cuda //tensorflow/tools/pip_package:build_pip_package\nbazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg\nThe name of the .whl file will depend on your platform.\nsudo pip install /tmp/tensorflow_pkg/tensorflow-0.10.0rc0-py2-none-any.whl\ntest with\ncd tensorflow/models/image/mnist\npython convolutional.py", "body": "[RESOLVED] Same error, same setup: Ubuntu 16.04, gcc 5.4, GTX 1080 - 367.35,  CUDA 8.0.27.1, CuDNN 5.1.5, and current master of TF.   capability v6.1\n\nSearching for h2log1p reveals it isn't there ..\n grep -rnw /path/to/cuda/include -e \"h2log1p\"\n\nbut in /path/to/cuda/include/cuda_fp16.h you can find the declarations for h2log ... which is why the declare statement in PacketMathHalf.h was probably added \n#if defined **CUDACC_VER** && **CUDACC_VER** >= 80000 && defined **CUDA_ARCH** && **CUDA_ARCH** >= 530.\n\nSteps:\n1. _git clone --recurse-submodules https://github.com/tensorflow/tensorflow_\n2. edit tensorflow/third_party/gpus/crosstool/CROSSTOL and add:  \n   **`cxx_builtin_include_directory: \"path/to/cuda/include\"`**     (note: symlink did not work, use actual path)\n3. _bazel build -c opt --config=cuda //tensorflow/tools/pip_package:build_pip_package_\n4. This will take awhile but eventually fail due to above error \"undefined h2log1p\"\n5. locate PacketMathHalf.h and edit it\n6. comment out:   **`// return h2log1p(a);`**\n7. paste in:\n   **`\n   float a1 = __low2float(a);\n   float a2 = __high2float(a);\n   float r1 = log1pf(a1);\n   float r2 = log1pf(a2);\n   return __floats2half2_rn(r1, r2);\n   `**\n8. _bazel build -c opt --config=cuda //tensorflow/tools/pip_package:build_pip_package_\n9. _bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg_\n10. The name of the .whl file will depend on your platform.\n11. _sudo pip install /tmp/tensorflow_pkg/tensorflow-0.10.0rc0-py2-none-any.whl_\n12. test with\n    cd tensorflow/models/image/mnist\n    python convolutional.py\n"}