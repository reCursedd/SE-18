{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/403230451", "html_url": "https://github.com/tensorflow/tensorflow/issues/3388#issuecomment-403230451", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3388", "id": 403230451, "node_id": "MDEyOklzc3VlQ29tbWVudDQwMzIzMDQ1MQ==", "user": {"login": "princeofpotato", "id": 22792158, "node_id": "MDQ6VXNlcjIyNzkyMTU4", "avatar_url": "https://avatars3.githubusercontent.com/u/22792158?v=4", "gravatar_id": "", "url": "https://api.github.com/users/princeofpotato", "html_url": "https://github.com/princeofpotato", "followers_url": "https://api.github.com/users/princeofpotato/followers", "following_url": "https://api.github.com/users/princeofpotato/following{/other_user}", "gists_url": "https://api.github.com/users/princeofpotato/gists{/gist_id}", "starred_url": "https://api.github.com/users/princeofpotato/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/princeofpotato/subscriptions", "organizations_url": "https://api.github.com/users/princeofpotato/orgs", "repos_url": "https://api.github.com/users/princeofpotato/repos", "events_url": "https://api.github.com/users/princeofpotato/events{/privacy}", "received_events_url": "https://api.github.com/users/princeofpotato/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-07T17:17:31Z", "updated_at": "2018-07-07T17:17:31Z", "author_association": "NONE", "body_html": "<p>The code from <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1544502\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ChristopherLucas\">@ChristopherLucas</a> should work.  Let's see the reason:<br>\nThe  original code:<br>\nif self._session is not None:<br>\ntry:<br>\nif self._created_with_new_api:<br>\ntf_session.TF_DeleteSession(self._session)<br>\nelse:<br>\ntf_session.TF_DeleteDeprecatedSession(self._session)<br>\nexcept AttributeError:</p>\n<h1>At shutdown, <code>c_api_util</code> or <code>tf_session</code> may have been garbage</h1>\n<h1>collected, causing the above method calls to fail. In this case,</h1>\n<h1>silently leak since the program is about to terminate anyway.</h1>\n<p>pass<br>\nself._session = None</p>\n<p>Look at the comments. What the comment said should also be suitable for the NoneType Error, I think. So the code from <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1544502\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ChristopherLucas\">@ChristopherLucas</a> should work perfectly.</p>\n<p>I did a similar change to the code and it works fine:<br>\nexcept (AttributeError, TypeError) as e:<br>\n# At shutdown, <code>c_api_util</code> or <code>tf_session</code> may have been garbage<br>\n# collected, causing the above method calls to fail. In this case,<br>\n# silently leak since the program is about to terminate anyway.<br>\nprint('Error passed, Do not worry. <code>c_api_util</code> or <code>tf_session</code> may have been garbage collected. The error is ',e.args[-1])<br>\npass</p>", "body_text": "The code from @ChristopherLucas should work.  Let's see the reason:\nThe  original code:\nif self._session is not None:\ntry:\nif self._created_with_new_api:\ntf_session.TF_DeleteSession(self._session)\nelse:\ntf_session.TF_DeleteDeprecatedSession(self._session)\nexcept AttributeError:\nAt shutdown, c_api_util or tf_session may have been garbage\ncollected, causing the above method calls to fail. In this case,\nsilently leak since the program is about to terminate anyway.\npass\nself._session = None\nLook at the comments. What the comment said should also be suitable for the NoneType Error, I think. So the code from @ChristopherLucas should work perfectly.\nI did a similar change to the code and it works fine:\nexcept (AttributeError, TypeError) as e:\n# At shutdown, c_api_util or tf_session may have been garbage\n# collected, causing the above method calls to fail. In this case,\n# silently leak since the program is about to terminate anyway.\nprint('Error passed, Do not worry. c_api_util or tf_session may have been garbage collected. The error is ',e.args[-1])\npass", "body": "The code from @ChristopherLucas should work.  Let's see the reason:\r\nThe  original code:\r\nif self._session is not None:\r\n try:\r\n   if self._created_with_new_api:\r\n     tf_session.TF_DeleteSession(self._session)\r\n   else:\r\n     tf_session.TF_DeleteDeprecatedSession(self._session)\r\n except AttributeError:\r\n   # At shutdown, `c_api_util` or `tf_session` may have been garbage\r\n   # collected, causing the above method calls to fail. In this case,\r\n   # silently leak since the program is about to terminate anyway.\r\n   pass\r\n self._session = None\r\n\r\nLook at the comments. What the comment said should also be suitable for the NoneType Error, I think. So the code from @ChristopherLucas should work perfectly.\r\n\r\nI did a similar change to the code and it works fine:\r\n      except (AttributeError, TypeError) as e:\r\n        # At shutdown, `c_api_util` or `tf_session` may have been garbage\r\n        # collected, causing the above method calls to fail. In this case,\r\n        # silently leak since the program is about to terminate anyway.\r\n        print('Error passed, Do not worry. `c_api_util` or `tf_session` may have been garbage collected. The error is ',e.args[-1])\r\n        pass"}