{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6650", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6650/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6650/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6650/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/6650", "id": 198860521, "node_id": "MDU6SXNzdWUxOTg4NjA1MjE=", "number": 6650, "title": "`histogram_fixed_width` type errors and GPU issues", "user": {"login": "willcrichton", "id": 663326, "node_id": "MDQ6VXNlcjY2MzMyNg==", "avatar_url": "https://avatars3.githubusercontent.com/u/663326?v=4", "gravatar_id": "", "url": "https://api.github.com/users/willcrichton", "html_url": "https://github.com/willcrichton", "followers_url": "https://api.github.com/users/willcrichton/followers", "following_url": "https://api.github.com/users/willcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/willcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/willcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/willcrichton/subscriptions", "organizations_url": "https://api.github.com/users/willcrichton/orgs", "repos_url": "https://api.github.com/users/willcrichton/repos", "events_url": "https://api.github.com/users/willcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/willcrichton/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "sherrym", "id": 12770037, "node_id": "MDQ6VXNlcjEyNzcwMDM3", "avatar_url": "https://avatars0.githubusercontent.com/u/12770037?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sherrym", "html_url": "https://github.com/sherrym", "followers_url": "https://api.github.com/users/sherrym/followers", "following_url": "https://api.github.com/users/sherrym/following{/other_user}", "gists_url": "https://api.github.com/users/sherrym/gists{/gist_id}", "starred_url": "https://api.github.com/users/sherrym/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sherrym/subscriptions", "organizations_url": "https://api.github.com/users/sherrym/orgs", "repos_url": "https://api.github.com/users/sherrym/repos", "events_url": "https://api.github.com/users/sherrym/events{/privacy}", "received_events_url": "https://api.github.com/users/sherrym/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "sherrym", "id": 12770037, "node_id": "MDQ6VXNlcjEyNzcwMDM3", "avatar_url": "https://avatars0.githubusercontent.com/u/12770037?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sherrym", "html_url": "https://github.com/sherrym", "followers_url": "https://api.github.com/users/sherrym/followers", "following_url": "https://api.github.com/users/sherrym/following{/other_user}", "gists_url": "https://api.github.com/users/sherrym/gists{/gist_id}", "starred_url": "https://api.github.com/users/sherrym/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sherrym/subscriptions", "organizations_url": "https://api.github.com/users/sherrym/orgs", "repos_url": "https://api.github.com/users/sherrym/repos", "events_url": "https://api.github.com/users/sherrym/events{/privacy}", "received_events_url": "https://api.github.com/users/sherrym/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2017-01-05T02:18:27Z", "updated_at": "2017-07-21T11:50:21Z", "closed_at": "2017-06-16T18:35:20Z", "author_association": "NONE", "body_html": "<p>With the following script:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\n<span class=\"pl-k\">with</span> tf.device(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>/gpu:0<span class=\"pl-pds\">'</span></span>):\n    image <span class=\"pl-k\">=</span> tf.zeros([<span class=\"pl-c1\">200</span>, <span class=\"pl-c1\">200</span>, <span class=\"pl-c1\">3</span>], <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>tf.int32)\n    hist_range <span class=\"pl-k\">=</span> tf.constant([<span class=\"pl-c1\">0</span>, <span class=\"pl-c1\">255</span>], <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>tf.int32)\n    hist <span class=\"pl-k\">=</span> histogram_fixed_width(image, hist_range, <span class=\"pl-v\">nbins</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">16</span>, <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>tf.int32)\n\n<span class=\"pl-k\">with</span> tf.Session() <span class=\"pl-k\">as</span> sess:\n    sess.run(hist)</pre></div>\n<p>Gives the following error:</p>\n<pre><code>Traceback (most recent call last):\n  File \"hist.py\", line 5, in &lt;module&gt;\n    hist = tf.histogram_fixed_width(image, hist_range, nbins=16, dtype=tf.int32)\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/ops/histogram_ops.py\", line 84, in histogram_fixed_width\n    indices = math_ops.floor(nbins_float * scaled_values, name='indices')\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/ops/math_ops.py\", line 805, in binary_op_wrapper\n    y = ops.convert_to_tensor(y, dtype=x.dtype.base_dtype, name=\"y\")\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 651, in convert_to_tensor\n    as_ref=False)\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 716, in internal_convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 589, in _TensorTensorConversionFunction\n    % (dtype.name, t.dtype.name, str(t)))\nValueError: Tensor conversion requested dtype float32 for Tensor with dtype float64: 'Tensor(\"histogram_fixed_width/scaled_values:0\", shape=(120000,), dtype=float64)'\n</code></pre>\n<p>I believe the issue here is this line: <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/histogram_ops.py#L75\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/histogram_ops.py#L75</a></p>\n<p>It should say <code>to_double</code> instead of <code>to_float</code>. However, even if you fix this, you then get this error:</p>\n<pre><code>Caused by op u'histogram_fixed_width', defined at:\n  File \"hist.py\", line 79, in &lt;module&gt;\n    hist = histogram_fixed_width(image, hist_range, nbins=16, dtype=tf.int32)\n  File \"hist.py\", line 74, in histogram_fixed_width\n    name=scope)\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 2952, in unsorted_segment_sum\n    num_segments=num_segments, name=name)\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\n    op_def=op_def)\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2392, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\n    self._traceback = _extract_stack()\n\nInvalidArgumentError (see above for traceback): Cannot assign a device to node 'histogram_fixed_width': Could not satisfy explicit device specification '/device:GPU:0' because no supported kernel for GPU devices is available.\n\t [[Node: histogram_fixed_width = UnsortedSegmentSum[T=DT_INT32, Tindices=DT_INT32, _device=\"/device:GPU:0\"](histogram_fixed_width/ones_like, histogram_fixed_width/Cast, histogram_fixed_width/nbins)]]\n</code></pre>\n<p>I ran this both with the TF version from <code>pip install tensorflow-gpu</code> as well as when building from source with <code>--config=cuda</code> and got this error. However, the source makes it seem like this should work: <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/segment_reduction_ops.cc#L323\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/segment_reduction_ops.cc#L323</a></p>", "body_text": "With the following script:\nimport tensorflow as tf\n\nwith tf.device('/gpu:0'):\n    image = tf.zeros([200, 200, 3], dtype=tf.int32)\n    hist_range = tf.constant([0, 255], dtype=tf.int32)\n    hist = histogram_fixed_width(image, hist_range, nbins=16, dtype=tf.int32)\n\nwith tf.Session() as sess:\n    sess.run(hist)\nGives the following error:\nTraceback (most recent call last):\n  File \"hist.py\", line 5, in <module>\n    hist = tf.histogram_fixed_width(image, hist_range, nbins=16, dtype=tf.int32)\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/ops/histogram_ops.py\", line 84, in histogram_fixed_width\n    indices = math_ops.floor(nbins_float * scaled_values, name='indices')\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/ops/math_ops.py\", line 805, in binary_op_wrapper\n    y = ops.convert_to_tensor(y, dtype=x.dtype.base_dtype, name=\"y\")\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 651, in convert_to_tensor\n    as_ref=False)\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 716, in internal_convert_to_tensor\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 589, in _TensorTensorConversionFunction\n    % (dtype.name, t.dtype.name, str(t)))\nValueError: Tensor conversion requested dtype float32 for Tensor with dtype float64: 'Tensor(\"histogram_fixed_width/scaled_values:0\", shape=(120000,), dtype=float64)'\n\nI believe the issue here is this line: https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/histogram_ops.py#L75\nIt should say to_double instead of to_float. However, even if you fix this, you then get this error:\nCaused by op u'histogram_fixed_width', defined at:\n  File \"hist.py\", line 79, in <module>\n    hist = histogram_fixed_width(image, hist_range, nbins=16, dtype=tf.int32)\n  File \"hist.py\", line 74, in histogram_fixed_width\n    name=scope)\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 2952, in unsorted_segment_sum\n    num_segments=num_segments, name=name)\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\n    op_def=op_def)\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2392, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\n    self._traceback = _extract_stack()\n\nInvalidArgumentError (see above for traceback): Cannot assign a device to node 'histogram_fixed_width': Could not satisfy explicit device specification '/device:GPU:0' because no supported kernel for GPU devices is available.\n\t [[Node: histogram_fixed_width = UnsortedSegmentSum[T=DT_INT32, Tindices=DT_INT32, _device=\"/device:GPU:0\"](histogram_fixed_width/ones_like, histogram_fixed_width/Cast, histogram_fixed_width/nbins)]]\n\nI ran this both with the TF version from pip install tensorflow-gpu as well as when building from source with --config=cuda and got this error. However, the source makes it seem like this should work: https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/segment_reduction_ops.cc#L323", "body": "With the following script:\r\n\r\n```python\r\nimport tensorflow as tf\r\n\r\nwith tf.device('/gpu:0'):\r\n    image = tf.zeros([200, 200, 3], dtype=tf.int32)\r\n    hist_range = tf.constant([0, 255], dtype=tf.int32)\r\n    hist = histogram_fixed_width(image, hist_range, nbins=16, dtype=tf.int32)\r\n\r\nwith tf.Session() as sess:\r\n    sess.run(hist)\r\n```\r\n\r\nGives the following error:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"hist.py\", line 5, in <module>\r\n    hist = tf.histogram_fixed_width(image, hist_range, nbins=16, dtype=tf.int32)\r\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/ops/histogram_ops.py\", line 84, in histogram_fixed_width\r\n    indices = math_ops.floor(nbins_float * scaled_values, name='indices')\r\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/ops/math_ops.py\", line 805, in binary_op_wrapper\r\n    y = ops.convert_to_tensor(y, dtype=x.dtype.base_dtype, name=\"y\")\r\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 651, in convert_to_tensor\r\n    as_ref=False)\r\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 716, in internal_convert_to_tensor\r\n    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\r\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 589, in _TensorTensorConversionFunction\r\n    % (dtype.name, t.dtype.name, str(t)))\r\nValueError: Tensor conversion requested dtype float32 for Tensor with dtype float64: 'Tensor(\"histogram_fixed_width/scaled_values:0\", shape=(120000,), dtype=float64)'\r\n```\r\n\r\nI believe the issue here is this line: https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/histogram_ops.py#L75\r\n\r\nIt should say `to_double` instead of `to_float`. However, even if you fix this, you then get this error: \r\n\r\n```\r\nCaused by op u'histogram_fixed_width', defined at:\r\n  File \"hist.py\", line 79, in <module>\r\n    hist = histogram_fixed_width(image, hist_range, nbins=16, dtype=tf.int32)\r\n  File \"hist.py\", line 74, in histogram_fixed_width\r\n    name=scope)\r\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 2952, in unsorted_segment_sum\r\n    num_segments=num_segments, name=name)\r\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\r\n    op_def=op_def)\r\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2392, in create_op\r\n    original_op=self._default_original_op, op_def=op_def)\r\n  File \"/home/wcrichto/.env/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\r\n    self._traceback = _extract_stack()\r\n\r\nInvalidArgumentError (see above for traceback): Cannot assign a device to node 'histogram_fixed_width': Could not satisfy explicit device specification '/device:GPU:0' because no supported kernel for GPU devices is available.\r\n\t [[Node: histogram_fixed_width = UnsortedSegmentSum[T=DT_INT32, Tindices=DT_INT32, _device=\"/device:GPU:0\"](histogram_fixed_width/ones_like, histogram_fixed_width/Cast, histogram_fixed_width/nbins)]]\r\n```\r\n\r\nI ran this both with the TF version from `pip install tensorflow-gpu` as well as when building from source with `--config=cuda` and got this error. However, the source makes it seem like this should work: https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/segment_reduction_ops.cc#L323\r\n"}