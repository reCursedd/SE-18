{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4624", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4624/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4624/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4624/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/4624", "id": 179743984, "node_id": "MDU6SXNzdWUxNzk3NDM5ODQ=", "number": 4624, "title": "Meta Graph Import not working when used with outputs_collections", "user": {"login": "bfreskura", "id": 9371112, "node_id": "MDQ6VXNlcjkzNzExMTI=", "avatar_url": "https://avatars3.githubusercontent.com/u/9371112?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bfreskura", "html_url": "https://github.com/bfreskura", "followers_url": "https://api.github.com/users/bfreskura/followers", "following_url": "https://api.github.com/users/bfreskura/following{/other_user}", "gists_url": "https://api.github.com/users/bfreskura/gists{/gist_id}", "starred_url": "https://api.github.com/users/bfreskura/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bfreskura/subscriptions", "organizations_url": "https://api.github.com/users/bfreskura/orgs", "repos_url": "https://api.github.com/users/bfreskura/repos", "events_url": "https://api.github.com/users/bfreskura/events{/privacy}", "received_events_url": "https://api.github.com/users/bfreskura/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "sguada", "id": 1766524, "node_id": "MDQ6VXNlcjE3NjY1MjQ=", "avatar_url": "https://avatars3.githubusercontent.com/u/1766524?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sguada", "html_url": "https://github.com/sguada", "followers_url": "https://api.github.com/users/sguada/followers", "following_url": "https://api.github.com/users/sguada/following{/other_user}", "gists_url": "https://api.github.com/users/sguada/gists{/gist_id}", "starred_url": "https://api.github.com/users/sguada/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sguada/subscriptions", "organizations_url": "https://api.github.com/users/sguada/orgs", "repos_url": "https://api.github.com/users/sguada/repos", "events_url": "https://api.github.com/users/sguada/events{/privacy}", "received_events_url": "https://api.github.com/users/sguada/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "sguada", "id": 1766524, "node_id": "MDQ6VXNlcjE3NjY1MjQ=", "avatar_url": "https://avatars3.githubusercontent.com/u/1766524?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sguada", "html_url": "https://github.com/sguada", "followers_url": "https://api.github.com/users/sguada/followers", "following_url": "https://api.github.com/users/sguada/following{/other_user}", "gists_url": "https://api.github.com/users/sguada/gists{/gist_id}", "starred_url": "https://api.github.com/users/sguada/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sguada/subscriptions", "organizations_url": "https://api.github.com/users/sguada/orgs", "repos_url": "https://api.github.com/users/sguada/repos", "events_url": "https://api.github.com/users/sguada/events{/privacy}", "received_events_url": "https://api.github.com/users/sguada/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2016-09-28T11:10:43Z", "updated_at": "2017-06-16T18:15:14Z", "closed_at": "2017-06-16T18:15:14Z", "author_association": "NONE", "body_html": "<h3>OS info</h3>\n<pre><code>DISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=15.10\nDISTRIB_CODENAME=wily\nDISTRIB_DESCRIPTION=\"Ubuntu 15.10\"\nNAME=\"Ubuntu\"\nVERSION=\"15.10 (Wily Werewolf)\"\nID=ubuntu\nID_LIKE=debian\nPRETTY_NAME=\"Ubuntu 15.10\"\nVERSION_ID=\"15.10\"\n\nKERNEL: Linux 4.2.0-16-generic x86_64\n</code></pre>\n<h3>Cuda Version:</h3>\n<pre><code>-rw-r--r-- 1 root root 189170 Nov 30  2015 /usr/local/cuda/lib/libcudadevrt.a\nlrwxrwxrwx 1 root root     16 Nov 30  2015 /usr/local/cuda/lib/libcudart.so -&gt; libcudart.so.7.5\nlrwxrwxrwx 1 root root     19 Nov 30  2015 /usr/local/cuda/lib/libcudart.so.7.5 -&gt; libcudart.so.7.5.18\n-rwxr-xr-x 1 root root 311596 Nov 30  2015 /usr/local/cuda/lib/libcudart.so.7.5.18\n-rw-r--r-- 1 root root 558020 Nov 30  2015 /usr/local/cuda/lib/libcudart_static.a\n</code></pre>\n<h3>Tensorflow pip version:</h3>\n<p><a href=\"https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow-0.10.0-cp34-cp34m-linux_x86_64.whl\" rel=\"nofollow\">https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow-0.10.0-cp34-cp34m-linux_x86_64.whl</a></p>\n<h3>Python <code>tensorflow.__version__</code> output</h3>\n<pre><code>0.10.0\n</code></pre>\n<h3>Minimal Reproducible code</h3>\n<pre><code>import tensorflow as tf\nfrom tensorflow.contrib import slim\n\ntf_chk = \"model_ckpt-0\"\ntf_meta = \"model_ckpt-0.meta\"\n\nimages = tf.constant(1.2, tf.float32, shape=[100, 100])\nwith slim.arg_scope(\n        [slim.fully_connected],\n        outputs_collections=[tf.GraphKeys.ACTIVATIONS]): ## NOT working\n        # outputs_collections=[]): ## This works\n    logits = slim.fully_connected(images, 100, scope='logits')\n\ninit = tf.initialize_all_variables()\n\nwith tf.Session() as sess:\n    sess.run(init)\n    saver = tf.train.Saver()\n    saver.save(sess, tf_chk)\n\nwith tf.Graph().as_default():\n    with tf.Session() as sess:\n        new_saver = tf.train.import_meta_graph(tf_meta)\n        new_saver.restore(sess, tf_chk)\n</code></pre>\n<h3>Description</h3>\n<p>Code above will crash the program with the following stack trace:</p>\n<pre><code>Traceback (most recent call last):\n  File \"test.py\", line 24, in &lt;module&gt;\n    new_saver = tf.train.import_meta_graph(tf_meta)\n  File \"/home/x/.local/lib/python3.4/site-packages/tensorflow/python/training/saver.py\", line 1458, in import_m\neta_graph\n    return _import_meta_graph_def(read_meta_graph_file(meta_graph_or_file))\n  File \"/home/x/.local/lib/python3.4/site-packages/tensorflow/python/training/saver.py\", line 1369, in _import_\nmeta_graph_def\n    col_op = ops.get_default_graph().as_graph_element(value)\n  File \"/home/x/.local/lib/python3.4/site-packages/tensorflow/python/framework/ops.py\", line 2392, in as_graph_\nelement\n    return self._as_graph_element_locked(obj, allow_tensor, allow_operation)\n  File \"/home/x/.local/lib/python3.4/site-packages/tensorflow/python/framework/ops.py\", line 2452, in _as_graph\n_element_locked\n    \"graph.\" % repr(name))\nKeyError: \"The name 'logits' refers to an Operation not in the graph.\"\n</code></pre>\n<p>However, if I create <em>outputs_collections</em> with the empty list, the code will<br>\nwork. Also, the code will work if I don't specify the <em>outputs_collections</em><br>\nargument.</p>", "body_text": "OS info\nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=15.10\nDISTRIB_CODENAME=wily\nDISTRIB_DESCRIPTION=\"Ubuntu 15.10\"\nNAME=\"Ubuntu\"\nVERSION=\"15.10 (Wily Werewolf)\"\nID=ubuntu\nID_LIKE=debian\nPRETTY_NAME=\"Ubuntu 15.10\"\nVERSION_ID=\"15.10\"\n\nKERNEL: Linux 4.2.0-16-generic x86_64\n\nCuda Version:\n-rw-r--r-- 1 root root 189170 Nov 30  2015 /usr/local/cuda/lib/libcudadevrt.a\nlrwxrwxrwx 1 root root     16 Nov 30  2015 /usr/local/cuda/lib/libcudart.so -> libcudart.so.7.5\nlrwxrwxrwx 1 root root     19 Nov 30  2015 /usr/local/cuda/lib/libcudart.so.7.5 -> libcudart.so.7.5.18\n-rwxr-xr-x 1 root root 311596 Nov 30  2015 /usr/local/cuda/lib/libcudart.so.7.5.18\n-rw-r--r-- 1 root root 558020 Nov 30  2015 /usr/local/cuda/lib/libcudart_static.a\n\nTensorflow pip version:\nhttps://storage.googleapis.com/tensorflow/linux/gpu/tensorflow-0.10.0-cp34-cp34m-linux_x86_64.whl\nPython tensorflow.__version__ output\n0.10.0\n\nMinimal Reproducible code\nimport tensorflow as tf\nfrom tensorflow.contrib import slim\n\ntf_chk = \"model_ckpt-0\"\ntf_meta = \"model_ckpt-0.meta\"\n\nimages = tf.constant(1.2, tf.float32, shape=[100, 100])\nwith slim.arg_scope(\n        [slim.fully_connected],\n        outputs_collections=[tf.GraphKeys.ACTIVATIONS]): ## NOT working\n        # outputs_collections=[]): ## This works\n    logits = slim.fully_connected(images, 100, scope='logits')\n\ninit = tf.initialize_all_variables()\n\nwith tf.Session() as sess:\n    sess.run(init)\n    saver = tf.train.Saver()\n    saver.save(sess, tf_chk)\n\nwith tf.Graph().as_default():\n    with tf.Session() as sess:\n        new_saver = tf.train.import_meta_graph(tf_meta)\n        new_saver.restore(sess, tf_chk)\n\nDescription\nCode above will crash the program with the following stack trace:\nTraceback (most recent call last):\n  File \"test.py\", line 24, in <module>\n    new_saver = tf.train.import_meta_graph(tf_meta)\n  File \"/home/x/.local/lib/python3.4/site-packages/tensorflow/python/training/saver.py\", line 1458, in import_m\neta_graph\n    return _import_meta_graph_def(read_meta_graph_file(meta_graph_or_file))\n  File \"/home/x/.local/lib/python3.4/site-packages/tensorflow/python/training/saver.py\", line 1369, in _import_\nmeta_graph_def\n    col_op = ops.get_default_graph().as_graph_element(value)\n  File \"/home/x/.local/lib/python3.4/site-packages/tensorflow/python/framework/ops.py\", line 2392, in as_graph_\nelement\n    return self._as_graph_element_locked(obj, allow_tensor, allow_operation)\n  File \"/home/x/.local/lib/python3.4/site-packages/tensorflow/python/framework/ops.py\", line 2452, in _as_graph\n_element_locked\n    \"graph.\" % repr(name))\nKeyError: \"The name 'logits' refers to an Operation not in the graph.\"\n\nHowever, if I create outputs_collections with the empty list, the code will\nwork. Also, the code will work if I don't specify the outputs_collections\nargument.", "body": "### OS info\n\n```\nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=15.10\nDISTRIB_CODENAME=wily\nDISTRIB_DESCRIPTION=\"Ubuntu 15.10\"\nNAME=\"Ubuntu\"\nVERSION=\"15.10 (Wily Werewolf)\"\nID=ubuntu\nID_LIKE=debian\nPRETTY_NAME=\"Ubuntu 15.10\"\nVERSION_ID=\"15.10\"\n\nKERNEL: Linux 4.2.0-16-generic x86_64\n```\n### Cuda Version:\n\n```\n-rw-r--r-- 1 root root 189170 Nov 30  2015 /usr/local/cuda/lib/libcudadevrt.a\nlrwxrwxrwx 1 root root     16 Nov 30  2015 /usr/local/cuda/lib/libcudart.so -> libcudart.so.7.5\nlrwxrwxrwx 1 root root     19 Nov 30  2015 /usr/local/cuda/lib/libcudart.so.7.5 -> libcudart.so.7.5.18\n-rwxr-xr-x 1 root root 311596 Nov 30  2015 /usr/local/cuda/lib/libcudart.so.7.5.18\n-rw-r--r-- 1 root root 558020 Nov 30  2015 /usr/local/cuda/lib/libcudart_static.a\n```\n### Tensorflow pip version:\n\nhttps://storage.googleapis.com/tensorflow/linux/gpu/tensorflow-0.10.0-cp34-cp34m-linux_x86_64.whl\n### Python `tensorflow.__version__` output\n\n```\n0.10.0\n```\n### Minimal Reproducible code\n\n```\nimport tensorflow as tf\nfrom tensorflow.contrib import slim\n\ntf_chk = \"model_ckpt-0\"\ntf_meta = \"model_ckpt-0.meta\"\n\nimages = tf.constant(1.2, tf.float32, shape=[100, 100])\nwith slim.arg_scope(\n        [slim.fully_connected],\n        outputs_collections=[tf.GraphKeys.ACTIVATIONS]): ## NOT working\n        # outputs_collections=[]): ## This works\n    logits = slim.fully_connected(images, 100, scope='logits')\n\ninit = tf.initialize_all_variables()\n\nwith tf.Session() as sess:\n    sess.run(init)\n    saver = tf.train.Saver()\n    saver.save(sess, tf_chk)\n\nwith tf.Graph().as_default():\n    with tf.Session() as sess:\n        new_saver = tf.train.import_meta_graph(tf_meta)\n        new_saver.restore(sess, tf_chk)\n```\n### Description\n\nCode above will crash the program with the following stack trace:\n\n```\nTraceback (most recent call last):\n  File \"test.py\", line 24, in <module>\n    new_saver = tf.train.import_meta_graph(tf_meta)\n  File \"/home/x/.local/lib/python3.4/site-packages/tensorflow/python/training/saver.py\", line 1458, in import_m\neta_graph\n    return _import_meta_graph_def(read_meta_graph_file(meta_graph_or_file))\n  File \"/home/x/.local/lib/python3.4/site-packages/tensorflow/python/training/saver.py\", line 1369, in _import_\nmeta_graph_def\n    col_op = ops.get_default_graph().as_graph_element(value)\n  File \"/home/x/.local/lib/python3.4/site-packages/tensorflow/python/framework/ops.py\", line 2392, in as_graph_\nelement\n    return self._as_graph_element_locked(obj, allow_tensor, allow_operation)\n  File \"/home/x/.local/lib/python3.4/site-packages/tensorflow/python/framework/ops.py\", line 2452, in _as_graph\n_element_locked\n    \"graph.\" % repr(name))\nKeyError: \"The name 'logits' refers to an Operation not in the graph.\"\n```\n\nHowever, if I create _outputs_collections_ with the empty list, the code will\nwork. Also, the code will work if I don't specify the _outputs_collections_\nargument.\n"}