{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/610", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/610/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/610/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/610/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/610", "id": 123725643, "node_id": "MDU6SXNzdWUxMjM3MjU2NDM=", "number": 610, "title": "Issues with running transpose on GPU", "user": {"login": "alquraishi", "id": 5205204, "node_id": "MDQ6VXNlcjUyMDUyMDQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/5205204?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alquraishi", "html_url": "https://github.com/alquraishi", "followers_url": "https://api.github.com/users/alquraishi/followers", "following_url": "https://api.github.com/users/alquraishi/following{/other_user}", "gists_url": "https://api.github.com/users/alquraishi/gists{/gist_id}", "starred_url": "https://api.github.com/users/alquraishi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alquraishi/subscriptions", "organizations_url": "https://api.github.com/users/alquraishi/orgs", "repos_url": "https://api.github.com/users/alquraishi/repos", "events_url": "https://api.github.com/users/alquraishi/events{/privacy}", "received_events_url": "https://api.github.com/users/alquraishi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2015-12-23T21:34:09Z", "updated_at": "2017-06-16T16:27:28Z", "closed_at": "2017-06-16T16:27:28Z", "author_association": "NONE", "body_html": "<p>I\u2019m running into a couple of issues with <code>transpose</code> on GPUs. First, even the forward computation can\u2019t be registered on a GPU unless I explicitly set the <code>perm</code> option. For example this fails (I\u2019m setting <code>allow_soft_placement=False</code> in the session <code>Config</code>):</p>\n<pre><code>with tf.device('/gpu:0'):\n    a = tf.constant(npr.rand(5, 3).astype('float32'))\n    b = tf.transpose(a)\n</code></pre>\n<p>with the following error:</p>\n<pre><code>InvalidArgumentError: Cannot assign a device to node 'transpose/Reverse': Could not satisfy explicit device specification '/gpu:0'\n[[Node: transpose/Reverse = Reverse[T=DT_INT32, _device=\"/gpu:0\"](transpose/Range, transpose/Reverse/dims)]]\n</code></pre>\n<p>If however I set <code>perm=(1, 0)</code> in the <code>transpose</code> operation above, it works. But that\u2019s not the only problem, as the backward computation doesn\u2019t work either way. For example this fails:</p>\n<pre><code>with tf.device('/gpu:0'):\n    a = tf.Variable(tf.random_uniform([5, 3]))\n    b = tf.transpose(a, perm=(1, 0))\n    l = tf.reduce_sum(b)\n    o = tf.train.AdamOptimizer().minimize(l)\n    i = tf.initialize_all_variables()\n\nsess = tf.Session(config=tf.ConfigProto(allow_soft_placement=False))\nsess.run(i)\nsess.run(o)\n</code></pre>\n<p>with the following error:</p>\n<pre><code>InvalidArgumentError: Cannot assign a device to node 'gradients/transpose_grad/InvertPermutation': Could not satisfy explicit device specification '/gpu:0'\n[[Node: gradients/transpose_grad/InvertPermutation = InvertPermutation[_device=\"/gpu:0\"](transpose/perm)]]\n</code></pre>", "body_text": "I\u2019m running into a couple of issues with transpose on GPUs. First, even the forward computation can\u2019t be registered on a GPU unless I explicitly set the perm option. For example this fails (I\u2019m setting allow_soft_placement=False in the session Config):\nwith tf.device('/gpu:0'):\n    a = tf.constant(npr.rand(5, 3).astype('float32'))\n    b = tf.transpose(a)\n\nwith the following error:\nInvalidArgumentError: Cannot assign a device to node 'transpose/Reverse': Could not satisfy explicit device specification '/gpu:0'\n[[Node: transpose/Reverse = Reverse[T=DT_INT32, _device=\"/gpu:0\"](transpose/Range, transpose/Reverse/dims)]]\n\nIf however I set perm=(1, 0) in the transpose operation above, it works. But that\u2019s not the only problem, as the backward computation doesn\u2019t work either way. For example this fails:\nwith tf.device('/gpu:0'):\n    a = tf.Variable(tf.random_uniform([5, 3]))\n    b = tf.transpose(a, perm=(1, 0))\n    l = tf.reduce_sum(b)\n    o = tf.train.AdamOptimizer().minimize(l)\n    i = tf.initialize_all_variables()\n\nsess = tf.Session(config=tf.ConfigProto(allow_soft_placement=False))\nsess.run(i)\nsess.run(o)\n\nwith the following error:\nInvalidArgumentError: Cannot assign a device to node 'gradients/transpose_grad/InvertPermutation': Could not satisfy explicit device specification '/gpu:0'\n[[Node: gradients/transpose_grad/InvertPermutation = InvertPermutation[_device=\"/gpu:0\"](transpose/perm)]]", "body": "I\u2019m running into a couple of issues with `transpose` on GPUs. First, even the forward computation can\u2019t be registered on a GPU unless I explicitly set the `perm` option. For example this fails (I\u2019m setting `allow_soft_placement=False` in the session `Config`):\n\n```\nwith tf.device('/gpu:0'):\n    a = tf.constant(npr.rand(5, 3).astype('float32'))\n    b = tf.transpose(a)\n```\n\nwith the following error:\n\n```\nInvalidArgumentError: Cannot assign a device to node 'transpose/Reverse': Could not satisfy explicit device specification '/gpu:0'\n[[Node: transpose/Reverse = Reverse[T=DT_INT32, _device=\"/gpu:0\"](transpose/Range, transpose/Reverse/dims)]]\n```\n\nIf however I set `perm=(1, 0)` in the `transpose` operation above, it works. But that\u2019s not the only problem, as the backward computation doesn\u2019t work either way. For example this fails:\n\n```\nwith tf.device('/gpu:0'):\n    a = tf.Variable(tf.random_uniform([5, 3]))\n    b = tf.transpose(a, perm=(1, 0))\n    l = tf.reduce_sum(b)\n    o = tf.train.AdamOptimizer().minimize(l)\n    i = tf.initialize_all_variables()\n\nsess = tf.Session(config=tf.ConfigProto(allow_soft_placement=False))\nsess.run(i)\nsess.run(o)\n```\n\nwith the following error:\n\n```\nInvalidArgumentError: Cannot assign a device to node 'gradients/transpose_grad/InvertPermutation': Could not satisfy explicit device specification '/gpu:0'\n[[Node: gradients/transpose_grad/InvertPermutation = InvertPermutation[_device=\"/gpu:0\"](transpose/perm)]]\n```\n"}