{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/210326075", "pull_request_review_id": 146516889, "id": 210326075, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMDMyNjA3NQ==", "diff_hunk": "@@ -105,9 +105,9 @@ class EigenCudaStreamDevice : public ::Eigen::StreamInterface {\n         reinterpret_cast<unsigned int*>(scratch + Eigen::kCudaScratchSize);\n     stream_ = cuda_stream;\n     allocator_ = alloc;\n-    CudaGpuId cuda_gpu_id;\n-    TF_CHECK_OK(GpuIdManager::TfToCudaGpuId(tf_gpu_id, &cuda_gpu_id));\n-    device_prop_ = &Eigen::m_deviceProperties[cuda_gpu_id.value()];\n+    PlatformGpuId platform_gpu_id;", "path": "tensorflow/core/common_runtime/gpu/gpu_device.cc", "position": 7, "original_position": 7, "commit_id": "1b166c7e6f30bf7179f31764b3615e63025a7472", "original_commit_id": "172bd13219f7bfbbfd28a860a80004d045bdd6dd", "user": {"login": "whchung", "id": 1673574, "node_id": "MDQ6VXNlcjE2NzM1NzQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/1673574?v=4", "gravatar_id": "", "url": "https://api.github.com/users/whchung", "html_url": "https://github.com/whchung", "followers_url": "https://api.github.com/users/whchung/followers", "following_url": "https://api.github.com/users/whchung/following{/other_user}", "gists_url": "https://api.github.com/users/whchung/gists{/gist_id}", "starred_url": "https://api.github.com/users/whchung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/whchung/subscriptions", "organizations_url": "https://api.github.com/users/whchung/orgs", "repos_url": "https://api.github.com/users/whchung/repos", "events_url": "https://api.github.com/users/whchung/events{/privacy}", "received_events_url": "https://api.github.com/users/whchung/received_events", "type": "User", "site_admin": false}, "body": "ROCm uses `BaseGPUDevice`. Please refer to the working version for ROCm at:\r\nhttps://github.com/ROCmSoftwarePlatform/tensorflow-upstream/blob/develop-upstream/tensorflow/core/common_runtime/gpu/gpu_device.cc#L134\r\n\r\nWe are going to upstream this portion once #20277 lands.\r\n\r\nDue to the nature of how GPU common runtime uses `Eigen`, right now we have to use a compile-time flag `TENSORFLOW_USE_ROCM` to guard ROCm/HIP-specific logic, while leaving CUDA-specific logic be guarded by `GOOGLE_CUDA`. #20277 introduces `TENSORFLOW_USE_ROCM` macro to TensorFlow configure and build system.", "created_at": "2018-08-15T16:25:49Z", "updated_at": "2018-08-31T16:34:59Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/21000#discussion_r210326075", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/21000", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/210326075"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/21000#discussion_r210326075"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/21000"}}, "body_html": "<p>ROCm uses <code>BaseGPUDevice</code>. Please refer to the working version for ROCm at:<br>\n<a href=\"https://github.com/ROCmSoftwarePlatform/tensorflow-upstream/blob/develop-upstream/tensorflow/core/common_runtime/gpu/gpu_device.cc#L134\">https://github.com/ROCmSoftwarePlatform/tensorflow-upstream/blob/develop-upstream/tensorflow/core/common_runtime/gpu/gpu_device.cc#L134</a></p>\n<p>We are going to upstream this portion once <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"335455607\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/20277\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/20277/hovercard\" href=\"https://github.com/tensorflow/tensorflow/pull/20277\">#20277</a> lands.</p>\n<p>Due to the nature of how GPU common runtime uses <code>Eigen</code>, right now we have to use a compile-time flag <code>TENSORFLOW_USE_ROCM</code> to guard ROCm/HIP-specific logic, while leaving CUDA-specific logic be guarded by <code>GOOGLE_CUDA</code>. <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"335455607\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/20277\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/20277/hovercard\" href=\"https://github.com/tensorflow/tensorflow/pull/20277\">#20277</a> introduces <code>TENSORFLOW_USE_ROCM</code> macro to TensorFlow configure and build system.</p>", "body_text": "ROCm uses BaseGPUDevice. Please refer to the working version for ROCm at:\nhttps://github.com/ROCmSoftwarePlatform/tensorflow-upstream/blob/develop-upstream/tensorflow/core/common_runtime/gpu/gpu_device.cc#L134\nWe are going to upstream this portion once #20277 lands.\nDue to the nature of how GPU common runtime uses Eigen, right now we have to use a compile-time flag TENSORFLOW_USE_ROCM to guard ROCm/HIP-specific logic, while leaving CUDA-specific logic be guarded by GOOGLE_CUDA. #20277 introduces TENSORFLOW_USE_ROCM macro to TensorFlow configure and build system.", "in_reply_to_id": 210320456}