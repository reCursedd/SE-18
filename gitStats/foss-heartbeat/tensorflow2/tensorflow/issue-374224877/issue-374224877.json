{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23283", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23283/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23283/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23283/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23283", "id": 374224877, "node_id": "MDU6SXNzdWUzNzQyMjQ4Nzc=", "number": 23283, "title": "CollectiveAllReduceStrategy RecvBufResponse error in ResNet model", "user": {"login": "CheukNgai", "id": 14886554, "node_id": "MDQ6VXNlcjE0ODg2NTU0", "avatar_url": "https://avatars2.githubusercontent.com/u/14886554?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CheukNgai", "html_url": "https://github.com/CheukNgai", "followers_url": "https://api.github.com/users/CheukNgai/followers", "following_url": "https://api.github.com/users/CheukNgai/following{/other_user}", "gists_url": "https://api.github.com/users/CheukNgai/gists{/gist_id}", "starred_url": "https://api.github.com/users/CheukNgai/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CheukNgai/subscriptions", "organizations_url": "https://api.github.com/users/CheukNgai/orgs", "repos_url": "https://api.github.com/users/CheukNgai/repos", "events_url": "https://api.github.com/users/CheukNgai/events{/privacy}", "received_events_url": "https://api.github.com/users/CheukNgai/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 996845227, "node_id": "MDU6TGFiZWw5OTY4NDUyMjc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:dist-strat", "name": "comp:dist-strat", "color": "0052cc", "default": false}], "state": "open", "locked": false, "assignee": {"login": "yuefengz", "id": 1647833, "node_id": "MDQ6VXNlcjE2NDc4MzM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1647833?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuefengz", "html_url": "https://github.com/yuefengz", "followers_url": "https://api.github.com/users/yuefengz/followers", "following_url": "https://api.github.com/users/yuefengz/following{/other_user}", "gists_url": "https://api.github.com/users/yuefengz/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuefengz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuefengz/subscriptions", "organizations_url": "https://api.github.com/users/yuefengz/orgs", "repos_url": "https://api.github.com/users/yuefengz/repos", "events_url": "https://api.github.com/users/yuefengz/events{/privacy}", "received_events_url": "https://api.github.com/users/yuefengz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "yuefengz", "id": 1647833, "node_id": "MDQ6VXNlcjE2NDc4MzM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1647833?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuefengz", "html_url": "https://github.com/yuefengz", "followers_url": "https://api.github.com/users/yuefengz/followers", "following_url": "https://api.github.com/users/yuefengz/following{/other_user}", "gists_url": "https://api.github.com/users/yuefengz/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuefengz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuefengz/subscriptions", "organizations_url": "https://api.github.com/users/yuefengz/orgs", "repos_url": "https://api.github.com/users/yuefengz/repos", "events_url": "https://api.github.com/users/yuefengz/events{/privacy}", "received_events_url": "https://api.github.com/users/yuefengz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2018-10-26T04:44:42Z", "updated_at": "2018-11-15T19:00:12Z", "closed_at": null, "author_association": "NONE", "body_html": "<p><strong>System information</strong></p>\n<ul>\n<li>Have I written custom code (as opposed to using a stock example script provided in TensorFlow): custom code</li>\n<li>OS Platform and Distribution (e.g., Linux Ubuntu 16.04): macOS 10.13.6</li>\n<li>TensorFlow installed from (source or binary): binary(modify the code to fix the bug, pull request <a href=\"https://github.com/tensorflow/estimator/pull/3\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/estimator/pull/3/hovercard\">link</a> )</li>\n<li>TensorFlow version (use command below): 1.12.0-rc0</li>\n<li>Python version: 2.7.10</li>\n<li>Bazel version (if compiling from source): 0.16.1</li>\n<li>GCC/Compiler version (if compiling from source):  LLVM version 9.1.0(clang-902.0.39.2)</li>\n<li>CUDA/cuDNN version: no installed</li>\n<li>GPU model and memory: Intel Iris Plus Graphics</li>\n</ul>\n<p><strong>Describe the current behavior</strong><br>\nusing the collective_all_reduce_strategy to train cifar10_Resnet model will raise an error, but the ParameterServerStrategy won't.</p>\n<p><strong>Describe the expected behavior</strong><br>\nThis cifar10_ResNet has been updated to r1.11 and used tf.estimator.train_and_evaluate to train model, with the new feature of using distribute strategy.<br>\nIt was found that the ParameterServerStrategy ran normally, but the CollectiveAllReduceStrategy raised an error in RecvBufResponse.</p>\n<p><strong>Code to reproduce the issue</strong><br>\nSource code is attached.<br>\n<a href=\"https://github.com/tensorflow/tensorflow/files/2517601/cifar10_estimator.zip\">cifar10_estimator.zip</a></p>\n<p>To run the ParameterServerStrategy, type these two commands in different shells:</p>\n<pre><code>python PS_ps0.py --data-dir=./cifar-10-data --job-dir=./model_dir/ --num-gpus=0 --train-steps=1000\n</code></pre>\n<pre><code>python PS_worker0.py --data-dir=./cifar-10-data --job-dir=./model_dir/ --num-gpus=0 --train-steps=1000\n</code></pre>\n<p>To run the CollectiveAllReduceStrategy(just modify TF_CONFIG and strategy), type these two commands in different shells:</p>\n<pre><code>python Collective_worker0.py --data-dir=./cifar-10-data --job-dir=./model_dir/ --num-gpus=0 --train-steps=1000\n</code></pre>\n<pre><code>python Collective_worker1.py --data-dir=./cifar-10-data --job-dir=./model_dir/ --num-gpus=0 --train-steps=1000\n</code></pre>\n<p><strong>Other info / logs</strong></p>\n<p>Error message:RecvBufResponse returned 128 bytes where to_tensor expected 64<br>\n[[node resnet/BatchNorm/beta/Momentum/Initializer/CollectiveBcastRecv (defined at /Library/Python/2.7/site-packages/tensorflow/contrib/distribute/python/collective_all_reduce_strategy.py:186) ]]</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): custom code\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): macOS 10.13.6\nTensorFlow installed from (source or binary): binary(modify the code to fix the bug, pull request link )\nTensorFlow version (use command below): 1.12.0-rc0\nPython version: 2.7.10\nBazel version (if compiling from source): 0.16.1\nGCC/Compiler version (if compiling from source):  LLVM version 9.1.0(clang-902.0.39.2)\nCUDA/cuDNN version: no installed\nGPU model and memory: Intel Iris Plus Graphics\n\nDescribe the current behavior\nusing the collective_all_reduce_strategy to train cifar10_Resnet model will raise an error, but the ParameterServerStrategy won't.\nDescribe the expected behavior\nThis cifar10_ResNet has been updated to r1.11 and used tf.estimator.train_and_evaluate to train model, with the new feature of using distribute strategy.\nIt was found that the ParameterServerStrategy ran normally, but the CollectiveAllReduceStrategy raised an error in RecvBufResponse.\nCode to reproduce the issue\nSource code is attached.\ncifar10_estimator.zip\nTo run the ParameterServerStrategy, type these two commands in different shells:\npython PS_ps0.py --data-dir=./cifar-10-data --job-dir=./model_dir/ --num-gpus=0 --train-steps=1000\n\npython PS_worker0.py --data-dir=./cifar-10-data --job-dir=./model_dir/ --num-gpus=0 --train-steps=1000\n\nTo run the CollectiveAllReduceStrategy(just modify TF_CONFIG and strategy), type these two commands in different shells:\npython Collective_worker0.py --data-dir=./cifar-10-data --job-dir=./model_dir/ --num-gpus=0 --train-steps=1000\n\npython Collective_worker1.py --data-dir=./cifar-10-data --job-dir=./model_dir/ --num-gpus=0 --train-steps=1000\n\nOther info / logs\nError message:RecvBufResponse returned 128 bytes where to_tensor expected 64\n[[node resnet/BatchNorm/beta/Momentum/Initializer/CollectiveBcastRecv (defined at /Library/Python/2.7/site-packages/tensorflow/contrib/distribute/python/collective_all_reduce_strategy.py:186) ]]", "body": "**System information**\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow): custom code\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 16.04): macOS 10.13.6\r\n- TensorFlow installed from (source or binary): binary(modify the code to fix the bug, pull request [link](https://github.com/tensorflow/estimator/pull/3) )\r\n- TensorFlow version (use command below): 1.12.0-rc0\r\n- Python version: 2.7.10\r\n- Bazel version (if compiling from source): 0.16.1\r\n- GCC/Compiler version (if compiling from source):  LLVM version 9.1.0(clang-902.0.39.2)\r\n- CUDA/cuDNN version: no installed\r\n- GPU model and memory: Intel Iris Plus Graphics\r\n\r\n**Describe the current behavior**\r\nusing the collective_all_reduce_strategy to train cifar10_Resnet model will raise an error, but the ParameterServerStrategy won't.\r\n\r\n**Describe the expected behavior**\r\nThis cifar10_ResNet has been updated to r1.11 and used tf.estimator.train_and_evaluate to train model, with the new feature of using distribute strategy.\r\nIt was found that the ParameterServerStrategy ran normally, but the CollectiveAllReduceStrategy raised an error in RecvBufResponse.\r\n\r\n**Code to reproduce the issue**\r\nSource code is attached.\r\n[cifar10_estimator.zip](https://github.com/tensorflow/tensorflow/files/2517601/cifar10_estimator.zip)\r\n\r\nTo run the ParameterServerStrategy, type these two commands in different shells:\r\n\r\n```\r\npython PS_ps0.py --data-dir=./cifar-10-data --job-dir=./model_dir/ --num-gpus=0 --train-steps=1000\r\n```\r\n\r\n```\r\npython PS_worker0.py --data-dir=./cifar-10-data --job-dir=./model_dir/ --num-gpus=0 --train-steps=1000\r\n```\r\n\r\nTo run the CollectiveAllReduceStrategy(just modify TF_CONFIG and strategy), type these two commands in different shells:\r\n\r\n```\r\npython Collective_worker0.py --data-dir=./cifar-10-data --job-dir=./model_dir/ --num-gpus=0 --train-steps=1000\r\n```\r\n\r\n```\r\npython Collective_worker1.py --data-dir=./cifar-10-data --job-dir=./model_dir/ --num-gpus=0 --train-steps=1000\r\n```\r\n\r\n**Other info / logs**\r\n\r\nError message:RecvBufResponse returned 128 bytes where to_tensor expected 64\r\n[[node resnet/BatchNorm/beta/Momentum/Initializer/CollectiveBcastRecv (defined at /Library/Python/2.7/site-packages/tensorflow/contrib/distribute/python/collective_all_reduce_strategy.py:186) ]]\r\n\r\n"}