{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/121865591", "pull_request_review_id": 43927080, "id": 121865591, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTg2NTU5MQ==", "diff_hunk": "@@ -264,142 +296,155 @@ def _tfIFFTForRank(self, rank):\n       raise ValueError(\"invalid rank\")\n \n   def testEmpty(self):\n-    for rank in VALID_FFT_RANKS:\n-      for dims in xrange(rank, rank + 3):\n-        x = np.zeros((0,) * dims).astype(np.float32)\n-        self.assertEqual(x.shape, self._tfFFT(x, rank).shape)\n-        x = np.zeros((0,) * dims).astype(np.complex64)\n-        self.assertEqual(x.shape, self._tfIFFT(x, rank).shape)\n+    with self._fft_kernel_label_map():\n+      for rank in VALID_FFT_RANKS:\n+        for dims in xrange(rank, rank + 3):\n+          x = np.zeros((0,) * dims).astype(np.float32)\n+          self.assertEqual(x.shape, self._tfFFT(x, rank).shape)\n+          x = np.zeros((0,) * dims).astype(np.complex64)\n+          self.assertEqual(x.shape, self._tfIFFT(x, rank).shape)\n \n   def testBasic(self):\n-    for rank in VALID_FFT_RANKS:\n-      for dims in xrange(rank, rank + 3):\n-        for size in (5, 6):\n-          inner_dim = size // 2 + 1\n-          r2c = np.mod(np.arange(np.power(size, dims)), 10).reshape(\n-              (size,) * dims)\n-          self._CompareForward(r2c.astype(np.float32), rank, (size,) * rank)\n-          c2r = np.mod(np.arange(np.power(size, dims - 1) * inner_dim),\n-                       10).reshape((size,) * (dims - 1) + (inner_dim,))\n-          self._CompareBackward(c2r.astype(np.complex64), rank, (size,) * rank)\n+    with self._fft_kernel_label_map():\n+      for rank in VALID_FFT_RANKS:\n+        for dims in xrange(rank, rank + 3):\n+          for size in (5, 6):\n+            inner_dim = size // 2 + 1\n+            r2c = np.mod(np.arange(np.power(size, dims)), 10).reshape(\n+                (size,) * dims)\n+            self._CompareForward(r2c.astype(np.float32), rank, (size,) * rank)\n+            c2r = np.mod(np.arange(np.power(size, dims - 1) * inner_dim),\n+                         10).reshape((size,) * (dims - 1) + (inner_dim,))\n+            self._CompareBackward(\n+                c2r.astype(np.complex64), rank, (size,) * rank)\n \n   def testBasicPlaceholder(self):\n-    for rank in VALID_FFT_RANKS:\n-      for dims in xrange(rank, rank + 3):\n-        for size in (5, 6):\n-          inner_dim = size // 2 + 1\n-          r2c = np.mod(np.arange(np.power(size, dims)), 10).reshape(\n-              (size,) * dims)\n-          self._CompareForward(r2c.astype(np.float32), rank, (size,) * rank,\n-                               use_placeholder=True)\n-          c2r = np.mod(np.arange(np.power(size, dims - 1) * inner_dim),\n-                       10).reshape((size,) * (dims - 1) + (inner_dim,))\n-          self._CompareBackward(c2r.astype(np.complex64), rank, (size,) * rank,\n-                                use_placeholder=True)\n-\n-  def testFftLength(self):\n-    if test.is_gpu_available(cuda_only=True):\n+    with self._fft_kernel_label_map():\n       for rank in VALID_FFT_RANKS:\n         for dims in xrange(rank, rank + 3):\n           for size in (5, 6):\n             inner_dim = size // 2 + 1\n             r2c = np.mod(np.arange(np.power(size, dims)), 10).reshape(\n                 (size,) * dims)\n+            self._CompareForward(\n+                r2c.astype(np.float32),\n+                rank, (size,) * rank,\n+                use_placeholder=True)\n             c2r = np.mod(np.arange(np.power(size, dims - 1) * inner_dim),\n                          10).reshape((size,) * (dims - 1) + (inner_dim,))\n+            self._CompareBackward(\n+                c2r.astype(np.complex64),\n+                rank, (size,) * rank,\n+                use_placeholder=True)\n \n-            # Test truncation (FFT size < dimensions).\n-            fft_length = (size - 2,) * rank\n-            self._CompareForward(r2c.astype(np.float32), rank, fft_length)\n-            self._CompareBackward(c2r.astype(np.complex64), rank, fft_length)\n-\n-            # Confirm it works with unknown shapes as well.\n-            self._CompareForward(r2c.astype(np.float32), rank, fft_length,\n-                                 use_placeholder=True)\n-            self._CompareBackward(c2r.astype(np.complex64), rank, fft_length,\n-                                  use_placeholder=True)\n-\n-            # Test padding (FFT size > dimensions).\n-            fft_length = (size + 2,) * rank\n-            self._CompareForward(r2c.astype(np.float32), rank, fft_length)\n-            self._CompareBackward(c2r.astype(np.complex64), rank, fft_length)\n-\n-            # Confirm it works with unknown shapes as well.\n-            self._CompareForward(r2c.astype(np.float32), rank, fft_length,\n-                                 use_placeholder=True)\n-            self._CompareBackward(c2r.astype(np.complex64), rank, fft_length,\n-                                  use_placeholder=True)\n+  def testFftLength(self):\n+    if test.is_gpu_available(cuda_only=True):", "path": "tensorflow/python/kernel_tests/fft_ops_test.py", "position": 315, "original_position": 315, "commit_id": "3af9224979917aa47e878f94306f62f4125b7fab", "original_commit_id": "3af9224979917aa47e878f94306f62f4125b7fab", "user": {"login": "martinwicke", "id": 577277, "node_id": "MDQ6VXNlcjU3NzI3Nw==", "avatar_url": "https://avatars2.githubusercontent.com/u/577277?v=4", "gravatar_id": "", "url": "https://api.github.com/users/martinwicke", "html_url": "https://github.com/martinwicke", "followers_url": "https://api.github.com/users/martinwicke/followers", "following_url": "https://api.github.com/users/martinwicke/following{/other_user}", "gists_url": "https://api.github.com/users/martinwicke/gists{/gist_id}", "starred_url": "https://api.github.com/users/martinwicke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/martinwicke/subscriptions", "organizations_url": "https://api.github.com/users/martinwicke/orgs", "repos_url": "https://api.github.com/users/martinwicke/repos", "events_url": "https://api.github.com/users/martinwicke/events{/privacy}", "received_events_url": "https://api.github.com/users/martinwicke/received_events", "type": "User", "site_admin": false}, "body": "You are saying this line should be removed?", "created_at": "2017-06-14T06:43:19Z", "updated_at": "2017-06-14T06:43:19Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/10667#discussion_r121865591", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/10667", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/121865591"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/10667#discussion_r121865591"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/10667"}}, "body_html": "<p>You are saying this line should be removed?</p>", "body_text": "You are saying this line should be removed?", "in_reply_to_id": 121823961}