{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/303818748", "html_url": "https://github.com/tensorflow/tensorflow/issues/7407#issuecomment-303818748", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7407", "id": 303818748, "node_id": "MDEyOklzc3VlQ29tbWVudDMwMzgxODc0OA==", "user": {"login": "sunsided", "id": 495335, "node_id": "MDQ6VXNlcjQ5NTMzNQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/495335?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sunsided", "html_url": "https://github.com/sunsided", "followers_url": "https://api.github.com/users/sunsided/followers", "following_url": "https://api.github.com/users/sunsided/following{/other_user}", "gists_url": "https://api.github.com/users/sunsided/gists{/gist_id}", "starred_url": "https://api.github.com/users/sunsided/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sunsided/subscriptions", "organizations_url": "https://api.github.com/users/sunsided/orgs", "repos_url": "https://api.github.com/users/sunsided/repos", "events_url": "https://api.github.com/users/sunsided/events{/privacy}", "received_events_url": "https://api.github.com/users/sunsided/received_events", "type": "User", "site_admin": false}, "created_at": "2017-05-24T18:55:56Z", "updated_at": "2017-05-24T19:19:51Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=4431772\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/pkubik\">@pkubik</a> Just tried on Linux (built from <code>r1.1</code> branch) and have the same problem with \"contrib\"  <code>Estimator</code> and the <code>tf.estimator.Estimator</code>. Looking at the code of the latter, there also seems to be no <code>try</code> at all ... am I missing something obvious?</p>\n<pre><code>2017-05-24 20:52:38.532029: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n2017-05-24 20:52:38.532066: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n2017-05-24 20:52:38.532262: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n2017-05-24 20:52:38.694023: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n2017-05-24 20:52:38.694249: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n2017-05-24 20:52:38.695189: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n2017-05-24 20:52:38.695218: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n2017-05-24 20:52:38.695568: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n2017-05-24 20:52:38.695924: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\nTraceback (most recent call last):\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1039, in _do_call\n    return fn(*args)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1021, in _run_fn\n    status, run_metadata)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/contextlib.py\", line 89, in __exit__\n    next(self.gen)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/errors_impl.py\", line 466, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors_impl.OutOfRangeError: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/evaluation.py\", line 182, in _evaluate_once\n    session.run(eval_ops, feed_dict)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 484, in run\n    run_metadata=run_metadata)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 820, in run\n    run_metadata=run_metadata)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 776, in run\n    return self._sess.run(*args, **kwargs)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 930, in run\n    run_metadata=run_metadata)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 776, in run\n    return self._sess.run(*args, **kwargs)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 778, in run\n    run_metadata_ptr)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 982, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1032, in _do_run\n    target_list, options, run_metadata)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1052, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.OutOfRangeError: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n\nCaused by op 'shuffle_batch', defined at:\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/pydevd.py\", line 1585, in &lt;module&gt;\n    globals = debugger.run(setup['file'], None, None, is_module)\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/pydevd.py\", line 1015, in run\n    pydev_imports.execfile(file, globals, locals)  # execute the script\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/_pydev_imps/_pydev_execfile.py\", line 18, in execfile\n    exec(compile(contents+\"\\n\", file, 'exec'), glob, loc)\n  File \"/home/mmayer/dev/foobar.py\", line 206, in &lt;module&gt;\n    main()\n  File \"/home/mmayer/dev/foobar.py\", line 40, in main\n    run_training(nn, args, model_params)\n  File \"/home/mmayer/dev/foobar.py\", line 58, in run_training\n    ev = run_evaluation(nn, args, model_params, best_f=None, use_best_checkpoint=True)\n  File \"/home/mmayer/dev/foobar.py\", line 82, in run_evaluation\n    ev = nn.evaluate(input_fn=lambda: input_fn(args.eval_dir, params=model_params, epochs=1), steps=None)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 268, in evaluate\n    name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 604, in _evaluate_model\n    features, labels = input_fn()\n  File \"/home/mmayer/dev/foobar.py\", line 82, in &lt;lambda&gt;\n    ev = nn.evaluate(input_fn=lambda: input_fn(args.eval_dir, params=model_params, epochs=1), steps=None)\n  File \"/home/mmayer/dev/input_pipeline/input_fn.py\", line 31, in input_fn\n    allow_smaller_final_batch=True)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/input.py\", line 1214, in shuffle_batch\n    name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/input.py\", line 782, in _shuffle_batch\n    dequeued = queue.dequeue_up_to(batch_size, name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/ops/data_flow_ops.py\", line 499, in dequeue_up_to\n    self._queue_ref, n=n, component_types=self._dtypes, name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 1420, in _queue_dequeue_up_to_v2\n    timeout_ms=timeout_ms, name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 768, in apply_op\n    op_def=op_def)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 2336, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1228, in __init__\n    self._traceback = _extract_stack()\n\nOutOfRangeError (see above for traceback): RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1039, in _do_call\n    return fn(*args)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1021, in _run_fn\n    status, run_metadata)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/contextlib.py\", line 89, in __exit__\n    next(self.gen)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/errors_impl.py\", line 466, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors_impl.OutOfRangeError: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/pydevd.py\", line 1585, in &lt;module&gt;\n    globals = debugger.run(setup['file'], None, None, is_module)\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/pydevd.py\", line 1015, in run\n    pydev_imports.execfile(file, globals, locals)  # execute the script\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/_pydev_imps/_pydev_execfile.py\", line 18, in execfile\n    exec(compile(contents+\"\\n\", file, 'exec'), glob, loc)\n  File \"/home/mmayer/dev/foobar.py\", line 206, in &lt;module&gt;\n    main()\n  File \"/home/mmayer/dev/foobar.py\", line 40, in main\n    run_training(nn, args, model_params)\n  File \"/home/mmayer/dev/foobar.py\", line 58, in run_training\n    ev = run_evaluation(nn, args, model_params, best_f=None, use_best_checkpoint=True)\n  File \"/home/mmayer/dev/foobar.py\", line 82, in run_evaluation\n    ev = nn.evaluate(input_fn=lambda: input_fn(args.eval_dir, params=model_params, epochs=1), steps=None)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 268, in evaluate\n    name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 632, in _evaluate_model\n    config=config_pb2.ConfigProto(allow_soft_placement=True))\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/evaluation.py\", line 182, in _evaluate_once\n    session.run(eval_ops, feed_dict)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 500, in __exit__\n    self._close_internal(exception_type)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 532, in _close_internal\n    h.end(self._coordinated_creator.tf_sess)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/basic_session_run_hooks.py\", line 663, in end\n    feed_dict=self._final_ops_feed_dict)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 778, in run\n    run_metadata_ptr)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 982, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1032, in _do_run\n    target_list, options, run_metadata)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1052, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.OutOfRangeError: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n\nCaused by op 'shuffle_batch', defined at:\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/pydevd.py\", line 1585, in &lt;module&gt;\n    globals = debugger.run(setup['file'], None, None, is_module)\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/pydevd.py\", line 1015, in run\n    pydev_imports.execfile(file, globals, locals)  # execute the script\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/_pydev_imps/_pydev_execfile.py\", line 18, in execfile\n    exec(compile(contents+\"\\n\", file, 'exec'), glob, loc)\n  File \"/home/mmayer/dev/foobar.py\", line 206, in &lt;module&gt;\n    main()\n  File \"/home/mmayer/dev/foobar.py\", line 40, in main\n    run_training(nn, args, model_params)\n  File \"/home/mmayer/dev/foobar.py\", line 58, in run_training\n    ev = run_evaluation(nn, args, model_params, best_f=None, use_best_checkpoint=True)\n  File \"/home/mmayer/dev/foobar.py\", line 82, in run_evaluation\n    ev = nn.evaluate(input_fn=lambda: input_fn(args.eval_dir, params=model_params, epochs=1), steps=None)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 268, in evaluate\n    name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 604, in _evaluate_model\n    features, labels = input_fn()\n  File \"/home/mmayer/dev/foobar.py\", line 82, in &lt;lambda&gt;\n    ev = nn.evaluate(input_fn=lambda: input_fn(args.eval_dir, params=model_params, epochs=1), steps=None)\n  File \"/home/mmayer/dev/input_pipeline/input_fn.py\", line 31, in input_fn\n    allow_smaller_final_batch=True)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/input.py\", line 1214, in shuffle_batch\n    name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/input.py\", line 782, in _shuffle_batch\n    dequeued = queue.dequeue_up_to(batch_size, name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/ops/data_flow_ops.py\", line 499, in dequeue_up_to\n    self._queue_ref, n=n, component_types=self._dtypes, name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 1420, in _queue_dequeue_up_to_v2\n    timeout_ms=timeout_ms, name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 768, in apply_op\n    op_def=op_def)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 2336, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1228, in __init__\n    self._traceback = _extract_stack()\n\nOutOfRangeError (see above for traceback): RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n</code></pre>\n<p>The line in question in my code is a</p>\n<div class=\"highlight highlight-source-python\"><pre>image_batch <span class=\"pl-k\">=</span> tf.train.shuffle_batch([file_names, image_bytes],\n                                                 <span class=\"pl-v\">batch_size</span><span class=\"pl-k\">=</span>params[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>batch_size<span class=\"pl-pds\">'</span></span>],\n                                                 <span class=\"pl-v\">capacity</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">1000</span>, <span class=\"pl-v\">min_after_dequeue</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">100</span>,\n                                                 <span class=\"pl-v\">num_threads</span><span class=\"pl-k\">=</span>params[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>input_threads<span class=\"pl-pds\">'</span></span>],\n                                                 <span class=\"pl-v\">enqueue_many</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>,\n                                                 <span class=\"pl-v\">allow_smaller_final_batch</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>)</pre></div>", "body_text": "@pkubik Just tried on Linux (built from r1.1 branch) and have the same problem with \"contrib\"  Estimator and the tf.estimator.Estimator. Looking at the code of the latter, there also seems to be no try at all ... am I missing something obvious?\n2017-05-24 20:52:38.532029: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n2017-05-24 20:52:38.532066: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n2017-05-24 20:52:38.532262: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n2017-05-24 20:52:38.694023: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n2017-05-24 20:52:38.694249: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n2017-05-24 20:52:38.695189: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n2017-05-24 20:52:38.695218: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n2017-05-24 20:52:38.695568: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n2017-05-24 20:52:38.695924: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\nTraceback (most recent call last):\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1039, in _do_call\n    return fn(*args)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1021, in _run_fn\n    status, run_metadata)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/contextlib.py\", line 89, in __exit__\n    next(self.gen)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/errors_impl.py\", line 466, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors_impl.OutOfRangeError: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/evaluation.py\", line 182, in _evaluate_once\n    session.run(eval_ops, feed_dict)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 484, in run\n    run_metadata=run_metadata)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 820, in run\n    run_metadata=run_metadata)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 776, in run\n    return self._sess.run(*args, **kwargs)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 930, in run\n    run_metadata=run_metadata)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 776, in run\n    return self._sess.run(*args, **kwargs)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 778, in run\n    run_metadata_ptr)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 982, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1032, in _do_run\n    target_list, options, run_metadata)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1052, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.OutOfRangeError: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n\nCaused by op 'shuffle_batch', defined at:\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/pydevd.py\", line 1585, in <module>\n    globals = debugger.run(setup['file'], None, None, is_module)\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/pydevd.py\", line 1015, in run\n    pydev_imports.execfile(file, globals, locals)  # execute the script\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/_pydev_imps/_pydev_execfile.py\", line 18, in execfile\n    exec(compile(contents+\"\\n\", file, 'exec'), glob, loc)\n  File \"/home/mmayer/dev/foobar.py\", line 206, in <module>\n    main()\n  File \"/home/mmayer/dev/foobar.py\", line 40, in main\n    run_training(nn, args, model_params)\n  File \"/home/mmayer/dev/foobar.py\", line 58, in run_training\n    ev = run_evaluation(nn, args, model_params, best_f=None, use_best_checkpoint=True)\n  File \"/home/mmayer/dev/foobar.py\", line 82, in run_evaluation\n    ev = nn.evaluate(input_fn=lambda: input_fn(args.eval_dir, params=model_params, epochs=1), steps=None)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 268, in evaluate\n    name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 604, in _evaluate_model\n    features, labels = input_fn()\n  File \"/home/mmayer/dev/foobar.py\", line 82, in <lambda>\n    ev = nn.evaluate(input_fn=lambda: input_fn(args.eval_dir, params=model_params, epochs=1), steps=None)\n  File \"/home/mmayer/dev/input_pipeline/input_fn.py\", line 31, in input_fn\n    allow_smaller_final_batch=True)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/input.py\", line 1214, in shuffle_batch\n    name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/input.py\", line 782, in _shuffle_batch\n    dequeued = queue.dequeue_up_to(batch_size, name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/ops/data_flow_ops.py\", line 499, in dequeue_up_to\n    self._queue_ref, n=n, component_types=self._dtypes, name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 1420, in _queue_dequeue_up_to_v2\n    timeout_ms=timeout_ms, name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 768, in apply_op\n    op_def=op_def)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 2336, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1228, in __init__\n    self._traceback = _extract_stack()\n\nOutOfRangeError (see above for traceback): RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1039, in _do_call\n    return fn(*args)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1021, in _run_fn\n    status, run_metadata)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/contextlib.py\", line 89, in __exit__\n    next(self.gen)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/errors_impl.py\", line 466, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors_impl.OutOfRangeError: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/pydevd.py\", line 1585, in <module>\n    globals = debugger.run(setup['file'], None, None, is_module)\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/pydevd.py\", line 1015, in run\n    pydev_imports.execfile(file, globals, locals)  # execute the script\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/_pydev_imps/_pydev_execfile.py\", line 18, in execfile\n    exec(compile(contents+\"\\n\", file, 'exec'), glob, loc)\n  File \"/home/mmayer/dev/foobar.py\", line 206, in <module>\n    main()\n  File \"/home/mmayer/dev/foobar.py\", line 40, in main\n    run_training(nn, args, model_params)\n  File \"/home/mmayer/dev/foobar.py\", line 58, in run_training\n    ev = run_evaluation(nn, args, model_params, best_f=None, use_best_checkpoint=True)\n  File \"/home/mmayer/dev/foobar.py\", line 82, in run_evaluation\n    ev = nn.evaluate(input_fn=lambda: input_fn(args.eval_dir, params=model_params, epochs=1), steps=None)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 268, in evaluate\n    name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 632, in _evaluate_model\n    config=config_pb2.ConfigProto(allow_soft_placement=True))\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/evaluation.py\", line 182, in _evaluate_once\n    session.run(eval_ops, feed_dict)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 500, in __exit__\n    self._close_internal(exception_type)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 532, in _close_internal\n    h.end(self._coordinated_creator.tf_sess)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/basic_session_run_hooks.py\", line 663, in end\n    feed_dict=self._final_ops_feed_dict)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 778, in run\n    run_metadata_ptr)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 982, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1032, in _do_run\n    target_list, options, run_metadata)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1052, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.OutOfRangeError: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n\nCaused by op 'shuffle_batch', defined at:\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/pydevd.py\", line 1585, in <module>\n    globals = debugger.run(setup['file'], None, None, is_module)\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/pydevd.py\", line 1015, in run\n    pydev_imports.execfile(file, globals, locals)  # execute the script\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/_pydev_imps/_pydev_execfile.py\", line 18, in execfile\n    exec(compile(contents+\"\\n\", file, 'exec'), glob, loc)\n  File \"/home/mmayer/dev/foobar.py\", line 206, in <module>\n    main()\n  File \"/home/mmayer/dev/foobar.py\", line 40, in main\n    run_training(nn, args, model_params)\n  File \"/home/mmayer/dev/foobar.py\", line 58, in run_training\n    ev = run_evaluation(nn, args, model_params, best_f=None, use_best_checkpoint=True)\n  File \"/home/mmayer/dev/foobar.py\", line 82, in run_evaluation\n    ev = nn.evaluate(input_fn=lambda: input_fn(args.eval_dir, params=model_params, epochs=1), steps=None)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 268, in evaluate\n    name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 604, in _evaluate_model\n    features, labels = input_fn()\n  File \"/home/mmayer/dev/foobar.py\", line 82, in <lambda>\n    ev = nn.evaluate(input_fn=lambda: input_fn(args.eval_dir, params=model_params, epochs=1), steps=None)\n  File \"/home/mmayer/dev/input_pipeline/input_fn.py\", line 31, in input_fn\n    allow_smaller_final_batch=True)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/input.py\", line 1214, in shuffle_batch\n    name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/input.py\", line 782, in _shuffle_batch\n    dequeued = queue.dequeue_up_to(batch_size, name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/ops/data_flow_ops.py\", line 499, in dequeue_up_to\n    self._queue_ref, n=n, component_types=self._dtypes, name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 1420, in _queue_dequeue_up_to_v2\n    timeout_ms=timeout_ms, name=name)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 768, in apply_op\n    op_def=op_def)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 2336, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1228, in __init__\n    self._traceback = _extract_stack()\n\nOutOfRangeError (see above for traceback): RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\n\nThe line in question in my code is a\nimage_batch = tf.train.shuffle_batch([file_names, image_bytes],\n                                                 batch_size=params['batch_size'],\n                                                 capacity=1000, min_after_dequeue=100,\n                                                 num_threads=params['input_threads'],\n                                                 enqueue_many=True,\n                                                 allow_smaller_final_batch=True)", "body": "@pkubik Just tried on Linux (built from `r1.1` branch) and have the same problem with \"contrib\"  `Estimator` and the `tf.estimator.Estimator`. Looking at the code of the latter, there also seems to be no `try` at all ... am I missing something obvious?\r\n\r\n```\r\n2017-05-24 20:52:38.532029: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\r\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\r\n2017-05-24 20:52:38.532066: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\r\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\r\n2017-05-24 20:52:38.532262: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\r\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\r\n2017-05-24 20:52:38.694023: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\r\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\r\n2017-05-24 20:52:38.694249: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\r\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\r\n2017-05-24 20:52:38.695189: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\r\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\r\n2017-05-24 20:52:38.695218: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\r\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\r\n2017-05-24 20:52:38.695568: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\r\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\r\n2017-05-24 20:52:38.695924: W tensorflow/core/framework/op_kernel.cc:1152] Out of range: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\r\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\r\nTraceback (most recent call last):\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1039, in _do_call\r\n    return fn(*args)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1021, in _run_fn\r\n    status, run_metadata)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/contextlib.py\", line 89, in __exit__\r\n    next(self.gen)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/errors_impl.py\", line 466, in raise_exception_on_not_ok_status\r\n    pywrap_tensorflow.TF_GetCode(status))\r\ntensorflow.python.framework.errors_impl.OutOfRangeError: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\r\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/evaluation.py\", line 182, in _evaluate_once\r\n    session.run(eval_ops, feed_dict)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 484, in run\r\n    run_metadata=run_metadata)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 820, in run\r\n    run_metadata=run_metadata)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 776, in run\r\n    return self._sess.run(*args, **kwargs)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 930, in run\r\n    run_metadata=run_metadata)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 776, in run\r\n    return self._sess.run(*args, **kwargs)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 778, in run\r\n    run_metadata_ptr)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 982, in _run\r\n    feed_dict_string, options, run_metadata)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1032, in _do_run\r\n    target_list, options, run_metadata)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1052, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.OutOfRangeError: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\r\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\r\n\r\nCaused by op 'shuffle_batch', defined at:\r\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/pydevd.py\", line 1585, in <module>\r\n    globals = debugger.run(setup['file'], None, None, is_module)\r\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/pydevd.py\", line 1015, in run\r\n    pydev_imports.execfile(file, globals, locals)  # execute the script\r\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/_pydev_imps/_pydev_execfile.py\", line 18, in execfile\r\n    exec(compile(contents+\"\\n\", file, 'exec'), glob, loc)\r\n  File \"/home/mmayer/dev/foobar.py\", line 206, in <module>\r\n    main()\r\n  File \"/home/mmayer/dev/foobar.py\", line 40, in main\r\n    run_training(nn, args, model_params)\r\n  File \"/home/mmayer/dev/foobar.py\", line 58, in run_training\r\n    ev = run_evaluation(nn, args, model_params, best_f=None, use_best_checkpoint=True)\r\n  File \"/home/mmayer/dev/foobar.py\", line 82, in run_evaluation\r\n    ev = nn.evaluate(input_fn=lambda: input_fn(args.eval_dir, params=model_params, epochs=1), steps=None)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 268, in evaluate\r\n    name=name)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 604, in _evaluate_model\r\n    features, labels = input_fn()\r\n  File \"/home/mmayer/dev/foobar.py\", line 82, in <lambda>\r\n    ev = nn.evaluate(input_fn=lambda: input_fn(args.eval_dir, params=model_params, epochs=1), steps=None)\r\n  File \"/home/mmayer/dev/input_pipeline/input_fn.py\", line 31, in input_fn\r\n    allow_smaller_final_batch=True)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/input.py\", line 1214, in shuffle_batch\r\n    name=name)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/input.py\", line 782, in _shuffle_batch\r\n    dequeued = queue.dequeue_up_to(batch_size, name=name)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/ops/data_flow_ops.py\", line 499, in dequeue_up_to\r\n    self._queue_ref, n=n, component_types=self._dtypes, name=name)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 1420, in _queue_dequeue_up_to_v2\r\n    timeout_ms=timeout_ms, name=name)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 768, in apply_op\r\n    op_def=op_def)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 2336, in create_op\r\n    original_op=self._default_original_op, op_def=op_def)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1228, in __init__\r\n    self._traceback = _extract_stack()\r\n\r\nOutOfRangeError (see above for traceback): RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\r\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\r\n\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1039, in _do_call\r\n    return fn(*args)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1021, in _run_fn\r\n    status, run_metadata)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/contextlib.py\", line 89, in __exit__\r\n    next(self.gen)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/errors_impl.py\", line 466, in raise_exception_on_not_ok_status\r\n    pywrap_tensorflow.TF_GetCode(status))\r\ntensorflow.python.framework.errors_impl.OutOfRangeError: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\r\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/pydevd.py\", line 1585, in <module>\r\n    globals = debugger.run(setup['file'], None, None, is_module)\r\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/pydevd.py\", line 1015, in run\r\n    pydev_imports.execfile(file, globals, locals)  # execute the script\r\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/_pydev_imps/_pydev_execfile.py\", line 18, in execfile\r\n    exec(compile(contents+\"\\n\", file, 'exec'), glob, loc)\r\n  File \"/home/mmayer/dev/foobar.py\", line 206, in <module>\r\n    main()\r\n  File \"/home/mmayer/dev/foobar.py\", line 40, in main\r\n    run_training(nn, args, model_params)\r\n  File \"/home/mmayer/dev/foobar.py\", line 58, in run_training\r\n    ev = run_evaluation(nn, args, model_params, best_f=None, use_best_checkpoint=True)\r\n  File \"/home/mmayer/dev/foobar.py\", line 82, in run_evaluation\r\n    ev = nn.evaluate(input_fn=lambda: input_fn(args.eval_dir, params=model_params, epochs=1), steps=None)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 268, in evaluate\r\n    name=name)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 632, in _evaluate_model\r\n    config=config_pb2.ConfigProto(allow_soft_placement=True))\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/evaluation.py\", line 182, in _evaluate_once\r\n    session.run(eval_ops, feed_dict)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 500, in __exit__\r\n    self._close_internal(exception_type)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py\", line 532, in _close_internal\r\n    h.end(self._coordinated_creator.tf_sess)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/basic_session_run_hooks.py\", line 663, in end\r\n    feed_dict=self._final_ops_feed_dict)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 778, in run\r\n    run_metadata_ptr)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 982, in _run\r\n    feed_dict_string, options, run_metadata)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1032, in _do_run\r\n    target_list, options, run_metadata)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 1052, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.OutOfRangeError: RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\r\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\r\n\r\nCaused by op 'shuffle_batch', defined at:\r\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/pydevd.py\", line 1585, in <module>\r\n    globals = debugger.run(setup['file'], None, None, is_module)\r\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/pydevd.py\", line 1015, in run\r\n    pydev_imports.execfile(file, globals, locals)  # execute the script\r\n  File \"/opt/pycharm-2017.1.2/helpers/pydev/_pydev_imps/_pydev_execfile.py\", line 18, in execfile\r\n    exec(compile(contents+\"\\n\", file, 'exec'), glob, loc)\r\n  File \"/home/mmayer/dev/foobar.py\", line 206, in <module>\r\n    main()\r\n  File \"/home/mmayer/dev/foobar.py\", line 40, in main\r\n    run_training(nn, args, model_params)\r\n  File \"/home/mmayer/dev/foobar.py\", line 58, in run_training\r\n    ev = run_evaluation(nn, args, model_params, best_f=None, use_best_checkpoint=True)\r\n  File \"/home/mmayer/dev/foobar.py\", line 82, in run_evaluation\r\n    ev = nn.evaluate(input_fn=lambda: input_fn(args.eval_dir, params=model_params, epochs=1), steps=None)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 268, in evaluate\r\n    name=name)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/estimator/estimator.py\", line 604, in _evaluate_model\r\n    features, labels = input_fn()\r\n  File \"/home/mmayer/dev/foobar.py\", line 82, in <lambda>\r\n    ev = nn.evaluate(input_fn=lambda: input_fn(args.eval_dir, params=model_params, epochs=1), steps=None)\r\n  File \"/home/mmayer/dev/input_pipeline/input_fn.py\", line 31, in input_fn\r\n    allow_smaller_final_batch=True)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/input.py\", line 1214, in shuffle_batch\r\n    name=name)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/training/input.py\", line 782, in _shuffle_batch\r\n    dequeued = queue.dequeue_up_to(batch_size, name=name)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/ops/data_flow_ops.py\", line 499, in dequeue_up_to\r\n    self._queue_ref, n=n, component_types=self._dtypes, name=name)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 1420, in _queue_dequeue_up_to_v2\r\n    timeout_ms=timeout_ms, name=name)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py\", line 768, in apply_op\r\n    op_def=op_def)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 2336, in create_op\r\n    original_op=self._default_original_op, op_def=op_def)\r\n  File \"/home/mmayer/.conda/envs/tensorflow-xla/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1228, in __init__\r\n    self._traceback = _extract_stack()\r\n\r\nOutOfRangeError (see above for traceback): RandomShuffleQueue '_1_shuffle_batch/random_shuffle_queue' is closed and has insufficient elements (requested 16, current size 0)\r\n\t [[Node: shuffle_batch = QueueDequeueUpToV2[component_types=[DT_STRING, DT_STRING], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](shuffle_batch/random_shuffle_queue, shuffle_batch/n)]]\r\n```\r\n\r\nThe line in question in my code is a\r\n\r\n```python\r\nimage_batch = tf.train.shuffle_batch([file_names, image_bytes],\r\n                                                 batch_size=params['batch_size'],\r\n                                                 capacity=1000, min_after_dequeue=100,\r\n                                                 num_threads=params['input_threads'],\r\n                                                 enqueue_many=True,\r\n                                                 allow_smaller_final_batch=True)\r\n```"}