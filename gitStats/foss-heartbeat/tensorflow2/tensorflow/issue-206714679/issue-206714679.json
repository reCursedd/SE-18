{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7407", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7407/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7407/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7407/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/7407", "id": 206714679, "node_id": "MDU6SXNzdWUyMDY3MTQ2Nzk=", "number": 7407, "title": "Estimator does not catch OutOfRange error", "user": {"login": "bxshi", "id": 1314883, "node_id": "MDQ6VXNlcjEzMTQ4ODM=", "avatar_url": "https://avatars3.githubusercontent.com/u/1314883?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bxshi", "html_url": "https://github.com/bxshi", "followers_url": "https://api.github.com/users/bxshi/followers", "following_url": "https://api.github.com/users/bxshi/following{/other_user}", "gists_url": "https://api.github.com/users/bxshi/gists{/gist_id}", "starred_url": "https://api.github.com/users/bxshi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bxshi/subscriptions", "organizations_url": "https://api.github.com/users/bxshi/orgs", "repos_url": "https://api.github.com/users/bxshi/repos", "events_url": "https://api.github.com/users/bxshi/events{/privacy}", "received_events_url": "https://api.github.com/users/bxshi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2017-02-10T05:53:27Z", "updated_at": "2018-02-14T06:52:24Z", "closed_at": "2017-10-10T12:49:11Z", "author_association": "NONE", "body_html": "<p>I created a [4, 1, 5] tensor and use</p>\n<pre><code>feature_a = tf.train.limit_epochs(testing_data_a, num_epochs=1, name=\"feature_a_limit\")\ntf.train.batch([feature_a], batch_size=2, enqueue_many=True,\n                                                                allow_smaller_final_batch=True, name=\"feature_a_batch\")\n</code></pre>\n<p>to create a batch queue that produces the tensor only once, and I then use this in the input_fn function of <code>model.evaluate</code> with steps=2. Because the batch size is 2 and the steps is 2, I expect this could use up the batch queue without an OutOfRange error (or the Estimator will catch this error and use it as an indicator to stop the evaluation), however the Estimator does not catch it and the program ends.</p>\n<p>Is this an expected behavior? If I remember correctly Estimator used to catch such error. Another question is, why the FIFO queue still throw the OutOfRange even if I just request the exact number of elements in the queue?</p>\n<h3>What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?</h3>\n<p><a href=\"http://stackoverflow.com/questions/42127447/tensorflows-estimator-can-only-get-n-1-batches-from-tf-train-limit-epochs\" rel=\"nofollow\">http://stackoverflow.com/questions/42127447/tensorflows-estimator-can-only-get-n-1-batches-from-tf-train-limit-epochs</a></p>\n<h3>Environment info</h3>\n<p>Operating System:</p>\n<pre><code>Linux DOMAIN 3.13.0-107-generic #154-Ubuntu SMP Tue Dec 20 09:57:27 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n</code></pre>\n<ol>\n<li>The commit hash (<code>git rev-parse HEAD</code>)</li>\n</ol>\n<pre><code>1536a84f32f1fe77efd3fee6e5933a1dfe4e10bb\n</code></pre>\n<ol start=\"2\">\n<li>The output of <code>bazel version</code></li>\n</ol>\n<pre><code>Build label: 0.4.3\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Thu Dec 22 12:31:25 2016 (1482409885)\nBuild timestamp: 1482409885\nBuild timestamp as int: 1482409885\n</code></pre>\n<h3>If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)</h3>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n<span class=\"pl-k\">from</span> tensorflow.contrib.layers.python.layers.optimizers <span class=\"pl-k\">import</span> optimize_loss\n<span class=\"pl-k\">from</span> tensorflow.contrib.learn.python.learn.estimators <span class=\"pl-k\">import</span> model_fn\n<span class=\"pl-k\">from</span> tensorflow.contrib.learn.python.learn.estimators.estimator <span class=\"pl-k\">import</span> Estimator\n<span class=\"pl-k\">from</span> tensorflow.python <span class=\"pl-k\">import</span> debug <span class=\"pl-k\">as</span> tf_debug\n<span class=\"pl-k\">from</span> tensorflow.python.framework <span class=\"pl-k\">import</span> ops\n\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">main</span>(<span class=\"pl-smi\">_</span>):\n    hooks <span class=\"pl-k\">=</span> [tf_debug.LocalCLIDebugHook()]\n\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">func</span>(<span class=\"pl-smi\">features</span>, <span class=\"pl-smi\">targets</span>, <span class=\"pl-smi\">mode</span>, <span class=\"pl-smi\">params</span>):\n        idx <span class=\"pl-k\">=</span> tf.concat([features[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>a<span class=\"pl-pds\">'</span></span>], features[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>b<span class=\"pl-pds\">'</span></span>]], <span class=\"pl-v\">axis</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">1</span>)\n\n        embedding <span class=\"pl-k\">=</span> tf.get_variable(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>embed<span class=\"pl-pds\">\"</span></span>, [<span class=\"pl-c1\">10</span>, <span class=\"pl-c1\">20</span>], <span class=\"pl-v\">dtype</span><span class=\"pl-k\">=</span>tf.float32)\n\n        pred <span class=\"pl-k\">=</span> tf.reduce_sum(tf.nn.embedding_lookup(embedding, idx))\n\n        train_op <span class=\"pl-k\">=</span> optimize_loss(<span class=\"pl-v\">loss</span><span class=\"pl-k\">=</span>pred,\n                                 <span class=\"pl-v\">global_step</span><span class=\"pl-k\">=</span>tf.train.get_global_step(),\n                                 <span class=\"pl-v\">learning_rate</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">0.001</span>,\n                                 <span class=\"pl-v\">optimizer</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>Adam<span class=\"pl-pds\">'</span></span>,\n                                 <span class=\"pl-v\">variables</span><span class=\"pl-k\">=</span>tf.trainable_variables(),\n                                 <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>training_loss_optimizer<span class=\"pl-pds\">\"</span></span>)\n\n        eval_metric_dict <span class=\"pl-k\">=</span> <span class=\"pl-c1\">dict</span>()\n        eval_metric_dict[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>metric<span class=\"pl-pds\">'</span></span>] <span class=\"pl-k\">=</span> pred\n\n        <span class=\"pl-k\">return</span> model_fn.ModelFnOps(<span class=\"pl-v\">mode</span><span class=\"pl-k\">=</span>mode,\n                                   <span class=\"pl-v\">predictions</span><span class=\"pl-k\">=</span>pred,\n                                   <span class=\"pl-v\">loss</span><span class=\"pl-k\">=</span>pred,\n                                   <span class=\"pl-v\">train_op</span><span class=\"pl-k\">=</span>train_op,\n                                   <span class=\"pl-v\">eval_metric_ops</span><span class=\"pl-k\">=</span>eval_metric_dict)\n\n    model <span class=\"pl-k\">=</span> Estimator(func, <span class=\"pl-v\">params</span><span class=\"pl-k\">=</span>{})\n\n    model.fit(\n        <span class=\"pl-v\">input_fn</span><span class=\"pl-k\">=</span><span class=\"pl-k\">lambda</span>: (\n            {<span class=\"pl-s\"><span class=\"pl-pds\">'</span>a<span class=\"pl-pds\">'</span></span>: ops.convert_to_tensor([[<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">4</span>, <span class=\"pl-c1\">5</span>]]), <span class=\"pl-s\"><span class=\"pl-pds\">'</span>b<span class=\"pl-pds\">'</span></span>: ops.convert_to_tensor([[<span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">4</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">5</span>]])},\n            <span class=\"pl-c1\">None</span>), <span class=\"pl-v\">max_steps</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">10</span>)\n\n    testing_data_a <span class=\"pl-k\">=</span> [[<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">4</span>, <span class=\"pl-c1\">5</span>], [<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">4</span>, <span class=\"pl-c1\">5</span>] , [<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">4</span>, <span class=\"pl-c1\">5</span>], [<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">4</span>, <span class=\"pl-c1\">5</span>]]\n    testing_data_b <span class=\"pl-k\">=</span> [[<span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">4</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">5</span>], [<span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">4</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">5</span>] , [<span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">4</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">5</span>], [<span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">4</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">5</span>]]\n\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">test_input_fn</span>():\n        <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>test_input_fn entered<span class=\"pl-pds\">\"</span></span>)\n        feature_a <span class=\"pl-k\">=</span> tf.train.limit_epochs(testing_data_a, <span class=\"pl-v\">num_epochs</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">1</span>, <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>feature_a_limit<span class=\"pl-pds\">\"</span></span>)\n        feature_b <span class=\"pl-k\">=</span> tf.train.limit_epochs(testing_data_b, <span class=\"pl-v\">num_epochs</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">1</span>, <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>feature_b_limit<span class=\"pl-pds\">\"</span></span>)\n\n        feature_a_producer, feature_b_producer <span class=\"pl-k\">=</span> tf.train.batch([feature_a, feature_b], <span class=\"pl-v\">batch_size</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">2</span>, <span class=\"pl-v\">enqueue_many</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>,\n                                                                <span class=\"pl-v\">allow_smaller_final_batch</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>, <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>feature_a_batch<span class=\"pl-pds\">\"</span></span>)\n\n        <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>test_input_fn exit<span class=\"pl-pds\">\"</span></span>)\n        <span class=\"pl-k\">return</span> {<span class=\"pl-s\"><span class=\"pl-pds\">'</span>a<span class=\"pl-pds\">'</span></span>: feature_a_producer, <span class=\"pl-s\"><span class=\"pl-pds\">'</span>b<span class=\"pl-pds\">'</span></span>: feature_b_producer}, <span class=\"pl-c1\">None</span>\n\n    <span class=\"pl-k\">for</span> i <span class=\"pl-k\">in</span> <span class=\"pl-c1\">range</span>(<span class=\"pl-c1\">10</span>):\n        <span class=\"pl-c1\">print</span>(model.evaluate(<span class=\"pl-v\">input_fn</span><span class=\"pl-k\">=</span>test_input_fn, <span class=\"pl-v\">steps</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">2</span>))\n        <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>one iteration done<span class=\"pl-pds\">\"</span></span>)\n\n\n<span class=\"pl-k\">if</span> <span class=\"pl-c1\">__name__</span> <span class=\"pl-k\">==</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>__main__<span class=\"pl-pds\">\"</span></span>:\n    tf.app.run()</pre></div>\n<h3>What other attempted solutions have you tried?</h3>\n<h3>Logs or other output that would be helpful</h3>\n<p>(If logs are large, please upload as attachment or provide link).</p>\n<pre><code>ssh://bshi@dsg1.crc.nd.edu:22/data/bshi/py3env/bin/python -u /data/bshi/ProjC/estimator_test.py --debug\nWARNING:tensorflow:Using temporary folder as model directory: /tmp/tmpxtkow_oq\ntest_input_fn entered\ntest_input_fn exit\nW tensorflow/core/framework/op_kernel.cc:993] Out of range: FIFOQueue '_0_feature_a_batch/fifo_queue' is closed and has insufficient elements (requested 2, current size 0)\n\t [[Node: feature_a_batch = QueueDequeueUpToV2[component_types=[DT_INT32, DT_INT32], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](feature_a_batch/fifo_queue, feature_a_batch/n)]]\nTraceback (most recent call last):\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1022, in _do_call\n    return fn(*args)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1004, in _run_fn\n    status, run_metadata)\n  File \"/usr/lib/python3.4/contextlib.py\", line 66, in __exit__\n    next(self.gen)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/framework/errors_impl.py\", line 469, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors_impl.OutOfRangeError: FIFOQueue '_0_feature_a_batch/fifo_queue' is closed and has insufficient elements (requested 2, current size 0)\n\t [[Node: feature_a_batch = QueueDequeueUpToV2[component_types=[DT_INT32, DT_INT32], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](feature_a_batch/fifo_queue, feature_a_batch/n)]]\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/data/bshi/ProjC/estimator_test.py\", line 62, in &lt;module&gt;\n    tf.app.run()\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/platform/app.py\", line 44, in run\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\n  File \"/data/bshi/ProjC/estimator_test.py\", line 57, in main\n    print(model.evaluate(input_fn=test_input_fn, steps=2))\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/util/deprecation.py\", line 280, in new_func\n    return func(*args, **kwargs)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 514, in evaluate\n    log_progress=log_progress)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 836, in _evaluate_model\n    hooks=hooks)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/contrib/training/python/training/evaluation.py\", line 430, in evaluate_once\n    session.run(eval_ops, feed_dict)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/training/monitored_session.py\", line 478, in __exit__\n    self._close_internal(exception_type)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/training/monitored_session.py\", line 508, in _close_internal\n    h.end(self._coordinated_creator.tf_sess)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/training/basic_session_run_hooks.py\", line 647, in end\n    feed_dict=self._final_ops_feed_dict)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 767, in run\n    run_metadata_ptr)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 965, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1015, in _do_run\n    target_list, options, run_metadata)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1035, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.OutOfRangeError: FIFOQueue '_0_feature_a_batch/fifo_queue' is closed and has insufficient elements (requested 2, current size 0)\n\t [[Node: feature_a_batch = QueueDequeueUpToV2[component_types=[DT_INT32, DT_INT32], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](feature_a_batch/fifo_queue, feature_a_batch/n)]]\n\nCaused by op 'feature_a_batch', defined at:\n  File \"/data/bshi/ProjC/estimator_test.py\", line 62, in &lt;module&gt;\n    tf.app.run()\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/platform/app.py\", line 44, in run\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\n  File \"/data/bshi/ProjC/estimator_test.py\", line 57, in main\n    print(model.evaluate(input_fn=test_input_fn, steps=2))\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/util/deprecation.py\", line 280, in new_func\n    return func(*args, **kwargs)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 514, in evaluate\n    log_progress=log_progress)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 800, in _evaluate_model\n    features, labels = input_fn()\n  File \"/data/bshi/ProjC/estimator_test.py\", line 51, in test_input_fn\n    allow_smaller_final_batch=True, name=\"feature_a_batch\")\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/training/input.py\", line 872, in batch\n    name=name)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/training/input.py\", line 665, in _batch\n    dequeued = queue.dequeue_up_to(batch_size, name=name)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/ops/data_flow_ops.py\", line 510, in dequeue_up_to\n    self._queue_ref, n=n, component_types=self._dtypes, name=name)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 1402, in _queue_dequeue_up_to_v2\n    timeout_ms=timeout_ms, name=name)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\n    op_def=op_def)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/framework/ops.py\", line 2395, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\n    self._traceback = _extract_stack()\n\nOutOfRangeError (see above for traceback): FIFOQueue '_0_feature_a_batch/fifo_queue' is closed and has insufficient elements (requested 2, current size 0)\n\t [[Node: feature_a_batch = QueueDequeueUpToV2[component_types=[DT_INT32, DT_INT32], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](feature_a_batch/fifo_queue, feature_a_batch/n)]]\n\n\nProcess finished with exit code 1\n</code></pre>", "body_text": "I created a [4, 1, 5] tensor and use\nfeature_a = tf.train.limit_epochs(testing_data_a, num_epochs=1, name=\"feature_a_limit\")\ntf.train.batch([feature_a], batch_size=2, enqueue_many=True,\n                                                                allow_smaller_final_batch=True, name=\"feature_a_batch\")\n\nto create a batch queue that produces the tensor only once, and I then use this in the input_fn function of model.evaluate with steps=2. Because the batch size is 2 and the steps is 2, I expect this could use up the batch queue without an OutOfRange error (or the Estimator will catch this error and use it as an indicator to stop the evaluation), however the Estimator does not catch it and the program ends.\nIs this an expected behavior? If I remember correctly Estimator used to catch such error. Another question is, why the FIFO queue still throw the OutOfRange even if I just request the exact number of elements in the queue?\nWhat related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\nhttp://stackoverflow.com/questions/42127447/tensorflows-estimator-can-only-get-n-1-batches-from-tf-train-limit-epochs\nEnvironment info\nOperating System:\nLinux DOMAIN 3.13.0-107-generic #154-Ubuntu SMP Tue Dec 20 09:57:27 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n\n\nThe commit hash (git rev-parse HEAD)\n\n1536a84f32f1fe77efd3fee6e5933a1dfe4e10bb\n\n\nThe output of bazel version\n\nBuild label: 0.4.3\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Thu Dec 22 12:31:25 2016 (1482409885)\nBuild timestamp: 1482409885\nBuild timestamp as int: 1482409885\n\nIf possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\nimport tensorflow as tf\nfrom tensorflow.contrib.layers.python.layers.optimizers import optimize_loss\nfrom tensorflow.contrib.learn.python.learn.estimators import model_fn\nfrom tensorflow.contrib.learn.python.learn.estimators.estimator import Estimator\nfrom tensorflow.python import debug as tf_debug\nfrom tensorflow.python.framework import ops\n\n\ndef main(_):\n    hooks = [tf_debug.LocalCLIDebugHook()]\n\n    def func(features, targets, mode, params):\n        idx = tf.concat([features['a'], features['b']], axis=1)\n\n        embedding = tf.get_variable(\"embed\", [10, 20], dtype=tf.float32)\n\n        pred = tf.reduce_sum(tf.nn.embedding_lookup(embedding, idx))\n\n        train_op = optimize_loss(loss=pred,\n                                 global_step=tf.train.get_global_step(),\n                                 learning_rate=0.001,\n                                 optimizer='Adam',\n                                 variables=tf.trainable_variables(),\n                                 name=\"training_loss_optimizer\")\n\n        eval_metric_dict = dict()\n        eval_metric_dict['metric'] = pred\n\n        return model_fn.ModelFnOps(mode=mode,\n                                   predictions=pred,\n                                   loss=pred,\n                                   train_op=train_op,\n                                   eval_metric_ops=eval_metric_dict)\n\n    model = Estimator(func, params={})\n\n    model.fit(\n        input_fn=lambda: (\n            {'a': ops.convert_to_tensor([[1, 2, 3, 4, 5]]), 'b': ops.convert_to_tensor([[2, 3, 4, 3, 5]])},\n            None), max_steps=10)\n\n    testing_data_a = [[1, 2, 3, 4, 5], [1, 2, 3, 4, 5] , [1, 2, 3, 4, 5], [1, 2, 3, 4, 5]]\n    testing_data_b = [[2, 3, 4, 3, 5], [2, 3, 4, 3, 5] , [2, 3, 4, 3, 5], [2, 3, 4, 3, 5]]\n\n    def test_input_fn():\n        print(\"test_input_fn entered\")\n        feature_a = tf.train.limit_epochs(testing_data_a, num_epochs=1, name=\"feature_a_limit\")\n        feature_b = tf.train.limit_epochs(testing_data_b, num_epochs=1, name=\"feature_b_limit\")\n\n        feature_a_producer, feature_b_producer = tf.train.batch([feature_a, feature_b], batch_size=2, enqueue_many=True,\n                                                                allow_smaller_final_batch=True, name=\"feature_a_batch\")\n\n        print(\"test_input_fn exit\")\n        return {'a': feature_a_producer, 'b': feature_b_producer}, None\n\n    for i in range(10):\n        print(model.evaluate(input_fn=test_input_fn, steps=2))\n        print(\"one iteration done\")\n\n\nif __name__ == \"__main__\":\n    tf.app.run()\nWhat other attempted solutions have you tried?\nLogs or other output that would be helpful\n(If logs are large, please upload as attachment or provide link).\nssh://bshi@dsg1.crc.nd.edu:22/data/bshi/py3env/bin/python -u /data/bshi/ProjC/estimator_test.py --debug\nWARNING:tensorflow:Using temporary folder as model directory: /tmp/tmpxtkow_oq\ntest_input_fn entered\ntest_input_fn exit\nW tensorflow/core/framework/op_kernel.cc:993] Out of range: FIFOQueue '_0_feature_a_batch/fifo_queue' is closed and has insufficient elements (requested 2, current size 0)\n\t [[Node: feature_a_batch = QueueDequeueUpToV2[component_types=[DT_INT32, DT_INT32], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](feature_a_batch/fifo_queue, feature_a_batch/n)]]\nTraceback (most recent call last):\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1022, in _do_call\n    return fn(*args)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1004, in _run_fn\n    status, run_metadata)\n  File \"/usr/lib/python3.4/contextlib.py\", line 66, in __exit__\n    next(self.gen)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/framework/errors_impl.py\", line 469, in raise_exception_on_not_ok_status\n    pywrap_tensorflow.TF_GetCode(status))\ntensorflow.python.framework.errors_impl.OutOfRangeError: FIFOQueue '_0_feature_a_batch/fifo_queue' is closed and has insufficient elements (requested 2, current size 0)\n\t [[Node: feature_a_batch = QueueDequeueUpToV2[component_types=[DT_INT32, DT_INT32], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](feature_a_batch/fifo_queue, feature_a_batch/n)]]\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/data/bshi/ProjC/estimator_test.py\", line 62, in <module>\n    tf.app.run()\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/platform/app.py\", line 44, in run\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\n  File \"/data/bshi/ProjC/estimator_test.py\", line 57, in main\n    print(model.evaluate(input_fn=test_input_fn, steps=2))\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/util/deprecation.py\", line 280, in new_func\n    return func(*args, **kwargs)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 514, in evaluate\n    log_progress=log_progress)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 836, in _evaluate_model\n    hooks=hooks)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/contrib/training/python/training/evaluation.py\", line 430, in evaluate_once\n    session.run(eval_ops, feed_dict)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/training/monitored_session.py\", line 478, in __exit__\n    self._close_internal(exception_type)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/training/monitored_session.py\", line 508, in _close_internal\n    h.end(self._coordinated_creator.tf_sess)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/training/basic_session_run_hooks.py\", line 647, in end\n    feed_dict=self._final_ops_feed_dict)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 767, in run\n    run_metadata_ptr)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 965, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1015, in _do_run\n    target_list, options, run_metadata)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1035, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.OutOfRangeError: FIFOQueue '_0_feature_a_batch/fifo_queue' is closed and has insufficient elements (requested 2, current size 0)\n\t [[Node: feature_a_batch = QueueDequeueUpToV2[component_types=[DT_INT32, DT_INT32], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](feature_a_batch/fifo_queue, feature_a_batch/n)]]\n\nCaused by op 'feature_a_batch', defined at:\n  File \"/data/bshi/ProjC/estimator_test.py\", line 62, in <module>\n    tf.app.run()\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/platform/app.py\", line 44, in run\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\n  File \"/data/bshi/ProjC/estimator_test.py\", line 57, in main\n    print(model.evaluate(input_fn=test_input_fn, steps=2))\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/util/deprecation.py\", line 280, in new_func\n    return func(*args, **kwargs)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 514, in evaluate\n    log_progress=log_progress)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 800, in _evaluate_model\n    features, labels = input_fn()\n  File \"/data/bshi/ProjC/estimator_test.py\", line 51, in test_input_fn\n    allow_smaller_final_batch=True, name=\"feature_a_batch\")\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/training/input.py\", line 872, in batch\n    name=name)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/training/input.py\", line 665, in _batch\n    dequeued = queue.dequeue_up_to(batch_size, name=name)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/ops/data_flow_ops.py\", line 510, in dequeue_up_to\n    self._queue_ref, n=n, component_types=self._dtypes, name=name)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 1402, in _queue_dequeue_up_to_v2\n    timeout_ms=timeout_ms, name=name)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\n    op_def=op_def)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/framework/ops.py\", line 2395, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\n    self._traceback = _extract_stack()\n\nOutOfRangeError (see above for traceback): FIFOQueue '_0_feature_a_batch/fifo_queue' is closed and has insufficient elements (requested 2, current size 0)\n\t [[Node: feature_a_batch = QueueDequeueUpToV2[component_types=[DT_INT32, DT_INT32], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](feature_a_batch/fifo_queue, feature_a_batch/n)]]\n\n\nProcess finished with exit code 1", "body": "I created a [4, 1, 5] tensor and use \r\n\r\n```\r\nfeature_a = tf.train.limit_epochs(testing_data_a, num_epochs=1, name=\"feature_a_limit\")\r\ntf.train.batch([feature_a], batch_size=2, enqueue_many=True,\r\n                                                                allow_smaller_final_batch=True, name=\"feature_a_batch\")\r\n```\r\n\r\nto create a batch queue that produces the tensor only once, and I then use this in the input_fn function of `model.evaluate` with steps=2. Because the batch size is 2 and the steps is 2, I expect this could use up the batch queue without an OutOfRange error (or the Estimator will catch this error and use it as an indicator to stop the evaluation), however the Estimator does not catch it and the program ends.\r\n\r\nIs this an expected behavior? If I remember correctly Estimator used to catch such error. Another question is, why the FIFO queue still throw the OutOfRange even if I just request the exact number of elements in the queue?\r\n\r\n### What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\r\n\r\nhttp://stackoverflow.com/questions/42127447/tensorflows-estimator-can-only-get-n-1-batches-from-tf-train-limit-epochs\r\n\r\n### Environment info\r\nOperating System:\r\n\r\n```\r\nLinux DOMAIN 3.13.0-107-generic #154-Ubuntu SMP Tue Dec 20 09:57:27 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n\r\n1. The commit hash (`git rev-parse HEAD`)\r\n```\r\n1536a84f32f1fe77efd3fee6e5933a1dfe4e10bb\r\n```\r\n2. The output of `bazel version`\r\n\r\n```\r\nBuild label: 0.4.3\r\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\r\nBuild time: Thu Dec 22 12:31:25 2016 (1482409885)\r\nBuild timestamp: 1482409885\r\nBuild timestamp as int: 1482409885\r\n```\r\n\r\n### If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\r\n\r\n```python\r\nimport tensorflow as tf\r\nfrom tensorflow.contrib.layers.python.layers.optimizers import optimize_loss\r\nfrom tensorflow.contrib.learn.python.learn.estimators import model_fn\r\nfrom tensorflow.contrib.learn.python.learn.estimators.estimator import Estimator\r\nfrom tensorflow.python import debug as tf_debug\r\nfrom tensorflow.python.framework import ops\r\n\r\n\r\ndef main(_):\r\n    hooks = [tf_debug.LocalCLIDebugHook()]\r\n\r\n    def func(features, targets, mode, params):\r\n        idx = tf.concat([features['a'], features['b']], axis=1)\r\n\r\n        embedding = tf.get_variable(\"embed\", [10, 20], dtype=tf.float32)\r\n\r\n        pred = tf.reduce_sum(tf.nn.embedding_lookup(embedding, idx))\r\n\r\n        train_op = optimize_loss(loss=pred,\r\n                                 global_step=tf.train.get_global_step(),\r\n                                 learning_rate=0.001,\r\n                                 optimizer='Adam',\r\n                                 variables=tf.trainable_variables(),\r\n                                 name=\"training_loss_optimizer\")\r\n\r\n        eval_metric_dict = dict()\r\n        eval_metric_dict['metric'] = pred\r\n\r\n        return model_fn.ModelFnOps(mode=mode,\r\n                                   predictions=pred,\r\n                                   loss=pred,\r\n                                   train_op=train_op,\r\n                                   eval_metric_ops=eval_metric_dict)\r\n\r\n    model = Estimator(func, params={})\r\n\r\n    model.fit(\r\n        input_fn=lambda: (\r\n            {'a': ops.convert_to_tensor([[1, 2, 3, 4, 5]]), 'b': ops.convert_to_tensor([[2, 3, 4, 3, 5]])},\r\n            None), max_steps=10)\r\n\r\n    testing_data_a = [[1, 2, 3, 4, 5], [1, 2, 3, 4, 5] , [1, 2, 3, 4, 5], [1, 2, 3, 4, 5]]\r\n    testing_data_b = [[2, 3, 4, 3, 5], [2, 3, 4, 3, 5] , [2, 3, 4, 3, 5], [2, 3, 4, 3, 5]]\r\n\r\n    def test_input_fn():\r\n        print(\"test_input_fn entered\")\r\n        feature_a = tf.train.limit_epochs(testing_data_a, num_epochs=1, name=\"feature_a_limit\")\r\n        feature_b = tf.train.limit_epochs(testing_data_b, num_epochs=1, name=\"feature_b_limit\")\r\n\r\n        feature_a_producer, feature_b_producer = tf.train.batch([feature_a, feature_b], batch_size=2, enqueue_many=True,\r\n                                                                allow_smaller_final_batch=True, name=\"feature_a_batch\")\r\n\r\n        print(\"test_input_fn exit\")\r\n        return {'a': feature_a_producer, 'b': feature_b_producer}, None\r\n\r\n    for i in range(10):\r\n        print(model.evaluate(input_fn=test_input_fn, steps=2))\r\n        print(\"one iteration done\")\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    tf.app.run()\r\n```\r\n\r\n### What other attempted solutions have you tried?\r\n\r\n\r\n### Logs or other output that would be helpful\r\n(If logs are large, please upload as attachment or provide link).\r\n```\r\nssh://bshi@dsg1.crc.nd.edu:22/data/bshi/py3env/bin/python -u /data/bshi/ProjC/estimator_test.py --debug\r\nWARNING:tensorflow:Using temporary folder as model directory: /tmp/tmpxtkow_oq\r\ntest_input_fn entered\r\ntest_input_fn exit\r\nW tensorflow/core/framework/op_kernel.cc:993] Out of range: FIFOQueue '_0_feature_a_batch/fifo_queue' is closed and has insufficient elements (requested 2, current size 0)\r\n\t [[Node: feature_a_batch = QueueDequeueUpToV2[component_types=[DT_INT32, DT_INT32], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](feature_a_batch/fifo_queue, feature_a_batch/n)]]\r\nTraceback (most recent call last):\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1022, in _do_call\r\n    return fn(*args)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1004, in _run_fn\r\n    status, run_metadata)\r\n  File \"/usr/lib/python3.4/contextlib.py\", line 66, in __exit__\r\n    next(self.gen)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/framework/errors_impl.py\", line 469, in raise_exception_on_not_ok_status\r\n    pywrap_tensorflow.TF_GetCode(status))\r\ntensorflow.python.framework.errors_impl.OutOfRangeError: FIFOQueue '_0_feature_a_batch/fifo_queue' is closed and has insufficient elements (requested 2, current size 0)\r\n\t [[Node: feature_a_batch = QueueDequeueUpToV2[component_types=[DT_INT32, DT_INT32], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](feature_a_batch/fifo_queue, feature_a_batch/n)]]\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/data/bshi/ProjC/estimator_test.py\", line 62, in <module>\r\n    tf.app.run()\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/platform/app.py\", line 44, in run\r\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\r\n  File \"/data/bshi/ProjC/estimator_test.py\", line 57, in main\r\n    print(model.evaluate(input_fn=test_input_fn, steps=2))\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/util/deprecation.py\", line 280, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 514, in evaluate\r\n    log_progress=log_progress)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 836, in _evaluate_model\r\n    hooks=hooks)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/contrib/training/python/training/evaluation.py\", line 430, in evaluate_once\r\n    session.run(eval_ops, feed_dict)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/training/monitored_session.py\", line 478, in __exit__\r\n    self._close_internal(exception_type)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/training/monitored_session.py\", line 508, in _close_internal\r\n    h.end(self._coordinated_creator.tf_sess)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/training/basic_session_run_hooks.py\", line 647, in end\r\n    feed_dict=self._final_ops_feed_dict)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 767, in run\r\n    run_metadata_ptr)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 965, in _run\r\n    feed_dict_string, options, run_metadata)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1015, in _do_run\r\n    target_list, options, run_metadata)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/client/session.py\", line 1035, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.OutOfRangeError: FIFOQueue '_0_feature_a_batch/fifo_queue' is closed and has insufficient elements (requested 2, current size 0)\r\n\t [[Node: feature_a_batch = QueueDequeueUpToV2[component_types=[DT_INT32, DT_INT32], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](feature_a_batch/fifo_queue, feature_a_batch/n)]]\r\n\r\nCaused by op 'feature_a_batch', defined at:\r\n  File \"/data/bshi/ProjC/estimator_test.py\", line 62, in <module>\r\n    tf.app.run()\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/platform/app.py\", line 44, in run\r\n    _sys.exit(main(_sys.argv[:1] + flags_passthrough))\r\n  File \"/data/bshi/ProjC/estimator_test.py\", line 57, in main\r\n    print(model.evaluate(input_fn=test_input_fn, steps=2))\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/util/deprecation.py\", line 280, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 514, in evaluate\r\n    log_progress=log_progress)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 800, in _evaluate_model\r\n    features, labels = input_fn()\r\n  File \"/data/bshi/ProjC/estimator_test.py\", line 51, in test_input_fn\r\n    allow_smaller_final_batch=True, name=\"feature_a_batch\")\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/training/input.py\", line 872, in batch\r\n    name=name)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/training/input.py\", line 665, in _batch\r\n    dequeued = queue.dequeue_up_to(batch_size, name=name)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/ops/data_flow_ops.py\", line 510, in dequeue_up_to\r\n    self._queue_ref, n=n, component_types=self._dtypes, name=name)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 1402, in _queue_dequeue_up_to_v2\r\n    timeout_ms=timeout_ms, name=name)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/framework/op_def_library.py\", line 763, in apply_op\r\n    op_def=op_def)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/framework/ops.py\", line 2395, in create_op\r\n    original_op=self._default_original_op, op_def=op_def)\r\n  File \"/data/bshi/py3env/lib/python3.4/site-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\r\n    self._traceback = _extract_stack()\r\n\r\nOutOfRangeError (see above for traceback): FIFOQueue '_0_feature_a_batch/fifo_queue' is closed and has insufficient elements (requested 2, current size 0)\r\n\t [[Node: feature_a_batch = QueueDequeueUpToV2[component_types=[DT_INT32, DT_INT32], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](feature_a_batch/fifo_queue, feature_a_batch/n)]]\r\n\r\n\r\nProcess finished with exit code 1\r\n```\r\n"}