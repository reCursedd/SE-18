{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13190", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13190/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13190/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13190/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/13190", "id": 259218354, "node_id": "MDU6SXNzdWUyNTkyMTgzNTQ=", "number": 13190, "title": "TF_AddGradients gradients returns wrong result when multiple outputs specified", "user": {"login": "Dorokhov", "id": 1944245, "node_id": "MDQ6VXNlcjE5NDQyNDU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1944245?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dorokhov", "html_url": "https://github.com/Dorokhov", "followers_url": "https://api.github.com/users/Dorokhov/followers", "following_url": "https://api.github.com/users/Dorokhov/following{/other_user}", "gists_url": "https://api.github.com/users/Dorokhov/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dorokhov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dorokhov/subscriptions", "organizations_url": "https://api.github.com/users/Dorokhov/orgs", "repos_url": "https://api.github.com/users/Dorokhov/repos", "events_url": "https://api.github.com/users/Dorokhov/events{/privacy}", "received_events_url": "https://api.github.com/users/Dorokhov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "suharshs", "id": 1450614, "node_id": "MDQ6VXNlcjE0NTA2MTQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/1450614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/suharshs", "html_url": "https://github.com/suharshs", "followers_url": "https://api.github.com/users/suharshs/followers", "following_url": "https://api.github.com/users/suharshs/following{/other_user}", "gists_url": "https://api.github.com/users/suharshs/gists{/gist_id}", "starred_url": "https://api.github.com/users/suharshs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/suharshs/subscriptions", "organizations_url": "https://api.github.com/users/suharshs/orgs", "repos_url": "https://api.github.com/users/suharshs/repos", "events_url": "https://api.github.com/users/suharshs/events{/privacy}", "received_events_url": "https://api.github.com/users/suharshs/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "suharshs", "id": 1450614, "node_id": "MDQ6VXNlcjE0NTA2MTQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/1450614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/suharshs", "html_url": "https://github.com/suharshs", "followers_url": "https://api.github.com/users/suharshs/followers", "following_url": "https://api.github.com/users/suharshs/following{/other_user}", "gists_url": "https://api.github.com/users/suharshs/gists{/gist_id}", "starred_url": "https://api.github.com/users/suharshs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/suharshs/subscriptions", "organizations_url": "https://api.github.com/users/suharshs/orgs", "repos_url": "https://api.github.com/users/suharshs/repos", "events_url": "https://api.github.com/users/suharshs/events{/privacy}", "received_events_url": "https://api.github.com/users/suharshs/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2017-09-20T16:04:58Z", "updated_at": "2017-10-04T20:50:56Z", "closed_at": "2017-10-04T20:50:56Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>System information</h3>\n<p>Darwin Mac-Admin.local 15.6.0 Darwin Kernel Version 15.6.0: Thu Jun 23 18:25:34 PDT 2016; root:xnu-3248.60.10~1/RELEASE_X86_64 x86_64<br>\nMac OS X 10.11.6</p>\n<h3>Describe the problem</h3>\n<p>Hi. I've added a unit test for TF_AddGradients API (see code below) which is similar to<br>\n<a href=\"https://github.com/tensorflow/tensorflow/blob/ca3bc0f1c2f917cf6e7c49d58f5ec604a9af9367/tensorflow/python/ops/gradients_test.py#L337\">this python test</a></p>\n<p>In the test, I provide two outputs<br>\ny[0]=x[0] ** 2<br>\ny[1] = y[0] ** 8</p>\n<p>where input x[0]=3.<br>\nAccording to the <a href=\"https://github.com/tensorflow/tensorflow/blob/03619fab3f4dd6f28b67418455a953b0fccdd9bf/tensorflow/c/c_api.h#L1018\">documentation</a>  result should be calculated by formula d(y_1 + y_2 + ...)/dx_1 and be equal to 17502, but the API prints 6.</p>\n<p>What am I missing? Thanks.</p>\n<h3>Source code / logs</h3>\n<pre><code>    TF_Status* s = TF_NewStatus();\n    TF_Graph* graph = TF_NewGraph();\n\n    const int ny = 2;\n    const int nx = 1;\n    TF_Output inputs[nx];\n    TF_Output outputs[ny];\n    TF_Output grad_outputs[nx];\n\n    TF_Operation* ph0 = Placeholder(graph, s);\n\n    TF_Operation* y0 = Square(graph, s, ph0, \"Square0\");\n    TF_Operation* y1 = Square(graph, s, y0, \"Square1\");\n    TF_Operation* y2 = Square(graph, s, y1, \"Square2\");\n    inputs[0] = TF_Output{ph0, 0};\n    outputs[0] = TF_Output{y0, 0};\n    outputs[1] = TF_Output{y2, 0};\n\n    TF_AddGradients(graph, outputs, ny, inputs, nx, nullptr, s, grad_outputs);\n    EXPECT_EQ(TF_OK, TF_GetCode(s)) &lt;&lt; TF_Message(s);\n\n    std::unique_ptr&lt;CSession&gt; csession(new CSession(graph, s));\n\n    std::vector&lt;TF_Output&gt; grad_outputs_vec;\n    grad_outputs_vec.assign(grad_outputs, grad_outputs + 2);\n    csession-&gt;SetInputs({{ph0, Int32Tensor(3)}});\n    csession-&gt;SetOutputs(grad_outputs_vec);\n    csession-&gt;Run(s);\n    ASSERT_EQ(TF_OK, TF_GetCode(s)) &lt;&lt; TF_Message(s);\n\n    TF_Tensor* out0 = csession-&gt;output_tensor(0);\n    int* data = static_cast&lt;int*&gt;(TF_TensorData(out0));\n    ASSERT_EQ(17502, *data); \n\nFailure\n      Expected: 17502\nTo be equal to: *data\n      Which is: 6\n</code></pre>", "body_text": "System information\nDarwin Mac-Admin.local 15.6.0 Darwin Kernel Version 15.6.0: Thu Jun 23 18:25:34 PDT 2016; root:xnu-3248.60.10~1/RELEASE_X86_64 x86_64\nMac OS X 10.11.6\nDescribe the problem\nHi. I've added a unit test for TF_AddGradients API (see code below) which is similar to\nthis python test\nIn the test, I provide two outputs\ny[0]=x[0] ** 2\ny[1] = y[0] ** 8\nwhere input x[0]=3.\nAccording to the documentation  result should be calculated by formula d(y_1 + y_2 + ...)/dx_1 and be equal to 17502, but the API prints 6.\nWhat am I missing? Thanks.\nSource code / logs\n    TF_Status* s = TF_NewStatus();\n    TF_Graph* graph = TF_NewGraph();\n\n    const int ny = 2;\n    const int nx = 1;\n    TF_Output inputs[nx];\n    TF_Output outputs[ny];\n    TF_Output grad_outputs[nx];\n\n    TF_Operation* ph0 = Placeholder(graph, s);\n\n    TF_Operation* y0 = Square(graph, s, ph0, \"Square0\");\n    TF_Operation* y1 = Square(graph, s, y0, \"Square1\");\n    TF_Operation* y2 = Square(graph, s, y1, \"Square2\");\n    inputs[0] = TF_Output{ph0, 0};\n    outputs[0] = TF_Output{y0, 0};\n    outputs[1] = TF_Output{y2, 0};\n\n    TF_AddGradients(graph, outputs, ny, inputs, nx, nullptr, s, grad_outputs);\n    EXPECT_EQ(TF_OK, TF_GetCode(s)) << TF_Message(s);\n\n    std::unique_ptr<CSession> csession(new CSession(graph, s));\n\n    std::vector<TF_Output> grad_outputs_vec;\n    grad_outputs_vec.assign(grad_outputs, grad_outputs + 2);\n    csession->SetInputs({{ph0, Int32Tensor(3)}});\n    csession->SetOutputs(grad_outputs_vec);\n    csession->Run(s);\n    ASSERT_EQ(TF_OK, TF_GetCode(s)) << TF_Message(s);\n\n    TF_Tensor* out0 = csession->output_tensor(0);\n    int* data = static_cast<int*>(TF_TensorData(out0));\n    ASSERT_EQ(17502, *data); \n\nFailure\n      Expected: 17502\nTo be equal to: *data\n      Which is: 6", "body": "### System information\r\nDarwin Mac-Admin.local 15.6.0 Darwin Kernel Version 15.6.0: Thu Jun 23 18:25:34 PDT 2016; root:xnu-3248.60.10~1/RELEASE_X86_64 x86_64\r\nMac OS X 10.11.6\r\n\r\n### Describe the problem\r\nHi. I've added a unit test for TF_AddGradients API (see code below) which is similar to\r\n[this python test](https://github.com/tensorflow/tensorflow/blob/ca3bc0f1c2f917cf6e7c49d58f5ec604a9af9367/tensorflow/python/ops/gradients_test.py#L337)\r\n\r\nIn the test, I provide two outputs \r\ny[0]=x[0] ** 2 \r\ny[1] = y[0] ** 8\r\n\r\nwhere input x[0]=3.\r\nAccording to the [documentation](https://github.com/tensorflow/tensorflow/blob/03619fab3f4dd6f28b67418455a953b0fccdd9bf/tensorflow/c/c_api.h#L1018)  result should be calculated by formula d(y_1 + y_2 + ...)/dx_1 and be equal to 17502, but the API prints 6.\r\n\r\nWhat am I missing? Thanks.\r\n\r\n### Source code / logs\r\n\r\n```\r\n    TF_Status* s = TF_NewStatus();\r\n    TF_Graph* graph = TF_NewGraph();\r\n\r\n    const int ny = 2;\r\n    const int nx = 1;\r\n    TF_Output inputs[nx];\r\n    TF_Output outputs[ny];\r\n    TF_Output grad_outputs[nx];\r\n\r\n    TF_Operation* ph0 = Placeholder(graph, s);\r\n\r\n    TF_Operation* y0 = Square(graph, s, ph0, \"Square0\");\r\n    TF_Operation* y1 = Square(graph, s, y0, \"Square1\");\r\n    TF_Operation* y2 = Square(graph, s, y1, \"Square2\");\r\n    inputs[0] = TF_Output{ph0, 0};\r\n    outputs[0] = TF_Output{y0, 0};\r\n    outputs[1] = TF_Output{y2, 0};\r\n\r\n    TF_AddGradients(graph, outputs, ny, inputs, nx, nullptr, s, grad_outputs);\r\n    EXPECT_EQ(TF_OK, TF_GetCode(s)) << TF_Message(s);\r\n\r\n    std::unique_ptr<CSession> csession(new CSession(graph, s));\r\n\r\n    std::vector<TF_Output> grad_outputs_vec;\r\n    grad_outputs_vec.assign(grad_outputs, grad_outputs + 2);\r\n    csession->SetInputs({{ph0, Int32Tensor(3)}});\r\n    csession->SetOutputs(grad_outputs_vec);\r\n    csession->Run(s);\r\n    ASSERT_EQ(TF_OK, TF_GetCode(s)) << TF_Message(s);\r\n\r\n    TF_Tensor* out0 = csession->output_tensor(0);\r\n    int* data = static_cast<int*>(TF_TensorData(out0));\r\n    ASSERT_EQ(17502, *data); \r\n\r\nFailure\r\n      Expected: 17502\r\nTo be equal to: *data\r\n      Which is: 6\r\n```\r\n\r\n"}