{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/321529446", "html_url": "https://github.com/tensorflow/tensorflow/pull/11581#issuecomment-321529446", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/11581", "id": 321529446, "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTUyOTQ0Ng==", "user": {"login": "zhouh", "id": 7070361, "node_id": "MDQ6VXNlcjcwNzAzNjE=", "avatar_url": "https://avatars1.githubusercontent.com/u/7070361?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhouh", "html_url": "https://github.com/zhouh", "followers_url": "https://api.github.com/users/zhouh/followers", "following_url": "https://api.github.com/users/zhouh/following{/other_user}", "gists_url": "https://api.github.com/users/zhouh/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhouh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhouh/subscriptions", "organizations_url": "https://api.github.com/users/zhouh/orgs", "repos_url": "https://api.github.com/users/zhouh/repos", "events_url": "https://api.github.com/users/zhouh/events{/privacy}", "received_events_url": "https://api.github.com/users/zhouh/received_events", "type": "User", "site_admin": false}, "created_at": "2017-08-10T11:49:30Z", "updated_at": "2017-08-10T11:50:50Z", "author_association": "NONE", "body_html": "<p>Thanks for fixing this. Another issue is that when the global variable set includes variables with type as int32, it may cause an error:</p>\n<pre><code>\n  File \"/data01/home/zhouhao.nlp/workspace/nmt/src/seq2seq/seq2seq_runner.py\", line 304, in distributed_run\n    ma_hook = ma.make_ma_run_hook()\n  File \"/data01/home/zhouhao.nlp/workspace/nmt/src/seq2seq/utils/model_average/python/model_average_optimizer.py\", line 453, in make_ma_run_hook\n    global_step=self._super_global_step)\n  File \"/data01/home/zhouhao.nlp/workspace/nmt/src/seq2seq/utils/model_average/python/model_average_optimizer.py\", line 307, in apply_model_average\n    block_grad = math_ops.multiply(self._block_learning_rate, gk_new)\n  File \"/data01/home/zhaochengqi/tf11/local/lib/python2.7/site-packages/tensorflow/python/ops/math_ops.py\", line 286, in multiply\n    return gen_math_ops._mul(x, y, name)\n  File \"/data01/home/zhaochengqi/tf11/local/lib/python2.7/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 1377, in _mul\n    result = _op_def_lib.apply_op(\"Mul\", x=x, y=y, name=name)\n  File \"/data01/home/zhaochengqi/tf11/local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 526, in apply_op\n    inferred_from[input_arg.type_attr]))\nTypeError: Input 'y' of 'Mul' Op has type int32 that does not match type float32 of argument 'x'. \n</code></pre>\n<p>This error occurs due to our global variable set includes some untrainable int32 variables such as the global_step, which will lead to exception in the process of averaging parameters. How about using the TRAINABLE_VARIABLES to replace the local and global variables for averaging?</p>\n<p>Do I mis-understand something?</p>", "body_text": "Thanks for fixing this. Another issue is that when the global variable set includes variables with type as int32, it may cause an error:\n\n  File \"/data01/home/zhouhao.nlp/workspace/nmt/src/seq2seq/seq2seq_runner.py\", line 304, in distributed_run\n    ma_hook = ma.make_ma_run_hook()\n  File \"/data01/home/zhouhao.nlp/workspace/nmt/src/seq2seq/utils/model_average/python/model_average_optimizer.py\", line 453, in make_ma_run_hook\n    global_step=self._super_global_step)\n  File \"/data01/home/zhouhao.nlp/workspace/nmt/src/seq2seq/utils/model_average/python/model_average_optimizer.py\", line 307, in apply_model_average\n    block_grad = math_ops.multiply(self._block_learning_rate, gk_new)\n  File \"/data01/home/zhaochengqi/tf11/local/lib/python2.7/site-packages/tensorflow/python/ops/math_ops.py\", line 286, in multiply\n    return gen_math_ops._mul(x, y, name)\n  File \"/data01/home/zhaochengqi/tf11/local/lib/python2.7/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 1377, in _mul\n    result = _op_def_lib.apply_op(\"Mul\", x=x, y=y, name=name)\n  File \"/data01/home/zhaochengqi/tf11/local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 526, in apply_op\n    inferred_from[input_arg.type_attr]))\nTypeError: Input 'y' of 'Mul' Op has type int32 that does not match type float32 of argument 'x'. \n\nThis error occurs due to our global variable set includes some untrainable int32 variables such as the global_step, which will lead to exception in the process of averaging parameters. How about using the TRAINABLE_VARIABLES to replace the local and global variables for averaging?\nDo I mis-understand something?", "body": "Thanks for fixing this. Another issue is that when the global variable set includes variables with type as int32, it may cause an error:\r\n\r\n```\r\n\r\n  File \"/data01/home/zhouhao.nlp/workspace/nmt/src/seq2seq/seq2seq_runner.py\", line 304, in distributed_run\r\n    ma_hook = ma.make_ma_run_hook()\r\n  File \"/data01/home/zhouhao.nlp/workspace/nmt/src/seq2seq/utils/model_average/python/model_average_optimizer.py\", line 453, in make_ma_run_hook\r\n    global_step=self._super_global_step)\r\n  File \"/data01/home/zhouhao.nlp/workspace/nmt/src/seq2seq/utils/model_average/python/model_average_optimizer.py\", line 307, in apply_model_average\r\n    block_grad = math_ops.multiply(self._block_learning_rate, gk_new)\r\n  File \"/data01/home/zhaochengqi/tf11/local/lib/python2.7/site-packages/tensorflow/python/ops/math_ops.py\", line 286, in multiply\r\n    return gen_math_ops._mul(x, y, name)\r\n  File \"/data01/home/zhaochengqi/tf11/local/lib/python2.7/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 1377, in _mul\r\n    result = _op_def_lib.apply_op(\"Mul\", x=x, y=y, name=name)\r\n  File \"/data01/home/zhaochengqi/tf11/local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 526, in apply_op\r\n    inferred_from[input_arg.type_attr]))\r\nTypeError: Input 'y' of 'Mul' Op has type int32 that does not match type float32 of argument 'x'. \r\n```\r\nThis error occurs due to our global variable set includes some untrainable int32 variables such as the global_step, which will lead to exception in the process of averaging parameters. How about using the TRAINABLE_VARIABLES to replace the local and global variables for averaging?\r\n\r\nDo I mis-understand something?"}