{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8818", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8818/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8818/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8818/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/8818", "id": 218012809, "node_id": "MDU6SXNzdWUyMTgwMTI4MDk=", "number": 8818, "title": "Bug when using `tf.contrib.metrics.streaming_mean_iou`", "user": {"login": "mgarbade", "id": 3956593, "node_id": "MDQ6VXNlcjM5NTY1OTM=", "avatar_url": "https://avatars3.githubusercontent.com/u/3956593?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mgarbade", "html_url": "https://github.com/mgarbade", "followers_url": "https://api.github.com/users/mgarbade/followers", "following_url": "https://api.github.com/users/mgarbade/following{/other_user}", "gists_url": "https://api.github.com/users/mgarbade/gists{/gist_id}", "starred_url": "https://api.github.com/users/mgarbade/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mgarbade/subscriptions", "organizations_url": "https://api.github.com/users/mgarbade/orgs", "repos_url": "https://api.github.com/users/mgarbade/repos", "events_url": "https://api.github.com/users/mgarbade/events{/privacy}", "received_events_url": "https://api.github.com/users/mgarbade/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-03-29T21:20:30Z", "updated_at": "2017-06-16T21:01:15Z", "closed_at": "2017-06-16T21:01:15Z", "author_association": "NONE", "body_html": "<h3>What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?</h3>\n<h3>Environment info</h3>\n<p>Operating System: Ubuntu 14.04</p>\n<p>Installed version of CUDA and cuDNN:<br>\n(please attach the output of <code>ls -l /path/to/cuda/lib/libcud*</code>):</p>\n<pre><code>ls -l /usr/local/cuda-8.0/lib/libcud*\n-rw-r--r-- 1 root root   560184 Sep  5  2016 /usr/local/cuda-8.0/lib/libcudadevrt.a\nlrwxrwxrwx 1 root root       16 Sep  5  2016 /usr/local/cuda-8.0/lib/libcudart.so -&gt; libcudart.so.8.0\nlrwxrwxrwx 1 root root       19 Sep  5  2016 /usr/local/cuda-8.0/lib/libcudart.so.8.0 -&gt; libcudart.so.8.0.27\n-rwxr-xr-x 1 root root   394472 Sep  5  2016 /usr/local/cuda-8.0/lib/libcudart.so.8.0.27\n-rw-r--r-- 1 root root   737516 Sep  5  2016 /usr/local/cuda-8.0/lib/libcudart_static.a\nlrwxrwxrwx 1 root root       13 Jan 17 13:52 /usr/local/cuda-8.0/lib/libcudnn.so -&gt; libcudnn.so.5\n-rwxr-xr-x 1 root root 61453024 Nov 13 12:10 /usr/local/cuda-8.0/lib/libcudnn.so.4\n-rwxr-xr-x 1 root root 61453024 Nov 13 12:10 /usr/local/cuda-8.0/lib/libcudnn.so.4.0.7\nlrwxrwxrwx 1 root root       17 Jan 17 13:52 /usr/local/cuda-8.0/lib/libcudnn.so.5 -&gt; libcudnn.so.5.1.5\n-rwxr-xr-x 1 root root 78065952 Jan 12 11:03 /usr/local/cuda-8.0/lib/libcudnn.so.5.0.5\n-rwxr-xr-x 1 root root 79337624 Jan 17 13:52 /usr/local/cuda-8.0/lib/libcudnn.so.5.1.5\n-rw-r--r-- 1 root root 69756172 Jan 17 13:52 /usr/local/cuda-8.0/lib/libcudnn_static.a\n</code></pre>\n<p>If installed from binary pip package, provide:</p>\n<ol>\n<li>\n<p>A link to the pip package you installed:</p>\n</li>\n<li>\n<p>The output from <code>python -c \"import tensorflow; print(tensorflow.__version__)\"</code>.<br>\n<code>0.12.1</code><br>\nIf installed from source, provide</p>\n</li>\n<li>\n<p>The commit hash (<code>git rev-parse HEAD</code>)</p>\n</li>\n<li>\n<p>The output of <code>bazel version</code></p>\n</li>\n</ol>\n<h3>If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)</h3>\n<h3>What other attempted solutions have you tried?</h3>\n<h3>Logs or other output that would be helpful</h3>\n<p>(If logs are large, please upload as attachment or provide link).</p>\n<p>I'm getting a strange error when trying to compute the intersection over union using tensorflows tf.contrib.metrics.streaming_mean_iou.<br>\nThis was the code I was using before which works perfectly fine</p>\n<pre><code>import tensorflow as tf\nlabel = tf.image.decode_png(tf.read_file('/path/to/label.png'),channels=1)\nlabel_lin = tf.reshape(label, [-1,])\nweights = tf.cast(tf.less_equal(label_lin, 10), tf.int32)\nmIoU, update_op = tf.contrib.metrics.streaming_mean_iou(label_lin, label_lin,num_classes = 11,weights = weights)\ninit = tf.local_variables_initializer()\nsess.run(init)\nsess.run([update_op])\n</code></pre>\n<p>However when I use a mask like this</p>\n<pre><code>mask = tf.image.decode_png(tf.read_file('/path/to/mask_file.png'),channels=1)\nmask_lin = tf.reshape(mask, [-1,])\nmask_lin = tf.cast(mask_lin,tf.int32)\nmIoU, update_op = tf.contrib.metrics.streaming_mean_iou(label_lin, label_lin,num_classes = 11,weights = mask_lin)\ninit = tf.local_variables_initializer()\nsess.run(init)\nsess.run([update_op])\n</code></pre>\n<p>It keeps on failing after an irregular number of iterations showing this error:</p>\n<p><code>*** Error in </code>/usr/bin/python': corrupted double-linked list: 0x00007f29d0022fd0 ***`</p>\n<p>I checked the shape and data type of both mask_lin and  weights. They are the same, so I cannot really see what is going wrong here.<br>\nAlso the fact that the error comes after calling update_op an irregular number of times is strange. Maybe TF empties the mask_lin object after calling several sess.run()'s ?<br>\nOr is this some TF bug? But then again why would it work with weights...</p>", "body_text": "What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\nEnvironment info\nOperating System: Ubuntu 14.04\nInstalled version of CUDA and cuDNN:\n(please attach the output of ls -l /path/to/cuda/lib/libcud*):\nls -l /usr/local/cuda-8.0/lib/libcud*\n-rw-r--r-- 1 root root   560184 Sep  5  2016 /usr/local/cuda-8.0/lib/libcudadevrt.a\nlrwxrwxrwx 1 root root       16 Sep  5  2016 /usr/local/cuda-8.0/lib/libcudart.so -> libcudart.so.8.0\nlrwxrwxrwx 1 root root       19 Sep  5  2016 /usr/local/cuda-8.0/lib/libcudart.so.8.0 -> libcudart.so.8.0.27\n-rwxr-xr-x 1 root root   394472 Sep  5  2016 /usr/local/cuda-8.0/lib/libcudart.so.8.0.27\n-rw-r--r-- 1 root root   737516 Sep  5  2016 /usr/local/cuda-8.0/lib/libcudart_static.a\nlrwxrwxrwx 1 root root       13 Jan 17 13:52 /usr/local/cuda-8.0/lib/libcudnn.so -> libcudnn.so.5\n-rwxr-xr-x 1 root root 61453024 Nov 13 12:10 /usr/local/cuda-8.0/lib/libcudnn.so.4\n-rwxr-xr-x 1 root root 61453024 Nov 13 12:10 /usr/local/cuda-8.0/lib/libcudnn.so.4.0.7\nlrwxrwxrwx 1 root root       17 Jan 17 13:52 /usr/local/cuda-8.0/lib/libcudnn.so.5 -> libcudnn.so.5.1.5\n-rwxr-xr-x 1 root root 78065952 Jan 12 11:03 /usr/local/cuda-8.0/lib/libcudnn.so.5.0.5\n-rwxr-xr-x 1 root root 79337624 Jan 17 13:52 /usr/local/cuda-8.0/lib/libcudnn.so.5.1.5\n-rw-r--r-- 1 root root 69756172 Jan 17 13:52 /usr/local/cuda-8.0/lib/libcudnn_static.a\n\nIf installed from binary pip package, provide:\n\n\nA link to the pip package you installed:\n\n\nThe output from python -c \"import tensorflow; print(tensorflow.__version__)\".\n0.12.1\nIf installed from source, provide\n\n\nThe commit hash (git rev-parse HEAD)\n\n\nThe output of bazel version\n\n\nIf possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\nWhat other attempted solutions have you tried?\nLogs or other output that would be helpful\n(If logs are large, please upload as attachment or provide link).\nI'm getting a strange error when trying to compute the intersection over union using tensorflows tf.contrib.metrics.streaming_mean_iou.\nThis was the code I was using before which works perfectly fine\nimport tensorflow as tf\nlabel = tf.image.decode_png(tf.read_file('/path/to/label.png'),channels=1)\nlabel_lin = tf.reshape(label, [-1,])\nweights = tf.cast(tf.less_equal(label_lin, 10), tf.int32)\nmIoU, update_op = tf.contrib.metrics.streaming_mean_iou(label_lin, label_lin,num_classes = 11,weights = weights)\ninit = tf.local_variables_initializer()\nsess.run(init)\nsess.run([update_op])\n\nHowever when I use a mask like this\nmask = tf.image.decode_png(tf.read_file('/path/to/mask_file.png'),channels=1)\nmask_lin = tf.reshape(mask, [-1,])\nmask_lin = tf.cast(mask_lin,tf.int32)\nmIoU, update_op = tf.contrib.metrics.streaming_mean_iou(label_lin, label_lin,num_classes = 11,weights = mask_lin)\ninit = tf.local_variables_initializer()\nsess.run(init)\nsess.run([update_op])\n\nIt keeps on failing after an irregular number of iterations showing this error:\n*** Error in /usr/bin/python': corrupted double-linked list: 0x00007f29d0022fd0 ***`\nI checked the shape and data type of both mask_lin and  weights. They are the same, so I cannot really see what is going wrong here.\nAlso the fact that the error comes after calling update_op an irregular number of times is strange. Maybe TF empties the mask_lin object after calling several sess.run()'s ?\nOr is this some TF bug? But then again why would it work with weights...", "body": "### What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\r\n\r\n### Environment info\r\nOperating System: Ubuntu 14.04\r\n\r\nInstalled version of CUDA and cuDNN: \r\n(please attach the output of `ls -l /path/to/cuda/lib/libcud*`):\r\n```\r\nls -l /usr/local/cuda-8.0/lib/libcud*\r\n-rw-r--r-- 1 root root   560184 Sep  5  2016 /usr/local/cuda-8.0/lib/libcudadevrt.a\r\nlrwxrwxrwx 1 root root       16 Sep  5  2016 /usr/local/cuda-8.0/lib/libcudart.so -> libcudart.so.8.0\r\nlrwxrwxrwx 1 root root       19 Sep  5  2016 /usr/local/cuda-8.0/lib/libcudart.so.8.0 -> libcudart.so.8.0.27\r\n-rwxr-xr-x 1 root root   394472 Sep  5  2016 /usr/local/cuda-8.0/lib/libcudart.so.8.0.27\r\n-rw-r--r-- 1 root root   737516 Sep  5  2016 /usr/local/cuda-8.0/lib/libcudart_static.a\r\nlrwxrwxrwx 1 root root       13 Jan 17 13:52 /usr/local/cuda-8.0/lib/libcudnn.so -> libcudnn.so.5\r\n-rwxr-xr-x 1 root root 61453024 Nov 13 12:10 /usr/local/cuda-8.0/lib/libcudnn.so.4\r\n-rwxr-xr-x 1 root root 61453024 Nov 13 12:10 /usr/local/cuda-8.0/lib/libcudnn.so.4.0.7\r\nlrwxrwxrwx 1 root root       17 Jan 17 13:52 /usr/local/cuda-8.0/lib/libcudnn.so.5 -> libcudnn.so.5.1.5\r\n-rwxr-xr-x 1 root root 78065952 Jan 12 11:03 /usr/local/cuda-8.0/lib/libcudnn.so.5.0.5\r\n-rwxr-xr-x 1 root root 79337624 Jan 17 13:52 /usr/local/cuda-8.0/lib/libcudnn.so.5.1.5\r\n-rw-r--r-- 1 root root 69756172 Jan 17 13:52 /usr/local/cuda-8.0/lib/libcudnn_static.a\r\n```\r\n\r\nIf installed from binary pip package, provide:\r\n\r\n1. A link to the pip package you installed:\r\n2. The output from `python -c \"import tensorflow; print(tensorflow.__version__)\"`.\r\n`0.12.1`\r\nIf installed from source, provide \r\n\r\n1. The commit hash (`git rev-parse HEAD`)\r\n2. The output of `bazel version`\r\n\r\n### If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\r\n\r\n\r\n### What other attempted solutions have you tried?\r\n\r\n\r\n### Logs or other output that would be helpful\r\n(If logs are large, please upload as attachment or provide link).\r\n\r\n\r\nI'm getting a strange error when trying to compute the intersection over union using tensorflows tf.contrib.metrics.streaming_mean_iou.\r\nThis was the code I was using before which works perfectly fine\r\n\r\n```\r\nimport tensorflow as tf\r\nlabel = tf.image.decode_png(tf.read_file('/path/to/label.png'),channels=1)\r\nlabel_lin = tf.reshape(label, [-1,])\r\nweights = tf.cast(tf.less_equal(label_lin, 10), tf.int32)\r\nmIoU, update_op = tf.contrib.metrics.streaming_mean_iou(label_lin, label_lin,num_classes = 11,weights = weights)\r\ninit = tf.local_variables_initializer()\r\nsess.run(init)\r\nsess.run([update_op])\r\n```\r\nHowever when I use a mask like this\r\n\r\n```\r\nmask = tf.image.decode_png(tf.read_file('/path/to/mask_file.png'),channels=1)\r\nmask_lin = tf.reshape(mask, [-1,])\r\nmask_lin = tf.cast(mask_lin,tf.int32)\r\nmIoU, update_op = tf.contrib.metrics.streaming_mean_iou(label_lin, label_lin,num_classes = 11,weights = mask_lin)\r\ninit = tf.local_variables_initializer()\r\nsess.run(init)\r\nsess.run([update_op])\r\n```\r\nIt keeps on failing after an irregular number of iterations showing this error:\r\n\r\n`*** Error in `/usr/bin/python': corrupted double-linked list: 0x00007f29d0022fd0 ***`\r\n\r\nI checked the shape and data type of both mask_lin and  weights. They are the same, so I cannot really see what is going wrong here.\r\nAlso the fact that the error comes after calling update_op an irregular number of times is strange. Maybe TF empties the mask_lin object after calling several sess.run()'s ?\r\nOr is this some TF bug? But then again why would it work with weights..."}