{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/333152165", "html_url": "https://github.com/tensorflow/tensorflow/issues/13376#issuecomment-333152165", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13376", "id": 333152165, "node_id": "MDEyOklzc3VlQ29tbWVudDMzMzE1MjE2NQ==", "user": {"login": "yaroslavvb", "id": 23068, "node_id": "MDQ6VXNlcjIzMDY4", "avatar_url": "https://avatars3.githubusercontent.com/u/23068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yaroslavvb", "html_url": "https://github.com/yaroslavvb", "followers_url": "https://api.github.com/users/yaroslavvb/followers", "following_url": "https://api.github.com/users/yaroslavvb/following{/other_user}", "gists_url": "https://api.github.com/users/yaroslavvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/yaroslavvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yaroslavvb/subscriptions", "organizations_url": "https://api.github.com/users/yaroslavvb/orgs", "repos_url": "https://api.github.com/users/yaroslavvb/repos", "events_url": "https://api.github.com/users/yaroslavvb/events{/privacy}", "received_events_url": "https://api.github.com/users/yaroslavvb/received_events", "type": "User", "site_admin": false}, "created_at": "2017-09-29T15:05:59Z", "updated_at": "2017-09-30T00:49:58Z", "author_association": "CONTRIBUTOR", "body_html": "<p>A few problems in your code -- your GPU matmul and CPU matmul are measuring the same thing, your V_cpu computation also includes an SVD. You are saying the problem is with matmul but the benchmark computation includes a bunch of other things like tf.conj. It's easy to get bad performance due to other reasons like type conversions/unexpected device transfers, so if the claim is a bug in TensorFlow, it's best to make example as simple as possible.</p>\n<p>Also, it's unlikely to find a significant problem with matmul in TF -- unlike SVD, matmul is a core part of any neural net, so it's been tested/tuned for a while at google.</p>\n<p>Just leaving N,N matmuls you'll get different numbers in your code. TF CPU version might be a little slower because the timing includes the time to generate new random matrix.</p>\n<pre><code>numpy default .dot product min:    35.85, median:    45.71, mean:    54.80\nTF CPU matmul        min:    38.19, median:    51.00, mean:    49.19\nTF GPU matmul        min:     5.75, median:     5.78, mean:    65.49\n</code></pre>\n<p>Here's an isolated matmul benchmark. You get at least 11x performance speed-up on GPU using optimal settings: <a href=\"https://github.com/yaroslavvb/stuff/blob/master/matmul_benchmark.py\">https://github.com/yaroslavvb/stuff/blob/master/matmul_benchmark.py</a></p>", "body_text": "A few problems in your code -- your GPU matmul and CPU matmul are measuring the same thing, your V_cpu computation also includes an SVD. You are saying the problem is with matmul but the benchmark computation includes a bunch of other things like tf.conj. It's easy to get bad performance due to other reasons like type conversions/unexpected device transfers, so if the claim is a bug in TensorFlow, it's best to make example as simple as possible.\nAlso, it's unlikely to find a significant problem with matmul in TF -- unlike SVD, matmul is a core part of any neural net, so it's been tested/tuned for a while at google.\nJust leaving N,N matmuls you'll get different numbers in your code. TF CPU version might be a little slower because the timing includes the time to generate new random matrix.\nnumpy default .dot product min:    35.85, median:    45.71, mean:    54.80\nTF CPU matmul        min:    38.19, median:    51.00, mean:    49.19\nTF GPU matmul        min:     5.75, median:     5.78, mean:    65.49\n\nHere's an isolated matmul benchmark. You get at least 11x performance speed-up on GPU using optimal settings: https://github.com/yaroslavvb/stuff/blob/master/matmul_benchmark.py", "body": "A few problems in your code -- your GPU matmul and CPU matmul are measuring the same thing, your V_cpu computation also includes an SVD. You are saying the problem is with matmul but the benchmark computation includes a bunch of other things like tf.conj. It's easy to get bad performance due to other reasons like type conversions/unexpected device transfers, so if the claim is a bug in TensorFlow, it's best to make example as simple as possible.\r\n\r\nAlso, it's unlikely to find a significant problem with matmul in TF -- unlike SVD, matmul is a core part of any neural net, so it's been tested/tuned for a while at google.\r\n\r\nJust leaving N,N matmuls you'll get different numbers in your code. TF CPU version might be a little slower because the timing includes the time to generate new random matrix. \r\n\r\n```\r\nnumpy default .dot product min:    35.85, median:    45.71, mean:    54.80\r\nTF CPU matmul        min:    38.19, median:    51.00, mean:    49.19\r\nTF GPU matmul        min:     5.75, median:     5.78, mean:    65.49\r\n```\r\n\r\nHere's an isolated matmul benchmark. You get at least 11x performance speed-up on GPU using optimal settings: https://github.com/yaroslavvb/stuff/blob/master/matmul_benchmark.py"}