{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/92773801", "pull_request_review_id": 13294222, "id": 92773801, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDkyNzczODAx", "diff_hunk": "@@ -395,6 +395,13 @@ def _AvgPoolGrad(op, grad):\n       data_format=op.get_attr(\"data_format\"))\n \n \n+@ops.RegisterGradient(\"AvgPoolGrad\")\n+def _AvgPoolGradGrad(op, grad):\n+  print(op)", "path": "tensorflow/python/ops/nn_grad.py", "position": 6, "original_position": 6, "commit_id": "9f26b9b28b6c676fddc3cbbd201616e4188c88ce", "original_commit_id": "9f26b9b28b6c676fddc3cbbd201616e4188c88ce", "user": {"login": "AnishShah", "id": 3175743, "node_id": "MDQ6VXNlcjMxNzU3NDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/3175743?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AnishShah", "html_url": "https://github.com/AnishShah", "followers_url": "https://api.github.com/users/AnishShah/followers", "following_url": "https://api.github.com/users/AnishShah/following{/other_user}", "gists_url": "https://api.github.com/users/AnishShah/gists{/gist_id}", "starred_url": "https://api.github.com/users/AnishShah/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AnishShah/subscriptions", "organizations_url": "https://api.github.com/users/AnishShah/orgs", "repos_url": "https://api.github.com/users/AnishShah/repos", "events_url": "https://api.github.com/users/AnishShah/events{/privacy}", "received_events_url": "https://api.github.com/users/AnishShah/received_events", "type": "User", "site_admin": false}, "body": "@vrv For gradient of gradient of avg_pool, the inputs are : `gradients/AvgPool_grad/Shape` and `gradients/Fill`. There's no `x` in the input. Is this wrong?\r\n\r\n```\r\nIn [2]: x = tf.constant(np.random.RandomState(1).rand(1, 4, 4, 1).astype(np.float32), name=\"x\")\r\n\r\nIn [3]: y = tf.nn.avg_pool(x, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], padding='VALID')\r\n\r\nIn [4]: dy = tf.gradients(y, x)\r\n\r\nIn [5]: ddy = tf.gradients(dy, x)\r\nname: \"gradients/AvgPool_grad/AvgPoolGrad\"\r\nop: \"AvgPoolGrad\"\r\ninput: \"gradients/AvgPool_grad/Shape\"\r\ninput: \"gradients/Fill\"\r\nattr {\r\n  key: \"T\"\r\n  value {\r\n    type: DT_FLOAT\r\n  }\r\n}\r\nattr {\r\n  key: \"data_format\"\r\n  value {\r\n    s: \"NHWC\"\r\n  }\r\n}\r\nattr {\r\n  key: \"ksize\"\r\n  value {\r\n    list {\r\n      i: 1\r\n      i: 2\r\n      i: 2\r\n      i: 1\r\n    }\r\n  }\r\n}\r\nattr {\r\n  key: \"padding\"\r\n  value {\r\n    s: \"VALID\"\r\n  }\r\n}\r\nattr {\r\n  key: \"strides\"\r\n  value {\r\n    list {\r\n      i: 1\r\n      i: 2\r\n      i: 2\r\n      i: 1\r\n    }\r\n  }\r\n}\r\n```", "created_at": "2016-12-16T08:59:05Z", "updated_at": "2016-12-16T08:59:38Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/6299#discussion_r92773801", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/6299", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/92773801"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/6299#discussion_r92773801"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/6299"}}, "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=463737\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/vrv\">@vrv</a> For gradient of gradient of avg_pool, the inputs are : <code>gradients/AvgPool_grad/Shape</code> and <code>gradients/Fill</code>. There's no <code>x</code> in the input. Is this wrong?</p>\n<pre><code>In [2]: x = tf.constant(np.random.RandomState(1).rand(1, 4, 4, 1).astype(np.float32), name=\"x\")\n\nIn [3]: y = tf.nn.avg_pool(x, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], padding='VALID')\n\nIn [4]: dy = tf.gradients(y, x)\n\nIn [5]: ddy = tf.gradients(dy, x)\nname: \"gradients/AvgPool_grad/AvgPoolGrad\"\nop: \"AvgPoolGrad\"\ninput: \"gradients/AvgPool_grad/Shape\"\ninput: \"gradients/Fill\"\nattr {\n  key: \"T\"\n  value {\n    type: DT_FLOAT\n  }\n}\nattr {\n  key: \"data_format\"\n  value {\n    s: \"NHWC\"\n  }\n}\nattr {\n  key: \"ksize\"\n  value {\n    list {\n      i: 1\n      i: 2\n      i: 2\n      i: 1\n    }\n  }\n}\nattr {\n  key: \"padding\"\n  value {\n    s: \"VALID\"\n  }\n}\nattr {\n  key: \"strides\"\n  value {\n    list {\n      i: 1\n      i: 2\n      i: 2\n      i: 1\n    }\n  }\n}\n</code></pre>", "body_text": "@vrv For gradient of gradient of avg_pool, the inputs are : gradients/AvgPool_grad/Shape and gradients/Fill. There's no x in the input. Is this wrong?\nIn [2]: x = tf.constant(np.random.RandomState(1).rand(1, 4, 4, 1).astype(np.float32), name=\"x\")\n\nIn [3]: y = tf.nn.avg_pool(x, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], padding='VALID')\n\nIn [4]: dy = tf.gradients(y, x)\n\nIn [5]: ddy = tf.gradients(dy, x)\nname: \"gradients/AvgPool_grad/AvgPoolGrad\"\nop: \"AvgPoolGrad\"\ninput: \"gradients/AvgPool_grad/Shape\"\ninput: \"gradients/Fill\"\nattr {\n  key: \"T\"\n  value {\n    type: DT_FLOAT\n  }\n}\nattr {\n  key: \"data_format\"\n  value {\n    s: \"NHWC\"\n  }\n}\nattr {\n  key: \"ksize\"\n  value {\n    list {\n      i: 1\n      i: 2\n      i: 2\n      i: 1\n    }\n  }\n}\nattr {\n  key: \"padding\"\n  value {\n    s: \"VALID\"\n  }\n}\nattr {\n  key: \"strides\"\n  value {\n    list {\n      i: 1\n      i: 2\n      i: 2\n      i: 1\n    }\n  }\n}"}