{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3726", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3726/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3726/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3726/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/3726", "id": 170360804, "node_id": "MDU6SXNzdWUxNzAzNjA4MDQ=", "number": 3726, "title": "nested scan functions break in gradient calculation, bug?", "user": {"login": "HeikoSchuett", "id": 13691026, "node_id": "MDQ6VXNlcjEzNjkxMDI2", "avatar_url": "https://avatars3.githubusercontent.com/u/13691026?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HeikoSchuett", "html_url": "https://github.com/HeikoSchuett", "followers_url": "https://api.github.com/users/HeikoSchuett/followers", "following_url": "https://api.github.com/users/HeikoSchuett/following{/other_user}", "gists_url": "https://api.github.com/users/HeikoSchuett/gists{/gist_id}", "starred_url": "https://api.github.com/users/HeikoSchuett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HeikoSchuett/subscriptions", "organizations_url": "https://api.github.com/users/HeikoSchuett/orgs", "repos_url": "https://api.github.com/users/HeikoSchuett/repos", "events_url": "https://api.github.com/users/HeikoSchuett/events{/privacy}", "received_events_url": "https://api.github.com/users/HeikoSchuett/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "yuanbyu", "id": 2342391, "node_id": "MDQ6VXNlcjIzNDIzOTE=", "avatar_url": "https://avatars1.githubusercontent.com/u/2342391?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuanbyu", "html_url": "https://github.com/yuanbyu", "followers_url": "https://api.github.com/users/yuanbyu/followers", "following_url": "https://api.github.com/users/yuanbyu/following{/other_user}", "gists_url": "https://api.github.com/users/yuanbyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuanbyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuanbyu/subscriptions", "organizations_url": "https://api.github.com/users/yuanbyu/orgs", "repos_url": "https://api.github.com/users/yuanbyu/repos", "events_url": "https://api.github.com/users/yuanbyu/events{/privacy}", "received_events_url": "https://api.github.com/users/yuanbyu/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "yuanbyu", "id": 2342391, "node_id": "MDQ6VXNlcjIzNDIzOTE=", "avatar_url": "https://avatars1.githubusercontent.com/u/2342391?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuanbyu", "html_url": "https://github.com/yuanbyu", "followers_url": "https://api.github.com/users/yuanbyu/followers", "following_url": "https://api.github.com/users/yuanbyu/following{/other_user}", "gists_url": "https://api.github.com/users/yuanbyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuanbyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuanbyu/subscriptions", "organizations_url": "https://api.github.com/users/yuanbyu/orgs", "repos_url": "https://api.github.com/users/yuanbyu/repos", "events_url": "https://api.github.com/users/yuanbyu/events{/privacy}", "received_events_url": "https://api.github.com/users/yuanbyu/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2016-08-10T08:29:14Z", "updated_at": "2017-03-09T18:23:41Z", "closed_at": "2017-03-09T18:23:41Z", "author_association": "NONE", "body_html": "<p>I tried to produce some code to read out the values at multiple locations from a vector of results. To do this I used two nested scan functions to go through the batches and the vector of the multiple locations.<br>\nThis function correctly calculates the values when used alone, but when I want to calculate gradients, the code breaks at initialisation of the variables in the session with a error message I do not feel responsible for.</p>\n<h2>Environment info</h2>\n<p>Operating System: iOS 10.11.5</p>\n<p>Installed version of CUDA and cuDNN:<br>\n(please attach the output of <code>ls -l /path/to/cuda/lib/libcud*</code>):<br>\n-rwxr-xr-x  1 root  wheel  8280 Aug  9 18:11 /usr/local/cuda/lib/libcuda.1.dylib<br>\n-rwxr-xr-x  1 root  wheel  8280 Apr 13 08:02 /usr/local/cuda/lib/libcuda.dylib<br>\nlrwxr-xr-x  1 root  wheel    45 Apr 13 08:03 /usr/local/cuda/lib/libcudadevrt.a -&gt; /Developer/NVIDIA/CUDA-7.5/lib/libcudadevrt.a<br>\nlrwxr-xr-x  1 root  wheel    50 Apr 13 08:03 /usr/local/cuda/lib/libcudart.7.5.dylib -&gt; /Developer/NVIDIA/CUDA-7.5/lib/libcudart.7.5.dylib<br>\nlrwxr-xr-x  1 root  wheel    46 Apr 13 08:03 /usr/local/cuda/lib/libcudart.dylib -&gt; /Developer/NVIDIA/CUDA-7.5/lib/libcudart.dylib<br>\nlrwxr-xr-x  1 root  wheel    49 Apr 13 08:03 /usr/local/cuda/lib/libcudart_static.a -&gt; /Developer/NVIDIA/CUDA-7.5/lib/libcudart_static.a<br>\nlrwxr-xr-x  1 root  wheel    47 Aug  9 18:38 /usr/local/cuda/lib/libcudnn.5.dylib -&gt; /Developer/NVIDIA/CUDA-7.5/lib/libcudnn.5.dylib<br>\nlrwxr-xr-x  1 root  wheel    45 Aug  9 18:38 /usr/local/cuda/lib/libcudnn.dylib -&gt; /Developer/NVIDIA/CUDA-7.5/lib/libcudnn.dylib<br>\nlrwxr-xr-x  1 root  wheel    48 Aug  9 18:38 /usr/local/cuda/lib/libcudnn_static.a -&gt; /Developer/NVIDIA/CUDA-7.5/lib/libcudnn_static.a</p>\n<p>If installed from source, provide</p>\n<ol>\n<li>The output from <code>python -c \"import tensorflow; print(tensorflow.__version__)\"</code>.<br>\n'0.10.0rc0'</li>\n<li>The commit hash (<code>git rev-parse HEAD</code>)<br>\n<a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/056db850614e0a06ce6f65b30f877c5789ab74f5/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/056db850614e0a06ce6f65b30f877c5789ab74f5\"><tt>056db85</tt></a></li>\n<li>The output of <code>bazel version</code><br>\nBuild label: 0.3.1-homebrew<br>\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar<br>\nBuild time: Thu Aug 4 09:58:27 2016 (1470304707)<br>\nBuild timestamp: 1470304707<br>\nBuild timestamp as int: 1470304707</li>\n</ol>\n<h2>Steps to reproduce</h2>\n<ol>\n<li>run code</li>\n</ol>\n<pre><code>import tensorflow as tf\nimport numpy \n\ndef saliency_loss(y_true, y_pred):\n    def saliency_loss_1(oldL,y):\n        select = tf.slice(tf.squeeze(y),[5],[-1])\n        def subindex(old,select1):\n            return tf.slice(y,tf.reshape(tf.cast(select1,dtype='int32'),(1,)),tf.reshape(tf.constant(1),(1,))) \n        prob = tf.scan(subindex,select,initializer = tf.reshape(tf.constant(0.0),(1,)))\n        return -tf.reshape(tf.reduce_sum(tf.log(prob)),(1,))\n    y = tf.concat(1,(y_pred,y_true),name = 'y')\n    L = tf.scan(saliency_loss_1,y,initializer = tf.reshape(tf.constant(0.0),(1,)))\n    return tf.reduce_mean(L)\n\ny_true = tf.Variable([[0.0,0.0,0.0],[1.0,4.0,1.0],[0.0,0.0,0.0],[1.0,4.0,1.0]])\ny_pred = tf.Variable([[1.0,2.0,3.0,4.0,5.0],[11.0,12.0,13.0,14.0,15.0],[1.0,2.0,3.0,4.0,5.0],[11.0,12.0,13.0,14.0,15.0]])\ny = tf.concat(1,(y_pred,y_true),name = 'y')\nprint(-(numpy.log(12.0)+numpy.log(15.0)+numpy.log(12.0))/2.0)\n\n\nwith tf.Session() as sess:\n    sess.run(tf.initialize_all_variables())\n    print(sess.run(saliency_loss(y_true, y_pred)))\n\nloss = saliency_loss(y_true, y_pred)\ngrad = tf.gradients(loss,y_pred)\n\nprint(grad)\n\nwith tf.Session() as sess:\n    sess.run(tf.initialize_all_variables())\n    #print(sess.run(grad))\n\n</code></pre>\n<h2>What have you tried?</h2>\n<ol>\n<li>all orders of initialisation and running only gradient calculation</li>\n</ol>\n<h2>Logs or other output that would be helpful</h2>\n<h3>Errortrace:</h3>\n<hr>\n<p>InvalidArgumentError                      Traceback (most recent call last)<br>\n/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, _args)<br>\n964     try:<br>\n--&gt; 965       return fn(_args)<br>\n966     except errors.OpError as e:</p>\n<p>/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run_fn(session, feed_dict, fetch_list, target_list, options, run_metadata)<br>\n946                                  feed_dict, fetch_list, target_list,<br>\n--&gt; 947                                  status, run_metadata)<br>\n948</p>\n<p>/Users/heiko/anaconda/lib/python3.5/contextlib.py in <strong>exit</strong>(self, type, value, traceback)<br>\n65             try:<br>\n---&gt; 66                 next(self.gen)<br>\n67             except StopIteration:</p>\n<p>/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/framework/errors.py in raise_exception_on_not_ok_status()<br>\n449           compat.as_text(pywrap_tensorflow.TF_Message(status)),<br>\n--&gt; 450           pywrap_tensorflow.TF_GetCode(status))<br>\n451   finally:</p>\n<p>InvalidArgumentError: Input 0 of node gradients/scan_1/while/scan/TensorArrayPack_grad/TensorArrayGrad/TensorArrayGrad was passed string from gradients/scan_1/while/scan/TensorArrayPack_grad/TensorArrayGrad/TensorArrayGrad/StackPop:0 incompatible with expected string_ref.</p>\n<p>During handling of the above exception, another exception occurred:</p>\n<p>InvalidArgumentError                      Traceback (most recent call last)<br>\n in ()<br>\n29<br>\n30 with tf.Session() as sess:<br>\n---&gt; 31     sess.run(tf.initialize_all_variables())<br>\n32     #print(sess.run(grad))</p>\n<p>/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/client/session.py in run(self, fetches, feed_dict, options, run_metadata)<br>\n708     try:<br>\n709       result = self._run(None, fetches, feed_dict, options_ptr,<br>\n--&gt; 710                          run_metadata_ptr)<br>\n711       if run_metadata:<br>\n712         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)</p>\n<p>/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run(self, handle, fetches, feed_dict, options, run_metadata)<br>\n906     if final_fetches or final_targets:<br>\n907       results = self._do_run(handle, final_targets, final_fetches,<br>\n--&gt; 908                              feed_dict_string, options, run_metadata)<br>\n909     else:<br>\n910       results = []</p>\n<p>/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)<br>\n956     if handle is None:<br>\n957       return self._do_call(_run_fn, self._session, feed_dict, fetch_list,<br>\n--&gt; 958                            target_list, options, run_metadata)<br>\n959     else:<br>\n960       return self._do_call(_prun_fn, self._session, handle, feed_dict,</p>\n<p>/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)<br>\n976         except KeyError:<br>\n977           pass<br>\n--&gt; 978       raise type(e)(node_def, op, message)<br>\n979<br>\n980   def _extend_graph(self):</p>\n<p>InvalidArgumentError: Input 0 of node gradients/scan_1/while/scan/TensorArrayPack_grad/TensorArrayGrad/TensorArrayGrad was passed string from gradients/scan_1/while/scan/TensorArrayPack_grad/TensorArrayGrad/TensorArrayGrad/StackPop:0 incompatible with expected string_ref.</p>", "body_text": "I tried to produce some code to read out the values at multiple locations from a vector of results. To do this I used two nested scan functions to go through the batches and the vector of the multiple locations.\nThis function correctly calculates the values when used alone, but when I want to calculate gradients, the code breaks at initialisation of the variables in the session with a error message I do not feel responsible for.\nEnvironment info\nOperating System: iOS 10.11.5\nInstalled version of CUDA and cuDNN:\n(please attach the output of ls -l /path/to/cuda/lib/libcud*):\n-rwxr-xr-x  1 root  wheel  8280 Aug  9 18:11 /usr/local/cuda/lib/libcuda.1.dylib\n-rwxr-xr-x  1 root  wheel  8280 Apr 13 08:02 /usr/local/cuda/lib/libcuda.dylib\nlrwxr-xr-x  1 root  wheel    45 Apr 13 08:03 /usr/local/cuda/lib/libcudadevrt.a -> /Developer/NVIDIA/CUDA-7.5/lib/libcudadevrt.a\nlrwxr-xr-x  1 root  wheel    50 Apr 13 08:03 /usr/local/cuda/lib/libcudart.7.5.dylib -> /Developer/NVIDIA/CUDA-7.5/lib/libcudart.7.5.dylib\nlrwxr-xr-x  1 root  wheel    46 Apr 13 08:03 /usr/local/cuda/lib/libcudart.dylib -> /Developer/NVIDIA/CUDA-7.5/lib/libcudart.dylib\nlrwxr-xr-x  1 root  wheel    49 Apr 13 08:03 /usr/local/cuda/lib/libcudart_static.a -> /Developer/NVIDIA/CUDA-7.5/lib/libcudart_static.a\nlrwxr-xr-x  1 root  wheel    47 Aug  9 18:38 /usr/local/cuda/lib/libcudnn.5.dylib -> /Developer/NVIDIA/CUDA-7.5/lib/libcudnn.5.dylib\nlrwxr-xr-x  1 root  wheel    45 Aug  9 18:38 /usr/local/cuda/lib/libcudnn.dylib -> /Developer/NVIDIA/CUDA-7.5/lib/libcudnn.dylib\nlrwxr-xr-x  1 root  wheel    48 Aug  9 18:38 /usr/local/cuda/lib/libcudnn_static.a -> /Developer/NVIDIA/CUDA-7.5/lib/libcudnn_static.a\nIf installed from source, provide\n\nThe output from python -c \"import tensorflow; print(tensorflow.__version__)\".\n'0.10.0rc0'\nThe commit hash (git rev-parse HEAD)\n056db85\nThe output of bazel version\nBuild label: 0.3.1-homebrew\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Thu Aug 4 09:58:27 2016 (1470304707)\nBuild timestamp: 1470304707\nBuild timestamp as int: 1470304707\n\nSteps to reproduce\n\nrun code\n\nimport tensorflow as tf\nimport numpy \n\ndef saliency_loss(y_true, y_pred):\n    def saliency_loss_1(oldL,y):\n        select = tf.slice(tf.squeeze(y),[5],[-1])\n        def subindex(old,select1):\n            return tf.slice(y,tf.reshape(tf.cast(select1,dtype='int32'),(1,)),tf.reshape(tf.constant(1),(1,))) \n        prob = tf.scan(subindex,select,initializer = tf.reshape(tf.constant(0.0),(1,)))\n        return -tf.reshape(tf.reduce_sum(tf.log(prob)),(1,))\n    y = tf.concat(1,(y_pred,y_true),name = 'y')\n    L = tf.scan(saliency_loss_1,y,initializer = tf.reshape(tf.constant(0.0),(1,)))\n    return tf.reduce_mean(L)\n\ny_true = tf.Variable([[0.0,0.0,0.0],[1.0,4.0,1.0],[0.0,0.0,0.0],[1.0,4.0,1.0]])\ny_pred = tf.Variable([[1.0,2.0,3.0,4.0,5.0],[11.0,12.0,13.0,14.0,15.0],[1.0,2.0,3.0,4.0,5.0],[11.0,12.0,13.0,14.0,15.0]])\ny = tf.concat(1,(y_pred,y_true),name = 'y')\nprint(-(numpy.log(12.0)+numpy.log(15.0)+numpy.log(12.0))/2.0)\n\n\nwith tf.Session() as sess:\n    sess.run(tf.initialize_all_variables())\n    print(sess.run(saliency_loss(y_true, y_pred)))\n\nloss = saliency_loss(y_true, y_pred)\ngrad = tf.gradients(loss,y_pred)\n\nprint(grad)\n\nwith tf.Session() as sess:\n    sess.run(tf.initialize_all_variables())\n    #print(sess.run(grad))\n\n\nWhat have you tried?\n\nall orders of initialisation and running only gradient calculation\n\nLogs or other output that would be helpful\nErrortrace:\n\nInvalidArgumentError                      Traceback (most recent call last)\n/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, _args)\n964     try:\n--> 965       return fn(_args)\n966     except errors.OpError as e:\n/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run_fn(session, feed_dict, fetch_list, target_list, options, run_metadata)\n946                                  feed_dict, fetch_list, target_list,\n--> 947                                  status, run_metadata)\n948\n/Users/heiko/anaconda/lib/python3.5/contextlib.py in exit(self, type, value, traceback)\n65             try:\n---> 66                 next(self.gen)\n67             except StopIteration:\n/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/framework/errors.py in raise_exception_on_not_ok_status()\n449           compat.as_text(pywrap_tensorflow.TF_Message(status)),\n--> 450           pywrap_tensorflow.TF_GetCode(status))\n451   finally:\nInvalidArgumentError: Input 0 of node gradients/scan_1/while/scan/TensorArrayPack_grad/TensorArrayGrad/TensorArrayGrad was passed string from gradients/scan_1/while/scan/TensorArrayPack_grad/TensorArrayGrad/TensorArrayGrad/StackPop:0 incompatible with expected string_ref.\nDuring handling of the above exception, another exception occurred:\nInvalidArgumentError                      Traceback (most recent call last)\n in ()\n29\n30 with tf.Session() as sess:\n---> 31     sess.run(tf.initialize_all_variables())\n32     #print(sess.run(grad))\n/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/client/session.py in run(self, fetches, feed_dict, options, run_metadata)\n708     try:\n709       result = self._run(None, fetches, feed_dict, options_ptr,\n--> 710                          run_metadata_ptr)\n711       if run_metadata:\n712         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)\n/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run(self, handle, fetches, feed_dict, options, run_metadata)\n906     if final_fetches or final_targets:\n907       results = self._do_run(handle, final_targets, final_fetches,\n--> 908                              feed_dict_string, options, run_metadata)\n909     else:\n910       results = []\n/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)\n956     if handle is None:\n957       return self._do_call(_run_fn, self._session, feed_dict, fetch_list,\n--> 958                            target_list, options, run_metadata)\n959     else:\n960       return self._do_call(_prun_fn, self._session, handle, feed_dict,\n/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\n976         except KeyError:\n977           pass\n--> 978       raise type(e)(node_def, op, message)\n979\n980   def _extend_graph(self):\nInvalidArgumentError: Input 0 of node gradients/scan_1/while/scan/TensorArrayPack_grad/TensorArrayGrad/TensorArrayGrad was passed string from gradients/scan_1/while/scan/TensorArrayPack_grad/TensorArrayGrad/TensorArrayGrad/StackPop:0 incompatible with expected string_ref.", "body": "I tried to produce some code to read out the values at multiple locations from a vector of results. To do this I used two nested scan functions to go through the batches and the vector of the multiple locations. \nThis function correctly calculates the values when used alone, but when I want to calculate gradients, the code breaks at initialisation of the variables in the session with a error message I do not feel responsible for.\n## Environment info\n\nOperating System: iOS 10.11.5 \n\nInstalled version of CUDA and cuDNN: \n(please attach the output of `ls -l /path/to/cuda/lib/libcud*`):\n-rwxr-xr-x  1 root  wheel  8280 Aug  9 18:11 /usr/local/cuda/lib/libcuda.1.dylib\n-rwxr-xr-x  1 root  wheel  8280 Apr 13 08:02 /usr/local/cuda/lib/libcuda.dylib\nlrwxr-xr-x  1 root  wheel    45 Apr 13 08:03 /usr/local/cuda/lib/libcudadevrt.a -> /Developer/NVIDIA/CUDA-7.5/lib/libcudadevrt.a\nlrwxr-xr-x  1 root  wheel    50 Apr 13 08:03 /usr/local/cuda/lib/libcudart.7.5.dylib -> /Developer/NVIDIA/CUDA-7.5/lib/libcudart.7.5.dylib\nlrwxr-xr-x  1 root  wheel    46 Apr 13 08:03 /usr/local/cuda/lib/libcudart.dylib -> /Developer/NVIDIA/CUDA-7.5/lib/libcudart.dylib\nlrwxr-xr-x  1 root  wheel    49 Apr 13 08:03 /usr/local/cuda/lib/libcudart_static.a -> /Developer/NVIDIA/CUDA-7.5/lib/libcudart_static.a\nlrwxr-xr-x  1 root  wheel    47 Aug  9 18:38 /usr/local/cuda/lib/libcudnn.5.dylib -> /Developer/NVIDIA/CUDA-7.5/lib/libcudnn.5.dylib\nlrwxr-xr-x  1 root  wheel    45 Aug  9 18:38 /usr/local/cuda/lib/libcudnn.dylib -> /Developer/NVIDIA/CUDA-7.5/lib/libcudnn.dylib\nlrwxr-xr-x  1 root  wheel    48 Aug  9 18:38 /usr/local/cuda/lib/libcudnn_static.a -> /Developer/NVIDIA/CUDA-7.5/lib/libcudnn_static.a\n\nIf installed from source, provide \n1. The output from `python -c \"import tensorflow; print(tensorflow.__version__)\"`.\n   '0.10.0rc0'\n2. The commit hash (`git rev-parse HEAD`)\n   056db850614e0a06ce6f65b30f877c5789ab74f5\n3. The output of `bazel version`\n   Build label: 0.3.1-homebrew\n   Build target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\n   Build time: Thu Aug 4 09:58:27 2016 (1470304707)\n   Build timestamp: 1470304707\n   Build timestamp as int: 1470304707\n## Steps to reproduce\n1. run code \n\n```\nimport tensorflow as tf\nimport numpy \n\ndef saliency_loss(y_true, y_pred):\n    def saliency_loss_1(oldL,y):\n        select = tf.slice(tf.squeeze(y),[5],[-1])\n        def subindex(old,select1):\n            return tf.slice(y,tf.reshape(tf.cast(select1,dtype='int32'),(1,)),tf.reshape(tf.constant(1),(1,))) \n        prob = tf.scan(subindex,select,initializer = tf.reshape(tf.constant(0.0),(1,)))\n        return -tf.reshape(tf.reduce_sum(tf.log(prob)),(1,))\n    y = tf.concat(1,(y_pred,y_true),name = 'y')\n    L = tf.scan(saliency_loss_1,y,initializer = tf.reshape(tf.constant(0.0),(1,)))\n    return tf.reduce_mean(L)\n\ny_true = tf.Variable([[0.0,0.0,0.0],[1.0,4.0,1.0],[0.0,0.0,0.0],[1.0,4.0,1.0]])\ny_pred = tf.Variable([[1.0,2.0,3.0,4.0,5.0],[11.0,12.0,13.0,14.0,15.0],[1.0,2.0,3.0,4.0,5.0],[11.0,12.0,13.0,14.0,15.0]])\ny = tf.concat(1,(y_pred,y_true),name = 'y')\nprint(-(numpy.log(12.0)+numpy.log(15.0)+numpy.log(12.0))/2.0)\n\n\nwith tf.Session() as sess:\n    sess.run(tf.initialize_all_variables())\n    print(sess.run(saliency_loss(y_true, y_pred)))\n\nloss = saliency_loss(y_true, y_pred)\ngrad = tf.gradients(loss,y_pred)\n\nprint(grad)\n\nwith tf.Session() as sess:\n    sess.run(tf.initialize_all_variables())\n    #print(sess.run(grad))\n\n```\n## What have you tried?\n1. all orders of initialisation and running only gradient calculation\n## Logs or other output that would be helpful\n### Errortrace:\n\n---\n\nInvalidArgumentError                      Traceback (most recent call last)\n/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, _args)\n    964     try:\n--> 965       return fn(_args)\n    966     except errors.OpError as e:\n\n/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run_fn(session, feed_dict, fetch_list, target_list, options, run_metadata)\n    946                                  feed_dict, fetch_list, target_list,\n--> 947                                  status, run_metadata)\n    948 \n\n/Users/heiko/anaconda/lib/python3.5/contextlib.py in **exit**(self, type, value, traceback)\n     65             try:\n---> 66                 next(self.gen)\n     67             except StopIteration:\n\n/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/framework/errors.py in raise_exception_on_not_ok_status()\n    449           compat.as_text(pywrap_tensorflow.TF_Message(status)),\n--> 450           pywrap_tensorflow.TF_GetCode(status))\n    451   finally:\n\nInvalidArgumentError: Input 0 of node gradients/scan_1/while/scan/TensorArrayPack_grad/TensorArrayGrad/TensorArrayGrad was passed string from gradients/scan_1/while/scan/TensorArrayPack_grad/TensorArrayGrad/TensorArrayGrad/StackPop:0 incompatible with expected string_ref.\n\nDuring handling of the above exception, another exception occurred:\n\nInvalidArgumentError                      Traceback (most recent call last)\n<ipython-input-1-d5cce368f52a> in <module>()\n     29 \n     30 with tf.Session() as sess:\n---> 31     sess.run(tf.initialize_all_variables())\n     32     #print(sess.run(grad))\n\n/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/client/session.py in run(self, fetches, feed_dict, options, run_metadata)\n    708     try:\n    709       result = self._run(None, fetches, feed_dict, options_ptr,\n--> 710                          run_metadata_ptr)\n    711       if run_metadata:\n    712         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)\n\n/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run(self, handle, fetches, feed_dict, options, run_metadata)\n    906     if final_fetches or final_targets:\n    907       results = self._do_run(handle, final_targets, final_fetches,\n--> 908                              feed_dict_string, options, run_metadata)\n    909     else:\n    910       results = []\n\n/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)\n    956     if handle is None:\n    957       return self._do_call(_run_fn, self._session, feed_dict, fetch_list,\n--> 958                            target_list, options, run_metadata)\n    959     else:\n    960       return self._do_call(_prun_fn, self._session, handle, feed_dict,\n\n/Users/heiko/anaconda/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\n    976         except KeyError:\n    977           pass\n--> 978       raise type(e)(node_def, op, message)\n    979 \n    980   def _extend_graph(self):\n\nInvalidArgumentError: Input 0 of node gradients/scan_1/while/scan/TensorArrayPack_grad/TensorArrayGrad/TensorArrayGrad was passed string from gradients/scan_1/while/scan/TensorArrayPack_grad/TensorArrayGrad/TensorArrayGrad/StackPop:0 incompatible with expected string_ref.\n"}