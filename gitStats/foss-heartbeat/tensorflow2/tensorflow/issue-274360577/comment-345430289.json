{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/345430289", "html_url": "https://github.com/tensorflow/tensorflow/issues/14601#issuecomment-345430289", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14601", "id": 345430289, "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTQzMDI4OQ==", "user": {"login": "facaiy", "id": 1112263, "node_id": "MDQ6VXNlcjExMTIyNjM=", "avatar_url": "https://avatars3.githubusercontent.com/u/1112263?v=4", "gravatar_id": "", "url": "https://api.github.com/users/facaiy", "html_url": "https://github.com/facaiy", "followers_url": "https://api.github.com/users/facaiy/followers", "following_url": "https://api.github.com/users/facaiy/following{/other_user}", "gists_url": "https://api.github.com/users/facaiy/gists{/gist_id}", "starred_url": "https://api.github.com/users/facaiy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/facaiy/subscriptions", "organizations_url": "https://api.github.com/users/facaiy/orgs", "repos_url": "https://api.github.com/users/facaiy/repos", "events_url": "https://api.github.com/users/facaiy/events{/privacy}", "received_events_url": "https://api.github.com/users/facaiy/received_events", "type": "User", "site_admin": false}, "created_at": "2017-11-18T09:29:28Z", "updated_at": "2017-11-18T09:29:28Z", "author_association": "MEMBER", "body_html": "<p>I believe that <code>max(0, pad)</code> works well, see:</p>\n<p><div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/69620e12bf3403a11a47b26006ebb22656a9f036/tensorflow/core/framework/common_shape_fns.cc#L42-L44\">tensorflow/tensorflow/core/framework/common_shape_fns.cc</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n        Lines 42 to 44\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/69620e12bf3403a11a47b26006ebb22656a9f036\">69620e1</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L42\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"42\"></td>\n          <td id=\"LC42\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-k\">const</span> int64 padding_needed = </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L43\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"43\"></td>\n          <td id=\"LC43\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">     <span class=\"pl-c1\">std::max</span>(<span class=\"pl-c1\">0LL</span>, (*output_size - <span class=\"pl-c1\">1</span>) * stride + effective_filter_size - </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L44\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"44\"></td>\n          <td id=\"LC44\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">                       input_size); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>\n<p>And I find the stride information isn't packed into <code>args</code> in <code>LaunchDeepConvOp</code>, perhaps the problem is here but I am still not sure about it:</p>\n<p><div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/69620e12bf3403a11a47b26006ebb22656a9f036/tensorflow/core/kernels/conv_ops.cc#L158-L169\">tensorflow/tensorflow/core/kernels/conv_ops.cc</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n        Lines 158 to 169\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/69620e12bf3403a11a47b26006ebb22656a9f036\">69620e1</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L158\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"158\"></td>\n          <td id=\"LC158\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> Conv2DArgs args; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L159\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"159\"></td>\n          <td id=\"LC159\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> args.<span class=\"pl-smi\">batch</span> = batch; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L160\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"160\"></td>\n          <td id=\"LC160\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> args.<span class=\"pl-smi\">in_rows</span> = input_rows; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L161\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"161\"></td>\n          <td id=\"LC161\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> args.<span class=\"pl-smi\">in_cols</span> = input_cols; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L162\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"162\"></td>\n          <td id=\"LC162\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> args.<span class=\"pl-smi\">in_depth</span> = in_depth; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L163\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"163\"></td>\n          <td id=\"LC163\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> args.<span class=\"pl-smi\">filter_rows</span> = filter_rows; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L164\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"164\"></td>\n          <td id=\"LC164\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> args.<span class=\"pl-smi\">filter_cols</span> = filter_cols; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L165\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"165\"></td>\n          <td id=\"LC165\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> args.<span class=\"pl-smi\">pad_rows</span> = pad_rows; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L166\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"166\"></td>\n          <td id=\"LC166\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> args.<span class=\"pl-smi\">pad_cols</span> = pad_cols; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L167\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"167\"></td>\n          <td id=\"LC167\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> args.<span class=\"pl-smi\">out_rows</span> = out_rows; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L168\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"168\"></td>\n          <td id=\"LC168\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> args.<span class=\"pl-smi\">out_cols</span> = out_cols; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L169\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"169\"></td>\n          <td id=\"LC169\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> args.<span class=\"pl-smi\">out_depth</span> = out_depth; </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>", "body_text": "I believe that max(0, pad) works well, see:\n\n  \n    \n      tensorflow/tensorflow/core/framework/common_shape_fns.cc\n    \n    \n        Lines 42 to 44\n      in\n      69620e1\n    \n    \n    \n    \n\n        \n          \n           const int64 padding_needed = \n        \n\n        \n          \n               std::max(0LL, (*output_size - 1) * stride + effective_filter_size - \n        \n\n        \n          \n                                 input_size); \n        \n    \n  \n\n\nAnd I find the stride information isn't packed into args in LaunchDeepConvOp, perhaps the problem is here but I am still not sure about it:\n\n  \n    \n      tensorflow/tensorflow/core/kernels/conv_ops.cc\n    \n    \n        Lines 158 to 169\n      in\n      69620e1\n    \n    \n    \n    \n\n        \n          \n           Conv2DArgs args; \n        \n\n        \n          \n           args.batch = batch; \n        \n\n        \n          \n           args.in_rows = input_rows; \n        \n\n        \n          \n           args.in_cols = input_cols; \n        \n\n        \n          \n           args.in_depth = in_depth; \n        \n\n        \n          \n           args.filter_rows = filter_rows; \n        \n\n        \n          \n           args.filter_cols = filter_cols; \n        \n\n        \n          \n           args.pad_rows = pad_rows; \n        \n\n        \n          \n           args.pad_cols = pad_cols; \n        \n\n        \n          \n           args.out_rows = out_rows; \n        \n\n        \n          \n           args.out_cols = out_cols; \n        \n\n        \n          \n           args.out_depth = out_depth;", "body": "I believe that `max(0, pad)` works well, see:\r\n\r\nhttps://github.com/tensorflow/tensorflow/blob/69620e12bf3403a11a47b26006ebb22656a9f036/tensorflow/core/framework/common_shape_fns.cc#L42-L44\r\n\r\nAnd I find the stride information isn't packed into `args` in `LaunchDeepConvOp`, perhaps the problem is here but I am still not sure about it:\r\n\r\nhttps://github.com/tensorflow/tensorflow/blob/69620e12bf3403a11a47b26006ebb22656a9f036/tensorflow/core/kernels/conv_ops.cc#L158-L169\r\n"}