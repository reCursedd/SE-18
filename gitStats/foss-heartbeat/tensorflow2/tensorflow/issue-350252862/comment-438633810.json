{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/438633810", "html_url": "https://github.com/tensorflow/tensorflow/issues/21587#issuecomment-438633810", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21587", "id": 438633810, "node_id": "MDEyOklzc3VlQ29tbWVudDQzODYzMzgxMA==", "user": {"login": "tranhungnghiep", "id": 4527536, "node_id": "MDQ6VXNlcjQ1Mjc1MzY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4527536?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tranhungnghiep", "html_url": "https://github.com/tranhungnghiep", "followers_url": "https://api.github.com/users/tranhungnghiep/followers", "following_url": "https://api.github.com/users/tranhungnghiep/following{/other_user}", "gists_url": "https://api.github.com/users/tranhungnghiep/gists{/gist_id}", "starred_url": "https://api.github.com/users/tranhungnghiep/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tranhungnghiep/subscriptions", "organizations_url": "https://api.github.com/users/tranhungnghiep/orgs", "repos_url": "https://api.github.com/users/tranhungnghiep/repos", "events_url": "https://api.github.com/users/tranhungnghiep/events{/privacy}", "received_events_url": "https://api.github.com/users/tranhungnghiep/received_events", "type": "User", "site_admin": false}, "created_at": "2018-11-14T11:41:08Z", "updated_at": "2018-11-14T11:41:08Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=5325686\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/scotthuang1989\">@scotthuang1989</a> I think you are right. tf's <code>add_loss()</code> adds regularization loss to <code>GraphKeys.REGULARIZATION_LOSSES</code>, but keras' <code>add_loss()</code> doesn't. So <code>tf.losses.get_regularization_loss()</code> works for tf layer but not keras layer. For keras layer, you should call <code>layer._losses</code> or <code>layer.get_losses_for()</code>.</p>\n<p>I also see <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=710255\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/fchollet\">@fchollet</a>'s comment that <code>GraphKeys.REGULARIZATION_LOSSES</code> is deprecated, so the correct way is to go through each and every layer/variable and get loss out manually. You can also use tf instead of keras, it works, for now.</p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=710255\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/fchollet\">@fchollet</a> There is really a mismatch in tf and keras behaviors. And regarding your comment on deprecation, please consider either update the code or the documentation to keep consistency and avoid confusion. Thanks.</p>", "body_text": "@scotthuang1989 I think you are right. tf's add_loss() adds regularization loss to GraphKeys.REGULARIZATION_LOSSES, but keras' add_loss() doesn't. So tf.losses.get_regularization_loss() works for tf layer but not keras layer. For keras layer, you should call layer._losses or layer.get_losses_for().\nI also see @fchollet's comment that GraphKeys.REGULARIZATION_LOSSES is deprecated, so the correct way is to go through each and every layer/variable and get loss out manually. You can also use tf instead of keras, it works, for now.\n@fchollet There is really a mismatch in tf and keras behaviors. And regarding your comment on deprecation, please consider either update the code or the documentation to keep consistency and avoid confusion. Thanks.", "body": "@scotthuang1989 I think you are right. tf's `add_loss()` adds regularization loss to `GraphKeys.REGULARIZATION_LOSSES`, but keras' `add_loss()` doesn't. So `tf.losses.get_regularization_loss()` works for tf layer but not keras layer. For keras layer, you should call `layer._losses` or `layer.get_losses_for()`.\r\n\r\nI also see @fchollet's comment that `GraphKeys.REGULARIZATION_LOSSES` is deprecated, so the correct way is to go through each and every layer/variable and get loss out manually. You can also use tf instead of keras, it works, for now.\r\n\r\n@fchollet There is really a mismatch in tf and keras behaviors. And regarding your comment on deprecation, please consider either update the code or the documentation to keep consistency and avoid confusion. Thanks."}