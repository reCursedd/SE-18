{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7561", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7561/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7561/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7561/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/7561", "id": 208049943, "node_id": "MDU6SXNzdWUyMDgwNDk5NDM=", "number": 7561, "title": "Different buckets give different outputs at first time step during decoding", "user": {"login": "shashankneo", "id": 10858825, "node_id": "MDQ6VXNlcjEwODU4ODI1", "avatar_url": "https://avatars1.githubusercontent.com/u/10858825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shashankneo", "html_url": "https://github.com/shashankneo", "followers_url": "https://api.github.com/users/shashankneo/followers", "following_url": "https://api.github.com/users/shashankneo/following{/other_user}", "gists_url": "https://api.github.com/users/shashankneo/gists{/gist_id}", "starred_url": "https://api.github.com/users/shashankneo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shashankneo/subscriptions", "organizations_url": "https://api.github.com/users/shashankneo/orgs", "repos_url": "https://api.github.com/users/shashankneo/repos", "events_url": "https://api.github.com/users/shashankneo/events{/privacy}", "received_events_url": "https://api.github.com/users/shashankneo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473184161, "node_id": "MDU6TGFiZWw0NzMxODQxNjE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:support", "name": "type:support", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-02-16T08:15:23Z", "updated_at": "2017-02-19T05:01:02Z", "closed_at": "2017-02-19T05:01:01Z", "author_association": "NONE", "body_html": "<p>Hi,</p>\n<p><strong>Background</strong><br>\nI'm trying to build a chat bot and have a basic understanding of tensorflow Sequence2Sequence API  by reading from here:<br>\n<a href=\"https://www.tensorflow.org/tutorials/seq2seq/\" rel=\"nofollow\">https://www.tensorflow.org/tutorials/seq2seq/</a></p>\n<p>I've also read related papers for Neural translation, attention mechanism during encoding/decoding etc.</p>\n<p>RNN translate code is taken from here:<br>\n<a href=\"https://github.com/tensorflow/models/blob/master/tutorials/rnn/translate/seq2seq_model.py\">https://github.com/tensorflow/models/blob/master/tutorials/rnn/translate/seq2seq_model.py</a></p>\n<p>Bucketing/Attention mechanism code is picked from here:<br>\n<a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/legacy_seq2seq/python/ops/seq2seq.py\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/legacy_seq2seq/python/ops/seq2seq.py</a></p>\n<p>During my training(attention mechanism, GRU cell), I gave my buckets as [(2,2),(4,4),(6,6),(,8,8),(10,10)].</p>\n<p><strong>Issue</strong></p>\n<p>During decoding, if I force a bucket_index on the same input I'm getting totally different outputs at the first time step. For example:</p>\n<ol>\n<li>\n<p>Input : How're you ?<br>\nBucket index : 1</p>\n<p>Output : NAME UNK NAME</p>\n<p>Input : How're you ?<br>\nBucket index : 2</p>\n<p>Output : Hi NAME to the</p>\n</li>\n</ol>\n<p><strong>Observations</strong></p>\n<ol>\n<li>\n<p>I can fix the bad outputs at each time step using beam-search. However, why I'm getting different word as output at the first time step during decoding ? Shouldn't the smaller bucket output be a subset of larger bucket output ?</p>\n</li>\n<li>\n<p>I've tried searching online and everywhere it's mentioned that parameters are shared across various buckets.  Buckets are used for training efficiency and not for model tuning. I've also verified that my trainable parameters are common across all the buckets.</p>\n</li>\n<li>\n<p>The biggest difference I can see between encoder inputs for various buckets is the extra padding at the very start. We are doing attention mechanism on encoded_states, and softmax weights are already learned for those encoded states during training. Therefore,  Can those softmax weights for those extra padded inputs cause sufficient difference leading to different output during first time step of decoding ?</p>\n</li>\n</ol>\n<p>Did any one else also encounter the above issue?  Any help for fixing the above error would be greatly appreciated.</p>", "body_text": "Hi,\nBackground\nI'm trying to build a chat bot and have a basic understanding of tensorflow Sequence2Sequence API  by reading from here:\nhttps://www.tensorflow.org/tutorials/seq2seq/\nI've also read related papers for Neural translation, attention mechanism during encoding/decoding etc.\nRNN translate code is taken from here:\nhttps://github.com/tensorflow/models/blob/master/tutorials/rnn/translate/seq2seq_model.py\nBucketing/Attention mechanism code is picked from here:\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/legacy_seq2seq/python/ops/seq2seq.py\nDuring my training(attention mechanism, GRU cell), I gave my buckets as [(2,2),(4,4),(6,6),(,8,8),(10,10)].\nIssue\nDuring decoding, if I force a bucket_index on the same input I'm getting totally different outputs at the first time step. For example:\n\n\nInput : How're you ?\nBucket index : 1\nOutput : NAME UNK NAME\nInput : How're you ?\nBucket index : 2\nOutput : Hi NAME to the\n\n\nObservations\n\n\nI can fix the bad outputs at each time step using beam-search. However, why I'm getting different word as output at the first time step during decoding ? Shouldn't the smaller bucket output be a subset of larger bucket output ?\n\n\nI've tried searching online and everywhere it's mentioned that parameters are shared across various buckets.  Buckets are used for training efficiency and not for model tuning. I've also verified that my trainable parameters are common across all the buckets.\n\n\nThe biggest difference I can see between encoder inputs for various buckets is the extra padding at the very start. We are doing attention mechanism on encoded_states, and softmax weights are already learned for those encoded states during training. Therefore,  Can those softmax weights for those extra padded inputs cause sufficient difference leading to different output during first time step of decoding ?\n\n\nDid any one else also encounter the above issue?  Any help for fixing the above error would be greatly appreciated.", "body": "Hi,\r\n\r\n**Background**\r\nI'm trying to build a chat bot and have a basic understanding of tensorflow Sequence2Sequence API  by reading from here: \r\nhttps://www.tensorflow.org/tutorials/seq2seq/\r\n\r\nI've also read related papers for Neural translation, attention mechanism during encoding/decoding etc.\r\n\r\nRNN translate code is taken from here:\r\nhttps://github.com/tensorflow/models/blob/master/tutorials/rnn/translate/seq2seq_model.py\r\n\r\nBucketing/Attention mechanism code is picked from here:\r\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/legacy_seq2seq/python/ops/seq2seq.py\r\n\r\nDuring my training(attention mechanism, GRU cell), I gave my buckets as [(2,2),(4,4),(6,6),(,8,8),(10,10)].\r\n\r\n**Issue**\r\n\r\nDuring decoding, if I force a bucket_index on the same input I'm getting totally different outputs at the first time step. For example:\r\n\r\n1) Input : How're you ?\r\n    Bucket index : 1\r\n\r\n    Output : NAME UNK NAME\r\n\r\n   Input : How're you ?\r\n    Bucket index : 2\r\n\r\n    Output : Hi NAME to the\r\n\r\n**Observations**\r\n\r\n1)  I can fix the bad outputs at each time step using beam-search. However, why I'm getting different word as output at the first time step during decoding ? Shouldn't the smaller bucket output be a subset of larger bucket output ? \r\n\r\n2) I've tried searching online and everywhere it's mentioned that parameters are shared across various buckets.  Buckets are used for training efficiency and not for model tuning. I've also verified that my trainable parameters are common across all the buckets.\r\n\r\n3) The biggest difference I can see between encoder inputs for various buckets is the extra padding at the very start. We are doing attention mechanism on encoded_states, and softmax weights are already learned for those encoded states during training. Therefore,  Can those softmax weights for those extra padded inputs cause sufficient difference leading to different output during first time step of decoding ?\r\n\r\nDid any one else also encounter the above issue?  Any help for fixing the above error would be greatly appreciated.\r\n\r\n"}