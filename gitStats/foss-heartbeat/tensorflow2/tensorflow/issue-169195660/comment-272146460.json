{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/272146460", "html_url": "https://github.com/tensorflow/tensorflow/issues/3628#issuecomment-272146460", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3628", "id": 272146460, "node_id": "MDEyOklzc3VlQ29tbWVudDI3MjE0NjQ2MA==", "user": {"login": "barbolo", "id": 274526, "node_id": "MDQ6VXNlcjI3NDUyNg==", "avatar_url": "https://avatars1.githubusercontent.com/u/274526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/barbolo", "html_url": "https://github.com/barbolo", "followers_url": "https://api.github.com/users/barbolo/followers", "following_url": "https://api.github.com/users/barbolo/following{/other_user}", "gists_url": "https://api.github.com/users/barbolo/gists{/gist_id}", "starred_url": "https://api.github.com/users/barbolo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/barbolo/subscriptions", "organizations_url": "https://api.github.com/users/barbolo/orgs", "repos_url": "https://api.github.com/users/barbolo/repos", "events_url": "https://api.github.com/users/barbolo/events{/privacy}", "received_events_url": "https://api.github.com/users/barbolo/received_events", "type": "User", "site_admin": false}, "created_at": "2017-01-12T12:01:59Z", "updated_at": "2017-01-12T12:05:18Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=16557697\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/pavelgonchar\">@pavelgonchar</a> Your suggestion didn't work for me:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-c\"><span class=\"pl-c\">#</span> read graph definition</span>\nf <span class=\"pl-k\">=</span> tf.python.platform.gfile.FastGFile(model_path)\ngd <span class=\"pl-k\">=</span> graph_def <span class=\"pl-k\">=</span> tf.GraphDef()\ngraph_def.ParseFromString(f.read())\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> fix nodes</span>\n<span class=\"pl-k\">for</span> node <span class=\"pl-k\">in</span> graph_def.node:\n  <span class=\"pl-k\">if</span> node.op <span class=\"pl-k\">==</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>RefSwitch<span class=\"pl-pds\">'</span></span>:\n    node.op <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>Switch<span class=\"pl-pds\">'</span></span>\n    <span class=\"pl-k\">for</span> index <span class=\"pl-k\">in</span> <span class=\"pl-v\">xrange</span>(<span class=\"pl-c1\">len</span>(node.input)):\n      node.input[index] <span class=\"pl-k\">=</span> node.input[index] <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>/read<span class=\"pl-pds\">'</span></span>\n  <span class=\"pl-k\">elif</span> node.op <span class=\"pl-k\">==</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>AssignSub<span class=\"pl-pds\">'</span></span>:\n    node.op <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>Sub<span class=\"pl-pds\">'</span></span>\n    <span class=\"pl-k\">if</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>use_locking<span class=\"pl-pds\">'</span></span> <span class=\"pl-k\">in</span> node.attr: <span class=\"pl-k\">del</span> node.attr[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>use_locking<span class=\"pl-pds\">'</span></span>]\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> import graph into session</span>\ntf.import_graph_def(graph_def, <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span><span class=\"pl-pds\">'</span></span>)</pre></div>\n<p>Error:</p>\n<pre><code>Traceback (most recent call last):\n  File \"&lt;stdin&gt;\", line 1, in &lt;module&gt;\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/importer.py\", line 357, in import_graph_def\n    % (input_name,)))\nValueError: graph_def is invalid at node u'conv1/BatchNorm/cond/AssignMovingAvg/Switch': Input tensor 'conv1/BatchNorm/cond/pred_id/read:0' not found in graph_def..\n</code></pre>", "body_text": "@pavelgonchar Your suggestion didn't work for me:\n# read graph definition\nf = tf.python.platform.gfile.FastGFile(model_path)\ngd = graph_def = tf.GraphDef()\ngraph_def.ParseFromString(f.read())\n\n# fix nodes\nfor node in graph_def.node:\n  if node.op == 'RefSwitch':\n    node.op = 'Switch'\n    for index in xrange(len(node.input)):\n      node.input[index] = node.input[index] + '/read'\n  elif node.op == 'AssignSub':\n    node.op = 'Sub'\n    if 'use_locking' in node.attr: del node.attr['use_locking']\n\n# import graph into session\ntf.import_graph_def(graph_def, name='')\nError:\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/importer.py\", line 357, in import_graph_def\n    % (input_name,)))\nValueError: graph_def is invalid at node u'conv1/BatchNorm/cond/AssignMovingAvg/Switch': Input tensor 'conv1/BatchNorm/cond/pred_id/read:0' not found in graph_def..", "body": "@pavelgonchar Your suggestion didn't work for me:\r\n\r\n```python\r\n# read graph definition\r\nf = tf.python.platform.gfile.FastGFile(model_path)\r\ngd = graph_def = tf.GraphDef()\r\ngraph_def.ParseFromString(f.read())\r\n\r\n# fix nodes\r\nfor node in graph_def.node:\r\n  if node.op == 'RefSwitch':\r\n    node.op = 'Switch'\r\n    for index in xrange(len(node.input)):\r\n      node.input[index] = node.input[index] + '/read'\r\n  elif node.op == 'AssignSub':\r\n    node.op = 'Sub'\r\n    if 'use_locking' in node.attr: del node.attr['use_locking']\r\n\r\n# import graph into session\r\ntf.import_graph_def(graph_def, name='')\r\n```\r\n\r\nError:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/importer.py\", line 357, in import_graph_def\r\n    % (input_name,)))\r\nValueError: graph_def is invalid at node u'conv1/BatchNorm/cond/AssignMovingAvg/Switch': Input tensor 'conv1/BatchNorm/cond/pred_id/read:0' not found in graph_def..\r\n```"}