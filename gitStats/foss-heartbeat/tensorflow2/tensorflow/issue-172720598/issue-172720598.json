{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3986", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3986/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3986/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3986/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/3986", "id": 172720598, "node_id": "MDU6SXNzdWUxNzI3MjA1OTg=", "number": 3986, "title": "Freeze graph: node is not in graph (even though it's been named)", "user": {"login": "cardshuffle", "id": 10469216, "node_id": "MDQ6VXNlcjEwNDY5MjE2", "avatar_url": "https://avatars0.githubusercontent.com/u/10469216?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cardshuffle", "html_url": "https://github.com/cardshuffle", "followers_url": "https://api.github.com/users/cardshuffle/followers", "following_url": "https://api.github.com/users/cardshuffle/following{/other_user}", "gists_url": "https://api.github.com/users/cardshuffle/gists{/gist_id}", "starred_url": "https://api.github.com/users/cardshuffle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cardshuffle/subscriptions", "organizations_url": "https://api.github.com/users/cardshuffle/orgs", "repos_url": "https://api.github.com/users/cardshuffle/repos", "events_url": "https://api.github.com/users/cardshuffle/events{/privacy}", "received_events_url": "https://api.github.com/users/cardshuffle/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "petewarden", "id": 161459, "node_id": "MDQ6VXNlcjE2MTQ1OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/161459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petewarden", "html_url": "https://github.com/petewarden", "followers_url": "https://api.github.com/users/petewarden/followers", "following_url": "https://api.github.com/users/petewarden/following{/other_user}", "gists_url": "https://api.github.com/users/petewarden/gists{/gist_id}", "starred_url": "https://api.github.com/users/petewarden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petewarden/subscriptions", "organizations_url": "https://api.github.com/users/petewarden/orgs", "repos_url": "https://api.github.com/users/petewarden/repos", "events_url": "https://api.github.com/users/petewarden/events{/privacy}", "received_events_url": "https://api.github.com/users/petewarden/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 17, "created_at": "2016-08-23T14:51:48Z", "updated_at": "2018-07-12T13:45:12Z", "closed_at": "2017-02-06T22:56:40Z", "author_association": "NONE", "body_html": "<h3>Environment info</h3>\n<p>Operating System: Ubuntu 14.04 LTS 64-bit</p>\n<p>Installed version of CUDA and cuDNN: none</p>\n<p>If installed from source, provide</p>\n<ol>\n<li>The commit hash (<code>git rev-parse HEAD</code>): <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/fc9162975e52978d3af38549b570cc3cc5f0ab66/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/fc9162975e52978d3af38549b570cc3cc5f0ab66\"><tt>fc91629</tt></a></li>\n<li>The output of <code>bazel version</code></li>\n</ol>\n<pre><code>Build label: 0.3.0\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Fri Jun 10 11:38:23 2016 (1465558703)\nBuild timestamp: 1465558703\nBuild timestamp as int: 1465558703\n</code></pre>\n<h3>Steps to reproduce</h3>\n<ol>\n<li>Copy the IPython Notebook for Assignment 6 of Udacity's deep learning course (<a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/udacity/6_lstm.ipynb\">here</a>)</li>\n<li>Change <code>saved_sample_output = tf.Variable(tf.zeros([1, num_nodes]))</code> to <code>saved_sample_output = tf.Variable(tf.zeros([1, num_nodes]), name=\"saved_sample_output\")</code></li>\n<li>Modify the code like so:</li>\n</ol>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">with</span> tf.Session(<span class=\"pl-v\">graph</span><span class=\"pl-k\">=</span>graph) <span class=\"pl-k\">as</span> session:\n  tf.initialize_all_variables().run()\n  <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>Initialized<span class=\"pl-pds\">'</span></span>)\n  mean_loss <span class=\"pl-k\">=</span> <span class=\"pl-c1\">0</span>\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> code omitted (no changes)</span>\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> new code below:</span>\n  saver <span class=\"pl-k\">=</span> tf.train.Saver(tf.all_variables())\n  saver.save(session, <span class=\"pl-s\"><span class=\"pl-pds\">'</span>/home/me/Documents/checkpoint.ckpt<span class=\"pl-pds\">'</span></span>, <span class=\"pl-v\">write_meta_graph</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">False</span>)\n  tf.train.write_graph(graph.as_graph_def(), <span class=\"pl-s\"><span class=\"pl-pds\">'</span>/home/me/Documents<span class=\"pl-pds\">'</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">'</span>graph.pb<span class=\"pl-pds\">'</span></span>)</pre></div>\n<ol>\n<li>Run.</li>\n<li>Verify that <code>checkpoint.ckpt</code> and <code>graph.pb</code> have been successfully created in the directory.</li>\n<li>In the tensorflow source directory, run:</li>\n</ol>\n<pre><code>bazel build tensorflow/python/tools:freeze_graph &amp;&amp; bazel-bin/tensorflow/python/tools/freeze_graph --input_graph=/home/me/Documents/graph.pb --input_checkpoint=/home/me/Documents/checkpoint.ckpt --output_graph=/home/me/Documents/frozen_graph.pb --output_node_names=saved_sample_output\n</code></pre>\n<h3>What have you tried?</h3>\n<p>Checked the <code>graph.pb</code> file to make sure that node had actually been named properly. Seems like it was:</p>\n<pre><code># other stuff\nnode {\n  name: \"saved_sample_output\"\n  op: \"Variable\"\n  attr {\n    key: \"container\"\n    value {\n      s: \"\"\n    }\n  }\n  attr {\n    key: \"dtype\"\n    value {\n      type: DT_FLOAT\n    }\n  }\n  attr {\n    key: \"shape\"\n    value {\n      shape {\n        dim {\n          size: 1\n        }\n        dim {\n          size: 64\n        }\n      }\n    }\n  }\n  attr {\n    key: \"shared_name\"\n    value {\n      s: \"\"\n    }\n  }\n}\n# etc.\n</code></pre>\n<p>I'm pretty much stumped with this one since <a href=\"https://stackoverflow.com/questions/38958662/tensorflow-what-are-the-output-node-names-for-freeze-graph-py-in-the-model-wi\" rel=\"nofollow\">this</a> issue on StackOverflow says to pass in a name parameter for the node you want, which is what I did, to no avail (even without the name parameter, it still gave the same error).<br>\n<strong>Edit:</strong> Got freeze_graph to run successfully with the <code>sample_prediction</code> node (changed <code>sample_prediction = tf.nn.softmax(tf.nn.xw_plus_b(sample_output, w, b))</code> to <code>sample_prediction = tf.nn.softmax(tf.nn.xw_plus_b(sample_output, w, b), name=\"sample_prediction\")</code>). However, I still haven't figured out why that worked, and this didn't.</p>\n<h3>Logs or other output that would be helpful</h3>\n<pre><code>Traceback (most recent call last):\n  File \"/home/me/tf_m/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 134, in &lt;module&gt;\n    tf.app.run()\n  File \"/home/me/tf_m/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv))\n  File \"/home/me/tf_m/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 131, in main\n    FLAGS.output_graph, FLAGS.clear_devices, FLAGS.initializer_nodes)\n  File \"/home/me/tf_m/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 120, in freeze_graph\n    sess, input_graph_def, output_node_names.split(\",\"))\n  File \"/home/me/tf_m/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/framework/graph_util.py\", line 232, in convert_variables_to_constants\n    inference_graph = extract_sub_graph(input_graph_def, output_node_names)\n  File \"/home/me/tf_m/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/framework/graph_util.py\", line 156, in extract_sub_graph\n    assert d in name_to_node_map, \"%s is not in graph\" % d\nAssertionError: saved_sample_output is not in graph\n</code></pre>", "body_text": "Environment info\nOperating System: Ubuntu 14.04 LTS 64-bit\nInstalled version of CUDA and cuDNN: none\nIf installed from source, provide\n\nThe commit hash (git rev-parse HEAD): fc91629\nThe output of bazel version\n\nBuild label: 0.3.0\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Fri Jun 10 11:38:23 2016 (1465558703)\nBuild timestamp: 1465558703\nBuild timestamp as int: 1465558703\n\nSteps to reproduce\n\nCopy the IPython Notebook for Assignment 6 of Udacity's deep learning course (here)\nChange saved_sample_output = tf.Variable(tf.zeros([1, num_nodes])) to saved_sample_output = tf.Variable(tf.zeros([1, num_nodes]), name=\"saved_sample_output\")\nModify the code like so:\n\nwith tf.Session(graph=graph) as session:\n  tf.initialize_all_variables().run()\n  print('Initialized')\n  mean_loss = 0\n  # code omitted (no changes)\n  # new code below:\n  saver = tf.train.Saver(tf.all_variables())\n  saver.save(session, '/home/me/Documents/checkpoint.ckpt', write_meta_graph=False)\n  tf.train.write_graph(graph.as_graph_def(), '/home/me/Documents', 'graph.pb')\n\nRun.\nVerify that checkpoint.ckpt and graph.pb have been successfully created in the directory.\nIn the tensorflow source directory, run:\n\nbazel build tensorflow/python/tools:freeze_graph && bazel-bin/tensorflow/python/tools/freeze_graph --input_graph=/home/me/Documents/graph.pb --input_checkpoint=/home/me/Documents/checkpoint.ckpt --output_graph=/home/me/Documents/frozen_graph.pb --output_node_names=saved_sample_output\n\nWhat have you tried?\nChecked the graph.pb file to make sure that node had actually been named properly. Seems like it was:\n# other stuff\nnode {\n  name: \"saved_sample_output\"\n  op: \"Variable\"\n  attr {\n    key: \"container\"\n    value {\n      s: \"\"\n    }\n  }\n  attr {\n    key: \"dtype\"\n    value {\n      type: DT_FLOAT\n    }\n  }\n  attr {\n    key: \"shape\"\n    value {\n      shape {\n        dim {\n          size: 1\n        }\n        dim {\n          size: 64\n        }\n      }\n    }\n  }\n  attr {\n    key: \"shared_name\"\n    value {\n      s: \"\"\n    }\n  }\n}\n# etc.\n\nI'm pretty much stumped with this one since this issue on StackOverflow says to pass in a name parameter for the node you want, which is what I did, to no avail (even without the name parameter, it still gave the same error).\nEdit: Got freeze_graph to run successfully with the sample_prediction node (changed sample_prediction = tf.nn.softmax(tf.nn.xw_plus_b(sample_output, w, b)) to sample_prediction = tf.nn.softmax(tf.nn.xw_plus_b(sample_output, w, b), name=\"sample_prediction\")). However, I still haven't figured out why that worked, and this didn't.\nLogs or other output that would be helpful\nTraceback (most recent call last):\n  File \"/home/me/tf_m/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 134, in <module>\n    tf.app.run()\n  File \"/home/me/tf_m/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv))\n  File \"/home/me/tf_m/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 131, in main\n    FLAGS.output_graph, FLAGS.clear_devices, FLAGS.initializer_nodes)\n  File \"/home/me/tf_m/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 120, in freeze_graph\n    sess, input_graph_def, output_node_names.split(\",\"))\n  File \"/home/me/tf_m/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/framework/graph_util.py\", line 232, in convert_variables_to_constants\n    inference_graph = extract_sub_graph(input_graph_def, output_node_names)\n  File \"/home/me/tf_m/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/framework/graph_util.py\", line 156, in extract_sub_graph\n    assert d in name_to_node_map, \"%s is not in graph\" % d\nAssertionError: saved_sample_output is not in graph", "body": "### Environment info\n\nOperating System: Ubuntu 14.04 LTS 64-bit\n\nInstalled version of CUDA and cuDNN: none\n\nIf installed from source, provide \n1. The commit hash (`git rev-parse HEAD`): fc9162975e52978d3af38549b570cc3cc5f0ab66\n2. The output of `bazel version`\n\n```\nBuild label: 0.3.0\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Fri Jun 10 11:38:23 2016 (1465558703)\nBuild timestamp: 1465558703\nBuild timestamp as int: 1465558703\n```\n### Steps to reproduce\n1. Copy the IPython Notebook for Assignment 6 of Udacity's deep learning course ([here](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/udacity/6_lstm.ipynb))\n2. Change `saved_sample_output = tf.Variable(tf.zeros([1, num_nodes]))` to `saved_sample_output = tf.Variable(tf.zeros([1, num_nodes]), name=\"saved_sample_output\")`\n3. Modify the code like so:\n\n``` python\nwith tf.Session(graph=graph) as session:\n  tf.initialize_all_variables().run()\n  print('Initialized')\n  mean_loss = 0\n  # code omitted (no changes)\n  # new code below:\n  saver = tf.train.Saver(tf.all_variables())\n  saver.save(session, '/home/me/Documents/checkpoint.ckpt', write_meta_graph=False)\n  tf.train.write_graph(graph.as_graph_def(), '/home/me/Documents', 'graph.pb')\n```\n1. Run.\n2. Verify that `checkpoint.ckpt` and `graph.pb` have been successfully created in the directory.\n3. In the tensorflow source directory, run:\n\n```\nbazel build tensorflow/python/tools:freeze_graph && bazel-bin/tensorflow/python/tools/freeze_graph --input_graph=/home/me/Documents/graph.pb --input_checkpoint=/home/me/Documents/checkpoint.ckpt --output_graph=/home/me/Documents/frozen_graph.pb --output_node_names=saved_sample_output\n```\n### What have you tried?\n\nChecked the `graph.pb` file to make sure that node had actually been named properly. Seems like it was:\n\n```\n# other stuff\nnode {\n  name: \"saved_sample_output\"\n  op: \"Variable\"\n  attr {\n    key: \"container\"\n    value {\n      s: \"\"\n    }\n  }\n  attr {\n    key: \"dtype\"\n    value {\n      type: DT_FLOAT\n    }\n  }\n  attr {\n    key: \"shape\"\n    value {\n      shape {\n        dim {\n          size: 1\n        }\n        dim {\n          size: 64\n        }\n      }\n    }\n  }\n  attr {\n    key: \"shared_name\"\n    value {\n      s: \"\"\n    }\n  }\n}\n# etc.\n```\n\nI'm pretty much stumped with this one since [this](https://stackoverflow.com/questions/38958662/tensorflow-what-are-the-output-node-names-for-freeze-graph-py-in-the-model-wi) issue on StackOverflow says to pass in a name parameter for the node you want, which is what I did, to no avail (even without the name parameter, it still gave the same error).\n**Edit:** Got freeze_graph to run successfully with the `sample_prediction` node (changed `sample_prediction = tf.nn.softmax(tf.nn.xw_plus_b(sample_output, w, b))` to `sample_prediction = tf.nn.softmax(tf.nn.xw_plus_b(sample_output, w, b), name=\"sample_prediction\")`). However, I still haven't figured out why that worked, and this didn't.\n### Logs or other output that would be helpful\n\n```\nTraceback (most recent call last):\n  File \"/home/me/tf_m/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 134, in <module>\n    tf.app.run()\n  File \"/home/me/tf_m/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv))\n  File \"/home/me/tf_m/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 131, in main\n    FLAGS.output_graph, FLAGS.clear_devices, FLAGS.initializer_nodes)\n  File \"/home/me/tf_m/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/tools/freeze_graph.py\", line 120, in freeze_graph\n    sess, input_graph_def, output_node_names.split(\",\"))\n  File \"/home/me/tf_m/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/framework/graph_util.py\", line 232, in convert_variables_to_constants\n    inference_graph = extract_sub_graph(input_graph_def, output_node_names)\n  File \"/home/me/tf_m/tensorflow/bazel-bin/tensorflow/python/tools/freeze_graph.runfiles/org_tensorflow/tensorflow/python/framework/graph_util.py\", line 156, in extract_sub_graph\n    assert d in name_to_node_map, \"%s is not in graph\" % d\nAssertionError: saved_sample_output is not in graph\n```\n"}