{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9427", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9427/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9427/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9427/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/9427", "id": 224020698, "node_id": "MDU6SXNzdWUyMjQwMjA2OTg=", "number": 9427, "title": "Resource Exhausted and Initialization Errors on gpu", "user": {"login": "vijpandaturtle", "id": 22594650, "node_id": "MDQ6VXNlcjIyNTk0NjUw", "avatar_url": "https://avatars2.githubusercontent.com/u/22594650?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vijpandaturtle", "html_url": "https://github.com/vijpandaturtle", "followers_url": "https://api.github.com/users/vijpandaturtle/followers", "following_url": "https://api.github.com/users/vijpandaturtle/following{/other_user}", "gists_url": "https://api.github.com/users/vijpandaturtle/gists{/gist_id}", "starred_url": "https://api.github.com/users/vijpandaturtle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vijpandaturtle/subscriptions", "organizations_url": "https://api.github.com/users/vijpandaturtle/orgs", "repos_url": "https://api.github.com/users/vijpandaturtle/repos", "events_url": "https://api.github.com/users/vijpandaturtle/events{/privacy}", "received_events_url": "https://api.github.com/users/vijpandaturtle/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473184161, "node_id": "MDU6TGFiZWw0NzMxODQxNjE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:support", "name": "type:support", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-04-25T04:51:34Z", "updated_at": "2017-04-25T05:16:33Z", "closed_at": "2017-04-25T05:16:32Z", "author_association": "NONE", "body_html": "<p>Hello,<br>\nI have been facing a resource exhausted error on my gpu for a couple of days and can't seem to figure out how to fix it.<br>\nSo, i have been training custom made conv net on a kaggle dataset for facial recognition with the 53% accuracy..it currently has four convolutional + maxpooling layers followed by 2 fully connected layers<br>\nMy convolutional layers currently have a stride of (2,2) but since that results in loss of information i wanted to reduce the strides to (1,1). This is a snippet of the various error i'm facing</p>\n<h2>Training on the data</h2>\n<p>InternalError                             Traceback (most recent call last)<br>\n/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)<br>\n1021     try:<br>\n-&gt; 1022       return fn(*args)<br>\n1023     except errors.OpError as e:</p>\n<p>/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run_fn(session, feed_dict, fetch_list, target_list, options, run_metadata)<br>\n1003                                  feed_dict, fetch_list, target_list,<br>\n-&gt; 1004                                  status, run_metadata)<br>\n1005</p>\n<p>/home/carnd/anaconda3/envs/dl/lib/python3.5/contextlib.py in <strong>exit</strong>(self, type, value, traceback)<br>\n65             try:<br>\n---&gt; 66                 next(self.gen)<br>\n67             except StopIteration:</p>\n<p>/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/framework/errors_impl.py in raise_exception_on_not_ok_status()<br>\n468           compat.as_text(pywrap_tensorflow.TF_Message(status)),<br>\n--&gt; 469           pywrap_tensorflow.TF_GetCode(status))<br>\n470   finally:</p>\n<p>InternalError: Dst tensor is not initialized.<br>\n[[Node: zeros_28 = Const<a href=\"\">dtype=DT_FLOAT, value=Tensor&lt;type: float shape: [2304,1152] values: [0 0 0]...&gt;, _device=\"/job:localhost/replica:0/task:0/gpu:0\"</a>]]</p>\n<p>During handling of the above exception, another exception occurred:</p>\n<p>InternalError                             Traceback (most recent call last)<br>\n in ()<br>\n2 print(\"Training on the data\")<br>\n3 with tf.Session() as sess:<br>\n----&gt; 4     sess.run(tf.global_variables_initializer())<br>\n5<br>\n6     for epoch in range(epochs):</p>\n<p>/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/client/session.py in run(self, fetches, feed_dict, options, run_metadata)<br>\n765     try:<br>\n766       result = self._run(None, fetches, feed_dict, options_ptr,<br>\n--&gt; 767                          run_metadata_ptr)<br>\n768       if run_metadata:<br>\n769         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)</p>\n<p>/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run(self, handle, fetches, feed_dict, options, run_metadata)<br>\n963     if final_fetches or final_targets:<br>\n964       results = self._do_run(handle, final_targets, final_fetches,<br>\n--&gt; 965                              feed_dict_string, options, run_metadata)<br>\n966     else:<br>\n967       results = []</p>\n<p>/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)<br>\n1013     if handle is None:<br>\n1014       return self._do_call(_run_fn, self._session, feed_dict, fetch_list,<br>\n-&gt; 1015                            target_list, options, run_metadata)<br>\n1016     else:<br>\n1017       return self._do_call(_prun_fn, self._session, handle, feed_dict,</p>\n<p>/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)<br>\n1033         except KeyError:<br>\n1034           pass<br>\n-&gt; 1035       raise type(e)(node_def, op, message)<br>\n1036<br>\n1037   def _extend_graph(self):</p>\n<p>InternalError: Dst tensor is not initialized.<br>\n[[Node: zeros_28 = Const<a href=\"\">dtype=DT_FLOAT, value=Tensor&lt;type: float shape: [2304,1152] values: [0 0 0]...&gt;, _device=\"/job:localhost/replica:0/task:0/gpu:0\"</a>]]</p>\n<p>Caused by op 'zeros_28', defined at:<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/runpy.py\", line 184, in _run_module_as_main<br>\n\"<strong>main</strong>\", mod_spec)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/runpy.py\", line 85, in _run_code<br>\nexec(code, run_globals)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/<strong>main</strong>.py\", line 3, in <br>\napp.launch_new_instance()<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/traitlets/config/application.py\", line 658, in launch_instance<br>\napp.start()<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/kernelapp.py\", line 474, in start<br>\nioloop.IOLoop.instance().start()<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/zmq/eventloop/ioloop.py\", line 177, in start<br>\nsuper(ZMQIOLoop, self).start()<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tornado/ioloop.py\", line 887, in start<br>\nhandler_func(fd_obj, events)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tornado/stack_context.py\", line 275, in null_wrapper<br>\nreturn fn(*args, **kwargs)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/zmq/eventloop/zmqstream.py\", line 440, in _handle_events<br>\nself._handle_recv()<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/zmq/eventloop/zmqstream.py\", line 472, in _handle_recv<br>\nself._run_callback(callback, msg)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/zmq/eventloop/zmqstream.py\", line 414, in _run_callback<br>\ncallback(*args, **kwargs)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tornado/stack_context.py\", line 275, in null_wrapper<br>\nreturn fn(*args, **kwargs)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/kernelbase.py\", line 276, in dispatcher<br>\nreturn self.dispatch_shell(stream, msg)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/kernelbase.py\", line 228, in dispatch_shell<br>\nhandler(stream, idents, msg)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/kernelbase.py\", line 390, in execute_request<br>\nuser_expressions, allow_stdin)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/ipkernel.py\", line 196, in do_execute<br>\nres = shell.run_cell(code, store_history=store_history, silent=silent)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/zmqshell.py\", line 501, in run_cell<br>\nreturn super(ZMQInteractiveShell, self).run_cell(*args, **kwargs)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/IPython/core/interactiveshell.py\", line 2717, in run_cell<br>\ninteractivity=interactivity, compiler=compiler, result=result)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/IPython/core/interactiveshell.py\", line 2821, in run_ast_nodes<br>\nif self.run_code(code, result):<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/IPython/core/interactiveshell.py\", line 2881, in run_code<br>\nexec(code_obj, self.user_global_ns, self.user_ns)<br>\nFile \"\", line 47, in <br>\noptimizer = tf.train.AdamOptimizer().minimize(cost)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 298, in minimize<br>\nname=name)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 412, in apply_gradients<br>\nself._create_slots(var_list)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/training/adam.py\", line 119, in _create_slots<br>\nself._zeros_slot(v, \"m\", self._name)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 656, in _zeros_slot<br>\nnamed_slots[var] = slot_creator.create_zeros_slot(var, op_name)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/training/slot_creator.py\", line 121, in create_zeros_slot<br>\nval = array_ops.zeros(primary.get_shape().as_list(), dtype=dtype)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/ops/array_ops.py\", line 1370, in zeros<br>\noutput = constant(zero, shape=shape, dtype=dtype, name=name)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/framework/constant_op.py\", line 169, in constant<br>\nattrs={\"value\": tensor_value, \"dtype\": dtype_value}, name=name).outputs[0]<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2395, in create_op<br>\noriginal_op=self._default_original_op, op_def=op_def)<br>\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1264, in <strong>init</strong><br>\nself._traceback = _extract_stack()</p>\n<p>InternalError (see above for traceback): Dst tensor is not initialized.<br>\n[[Node: zeros_28 = Const<a href=\"\">dtype=DT_FLOAT, value=Tensor&lt;type: float shape: [2304,1152] values: [0 0 0]...&gt;, _device=\"/job:localhost/replica:0/task:0/gpu:0\"</a>]]</p>\n<h3>The error faced in the previous training run of the network was a resource exhausted error which i have commented on in another issue</h3>\n<p><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"223697349\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/9400\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/9400/hovercard?comment_id=296718808&amp;comment_type=issue_comment\" href=\"https://github.com/tensorflow/tensorflow/issues/9400#issuecomment-296718808\">#9400 (comment)</a></p>\n<p>I am using  a g2.2x large ec2 instance on aws amazon with a 32gb storage volume</p>\n<p>Here is a link to the original unbroken code<br>\n<a href=\"https://github.com/vijpandaturtle/facial-expressions\">https://github.com/vijpandaturtle/facial-expressions</a><br>\nAnd here is the dataset of 48x48 pixel images(around 35000 images)<br>\n<a href=\"https://www.kaggle.com/c/challenges-in-representation-learning-facial-expression-recognition-challenge\" rel=\"nofollow\">https://www.kaggle.com/c/challenges-in-representation-learning-facial-expression-recognition-challenge</a><br>\nThanks</p>", "body_text": "Hello,\nI have been facing a resource exhausted error on my gpu for a couple of days and can't seem to figure out how to fix it.\nSo, i have been training custom made conv net on a kaggle dataset for facial recognition with the 53% accuracy..it currently has four convolutional + maxpooling layers followed by 2 fully connected layers\nMy convolutional layers currently have a stride of (2,2) but since that results in loss of information i wanted to reduce the strides to (1,1). This is a snippet of the various error i'm facing\nTraining on the data\nInternalError                             Traceback (most recent call last)\n/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\n1021     try:\n-> 1022       return fn(*args)\n1023     except errors.OpError as e:\n/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run_fn(session, feed_dict, fetch_list, target_list, options, run_metadata)\n1003                                  feed_dict, fetch_list, target_list,\n-> 1004                                  status, run_metadata)\n1005\n/home/carnd/anaconda3/envs/dl/lib/python3.5/contextlib.py in exit(self, type, value, traceback)\n65             try:\n---> 66                 next(self.gen)\n67             except StopIteration:\n/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/framework/errors_impl.py in raise_exception_on_not_ok_status()\n468           compat.as_text(pywrap_tensorflow.TF_Message(status)),\n--> 469           pywrap_tensorflow.TF_GetCode(status))\n470   finally:\nInternalError: Dst tensor is not initialized.\n[[Node: zeros_28 = Constdtype=DT_FLOAT, value=Tensor<type: float shape: [2304,1152] values: [0 0 0]...>, _device=\"/job:localhost/replica:0/task:0/gpu:0\"]]\nDuring handling of the above exception, another exception occurred:\nInternalError                             Traceback (most recent call last)\n in ()\n2 print(\"Training on the data\")\n3 with tf.Session() as sess:\n----> 4     sess.run(tf.global_variables_initializer())\n5\n6     for epoch in range(epochs):\n/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/client/session.py in run(self, fetches, feed_dict, options, run_metadata)\n765     try:\n766       result = self._run(None, fetches, feed_dict, options_ptr,\n--> 767                          run_metadata_ptr)\n768       if run_metadata:\n769         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)\n/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run(self, handle, fetches, feed_dict, options, run_metadata)\n963     if final_fetches or final_targets:\n964       results = self._do_run(handle, final_targets, final_fetches,\n--> 965                              feed_dict_string, options, run_metadata)\n966     else:\n967       results = []\n/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)\n1013     if handle is None:\n1014       return self._do_call(_run_fn, self._session, feed_dict, fetch_list,\n-> 1015                            target_list, options, run_metadata)\n1016     else:\n1017       return self._do_call(_prun_fn, self._session, handle, feed_dict,\n/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\n1033         except KeyError:\n1034           pass\n-> 1035       raise type(e)(node_def, op, message)\n1036\n1037   def _extend_graph(self):\nInternalError: Dst tensor is not initialized.\n[[Node: zeros_28 = Constdtype=DT_FLOAT, value=Tensor<type: float shape: [2304,1152] values: [0 0 0]...>, _device=\"/job:localhost/replica:0/task:0/gpu:0\"]]\nCaused by op 'zeros_28', defined at:\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/runpy.py\", line 184, in _run_module_as_main\n\"main\", mod_spec)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/runpy.py\", line 85, in _run_code\nexec(code, run_globals)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/main.py\", line 3, in \napp.launch_new_instance()\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/traitlets/config/application.py\", line 658, in launch_instance\napp.start()\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/kernelapp.py\", line 474, in start\nioloop.IOLoop.instance().start()\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/zmq/eventloop/ioloop.py\", line 177, in start\nsuper(ZMQIOLoop, self).start()\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tornado/ioloop.py\", line 887, in start\nhandler_func(fd_obj, events)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\nreturn fn(*args, **kwargs)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/zmq/eventloop/zmqstream.py\", line 440, in _handle_events\nself._handle_recv()\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/zmq/eventloop/zmqstream.py\", line 472, in _handle_recv\nself._run_callback(callback, msg)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/zmq/eventloop/zmqstream.py\", line 414, in _run_callback\ncallback(*args, **kwargs)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\nreturn fn(*args, **kwargs)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/kernelbase.py\", line 276, in dispatcher\nreturn self.dispatch_shell(stream, msg)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/kernelbase.py\", line 228, in dispatch_shell\nhandler(stream, idents, msg)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/kernelbase.py\", line 390, in execute_request\nuser_expressions, allow_stdin)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/ipkernel.py\", line 196, in do_execute\nres = shell.run_cell(code, store_history=store_history, silent=silent)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/zmqshell.py\", line 501, in run_cell\nreturn super(ZMQInteractiveShell, self).run_cell(*args, **kwargs)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/IPython/core/interactiveshell.py\", line 2717, in run_cell\ninteractivity=interactivity, compiler=compiler, result=result)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/IPython/core/interactiveshell.py\", line 2821, in run_ast_nodes\nif self.run_code(code, result):\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/IPython/core/interactiveshell.py\", line 2881, in run_code\nexec(code_obj, self.user_global_ns, self.user_ns)\nFile \"\", line 47, in \noptimizer = tf.train.AdamOptimizer().minimize(cost)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 298, in minimize\nname=name)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 412, in apply_gradients\nself._create_slots(var_list)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/training/adam.py\", line 119, in _create_slots\nself._zeros_slot(v, \"m\", self._name)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 656, in _zeros_slot\nnamed_slots[var] = slot_creator.create_zeros_slot(var, op_name)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/training/slot_creator.py\", line 121, in create_zeros_slot\nval = array_ops.zeros(primary.get_shape().as_list(), dtype=dtype)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/ops/array_ops.py\", line 1370, in zeros\noutput = constant(zero, shape=shape, dtype=dtype, name=name)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/framework/constant_op.py\", line 169, in constant\nattrs={\"value\": tensor_value, \"dtype\": dtype_value}, name=name).outputs[0]\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2395, in create_op\noriginal_op=self._default_original_op, op_def=op_def)\nFile \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1264, in init\nself._traceback = _extract_stack()\nInternalError (see above for traceback): Dst tensor is not initialized.\n[[Node: zeros_28 = Constdtype=DT_FLOAT, value=Tensor<type: float shape: [2304,1152] values: [0 0 0]...>, _device=\"/job:localhost/replica:0/task:0/gpu:0\"]]\nThe error faced in the previous training run of the network was a resource exhausted error which i have commented on in another issue\n#9400 (comment)\nI am using  a g2.2x large ec2 instance on aws amazon with a 32gb storage volume\nHere is a link to the original unbroken code\nhttps://github.com/vijpandaturtle/facial-expressions\nAnd here is the dataset of 48x48 pixel images(around 35000 images)\nhttps://www.kaggle.com/c/challenges-in-representation-learning-facial-expression-recognition-challenge\nThanks", "body": "Hello,\r\nI have been facing a resource exhausted error on my gpu for a couple of days and can't seem to figure out how to fix it.\r\nSo, i have been training custom made conv net on a kaggle dataset for facial recognition with the 53% accuracy..it currently has four convolutional + maxpooling layers followed by 2 fully connected layers\r\nMy convolutional layers currently have a stride of (2,2) but since that results in loss of information i wanted to reduce the strides to (1,1). This is a snippet of the various error i'm facing \r\n\r\nTraining on the data\r\n---------------------------------------------------------------------------\r\nInternalError                             Traceback (most recent call last)\r\n/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\r\n   1021     try:\r\n-> 1022       return fn(*args)\r\n   1023     except errors.OpError as e:\r\n\r\n/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run_fn(session, feed_dict, fetch_list, target_list, options, run_metadata)\r\n   1003                                  feed_dict, fetch_list, target_list,\r\n-> 1004                                  status, run_metadata)\r\n   1005 \r\n\r\n/home/carnd/anaconda3/envs/dl/lib/python3.5/contextlib.py in __exit__(self, type, value, traceback)\r\n     65             try:\r\n---> 66                 next(self.gen)\r\n     67             except StopIteration:\r\n\r\n/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/framework/errors_impl.py in raise_exception_on_not_ok_status()\r\n    468           compat.as_text(pywrap_tensorflow.TF_Message(status)),\r\n--> 469           pywrap_tensorflow.TF_GetCode(status))\r\n    470   finally:\r\n\r\nInternalError: Dst tensor is not initialized.\r\n\t [[Node: zeros_28 = Const[dtype=DT_FLOAT, value=Tensor<type: float shape: [2304,1152] values: [0 0 0]...>, _device=\"/job:localhost/replica:0/task:0/gpu:0\"]()]]\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nInternalError                             Traceback (most recent call last)\r\n<ipython-input-37-ab81f6da0f51> in <module>()\r\n      2 print(\"Training on the data\")\r\n      3 with tf.Session() as sess:\r\n----> 4     sess.run(tf.global_variables_initializer())\r\n      5 \r\n      6     for epoch in range(epochs):\r\n\r\n/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/client/session.py in run(self, fetches, feed_dict, options, run_metadata)\r\n    765     try:\r\n    766       result = self._run(None, fetches, feed_dict, options_ptr,\r\n--> 767                          run_metadata_ptr)\r\n    768       if run_metadata:\r\n    769         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)\r\n\r\n/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/client/session.py in _run(self, handle, fetches, feed_dict, options, run_metadata)\r\n    963     if final_fetches or final_targets:\r\n    964       results = self._do_run(handle, final_targets, final_fetches,\r\n--> 965                              feed_dict_string, options, run_metadata)\r\n    966     else:\r\n    967       results = []\r\n\r\n/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)\r\n   1013     if handle is None:\r\n   1014       return self._do_call(_run_fn, self._session, feed_dict, fetch_list,\r\n-> 1015                            target_list, options, run_metadata)\r\n   1016     else:\r\n   1017       return self._do_call(_prun_fn, self._session, handle, feed_dict,\r\n\r\n/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\r\n   1033         except KeyError:\r\n   1034           pass\r\n-> 1035       raise type(e)(node_def, op, message)\r\n   1036 \r\n   1037   def _extend_graph(self):\r\n\r\nInternalError: Dst tensor is not initialized.\r\n\t [[Node: zeros_28 = Const[dtype=DT_FLOAT, value=Tensor<type: float shape: [2304,1152] values: [0 0 0]...>, _device=\"/job:localhost/replica:0/task:0/gpu:0\"]()]]\r\n\r\nCaused by op 'zeros_28', defined at:\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/runpy.py\", line 184, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/__main__.py\", line 3, in <module>\r\n    app.launch_new_instance()\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/traitlets/config/application.py\", line 658, in launch_instance\r\n    app.start()\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/kernelapp.py\", line 474, in start\r\n    ioloop.IOLoop.instance().start()\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/zmq/eventloop/ioloop.py\", line 177, in start\r\n    super(ZMQIOLoop, self).start()\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tornado/ioloop.py\", line 887, in start\r\n    handler_func(fd_obj, events)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\r\n    return fn(*args, **kwargs)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/zmq/eventloop/zmqstream.py\", line 440, in _handle_events\r\n    self._handle_recv()\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/zmq/eventloop/zmqstream.py\", line 472, in _handle_recv\r\n    self._run_callback(callback, msg)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/zmq/eventloop/zmqstream.py\", line 414, in _run_callback\r\n    callback(*args, **kwargs)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\r\n    return fn(*args, **kwargs)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/kernelbase.py\", line 276, in dispatcher\r\n    return self.dispatch_shell(stream, msg)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/kernelbase.py\", line 228, in dispatch_shell\r\n    handler(stream, idents, msg)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/kernelbase.py\", line 390, in execute_request\r\n    user_expressions, allow_stdin)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/ipkernel.py\", line 196, in do_execute\r\n    res = shell.run_cell(code, store_history=store_history, silent=silent)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/ipykernel/zmqshell.py\", line 501, in run_cell\r\n    return super(ZMQInteractiveShell, self).run_cell(*args, **kwargs)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/IPython/core/interactiveshell.py\", line 2717, in run_cell\r\n    interactivity=interactivity, compiler=compiler, result=result)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/IPython/core/interactiveshell.py\", line 2821, in run_ast_nodes\r\n    if self.run_code(code, result):\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/IPython/core/interactiveshell.py\", line 2881, in run_code\r\n    exec(code_obj, self.user_global_ns, self.user_ns)\r\n  File \"<ipython-input-34-12683d1a5f6b>\", line 47, in <module>\r\n    optimizer = tf.train.AdamOptimizer().minimize(cost)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 298, in minimize\r\n    name=name)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 412, in apply_gradients\r\n    self._create_slots(var_list)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/training/adam.py\", line 119, in _create_slots\r\n    self._zeros_slot(v, \"m\", self._name)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/training/optimizer.py\", line 656, in _zeros_slot\r\n    named_slots[var] = slot_creator.create_zeros_slot(var, op_name)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/training/slot_creator.py\", line 121, in create_zeros_slot\r\n    val = array_ops.zeros(primary.get_shape().as_list(), dtype=dtype)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/ops/array_ops.py\", line 1370, in zeros\r\n    output = constant(zero, shape=shape, dtype=dtype, name=name)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/framework/constant_op.py\", line 169, in constant\r\n    attrs={\"value\": tensor_value, \"dtype\": dtype_value}, name=name).outputs[0]\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 2395, in create_op\r\n    original_op=self._default_original_op, op_def=op_def)\r\n  File \"/home/carnd/anaconda3/envs/dl/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\", line 1264, in __init__\r\n    self._traceback = _extract_stack()\r\n\r\nInternalError (see above for traceback): Dst tensor is not initialized.\r\n\t [[Node: zeros_28 = Const[dtype=DT_FLOAT, value=Tensor<type: float shape: [2304,1152] values: [0 0 0]...>, _device=\"/job:localhost/replica:0/task:0/gpu:0\"]()]]\r\n\r\n### The error faced in the previous training run of the network was a resource exhausted error which i have commented on in another issue\r\nhttps://github.com/tensorflow/tensorflow/issues/9400#issuecomment-296718808\r\n\r\nI am using  a g2.2x large ec2 instance on aws amazon with a 32gb storage volume\r\n\r\nHere is a link to the original unbroken code \r\nhttps://github.com/vijpandaturtle/facial-expressions\r\nAnd here is the dataset of 48x48 pixel images(around 35000 images)\r\nhttps://www.kaggle.com/c/challenges-in-representation-learning-facial-expression-recognition-challenge\r\nThanks"}