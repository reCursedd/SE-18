{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22224", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22224/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22224/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22224/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/22224", "id": 359337104, "node_id": "MDU6SXNzdWUzNTkzMzcxMDQ=", "number": 22224, "title": "Eeager Mode:sigmoid_cross_entropy_with_logits expects int32 but not float tensor", "user": {"login": "Paul0M", "id": 13173000, "node_id": "MDQ6VXNlcjEzMTczMDAw", "avatar_url": "https://avatars2.githubusercontent.com/u/13173000?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Paul0M", "html_url": "https://github.com/Paul0M", "followers_url": "https://api.github.com/users/Paul0M/followers", "following_url": "https://api.github.com/users/Paul0M/following{/other_user}", "gists_url": "https://api.github.com/users/Paul0M/gists{/gist_id}", "starred_url": "https://api.github.com/users/Paul0M/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Paul0M/subscriptions", "organizations_url": "https://api.github.com/users/Paul0M/orgs", "repos_url": "https://api.github.com/users/Paul0M/repos", "events_url": "https://api.github.com/users/Paul0M/events{/privacy}", "received_events_url": "https://api.github.com/users/Paul0M/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-09-12T06:45:47Z", "updated_at": "2018-09-12T07:12:04Z", "closed_at": "2018-09-12T07:12:03Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<p>OS: ubuntu 1604<br>\nVirtual Env:Conda<br>\nTF Version:1.10<br>\nPython:3.6.6</p>\n<div class=\"highlight highlight-source-python\"><pre>tfe <span class=\"pl-k\">=</span> tf.contrib.eager\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">loss</span>(<span class=\"pl-smi\">inputs</span>, <span class=\"pl-smi\">labels</span>):\n    <span class=\"pl-c1\">print</span>(labels.dtype)\n    logits <span class=\"pl-k\">=</span> model(inputs, <span class=\"pl-v\">training</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>)\n    <span class=\"pl-c1\">print</span>(logits.dtype)\n    <span class=\"pl-k\">return</span> tf.reduce_mean(\n      tf.nn.sigmoid_cross_entropy_with_logits(\n        <span class=\"pl-v\">logits</span><span class=\"pl-k\">=</span>logits,\n        <span class=\"pl-v\">labels</span><span class=\"pl-k\">=</span>labels)\n    )\n\nval_grad_fn <span class=\"pl-k\">=</span> tfe.implicit_value_and_gradients(loss)</pre></div>\n<p>Error: here can be seen the type of logits is float32, same as the requirement of  <a href=\"https://www.tensorflow.org/api_docs/python/tf/nn/sigmoid_cross_entropy_with_logits\" rel=\"nofollow\">sigmoid_cross_entropy_with_logits</a>.<br>\nSo I'm curious where's wrong.</p>\n<pre><code>&lt;dtype: 'int32'&gt;\n&lt;dtype: 'float32'&gt;\nTraceback (most recent call last):\n  File \"model.py\", line 384, in &lt;module&gt;\n    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)\n  File \"/home/ubuntu/hdd1/zip_data/Paul/miniconda3/lib/python3.6/site-packages/tensorflow/python/platform/app.py\", line 125, in run\n    _sys.exit(main(argv))\n  File \"model.py\", line 335, in main\n    train_one_epoch(epoch_i=i, train_data=ds_train, log_interval=FLAGS.log_interval, **model_objects)\n  File \"model.py\", line 264, in train_one_epoch\n    value, grads_and_vars = val_grad_fn((u, i, i_c, ts, hist_c, sl), y)\n  File \"/home/ubuntu/hdd1/zip_data/Paul/miniconda3/lib/python3.6/site-packages/tensorflow/python/eager/backprop.py\", line 203, in grad_fn\n    end_node = f(*args, **kwds)\n  File \"model.py\", line 249, in loss\n    labels=labels)\n  File \"/home/ubuntu/hdd1/zip_data/Paul/miniconda3/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py\", line 181, in sigmoid_cross_entropy_with_logits\n    relu_logits - logits * labels,\n  File \"/home/ubuntu/hdd1/zip_data/Paul/miniconda3/lib/python3.6/site-packages/tensorflow/python/ops/math_ops.py\", line 850, in binary_op_wrapper\n    return func(x, y, name=name)\n  File \"/home/ubuntu/hdd1/zip_data/Paul/miniconda3/lib/python3.6/site-packages/tensorflow/python/ops/math_ops.py\", line 1094, in _mul_dispatch\n    return gen_math_ops.mul(x, y, name=name)\n  File \"/home/ubuntu/hdd1/zip_data/Paul/miniconda3/lib/python3.6/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 4959, in mul\n    _six.raise_from(_core._status_to_exception(e.code, message), None)\n  File \"&lt;string&gt;\", line 3, in raise_from\ntensorflow.python.framework.errors_impl.InvalidArgumentError: cannot compute Mul as input #0 was expected to be a int32 tensor but is a float tensor [Op:Mul] name: logistic_loss/mul/\n</code></pre>", "body_text": "System information\nOS: ubuntu 1604\nVirtual Env:Conda\nTF Version:1.10\nPython:3.6.6\ntfe = tf.contrib.eager\ndef loss(inputs, labels):\n    print(labels.dtype)\n    logits = model(inputs, training=True)\n    print(logits.dtype)\n    return tf.reduce_mean(\n      tf.nn.sigmoid_cross_entropy_with_logits(\n        logits=logits,\n        labels=labels)\n    )\n\nval_grad_fn = tfe.implicit_value_and_gradients(loss)\nError: here can be seen the type of logits is float32, same as the requirement of  sigmoid_cross_entropy_with_logits.\nSo I'm curious where's wrong.\n<dtype: 'int32'>\n<dtype: 'float32'>\nTraceback (most recent call last):\n  File \"model.py\", line 384, in <module>\n    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)\n  File \"/home/ubuntu/hdd1/zip_data/Paul/miniconda3/lib/python3.6/site-packages/tensorflow/python/platform/app.py\", line 125, in run\n    _sys.exit(main(argv))\n  File \"model.py\", line 335, in main\n    train_one_epoch(epoch_i=i, train_data=ds_train, log_interval=FLAGS.log_interval, **model_objects)\n  File \"model.py\", line 264, in train_one_epoch\n    value, grads_and_vars = val_grad_fn((u, i, i_c, ts, hist_c, sl), y)\n  File \"/home/ubuntu/hdd1/zip_data/Paul/miniconda3/lib/python3.6/site-packages/tensorflow/python/eager/backprop.py\", line 203, in grad_fn\n    end_node = f(*args, **kwds)\n  File \"model.py\", line 249, in loss\n    labels=labels)\n  File \"/home/ubuntu/hdd1/zip_data/Paul/miniconda3/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py\", line 181, in sigmoid_cross_entropy_with_logits\n    relu_logits - logits * labels,\n  File \"/home/ubuntu/hdd1/zip_data/Paul/miniconda3/lib/python3.6/site-packages/tensorflow/python/ops/math_ops.py\", line 850, in binary_op_wrapper\n    return func(x, y, name=name)\n  File \"/home/ubuntu/hdd1/zip_data/Paul/miniconda3/lib/python3.6/site-packages/tensorflow/python/ops/math_ops.py\", line 1094, in _mul_dispatch\n    return gen_math_ops.mul(x, y, name=name)\n  File \"/home/ubuntu/hdd1/zip_data/Paul/miniconda3/lib/python3.6/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 4959, in mul\n    _six.raise_from(_core._status_to_exception(e.code, message), None)\n  File \"<string>\", line 3, in raise_from\ntensorflow.python.framework.errors_impl.InvalidArgumentError: cannot compute Mul as input #0 was expected to be a int32 tensor but is a float tensor [Op:Mul] name: logistic_loss/mul/", "body": "### System information\r\nOS: ubuntu 1604\r\nVirtual Env:Conda\r\nTF Version:1.10\r\nPython:3.6.6\r\n\r\n```python\r\ntfe = tf.contrib.eager\r\ndef loss(inputs, labels):\r\n    print(labels.dtype)\r\n    logits = model(inputs, training=True)\r\n    print(logits.dtype)\r\n    return tf.reduce_mean(\r\n      tf.nn.sigmoid_cross_entropy_with_logits(\r\n        logits=logits,\r\n        labels=labels)\r\n    )\r\n\r\nval_grad_fn = tfe.implicit_value_and_gradients(loss)\r\n```\r\nError: here can be seen the type of logits is float32, same as the requirement of  [sigmoid_cross_entropy_with_logits](https://www.tensorflow.org/api_docs/python/tf/nn/sigmoid_cross_entropy_with_logits).   \r\nSo I'm curious where's wrong.\r\n```\r\n<dtype: 'int32'>\r\n<dtype: 'float32'>\r\nTraceback (most recent call last):\r\n  File \"model.py\", line 384, in <module>\r\n    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)\r\n  File \"/home/ubuntu/hdd1/zip_data/Paul/miniconda3/lib/python3.6/site-packages/tensorflow/python/platform/app.py\", line 125, in run\r\n    _sys.exit(main(argv))\r\n  File \"model.py\", line 335, in main\r\n    train_one_epoch(epoch_i=i, train_data=ds_train, log_interval=FLAGS.log_interval, **model_objects)\r\n  File \"model.py\", line 264, in train_one_epoch\r\n    value, grads_and_vars = val_grad_fn((u, i, i_c, ts, hist_c, sl), y)\r\n  File \"/home/ubuntu/hdd1/zip_data/Paul/miniconda3/lib/python3.6/site-packages/tensorflow/python/eager/backprop.py\", line 203, in grad_fn\r\n    end_node = f(*args, **kwds)\r\n  File \"model.py\", line 249, in loss\r\n    labels=labels)\r\n  File \"/home/ubuntu/hdd1/zip_data/Paul/miniconda3/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py\", line 181, in sigmoid_cross_entropy_with_logits\r\n    relu_logits - logits * labels,\r\n  File \"/home/ubuntu/hdd1/zip_data/Paul/miniconda3/lib/python3.6/site-packages/tensorflow/python/ops/math_ops.py\", line 850, in binary_op_wrapper\r\n    return func(x, y, name=name)\r\n  File \"/home/ubuntu/hdd1/zip_data/Paul/miniconda3/lib/python3.6/site-packages/tensorflow/python/ops/math_ops.py\", line 1094, in _mul_dispatch\r\n    return gen_math_ops.mul(x, y, name=name)\r\n  File \"/home/ubuntu/hdd1/zip_data/Paul/miniconda3/lib/python3.6/site-packages/tensorflow/python/ops/gen_math_ops.py\", line 4959, in mul\r\n    _six.raise_from(_core._status_to_exception(e.code, message), None)\r\n  File \"<string>\", line 3, in raise_from\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: cannot compute Mul as input #0 was expected to be a int32 tensor but is a float tensor [Op:Mul] name: logistic_loss/mul/\r\n```\r\n"}