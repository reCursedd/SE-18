{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/264312706", "html_url": "https://github.com/tensorflow/tensorflow/issues/5722#issuecomment-264312706", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5722", "id": 264312706, "node_id": "MDEyOklzc3VlQ29tbWVudDI2NDMxMjcwNg==", "user": {"login": "nmiculinic", "id": 3183610, "node_id": "MDQ6VXNlcjMxODM2MTA=", "avatar_url": "https://avatars0.githubusercontent.com/u/3183610?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nmiculinic", "html_url": "https://github.com/nmiculinic", "followers_url": "https://api.github.com/users/nmiculinic/followers", "following_url": "https://api.github.com/users/nmiculinic/following{/other_user}", "gists_url": "https://api.github.com/users/nmiculinic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nmiculinic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nmiculinic/subscriptions", "organizations_url": "https://api.github.com/users/nmiculinic/orgs", "repos_url": "https://api.github.com/users/nmiculinic/repos", "events_url": "https://api.github.com/users/nmiculinic/events{/privacy}", "received_events_url": "https://api.github.com/users/nmiculinic/received_events", "type": "User", "site_admin": false}, "created_at": "2016-12-01T22:16:33Z", "updated_at": "2016-12-01T22:16:33Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=23068\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/yaroslavvb\">@yaroslavvb</a>  I've tried to implement double buffering and run some test: Full code is here: <a href=\"http://pastebin.com/Rcg76XPM\" rel=\"nofollow\">http://pastebin.com/Rcg76XPM</a></p>\n<ol>\n<li>CPU only</li>\n</ol>\n<p>Without buffering, that is async prefetching:<br>\n<a href=\"https://i.imgur.com/DWS3OKZ.png\" rel=\"nofollow\">https://i.imgur.com/DWS3OKZ.png</a></p>\n<p>With buffering:<br>\n<a href=\"https://i.imgur.com/gi4wgUu.png\" rel=\"nofollow\">https://i.imgur.com/gi4wgUu.png</a></p>\n<p>As you can see there's performance improvement when queue element is already loaded in memory even for CPU... not sure why</p>\n<ol start=\"2\">\n<li>GPU</li>\n</ol>\n<p>With GPU this is even more pronounced due to data copying:<br>\nWithout buffer:<br>\n<a href=\"https://i.imgur.com/v7sIKF8.png\" rel=\"nofollow\">https://i.imgur.com/v7sIKF8.png</a><br>\nWith Buffer:<br>\n<a href=\"https://i.imgur.com/j6bF67e.png\" rel=\"nofollow\">https://i.imgur.com/j6bF67e.png</a></p>\n<p>I'm not sure why is only dequeue async in my code, not also data transfer. If somebody could give me some feedback I'd much appreciate it. Nevertheless speed improvement is obvious and immediate.</p>", "body_text": "@yaroslavvb  I've tried to implement double buffering and run some test: Full code is here: http://pastebin.com/Rcg76XPM\n\nCPU only\n\nWithout buffering, that is async prefetching:\nhttps://i.imgur.com/DWS3OKZ.png\nWith buffering:\nhttps://i.imgur.com/gi4wgUu.png\nAs you can see there's performance improvement when queue element is already loaded in memory even for CPU... not sure why\n\nGPU\n\nWith GPU this is even more pronounced due to data copying:\nWithout buffer:\nhttps://i.imgur.com/v7sIKF8.png\nWith Buffer:\nhttps://i.imgur.com/j6bF67e.png\nI'm not sure why is only dequeue async in my code, not also data transfer. If somebody could give me some feedback I'd much appreciate it. Nevertheless speed improvement is obvious and immediate.", "body": "@yaroslavvb  I've tried to implement double buffering and run some test: Full code is here: http://pastebin.com/Rcg76XPM\r\n\r\n1) CPU only\r\n\r\nWithout buffering, that is async prefetching:\r\nhttps://i.imgur.com/DWS3OKZ.png\r\n\r\nWith buffering:\r\nhttps://i.imgur.com/gi4wgUu.png\r\n\r\nAs you can see there's performance improvement when queue element is already loaded in memory even for CPU... not sure why\r\n\r\n2) GPU\r\n\r\nWith GPU this is even more pronounced due to data copying:\r\nWithout buffer:\r\nhttps://i.imgur.com/v7sIKF8.png\r\nWith Buffer:\r\nhttps://i.imgur.com/j6bF67e.png\r\n\r\nI'm not sure why is only dequeue async in my code, not also data transfer. If somebody could give me some feedback I'd much appreciate it. Nevertheless speed improvement is obvious and immediate."}