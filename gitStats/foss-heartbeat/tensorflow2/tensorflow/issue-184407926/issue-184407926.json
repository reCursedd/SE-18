{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5106", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5106/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5106/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5106/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/5106", "id": 184407926, "node_id": "MDU6SXNzdWUxODQ0MDc5MjY=", "number": 5106, "title": "Problems with TF_GraphGetTensorNumDims when applied to \"Variable\" operations", "user": {"login": "juraj-bicikl", "id": 22090096, "node_id": "MDQ6VXNlcjIyMDkwMDk2", "avatar_url": "https://avatars1.githubusercontent.com/u/22090096?v=4", "gravatar_id": "", "url": "https://api.github.com/users/juraj-bicikl", "html_url": "https://github.com/juraj-bicikl", "followers_url": "https://api.github.com/users/juraj-bicikl/followers", "following_url": "https://api.github.com/users/juraj-bicikl/following{/other_user}", "gists_url": "https://api.github.com/users/juraj-bicikl/gists{/gist_id}", "starred_url": "https://api.github.com/users/juraj-bicikl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/juraj-bicikl/subscriptions", "organizations_url": "https://api.github.com/users/juraj-bicikl/orgs", "repos_url": "https://api.github.com/users/juraj-bicikl/repos", "events_url": "https://api.github.com/users/juraj-bicikl/events{/privacy}", "received_events_url": "https://api.github.com/users/juraj-bicikl/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asimshankar", "id": 16018, "node_id": "MDQ6VXNlcjE2MDE4", "avatar_url": "https://avatars2.githubusercontent.com/u/16018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asimshankar", "html_url": "https://github.com/asimshankar", "followers_url": "https://api.github.com/users/asimshankar/followers", "following_url": "https://api.github.com/users/asimshankar/following{/other_user}", "gists_url": "https://api.github.com/users/asimshankar/gists{/gist_id}", "starred_url": "https://api.github.com/users/asimshankar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asimshankar/subscriptions", "organizations_url": "https://api.github.com/users/asimshankar/orgs", "repos_url": "https://api.github.com/users/asimshankar/repos", "events_url": "https://api.github.com/users/asimshankar/events{/privacy}", "received_events_url": "https://api.github.com/users/asimshankar/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2016-10-21T06:19:58Z", "updated_at": "2016-10-28T04:39:13Z", "closed_at": "2016-10-28T04:39:13Z", "author_association": "NONE", "body_html": "<p>For some reason, when applying <em>TF_GraphGetTensorNumDims</em> to a \"Variable\" operation,<br>\nthe functions returns -1, even though the shape and number of dimensions are<br>\nwell defined.</p>\n<p>A simple example:</p>\n<div class=\"highlight highlight-source-c++\"><pre>#<span class=\"pl-k\">include</span> <span class=\"pl-s\"><span class=\"pl-pds\">&lt;</span>string<span class=\"pl-pds\">&gt;</span></span>\n#<span class=\"pl-k\">include</span> <span class=\"pl-s\"><span class=\"pl-pds\">&lt;</span>iostream<span class=\"pl-pds\">&gt;</span></span>\n#<span class=\"pl-k\">include</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>tensorflow/c/c_api.h<span class=\"pl-pds\">\"</span></span>\n\n<span class=\"pl-k\">int</span> <span class=\"pl-en\">main</span>() {\n\n  <span class=\"pl-c\"><span class=\"pl-c\">//</span> creating a TF_Graph</span>\n  TF_Graph* graph = <span class=\"pl-c1\">TF_NewGraph</span>();\n\n  <span class=\"pl-c\"><span class=\"pl-c\">//</span> creating a \"Variable\" operation</span>\n  TF_OperationDescription* opDesc = <span class=\"pl-c1\">TF_NewOperation</span>(graph, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Variable<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>w<span class=\"pl-pds\">\"</span></span>);\n  <span class=\"pl-k\">const</span> <span class=\"pl-k\">long</span> <span class=\"pl-k\">long</span> dims[<span class=\"pl-c1\">2</span>] = {<span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">2</span>};\n  <span class=\"pl-c1\">TF_SetAttrShape</span>(opDesc, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>shape<span class=\"pl-pds\">\"</span></span>, dims, <span class=\"pl-c1\">2</span>);\n  <span class=\"pl-c1\">TF_SetAttrType</span>(opDesc, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>dtype<span class=\"pl-pds\">\"</span></span>, TF_DOUBLE);\n\n  TF_Status* status = <span class=\"pl-c1\">TF_NewStatus</span>();\n  TF_Operation* w = <span class=\"pl-c1\">TF_FinishOperation</span>(opDesc, status);\n  std::string finish_message = <span class=\"pl-c1\">std::string</span>(<span class=\"pl-c1\">TF_Message</span>(status));\n\n  TF_Port w_port = {w, <span class=\"pl-c1\">0</span>};\n  <span class=\"pl-k\">int</span> w_num_dims = <span class=\"pl-c1\">TF_GraphGetTensorNumDims</span>(graph, w_port, status);\n  std::string num_dims_message = <span class=\"pl-c1\">std::string</span>(<span class=\"pl-c1\">TF_Message</span>(status));\n\n  std::cout &lt;&lt; <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>finish_message: <span class=\"pl-pds\">\"</span></span> &lt;&lt; finish_message &lt;&lt; <span class=\"pl-s\"><span class=\"pl-pds\">'</span><span class=\"pl-cce\">\\n</span><span class=\"pl-pds\">'</span></span>;\n  std::cout &lt;&lt; <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>w_num_dims: <span class=\"pl-pds\">\"</span></span> &lt;&lt; w_num_dims &lt;&lt; <span class=\"pl-s\"><span class=\"pl-pds\">'</span><span class=\"pl-cce\">\\n</span><span class=\"pl-pds\">'</span></span>;\n  std::cout &lt;&lt; <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>num_dims_message: <span class=\"pl-pds\">\"</span></span> &lt;&lt; num_dims_message &lt;&lt; <span class=\"pl-s\"><span class=\"pl-pds\">'</span><span class=\"pl-cce\">\\n</span><span class=\"pl-pds\">'</span></span>;\n\n  <span class=\"pl-c1\">TF_DeleteGraph</span>(graph);\n  <span class=\"pl-c1\">TF_DeleteStatus</span>(status);\n\n  <span class=\"pl-k\">return</span> <span class=\"pl-c1\">0</span>;\n}</pre></div>\n<p>The program returns:</p>\n<pre><code>finish_message:\nw_num_dims: -1\nnum_dims_message:\n</code></pre>\n<p>However, if I do the same for a \"Placeholder\" operation (by simply replacing<br>\n\"Variable\" with \"Placeholder), the returned number of dimensions is 2 (as expected).</p>\n<p>It seems to me like a bug. It might be related to the previous issue that<br>\nI reported (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"183831878\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/5059\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/5059/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/5059\">#5059</a>), since the inability to determine the shape of a tensor at a particular node propagates through the graph.</p>", "body_text": "For some reason, when applying TF_GraphGetTensorNumDims to a \"Variable\" operation,\nthe functions returns -1, even though the shape and number of dimensions are\nwell defined.\nA simple example:\n#include <string>\n#include <iostream>\n#include \"tensorflow/c/c_api.h\"\n\nint main() {\n\n  // creating a TF_Graph\n  TF_Graph* graph = TF_NewGraph();\n\n  // creating a \"Variable\" operation\n  TF_OperationDescription* opDesc = TF_NewOperation(graph, \"Variable\", \"w\");\n  const long long dims[2] = {2, 2};\n  TF_SetAttrShape(opDesc, \"shape\", dims, 2);\n  TF_SetAttrType(opDesc, \"dtype\", TF_DOUBLE);\n\n  TF_Status* status = TF_NewStatus();\n  TF_Operation* w = TF_FinishOperation(opDesc, status);\n  std::string finish_message = std::string(TF_Message(status));\n\n  TF_Port w_port = {w, 0};\n  int w_num_dims = TF_GraphGetTensorNumDims(graph, w_port, status);\n  std::string num_dims_message = std::string(TF_Message(status));\n\n  std::cout << \"finish_message: \" << finish_message << '\\n';\n  std::cout << \"w_num_dims: \" << w_num_dims << '\\n';\n  std::cout << \"num_dims_message: \" << num_dims_message << '\\n';\n\n  TF_DeleteGraph(graph);\n  TF_DeleteStatus(status);\n\n  return 0;\n}\nThe program returns:\nfinish_message:\nw_num_dims: -1\nnum_dims_message:\n\nHowever, if I do the same for a \"Placeholder\" operation (by simply replacing\n\"Variable\" with \"Placeholder), the returned number of dimensions is 2 (as expected).\nIt seems to me like a bug. It might be related to the previous issue that\nI reported (#5059), since the inability to determine the shape of a tensor at a particular node propagates through the graph.", "body": "For some reason, when applying _TF_GraphGetTensorNumDims_ to a \"Variable\" operation,\nthe functions returns -1, even though the shape and number of dimensions are \nwell defined.\n\nA simple example:\n\n``` C++\n#include <string>\n#include <iostream>\n#include \"tensorflow/c/c_api.h\"\n\nint main() {\n\n  // creating a TF_Graph\n  TF_Graph* graph = TF_NewGraph();\n\n  // creating a \"Variable\" operation\n  TF_OperationDescription* opDesc = TF_NewOperation(graph, \"Variable\", \"w\");\n  const long long dims[2] = {2, 2};\n  TF_SetAttrShape(opDesc, \"shape\", dims, 2);\n  TF_SetAttrType(opDesc, \"dtype\", TF_DOUBLE);\n\n  TF_Status* status = TF_NewStatus();\n  TF_Operation* w = TF_FinishOperation(opDesc, status);\n  std::string finish_message = std::string(TF_Message(status));\n\n  TF_Port w_port = {w, 0};\n  int w_num_dims = TF_GraphGetTensorNumDims(graph, w_port, status);\n  std::string num_dims_message = std::string(TF_Message(status));\n\n  std::cout << \"finish_message: \" << finish_message << '\\n';\n  std::cout << \"w_num_dims: \" << w_num_dims << '\\n';\n  std::cout << \"num_dims_message: \" << num_dims_message << '\\n';\n\n  TF_DeleteGraph(graph);\n  TF_DeleteStatus(status);\n\n  return 0;\n}\n```\n\nThe program returns:\n\n```\nfinish_message:\nw_num_dims: -1\nnum_dims_message:\n```\n\nHowever, if I do the same for a \"Placeholder\" operation (by simply replacing \n\"Variable\" with \"Placeholder), the returned number of dimensions is 2 (as expected).\n\nIt seems to me like a bug. It might be related to the previous issue that \nI reported (#5059), since the inability to determine the shape of a tensor at a particular node propagates through the graph.\n"}