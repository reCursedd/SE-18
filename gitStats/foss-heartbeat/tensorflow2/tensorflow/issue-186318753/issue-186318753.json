{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5303", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5303/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5303/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5303/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/5303", "id": 186318753, "node_id": "MDU6SXNzdWUxODYzMTg3NTM=", "number": 5303, "title": "Error compiling on ARM with -mfpu=neon: can\u2019t find a register in class \u2018LO_REGS\u2019 while reloading \u2018asm\u2019", "user": {"login": "dprylipko", "id": 15672564, "node_id": "MDQ6VXNlcjE1NjcyNTY0", "avatar_url": "https://avatars0.githubusercontent.com/u/15672564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dprylipko", "html_url": "https://github.com/dprylipko", "followers_url": "https://api.github.com/users/dprylipko/followers", "following_url": "https://api.github.com/users/dprylipko/following{/other_user}", "gists_url": "https://api.github.com/users/dprylipko/gists{/gist_id}", "starred_url": "https://api.github.com/users/dprylipko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dprylipko/subscriptions", "organizations_url": "https://api.github.com/users/dprylipko/orgs", "repos_url": "https://api.github.com/users/dprylipko/repos", "events_url": "https://api.github.com/users/dprylipko/events{/privacy}", "received_events_url": "https://api.github.com/users/dprylipko/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473173351, "node_id": "MDU6TGFiZWw0NzMxNzMzNTE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:build/install", "name": "type:build/install", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "maciekcc", "id": 15237924, "node_id": "MDQ6VXNlcjE1MjM3OTI0", "avatar_url": "https://avatars0.githubusercontent.com/u/15237924?v=4", "gravatar_id": "", "url": "https://api.github.com/users/maciekcc", "html_url": "https://github.com/maciekcc", "followers_url": "https://api.github.com/users/maciekcc/followers", "following_url": "https://api.github.com/users/maciekcc/following{/other_user}", "gists_url": "https://api.github.com/users/maciekcc/gists{/gist_id}", "starred_url": "https://api.github.com/users/maciekcc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/maciekcc/subscriptions", "organizations_url": "https://api.github.com/users/maciekcc/orgs", "repos_url": "https://api.github.com/users/maciekcc/repos", "events_url": "https://api.github.com/users/maciekcc/events{/privacy}", "received_events_url": "https://api.github.com/users/maciekcc/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "maciekcc", "id": 15237924, "node_id": "MDQ6VXNlcjE1MjM3OTI0", "avatar_url": "https://avatars0.githubusercontent.com/u/15237924?v=4", "gravatar_id": "", "url": "https://api.github.com/users/maciekcc", "html_url": "https://github.com/maciekcc", "followers_url": "https://api.github.com/users/maciekcc/followers", "following_url": "https://api.github.com/users/maciekcc/following{/other_user}", "gists_url": "https://api.github.com/users/maciekcc/gists{/gist_id}", "starred_url": "https://api.github.com/users/maciekcc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/maciekcc/subscriptions", "organizations_url": "https://api.github.com/users/maciekcc/orgs", "repos_url": "https://api.github.com/users/maciekcc/repos", "events_url": "https://api.github.com/users/maciekcc/events{/privacy}", "received_events_url": "https://api.github.com/users/maciekcc/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 18, "created_at": "2016-10-31T15:47:39Z", "updated_at": "2017-08-08T17:55:46Z", "closed_at": "2017-06-16T22:07:16Z", "author_association": "NONE", "body_html": "<p>Hi,</p>\n<p>I am trying to compile TF for an ARM device and to exploit NEON-related optimizations.<br>\nBasically, I follow these instructions for PI (my device is a Sabre Board, not PI): <a href=\"https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/makefile\">https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/makefile</a></p>\n<p>but with a bit different flags, namely:<br>\n<code>make -f tensorflow/contrib/makefile/Makefile OPTFLAGS=\"-Ofast -mfpu=neon -funsafe-math-optimizations -ftree-vectorize\" HOST_OS=LINUX</code></p>\n<p>because my CPU does not support vfpv4:</p>\n<pre><code>cat /proc/cpuinfo\nprocessor\t: 0\nmodel name\t: ARMv7 Processor rev 10 (v7l)\nBogoMIPS\t: 7.54\nFeatures\t: half thumb fastmult vfp edsp neon vfpv3 tls vfpd32\nCPU implementer\t: 0x41\nCPU architecture: 7\nCPU variant\t: 0x2\nCPU part\t: 0xc09\nCPU revision\t: 10\n</code></pre>\n<p>The error I got:</p>\n<pre><code>/root/tensorflow_exp/tensorflow/contrib/makefile/downloads/gemmlowp/meta/streams_arm_32.h: In static member function \u2018static void gemmlowp::meta::GemmExecutorPackLHS::ExecuteDispatch3D(const P&amp;) [with P = gemmlowp::meta::GemmParams&lt;unsigned char, int, gemmlowp::meta::ColumnMajorWithSum, gemmlowp::meta::RowMajorWithSum, gemmlowp::meta::QuantizedStaticPreprocessedAsInt32, gemmlowp::meta::RowMajor&gt;; int m = 1; int n = 8; int k = 8; int m_leftovers = 0; int n_leftovers = 7; int k_leftovers = 4]\u2019:\n/root/tensorflow_exp/tensorflow/contrib/makefile/downloads/gemmlowp/meta/streams_arm_32.h:4211:59: error: can\u2019t find a register in class \u2018LO_REGS\u2019 while reloading \u2018asm\u2019\n         \"d25\", \"d26\", \"d27\", \"d28\", \"d29\", \"cc\", \"memory\");\n                                                           ^\n/root/tensorflow_exp/tensorflow/contrib/makefile/downloads/gemmlowp/meta/streams_arm_32.h:4211:59: error: \u2018asm\u2019 operand has impossible constraints\nmake: *** [/root/tensorflow_exp/tensorflow/contrib/makefile/gen/obj/tensorflow/core/kernels/meta_support.o] Error 1\n</code></pre>\n<p>As far as I understand, it complains about too little registers, which wonders me, since ARM has 16 registers. If I remove <code> -mfpu=neon</code> flag, everything works like a charm.</p>\n<p>I would greatly appreciated for any suggestions.</p>\n<h3>Environment info</h3>\n<p>Ubuntu 14.04.4 LTS<br>\n<code>Linux sabresd 4.1.15-1.0.0+g3924425 #1 SMP PREEMPT Sun Mar 13 14:09:51 CST 2016 armv7l armv7l armv7l GNU/Linux</code></p>\n<p>Installed version of CUDA and cuDNN:<br>\nNo CUDA installed<br>\nTF commit hash: <code>1fcd6d1294564066c6f92b121a3aaf4ed186dc1a</code></p>", "body_text": "Hi,\nI am trying to compile TF for an ARM device and to exploit NEON-related optimizations.\nBasically, I follow these instructions for PI (my device is a Sabre Board, not PI): https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/makefile\nbut with a bit different flags, namely:\nmake -f tensorflow/contrib/makefile/Makefile OPTFLAGS=\"-Ofast -mfpu=neon -funsafe-math-optimizations -ftree-vectorize\" HOST_OS=LINUX\nbecause my CPU does not support vfpv4:\ncat /proc/cpuinfo\nprocessor\t: 0\nmodel name\t: ARMv7 Processor rev 10 (v7l)\nBogoMIPS\t: 7.54\nFeatures\t: half thumb fastmult vfp edsp neon vfpv3 tls vfpd32\nCPU implementer\t: 0x41\nCPU architecture: 7\nCPU variant\t: 0x2\nCPU part\t: 0xc09\nCPU revision\t: 10\n\nThe error I got:\n/root/tensorflow_exp/tensorflow/contrib/makefile/downloads/gemmlowp/meta/streams_arm_32.h: In static member function \u2018static void gemmlowp::meta::GemmExecutorPackLHS::ExecuteDispatch3D(const P&) [with P = gemmlowp::meta::GemmParams<unsigned char, int, gemmlowp::meta::ColumnMajorWithSum, gemmlowp::meta::RowMajorWithSum, gemmlowp::meta::QuantizedStaticPreprocessedAsInt32, gemmlowp::meta::RowMajor>; int m = 1; int n = 8; int k = 8; int m_leftovers = 0; int n_leftovers = 7; int k_leftovers = 4]\u2019:\n/root/tensorflow_exp/tensorflow/contrib/makefile/downloads/gemmlowp/meta/streams_arm_32.h:4211:59: error: can\u2019t find a register in class \u2018LO_REGS\u2019 while reloading \u2018asm\u2019\n         \"d25\", \"d26\", \"d27\", \"d28\", \"d29\", \"cc\", \"memory\");\n                                                           ^\n/root/tensorflow_exp/tensorflow/contrib/makefile/downloads/gemmlowp/meta/streams_arm_32.h:4211:59: error: \u2018asm\u2019 operand has impossible constraints\nmake: *** [/root/tensorflow_exp/tensorflow/contrib/makefile/gen/obj/tensorflow/core/kernels/meta_support.o] Error 1\n\nAs far as I understand, it complains about too little registers, which wonders me, since ARM has 16 registers. If I remove  -mfpu=neon flag, everything works like a charm.\nI would greatly appreciated for any suggestions.\nEnvironment info\nUbuntu 14.04.4 LTS\nLinux sabresd 4.1.15-1.0.0+g3924425 #1 SMP PREEMPT Sun Mar 13 14:09:51 CST 2016 armv7l armv7l armv7l GNU/Linux\nInstalled version of CUDA and cuDNN:\nNo CUDA installed\nTF commit hash: 1fcd6d1294564066c6f92b121a3aaf4ed186dc1a", "body": "Hi,\r\n\r\nI am trying to compile TF for an ARM device and to exploit NEON-related optimizations.\r\nBasically, I follow these instructions for PI (my device is a Sabre Board, not PI): https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/makefile\r\n\r\nbut with a bit different flags, namely:\r\n`make -f tensorflow/contrib/makefile/Makefile OPTFLAGS=\"-Ofast -mfpu=neon -funsafe-math-optimizations -ftree-vectorize\" HOST_OS=LINUX`\r\n\r\nbecause my CPU does not support vfpv4:\r\n\r\n```\r\ncat /proc/cpuinfo\r\nprocessor\t: 0\r\nmodel name\t: ARMv7 Processor rev 10 (v7l)\r\nBogoMIPS\t: 7.54\r\nFeatures\t: half thumb fastmult vfp edsp neon vfpv3 tls vfpd32\r\nCPU implementer\t: 0x41\r\nCPU architecture: 7\r\nCPU variant\t: 0x2\r\nCPU part\t: 0xc09\r\nCPU revision\t: 10\r\n```\r\n\r\nThe error I got:\r\n```\r\n/root/tensorflow_exp/tensorflow/contrib/makefile/downloads/gemmlowp/meta/streams_arm_32.h: In static member function \u2018static void gemmlowp::meta::GemmExecutorPackLHS::ExecuteDispatch3D(const P&) [with P = gemmlowp::meta::GemmParams<unsigned char, int, gemmlowp::meta::ColumnMajorWithSum, gemmlowp::meta::RowMajorWithSum, gemmlowp::meta::QuantizedStaticPreprocessedAsInt32, gemmlowp::meta::RowMajor>; int m = 1; int n = 8; int k = 8; int m_leftovers = 0; int n_leftovers = 7; int k_leftovers = 4]\u2019:\r\n/root/tensorflow_exp/tensorflow/contrib/makefile/downloads/gemmlowp/meta/streams_arm_32.h:4211:59: error: can\u2019t find a register in class \u2018LO_REGS\u2019 while reloading \u2018asm\u2019\r\n         \"d25\", \"d26\", \"d27\", \"d28\", \"d29\", \"cc\", \"memory\");\r\n                                                           ^\r\n/root/tensorflow_exp/tensorflow/contrib/makefile/downloads/gemmlowp/meta/streams_arm_32.h:4211:59: error: \u2018asm\u2019 operand has impossible constraints\r\nmake: *** [/root/tensorflow_exp/tensorflow/contrib/makefile/gen/obj/tensorflow/core/kernels/meta_support.o] Error 1\r\n```\r\n\r\nAs far as I understand, it complains about too little registers, which wonders me, since ARM has 16 registers. If I remove ` -mfpu=neon` flag, everything works like a charm. \r\n\r\nI would greatly appreciated for any suggestions.\r\n\r\n### Environment info\r\nUbuntu 14.04.4 LTS\r\n`Linux sabresd 4.1.15-1.0.0+g3924425 #1 SMP PREEMPT Sun Mar 13 14:09:51 CST 2016 armv7l armv7l armv7l GNU/Linux`\r\n\r\nInstalled version of CUDA and cuDNN: \r\nNo CUDA installed\r\nTF commit hash: `1fcd6d1294564066c6f92b121a3aaf4ed186dc1a`\r\n"}