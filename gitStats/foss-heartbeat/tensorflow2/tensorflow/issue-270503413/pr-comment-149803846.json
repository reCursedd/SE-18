{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/149803846", "pull_request_review_id": 75257856, "id": 149803846, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE0OTgwMzg0Ng==", "diff_hunk": "@@ -373,12 +373,67 @@ $(MARCH_OPTION) \\\n \tifdef ENABLE_EXPERIMENTAL_HEXNN_OPS\n \t\tCXXFLAGS += -DENABLE_EXPERIMENTAL_HEXNN_OPS\n \tendif\n-\t\n-\tOBJDIR := $(OBJDIR)android_$(ANDROID_ARCH)/\n-\tLIBDIR := $(LIBDIR)android_$(ANDROID_ARCH)/\n-\tBINDIR := $(BINDIR)android_$(ANDROID_ARCH)/\n-\tDEPDIR := $(DEPDIR)android_$(ANDROID_ARCH)/\n \n+\tifeq ($(BUILD_FOR_TEGRA),1)\n+\t\tNVCC := $(JETPACK)/cuda-8.0/bin/nvcc\n+\t\tNVCCFLAGS := -x=cu -D__CUDACC__ -DNVCC -DNVIDIA_TEGRA -ccbin $(NDK_ROOT)/toolchains/$(TOOLCHAIN)/prebuilt/$(ANDROID_HOST_OS_ARCH)/bin/$(BIN_PREFIX)-g++ --std c++11 --expt-relaxed-constexpr -m64 -gencode arch=compute_53,\\\"code=sm_53\\\" -gencode arch=compute_62,\\\"code=sm_62\\\" -DEIGEN_AVOID_STL_ARRAY -DTENSORFLOW_USE_EIGEN_THREADPOOL -DLANG_CXX11 -DEIGEN_HAS_C99_MATH -DGOOGLE_CUDA=1 -DTF_EXTRA_CUDA_CAPABILITIES=5.3\n+\t\tCXXFLAGS4NVCC =\\\n+-DIS_SLIM_BUILD \\\n+-DNVIDIA_TEGRA \\\n+-fno-exceptions \\\n+-DNDEBUG $(OPTFLAGS) \\\n+-march=armv8-a \\\n+-fPIE \\\n+--sysroot $(NDK_ROOT)/platforms/android-21/arch-arm64\n+\n+\t\tCXXFLAGS +=\\\n+-DGOOGLE_CUDA=1 \\\n+-DNVIDIA_TEGRA \\\n+-DEIGEN_AVOID_STL_ARRAY \\\n+-DEIGEN_HAS_C99_MATH \\\n+-DLANG_CXX11 -DTENSORFLOW_USE_EIGEN_THREADPOOL -DTF_EXTRA_CUDA_CAPABILITIES=5.3\n+\n+\t\tINCLUDES += \\\n+-Itensorflow/core/kernels \\\n+-I$(JETPACK)/cuda-8.0/include \\\n+-I$(JETPACK) \\\n+-I$(JETPACK)/cuDNN/aarch64 \\\n+-I$(JETPACK)/cuda-8.0/extras/CUPTI/include \\\n+-I. \\\n+-Itegra \\\n+-Itegra/external/cub_archive/cub/device", "path": "tensorflow/contrib/makefile/Makefile", "position": null, "original_position": 37, "commit_id": "a73f5b2fd337dc5b9e95ef7dce8074df406014c0", "original_commit_id": "3caf088047f7117f5d2f70fc1d40419b28772d68", "user": {"login": "lihanchen", "id": 5497974, "node_id": "MDQ6VXNlcjU0OTc5NzQ=", "avatar_url": "https://avatars2.githubusercontent.com/u/5497974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lihanchen", "html_url": "https://github.com/lihanchen", "followers_url": "https://api.github.com/users/lihanchen/followers", "following_url": "https://api.github.com/users/lihanchen/following{/other_user}", "gists_url": "https://api.github.com/users/lihanchen/gists{/gist_id}", "starred_url": "https://api.github.com/users/lihanchen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lihanchen/subscriptions", "organizations_url": "https://api.github.com/users/lihanchen/orgs", "repos_url": "https://api.github.com/users/lihanchen/repos", "events_url": "https://api.github.com/users/lihanchen/events{/privacy}", "received_events_url": "https://api.github.com/users/lihanchen/received_events", "type": "User", "site_admin": false}, "body": "-I. \\ can be removed.\r\n\r\n-I$(JETPACK)/cuda-8.0/extras/CUPTI/include and libcupti.so is used by tensorflow/core/platform/default/gpu_tracer.cc. If we don\u2019t need gpu_tracer.cc we can remove this.\r\n\r\n+-Itegra \\ contains cuda_config.h is written by google. I don't think it plays any practical role, but it is included in many CUDA source files.\r\n\r\n+-Itegra/external/cub_archive/cub/device is a lot of cuda headers.\r\nMost of them can be found in Jetpack, but the way TF code include headers makes it unable to use the copy in Jetpack\r\nFor example, \r\ntensorflow/core/kernels/depthwise_conv_op_gpu.cu.cc:25: #include \"external/cub_archive/cub/util_ptx.cuh\"\r\nThere is a util.ptx.cuh in Jetpack_Android_3.0/cuda-8.0/targets/aarch64-linux-androideabi/include/thrust/system/cuda/detail/cub/util_ptx.cuh\r\nHowever, I can\u2019t handle the path in the inclusion \u201cexternal/cub_archive/\u201d.\r\n\r\nAlso, I notice there are at least two cuh files that TF needs but don\u2019t exists in Jetpack.\r\ntegra/external2/cub_archive/cub/device/device_segmented_radix_sort.cuh\r\ntegra/external2/cub_archive/cub/device/device_segmented_reduce.cuh.cuh\r\n\r\n", "created_at": "2017-11-08T21:36:49Z", "updated_at": "2018-01-04T19:32:46Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/14167#discussion_r149803846", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/14167", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/149803846"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/14167#discussion_r149803846"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/14167"}}, "body_html": "<p>-I. \\ can be removed.</p>\n<p>-I$(JETPACK)/cuda-8.0/extras/CUPTI/include and libcupti.so is used by tensorflow/core/platform/default/gpu_tracer.cc. If we don\u2019t need gpu_tracer.cc we can remove this.</p>\n<p>+-Itegra \\ contains cuda_config.h is written by google. I don't think it plays any practical role, but it is included in many CUDA source files.</p>\n<p>+-Itegra/external/cub_archive/cub/device is a lot of cuda headers.<br>\nMost of them can be found in Jetpack, but the way TF code include headers makes it unable to use the copy in Jetpack<br>\nFor example,<br>\ntensorflow/core/kernels/depthwise_conv_op_gpu.cu.cc:25: #include \"external/cub_archive/cub/util_ptx.cuh\"<br>\nThere is a util.ptx.cuh in Jetpack_Android_3.0/cuda-8.0/targets/aarch64-linux-androideabi/include/thrust/system/cuda/detail/cub/util_ptx.cuh<br>\nHowever, I can\u2019t handle the path in the inclusion \u201cexternal/cub_archive/\u201d.</p>\n<p>Also, I notice there are at least two cuh files that TF needs but don\u2019t exists in Jetpack.<br>\ntegra/external2/cub_archive/cub/device/device_segmented_radix_sort.cuh<br>\ntegra/external2/cub_archive/cub/device/device_segmented_reduce.cuh.cuh</p>", "body_text": "-I. \\ can be removed.\n-I$(JETPACK)/cuda-8.0/extras/CUPTI/include and libcupti.so is used by tensorflow/core/platform/default/gpu_tracer.cc. If we don\u2019t need gpu_tracer.cc we can remove this.\n+-Itegra \\ contains cuda_config.h is written by google. I don't think it plays any practical role, but it is included in many CUDA source files.\n+-Itegra/external/cub_archive/cub/device is a lot of cuda headers.\nMost of them can be found in Jetpack, but the way TF code include headers makes it unable to use the copy in Jetpack\nFor example,\ntensorflow/core/kernels/depthwise_conv_op_gpu.cu.cc:25: #include \"external/cub_archive/cub/util_ptx.cuh\"\nThere is a util.ptx.cuh in Jetpack_Android_3.0/cuda-8.0/targets/aarch64-linux-androideabi/include/thrust/system/cuda/detail/cub/util_ptx.cuh\nHowever, I can\u2019t handle the path in the inclusion \u201cexternal/cub_archive/\u201d.\nAlso, I notice there are at least two cuh files that TF needs but don\u2019t exists in Jetpack.\ntegra/external2/cub_archive/cub/device/device_segmented_radix_sort.cuh\ntegra/external2/cub_archive/cub/device/device_segmented_reduce.cuh.cuh", "in_reply_to_id": 148647994}