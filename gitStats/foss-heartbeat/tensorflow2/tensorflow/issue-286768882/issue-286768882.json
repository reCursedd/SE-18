{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15946", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15946/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15946/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15946/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/15946", "id": 286768882, "node_id": "MDExOlB1bGxSZXF1ZXN0MTYxNjQ1NDUx", "number": 15946, "title": "Support for large number of classes when using tf.metrics.mean_per_class_accuracy()", "user": {"login": "clemens-schulz", "id": 1083960, "node_id": "MDQ6VXNlcjEwODM5NjA=", "avatar_url": "https://avatars2.githubusercontent.com/u/1083960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clemens-schulz", "html_url": "https://github.com/clemens-schulz", "followers_url": "https://api.github.com/users/clemens-schulz/followers", "following_url": "https://api.github.com/users/clemens-schulz/following{/other_user}", "gists_url": "https://api.github.com/users/clemens-schulz/gists{/gist_id}", "starred_url": "https://api.github.com/users/clemens-schulz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clemens-schulz/subscriptions", "organizations_url": "https://api.github.com/users/clemens-schulz/orgs", "repos_url": "https://api.github.com/users/clemens-schulz/repos", "events_url": "https://api.github.com/users/clemens-schulz/events{/privacy}", "received_events_url": "https://api.github.com/users/clemens-schulz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 419840263, "node_id": "MDU6TGFiZWw0MTk4NDAyNjM=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/awaiting%20testing%20(then%20merge)", "name": "awaiting testing (then merge)", "color": "c2e0c6", "default": false}, {"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}, {"id": 703698475, "node_id": "MDU6TGFiZWw3MDM2OTg0NzU=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/kokoro:run", "name": "kokoro:run", "color": "bfdadc", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "rmlarsen", "id": 16907534, "node_id": "MDQ6VXNlcjE2OTA3NTM0", "avatar_url": "https://avatars2.githubusercontent.com/u/16907534?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rmlarsen", "html_url": "https://github.com/rmlarsen", "followers_url": "https://api.github.com/users/rmlarsen/followers", "following_url": "https://api.github.com/users/rmlarsen/following{/other_user}", "gists_url": "https://api.github.com/users/rmlarsen/gists{/gist_id}", "starred_url": "https://api.github.com/users/rmlarsen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rmlarsen/subscriptions", "organizations_url": "https://api.github.com/users/rmlarsen/orgs", "repos_url": "https://api.github.com/users/rmlarsen/repos", "events_url": "https://api.github.com/users/rmlarsen/events{/privacy}", "received_events_url": "https://api.github.com/users/rmlarsen/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "rmlarsen", "id": 16907534, "node_id": "MDQ6VXNlcjE2OTA3NTM0", "avatar_url": "https://avatars2.githubusercontent.com/u/16907534?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rmlarsen", "html_url": "https://github.com/rmlarsen", "followers_url": "https://api.github.com/users/rmlarsen/followers", "following_url": "https://api.github.com/users/rmlarsen/following{/other_user}", "gists_url": "https://api.github.com/users/rmlarsen/gists{/gist_id}", "starred_url": "https://api.github.com/users/rmlarsen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rmlarsen/subscriptions", "organizations_url": "https://api.github.com/users/rmlarsen/orgs", "repos_url": "https://api.github.com/users/rmlarsen/repos", "events_url": "https://api.github.com/users/rmlarsen/events{/privacy}", "received_events_url": "https://api.github.com/users/rmlarsen/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2018-01-08T14:49:46Z", "updated_at": "2018-01-23T18:38:26Z", "closed_at": "2018-01-23T18:22:08Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/15946", "html_url": "https://github.com/tensorflow/tensorflow/pull/15946", "diff_url": "https://github.com/tensorflow/tensorflow/pull/15946.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/15946.patch"}, "body_html": "<p><code>tf.metrics.mean_per_class_accuracy()</code> uses a <code>num_classes x num_classes</code> matrix to keep track of accuracies for each class. This wastes a lot of memory and doesn't work well for large number of classes (e.g. matrix size for 500k classes is 500000^2*4 = 1 terabyte).</p>\n<p>By switching to two 1-D variables of size <code>num_classes</code> instead, memory usage is reduced considerably. One variable keeps track of correct predictions for each class, while the other variable keeps track of the total number of predictions for each class.</p>", "body_text": "tf.metrics.mean_per_class_accuracy() uses a num_classes x num_classes matrix to keep track of accuracies for each class. This wastes a lot of memory and doesn't work well for large number of classes (e.g. matrix size for 500k classes is 500000^2*4 = 1 terabyte).\nBy switching to two 1-D variables of size num_classes instead, memory usage is reduced considerably. One variable keeps track of correct predictions for each class, while the other variable keeps track of the total number of predictions for each class.", "body": "`tf.metrics.mean_per_class_accuracy()` uses a `num_classes x num_classes` matrix to keep track of accuracies for each class. This wastes a lot of memory and doesn't work well for large number of classes (e.g. matrix size for 500k classes is 500000^2*4 = 1 terabyte).\r\n\r\nBy switching to two 1-D variables of size `num_classes` instead, memory usage is reduced considerably. One variable keeps track of correct predictions for each class, while the other variable keeps track of the total number of predictions for each class."}