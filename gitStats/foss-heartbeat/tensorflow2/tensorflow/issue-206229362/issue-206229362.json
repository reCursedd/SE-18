{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7359", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7359/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7359/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7359/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/7359", "id": 206229362, "node_id": "MDU6SXNzdWUyMDYyMjkzNjI=", "number": 7359, "title": "resize_image_with_crop_or_pad should work with batch of images", "user": {"login": "cancan101", "id": 51059, "node_id": "MDQ6VXNlcjUxMDU5", "avatar_url": "https://avatars1.githubusercontent.com/u/51059?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cancan101", "html_url": "https://github.com/cancan101", "followers_url": "https://api.github.com/users/cancan101/followers", "following_url": "https://api.github.com/users/cancan101/following{/other_user}", "gists_url": "https://api.github.com/users/cancan101/gists{/gist_id}", "starred_url": "https://api.github.com/users/cancan101/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cancan101/subscriptions", "organizations_url": "https://api.github.com/users/cancan101/orgs", "repos_url": "https://api.github.com/users/cancan101/repos", "events_url": "https://api.github.com/users/cancan101/events{/privacy}", "received_events_url": "https://api.github.com/users/cancan101/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 299643928, "node_id": "MDU6TGFiZWwyOTk2NDM5Mjg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:contributions%20welcome", "name": "stat:contributions welcome", "color": "f4b400", "default": false}, {"id": 473173272, "node_id": "MDU6TGFiZWw0NzMxNzMyNzI=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:feature", "name": "type:feature", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2017-02-08T15:24:13Z", "updated_at": "2017-03-16T01:49:35Z", "closed_at": "2017-03-16T01:49:35Z", "author_association": "CONTRIBUTOR", "body_html": "<p>This is a repost of <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"153730123\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/2284\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/2284/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/2284\">#2284</a> <a href=\"https://github.com/tensorflow/tensorflow/issues/2284#issuecomment-277339057\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/2284/hovercard\">per comment</a> from <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=192142\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/mrry\">@mrry</a> (CC <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1810839\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ziky90\">@ziky90</a>).</p>\n<p><code>resize_image_with_crop_or_pad</code> should be modified to take either a single image or a batch of images. Right now the signature of the function specifies:</p>\n<pre><code>    image: 3-D tensor of shape `[height, width, channels]`\n</code></pre>\n<p>For a reference of what the api should look like, see <a href=\"https://github.com/tensorflow/tensorflow/blob/4c192f060cf9ff897911d240c140299d6db257b6/tensorflow/python/ops/image_ops_impl.py#L605-L608\"><code>resize_images(images,....)</code></a>:</p>\n<pre><code>    images: 4-D Tensor of shape `[batch, height, width, channels]` or\n            3-D Tensor of shape `[height, width, channels]`.\n</code></pre>\n<p>Some commentary:</p>\n<ul>\n<li>docs for <code>resize_images</code> say: \" Resized images will be distorted if their original aspect ratio is not the same as <code>size</code>.  To avoid distortions see [<code>resize_image_with_crop_or_pad</code>].\" However the method referenced <em>cannot</em> be currently used in some cases for which <code>resize_images</code> works due to the above mentioned limitations.</li>\n<li>the entire operation can be implemented using slice operations on the tensor batch. This is what <code>resize_image_with_crop_or_pad</code> does but it has the following logic which would be nice not to copy and paste (there is some subtlety with round down vs up):</li>\n</ul>\n<div class=\"highlight highlight-source-python\"><pre>  width_diff <span class=\"pl-k\">=</span> target_width <span class=\"pl-k\">-</span> width\n  offset_crop_width <span class=\"pl-k\">=</span> max_(<span class=\"pl-k\">-</span>width_diff <span class=\"pl-k\">//</span> <span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">0</span>)\n  offset_pad_width <span class=\"pl-k\">=</span> max_(width_diff <span class=\"pl-k\">//</span> <span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">0</span>)\n\n  height_diff <span class=\"pl-k\">=</span> target_height <span class=\"pl-k\">-</span> height\n  offset_crop_height <span class=\"pl-k\">=</span> max_(<span class=\"pl-k\">-</span>height_diff <span class=\"pl-k\">//</span> <span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">0</span>)\n  offset_pad_height <span class=\"pl-k\">=</span> max_(height_diff <span class=\"pl-k\">//</span> <span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">0</span>)</pre></div>\n<ul>\n<li>the fact this one image op method does not handle batches leads to confusion and various <a href=\"http://stackoverflow.com/questions/33944683/tensorflow-map-operation-for-tensor\" rel=\"nofollow\">SO</a> posts. People even resort to solving the problem using all sorts of crazy solutions (e.g. <code>tf.while_loop</code>).</li>\n<li>this method is useful in combination with concatenation operations. For example see the<a href=\"http://lasagne.readthedocs.io/en/latest/modules/layers/merge.html#lasagne.layers.ConcatLayer\" rel=\"nofollow\"> Lasagne <code>ConcatLayer</code></a>.</li>\n</ul>", "body_text": "This is a repost of #2284 per comment from @mrry (CC @ziky90).\nresize_image_with_crop_or_pad should be modified to take either a single image or a batch of images. Right now the signature of the function specifies:\n    image: 3-D tensor of shape `[height, width, channels]`\n\nFor a reference of what the api should look like, see resize_images(images,....):\n    images: 4-D Tensor of shape `[batch, height, width, channels]` or\n            3-D Tensor of shape `[height, width, channels]`.\n\nSome commentary:\n\ndocs for resize_images say: \" Resized images will be distorted if their original aspect ratio is not the same as size.  To avoid distortions see [resize_image_with_crop_or_pad].\" However the method referenced cannot be currently used in some cases for which resize_images works due to the above mentioned limitations.\nthe entire operation can be implemented using slice operations on the tensor batch. This is what resize_image_with_crop_or_pad does but it has the following logic which would be nice not to copy and paste (there is some subtlety with round down vs up):\n\n  width_diff = target_width - width\n  offset_crop_width = max_(-width_diff // 2, 0)\n  offset_pad_width = max_(width_diff // 2, 0)\n\n  height_diff = target_height - height\n  offset_crop_height = max_(-height_diff // 2, 0)\n  offset_pad_height = max_(height_diff // 2, 0)\n\nthe fact this one image op method does not handle batches leads to confusion and various SO posts. People even resort to solving the problem using all sorts of crazy solutions (e.g. tf.while_loop).\nthis method is useful in combination with concatenation operations. For example see the Lasagne ConcatLayer.", "body": "This is a repost of https://github.com/tensorflow/tensorflow/issues/2284 [per comment](https://github.com/tensorflow/tensorflow/issues/2284#issuecomment-277339057) from @mrry (CC @ziky90).\r\n\r\n`resize_image_with_crop_or_pad` should be modified to take either a single image or a batch of images. Right now the signature of the function specifies:\r\n```\r\n    image: 3-D tensor of shape `[height, width, channels]`\r\n```\r\n\r\nFor a reference of what the api should look like, see [`resize_images(images,....)`](https://github.com/tensorflow/tensorflow/blob/4c192f060cf9ff897911d240c140299d6db257b6/tensorflow/python/ops/image_ops_impl.py#L605-L608):\r\n```\r\n    images: 4-D Tensor of shape `[batch, height, width, channels]` or\r\n            3-D Tensor of shape `[height, width, channels]`.\r\n```\r\n\r\nSome commentary:\r\n* docs for `resize_images` say: \" Resized images will be distorted if their original aspect ratio is not the same as `size`.  To avoid distortions see [`resize_image_with_crop_or_pad`].\" However the method referenced _cannot_ be currently used in some cases for which `resize_images` works due to the above mentioned limitations.\r\n* the entire operation can be implemented using slice operations on the tensor batch. This is what `resize_image_with_crop_or_pad` does but it has the following logic which would be nice not to copy and paste (there is some subtlety with round down vs up):\r\n```python\r\n  width_diff = target_width - width\r\n  offset_crop_width = max_(-width_diff // 2, 0)\r\n  offset_pad_width = max_(width_diff // 2, 0)\r\n\r\n  height_diff = target_height - height\r\n  offset_crop_height = max_(-height_diff // 2, 0)\r\n  offset_pad_height = max_(height_diff // 2, 0)\r\n```\r\n* the fact this one image op method does not handle batches leads to confusion and various [SO](http://stackoverflow.com/questions/33944683/tensorflow-map-operation-for-tensor) posts. People even resort to solving the problem using all sorts of crazy solutions (e.g. `tf.while_loop`).\r\n* this method is useful in combination with concatenation operations. For example see the[ Lasagne `ConcatLayer`](http://lasagne.readthedocs.io/en/latest/modules/layers/merge.html#lasagne.layers.ConcatLayer)."}