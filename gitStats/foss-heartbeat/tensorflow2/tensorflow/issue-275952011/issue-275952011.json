{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14783", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14783/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14783/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14783/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/14783", "id": 275952011, "node_id": "MDU6SXNzdWUyNzU5NTIwMTE=", "number": 14783, "title": "Debugging control flow gradients code", "user": {"login": "eaplatanios", "id": 1294940, "node_id": "MDQ6VXNlcjEyOTQ5NDA=", "avatar_url": "https://avatars2.githubusercontent.com/u/1294940?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eaplatanios", "html_url": "https://github.com/eaplatanios", "followers_url": "https://api.github.com/users/eaplatanios/followers", "following_url": "https://api.github.com/users/eaplatanios/following{/other_user}", "gists_url": "https://api.github.com/users/eaplatanios/gists{/gist_id}", "starred_url": "https://api.github.com/users/eaplatanios/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eaplatanios/subscriptions", "organizations_url": "https://api.github.com/users/eaplatanios/orgs", "repos_url": "https://api.github.com/users/eaplatanios/repos", "events_url": "https://api.github.com/users/eaplatanios/events{/privacy}", "received_events_url": "https://api.github.com/users/eaplatanios/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "tatianashp", "id": 986732, "node_id": "MDQ6VXNlcjk4NjczMg==", "avatar_url": "https://avatars2.githubusercontent.com/u/986732?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tatianashp", "html_url": "https://github.com/tatianashp", "followers_url": "https://api.github.com/users/tatianashp/followers", "following_url": "https://api.github.com/users/tatianashp/following{/other_user}", "gists_url": "https://api.github.com/users/tatianashp/gists{/gist_id}", "starred_url": "https://api.github.com/users/tatianashp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tatianashp/subscriptions", "organizations_url": "https://api.github.com/users/tatianashp/orgs", "repos_url": "https://api.github.com/users/tatianashp/repos", "events_url": "https://api.github.com/users/tatianashp/events{/privacy}", "received_events_url": "https://api.github.com/users/tatianashp/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "tatianashp", "id": 986732, "node_id": "MDQ6VXNlcjk4NjczMg==", "avatar_url": "https://avatars2.githubusercontent.com/u/986732?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tatianashp", "html_url": "https://github.com/tatianashp", "followers_url": "https://api.github.com/users/tatianashp/followers", "following_url": "https://api.github.com/users/tatianashp/following{/other_user}", "gists_url": "https://api.github.com/users/tatianashp/gists{/gist_id}", "starred_url": "https://api.github.com/users/tatianashp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tatianashp/subscriptions", "organizations_url": "https://api.github.com/users/tatianashp/orgs", "repos_url": "https://api.github.com/users/tatianashp/repos", "events_url": "https://api.github.com/users/tatianashp/events{/privacy}", "received_events_url": "https://api.github.com/users/tatianashp/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 21, "created_at": "2017-11-22T05:49:33Z", "updated_at": "2018-05-03T03:39:51Z", "closed_at": "2018-05-03T03:39:51Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Hi,</p>\n<p>I've been trying to debug some code I have for computing gradients over control flow ops and I've encountered a couple issues:</p>\n<ol>\n<li><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=2469592\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/itsmeolivia\">@itsmeolivia</a> The shape check introduced in commit <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/bac56b37be7736c9da9a3257696a9c1241327d60/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/bac56b37be7736c9da9a3257696a9c1241327d60\"><tt>bac56b3</tt></a> breaks the code <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/control_flow_ops.py#L2466\">here</a> when creating a backprop indexed slices accumulator. That's because when concatenating the indices in line <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/control_flow_ops.py#L2528\">2528</a>, the shape changes.</li>\n<li>I have implemented most of the same unit tests and all works well. I also have support for RNNs and things are fine. However, when I implement a decoder that involves a while loop with a cond nested within it, there are cases where I have a problem. More specifically, if I use an existing tensor (created outside the while loop) within a cond branch, I get this error: <code>Retval[0] does not have value</code>. I realize this comes from a switch output of a dead branch being used, but can't figure out exactly what's wrong. Note that this only happens when computing gradients and only when I use an existing tensor within a branch. What would be a good way to debug this?</li>\n<li>More generally, how can I debug error like <code>Retval[0] does not have value</code>. No stack trace is provided and I'm not sure how I could configure TensorFlow when compiling to add some debugging information (e.g., stack trace). <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=16018\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/asimshankar\">@asimshankar</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=88808\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/skye\">@skye</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=5061\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/alextp\">@alextp</a> Is there some way to setup and run TensorFlow in a debug mode of some sort?</li>\n</ol>\n<p>Thanks! :)</p>", "body_text": "Hi,\nI've been trying to debug some code I have for computing gradients over control flow ops and I've encountered a couple issues:\n\n@itsmeolivia The shape check introduced in commit bac56b3 breaks the code here when creating a backprop indexed slices accumulator. That's because when concatenating the indices in line 2528, the shape changes.\nI have implemented most of the same unit tests and all works well. I also have support for RNNs and things are fine. However, when I implement a decoder that involves a while loop with a cond nested within it, there are cases where I have a problem. More specifically, if I use an existing tensor (created outside the while loop) within a cond branch, I get this error: Retval[0] does not have value. I realize this comes from a switch output of a dead branch being used, but can't figure out exactly what's wrong. Note that this only happens when computing gradients and only when I use an existing tensor within a branch. What would be a good way to debug this?\nMore generally, how can I debug error like Retval[0] does not have value. No stack trace is provided and I'm not sure how I could configure TensorFlow when compiling to add some debugging information (e.g., stack trace). @asimshankar @skye @alextp Is there some way to setup and run TensorFlow in a debug mode of some sort?\n\nThanks! :)", "body": "Hi,\r\n\r\nI've been trying to debug some code I have for computing gradients over control flow ops and I've encountered a couple issues:\r\n\r\n1. @itsmeolivia The shape check introduced in commit bac56b3 breaks the code [here](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/control_flow_ops.py#L2466) when creating a backprop indexed slices accumulator. That's because when concatenating the indices in line [2528](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/control_flow_ops.py#L2528), the shape changes.\r\n2. I have implemented most of the same unit tests and all works well. I also have support for RNNs and things are fine. However, when I implement a decoder that involves a while loop with a cond nested within it, there are cases where I have a problem. More specifically, if I use an existing tensor (created outside the while loop) within a cond branch, I get this error: `Retval[0] does not have value`. I realize this comes from a switch output of a dead branch being used, but can't figure out exactly what's wrong. Note that this only happens when computing gradients and only when I use an existing tensor within a branch. What would be a good way to debug this?\r\n3. More generally, how can I debug error like `Retval[0] does not have value`. No stack trace is provided and I'm not sure how I could configure TensorFlow when compiling to add some debugging information (e.g., stack trace). @asimshankar @skye @alextp Is there some way to setup and run TensorFlow in a debug mode of some sort?\r\n\r\nThanks! :)"}