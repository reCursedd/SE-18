{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/213399709", "pull_request_review_id": 150227614, "id": 213399709, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzM5OTcwOQ==", "diff_hunk": "@@ -95,26 +97,35 @@ def dnn_logit_fn(features, mode):\n     for layer_id, num_hidden_units in enumerate(hidden_units):\n       with variable_scope.variable_scope(\n           'hiddenlayer_%d' % layer_id, values=(net,)) as hidden_layer_scope:\n-        net = core_layers.dense(\n-            net,\n-            units=num_hidden_units,\n-            activation=activation_fn,\n-            kernel_initializer=init_ops.glorot_uniform_initializer(),\n-            name=hidden_layer_scope)\n-        if dropout is not None and is_training:\n-          net = core_layers.dropout(net, rate=dropout, training=True)\n         if batch_norm:\n           # TODO(hjm): In future, if this becomes popular, we can enable\n           # customization of the batch normalization params by accepting a\n           # list of `BatchNormalization` instances as `batch_norm`.\n+          net = core_layers.dense(\n+              net,\n+              units=num_hidden_units,\n+              activation=None,\n+              kernel_initializer=init_ops.glorot_uniform_initializer(),\n+              name=hidden_layer_scope)\n           net = normalization.batch_normalization(\n               net,\n               # The default momentum 0.99 actually crashes on certain\n-              # problem, so here we use 0.999, which is the default of\n+              # problems, so here we use 0.999, which is the default of\n               # tf.contrib.layers.batch_norm.\n               momentum=0.999,\n               training=is_training,\n               name='batchnorm_%d' % layer_id)\n+          if activation_fn is not None:\n+            net = activation_fn(net, name='hiddenlayer_%d_output' % layer_id)\n+        else:\n+          net = core_layers.dense(\n+              net,\n+              units=num_hidden_units,\n+              activation=activation_fn,\n+              kernel_initializer=init_ops.glorot_uniform_initializer(),\n+              name=hidden_layer_scope)", "path": "tensorflow/python/estimator/canned/dnn.py", "position": 90, "original_position": 55, "commit_id": "2945679be1dcd64139ecd2d1c5b08ae8594f76a6", "original_commit_id": "bdcb209821b6f333abb5e720e4c446f5099c8fa1", "user": {"login": "ispirmustafa", "id": 19293677, "node_id": "MDQ6VXNlcjE5MjkzNjc3", "avatar_url": "https://avatars1.githubusercontent.com/u/19293677?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ispirmustafa", "html_url": "https://github.com/ispirmustafa", "followers_url": "https://api.github.com/users/ispirmustafa/followers", "following_url": "https://api.github.com/users/ispirmustafa/following{/other_user}", "gists_url": "https://api.github.com/users/ispirmustafa/gists{/gist_id}", "starred_url": "https://api.github.com/users/ispirmustafa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ispirmustafa/subscriptions", "organizations_url": "https://api.github.com/users/ispirmustafa/orgs", "repos_url": "https://api.github.com/users/ispirmustafa/repos", "events_url": "https://api.github.com/users/ispirmustafa/events{/privacy}", "received_events_url": "https://api.github.com/users/ispirmustafa/received_events", "type": "User", "site_admin": false}, "body": "let's do following which will be more readable:\r\nnet = dense(activation=none)\r\nif batch-norm:\r\n  net = batch-norm(net)\r\nif activation-fn:\r\n  net = activation-fn(net)\r\nif dropout:\r\n  net = dropout", "created_at": "2018-08-28T17:16:10Z", "updated_at": "2018-09-27T16:50:15Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/21916#discussion_r213399709", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/21916", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/213399709"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/21916#discussion_r213399709"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/21916"}}, "body_html": "<p>let's do following which will be more readable:<br>\nnet = dense(activation=none)<br>\nif batch-norm:<br>\nnet = batch-norm(net)<br>\nif activation-fn:<br>\nnet = activation-fn(net)<br>\nif dropout:<br>\nnet = dropout</p>", "body_text": "let's do following which will be more readable:\nnet = dense(activation=none)\nif batch-norm:\nnet = batch-norm(net)\nif activation-fn:\nnet = activation-fn(net)\nif dropout:\nnet = dropout"}