{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10665", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10665/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10665/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10665/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/10665", "id": 235424410, "node_id": "MDU6SXNzdWUyMzU0MjQ0MTA=", "number": 10665, "title": "The issue of compling from source code: undeclared inclusion(s) in rule '@nccl_archive//:nccl'", "user": {"login": "lxwgcool", "id": 11053933, "node_id": "MDQ6VXNlcjExMDUzOTMz", "avatar_url": "https://avatars2.githubusercontent.com/u/11053933?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lxwgcool", "html_url": "https://github.com/lxwgcool", "followers_url": "https://api.github.com/users/lxwgcool/followers", "following_url": "https://api.github.com/users/lxwgcool/following{/other_user}", "gists_url": "https://api.github.com/users/lxwgcool/gists{/gist_id}", "starred_url": "https://api.github.com/users/lxwgcool/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lxwgcool/subscriptions", "organizations_url": "https://api.github.com/users/lxwgcool/orgs", "repos_url": "https://api.github.com/users/lxwgcool/repos", "events_url": "https://api.github.com/users/lxwgcool/events{/privacy}", "received_events_url": "https://api.github.com/users/lxwgcool/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586558, "node_id": "MDU6TGFiZWw0MDQ1ODY1NTg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:community%20support", "name": "stat:community support", "color": "f4b400", "default": false}, {"id": 473173351, "node_id": "MDU6TGFiZWw0NzMxNzMzNTE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:build/install", "name": "type:build/install", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 21, "created_at": "2017-06-13T03:19:37Z", "updated_at": "2017-12-28T07:40:16Z", "closed_at": "2017-06-17T05:26:54Z", "author_association": "NONE", "body_html": "<p>Hey guys,</p>\n<p>I can compile the cpu version of tensorflow 1.2.0-rc2 without any problem, however, i am blocked when i try to compile the gpu version. I spend almost the whole day to install tensorflow 1.2.0-rc2 gpu version in our cluster, however there is no lucky.</p>\n<h3>Here is the error from the terminal:</h3>\n<p>ERROR: /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/BUILD:33:1: undeclared inclusion(s) in rule '@nccl_archive//:nccl':<br>\nthis rule is missing dependency declarations for the following files included by 'external/nccl_archive/src/libwrap.cu.cc':<br>\n'/gpfs/gpfs1/apps2/gcc/5.4.0/lib/gcc/x86_64-unknown-linux-gnu/5.4.0/include-fixed/limits.h'<br>\n'/gpfs/gpfs1/apps2/gcc/5.4.0/lib/gcc/x86_64-unknown-linux-gnu/5.4.0/include-fixed/syslimits.h'<br>\n'/gpfs/gpfs1/apps2/gcc/5.4.0/lib/gcc/x86_64-unknown-linux-gnu/5.4.0/include/stddef.h'<br>\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/new'<br>\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/x86_64-unknown-linux-gnu/bits/c++config.h'<br>\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/x86_64-unknown-linux-gnu/bits/os_defines.h'<br>\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/x86_64-unknown-linux-gnu/bits/cpu_defines.h'<br>\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/exception'<br>\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/bits/atomic_lockfree_defines.h'<br>\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/bits/exception_ptr.h'<br>\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/bits/exception_defines.h'<br>\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/bits/nested_exception.h'<br>\n'/gpfs/gpfs1/apps2/gcc/5.4.0/lib/gcc/x86_64-unknown-linux-gnu/5.4.0/include/stdarg.h'<br>\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/cmath'<br>\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/bits/cpp_type_traits.h'<br>\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/ext/type_traits.h'<br>\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/cstdlib'<br>\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/cstdio'.<br>\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build<br>\nUse --verbose_failures to see the command lines of failed build steps.<br>\nINFO: Elapsed time: 22.226s, Critical Path: 5.20s</p>\n<h3>OS Information</h3>\n<p>Red Hat Enterprise Linux Workstation release 6.7 (Santiago)</p>\n<h3>Modules I loaded</h3>\n<p>gcc/5.4.0, cuda/8.0.61, cudnn/6.0, java/1.8.0_31, sqlite/3.18.0, tcl/8.6.6.8606, python/3.6.1</p>\n<h3>Here is how i make the configuration</h3>\n<p>gcc (v5.4.0): /apps2/gcc/5.4.0 (customized path\uff09<br>\nenabled cuda (v8.0): /apps2/cuda/8.0.61 (customized path\uff09<br>\nenabled cudnn: /apps2/cudnn/6.0 (customized path\uff09<br>\npython (v3.6.1, which is compiled with gcc 5.4.0): /apps2/python/3.6.1 (customized path)<br>\nOther options are disabled (such as hadoop, google cloud).</p>\n<h3>Here are some files i modified manually before compiling</h3>\n<p>(1) /tensorflow-1.2.0-rc2/third_party/gpus/crosstool/CROSSTOOL_clang.tpl<br>\n/tensorflow-1.2.0-rc2/third_party/gpus/crosstool/CROSSTOOL_nvcc.tpl<br>\nAdd the following contents in all of \"toolchain\":<br>\ncxx_builtin_include_directory: \"/apps2/gcc/5.4.0/lib/gcc/x86_64-unknown-linux-gnu/5.4.0/include\"<br>\ncxx_builtin_include_directory: \"/apps2/gcc/5.4.0/lib/gcc/x86_64-unknown-linux-gnu/5.4.0/include-fixed\"<br>\ncxx_builtin_include_directory: \"/apps2/gcc/5.4.0/include/c++/5.4.0\"<br>\ncxx_builtin_include_directory: \"/apps2/gcc/5.4.0/include\"<br>\ncxx_builtin_include_directory: \"/apps2/cuda/8.0.61/include\"<br>\ncxx_builtin_include_directory: \"/apps2/cudnn/6.0/include\"</p>\n<p>(2) /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/protobuf/protobuf.bzl<br>\nAdd the following content in \"ctx.action\"<br>\nenv=ctx.configuration.default_shell_env</p>\n<p>(3) /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/Makefile<br>\nSome modification as below:<br>\nCUDA_HOME ?= /usr/local/cuda --&gt; CUDA_HOME ?= /apps2/cuda/8.0.61</p>\n<p>I noticed that some of people said this issue could be bypassed by delete the nccl dependence in \"/tensorflow-1.2.0-rc2/tensorflow/contrib/BUILD\". However, i do not think this is the correct way to solve this issue. I wanna keep this dependence.</p>\n<p>Thanks so much for your help. Any comments are appreciated.<br>\nBest Regards<br>\nXin</p>", "body_text": "Hey guys,\nI can compile the cpu version of tensorflow 1.2.0-rc2 without any problem, however, i am blocked when i try to compile the gpu version. I spend almost the whole day to install tensorflow 1.2.0-rc2 gpu version in our cluster, however there is no lucky.\nHere is the error from the terminal:\nERROR: /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/BUILD:33:1: undeclared inclusion(s) in rule '@nccl_archive//:nccl':\nthis rule is missing dependency declarations for the following files included by 'external/nccl_archive/src/libwrap.cu.cc':\n'/gpfs/gpfs1/apps2/gcc/5.4.0/lib/gcc/x86_64-unknown-linux-gnu/5.4.0/include-fixed/limits.h'\n'/gpfs/gpfs1/apps2/gcc/5.4.0/lib/gcc/x86_64-unknown-linux-gnu/5.4.0/include-fixed/syslimits.h'\n'/gpfs/gpfs1/apps2/gcc/5.4.0/lib/gcc/x86_64-unknown-linux-gnu/5.4.0/include/stddef.h'\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/new'\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/x86_64-unknown-linux-gnu/bits/c++config.h'\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/x86_64-unknown-linux-gnu/bits/os_defines.h'\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/x86_64-unknown-linux-gnu/bits/cpu_defines.h'\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/exception'\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/bits/atomic_lockfree_defines.h'\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/bits/exception_ptr.h'\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/bits/exception_defines.h'\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/bits/nested_exception.h'\n'/gpfs/gpfs1/apps2/gcc/5.4.0/lib/gcc/x86_64-unknown-linux-gnu/5.4.0/include/stdarg.h'\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/cmath'\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/bits/cpp_type_traits.h'\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/ext/type_traits.h'\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/cstdlib'\n'/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/cstdio'.\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\nUse --verbose_failures to see the command lines of failed build steps.\nINFO: Elapsed time: 22.226s, Critical Path: 5.20s\nOS Information\nRed Hat Enterprise Linux Workstation release 6.7 (Santiago)\nModules I loaded\ngcc/5.4.0, cuda/8.0.61, cudnn/6.0, java/1.8.0_31, sqlite/3.18.0, tcl/8.6.6.8606, python/3.6.1\nHere is how i make the configuration\ngcc (v5.4.0): /apps2/gcc/5.4.0 (customized path\uff09\nenabled cuda (v8.0): /apps2/cuda/8.0.61 (customized path\uff09\nenabled cudnn: /apps2/cudnn/6.0 (customized path\uff09\npython (v3.6.1, which is compiled with gcc 5.4.0): /apps2/python/3.6.1 (customized path)\nOther options are disabled (such as hadoop, google cloud).\nHere are some files i modified manually before compiling\n(1) /tensorflow-1.2.0-rc2/third_party/gpus/crosstool/CROSSTOOL_clang.tpl\n/tensorflow-1.2.0-rc2/third_party/gpus/crosstool/CROSSTOOL_nvcc.tpl\nAdd the following contents in all of \"toolchain\":\ncxx_builtin_include_directory: \"/apps2/gcc/5.4.0/lib/gcc/x86_64-unknown-linux-gnu/5.4.0/include\"\ncxx_builtin_include_directory: \"/apps2/gcc/5.4.0/lib/gcc/x86_64-unknown-linux-gnu/5.4.0/include-fixed\"\ncxx_builtin_include_directory: \"/apps2/gcc/5.4.0/include/c++/5.4.0\"\ncxx_builtin_include_directory: \"/apps2/gcc/5.4.0/include\"\ncxx_builtin_include_directory: \"/apps2/cuda/8.0.61/include\"\ncxx_builtin_include_directory: \"/apps2/cudnn/6.0/include\"\n(2) /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/protobuf/protobuf.bzl\nAdd the following content in \"ctx.action\"\nenv=ctx.configuration.default_shell_env\n(3) /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/Makefile\nSome modification as below:\nCUDA_HOME ?= /usr/local/cuda --> CUDA_HOME ?= /apps2/cuda/8.0.61\nI noticed that some of people said this issue could be bypassed by delete the nccl dependence in \"/tensorflow-1.2.0-rc2/tensorflow/contrib/BUILD\". However, i do not think this is the correct way to solve this issue. I wanna keep this dependence.\nThanks so much for your help. Any comments are appreciated.\nBest Regards\nXin", "body": "Hey guys,\r\n\r\nI can compile the cpu version of tensorflow 1.2.0-rc2 without any problem, however, i am blocked when i try to compile the gpu version. I spend almost the whole day to install tensorflow 1.2.0-rc2 gpu version in our cluster, however there is no lucky.\r\n\r\n### Here is the error from the terminal: \r\n\r\nERROR: /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/BUILD:33:1: undeclared inclusion(s) in rule '@nccl_archive//:nccl':\r\nthis rule is missing dependency declarations for the following files included by 'external/nccl_archive/src/libwrap.cu.cc':\r\n  '/gpfs/gpfs1/apps2/gcc/5.4.0/lib/gcc/x86_64-unknown-linux-gnu/5.4.0/include-fixed/limits.h'\r\n  '/gpfs/gpfs1/apps2/gcc/5.4.0/lib/gcc/x86_64-unknown-linux-gnu/5.4.0/include-fixed/syslimits.h'\r\n  '/gpfs/gpfs1/apps2/gcc/5.4.0/lib/gcc/x86_64-unknown-linux-gnu/5.4.0/include/stddef.h'\r\n  '/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/new'\r\n  '/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/x86_64-unknown-linux-gnu/bits/c++config.h'\r\n  '/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/x86_64-unknown-linux-gnu/bits/os_defines.h'\r\n  '/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/x86_64-unknown-linux-gnu/bits/cpu_defines.h'\r\n  '/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/exception'\r\n  '/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/bits/atomic_lockfree_defines.h'\r\n  '/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/bits/exception_ptr.h'\r\n  '/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/bits/exception_defines.h'\r\n  '/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/bits/nested_exception.h'\r\n  '/gpfs/gpfs1/apps2/gcc/5.4.0/lib/gcc/x86_64-unknown-linux-gnu/5.4.0/include/stdarg.h'\r\n  '/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/cmath'\r\n  '/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/bits/cpp_type_traits.h'\r\n  '/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/ext/type_traits.h'\r\n  '/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/cstdlib'\r\n  '/gpfs/gpfs1/apps2/gcc/5.4.0/include/c++/5.4.0/cstdio'.\r\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\r\nUse --verbose_failures to see the command lines of failed build steps.\r\nINFO: Elapsed time: 22.226s, Critical Path: 5.20s\r\n\r\n### OS Information \r\nRed Hat Enterprise Linux Workstation release 6.7 (Santiago)\r\n\r\n### Modules I loaded\r\ngcc/5.4.0, cuda/8.0.61, cudnn/6.0, java/1.8.0_31, sqlite/3.18.0, tcl/8.6.6.8606, python/3.6.1\r\n\r\n### Here is how i make the configuration\r\ngcc (v5.4.0): /apps2/gcc/5.4.0 (customized path\uff09\r\nenabled cuda (v8.0): /apps2/cuda/8.0.61 (customized path\uff09\r\nenabled cudnn: /apps2/cudnn/6.0 (customized path\uff09\r\npython (v3.6.1, which is compiled with gcc 5.4.0): /apps2/python/3.6.1 (customized path)\r\nOther options are disabled (such as hadoop, google cloud). \r\n\r\n### Here are some files i modified manually before compiling\r\n(1) /tensorflow-1.2.0-rc2/third_party/gpus/crosstool/CROSSTOOL_clang.tpl\r\n     /tensorflow-1.2.0-rc2/third_party/gpus/crosstool/CROSSTOOL_nvcc.tpl\r\n    Add the following contents in all of \"toolchain\": \r\n    cxx_builtin_include_directory: \"/apps2/gcc/5.4.0/lib/gcc/x86_64-unknown-linux-gnu/5.4.0/include\"\r\n    cxx_builtin_include_directory: \"/apps2/gcc/5.4.0/lib/gcc/x86_64-unknown-linux-gnu/5.4.0/include-fixed\"\r\n    cxx_builtin_include_directory: \"/apps2/gcc/5.4.0/include/c++/5.4.0\"\r\n    cxx_builtin_include_directory: \"/apps2/gcc/5.4.0/include\"\r\n    cxx_builtin_include_directory: \"/apps2/cuda/8.0.61/include\"\r\n    cxx_builtin_include_directory: \"/apps2/cudnn/6.0/include\"\r\n\r\n(2) /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/protobuf/protobuf.bzl\r\n     Add the following content in \"ctx.action\"\r\n     env=ctx.configuration.default_shell_env\r\n\r\n(3) /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/Makefile\r\n     Some modification as below:\r\n     CUDA_HOME ?= /usr/local/cuda --> CUDA_HOME ?= /apps2/cuda/8.0.61\r\n\r\nI noticed that some of people said this issue could be bypassed by delete the nccl dependence in \"/tensorflow-1.2.0-rc2/tensorflow/contrib/BUILD\". However, i do not think this is the correct way to solve this issue. I wanna keep this dependence.\r\n\r\nThanks so much for your help. Any comments are appreciated.\r\nBest Regards\r\nXin"}