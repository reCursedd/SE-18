{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/308270664", "html_url": "https://github.com/tensorflow/tensorflow/issues/10665#issuecomment-308270664", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10665", "id": 308270664, "node_id": "MDEyOklzc3VlQ29tbWVudDMwODI3MDY2NA==", "user": {"login": "lxwgcool", "id": 11053933, "node_id": "MDQ6VXNlcjExMDUzOTMz", "avatar_url": "https://avatars2.githubusercontent.com/u/11053933?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lxwgcool", "html_url": "https://github.com/lxwgcool", "followers_url": "https://api.github.com/users/lxwgcool/followers", "following_url": "https://api.github.com/users/lxwgcool/following{/other_user}", "gists_url": "https://api.github.com/users/lxwgcool/gists{/gist_id}", "starred_url": "https://api.github.com/users/lxwgcool/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lxwgcool/subscriptions", "organizations_url": "https://api.github.com/users/lxwgcool/orgs", "repos_url": "https://api.github.com/users/lxwgcool/repos", "events_url": "https://api.github.com/users/lxwgcool/events{/privacy}", "received_events_url": "https://api.github.com/users/lxwgcool/received_events", "type": "User", "site_admin": false}, "created_at": "2017-06-13T22:48:35Z", "updated_at": "2017-06-13T22:51:36Z", "author_association": "NONE", "body_html": "<p>Thanks gunan,<br>\nI tried gcc/4.8.5 with bazel 0.4.5, however, i still get the similar error as below:</p>\n<blockquote>\n<p>ERROR: /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/BUILD:33:1: undeclared inclusion(s) in rule '@nccl_archive//:nccl':<br>\nthis rule is missing dependency declarations for the following files included by 'external/nccl_archive/src/libwrap.cu.cc':<br>\n'/gpfs/gpfs1/apps2/gcc/4.8.5/lib/gcc/x86_64-unknown-linux-gnu/4.8.5/include-fixed/limits.h'<br>\n'/gpfs/gpfs1/apps2/gcc/4.8.5/lib/gcc/x86_64-unknown-linux-gnu/4.8.5/include-fixed/syslimits.h'<br>\n'/gpfs/gpfs1/apps2/gcc/4.8.5/lib/gcc/x86_64-unknown-linux-gnu/4.8.5/include/stddef.h'<br>\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/new'<br>\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/x86_64-unknown-linux-gnu/bits/c++config.h'<br>\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/x86_64-unknown-linux-gnu/bits/os_defines.h'<br>\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/x86_64-unknown-linux-gnu/bits/cpu_defines.h'<br>\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/exception'<br>\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/bits/atomic_lockfree_defines.h'<br>\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/bits/exception_ptr.h'<br>\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/bits/exception_defines.h'<br>\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/bits/nested_exception.h'<br>\n'/gpfs/gpfs1/apps2/gcc/4.8.5/lib/gcc/x86_64-unknown-linux-gnu/4.8.5/include/stdarg.h'<br>\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/cmath'<br>\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/bits/cpp_type_traits.h'<br>\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/ext/type_traits.h'<br>\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/cstdlib'<br>\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/cstdio'.<br>\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build<br>\nUse --verbose_failures to see the command lines of failed build steps.</p>\n</blockquote>\n<p>I find there is a makefile in nccl_archive folder \"/home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive\". Then, i try to make the nccl_archive source code manually by simply typing \"make\". What is surprise for me is that I did the \"make\" successfully ( libwrap.o be compiled successfully as well), please check below:</p>\n<blockquote>\n<p>hpc-xin@cn02:/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive$ make<br>\nCompiling src/libwrap.cu                      &gt; /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/libwrap.o<br>\nCompiling src/core.cu                         &gt; /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/core.o<br>\nCompiling src/all_gather.cu                   &gt; /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/all_gather.o<br>\nCompiling src/all_reduce.cu                   &gt; /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/all_reduce.o<br>\nCompiling src/broadcast.cu                    &gt; /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/broadcast.o<br>\nCompiling src/reduce.cu                       &gt; /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/reduce.o<br>\nCompiling src/reduce_scatter.cu               &gt; /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/reduce_scatter.o<br>\nLinking   libnccl.so.1.3.4                    &gt; /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/lib/libnccl.so.1.3.4<br>\nArchiving libnccl_static.a                    &gt; /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/lib/libnccl_static.a<br>\nhpc-xin@cn02:~/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive$</p>\n</blockquote>\n<p>It seems that gcc works for nccl. I really have no idea why nccl-archive be failed while compiling by bazel.<br>\nI will spend more time for investigation on Friday afternoon. Any additional comments of this issue is really appreciated.</p>\n<p>Thanks again for your help<br>\nBest regards<br>\nXin</p>", "body_text": "Thanks gunan,\nI tried gcc/4.8.5 with bazel 0.4.5, however, i still get the similar error as below:\n\nERROR: /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/BUILD:33:1: undeclared inclusion(s) in rule '@nccl_archive//:nccl':\nthis rule is missing dependency declarations for the following files included by 'external/nccl_archive/src/libwrap.cu.cc':\n'/gpfs/gpfs1/apps2/gcc/4.8.5/lib/gcc/x86_64-unknown-linux-gnu/4.8.5/include-fixed/limits.h'\n'/gpfs/gpfs1/apps2/gcc/4.8.5/lib/gcc/x86_64-unknown-linux-gnu/4.8.5/include-fixed/syslimits.h'\n'/gpfs/gpfs1/apps2/gcc/4.8.5/lib/gcc/x86_64-unknown-linux-gnu/4.8.5/include/stddef.h'\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/new'\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/x86_64-unknown-linux-gnu/bits/c++config.h'\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/x86_64-unknown-linux-gnu/bits/os_defines.h'\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/x86_64-unknown-linux-gnu/bits/cpu_defines.h'\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/exception'\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/bits/atomic_lockfree_defines.h'\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/bits/exception_ptr.h'\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/bits/exception_defines.h'\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/bits/nested_exception.h'\n'/gpfs/gpfs1/apps2/gcc/4.8.5/lib/gcc/x86_64-unknown-linux-gnu/4.8.5/include/stdarg.h'\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/cmath'\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/bits/cpp_type_traits.h'\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/ext/type_traits.h'\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/cstdlib'\n'/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/cstdio'.\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\nUse --verbose_failures to see the command lines of failed build steps.\n\nI find there is a makefile in nccl_archive folder \"/home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive\". Then, i try to make the nccl_archive source code manually by simply typing \"make\". What is surprise for me is that I did the \"make\" successfully ( libwrap.o be compiled successfully as well), please check below:\n\nhpc-xin@cn02:/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive$ make\nCompiling src/libwrap.cu                      > /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/libwrap.o\nCompiling src/core.cu                         > /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/core.o\nCompiling src/all_gather.cu                   > /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/all_gather.o\nCompiling src/all_reduce.cu                   > /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/all_reduce.o\nCompiling src/broadcast.cu                    > /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/broadcast.o\nCompiling src/reduce.cu                       > /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/reduce.o\nCompiling src/reduce_scatter.cu               > /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/reduce_scatter.o\nLinking   libnccl.so.1.3.4                    > /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/lib/libnccl.so.1.3.4\nArchiving libnccl_static.a                    > /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/lib/libnccl_static.a\nhpc-xin@cn02:~/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive$\n\nIt seems that gcc works for nccl. I really have no idea why nccl-archive be failed while compiling by bazel.\nI will spend more time for investigation on Friday afternoon. Any additional comments of this issue is really appreciated.\nThanks again for your help\nBest regards\nXin", "body": "Thanks gunan,\r\nI tried gcc/4.8.5 with bazel 0.4.5, however, i still get the similar error as below: \r\n\r\n> ERROR: /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/BUILD:33:1: undeclared inclusion(s) in rule '@nccl_archive//:nccl':\r\n> this rule is missing dependency declarations for the following files included by 'external/nccl_archive/src/libwrap.cu.cc':\r\n>   '/gpfs/gpfs1/apps2/gcc/4.8.5/lib/gcc/x86_64-unknown-linux-gnu/4.8.5/include-fixed/limits.h'\r\n>   '/gpfs/gpfs1/apps2/gcc/4.8.5/lib/gcc/x86_64-unknown-linux-gnu/4.8.5/include-fixed/syslimits.h'\r\n>   '/gpfs/gpfs1/apps2/gcc/4.8.5/lib/gcc/x86_64-unknown-linux-gnu/4.8.5/include/stddef.h'\r\n>   '/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/new'\r\n>   '/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/x86_64-unknown-linux-gnu/bits/c++config.h'\r\n>   '/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/x86_64-unknown-linux-gnu/bits/os_defines.h'\r\n>   '/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/x86_64-unknown-linux-gnu/bits/cpu_defines.h'\r\n>   '/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/exception'\r\n>   '/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/bits/atomic_lockfree_defines.h'\r\n>   '/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/bits/exception_ptr.h'\r\n>   '/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/bits/exception_defines.h'\r\n>   '/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/bits/nested_exception.h'\r\n>   '/gpfs/gpfs1/apps2/gcc/4.8.5/lib/gcc/x86_64-unknown-linux-gnu/4.8.5/include/stdarg.h'\r\n>   '/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/cmath'\r\n>   '/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/bits/cpp_type_traits.h'\r\n>   '/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/ext/type_traits.h'\r\n>   '/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/cstdlib'\r\n>   '/gpfs/gpfs1/apps2/gcc/4.8.5/include/c++/4.8.5/cstdio'.\r\n> Target //tensorflow/tools/pip_package:build_pip_package failed to build\r\n> Use --verbose_failures to see the command lines of failed build steps.\r\n\r\n\r\nI find there is a makefile in nccl_archive folder \"/home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive\". Then, i try to make the nccl_archive source code manually by simply typing \"make\". What is surprise for me is that I did the \"make\" successfully ( libwrap.o be compiled successfully as well), please check below:\r\n\r\n> hpc-xin@cn02:/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive$ make\r\n> Compiling src/libwrap.cu                      > /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/libwrap.o\r\n> Compiling src/core.cu                         > /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/core.o\r\n> Compiling src/all_gather.cu                   > /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/all_gather.o\r\n> Compiling src/all_reduce.cu                   > /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/all_reduce.o\r\n> Compiling src/broadcast.cu                    > /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/broadcast.o\r\n> Compiling src/reduce.cu                       > /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/reduce.o\r\n> Compiling src/reduce_scatter.cu               > /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/obj/reduce_scatter.o\r\n> Linking   libnccl.so.1.3.4                    > /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/lib/libnccl.so.1.3.4\r\n> Archiving libnccl_static.a                    > /home/hpc-xin/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive/build/lib/libnccl_static.a\r\n> hpc-xin@cn02:~/.cache/bazel/_bazel_hpc-xin/c5e302e32d7acb9c3e4fce8142d1cd66/external/nccl_archive$ \r\n> \r\n\r\nIt seems that gcc works for nccl. I really have no idea why nccl-archive be failed while compiling by bazel. \r\nI will spend more time for investigation on Friday afternoon. Any additional comments of this issue is really appreciated. \r\n\r\nThanks again for your help\r\nBest regards\r\nXin"}