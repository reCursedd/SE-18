{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/393596586", "html_url": "https://github.com/tensorflow/tensorflow/issues/19457#issuecomment-393596586", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19457", "id": 393596586, "node_id": "MDEyOklzc3VlQ29tbWVudDM5MzU5NjU4Ng==", "user": {"login": "allenlavoie", "id": 3731025, "node_id": "MDQ6VXNlcjM3MzEwMjU=", "avatar_url": "https://avatars3.githubusercontent.com/u/3731025?v=4", "gravatar_id": "", "url": "https://api.github.com/users/allenlavoie", "html_url": "https://github.com/allenlavoie", "followers_url": "https://api.github.com/users/allenlavoie/followers", "following_url": "https://api.github.com/users/allenlavoie/following{/other_user}", "gists_url": "https://api.github.com/users/allenlavoie/gists{/gist_id}", "starred_url": "https://api.github.com/users/allenlavoie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/allenlavoie/subscriptions", "organizations_url": "https://api.github.com/users/allenlavoie/orgs", "repos_url": "https://api.github.com/users/allenlavoie/repos", "events_url": "https://api.github.com/users/allenlavoie/events{/privacy}", "received_events_url": "https://api.github.com/users/allenlavoie/received_events", "type": "User", "site_admin": false}, "created_at": "2018-05-31T16:43:29Z", "updated_at": "2018-05-31T16:43:29Z", "author_association": "MEMBER", "body_html": "<p>So you came up with some workaround to get the slot variable to have shape [44], it only partly worked, so now the Saver is confused?</p>\n<p>I just hacked a reproduction together, and saving/restoring a smaller slot variable works for me with the most recently nightly:</p>\n<pre><code>      self._get_or_make_slot_with_initializer(\n          v, init, v_shape[:1], dtype, \"accumulator\", self._name)\n      self._get_or_make_slot_with_initializer(\n          v, init_ops.zeros_initializer(self._global_step.dtype),\n          v_shape, self._global_step.dtype, \"accumulator_decay_power\", self._name)\n</code></pre>\n<pre><code>opt = GradientDescentOptimizer(0.01)\nopt.minimize(v)\nprint(opt.variables())\n</code></pre>\n<p><code>[&lt;tf.Variable 'v/GradientDescent:0' shape=(512,) dtype=float32_ref&gt;, &lt;tf.Variable 'v/GradientDescent_1:0' shape=(512, 256) dtype=int64_ref&gt;]</code></p>\n<pre><code>saver = tf.train.Saver()\nwith tf.Session() as session:\n  tf.global_variables_initializer().run()\n  saver.save(session, '/tmp/ckpt')\n  saver.restore(session, '/tmp/ckpt')\n</code></pre>\n<p>Seems to work with no error. Worth trying an upgrade.</p>", "body_text": "So you came up with some workaround to get the slot variable to have shape [44], it only partly worked, so now the Saver is confused?\nI just hacked a reproduction together, and saving/restoring a smaller slot variable works for me with the most recently nightly:\n      self._get_or_make_slot_with_initializer(\n          v, init, v_shape[:1], dtype, \"accumulator\", self._name)\n      self._get_or_make_slot_with_initializer(\n          v, init_ops.zeros_initializer(self._global_step.dtype),\n          v_shape, self._global_step.dtype, \"accumulator_decay_power\", self._name)\n\nopt = GradientDescentOptimizer(0.01)\nopt.minimize(v)\nprint(opt.variables())\n\n[<tf.Variable 'v/GradientDescent:0' shape=(512,) dtype=float32_ref>, <tf.Variable 'v/GradientDescent_1:0' shape=(512, 256) dtype=int64_ref>]\nsaver = tf.train.Saver()\nwith tf.Session() as session:\n  tf.global_variables_initializer().run()\n  saver.save(session, '/tmp/ckpt')\n  saver.restore(session, '/tmp/ckpt')\n\nSeems to work with no error. Worth trying an upgrade.", "body": "So you came up with some workaround to get the slot variable to have shape [44], it only partly worked, so now the Saver is confused?\r\n\r\nI just hacked a reproduction together, and saving/restoring a smaller slot variable works for me with the most recently nightly:\r\n\r\n```\r\n      self._get_or_make_slot_with_initializer(\r\n          v, init, v_shape[:1], dtype, \"accumulator\", self._name)\r\n      self._get_or_make_slot_with_initializer(\r\n          v, init_ops.zeros_initializer(self._global_step.dtype),\r\n          v_shape, self._global_step.dtype, \"accumulator_decay_power\", self._name)\r\n```\r\n\r\n```\r\nopt = GradientDescentOptimizer(0.01)\r\nopt.minimize(v)\r\nprint(opt.variables())\r\n```\r\n\r\n`[<tf.Variable 'v/GradientDescent:0' shape=(512,) dtype=float32_ref>, <tf.Variable 'v/GradientDescent_1:0' shape=(512, 256) dtype=int64_ref>]`\r\n\r\n```\r\nsaver = tf.train.Saver()\r\nwith tf.Session() as session:\r\n  tf.global_variables_initializer().run()\r\n  saver.save(session, '/tmp/ckpt')\r\n  saver.restore(session, '/tmp/ckpt')\r\n```\r\n\r\nSeems to work with no error. Worth trying an upgrade."}