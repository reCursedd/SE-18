{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23383", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23383/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23383/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23383/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23383", "id": 375629544, "node_id": "MDU6SXNzdWUzNzU2Mjk1NDQ=", "number": 23383, "title": "Infinite loop in graph optimization", "user": {"login": "drasmuss", "id": 1952220, "node_id": "MDQ6VXNlcjE5NTIyMjA=", "avatar_url": "https://avatars1.githubusercontent.com/u/1952220?v=4", "gravatar_id": "", "url": "https://api.github.com/users/drasmuss", "html_url": "https://github.com/drasmuss", "followers_url": "https://api.github.com/users/drasmuss/followers", "following_url": "https://api.github.com/users/drasmuss/following{/other_user}", "gists_url": "https://api.github.com/users/drasmuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/drasmuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/drasmuss/subscriptions", "organizations_url": "https://api.github.com/users/drasmuss/orgs", "repos_url": "https://api.github.com/users/drasmuss/repos", "events_url": "https://api.github.com/users/drasmuss/events{/privacy}", "received_events_url": "https://api.github.com/users/drasmuss/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": {"login": "rmlarsen", "id": 16907534, "node_id": "MDQ6VXNlcjE2OTA3NTM0", "avatar_url": "https://avatars2.githubusercontent.com/u/16907534?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rmlarsen", "html_url": "https://github.com/rmlarsen", "followers_url": "https://api.github.com/users/rmlarsen/followers", "following_url": "https://api.github.com/users/rmlarsen/following{/other_user}", "gists_url": "https://api.github.com/users/rmlarsen/gists{/gist_id}", "starred_url": "https://api.github.com/users/rmlarsen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rmlarsen/subscriptions", "organizations_url": "https://api.github.com/users/rmlarsen/orgs", "repos_url": "https://api.github.com/users/rmlarsen/repos", "events_url": "https://api.github.com/users/rmlarsen/events{/privacy}", "received_events_url": "https://api.github.com/users/rmlarsen/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "rmlarsen", "id": 16907534, "node_id": "MDQ6VXNlcjE2OTA3NTM0", "avatar_url": "https://avatars2.githubusercontent.com/u/16907534?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rmlarsen", "html_url": "https://github.com/rmlarsen", "followers_url": "https://api.github.com/users/rmlarsen/followers", "following_url": "https://api.github.com/users/rmlarsen/following{/other_user}", "gists_url": "https://api.github.com/users/rmlarsen/gists{/gist_id}", "starred_url": "https://api.github.com/users/rmlarsen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rmlarsen/subscriptions", "organizations_url": "https://api.github.com/users/rmlarsen/orgs", "repos_url": "https://api.github.com/users/rmlarsen/repos", "events_url": "https://api.github.com/users/rmlarsen/events{/privacy}", "received_events_url": "https://api.github.com/users/rmlarsen/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2018-10-30T18:20:32Z", "updated_at": "2018-11-14T19:12:40Z", "closed_at": null, "author_association": "CONTRIBUTOR", "body_html": "<p><strong>System information</strong></p>\n<ul>\n<li>Have I written custom code (as opposed to using a stock example script provided in TensorFlow): yes</li>\n<li>OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Windows 10</li>\n<li>Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: n/a</li>\n<li>TensorFlow installed from (source or binary): binary</li>\n<li>TensorFlow version (use command below): 1.11.0</li>\n<li>Python version: 3.6.6</li>\n<li>Bazel version (if compiling from source): n/a</li>\n<li>GCC/Compiler version (if compiling from source): n/a</li>\n<li>CUDA/cuDNN version: n/a</li>\n<li>GPU model and memory: n/a</li>\n</ul>\n<p><strong>Describe the current behavior</strong></p>\n<p>When calling <code>sess.run</code> for certain graphs (e.g., see below), the session call gets stuck in an infinite loop.</p>\n<p><strong>Describe the expected behavior</strong></p>\n<p>The session call should complete normally.</p>\n<p><strong>Code to reproduce the issue</strong></p>\n<pre><code>import numpy as np\nimport tensorflow as tf\n\nconst1 = tf.zeros((1,))\nconst2 = tf.zeros((1,))\nconst3 = tf.zeros((1,))\nconst4 = tf.zeros((1,))\nph = tf.placeholder(tf.float32, (1,))\n\nc1 = tf.concat((const1, const2, ph), axis=0)\nc2 = tf.concat((const3, const4, c1), axis=0)\n\nwith tf.Session() as sess:\n    sess.run(c2, feed_dict={ph: np.zeros((1,))})  # gets stuck in infinite loop here\n</code></pre>\n<p><strong>Other info / logs</strong><br>\nSpecifically, the build process is getting stuck in the <code>ConstantFolding</code> optimization pass.  This is due to the new <code>MergeConcat</code> optimization introduced in <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/e96d65246835b3a33a55c70d1f1057517ef0aa8e/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/e96d65246835b3a33a55c70d1f1057517ef0aa8e\"><tt>e96d652</tt></a>.  It can create a graph structure that causes the <code>PartialConcatConstFolding</code> optimization to enter an infinite loop.</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Windows 10\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: n/a\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below): 1.11.0\nPython version: 3.6.6\nBazel version (if compiling from source): n/a\nGCC/Compiler version (if compiling from source): n/a\nCUDA/cuDNN version: n/a\nGPU model and memory: n/a\n\nDescribe the current behavior\nWhen calling sess.run for certain graphs (e.g., see below), the session call gets stuck in an infinite loop.\nDescribe the expected behavior\nThe session call should complete normally.\nCode to reproduce the issue\nimport numpy as np\nimport tensorflow as tf\n\nconst1 = tf.zeros((1,))\nconst2 = tf.zeros((1,))\nconst3 = tf.zeros((1,))\nconst4 = tf.zeros((1,))\nph = tf.placeholder(tf.float32, (1,))\n\nc1 = tf.concat((const1, const2, ph), axis=0)\nc2 = tf.concat((const3, const4, c1), axis=0)\n\nwith tf.Session() as sess:\n    sess.run(c2, feed_dict={ph: np.zeros((1,))})  # gets stuck in infinite loop here\n\nOther info / logs\nSpecifically, the build process is getting stuck in the ConstantFolding optimization pass.  This is due to the new MergeConcat optimization introduced in e96d652.  It can create a graph structure that causes the PartialConcatConstFolding optimization to enter an infinite loop.", "body": "**System information**\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow): yes\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Windows 10\r\n- Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: n/a\r\n- TensorFlow installed from (source or binary): binary\r\n- TensorFlow version (use command below): 1.11.0\r\n- Python version: 3.6.6\r\n- Bazel version (if compiling from source): n/a\r\n- GCC/Compiler version (if compiling from source): n/a\r\n- CUDA/cuDNN version: n/a\r\n- GPU model and memory: n/a\r\n\r\n**Describe the current behavior**\r\n\r\nWhen calling `sess.run` for certain graphs (e.g., see below), the session call gets stuck in an infinite loop.\r\n\r\n**Describe the expected behavior**\r\n\r\nThe session call should complete normally.\r\n\r\n**Code to reproduce the issue**\r\n\r\n```\r\nimport numpy as np\r\nimport tensorflow as tf\r\n\r\nconst1 = tf.zeros((1,))\r\nconst2 = tf.zeros((1,))\r\nconst3 = tf.zeros((1,))\r\nconst4 = tf.zeros((1,))\r\nph = tf.placeholder(tf.float32, (1,))\r\n\r\nc1 = tf.concat((const1, const2, ph), axis=0)\r\nc2 = tf.concat((const3, const4, c1), axis=0)\r\n\r\nwith tf.Session() as sess:\r\n    sess.run(c2, feed_dict={ph: np.zeros((1,))})  # gets stuck in infinite loop here\r\n```\r\n\r\n**Other info / logs**\r\nSpecifically, the build process is getting stuck in the ``ConstantFolding`` optimization pass.  This is due to the new ``MergeConcat`` optimization introduced in https://github.com/tensorflow/tensorflow/commit/e96d65246835b3a33a55c70d1f1057517ef0aa8e.  It can create a graph structure that causes the ``PartialConcatConstFolding`` optimization to enter an infinite loop.\r\n"}