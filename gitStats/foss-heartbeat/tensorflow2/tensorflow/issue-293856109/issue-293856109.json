{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16692", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16692/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16692/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16692/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/16692", "id": 293856109, "node_id": "MDU6SXNzdWUyOTM4NTYxMDk=", "number": 16692, "title": "Bug: using pandas_input_fn with tensorflow.contrib.tensor_forest.client.random_forest.TensorForestEstimator", "user": {"login": "chrysantd", "id": 10464099, "node_id": "MDQ6VXNlcjEwNDY0MDk5", "avatar_url": "https://avatars0.githubusercontent.com/u/10464099?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chrysantd", "html_url": "https://github.com/chrysantd", "followers_url": "https://api.github.com/users/chrysantd/followers", "following_url": "https://api.github.com/users/chrysantd/following{/other_user}", "gists_url": "https://api.github.com/users/chrysantd/gists{/gist_id}", "starred_url": "https://api.github.com/users/chrysantd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chrysantd/subscriptions", "organizations_url": "https://api.github.com/users/chrysantd/orgs", "repos_url": "https://api.github.com/users/chrysantd/repos", "events_url": "https://api.github.com/users/chrysantd/events{/privacy}", "received_events_url": "https://api.github.com/users/chrysantd/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "nataliaponomareva", "id": 4313109, "node_id": "MDQ6VXNlcjQzMTMxMDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/4313109?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nataliaponomareva", "html_url": "https://github.com/nataliaponomareva", "followers_url": "https://api.github.com/users/nataliaponomareva/followers", "following_url": "https://api.github.com/users/nataliaponomareva/following{/other_user}", "gists_url": "https://api.github.com/users/nataliaponomareva/gists{/gist_id}", "starred_url": "https://api.github.com/users/nataliaponomareva/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nataliaponomareva/subscriptions", "organizations_url": "https://api.github.com/users/nataliaponomareva/orgs", "repos_url": "https://api.github.com/users/nataliaponomareva/repos", "events_url": "https://api.github.com/users/nataliaponomareva/events{/privacy}", "received_events_url": "https://api.github.com/users/nataliaponomareva/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "nataliaponomareva", "id": 4313109, "node_id": "MDQ6VXNlcjQzMTMxMDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/4313109?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nataliaponomareva", "html_url": "https://github.com/nataliaponomareva", "followers_url": "https://api.github.com/users/nataliaponomareva/followers", "following_url": "https://api.github.com/users/nataliaponomareva/following{/other_user}", "gists_url": "https://api.github.com/users/nataliaponomareva/gists{/gist_id}", "starred_url": "https://api.github.com/users/nataliaponomareva/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nataliaponomareva/subscriptions", "organizations_url": "https://api.github.com/users/nataliaponomareva/orgs", "repos_url": "https://api.github.com/users/nataliaponomareva/repos", "events_url": "https://api.github.com/users/nataliaponomareva/events{/privacy}", "received_events_url": "https://api.github.com/users/nataliaponomareva/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 9, "created_at": "2018-02-02T11:21:48Z", "updated_at": "2018-07-16T15:58:33Z", "closed_at": "2018-02-22T20:50:25Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li>**Have I written custom code:  YES</li>\n<li>**OS Platform and Distribution : Linux Ubuntu 16.04 LTS</li>\n<li>**TensorFlow installed from : pip</li>\n<li>**TensorFlow version (use command below): 1.4.1</li>\n<li>**Python version: 2.7.12</li>\n</ul>\n<h3>Describe the problem</h3>\n<h3>Source code / logs</h3>\n<p>I am working on a simple Tensorflow programme, and build input pipeline with pandas.My code is below:</p>\n<pre><code>def train_rf(X,Y):\n  print(X.shape) #output is  (53443, 131)\n  print(Y.shape) #output is  (53443,)\n\n  #features is the list of names of features\n  params = tensor_forest.ForestHParams(\n      num_classes=2,\n      num_features=len(features),\n      num_trees=config['rf']['num_trees'])\n\n  est = random_forest.TensorForestEstimator(params, model_dir=config['rf']['model_dir'])\n\n  train_input_fn = tf.estimator.inputs.pandas_input_fn(\n      X,\n      y=Y,\n      batch_size=config['rf']['train_batch_size'],\n      num_epochs=1,\n      shuffle=True)\n\n  est.fit(input_fn=train_input_fn, steps=100)\n</code></pre>\n<p>However, when I run this function, I got error like this:</p>\n<pre><code>    Traceback (most recent call last):\n      File \"random_forest.py\", line 118, in &lt;module&gt;\n        train_rf(train_ohd[features].iloc[X_1],l(y_1),train_ohd[features].iloc[X_2])\n      File \"random_forest.py\", line 44, in train_rf\n        est.fit(input_fn=train_input_fn, steps=100)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/util/deprecation.py\", line 316, in new_func\n        return func(*args, **kwargs)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 480, in fit\n        loss = self._train_model(input_fn=input_fn, hooks=hooks)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 986, in _train_model\n        model_fn_ops = self._get_train_ops(features, labels)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 1202, in _get_train_ops\n        return self._call_model_fn(features, labels, model_fn_lib.ModeKeys.TRAIN)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 1166, in _call_model_fn\n        model_fn_results = self._model_fn(features, labels, **kwargs)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/tensor_forest/client/random_forest.py\", line 171, in _model_fn\n        features)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/tensor_forest/python/tensor_forest.py\", line 489, in inference_graph\n        data_ops.ParseDataTensorOrDict(input_data))\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/tensor_forest/python/ops/data_ops.py\", line 159, in ParseDataTensorOrDict\n        processed_dense_features = array_ops.concat(dense_features, 1)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/array_ops.py\", line 1099, in concat\n        return gen_array_ops._concat_v2(values=values, axis=axis, name=name)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_array_ops.py\", line 706, in _concat_v2\n        \"ConcatV2\", values=values, axis=axis, name=name)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\n        op_def=op_def)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2958, in create_op\n        set_shapes_for_outputs(ret)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2209, in set_shapes_for_outputs\n        shapes = shape_func(op)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2159, in call_with_requiring\n        return call_cpp_shape_fn(op, require_shape_fn=True)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/common_shapes.py\", line 627, in call_cpp_shape_fn\n        require_shape_fn)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/common_shapes.py\", line 691, in _call_cpp_shape_fn_impl\n        raise ValueError(err.message)\n    ValueError: Shape must be at least rank 2 but is rank 1 for 'concat' (op: 'ConcatV2') with input shapes: [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [] and with computed input tensors: input[131] = &lt;1&gt;.\n</code></pre>\n<p>The output of <code>print(X.shape)</code> and <code>print(Y.shape)</code> is <code>(53443, 131)</code>, <code>(53443,)</code> respectively. So I got confused why there will be 132 dimensions in input and why I got this <code>ValueError</code>?</p>\n<p>What's more, when I used <code>tf.contrib.learn.LinearRegressor</code> to replace <code>TensorForestEstimator</code>, I can train and eval model with no error. So there's no problems in my <code>train_input_fn</code> and I assume this is a bug of Tensorflow.</p>", "body_text": "System information\n\n**Have I written custom code:  YES\n**OS Platform and Distribution : Linux Ubuntu 16.04 LTS\n**TensorFlow installed from : pip\n**TensorFlow version (use command below): 1.4.1\n**Python version: 2.7.12\n\nDescribe the problem\nSource code / logs\nI am working on a simple Tensorflow programme, and build input pipeline with pandas.My code is below:\ndef train_rf(X,Y):\n  print(X.shape) #output is  (53443, 131)\n  print(Y.shape) #output is  (53443,)\n\n  #features is the list of names of features\n  params = tensor_forest.ForestHParams(\n      num_classes=2,\n      num_features=len(features),\n      num_trees=config['rf']['num_trees'])\n\n  est = random_forest.TensorForestEstimator(params, model_dir=config['rf']['model_dir'])\n\n  train_input_fn = tf.estimator.inputs.pandas_input_fn(\n      X,\n      y=Y,\n      batch_size=config['rf']['train_batch_size'],\n      num_epochs=1,\n      shuffle=True)\n\n  est.fit(input_fn=train_input_fn, steps=100)\n\nHowever, when I run this function, I got error like this:\n    Traceback (most recent call last):\n      File \"random_forest.py\", line 118, in <module>\n        train_rf(train_ohd[features].iloc[X_1],l(y_1),train_ohd[features].iloc[X_2])\n      File \"random_forest.py\", line 44, in train_rf\n        est.fit(input_fn=train_input_fn, steps=100)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/util/deprecation.py\", line 316, in new_func\n        return func(*args, **kwargs)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 480, in fit\n        loss = self._train_model(input_fn=input_fn, hooks=hooks)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 986, in _train_model\n        model_fn_ops = self._get_train_ops(features, labels)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 1202, in _get_train_ops\n        return self._call_model_fn(features, labels, model_fn_lib.ModeKeys.TRAIN)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 1166, in _call_model_fn\n        model_fn_results = self._model_fn(features, labels, **kwargs)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/tensor_forest/client/random_forest.py\", line 171, in _model_fn\n        features)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/tensor_forest/python/tensor_forest.py\", line 489, in inference_graph\n        data_ops.ParseDataTensorOrDict(input_data))\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/tensor_forest/python/ops/data_ops.py\", line 159, in ParseDataTensorOrDict\n        processed_dense_features = array_ops.concat(dense_features, 1)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/array_ops.py\", line 1099, in concat\n        return gen_array_ops._concat_v2(values=values, axis=axis, name=name)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_array_ops.py\", line 706, in _concat_v2\n        \"ConcatV2\", values=values, axis=axis, name=name)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\n        op_def=op_def)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2958, in create_op\n        set_shapes_for_outputs(ret)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2209, in set_shapes_for_outputs\n        shapes = shape_func(op)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2159, in call_with_requiring\n        return call_cpp_shape_fn(op, require_shape_fn=True)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/common_shapes.py\", line 627, in call_cpp_shape_fn\n        require_shape_fn)\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/common_shapes.py\", line 691, in _call_cpp_shape_fn_impl\n        raise ValueError(err.message)\n    ValueError: Shape must be at least rank 2 but is rank 1 for 'concat' (op: 'ConcatV2') with input shapes: [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [] and with computed input tensors: input[131] = <1>.\n\nThe output of print(X.shape) and print(Y.shape) is (53443, 131), (53443,) respectively. So I got confused why there will be 132 dimensions in input and why I got this ValueError?\nWhat's more, when I used tf.contrib.learn.LinearRegressor to replace TensorForestEstimator, I can train and eval model with no error. So there's no problems in my train_input_fn and I assume this is a bug of Tensorflow.", "body": "### System information\r\n- **Have I written custom code:  YES\r\n- **OS Platform and Distribution : Linux Ubuntu 16.04 LTS\r\n- **TensorFlow installed from : pip\r\n- **TensorFlow version (use command below): 1.4.1\r\n- **Python version: 2.7.12 \r\n\r\n### Describe the problem\r\n\r\n\r\n### Source code / logs\r\n\r\nI am working on a simple Tensorflow programme, and build input pipeline with pandas.My code is below:\r\n\r\n```\r\ndef train_rf(X,Y):\r\n  print(X.shape) #output is  (53443, 131)\r\n  print(Y.shape) #output is  (53443,)\r\n\r\n  #features is the list of names of features\r\n  params = tensor_forest.ForestHParams(\r\n      num_classes=2,\r\n      num_features=len(features),\r\n      num_trees=config['rf']['num_trees'])\r\n\r\n  est = random_forest.TensorForestEstimator(params, model_dir=config['rf']['model_dir'])\r\n\r\n  train_input_fn = tf.estimator.inputs.pandas_input_fn(\r\n      X,\r\n      y=Y,\r\n      batch_size=config['rf']['train_batch_size'],\r\n      num_epochs=1,\r\n      shuffle=True)\r\n\r\n  est.fit(input_fn=train_input_fn, steps=100)\r\n```\r\n\r\nHowever, when I run this function, I got error like this:\r\n```\r\n    Traceback (most recent call last):\r\n      File \"random_forest.py\", line 118, in <module>\r\n        train_rf(train_ohd[features].iloc[X_1],l(y_1),train_ohd[features].iloc[X_2])\r\n      File \"random_forest.py\", line 44, in train_rf\r\n        est.fit(input_fn=train_input_fn, steps=100)\r\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/util/deprecation.py\", line 316, in new_func\r\n        return func(*args, **kwargs)\r\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 480, in fit\r\n        loss = self._train_model(input_fn=input_fn, hooks=hooks)\r\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 986, in _train_model\r\n        model_fn_ops = self._get_train_ops(features, labels)\r\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 1202, in _get_train_ops\r\n        return self._call_model_fn(features, labels, model_fn_lib.ModeKeys.TRAIN)\r\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py\", line 1166, in _call_model_fn\r\n        model_fn_results = self._model_fn(features, labels, **kwargs)\r\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/tensor_forest/client/random_forest.py\", line 171, in _model_fn\r\n        features)\r\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/tensor_forest/python/tensor_forest.py\", line 489, in inference_graph\r\n        data_ops.ParseDataTensorOrDict(input_data))\r\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/tensor_forest/python/ops/data_ops.py\", line 159, in ParseDataTensorOrDict\r\n        processed_dense_features = array_ops.concat(dense_features, 1)\r\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/array_ops.py\", line 1099, in concat\r\n        return gen_array_ops._concat_v2(values=values, axis=axis, name=name)\r\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_array_ops.py\", line 706, in _concat_v2\r\n        \"ConcatV2\", values=values, axis=axis, name=name)\r\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\r\n        op_def=op_def)\r\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2958, in create_op\r\n        set_shapes_for_outputs(ret)\r\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2209, in set_shapes_for_outputs\r\n        shapes = shape_func(op)\r\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2159, in call_with_requiring\r\n        return call_cpp_shape_fn(op, require_shape_fn=True)\r\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/common_shapes.py\", line 627, in call_cpp_shape_fn\r\n        require_shape_fn)\r\n      File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/common_shapes.py\", line 691, in _call_cpp_shape_fn_impl\r\n        raise ValueError(err.message)\r\n    ValueError: Shape must be at least rank 2 but is rank 1 for 'concat' (op: 'ConcatV2') with input shapes: [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [?], [] and with computed input tensors: input[131] = <1>.\r\n```\r\n\r\nThe output of `print(X.shape)` and `print(Y.shape)` is `(53443, 131)`, `(53443,)` respectively. So I got confused why there will be 132 dimensions in input and why I got this `ValueError`?\r\n\r\nWhat's more, when I used `tf.contrib.learn.LinearRegressor` to replace `TensorForestEstimator`, I can train and eval model with no error. So there's no problems in my `train_input_fn` and I assume this is a bug of Tensorflow.\r\n"}