{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/139276117", "pull_request_review_id": 63192553, "id": 139276117, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzOTI3NjExNw==", "diff_hunk": "@@ -259,4 +261,50 @@ Status FileSystem::RecursivelyCreateDir(const string& dirname) {\n   return Status::OK();\n }\n \n+Status FileSystem::CopyFile(const string& src, const string& target) {\n+  uint64 size;\n+  Status s = GetFileSize(src, &size);\n+  if (!s.ok()) {\n+    return s;\n+  }\n+  std::unique_ptr<RandomAccessFile> src_file;\n+  s = NewRandomAccessFile(src, &src_file);\n+  if (!s.ok()) {\n+    return s;\n+  }\n+  std::unique_ptr<WritableFile> target_file;\n+  s = NewWritableFile(target, &target_file);\n+  if (!s.ok()) {\n+    return s;\n+  }\n+\n+  uint64 offset = 0;\n+  while (offset < size) {\n+    char scratch[kCopyFileBufferSize];\n+    StringPiece result;\n+    size_t chunk =\n+        offset + sizeof(scratch) < size ? sizeof(scratch) : size - offset;\n+    s = src_file->Read(offset, chunk, &result, scratch);\n+    if (!s.ok()) {\n+      return s;\n+    }\n+\n+    s = target_file->Append(result);\n+    if (!s.ok()) {\n+      return s;\n+    }\n+\n+    offset += chunk;\n+  }\n+  s = GetFileSize(src, &size);\n+  if (!s.ok()) {\n+    return s;\n+  }\n+  if (offset != size) {\n+    return errors::Aborted(\"File \", src, \" changed while reading: \", size,", "path": "tensorflow/core/platform/file_system.cc", "position": null, "original_position": 53, "commit_id": "b87e4c4d1e27a34eeaa835a6193eb0a66f2152ee", "original_commit_id": "db8639110f34455de1d67c69811358098c4b44d2", "user": {"login": "yongtang", "id": 6932348, "node_id": "MDQ6VXNlcjY5MzIzNDg=", "avatar_url": "https://avatars0.githubusercontent.com/u/6932348?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yongtang", "html_url": "https://github.com/yongtang", "followers_url": "https://api.github.com/users/yongtang/followers", "following_url": "https://api.github.com/users/yongtang/following{/other_user}", "gists_url": "https://api.github.com/users/yongtang/gists{/gist_id}", "starred_url": "https://api.github.com/users/yongtang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yongtang/subscriptions", "organizations_url": "https://api.github.com/users/yongtang/orgs", "repos_url": "https://api.github.com/users/yongtang/repos", "events_url": "https://api.github.com/users/yongtang/events{/privacy}", "received_events_url": "https://api.github.com/users/yongtang/received_events", "type": "User", "site_admin": false}, "body": "@rohan100jain That was to follow the old semantics (where no partial copy in memory). Now as we use streaming, it is not possible to rollback any way. The `cp` in Linux is not impacted by the file change so I just removed the check at the end.", "created_at": "2017-09-16T02:23:43Z", "updated_at": "2017-12-12T00:28:21Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/12658#discussion_r139276117", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12658", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/139276117"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/12658#discussion_r139276117"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12658"}}, "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=144114\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rohan100jain\">@rohan100jain</a> That was to follow the old semantics (where no partial copy in memory). Now as we use streaming, it is not possible to rollback any way. The <code>cp</code> in Linux is not impacted by the file change so I just removed the check at the end.</p>", "body_text": "@rohan100jain That was to follow the old semantics (where no partial copy in memory). Now as we use streaming, it is not possible to rollback any way. The cp in Linux is not impacted by the file change so I just removed the check at the end.", "in_reply_to_id": 137835789}