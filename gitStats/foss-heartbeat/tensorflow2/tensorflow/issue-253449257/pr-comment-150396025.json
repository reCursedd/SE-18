{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/150396025", "pull_request_review_id": 75944617, "id": 150396025, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1MDM5NjAyNQ==", "diff_hunk": "@@ -276,4 +281,57 @@ Status PosixFileSystem::RenameFile(const string& src, const string& target) {\n   return result;\n }\n \n+Status PosixFileSystem::CopyFile(const string& src, const string& target) {\n+  string translated_src = TranslateName(src);\n+  struct stat sbuf;\n+  if (stat(translated_src.c_str(), &sbuf) != 0) {\n+    return IOError(src, errno);\n+  }\n+  int src_fd = open(translated_src.c_str(), O_RDONLY);\n+  if (src_fd < 0) {\n+    return IOError(src, errno);\n+  }\n+  string translated_target = TranslateName(target);\n+  // O_WRONLY | O_CREAT:\n+  //   Open file for write and if file does not exist, create the file.\n+  // S_IRUSR | S_IWUSR | S_IRGRP | S_IWGRP | S_IROTH | S_IWOTH:\n+  //   Create the file with permission of 0666\n+  int target_fd =\n+      open(translated_target.c_str(), O_WRONLY | O_CREAT,\n+           S_IRUSR | S_IWUSR | S_IRGRP | S_IWGRP | S_IROTH | S_IWOTH);\n+  if (target_fd < 0) {\n+    close(src_fd);\n+    return IOError(target, errno);\n+  }\n+  int rc = 0;\n+  off_t offset = 0;\n+  while (offset < sbuf.st_size) {\n+    size_t chunk = (sbuf.st_size - offset) < SSIZE_MAX ? (sbuf.st_size - offset)\n+                                                       : SSIZE_MAX;\n+#if !defined(__APPLE__)", "path": "tensorflow/core/platform/posix/posix_file_system.cc", "position": null, "original_position": 50, "commit_id": "b87e4c4d1e27a34eeaa835a6193eb0a66f2152ee", "original_commit_id": "1e559beff83d2e9f5be0dc1f41392000091f42c3", "user": {"login": "jart", "id": 49262, "node_id": "MDQ6VXNlcjQ5MjYy", "avatar_url": "https://avatars1.githubusercontent.com/u/49262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jart", "html_url": "https://github.com/jart", "followers_url": "https://api.github.com/users/jart/followers", "following_url": "https://api.github.com/users/jart/following{/other_user}", "gists_url": "https://api.github.com/users/jart/gists{/gist_id}", "starred_url": "https://api.github.com/users/jart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jart/subscriptions", "organizations_url": "https://api.github.com/users/jart/orgs", "repos_url": "https://api.github.com/users/jart/repos", "events_url": "https://api.github.com/users/jart/events{/privacy}", "received_events_url": "https://api.github.com/users/jart/received_events", "type": "User", "site_admin": false}, "body": "Having done more homework, I would say change this to `#if defined(__linux__) && !defined(__ANDROID__)` because it won't work on FreeBSD and you never know with Android. I've confirmed it will work on Linux kernels \u22652.6.33 (published in 2010.) TensorFlow supports as far back as CentOS 7, which uses Linux 3.10.0, so this should be fine. If we want to be even more conservative, we could use the [splice](https://en.wikipedia.org/wiki/Splice_(system_call)) system call instead, which became available in 2.6.17 in 2006. It's Linux-only, but we've constrained ourselves to Linux anyway.", "created_at": "2017-11-11T23:18:52Z", "updated_at": "2017-12-12T00:28:21Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/12658#discussion_r150396025", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12658", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/150396025"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/12658#discussion_r150396025"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/12658"}}, "body_html": "<p>Having done more homework, I would say change this to <code>#if defined(__linux__) &amp;&amp; !defined(__ANDROID__)</code> because it won't work on FreeBSD and you never know with Android. I've confirmed it will work on Linux kernels \u22652.6.33 (published in 2010.) TensorFlow supports as far back as CentOS 7, which uses Linux 3.10.0, so this should be fine. If we want to be even more conservative, we could use the <a href=\"https://en.wikipedia.org/wiki/Splice_(system_call)\" rel=\"nofollow\">splice</a> system call instead, which became available in 2.6.17 in 2006. It's Linux-only, but we've constrained ourselves to Linux anyway.</p>", "body_text": "Having done more homework, I would say change this to #if defined(__linux__) && !defined(__ANDROID__) because it won't work on FreeBSD and you never know with Android. I've confirmed it will work on Linux kernels \u22652.6.33 (published in 2010.) TensorFlow supports as far back as CentOS 7, which uses Linux 3.10.0, so this should be fine. If we want to be even more conservative, we could use the splice system call instead, which became available in 2.6.17 in 2006. It's Linux-only, but we've constrained ourselves to Linux anyway."}