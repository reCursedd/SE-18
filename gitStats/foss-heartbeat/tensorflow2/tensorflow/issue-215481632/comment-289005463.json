{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/289005463", "html_url": "https://github.com/tensorflow/tensorflow/issues/8559#issuecomment-289005463", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8559", "id": 289005463, "node_id": "MDEyOklzc3VlQ29tbWVudDI4OTAwNTQ2Mw==", "user": {"login": "gaohuazuo", "id": 10446514, "node_id": "MDQ6VXNlcjEwNDQ2NTE0", "avatar_url": "https://avatars0.githubusercontent.com/u/10446514?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gaohuazuo", "html_url": "https://github.com/gaohuazuo", "followers_url": "https://api.github.com/users/gaohuazuo/followers", "following_url": "https://api.github.com/users/gaohuazuo/following{/other_user}", "gists_url": "https://api.github.com/users/gaohuazuo/gists{/gist_id}", "starred_url": "https://api.github.com/users/gaohuazuo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gaohuazuo/subscriptions", "organizations_url": "https://api.github.com/users/gaohuazuo/orgs", "repos_url": "https://api.github.com/users/gaohuazuo/repos", "events_url": "https://api.github.com/users/gaohuazuo/events{/privacy}", "received_events_url": "https://api.github.com/users/gaohuazuo/received_events", "type": "User", "site_admin": false}, "created_at": "2017-03-24T12:03:14Z", "updated_at": "2017-03-24T12:12:53Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Maybe you can try <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/framework/function.py\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/framework/function.py</a>. It allows you to construct a new op with existing ones, and define its gradient.</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">from</span> tensorflow.python.framework.function <span class=\"pl-k\">import</span> Defun\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">_projection_func_grad</span>(<span class=\"pl-smi\">op</span>, <span class=\"pl-smi\">grad</span>):\n    <span class=\"pl-c\"><span class=\"pl-c\">#</span> compute the (fake) gradient, in this case just pass it through</span>\n    <span class=\"pl-k\">return</span> grad\n\n<span class=\"pl-en\">@Defun</span>(tf.float32, <span class=\"pl-v\">python_grad_func</span><span class=\"pl-k\">=</span>_projection_func_grad)\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">projection_func</span>(<span class=\"pl-smi\">weights</span>):\n    <span class=\"pl-c\"><span class=\"pl-c\">#</span> do something</span>\n    <span class=\"pl-k\">return</span> weights</pre></div>", "body_text": "Maybe you can try https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/framework/function.py. It allows you to construct a new op with existing ones, and define its gradient.\nfrom tensorflow.python.framework.function import Defun\n\ndef _projection_func_grad(op, grad):\n    # compute the (fake) gradient, in this case just pass it through\n    return grad\n\n@Defun(tf.float32, python_grad_func=_projection_func_grad)\ndef projection_func(weights):\n    # do something\n    return weights", "body": "Maybe you can try https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/framework/function.py. It allows you to construct a new op with existing ones, and define its gradient.\r\n\r\n```python\r\nfrom tensorflow.python.framework.function import Defun\r\n\r\ndef _projection_func_grad(op, grad):\r\n    # compute the (fake) gradient, in this case just pass it through\r\n    return grad\r\n\r\n@Defun(tf.float32, python_grad_func=_projection_func_grad)\r\ndef projection_func(weights):\r\n    # do something\r\n    return weights\r\n```"}