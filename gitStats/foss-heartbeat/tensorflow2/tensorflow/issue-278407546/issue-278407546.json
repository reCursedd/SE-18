{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15032", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15032/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15032/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15032/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/15032", "id": 278407546, "node_id": "MDU6SXNzdWUyNzg0MDc1NDY=", "number": 15032, "title": "Error while implementing the feature requested in  #10767", "user": {"login": "rezwan16", "id": 34155726, "node_id": "MDQ6VXNlcjM0MTU1NzI2", "avatar_url": "https://avatars2.githubusercontent.com/u/34155726?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rezwan16", "html_url": "https://github.com/rezwan16", "followers_url": "https://api.github.com/users/rezwan16/followers", "following_url": "https://api.github.com/users/rezwan16/following{/other_user}", "gists_url": "https://api.github.com/users/rezwan16/gists{/gist_id}", "starred_url": "https://api.github.com/users/rezwan16/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rezwan16/subscriptions", "organizations_url": "https://api.github.com/users/rezwan16/orgs", "repos_url": "https://api.github.com/users/rezwan16/repos", "events_url": "https://api.github.com/users/rezwan16/events{/privacy}", "received_events_url": "https://api.github.com/users/rezwan16/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2017-12-01T09:34:33Z", "updated_at": "2017-12-08T12:24:55Z", "closed_at": "2017-12-07T17:35:10Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li>\n<p><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:<br>\nYes</p>\n</li>\n<li>\n<p><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>:<br>\nRHEL 6.8</p>\n</li>\n<li>\n<p><strong>TensorFlow installed from (source or binary)</strong>:<br>\nbinary</p>\n</li>\n<li>\n<p><strong>TensorFlow version (use command below)</strong>:<br>\n'v1.3.0-rc1-5326-gcae852a', '1.4.0'</p>\n</li>\n<li>\n<p><strong>Python version</strong>:<br>\n2.7.14</p>\n</li>\n<li>\n<p><strong>Bazel version (if compiling from source)</strong>:<br>\nBuild label: 0.5.4- (@non-git)</p>\n</li>\n<li>\n<p><strong>GCC/Compiler version (if compiling from source)</strong>:<br>\n4.8.5</p>\n</li>\n<li>\n<p><strong>CUDA/cuDNN version</strong>:<br>\nNot installed</p>\n</li>\n<li>\n<p><strong>GPU model and memory</strong>:<br>\nUsing tensorflow for CPU</p>\n</li>\n<li>\n<p><strong>Exact command to reproduce</strong>:<br>\nI want to implement <em>in_top_k</em> operation with options to specify what to do when a tie occurs for <a href=\"https://github.com/tensorflow/models/tree/master/tutorials/image/cifar10\">CIFAR-10</a> data-set. I came across this feature request in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"236500703\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/10767\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/10767/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/10767\">#10767</a>, modified the 6-files as shown <a href=\"https://github.com/nolanliou/tensorflow/commit/681724f94e025bbd8377c5406eec4047d58fc31b\">here</a>, and rebuilt from source. When I run <em>eval_CIFAR10.py</em> which contains the <em>in_top_k</em> op, I get the following error.</p>\n<p>File \"eval_CIFAR10.py\", line 146, in <br>\ntf.app.run()<br>\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 129, in run<br>\n_sys.exit(main(argv))<br>\nFile \"eval_CIFAR10.py\", line 141, in main<br>\nevaluate()<br>\nFile \"eval_CIFAR10.py\", line 130, in evaluate<br>\neval_once(saver, summary_writer, top_k_op, summary_op)<br>\nFile \"eval_CIFAR10.py\", line 63, in eval_once<br>\nsaver.restore(sess, ckpt.model_checkpoint_path)<br>\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/training/saver.py\", line 1686, in restore<br>\n{self.saver_def.filename_tensor_name: save_path})<br>\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 889, in run<br>\nrun_metadata_ptr)<br>\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1120, in _run<br>\nfeed_dict_tensor, options, run_metadata)<br>\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1317, in _do_run<br>\noptions, run_metadata)<br>\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1336, in _do_call<br>\nraise type(e)(node_def, op, message)<br>\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Multiple OpKernel registrations match NodeDef 'in_top_k/InTopKV2 = InTopKV2[T=DT_INT32, handle_ties=\"SAMPLE\"](softmax_linear/softmax_linear, Reshape_2, in_top_k/InTopKV2/k)': 'op: \"InTopKV2\" device_type: \"CPU\" constraint { name: \"T\" allowed_values { list { type: DT_INT32 } } } host_memory_arg: \"predictions\" host_memory_arg: \"targets\" host_memory_arg: \"k\" host_memory_arg: \"precision\"' and 'op: \"InTopKV2\" device_type: \"CPU\" constraint { name: \"T\" allowed_values { list { type: DT_INT32 } } } host_memory_arg: \"predictions\" host_memory_arg: \"targets\" host_memory_arg: \"k\" host_memory_arg: \"precision\"'<br>\n[[Node: in_top_k/InTopKV2 = InTopKV2[T=DT_INT32, handle_ties=\"SAMPLE\"](softmax_linear/softmax_linear, Reshape_2, in_top_k/InTopKV2/k)]]</p>\n</li>\n</ul>\n<p>Caused by op u'in_top_k/InTopKV2', defined at:<br>\nFile \"eval_CIFAR10.py\", line 146, in <br>\ntf.app.run()<br>\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 129, in run<br>\n_sys.exit(main(argv))<br>\nFile \"eval_CIFAR10.py\", line 141, in main<br>\nevaluate()<br>\nFile \"eval_CIFAR10.py\", line 116, in evaluate<br>\ntop_k_op = tf.nn.in_top_k(logits, labels, 1, handle_ties=\"SAMPLE\")<br>\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/nn_ops.py\", line 2523, in in_top_k<br>\nreturn gen_nn_ops._in_top_kv2(predictions, targets, k, handle_ties, name=name)<br>\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/gen_nn_ops.py\", line 2536, in _in_top_kv2<br>\nhandle_ties=handle_ties, name=name)<br>\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper<br>\nop_def=op_def)<br>\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 3101, in create_op<br>\nop_def=op_def)<br>\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1583, in <strong>init</strong><br>\nself._traceback = self._graph._extract_stack()  # pylint: disable=protected-access</p>\n<p>InvalidArgumentError (see above for traceback): Multiple OpKernel registrations match NodeDef 'in_top_k/InTopKV2 = InTopKV2[T=DT_INT32, handle_ties=\"SAMPLE\"](softmax_linear/softmax_linear, Reshape_2, in_top_k/InTopKV2/k)': 'op: \"InTopKV2\" device_type: \"CPU\" constraint { name: \"T\" allowed_values { list { type: DT_INT32 } } } host_memory_arg: \"predictions\" host_memory_arg: \"targets\" host_memory_arg: \"k\" host_memory_arg: \"precision\"' and 'op: \"InTopKV2\" device_type: \"CPU\" constraint { name: \"T\" allowed_values { list { type: DT_INT32 } } } host_memory_arg: \"predictions\" host_memory_arg: \"targets\" host_memory_arg: \"k\" host_memory_arg: \"precision\"'<br>\n[[Node: in_top_k/InTopKV2 = InTopKV2[T=DT_INT32, handle_ties=\"SAMPLE\"](softmax_linear/softmax_linear, Reshape_2, in_top_k/InTopKV2/k)]]</p>\n<p>If you can kindly look into the matter I shall be much helped. Thank you.</p>", "body_text": "System information\n\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nYes\n\n\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\nRHEL 6.8\n\n\nTensorFlow installed from (source or binary):\nbinary\n\n\nTensorFlow version (use command below):\n'v1.3.0-rc1-5326-gcae852a', '1.4.0'\n\n\nPython version:\n2.7.14\n\n\nBazel version (if compiling from source):\nBuild label: 0.5.4- (@non-git)\n\n\nGCC/Compiler version (if compiling from source):\n4.8.5\n\n\nCUDA/cuDNN version:\nNot installed\n\n\nGPU model and memory:\nUsing tensorflow for CPU\n\n\nExact command to reproduce:\nI want to implement in_top_k operation with options to specify what to do when a tie occurs for CIFAR-10 data-set. I came across this feature request in #10767, modified the 6-files as shown here, and rebuilt from source. When I run eval_CIFAR10.py which contains the in_top_k op, I get the following error.\nFile \"eval_CIFAR10.py\", line 146, in \ntf.app.run()\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 129, in run\n_sys.exit(main(argv))\nFile \"eval_CIFAR10.py\", line 141, in main\nevaluate()\nFile \"eval_CIFAR10.py\", line 130, in evaluate\neval_once(saver, summary_writer, top_k_op, summary_op)\nFile \"eval_CIFAR10.py\", line 63, in eval_once\nsaver.restore(sess, ckpt.model_checkpoint_path)\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/training/saver.py\", line 1686, in restore\n{self.saver_def.filename_tensor_name: save_path})\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 889, in run\nrun_metadata_ptr)\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1120, in _run\nfeed_dict_tensor, options, run_metadata)\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1317, in _do_run\noptions, run_metadata)\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1336, in _do_call\nraise type(e)(node_def, op, message)\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Multiple OpKernel registrations match NodeDef 'in_top_k/InTopKV2 = InTopKV2[T=DT_INT32, handle_ties=\"SAMPLE\"](softmax_linear/softmax_linear, Reshape_2, in_top_k/InTopKV2/k)': 'op: \"InTopKV2\" device_type: \"CPU\" constraint { name: \"T\" allowed_values { list { type: DT_INT32 } } } host_memory_arg: \"predictions\" host_memory_arg: \"targets\" host_memory_arg: \"k\" host_memory_arg: \"precision\"' and 'op: \"InTopKV2\" device_type: \"CPU\" constraint { name: \"T\" allowed_values { list { type: DT_INT32 } } } host_memory_arg: \"predictions\" host_memory_arg: \"targets\" host_memory_arg: \"k\" host_memory_arg: \"precision\"'\n[[Node: in_top_k/InTopKV2 = InTopKV2[T=DT_INT32, handle_ties=\"SAMPLE\"](softmax_linear/softmax_linear, Reshape_2, in_top_k/InTopKV2/k)]]\n\n\nCaused by op u'in_top_k/InTopKV2', defined at:\nFile \"eval_CIFAR10.py\", line 146, in \ntf.app.run()\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 129, in run\n_sys.exit(main(argv))\nFile \"eval_CIFAR10.py\", line 141, in main\nevaluate()\nFile \"eval_CIFAR10.py\", line 116, in evaluate\ntop_k_op = tf.nn.in_top_k(logits, labels, 1, handle_ties=\"SAMPLE\")\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/nn_ops.py\", line 2523, in in_top_k\nreturn gen_nn_ops._in_top_kv2(predictions, targets, k, handle_ties, name=name)\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/gen_nn_ops.py\", line 2536, in _in_top_kv2\nhandle_ties=handle_ties, name=name)\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\nop_def=op_def)\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 3101, in create_op\nop_def=op_def)\nFile \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1583, in init\nself._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\nInvalidArgumentError (see above for traceback): Multiple OpKernel registrations match NodeDef 'in_top_k/InTopKV2 = InTopKV2[T=DT_INT32, handle_ties=\"SAMPLE\"](softmax_linear/softmax_linear, Reshape_2, in_top_k/InTopKV2/k)': 'op: \"InTopKV2\" device_type: \"CPU\" constraint { name: \"T\" allowed_values { list { type: DT_INT32 } } } host_memory_arg: \"predictions\" host_memory_arg: \"targets\" host_memory_arg: \"k\" host_memory_arg: \"precision\"' and 'op: \"InTopKV2\" device_type: \"CPU\" constraint { name: \"T\" allowed_values { list { type: DT_INT32 } } } host_memory_arg: \"predictions\" host_memory_arg: \"targets\" host_memory_arg: \"k\" host_memory_arg: \"precision\"'\n[[Node: in_top_k/InTopKV2 = InTopKV2[T=DT_INT32, handle_ties=\"SAMPLE\"](softmax_linear/softmax_linear, Reshape_2, in_top_k/InTopKV2/k)]]\nIf you can kindly look into the matter I shall be much helped. Thank you.", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\nYes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**:\r\nRHEL 6.8 \r\n- **TensorFlow installed from (source or binary)**:\r\nbinary\r\n- **TensorFlow version (use command below)**:\r\n'v1.3.0-rc1-5326-gcae852a', '1.4.0'\r\n- **Python version**: \r\n2.7.14\r\n- **Bazel version (if compiling from source)**:\r\nBuild label: 0.5.4- (@non-git)\r\n- **GCC/Compiler version (if compiling from source)**:\r\n4.8.5\r\n- **CUDA/cuDNN version**:\r\nNot installed\r\n- **GPU model and memory**:\r\nUsing tensorflow for CPU\r\n- **Exact command to reproduce**:\r\nI want to implement _in_top_k_ operation with options to specify what to do when a tie occurs for [CIFAR-10](https://github.com/tensorflow/models/tree/master/tutorials/image/cifar10) data-set. I came across this feature request in #10767, modified the 6-files as shown [here](https://github.com/nolanliou/tensorflow/commit/681724f94e025bbd8377c5406eec4047d58fc31b), and rebuilt from source. When I run _eval_CIFAR10.py_ which contains the _in_top_k_ op, I get the following error.\r\n\r\n  File \"eval_CIFAR10.py\", line 146, in <module>\r\n    tf.app.run()\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 129, in run\r\n    _sys.exit(main(argv))\r\n  File \"eval_CIFAR10.py\", line 141, in main\r\n    evaluate()\r\n  File \"eval_CIFAR10.py\", line 130, in evaluate\r\n    eval_once(saver, summary_writer, top_k_op, summary_op)\r\n  File \"eval_CIFAR10.py\", line 63, in eval_once\r\n    saver.restore(sess, ckpt.model_checkpoint_path)\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/training/saver.py\", line 1686, in restore\r\n    {self.saver_def.filename_tensor_name: save_path})\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 889, in run\r\n    run_metadata_ptr)\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1120, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1317, in _do_run\r\n    options, run_metadata)\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 1336, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Multiple OpKernel registrations match NodeDef 'in_top_k/InTopKV2 = InTopKV2[T=DT_INT32, handle_ties=\"SAMPLE\"](softmax_linear/softmax_linear, Reshape_2, in_top_k/InTopKV2/k)': 'op: \"InTopKV2\" device_type: \"CPU\" constraint { name: \"T\" allowed_values { list { type: DT_INT32 } } } host_memory_arg: \"predictions\" host_memory_arg: \"targets\" host_memory_arg: \"k\" host_memory_arg: \"precision\"' and 'op: \"InTopKV2\" device_type: \"CPU\" constraint { name: \"T\" allowed_values { list { type: DT_INT32 } } } host_memory_arg: \"predictions\" host_memory_arg: \"targets\" host_memory_arg: \"k\" host_memory_arg: \"precision\"'\r\n\t [[Node: in_top_k/InTopKV2 = InTopKV2[T=DT_INT32, handle_ties=\"SAMPLE\"](softmax_linear/softmax_linear, Reshape_2, in_top_k/InTopKV2/k)]]\r\n\r\nCaused by op u'in_top_k/InTopKV2', defined at:\r\n  File \"eval_CIFAR10.py\", line 146, in <module>\r\n    tf.app.run()\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 129, in run\r\n    _sys.exit(main(argv))\r\n  File \"eval_CIFAR10.py\", line 141, in main\r\n    evaluate()\r\n  File \"eval_CIFAR10.py\", line 116, in evaluate\r\n    top_k_op = tf.nn.in_top_k(logits, labels, 1, handle_ties=\"SAMPLE\")\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/nn_ops.py\", line 2523, in in_top_k\r\n    return gen_nn_ops._in_top_kv2(predictions, targets, k, handle_ties, name=name)\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/gen_nn_ops.py\", line 2536, in _in_top_kv2\r\n    handle_ties=handle_ties, name=name)\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 3101, in create_op\r\n    op_def=op_def)\r\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1583, in __init__\r\n    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access\r\n\r\nInvalidArgumentError (see above for traceback): Multiple OpKernel registrations match NodeDef 'in_top_k/InTopKV2 = InTopKV2[T=DT_INT32, handle_ties=\"SAMPLE\"](softmax_linear/softmax_linear, Reshape_2, in_top_k/InTopKV2/k)': 'op: \"InTopKV2\" device_type: \"CPU\" constraint { name: \"T\" allowed_values { list { type: DT_INT32 } } } host_memory_arg: \"predictions\" host_memory_arg: \"targets\" host_memory_arg: \"k\" host_memory_arg: \"precision\"' and 'op: \"InTopKV2\" device_type: \"CPU\" constraint { name: \"T\" allowed_values { list { type: DT_INT32 } } } host_memory_arg: \"predictions\" host_memory_arg: \"targets\" host_memory_arg: \"k\" host_memory_arg: \"precision\"'\r\n\t [[Node: in_top_k/InTopKV2 = InTopKV2[T=DT_INT32, handle_ties=\"SAMPLE\"](softmax_linear/softmax_linear, Reshape_2, in_top_k/InTopKV2/k)]]\r\n\r\nIf you can kindly look into the matter I shall be much helped. Thank you. "}