{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/157363263", "pull_request_review_id": 83995517, "id": 157363263, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NzM2MzI2Mw==", "diff_hunk": "@@ -125,63 +120,6 @@ def sgdr_decay(learning_rate, global_step, initial_period_steps,\n     ValueError: if `global_step` is not supplied.\n   \"\"\"\n \n-  if global_step is None:\n-    raise ValueError(\"global_step is required for sgdr_decay.\")\n-  with ops.name_scope(name, \"SGDRDecay\",\n-                      [learning_rate, global_step,\n-                       initial_period_steps, t_mul, m_mul]) as name:\n-    learning_rate = ops.convert_to_tensor(learning_rate,\n-                                          name=\"initial_learning_rate\")\n-    dtype = learning_rate.dtype\n-    global_step = math_ops.cast(global_step, dtype)\n-    t_0 = math_ops.cast(initial_period_steps, dtype)\n-    t_mul = math_ops.cast(t_mul, dtype)\n-    m_mul = math_ops.cast(m_mul, dtype)\n-\n-    c_one = math_ops.cast(constant_op.constant(1.0), dtype)\n-    c_half = math_ops.cast(constant_op.constant(0.5), dtype)\n-    c_pi = math_ops.cast(constant_op.constant(math.pi), dtype)\n-\n-    # Find normalized value of the current step\n-    x_val = math_ops.div(global_step, t_0)\n-\n-    def compute_step(x_val, geometric=False):\n-      if geometric:\n-        # Consider geometric series where t_mul != 1\n-        # 1 + t_mul + t_mul^2 ... = (1 - t_mul^i_restart) / (1 - t_mul)\n-\n-        # First find how many restarts were performed for a given x_val\n-        # Find maximal integer i_restart value for which this equation holds\n-        # x_val >= (1 - t_mul^i_restart) / (1 - t_mul)\n-        # x_val * (1 - t_mul) <= (1 - t_mul^i_restart)\n-        # t_mul^i_restart <= (1 - x_val * (1 - t_mul))\n-\n-        # tensorflow allows only log with base e\n-        # i_restart <= log(1 - x_val * (1 - t_mul) / log(t_mul)\n-        # Find how many restarts were performed\n-\n-        i_restart = math_ops.floor(\n-            math_ops.log(c_one - x_val * (c_one - t_mul)) / math_ops.log(t_mul))\n-        # Compute the sum of all restarts before the current one\n-        sum_r = (c_one - t_mul ** i_restart) / (c_one - t_mul)\n-        # Compute our position within the current restart\n-        x_val = (x_val - sum_r) / t_mul ** i_restart\n-\n-      else:\n-        # Find how many restarts were performed\n-        i_restart = math_ops.floor(x_val)\n-        # Compute our position within the current restart\n-        x_val = x_val - i_restart\n-      return i_restart, x_val\n-\n-    i_restart, x_val = control_flow_ops.cond(\n-        math_ops.equal(t_mul, c_one),\n-        lambda: compute_step(x_val, geometric=False),\n-        lambda: compute_step(x_val, geometric=True))\n-\n-    # If m_mul < 1, then the initial learning rate of every new restart will be\n-    # smaller, i.e., by a factor of m_mul ** i_restart at i_restart-th restart\n-    m_fac = learning_rate * (m_mul ** i_restart)\n-\n-  return math_ops.multiply(c_half * m_fac,\n-                           (math_ops.cos(x_val * c_pi) + c_one), name=name)\n+  return learning_rate_decay.cosine_decay_restarts(learning_rate, global_step,", "path": "tensorflow/contrib/training/python/training/sgdr_learning_rate_decay.py", "position": null, "original_position": 102, "commit_id": "b5747ad29d3dbd60e1c3f8e0711106a2c8d2e846", "original_commit_id": "84fc95eb15eb4ee5ddcd357804f6459df58d7edb", "user": {"login": "taion", "id": 3112159, "node_id": "MDQ6VXNlcjMxMTIxNTk=", "avatar_url": "https://avatars0.githubusercontent.com/u/3112159?v=4", "gravatar_id": "", "url": "https://api.github.com/users/taion", "html_url": "https://github.com/taion", "followers_url": "https://api.github.com/users/taion/followers", "following_url": "https://api.github.com/users/taion/following{/other_user}", "gists_url": "https://api.github.com/users/taion/gists{/gist_id}", "starred_url": "https://api.github.com/users/taion/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/taion/subscriptions", "organizations_url": "https://api.github.com/users/taion/orgs", "repos_url": "https://api.github.com/users/taion/repos", "events_url": "https://api.github.com/users/taion/events{/privacy}", "received_events_url": "https://api.github.com/users/taion/received_events", "type": "User", "site_admin": false}, "body": "FWIW, since this was never added to https://github.com/tensorflow/tensorflow/blob/v1.4.1/tensorflow/contrib/training/__init__.py, it wasn't ever part of the publicly visible TF API (was not available via e.g. `tf.contrib.training.sgdr_decay`), so could it be fine to remove this entirely?", "created_at": "2017-12-17T09:37:58Z", "updated_at": "2017-12-29T13:22:12Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/14500#discussion_r157363263", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/14500", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/157363263"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/14500#discussion_r157363263"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/14500"}}, "body_html": "<p>FWIW, since this was never added to <a href=\"https://github.com/tensorflow/tensorflow/blob/v1.4.1/tensorflow/contrib/training/__init__.py\">https://github.com/tensorflow/tensorflow/blob/v1.4.1/tensorflow/contrib/training/__init__.py</a>, it wasn't ever part of the publicly visible TF API (was not available via e.g. <code>tf.contrib.training.sgdr_decay</code>), so could it be fine to remove this entirely?</p>", "body_text": "FWIW, since this was never added to https://github.com/tensorflow/tensorflow/blob/v1.4.1/tensorflow/contrib/training/__init__.py, it wasn't ever part of the publicly visible TF API (was not available via e.g. tf.contrib.training.sgdr_decay), so could it be fine to remove this entirely?"}