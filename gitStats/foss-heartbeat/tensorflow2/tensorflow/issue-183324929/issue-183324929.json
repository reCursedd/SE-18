{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5003", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5003/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5003/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5003/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/5003", "id": 183324929, "node_id": "MDU6SXNzdWUxODMzMjQ5Mjk=", "number": 5003, "title": "C API crashes on simple problems  ", "user": {"login": "sergiyprotsiv", "id": 1951020, "node_id": "MDQ6VXNlcjE5NTEwMjA=", "avatar_url": "https://avatars3.githubusercontent.com/u/1951020?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sergiyprotsiv", "html_url": "https://github.com/sergiyprotsiv", "followers_url": "https://api.github.com/users/sergiyprotsiv/followers", "following_url": "https://api.github.com/users/sergiyprotsiv/following{/other_user}", "gists_url": "https://api.github.com/users/sergiyprotsiv/gists{/gist_id}", "starred_url": "https://api.github.com/users/sergiyprotsiv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sergiyprotsiv/subscriptions", "organizations_url": "https://api.github.com/users/sergiyprotsiv/orgs", "repos_url": "https://api.github.com/users/sergiyprotsiv/repos", "events_url": "https://api.github.com/users/sergiyprotsiv/events{/privacy}", "received_events_url": "https://api.github.com/users/sergiyprotsiv/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2016-10-17T04:50:35Z", "updated_at": "2017-03-24T04:45:48Z", "closed_at": "2016-10-17T06:11:49Z", "author_association": "NONE", "body_html": "<p>I am trying to incorporate Tensorflow into a larger OS X project, so using the stand-alone static library build (from contrib/makefile) and C API.</p>\n<p>Once all the linking issues are resolved, the simplest Tensorflow programs compile fine, but do not run. I have so far found two issues when creating operations similarly to the c_api_test file:</p>\n<ul>\n<li>When adding a constant Operation, Tensorflow crashes on exit from TF_SetAttrTensor(). The issue is that the managed buffer is deallocated, but still has refcount of 1. I am not sure why this happens since the managed buffer should supposedly be passed to the node_builder (which should retain the reference), but the buffer still gets deallocated.</li>\n<li>Trying to work around that, it almost immediately hits another issue: TF_FinishOperation crashes because node_builder.Finalize call does not set the props of the Node and so ret-&gt;name() returns NULL.</li>\n</ul>\n<p>I do not know the codebase well enough (just started today), so perhaps you could point me to a possible underlying cause.</p>\n<p>Using OS X 10.11.6, Xcode 8, libc++ and C++14. Tensorflow current as of October 16.</p>", "body_text": "I am trying to incorporate Tensorflow into a larger OS X project, so using the stand-alone static library build (from contrib/makefile) and C API.\nOnce all the linking issues are resolved, the simplest Tensorflow programs compile fine, but do not run. I have so far found two issues when creating operations similarly to the c_api_test file:\n\nWhen adding a constant Operation, Tensorflow crashes on exit from TF_SetAttrTensor(). The issue is that the managed buffer is deallocated, but still has refcount of 1. I am not sure why this happens since the managed buffer should supposedly be passed to the node_builder (which should retain the reference), but the buffer still gets deallocated.\nTrying to work around that, it almost immediately hits another issue: TF_FinishOperation crashes because node_builder.Finalize call does not set the props of the Node and so ret->name() returns NULL.\n\nI do not know the codebase well enough (just started today), so perhaps you could point me to a possible underlying cause.\nUsing OS X 10.11.6, Xcode 8, libc++ and C++14. Tensorflow current as of October 16.", "body": "I am trying to incorporate Tensorflow into a larger OS X project, so using the stand-alone static library build (from contrib/makefile) and C API.\n\nOnce all the linking issues are resolved, the simplest Tensorflow programs compile fine, but do not run. I have so far found two issues when creating operations similarly to the c_api_test file:\n- When adding a constant Operation, Tensorflow crashes on exit from TF_SetAttrTensor(). The issue is that the managed buffer is deallocated, but still has refcount of 1. I am not sure why this happens since the managed buffer should supposedly be passed to the node_builder (which should retain the reference), but the buffer still gets deallocated.\n- Trying to work around that, it almost immediately hits another issue: TF_FinishOperation crashes because node_builder.Finalize call does not set the props of the Node and so ret->name() returns NULL.\n\nI do not know the codebase well enough (just started today), so perhaps you could point me to a possible underlying cause.\n\nUsing OS X 10.11.6, Xcode 8, libc++ and C++14. Tensorflow current as of October 16.\n"}