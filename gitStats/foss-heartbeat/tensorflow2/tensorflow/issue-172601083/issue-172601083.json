{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3971", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3971/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3971/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3971/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/3971", "id": 172601083, "node_id": "MDU6SXNzdWUxNzI2MDEwODM=", "number": 3971, "title": "tf.contrib.metrics.streaming_auc evaluation exception", "user": {"login": "guozhizou", "id": 7837436, "node_id": "MDQ6VXNlcjc4Mzc0MzY=", "avatar_url": "https://avatars1.githubusercontent.com/u/7837436?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guozhizou", "html_url": "https://github.com/guozhizou", "followers_url": "https://api.github.com/users/guozhizou/followers", "following_url": "https://api.github.com/users/guozhizou/following{/other_user}", "gists_url": "https://api.github.com/users/guozhizou/gists{/gist_id}", "starred_url": "https://api.github.com/users/guozhizou/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guozhizou/subscriptions", "organizations_url": "https://api.github.com/users/guozhizou/orgs", "repos_url": "https://api.github.com/users/guozhizou/repos", "events_url": "https://api.github.com/users/guozhizou/events{/privacy}", "received_events_url": "https://api.github.com/users/guozhizou/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "martinwicke", "id": 577277, "node_id": "MDQ6VXNlcjU3NzI3Nw==", "avatar_url": "https://avatars2.githubusercontent.com/u/577277?v=4", "gravatar_id": "", "url": "https://api.github.com/users/martinwicke", "html_url": "https://github.com/martinwicke", "followers_url": "https://api.github.com/users/martinwicke/followers", "following_url": "https://api.github.com/users/martinwicke/following{/other_user}", "gists_url": "https://api.github.com/users/martinwicke/gists{/gist_id}", "starred_url": "https://api.github.com/users/martinwicke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/martinwicke/subscriptions", "organizations_url": "https://api.github.com/users/martinwicke/orgs", "repos_url": "https://api.github.com/users/martinwicke/repos", "events_url": "https://api.github.com/users/martinwicke/events{/privacy}", "received_events_url": "https://api.github.com/users/martinwicke/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "martinwicke", "id": 577277, "node_id": "MDQ6VXNlcjU3NzI3Nw==", "avatar_url": "https://avatars2.githubusercontent.com/u/577277?v=4", "gravatar_id": "", "url": "https://api.github.com/users/martinwicke", "html_url": "https://github.com/martinwicke", "followers_url": "https://api.github.com/users/martinwicke/followers", "following_url": "https://api.github.com/users/martinwicke/following{/other_user}", "gists_url": "https://api.github.com/users/martinwicke/gists{/gist_id}", "starred_url": "https://api.github.com/users/martinwicke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/martinwicke/subscriptions", "organizations_url": "https://api.github.com/users/martinwicke/orgs", "repos_url": "https://api.github.com/users/martinwicke/repos", "events_url": "https://api.github.com/users/martinwicke/events{/privacy}", "received_events_url": "https://api.github.com/users/martinwicke/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2016-08-23T02:52:51Z", "updated_at": "2017-12-07T04:09:43Z", "closed_at": "2016-08-27T22:16:04Z", "author_association": "NONE", "body_html": "<p>I used <code>tf.contrib.metrics.streaming_auc</code> to evaluate DNN rank model,</p>\n<pre><code>auc,  opts = tf.contrib.metrics.streaming_auc(logits, labels)\n</code></pre>\n<p><code>logits</code> are my predicted results, <code>labels</code> are true labels, they have format:</p>\n<pre><code>Tensor(\"Sigmoid:0\", shape=(100, 1), dtype=float32)\nTensor(\"labels_placeholder:0\", shape=(100, ?), dtype=float32)\n</code></pre>\n<p>Errors as following:</p>\n<pre><code>Traceback (most recent call last):\n  File \"/Users/nali/Workspace/tensorflow_example/search_click/MLP.py\", line 200, in &lt;module&gt;\n    dnn.run(training_data=[x, y], epochs=10)\n  File \"/Users/nali/Workspace/tensorflow_example/search_click/MLP.py\", line 135, in run\n    feed_dict={self.x: x[samples], self.y: y[samples]})\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 372, in run\n    run_metadata_ptr)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 636, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 708, in _do_run\n    target_list, options, run_metadata)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 728, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors.FailedPreconditionError: Attempting to use uninitialized value auc/true_positives\n     [[Node: auc/true_positives/read = Identity[T=DT_FLOAT, _class=[\"loc:@auc/true_positives\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](auc/true_positives)]]\nCaused by op u'auc/true_positives/read', defined at:\n  File \"/Users/nali/Workspace/tensorflow_example/search_click/MLP.py\", line 200, in &lt;module&gt;\n    dnn.run(training_data=[x, y], epochs=10)\n  File \"/Users/nali/Workspace/tensorflow_example/search_click/MLP.py\", line 126, in run\n    cross_entropy, accuracy, logits = self.training()\n  File \"/Users/nali/Workspace/tensorflow_example/search_click/MLP.py\", line 100, in training\n    accuracy = self.evaluation(logits, self.y)\n  File \"/Users/nali/Workspace/tensorflow_example/search_click/MLP.py\", line 146, in evaluation\n    auc, opt = tf.contrib.metrics.streaming_auc(logits, labels)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/contrib/metrics/python/ops/metric_ops.py\", line 718, in streaming_auc\n    predictions, labels, thresholds, ignore_mask)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/contrib/metrics/python/ops/metric_ops.py\", line 600, in _tp_fn_tn_fp\n    true_positives = _create_local('true_positives', shape=[num_thresholds])\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/contrib/metrics/python/ops/metric_ops.py\", line 75, in _create_local\n    collections=collections)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 211, in __init__\n    dtype=dtype)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 319, in _init_from_args\n    self._snapshot = array_ops.identity(self._variable, name=\"read\")\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 831, in identity\n    result = _op_def_lib.apply_op(\"Identity\", input=input, name=name)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/op_def_library.py\", line 704, in apply_op\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2260, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1230, in __init__\n    self._traceback = _extract_stack()\n</code></pre>\n<p>Thanks in advance.</p>", "body_text": "I used tf.contrib.metrics.streaming_auc to evaluate DNN rank model,\nauc,  opts = tf.contrib.metrics.streaming_auc(logits, labels)\n\nlogits are my predicted results, labels are true labels, they have format:\nTensor(\"Sigmoid:0\", shape=(100, 1), dtype=float32)\nTensor(\"labels_placeholder:0\", shape=(100, ?), dtype=float32)\n\nErrors as following:\nTraceback (most recent call last):\n  File \"/Users/nali/Workspace/tensorflow_example/search_click/MLP.py\", line 200, in <module>\n    dnn.run(training_data=[x, y], epochs=10)\n  File \"/Users/nali/Workspace/tensorflow_example/search_click/MLP.py\", line 135, in run\n    feed_dict={self.x: x[samples], self.y: y[samples]})\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 372, in run\n    run_metadata_ptr)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 636, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 708, in _do_run\n    target_list, options, run_metadata)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 728, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors.FailedPreconditionError: Attempting to use uninitialized value auc/true_positives\n     [[Node: auc/true_positives/read = Identity[T=DT_FLOAT, _class=[\"loc:@auc/true_positives\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](auc/true_positives)]]\nCaused by op u'auc/true_positives/read', defined at:\n  File \"/Users/nali/Workspace/tensorflow_example/search_click/MLP.py\", line 200, in <module>\n    dnn.run(training_data=[x, y], epochs=10)\n  File \"/Users/nali/Workspace/tensorflow_example/search_click/MLP.py\", line 126, in run\n    cross_entropy, accuracy, logits = self.training()\n  File \"/Users/nali/Workspace/tensorflow_example/search_click/MLP.py\", line 100, in training\n    accuracy = self.evaluation(logits, self.y)\n  File \"/Users/nali/Workspace/tensorflow_example/search_click/MLP.py\", line 146, in evaluation\n    auc, opt = tf.contrib.metrics.streaming_auc(logits, labels)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/contrib/metrics/python/ops/metric_ops.py\", line 718, in streaming_auc\n    predictions, labels, thresholds, ignore_mask)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/contrib/metrics/python/ops/metric_ops.py\", line 600, in _tp_fn_tn_fp\n    true_positives = _create_local('true_positives', shape=[num_thresholds])\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/contrib/metrics/python/ops/metric_ops.py\", line 75, in _create_local\n    collections=collections)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 211, in __init__\n    dtype=dtype)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 319, in _init_from_args\n    self._snapshot = array_ops.identity(self._variable, name=\"read\")\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 831, in identity\n    result = _op_def_lib.apply_op(\"Identity\", input=input, name=name)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/op_def_library.py\", line 704, in apply_op\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2260, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1230, in __init__\n    self._traceback = _extract_stack()\n\nThanks in advance.", "body": "I used `tf.contrib.metrics.streaming_auc` to evaluate DNN rank model, \n\n```\nauc,  opts = tf.contrib.metrics.streaming_auc(logits, labels)\n```\n\n`logits` are my predicted results, `labels` are true labels, they have format:\n\n```\nTensor(\"Sigmoid:0\", shape=(100, 1), dtype=float32)\nTensor(\"labels_placeholder:0\", shape=(100, ?), dtype=float32)\n```\n\nErrors as following:\n\n```\nTraceback (most recent call last):\n  File \"/Users/nali/Workspace/tensorflow_example/search_click/MLP.py\", line 200, in <module>\n    dnn.run(training_data=[x, y], epochs=10)\n  File \"/Users/nali/Workspace/tensorflow_example/search_click/MLP.py\", line 135, in run\n    feed_dict={self.x: x[samples], self.y: y[samples]})\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 372, in run\n    run_metadata_ptr)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 636, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 708, in _do_run\n    target_list, options, run_metadata)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 728, in _do_call\n    raise type(e)(node_def, op, message)\ntensorflow.python.framework.errors.FailedPreconditionError: Attempting to use uninitialized value auc/true_positives\n     [[Node: auc/true_positives/read = Identity[T=DT_FLOAT, _class=[\"loc:@auc/true_positives\"], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](auc/true_positives)]]\nCaused by op u'auc/true_positives/read', defined at:\n  File \"/Users/nali/Workspace/tensorflow_example/search_click/MLP.py\", line 200, in <module>\n    dnn.run(training_data=[x, y], epochs=10)\n  File \"/Users/nali/Workspace/tensorflow_example/search_click/MLP.py\", line 126, in run\n    cross_entropy, accuracy, logits = self.training()\n  File \"/Users/nali/Workspace/tensorflow_example/search_click/MLP.py\", line 100, in training\n    accuracy = self.evaluation(logits, self.y)\n  File \"/Users/nali/Workspace/tensorflow_example/search_click/MLP.py\", line 146, in evaluation\n    auc, opt = tf.contrib.metrics.streaming_auc(logits, labels)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/contrib/metrics/python/ops/metric_ops.py\", line 718, in streaming_auc\n    predictions, labels, thresholds, ignore_mask)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/contrib/metrics/python/ops/metric_ops.py\", line 600, in _tp_fn_tn_fp\n    true_positives = _create_local('true_positives', shape=[num_thresholds])\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/contrib/metrics/python/ops/metric_ops.py\", line 75, in _create_local\n    collections=collections)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 211, in __init__\n    dtype=dtype)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/variables.py\", line 319, in _init_from_args\n    self._snapshot = array_ops.identity(self._variable, name=\"read\")\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 831, in identity\n    result = _op_def_lib.apply_op(\"Identity\", input=input, name=name)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/ops/op_def_library.py\", line 704, in apply_op\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2260, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/usr/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1230, in __init__\n    self._traceback = _extract_stack()\n```\n\nThanks in advance.\n"}