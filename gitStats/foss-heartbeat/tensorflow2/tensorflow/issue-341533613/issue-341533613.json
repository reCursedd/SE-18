{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20841", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20841/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20841/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20841/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/20841", "id": 341533613, "node_id": "MDU6SXNzdWUzNDE1MzM2MTM=", "number": 20841, "title": "toco tensorflow lite conversion fails with ParseFromStringEitherTextOrBinary(input_file_contents, tf_graph.get())", "user": {"login": "ShapingView", "id": 20456847, "node_id": "MDQ6VXNlcjIwNDU2ODQ3", "avatar_url": "https://avatars0.githubusercontent.com/u/20456847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ShapingView", "html_url": "https://github.com/ShapingView", "followers_url": "https://api.github.com/users/ShapingView/followers", "following_url": "https://api.github.com/users/ShapingView/following{/other_user}", "gists_url": "https://api.github.com/users/ShapingView/gists{/gist_id}", "starred_url": "https://api.github.com/users/ShapingView/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ShapingView/subscriptions", "organizations_url": "https://api.github.com/users/ShapingView/orgs", "repos_url": "https://api.github.com/users/ShapingView/repos", "events_url": "https://api.github.com/users/ShapingView/events{/privacy}", "received_events_url": "https://api.github.com/users/ShapingView/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 750616506, "node_id": "MDU6TGFiZWw3NTA2MTY1MDY=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:lite", "name": "comp:lite", "color": "0052cc", "default": false}, {"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "shashishekhar", "id": 1162712, "node_id": "MDQ6VXNlcjExNjI3MTI=", "avatar_url": "https://avatars1.githubusercontent.com/u/1162712?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shashishekhar", "html_url": "https://github.com/shashishekhar", "followers_url": "https://api.github.com/users/shashishekhar/followers", "following_url": "https://api.github.com/users/shashishekhar/following{/other_user}", "gists_url": "https://api.github.com/users/shashishekhar/gists{/gist_id}", "starred_url": "https://api.github.com/users/shashishekhar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shashishekhar/subscriptions", "organizations_url": "https://api.github.com/users/shashishekhar/orgs", "repos_url": "https://api.github.com/users/shashishekhar/repos", "events_url": "https://api.github.com/users/shashishekhar/events{/privacy}", "received_events_url": "https://api.github.com/users/shashishekhar/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "shashishekhar", "id": 1162712, "node_id": "MDQ6VXNlcjExNjI3MTI=", "avatar_url": "https://avatars1.githubusercontent.com/u/1162712?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shashishekhar", "html_url": "https://github.com/shashishekhar", "followers_url": "https://api.github.com/users/shashishekhar/followers", "following_url": "https://api.github.com/users/shashishekhar/following{/other_user}", "gists_url": "https://api.github.com/users/shashishekhar/gists{/gist_id}", "starred_url": "https://api.github.com/users/shashishekhar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shashishekhar/subscriptions", "organizations_url": "https://api.github.com/users/shashishekhar/orgs", "repos_url": "https://api.github.com/users/shashishekhar/repos", "events_url": "https://api.github.com/users/shashishekhar/events{/privacy}", "received_events_url": "https://api.github.com/users/shashishekhar/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2018-07-16T14:06:16Z", "updated_at": "2018-07-23T20:27:42Z", "closed_at": "2018-07-18T18:18:06Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: No</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Ubuntu 18.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: Binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: v1.7.1-2-g9156fcc7a8 1.7.1</li>\n<li><strong>Python version</strong>: 3.6.5</li>\n<li><strong>Bazel version (if compiling from source)</strong>: ---</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: ---</li>\n<li><strong>CUDA/cuDNN version</strong>: 9.0 / 7.1</li>\n<li><strong>GPU model and memory</strong>: NVIDIA GeForce GTX 1080 Ti</li>\n<li><strong>Exact command to reproduce</strong>: make</li>\n</ul>\n<p>I am trying to build a tensorflow model and export it as an tensorflow lite model using <strong>toco</strong>. It crashes with the issue below. I actually tried to run it on a far larger model, and build this just to reproduce it.</p>\n<p>I put the script into a zip file <a href=\"https://github.com/tensorflow/tensorflow/files/2197923/simple_export_test.zip\">simple_export_test.zip</a>, if you want to run it quickly, using make.<br>\nThe exported model on my system looks like this: <a href=\"https://github.com/tensorflow/tensorflow/files/2197981/exported.zip\">exported.zip</a></p>\n<p><em>simple_model_export.py</em></p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n<span class=\"pl-k\">import</span> numpy <span class=\"pl-k\">as</span> np\n<span class=\"pl-k\">import</span> os\nscript_path <span class=\"pl-k\">=</span> os.path.dirname(os.path.abspath(<span class=\"pl-c1\">__file__</span>))\n\nx <span class=\"pl-k\">=</span> tf.placeholder(tf.float32, <span class=\"pl-v\">shape</span><span class=\"pl-k\">=</span>[<span class=\"pl-c1\">2</span>])\ny <span class=\"pl-k\">=</span> tf.Variable([<span class=\"pl-c1\">2</span>., <span class=\"pl-c1\">3</span>.])\nz <span class=\"pl-k\">=</span> tf.pow(x, y)\n\nexport_dir <span class=\"pl-k\">=</span> script_path <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>/export<span class=\"pl-pds\">'</span></span>\n\n<span class=\"pl-k\">with</span> tf.Session() <span class=\"pl-k\">as</span> sess:\n    sess.run(tf.global_variables_initializer())\n\n    sess.run(y, <span class=\"pl-v\">feed_dict</span><span class=\"pl-k\">=</span>{x: np.array([<span class=\"pl-c1\">5</span>, <span class=\"pl-c1\">6</span>])})\n    tf.saved_model.simple_save(<span class=\"pl-v\">session</span><span class=\"pl-k\">=</span>sess, <span class=\"pl-v\">export_dir</span><span class=\"pl-k\">=</span>export_dir, <span class=\"pl-v\">inputs</span><span class=\"pl-k\">=</span>{<span class=\"pl-s\"><span class=\"pl-pds\">'</span>x<span class=\"pl-pds\">'</span></span>: x}, <span class=\"pl-v\">outputs</span><span class=\"pl-k\">=</span>{<span class=\"pl-s\"><span class=\"pl-pds\">'</span>y<span class=\"pl-pds\">'</span></span>: y})</pre></div>\n<p><em>Makefile</em></p>\n<div class=\"highlight highlight-source-makefile\"><pre><span class=\"pl-c1\">.PHONY</span>: all standard_export tflite_export\n  \n<span class=\"pl-en\">all</span>: standard_export tflite_export\n\n<span class=\"pl-en\">standard_export</span>:\n    python simple_model_export.py\n\n<span class=\"pl-en\">tflite_export</span>:\n    toco \\\n        <span class=\"pl-smi\">--input_file</span>=export/saved_model.pb <span class=\"pl-cce\">\\</span>\n        --output_file=export/optimized_graph.lite <span class=\"pl-cce\">\\</span>\n        --input_format=TENSORFLOW_GRAPHDEF <span class=\"pl-cce\">\\</span>\n        --output_format=TFLITE <span class=\"pl-cce\">\\</span>\n        --input_shape=2 <span class=\"pl-cce\">\\</span>\n        --input_array=x <span class=\"pl-cce\">\\</span>\n        --output_array=y <span class=\"pl-cce\">\\</span>\n        --inference_type=FLOAT <span class=\"pl-cce\">\\</span>\n        --input_data_type=FLOAT</pre></div>\n<p>Executing it leads to:</p>\n<pre lang=\"log\"><code>[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/text_format.cc:288] Error parsing text-format tensorflow.GraphDef: 1:1: Invalid control characters encountered in text.\n[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/text_format.cc:288] Error parsing text-format tensorflow.GraphDef: 1:4: Interpreting non ascii codepoint 188.\n[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/text_format.cc:288] Error parsing text-format tensorflow.GraphDef: 1:4: Expected identifier, got:\n2018-07-16 15:58:04.116409: F tensorflow/contrib/lite/toco/import_tensorflow.cc:2189] Check failed: ParseFromStringEitherTextOrBinary(input_file_contents, tf_graph.get())\nMakefile:9: recipe for target 'tflite_export' failed\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): No\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Ubuntu 18.04\nTensorFlow installed from (source or binary): Binary\nTensorFlow version (use command below): v1.7.1-2-g9156fcc7a8 1.7.1\nPython version: 3.6.5\nBazel version (if compiling from source): ---\nGCC/Compiler version (if compiling from source): ---\nCUDA/cuDNN version: 9.0 / 7.1\nGPU model and memory: NVIDIA GeForce GTX 1080 Ti\nExact command to reproduce: make\n\nI am trying to build a tensorflow model and export it as an tensorflow lite model using toco. It crashes with the issue below. I actually tried to run it on a far larger model, and build this just to reproduce it.\nI put the script into a zip file simple_export_test.zip, if you want to run it quickly, using make.\nThe exported model on my system looks like this: exported.zip\nsimple_model_export.py\nimport tensorflow as tf\nimport numpy as np\nimport os\nscript_path = os.path.dirname(os.path.abspath(__file__))\n\nx = tf.placeholder(tf.float32, shape=[2])\ny = tf.Variable([2., 3.])\nz = tf.pow(x, y)\n\nexport_dir = script_path + '/export'\n\nwith tf.Session() as sess:\n    sess.run(tf.global_variables_initializer())\n\n    sess.run(y, feed_dict={x: np.array([5, 6])})\n    tf.saved_model.simple_save(session=sess, export_dir=export_dir, inputs={'x': x}, outputs={'y': y})\nMakefile\n.PHONY: all standard_export tflite_export\n  \nall: standard_export tflite_export\n\nstandard_export:\n    python simple_model_export.py\n\ntflite_export:\n    toco \\\n        --input_file=export/saved_model.pb \\\n        --output_file=export/optimized_graph.lite \\\n        --input_format=TENSORFLOW_GRAPHDEF \\\n        --output_format=TFLITE \\\n        --input_shape=2 \\\n        --input_array=x \\\n        --output_array=y \\\n        --inference_type=FLOAT \\\n        --input_data_type=FLOAT\nExecuting it leads to:\n[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/text_format.cc:288] Error parsing text-format tensorflow.GraphDef: 1:1: Invalid control characters encountered in text.\n[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/text_format.cc:288] Error parsing text-format tensorflow.GraphDef: 1:4: Interpreting non ascii codepoint 188.\n[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/text_format.cc:288] Error parsing text-format tensorflow.GraphDef: 1:4: Expected identifier, got:\n2018-07-16 15:58:04.116409: F tensorflow/contrib/lite/toco/import_tensorflow.cc:2189] Check failed: ParseFromStringEitherTextOrBinary(input_file_contents, tf_graph.get())\nMakefile:9: recipe for target 'tflite_export' failed", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Ubuntu 18.04\r\n- **TensorFlow installed from (source or binary)**: Binary\r\n- **TensorFlow version (use command below)**: v1.7.1-2-g9156fcc7a8 1.7.1\r\n- **Python version**: 3.6.5\r\n- **Bazel version (if compiling from source)**: ---\r\n- **GCC/Compiler version (if compiling from source)**: ---\r\n- **CUDA/cuDNN version**: 9.0 / 7.1\r\n- **GPU model and memory**: NVIDIA GeForce GTX 1080 Ti\r\n- **Exact command to reproduce**: make\r\n\r\nI am trying to build a tensorflow model and export it as an tensorflow lite model using **toco**. It crashes with the issue below. I actually tried to run it on a far larger model, and build this just to reproduce it. \r\n\r\nI put the script into a zip file [simple_export_test.zip], if you want to run it quickly, using make.\r\nThe exported model on my system looks like this: [exported.zip]\r\n\r\n[exported.zip]: https://github.com/tensorflow/tensorflow/files/2197981/exported.zip\r\n\r\n\r\n[simple_export_test.zip]: https://github.com/tensorflow/tensorflow/files/2197923/simple_export_test.zip\r\n\r\n_simple_model_export.py_\r\n\r\n```python\r\nimport tensorflow as tf\r\nimport numpy as np\r\nimport os\r\nscript_path = os.path.dirname(os.path.abspath(__file__))\r\n\r\nx = tf.placeholder(tf.float32, shape=[2])\r\ny = tf.Variable([2., 3.])\r\nz = tf.pow(x, y)\r\n\r\nexport_dir = script_path + '/export'\r\n\r\nwith tf.Session() as sess:\r\n    sess.run(tf.global_variables_initializer())\r\n\r\n    sess.run(y, feed_dict={x: np.array([5, 6])})\r\n    tf.saved_model.simple_save(session=sess, export_dir=export_dir, inputs={'x': x}, outputs={'y': y})\r\n```\r\n_Makefile_\r\n```make\r\n.PHONY: all standard_export tflite_export\r\n  \r\nall: standard_export tflite_export\r\n\r\nstandard_export:\r\n    python simple_model_export.py\r\n\r\ntflite_export:\r\n    toco \\\r\n        --input_file=export/saved_model.pb \\\r\n        --output_file=export/optimized_graph.lite \\\r\n        --input_format=TENSORFLOW_GRAPHDEF \\\r\n        --output_format=TFLITE \\\r\n        --input_shape=2 \\\r\n        --input_array=x \\\r\n        --output_array=y \\\r\n        --inference_type=FLOAT \\\r\n        --input_data_type=FLOAT\r\n```\r\n\r\nExecuting it leads to:\r\n\r\n```log\r\n[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/text_format.cc:288] Error parsing text-format tensorflow.GraphDef: 1:1: Invalid control characters encountered in text.\r\n[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/text_format.cc:288] Error parsing text-format tensorflow.GraphDef: 1:4: Interpreting non ascii codepoint 188.\r\n[libprotobuf ERROR external/protobuf_archive/src/google/protobuf/text_format.cc:288] Error parsing text-format tensorflow.GraphDef: 1:4: Expected identifier, got:\r\n2018-07-16 15:58:04.116409: F tensorflow/contrib/lite/toco/import_tensorflow.cc:2189] Check failed: ParseFromStringEitherTextOrBinary(input_file_contents, tf_graph.get())\r\nMakefile:9: recipe for target 'tflite_export' failed\r\n```\r\n\r\n"}