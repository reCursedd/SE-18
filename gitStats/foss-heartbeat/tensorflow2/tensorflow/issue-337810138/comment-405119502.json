{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/405119502", "html_url": "https://github.com/tensorflow/tensorflow/issues/20506#issuecomment-405119502", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20506", "id": 405119502, "node_id": "MDEyOklzc3VlQ29tbWVudDQwNTExOTUwMg==", "user": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-15T21:24:19Z", "updated_at": "2018-07-15T21:24:19Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Thanks for the straightforward reproducer, <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=12489437\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/miacro\">@miacro</a>. It looks like this might be a bug in the <code>Estimator.predict()</code> implementation (or at least something that deserves a better error message). In particular, if I changed the following lines of code:</p>\n<div class=\"highlight highlight-source-python\"><pre>model1_output <span class=\"pl-k\">=</span> model1.predict(<span class=\"pl-v\">input_fn</span><span class=\"pl-k\">=</span>get_input_fn([<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">4</span>]))\nmodel2_input_fn <span class=\"pl-k\">=</span> get_input_fn(model1_output)\n<span class=\"pl-k\">for</span> item <span class=\"pl-k\">in</span> model2.predict(model2_input_fn):\n    <span class=\"pl-c1\">print</span>(item)</pre></div>\n<p>...to the following:</p>\n<div class=\"highlight highlight-source-python\"><pre>model1_output <span class=\"pl-k\">=</span> model1.predict(<span class=\"pl-v\">input_fn</span><span class=\"pl-k\">=</span>get_input_fn([<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">2</span>, <span class=\"pl-c1\">3</span>, <span class=\"pl-c1\">4</span>]))\nmodel1_output <span class=\"pl-k\">=</span> <span class=\"pl-c1\">list</span>(model1_output)\nmodel2_input_fn <span class=\"pl-k\">=</span> get_input_fn(model1_output)\n<span class=\"pl-k\">for</span> item <span class=\"pl-k\">in</span> model2.predict(model2_input_fn):\n    <span class=\"pl-c1\">print</span>(item)</pre></div>\n<p>...the program behaves correctly.</p>\n<p>I'll assign this to <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=19293677\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ispirmustafa\">@ispirmustafa</a>, since he made some changes to context handling in <code>Estimator.predict()</code> in <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/0385bfe0726ad9710bfcca145e19611e9e2391bb/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/0385bfe0726ad9710bfcca145e19611e9e2391bb\"><tt>0385bfe</tt></a>, and this may account for the error message about \"context switches\".</p>", "body_text": "Thanks for the straightforward reproducer, @miacro. It looks like this might be a bug in the Estimator.predict() implementation (or at least something that deserves a better error message). In particular, if I changed the following lines of code:\nmodel1_output = model1.predict(input_fn=get_input_fn([1, 2, 3, 4]))\nmodel2_input_fn = get_input_fn(model1_output)\nfor item in model2.predict(model2_input_fn):\n    print(item)\n...to the following:\nmodel1_output = model1.predict(input_fn=get_input_fn([1, 2, 3, 4]))\nmodel1_output = list(model1_output)\nmodel2_input_fn = get_input_fn(model1_output)\nfor item in model2.predict(model2_input_fn):\n    print(item)\n...the program behaves correctly.\nI'll assign this to @ispirmustafa, since he made some changes to context handling in Estimator.predict() in 0385bfe, and this may account for the error message about \"context switches\".", "body": "Thanks for the straightforward reproducer, @miacro. It looks like this might be a bug in the `Estimator.predict()` implementation (or at least something that deserves a better error message). In particular, if I changed the following lines of code:\r\n\r\n```python\r\nmodel1_output = model1.predict(input_fn=get_input_fn([1, 2, 3, 4]))\r\nmodel2_input_fn = get_input_fn(model1_output)\r\nfor item in model2.predict(model2_input_fn):\r\n    print(item)\r\n```\r\n\r\n...to the following:\r\n\r\n```python\r\nmodel1_output = model1.predict(input_fn=get_input_fn([1, 2, 3, 4]))\r\nmodel1_output = list(model1_output)\r\nmodel2_input_fn = get_input_fn(model1_output)\r\nfor item in model2.predict(model2_input_fn):\r\n    print(item)\r\n```\r\n\r\n...the program behaves correctly.\r\n\r\nI'll assign this to @ispirmustafa, since he made some changes to context handling in `Estimator.predict()` in 0385bfe0726ad9710bfcca145e19611e9e2391bb, and this may account for the error message about \"context switches\"."}