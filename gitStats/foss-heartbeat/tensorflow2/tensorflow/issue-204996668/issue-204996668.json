{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7227", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7227/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7227/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7227/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/7227", "id": 204996668, "node_id": "MDU6SXNzdWUyMDQ5OTY2Njg=", "number": 7227, "title": "ld: file not found: -lcudart.8.0 when building CUDA on MacOS and bazel 0.4.4", "user": {"login": "yaroslavvb", "id": 23068, "node_id": "MDQ6VXNlcjIzMDY4", "avatar_url": "https://avatars3.githubusercontent.com/u/23068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yaroslavvb", "html_url": "https://github.com/yaroslavvb", "followers_url": "https://api.github.com/users/yaroslavvb/followers", "following_url": "https://api.github.com/users/yaroslavvb/following{/other_user}", "gists_url": "https://api.github.com/users/yaroslavvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/yaroslavvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yaroslavvb/subscriptions", "organizations_url": "https://api.github.com/users/yaroslavvb/orgs", "repos_url": "https://api.github.com/users/yaroslavvb/repos", "events_url": "https://api.github.com/users/yaroslavvb/events{/privacy}", "received_events_url": "https://api.github.com/users/yaroslavvb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473173351, "node_id": "MDU6TGFiZWw0NzMxNzMzNTE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:build/install", "name": "type:build/install", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "jhseu", "id": 170179, "node_id": "MDQ6VXNlcjE3MDE3OQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/170179?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhseu", "html_url": "https://github.com/jhseu", "followers_url": "https://api.github.com/users/jhseu/followers", "following_url": "https://api.github.com/users/jhseu/following{/other_user}", "gists_url": "https://api.github.com/users/jhseu/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhseu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhseu/subscriptions", "organizations_url": "https://api.github.com/users/jhseu/orgs", "repos_url": "https://api.github.com/users/jhseu/repos", "events_url": "https://api.github.com/users/jhseu/events{/privacy}", "received_events_url": "https://api.github.com/users/jhseu/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jhseu", "id": 170179, "node_id": "MDQ6VXNlcjE3MDE3OQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/170179?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhseu", "html_url": "https://github.com/jhseu", "followers_url": "https://api.github.com/users/jhseu/followers", "following_url": "https://api.github.com/users/jhseu/following{/other_user}", "gists_url": "https://api.github.com/users/jhseu/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhseu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhseu/subscriptions", "organizations_url": "https://api.github.com/users/jhseu/orgs", "repos_url": "https://api.github.com/users/jhseu/repos", "events_url": "https://api.github.com/users/jhseu/events{/privacy}", "received_events_url": "https://api.github.com/users/jhseu/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2017-02-02T21:08:07Z", "updated_at": "2017-02-16T19:20:20Z", "closed_at": "2017-02-16T19:20:20Z", "author_association": "CONTRIBUTOR", "body_html": "<p>In today's head <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/b47dc70e548e6958919f87864b83866919473a92/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/b47dc70e548e6958919f87864b83866919473a92\"><tt>b47dc70</tt></a>, and bazel 0.4.4, bazel building with XLA + CUDA on MacOS fails because it can't find cuda library when linking. I was able to build with the same setup from head from Jan 24 .</p>\n<pre><code>bazel build --config=cuda --config=opt -k //tensorflow/tools/pip_package:build_pip_package\n...\nld: file not found: -lcudart.8.0\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\nINFO: Elapsed time: 0.513s, Critical Path: 0.11s\n\n</code></pre>\n<p>I see <code>libcudart_static.a</code> in my <code>/usr/local/cuda/lib</code> and similar issue <a href=\"http://stackoverflow.com/questions/9633881/usr-bin-ld-cannot-find-lcudart\" rel=\"nofollow\">suggests</a> that linking needs to be done with -L$CUDA_HOME/lib flag, but I can't figure out how to massage that option into bazel config</p>\n<p>I also tried building with flags <code> --action_env PATH --action_env DYLD_LIBRARY_PATH --action_env LD_LIBRARY_PATH</code> and copying <code>libcudart_static.a</code> to <code>libcudart.8.0.a</code></p>\n<p>Note that libcudart dependency dependency exists in CPU-only build as well because of <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"204848107\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/7216\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/7216/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/7216\">#7216</a></p>", "body_text": "In today's head b47dc70, and bazel 0.4.4, bazel building with XLA + CUDA on MacOS fails because it can't find cuda library when linking. I was able to build with the same setup from head from Jan 24 .\nbazel build --config=cuda --config=opt -k //tensorflow/tools/pip_package:build_pip_package\n...\nld: file not found: -lcudart.8.0\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\nINFO: Elapsed time: 0.513s, Critical Path: 0.11s\n\n\nI see libcudart_static.a in my /usr/local/cuda/lib and similar issue suggests that linking needs to be done with -L$CUDA_HOME/lib flag, but I can't figure out how to massage that option into bazel config\nI also tried building with flags  --action_env PATH --action_env DYLD_LIBRARY_PATH --action_env LD_LIBRARY_PATH and copying libcudart_static.a to libcudart.8.0.a\nNote that libcudart dependency dependency exists in CPU-only build as well because of #7216", "body": "In today's head https://github.com/tensorflow/tensorflow/commit/b47dc70e548e6958919f87864b83866919473a92, and bazel 0.4.4, bazel building with XLA + CUDA on MacOS fails because it can't find cuda library when linking. I was able to build with the same setup from head from Jan 24 .\r\n\r\n```\r\nbazel build --config=cuda --config=opt -k //tensorflow/tools/pip_package:build_pip_package\r\n...\r\nld: file not found: -lcudart.8.0\r\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\r\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\r\nINFO: Elapsed time: 0.513s, Critical Path: 0.11s\r\n\r\n```\r\n\r\nI see `libcudart_static.a` in my `/usr/local/cuda/lib` and similar issue [suggests](http://stackoverflow.com/questions/9633881/usr-bin-ld-cannot-find-lcudart) that linking needs to be done with -L$CUDA_HOME/lib flag, but I can't figure out how to massage that option into bazel config\r\n\r\nI also tried building with flags ` --action_env PATH --action_env DYLD_LIBRARY_PATH --action_env LD_LIBRARY_PATH` and copying `libcudart_static.a` to `libcudart.8.0.a`\r\n\r\nNote that libcudart dependency dependency exists in CPU-only build as well because of https://github.com/tensorflow/tensorflow/issues/7216"}