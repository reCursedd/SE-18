{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/187788568", "pull_request_review_id": 119642448, "id": 187788568, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4Nzc4ODU2OA==", "diff_hunk": "@@ -7,6 +7,18 @@ cimport numpy as np\n from tensorflow.python.util import compat\n \n \n+def AppendFloat16ArrayToTensorProto(\n+    # For numpy, npy_half is a typedef for npy_uint16,\n+    # see: https://github.com/numpy/numpy/blob/master/doc/source/reference/c-api.coremath.rst#half-precision-functions\n+    # Because np.float16_t dosen't exist in cython, we use uint16_t here.\n+    # TODO: Use np.float16_t when cython supports it.\n+    tensor_proto, np.ndarray[np.uint16_t, ndim=1] nparray):\n+  cdef long i, n\n+  n = nparray.size\n+  for i in range(n):\n+    tensor_proto.half_val.append(nparray[i])", "path": "tensorflow/python/framework/fast_tensor_util.pyx", "position": 13, "original_position": 13, "commit_id": "0c4e88e18a9fdc694c07794f94f4f87e2cd5cb95", "original_commit_id": "aac1ce388e35703458defbf3ee3b9bf25e672b08", "user": {"login": "facaiy", "id": 1112263, "node_id": "MDQ6VXNlcjExMTIyNjM=", "avatar_url": "https://avatars3.githubusercontent.com/u/1112263?v=4", "gravatar_id": "", "url": "https://api.github.com/users/facaiy", "html_url": "https://github.com/facaiy", "followers_url": "https://api.github.com/users/facaiy/followers", "following_url": "https://api.github.com/users/facaiy/following{/other_user}", "gists_url": "https://api.github.com/users/facaiy/gists{/gist_id}", "starred_url": "https://api.github.com/users/facaiy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/facaiy/subscriptions", "organizations_url": "https://api.github.com/users/facaiy/orgs", "repos_url": "https://api.github.com/users/facaiy/repos", "events_url": "https://api.github.com/users/facaiy/events{/privacy}", "received_events_url": "https://api.github.com/users/facaiy/received_events", "type": "User", "site_admin": false}, "body": "I compare the performance, and find that `append` is better than `extend`. (Also note that float32 became slow, I run the same test on the same working machine):\r\n\r\n\r\n```bash\r\noriginal:\r\nfloat32: 0.4189 sec\r\nfloat16: 13.7551 sec\r\n\r\n\r\nappend:\r\n1st experiment:\r\nfloat32: 0.4094 sec\r\nfloat16: 1.5520 sec\r\n\r\n2nd experiment:\r\nfloat32: 0.4123 sec\r\nfloat16: 1.5605 sec\r\n\r\n\r\nextend:\r\n1st experiment:\r\nfloat32: 0.4117 sec\r\nfloat16: 1.8706 sec\r\n\r\n2nd experiment:\r\nfloat32: 0.4648 sec\r\nfloat16: 1.9272 sec\r\n```", "created_at": "2018-05-13T04:14:19Z", "updated_at": "2018-05-13T04:17:10Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/19212#discussion_r187788568", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/19212", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/187788568"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/19212#discussion_r187788568"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/19212"}}, "body_html": "<p>I compare the performance, and find that <code>append</code> is better than <code>extend</code>. (Also note that float32 became slow, I run the same test on the same working machine):</p>\n<div class=\"highlight highlight-source-shell\"><pre>original:\nfloat32: 0.4189 sec\nfloat16: 13.7551 sec\n\n\nappend:\n1st experiment:\nfloat32: 0.4094 sec\nfloat16: 1.5520 sec\n\n2nd experiment:\nfloat32: 0.4123 sec\nfloat16: 1.5605 sec\n\n\nextend:\n1st experiment:\nfloat32: 0.4117 sec\nfloat16: 1.8706 sec\n\n2nd experiment:\nfloat32: 0.4648 sec\nfloat16: 1.9272 sec</pre></div>", "body_text": "I compare the performance, and find that append is better than extend. (Also note that float32 became slow, I run the same test on the same working machine):\noriginal:\nfloat32: 0.4189 sec\nfloat16: 13.7551 sec\n\n\nappend:\n1st experiment:\nfloat32: 0.4094 sec\nfloat16: 1.5520 sec\n\n2nd experiment:\nfloat32: 0.4123 sec\nfloat16: 1.5605 sec\n\n\nextend:\n1st experiment:\nfloat32: 0.4117 sec\nfloat16: 1.8706 sec\n\n2nd experiment:\nfloat32: 0.4648 sec\nfloat16: 1.9272 sec", "in_reply_to_id": 187669867}