{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/161501597", "html_url": "https://github.com/tensorflow/tensorflow/issues/323#issuecomment-161501597", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/323", "id": 161501597, "node_id": "MDEyOklzc3VlQ29tbWVudDE2MTUwMTU5Nw==", "user": {"login": "navraj28", "id": 1769590, "node_id": "MDQ6VXNlcjE3Njk1OTA=", "avatar_url": "https://avatars0.githubusercontent.com/u/1769590?v=4", "gravatar_id": "", "url": "https://api.github.com/users/navraj28", "html_url": "https://github.com/navraj28", "followers_url": "https://api.github.com/users/navraj28/followers", "following_url": "https://api.github.com/users/navraj28/following{/other_user}", "gists_url": "https://api.github.com/users/navraj28/gists{/gist_id}", "starred_url": "https://api.github.com/users/navraj28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/navraj28/subscriptions", "organizations_url": "https://api.github.com/users/navraj28/orgs", "repos_url": "https://api.github.com/users/navraj28/repos", "events_url": "https://api.github.com/users/navraj28/events{/privacy}", "received_events_url": "https://api.github.com/users/navraj28/received_events", "type": "User", "site_admin": false}, "created_at": "2015-12-03T02:57:52Z", "updated_at": "2015-12-03T02:57:52Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=15737127\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/vincentvanhoucke\">@vincentvanhoucke</a>: I copied the MNIST Conv Net. Since, I have just a handful of images, each Batch is applying some random changes to the images. Code snippet below. The first iteration is successful. 2nd one gives the above error.</p>\n<pre><code>def preprocessImages(x):\n    retValue = numpy.empty_like(x)\n    for i in range(len(data)):\n    image = x[i]\n    image = tf.reshape(image, [388,190,1])\n    image = tf.image.random_brightness(image, max_delta=63)\n    # Subtract off the mean and divide by the variance of the pixels.\n    float_image = tf.image.per_image_whitening(image)\n    float_image_Mat = sess.run(float_image)\n    retValue[i] = float_image_Mat.reshape((388*190))\nreturn retValue\n\nfor i in range(500):\n    feed_dict={x: preprocessImages(data), y_: labelsAsOneHotVector, keep_prob: 0.5}\n    train_step.run(feed_dict)\n    if i%100 == 0:\n        train_accuracy = accuracy.eval(feed_dict)\n        print(\"step %d, training accuracy %g\"%(i, train_accuracy))\n</code></pre>\n<p>First iteration works fine!</p>\n<pre><code>step 0, training accuracy 0.680851\nW tensorflow/core/common_runtime/executor.cc:1027] 0x2a1a82e0 Compute status: Invalid     argument: ReluGrad input is not finite. : Tensor had NaN values\n</code></pre>", "body_text": "@vincentvanhoucke: I copied the MNIST Conv Net. Since, I have just a handful of images, each Batch is applying some random changes to the images. Code snippet below. The first iteration is successful. 2nd one gives the above error.\ndef preprocessImages(x):\n    retValue = numpy.empty_like(x)\n    for i in range(len(data)):\n    image = x[i]\n    image = tf.reshape(image, [388,190,1])\n    image = tf.image.random_brightness(image, max_delta=63)\n    # Subtract off the mean and divide by the variance of the pixels.\n    float_image = tf.image.per_image_whitening(image)\n    float_image_Mat = sess.run(float_image)\n    retValue[i] = float_image_Mat.reshape((388*190))\nreturn retValue\n\nfor i in range(500):\n    feed_dict={x: preprocessImages(data), y_: labelsAsOneHotVector, keep_prob: 0.5}\n    train_step.run(feed_dict)\n    if i%100 == 0:\n        train_accuracy = accuracy.eval(feed_dict)\n        print(\"step %d, training accuracy %g\"%(i, train_accuracy))\n\nFirst iteration works fine!\nstep 0, training accuracy 0.680851\nW tensorflow/core/common_runtime/executor.cc:1027] 0x2a1a82e0 Compute status: Invalid     argument: ReluGrad input is not finite. : Tensor had NaN values", "body": "@vincentvanhoucke: I copied the MNIST Conv Net. Since, I have just a handful of images, each Batch is applying some random changes to the images. Code snippet below. The first iteration is successful. 2nd one gives the above error.\n\n```\ndef preprocessImages(x):\n    retValue = numpy.empty_like(x)\n    for i in range(len(data)):\n    image = x[i]\n    image = tf.reshape(image, [388,190,1])\n    image = tf.image.random_brightness(image, max_delta=63)\n    # Subtract off the mean and divide by the variance of the pixels.\n    float_image = tf.image.per_image_whitening(image)\n    float_image_Mat = sess.run(float_image)\n    retValue[i] = float_image_Mat.reshape((388*190))\nreturn retValue\n\nfor i in range(500):\n    feed_dict={x: preprocessImages(data), y_: labelsAsOneHotVector, keep_prob: 0.5}\n    train_step.run(feed_dict)\n    if i%100 == 0:\n        train_accuracy = accuracy.eval(feed_dict)\n        print(\"step %d, training accuracy %g\"%(i, train_accuracy))\n```\n\nFirst iteration works fine! \n\n```\nstep 0, training accuracy 0.680851\nW tensorflow/core/common_runtime/executor.cc:1027] 0x2a1a82e0 Compute status: Invalid     argument: ReluGrad input is not finite. : Tensor had NaN values\n```\n"}