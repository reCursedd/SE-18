{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/437638689", "html_url": "https://github.com/tensorflow/tensorflow/issues/19431#issuecomment-437638689", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/19431", "id": 437638689, "node_id": "MDEyOklzc3VlQ29tbWVudDQzNzYzODY4OQ==", "user": {"login": "milinddeore", "id": 1849168, "node_id": "MDQ6VXNlcjE4NDkxNjg=", "avatar_url": "https://avatars0.githubusercontent.com/u/1849168?v=4", "gravatar_id": "", "url": "https://api.github.com/users/milinddeore", "html_url": "https://github.com/milinddeore", "followers_url": "https://api.github.com/users/milinddeore/followers", "following_url": "https://api.github.com/users/milinddeore/following{/other_user}", "gists_url": "https://api.github.com/users/milinddeore/gists{/gist_id}", "starred_url": "https://api.github.com/users/milinddeore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/milinddeore/subscriptions", "organizations_url": "https://api.github.com/users/milinddeore/orgs", "repos_url": "https://api.github.com/users/milinddeore/repos", "events_url": "https://api.github.com/users/milinddeore/events{/privacy}", "received_events_url": "https://api.github.com/users/milinddeore/received_events", "type": "User", "site_admin": false}, "created_at": "2018-11-11T02:38:11Z", "updated_at": "2018-11-11T02:39:28Z", "author_association": "NONE", "body_html": "<p>TFLite conversion can be done using SavedModel, i have given the link to the model below. This is as per the documentation <a href=\"https://www.tensorflow.org/lite/convert/python_api\" rel=\"nofollow\">here</a>.</p>\n<p>I have a <a href=\"https://drive.google.com/file/d/1mgjhsPpEDKs8Jud1wbtAKfjObAJVO8GL/view?usp=sharing\" rel=\"nofollow\">model here</a>, which is exported SavedModel using following code:</p>\n<pre><code># SavedModel using simple_save()\n\nins = {\"phase_train_placeholder\":phase_train_placeholder}\nouts = {\"embeddings\":embeddings}\ntf.saved_model.simple_save(sess, '/content/generated/', ins, outs)\n</code></pre>\n<p>But while converting i am too getting the same error, in this case i am not freezing the model by myself. nor qualitizing it. Below code to convert SavedModel to TFLite:</p>\n<pre><code>import tensorflow as tf\n\nsaved_model_dir = '/content/generated/'\n\nconverter = tf.contrib.lite.TFLiteConverter.from_saved_model(saved_model_dir, input_arrays=['phase_train'], input_shapes=(1,160,160,3), \n                                                             output_arrays=['embeddings'])\ntflite_model = converter.convert()\nopen(\"converted_model_savedModel.tflite\", \"wb\").write(tflite_model)\n</code></pre>\n<p>Logs:</p>\n<pre><code>2018-11-11 02:27:06.150377: I tensorflow/lite/toco/import_tensorflow.cc:1280] Converting unsupported operation: RefSwitch\n2018-11-11 02:27:06.150423: I tensorflow/lite/toco/import_tensorflow.cc:1280] Converting unsupported operation: AssignSub\n2018-11-11 02:27:06.150476: I tensorflow/lite/toco/import_tensorflow.cc:1280] Converting unsupported operation: RefSwitch\n2018-11-11 02:27:06.150510: I tensorflow/lite/toco/import_tensorflow.cc:1280] Converting unsupported operation: AssignSub\n2018-11-11 02:27:06.790259: I tensorflow/lite/toco/graph_transformations/graph_transformations.cc:39] Before Removing unused ops: 5600 operators, 9398 arrays (0 quantized)\n2018-11-11 02:27:07.384090: I tensorflow/lite/toco/graph_transformations/graph_transformations.cc:39] After Removing unused ops pass 1: 3582 operators, 6259 arrays (0 quantized)\n2018-11-11 02:27:07.836694: I tensorflow/lite/toco/graph_transformations/graph_transformations.cc:39] Before general graph transformations: 3582 operators, 6259 arrays (0 quantized)\n2018-11-11 02:27:07.839340: F tensorflow/lite/toco/graph_transformations/resolve_batch_normalization.cc:45] Check failed: IsConstantParameterArray(*model, bn_op-&gt;inputs[1]) &amp;&amp; IsConstantParameterArray(*model, bn_op-&gt;inputs[2]) &amp;&amp; IsConstantParameterArray(*model, bn_op-&gt;inputs[3]) Batch normalization resolution requires that mean, multiplier and offset arrays be constant.\nAborted (core dumped)\n</code></pre>", "body_text": "TFLite conversion can be done using SavedModel, i have given the link to the model below. This is as per the documentation here.\nI have a model here, which is exported SavedModel using following code:\n# SavedModel using simple_save()\n\nins = {\"phase_train_placeholder\":phase_train_placeholder}\nouts = {\"embeddings\":embeddings}\ntf.saved_model.simple_save(sess, '/content/generated/', ins, outs)\n\nBut while converting i am too getting the same error, in this case i am not freezing the model by myself. nor qualitizing it. Below code to convert SavedModel to TFLite:\nimport tensorflow as tf\n\nsaved_model_dir = '/content/generated/'\n\nconverter = tf.contrib.lite.TFLiteConverter.from_saved_model(saved_model_dir, input_arrays=['phase_train'], input_shapes=(1,160,160,3), \n                                                             output_arrays=['embeddings'])\ntflite_model = converter.convert()\nopen(\"converted_model_savedModel.tflite\", \"wb\").write(tflite_model)\n\nLogs:\n2018-11-11 02:27:06.150377: I tensorflow/lite/toco/import_tensorflow.cc:1280] Converting unsupported operation: RefSwitch\n2018-11-11 02:27:06.150423: I tensorflow/lite/toco/import_tensorflow.cc:1280] Converting unsupported operation: AssignSub\n2018-11-11 02:27:06.150476: I tensorflow/lite/toco/import_tensorflow.cc:1280] Converting unsupported operation: RefSwitch\n2018-11-11 02:27:06.150510: I tensorflow/lite/toco/import_tensorflow.cc:1280] Converting unsupported operation: AssignSub\n2018-11-11 02:27:06.790259: I tensorflow/lite/toco/graph_transformations/graph_transformations.cc:39] Before Removing unused ops: 5600 operators, 9398 arrays (0 quantized)\n2018-11-11 02:27:07.384090: I tensorflow/lite/toco/graph_transformations/graph_transformations.cc:39] After Removing unused ops pass 1: 3582 operators, 6259 arrays (0 quantized)\n2018-11-11 02:27:07.836694: I tensorflow/lite/toco/graph_transformations/graph_transformations.cc:39] Before general graph transformations: 3582 operators, 6259 arrays (0 quantized)\n2018-11-11 02:27:07.839340: F tensorflow/lite/toco/graph_transformations/resolve_batch_normalization.cc:45] Check failed: IsConstantParameterArray(*model, bn_op->inputs[1]) && IsConstantParameterArray(*model, bn_op->inputs[2]) && IsConstantParameterArray(*model, bn_op->inputs[3]) Batch normalization resolution requires that mean, multiplier and offset arrays be constant.\nAborted (core dumped)", "body": "TFLite conversion can be done using SavedModel, i have given the link to the model below. This is as per the documentation [here](https://www.tensorflow.org/lite/convert/python_api).\r\n\r\nI have a [model here](https://drive.google.com/file/d/1mgjhsPpEDKs8Jud1wbtAKfjObAJVO8GL/view?usp=sharing), which is exported SavedModel using following code:\r\n\r\n```\r\n# SavedModel using simple_save()\r\n\r\nins = {\"phase_train_placeholder\":phase_train_placeholder}\r\nouts = {\"embeddings\":embeddings}\r\ntf.saved_model.simple_save(sess, '/content/generated/', ins, outs)\r\n```\r\n\r\nBut while converting i am too getting the same error, in this case i am not freezing the model by myself. nor qualitizing it. Below code to convert SavedModel to TFLite:\r\n\r\n```\r\nimport tensorflow as tf\r\n\r\nsaved_model_dir = '/content/generated/'\r\n\r\nconverter = tf.contrib.lite.TFLiteConverter.from_saved_model(saved_model_dir, input_arrays=['phase_train'], input_shapes=(1,160,160,3), \r\n                                                             output_arrays=['embeddings'])\r\ntflite_model = converter.convert()\r\nopen(\"converted_model_savedModel.tflite\", \"wb\").write(tflite_model)\r\n```\r\n\r\nLogs: \r\n\r\n```\r\n2018-11-11 02:27:06.150377: I tensorflow/lite/toco/import_tensorflow.cc:1280] Converting unsupported operation: RefSwitch\r\n2018-11-11 02:27:06.150423: I tensorflow/lite/toco/import_tensorflow.cc:1280] Converting unsupported operation: AssignSub\r\n2018-11-11 02:27:06.150476: I tensorflow/lite/toco/import_tensorflow.cc:1280] Converting unsupported operation: RefSwitch\r\n2018-11-11 02:27:06.150510: I tensorflow/lite/toco/import_tensorflow.cc:1280] Converting unsupported operation: AssignSub\r\n2018-11-11 02:27:06.790259: I tensorflow/lite/toco/graph_transformations/graph_transformations.cc:39] Before Removing unused ops: 5600 operators, 9398 arrays (0 quantized)\r\n2018-11-11 02:27:07.384090: I tensorflow/lite/toco/graph_transformations/graph_transformations.cc:39] After Removing unused ops pass 1: 3582 operators, 6259 arrays (0 quantized)\r\n2018-11-11 02:27:07.836694: I tensorflow/lite/toco/graph_transformations/graph_transformations.cc:39] Before general graph transformations: 3582 operators, 6259 arrays (0 quantized)\r\n2018-11-11 02:27:07.839340: F tensorflow/lite/toco/graph_transformations/resolve_batch_normalization.cc:45] Check failed: IsConstantParameterArray(*model, bn_op->inputs[1]) && IsConstantParameterArray(*model, bn_op->inputs[2]) && IsConstantParameterArray(*model, bn_op->inputs[3]) Batch normalization resolution requires that mean, multiplier and offset arrays be constant.\r\nAborted (core dumped)\r\n```"}