{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/336319386", "html_url": "https://github.com/tensorflow/tensorflow/pull/13525#issuecomment-336319386", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13525", "id": 336319386, "node_id": "MDEyOklzc3VlQ29tbWVudDMzNjMxOTM4Ng==", "user": {"login": "scottmudge", "id": 19617165, "node_id": "MDQ6VXNlcjE5NjE3MTY1", "avatar_url": "https://avatars2.githubusercontent.com/u/19617165?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scottmudge", "html_url": "https://github.com/scottmudge", "followers_url": "https://api.github.com/users/scottmudge/followers", "following_url": "https://api.github.com/users/scottmudge/following{/other_user}", "gists_url": "https://api.github.com/users/scottmudge/gists{/gist_id}", "starred_url": "https://api.github.com/users/scottmudge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scottmudge/subscriptions", "organizations_url": "https://api.github.com/users/scottmudge/orgs", "repos_url": "https://api.github.com/users/scottmudge/repos", "events_url": "https://api.github.com/users/scottmudge/events{/privacy}", "received_events_url": "https://api.github.com/users/scottmudge/received_events", "type": "User", "site_admin": false}, "created_at": "2017-10-13T00:44:24Z", "updated_at": "2017-10-13T00:44:24Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Hey Frank,</p>\n<p>Yes the CMakeLists.txt file in TensorFlow needs some modifications; it does not properly set the AVX/AVX2 flags.</p>\n<p>Find this line in the CMakeLists.txt file in ./tensorflow/contrib/cmake/:</p>\n<pre><code>if (tensorflow_OPTIMIZE_FOR_NATIVE_ARCH)\n  include(CheckCXXCompilerFlag)\n  CHECK_CXX_COMPILER_FLAG(\"-march=native\" COMPILER_OPT_ARCH_NATIVE_SUPPORTED)\n  if (COMPILER_OPT_ARCH_NATIVE_SUPPORTED)\n    set(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -march=native\")\n  endif()\nendif()\n</code></pre>\n<p>And change it to:</p>\n<pre><code>if (tensorflow_OPTIMIZE_FOR_NATIVE_ARCH)\n  include(CheckCXXCompilerFlag)\n  CHECK_CXX_COMPILER_FLAG(\"-march=native\" COMPILER_OPT_ARCH_NATIVE_SUPPORTED)\n  if (WIN32)\n\t  if (COMPILER_OPT_ARCH_NATIVE_SUPPORTED)\n\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} /arch:AVX /arch:AVX2\")\n\t  endif()\n  else()\n\tif (COMPILER_OPT_ARCH_NATIVE_SUPPORTED)\n\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -march=native\")\n\tendif()\n  endif()\nendif()\n</code></pre>\n<p>Sort of a hacky way to force enable it, but it'll do the job for now. I need to do another pull request with a better fix.</p>\n<p>If you get error C1001 when compiling with GPU support, take a look at this thread:</p>\n<p><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"224648758\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/9470\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/9470/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/9470\">#9470</a></p>\n<p>I'm not sure if it does it on the master branch, but I had the problem as of v1.3.1</p>", "body_text": "Hey Frank,\nYes the CMakeLists.txt file in TensorFlow needs some modifications; it does not properly set the AVX/AVX2 flags.\nFind this line in the CMakeLists.txt file in ./tensorflow/contrib/cmake/:\nif (tensorflow_OPTIMIZE_FOR_NATIVE_ARCH)\n  include(CheckCXXCompilerFlag)\n  CHECK_CXX_COMPILER_FLAG(\"-march=native\" COMPILER_OPT_ARCH_NATIVE_SUPPORTED)\n  if (COMPILER_OPT_ARCH_NATIVE_SUPPORTED)\n    set(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -march=native\")\n  endif()\nendif()\n\nAnd change it to:\nif (tensorflow_OPTIMIZE_FOR_NATIVE_ARCH)\n  include(CheckCXXCompilerFlag)\n  CHECK_CXX_COMPILER_FLAG(\"-march=native\" COMPILER_OPT_ARCH_NATIVE_SUPPORTED)\n  if (WIN32)\n\t  if (COMPILER_OPT_ARCH_NATIVE_SUPPORTED)\n\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} /arch:AVX /arch:AVX2\")\n\t  endif()\n  else()\n\tif (COMPILER_OPT_ARCH_NATIVE_SUPPORTED)\n\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -march=native\")\n\tendif()\n  endif()\nendif()\n\nSort of a hacky way to force enable it, but it'll do the job for now. I need to do another pull request with a better fix.\nIf you get error C1001 when compiling with GPU support, take a look at this thread:\n#9470\nI'm not sure if it does it on the master branch, but I had the problem as of v1.3.1", "body": "Hey Frank,\r\n\r\nYes the CMakeLists.txt file in TensorFlow needs some modifications; it does not properly set the AVX/AVX2 flags. \r\n\r\nFind this line in the CMakeLists.txt file in ./tensorflow/contrib/cmake/:\r\n\r\n```\r\nif (tensorflow_OPTIMIZE_FOR_NATIVE_ARCH)\r\n  include(CheckCXXCompilerFlag)\r\n  CHECK_CXX_COMPILER_FLAG(\"-march=native\" COMPILER_OPT_ARCH_NATIVE_SUPPORTED)\r\n  if (COMPILER_OPT_ARCH_NATIVE_SUPPORTED)\r\n    set(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -march=native\")\r\n  endif()\r\nendif()\r\n```\r\n\r\nAnd change it to:\r\n\r\n```\r\nif (tensorflow_OPTIMIZE_FOR_NATIVE_ARCH)\r\n  include(CheckCXXCompilerFlag)\r\n  CHECK_CXX_COMPILER_FLAG(\"-march=native\" COMPILER_OPT_ARCH_NATIVE_SUPPORTED)\r\n  if (WIN32)\r\n\t  if (COMPILER_OPT_ARCH_NATIVE_SUPPORTED)\r\n\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} /arch:AVX /arch:AVX2\")\r\n\t  endif()\r\n  else()\r\n\tif (COMPILER_OPT_ARCH_NATIVE_SUPPORTED)\r\n\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -march=native\")\r\n\tendif()\r\n  endif()\r\nendif()\r\n```\r\n\r\nSort of a hacky way to force enable it, but it'll do the job for now. I need to do another pull request with a better fix. \r\n\r\nIf you get error C1001 when compiling with GPU support, take a look at this thread:\r\n\r\nhttps://github.com/tensorflow/tensorflow/issues/9470\r\n\r\nI'm not sure if it does it on the master branch, but I had the problem as of v1.3.1"}