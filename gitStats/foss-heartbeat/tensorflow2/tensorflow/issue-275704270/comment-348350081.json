{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/348350081", "html_url": "https://github.com/tensorflow/tensorflow/issues/14759#issuecomment-348350081", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14759", "id": 348350081, "node_id": "MDEyOklzc3VlQ29tbWVudDM0ODM1MDA4MQ==", "user": {"login": "tatatodd", "id": 5453737, "node_id": "MDQ6VXNlcjU0NTM3Mzc=", "avatar_url": "https://avatars3.githubusercontent.com/u/5453737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tatatodd", "html_url": "https://github.com/tatatodd", "followers_url": "https://api.github.com/users/tatatodd/followers", "following_url": "https://api.github.com/users/tatatodd/following{/other_user}", "gists_url": "https://api.github.com/users/tatatodd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tatatodd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tatatodd/subscriptions", "organizations_url": "https://api.github.com/users/tatatodd/orgs", "repos_url": "https://api.github.com/users/tatatodd/repos", "events_url": "https://api.github.com/users/tatatodd/events{/privacy}", "received_events_url": "https://api.github.com/users/tatatodd/received_events", "type": "User", "site_admin": false}, "created_at": "2017-11-30T23:06:19Z", "updated_at": "2017-11-30T23:06:19Z", "author_association": "MEMBER", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1415280\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/Phhere\">@Phhere</a> Thanks for filing the issue!</p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=15736910\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/zheng-xq\">@zheng-xq</a> might be interested in this, and might have some ideas too.</p>\n<p>Sadly the LOG message is dropping the status, which would have told us <em>why</em> peer access isn't enabled.</p>\n<p>The relevant code that's dropping the status is here:<br>\n<div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/5439c1e2de01a8684b62aba224d44c392176ac32/tensorflow/core/common_runtime/gpu/gpu_device.cc#L950\">tensorflow/tensorflow/core/common_runtime/gpu/gpu_device.cc</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n         Line 950\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/5439c1e2de01a8684b62aba224d44c392176ac32\">5439c1e</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L950\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"950\"></td>\n          <td id=\"LC950\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-c1\">LOG</span>(WARNING) </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>\n<p>Can you change that line from this:</p>\n<pre><code>LOG(WARNING)\n    &lt;&lt; \"Unable to enable peer access between device ordinals \"\n    &lt;&lt; i_gpu_id &lt;&lt; \" and \" &lt;&lt; j_gpu_id;\n</code></pre>\n<p>to this:</p>\n<pre><code>LOG(WARNING)\n    &lt;&lt; \"Unable to enable peer access between device ordinals \"\n    &lt;&lt; i_gpu_id &lt;&lt; \" and \" &lt;&lt; j_gpu_id &lt;&lt; \", status: \" &lt;&lt; status;\n</code></pre>\n<p>And then re-compile and re-run?  That should give us more ideas on what's going wrong.</p>\n<p>FYI the actual CUDA call to enable peer access is here:<br>\n<div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/5439c1e2de01a8684b62aba224d44c392176ac32/tensorflow/stream_executor/cuda/cuda_driver.cc#L1591\">tensorflow/tensorflow/stream_executor/cuda/cuda_driver.cc</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n         Line 1591\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/5439c1e2de01a8684b62aba224d44c392176ac32\">5439c1e</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L1591\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"1591\"></td>\n          <td id=\"LC1591\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> <span class=\"pl-c\"><span class=\"pl-c\">/*</span> static <span class=\"pl-c\">*/</span></span> port::Status <span class=\"pl-en\">CUDADriver::EnablePeerAccess</span>(CudaContext* from, </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>", "body_text": "@Phhere Thanks for filing the issue!\n@zheng-xq might be interested in this, and might have some ideas too.\nSadly the LOG message is dropping the status, which would have told us why peer access isn't enabled.\nThe relevant code that's dropping the status is here:\n\n  \n    \n      tensorflow/tensorflow/core/common_runtime/gpu/gpu_device.cc\n    \n    \n         Line 950\n      in\n      5439c1e\n    \n    \n    \n    \n\n        \n          \n           LOG(WARNING) \n        \n    \n  \n\n\nCan you change that line from this:\nLOG(WARNING)\n    << \"Unable to enable peer access between device ordinals \"\n    << i_gpu_id << \" and \" << j_gpu_id;\n\nto this:\nLOG(WARNING)\n    << \"Unable to enable peer access between device ordinals \"\n    << i_gpu_id << \" and \" << j_gpu_id << \", status: \" << status;\n\nAnd then re-compile and re-run?  That should give us more ideas on what's going wrong.\nFYI the actual CUDA call to enable peer access is here:\n\n  \n    \n      tensorflow/tensorflow/stream_executor/cuda/cuda_driver.cc\n    \n    \n         Line 1591\n      in\n      5439c1e\n    \n    \n    \n    \n\n        \n          \n           /* static */ port::Status CUDADriver::EnablePeerAccess(CudaContext* from,", "body": "@Phhere Thanks for filing the issue!\r\n\r\n@zheng-xq might be interested in this, and might have some ideas too.\r\n\r\nSadly the LOG message is dropping the status, which would have told us *why* peer access isn't enabled.\r\n\r\nThe relevant code that's dropping the status is here:\r\nhttps://github.com/tensorflow/tensorflow/blob/5439c1e2de01a8684b62aba224d44c392176ac32/tensorflow/core/common_runtime/gpu/gpu_device.cc#L950\r\n\r\nCan you change that line from this:\r\n```\r\nLOG(WARNING)\r\n    << \"Unable to enable peer access between device ordinals \"\r\n    << i_gpu_id << \" and \" << j_gpu_id;\r\n```\r\nto this:\r\n```\r\nLOG(WARNING)\r\n    << \"Unable to enable peer access between device ordinals \"\r\n    << i_gpu_id << \" and \" << j_gpu_id << \", status: \" << status;\r\n```\r\n\r\nAnd then re-compile and re-run?  That should give us more ideas on what's going wrong.\r\n\r\nFYI the actual CUDA call to enable peer access is here:\r\nhttps://github.com/tensorflow/tensorflow/blob/5439c1e2de01a8684b62aba224d44c392176ac32/tensorflow/stream_executor/cuda/cuda_driver.cc#L1591"}