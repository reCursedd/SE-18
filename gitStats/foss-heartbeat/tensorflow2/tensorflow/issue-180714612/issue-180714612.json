{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4734", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4734/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4734/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4734/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/4734", "id": 180714612, "node_id": "MDU6SXNzdWUxODA3MTQ2MTI=", "number": 4734, "title": "Unable to restore session with batch_norm", "user": {"login": "jrbtaylor", "id": 15191858, "node_id": "MDQ6VXNlcjE1MTkxODU4", "avatar_url": "https://avatars3.githubusercontent.com/u/15191858?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jrbtaylor", "html_url": "https://github.com/jrbtaylor", "followers_url": "https://api.github.com/users/jrbtaylor/followers", "following_url": "https://api.github.com/users/jrbtaylor/following{/other_user}", "gists_url": "https://api.github.com/users/jrbtaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/jrbtaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jrbtaylor/subscriptions", "organizations_url": "https://api.github.com/users/jrbtaylor/orgs", "repos_url": "https://api.github.com/users/jrbtaylor/repos", "events_url": "https://api.github.com/users/jrbtaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/jrbtaylor/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2016-10-03T18:42:47Z", "updated_at": "2016-10-03T19:53:37Z", "closed_at": "2016-10-03T19:53:37Z", "author_association": "NONE", "body_html": "<p>I am saving my model during training with saver = tf.train.Saver() and then conditionally saver.save(sess,filename). It works for my model and allows me to restore the session later if I do not use batch normalization. With batch_norm layers in the model (either the one in contrib.layers or contrib.slim) I get the following error when I try to restore the session:</p>\n<p><code>FailedPreconditionError: Attempting to use uninitialized value Variable [[Node: Variable/read = Identity[T=DT_FLOAT, _class=[\"loc:@Variable\"], _device=\"/job:localhost/replica:0/task:0/gpu:0\"](Variable)]] [[Node: conv0/moments/sufficient_statistics/Shape/_32 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device_incarnation=1, tensor_name=\"edge_483_conv0/moments/sufficient_statistics/Shape\", tensor_type=DT_INT32, _device=\"/job:localhost/replica:0/task:0/cpu:0\"]()]] Caused by op u'Variable/read', defined at: File \"/usr/lib/python2.7/dist-packages/spyderlib/widgets/externalshell/start_ipython_kernel.py\", line 197, in &lt;module&gt; __ipythonkernel__.start() File \"/usr/lib/python2.7/dist-packages/IPython/kernel/zmq/kernelapp.py\", line 458, in start ioloop.IOLoop.instance().start() File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/ioloop.py\", line 160, in start super(ZMQIOLoop, self).start() File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/minitornado/ioloop.py\", line 678, in start self._handlers[fd](fd, events) File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/minitornado/stack_context.py\", line 302, in wrapped ret = fn(*args, **kwargs) File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 433, in _handle_events self._handle_recv() File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 465, in _handle_recv self._run_callback(callback, msg) File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 407, in _run_callback callback(*args, **kwargs) File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/minitornado/stack_context.py\", line 302, in wrapped ret = fn(*args, **kwargs) File \"/usr/lib/python2.7/dist-packages/IPython/kernel/zmq/ipkernel.py\", line 279, in dispatcher return self.dispatch_shell(stream, msg) File \"/usr/lib/python2.7/dist-packages/IPython/kernel/zmq/ipkernel.py\", line 247, in dispatch_shell handler(stream, idents, msg) File \"/usr/lib/python2.7/dist-packages/IPython/kernel/zmq/ipkernel.py\", line 396, in execute_request shell.run_cell(code, store_history=store_history, silent=silent) File \"/usr/lib/python2.7/dist-packages/IPython/core/interactiveshell.py\", line 2660, in run_cell interactivity=interactivity, compiler=compiler) File \"/usr/lib/python2.7/dist-packages/IPython/core/interactiveshell.py\", line 2770, in run_ast_nodes if self.run_code(code): File \"/usr/lib/python2.7/dist-packages/IPython/core/interactiveshell.py\", line 2820, in run_code exec code_obj in self.user_global_ns, self.user_ns File \"&lt;ipython-input-1-3936af1513f1&gt;\", line 1, in &lt;module&gt; runfile('/home/jason/code/test_prototypes.py', wdir='/home/jason/code') File \"/usr/lib/python2.7/dist-packages/spyderlib/widgets/externalshell/sitecustomize.py\", line 540, in runfile execfile(filename, namespace) File \"/home/jason/code/test_prototypes.py\", line 53, in &lt;module&gt; l2_reg=l2_reg) File \"model.py\", line 147, in __init__ W = _uniform_weight(filter_shape) File \"model.py\", line 27, in _uniform_weight return tf.Variable(initial) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 215, in __init__ dtype=dtype) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 327, in _init_from_args self._snapshot = array_ops.identity(self._variable, name=\"read\") File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_array_ops.py\", line 1106, in identity result = _op_def_lib.apply_op(\"Identity\", input=input, name=name) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/op_def_library.py\", line 703, in apply_op op_def=op_def) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2333, in create_op original_op=self._default_original_op, op_def=op_def) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1252, in __init__ self._traceback = _extract_stack()</code></p>", "body_text": "I am saving my model during training with saver = tf.train.Saver() and then conditionally saver.save(sess,filename). It works for my model and allows me to restore the session later if I do not use batch normalization. With batch_norm layers in the model (either the one in contrib.layers or contrib.slim) I get the following error when I try to restore the session:\nFailedPreconditionError: Attempting to use uninitialized value Variable [[Node: Variable/read = Identity[T=DT_FLOAT, _class=[\"loc:@Variable\"], _device=\"/job:localhost/replica:0/task:0/gpu:0\"](Variable)]] [[Node: conv0/moments/sufficient_statistics/Shape/_32 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device_incarnation=1, tensor_name=\"edge_483_conv0/moments/sufficient_statistics/Shape\", tensor_type=DT_INT32, _device=\"/job:localhost/replica:0/task:0/cpu:0\"]()]] Caused by op u'Variable/read', defined at: File \"/usr/lib/python2.7/dist-packages/spyderlib/widgets/externalshell/start_ipython_kernel.py\", line 197, in <module> __ipythonkernel__.start() File \"/usr/lib/python2.7/dist-packages/IPython/kernel/zmq/kernelapp.py\", line 458, in start ioloop.IOLoop.instance().start() File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/ioloop.py\", line 160, in start super(ZMQIOLoop, self).start() File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/minitornado/ioloop.py\", line 678, in start self._handlers[fd](fd, events) File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/minitornado/stack_context.py\", line 302, in wrapped ret = fn(*args, **kwargs) File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 433, in _handle_events self._handle_recv() File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 465, in _handle_recv self._run_callback(callback, msg) File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 407, in _run_callback callback(*args, **kwargs) File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/minitornado/stack_context.py\", line 302, in wrapped ret = fn(*args, **kwargs) File \"/usr/lib/python2.7/dist-packages/IPython/kernel/zmq/ipkernel.py\", line 279, in dispatcher return self.dispatch_shell(stream, msg) File \"/usr/lib/python2.7/dist-packages/IPython/kernel/zmq/ipkernel.py\", line 247, in dispatch_shell handler(stream, idents, msg) File \"/usr/lib/python2.7/dist-packages/IPython/kernel/zmq/ipkernel.py\", line 396, in execute_request shell.run_cell(code, store_history=store_history, silent=silent) File \"/usr/lib/python2.7/dist-packages/IPython/core/interactiveshell.py\", line 2660, in run_cell interactivity=interactivity, compiler=compiler) File \"/usr/lib/python2.7/dist-packages/IPython/core/interactiveshell.py\", line 2770, in run_ast_nodes if self.run_code(code): File \"/usr/lib/python2.7/dist-packages/IPython/core/interactiveshell.py\", line 2820, in run_code exec code_obj in self.user_global_ns, self.user_ns File \"<ipython-input-1-3936af1513f1>\", line 1, in <module> runfile('/home/jason/code/test_prototypes.py', wdir='/home/jason/code') File \"/usr/lib/python2.7/dist-packages/spyderlib/widgets/externalshell/sitecustomize.py\", line 540, in runfile execfile(filename, namespace) File \"/home/jason/code/test_prototypes.py\", line 53, in <module> l2_reg=l2_reg) File \"model.py\", line 147, in __init__ W = _uniform_weight(filter_shape) File \"model.py\", line 27, in _uniform_weight return tf.Variable(initial) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 215, in __init__ dtype=dtype) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 327, in _init_from_args self._snapshot = array_ops.identity(self._variable, name=\"read\") File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_array_ops.py\", line 1106, in identity result = _op_def_lib.apply_op(\"Identity\", input=input, name=name) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/op_def_library.py\", line 703, in apply_op op_def=op_def) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2333, in create_op original_op=self._default_original_op, op_def=op_def) File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1252, in __init__ self._traceback = _extract_stack()", "body": "I am saving my model during training with saver = tf.train.Saver() and then conditionally saver.save(sess,filename). It works for my model and allows me to restore the session later if I do not use batch normalization. With batch_norm layers in the model (either the one in contrib.layers or contrib.slim) I get the following error when I try to restore the session:\n\n`FailedPreconditionError: Attempting to use uninitialized value Variable\n     [[Node: Variable/read = Identity[T=DT_FLOAT, _class=[\"loc:@Variable\"], _device=\"/job:localhost/replica:0/task:0/gpu:0\"](Variable)]]\n     [[Node: conv0/moments/sufficient_statistics/Shape/_32 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device_incarnation=1, tensor_name=\"edge_483_conv0/moments/sufficient_statistics/Shape\", tensor_type=DT_INT32, _device=\"/job:localhost/replica:0/task:0/cpu:0\"]()]]\nCaused by op u'Variable/read', defined at:\n  File \"/usr/lib/python2.7/dist-packages/spyderlib/widgets/externalshell/start_ipython_kernel.py\", line 197, in <module>\n    __ipythonkernel__.start()\n  File \"/usr/lib/python2.7/dist-packages/IPython/kernel/zmq/kernelapp.py\", line 458, in start\n    ioloop.IOLoop.instance().start()\n  File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/ioloop.py\", line 160, in start\n    super(ZMQIOLoop, self).start()\n  File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/minitornado/ioloop.py\", line 678, in start\n    self._handlers[fd](fd, events)\n  File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/minitornado/stack_context.py\", line 302, in wrapped\n    ret = fn(*args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 433, in _handle_events\n    self._handle_recv()\n  File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 465, in _handle_recv\n    self._run_callback(callback, msg)\n  File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 407, in _run_callback\n    callback(*args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/minitornado/stack_context.py\", line 302, in wrapped\n    ret = fn(*args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/IPython/kernel/zmq/ipkernel.py\", line 279, in dispatcher\n    return self.dispatch_shell(stream, msg)\n  File \"/usr/lib/python2.7/dist-packages/IPython/kernel/zmq/ipkernel.py\", line 247, in dispatch_shell\n    handler(stream, idents, msg)\n  File \"/usr/lib/python2.7/dist-packages/IPython/kernel/zmq/ipkernel.py\", line 396, in execute_request\n    shell.run_cell(code, store_history=store_history, silent=silent)\n  File \"/usr/lib/python2.7/dist-packages/IPython/core/interactiveshell.py\", line 2660, in run_cell\n    interactivity=interactivity, compiler=compiler)\n  File \"/usr/lib/python2.7/dist-packages/IPython/core/interactiveshell.py\", line 2770, in run_ast_nodes\n    if self.run_code(code):\n  File \"/usr/lib/python2.7/dist-packages/IPython/core/interactiveshell.py\", line 2820, in run_code\n    exec code_obj in self.user_global_ns, self.user_ns\n  File \"<ipython-input-1-3936af1513f1>\", line 1, in <module>\n    runfile('/home/jason/code/test_prototypes.py', wdir='/home/jason/code')\n  File \"/usr/lib/python2.7/dist-packages/spyderlib/widgets/externalshell/sitecustomize.py\", line 540, in runfile\n    execfile(filename, namespace)\n  File \"/home/jason/code/test_prototypes.py\", line 53, in <module>\n    l2_reg=l2_reg)\n  File \"model.py\", line 147, in __init__\n    W = _uniform_weight(filter_shape)\n  File \"model.py\", line 27, in _uniform_weight\n    return tf.Variable(initial)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 215, in __init__\n    dtype=dtype)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/variables.py\", line 327, in _init_from_args\n    self._snapshot = array_ops.identity(self._variable, name=\"read\")\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_array_ops.py\", line 1106, in identity\n    result = _op_def_lib.apply_op(\"Identity\", input=input, name=name)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/op_def_library.py\", line 703, in apply_op\n    op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2333, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1252, in __init__\n    self._traceback = _extract_stack()`\n"}