{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2942", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2942/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2942/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2942/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/2942", "id": 160999845, "node_id": "MDU6SXNzdWUxNjA5OTk4NDU=", "number": 2942, "title": "Memory Leak in Queue", "user": {"login": "ppwwyyxx", "id": 1381301, "node_id": "MDQ6VXNlcjEzODEzMDE=", "avatar_url": "https://avatars3.githubusercontent.com/u/1381301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ppwwyyxx", "html_url": "https://github.com/ppwwyyxx", "followers_url": "https://api.github.com/users/ppwwyyxx/followers", "following_url": "https://api.github.com/users/ppwwyyxx/following{/other_user}", "gists_url": "https://api.github.com/users/ppwwyyxx/gists{/gist_id}", "starred_url": "https://api.github.com/users/ppwwyyxx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ppwwyyxx/subscriptions", "organizations_url": "https://api.github.com/users/ppwwyyxx/orgs", "repos_url": "https://api.github.com/users/ppwwyyxx/repos", "events_url": "https://api.github.com/users/ppwwyyxx/events{/privacy}", "received_events_url": "https://api.github.com/users/ppwwyyxx/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2016-06-18T01:17:27Z", "updated_at": "2016-06-22T02:33:11Z", "closed_at": "2016-06-22T02:33:11Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Version: nightly built for Python2+Linux+GPU about a week ago (perhaps earlier). Cannot test on latest binary due to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"160978413\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/2939\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/2939/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/2939\">#2939</a>.</p>\n<p>The following code:</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n<span class=\"pl-k\">import</span> numpy <span class=\"pl-k\">as</span> np\n<span class=\"pl-k\">import</span> os\n\n<span class=\"pl-k\">if</span> <span class=\"pl-c1\">__name__</span> <span class=\"pl-k\">==</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>__main__<span class=\"pl-pds\">'</span></span>:\n    input_vars <span class=\"pl-k\">=</span> tf.placeholder(tf.float32, <span class=\"pl-v\">shape</span><span class=\"pl-k\">=</span>(<span class=\"pl-c1\">None</span>, <span class=\"pl-c1\">60</span>, <span class=\"pl-c1\">60</span>, <span class=\"pl-c1\">4</span>))\n    queue <span class=\"pl-k\">=</span> tf.FIFOQueue(<span class=\"pl-c1\">1000</span>, [tf.float32], <span class=\"pl-v\">name</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>queue<span class=\"pl-pds\">'</span></span>)\n    enqueue_op <span class=\"pl-k\">=</span> queue.enqueue([input_vars])\n    output <span class=\"pl-k\">=</span> tf.reduce_mean(queue.dequeue())\n\n    sess <span class=\"pl-k\">=</span> tf.Session()\n    sess.run(tf.initialize_all_variables())\n\n    <span class=\"pl-k\">with</span> sess.as_default():\n        d <span class=\"pl-k\">=</span> np.random.rand(<span class=\"pl-c1\">16</span>, <span class=\"pl-c1\">60</span>, <span class=\"pl-c1\">60</span>, <span class=\"pl-c1\">4</span>)\n        <span class=\"pl-k\">for</span> k <span class=\"pl-k\">in</span> <span class=\"pl-c1\">range</span>(<span class=\"pl-c1\">990</span>):\n            enqueue_op.run(<span class=\"pl-v\">feed_dict</span><span class=\"pl-k\">=</span>{input_vars: d})\n        cmd <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ps u <span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> <span class=\"pl-c1\">str</span>(os.getpid()) <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span> | tail -n 1 | awk '{print $6}'<span class=\"pl-pds\">\"</span></span>\n        <span class=\"pl-k\">while</span> <span class=\"pl-c1\">True</span>:\n            <span class=\"pl-c1\">print</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>mem in KB: <span class=\"pl-pds\">\"</span></span>\n            os.system(cmd)\n            <span class=\"pl-k\">for</span> k <span class=\"pl-k\">in</span> <span class=\"pl-c1\">range</span>(<span class=\"pl-c1\">300</span>):\n                enqueue_op.run(<span class=\"pl-v\">feed_dict</span><span class=\"pl-k\">=</span>{input_vars: d})\n                output.eval()</pre></div>\n<p>quickly consumes 10GB main memory.</p>\n<p>Tested on ArchLinux as well as CentOS7.</p>", "body_text": "Version: nightly built for Python2+Linux+GPU about a week ago (perhaps earlier). Cannot test on latest binary due to #2939.\nThe following code:\nimport tensorflow as tf\nimport numpy as np\nimport os\n\nif __name__ == '__main__':\n    input_vars = tf.placeholder(tf.float32, shape=(None, 60, 60, 4))\n    queue = tf.FIFOQueue(1000, [tf.float32], name='queue')\n    enqueue_op = queue.enqueue([input_vars])\n    output = tf.reduce_mean(queue.dequeue())\n\n    sess = tf.Session()\n    sess.run(tf.initialize_all_variables())\n\n    with sess.as_default():\n        d = np.random.rand(16, 60, 60, 4)\n        for k in range(990):\n            enqueue_op.run(feed_dict={input_vars: d})\n        cmd = \"ps u \" + str(os.getpid()) + \" | tail -n 1 | awk '{print $6}'\"\n        while True:\n            print \"mem in KB: \"\n            os.system(cmd)\n            for k in range(300):\n                enqueue_op.run(feed_dict={input_vars: d})\n                output.eval()\nquickly consumes 10GB main memory.\nTested on ArchLinux as well as CentOS7.", "body": "Version: nightly built for Python2+Linux+GPU about a week ago (perhaps earlier). Cannot test on latest binary due to #2939.\n\nThe following code:\n\n``` python\nimport tensorflow as tf\nimport numpy as np\nimport os\n\nif __name__ == '__main__':\n    input_vars = tf.placeholder(tf.float32, shape=(None, 60, 60, 4))\n    queue = tf.FIFOQueue(1000, [tf.float32], name='queue')\n    enqueue_op = queue.enqueue([input_vars])\n    output = tf.reduce_mean(queue.dequeue())\n\n    sess = tf.Session()\n    sess.run(tf.initialize_all_variables())\n\n    with sess.as_default():\n        d = np.random.rand(16, 60, 60, 4)\n        for k in range(990):\n            enqueue_op.run(feed_dict={input_vars: d})\n        cmd = \"ps u \" + str(os.getpid()) + \" | tail -n 1 | awk '{print $6}'\"\n        while True:\n            print \"mem in KB: \"\n            os.system(cmd)\n            for k in range(300):\n                enqueue_op.run(feed_dict={input_vars: d})\n                output.eval()\n```\n\nquickly consumes 10GB main memory.\n\nTested on ArchLinux as well as CentOS7.\n"}