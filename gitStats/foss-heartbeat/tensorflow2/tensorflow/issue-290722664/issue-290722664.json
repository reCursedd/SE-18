{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16313", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16313/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16313/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/16313/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/16313", "id": 290722664, "node_id": "MDU6SXNzdWUyOTA3MjI2NjQ=", "number": 16313, "title": "Bug of tf.data.TFRecordDataset? Couldn't use tf.reshape after the operations of tf.data.TFRecordDataset", "user": {"login": "zhongxing9006", "id": 7303899, "node_id": "MDQ6VXNlcjczMDM4OTk=", "avatar_url": "https://avatars2.githubusercontent.com/u/7303899?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhongxing9006", "html_url": "https://github.com/zhongxing9006", "followers_url": "https://api.github.com/users/zhongxing9006/followers", "following_url": "https://api.github.com/users/zhongxing9006/following{/other_user}", "gists_url": "https://api.github.com/users/zhongxing9006/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhongxing9006/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhongxing9006/subscriptions", "organizations_url": "https://api.github.com/users/zhongxing9006/orgs", "repos_url": "https://api.github.com/users/zhongxing9006/repos", "events_url": "https://api.github.com/users/zhongxing9006/events{/privacy}", "received_events_url": "https://api.github.com/users/zhongxing9006/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-01-23T06:26:49Z", "updated_at": "2018-01-24T07:42:04Z", "closed_at": "2018-01-23T22:45:02Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Ubuntu 16.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.4.1</li>\n<li><strong>Python version</strong>: 2.7.12</li>\n<li><strong>Bazel version (if compiling from source)</strong>:</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>:</li>\n<li><strong>CUDA/cuDNN version</strong>: 8.0/6.0</li>\n<li><strong>GPU model and memory</strong>: Nvidia GeForce GTX TITAN X 12GB</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>I want to use  function <strong>tf.profiler.ProfileOptionBuilder.float_operation</strong> to show the flops of the model. But it need a certain input shape while the the output shape of <strong>tf.data.TFrecordDataset</strong> is like (?, 32,32,3). When I want to use tf.reshape to reshape the output of <strong>tf.data.TFrecordDataset</strong>, it generates an error \"Input to reshape is a tensor with 64512 values, but the requested shape has 98304\".</p>\n<h3>Source code</h3>\n<p>def dataset_input(self, dataset_type):<br>\nwith tf.variable_scope(\"batch_\" + dataset_type):<br>\ndef parser(record):<br>\nfeatures = tf.parse_single_example(<br>\nrecord,<br>\nfeatures={<br>\n'image': tf.FixedLenFeature([], tf.string),<br>\n'label': tf.FixedLenFeature([], tf.int64)<br>\n})<br>\nimage, label = features['image'], features['label']<br>\nheight, width, channels = self.input_size, self.input_size, self.input_dim<br>\nimage = tf.decode_raw(image, tf.uint8)<br>\nimage = tf.reshape(image, [height, width, channels])<br>\nreturn image, label<br>\ndataset = tf.data.TFRecordDataset([self.dataset_dir[dataset_type]])<br>\ndataset = dataset.map(parser)<br>\ndataset = dataset.shuffle(buffer_size=50000)<br>\ndataset = dataset.batch(self.batch_size)<br>\ndataset = dataset.repeat()<br>\niterator = dataset.make_one_shot_iterator()<br>\nfeatures, labels = iterator.get_next()<br>\nfeatures = tf.reshape(features, [self.batch_size, self.input_size, self.input_size, self.input_dim])<br>\nreturn features, labels</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Ubuntu 16.04\nTensorFlow installed from (source or binary): binary\nTensorFlow version (use command below): 1.4.1\nPython version: 2.7.12\nBazel version (if compiling from source):\nGCC/Compiler version (if compiling from source):\nCUDA/cuDNN version: 8.0/6.0\nGPU model and memory: Nvidia GeForce GTX TITAN X 12GB\nExact command to reproduce:\n\nDescribe the problem\nI want to use  function tf.profiler.ProfileOptionBuilder.float_operation to show the flops of the model. But it need a certain input shape while the the output shape of tf.data.TFrecordDataset is like (?, 32,32,3). When I want to use tf.reshape to reshape the output of tf.data.TFrecordDataset, it generates an error \"Input to reshape is a tensor with 64512 values, but the requested shape has 98304\".\nSource code\ndef dataset_input(self, dataset_type):\nwith tf.variable_scope(\"batch_\" + dataset_type):\ndef parser(record):\nfeatures = tf.parse_single_example(\nrecord,\nfeatures={\n'image': tf.FixedLenFeature([], tf.string),\n'label': tf.FixedLenFeature([], tf.int64)\n})\nimage, label = features['image'], features['label']\nheight, width, channels = self.input_size, self.input_size, self.input_dim\nimage = tf.decode_raw(image, tf.uint8)\nimage = tf.reshape(image, [height, width, channels])\nreturn image, label\ndataset = tf.data.TFRecordDataset([self.dataset_dir[dataset_type]])\ndataset = dataset.map(parser)\ndataset = dataset.shuffle(buffer_size=50000)\ndataset = dataset.batch(self.batch_size)\ndataset = dataset.repeat()\niterator = dataset.make_one_shot_iterator()\nfeatures, labels = iterator.get_next()\nfeatures = tf.reshape(features, [self.batch_size, self.input_size, self.input_size, self.input_dim])\nreturn features, labels", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Ubuntu 16.04\r\n- **TensorFlow installed from (source or binary)**: binary\r\n- **TensorFlow version (use command below)**: 1.4.1\r\n- **Python version**: 2.7.12\r\n- **Bazel version (if compiling from source)**:\r\n- **GCC/Compiler version (if compiling from source)**:\r\n- **CUDA/cuDNN version**: 8.0/6.0\r\n- **GPU model and memory**: Nvidia GeForce GTX TITAN X 12GB\r\n- **Exact command to reproduce**:\r\n\r\n\r\n### Describe the problem\r\nI want to use  function **tf.profiler.ProfileOptionBuilder.float_operation** to show the flops of the model. But it need a certain input shape while the the output shape of **tf.data.TFrecordDataset** is like (?, 32,32,3). When I want to use tf.reshape to reshape the output of **tf.data.TFrecordDataset**, it generates an error \"Input to reshape is a tensor with 64512 values, but the requested shape has 98304\".  \r\n\r\n### Source code \r\n\r\n  def dataset_input(self, dataset_type):\r\n    with tf.variable_scope(\"batch_\" + dataset_type):\r\n        def parser(record):\r\n            features = tf.parse_single_example(\r\n                record,\r\n                features={\r\n                    'image': tf.FixedLenFeature([], tf.string),\r\n                    'label': tf.FixedLenFeature([], tf.int64)\r\n                })\r\n            image, label = features['image'], features['label']\r\n            height, width, channels = self.input_size, self.input_size, self.input_dim\r\n            image = tf.decode_raw(image, tf.uint8)\r\n            image = tf.reshape(image, [height, width, channels])\r\n            return image, label\r\n        dataset = tf.data.TFRecordDataset([self.dataset_dir[dataset_type]])\r\n        dataset = dataset.map(parser)\r\n        dataset = dataset.shuffle(buffer_size=50000)\r\n        dataset = dataset.batch(self.batch_size)\r\n        dataset = dataset.repeat()\r\n        iterator = dataset.make_one_shot_iterator()\r\n        features, labels = iterator.get_next()\r\n        features = tf.reshape(features, [self.batch_size, self.input_size, self.input_size, self.input_dim])\r\n        return features, labels\r\n  "}