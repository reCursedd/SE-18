{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/156433416", "pull_request_review_id": 82907624, "id": 156433416, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1NjQzMzQxNg==", "diff_hunk": "@@ -352,30 +376,50 @@ class TensorArrayScatterOp : public XlaOpKernel {\n     const xla::ComputationDataHandle value = ctx->Input(2);\n     const xla::ComputationDataHandle flow = ctx->Input(3);\n \n-    auto slice_dims = value_shape.dim_sizes();\n-    slice_dims[0] = 1LL;\n+    bool is_simple = false;\n+\n+    std::vector<int64> const_indices;\n+    Status status = ctx->ConstantInputAsIntVector(1, &const_indices);\n+    if (status.ok() && num_indices==value_shape.dim_size(0)) {\n+      is_simple = true;\n+      for (auto i = 0; i < num_indices; i++) {\n+        if (const_indices[i] != i) {\n+          is_simple = false;\n+          break;\n+        }\n+      }\n+    }\n+\n+    if (is_simple) {\n+      ta = b->Add(ta, value);\n+\n+    } else {\n+      auto slice_dims = value_shape.dim_sizes();\n+      slice_dims[0] = 1LL;\n \n-    std::vector<int64> value_starts(value_shape.dims(), 0);\n-    auto value_ends = value_shape.dim_sizes();\n+      std::vector<int64> value_starts(value_shape.dims(), 0);\n+      auto value_ends = value_shape.dim_sizes();\n \n-    std::vector<int64> value_strides(value_shape.dims(), 1);\n+      std::vector<int64> value_strides(value_shape.dims(), 1);\n \n-    // For every (index, value) pair, update the corresponding TensorArray\n-    // storage.\n-    for (int i = 0; i < num_indices; ++i) {\n-      // Slice out part of the value.\n-      value_starts[0] = i;\n-      value_ends[0] = i + 1;\n-      auto slice = b->Slice(value, value_starts, value_ends, value_strides);\n+      // For every (index, value) pair, update the corresponding TensorArray\n+      // storage.\n+      for (int i = 0; i < num_indices; ++i) {\n+        // Slice out part of the value.\n+        value_starts[0] = i;\n+        value_ends[0] = i + 1;\n+        auto slice = b->Slice(value, value_starts, value_ends, value_strides);\n \n-      // start_indices of the DynamicUpdateSlice are [index, 0, 0, ..., 0].\n-      auto index = b->Slice(indices, {i}, {i + 1}, {1});\n-      auto start_indices =\n-          b->Pad(b->Reshape(index, {1}), b->ConstantR0<int32>(0),\n-                 xla::MakeEdgePaddingConfig({{0, elem_shape.dims()}}));\n-      ta = DynamicAddSlice(b, ta, slice, slice_dims, start_indices);\n+        // start_indices of the DynamicUpdateSlice are [index, 0, 0, ..., 0].\n+        auto index = b->Slice(indices, {i}, {i + 1}, {1});\n+        auto start_indices =\n+                b->Pad(b->Reshape(index, {1}), b->ConstantR0<int32>(0),\n+                       xla::MakeEdgePaddingConfig({{0, elem_shape.dims()}}));\n+        ta = DynamicAddSlice(b, ta, slice, slice_dims, start_indices);\n+      }\n     }\n \n+", "path": "tensorflow/compiler/tf2xla/kernels/tensor_array_ops.cc", "position": null, "original_position": 96, "commit_id": "5516505e7d149cc20dbd61d06be829a9694393cc", "original_commit_id": "aad97339dbc228e1a96587de264c273e8aefaf62", "user": {"login": "hawkinsp", "id": 348932, "node_id": "MDQ6VXNlcjM0ODkzMg==", "avatar_url": "https://avatars0.githubusercontent.com/u/348932?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hawkinsp", "html_url": "https://github.com/hawkinsp", "followers_url": "https://api.github.com/users/hawkinsp/followers", "following_url": "https://api.github.com/users/hawkinsp/following{/other_user}", "gists_url": "https://api.github.com/users/hawkinsp/gists{/gist_id}", "starred_url": "https://api.github.com/users/hawkinsp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hawkinsp/subscriptions", "organizations_url": "https://api.github.com/users/hawkinsp/orgs", "repos_url": "https://api.github.com/users/hawkinsp/repos", "events_url": "https://api.github.com/users/hawkinsp/events{/privacy}", "received_events_url": "https://api.github.com/users/hawkinsp/received_events", "type": "User", "site_admin": false}, "body": "Remove extra blank line.", "created_at": "2017-12-12T17:10:59Z", "updated_at": "2017-12-13T12:03:42Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/15185#discussion_r156433416", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/15185", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/156433416"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/15185#discussion_r156433416"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/15185"}}, "body_html": "<p>Remove extra blank line.</p>", "body_text": "Remove extra blank line."}