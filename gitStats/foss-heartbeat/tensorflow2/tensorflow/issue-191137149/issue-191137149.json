{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5792", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5792/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5792/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/5792/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/5792", "id": 191137149, "node_id": "MDU6SXNzdWUxOTExMzcxNDk=", "number": 5792, "title": "I am having a problem when adding new op in tensorflow", "user": {"login": "lixinyutfd", "id": 16847697, "node_id": "MDQ6VXNlcjE2ODQ3Njk3", "avatar_url": "https://avatars3.githubusercontent.com/u/16847697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lixinyutfd", "html_url": "https://github.com/lixinyutfd", "followers_url": "https://api.github.com/users/lixinyutfd/followers", "following_url": "https://api.github.com/users/lixinyutfd/following{/other_user}", "gists_url": "https://api.github.com/users/lixinyutfd/gists{/gist_id}", "starred_url": "https://api.github.com/users/lixinyutfd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lixinyutfd/subscriptions", "organizations_url": "https://api.github.com/users/lixinyutfd/orgs", "repos_url": "https://api.github.com/users/lixinyutfd/repos", "events_url": "https://api.github.com/users/lixinyutfd/events{/privacy}", "received_events_url": "https://api.github.com/users/lixinyutfd/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2016-11-22T22:05:47Z", "updated_at": "2018-09-24T10:51:42Z", "closed_at": "2016-11-23T01:55:33Z", "author_association": "NONE", "body_html": "<p>I just followed the tutorial when trying to add a new op in tensorflow<br>\nI would like to add a new op with which the file name is: rec_conv.cc<br>\nThe code is like:(Input an tensor and just output a string)</p>\n<pre><code>#include \"tensorflow/core/framework/op.h\"\n#include \"tensorflow/core/framework/shape_inference.h\"\n#include \"tensorflow/core/framework/op_kernel.h\"\nusing namespace tensorflow;\n\t\nREGISTER_OP(\"RecConv\")\n    .Input(\"input: int32\")\n    .Output(\"output: string\")\n    .SetShapeFn([](::tensorflow::shape_inference::InferenceContext* c) {\n      c-&gt;set_output(0, c-&gt;input(0));\n      return Status::OK();\n    });\n\nclass RecConvOp: public OpKernel{\n public:\n\texplicit RecConvOp(OpKernelConstruction* context): OpKernel(context){}\n\n void Compute(OpKernelContext* context) override {\n\t//const Tensor&amp; input_tensor = context-&gt;input(0);\n\tTensor* output_tensor = NULL;\n\tauto output = output_tensor-&gt;template scalar&lt;string&gt;();\n\toutput() = \"Output is Rec_conv layer\";\n }\n}\nREGISTER_KERNEL_BUILDER(Name(\"RecConv\").Device(DEVICE_CPU), RecConvOp);\n</code></pre>\n<hr>\n<p>The BUILD file is like:</p>\n<pre><code>load(\"//tensorflow:tensorflow.bzl\", \"tf_custom_op_library\")\n\ntf_custom_op_library(\n    name = \"rec_conv.so\",\n    srcs = [\"rec_conv.cc\"],\n)\n</code></pre>\n<hr>\n<p>However, when I run:<br>\nbazel build -c opt //tensorflow/core/user_ops:rec_conv.so<br>\nError occure like:</p>\n<pre><code>Server finished RPC without an explicit exit code\n\nlixinyu@lixinyu-PC:~/tensorflow/tensorflow/tensorflow/core/user_ops$ bazel build -c opt //tensorflow/core/user_ops:rec_conv.so\n...........\nINFO: Found 1 target...\nERROR: /home/lixinyu/tensorflow/tensorflow/tensorflow/core/user_ops/BUILD:3:1: C++ compilation of rule '//tensorflow/core/user_ops:rec_conv.so' failed: gcc failed: error executing command /usr/bin/gcc -U_FORTIFY_SOURCE '-D_FORTIFY_SOURCE=1' -fstack-protector -Wall -Wl,-z,-relro,-z,now -B/usr/bin -B/usr/bin -Wunused-but-set-parameter -Wno-free-nonheap-object -fno-canonical-system-headers ... (remaining 57 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\nIn file included from tensorflow/core/user_ops/rec_conv.cc:3:0:\n./tensorflow/core/framework/op_kernel.h:1097:7: error: expected initializer before 'registrar__body__1__object'\n       registrar__body__##ctr##__object(                                 \\\n       ^\n./tensorflow/core/framework/op_kernel.h:1093:3: note: in expansion of macro 'REGISTER_KERNEL_BUILDER_UNIQ'\n   REGISTER_KERNEL_BUILDER_UNIQ(ctr, kernel_builder, __VA_ARGS__)\n   ^\n./tensorflow/core/framework/op_kernel.h:1090:3: note: in expansion of macro 'REGISTER_KERNEL_BUILDER_UNIQ_HELPER'\n   REGISTER_KERNEL_BUILDER_UNIQ_HELPER(__COUNTER__, kernel_builder, __VA_ARGS__)\n   ^\ntensorflow/core/user_ops/rec_conv.cc:32:1: note: in expansion of macro 'REGISTER_KERNEL_BUILDER'\n REGISTER_KERNEL_BUILDER(Name(\"RecConv\").Device(DEVICE_CPU), RecConvOp);\n ^\n./tensorflow/core/framework/op_kernel.h:1104:30: error: expected unqualified-id before ')' token\n                             });\n                              ^\n./tensorflow/core/framework/op_kernel.h:1093:3: note: in expansion of macro 'REGISTER_KERNEL_BUILDER_UNIQ'\n   REGISTER_KERNEL_BUILDER_UNIQ(ctr, kernel_builder, __VA_ARGS__)\n   ^\n./tensorflow/core/framework/op_kernel.h:1090:3: note: in expansion of macro 'REGISTER_KERNEL_BUILDER_UNIQ_HELPER'\n   REGISTER_KERNEL_BUILDER_UNIQ_HELPER(__COUNTER__, kernel_builder, __VA_ARGS__)\n   ^\ntensorflow/core/user_ops/rec_conv.cc:32:1: note: in expansion of macro 'REGISTER_KERNEL_BUILDER'\n REGISTER_KERNEL_BUILDER(Name(\"RecConv\").Device(DEVICE_CPU), RecConvOp);\n ^\nTarget //tensorflow/core/user_ops:rec_conv.so failed to build\nUse --verbose_failures to see the command lines of failed build steps.\nINFO: Elapsed time: 11.505s, Critical Path: 2.99s\nlixinyu@lixinyu-PC:~/tensorflow/tensorflow/tensorflow/core/user_ops$ bazel build -c opt //tensorflow/core/user_ops:rec_conv.so\n</code></pre>\n<hr>\n<p>Could anyone tell me what type of error it is like and how to debug it cuz I am wondering why there are so many warnings and error promped from the included header file</p>\n<p>Thanks in advance</p>", "body_text": "I just followed the tutorial when trying to add a new op in tensorflow\nI would like to add a new op with which the file name is: rec_conv.cc\nThe code is like:(Input an tensor and just output a string)\n#include \"tensorflow/core/framework/op.h\"\n#include \"tensorflow/core/framework/shape_inference.h\"\n#include \"tensorflow/core/framework/op_kernel.h\"\nusing namespace tensorflow;\n\t\nREGISTER_OP(\"RecConv\")\n    .Input(\"input: int32\")\n    .Output(\"output: string\")\n    .SetShapeFn([](::tensorflow::shape_inference::InferenceContext* c) {\n      c->set_output(0, c->input(0));\n      return Status::OK();\n    });\n\nclass RecConvOp: public OpKernel{\n public:\n\texplicit RecConvOp(OpKernelConstruction* context): OpKernel(context){}\n\n void Compute(OpKernelContext* context) override {\n\t//const Tensor& input_tensor = context->input(0);\n\tTensor* output_tensor = NULL;\n\tauto output = output_tensor->template scalar<string>();\n\toutput() = \"Output is Rec_conv layer\";\n }\n}\nREGISTER_KERNEL_BUILDER(Name(\"RecConv\").Device(DEVICE_CPU), RecConvOp);\n\n\nThe BUILD file is like:\nload(\"//tensorflow:tensorflow.bzl\", \"tf_custom_op_library\")\n\ntf_custom_op_library(\n    name = \"rec_conv.so\",\n    srcs = [\"rec_conv.cc\"],\n)\n\n\nHowever, when I run:\nbazel build -c opt //tensorflow/core/user_ops:rec_conv.so\nError occure like:\nServer finished RPC without an explicit exit code\n\nlixinyu@lixinyu-PC:~/tensorflow/tensorflow/tensorflow/core/user_ops$ bazel build -c opt //tensorflow/core/user_ops:rec_conv.so\n...........\nINFO: Found 1 target...\nERROR: /home/lixinyu/tensorflow/tensorflow/tensorflow/core/user_ops/BUILD:3:1: C++ compilation of rule '//tensorflow/core/user_ops:rec_conv.so' failed: gcc failed: error executing command /usr/bin/gcc -U_FORTIFY_SOURCE '-D_FORTIFY_SOURCE=1' -fstack-protector -Wall -Wl,-z,-relro,-z,now -B/usr/bin -B/usr/bin -Wunused-but-set-parameter -Wno-free-nonheap-object -fno-canonical-system-headers ... (remaining 57 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\nIn file included from tensorflow/core/user_ops/rec_conv.cc:3:0:\n./tensorflow/core/framework/op_kernel.h:1097:7: error: expected initializer before 'registrar__body__1__object'\n       registrar__body__##ctr##__object(                                 \\\n       ^\n./tensorflow/core/framework/op_kernel.h:1093:3: note: in expansion of macro 'REGISTER_KERNEL_BUILDER_UNIQ'\n   REGISTER_KERNEL_BUILDER_UNIQ(ctr, kernel_builder, __VA_ARGS__)\n   ^\n./tensorflow/core/framework/op_kernel.h:1090:3: note: in expansion of macro 'REGISTER_KERNEL_BUILDER_UNIQ_HELPER'\n   REGISTER_KERNEL_BUILDER_UNIQ_HELPER(__COUNTER__, kernel_builder, __VA_ARGS__)\n   ^\ntensorflow/core/user_ops/rec_conv.cc:32:1: note: in expansion of macro 'REGISTER_KERNEL_BUILDER'\n REGISTER_KERNEL_BUILDER(Name(\"RecConv\").Device(DEVICE_CPU), RecConvOp);\n ^\n./tensorflow/core/framework/op_kernel.h:1104:30: error: expected unqualified-id before ')' token\n                             });\n                              ^\n./tensorflow/core/framework/op_kernel.h:1093:3: note: in expansion of macro 'REGISTER_KERNEL_BUILDER_UNIQ'\n   REGISTER_KERNEL_BUILDER_UNIQ(ctr, kernel_builder, __VA_ARGS__)\n   ^\n./tensorflow/core/framework/op_kernel.h:1090:3: note: in expansion of macro 'REGISTER_KERNEL_BUILDER_UNIQ_HELPER'\n   REGISTER_KERNEL_BUILDER_UNIQ_HELPER(__COUNTER__, kernel_builder, __VA_ARGS__)\n   ^\ntensorflow/core/user_ops/rec_conv.cc:32:1: note: in expansion of macro 'REGISTER_KERNEL_BUILDER'\n REGISTER_KERNEL_BUILDER(Name(\"RecConv\").Device(DEVICE_CPU), RecConvOp);\n ^\nTarget //tensorflow/core/user_ops:rec_conv.so failed to build\nUse --verbose_failures to see the command lines of failed build steps.\nINFO: Elapsed time: 11.505s, Critical Path: 2.99s\nlixinyu@lixinyu-PC:~/tensorflow/tensorflow/tensorflow/core/user_ops$ bazel build -c opt //tensorflow/core/user_ops:rec_conv.so\n\n\nCould anyone tell me what type of error it is like and how to debug it cuz I am wondering why there are so many warnings and error promped from the included header file\nThanks in advance", "body": "I just followed the tutorial when trying to add a new op in tensorflow\r\nI would like to add a new op with which the file name is: rec_conv.cc\r\nThe code is like:(Input an tensor and just output a string)\r\n```\r\n#include \"tensorflow/core/framework/op.h\"\r\n#include \"tensorflow/core/framework/shape_inference.h\"\r\n#include \"tensorflow/core/framework/op_kernel.h\"\r\nusing namespace tensorflow;\r\n\t\r\nREGISTER_OP(\"RecConv\")\r\n    .Input(\"input: int32\")\r\n    .Output(\"output: string\")\r\n    .SetShapeFn([](::tensorflow::shape_inference::InferenceContext* c) {\r\n      c->set_output(0, c->input(0));\r\n      return Status::OK();\r\n    });\r\n\r\nclass RecConvOp: public OpKernel{\r\n public:\r\n\texplicit RecConvOp(OpKernelConstruction* context): OpKernel(context){}\r\n\r\n void Compute(OpKernelContext* context) override {\r\n\t//const Tensor& input_tensor = context->input(0);\r\n\tTensor* output_tensor = NULL;\r\n\tauto output = output_tensor->template scalar<string>();\r\n\toutput() = \"Output is Rec_conv layer\";\r\n }\r\n}\r\nREGISTER_KERNEL_BUILDER(Name(\"RecConv\").Device(DEVICE_CPU), RecConvOp);\r\n```\r\n-------------------------------------------------\r\nThe BUILD file is like:\r\n```\r\nload(\"//tensorflow:tensorflow.bzl\", \"tf_custom_op_library\")\r\n\r\ntf_custom_op_library(\r\n    name = \"rec_conv.so\",\r\n    srcs = [\"rec_conv.cc\"],\r\n)\r\n```\r\n---------------------------------------------\r\nHowever, when I run:\r\n bazel build -c opt //tensorflow/core/user_ops:rec_conv.so\r\nError occure like:\r\n```\r\nServer finished RPC without an explicit exit code\r\n\r\nlixinyu@lixinyu-PC:~/tensorflow/tensorflow/tensorflow/core/user_ops$ bazel build -c opt //tensorflow/core/user_ops:rec_conv.so\r\n...........\r\nINFO: Found 1 target...\r\nERROR: /home/lixinyu/tensorflow/tensorflow/tensorflow/core/user_ops/BUILD:3:1: C++ compilation of rule '//tensorflow/core/user_ops:rec_conv.so' failed: gcc failed: error executing command /usr/bin/gcc -U_FORTIFY_SOURCE '-D_FORTIFY_SOURCE=1' -fstack-protector -Wall -Wl,-z,-relro,-z,now -B/usr/bin -B/usr/bin -Wunused-but-set-parameter -Wno-free-nonheap-object -fno-canonical-system-headers ... (remaining 57 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\r\nIn file included from tensorflow/core/user_ops/rec_conv.cc:3:0:\r\n./tensorflow/core/framework/op_kernel.h:1097:7: error: expected initializer before 'registrar__body__1__object'\r\n       registrar__body__##ctr##__object(                                 \\\r\n       ^\r\n./tensorflow/core/framework/op_kernel.h:1093:3: note: in expansion of macro 'REGISTER_KERNEL_BUILDER_UNIQ'\r\n   REGISTER_KERNEL_BUILDER_UNIQ(ctr, kernel_builder, __VA_ARGS__)\r\n   ^\r\n./tensorflow/core/framework/op_kernel.h:1090:3: note: in expansion of macro 'REGISTER_KERNEL_BUILDER_UNIQ_HELPER'\r\n   REGISTER_KERNEL_BUILDER_UNIQ_HELPER(__COUNTER__, kernel_builder, __VA_ARGS__)\r\n   ^\r\ntensorflow/core/user_ops/rec_conv.cc:32:1: note: in expansion of macro 'REGISTER_KERNEL_BUILDER'\r\n REGISTER_KERNEL_BUILDER(Name(\"RecConv\").Device(DEVICE_CPU), RecConvOp);\r\n ^\r\n./tensorflow/core/framework/op_kernel.h:1104:30: error: expected unqualified-id before ')' token\r\n                             });\r\n                              ^\r\n./tensorflow/core/framework/op_kernel.h:1093:3: note: in expansion of macro 'REGISTER_KERNEL_BUILDER_UNIQ'\r\n   REGISTER_KERNEL_BUILDER_UNIQ(ctr, kernel_builder, __VA_ARGS__)\r\n   ^\r\n./tensorflow/core/framework/op_kernel.h:1090:3: note: in expansion of macro 'REGISTER_KERNEL_BUILDER_UNIQ_HELPER'\r\n   REGISTER_KERNEL_BUILDER_UNIQ_HELPER(__COUNTER__, kernel_builder, __VA_ARGS__)\r\n   ^\r\ntensorflow/core/user_ops/rec_conv.cc:32:1: note: in expansion of macro 'REGISTER_KERNEL_BUILDER'\r\n REGISTER_KERNEL_BUILDER(Name(\"RecConv\").Device(DEVICE_CPU), RecConvOp);\r\n ^\r\nTarget //tensorflow/core/user_ops:rec_conv.so failed to build\r\nUse --verbose_failures to see the command lines of failed build steps.\r\nINFO: Elapsed time: 11.505s, Critical Path: 2.99s\r\nlixinyu@lixinyu-PC:~/tensorflow/tensorflow/tensorflow/core/user_ops$ bazel build -c opt //tensorflow/core/user_ops:rec_conv.so\r\n```\r\n-----------------------------------------------------\r\nCould anyone tell me what type of error it is like and how to debug it cuz I am wondering why there are so many warnings and error promped from the included header file\r\n\r\nThanks in advance\r\n"}