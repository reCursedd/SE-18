{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/409282073", "html_url": "https://github.com/tensorflow/tensorflow/issues/21277#issuecomment-409282073", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21277", "id": 409282073, "node_id": "MDEyOklzc3VlQ29tbWVudDQwOTI4MjA3Mw==", "user": {"login": "nfergu", "id": 1291583, "node_id": "MDQ6VXNlcjEyOTE1ODM=", "avatar_url": "https://avatars1.githubusercontent.com/u/1291583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nfergu", "html_url": "https://github.com/nfergu", "followers_url": "https://api.github.com/users/nfergu/followers", "following_url": "https://api.github.com/users/nfergu/following{/other_user}", "gists_url": "https://api.github.com/users/nfergu/gists{/gist_id}", "starred_url": "https://api.github.com/users/nfergu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nfergu/subscriptions", "organizations_url": "https://api.github.com/users/nfergu/orgs", "repos_url": "https://api.github.com/users/nfergu/repos", "events_url": "https://api.github.com/users/nfergu/events{/privacy}", "received_events_url": "https://api.github.com/users/nfergu/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-31T16:24:19Z", "updated_at": "2018-07-31T16:24:19Z", "author_association": "NONE", "body_html": "<p>I've set <code>TF_CPP_MIN_VLOG_LEVEL=1</code> and attached the resulting log from after the call to <code>TF_DeleteSession</code>. Note that this includes my added log line \"About to ensure GIL\" at the end (see my previous comment). And then the program hangs.</p>\n<pre><code>2018-07-31 17:22:11.229247: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229282: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229298: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229311: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229329: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229338: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229356: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229375: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229396: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229413: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229426: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229452: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229462: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229474: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229495: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229503: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229515: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229534: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229543: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229917: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229930: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229961: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229970: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229990: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229998: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230006: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230014: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230022: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230030: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230066: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230074: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230093: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230101: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230109: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230138: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230155: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230219: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230336: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230346: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230354: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230362: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230370: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230384: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230401: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.231726: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.231838: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.232569: I tensorflow/core/common_runtime/function.cc:584] Graph Initial #nodes 5 #edges 6\n2018-07-31 17:22:11.232583: I tensorflow/core/common_runtime/function.cc:584] Graph Before #nodes 5 #edges 6\n2018-07-31 17:22:11.232599: I tensorflow/core/common_runtime/constant_folding.cc:571] No constant foldable nodes found\n2018-07-31 17:22:11.232644: I tensorflow/core/common_runtime/function.cc:584] Graph ReCopy #nodes 5 #edges 7\n2018-07-31 17:22:11.232673: I tensorflow/core/framework/op_kernel.cc:1157] Instantiating kernel for node: _SOURCE = NoOp[]()\n2018-07-31 17:22:11.232701: I tensorflow/core/framework/op_kernel.cc:1157] Instantiating kernel for node: _SINK = NoOp[]()\n2018-07-31 17:22:11.232724: I tensorflow/core/framework/op_kernel.cc:1157] Instantiating kernel for node: arg0 = _Arg[T=DT_INT64, index=0]()\n2018-07-31 17:22:11.232763: I tensorflow/core/framework/op_kernel.cc:1157] Instantiating kernel for node: PyFunc = PyFunc[Tin=[DT_INT64], Tout=[DT_INT64], token=\"pyfunc_2\"](arg0)\n2018-07-31 17:22:11.232802: I tensorflow/core/framework/op_kernel.cc:1157] Instantiating kernel for node: pyfunc_RetVal = _Retval[T=DT_INT64, index=0](PyFunc)\n2018-07-31 17:22:11.232861: I tensorflow/core/common_runtime/executor.cc:1578] Process node: 0 step -6231738800936566896 _SOURCE = NoOp[]() is dead: 0\n2018-07-31 17:22:11.232880: I tensorflow/core/common_runtime/executor.cc:1578] Process node: 2 step -6231738800936566896 arg0 = _Arg[T=DT_INT64, index=0]() is dead: 0\n2018-07-31 17:22:11.232906: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorOutput { step_id: -6231738800936566896 kernel_name: \"arg0\" tensor { dtype: DT_INT64 shape { } allocation_description { requested_bytes: 8 allocator_name: \"cpu\" } } }\n2018-07-31 17:22:11.232926: I tensorflow/core/common_runtime/executor.cc:1578] Process node: 3 step -6231738800936566896 PyFunc = PyFunc[Tin=[DT_INT64], Tout=[DT_INT64], token=\"pyfunc_2\"](arg0) is dead: 0\n2018-07-31 17:22:11.232938: E tensorflow/python/lib/core/py_func.cc:472] About to ensure GIL\n</code></pre>", "body_text": "I've set TF_CPP_MIN_VLOG_LEVEL=1 and attached the resulting log from after the call to TF_DeleteSession. Note that this includes my added log line \"About to ensure GIL\" at the end (see my previous comment). And then the program hangs.\n2018-07-31 17:22:11.229247: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229282: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229298: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229311: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229329: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229338: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229356: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229375: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229396: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229413: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229426: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229452: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229462: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229474: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229495: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229503: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229515: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229534: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229543: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229917: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229930: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229961: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229970: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229990: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.229998: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230006: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230014: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230022: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230030: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230066: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230074: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230093: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230101: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230109: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230138: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230155: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230219: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230336: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230346: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230354: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230362: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230370: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230384: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.230401: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.231726: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.231838: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\n2018-07-31 17:22:11.232569: I tensorflow/core/common_runtime/function.cc:584] Graph Initial #nodes 5 #edges 6\n2018-07-31 17:22:11.232583: I tensorflow/core/common_runtime/function.cc:584] Graph Before #nodes 5 #edges 6\n2018-07-31 17:22:11.232599: I tensorflow/core/common_runtime/constant_folding.cc:571] No constant foldable nodes found\n2018-07-31 17:22:11.232644: I tensorflow/core/common_runtime/function.cc:584] Graph ReCopy #nodes 5 #edges 7\n2018-07-31 17:22:11.232673: I tensorflow/core/framework/op_kernel.cc:1157] Instantiating kernel for node: _SOURCE = NoOp[]()\n2018-07-31 17:22:11.232701: I tensorflow/core/framework/op_kernel.cc:1157] Instantiating kernel for node: _SINK = NoOp[]()\n2018-07-31 17:22:11.232724: I tensorflow/core/framework/op_kernel.cc:1157] Instantiating kernel for node: arg0 = _Arg[T=DT_INT64, index=0]()\n2018-07-31 17:22:11.232763: I tensorflow/core/framework/op_kernel.cc:1157] Instantiating kernel for node: PyFunc = PyFunc[Tin=[DT_INT64], Tout=[DT_INT64], token=\"pyfunc_2\"](arg0)\n2018-07-31 17:22:11.232802: I tensorflow/core/framework/op_kernel.cc:1157] Instantiating kernel for node: pyfunc_RetVal = _Retval[T=DT_INT64, index=0](PyFunc)\n2018-07-31 17:22:11.232861: I tensorflow/core/common_runtime/executor.cc:1578] Process node: 0 step -6231738800936566896 _SOURCE = NoOp[]() is dead: 0\n2018-07-31 17:22:11.232880: I tensorflow/core/common_runtime/executor.cc:1578] Process node: 2 step -6231738800936566896 arg0 = _Arg[T=DT_INT64, index=0]() is dead: 0\n2018-07-31 17:22:11.232906: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorOutput { step_id: -6231738800936566896 kernel_name: \"arg0\" tensor { dtype: DT_INT64 shape { } allocation_description { requested_bytes: 8 allocator_name: \"cpu\" } } }\n2018-07-31 17:22:11.232926: I tensorflow/core/common_runtime/executor.cc:1578] Process node: 3 step -6231738800936566896 PyFunc = PyFunc[Tin=[DT_INT64], Tout=[DT_INT64], token=\"pyfunc_2\"](arg0) is dead: 0\n2018-07-31 17:22:11.232938: E tensorflow/python/lib/core/py_func.cc:472] About to ensure GIL", "body": "I've set `TF_CPP_MIN_VLOG_LEVEL=1` and attached the resulting log from after the call to `TF_DeleteSession`. Note that this includes my added log line \"About to ensure GIL\" at the end (see my previous comment). And then the program hangs.\r\n\r\n```\r\n2018-07-31 17:22:11.229247: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229282: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229298: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229311: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229329: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229338: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229356: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229375: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229396: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229413: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229426: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229452: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229462: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229474: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229495: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229503: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229515: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229534: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229543: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229917: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229930: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229961: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229970: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229990: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.229998: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230006: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230014: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230022: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230030: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230066: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230074: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230093: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230101: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230109: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230138: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230155: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230219: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230336: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230346: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230354: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230362: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230370: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230384: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.230401: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.231726: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.231838: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorDeallocation { allocator_name: \"cpu\" }\r\n2018-07-31 17:22:11.232569: I tensorflow/core/common_runtime/function.cc:584] Graph Initial #nodes 5 #edges 6\r\n2018-07-31 17:22:11.232583: I tensorflow/core/common_runtime/function.cc:584] Graph Before #nodes 5 #edges 6\r\n2018-07-31 17:22:11.232599: I tensorflow/core/common_runtime/constant_folding.cc:571] No constant foldable nodes found\r\n2018-07-31 17:22:11.232644: I tensorflow/core/common_runtime/function.cc:584] Graph ReCopy #nodes 5 #edges 7\r\n2018-07-31 17:22:11.232673: I tensorflow/core/framework/op_kernel.cc:1157] Instantiating kernel for node: _SOURCE = NoOp[]()\r\n2018-07-31 17:22:11.232701: I tensorflow/core/framework/op_kernel.cc:1157] Instantiating kernel for node: _SINK = NoOp[]()\r\n2018-07-31 17:22:11.232724: I tensorflow/core/framework/op_kernel.cc:1157] Instantiating kernel for node: arg0 = _Arg[T=DT_INT64, index=0]()\r\n2018-07-31 17:22:11.232763: I tensorflow/core/framework/op_kernel.cc:1157] Instantiating kernel for node: PyFunc = PyFunc[Tin=[DT_INT64], Tout=[DT_INT64], token=\"pyfunc_2\"](arg0)\r\n2018-07-31 17:22:11.232802: I tensorflow/core/framework/op_kernel.cc:1157] Instantiating kernel for node: pyfunc_RetVal = _Retval[T=DT_INT64, index=0](PyFunc)\r\n2018-07-31 17:22:11.232861: I tensorflow/core/common_runtime/executor.cc:1578] Process node: 0 step -6231738800936566896 _SOURCE = NoOp[]() is dead: 0\r\n2018-07-31 17:22:11.232880: I tensorflow/core/common_runtime/executor.cc:1578] Process node: 2 step -6231738800936566896 arg0 = _Arg[T=DT_INT64, index=0]() is dead: 0\r\n2018-07-31 17:22:11.232906: I tensorflow/core/framework/log_memory.cc:35] __LOG_MEMORY__ MemoryLogTensorOutput { step_id: -6231738800936566896 kernel_name: \"arg0\" tensor { dtype: DT_INT64 shape { } allocation_description { requested_bytes: 8 allocator_name: \"cpu\" } } }\r\n2018-07-31 17:22:11.232926: I tensorflow/core/common_runtime/executor.cc:1578] Process node: 3 step -6231738800936566896 PyFunc = PyFunc[Tin=[DT_INT64], Tout=[DT_INT64], token=\"pyfunc_2\"](arg0) is dead: 0\r\n2018-07-31 17:22:11.232938: E tensorflow/python/lib/core/py_func.cc:472] About to ensure GIL\r\n```"}