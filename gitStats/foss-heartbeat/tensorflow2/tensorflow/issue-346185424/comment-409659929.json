{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/409659929", "html_url": "https://github.com/tensorflow/tensorflow/issues/21277#issuecomment-409659929", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21277", "id": 409659929, "node_id": "MDEyOklzc3VlQ29tbWVudDQwOTY1OTkyOQ==", "user": {"login": "nfergu", "id": 1291583, "node_id": "MDQ6VXNlcjEyOTE1ODM=", "avatar_url": "https://avatars1.githubusercontent.com/u/1291583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nfergu", "html_url": "https://github.com/nfergu", "followers_url": "https://api.github.com/users/nfergu/followers", "following_url": "https://api.github.com/users/nfergu/following{/other_user}", "gists_url": "https://api.github.com/users/nfergu/gists{/gist_id}", "starred_url": "https://api.github.com/users/nfergu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nfergu/subscriptions", "organizations_url": "https://api.github.com/users/nfergu/orgs", "repos_url": "https://api.github.com/users/nfergu/repos", "events_url": "https://api.github.com/users/nfergu/events{/privacy}", "received_events_url": "https://api.github.com/users/nfergu/received_events", "type": "User", "site_admin": false}, "created_at": "2018-08-01T17:41:27Z", "updated_at": "2018-08-01T17:41:27Z", "author_association": "NONE", "body_html": "<p>It looks like an error may be occurring, which is killing the thread. Stepping through the <code>PyGILState_Ensure</code> function in lldb, I can see the following happening:</p>\n<pre><code>Process 71453 stopped\n* thread #11, stop reason = instruction step over\n    frame #0: 0x000000010087d794 Python`PyGILState_Ensure + 100\nPython`PyGILState_Ensure:\n-&gt;  0x10087d794 &lt;+100&gt;: movl   $0x0, 0x88(%rbx)\n    0x10087d79e &lt;+110&gt;: jmp    0x10087d75a               ; &lt;+42&gt;\n    0x10087d7a0 &lt;+112&gt;: leaq   0x8e1d1(%rip), %rdi       ; \"Couldn't create thread-state for new thread\"\n    0x10087d7a7 &lt;+119&gt;: callq  0x10087a510               ; Py_FatalError\n</code></pre>\n<p>This <em>looks</em> to me like the <code>Py_FatalError</code> function is being called with \"Couldn't create thread-state for new thread\". Soon after this happens the thread dies.</p>\n<p>This seems to correspond to these lines from <code>PyGILState_Ensure</code> (looking at the code here: <a href=\"https://github.com/python/cpython/blob/e42b705188271da108de42b55d9344642170aa2b/Python/pystate.c\">https://github.com/python/cpython/blob/e42b705188271da108de42b55d9344642170aa2b/Python/pystate.c</a>):</p>\n<pre><code>tcur = PyThreadState_New(_PyRuntime.gilstate.autoInterpreterState);\n        if (tcur == NULL)\n            Py_FatalError(\"Couldn't create thread-state for new thread\");\n</code></pre>\n<p>But it's not obvious to me why this would be failing.</p>", "body_text": "It looks like an error may be occurring, which is killing the thread. Stepping through the PyGILState_Ensure function in lldb, I can see the following happening:\nProcess 71453 stopped\n* thread #11, stop reason = instruction step over\n    frame #0: 0x000000010087d794 Python`PyGILState_Ensure + 100\nPython`PyGILState_Ensure:\n->  0x10087d794 <+100>: movl   $0x0, 0x88(%rbx)\n    0x10087d79e <+110>: jmp    0x10087d75a               ; <+42>\n    0x10087d7a0 <+112>: leaq   0x8e1d1(%rip), %rdi       ; \"Couldn't create thread-state for new thread\"\n    0x10087d7a7 <+119>: callq  0x10087a510               ; Py_FatalError\n\nThis looks to me like the Py_FatalError function is being called with \"Couldn't create thread-state for new thread\". Soon after this happens the thread dies.\nThis seems to correspond to these lines from PyGILState_Ensure (looking at the code here: https://github.com/python/cpython/blob/e42b705188271da108de42b55d9344642170aa2b/Python/pystate.c):\ntcur = PyThreadState_New(_PyRuntime.gilstate.autoInterpreterState);\n        if (tcur == NULL)\n            Py_FatalError(\"Couldn't create thread-state for new thread\");\n\nBut it's not obvious to me why this would be failing.", "body": "It looks like an error may be occurring, which is killing the thread. Stepping through the `PyGILState_Ensure` function in lldb, I can see the following happening:\r\n\r\n```\r\nProcess 71453 stopped\r\n* thread #11, stop reason = instruction step over\r\n    frame #0: 0x000000010087d794 Python`PyGILState_Ensure + 100\r\nPython`PyGILState_Ensure:\r\n->  0x10087d794 <+100>: movl   $0x0, 0x88(%rbx)\r\n    0x10087d79e <+110>: jmp    0x10087d75a               ; <+42>\r\n    0x10087d7a0 <+112>: leaq   0x8e1d1(%rip), %rdi       ; \"Couldn't create thread-state for new thread\"\r\n    0x10087d7a7 <+119>: callq  0x10087a510               ; Py_FatalError\r\n```\r\n\r\nThis _looks_ to me like the `Py_FatalError` function is being called with \"Couldn't create thread-state for new thread\". Soon after this happens the thread dies.\r\n\r\nThis seems to correspond to these lines from `PyGILState_Ensure` (looking at the code here: https://github.com/python/cpython/blob/e42b705188271da108de42b55d9344642170aa2b/Python/pystate.c):\r\n\r\n```\r\ntcur = PyThreadState_New(_PyRuntime.gilstate.autoInterpreterState);\r\n        if (tcur == NULL)\r\n            Py_FatalError(\"Couldn't create thread-state for new thread\");\r\n```\r\n\r\nBut it's not obvious to me why this would be failing."}