{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/232775871", "html_url": "https://github.com/tensorflow/tensorflow/issues/492#issuecomment-232775871", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/492", "id": 232775871, "node_id": "MDEyOklzc3VlQ29tbWVudDIzMjc3NTg3MQ==", "user": {"login": "pooyam", "id": 16478748, "node_id": "MDQ6VXNlcjE2NDc4NzQ4", "avatar_url": "https://avatars3.githubusercontent.com/u/16478748?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pooyam", "html_url": "https://github.com/pooyam", "followers_url": "https://api.github.com/users/pooyam/followers", "following_url": "https://api.github.com/users/pooyam/following{/other_user}", "gists_url": "https://api.github.com/users/pooyam/gists{/gist_id}", "starred_url": "https://api.github.com/users/pooyam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pooyam/subscriptions", "organizations_url": "https://api.github.com/users/pooyam/orgs", "repos_url": "https://api.github.com/users/pooyam/repos", "events_url": "https://api.github.com/users/pooyam/events{/privacy}", "received_events_url": "https://api.github.com/users/pooyam/received_events", "type": "User", "site_admin": false}, "created_at": "2016-07-14T20:03:01Z", "updated_at": "2016-07-14T20:03:01Z", "author_association": "NONE", "body_html": "<p>Hello,</p>\n<p>I am using the GPU compatible version of TensorFlow 0.8, my system has 4 GPUs with approximately 12GB memory for each. I am running a CNN in TensorFlow for grey scale images (one channel images) whose size is 1024*1024, the total number of training images is 1520 and the batch size is 7, also this CNN has 64 feature maps for each convolutional layer. According to a variety of web pages talking about TensorFlow's memory issue I am using the BFC memory allocator in the session's configuration of my CNN. Unfortunately after around 10 epochs I am getting the \"ran out of memory error\", following is the error log, which doesn't make sense to me considering the batch size, image dimensions, and memory size of my GPU. Any help is appreciated.</p>\n<p>Error log:</p>\n<p>I tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (256):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (512):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (1024):     Total Chunks: 1, Chunks in use: 0 1.8KiB allocated for chunks. 256B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (2048):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (4096):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (8192):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (16384):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (32768):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (65536):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (131072):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (262144):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (524288):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (1048576):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (2097152):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (4194304):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (8388608):     Total Chunks: 1, Chunks in use: 0 8.00MiB allocated for chunks. 400.0KiB client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (16777216):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (33554432):     Total Chunks: 1, Chunks in use: 0 36.53MiB allocated for chunks. 400.0KiB client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (67108864):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (134217728):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (268435456):     Total Chunks: 2, Chunks in use: 0 2.21GiB allocated for chunks. 896.00MiB client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:652] Bin for 1.75GiB was 256.00MiB, Chunk State:<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:658]   Size: 508.67MiB | Requested Size: 448.00MiB | in_use: 0, prev:   Size: 448.00MiB | Requested Size: 448.00MiB | in_use: 1, next:   Size: 1.75GiB | Requested Size: 1.75GiB | in_use: 1<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:658]   Size: 1.72GiB | Requested Size: 448.00MiB | in_use: 0, prev:   Size: 448.00MiB | Requested Size: 448.00MiB | in_use: 1, next:   Size: 6.2KiB | Requested Size: 6.2KiB | in_use: 1<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80000 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80100 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80200 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80300 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80400 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80500 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80600 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80700 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80800 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80900 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80a00 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80b00 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80c00 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80d00 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80e00 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80f00 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81000 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81100 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81200 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81300 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81400 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81500 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81600 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81700 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81f00 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb82000 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb82100 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb82200 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb82300 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb82400 of size 256<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb82500 of size 6400<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x231200b200 of size 29360128<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x231440b200 of size 469762048<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x239e15e100 of size 6400<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x239e15fa00 of size 469762048<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x23ba15fa00 of size 469762048<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x23f5e0b200 of size 1879048192<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x2465e0b200 of size 1879048192<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x24d5e0b200 of size 3733947904<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:679] Free at 0x230fb81800 of size 1792<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:679] Free at 0x230fb83e00 of size 38302720<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:679] Free at 0x2313c0b200 of size 8388608<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:679] Free at 0x233040b200 of size 1842687744<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:679] Free at 0x23d615fa00 of size 533379072<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:685]      Summary of in-use Chunks by size:<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:688] 30 Chunks of size 256 totalling 7.5KiB<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:688] 2 Chunks of size 6400 totalling 12.5KiB<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:688] 1 Chunks of size 29360128 totalling 28.00MiB<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:688] 3 Chunks of size 469762048 totalling 1.31GiB<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:688] 2 Chunks of size 1879048192 totalling 3.50GiB<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:688] 1 Chunks of size 3733947904 totalling 3.48GiB<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:692] Sum Total of in-use chunks: 8.32GiB<br>\nI tensorflow/core/common_runtime/bfc_allocator.cc:694] Stats:<br>\nLimit:                 11353470976<br>\nInUse:                  8930711040<br>\nMaxInUse:              11319364608<br>\nNumAllocs:                 1495009<br>\nMaxAllocSize:           4804771072</p>\n<p>W tensorflow/core/common_runtime/bfc_allocator.cc:270] ****____________<em><strong><strong><strong>_</strong>***</strong></strong></em>**_***********************************************xxxxxxxxxxxxxxxx<br>\nW tensorflow/core/common_runtime/bfc_allocator.cc:271] Ran out of memory trying to allocate 1.75GiB.  See logs for memory state.<br>\nW tensorflow/core/framework/op_kernel.cc:900] Resource exhausted: OOM when allocating tensor with shape[7,64,1024,1024]<br>\nTraceback (most recent call last):<br>\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 342, in <br>\ntf.app.run()<br>\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 30, in run<br>\nsys.exit(main(sys.argv))<br>\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 338, in main<br>\ntrain()<br>\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 256, in train<br>\n_, loss_value, mse_value, mymse_value, logits_value, labels_value = sess.run([train_op, loss, mse, mymse, logits, labels])<br>\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 340, in run<br>\nrun_metadata_ptr)<br>\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 564, in _run<br>\nfeed_dict_string, options, run_metadata)<br>\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 637, in _do_run<br>\ntarget_list, options, run_metadata)<br>\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 659, in _do_call<br>\ne.code)<br>\ntensorflow.python.framework.errors.ResourceExhaustedError: OOM when allocating tensor with shape[7,64,1024,1024]<br>\n[[Node: tower_3/gradients/tower_3/pool1_grad/MaxPoolGrad = MaxPoolGrad[data_format=\"NHWC\", ksize=[1, 3, 3, 1], padding=\"SAME\", strides=[1, 2, 2, 1], _device=\"/job:localhost/replica:0/task:0/gpu:3\"](tower_3/conv1/conv1, tower_3/pool1, tower_3/gradients/tower_3/norm1_grad/LRNGrad/_2719)]]<br>\n[[Node: tower_3/gradients/tower_3/conv1/BiasAdd_grad/tuple/control_dependency_1/_2721 = _Recv<a href=\"\">client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/gpu:3\", send_device_incarnation=1, tensor_name=\"edge_3317_tower_3/gradients/tower_3/conv1/BiasAdd_grad/tuple/control_dependency_1\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/cpu:0\"</a>]]<br>\nCaused by op u'tower_3/gradients/tower_3/pool1_grad/MaxPoolGrad', defined at:<br>\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 342, in <br>\ntf.app.run()<br>\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 30, in run<br>\nsys.exit(main(sys.argv))<br>\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 338, in main<br>\ntrain()<br>\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 182, in train<br>\ngrads = opt.compute_gradients(loss)<br>\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/training/optimizer.py\", line 241, in compute_gradients<br>\ncolocate_gradients_with_ops=colocate_gradients_with_ops)<br>\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gradients.py\", line 481, in gradients<br>\nin_grads = _AsList(grad_fn(op, *out_grads))<br>\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/nn_grad.py\", line 251, in _MaxPoolGrad<br>\ndata_format=op.get_attr(\"data_format\")<br>\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gen_nn_ops.py\", line 710, in _max_pool_grad<br>\ndata_format=data_format, name=name)<br>\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/op_def_library.py\", line 655, in apply_op<br>\nop_def=op_def)<br>\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2154, in create_op<br>\noriginal_op=self._default_original_op, op_def=op_def)<br>\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1154, in <strong>init</strong><br>\nself._traceback = _extract_stack()</p>\n<p>...which was originally created as op u'tower_3/pool1', defined at:<br>\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 342, in <br>\ntf.app.run()<br>\n[elided 1 identical lines from previous traceback]<br>\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 338, in main<br>\ntrain()<br>\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 173, in train<br>\nloss, mse, mymse, logits, labels = tower_loss(scope)<br>\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 69, in tower_loss<br>\nlogits = cnn.inference(images)<br>\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn.py\", line 184, in inference<br>\npadding='SAME', name='pool1')<br>\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/nn_ops.py\", line 341, in max_pool<br>\nname=name)<br>\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gen_nn_ops.py\", line 677, in _max_pool<br>\ndata_format=data_format, name=name)<br>\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/op_def_library.py\", line 655, in apply_op<br>\nop_def=op_def)</p>", "body_text": "Hello,\nI am using the GPU compatible version of TensorFlow 0.8, my system has 4 GPUs with approximately 12GB memory for each. I am running a CNN in TensorFlow for grey scale images (one channel images) whose size is 1024*1024, the total number of training images is 1520 and the batch size is 7, also this CNN has 64 feature maps for each convolutional layer. According to a variety of web pages talking about TensorFlow's memory issue I am using the BFC memory allocator in the session's configuration of my CNN. Unfortunately after around 10 epochs I am getting the \"ran out of memory error\", following is the error log, which doesn't make sense to me considering the batch size, image dimensions, and memory size of my GPU. Any help is appreciated.\nError log:\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (256):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (512):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (1024):     Total Chunks: 1, Chunks in use: 0 1.8KiB allocated for chunks. 256B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (2048):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (4096):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (8192):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (16384):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (32768):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (65536):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (131072):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (262144):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (524288):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (1048576):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (2097152):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (4194304):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (8388608):     Total Chunks: 1, Chunks in use: 0 8.00MiB allocated for chunks. 400.0KiB client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (16777216):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (33554432):     Total Chunks: 1, Chunks in use: 0 36.53MiB allocated for chunks. 400.0KiB client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (67108864):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (134217728):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (268435456):     Total Chunks: 2, Chunks in use: 0 2.21GiB allocated for chunks. 896.00MiB client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:652] Bin for 1.75GiB was 256.00MiB, Chunk State:\nI tensorflow/core/common_runtime/bfc_allocator.cc:658]   Size: 508.67MiB | Requested Size: 448.00MiB | in_use: 0, prev:   Size: 448.00MiB | Requested Size: 448.00MiB | in_use: 1, next:   Size: 1.75GiB | Requested Size: 1.75GiB | in_use: 1\nI tensorflow/core/common_runtime/bfc_allocator.cc:658]   Size: 1.72GiB | Requested Size: 448.00MiB | in_use: 0, prev:   Size: 448.00MiB | Requested Size: 448.00MiB | in_use: 1, next:   Size: 6.2KiB | Requested Size: 6.2KiB | in_use: 1\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80000 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80100 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80200 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80300 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80400 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80500 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80600 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80700 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80800 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80900 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80a00 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80b00 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80c00 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80d00 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80e00 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80f00 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81000 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81100 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81200 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81300 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81400 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81500 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81600 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81700 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81f00 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb82000 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb82100 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb82200 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb82300 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb82400 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb82500 of size 6400\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x231200b200 of size 29360128\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x231440b200 of size 469762048\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x239e15e100 of size 6400\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x239e15fa00 of size 469762048\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x23ba15fa00 of size 469762048\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x23f5e0b200 of size 1879048192\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x2465e0b200 of size 1879048192\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x24d5e0b200 of size 3733947904\nI tensorflow/core/common_runtime/bfc_allocator.cc:679] Free at 0x230fb81800 of size 1792\nI tensorflow/core/common_runtime/bfc_allocator.cc:679] Free at 0x230fb83e00 of size 38302720\nI tensorflow/core/common_runtime/bfc_allocator.cc:679] Free at 0x2313c0b200 of size 8388608\nI tensorflow/core/common_runtime/bfc_allocator.cc:679] Free at 0x233040b200 of size 1842687744\nI tensorflow/core/common_runtime/bfc_allocator.cc:679] Free at 0x23d615fa00 of size 533379072\nI tensorflow/core/common_runtime/bfc_allocator.cc:685]      Summary of in-use Chunks by size:\nI tensorflow/core/common_runtime/bfc_allocator.cc:688] 30 Chunks of size 256 totalling 7.5KiB\nI tensorflow/core/common_runtime/bfc_allocator.cc:688] 2 Chunks of size 6400 totalling 12.5KiB\nI tensorflow/core/common_runtime/bfc_allocator.cc:688] 1 Chunks of size 29360128 totalling 28.00MiB\nI tensorflow/core/common_runtime/bfc_allocator.cc:688] 3 Chunks of size 469762048 totalling 1.31GiB\nI tensorflow/core/common_runtime/bfc_allocator.cc:688] 2 Chunks of size 1879048192 totalling 3.50GiB\nI tensorflow/core/common_runtime/bfc_allocator.cc:688] 1 Chunks of size 3733947904 totalling 3.48GiB\nI tensorflow/core/common_runtime/bfc_allocator.cc:692] Sum Total of in-use chunks: 8.32GiB\nI tensorflow/core/common_runtime/bfc_allocator.cc:694] Stats:\nLimit:                 11353470976\nInUse:                  8930711040\nMaxInUse:              11319364608\nNumAllocs:                 1495009\nMaxAllocSize:           4804771072\nW tensorflow/core/common_runtime/bfc_allocator.cc:270] ****_____________*****_***********************************************xxxxxxxxxxxxxxxx\nW tensorflow/core/common_runtime/bfc_allocator.cc:271] Ran out of memory trying to allocate 1.75GiB.  See logs for memory state.\nW tensorflow/core/framework/op_kernel.cc:900] Resource exhausted: OOM when allocating tensor with shape[7,64,1024,1024]\nTraceback (most recent call last):\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 342, in \ntf.app.run()\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 30, in run\nsys.exit(main(sys.argv))\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 338, in main\ntrain()\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 256, in train\n_, loss_value, mse_value, mymse_value, logits_value, labels_value = sess.run([train_op, loss, mse, mymse, logits, labels])\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 340, in run\nrun_metadata_ptr)\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 564, in _run\nfeed_dict_string, options, run_metadata)\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 637, in _do_run\ntarget_list, options, run_metadata)\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 659, in _do_call\ne.code)\ntensorflow.python.framework.errors.ResourceExhaustedError: OOM when allocating tensor with shape[7,64,1024,1024]\n[[Node: tower_3/gradients/tower_3/pool1_grad/MaxPoolGrad = MaxPoolGrad[data_format=\"NHWC\", ksize=[1, 3, 3, 1], padding=\"SAME\", strides=[1, 2, 2, 1], _device=\"/job:localhost/replica:0/task:0/gpu:3\"](tower_3/conv1/conv1, tower_3/pool1, tower_3/gradients/tower_3/norm1_grad/LRNGrad/_2719)]]\n[[Node: tower_3/gradients/tower_3/conv1/BiasAdd_grad/tuple/control_dependency_1/_2721 = _Recvclient_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/gpu:3\", send_device_incarnation=1, tensor_name=\"edge_3317_tower_3/gradients/tower_3/conv1/BiasAdd_grad/tuple/control_dependency_1\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/cpu:0\"]]\nCaused by op u'tower_3/gradients/tower_3/pool1_grad/MaxPoolGrad', defined at:\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 342, in \ntf.app.run()\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 30, in run\nsys.exit(main(sys.argv))\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 338, in main\ntrain()\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 182, in train\ngrads = opt.compute_gradients(loss)\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/training/optimizer.py\", line 241, in compute_gradients\ncolocate_gradients_with_ops=colocate_gradients_with_ops)\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gradients.py\", line 481, in gradients\nin_grads = _AsList(grad_fn(op, *out_grads))\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/nn_grad.py\", line 251, in _MaxPoolGrad\ndata_format=op.get_attr(\"data_format\")\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gen_nn_ops.py\", line 710, in _max_pool_grad\ndata_format=data_format, name=name)\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/op_def_library.py\", line 655, in apply_op\nop_def=op_def)\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2154, in create_op\noriginal_op=self._default_original_op, op_def=op_def)\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1154, in init\nself._traceback = _extract_stack()\n...which was originally created as op u'tower_3/pool1', defined at:\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 342, in \ntf.app.run()\n[elided 1 identical lines from previous traceback]\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 338, in main\ntrain()\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 173, in train\nloss, mse, mymse, logits, labels = tower_loss(scope)\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 69, in tower_loss\nlogits = cnn.inference(images)\nFile \"/home/pmobade/project_latest/12july2016/grey/cnn.py\", line 184, in inference\npadding='SAME', name='pool1')\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/nn_ops.py\", line 341, in max_pool\nname=name)\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gen_nn_ops.py\", line 677, in _max_pool\ndata_format=data_format, name=name)\nFile \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/op_def_library.py\", line 655, in apply_op\nop_def=op_def)", "body": "Hello,\n\nI am using the GPU compatible version of TensorFlow 0.8, my system has 4 GPUs with approximately 12GB memory for each. I am running a CNN in TensorFlow for grey scale images (one channel images) whose size is 1024*1024, the total number of training images is 1520 and the batch size is 7, also this CNN has 64 feature maps for each convolutional layer. According to a variety of web pages talking about TensorFlow's memory issue I am using the BFC memory allocator in the session's configuration of my CNN. Unfortunately after around 10 epochs I am getting the \"ran out of memory error\", following is the error log, which doesn't make sense to me considering the batch size, image dimensions, and memory size of my GPU. Any help is appreciated.\n\n Error log:\n\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (256):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (512):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (1024):     Total Chunks: 1, Chunks in use: 0 1.8KiB allocated for chunks. 256B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (2048):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (4096):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (8192):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (16384):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (32768):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (65536):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (131072):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (262144):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (524288):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (1048576):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (2097152):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (4194304):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (8388608):     Total Chunks: 1, Chunks in use: 0 8.00MiB allocated for chunks. 400.0KiB client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (16777216):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (33554432):     Total Chunks: 1, Chunks in use: 0 36.53MiB allocated for chunks. 400.0KiB client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (67108864):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (134217728):     Total Chunks: 0, Chunks in use: 0 0B allocated for chunks. 0B client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:635] Bin (268435456):     Total Chunks: 2, Chunks in use: 0 2.21GiB allocated for chunks. 896.00MiB client-requested for chunks. 0B in use in bin. 0B client-requested in use in bin.\nI tensorflow/core/common_runtime/bfc_allocator.cc:652] Bin for 1.75GiB was 256.00MiB, Chunk State:\nI tensorflow/core/common_runtime/bfc_allocator.cc:658]   Size: 508.67MiB | Requested Size: 448.00MiB | in_use: 0, prev:   Size: 448.00MiB | Requested Size: 448.00MiB | in_use: 1, next:   Size: 1.75GiB | Requested Size: 1.75GiB | in_use: 1\nI tensorflow/core/common_runtime/bfc_allocator.cc:658]   Size: 1.72GiB | Requested Size: 448.00MiB | in_use: 0, prev:   Size: 448.00MiB | Requested Size: 448.00MiB | in_use: 1, next:   Size: 6.2KiB | Requested Size: 6.2KiB | in_use: 1\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80000 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80100 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80200 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80300 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80400 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80500 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80600 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80700 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80800 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80900 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80a00 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80b00 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80c00 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80d00 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80e00 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb80f00 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81000 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81100 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81200 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81300 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81400 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81500 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81600 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81700 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb81f00 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb82000 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb82100 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb82200 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb82300 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb82400 of size 256\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x230fb82500 of size 6400\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x231200b200 of size 29360128\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x231440b200 of size 469762048\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x239e15e100 of size 6400\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x239e15fa00 of size 469762048\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x23ba15fa00 of size 469762048\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x23f5e0b200 of size 1879048192\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x2465e0b200 of size 1879048192\nI tensorflow/core/common_runtime/bfc_allocator.cc:670] Chunk at 0x24d5e0b200 of size 3733947904\nI tensorflow/core/common_runtime/bfc_allocator.cc:679] Free at 0x230fb81800 of size 1792\nI tensorflow/core/common_runtime/bfc_allocator.cc:679] Free at 0x230fb83e00 of size 38302720\nI tensorflow/core/common_runtime/bfc_allocator.cc:679] Free at 0x2313c0b200 of size 8388608\nI tensorflow/core/common_runtime/bfc_allocator.cc:679] Free at 0x233040b200 of size 1842687744\nI tensorflow/core/common_runtime/bfc_allocator.cc:679] Free at 0x23d615fa00 of size 533379072\nI tensorflow/core/common_runtime/bfc_allocator.cc:685]      Summary of in-use Chunks by size:\nI tensorflow/core/common_runtime/bfc_allocator.cc:688] 30 Chunks of size 256 totalling 7.5KiB\nI tensorflow/core/common_runtime/bfc_allocator.cc:688] 2 Chunks of size 6400 totalling 12.5KiB\nI tensorflow/core/common_runtime/bfc_allocator.cc:688] 1 Chunks of size 29360128 totalling 28.00MiB\nI tensorflow/core/common_runtime/bfc_allocator.cc:688] 3 Chunks of size 469762048 totalling 1.31GiB\nI tensorflow/core/common_runtime/bfc_allocator.cc:688] 2 Chunks of size 1879048192 totalling 3.50GiB\nI tensorflow/core/common_runtime/bfc_allocator.cc:688] 1 Chunks of size 3733947904 totalling 3.48GiB\nI tensorflow/core/common_runtime/bfc_allocator.cc:692] Sum Total of in-use chunks: 8.32GiB\nI tensorflow/core/common_runtime/bfc_allocator.cc:694] Stats:\nLimit:                 11353470976\nInUse:                  8930711040\nMaxInUse:              11319364608\nNumAllocs:                 1495009\nMaxAllocSize:           4804771072\n\nW tensorflow/core/common_runtime/bfc_allocator.cc:270] ****_________________**_*****_____**_***********************************************xxxxxxxxxxxxxxxx\nW tensorflow/core/common_runtime/bfc_allocator.cc:271] Ran out of memory trying to allocate 1.75GiB.  See logs for memory state.\nW tensorflow/core/framework/op_kernel.cc:900] Resource exhausted: OOM when allocating tensor with shape[7,64,1024,1024]\nTraceback (most recent call last):\n  File \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 342, in <module>\n    tf.app.run()\n  File \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv))\n  File \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 338, in main\n    train()\n  File \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 256, in train\n    _, loss_value, mse_value, mymse_value, logits_value, labels_value = sess.run([train_op, loss, mse, mymse, logits, labels])\n  File \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 340, in run\n    run_metadata_ptr)\n  File \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 564, in _run\n    feed_dict_string, options, run_metadata)\n  File \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 637, in _do_run\n    target_list, options, run_metadata)\n  File \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/client/session.py\", line 659, in _do_call\n    e.code)\ntensorflow.python.framework.errors.ResourceExhaustedError: OOM when allocating tensor with shape[7,64,1024,1024]\n     [[Node: tower_3/gradients/tower_3/pool1_grad/MaxPoolGrad = MaxPoolGrad[data_format=\"NHWC\", ksize=[1, 3, 3, 1], padding=\"SAME\", strides=[1, 2, 2, 1], _device=\"/job:localhost/replica:0/task:0/gpu:3\"](tower_3/conv1/conv1, tower_3/pool1, tower_3/gradients/tower_3/norm1_grad/LRNGrad/_2719)]]\n     [[Node: tower_3/gradients/tower_3/conv1/BiasAdd_grad/tuple/control_dependency_1/_2721 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device=\"/job:localhost/replica:0/task:0/gpu:3\", send_device_incarnation=1, tensor_name=\"edge_3317_tower_3/gradients/tower_3/conv1/BiasAdd_grad/tuple/control_dependency_1\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/cpu:0\"]()]]\nCaused by op u'tower_3/gradients/tower_3/pool1_grad/MaxPoolGrad', defined at:\n  File \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 342, in <module>\n    tf.app.run()\n  File \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/platform/app.py\", line 30, in run\n    sys.exit(main(sys.argv))\n  File \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 338, in main\n    train()\n  File \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 182, in train\n    grads = opt.compute_gradients(loss)\n  File \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/training/optimizer.py\", line 241, in compute_gradients\n    colocate_gradients_with_ops=colocate_gradients_with_ops)\n  File \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gradients.py\", line 481, in gradients\n    in_grads = _AsList(grad_fn(op, *out_grads))\n  File \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/nn_grad.py\", line 251, in _MaxPoolGrad\n    data_format=op.get_attr(\"data_format\")\n  File \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gen_nn_ops.py\", line 710, in _max_pool_grad\n    data_format=data_format, name=name)\n  File \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/op_def_library.py\", line 655, in apply_op\n    op_def=op_def)\n  File \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2154, in create_op\n    original_op=self._default_original_op, op_def=op_def)\n  File \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1154, in __init__\n    self._traceback = _extract_stack()\n\n...which was originally created as op u'tower_3/pool1', defined at:\n  File \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 342, in <module>\n    tf.app.run()\n[elided 1 identical lines from previous traceback]\n  File \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 338, in main\n    train()\n  File \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 173, in train\n    loss, mse, mymse, logits, labels = tower_loss(scope)\n  File \"/home/pmobade/project_latest/12july2016/grey/cnn_multi_gpu_train.py\", line 69, in tower_loss\n    logits = cnn.inference(images)\n  File \"/home/pmobade/project_latest/12july2016/grey/cnn.py\", line 184, in inference\n    padding='SAME', name='pool1')\n  File \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/nn_ops.py\", line 341, in max_pool\n    name=name)\n  File \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gen_nn_ops.py\", line 677, in _max_pool\n    data_format=data_format, name=name)\n  File \"/home/pmobade/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/op_def_library.py\", line 655, in apply_op\n    op_def=op_def)\n"}