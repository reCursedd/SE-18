{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/294473886", "html_url": "https://github.com/tensorflow/tensorflow/issues/8905#issuecomment-294473886", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8905", "id": 294473886, "node_id": "MDEyOklzc3VlQ29tbWVudDI5NDQ3Mzg4Ng==", "user": {"login": "Bihaqo", "id": 5630697, "node_id": "MDQ6VXNlcjU2MzA2OTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/5630697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Bihaqo", "html_url": "https://github.com/Bihaqo", "followers_url": "https://api.github.com/users/Bihaqo/followers", "following_url": "https://api.github.com/users/Bihaqo/following{/other_user}", "gists_url": "https://api.github.com/users/Bihaqo/gists{/gist_id}", "starred_url": "https://api.github.com/users/Bihaqo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Bihaqo/subscriptions", "organizations_url": "https://api.github.com/users/Bihaqo/orgs", "repos_url": "https://api.github.com/users/Bihaqo/repos", "events_url": "https://api.github.com/users/Bihaqo/events{/privacy}", "received_events_url": "https://api.github.com/users/Bihaqo/received_events", "type": "User", "site_admin": false}, "created_at": "2017-04-17T12:15:58Z", "updated_at": "2017-04-17T12:15:58Z", "author_association": "CONTRIBUTOR", "body_html": "<p>As a temporary workaround I replaced tf.svd with np.linalg.svd via tf.py_func module. It's really slow though.</p>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">def</span> <span class=\"pl-en\">replace_tf_svd_with_np_svd</span>():\n  <span class=\"pl-s\"><span class=\"pl-pds\">\"\"\"</span>Replaces tf.svd with np.svd. Slow, but a workaround for tf.svd bugs.</span>\n<span class=\"pl-s\">  For details see</span>\n<span class=\"pl-s\">  https://github.com/tensorflow/tensorflow/issues/8905</span>\n<span class=\"pl-s\">  <span class=\"pl-pds\">\"\"\"</span></span>\n  <span class=\"pl-k\">if</span> <span class=\"pl-c1\">hasattr</span>(tf, <span class=\"pl-s\"><span class=\"pl-pds\">'</span>original_svd<span class=\"pl-pds\">'</span></span>):\n    <span class=\"pl-c\"><span class=\"pl-c\">#</span> This function has been already called and tf.svd is already replaced.</span>\n    <span class=\"pl-k\">return</span>\n  tf.original_svd <span class=\"pl-k\">=</span> tf.svd\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">my_svd</span>(<span class=\"pl-smi\">tensor</span>, <span class=\"pl-smi\">full_matrices</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">False</span>, <span class=\"pl-smi\">compute_uv</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>):\n    dtype <span class=\"pl-k\">=</span> tensor.dtype\n    u, s, v <span class=\"pl-k\">=</span> tf.py_func(np.linalg.svd, [tensor, full_matrices, compute_uv],\n                         [dtype, dtype, dtype])\n    s_, u_, v_ <span class=\"pl-k\">=</span> tf.original_svd(tensor, full_matrices, compute_uv)\n    s <span class=\"pl-k\">=</span> tf.reshape(s, s_.get_shape())\n    u <span class=\"pl-k\">=</span> tf.reshape(u, u_.get_shape())\n    v <span class=\"pl-k\">=</span> tf.reshape(v, v_.get_shape())\n    <span class=\"pl-c\"><span class=\"pl-c\">#</span> Converting numpy order of v dims to TF order.</span>\n    order <span class=\"pl-k\">=</span> <span class=\"pl-c1\">range</span>(tensor.get_shape().ndims)\n    order[<span class=\"pl-k\">-</span><span class=\"pl-c1\">2</span>], order[<span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>] <span class=\"pl-k\">=</span> order[<span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>], order[<span class=\"pl-k\">-</span><span class=\"pl-c1\">2</span>]\n    v <span class=\"pl-k\">=</span> tf.transpose(v, order)\n    <span class=\"pl-k\">return</span> s, u, v\n\n  tf.svd <span class=\"pl-k\">=</span> my_svd</pre></div>", "body_text": "As a temporary workaround I replaced tf.svd with np.linalg.svd via tf.py_func module. It's really slow though.\ndef replace_tf_svd_with_np_svd():\n  \"\"\"Replaces tf.svd with np.svd. Slow, but a workaround for tf.svd bugs.\n  For details see\n  https://github.com/tensorflow/tensorflow/issues/8905\n  \"\"\"\n  if hasattr(tf, 'original_svd'):\n    # This function has been already called and tf.svd is already replaced.\n    return\n  tf.original_svd = tf.svd\n\n  def my_svd(tensor, full_matrices=False, compute_uv=True):\n    dtype = tensor.dtype\n    u, s, v = tf.py_func(np.linalg.svd, [tensor, full_matrices, compute_uv],\n                         [dtype, dtype, dtype])\n    s_, u_, v_ = tf.original_svd(tensor, full_matrices, compute_uv)\n    s = tf.reshape(s, s_.get_shape())\n    u = tf.reshape(u, u_.get_shape())\n    v = tf.reshape(v, v_.get_shape())\n    # Converting numpy order of v dims to TF order.\n    order = range(tensor.get_shape().ndims)\n    order[-2], order[-1] = order[-1], order[-2]\n    v = tf.transpose(v, order)\n    return s, u, v\n\n  tf.svd = my_svd", "body": "As a temporary workaround I replaced tf.svd with np.linalg.svd via tf.py_func module. It's really slow though.\r\n\r\n```Python\r\ndef replace_tf_svd_with_np_svd():\r\n  \"\"\"Replaces tf.svd with np.svd. Slow, but a workaround for tf.svd bugs.\r\n  For details see\r\n  https://github.com/tensorflow/tensorflow/issues/8905\r\n  \"\"\"\r\n  if hasattr(tf, 'original_svd'):\r\n    # This function has been already called and tf.svd is already replaced.\r\n    return\r\n  tf.original_svd = tf.svd\r\n\r\n  def my_svd(tensor, full_matrices=False, compute_uv=True):\r\n    dtype = tensor.dtype\r\n    u, s, v = tf.py_func(np.linalg.svd, [tensor, full_matrices, compute_uv],\r\n                         [dtype, dtype, dtype])\r\n    s_, u_, v_ = tf.original_svd(tensor, full_matrices, compute_uv)\r\n    s = tf.reshape(s, s_.get_shape())\r\n    u = tf.reshape(u, u_.get_shape())\r\n    v = tf.reshape(v, v_.get_shape())\r\n    # Converting numpy order of v dims to TF order.\r\n    order = range(tensor.get_shape().ndims)\r\n    order[-2], order[-1] = order[-1], order[-2]\r\n    v = tf.transpose(v, order)\r\n    return s, u, v\r\n\r\n  tf.svd = my_svd\r\n```"}