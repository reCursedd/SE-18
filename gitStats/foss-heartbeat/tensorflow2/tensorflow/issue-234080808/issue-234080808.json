{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10478", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10478/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10478/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10478/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/10478", "id": 234080808, "node_id": "MDU6SXNzdWUyMzQwODA4MDg=", "number": 10478, "title": "tfdbg error when stepping through a graph that uses tf.train.shuffle_batch", "user": {"login": "ed-alertedh", "id": 24605895, "node_id": "MDQ6VXNlcjI0NjA1ODk1", "avatar_url": "https://avatars1.githubusercontent.com/u/24605895?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ed-alertedh", "html_url": "https://github.com/ed-alertedh", "followers_url": "https://api.github.com/users/ed-alertedh/followers", "following_url": "https://api.github.com/users/ed-alertedh/following{/other_user}", "gists_url": "https://api.github.com/users/ed-alertedh/gists{/gist_id}", "starred_url": "https://api.github.com/users/ed-alertedh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ed-alertedh/subscriptions", "organizations_url": "https://api.github.com/users/ed-alertedh/orgs", "repos_url": "https://api.github.com/users/ed-alertedh/repos", "events_url": "https://api.github.com/users/ed-alertedh/events{/privacy}", "received_events_url": "https://api.github.com/users/ed-alertedh/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "caisq", "id": 16824702, "node_id": "MDQ6VXNlcjE2ODI0NzAy", "avatar_url": "https://avatars2.githubusercontent.com/u/16824702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/caisq", "html_url": "https://github.com/caisq", "followers_url": "https://api.github.com/users/caisq/followers", "following_url": "https://api.github.com/users/caisq/following{/other_user}", "gists_url": "https://api.github.com/users/caisq/gists{/gist_id}", "starred_url": "https://api.github.com/users/caisq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/caisq/subscriptions", "organizations_url": "https://api.github.com/users/caisq/orgs", "repos_url": "https://api.github.com/users/caisq/repos", "events_url": "https://api.github.com/users/caisq/events{/privacy}", "received_events_url": "https://api.github.com/users/caisq/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "caisq", "id": 16824702, "node_id": "MDQ6VXNlcjE2ODI0NzAy", "avatar_url": "https://avatars2.githubusercontent.com/u/16824702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/caisq", "html_url": "https://github.com/caisq", "followers_url": "https://api.github.com/users/caisq/followers", "following_url": "https://api.github.com/users/caisq/following{/other_user}", "gists_url": "https://api.github.com/users/caisq/gists{/gist_id}", "starred_url": "https://api.github.com/users/caisq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/caisq/subscriptions", "organizations_url": "https://api.github.com/users/caisq/orgs", "repos_url": "https://api.github.com/users/caisq/repos", "events_url": "https://api.github.com/users/caisq/events{/privacy}", "received_events_url": "https://api.github.com/users/caisq/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 14, "created_at": "2017-06-07T03:14:35Z", "updated_at": "2018-02-07T14:30:48Z", "closed_at": "2018-02-07T14:24:42Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: Yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Linux Ubuntu 17.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: Binary</li>\n<li><strong>TensorFlow version (use command below)</strong>: v1.2.0-rc1-24-gce1d6ec 1.2.0-rc2<br>\n(I also got the same error with tf 1.1.0)</li>\n<li><strong>Bazel version (if compiling from source)</strong>: N/A</li>\n<li><strong>CUDA/cuDNN version</strong>: CUDA 8.0, cuDNN 5.1</li>\n<li><strong>GPU model and memory</strong>: Nvidia GTX 1060</li>\n<li><strong>Exact command to reproduce</strong>:<br>\nThe following code will start a tfdbg session. Inside this session, enter these commands to get the error:<br>\ntfdbg&gt; invoke_stepper<br>\ntfdbg&gt; s<br>\ntfdbg&gt; s<br>\ntfdbg&gt; s</li>\n</ul>\n<pre><code>import tensorflow as tf\nfrom tensorflow.python import debug as tf_debug\n\ndef read_records(filename_queue, enqueue_many_size=1024):\n    reader = tf.TFRecordReader()\n    _, queue_batch = reader.read_up_to(filename_queue, enqueue_many_size)\n    return queue_batch\n\ndef input_batch(filenames, batch_size, num_epochs, min_after_dequeue=128, num_threads=8):\n    filename_queue = tf.train.string_input_producer(filenames, num_epochs=num_epochs)\n    queue_batch = read_records(filename_queue)\n\n    capacity = min_after_dequeue + (num_threads + 3) * batch_size\n    batch_serialized_example = tf.train.shuffle_batch(\n        [queue_batch],\n        batch_size=batch_size,\n        num_threads=num_threads,\n        capacity=capacity,\n        min_after_dequeue=min_after_dequeue,\n        enqueue_many=True)\n\n    return batch_serialized_example\n\nb = input_batch(['test_filename'], 32, 5)\nsess = tf_debug.LocalCLIDebugWrapperSession(tf.Session())\nsess.run(b)\n</code></pre>\n<h3>Describe the problem</h3>\n<p>tfdbg seemingly cannot step through a graph that uses tf.train.shuffle_batch. I cannot work around it by \"stepping over\" the node using step -t either.</p>\n<h3>Source code / logs</h3>\n<p>Running the code provided above and stepping through the graph produces this stack trace. In a real graph, the error stops me from stepping any further. I worked out from looking at types_pb2.py that the value 20 is DT_RESOURCE. It seems like the error is triggered when tfdbg tries to convert this datatype to a numpy array.</p>\n<pre><code>--- Node Stepper: run #1: 1 fetch (shuffle_batch:0); 0 feeds ------\n| &lt;-- --&gt; | s\nError occurred during handling of command: step :\n&lt;class 'KeyError'&gt;: 20                                                                                                                                                                                    UP\n\nTraceback (most recent call last):\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/debug/cli/debugger_cli_common.py\", line 664, in dispatch_command\n    output = handler(argv, screen_info=screen_info)\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/debug/cli/stepper_cli.py\", line 487, in step\n    screen_output = self.cont([self._sorted_nodes[self._next]], screen_info)\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/debug/cli/stepper_cli.py\", line 397, in cont\n    restore_variable_values=parsed.restore_variable_values)\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/debug/lib/stepper.py\", line 679, in cont\n    options=run_options)\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 789, in run\n    run_metadata_ptr)\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 952, in _run\n    subfeed_dtype = subfeed_t.dtype.as_numpy_dtype\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py\", line 122, in as_numpy_dtype\n    return _TF_TO_NP[self._type_enum]\nKeyError: 20\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 17.04\nTensorFlow installed from (source or binary): Binary\nTensorFlow version (use command below): v1.2.0-rc1-24-gce1d6ec 1.2.0-rc2\n(I also got the same error with tf 1.1.0)\nBazel version (if compiling from source): N/A\nCUDA/cuDNN version: CUDA 8.0, cuDNN 5.1\nGPU model and memory: Nvidia GTX 1060\nExact command to reproduce:\nThe following code will start a tfdbg session. Inside this session, enter these commands to get the error:\ntfdbg> invoke_stepper\ntfdbg> s\ntfdbg> s\ntfdbg> s\n\nimport tensorflow as tf\nfrom tensorflow.python import debug as tf_debug\n\ndef read_records(filename_queue, enqueue_many_size=1024):\n    reader = tf.TFRecordReader()\n    _, queue_batch = reader.read_up_to(filename_queue, enqueue_many_size)\n    return queue_batch\n\ndef input_batch(filenames, batch_size, num_epochs, min_after_dequeue=128, num_threads=8):\n    filename_queue = tf.train.string_input_producer(filenames, num_epochs=num_epochs)\n    queue_batch = read_records(filename_queue)\n\n    capacity = min_after_dequeue + (num_threads + 3) * batch_size\n    batch_serialized_example = tf.train.shuffle_batch(\n        [queue_batch],\n        batch_size=batch_size,\n        num_threads=num_threads,\n        capacity=capacity,\n        min_after_dequeue=min_after_dequeue,\n        enqueue_many=True)\n\n    return batch_serialized_example\n\nb = input_batch(['test_filename'], 32, 5)\nsess = tf_debug.LocalCLIDebugWrapperSession(tf.Session())\nsess.run(b)\n\nDescribe the problem\ntfdbg seemingly cannot step through a graph that uses tf.train.shuffle_batch. I cannot work around it by \"stepping over\" the node using step -t either.\nSource code / logs\nRunning the code provided above and stepping through the graph produces this stack trace. In a real graph, the error stops me from stepping any further. I worked out from looking at types_pb2.py that the value 20 is DT_RESOURCE. It seems like the error is triggered when tfdbg tries to convert this datatype to a numpy array.\n--- Node Stepper: run #1: 1 fetch (shuffle_batch:0); 0 feeds ------\n| <-- --> | s\nError occurred during handling of command: step :\n<class 'KeyError'>: 20                                                                                                                                                                                    UP\n\nTraceback (most recent call last):\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/debug/cli/debugger_cli_common.py\", line 664, in dispatch_command\n    output = handler(argv, screen_info=screen_info)\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/debug/cli/stepper_cli.py\", line 487, in step\n    screen_output = self.cont([self._sorted_nodes[self._next]], screen_info)\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/debug/cli/stepper_cli.py\", line 397, in cont\n    restore_variable_values=parsed.restore_variable_values)\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/debug/lib/stepper.py\", line 679, in cont\n    options=run_options)\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 789, in run\n    run_metadata_ptr)\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 952, in _run\n    subfeed_dtype = subfeed_t.dtype.as_numpy_dtype\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py\", line 122, in as_numpy_dtype\n    return _TF_TO_NP[self._type_enum]\nKeyError: 20", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: Yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Ubuntu 17.04\r\n- **TensorFlow installed from (source or binary)**: Binary\r\n- **TensorFlow version (use command below)**: v1.2.0-rc1-24-gce1d6ec 1.2.0-rc2\r\n(I also got the same error with tf 1.1.0)\r\n- **Bazel version (if compiling from source)**: N/A\r\n- **CUDA/cuDNN version**: CUDA 8.0, cuDNN 5.1\r\n- **GPU model and memory**: Nvidia GTX 1060\r\n- **Exact command to reproduce**:\r\nThe following code will start a tfdbg session. Inside this session, enter these commands to get the error:\r\ntfdbg> invoke_stepper\r\ntfdbg> s\r\ntfdbg> s\r\ntfdbg> s\r\n```\r\nimport tensorflow as tf\r\nfrom tensorflow.python import debug as tf_debug\r\n\r\ndef read_records(filename_queue, enqueue_many_size=1024):\r\n    reader = tf.TFRecordReader()\r\n    _, queue_batch = reader.read_up_to(filename_queue, enqueue_many_size)\r\n    return queue_batch\r\n\r\ndef input_batch(filenames, batch_size, num_epochs, min_after_dequeue=128, num_threads=8):\r\n    filename_queue = tf.train.string_input_producer(filenames, num_epochs=num_epochs)\r\n    queue_batch = read_records(filename_queue)\r\n\r\n    capacity = min_after_dequeue + (num_threads + 3) * batch_size\r\n    batch_serialized_example = tf.train.shuffle_batch(\r\n        [queue_batch],\r\n        batch_size=batch_size,\r\n        num_threads=num_threads,\r\n        capacity=capacity,\r\n        min_after_dequeue=min_after_dequeue,\r\n        enqueue_many=True)\r\n\r\n    return batch_serialized_example\r\n\r\nb = input_batch(['test_filename'], 32, 5)\r\nsess = tf_debug.LocalCLIDebugWrapperSession(tf.Session())\r\nsess.run(b)\r\n```\r\n\r\n### Describe the problem\r\ntfdbg seemingly cannot step through a graph that uses tf.train.shuffle_batch. I cannot work around it by \"stepping over\" the node using step -t either.\r\n\r\n### Source code / logs\r\nRunning the code provided above and stepping through the graph produces this stack trace. In a real graph, the error stops me from stepping any further. I worked out from looking at types_pb2.py that the value 20 is DT_RESOURCE. It seems like the error is triggered when tfdbg tries to convert this datatype to a numpy array.\r\n\r\n```\r\n--- Node Stepper: run #1: 1 fetch (shuffle_batch:0); 0 feeds ------\r\n| <-- --> | s\r\nError occurred during handling of command: step :\r\n<class 'KeyError'>: 20                                                                                                                                                                                    UP\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/debug/cli/debugger_cli_common.py\", line 664, in dispatch_command\r\n    output = handler(argv, screen_info=screen_info)\r\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/debug/cli/stepper_cli.py\", line 487, in step\r\n    screen_output = self.cont([self._sorted_nodes[self._next]], screen_info)\r\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/debug/cli/stepper_cli.py\", line 397, in cont\r\n    restore_variable_values=parsed.restore_variable_values)\r\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/debug/lib/stepper.py\", line 679, in cont\r\n    options=run_options)\r\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 789, in run\r\n    run_metadata_ptr)\r\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/client/session.py\", line 952, in _run\r\n    subfeed_dtype = subfeed_t.dtype.as_numpy_dtype\r\n  File \"/home/ed/.pyenv/versions/neda/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py\", line 122, in as_numpy_dtype\r\n    return _TF_TO_NP[self._type_enum]\r\nKeyError: 20\r\n```\r\n"}