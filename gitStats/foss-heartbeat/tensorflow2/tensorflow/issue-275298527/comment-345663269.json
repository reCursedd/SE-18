{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/345663269", "html_url": "https://github.com/tensorflow/tensorflow/issues/14713#issuecomment-345663269", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/14713", "id": 345663269, "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTY2MzI2OQ==", "user": {"login": "jmaye", "id": 2109115, "node_id": "MDQ6VXNlcjIxMDkxMTU=", "avatar_url": "https://avatars2.githubusercontent.com/u/2109115?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jmaye", "html_url": "https://github.com/jmaye", "followers_url": "https://api.github.com/users/jmaye/followers", "following_url": "https://api.github.com/users/jmaye/following{/other_user}", "gists_url": "https://api.github.com/users/jmaye/gists{/gist_id}", "starred_url": "https://api.github.com/users/jmaye/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jmaye/subscriptions", "organizations_url": "https://api.github.com/users/jmaye/orgs", "repos_url": "https://api.github.com/users/jmaye/repos", "events_url": "https://api.github.com/users/jmaye/events{/privacy}", "received_events_url": "https://api.github.com/users/jmaye/received_events", "type": "User", "site_admin": false}, "created_at": "2017-11-20T11:03:00Z", "updated_at": "2017-11-20T11:05:45Z", "author_association": "NONE", "body_html": "<p>Thanks for the hint, I'll try it as soon as possible. What I just implemented:</p>\n<p>def model_fn():<br>\n....<br>\nvar_to_restore = []<br>\nfor var in tf.trainable_variables():<br>\nif var.name.startswith('my_var'):<br>\nvar_to_restore.append(var)</p>\n<pre><code>checkpoint_state = tf.train.get_checkpoint_state('pretrained')\ninput_checkpoint = checkpoint_state.model_checkpoint_path\npretrain_saver = tf.train.Saver(var_to_restore)\n\ndef init_fn(scaffold, session):\n    pretrain_saver.restore(session, input_checkpoint)\n\nscaffold = tf.train.Scaffold(init_fn=init_fn)\n\nreturn tf.estimator.EstimatorSpec(\n    mode=mode,\n    predictions=predictions,\n    loss=loss,\n    train_op=train_op,\n    eval_metric_ops=metrics,\n    scaffold=scaffold)\n</code></pre>\n<p>Let's see whether this works too. But anyway, this requires more documentation or examples. Even a simpler interface, because this seems to me like a basic use.</p>", "body_text": "Thanks for the hint, I'll try it as soon as possible. What I just implemented:\ndef model_fn():\n....\nvar_to_restore = []\nfor var in tf.trainable_variables():\nif var.name.startswith('my_var'):\nvar_to_restore.append(var)\ncheckpoint_state = tf.train.get_checkpoint_state('pretrained')\ninput_checkpoint = checkpoint_state.model_checkpoint_path\npretrain_saver = tf.train.Saver(var_to_restore)\n\ndef init_fn(scaffold, session):\n    pretrain_saver.restore(session, input_checkpoint)\n\nscaffold = tf.train.Scaffold(init_fn=init_fn)\n\nreturn tf.estimator.EstimatorSpec(\n    mode=mode,\n    predictions=predictions,\n    loss=loss,\n    train_op=train_op,\n    eval_metric_ops=metrics,\n    scaffold=scaffold)\n\nLet's see whether this works too. But anyway, this requires more documentation or examples. Even a simpler interface, because this seems to me like a basic use.", "body": "Thanks for the hint, I'll try it as soon as possible. What I just implemented:\r\n\r\ndef model_fn():\r\n    ....\r\n    var_to_restore = []\r\n    for var in tf.trainable_variables():\r\n        if var.name.startswith('my_var'):\r\n            var_to_restore.append(var)\r\n\r\n    checkpoint_state = tf.train.get_checkpoint_state('pretrained')\r\n    input_checkpoint = checkpoint_state.model_checkpoint_path\r\n    pretrain_saver = tf.train.Saver(var_to_restore)\r\n\r\n    def init_fn(scaffold, session):\r\n        pretrain_saver.restore(session, input_checkpoint)\r\n\r\n    scaffold = tf.train.Scaffold(init_fn=init_fn)\r\n\r\n    return tf.estimator.EstimatorSpec(\r\n        mode=mode,\r\n        predictions=predictions,\r\n        loss=loss,\r\n        train_op=train_op,\r\n        eval_metric_ops=metrics,\r\n        scaffold=scaffold)\r\n\r\nLet's see whether this works too. But anyway, this requires more documentation or examples. Even a simpler interface, because this seems to me like a basic use."}