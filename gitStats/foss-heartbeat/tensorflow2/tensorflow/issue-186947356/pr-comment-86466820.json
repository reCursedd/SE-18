{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/86466820", "pull_request_review_id": 7126052, "id": 86466820, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDg2NDY2ODIw", "diff_hunk": "@@ -0,0 +1,384 @@\n+enable_testing()\n+\n+#\n+# get a temp path for test data\n+#\n+function(GetTestRunPath VAR_NAME OBJ_NAME)\n+    if(WIN32) \n+      if(DEFINED ENV{TMP}) \n+        set(TMPDIR \"$ENV{TMP}\")\n+      elseif(DEFINED ENV{TEMP})\n+        set(TMPDIR \"$ENV{TEMP}\")\n+      endif()\n+      string(REPLACE \"\\\\\" \"/\" TMPDIR ${TMPDIR})\n+    else() \n+      set(TMPDIR \"$ENV{TMPDIR}\") \n+    endif() \n+    if(NOT EXISTS \"${TMPDIR}\")\n+       message(FATAL_ERROR \"Unable to determine a path to the temporary directory\")\n+    endif()\n+    set(${VAR_NAME} \"${TMPDIR}/${OBJ_NAME}\" PARENT_SCOPE)\n+endfunction(GetTestRunPath)\n+\n+#\n+# create test for each source\n+#\n+function(AddTests)\n+  cmake_parse_arguments(_AT \"\" \"\" \"SOURCES;OBJECTS;LIBS;DATA;DEPENDS\" ${ARGN})\n+  foreach(sourcefile ${_AT_SOURCES})\n+    string(REPLACE \"${tensorflow_source_dir}/\" \"\" exename ${sourcefile})\n+    string(REPLACE \".cc\" \"\" exename ${exename})\n+    string(REPLACE \"/\" \"_\" exename ${exename})\n+    AddTest(\n+      TARGET ${exename}\n+      SOURCES ${sourcefile}\n+      OBJECTS ${_AT_OBJECTS}\n+      LIBS ${_AT_LIBS}\n+      DATA ${_AT_DATA}\n+      DEPENDS ${_AT_DEPENDS}\n+    )\n+  endforeach()\n+endfunction(AddTests)\n+\n+#\n+# create once test\n+#\n+function(AddTest)\n+  cmake_parse_arguments(_AT \"\" \"TARGET\" \"SOURCES;OBJECTS;LIBS;DATA;DEPENDS\" ${ARGN})\n+  \n+  list(REMOVE_DUPLICATES _AT_SOURCES)\n+  list(REMOVE_DUPLICATES _AT_OBJECTS)\n+  list(REMOVE_DUPLICATES _AT_LIBS)\n+  if (_AT_DATA)\n+    list(REMOVE_DUPLICATES _AT_DATA)\n+  endif(_AT_DATA)\n+  if (_AT_DEPENDS)\n+    list(REMOVE_DUPLICATES _AT_DEPENDS)\n+  endif(_AT_DEPENDS)\n+  \n+  add_executable(${_AT_TARGET} ${_AT_SOURCES} ${_AT_OBJECTS})\n+  target_link_libraries(${_AT_TARGET} ${_AT_LIBS})\n+\n+  GetTestRunPath(testdir ${_AT_TARGET})\n+  set(tempdir \"${testdir}/tmp\")\n+  file(REMOVE_RECURSE \"${testdir}\")\n+  file(MAKE_DIRECTORY \"${testdir}\")\n+  file(MAKE_DIRECTORY \"${tempdir}\")\n+  add_test(NAME ${_AT_TARGET} COMMAND ${_AT_TARGET} WORKING_DIRECTORY \"${testdir}\")\n+  set_tests_properties(${_AT_TARGET}\n+    PROPERTIES ENVIRONMENT \"TEST_TMPDIR=${tempdir};TEST_SRCDIR=${testdir}\"\n+  )\n+\n+  foreach(datafile ${_AT_DATA})\n+    add_custom_command(\n+      TARGET ${_AT_TARGET} POST_BUILD\n+      COMMAND ${CMAKE_COMMAND} -E copy\n+             \"${CMAKE_CURRENT_SOURCE_DIR}/${datafile}\"\n+             \"${testdir}/${datafile}\"\n+      DEPENDS \"${CMAKE_CURRENT_SOURCE_DIR}/${datafile}\"\n+    )\n+  endforeach()\n+\n+  if (_AT_DEPENDS)\n+    add_dependencies(${_AT_TARGET} ${_AT_DEPENDS})\n+  endif()\n+endfunction(AddTest)\n+\n+#\n+# create python test for each script\n+#\n+function(AddPythonTests)\n+  cmake_parse_arguments(_AT \"\" \"\" \"SOURCES;DATA;DEPENDS\" ${ARGN})\n+  list(REMOVE_DUPLICATES _AT_SOURCES)\n+  if (_AT_DATA)\n+    list(REMOVE_DUPLICATES _AT_DATA)\n+  endif(_AT_DATA)\n+  if (_AT_DEPENDS)\n+    list(REMOVE_DUPLICATES _AT_DEPENDS)\n+  endif(_AT_DEPENDS)\n+  \n+  foreach(sourcefile ${_AT_SOURCES})\n+    add_test(NAME ${sourcefile} COMMAND python ${sourcefile})", "path": "tensorflow/contrib/cmake/tf_tests.cmake", "position": null, "original_position": 101, "commit_id": "55dfdde7d5945f4bc8276969f1ac590b4d857f40", "original_commit_id": "fff3e39e586c92cd08372623166552999a96f904", "user": {"login": "gunan", "id": 7946809, "node_id": "MDQ6VXNlcjc5NDY4MDk=", "avatar_url": "https://avatars3.githubusercontent.com/u/7946809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gunan", "html_url": "https://github.com/gunan", "followers_url": "https://api.github.com/users/gunan/followers", "following_url": "https://api.github.com/users/gunan/following{/other_user}", "gists_url": "https://api.github.com/users/gunan/gists{/gist_id}", "starred_url": "https://api.github.com/users/gunan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gunan/subscriptions", "organizations_url": "https://api.github.com/users/gunan/orgs", "repos_url": "https://api.github.com/users/gunan/repos", "events_url": "https://api.github.com/users/gunan/events{/privacy}", "received_events_url": "https://api.github.com/users/gunan/received_events", "type": "User", "site_admin": false}, "body": "Instead of directly calling Python, can we use a variable to define which python binary to use?\nLike here:\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/cmake/tf_core_framework.cmake#L181\n\nin Anaconda3 installations python binary location did not end up in PATH. I think this will be more convenient, as it is the same way we are doing for cmake itself.\n", "created_at": "2016-11-03T23:44:54Z", "updated_at": "2016-11-04T02:49:37Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/5364#discussion_r86466820", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/5364", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/86466820"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/5364#discussion_r86466820"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/5364"}}, "body_html": "<p>Instead of directly calling Python, can we use a variable to define which python binary to use?<br>\nLike here:<br>\n<a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/cmake/tf_core_framework.cmake#L181\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/cmake/tf_core_framework.cmake#L181</a></p>\n<p>in Anaconda3 installations python binary location did not end up in PATH. I think this will be more convenient, as it is the same way we are doing for cmake itself.</p>", "body_text": "Instead of directly calling Python, can we use a variable to define which python binary to use?\nLike here:\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/cmake/tf_core_framework.cmake#L181\nin Anaconda3 installations python binary location did not end up in PATH. I think this will be more convenient, as it is the same way we are doing for cmake itself."}