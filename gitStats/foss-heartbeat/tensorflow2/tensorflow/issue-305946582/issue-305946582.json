{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17769", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17769/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17769/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/17769/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/17769", "id": 305946582, "node_id": "MDU6SXNzdWUzMDU5NDY1ODI=", "number": 17769, "title": "SSD Resnet50 FPN ValueError: Dimensions must be equal", "user": {"login": "UndeadBlow", "id": 2891003, "node_id": "MDQ6VXNlcjI4OTEwMDM=", "avatar_url": "https://avatars3.githubusercontent.com/u/2891003?v=4", "gravatar_id": "", "url": "https://api.github.com/users/UndeadBlow", "html_url": "https://github.com/UndeadBlow", "followers_url": "https://api.github.com/users/UndeadBlow/followers", "following_url": "https://api.github.com/users/UndeadBlow/following{/other_user}", "gists_url": "https://api.github.com/users/UndeadBlow/gists{/gist_id}", "starred_url": "https://api.github.com/users/UndeadBlow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/UndeadBlow/subscriptions", "organizations_url": "https://api.github.com/users/UndeadBlow/orgs", "repos_url": "https://api.github.com/users/UndeadBlow/repos", "events_url": "https://api.github.com/users/UndeadBlow/events{/privacy}", "received_events_url": "https://api.github.com/users/UndeadBlow/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-03-16T14:22:37Z", "updated_at": "2018-03-16T14:29:17Z", "closed_at": "2018-03-16T14:29:17Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: custom .config file, see below</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Linux Ubuntu 16.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: source</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.7-rc0 and also tried on 1.6</li>\n<li><strong>Python version</strong>: Tried 2.7 and 3.5</li>\n<li><strong>Bazel version (if compiling from source)</strong>: 0.11.1</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: gcc (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609</li>\n<li><strong>CUDA/cuDNN version</strong>: 8.0 / 6.0</li>\n<li><strong>GPU model and memory</strong>: GeForce GTX 1060 6GB</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<pre><code>python3 object_detection/train.py \\\n    --pipeline_config_path=object_detection/samples/ssd_resnet_50_fpn_drone.config \\\n    --train_dir=object_detection/drone \\\n    --num_clones=1\n</code></pre>\n<p>When I'm trying to run test FPN config from model_builder_test.py (see attach), I'm getting error:</p>\n<pre><code>WARNING:tensorflow:From /usr/local/lib/python3.5/dist-packages/tensorflow/contrib/learn/python/learn/datasets/base.py:198: retry (from tensorflow.contrib.learn.python.learn.datasets.base) is deprecated and will be removed in a future version.\nInstructions for updating:\nUse the retry module or similar alternatives.\nWARNING:tensorflow:From /home/undead/reps/tf_models/object_detection/trainer.py:228: create_global_step (from tensorflow.contrib.framework.python.ops.variables) is deprecated and will be removed in a future version.\nInstructions for updating:\nPlease switch to tf.train.create_global_step\nTraceback (most recent call last):\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/common_shapes.py\", line 686, in _call_cpp_shape_fn_impl\n    input_tensors_as_shapes, status)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/errors_impl.py\", line 516, in __exit__\n    c_api.TF_GetCode(self.status.status))\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Dimensions must be equal, but are 6 and 5 for 'FeatureExtractor/fpn/top_down_features/add' (op: 'Add') with input shapes: [4,6,6,256], [4,5,5,256].\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"object_detection/train.py\", line 167, in &lt;module&gt;\n    tf.app.run()\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/platform/app.py\", line 126, in run\n    _sys.exit(main(argv))\n  File \"object_detection/train.py\", line 163, in main\n    worker_job_name, is_chief, FLAGS.train_dir)\n  File \"/home/undead/reps/tf_models/object_detection/trainer.py\", line 246, in train\n    clones = model_deploy.create_clones(deploy_config, model_fn, [input_queue])\n  File \"/home/undead/reps/tf_models/slim/deployment/model_deploy.py\", line 193, in create_clones\n    outputs = model_fn(*args, **kwargs)\n  File \"/home/undead/reps/tf_models/object_detection/trainer.py\", line 179, in _create_losses\n    prediction_dict = detection_model.predict(images, true_image_shapes)\n  File \"/home/undead/reps/tf_models/object_detection/meta_architectures/ssd_meta_arch.py\", line 350, in predict\n    preprocessed_inputs)\n  File \"/home/undead/reps/tf_models/object_detection/models/ssd_resnet_v1_fpn_feature_extractor.py\", line 164, in extract_features\n    scope='top_down_features')\n  File \"/home/undead/reps/tf_models/object_detection/models/feature_map_generators.py\", line 217, in fpn_top_down_feature_maps\n    top_down = 0.5 * top_down + 0.5 * residual\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/ops/math_ops.py\", line 971, in binary_op_wrapper\n    return func(x, y, name=name)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/ops/gen_math_ops.py\", line 296, in add\n    \"Add\", x=x, y=y, name=name)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\n    op_def=op_def)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 3292, in create_op\n    compute_device=compute_device)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 3332, in _create_op_helper\n    set_shapes_for_outputs(op)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 2496, in set_shapes_for_outputs\n    return _set_shapes_for_outputs(op)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 2469, in _set_shapes_for_outputs\n    shapes = shape_func(op)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 2399, in call_with_requiring\n    return call_cpp_shape_fn(op, require_shape_fn=True)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/common_shapes.py\", line 627, in call_cpp_shape_fn\n    require_shape_fn)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/common_shapes.py\", line 691, in _call_cpp_shape_fn_impl\n    raise ValueError(err.message)\nValueError: Dimensions must be equal, but are 6 and 5 for 'FeatureExtractor/fpn/top_down_features/add' (op: 'Add') with input shapes: [4,6,6,256], [4,5,5,256].\n</code></pre>\n<p>model_builder_test.py and ssd_resnet_v1_fpn_feature_extractor_test.py passes on Python2.7.<br>\nTried TF 1.6 and 1.7, Python 2.7 and 3.5, tried different input resolutions. All the same. Seems like a bug.</p>\n<p><a href=\"https://github.com/tensorflow/tensorflow/files/1819317/ssd_resnet_50_fpn_drone.config.zip\">ssd_resnet_50_fpn_drone.config.zip</a></p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): custom .config file, see below\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 16.04\nTensorFlow installed from (source or binary): source\nTensorFlow version (use command below): 1.7-rc0 and also tried on 1.6\nPython version: Tried 2.7 and 3.5\nBazel version (if compiling from source): 0.11.1\nGCC/Compiler version (if compiling from source): gcc (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609\nCUDA/cuDNN version: 8.0 / 6.0\nGPU model and memory: GeForce GTX 1060 6GB\nExact command to reproduce:\n\npython3 object_detection/train.py \\\n    --pipeline_config_path=object_detection/samples/ssd_resnet_50_fpn_drone.config \\\n    --train_dir=object_detection/drone \\\n    --num_clones=1\n\nWhen I'm trying to run test FPN config from model_builder_test.py (see attach), I'm getting error:\nWARNING:tensorflow:From /usr/local/lib/python3.5/dist-packages/tensorflow/contrib/learn/python/learn/datasets/base.py:198: retry (from tensorflow.contrib.learn.python.learn.datasets.base) is deprecated and will be removed in a future version.\nInstructions for updating:\nUse the retry module or similar alternatives.\nWARNING:tensorflow:From /home/undead/reps/tf_models/object_detection/trainer.py:228: create_global_step (from tensorflow.contrib.framework.python.ops.variables) is deprecated and will be removed in a future version.\nInstructions for updating:\nPlease switch to tf.train.create_global_step\nTraceback (most recent call last):\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/common_shapes.py\", line 686, in _call_cpp_shape_fn_impl\n    input_tensors_as_shapes, status)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/errors_impl.py\", line 516, in __exit__\n    c_api.TF_GetCode(self.status.status))\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Dimensions must be equal, but are 6 and 5 for 'FeatureExtractor/fpn/top_down_features/add' (op: 'Add') with input shapes: [4,6,6,256], [4,5,5,256].\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"object_detection/train.py\", line 167, in <module>\n    tf.app.run()\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/platform/app.py\", line 126, in run\n    _sys.exit(main(argv))\n  File \"object_detection/train.py\", line 163, in main\n    worker_job_name, is_chief, FLAGS.train_dir)\n  File \"/home/undead/reps/tf_models/object_detection/trainer.py\", line 246, in train\n    clones = model_deploy.create_clones(deploy_config, model_fn, [input_queue])\n  File \"/home/undead/reps/tf_models/slim/deployment/model_deploy.py\", line 193, in create_clones\n    outputs = model_fn(*args, **kwargs)\n  File \"/home/undead/reps/tf_models/object_detection/trainer.py\", line 179, in _create_losses\n    prediction_dict = detection_model.predict(images, true_image_shapes)\n  File \"/home/undead/reps/tf_models/object_detection/meta_architectures/ssd_meta_arch.py\", line 350, in predict\n    preprocessed_inputs)\n  File \"/home/undead/reps/tf_models/object_detection/models/ssd_resnet_v1_fpn_feature_extractor.py\", line 164, in extract_features\n    scope='top_down_features')\n  File \"/home/undead/reps/tf_models/object_detection/models/feature_map_generators.py\", line 217, in fpn_top_down_feature_maps\n    top_down = 0.5 * top_down + 0.5 * residual\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/ops/math_ops.py\", line 971, in binary_op_wrapper\n    return func(x, y, name=name)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/ops/gen_math_ops.py\", line 296, in add\n    \"Add\", x=x, y=y, name=name)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\n    op_def=op_def)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 3292, in create_op\n    compute_device=compute_device)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 3332, in _create_op_helper\n    set_shapes_for_outputs(op)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 2496, in set_shapes_for_outputs\n    return _set_shapes_for_outputs(op)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 2469, in _set_shapes_for_outputs\n    shapes = shape_func(op)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 2399, in call_with_requiring\n    return call_cpp_shape_fn(op, require_shape_fn=True)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/common_shapes.py\", line 627, in call_cpp_shape_fn\n    require_shape_fn)\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/common_shapes.py\", line 691, in _call_cpp_shape_fn_impl\n    raise ValueError(err.message)\nValueError: Dimensions must be equal, but are 6 and 5 for 'FeatureExtractor/fpn/top_down_features/add' (op: 'Add') with input shapes: [4,6,6,256], [4,5,5,256].\n\nmodel_builder_test.py and ssd_resnet_v1_fpn_feature_extractor_test.py passes on Python2.7.\nTried TF 1.6 and 1.7, Python 2.7 and 3.5, tried different input resolutions. All the same. Seems like a bug.\nssd_resnet_50_fpn_drone.config.zip", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: custom .config file, see below\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Ubuntu 16.04\r\n- **TensorFlow installed from (source or binary)**: source\r\n- **TensorFlow version (use command below)**: 1.7-rc0 and also tried on 1.6\r\n- **Python version**: Tried 2.7 and 3.5\r\n- **Bazel version (if compiling from source)**: 0.11.1\r\n- **GCC/Compiler version (if compiling from source)**: gcc (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609\r\n- **CUDA/cuDNN version**: 8.0 / 6.0\r\n- **GPU model and memory**: GeForce GTX 1060 6GB\r\n- **Exact command to reproduce**: \r\n```\r\npython3 object_detection/train.py \\\r\n    --pipeline_config_path=object_detection/samples/ssd_resnet_50_fpn_drone.config \\\r\n    --train_dir=object_detection/drone \\\r\n    --num_clones=1\r\n```\r\n\r\nWhen I'm trying to run test FPN config from model_builder_test.py (see attach), I'm getting error:\r\n```\r\nWARNING:tensorflow:From /usr/local/lib/python3.5/dist-packages/tensorflow/contrib/learn/python/learn/datasets/base.py:198: retry (from tensorflow.contrib.learn.python.learn.datasets.base) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nUse the retry module or similar alternatives.\r\nWARNING:tensorflow:From /home/undead/reps/tf_models/object_detection/trainer.py:228: create_global_step (from tensorflow.contrib.framework.python.ops.variables) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nPlease switch to tf.train.create_global_step\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/common_shapes.py\", line 686, in _call_cpp_shape_fn_impl\r\n    input_tensors_as_shapes, status)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/errors_impl.py\", line 516, in __exit__\r\n    c_api.TF_GetCode(self.status.status))\r\ntensorflow.python.framework.errors_impl.InvalidArgumentError: Dimensions must be equal, but are 6 and 5 for 'FeatureExtractor/fpn/top_down_features/add' (op: 'Add') with input shapes: [4,6,6,256], [4,5,5,256].\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"object_detection/train.py\", line 167, in <module>\r\n    tf.app.run()\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/platform/app.py\", line 126, in run\r\n    _sys.exit(main(argv))\r\n  File \"object_detection/train.py\", line 163, in main\r\n    worker_job_name, is_chief, FLAGS.train_dir)\r\n  File \"/home/undead/reps/tf_models/object_detection/trainer.py\", line 246, in train\r\n    clones = model_deploy.create_clones(deploy_config, model_fn, [input_queue])\r\n  File \"/home/undead/reps/tf_models/slim/deployment/model_deploy.py\", line 193, in create_clones\r\n    outputs = model_fn(*args, **kwargs)\r\n  File \"/home/undead/reps/tf_models/object_detection/trainer.py\", line 179, in _create_losses\r\n    prediction_dict = detection_model.predict(images, true_image_shapes)\r\n  File \"/home/undead/reps/tf_models/object_detection/meta_architectures/ssd_meta_arch.py\", line 350, in predict\r\n    preprocessed_inputs)\r\n  File \"/home/undead/reps/tf_models/object_detection/models/ssd_resnet_v1_fpn_feature_extractor.py\", line 164, in extract_features\r\n    scope='top_down_features')\r\n  File \"/home/undead/reps/tf_models/object_detection/models/feature_map_generators.py\", line 217, in fpn_top_down_feature_maps\r\n    top_down = 0.5 * top_down + 0.5 * residual\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/ops/math_ops.py\", line 971, in binary_op_wrapper\r\n    return func(x, y, name=name)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/ops/gen_math_ops.py\", line 296, in add\r\n    \"Add\", x=x, y=y, name=name)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/op_def_library.py\", line 787, in _apply_op_helper\r\n    op_def=op_def)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 3292, in create_op\r\n    compute_device=compute_device)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 3332, in _create_op_helper\r\n    set_shapes_for_outputs(op)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 2496, in set_shapes_for_outputs\r\n    return _set_shapes_for_outputs(op)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 2469, in _set_shapes_for_outputs\r\n    shapes = shape_func(op)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/ops.py\", line 2399, in call_with_requiring\r\n    return call_cpp_shape_fn(op, require_shape_fn=True)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/common_shapes.py\", line 627, in call_cpp_shape_fn\r\n    require_shape_fn)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/common_shapes.py\", line 691, in _call_cpp_shape_fn_impl\r\n    raise ValueError(err.message)\r\nValueError: Dimensions must be equal, but are 6 and 5 for 'FeatureExtractor/fpn/top_down_features/add' (op: 'Add') with input shapes: [4,6,6,256], [4,5,5,256].\r\n```\r\nmodel_builder_test.py and ssd_resnet_v1_fpn_feature_extractor_test.py passes on Python2.7.\r\nTried TF 1.6 and 1.7, Python 2.7 and 3.5, tried different input resolutions. All the same. Seems like a bug.\r\n\r\n[ssd_resnet_50_fpn_drone.config.zip](https://github.com/tensorflow/tensorflow/files/1819317/ssd_resnet_50_fpn_drone.config.zip)\r\n\r\n"}