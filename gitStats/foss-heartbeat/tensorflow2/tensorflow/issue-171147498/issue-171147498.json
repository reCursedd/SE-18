{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3815", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3815/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3815/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3815/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/3815", "id": 171147498, "node_id": "MDU6SXNzdWUxNzExNDc0OTg=", "number": 3815, "title": "reduce_prod shape bug ", "user": {"login": "alexggmatthews", "id": 6596998, "node_id": "MDQ6VXNlcjY1OTY5OTg=", "avatar_url": "https://avatars2.githubusercontent.com/u/6596998?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexggmatthews", "html_url": "https://github.com/alexggmatthews", "followers_url": "https://api.github.com/users/alexggmatthews/followers", "following_url": "https://api.github.com/users/alexggmatthews/following{/other_user}", "gists_url": "https://api.github.com/users/alexggmatthews/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexggmatthews/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexggmatthews/subscriptions", "organizations_url": "https://api.github.com/users/alexggmatthews/orgs", "repos_url": "https://api.github.com/users/alexggmatthews/repos", "events_url": "https://api.github.com/users/alexggmatthews/events{/privacy}", "received_events_url": "https://api.github.com/users/alexggmatthews/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2016-08-15T10:41:16Z", "updated_at": "2016-08-16T21:40:52Z", "closed_at": "2016-08-16T21:40:52Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Installed TensorFlow using pip package for v0.10.0rc0 on Ubuntu with python 2.7</p>\n<p>Pip package <a href=\"https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.10.0rc0-cp27-none-linux_x86_64.whl\" rel=\"nofollow\">https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.10.0rc0-cp27-none-linux_x86_64.whl</a></p>\n<p>The same error appears in the GPU build.</p>\n<p>The following minimal code example produces raise an exception at the definition of z</p>\n<pre><code>u = tf.placeholder(dtype=tf.float64, shape=(30,30))\nv = tf.reduce_prod(u, reduction_indices=[0]) \nw = tf.gradients( v, u )\n\nx = tf.placeholder(dtype=tf.float64, shape=(30,30))\ny = tf.reduce_prod(x, reduction_indices=0) \nz = tf.gradients( y, x )\n</code></pre>\n<blockquote>\n<p>z = tf.gradients( y, x )<br>\nFile \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gradients.py\", line 478, in gradients<br>\nin_grads = _AsList(grad_fn(op, *out_grads))<br>\nFile \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/math_grad.py\", line 130, in _ProdGrad<br>\nother, _ = array_ops.listdiff(idx, reduced)<br>\nFile \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 1201, in list_diff<br>\nresult = _op_def_lib.apply_op(\"ListDiff\", x=x, y=y, name=name)<br>\nFile \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 703, in apply_op<br>\nop_def=op_def)<br>\nFile \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2312, in create_op<br>\nset_shapes_for_outputs(ret)<br>\nFile \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1704, in set_shapes_for_outputs<br>\nshapes = shape_func(op)<br>\nFile \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/array_ops.py\", line 1981, in _ListDiffShape<br>\nop.inputs[1].get_shape().assert_has_rank(1)<br>\nFile \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/tensor_shape.py\", line 621, in assert_has_rank<br>\nraise ValueError(\"Shape %s must have rank %d\" % (self, rank))<br>\nValueError: Shape () must have rank 1</p>\n</blockquote>\n<p>The top code for u,v and w does not raise an error but the similar code for x,y, and z does. It looks like the shape code for reduce_prod cannot cope with the case where the reduction_indices is a single integer rather than a list. If you replace reduce_prod with reduce_sum in the above snippet then it does not raise an error.</p>", "body_text": "Installed TensorFlow using pip package for v0.10.0rc0 on Ubuntu with python 2.7\nPip package https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.10.0rc0-cp27-none-linux_x86_64.whl\nThe same error appears in the GPU build.\nThe following minimal code example produces raise an exception at the definition of z\nu = tf.placeholder(dtype=tf.float64, shape=(30,30))\nv = tf.reduce_prod(u, reduction_indices=[0]) \nw = tf.gradients( v, u )\n\nx = tf.placeholder(dtype=tf.float64, shape=(30,30))\ny = tf.reduce_prod(x, reduction_indices=0) \nz = tf.gradients( y, x )\n\n\nz = tf.gradients( y, x )\nFile \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gradients.py\", line 478, in gradients\nin_grads = _AsList(grad_fn(op, *out_grads))\nFile \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/math_grad.py\", line 130, in _ProdGrad\nother, _ = array_ops.listdiff(idx, reduced)\nFile \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 1201, in list_diff\nresult = _op_def_lib.apply_op(\"ListDiff\", x=x, y=y, name=name)\nFile \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 703, in apply_op\nop_def=op_def)\nFile \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2312, in create_op\nset_shapes_for_outputs(ret)\nFile \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1704, in set_shapes_for_outputs\nshapes = shape_func(op)\nFile \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/array_ops.py\", line 1981, in _ListDiffShape\nop.inputs[1].get_shape().assert_has_rank(1)\nFile \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/tensor_shape.py\", line 621, in assert_has_rank\nraise ValueError(\"Shape %s must have rank %d\" % (self, rank))\nValueError: Shape () must have rank 1\n\nThe top code for u,v and w does not raise an error but the similar code for x,y, and z does. It looks like the shape code for reduce_prod cannot cope with the case where the reduction_indices is a single integer rather than a list. If you replace reduce_prod with reduce_sum in the above snippet then it does not raise an error.", "body": "Installed TensorFlow using pip package for v0.10.0rc0 on Ubuntu with python 2.7\n\nPip package https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.10.0rc0-cp27-none-linux_x86_64.whl\n\nThe same error appears in the GPU build.\n\nThe following minimal code example produces raise an exception at the definition of z\n\n```\nu = tf.placeholder(dtype=tf.float64, shape=(30,30))\nv = tf.reduce_prod(u, reduction_indices=[0]) \nw = tf.gradients( v, u )\n\nx = tf.placeholder(dtype=tf.float64, shape=(30,30))\ny = tf.reduce_prod(x, reduction_indices=0) \nz = tf.gradients( y, x )\n```\n\n>  z = tf.gradients( y, x )\n>   File \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gradients.py\", line 478, in gradients\n>     in_grads = _AsList(grad_fn(op, *out_grads))\n>   File \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/math_grad.py\", line 130, in _ProdGrad\n>     other, _ = array_ops.listdiff(idx, reduced)\n>   File \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 1201, in list_diff\n>     result = _op_def_lib.apply_op(\"ListDiff\", x=x, y=y, name=name)\n>   File \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 703, in apply_op\n>     op_def=op_def)\n>   File \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 2312, in create_op\n>     set_shapes_for_outputs(ret)\n>   File \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/ops.py\", line 1704, in set_shapes_for_outputs\n>     shapes = shape_func(op)\n>   File \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/ops/array_ops.py\", line 1981, in _ListDiffShape\n>     op.inputs[1].get_shape().assert_has_rank(1)\n>   File \"HOME/anaconda2/lib/python2.7/site-packages/tensorflow/python/framework/tensor_shape.py\", line 621, in assert_has_rank\n>     raise ValueError(\"Shape %s must have rank %d\" % (self, rank))\n> ValueError: Shape () must have rank 1\n\nThe top code for u,v and w does not raise an error but the similar code for x,y, and z does. It looks like the shape code for reduce_prod cannot cope with the case where the reduction_indices is a single integer rather than a list. If you replace reduce_prod with reduce_sum in the above snippet then it does not raise an error. \n"}