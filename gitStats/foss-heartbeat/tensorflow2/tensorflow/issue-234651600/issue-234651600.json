{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10574", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10574/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10574/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10574/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/10574", "id": 234651600, "node_id": "MDExOlB1bGxSZXF1ZXN0MTI0NzQwOTYz", "number": 10574, "title": "Changed default `evalution_master` to also use cluster information", "user": {"login": "jhaux", "id": 9572598, "node_id": "MDQ6VXNlcjk1NzI1OTg=", "avatar_url": "https://avatars0.githubusercontent.com/u/9572598?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhaux", "html_url": "https://github.com/jhaux", "followers_url": "https://api.github.com/users/jhaux/followers", "following_url": "https://api.github.com/users/jhaux/following{/other_user}", "gists_url": "https://api.github.com/users/jhaux/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhaux/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhaux/subscriptions", "organizations_url": "https://api.github.com/users/jhaux/orgs", "repos_url": "https://api.github.com/users/jhaux/repos", "events_url": "https://api.github.com/users/jhaux/events{/privacy}", "received_events_url": "https://api.github.com/users/jhaux/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 390482148, "node_id": "MDU6TGFiZWwzOTA0ODIxNDg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/awaiting%20review", "name": "awaiting review", "color": "fef2c0", "default": false}, {"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "xiejw", "id": 1184671, "node_id": "MDQ6VXNlcjExODQ2NzE=", "avatar_url": "https://avatars1.githubusercontent.com/u/1184671?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xiejw", "html_url": "https://github.com/xiejw", "followers_url": "https://api.github.com/users/xiejw/followers", "following_url": "https://api.github.com/users/xiejw/following{/other_user}", "gists_url": "https://api.github.com/users/xiejw/gists{/gist_id}", "starred_url": "https://api.github.com/users/xiejw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xiejw/subscriptions", "organizations_url": "https://api.github.com/users/xiejw/orgs", "repos_url": "https://api.github.com/users/xiejw/repos", "events_url": "https://api.github.com/users/xiejw/events{/privacy}", "received_events_url": "https://api.github.com/users/xiejw/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "xiejw", "id": 1184671, "node_id": "MDQ6VXNlcjExODQ2NzE=", "avatar_url": "https://avatars1.githubusercontent.com/u/1184671?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xiejw", "html_url": "https://github.com/xiejw", "followers_url": "https://api.github.com/users/xiejw/followers", "following_url": "https://api.github.com/users/xiejw/following{/other_user}", "gists_url": "https://api.github.com/users/xiejw/gists{/gist_id}", "starred_url": "https://api.github.com/users/xiejw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xiejw/subscriptions", "organizations_url": "https://api.github.com/users/xiejw/orgs", "repos_url": "https://api.github.com/users/xiejw/repos", "events_url": "https://api.github.com/users/xiejw/events{/privacy}", "received_events_url": "https://api.github.com/users/xiejw/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2017-06-08T20:47:29Z", "updated_at": "2017-06-28T15:48:36Z", "closed_at": "2017-06-26T20:48:39Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/10574", "html_url": "https://github.com/tensorflow/tensorflow/pull/10574", "diff_url": "https://github.com/tensorflow/tensorflow/pull/10574.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/10574.patch"}, "body_html": "<p>When using the standard Estimator during evaluation in distributed setting (a <code>cluster_spec</code> was supplied) I encountered the following error message:</p>\n<pre><code>InvalidArgumentError (see above for traceback): Cannot assign a device for operation \n'save/RestoreV2_28': Operation was explicitly assigned to \n/job:ps/replica:0/task:0/device:CPU:0 but available devices are\n[ /job:localhost/replica:0/task:0/cpu:0, /job:localhost/replica:0/task:0/gpu:0 ]. \nMake sure the device specification refers to a valid device.\n</code></pre>\n<pre><code>[[Node: save/RestoreV2_28 = RestoreV2[dtypes=[DT_FLOAT], \n_device=\"/job:ps/replica:0/task:0/device:CPU:0\"](save/Const, save/RestoreV2_28/tensor_names, \nsave/ResyoreV2_28/shape_and_slices)]]\n</code></pre>\n<p>In short:<br>\nThe evaluation graph is looking for Variables on <code> /job:localhost</code> but they are on <code> /job:ps</code>, as is intended.</p>\n<p>To fix this I changed the default settings of placing the <code>evaluation_master</code> on <code>localhost</code> to the same as for <code>master</code>. This means that when instancing a RunConfig with no <code>evaluation_master</code> given it will check if there is a <code>cluster_spec</code>. If so it will get the <code>evaluation_master</code> based on the <code>cluster_spec</code>.</p>\n<p>This fixes the problem for me and leads to correct behaviour.</p>", "body_text": "When using the standard Estimator during evaluation in distributed setting (a cluster_spec was supplied) I encountered the following error message:\nInvalidArgumentError (see above for traceback): Cannot assign a device for operation \n'save/RestoreV2_28': Operation was explicitly assigned to \n/job:ps/replica:0/task:0/device:CPU:0 but available devices are\n[ /job:localhost/replica:0/task:0/cpu:0, /job:localhost/replica:0/task:0/gpu:0 ]. \nMake sure the device specification refers to a valid device.\n\n[[Node: save/RestoreV2_28 = RestoreV2[dtypes=[DT_FLOAT], \n_device=\"/job:ps/replica:0/task:0/device:CPU:0\"](save/Const, save/RestoreV2_28/tensor_names, \nsave/ResyoreV2_28/shape_and_slices)]]\n\nIn short:\nThe evaluation graph is looking for Variables on  /job:localhost but they are on  /job:ps, as is intended.\nTo fix this I changed the default settings of placing the evaluation_master on localhost to the same as for master. This means that when instancing a RunConfig with no evaluation_master given it will check if there is a cluster_spec. If so it will get the evaluation_master based on the cluster_spec.\nThis fixes the problem for me and leads to correct behaviour.", "body": "When using the standard Estimator during evaluation in distributed setting (a `cluster_spec` was supplied) I encountered the following error message:\r\n\r\n```\r\nInvalidArgumentError (see above for traceback): Cannot assign a device for operation \r\n'save/RestoreV2_28': Operation was explicitly assigned to \r\n/job:ps/replica:0/task:0/device:CPU:0 but available devices are\r\n[ /job:localhost/replica:0/task:0/cpu:0, /job:localhost/replica:0/task:0/gpu:0 ]. \r\nMake sure the device specification refers to a valid device.\r\n```\r\n```\r\n[[Node: save/RestoreV2_28 = RestoreV2[dtypes=[DT_FLOAT], \r\n_device=\"/job:ps/replica:0/task:0/device:CPU:0\"](save/Const, save/RestoreV2_28/tensor_names, \r\nsave/ResyoreV2_28/shape_and_slices)]]\r\n```\r\nIn short:\r\nThe evaluation graph is looking for Variables on ` /job:localhost` but they are on ` /job:ps`, as is intended. \r\n\r\nTo fix this I changed the default settings of placing the `evaluation_master` on `localhost` to the same as for `master`. This means that when instancing a RunConfig with no `evaluation_master` given it will check if there is a `cluster_spec`. If so it will get the `evaluation_master` based on the `cluster_spec`. \r\n\r\nThis fixes the problem for me and leads to correct behaviour."}