{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/325381474", "html_url": "https://github.com/tensorflow/tensorflow/issues/9661#issuecomment-325381474", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9661", "id": 325381474, "node_id": "MDEyOklzc3VlQ29tbWVudDMyNTM4MTQ3NA==", "user": {"login": "ruppeshnalwaya1993", "id": 2301185, "node_id": "MDQ6VXNlcjIzMDExODU=", "avatar_url": "https://avatars2.githubusercontent.com/u/2301185?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ruppeshnalwaya1993", "html_url": "https://github.com/ruppeshnalwaya1993", "followers_url": "https://api.github.com/users/ruppeshnalwaya1993/followers", "following_url": "https://api.github.com/users/ruppeshnalwaya1993/following{/other_user}", "gists_url": "https://api.github.com/users/ruppeshnalwaya1993/gists{/gist_id}", "starred_url": "https://api.github.com/users/ruppeshnalwaya1993/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ruppeshnalwaya1993/subscriptions", "organizations_url": "https://api.github.com/users/ruppeshnalwaya1993/orgs", "repos_url": "https://api.github.com/users/ruppeshnalwaya1993/repos", "events_url": "https://api.github.com/users/ruppeshnalwaya1993/events{/privacy}", "received_events_url": "https://api.github.com/users/ruppeshnalwaya1993/received_events", "type": "User", "site_admin": false}, "created_at": "2017-08-28T15:10:42Z", "updated_at": "2017-08-28T15:10:42Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=52087\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/petecoup\">@petecoup</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1645737\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/lissyx\">@lissyx</a> In which file do we need to make changes, tfcompile.bzl or tfcompile_main.cc</p>\n<p>I see the line <code> \" --target_triple=\" + target_llvm_triple() +</code> in tfcompile.bzl     and      <code>flags.target_triple = \"x86_64-pc-linux\";</code> in tfcompile_main.cc</p>\n<p>I want to compile for both android and ios</p>\n<p>For ios I tried first tried, just replacing in tfcompile_main.cc  with <code>flags.target_triple = \"arm64-apple-ios\";</code>. The bazel build completed successfully but when I include the .h and .o in ios app, it says .o is not built for arm64.</p>\n<p>Next, in addition to changes in tfcompile_main.cc, when I also made the change in tfcompile.bzl by replacing the line with <code> \" --target_triple=\" + \"arm64-apple-ios\" +</code>, the bazel build itself failed with error</p>\n<p>ERROR: /tensorflow/test_graph_build/BUILD:4:1: Linking of rule '//test_graph_build:test_graph_tfmatmul' failed: link_dynamic_library.sh failed: error executing command external/bazel_tools/tools/cpp/link_dynamic_library.sh no ignored ignored ignored /usr/bin/gcc -shared -o bazel-out/local-opt/bin/test_graph_build/libtest_graph_tfmatmul.so '-fuse-ld=gold' ... (remaining 7 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.<br>\n/usr/bin/ld.gold: error: bazel-out/local-opt/genfiles/test_graph_build/test_graph_tfmatmul.o:1:1: invalid character<br>\ncollect2: error: ld returned 1 exit status<br>\nTarget //test_graph_build:test_graph_tfmatmul failed to build</p>", "body_text": "@petecoup @lissyx In which file do we need to make changes, tfcompile.bzl or tfcompile_main.cc\nI see the line  \" --target_triple=\" + target_llvm_triple() + in tfcompile.bzl     and      flags.target_triple = \"x86_64-pc-linux\"; in tfcompile_main.cc\nI want to compile for both android and ios\nFor ios I tried first tried, just replacing in tfcompile_main.cc  with flags.target_triple = \"arm64-apple-ios\";. The bazel build completed successfully but when I include the .h and .o in ios app, it says .o is not built for arm64.\nNext, in addition to changes in tfcompile_main.cc, when I also made the change in tfcompile.bzl by replacing the line with  \" --target_triple=\" + \"arm64-apple-ios\" +, the bazel build itself failed with error\nERROR: /tensorflow/test_graph_build/BUILD:4:1: Linking of rule '//test_graph_build:test_graph_tfmatmul' failed: link_dynamic_library.sh failed: error executing command external/bazel_tools/tools/cpp/link_dynamic_library.sh no ignored ignored ignored /usr/bin/gcc -shared -o bazel-out/local-opt/bin/test_graph_build/libtest_graph_tfmatmul.so '-fuse-ld=gold' ... (remaining 7 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\n/usr/bin/ld.gold: error: bazel-out/local-opt/genfiles/test_graph_build/test_graph_tfmatmul.o:1:1: invalid character\ncollect2: error: ld returned 1 exit status\nTarget //test_graph_build:test_graph_tfmatmul failed to build", "body": "@petecoup @lissyx In which file do we need to make changes, tfcompile.bzl or tfcompile_main.cc \r\n\r\nI see the line ` \" --target_triple=\" + target_llvm_triple() +` in tfcompile.bzl     and      `flags.target_triple = \"x86_64-pc-linux\";` in tfcompile_main.cc\r\n\r\nI want to compile for both android and ios\r\n\r\nFor ios I tried first tried, just replacing in tfcompile_main.cc  with `flags.target_triple = \"arm64-apple-ios\";`. The bazel build completed successfully but when I include the .h and .o in ios app, it says .o is not built for arm64.\r\n\r\nNext, in addition to changes in tfcompile_main.cc, when I also made the change in tfcompile.bzl by replacing the line with ` \" --target_triple=\" + \"arm64-apple-ios\" +`, the bazel build itself failed with error \r\n\r\nERROR: /tensorflow/test_graph_build/BUILD:4:1: Linking of rule '//test_graph_build:test_graph_tfmatmul' failed: link_dynamic_library.sh failed: error executing command external/bazel_tools/tools/cpp/link_dynamic_library.sh no ignored ignored ignored /usr/bin/gcc -shared -o bazel-out/local-opt/bin/test_graph_build/libtest_graph_tfmatmul.so '-fuse-ld=gold' ... (remaining 7 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.\r\n/usr/bin/ld.gold: error: bazel-out/local-opt/genfiles/test_graph_build/test_graph_tfmatmul.o:1:1: invalid character\r\ncollect2: error: ld returned 1 exit status\r\nTarget //test_graph_build:test_graph_tfmatmul failed to build"}