{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/430406148", "html_url": "https://github.com/tensorflow/tensorflow/issues/22145#issuecomment-430406148", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22145", "id": 430406148, "node_id": "MDEyOklzc3VlQ29tbWVudDQzMDQwNjE0OA==", "user": {"login": "yongtang", "id": 6932348, "node_id": "MDQ6VXNlcjY5MzIzNDg=", "avatar_url": "https://avatars0.githubusercontent.com/u/6932348?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yongtang", "html_url": "https://github.com/yongtang", "followers_url": "https://api.github.com/users/yongtang/followers", "following_url": "https://api.github.com/users/yongtang/following{/other_user}", "gists_url": "https://api.github.com/users/yongtang/gists{/gist_id}", "starred_url": "https://api.github.com/users/yongtang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yongtang/subscriptions", "organizations_url": "https://api.github.com/users/yongtang/orgs", "repos_url": "https://api.github.com/users/yongtang/repos", "events_url": "https://api.github.com/users/yongtang/events{/privacy}", "received_events_url": "https://api.github.com/users/yongtang/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-16T21:24:08Z", "updated_at": "2018-10-16T21:24:08Z", "author_association": "MEMBER", "body_html": "<p>I am running ok with tf-nightly, wondering if the issue still exist?</p>\n<pre><code>root@ubuntu:/v# python -c 'import tensorflow as tf; print(tf.VERSION)'\n1.13.0-dev20181016\nroot@ubuntu:/v# python 22145.py\n2018-10-16 21:22:48.542684: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\nroot@ubuntu:/v# cat 22145.py \nimport tensorflow as tf\nimport numpy as np\n\ndef apply_blur(img):\n    blur = np.random.rand(3,3,1,1)\n    img = tf.nn.depthwise_conv2d(img[None], blur, [1,1,1,1], 'VALID')\n    return img\n\ndef workaround(img):\n    return img[0]\n\ntf.reset_default_graph()\ndataset = tf.data.Dataset.from_tensor_slices(np.ones((10, 128, 128, 1)))\ndataset = dataset.map(apply_blur, 2).map(workaround, 2)\n\niterator = dataset.make_one_shot_iterator()\nbatch = iterator.get_next()\n\nconfig = tf.ConfigProto()\nconfig.gpu_options.allow_growth = True\nwith tf.Session(config=config) as sess:\n    out = sess.run(batch)\nroot@ubuntu:/v# \n</code></pre>", "body_text": "I am running ok with tf-nightly, wondering if the issue still exist?\nroot@ubuntu:/v# python -c 'import tensorflow as tf; print(tf.VERSION)'\n1.13.0-dev20181016\nroot@ubuntu:/v# python 22145.py\n2018-10-16 21:22:48.542684: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\nroot@ubuntu:/v# cat 22145.py \nimport tensorflow as tf\nimport numpy as np\n\ndef apply_blur(img):\n    blur = np.random.rand(3,3,1,1)\n    img = tf.nn.depthwise_conv2d(img[None], blur, [1,1,1,1], 'VALID')\n    return img\n\ndef workaround(img):\n    return img[0]\n\ntf.reset_default_graph()\ndataset = tf.data.Dataset.from_tensor_slices(np.ones((10, 128, 128, 1)))\ndataset = dataset.map(apply_blur, 2).map(workaround, 2)\n\niterator = dataset.make_one_shot_iterator()\nbatch = iterator.get_next()\n\nconfig = tf.ConfigProto()\nconfig.gpu_options.allow_growth = True\nwith tf.Session(config=config) as sess:\n    out = sess.run(batch)\nroot@ubuntu:/v#", "body": "I am running ok with tf-nightly, wondering if the issue still exist?\r\n```\r\nroot@ubuntu:/v# python -c 'import tensorflow as tf; print(tf.VERSION)'\r\n1.13.0-dev20181016\r\nroot@ubuntu:/v# python 22145.py\r\n2018-10-16 21:22:48.542684: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\r\nroot@ubuntu:/v# cat 22145.py \r\nimport tensorflow as tf\r\nimport numpy as np\r\n\r\ndef apply_blur(img):\r\n    blur = np.random.rand(3,3,1,1)\r\n    img = tf.nn.depthwise_conv2d(img[None], blur, [1,1,1,1], 'VALID')\r\n    return img\r\n\r\ndef workaround(img):\r\n    return img[0]\r\n\r\ntf.reset_default_graph()\r\ndataset = tf.data.Dataset.from_tensor_slices(np.ones((10, 128, 128, 1)))\r\ndataset = dataset.map(apply_blur, 2).map(workaround, 2)\r\n\r\niterator = dataset.make_one_shot_iterator()\r\nbatch = iterator.get_next()\r\n\r\nconfig = tf.ConfigProto()\r\nconfig.gpu_options.allow_growth = True\r\nwith tf.Session(config=config) as sess:\r\n    out = sess.run(batch)\r\nroot@ubuntu:/v# \r\n```"}