{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/199358675", "pull_request_review_id": 133462613, "id": 199358675, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5OTM1ODY3NQ==", "diff_hunk": "@@ -120,41 +115,40 @@ def py3string(inp):\n     to_bytes = py3bytes\n     to_string = py3string\n \n-  out_names = []\n-  for i in outputs:\n-    if isinstance(i, ops.Tensor):\n-      out_names.append(to_bytes(i.name))\n-    else:\n-      out_names.append(to_bytes(i))\n-\n-  input_graph_def_str = input_graph_def.SerializeToString()\n-\n-  # TODO(sami): Fix this when we can return status from C++ library\n-  # There is a problem with the TF internal library setup that doesn't\n-  # allow us to return a status object from C++.  Thus we return a\n-  # pair or strings where first one is encoded status and the second\n-  # one is the transformed graphs protobuf string.\n-  out = trt_convert(input_graph_def_str, out_names, max_batch_size,\n-                    max_workspace_size_bytes, mode, minimum_segment_size,\n-                    is_dynamic_op, maximum_cached_engines,\n-                    cached_engine_batches)\n-  status = to_string(out[0])\n-  output_graph_def_string = out[1]\n-  del input_graph_def_str  # Save some memory\n-  if len(status) < 2:\n-    raise _impl.UnknownError(None, None, status)\n-  if status[:2] != \"OK\":\n-    msg = status.split(\";\")\n-    if len(msg) == 1:\n-      raise RuntimeError(\"Status message is malformed {}\".format(status))\n-    # pylint: disable=protected-access\n-    raise _impl._make_specific_exception(None, None, \";\".join(msg[1:]),\n-                                         int(msg[0]))\n-    # pylint: enable=protected-access\n-  output_graph_def = graph_pb2.GraphDef()\n-  output_graph_def.ParseFromString(output_graph_def_string)\n-  del output_graph_def_string  # Save some memory\n-  return output_graph_def\n+  # Create MetaGraphDef\n+  graph = ops.Graph()\n+  with graph.as_default():\n+    importer.import_graph_def(input_graph_def, name=\"\")\n+  meta_graph = saver.export_meta_graph(\n+      graph_def=graph.as_graph_def(), graph=graph)", "path": "tensorflow/contrib/tensorrt/python/trt_convert.py", "position": 89, "original_position": 80, "commit_id": "e6012bd6b2cb9f65d25d02c1661cb2bac1689da8", "original_commit_id": "e77098094d401435f4d038d93724dd841e0469c1", "user": {"login": "samikama", "id": 10539540, "node_id": "MDQ6VXNlcjEwNTM5NTQw", "avatar_url": "https://avatars0.githubusercontent.com/u/10539540?v=4", "gravatar_id": "", "url": "https://api.github.com/users/samikama", "html_url": "https://github.com/samikama", "followers_url": "https://api.github.com/users/samikama/followers", "following_url": "https://api.github.com/users/samikama/following{/other_user}", "gists_url": "https://api.github.com/users/samikama/gists{/gist_id}", "starred_url": "https://api.github.com/users/samikama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/samikama/subscriptions", "organizations_url": "https://api.github.com/users/samikama/orgs", "repos_url": "https://api.github.com/users/samikama/repos", "events_url": "https://api.github.com/users/samikama/events{/privacy}", "received_events_url": "https://api.github.com/users/samikama/received_events", "type": "User", "site_admin": false}, "body": "Does this involve a file io. If so this is undesired behavior. Documentation implies it does.", "created_at": "2018-07-01T19:27:05Z", "updated_at": "2018-07-22T15:57:01Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/20318#discussion_r199358675", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/20318", "author_association": "CONTRIBUTOR", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/199358675"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/20318#discussion_r199358675"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/20318"}}, "body_html": "<p>Does this involve a file io. If so this is undesired behavior. Documentation implies it does.</p>", "body_text": "Does this involve a file io. If so this is undesired behavior. Documentation implies it does."}