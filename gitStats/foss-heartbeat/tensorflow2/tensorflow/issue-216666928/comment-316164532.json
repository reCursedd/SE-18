{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/316164532", "html_url": "https://github.com/tensorflow/tensorflow/issues/8682#issuecomment-316164532", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/8682", "id": 316164532, "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjE2NDUzMg==", "user": {"login": "ivamluz", "id": 1983873, "node_id": "MDQ6VXNlcjE5ODM4NzM=", "avatar_url": "https://avatars1.githubusercontent.com/u/1983873?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ivamluz", "html_url": "https://github.com/ivamluz", "followers_url": "https://api.github.com/users/ivamluz/followers", "following_url": "https://api.github.com/users/ivamluz/following{/other_user}", "gists_url": "https://api.github.com/users/ivamluz/gists{/gist_id}", "starred_url": "https://api.github.com/users/ivamluz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ivamluz/subscriptions", "organizations_url": "https://api.github.com/users/ivamluz/orgs", "repos_url": "https://api.github.com/users/ivamluz/repos", "events_url": "https://api.github.com/users/ivamluz/events{/privacy}", "received_events_url": "https://api.github.com/users/ivamluz/received_events", "type": "User", "site_admin": false}, "created_at": "2017-07-18T19:00:15Z", "updated_at": "2017-07-18T19:00:15Z", "author_association": "NONE", "body_html": "<p>I've tried the following approaches:</p>\n<pre><code>bazel-bin/tensorflow/tools/quantization/quantize_graph \\\n  --input=/path/to/input/graph.pb \\\n  --output_node_names=\"final_result\" \\\n  --output=/path/to/output/graph.pb \\\n  --mode=eightbit\n\n</code></pre>\n<p>For this approach, it always return a single wrong result with 100% certainty.</p>\n<hr>\n<pre><code>bazel-bin/tensorflow/tools/graph_transforms/transform_graph \\\n  --in_graph=/path/to/input/graph.pb \\\n  --out_graph=/path/to/output/graph.pb \\\n  --inputs=Mul \\\n  --outputs=final_result \\\n  --transforms='\n  add_default_attributes\n  strip_unused_nodes(type=float, shape=\"1,299,299,3\")\n  remove_nodes(op=Identity, op=CheckNumerics)\n  fold_old_batch_norms\n  quantize_weights\n  quantize_nodes\n  strip_unused_nodes'\n</code></pre>\n<p>and</p>\n<pre><code>bazel-bin/tensorflow/tools/graph_transforms/transform_graph \\\n--in_graph=/path/to/input/graph.pb \\\n--out_graph=/path/to/output/graph.pb \\\n--inputs='Mul' \\\n--outputs='final_result' \\\n--transforms='\n  add_default_attributes\n  strip_unused_nodes(type=float, shape=\"1,299,299,3\")\n  remove_nodes(op=Identity, op=CheckNumerics)\n  fold_constants(ignore_errors=true)\n  fold_batch_norms\n  fold_old_batch_norms\n  quantize_weights\n  quantize_nodes\n  strip_unused_nodes\n  sort_by_execution_order'\n</code></pre>\n<p>For both of these, the results are similar. There is some variance to the results returned (sometimes different values with around 20% or 50% variance), but a specific result is most of the times returned with 100% certainty as well, even though it's wrong.</p>\n<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=11551745\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/SubhashKsr\">@SubhashKsr</a>, did you manage to fix this?</p>\n<p>Any help is much appreciated.</p>", "body_text": "I've tried the following approaches:\nbazel-bin/tensorflow/tools/quantization/quantize_graph \\\n  --input=/path/to/input/graph.pb \\\n  --output_node_names=\"final_result\" \\\n  --output=/path/to/output/graph.pb \\\n  --mode=eightbit\n\n\nFor this approach, it always return a single wrong result with 100% certainty.\n\nbazel-bin/tensorflow/tools/graph_transforms/transform_graph \\\n  --in_graph=/path/to/input/graph.pb \\\n  --out_graph=/path/to/output/graph.pb \\\n  --inputs=Mul \\\n  --outputs=final_result \\\n  --transforms='\n  add_default_attributes\n  strip_unused_nodes(type=float, shape=\"1,299,299,3\")\n  remove_nodes(op=Identity, op=CheckNumerics)\n  fold_old_batch_norms\n  quantize_weights\n  quantize_nodes\n  strip_unused_nodes'\n\nand\nbazel-bin/tensorflow/tools/graph_transforms/transform_graph \\\n--in_graph=/path/to/input/graph.pb \\\n--out_graph=/path/to/output/graph.pb \\\n--inputs='Mul' \\\n--outputs='final_result' \\\n--transforms='\n  add_default_attributes\n  strip_unused_nodes(type=float, shape=\"1,299,299,3\")\n  remove_nodes(op=Identity, op=CheckNumerics)\n  fold_constants(ignore_errors=true)\n  fold_batch_norms\n  fold_old_batch_norms\n  quantize_weights\n  quantize_nodes\n  strip_unused_nodes\n  sort_by_execution_order'\n\nFor both of these, the results are similar. There is some variance to the results returned (sometimes different values with around 20% or 50% variance), but a specific result is most of the times returned with 100% certainty as well, even though it's wrong.\n@SubhashKsr, did you manage to fix this?\nAny help is much appreciated.", "body": "I've tried the following approaches:\r\n\r\n```\r\nbazel-bin/tensorflow/tools/quantization/quantize_graph \\\r\n  --input=/path/to/input/graph.pb \\\r\n  --output_node_names=\"final_result\" \\\r\n  --output=/path/to/output/graph.pb \\\r\n  --mode=eightbit\r\n\r\n```\r\nFor this approach, it always return a single wrong result with 100% certainty.\r\n\r\n-------------------\r\n```\r\nbazel-bin/tensorflow/tools/graph_transforms/transform_graph \\\r\n  --in_graph=/path/to/input/graph.pb \\\r\n  --out_graph=/path/to/output/graph.pb \\\r\n  --inputs=Mul \\\r\n  --outputs=final_result \\\r\n  --transforms='\r\n  add_default_attributes\r\n  strip_unused_nodes(type=float, shape=\"1,299,299,3\")\r\n  remove_nodes(op=Identity, op=CheckNumerics)\r\n  fold_old_batch_norms\r\n  quantize_weights\r\n  quantize_nodes\r\n  strip_unused_nodes'\r\n```\r\nand\r\n\r\n```\r\nbazel-bin/tensorflow/tools/graph_transforms/transform_graph \\\r\n--in_graph=/path/to/input/graph.pb \\\r\n--out_graph=/path/to/output/graph.pb \\\r\n--inputs='Mul' \\\r\n--outputs='final_result' \\\r\n--transforms='\r\n  add_default_attributes\r\n  strip_unused_nodes(type=float, shape=\"1,299,299,3\")\r\n  remove_nodes(op=Identity, op=CheckNumerics)\r\n  fold_constants(ignore_errors=true)\r\n  fold_batch_norms\r\n  fold_old_batch_norms\r\n  quantize_weights\r\n  quantize_nodes\r\n  strip_unused_nodes\r\n  sort_by_execution_order'\r\n```\r\n\r\nFor both of these, the results are similar. There is some variance to the results returned (sometimes different values with around 20% or 50% variance), but a specific result is most of the times returned with 100% certainty as well, even though it's wrong.\r\n\r\n@SubhashKsr, did you manage to fix this?\r\n\r\nAny help is much appreciated."}