{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/233957832", "html_url": "https://github.com/tensorflow/tensorflow/issues/3376#issuecomment-233957832", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/3376", "id": 233957832, "node_id": "MDEyOklzc3VlQ29tbWVudDIzMzk1NzgzMg==", "user": {"login": "zgxgoo", "id": 14540927, "node_id": "MDQ6VXNlcjE0NTQwOTI3", "avatar_url": "https://avatars1.githubusercontent.com/u/14540927?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zgxgoo", "html_url": "https://github.com/zgxgoo", "followers_url": "https://api.github.com/users/zgxgoo/followers", "following_url": "https://api.github.com/users/zgxgoo/following{/other_user}", "gists_url": "https://api.github.com/users/zgxgoo/gists{/gist_id}", "starred_url": "https://api.github.com/users/zgxgoo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zgxgoo/subscriptions", "organizations_url": "https://api.github.com/users/zgxgoo/orgs", "repos_url": "https://api.github.com/users/zgxgoo/repos", "events_url": "https://api.github.com/users/zgxgoo/events{/privacy}", "received_events_url": "https://api.github.com/users/zgxgoo/received_events", "type": "User", "site_admin": false}, "created_at": "2016-07-20T14:00:40Z", "updated_at": "2016-07-21T00:41:24Z", "author_association": "NONE", "body_html": "<p>Does  tf.cond need to support element-wise or just convert pred to scalar? And  does BuildCondBranch argument fn need to check fn type since when fn is constant which has no attr name?<br>\nand my patch  reshape pred to scalar , check the fn type and convert it to tensor<br>\n--- ./tensorflow/python/ops/control_flow_ops_org.py 2016-07-20 21:54:14.103755118 +0800<br>\n+++ ./tensorflow/python/ops/control_flow_ops.py 2016-07-20 21:58:40.927753017 +0800<br>\n@@ -1234,6 +1234,9 @@<br>\noriginal_r = r<br>\nresult = []<br>\nif r is not None:</p>\n<ul>\n<li>\n<pre><code> #convert to Tensor\n</code></pre>\n</li>\n<li>\n<pre><code> if not isinstance(r, ops.Tensor)\n</code></pre>\n</li>\n<li>\n<pre><code>   r = ops.convert_to_tensor(r)\n</code></pre>\nif not isinstance(r, list) and not isinstance(r, _basetuple):<br>\nr = [r]<br>\noriginal_r = [original_r]<br>\n@@ -1316,6 +1319,12 @@\n<h1>Add the Switch to the graph.</h1>\nif isinstance(pred, bool):<br>\nraise TypeError(\"pred must not be a Python bool\")<br>\n+</li>\n<li>\n<h1>rashape pred to scalar</h1>\n</li>\n<li>pred_shape = pred.get_shape()</li>\n<li>if pred_shape.ndims is not None and pred_shape.ndims != 0</li>\n<li>\n<pre><code>   pred = gen_array_ops.reshape(pred, [])\n</code></pre>\n<ul>\n<li></li>\n</ul>\np_2, p_1 = switch(pred, pred)<br>\npivot_1 = array_ops.identity(p_1, name=\"switch_t\")<br>\npivot_2 = array_ops.identity(p_2, name=\"switch_f\")</li>\n</ul>", "body_text": "Does  tf.cond need to support element-wise or just convert pred to scalar? And  does BuildCondBranch argument fn need to check fn type since when fn is constant which has no attr name?\nand my patch  reshape pred to scalar , check the fn type and convert it to tensor\n--- ./tensorflow/python/ops/control_flow_ops_org.py 2016-07-20 21:54:14.103755118 +0800\n+++ ./tensorflow/python/ops/control_flow_ops.py 2016-07-20 21:58:40.927753017 +0800\n@@ -1234,6 +1234,9 @@\noriginal_r = r\nresult = []\nif r is not None:\n\n\n #convert to Tensor\n\n\n\n if not isinstance(r, ops.Tensor)\n\n\n\n   r = ops.convert_to_tensor(r)\n\nif not isinstance(r, list) and not isinstance(r, _basetuple):\nr = [r]\noriginal_r = [original_r]\n@@ -1316,6 +1319,12 @@\nAdd the Switch to the graph.\nif isinstance(pred, bool):\nraise TypeError(\"pred must not be a Python bool\")\n+\n\nrashape pred to scalar\n\npred_shape = pred.get_shape()\nif pred_shape.ndims is not None and pred_shape.ndims != 0\n\n   pred = gen_array_ops.reshape(pred, [])\n\n\n\n\np_2, p_1 = switch(pred, pred)\npivot_1 = array_ops.identity(p_1, name=\"switch_t\")\npivot_2 = array_ops.identity(p_2, name=\"switch_f\")", "body": "Does  tf.cond need to support element-wise or just convert pred to scalar? And  does BuildCondBranch argument fn need to check fn type since when fn is constant which has no attr name?\nand my patch  reshape pred to scalar , check the fn type and convert it to tensor  \n--- ./tensorflow/python/ops/control_flow_ops_org.py 2016-07-20 21:54:14.103755118 +0800\n+++ ./tensorflow/python/ops/control_flow_ops.py 2016-07-20 21:58:40.927753017 +0800\n@@ -1234,6 +1234,9 @@\n     original_r = r\n     result = []\n     if r is not None:\n-      #convert to Tensor\n-      if not isinstance(r, ops.Tensor)\n-        r = ops.convert_to_tensor(r)\n     if not isinstance(r, list) and not isinstance(r, _basetuple):\n       r = [r]\n       original_r = [original_r]\n  @@ -1316,6 +1319,12 @@\n   # Add the Switch to the graph.\n   if isinstance(pred, bool):\n     raise TypeError(\"pred must not be a Python bool\")\n  +\n-    # rashape pred to scalar\n-    pred_shape = pred.get_shape()\n-    if pred_shape.ndims is not None and pred_shape.ndims != 0\n-        pred = gen_array_ops.reshape(pred, [])\n  +\n   p_2, p_1 = switch(pred, pred)\n   pivot_1 = array_ops.identity(p_1, name=\"switch_t\")\n   pivot_2 = array_ops.identity(p_2, name=\"switch_f\")\n"}