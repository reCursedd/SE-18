{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6472", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6472/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6472/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6472/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/6472", "id": 197337364, "node_id": "MDU6SXNzdWUxOTczMzczNjQ=", "number": 6472, "title": "Timeout does not work with session created with server", "user": {"login": "agnusmaximus", "id": 1736160, "node_id": "MDQ6VXNlcjE3MzYxNjA=", "avatar_url": "https://avatars1.githubusercontent.com/u/1736160?v=4", "gravatar_id": "", "url": "https://api.github.com/users/agnusmaximus", "html_url": "https://github.com/agnusmaximus", "followers_url": "https://api.github.com/users/agnusmaximus/followers", "following_url": "https://api.github.com/users/agnusmaximus/following{/other_user}", "gists_url": "https://api.github.com/users/agnusmaximus/gists{/gist_id}", "starred_url": "https://api.github.com/users/agnusmaximus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/agnusmaximus/subscriptions", "organizations_url": "https://api.github.com/users/agnusmaximus/orgs", "repos_url": "https://api.github.com/users/agnusmaximus/repos", "events_url": "https://api.github.com/users/agnusmaximus/events{/privacy}", "received_events_url": "https://api.github.com/users/agnusmaximus/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2016-12-23T09:28:09Z", "updated_at": "2016-12-30T22:43:13Z", "closed_at": "2016-12-30T22:43:13Z", "author_association": "NONE", "body_html": "<h3>What related GitHub issues or StackOverflow threads have you found by searching the web for your problem? None</h3>\n<h3>Environment info</h3>\n<p>Operating System: Ubuntu</p>\n<p>Installed version of CUDA and cuDNN:<br>\n(please attach the output of <code>ls -l /path/to/cuda/lib/libcud*</code>): CPU only</p>\n<p>If installed from source, provide</p>\n<ol>\n<li>The commit hash (<code>git rev-parse HEAD</code>)</li>\n</ol>\n<p><a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/c32663d119a4cbd9d4926d4eed2a0705f03a57f9/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/c32663d119a4cbd9d4926d4eed2a0705f03a57f9\"><tt>c32663d</tt></a></p>\n<ol start=\"2\">\n<li>The output of <code>bazel version</code></li>\n</ol>\n<p>Extracting Bazel installation...<br>\nBuild label: 0.4.3<br>\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar<br>\nBuild time: Thu Dec 22 12:31:25 2016 (1482409885)<br>\nBuild timestamp: 1482409885<br>\nBuild timestamp as int: 1482409885</p>\n<h3>If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)</h3>\n<div class=\"highlight highlight-source-python\"><pre><span class=\"pl-k\">from</span> <span class=\"pl-c1\">__future__</span> <span class=\"pl-k\">import</span> absolute_import\n<span class=\"pl-k\">from</span> <span class=\"pl-c1\">__future__</span> <span class=\"pl-k\">import</span> division\n<span class=\"pl-k\">from</span> <span class=\"pl-c1\">__future__</span> <span class=\"pl-k\">import</span> print_function\n\n<span class=\"pl-k\">from</span> datetime <span class=\"pl-k\">import</span> datetime\n<span class=\"pl-k\">import</span> os.path\n<span class=\"pl-k\">import</span> time\n\n<span class=\"pl-k\">import</span> numpy <span class=\"pl-k\">as</span> np\n<span class=\"pl-k\">import</span> random\n<span class=\"pl-k\">import</span> tensorflow <span class=\"pl-k\">as</span> tf\n\n<span class=\"pl-k\">import</span> signal\n<span class=\"pl-k\">import</span> sys\n<span class=\"pl-k\">import</span> os\n\n<span class=\"pl-k\">from</span> tensorflow.python.framework <span class=\"pl-k\">import</span> ops\n<span class=\"pl-k\">from</span> tensorflow.python.ops <span class=\"pl-k\">import</span> variables\n<span class=\"pl-k\">from</span> tensorflow.python.ops <span class=\"pl-k\">import</span> state_ops\n<span class=\"pl-k\">from</span> tensorflow.python.ops <span class=\"pl-k\">import</span> logging_ops\n<span class=\"pl-k\">from</span> tensorflow.python.client <span class=\"pl-k\">import</span> timeline\n\n<span class=\"pl-k\">from</span> tensorflow.python.ops <span class=\"pl-k\">import</span> data_flow_ops\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> (python test 1 worker &gt; /tmp/output 2&gt;&amp;1 &amp;) &amp;&amp; (python test 0 ps &gt; /tmp/output2 2&gt;&amp;1 &amp;) &amp;&amp; python test 0 worker</span>\n\n<span class=\"pl-k\">try</span>:\n\n    index, job <span class=\"pl-k\">=</span> <span class=\"pl-c1\">int</span>(sys.argv[<span class=\"pl-c1\">1</span>]), sys.argv[<span class=\"pl-c1\">2</span>]\n\n\n    ps_hosts <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>localhost:1234<span class=\"pl-pds\">'</span></span>\n    worker_hosts <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">'</span>localhost:1235,localhost:1236<span class=\"pl-pds\">'</span></span>\n    ps_hosts <span class=\"pl-k\">=</span> ps_hosts.split(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>,<span class=\"pl-pds\">\"</span></span>)\n    worker_hosts <span class=\"pl-k\">=</span> worker_hosts.split(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>,<span class=\"pl-pds\">\"</span></span>)\n\n    cluster_spec <span class=\"pl-k\">=</span> tf.train.ClusterSpec({<span class=\"pl-s\"><span class=\"pl-pds\">'</span>ps<span class=\"pl-pds\">'</span></span> : ps_hosts, <span class=\"pl-s\"><span class=\"pl-pds\">'</span>worker<span class=\"pl-pds\">'</span></span> : worker_hosts})\n    server <span class=\"pl-k\">=</span> tf.train.Server(\n\t{<span class=\"pl-s\"><span class=\"pl-pds\">'</span>ps<span class=\"pl-pds\">'</span></span>: ps_hosts,\n         <span class=\"pl-s\"><span class=\"pl-pds\">'</span>worker<span class=\"pl-pds\">'</span></span>: worker_hosts},\n\t<span class=\"pl-v\">job_name</span><span class=\"pl-k\">=</span>job,\n\t<span class=\"pl-v\">task_index</span><span class=\"pl-k\">=</span>index)\n\n    a <span class=\"pl-k\">=</span> data_flow_ops.FIFOQueue(<span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>, tf.float32)\n    b <span class=\"pl-k\">=</span> a.dequeue()\n    sv <span class=\"pl-k\">=</span> tf.train.Supervisor(<span class=\"pl-v\">is_chief</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>, <span class=\"pl-v\">logdir</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>./test_logdir<span class=\"pl-pds\">'</span></span>)\n    cfg <span class=\"pl-k\">=</span> tf.ConfigProto(\n\t<span class=\"pl-v\">allow_soft_placement</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">True</span>,\n\t<span class=\"pl-v\">log_device_placement</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">False</span>)\n    sess <span class=\"pl-k\">=</span> sv.prepare_or_wait_for_session(server.target, <span class=\"pl-v\">config</span><span class=\"pl-k\">=</span>cfg)\n    <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Testing timeout<span class=\"pl-pds\">\"</span></span>)\n    opt <span class=\"pl-k\">=</span> tf.RunOptions(<span class=\"pl-v\">timeout_in_ms</span><span class=\"pl-k\">=</span><span class=\"pl-c1\">50</span>)\n    sess.run(b, <span class=\"pl-v\">options</span><span class=\"pl-k\">=</span>opt)\n<span class=\"pl-k\">except</span> tf.errors.DeadlineExceededError:\n    <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Successfully timed out!<span class=\"pl-pds\">\"</span></span>)</pre></div>\n<p>Above I create a cluster and get a session from the server. I then try to dequeue an empty FIFOQueue with a timeout of 1 second. For some reason, on the latest commits of the tensorflow source, this does not successfully time out. This bug does not happen for the released versions of tensorflow (.11, .12).</p>\n<p>To run:<br>\n<code>(python script.py 1 worker &gt; /tmp/output 2&gt;&amp;1 &amp;) &amp;&amp; (python script.py 0 ps &gt; /tmp/output2 2&gt;&amp;1 &amp;) &amp;&amp; python script.py 0 worker</code></p>\n<p>where script.py is the above example.</p>", "body_text": "What related GitHub issues or StackOverflow threads have you found by searching the web for your problem? None\nEnvironment info\nOperating System: Ubuntu\nInstalled version of CUDA and cuDNN:\n(please attach the output of ls -l /path/to/cuda/lib/libcud*): CPU only\nIf installed from source, provide\n\nThe commit hash (git rev-parse HEAD)\n\nc32663d\n\nThe output of bazel version\n\nExtracting Bazel installation...\nBuild label: 0.4.3\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\nBuild time: Thu Dec 22 12:31:25 2016 (1482409885)\nBuild timestamp: 1482409885\nBuild timestamp as int: 1482409885\nIf possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\nfrom __future__ import absolute_import\nfrom __future__ import division\nfrom __future__ import print_function\n\nfrom datetime import datetime\nimport os.path\nimport time\n\nimport numpy as np\nimport random\nimport tensorflow as tf\n\nimport signal\nimport sys\nimport os\n\nfrom tensorflow.python.framework import ops\nfrom tensorflow.python.ops import variables\nfrom tensorflow.python.ops import state_ops\nfrom tensorflow.python.ops import logging_ops\nfrom tensorflow.python.client import timeline\n\nfrom tensorflow.python.ops import data_flow_ops\n\n# (python test 1 worker > /tmp/output 2>&1 &) && (python test 0 ps > /tmp/output2 2>&1 &) && python test 0 worker\n\ntry:\n\n    index, job = int(sys.argv[1]), sys.argv[2]\n\n\n    ps_hosts = 'localhost:1234'\n    worker_hosts = 'localhost:1235,localhost:1236'\n    ps_hosts = ps_hosts.split(\",\")\n    worker_hosts = worker_hosts.split(\",\")\n\n    cluster_spec = tf.train.ClusterSpec({'ps' : ps_hosts, 'worker' : worker_hosts})\n    server = tf.train.Server(\n\t{'ps': ps_hosts,\n         'worker': worker_hosts},\n\tjob_name=job,\n\ttask_index=index)\n\n    a = data_flow_ops.FIFOQueue(-1, tf.float32)\n    b = a.dequeue()\n    sv = tf.train.Supervisor(is_chief=True, logdir='./test_logdir')\n    cfg = tf.ConfigProto(\n\tallow_soft_placement=True,\n\tlog_device_placement=False)\n    sess = sv.prepare_or_wait_for_session(server.target, config=cfg)\n    print(\"Testing timeout\")\n    opt = tf.RunOptions(timeout_in_ms=50)\n    sess.run(b, options=opt)\nexcept tf.errors.DeadlineExceededError:\n    print(\"Successfully timed out!\")\nAbove I create a cluster and get a session from the server. I then try to dequeue an empty FIFOQueue with a timeout of 1 second. For some reason, on the latest commits of the tensorflow source, this does not successfully time out. This bug does not happen for the released versions of tensorflow (.11, .12).\nTo run:\n(python script.py 1 worker > /tmp/output 2>&1 &) && (python script.py 0 ps > /tmp/output2 2>&1 &) && python script.py 0 worker\nwhere script.py is the above example.", "body": "### What related GitHub issues or StackOverflow threads have you found by searching the web for your problem? None\r\n\r\n### Environment info\r\nOperating System: Ubuntu\r\n\r\nInstalled version of CUDA and cuDNN: \r\n(please attach the output of `ls -l /path/to/cuda/lib/libcud*`): CPU only\r\n\r\nIf installed from source, provide \r\n\r\n1. The commit hash (`git rev-parse HEAD`)  \r\n\r\nc32663d119a4cbd9d4926d4eed2a0705f03a57f9\r\n\r\n2. The output of `bazel version` \r\n\r\nExtracting Bazel installation...\r\nBuild label: 0.4.3\r\nBuild target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\r\nBuild time: Thu Dec 22 12:31:25 2016 (1482409885)\r\nBuild timestamp: 1482409885\r\nBuild timestamp as int: 1482409885\r\n\r\n### If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\r\n\r\n```python\r\nfrom __future__ import absolute_import\r\nfrom __future__ import division\r\nfrom __future__ import print_function\r\n\r\nfrom datetime import datetime\r\nimport os.path\r\nimport time\r\n\r\nimport numpy as np\r\nimport random\r\nimport tensorflow as tf\r\n\r\nimport signal\r\nimport sys\r\nimport os\r\n\r\nfrom tensorflow.python.framework import ops\r\nfrom tensorflow.python.ops import variables\r\nfrom tensorflow.python.ops import state_ops\r\nfrom tensorflow.python.ops import logging_ops\r\nfrom tensorflow.python.client import timeline\r\n\r\nfrom tensorflow.python.ops import data_flow_ops\r\n\r\n# (python test 1 worker > /tmp/output 2>&1 &) && (python test 0 ps > /tmp/output2 2>&1 &) && python test 0 worker\r\n\r\ntry:\r\n\r\n    index, job = int(sys.argv[1]), sys.argv[2]\r\n\r\n\r\n    ps_hosts = 'localhost:1234'\r\n    worker_hosts = 'localhost:1235,localhost:1236'\r\n    ps_hosts = ps_hosts.split(\",\")\r\n    worker_hosts = worker_hosts.split(\",\")\r\n\r\n    cluster_spec = tf.train.ClusterSpec({'ps' : ps_hosts, 'worker' : worker_hosts})\r\n    server = tf.train.Server(\r\n\t{'ps': ps_hosts,\r\n         'worker': worker_hosts},\r\n\tjob_name=job,\r\n\ttask_index=index)\r\n\r\n    a = data_flow_ops.FIFOQueue(-1, tf.float32)\r\n    b = a.dequeue()\r\n    sv = tf.train.Supervisor(is_chief=True, logdir='./test_logdir')\r\n    cfg = tf.ConfigProto(\r\n\tallow_soft_placement=True,\r\n\tlog_device_placement=False)\r\n    sess = sv.prepare_or_wait_for_session(server.target, config=cfg)\r\n    print(\"Testing timeout\")\r\n    opt = tf.RunOptions(timeout_in_ms=50)\r\n    sess.run(b, options=opt)\r\nexcept tf.errors.DeadlineExceededError:\r\n    print(\"Successfully timed out!\")\r\n```\r\n\r\nAbove I create a cluster and get a session from the server. I then try to dequeue an empty FIFOQueue with a timeout of 1 second. For some reason, on the latest commits of the tensorflow source, this does not successfully time out. This bug does not happen for the released versions of tensorflow (.11, .12).\r\n\r\nTo run:\r\n`(python script.py 1 worker > /tmp/output 2>&1 &) && (python script.py 0 ps > /tmp/output2 2>&1 &) && python script.py 0 worker`\r\n\r\nwhere script.py is the above example."}