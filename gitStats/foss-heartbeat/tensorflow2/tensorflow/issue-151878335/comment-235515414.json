{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/235515414", "html_url": "https://github.com/tensorflow/tensorflow/issues/2169#issuecomment-235515414", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/2169", "id": 235515414, "node_id": "MDEyOklzc3VlQ29tbWVudDIzNTUxNTQxNA==", "user": {"login": "syed-ahmed", "id": 8906225, "node_id": "MDQ6VXNlcjg5MDYyMjU=", "avatar_url": "https://avatars1.githubusercontent.com/u/8906225?v=4", "gravatar_id": "", "url": "https://api.github.com/users/syed-ahmed", "html_url": "https://github.com/syed-ahmed", "followers_url": "https://api.github.com/users/syed-ahmed/followers", "following_url": "https://api.github.com/users/syed-ahmed/following{/other_user}", "gists_url": "https://api.github.com/users/syed-ahmed/gists{/gist_id}", "starred_url": "https://api.github.com/users/syed-ahmed/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/syed-ahmed/subscriptions", "organizations_url": "https://api.github.com/users/syed-ahmed/orgs", "repos_url": "https://api.github.com/users/syed-ahmed/repos", "events_url": "https://api.github.com/users/syed-ahmed/events{/privacy}", "received_events_url": "https://api.github.com/users/syed-ahmed/received_events", "type": "User", "site_admin": false}, "created_at": "2016-07-27T08:06:00Z", "updated_at": "2016-07-27T14:57:22Z", "author_association": "CONTRIBUTOR", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=70511\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/girving\">@girving</a> Thanks for your reply. I am defining a MaxUnpoolGrad for the corresponding MaxUnpool operation that I have implemented. Following is what I declare as top_offset and bottom_offset for MaxUnpoolGrad:</p>\n<pre><code>const int top_offset = params.tensor_in_rows * params.tensor_in_cols * params.depth; \nconst int bottom_offset = params.out_height * params.out_width * params.depth;\n</code></pre>\n<p>The correspoding cuda kernel declared in maxpooling_op_gpu.cu.cc is:</p>\n<pre><code>template &lt;typename dtype&gt;\n__global__ void MaxUnpoolBackward(const int nthreads, const dtype* top_diff,\n                                          const int64* mask, const int top_offset,\n                                  const int bottom_offset, dtype* bottom_diff) {\n  CUDA_1D_KERNEL_LOOP(index, nthreads) {\n    int image_id = (index / bottom_offset);\n    CudaAtomicAdd(bottom_diff + index, top_diff[mask[index] + image_id * top_offset]);\n  }\n}\n</code></pre>\n<p>My graph builds but it is when the session runs that I get the following error:</p>\n<pre><code>E tensorflow/stream_executor/cuda/cuda_driver.cc:1110] failed to synchronize the stop event: CUDA_ERROR_ILLEGAL_ADDRESS\nE tensorflow/stream_executor/cuda/cuda_timer.cc:54] Internal: error destroying CUDA event in context 0x69951c0: CUDA_ERROR_ILLEGAL_ADDRESS\nE tensorflow/stream_executor/cuda/cuda_timer.cc:59] Internal: error destroying CUDA event in context 0x69951c0: CUDA_ERROR_ILLEGAL_ADDRESS\nF tensorflow/stream_executor/cuda/cuda_timer.cc:64] Check failed: start_event_ != nullptr &amp;&amp; stop_event_ != nullptr \n</code></pre>\n<p>I am also returning in nn_grad.py like this:</p>\n<pre><code>[None, gen_nn_ops._max_unpool_grad(array_ops.shape(op.inputs[1]),\n                                     grad,\n                                     op.inputs[2],\n                                     op.get_attr(\"ksize\"),\n                                     op.get_attr(\"strides\"),\n                                     padding=op.get_attr(\"padding\")), None)]\n</code></pre>\n<p>where:</p>\n<pre><code>MaxUnpool\n-input0: input_shape\n-input1: grad_in\n-input3: argmax\n</code></pre>\n<p>I have made sure the maxunpooling and its grad operation is taking a input shape rather than a input 4D tensor. Do you know how to debug this cuda errors/any tool that can help in finding the origin of these errors? What does these errors indicate? I read a comment on the maxpooling_op_gpu.cu.cc about racing conditions. Is it anyhow related to this?</p>", "body_text": "@girving Thanks for your reply. I am defining a MaxUnpoolGrad for the corresponding MaxUnpool operation that I have implemented. Following is what I declare as top_offset and bottom_offset for MaxUnpoolGrad:\nconst int top_offset = params.tensor_in_rows * params.tensor_in_cols * params.depth; \nconst int bottom_offset = params.out_height * params.out_width * params.depth;\n\nThe correspoding cuda kernel declared in maxpooling_op_gpu.cu.cc is:\ntemplate <typename dtype>\n__global__ void MaxUnpoolBackward(const int nthreads, const dtype* top_diff,\n                                          const int64* mask, const int top_offset,\n                                  const int bottom_offset, dtype* bottom_diff) {\n  CUDA_1D_KERNEL_LOOP(index, nthreads) {\n    int image_id = (index / bottom_offset);\n    CudaAtomicAdd(bottom_diff + index, top_diff[mask[index] + image_id * top_offset]);\n  }\n}\n\nMy graph builds but it is when the session runs that I get the following error:\nE tensorflow/stream_executor/cuda/cuda_driver.cc:1110] failed to synchronize the stop event: CUDA_ERROR_ILLEGAL_ADDRESS\nE tensorflow/stream_executor/cuda/cuda_timer.cc:54] Internal: error destroying CUDA event in context 0x69951c0: CUDA_ERROR_ILLEGAL_ADDRESS\nE tensorflow/stream_executor/cuda/cuda_timer.cc:59] Internal: error destroying CUDA event in context 0x69951c0: CUDA_ERROR_ILLEGAL_ADDRESS\nF tensorflow/stream_executor/cuda/cuda_timer.cc:64] Check failed: start_event_ != nullptr && stop_event_ != nullptr \n\nI am also returning in nn_grad.py like this:\n[None, gen_nn_ops._max_unpool_grad(array_ops.shape(op.inputs[1]),\n                                     grad,\n                                     op.inputs[2],\n                                     op.get_attr(\"ksize\"),\n                                     op.get_attr(\"strides\"),\n                                     padding=op.get_attr(\"padding\")), None)]\n\nwhere:\nMaxUnpool\n-input0: input_shape\n-input1: grad_in\n-input3: argmax\n\nI have made sure the maxunpooling and its grad operation is taking a input shape rather than a input 4D tensor. Do you know how to debug this cuda errors/any tool that can help in finding the origin of these errors? What does these errors indicate? I read a comment on the maxpooling_op_gpu.cu.cc about racing conditions. Is it anyhow related to this?", "body": "@girving Thanks for your reply. I am defining a MaxUnpoolGrad for the corresponding MaxUnpool operation that I have implemented. Following is what I declare as top_offset and bottom_offset for MaxUnpoolGrad:\n\n```\nconst int top_offset = params.tensor_in_rows * params.tensor_in_cols * params.depth; \nconst int bottom_offset = params.out_height * params.out_width * params.depth;\n```\n\nThe correspoding cuda kernel declared in maxpooling_op_gpu.cu.cc is:\n\n```\ntemplate <typename dtype>\n__global__ void MaxUnpoolBackward(const int nthreads, const dtype* top_diff,\n                                          const int64* mask, const int top_offset,\n                                  const int bottom_offset, dtype* bottom_diff) {\n  CUDA_1D_KERNEL_LOOP(index, nthreads) {\n    int image_id = (index / bottom_offset);\n    CudaAtomicAdd(bottom_diff + index, top_diff[mask[index] + image_id * top_offset]);\n  }\n}\n```\n\nMy graph builds but it is when the session runs that I get the following error:\n\n```\nE tensorflow/stream_executor/cuda/cuda_driver.cc:1110] failed to synchronize the stop event: CUDA_ERROR_ILLEGAL_ADDRESS\nE tensorflow/stream_executor/cuda/cuda_timer.cc:54] Internal: error destroying CUDA event in context 0x69951c0: CUDA_ERROR_ILLEGAL_ADDRESS\nE tensorflow/stream_executor/cuda/cuda_timer.cc:59] Internal: error destroying CUDA event in context 0x69951c0: CUDA_ERROR_ILLEGAL_ADDRESS\nF tensorflow/stream_executor/cuda/cuda_timer.cc:64] Check failed: start_event_ != nullptr && stop_event_ != nullptr \n```\n\nI am also returning in nn_grad.py like this:\n\n```\n[None, gen_nn_ops._max_unpool_grad(array_ops.shape(op.inputs[1]),\n                                     grad,\n                                     op.inputs[2],\n                                     op.get_attr(\"ksize\"),\n                                     op.get_attr(\"strides\"),\n                                     padding=op.get_attr(\"padding\")), None)]\n```\n\nwhere:\n\n```\nMaxUnpool\n-input0: input_shape\n-input1: grad_in\n-input3: argmax\n```\n\nI have made sure the maxunpooling and its grad operation is taking a input shape rather than a input 4D tensor. Do you know how to debug this cuda errors/any tool that can help in finding the origin of these errors? What does these errors indicate? I read a comment on the maxpooling_op_gpu.cu.cc about racing conditions. Is it anyhow related to this?\n"}