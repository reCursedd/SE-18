{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22827", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22827/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22827/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22827/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/22827", "id": 368048976, "node_id": "MDU6SXNzdWUzNjgwNDg5NzY=", "number": 22827, "title": "tensorflow c++ api session->Run segv for batch size>1", "user": {"login": "luochao436", "id": 4225206, "node_id": "MDQ6VXNlcjQyMjUyMDY=", "avatar_url": "https://avatars3.githubusercontent.com/u/4225206?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luochao436", "html_url": "https://github.com/luochao436", "followers_url": "https://api.github.com/users/luochao436/followers", "following_url": "https://api.github.com/users/luochao436/following{/other_user}", "gists_url": "https://api.github.com/users/luochao436/gists{/gist_id}", "starred_url": "https://api.github.com/users/luochao436/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luochao436/subscriptions", "organizations_url": "https://api.github.com/users/luochao436/orgs", "repos_url": "https://api.github.com/users/luochao436/repos", "events_url": "https://api.github.com/users/luochao436/events{/privacy}", "received_events_url": "https://api.github.com/users/luochao436/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "ymodak", "id": 42785357, "node_id": "MDQ6VXNlcjQyNzg1MzU3", "avatar_url": "https://avatars1.githubusercontent.com/u/42785357?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ymodak", "html_url": "https://github.com/ymodak", "followers_url": "https://api.github.com/users/ymodak/followers", "following_url": "https://api.github.com/users/ymodak/following{/other_user}", "gists_url": "https://api.github.com/users/ymodak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ymodak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ymodak/subscriptions", "organizations_url": "https://api.github.com/users/ymodak/orgs", "repos_url": "https://api.github.com/users/ymodak/repos", "events_url": "https://api.github.com/users/ymodak/events{/privacy}", "received_events_url": "https://api.github.com/users/ymodak/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ymodak", "id": 42785357, "node_id": "MDQ6VXNlcjQyNzg1MzU3", "avatar_url": "https://avatars1.githubusercontent.com/u/42785357?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ymodak", "html_url": "https://github.com/ymodak", "followers_url": "https://api.github.com/users/ymodak/followers", "following_url": "https://api.github.com/users/ymodak/following{/other_user}", "gists_url": "https://api.github.com/users/ymodak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ymodak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ymodak/subscriptions", "organizations_url": "https://api.github.com/users/ymodak/orgs", "repos_url": "https://api.github.com/users/ymodak/repos", "events_url": "https://api.github.com/users/ymodak/events{/privacy}", "received_events_url": "https://api.github.com/users/ymodak/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2018-10-09T05:43:58Z", "updated_at": "2018-10-15T19:13:42Z", "closed_at": "2018-10-15T19:13:42Z", "author_association": "NONE", "body_html": "<p>Hi,</p>\n<p>i build tensorflow 1.4.0 to .so and call c++ session api Run to predict, when the input batch size is 1, the  Run api works well, but  batch_size    &gt; 1, the Run will segv as follows:</p>\n<p><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"115915395\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/12\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/12/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/12\">#12</a> 0x00002b12e0122c72 in tensorflow::LaunchMatMulBase&lt;Eigen::ThreadPoolDevice, float&gt;::launch(tensorflow::OpKernelContext*, tensorflow::Tensor const&amp;, tensorflow::Tensor const&amp;, Eigen::array&lt;Eigen::IndexPair, 1ul&gt; const&amp;, std::vector&lt;long long, std::allocator &gt;<em>, bool, tensorflow::Tensor</em>) () from lib/64bit/libtensorflow_cc.so<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"115918299\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/13\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/tensorflow/tensorflow/pull/13/hovercard\" href=\"https://github.com/tensorflow/tensorflow/pull/13\">#13</a> 0x00002b12e0123231 in tensorflow::MatMulOp&lt;Eigen::ThreadPoolDevice, float, false&gt;::Compute(tensorflow::OpKernelContext*) () from lib/64bit/libtensorflow_cc.so<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"115918464\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/14\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/14/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/14\">#14</a> 0x00002b12e20e6a4c in tensorflow::ThreadPoolDevice::Compute(tensorflow::OpKernel*, tensorflow::OpKernelContext*) () from lib/64bit/libtensorflow_framework.so<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"115922135\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/15\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/15/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/15\">#15</a> 0x00002b12e20b7669 in tensorflow::(anonymous namespace)::ExecutorState::Process(tensorflow::(anonymous namespace)::ExecutorState::TaggedNode, long long) () from lib/64bit/libtensorflow_framework.so<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"115925923\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/16\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/16/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/16\">#16</a> 0x00002b12e20a6290 in std::_Function_handler&lt;void ()(), std::_Bind&lt;std::_Mem_fn&lt;void (tensorflow::(anonymous namespace)::ExecutorState::<em>)(tensorflow::(anonymous namespace)::ExecutorState::TaggedNode, long long)&gt; ()(tensorflow::(anonymous namespace)::ExecutorState</em>, tensorflow::(anonymous namespace)::ExecutorState::TaggedNode, long long)&gt; &gt;::_M_invoke(std::_Any_data const&amp;) () from lib/64bit/libtensorflow_framework.so<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"115925964\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/17\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/17/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/17\">#17</a> 0x00002b12e1d576b7 in Eigen::NonBlockingThreadPoolTempltensorflow::thread::EigenEnvironment::WorkerLoop(int) () from lib/64bit/libtensorflow_framework.so<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"115926208\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/18\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/18/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/18\">#18</a> 0x00002b12e1d565a2 in std::_Function_handler&lt;void ()(), tensorflow::thread::EigenEnvironment::CreateThread(std::function&lt;void ()()&gt;)::{lambda()<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"115886302\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/1\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/1/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/1\">#1</a>}&gt;::_M_invoke(std::_Any_data const&amp;) () from lib/64bit/libtensorflow_framework.so<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"115926362\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/19\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/19/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/19\">#19</a> 0x00002b12e7726f50 in execute_native_thread_routine_compat () from /icd/dlsh_t2b/luther/tf.integ2.dev/tools.lnx86/lib/64bit/libstdc++.so.6<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"115927762\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/20\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/20/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/20\">#20</a> 0x0000000004385269 in create_head(void*) ()<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"115927987\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/21\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/21/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/21\">#21</a> 0x00002b12e71309d1 in start_thread () from /lib64/libpthread.so.0</p>\n<p>*** Stack trace in log file.<br>\nfree model<br>\nterminate called after throwing an instance of 'std::system_error'<br>\nwhat():  Resource deadlock avoided</p>\n<p>the predict code :<br>\nstd::vectortensorflow::Tensor outputs;<br>\ntensorflow::Status run_status = session_-&gt;Run({input},{model_outputs_name_}, {}, &amp;outputs);</p>\n<p>After i upgrade tensorflow to 1.8.0, crash too, please help to review this issue.</p>\n<p>chao</p>", "body_text": "Hi,\ni build tensorflow 1.4.0 to .so and call c++ session api Run to predict, when the input batch size is 1, the  Run api works well, but  batch_size    > 1, the Run will segv as follows:\n#12 0x00002b12e0122c72 in tensorflow::LaunchMatMulBase<Eigen::ThreadPoolDevice, float>::launch(tensorflow::OpKernelContext*, tensorflow::Tensor const&, tensorflow::Tensor const&, Eigen::array<Eigen::IndexPair, 1ul> const&, std::vector<long long, std::allocator >, bool, tensorflow::Tensor) () from lib/64bit/libtensorflow_cc.so\n#13 0x00002b12e0123231 in tensorflow::MatMulOp<Eigen::ThreadPoolDevice, float, false>::Compute(tensorflow::OpKernelContext*) () from lib/64bit/libtensorflow_cc.so\n#14 0x00002b12e20e6a4c in tensorflow::ThreadPoolDevice::Compute(tensorflow::OpKernel*, tensorflow::OpKernelContext*) () from lib/64bit/libtensorflow_framework.so\n#15 0x00002b12e20b7669 in tensorflow::(anonymous namespace)::ExecutorState::Process(tensorflow::(anonymous namespace)::ExecutorState::TaggedNode, long long) () from lib/64bit/libtensorflow_framework.so\n#16 0x00002b12e20a6290 in std::_Function_handler<void ()(), std::_Bind<std::_Mem_fn<void (tensorflow::(anonymous namespace)::ExecutorState::)(tensorflow::(anonymous namespace)::ExecutorState::TaggedNode, long long)> ()(tensorflow::(anonymous namespace)::ExecutorState, tensorflow::(anonymous namespace)::ExecutorState::TaggedNode, long long)> >::_M_invoke(std::_Any_data const&) () from lib/64bit/libtensorflow_framework.so\n#17 0x00002b12e1d576b7 in Eigen::NonBlockingThreadPoolTempltensorflow::thread::EigenEnvironment::WorkerLoop(int) () from lib/64bit/libtensorflow_framework.so\n#18 0x00002b12e1d565a2 in std::_Function_handler<void ()(), tensorflow::thread::EigenEnvironment::CreateThread(std::function<void ()()>)::{lambda()#1}>::_M_invoke(std::_Any_data const&) () from lib/64bit/libtensorflow_framework.so\n#19 0x00002b12e7726f50 in execute_native_thread_routine_compat () from /icd/dlsh_t2b/luther/tf.integ2.dev/tools.lnx86/lib/64bit/libstdc++.so.6\n#20 0x0000000004385269 in create_head(void*) ()\n#21 0x00002b12e71309d1 in start_thread () from /lib64/libpthread.so.0\n*** Stack trace in log file.\nfree model\nterminate called after throwing an instance of 'std::system_error'\nwhat():  Resource deadlock avoided\nthe predict code :\nstd::vectortensorflow::Tensor outputs;\ntensorflow::Status run_status = session_->Run({input},{model_outputs_name_}, {}, &outputs);\nAfter i upgrade tensorflow to 1.8.0, crash too, please help to review this issue.\nchao", "body": "Hi,\r\n\r\n  i build tensorflow 1.4.0 to .so and call c++ session api Run to predict, when the input batch size is 1, the  Run api works well, but  batch_size    > 1, the Run will segv as follows:\r\n\r\n\r\n#12 0x00002b12e0122c72 in tensorflow::LaunchMatMulBase<Eigen::ThreadPoolDevice, float>::launch(tensorflow::OpKernelContext*, tensorflow::Tensor const&, tensorflow::Tensor const&, Eigen::array<Eigen::IndexPair<long>, 1ul> const&, std::vector<long long, std::allocator<long long> >*, bool, tensorflow::Tensor*) () from lib/64bit/libtensorflow_cc.so                                                                                                                                 \r\n#13 0x00002b12e0123231 in tensorflow::MatMulOp<Eigen::ThreadPoolDevice, float, false>::Compute(tensorflow::OpKernelContext*) () from lib/64bit/libtensorflow_cc.so                                                                                                                                           \r\n#14 0x00002b12e20e6a4c in tensorflow::ThreadPoolDevice::Compute(tensorflow::OpKernel*, tensorflow::OpKernelContext*) () from lib/64bit/libtensorflow_framework.so                                                                                                                                            \r\n#15 0x00002b12e20b7669 in tensorflow::(anonymous namespace)::ExecutorState::Process(tensorflow::(anonymous namespace)::ExecutorState::TaggedNode, long long) () from lib/64bit/libtensorflow_framework.so                                                                                                    \r\n#16 0x00002b12e20a6290 in std::_Function_handler<void ()(), std::_Bind<std::_Mem_fn<void (tensorflow::(anonymous namespace)::ExecutorState::*)(tensorflow::(anonymous namespace)::ExecutorState::TaggedNode, long long)> ()(tensorflow::(anonymous namespace)::ExecutorState*, tensorflow::(anonymous namespace)::ExecutorState::TaggedNode, long long)> >::_M_invoke(std::_Any_data const&) () from lib/64bit/libtensorflow_framework.so                                                  \r\n#17 0x00002b12e1d576b7 in Eigen::NonBlockingThreadPoolTempl<tensorflow::thread::EigenEnvironment>::WorkerLoop(int) () from lib/64bit/libtensorflow_framework.so                                                                                                                                              \r\n#18 0x00002b12e1d565a2 in std::_Function_handler<void ()(), tensorflow::thread::EigenEnvironment::CreateThread(std::function<void ()()>)::{lambda()#1}>::_M_invoke(std::_Any_data const&) () from lib/64bit/libtensorflow_framework.so                                                                       \r\n#19 0x00002b12e7726f50 in execute_native_thread_routine_compat () from /icd/dlsh_t2b/luther/tf.integ2.dev/tools.lnx86/lib/64bit/libstdc++.so.6                                \r\n#20 0x0000000004385269 in create_head(void*) ()                                                                                                                               \r\n#21 0x00002b12e71309d1 in start_thread () from /lib64/libpthread.so.0        \r\n    \r\n*** Stack trace in log file.\r\nfree model\r\nterminate called after throwing an instance of 'std::system_error'\r\n  what():  Resource deadlock avoided\r\n\r\n\r\n\r\nthe predict code :\r\n   std::vector<tensorflow::Tensor> outputs;\r\n    tensorflow::Status run_status = session_->Run({input},{model_outputs_name_}, {}, &outputs);\r\n\r\nAfter i upgrade tensorflow to 1.8.0, crash too, please help to review this issue.\r\n\r\nchao\r\n"}