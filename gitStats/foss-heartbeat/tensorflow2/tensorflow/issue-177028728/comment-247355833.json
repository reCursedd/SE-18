{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/247355833", "html_url": "https://github.com/tensorflow/tensorflow/issues/4387#issuecomment-247355833", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/4387", "id": 247355833, "node_id": "MDEyOklzc3VlQ29tbWVudDI0NzM1NTgzMw==", "user": {"login": "prb12", "id": 11547801, "node_id": "MDQ6VXNlcjExNTQ3ODAx", "avatar_url": "https://avatars1.githubusercontent.com/u/11547801?v=4", "gravatar_id": "", "url": "https://api.github.com/users/prb12", "html_url": "https://github.com/prb12", "followers_url": "https://api.github.com/users/prb12/followers", "following_url": "https://api.github.com/users/prb12/following{/other_user}", "gists_url": "https://api.github.com/users/prb12/gists{/gist_id}", "starred_url": "https://api.github.com/users/prb12/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/prb12/subscriptions", "organizations_url": "https://api.github.com/users/prb12/orgs", "repos_url": "https://api.github.com/users/prb12/repos", "events_url": "https://api.github.com/users/prb12/events{/privacy}", "received_events_url": "https://api.github.com/users/prb12/received_events", "type": "User", "site_admin": false}, "created_at": "2016-09-15T15:07:41Z", "updated_at": "2016-09-15T17:29:31Z", "author_association": "MEMBER", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=2342391\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/yuanbyu\">@yuanbyu</a> can probably clarify- but it does seem like you are executing the loop condition on the GPU. This is always going to be very inefficient since the host needs to know the output of the condition before it can dispatch the loop body for the next iteration.</p>\n<p>By making the condition function use integers you are effectively causing it to be executed on the CPU - there is a special case for integer ops assigned to /gpu:0 to compute on tensors kept in host memory.  This avoids the memcpyD2H and having to sync against the GPU stream each iteration.</p>\n<p>Having said that - all of the performance numbers in your post look <strong>way</strong> too large to me!</p>\n<p>PS <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=456665\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/kbrems\">@kbrems</a> TF Version 0.10rc0 had some nasty performance regressions.  I don't believe any of them would affect this code, but I would definitely advise updating to the release 0.10</p>", "body_text": "@yuanbyu can probably clarify- but it does seem like you are executing the loop condition on the GPU. This is always going to be very inefficient since the host needs to know the output of the condition before it can dispatch the loop body for the next iteration.\nBy making the condition function use integers you are effectively causing it to be executed on the CPU - there is a special case for integer ops assigned to /gpu:0 to compute on tensors kept in host memory.  This avoids the memcpyD2H and having to sync against the GPU stream each iteration.\nHaving said that - all of the performance numbers in your post look way too large to me!\nPS @kbrems TF Version 0.10rc0 had some nasty performance regressions.  I don't believe any of them would affect this code, but I would definitely advise updating to the release 0.10", "body": "@yuanbyu can probably clarify- but it does seem like you are executing the loop condition on the GPU. This is always going to be very inefficient since the host needs to know the output of the condition before it can dispatch the loop body for the next iteration.\n\nBy making the condition function use integers you are effectively causing it to be executed on the CPU - there is a special case for integer ops assigned to /gpu:0 to compute on tensors kept in host memory.  This avoids the memcpyD2H and having to sync against the GPU stream each iteration.\n\nHaving said that - all of the performance numbers in your post look **way** too large to me! \n\nPS @kbrems TF Version 0.10rc0 had some nasty performance regressions.  I don't believe any of them would affect this code, but I would definitely advise updating to the release 0.10\n"}