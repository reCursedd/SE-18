{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22322", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22322/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22322/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/22322/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/22322", "id": 361007355, "node_id": "MDU6SXNzdWUzNjEwMDczNTU=", "number": 22322, "title": "Error compiling/importing a custom (GPU) op on Windows w/ Bazel and TF r1.11", "user": {"login": "Sergio0694", "id": 10199417, "node_id": "MDQ6VXNlcjEwMTk5NDE3", "avatar_url": "https://avatars3.githubusercontent.com/u/10199417?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Sergio0694", "html_url": "https://github.com/Sergio0694", "followers_url": "https://api.github.com/users/Sergio0694/followers", "following_url": "https://api.github.com/users/Sergio0694/following{/other_user}", "gists_url": "https://api.github.com/users/Sergio0694/gists{/gist_id}", "starred_url": "https://api.github.com/users/Sergio0694/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Sergio0694/subscriptions", "organizations_url": "https://api.github.com/users/Sergio0694/orgs", "repos_url": "https://api.github.com/users/Sergio0694/repos", "events_url": "https://api.github.com/users/Sergio0694/events{/privacy}", "received_events_url": "https://api.github.com/users/Sergio0694/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 404586594, "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower", "name": "stat:awaiting tensorflower", "color": "f4b400", "default": false}, {"id": 473173351, "node_id": "MDU6TGFiZWw0NzMxNzMzNTE=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:build/install", "name": "type:build/install", "color": "159b2e", "default": false}], "state": "open", "locked": false, "assignee": {"login": "azaks2", "id": 40365382, "node_id": "MDQ6VXNlcjQwMzY1Mzgy", "avatar_url": "https://avatars2.githubusercontent.com/u/40365382?v=4", "gravatar_id": "", "url": "https://api.github.com/users/azaks2", "html_url": "https://github.com/azaks2", "followers_url": "https://api.github.com/users/azaks2/followers", "following_url": "https://api.github.com/users/azaks2/following{/other_user}", "gists_url": "https://api.github.com/users/azaks2/gists{/gist_id}", "starred_url": "https://api.github.com/users/azaks2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/azaks2/subscriptions", "organizations_url": "https://api.github.com/users/azaks2/orgs", "repos_url": "https://api.github.com/users/azaks2/repos", "events_url": "https://api.github.com/users/azaks2/events{/privacy}", "received_events_url": "https://api.github.com/users/azaks2/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "azaks2", "id": 40365382, "node_id": "MDQ6VXNlcjQwMzY1Mzgy", "avatar_url": "https://avatars2.githubusercontent.com/u/40365382?v=4", "gravatar_id": "", "url": "https://api.github.com/users/azaks2", "html_url": "https://github.com/azaks2", "followers_url": "https://api.github.com/users/azaks2/followers", "following_url": "https://api.github.com/users/azaks2/following{/other_user}", "gists_url": "https://api.github.com/users/azaks2/gists{/gist_id}", "starred_url": "https://api.github.com/users/azaks2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/azaks2/subscriptions", "organizations_url": "https://api.github.com/users/azaks2/orgs", "repos_url": "https://api.github.com/users/azaks2/repos", "events_url": "https://api.github.com/users/azaks2/events{/privacy}", "received_events_url": "https://api.github.com/users/azaks2/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2018-09-17T19:22:21Z", "updated_at": "2018-11-15T19:04:44Z", "closed_at": null, "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: Yes</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Windows 10 Pro x64 17134.x</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: binary, w/ Bazel</li>\n<li><strong>TensorFlow version (use command below)</strong>: r1.11</li>\n<li><strong>Python version</strong>: 3.6.5 x64</li>\n<li><strong>Bazel version (if compiling from source)</strong>: 17.1</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: VS 2015 C++ tools</li>\n<li><strong>CUDA/cuDNN version</strong>: CUDA 9.0, cuDNN 7</li>\n<li><strong>GPU model and memory</strong>: GTX1080</li>\n<li><strong>Exact command to reproduce</strong>: see below</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>I saw that the support for building TF on Windows with Bazel has been added recently, so I followed the <a href=\"https://www.tensorflow.org/install/install_sources_windows\" rel=\"nofollow\">official docs</a> and proceeded to setup my environment, clone TF r1.11 and build the library (with GPU support) to make sure everything was compiling fine. This worked without issues, so that's something.</p>\n<p>Then, I tried to compile a custom GPU op following the <a href=\"https://www.tensorflow.org/extend/adding_an_op#compile_the_op_using_bazel_tensorflow_source_installation\" rel=\"nofollow\">docs here</a> and hit a roadblock. I'm not sure if this is officially supported yet, but since I saw you guys added the ability to load user ops on Windows too a while back (plus the fact that building TF on Windows now works fine), it seemed plausible at this point.</p>\n<p>I wrote a dummy GPU op (code <a href=\"https://gist.github.com/Sergio0694/2b463571e6f82519137e9785caf90b08\">here</a> and kernel <a href=\"https://gist.github.com/Sergio0694/48a5bb39ea92494371b3c847d23d09f6\">here</a>) and used the <code>BUILD</code> script as explained in the docs (replacing <code>.so</code> with <code>.dll</code>), but the build failed with the <a href=\"https://gist.github.com/Sergio0694/3f379c9007fa2abd588dac5be0fe996e\">this output log</a>.</p>\n<p>I also tried to build the included <code>fact.cc</code> op (replacing <code>.so</code> again with <code>.dll</code>), which compiled fine (as that op is CPU only), but when I tried to import the module into TF it failed with the usual \"can't find entry point in dynamic library...\" error.</p>\n<p>So here are my two questions:</p>\n<ol>\n<li>Is there an official statement about the ability to build GPU ops on Windows, now that TF supports building the rest of the library on Windows?</li>\n<li>If so (I mean, the whole TF library builds just fine, so I guess I'm just doing something wrong here), what's the right procedure to build a custom GPU op on Windows with Bazel? Would it be possible to update the docs so that every TF user on Windows would be able to do the same as well?</li>\n</ol>\n<p>Thanks! <g-emoji class=\"g-emoji\" alias=\"smile\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f604.png\">\ud83d\ude04</g-emoji></p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Windows 10 Pro x64 17134.x\nTensorFlow installed from (source or binary): binary, w/ Bazel\nTensorFlow version (use command below): r1.11\nPython version: 3.6.5 x64\nBazel version (if compiling from source): 17.1\nGCC/Compiler version (if compiling from source): VS 2015 C++ tools\nCUDA/cuDNN version: CUDA 9.0, cuDNN 7\nGPU model and memory: GTX1080\nExact command to reproduce: see below\n\nDescribe the problem\nI saw that the support for building TF on Windows with Bazel has been added recently, so I followed the official docs and proceeded to setup my environment, clone TF r1.11 and build the library (with GPU support) to make sure everything was compiling fine. This worked without issues, so that's something.\nThen, I tried to compile a custom GPU op following the docs here and hit a roadblock. I'm not sure if this is officially supported yet, but since I saw you guys added the ability to load user ops on Windows too a while back (plus the fact that building TF on Windows now works fine), it seemed plausible at this point.\nI wrote a dummy GPU op (code here and kernel here) and used the BUILD script as explained in the docs (replacing .so with .dll), but the build failed with the this output log.\nI also tried to build the included fact.cc op (replacing .so again with .dll), which compiled fine (as that op is CPU only), but when I tried to import the module into TF it failed with the usual \"can't find entry point in dynamic library...\" error.\nSo here are my two questions:\n\nIs there an official statement about the ability to build GPU ops on Windows, now that TF supports building the rest of the library on Windows?\nIf so (I mean, the whole TF library builds just fine, so I guess I'm just doing something wrong here), what's the right procedure to build a custom GPU op on Windows with Bazel? Would it be possible to update the docs so that every TF user on Windows would be able to do the same as well?\n\nThanks! \ud83d\ude04", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: Yes\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Windows 10 Pro x64 17134.x\r\n- **TensorFlow installed from (source or binary)**: binary, w/ Bazel\r\n- **TensorFlow version (use command below)**: r1.11\r\n- **Python version**: 3.6.5 x64\r\n- **Bazel version (if compiling from source)**: 17.1\r\n- **GCC/Compiler version (if compiling from source)**: VS 2015 C++ tools\r\n- **CUDA/cuDNN version**: CUDA 9.0, cuDNN 7\r\n- **GPU model and memory**: GTX1080\r\n- **Exact command to reproduce**: see below\r\n\r\n### Describe the problem\r\nI saw that the support for building TF on Windows with Bazel has been added recently, so I followed the [official docs](https://www.tensorflow.org/install/install_sources_windows) and proceeded to setup my environment, clone TF r1.11 and build the library (with GPU support) to make sure everything was compiling fine. This worked without issues, so that's something.\r\n\r\nThen, I tried to compile a custom GPU op following the [docs here](https://www.tensorflow.org/extend/adding_an_op#compile_the_op_using_bazel_tensorflow_source_installation) and hit a roadblock. I'm not sure if this is officially supported yet, but since I saw you guys added the ability to load user ops on Windows too a while back (plus the fact that building TF on Windows now works fine), it seemed plausible at this point.\r\n\r\nI wrote a dummy GPU op (code [here](https://gist.github.com/Sergio0694/2b463571e6f82519137e9785caf90b08) and kernel [here](https://gist.github.com/Sergio0694/48a5bb39ea92494371b3c847d23d09f6)) and used the `BUILD` script as explained in the docs (replacing `.so` with `.dll`), but the build failed with the [this output log](https://gist.github.com/Sergio0694/3f379c9007fa2abd588dac5be0fe996e).\r\n\r\nI also tried to build the included `fact.cc` op (replacing `.so` again with `.dll`), which compiled fine (as that op is CPU only), but when I tried to import the module into TF it failed with the usual \"can't find entry point in dynamic library...\" error.\r\n\r\nSo here are my two questions:\r\n1) Is there an official statement about the ability to build GPU ops on Windows, now that TF supports building the rest of the library on Windows?\r\n2) If so (I mean, the whole TF library builds just fine, so I guess I'm just doing something wrong here), what's the right procedure to build a custom GPU op on Windows with Bazel? Would it be possible to update the docs so that every TF user on Windows would be able to do the same as well?\r\n\r\nThanks! \ud83d\ude04\r\n"}