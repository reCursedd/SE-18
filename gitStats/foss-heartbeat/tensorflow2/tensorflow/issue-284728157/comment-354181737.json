{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/354181737", "html_url": "https://github.com/tensorflow/tensorflow/issues/15655#issuecomment-354181737", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/15655", "id": 354181737, "node_id": "MDEyOklzc3VlQ29tbWVudDM1NDE4MTczNw==", "user": {"login": "facaiy", "id": 1112263, "node_id": "MDQ6VXNlcjExMTIyNjM=", "avatar_url": "https://avatars3.githubusercontent.com/u/1112263?v=4", "gravatar_id": "", "url": "https://api.github.com/users/facaiy", "html_url": "https://github.com/facaiy", "followers_url": "https://api.github.com/users/facaiy/followers", "following_url": "https://api.github.com/users/facaiy/following{/other_user}", "gists_url": "https://api.github.com/users/facaiy/gists{/gist_id}", "starred_url": "https://api.github.com/users/facaiy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/facaiy/subscriptions", "organizations_url": "https://api.github.com/users/facaiy/orgs", "repos_url": "https://api.github.com/users/facaiy/repos", "events_url": "https://api.github.com/users/facaiy/events{/privacy}", "received_events_url": "https://api.github.com/users/facaiy/received_events", "type": "User", "site_admin": false}, "created_at": "2017-12-27T21:40:37Z", "updated_at": "2017-12-28T23:16:24Z", "author_association": "MEMBER", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1780466\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/bodokaiser\">@bodokaiser</a> Yes, it seems that batch_size=None will raise the exception here.</p>\n<p><div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom bg-gray-light\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/tensorflow/tensorflow/blob/996ae8e750e8abd18166b40559043a88d7bdc1ce/tensorflow/python/layers/convolutional.py#L181-L187\">tensorflow/tensorflow/python/layers/convolutional.py</a>\n    </p>\n    <p class=\"mb-0 text-gray-light\">\n        Lines 181 to 187\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/tensorflow/tensorflow/commit/996ae8e750e8abd18166b40559043a88d7bdc1ce\">996ae8e</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L181\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"181\"></td>\n          <td id=\"LC181\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> outputs_shape <span class=\"pl-k\">=</span> outputs.shape.as_list() </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L182\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"182\"></td>\n          <td id=\"LC182\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> outputs_4d <span class=\"pl-k\">=</span> array_ops.reshape(outputs, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L183\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"183\"></td>\n          <td id=\"LC183\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">                                [outputs_shape[<span class=\"pl-c1\">0</span>], outputs_shape[<span class=\"pl-c1\">1</span>], </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L184\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"184\"></td>\n          <td id=\"LC184\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">                                 outputs_shape[<span class=\"pl-c1\">2</span>] <span class=\"pl-k\">*</span> outputs_shape[<span class=\"pl-c1\">3</span>], </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L185\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"185\"></td>\n          <td id=\"LC185\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\">                                 outputs_shape[<span class=\"pl-c1\">4</span>]]) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L186\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"186\"></td>\n          <td id=\"LC186\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> outputs_4d <span class=\"pl-k\">=</span> nn.bias_add(outputs_4d, <span class=\"pl-c1\">self</span>.bias, <span class=\"pl-v\">data_format</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>NCHW<span class=\"pl-pds\">'</span></span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L187\" class=\"blob-num border-0 px-3 py-0 bg-white js-line-number\" data-line-number=\"187\"></td>\n          <td id=\"LC187\" class=\"blob-code border-0 px-3 py-0 bg-white blob-code-inner js-file-line\"> outputs <span class=\"pl-k\">=</span> array_ops.reshape(outputs_4d, outputs_shape) </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>\n<p>I agree that casting <code>None</code> to <code>-1</code> could solve the problem, however it would be better if we could find a general solution, say, to use dynamic shape? Sorry that I have no good idea, let's wait for reply from tensorflowers.</p>", "body_text": "@bodokaiser Yes, it seems that batch_size=None will raise the exception here.\n\n  \n    \n      tensorflow/tensorflow/python/layers/convolutional.py\n    \n    \n        Lines 181 to 187\n      in\n      996ae8e\n    \n    \n    \n    \n\n        \n          \n           outputs_shape = outputs.shape.as_list() \n        \n\n        \n          \n           outputs_4d = array_ops.reshape(outputs, \n        \n\n        \n          \n                                          [outputs_shape[0], outputs_shape[1], \n        \n\n        \n          \n                                           outputs_shape[2] * outputs_shape[3], \n        \n\n        \n          \n                                           outputs_shape[4]]) \n        \n\n        \n          \n           outputs_4d = nn.bias_add(outputs_4d, self.bias, data_format='NCHW') \n        \n\n        \n          \n           outputs = array_ops.reshape(outputs_4d, outputs_shape) \n        \n    \n  \n\n\nI agree that casting None to -1 could solve the problem, however it would be better if we could find a general solution, say, to use dynamic shape? Sorry that I have no good idea, let's wait for reply from tensorflowers.", "body": "@bodokaiser Yes, it seems that batch_size=None will raise the exception here.\r\n\r\nhttps://github.com/tensorflow/tensorflow/blob/996ae8e750e8abd18166b40559043a88d7bdc1ce/tensorflow/python/layers/convolutional.py#L181-L187\r\n\r\nI agree that casting `None` to `-1` could solve the problem, however it would be better if we could find a general solution, say, to use dynamic shape? Sorry that I have no good idea, let's wait for reply from tensorflowers."}