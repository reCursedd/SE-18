{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23643", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23643/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23643/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/23643/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/23643", "id": 379388181, "node_id": "MDU6SXNzdWUzNzkzODgxODE=", "number": 23643, "title": "Mapping to a shuffled dataset yields an unmatched dataset in order.", "user": {"login": "iohara", "id": 20789469, "node_id": "MDQ6VXNlcjIwNzg5NDY5", "avatar_url": "https://avatars2.githubusercontent.com/u/20789469?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iohara", "html_url": "https://github.com/iohara", "followers_url": "https://api.github.com/users/iohara/followers", "following_url": "https://api.github.com/users/iohara/following{/other_user}", "gists_url": "https://api.github.com/users/iohara/gists{/gist_id}", "starred_url": "https://api.github.com/users/iohara/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iohara/subscriptions", "organizations_url": "https://api.github.com/users/iohara/orgs", "repos_url": "https://api.github.com/users/iohara/repos", "events_url": "https://api.github.com/users/iohara/events{/privacy}", "received_events_url": "https://api.github.com/users/iohara/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2018-11-10T04:08:43Z", "updated_at": "2018-11-14T22:05:17Z", "closed_at": "2018-11-13T02:53:53Z", "author_association": "NONE", "body_html": "<p><strong>System information</strong></p>\n<ul>\n<li>Have I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes</li>\n<li>OS Platform and Distribution : Linux Ubuntu 16.04.5 LTS (Xenial Xerus)</li>\n<li>Mobile device if the issue happens on mobile device: None</li>\n<li>TensorFlow installed from (source or binary): source</li>\n<li>TensorFlow version (use command below): v1.10.1-0-g4dcfddc</li>\n<li>Python version: Python 3.6.5</li>\n<li>Bazel version (if compiling from source): 0.16.1</li>\n<li>GCC/Compiler version (if compiling from source): 5.4.0-6ubuntu1~16.04.10</li>\n<li>CUDA/cuDNN version: V9.0.176/7.1.4.18</li>\n<li>GPU model and memory: GeForce GTX 1080 Ti with 12GB memory</li>\n</ul>\n<p><strong>Describe the current behavior</strong><br>\ndatasetB does not correspond to the order of shuffled dataset A.</p>\n<p><strong>Describe the expected behavior</strong><br>\ndatasetB is expected to correspond to the order of shuffled dataset A.</p>\n<p><strong>Code to reproduce the issue</strong><br>\nThe code below</p>\n<pre><code>import tensorflow as tf\nfrom tensorflow.data import Dataset\ntf.enable_eager_execution()\n\ndataset_A = Dataset.range(10).shuffle(10)\ndataset_B = dataset_A.map(lambda x: x * 2)\ndataset = Dataset.zip((dataset_A, dataset_B))\nfor data_A, data_B in dataset:\n    print(data_A, data_B)\n</code></pre>\n<p>produces a unmatched dataset in order.</p>\n<pre><code>tf.Tensor(1, shape=(), dtype=int64) tf.Tensor(8, shape=(), dtype=int64)\ntf.Tensor(8, shape=(), dtype=int64) tf.Tensor(14, shape=(), dtype=int64)\ntf.Tensor(3, shape=(), dtype=int64) tf.Tensor(12, shape=(), dtype=int64)\ntf.Tensor(6, shape=(), dtype=int64) tf.Tensor(16, shape=(), dtype=int64)\ntf.Tensor(0, shape=(), dtype=int64) tf.Tensor(18, shape=(), dtype=int64)\ntf.Tensor(2, shape=(), dtype=int64) tf.Tensor(2, shape=(), dtype=int64)\ntf.Tensor(4, shape=(), dtype=int64) tf.Tensor(10, shape=(), dtype=int64)\ntf.Tensor(7, shape=(), dtype=int64) tf.Tensor(4, shape=(), dtype=int64)\ntf.Tensor(9, shape=(), dtype=int64) tf.Tensor(0, shape=(), dtype=int64)\ntf.Tensor(5, shape=(), dtype=int64) tf.Tensor(6, shape=(), dtype=int64)\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes\nOS Platform and Distribution : Linux Ubuntu 16.04.5 LTS (Xenial Xerus)\nMobile device if the issue happens on mobile device: None\nTensorFlow installed from (source or binary): source\nTensorFlow version (use command below): v1.10.1-0-g4dcfddc\nPython version: Python 3.6.5\nBazel version (if compiling from source): 0.16.1\nGCC/Compiler version (if compiling from source): 5.4.0-6ubuntu1~16.04.10\nCUDA/cuDNN version: V9.0.176/7.1.4.18\nGPU model and memory: GeForce GTX 1080 Ti with 12GB memory\n\nDescribe the current behavior\ndatasetB does not correspond to the order of shuffled dataset A.\nDescribe the expected behavior\ndatasetB is expected to correspond to the order of shuffled dataset A.\nCode to reproduce the issue\nThe code below\nimport tensorflow as tf\nfrom tensorflow.data import Dataset\ntf.enable_eager_execution()\n\ndataset_A = Dataset.range(10).shuffle(10)\ndataset_B = dataset_A.map(lambda x: x * 2)\ndataset = Dataset.zip((dataset_A, dataset_B))\nfor data_A, data_B in dataset:\n    print(data_A, data_B)\n\nproduces a unmatched dataset in order.\ntf.Tensor(1, shape=(), dtype=int64) tf.Tensor(8, shape=(), dtype=int64)\ntf.Tensor(8, shape=(), dtype=int64) tf.Tensor(14, shape=(), dtype=int64)\ntf.Tensor(3, shape=(), dtype=int64) tf.Tensor(12, shape=(), dtype=int64)\ntf.Tensor(6, shape=(), dtype=int64) tf.Tensor(16, shape=(), dtype=int64)\ntf.Tensor(0, shape=(), dtype=int64) tf.Tensor(18, shape=(), dtype=int64)\ntf.Tensor(2, shape=(), dtype=int64) tf.Tensor(2, shape=(), dtype=int64)\ntf.Tensor(4, shape=(), dtype=int64) tf.Tensor(10, shape=(), dtype=int64)\ntf.Tensor(7, shape=(), dtype=int64) tf.Tensor(4, shape=(), dtype=int64)\ntf.Tensor(9, shape=(), dtype=int64) tf.Tensor(0, shape=(), dtype=int64)\ntf.Tensor(5, shape=(), dtype=int64) tf.Tensor(6, shape=(), dtype=int64)", "body": "**System information**\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes\r\n- OS Platform and Distribution : Linux Ubuntu 16.04.5 LTS (Xenial Xerus)\r\n- Mobile device if the issue happens on mobile device: None\r\n- TensorFlow installed from (source or binary): source\r\n- TensorFlow version (use command below): v1.10.1-0-g4dcfddc\r\n- Python version: Python 3.6.5\r\n- Bazel version (if compiling from source): 0.16.1\r\n- GCC/Compiler version (if compiling from source): 5.4.0-6ubuntu1~16.04.10\r\n- CUDA/cuDNN version: V9.0.176/7.1.4.18\r\n- GPU model and memory: GeForce GTX 1080 Ti with 12GB memory\r\n\r\n**Describe the current behavior**\r\ndatasetB does not correspond to the order of shuffled dataset A.\r\n\r\n**Describe the expected behavior**\r\ndatasetB is expected to correspond to the order of shuffled dataset A.\r\n\r\n**Code to reproduce the issue**\r\nThe code below\r\n```\r\nimport tensorflow as tf\r\nfrom tensorflow.data import Dataset\r\ntf.enable_eager_execution()\r\n\r\ndataset_A = Dataset.range(10).shuffle(10)\r\ndataset_B = dataset_A.map(lambda x: x * 2)\r\ndataset = Dataset.zip((dataset_A, dataset_B))\r\nfor data_A, data_B in dataset:\r\n    print(data_A, data_B)\r\n```\r\nproduces a unmatched dataset in order.\r\n```\r\ntf.Tensor(1, shape=(), dtype=int64) tf.Tensor(8, shape=(), dtype=int64)\r\ntf.Tensor(8, shape=(), dtype=int64) tf.Tensor(14, shape=(), dtype=int64)\r\ntf.Tensor(3, shape=(), dtype=int64) tf.Tensor(12, shape=(), dtype=int64)\r\ntf.Tensor(6, shape=(), dtype=int64) tf.Tensor(16, shape=(), dtype=int64)\r\ntf.Tensor(0, shape=(), dtype=int64) tf.Tensor(18, shape=(), dtype=int64)\r\ntf.Tensor(2, shape=(), dtype=int64) tf.Tensor(2, shape=(), dtype=int64)\r\ntf.Tensor(4, shape=(), dtype=int64) tf.Tensor(10, shape=(), dtype=int64)\r\ntf.Tensor(7, shape=(), dtype=int64) tf.Tensor(4, shape=(), dtype=int64)\r\ntf.Tensor(9, shape=(), dtype=int64) tf.Tensor(0, shape=(), dtype=int64)\r\ntf.Tensor(5, shape=(), dtype=int64) tf.Tensor(6, shape=(), dtype=int64)\r\n```"}