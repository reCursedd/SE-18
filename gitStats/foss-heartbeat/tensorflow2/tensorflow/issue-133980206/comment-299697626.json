{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/299697626", "html_url": "https://github.com/tensorflow/tensorflow/issues/1122#issuecomment-299697626", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/1122", "id": 299697626, "node_id": "MDEyOklzc3VlQ29tbWVudDI5OTY5NzYyNg==", "user": {"login": "MisayaZ", "id": 16910475, "node_id": "MDQ6VXNlcjE2OTEwNDc1", "avatar_url": "https://avatars2.githubusercontent.com/u/16910475?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MisayaZ", "html_url": "https://github.com/MisayaZ", "followers_url": "https://api.github.com/users/MisayaZ/followers", "following_url": "https://api.github.com/users/MisayaZ/following{/other_user}", "gists_url": "https://api.github.com/users/MisayaZ/gists{/gist_id}", "starred_url": "https://api.github.com/users/MisayaZ/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MisayaZ/subscriptions", "organizations_url": "https://api.github.com/users/MisayaZ/orgs", "repos_url": "https://api.github.com/users/MisayaZ/repos", "events_url": "https://api.github.com/users/MisayaZ/events{/privacy}", "received_events_url": "https://api.github.com/users/MisayaZ/received_events", "type": "User", "site_admin": false}, "created_at": "2017-05-07T10:52:56Z", "updated_at": "2017-05-07T10:54:58Z", "author_association": "NONE", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=1766524\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/sguada\">@sguada</a> Thanks, I build a network with bathnorm which is implemented as you mentioned above</p>\n<pre><code>z = batch_norm(x, decay=0.9, center=False, scale=True, updates_collections=None, \n                             is_training=train_phase, scope=scope_bn)\n</code></pre>\n<p>the speed is slow, I use tensorflow benchmark to get the computation time as below:<br>\nI tensorflow/core/util/stat_summarizer.cc:392] ============================== Top by Computation Time ==============================<br>\nI tensorflow/core/util/stat_summarizer.cc:392] \t             [node type]\t  [start]\t  [first]\t [avg ms]\t     [%]\t  [cdf%]\t  [mem KB]\t[Name]<br>\nI tensorflow/core/util/stat_summarizer.cc:392] \t                  Conv2D\t  106.164\t   51.354\t   51.004\t 23.145%\t 23.145%\t   692.224\tconv8/Conv2D<br>\nI tensorflow/core/util/stat_summarizer.cc:392] \t                  Conv2D\t   85.187\t   19.115\t   19.283\t  8.750%\t 31.896%\t   692.224\tconv7/Conv2D<br>\nI tensorflow/core/util/stat_summarizer.cc:392] \t       SquaredDifference\t   11.967\t   15.105\t   14.331\t  6.503%\t 38.399%\t 11075.584\tconv1/batch_norm/moments/sufficient_statistics/SquaredDifference<br>\nI tensorflow/core/util/stat_summarizer.cc:392] \t                     Mul\t   11.970\t   14.162\t   13.495\t  6.124%\t 44.523%\t 11075.584\tconv1/batch_norm/batchnorm/mul_1<br>\nI tensorflow/core/util/stat_summarizer.cc:392] \t                  Conv2D\t    3.948\t    8.170\t    7.986\t  3.624%\t 48.146%\t 11075.584\tconv1/Conv2D<br>\nI tensorflow/core/util/stat_summarizer.cc:392] \t                     Sub\t   11.960\t   10.176\t    7.943\t  3.604%\t 51.751%\t 11075.584\tconv1/batch_norm/moments/sufficient_statistics/Sub<br>\nI tensorflow/core/util/stat_summarizer.cc:392] \t       SquaredDifference\t   45.570\t    5.908\t    7.177\t  3.257%\t 55.007%\t  5537.792\tconv2/batch_norm/moments/sufficient_statistics/SquaredDifference<br>\nI tensorflow/core/util/stat_summarizer.cc:392] \t                     Mul\t   45.574\t    7.755\t    6.902\t  3.132%\t 58.140%\t  5537.792\tconv2/batch_norm/batchnorm/mul_1<br>\nI tensorflow/core/util/stat_summarizer.cc:392] \t                  Conv2D\t   40.692\t    5.408\t    4.845\t  2.199%\t 60.338%\t  5537.792\tconv2/Conv2D<br>\nI tensorflow/core/util/stat_summarizer.cc:392] \t                     Sub\t   45.563\t    6.067\t    4.784\t  2.171%\t 62.509%\t  5537.792\tcon</p>\n<p>I don't understand why some op in moment are executed during test and it cost a lot of time, such as conv1/batch_norm/moments/sufficient_statistics/SquaredDifference.</p>\n<p>The moment is not needed in test, why are some ops under moment executed?</p>", "body_text": "@sguada Thanks, I build a network with bathnorm which is implemented as you mentioned above\nz = batch_norm(x, decay=0.9, center=False, scale=True, updates_collections=None, \n                             is_training=train_phase, scope=scope_bn)\n\nthe speed is slow, I use tensorflow benchmark to get the computation time as below:\nI tensorflow/core/util/stat_summarizer.cc:392] ============================== Top by Computation Time ==============================\nI tensorflow/core/util/stat_summarizer.cc:392] \t             [node type]\t  [start]\t  [first]\t [avg ms]\t     [%]\t  [cdf%]\t  [mem KB]\t[Name]\nI tensorflow/core/util/stat_summarizer.cc:392] \t                  Conv2D\t  106.164\t   51.354\t   51.004\t 23.145%\t 23.145%\t   692.224\tconv8/Conv2D\nI tensorflow/core/util/stat_summarizer.cc:392] \t                  Conv2D\t   85.187\t   19.115\t   19.283\t  8.750%\t 31.896%\t   692.224\tconv7/Conv2D\nI tensorflow/core/util/stat_summarizer.cc:392] \t       SquaredDifference\t   11.967\t   15.105\t   14.331\t  6.503%\t 38.399%\t 11075.584\tconv1/batch_norm/moments/sufficient_statistics/SquaredDifference\nI tensorflow/core/util/stat_summarizer.cc:392] \t                     Mul\t   11.970\t   14.162\t   13.495\t  6.124%\t 44.523%\t 11075.584\tconv1/batch_norm/batchnorm/mul_1\nI tensorflow/core/util/stat_summarizer.cc:392] \t                  Conv2D\t    3.948\t    8.170\t    7.986\t  3.624%\t 48.146%\t 11075.584\tconv1/Conv2D\nI tensorflow/core/util/stat_summarizer.cc:392] \t                     Sub\t   11.960\t   10.176\t    7.943\t  3.604%\t 51.751%\t 11075.584\tconv1/batch_norm/moments/sufficient_statistics/Sub\nI tensorflow/core/util/stat_summarizer.cc:392] \t       SquaredDifference\t   45.570\t    5.908\t    7.177\t  3.257%\t 55.007%\t  5537.792\tconv2/batch_norm/moments/sufficient_statistics/SquaredDifference\nI tensorflow/core/util/stat_summarizer.cc:392] \t                     Mul\t   45.574\t    7.755\t    6.902\t  3.132%\t 58.140%\t  5537.792\tconv2/batch_norm/batchnorm/mul_1\nI tensorflow/core/util/stat_summarizer.cc:392] \t                  Conv2D\t   40.692\t    5.408\t    4.845\t  2.199%\t 60.338%\t  5537.792\tconv2/Conv2D\nI tensorflow/core/util/stat_summarizer.cc:392] \t                     Sub\t   45.563\t    6.067\t    4.784\t  2.171%\t 62.509%\t  5537.792\tcon\nI don't understand why some op in moment are executed during test and it cost a lot of time, such as conv1/batch_norm/moments/sufficient_statistics/SquaredDifference.\nThe moment is not needed in test, why are some ops under moment executed?", "body": "@sguada Thanks, I build a network with bathnorm which is implemented as you mentioned above\r\n```\r\nz = batch_norm(x, decay=0.9, center=False, scale=True, updates_collections=None, \r\n                             is_training=train_phase, scope=scope_bn)\r\n```\r\nthe speed is slow, I use tensorflow benchmark to get the computation time as below:\r\nI tensorflow/core/util/stat_summarizer.cc:392] ============================== Top by Computation Time ==============================\r\nI tensorflow/core/util/stat_summarizer.cc:392] \t             [node type]\t  [start]\t  [first]\t [avg ms]\t     [%]\t  [cdf%]\t  [mem KB]\t[Name]\r\nI tensorflow/core/util/stat_summarizer.cc:392] \t                  Conv2D\t  106.164\t   51.354\t   51.004\t 23.145%\t 23.145%\t   692.224\tconv8/Conv2D\r\nI tensorflow/core/util/stat_summarizer.cc:392] \t                  Conv2D\t   85.187\t   19.115\t   19.283\t  8.750%\t 31.896%\t   692.224\tconv7/Conv2D\r\nI tensorflow/core/util/stat_summarizer.cc:392] \t       SquaredDifference\t   11.967\t   15.105\t   14.331\t  6.503%\t 38.399%\t 11075.584\tconv1/batch_norm/moments/sufficient_statistics/SquaredDifference\r\nI tensorflow/core/util/stat_summarizer.cc:392] \t                     Mul\t   11.970\t   14.162\t   13.495\t  6.124%\t 44.523%\t 11075.584\tconv1/batch_norm/batchnorm/mul_1\r\nI tensorflow/core/util/stat_summarizer.cc:392] \t                  Conv2D\t    3.948\t    8.170\t    7.986\t  3.624%\t 48.146%\t 11075.584\tconv1/Conv2D\r\nI tensorflow/core/util/stat_summarizer.cc:392] \t                     Sub\t   11.960\t   10.176\t    7.943\t  3.604%\t 51.751%\t 11075.584\tconv1/batch_norm/moments/sufficient_statistics/Sub\r\nI tensorflow/core/util/stat_summarizer.cc:392] \t       SquaredDifference\t   45.570\t    5.908\t    7.177\t  3.257%\t 55.007%\t  5537.792\tconv2/batch_norm/moments/sufficient_statistics/SquaredDifference\r\nI tensorflow/core/util/stat_summarizer.cc:392] \t                     Mul\t   45.574\t    7.755\t    6.902\t  3.132%\t 58.140%\t  5537.792\tconv2/batch_norm/batchnorm/mul_1\r\nI tensorflow/core/util/stat_summarizer.cc:392] \t                  Conv2D\t   40.692\t    5.408\t    4.845\t  2.199%\t 60.338%\t  5537.792\tconv2/Conv2D\r\nI tensorflow/core/util/stat_summarizer.cc:392] \t                     Sub\t   45.563\t    6.067\t    4.784\t  2.171%\t 62.509%\t  5537.792\tcon\r\n\r\nI don't understand why some op in moment are executed during test and it cost a lot of time, such as conv1/batch_norm/moments/sufficient_statistics/SquaredDifference.\r\n\r\nThe moment is not needed in test, why are some ops under moment executed?\r\n"}