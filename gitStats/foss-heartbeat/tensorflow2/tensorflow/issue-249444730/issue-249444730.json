{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12188", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12188/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12188/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12188/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/12188", "id": 249444730, "node_id": "MDU6SXNzdWUyNDk0NDQ3MzA=", "number": 12188, "title": "learner.run Couldn't find trained model", "user": {"login": "nikky78", "id": 29562101, "node_id": "MDQ6VXNlcjI5NTYyMTAx", "avatar_url": "https://avatars1.githubusercontent.com/u/29562101?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikky78", "html_url": "https://github.com/nikky78", "followers_url": "https://api.github.com/users/nikky78/followers", "following_url": "https://api.github.com/users/nikky78/following{/other_user}", "gists_url": "https://api.github.com/users/nikky78/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikky78/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikky78/subscriptions", "organizations_url": "https://api.github.com/users/nikky78/orgs", "repos_url": "https://api.github.com/users/nikky78/repos", "events_url": "https://api.github.com/users/nikky78/events{/privacy}", "received_events_url": "https://api.github.com/users/nikky78/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-08-10T19:02:09Z", "updated_at": "2017-08-15T00:13:33Z", "closed_at": "2017-08-15T00:13:33Z", "author_association": "NONE", "body_html": "<p>I have built my custom experiment like this:</p>\n<pre><code>def experiment_fn(run_config, hparams):\n    hooks = [\n        tf.train.CheckpointSaverHook ( \n            checkpoint_dir = run_config.model_dir,\n            save_steps = 5,\n        ), \n        \n        tf.train.SummarySaverHook ( \n            save_steps = 5, \n            output_dir = run_config.model_dir, \n            scaffold= tf.train.Scaffold(),\n            summary_op=tf.summary.merge_all()\n        )\n    ]\n    \n    return learn.Experiment (\n        estimator = learn.Estimator (\n            model_fn = model_fn, \n            config = run_config,\n            params = hparams\n        ),\n        train_input_fn = lambda: input_fun(train_set),\n        eval_input_fn = lambda: input_fun(eval_set),\n        eval_metrics = model_eval_metrics(),\n        train_steps = 20,\n        train_monitors = hooks,\n        eval_hooks = hooks,\n        min_eval_frequency = 1,\n        export_strategies = saved_model_export_utils.make_export_strategy (\n            serving_input_fn = serving_input_fn,\n        )\n    )\n</code></pre>\n<pre><code>learn_runner.run (\n    experiment_fn = experiment_fn,\n    run_config = tf.contrib.learn.RunConfig (\n        model_dir = output_dir,\n    ),\n    schedule = \"train_and_evaluate\",\n    hparams =  tf.contrib.training.HParams (\n        ...some parameters...\n    )\n)\n</code></pre>\n<p>When I run it, I have files created in \\model with names like 'model.ckpt-6.meta' plus the monitor shows the following results:</p>\n<blockquote>\n<p>Monitors are deprecated. Please use tf.train.SessionRunHook.<br>\nINFO:tensorflow:step = 1, loss = 0.0437659<br>\nINFO:tensorflow:Saving checkpoints for 1 into model\\model.ckpt.<br>\nINFO:tensorflow:Saving checkpoints for 6 into model\\model.ckpt.<br>\nINFO:tensorflow:Saving checkpoints for 11 into model\\model.ckpt.<br>\nINFO:tensorflow:Saving checkpoints for 16 into model\\model.ckpt.<br>\nINFO:tensorflow:Saving checkpoints for 20 into model\\model.ckpt.<br>\nINFO:tensorflow:Loss for final step: 0.0438498.</p>\n</blockquote>\n<blockquote>\n<hr>\n<p>NotFittedError                            Traceback (most recent call last)<br>\n in ()<br>\n177         learning_rate = 0.01,<br>\n178         decay_rate = 0.96,<br>\n--&gt; 179         decay_steps = 10<br>\n180     )<br>\n181 )</p>\n<p>C:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\learn_runner.py in run(experiment_fn, output_dir, schedule, run_config, hparams)<br>\n208   schedule = schedule or _get_default_schedule(run_config)<br>\n209<br>\n--&gt; 210   return _execute_schedule(experiment, schedule)<br>\n211<br>\n212</p>\n<p>C:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\learn_runner.py in _execute_schedule(experiment, schedule)<br>\n45     logging.error('Allowed values for this experiment are: %s', valid_tasks)<br>\n46     raise TypeError('Schedule references non-callable member %s' % schedule)<br>\n---&gt; 47   return task()<br>\n48<br>\n49</p>\n<p>C:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\experiment.py in train_and_evaluate(self)<br>\n499                                       metrics=self._eval_metrics,<br>\n500                                       name=eval_dir_suffix,<br>\n--&gt; 501                                       hooks=self._eval_hooks)<br>\n502     export_results = self._maybe_export(eval_result)<br>\n503     return eval_result, export_results</p>\n<p>C:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\experiment.py in _call_evaluate(self, _sentinel, input_fn, steps, metrics, name, checkpoint_path, hooks)<br>\n686                                       name=name,<br>\n687                                       checkpoint_path=checkpoint_path,<br>\n--&gt; 688                                       hooks=hooks)<br>\n689<br>\n690</p>\n<p>C:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py in new_func(*args, **kwargs)<br>\n287             'in a future version' if date is None else ('after %s' % date),<br>\n288             instructions)<br>\n--&gt; 289       return func(*args, **kwargs)<br>\n290     return tf_decorator.make_decorator(func, new_func, 'deprecated',<br>\n291                                        _add_deprecated_arg_notice_to_docstring(</p>\n<p>C:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\estimators\\estimator.py in evaluate(self, x, y, input_fn, feed_fn, batch_size, steps, metrics, name, checkpoint_path, hooks, log_progress)<br>\n541         checkpoint_path=checkpoint_path,<br>\n542         hooks=hooks,<br>\n--&gt; 543         log_progress=log_progress)<br>\n544<br>\n545     if eval_results is not None:</p>\n<p>C:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\estimators\\estimator.py in _evaluate_model(self, input_fn, steps, feed_fn, metrics, name, checkpoint_path, hooks, log_progress)<br>\n814       if not latest_path:<br>\n815         raise NotFittedError(\"Couldn't find trained model at %s.\"<br>\n--&gt; 816                              % self._model_dir)<br>\n817       checkpoint_path = latest_path<br>\n818</p>\n<p>NotFittedError: Couldn't find trained model at \\model.</p>\n</blockquote>\n<p>Why it cannot find the model ?</p>\n<p>Thanks for assistance!</p>", "body_text": "I have built my custom experiment like this:\ndef experiment_fn(run_config, hparams):\n    hooks = [\n        tf.train.CheckpointSaverHook ( \n            checkpoint_dir = run_config.model_dir,\n            save_steps = 5,\n        ), \n        \n        tf.train.SummarySaverHook ( \n            save_steps = 5, \n            output_dir = run_config.model_dir, \n            scaffold= tf.train.Scaffold(),\n            summary_op=tf.summary.merge_all()\n        )\n    ]\n    \n    return learn.Experiment (\n        estimator = learn.Estimator (\n            model_fn = model_fn, \n            config = run_config,\n            params = hparams\n        ),\n        train_input_fn = lambda: input_fun(train_set),\n        eval_input_fn = lambda: input_fun(eval_set),\n        eval_metrics = model_eval_metrics(),\n        train_steps = 20,\n        train_monitors = hooks,\n        eval_hooks = hooks,\n        min_eval_frequency = 1,\n        export_strategies = saved_model_export_utils.make_export_strategy (\n            serving_input_fn = serving_input_fn,\n        )\n    )\n\nlearn_runner.run (\n    experiment_fn = experiment_fn,\n    run_config = tf.contrib.learn.RunConfig (\n        model_dir = output_dir,\n    ),\n    schedule = \"train_and_evaluate\",\n    hparams =  tf.contrib.training.HParams (\n        ...some parameters...\n    )\n)\n\nWhen I run it, I have files created in \\model with names like 'model.ckpt-6.meta' plus the monitor shows the following results:\n\nMonitors are deprecated. Please use tf.train.SessionRunHook.\nINFO:tensorflow:step = 1, loss = 0.0437659\nINFO:tensorflow:Saving checkpoints for 1 into model\\model.ckpt.\nINFO:tensorflow:Saving checkpoints for 6 into model\\model.ckpt.\nINFO:tensorflow:Saving checkpoints for 11 into model\\model.ckpt.\nINFO:tensorflow:Saving checkpoints for 16 into model\\model.ckpt.\nINFO:tensorflow:Saving checkpoints for 20 into model\\model.ckpt.\nINFO:tensorflow:Loss for final step: 0.0438498.\n\n\n\nNotFittedError                            Traceback (most recent call last)\n in ()\n177         learning_rate = 0.01,\n178         decay_rate = 0.96,\n--> 179         decay_steps = 10\n180     )\n181 )\nC:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\learn_runner.py in run(experiment_fn, output_dir, schedule, run_config, hparams)\n208   schedule = schedule or _get_default_schedule(run_config)\n209\n--> 210   return _execute_schedule(experiment, schedule)\n211\n212\nC:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\learn_runner.py in _execute_schedule(experiment, schedule)\n45     logging.error('Allowed values for this experiment are: %s', valid_tasks)\n46     raise TypeError('Schedule references non-callable member %s' % schedule)\n---> 47   return task()\n48\n49\nC:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\experiment.py in train_and_evaluate(self)\n499                                       metrics=self._eval_metrics,\n500                                       name=eval_dir_suffix,\n--> 501                                       hooks=self._eval_hooks)\n502     export_results = self._maybe_export(eval_result)\n503     return eval_result, export_results\nC:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\experiment.py in _call_evaluate(self, _sentinel, input_fn, steps, metrics, name, checkpoint_path, hooks)\n686                                       name=name,\n687                                       checkpoint_path=checkpoint_path,\n--> 688                                       hooks=hooks)\n689\n690\nC:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py in new_func(*args, **kwargs)\n287             'in a future version' if date is None else ('after %s' % date),\n288             instructions)\n--> 289       return func(*args, **kwargs)\n290     return tf_decorator.make_decorator(func, new_func, 'deprecated',\n291                                        _add_deprecated_arg_notice_to_docstring(\nC:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\estimators\\estimator.py in evaluate(self, x, y, input_fn, feed_fn, batch_size, steps, metrics, name, checkpoint_path, hooks, log_progress)\n541         checkpoint_path=checkpoint_path,\n542         hooks=hooks,\n--> 543         log_progress=log_progress)\n544\n545     if eval_results is not None:\nC:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\estimators\\estimator.py in _evaluate_model(self, input_fn, steps, feed_fn, metrics, name, checkpoint_path, hooks, log_progress)\n814       if not latest_path:\n815         raise NotFittedError(\"Couldn't find trained model at %s.\"\n--> 816                              % self._model_dir)\n817       checkpoint_path = latest_path\n818\nNotFittedError: Couldn't find trained model at \\model.\n\nWhy it cannot find the model ?\nThanks for assistance!", "body": "I have built my custom experiment like this:\r\n\r\n```\r\ndef experiment_fn(run_config, hparams):\r\n    hooks = [\r\n        tf.train.CheckpointSaverHook ( \r\n            checkpoint_dir = run_config.model_dir,\r\n            save_steps = 5,\r\n        ), \r\n        \r\n        tf.train.SummarySaverHook ( \r\n            save_steps = 5, \r\n            output_dir = run_config.model_dir, \r\n            scaffold= tf.train.Scaffold(),\r\n            summary_op=tf.summary.merge_all()\r\n        )\r\n    ]\r\n    \r\n    return learn.Experiment (\r\n        estimator = learn.Estimator (\r\n            model_fn = model_fn, \r\n            config = run_config,\r\n            params = hparams\r\n        ),\r\n        train_input_fn = lambda: input_fun(train_set),\r\n        eval_input_fn = lambda: input_fun(eval_set),\r\n        eval_metrics = model_eval_metrics(),\r\n        train_steps = 20,\r\n        train_monitors = hooks,\r\n        eval_hooks = hooks,\r\n        min_eval_frequency = 1,\r\n        export_strategies = saved_model_export_utils.make_export_strategy (\r\n            serving_input_fn = serving_input_fn,\r\n        )\r\n    )\r\n```\r\n\r\n```\r\nlearn_runner.run (\r\n    experiment_fn = experiment_fn,\r\n    run_config = tf.contrib.learn.RunConfig (\r\n        model_dir = output_dir,\r\n    ),\r\n    schedule = \"train_and_evaluate\",\r\n    hparams =  tf.contrib.training.HParams (\r\n        ...some parameters...\r\n    )\r\n)\r\n```\r\n\r\nWhen I run it, I have files created in \\model with names like 'model.ckpt-6.meta' plus the monitor shows the following results:\r\n\r\n> Monitors are deprecated. Please use tf.train.SessionRunHook.\r\n> INFO:tensorflow:step = 1, loss = 0.0437659\r\n> INFO:tensorflow:Saving checkpoints for 1 into model\\model.ckpt.\r\n> INFO:tensorflow:Saving checkpoints for 6 into model\\model.ckpt.\r\n> INFO:tensorflow:Saving checkpoints for 11 into model\\model.ckpt.\r\n> INFO:tensorflow:Saving checkpoints for 16 into model\\model.ckpt.\r\n> INFO:tensorflow:Saving checkpoints for 20 into model\\model.ckpt.\r\n> INFO:tensorflow:Loss for final step: 0.0438498.\r\n\r\n> ---------------------------------------------------------------------------\r\n> NotFittedError                            Traceback (most recent call last)\r\n> <ipython-input-3-4a9282b8a5f5> in <module>()\r\n>     177         learning_rate = 0.01,\r\n>     178         decay_rate = 0.96,\r\n> --> 179         decay_steps = 10\r\n>     180     )\r\n>     181 )\r\n> \r\n> C:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\learn_runner.py in run(experiment_fn, output_dir, schedule, run_config, hparams)\r\n>     208   schedule = schedule or _get_default_schedule(run_config)\r\n>     209 \r\n> --> 210   return _execute_schedule(experiment, schedule)\r\n>     211 \r\n>     212 \r\n> \r\n> C:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\learn_runner.py in _execute_schedule(experiment, schedule)\r\n>      45     logging.error('Allowed values for this experiment are: %s', valid_tasks)\r\n>      46     raise TypeError('Schedule references non-callable member %s' % schedule)\r\n> ---> 47   return task()\r\n>      48 \r\n>      49 \r\n> \r\n> C:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\experiment.py in train_and_evaluate(self)\r\n>     499                                       metrics=self._eval_metrics,\r\n>     500                                       name=eval_dir_suffix,\r\n> --> 501                                       hooks=self._eval_hooks)\r\n>     502     export_results = self._maybe_export(eval_result)\r\n>     503     return eval_result, export_results\r\n> \r\n> C:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\experiment.py in _call_evaluate(self, _sentinel, input_fn, steps, metrics, name, checkpoint_path, hooks)\r\n>     686                                       name=name,\r\n>     687                                       checkpoint_path=checkpoint_path,\r\n> --> 688                                       hooks=hooks)\r\n>     689 \r\n>     690 \r\n> \r\n> C:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\util\\deprecation.py in new_func(*args, **kwargs)\r\n>     287             'in a future version' if date is None else ('after %s' % date),\r\n>     288             instructions)\r\n> --> 289       return func(*args, **kwargs)\r\n>     290     return tf_decorator.make_decorator(func, new_func, 'deprecated',\r\n>     291                                        _add_deprecated_arg_notice_to_docstring(\r\n> \r\n> C:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\estimators\\estimator.py in evaluate(self, x, y, input_fn, feed_fn, batch_size, steps, metrics, name, checkpoint_path, hooks, log_progress)\r\n>     541         checkpoint_path=checkpoint_path,\r\n>     542         hooks=hooks,\r\n> --> 543         log_progress=log_progress)\r\n>     544 \r\n>     545     if eval_results is not None:\r\n> \r\n> C:\\Program Files\\Anaconda3\\lib\\site-packages\\tensorflow\\contrib\\learn\\python\\learn\\estimators\\estimator.py in _evaluate_model(self, input_fn, steps, feed_fn, metrics, name, checkpoint_path, hooks, log_progress)\r\n>     814       if not latest_path:\r\n>     815         raise NotFittedError(\"Couldn't find trained model at %s.\"\r\n> --> 816                              % self._model_dir)\r\n>     817       checkpoint_path = latest_path\r\n>     818 \r\n> \r\n> NotFittedError: Couldn't find trained model at \\model.\r\n\r\nWhy it cannot find the model ?\r\n\r\nThanks for assistance!"}