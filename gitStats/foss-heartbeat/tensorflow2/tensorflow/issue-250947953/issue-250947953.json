{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12363", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12363/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12363/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/12363/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/12363", "id": 250947953, "node_id": "MDU6SXNzdWUyNTA5NDc5NTM=", "number": 12363, "title": "Freeze tensor_forest graph for Android problem", "user": {"login": "es007", "id": 4059304, "node_id": "MDQ6VXNlcjQwNTkzMDQ=", "avatar_url": "https://avatars0.githubusercontent.com/u/4059304?v=4", "gravatar_id": "", "url": "https://api.github.com/users/es007", "html_url": "https://github.com/es007", "followers_url": "https://api.github.com/users/es007/followers", "following_url": "https://api.github.com/users/es007/following{/other_user}", "gists_url": "https://api.github.com/users/es007/gists{/gist_id}", "starred_url": "https://api.github.com/users/es007/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/es007/subscriptions", "organizations_url": "https://api.github.com/users/es007/orgs", "repos_url": "https://api.github.com/users/es007/repos", "events_url": "https://api.github.com/users/es007/events{/privacy}", "received_events_url": "https://api.github.com/users/es007/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-08-17T13:41:54Z", "updated_at": "2017-08-17T19:14:52Z", "closed_at": "2017-08-17T19:14:52Z", "author_association": "NONE", "body_html": "<p>Hi,</p>\n<p>I built a aimple Random Forest model in tensorflow, and want to freeze &amp; optimize it for android.<br>\nI used the following function for building the tesnor_forest estimator:</p>\n<pre><code>  def build_estimator(_model_dir, _num_classes, _num_features, _num_trees, _max_nodes):\n  params = tensor_forest.ForestHParams(\n  num_classes=_num_classes, num_features=_num_features,\n  num_trees=_num_trees, max_nodes=_max_nodes, min_split_samples=3)\n\ngraph_builder_class = tensor_forest.RandomForestGraphs\nreturn random_forest.TensorForestEstimator(\n  params, graph_builder_class=graph_builder_class,\n  model_dir=_model_dir)\n</code></pre>\n<p>This function stores the textual model to graph.pbtxt file in the specified model directory.</p>\n<p>Then I train it using:</p>\n<pre><code>est = build_estimator(output_model_dir, 3,np.size(features_eval,1), 5,6)\ntrain_X = features_eval.astype(dtype=np.float32)\ntrain_Y = labels_y.astype(dtype=np.float32)\nest.fit(x=train_X, y=train_Y, batch_size=np.size(features_eval,0))\n</code></pre>\n<p>(in this simple example: number of trees = 5, max_nodes=6)</p>\n<p>Now I want to freeze the model, so I call this function:<br>\n`<br>\ndef save_model_android(model_path):<br>\ncheckpoint_state_name = \"model.ckpt-1\"<br>\ninput_graph_name = \"graph.pbtxt\"<br>\noutput_graph_name = \"freezed_model.pb\"<br>\ncheckpoint_path = os.path.join(model_path, checkpoint_state_name)</p>\n<pre><code>input_graph_path = os.path.join(model_path, input_graph_name)\ninput_saver_def_path = None\ninput_binary = False\noutput_node_names = \"output\"\nrestore_op_name = \"save/restore_all\"\nfilename_tensor_name = \"save/Const:0\"\noutput_graph_path = os.path.join(model_path, output_graph_name)\nclear_devices = True\n\nfreeze_graph(input_graph_path, input_saver_def_path,\n                          input_binary, checkpoint_path,\n                          output_node_names, restore_op_name,\n                          filename_tensor_name, output_graph_path,\n                          clear_devices, \"\")\n</code></pre>\n<p>`</p>\n<p>and in the freezed_model.pb file generated I get only 1 op which is the output node.<br>\nin the console I get the following message when the freeze_graph function is called:</p>\n<blockquote>\n<p>Converted 0 variables to const ops.<br>\n1 ops in the final graph.</p>\n</blockquote>\n<p>Does anyone knows why only one node get exported when calling to freeze_graph?</p>\n<p>I'm using Tensorflow version  1.2.1 with cuda support , installed from sources on linux</p>", "body_text": "Hi,\nI built a aimple Random Forest model in tensorflow, and want to freeze & optimize it for android.\nI used the following function for building the tesnor_forest estimator:\n  def build_estimator(_model_dir, _num_classes, _num_features, _num_trees, _max_nodes):\n  params = tensor_forest.ForestHParams(\n  num_classes=_num_classes, num_features=_num_features,\n  num_trees=_num_trees, max_nodes=_max_nodes, min_split_samples=3)\n\ngraph_builder_class = tensor_forest.RandomForestGraphs\nreturn random_forest.TensorForestEstimator(\n  params, graph_builder_class=graph_builder_class,\n  model_dir=_model_dir)\n\nThis function stores the textual model to graph.pbtxt file in the specified model directory.\nThen I train it using:\nest = build_estimator(output_model_dir, 3,np.size(features_eval,1), 5,6)\ntrain_X = features_eval.astype(dtype=np.float32)\ntrain_Y = labels_y.astype(dtype=np.float32)\nest.fit(x=train_X, y=train_Y, batch_size=np.size(features_eval,0))\n\n(in this simple example: number of trees = 5, max_nodes=6)\nNow I want to freeze the model, so I call this function:\n`\ndef save_model_android(model_path):\ncheckpoint_state_name = \"model.ckpt-1\"\ninput_graph_name = \"graph.pbtxt\"\noutput_graph_name = \"freezed_model.pb\"\ncheckpoint_path = os.path.join(model_path, checkpoint_state_name)\ninput_graph_path = os.path.join(model_path, input_graph_name)\ninput_saver_def_path = None\ninput_binary = False\noutput_node_names = \"output\"\nrestore_op_name = \"save/restore_all\"\nfilename_tensor_name = \"save/Const:0\"\noutput_graph_path = os.path.join(model_path, output_graph_name)\nclear_devices = True\n\nfreeze_graph(input_graph_path, input_saver_def_path,\n                          input_binary, checkpoint_path,\n                          output_node_names, restore_op_name,\n                          filename_tensor_name, output_graph_path,\n                          clear_devices, \"\")\n\n`\nand in the freezed_model.pb file generated I get only 1 op which is the output node.\nin the console I get the following message when the freeze_graph function is called:\n\nConverted 0 variables to const ops.\n1 ops in the final graph.\n\nDoes anyone knows why only one node get exported when calling to freeze_graph?\nI'm using Tensorflow version  1.2.1 with cuda support , installed from sources on linux", "body": "Hi,\r\n\r\nI built a aimple Random Forest model in tensorflow, and want to freeze & optimize it for android.\r\nI used the following function for building the tesnor_forest estimator:\r\n\r\n      def build_estimator(_model_dir, _num_classes, _num_features, _num_trees, _max_nodes):\r\n      params = tensor_forest.ForestHParams(\r\n      num_classes=_num_classes, num_features=_num_features,\r\n      num_trees=_num_trees, max_nodes=_max_nodes, min_split_samples=3)\r\n\r\n    graph_builder_class = tensor_forest.RandomForestGraphs\r\n    return random_forest.TensorForestEstimator(\r\n      params, graph_builder_class=graph_builder_class,\r\n      model_dir=_model_dir)\r\n\r\n\r\n\r\n\r\nThis function stores the textual model to graph.pbtxt file in the specified model directory.\r\n\r\nThen I train it using:\r\n\r\n    est = build_estimator(output_model_dir, 3,np.size(features_eval,1), 5,6)\r\n    train_X = features_eval.astype(dtype=np.float32)\r\n    train_Y = labels_y.astype(dtype=np.float32)\r\n    est.fit(x=train_X, y=train_Y, batch_size=np.size(features_eval,0))\r\n\r\n\r\n(in this simple example: number of trees = 5, max_nodes=6)\r\n\r\nNow I want to freeze the model, so I call this function:\r\n`\r\ndef save_model_android(model_path):\r\n    checkpoint_state_name = \"model.ckpt-1\"\r\n    input_graph_name = \"graph.pbtxt\"\r\n    output_graph_name = \"freezed_model.pb\"\r\n    checkpoint_path = os.path.join(model_path, checkpoint_state_name)\r\n\r\n    input_graph_path = os.path.join(model_path, input_graph_name)\r\n    input_saver_def_path = None\r\n    input_binary = False\r\n    output_node_names = \"output\"\r\n    restore_op_name = \"save/restore_all\"\r\n    filename_tensor_name = \"save/Const:0\"\r\n    output_graph_path = os.path.join(model_path, output_graph_name)\r\n    clear_devices = True\r\n\r\n    freeze_graph(input_graph_path, input_saver_def_path,\r\n                              input_binary, checkpoint_path,\r\n                              output_node_names, restore_op_name,\r\n                              filename_tensor_name, output_graph_path,\r\n                              clear_devices, \"\")\r\n`\r\n\r\nand in the freezed_model.pb file generated I get only 1 op which is the output node.\r\nin the console I get the following message when the freeze_graph function is called:\r\n\r\n> Converted 0 variables to const ops.\r\n1 ops in the final graph.\r\n\r\nDoes anyone knows why only one node get exported when calling to freeze_graph?\r\n\r\nI'm using Tensorflow version  1.2.1 with cuda support , installed from sources on linux"}