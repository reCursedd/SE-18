{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/295757770", "html_url": "https://github.com/tensorflow/tensorflow/pull/9281#issuecomment-295757770", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/9281", "id": 295757770, "node_id": "MDEyOklzc3VlQ29tbWVudDI5NTc1Nzc3MA==", "user": {"login": "mrry", "id": 192142, "node_id": "MDQ6VXNlcjE5MjE0Mg==", "avatar_url": "https://avatars1.githubusercontent.com/u/192142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrry", "html_url": "https://github.com/mrry", "followers_url": "https://api.github.com/users/mrry/followers", "following_url": "https://api.github.com/users/mrry/following{/other_user}", "gists_url": "https://api.github.com/users/mrry/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrry/subscriptions", "organizations_url": "https://api.github.com/users/mrry/orgs", "repos_url": "https://api.github.com/users/mrry/repos", "events_url": "https://api.github.com/users/mrry/events{/privacy}", "received_events_url": "https://api.github.com/users/mrry/received_events", "type": "User", "site_admin": false}, "created_at": "2017-04-20T14:28:00Z", "updated_at": "2017-04-20T14:28:00Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Thanks for tracking that down, Yun! Then I think we have a smoking gun: the <code>tf.summary.FileWriter</code> is holding open a file handle after <code>est1.train()</code> returns.</p>\n<p>It looks like this happens deep in the <code>MonitoredTrainingSession</code>... and there seems to be a cache(!!) involved:</p>\n<p><a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/summary/writer/writer_cache.py#L27\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/summary/writer/writer_cache.py#L27</a></p>\n<p>As a hack, you might try invoking <code>FileWriterCache.clear()</code> before the rename, but I'm not sure that that's sufficient because deleting a <code>FileWriter</code> doesn't appear to <code>close()</code> it, so you might need to add a <code>writer.close()</code> call somewhere (or maybe add it to the destructor?).</p>", "body_text": "Thanks for tracking that down, Yun! Then I think we have a smoking gun: the tf.summary.FileWriter is holding open a file handle after est1.train() returns.\nIt looks like this happens deep in the MonitoredTrainingSession... and there seems to be a cache(!!) involved:\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/summary/writer/writer_cache.py#L27\nAs a hack, you might try invoking FileWriterCache.clear() before the rename, but I'm not sure that that's sufficient because deleting a FileWriter doesn't appear to close() it, so you might need to add a writer.close() call somewhere (or maybe add it to the destructor?).", "body": "Thanks for tracking that down, Yun! Then I think we have a smoking gun: the `tf.summary.FileWriter` is holding open a file handle after `est1.train()` returns.\r\n\r\nIt looks like this happens deep in the `MonitoredTrainingSession`... and there seems to be a cache(!!) involved:\r\n\r\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/summary/writer/writer_cache.py#L27\r\n\r\nAs a hack, you might try invoking `FileWriterCache.clear()` before the rename, but I'm not sure that that's sufficient because deleting a `FileWriter` doesn't appear to `close()` it, so you might need to add a `writer.close()` call somewhere (or maybe add it to the destructor?)."}