{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18240", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18240/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18240/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/18240/events", "html_url": "https://github.com/tensorflow/tensorflow/pull/18240", "id": 311333506, "node_id": "MDExOlB1bGxSZXF1ZXN0MTc5NDY4NzU5", "number": 18240, "title": "INTEL MKL:  Fixing a unit test failure, for direct session memory allocation  ", "user": {"login": "ashraf-bhuiyan", "id": 8062406, "node_id": "MDQ6VXNlcjgwNjI0MDY=", "avatar_url": "https://avatars2.githubusercontent.com/u/8062406?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ashraf-bhuiyan", "html_url": "https://github.com/ashraf-bhuiyan", "followers_url": "https://api.github.com/users/ashraf-bhuiyan/followers", "following_url": "https://api.github.com/users/ashraf-bhuiyan/following{/other_user}", "gists_url": "https://api.github.com/users/ashraf-bhuiyan/gists{/gist_id}", "starred_url": "https://api.github.com/users/ashraf-bhuiyan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ashraf-bhuiyan/subscriptions", "organizations_url": "https://api.github.com/users/ashraf-bhuiyan/orgs", "repos_url": "https://api.github.com/users/ashraf-bhuiyan/repos", "events_url": "https://api.github.com/users/ashraf-bhuiyan/events{/privacy}", "received_events_url": "https://api.github.com/users/ashraf-bhuiyan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 419840263, "node_id": "MDU6TGFiZWw0MTk4NDAyNjM=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/awaiting%20testing%20(then%20merge)", "name": "awaiting testing (then merge)", "color": "c2e0c6", "default": false}, {"id": 300136587, "node_id": "MDU6TGFiZWwzMDAxMzY1ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/cla:%20yes", "name": "cla: yes", "color": "009800", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "andrewharp", "id": 3376817, "node_id": "MDQ6VXNlcjMzNzY4MTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/3376817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewharp", "html_url": "https://github.com/andrewharp", "followers_url": "https://api.github.com/users/andrewharp/followers", "following_url": "https://api.github.com/users/andrewharp/following{/other_user}", "gists_url": "https://api.github.com/users/andrewharp/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewharp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewharp/subscriptions", "organizations_url": "https://api.github.com/users/andrewharp/orgs", "repos_url": "https://api.github.com/users/andrewharp/repos", "events_url": "https://api.github.com/users/andrewharp/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewharp/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "andrewharp", "id": 3376817, "node_id": "MDQ6VXNlcjMzNzY4MTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/3376817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewharp", "html_url": "https://github.com/andrewharp", "followers_url": "https://api.github.com/users/andrewharp/followers", "following_url": "https://api.github.com/users/andrewharp/following{/other_user}", "gists_url": "https://api.github.com/users/andrewharp/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewharp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewharp/subscriptions", "organizations_url": "https://api.github.com/users/andrewharp/orgs", "repos_url": "https://api.github.com/users/andrewharp/repos", "events_url": "https://api.github.com/users/andrewharp/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewharp/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 10, "created_at": "2018-04-04T18:04:32Z", "updated_at": "2018-05-18T14:50:56Z", "closed_at": "2018-05-18T14:50:55Z", "author_association": "CONTRIBUTOR", "pull_request": {"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/18240", "html_url": "https://github.com/tensorflow/tensorflow/pull/18240", "diff_url": "https://github.com/tensorflow/tensorflow/pull/18240.diff", "patch_url": "https://github.com/tensorflow/tensorflow/pull/18240.patch"}, "body_html": "<p>A unit test \"direct_session_with_tracking_alloc_test\" failed both in Google CI and Intel internal test. The root cause is: The check failed for checking allocation ID to 3 and 4 (hard coded). Here the test assumes, that the allocation id does not change in any place. But the problem is, the BFCallocator changed the allocation id when mkl is used. But, when mkl is not used, BFCAllocator is not used, thus allocation id is not overridden.<br>\nIf MKL is used, it goes through various additional graph rewrite pass. In TF, everytime a graph pass happens, \"constant\" nodes are allocated and deallocated. Each allocation calls the (FindChunkPtr of BFCAllocator) which increments the value of AllocationId. Thus AllocationId becomes more than 3 and 4 if MKL is used, they can be 10 and 11 or other numbers. If MKL is used following the AllocationId check will not hold. Thus, skipping the check if MKL is used.</p>", "body_text": "A unit test \"direct_session_with_tracking_alloc_test\" failed both in Google CI and Intel internal test. The root cause is: The check failed for checking allocation ID to 3 and 4 (hard coded). Here the test assumes, that the allocation id does not change in any place. But the problem is, the BFCallocator changed the allocation id when mkl is used. But, when mkl is not used, BFCAllocator is not used, thus allocation id is not overridden.\nIf MKL is used, it goes through various additional graph rewrite pass. In TF, everytime a graph pass happens, \"constant\" nodes are allocated and deallocated. Each allocation calls the (FindChunkPtr of BFCAllocator) which increments the value of AllocationId. Thus AllocationId becomes more than 3 and 4 if MKL is used, they can be 10 and 11 or other numbers. If MKL is used following the AllocationId check will not hold. Thus, skipping the check if MKL is used.", "body": "A unit test \"direct_session_with_tracking_alloc_test\" failed both in Google CI and Intel internal test. The root cause is: The check failed for checking allocation ID to 3 and 4 (hard coded). Here the test assumes, that the allocation id does not change in any place. But the problem is, the BFCallocator changed the allocation id when mkl is used. But, when mkl is not used, BFCAllocator is not used, thus allocation id is not overridden.\r\nIf MKL is used, it goes through various additional graph rewrite pass. In TF, everytime a graph pass happens, \"constant\" nodes are allocated and deallocated. Each allocation calls the (FindChunkPtr of BFCAllocator) which increments the value of AllocationId. Thus AllocationId becomes more than 3 and 4 if MKL is used, they can be 10 and 11 or other numbers. If MKL is used following the AllocationId check will not hold. Thus, skipping the check if MKL is used."}