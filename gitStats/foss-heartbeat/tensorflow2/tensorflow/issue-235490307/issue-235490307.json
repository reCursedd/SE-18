{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10672", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10672/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10672/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/10672/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/10672", "id": 235490307, "node_id": "MDU6SXNzdWUyMzU0OTAzMDc=", "number": 10672, "title": "Strange performance: sparse tensor matmul in kernel_test", "user": {"login": "sleepfin", "id": 7370869, "node_id": "MDQ6VXNlcjczNzA4Njk=", "avatar_url": "https://avatars1.githubusercontent.com/u/7370869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sleepfin", "html_url": "https://github.com/sleepfin", "followers_url": "https://api.github.com/users/sleepfin/followers", "following_url": "https://api.github.com/users/sleepfin/following{/other_user}", "gists_url": "https://api.github.com/users/sleepfin/gists{/gist_id}", "starred_url": "https://api.github.com/users/sleepfin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sleepfin/subscriptions", "organizations_url": "https://api.github.com/users/sleepfin/orgs", "repos_url": "https://api.github.com/users/sleepfin/repos", "events_url": "https://api.github.com/users/sleepfin/events{/privacy}", "received_events_url": "https://api.github.com/users/sleepfin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "open", "locked": false, "assignee": {"login": "shivaniag", "id": 16565716, "node_id": "MDQ6VXNlcjE2NTY1NzE2", "avatar_url": "https://avatars1.githubusercontent.com/u/16565716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shivaniag", "html_url": "https://github.com/shivaniag", "followers_url": "https://api.github.com/users/shivaniag/followers", "following_url": "https://api.github.com/users/shivaniag/following{/other_user}", "gists_url": "https://api.github.com/users/shivaniag/gists{/gist_id}", "starred_url": "https://api.github.com/users/shivaniag/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shivaniag/subscriptions", "organizations_url": "https://api.github.com/users/shivaniag/orgs", "repos_url": "https://api.github.com/users/shivaniag/repos", "events_url": "https://api.github.com/users/shivaniag/events{/privacy}", "received_events_url": "https://api.github.com/users/shivaniag/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "shivaniag", "id": 16565716, "node_id": "MDQ6VXNlcjE2NTY1NzE2", "avatar_url": "https://avatars1.githubusercontent.com/u/16565716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shivaniag", "html_url": "https://github.com/shivaniag", "followers_url": "https://api.github.com/users/shivaniag/followers", "following_url": "https://api.github.com/users/shivaniag/following{/other_user}", "gists_url": "https://api.github.com/users/shivaniag/gists{/gist_id}", "starred_url": "https://api.github.com/users/shivaniag/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shivaniag/subscriptions", "organizations_url": "https://api.github.com/users/shivaniag/orgs", "repos_url": "https://api.github.com/users/shivaniag/repos", "events_url": "https://api.github.com/users/shivaniag/events{/privacy}", "received_events_url": "https://api.github.com/users/shivaniag/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2017-06-13T09:24:43Z", "updated_at": "2018-11-22T18:52:01Z", "closed_at": null, "author_association": "NONE", "body_html": "<p>Sorry for the previous issue<br>\nAccording to the document <a href=\"https://www.tensorflow.org/api_docs/python/tf/sparse_tensor_dense_matmul\" rel=\"nofollow\">HERE</a></p>\n<blockquote>\n<p>tensorflow/python/sparse_tensor_dense_matmul_op_test --benchmarks<br>\nA sparse [m, k] with % nonzero values between 1% and 80%<br>\nB dense [k, n]</p>\n</blockquote>\n<p>When I run <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/kernel_tests/sparse_tensor_dense_matmul_op_test.py\">sparse_tensor_dense_matmul_op_test.py</a> with large n,m,k<br>\nI get:</p>\n<pre><code>% nnz \t n \t gpu \t m \t k \t dt(dense) \t dt(sparse) \t dt(sparse)/dt(dense)\n0.5 \t 512 \t True \t 1822 \t 4608 \t 0.0222946 \t 0.0130646 \t 0.585998\n0.5 \t 512 \t True \t 1821 \t 4608 \t 0.0224976 \t 0.0130761 \t 0.581222\n0.5 \t 512 \t True \t 1820 \t 4608 \t 0.022529 \t 0.79513 \t 35.2936\n0.5 \t 512 \t True \t 1819 \t 4608 \t 0.0217343 \t 0.795709 \t 36.6107\n</code></pre>\n<p>It is strange that <code>dt(sparse)/dt(dense)</code> are very different when m=1821 -&gt; 1820<br>\nBTY, I set the iterations to 10 for time saving...</p>\n<pre><code>delta_dense = _timer(sess, ops_fn, 10)\ndelta_sparse = _timer(sess, ops_fn, 10)\n</code></pre>\n<p>Here's some information:<br>\nOS: Ubuntu 14.04<br>\ntf-version: 1.1.0  installed from source<br>\nGPU: NVIDIA K80, 4 kernels (only '/gpu:0' is used)<br>\nCUDA: 8.0<br>\ncudnn: 5.1.5</p>\n<p>You can run sparse_tensor_dense_matmul_op_test.py with my settings</p>\n<pre><code>  for thresh in (0.5,):\n    for n in (512,):\n      for use_gpu in (True,):\n        for m in (1822, 1821, 1820, 1819):\n          for k in (9*512,):\n            sparse_tensor_dense_vs_dense_matmul_benchmark(\n                thresh, m, k, n, False, False, use_gpu=use_gpu)\n</code></pre>", "body_text": "Sorry for the previous issue\nAccording to the document HERE\n\ntensorflow/python/sparse_tensor_dense_matmul_op_test --benchmarks\nA sparse [m, k] with % nonzero values between 1% and 80%\nB dense [k, n]\n\nWhen I run sparse_tensor_dense_matmul_op_test.py with large n,m,k\nI get:\n% nnz \t n \t gpu \t m \t k \t dt(dense) \t dt(sparse) \t dt(sparse)/dt(dense)\n0.5 \t 512 \t True \t 1822 \t 4608 \t 0.0222946 \t 0.0130646 \t 0.585998\n0.5 \t 512 \t True \t 1821 \t 4608 \t 0.0224976 \t 0.0130761 \t 0.581222\n0.5 \t 512 \t True \t 1820 \t 4608 \t 0.022529 \t 0.79513 \t 35.2936\n0.5 \t 512 \t True \t 1819 \t 4608 \t 0.0217343 \t 0.795709 \t 36.6107\n\nIt is strange that dt(sparse)/dt(dense) are very different when m=1821 -> 1820\nBTY, I set the iterations to 10 for time saving...\ndelta_dense = _timer(sess, ops_fn, 10)\ndelta_sparse = _timer(sess, ops_fn, 10)\n\nHere's some information:\nOS: Ubuntu 14.04\ntf-version: 1.1.0  installed from source\nGPU: NVIDIA K80, 4 kernels (only '/gpu:0' is used)\nCUDA: 8.0\ncudnn: 5.1.5\nYou can run sparse_tensor_dense_matmul_op_test.py with my settings\n  for thresh in (0.5,):\n    for n in (512,):\n      for use_gpu in (True,):\n        for m in (1822, 1821, 1820, 1819):\n          for k in (9*512,):\n            sparse_tensor_dense_vs_dense_matmul_benchmark(\n                thresh, m, k, n, False, False, use_gpu=use_gpu)", "body": "Sorry for the previous issue \r\nAccording to the document [HERE](https://www.tensorflow.org/api_docs/python/tf/sparse_tensor_dense_matmul)\r\n\r\n> tensorflow/python/sparse_tensor_dense_matmul_op_test --benchmarks\r\nA sparse [m, k] with % nonzero values between 1% and 80%\r\nB dense [k, n]\r\n\r\nWhen I run [sparse_tensor_dense_matmul_op_test.py](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/kernel_tests/sparse_tensor_dense_matmul_op_test.py) with large n,m,k\r\nI get:\r\n```\r\n% nnz \t n \t gpu \t m \t k \t dt(dense) \t dt(sparse) \t dt(sparse)/dt(dense)\r\n0.5 \t 512 \t True \t 1822 \t 4608 \t 0.0222946 \t 0.0130646 \t 0.585998\r\n0.5 \t 512 \t True \t 1821 \t 4608 \t 0.0224976 \t 0.0130761 \t 0.581222\r\n0.5 \t 512 \t True \t 1820 \t 4608 \t 0.022529 \t 0.79513 \t 35.2936\r\n0.5 \t 512 \t True \t 1819 \t 4608 \t 0.0217343 \t 0.795709 \t 36.6107\r\n```\r\nIt is strange that `dt(sparse)/dt(dense)` are very different when m=1821 -> 1820\r\nBTY, I set the iterations to 10 for time saving...\r\n```\r\ndelta_dense = _timer(sess, ops_fn, 10)\r\ndelta_sparse = _timer(sess, ops_fn, 10)\r\n```\r\n\r\nHere's some information:\r\nOS: Ubuntu 14.04\r\ntf-version: 1.1.0  installed from source\r\nGPU: NVIDIA K80, 4 kernels (only '/gpu:0' is used)\r\nCUDA: 8.0\r\ncudnn: 5.1.5\r\n\r\nYou can run sparse_tensor_dense_matmul_op_test.py with my settings\r\n```\r\n  for thresh in (0.5,):\r\n    for n in (512,):\r\n      for use_gpu in (True,):\r\n        for m in (1822, 1821, 1820, 1819):\r\n          for k in (9*512,):\r\n            sparse_tensor_dense_vs_dense_matmul_benchmark(\r\n                thresh, m, k, n, False, False, use_gpu=use_gpu)\r\n```\r\n"}