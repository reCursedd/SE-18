{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6378", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6378/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6378/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/6378/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/6378", "id": 196234071, "node_id": "MDU6SXNzdWUxOTYyMzQwNzE=", "number": 6378, "title": "WhereOp: Race condition between counting the number of true elements and writing them", "user": {"login": "hosang", "id": 1494631, "node_id": "MDQ6VXNlcjE0OTQ2MzE=", "avatar_url": "https://avatars0.githubusercontent.com/u/1494631?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hosang", "html_url": "https://github.com/hosang", "followers_url": "https://api.github.com/users/hosang/followers", "following_url": "https://api.github.com/users/hosang/following{/other_user}", "gists_url": "https://api.github.com/users/hosang/gists{/gist_id}", "starred_url": "https://api.github.com/users/hosang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hosang/subscriptions", "organizations_url": "https://api.github.com/users/hosang/orgs", "repos_url": "https://api.github.com/users/hosang/repos", "events_url": "https://api.github.com/users/hosang/events{/privacy}", "received_events_url": "https://api.github.com/users/hosang/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 386191887, "node_id": "MDU6TGFiZWwzODYxOTE4ODc=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response", "name": "stat:awaiting response", "color": "f4b400", "default": false}, {"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2016-12-17T17:55:00Z", "updated_at": "2017-12-21T11:18:35Z", "closed_at": "2017-12-21T11:18:35Z", "author_association": "NONE", "body_html": "<p>I have the same problem as issue <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"173117674\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/4033\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/4033/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/4033\">#4033</a> and <a href=\"https://github.com/tensorflow/models/issues/486\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/models/issues/486/hovercard\">tensorflow/models#486</a> happening to me in my own project with the nightly wheel. It is running fine on CPU, the problem only happens on GPU (titan x pascal).</p>\n<p>The code that's causing the problem is this:<br>\n<code>pair_idxs = tf.where(tf.greater_equal(iou, params.thresh))</code><br>\n(iou is a tensor, params.thresh is a python float)</p>\n<p>WIth the error message:</p>\n<pre><code>InvalidArgumentError (see above for traceback): WhereOp: Race condition between counting the number of true elements and writing them.  When counting, saw 31641 elements; but when writing their indices, saw 187 elements.\n         [[Node: Where = Where[_device=\"/job:localhost/replica:0/task:0/cpu:0\"](GreaterEqual/_25)]]\n</code></pre>\n<p>Cuda:</p>\n<pre><code>-rw-r--r-- 1 foo bar   52M Dec  8 20:06 libcublas_device.a\nlrwxrwxrwx 1 foo bar    16 Dec  8 20:06 libcublas.so -&gt; libcublas.so.8.0\nlrwxrwxrwx 1 foo bar    19 Dec  8 20:07 libcublas.so.8.0 -&gt; libcublas.so.8.0.45\n-rwxr-xr-x 1 foo bar   40M Dec  8 20:06 libcublas.so.8.0.45\n-rw-r--r-- 1 foo bar   46M Dec  8 20:07 libcublas_static.a\n-rw-r--r-- 1 foo bar  546K Dec  8 20:07 libcudadevrt.a\nlrwxrwxrwx 1 foo bar    16 Dec  8 20:06 libcudart.so -&gt; libcudart.so.8.0\nlrwxrwxrwx 1 foo bar    19 Dec  8 20:07 libcudart.so.8.0 -&gt; libcudart.so.8.0.44\n-rwxr-xr-x 1 foo bar  406K Dec  8 20:06 libcudart.so.8.0.44\n-rw-r--r-- 1 foo bar  757K Dec  8 20:07 libcudart_static.a\nlrwxrwxrwx 1 foo bar    15 Dec  8 20:06 libcufft.so -&gt; libcufft.so.8.0\nlrwxrwxrwx 1 foo bar    18 Dec  8 20:07 libcufft.so.8.0 -&gt; libcufft.so.8.0.44\n-rwxr-xr-x 1 foo bar  140M Dec  8 20:06 libcufft.so.8.0.44\n-rw-r--r-- 1 foo bar  124M Dec  8 20:07 libcufft_static.a\nlrwxrwxrwx 1 foo bar    16 Dec  8 20:06 libcufftw.so -&gt; libcufftw.so.8.0\nlrwxrwxrwx 1 foo bar    19 Dec  8 20:07 libcufftw.so.8.0 -&gt; libcufftw.so.8.0.44\n-rwxr-xr-x 1 foo bar  466K Dec  8 20:06 libcufftw.so.8.0.44\n-rw-r--r-- 1 foo bar   42K Dec  8 20:07 libcufftw_static.a\nlrwxrwxrwx 1 foo bar    17 Dec  8 20:06 libcuinj64.so -&gt; libcuinj64.so.8.0\nlrwxrwxrwx 1 foo bar    20 Dec  8 20:06 libcuinj64.so.8.0 -&gt; libcuinj64.so.8.0.44\n-rwxr-xr-x 1 foo bar  6.2M Dec  8 20:06 libcuinj64.so.8.0.44\n-rw-r--r-- 1 foo bar  1.6M Dec  8 20:07 libculibos.a\nlrwxrwxrwx 1 foo bar    16 Dec  8 20:06 libcurand.so -&gt; libcurand.so.8.0\nlrwxrwxrwx 1 foo bar    19 Dec  8 20:07 libcurand.so.8.0 -&gt; libcurand.so.8.0.44\n-rwxr-xr-x 1 foo bar   57M Dec  8 20:07 libcurand.so.8.0.44\n-rw-r--r-- 1 foo bar   57M Dec  8 20:06 libcurand_static.a\nlrwxrwxrwx 1 foo bar    18 Dec  8 20:06 libcusolver.so -&gt; libcusolver.so.8.0\nlrwxrwxrwx 1 foo bar    21 Dec  8 20:07 libcusolver.so.8.0 -&gt; libcusolver.so.8.0.44\n-rwxr-xr-x 1 foo bar   52M Dec  8 20:06 libcusolver.so.8.0.44\n-rw-r--r-- 1 foo bar   22M Dec  8 20:07 libcusolver_static.a\nlrwxrwxrwx 1 foo bar    18 Dec  8 20:07 libcusparse.so -&gt; libcusparse.so.8.0\nlrwxrwxrwx 1 foo bar    21 Dec  8 20:06 libcusparse.so.8.0 -&gt; libcusparse.so.8.0.44\n-rwxr-xr-x 1 foo bar   41M Dec  8 20:07 libcusparse.so.8.0.44\n-rw-r--r-- 1 foo bar   50M Dec  8 20:06 libcusparse_static.a\n</code></pre>\n<p>cuDNN:</p>\n<pre><code>lrwxrwxrwx 1 foo bar  13 Jul 27 07:55 libcudnn.so -&gt; libcudnn.so.5\nlrwxrwxrwx 1 foo bar  17 Jul 27 07:55 libcudnn.so.5 -&gt; libcudnn.so.5.1.5\n-rwxr-xr-x 1 foo bar 76M Jul 27 07:53 libcudnn.so.5.1.5\n-rw-r--r-- 1 foo bar 67M Jul 27 07:53 libcudnn_static.a\n</code></pre>\n<p><code>tenserflow.__version__: 0.12.head</code></p>", "body_text": "I have the same problem as issue #4033 and tensorflow/models#486 happening to me in my own project with the nightly wheel. It is running fine on CPU, the problem only happens on GPU (titan x pascal).\nThe code that's causing the problem is this:\npair_idxs = tf.where(tf.greater_equal(iou, params.thresh))\n(iou is a tensor, params.thresh is a python float)\nWIth the error message:\nInvalidArgumentError (see above for traceback): WhereOp: Race condition between counting the number of true elements and writing them.  When counting, saw 31641 elements; but when writing their indices, saw 187 elements.\n         [[Node: Where = Where[_device=\"/job:localhost/replica:0/task:0/cpu:0\"](GreaterEqual/_25)]]\n\nCuda:\n-rw-r--r-- 1 foo bar   52M Dec  8 20:06 libcublas_device.a\nlrwxrwxrwx 1 foo bar    16 Dec  8 20:06 libcublas.so -> libcublas.so.8.0\nlrwxrwxrwx 1 foo bar    19 Dec  8 20:07 libcublas.so.8.0 -> libcublas.so.8.0.45\n-rwxr-xr-x 1 foo bar   40M Dec  8 20:06 libcublas.so.8.0.45\n-rw-r--r-- 1 foo bar   46M Dec  8 20:07 libcublas_static.a\n-rw-r--r-- 1 foo bar  546K Dec  8 20:07 libcudadevrt.a\nlrwxrwxrwx 1 foo bar    16 Dec  8 20:06 libcudart.so -> libcudart.so.8.0\nlrwxrwxrwx 1 foo bar    19 Dec  8 20:07 libcudart.so.8.0 -> libcudart.so.8.0.44\n-rwxr-xr-x 1 foo bar  406K Dec  8 20:06 libcudart.so.8.0.44\n-rw-r--r-- 1 foo bar  757K Dec  8 20:07 libcudart_static.a\nlrwxrwxrwx 1 foo bar    15 Dec  8 20:06 libcufft.so -> libcufft.so.8.0\nlrwxrwxrwx 1 foo bar    18 Dec  8 20:07 libcufft.so.8.0 -> libcufft.so.8.0.44\n-rwxr-xr-x 1 foo bar  140M Dec  8 20:06 libcufft.so.8.0.44\n-rw-r--r-- 1 foo bar  124M Dec  8 20:07 libcufft_static.a\nlrwxrwxrwx 1 foo bar    16 Dec  8 20:06 libcufftw.so -> libcufftw.so.8.0\nlrwxrwxrwx 1 foo bar    19 Dec  8 20:07 libcufftw.so.8.0 -> libcufftw.so.8.0.44\n-rwxr-xr-x 1 foo bar  466K Dec  8 20:06 libcufftw.so.8.0.44\n-rw-r--r-- 1 foo bar   42K Dec  8 20:07 libcufftw_static.a\nlrwxrwxrwx 1 foo bar    17 Dec  8 20:06 libcuinj64.so -> libcuinj64.so.8.0\nlrwxrwxrwx 1 foo bar    20 Dec  8 20:06 libcuinj64.so.8.0 -> libcuinj64.so.8.0.44\n-rwxr-xr-x 1 foo bar  6.2M Dec  8 20:06 libcuinj64.so.8.0.44\n-rw-r--r-- 1 foo bar  1.6M Dec  8 20:07 libculibos.a\nlrwxrwxrwx 1 foo bar    16 Dec  8 20:06 libcurand.so -> libcurand.so.8.0\nlrwxrwxrwx 1 foo bar    19 Dec  8 20:07 libcurand.so.8.0 -> libcurand.so.8.0.44\n-rwxr-xr-x 1 foo bar   57M Dec  8 20:07 libcurand.so.8.0.44\n-rw-r--r-- 1 foo bar   57M Dec  8 20:06 libcurand_static.a\nlrwxrwxrwx 1 foo bar    18 Dec  8 20:06 libcusolver.so -> libcusolver.so.8.0\nlrwxrwxrwx 1 foo bar    21 Dec  8 20:07 libcusolver.so.8.0 -> libcusolver.so.8.0.44\n-rwxr-xr-x 1 foo bar   52M Dec  8 20:06 libcusolver.so.8.0.44\n-rw-r--r-- 1 foo bar   22M Dec  8 20:07 libcusolver_static.a\nlrwxrwxrwx 1 foo bar    18 Dec  8 20:07 libcusparse.so -> libcusparse.so.8.0\nlrwxrwxrwx 1 foo bar    21 Dec  8 20:06 libcusparse.so.8.0 -> libcusparse.so.8.0.44\n-rwxr-xr-x 1 foo bar   41M Dec  8 20:07 libcusparse.so.8.0.44\n-rw-r--r-- 1 foo bar   50M Dec  8 20:06 libcusparse_static.a\n\ncuDNN:\nlrwxrwxrwx 1 foo bar  13 Jul 27 07:55 libcudnn.so -> libcudnn.so.5\nlrwxrwxrwx 1 foo bar  17 Jul 27 07:55 libcudnn.so.5 -> libcudnn.so.5.1.5\n-rwxr-xr-x 1 foo bar 76M Jul 27 07:53 libcudnn.so.5.1.5\n-rw-r--r-- 1 foo bar 67M Jul 27 07:53 libcudnn_static.a\n\ntenserflow.__version__: 0.12.head", "body": "I have the same problem as issue #4033 and [tensorflow/models#486](https://github.com/tensorflow/models/issues/486) happening to me in my own project with the nightly wheel. It is running fine on CPU, the problem only happens on GPU (titan x pascal).\r\n\r\nThe code that's causing the problem is this:\r\n`pair_idxs = tf.where(tf.greater_equal(iou, params.thresh))`\r\n(iou is a tensor, params.thresh is a python float)\r\n\r\nWIth the error message: \r\n```\r\nInvalidArgumentError (see above for traceback): WhereOp: Race condition between counting the number of true elements and writing them.  When counting, saw 31641 elements; but when writing their indices, saw 187 elements.\r\n         [[Node: Where = Where[_device=\"/job:localhost/replica:0/task:0/cpu:0\"](GreaterEqual/_25)]]\r\n```\r\n\r\nCuda:\r\n```\r\n-rw-r--r-- 1 foo bar   52M Dec  8 20:06 libcublas_device.a\r\nlrwxrwxrwx 1 foo bar    16 Dec  8 20:06 libcublas.so -> libcublas.so.8.0\r\nlrwxrwxrwx 1 foo bar    19 Dec  8 20:07 libcublas.so.8.0 -> libcublas.so.8.0.45\r\n-rwxr-xr-x 1 foo bar   40M Dec  8 20:06 libcublas.so.8.0.45\r\n-rw-r--r-- 1 foo bar   46M Dec  8 20:07 libcublas_static.a\r\n-rw-r--r-- 1 foo bar  546K Dec  8 20:07 libcudadevrt.a\r\nlrwxrwxrwx 1 foo bar    16 Dec  8 20:06 libcudart.so -> libcudart.so.8.0\r\nlrwxrwxrwx 1 foo bar    19 Dec  8 20:07 libcudart.so.8.0 -> libcudart.so.8.0.44\r\n-rwxr-xr-x 1 foo bar  406K Dec  8 20:06 libcudart.so.8.0.44\r\n-rw-r--r-- 1 foo bar  757K Dec  8 20:07 libcudart_static.a\r\nlrwxrwxrwx 1 foo bar    15 Dec  8 20:06 libcufft.so -> libcufft.so.8.0\r\nlrwxrwxrwx 1 foo bar    18 Dec  8 20:07 libcufft.so.8.0 -> libcufft.so.8.0.44\r\n-rwxr-xr-x 1 foo bar  140M Dec  8 20:06 libcufft.so.8.0.44\r\n-rw-r--r-- 1 foo bar  124M Dec  8 20:07 libcufft_static.a\r\nlrwxrwxrwx 1 foo bar    16 Dec  8 20:06 libcufftw.so -> libcufftw.so.8.0\r\nlrwxrwxrwx 1 foo bar    19 Dec  8 20:07 libcufftw.so.8.0 -> libcufftw.so.8.0.44\r\n-rwxr-xr-x 1 foo bar  466K Dec  8 20:06 libcufftw.so.8.0.44\r\n-rw-r--r-- 1 foo bar   42K Dec  8 20:07 libcufftw_static.a\r\nlrwxrwxrwx 1 foo bar    17 Dec  8 20:06 libcuinj64.so -> libcuinj64.so.8.0\r\nlrwxrwxrwx 1 foo bar    20 Dec  8 20:06 libcuinj64.so.8.0 -> libcuinj64.so.8.0.44\r\n-rwxr-xr-x 1 foo bar  6.2M Dec  8 20:06 libcuinj64.so.8.0.44\r\n-rw-r--r-- 1 foo bar  1.6M Dec  8 20:07 libculibos.a\r\nlrwxrwxrwx 1 foo bar    16 Dec  8 20:06 libcurand.so -> libcurand.so.8.0\r\nlrwxrwxrwx 1 foo bar    19 Dec  8 20:07 libcurand.so.8.0 -> libcurand.so.8.0.44\r\n-rwxr-xr-x 1 foo bar   57M Dec  8 20:07 libcurand.so.8.0.44\r\n-rw-r--r-- 1 foo bar   57M Dec  8 20:06 libcurand_static.a\r\nlrwxrwxrwx 1 foo bar    18 Dec  8 20:06 libcusolver.so -> libcusolver.so.8.0\r\nlrwxrwxrwx 1 foo bar    21 Dec  8 20:07 libcusolver.so.8.0 -> libcusolver.so.8.0.44\r\n-rwxr-xr-x 1 foo bar   52M Dec  8 20:06 libcusolver.so.8.0.44\r\n-rw-r--r-- 1 foo bar   22M Dec  8 20:07 libcusolver_static.a\r\nlrwxrwxrwx 1 foo bar    18 Dec  8 20:07 libcusparse.so -> libcusparse.so.8.0\r\nlrwxrwxrwx 1 foo bar    21 Dec  8 20:06 libcusparse.so.8.0 -> libcusparse.so.8.0.44\r\n-rwxr-xr-x 1 foo bar   41M Dec  8 20:07 libcusparse.so.8.0.44\r\n-rw-r--r-- 1 foo bar   50M Dec  8 20:06 libcusparse_static.a\r\n```\r\n\r\ncuDNN:\r\n```\r\nlrwxrwxrwx 1 foo bar  13 Jul 27 07:55 libcudnn.so -> libcudnn.so.5\r\nlrwxrwxrwx 1 foo bar  17 Jul 27 07:55 libcudnn.so.5 -> libcudnn.so.5.1.5\r\n-rwxr-xr-x 1 foo bar 76M Jul 27 07:53 libcudnn.so.5.1.5\r\n-rw-r--r-- 1 foo bar 67M Jul 27 07:53 libcudnn_static.a\r\n```\r\n\r\n`tenserflow.__version__: 0.12.head`\r\n\r\n"}