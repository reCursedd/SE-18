{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21708", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21708/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21708/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/21708/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/21708", "id": 351854923, "node_id": "MDU6SXNzdWUzNTE4NTQ5MjM=", "number": 21708, "title": "tf.contrib.estimator.InMemoryEvaluatorHook runs every step", "user": {"login": "arozans", "id": 16906186, "node_id": "MDQ6VXNlcjE2OTA2MTg2", "avatar_url": "https://avatars0.githubusercontent.com/u/16906186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arozans", "html_url": "https://github.com/arozans", "followers_url": "https://api.github.com/users/arozans/followers", "following_url": "https://api.github.com/users/arozans/following{/other_user}", "gists_url": "https://api.github.com/users/arozans/gists{/gist_id}", "starred_url": "https://api.github.com/users/arozans/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arozans/subscriptions", "organizations_url": "https://api.github.com/users/arozans/orgs", "repos_url": "https://api.github.com/users/arozans/repos", "events_url": "https://api.github.com/users/arozans/events{/privacy}", "received_events_url": "https://api.github.com/users/arozans/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-08-18T21:51:32Z", "updated_at": "2018-08-18T22:45:30Z", "closed_at": "2018-08-18T22:45:30Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: same code as in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"350259677\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/21590\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/21590/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/21590\">#21590</a></li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Linux Ubuntu 16.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: from conda, also tried with pip - same effect</li>\n<li><strong>TensorFlow version (use command below)</strong>: conda: 1.9.0, pip: v1.10.0-0-g656e7a2b34 1.10.0</li>\n<li><strong>Python version</strong>: conda: Python 3.6.6 :: Anaconda custom (64-bit), pip: 3.5.2</li>\n<li><strong>CUDA/cuDNN version</strong>: CUDA Version 9.0.176</li>\n<li><strong>GPU model and memory</strong>:  GeForce GTX 1080 Ti 12GB</li>\n<li><strong>Exact command to reproduce</strong>: python3 cnn_mnist.py</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>When evaluating during training with tf.contrib.estimator.InMemoryEvaluatorHook, regardless of the parameter every_n_iter, evaluation takes place every single step.</p>\n<pre><code>INFO:tensorflow:Running local_init_op.\nINFO:tensorflow:Done running local_init_op.\nINFO:tensorflow:Evaluation [1/1]\nINFO:tensorflow:Finished evaluation at 2018-08-18-21:39:14\nINFO:tensorflow:Saving dict for global step 3: accuracy = 0.5, global_step = 3, loss = 0.6996169\nINFO:tensorflow:Starting evaluation at 2018-08-18-21:39:14\nINFO:tensorflow:Graph was finalized.\n2018-08-18 23:39:14.756353: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1484] Adding visible gpu devices: 0\n2018-08-18 23:39:14.756388: I tensorflow/core/common_runtime/gpu/gpu_device.cc:965] Device interconnect StreamExecutor with strength 1 edge matrix:\n2018-08-18 23:39:14.756407: I tensorflow/core/common_runtime/gpu/gpu_device.cc:971]      0 \n2018-08-18 23:39:14.756425: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 0:   N \n2018-08-18 23:39:14.756536: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 10195 MB memory) -&gt; physical GPU (device: 0, name: GeForce GTX 1080 Ti, pci bus id: 0000:01:00.0, compute capability: 6.1)\nINFO:tensorflow:Running local_init_op.\nINFO:tensorflow:Done running local_init_op.\nINFO:tensorflow:Evaluation [1/1]\nINFO:tensorflow:Finished evaluation at 2018-08-18-21:39:14\nINFO:tensorflow:Saving dict for global step 4: accuracy = 0.49, global_step = 4, loss = 0.69892335\nINFO:tensorflow:Starting evaluation at 2018-08-18-21:39:14\nINFO:tensorflow:Graph was finalized.\n2018-08-18 23:39:14.881081: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1484] Adding visible gpu devices: 0\n2018-08-18 23:39:14.881101: I tensorflow/core/common_runtime/gpu/gpu_device.cc:965] Device interconnect StreamExecutor with strength 1 edge matrix:\n2018-08-18 23:39:14.881106: I tensorflow/core/common_runtime/gpu/gpu_device.cc:971]      0 \n2018-08-18 23:39:14.881111: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 0:   N \n2018-08-18 23:39:14.881199: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 10195 MB memory) -&gt; physical GPU (device: 0, name: GeForce GTX 1080 Ti, pci bus id: 0000:01:00.0, compute capability: 6.1)\nINFO:tensorflow:Running local_init_op.\nINFO:tensorflow:Done running local_init_op.\nINFO:tensorflow:Evaluation [1/1]\nINFO:tensorflow:Finished evaluation at 2018-08-18-21:39:14\nINFO:tensorflow:Saving dict for global step 5: accuracy = 0.49, global_step = 5, loss = 0.6985285\nINFO:tensorflow:Starting evaluation at 2018-08-18-21:39:14\nINFO:tensorflow:Graph was finalized.\n</code></pre>\n<h3>Source code / logs</h3>\n<p>Code is the same as in  <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"350259677\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/21590\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/21590/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/21590\">#21590</a>:<br>\n<a href=\"https://github.com/tensorflow/tensorflow/files/2299878/cnn_mnist.txt\">cnn_mnist.txt</a></p>\n<p>Same problem exists with my custom estimator.</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): same code as in #21590\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 16.04\nTensorFlow installed from (source or binary): from conda, also tried with pip - same effect\nTensorFlow version (use command below): conda: 1.9.0, pip: v1.10.0-0-g656e7a2b34 1.10.0\nPython version: conda: Python 3.6.6 :: Anaconda custom (64-bit), pip: 3.5.2\nCUDA/cuDNN version: CUDA Version 9.0.176\nGPU model and memory:  GeForce GTX 1080 Ti 12GB\nExact command to reproduce: python3 cnn_mnist.py\n\nDescribe the problem\nWhen evaluating during training with tf.contrib.estimator.InMemoryEvaluatorHook, regardless of the parameter every_n_iter, evaluation takes place every single step.\nINFO:tensorflow:Running local_init_op.\nINFO:tensorflow:Done running local_init_op.\nINFO:tensorflow:Evaluation [1/1]\nINFO:tensorflow:Finished evaluation at 2018-08-18-21:39:14\nINFO:tensorflow:Saving dict for global step 3: accuracy = 0.5, global_step = 3, loss = 0.6996169\nINFO:tensorflow:Starting evaluation at 2018-08-18-21:39:14\nINFO:tensorflow:Graph was finalized.\n2018-08-18 23:39:14.756353: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1484] Adding visible gpu devices: 0\n2018-08-18 23:39:14.756388: I tensorflow/core/common_runtime/gpu/gpu_device.cc:965] Device interconnect StreamExecutor with strength 1 edge matrix:\n2018-08-18 23:39:14.756407: I tensorflow/core/common_runtime/gpu/gpu_device.cc:971]      0 \n2018-08-18 23:39:14.756425: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 0:   N \n2018-08-18 23:39:14.756536: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 10195 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1080 Ti, pci bus id: 0000:01:00.0, compute capability: 6.1)\nINFO:tensorflow:Running local_init_op.\nINFO:tensorflow:Done running local_init_op.\nINFO:tensorflow:Evaluation [1/1]\nINFO:tensorflow:Finished evaluation at 2018-08-18-21:39:14\nINFO:tensorflow:Saving dict for global step 4: accuracy = 0.49, global_step = 4, loss = 0.69892335\nINFO:tensorflow:Starting evaluation at 2018-08-18-21:39:14\nINFO:tensorflow:Graph was finalized.\n2018-08-18 23:39:14.881081: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1484] Adding visible gpu devices: 0\n2018-08-18 23:39:14.881101: I tensorflow/core/common_runtime/gpu/gpu_device.cc:965] Device interconnect StreamExecutor with strength 1 edge matrix:\n2018-08-18 23:39:14.881106: I tensorflow/core/common_runtime/gpu/gpu_device.cc:971]      0 \n2018-08-18 23:39:14.881111: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 0:   N \n2018-08-18 23:39:14.881199: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 10195 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1080 Ti, pci bus id: 0000:01:00.0, compute capability: 6.1)\nINFO:tensorflow:Running local_init_op.\nINFO:tensorflow:Done running local_init_op.\nINFO:tensorflow:Evaluation [1/1]\nINFO:tensorflow:Finished evaluation at 2018-08-18-21:39:14\nINFO:tensorflow:Saving dict for global step 5: accuracy = 0.49, global_step = 5, loss = 0.6985285\nINFO:tensorflow:Starting evaluation at 2018-08-18-21:39:14\nINFO:tensorflow:Graph was finalized.\n\nSource code / logs\nCode is the same as in  #21590:\ncnn_mnist.txt\nSame problem exists with my custom estimator.", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: same code as in #21590\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Ubuntu 16.04\r\n- **TensorFlow installed from (source or binary)**: from conda, also tried with pip - same effect\r\n- **TensorFlow version (use command below)**: conda: 1.9.0, pip: v1.10.0-0-g656e7a2b34 1.10.0 \r\n- **Python version**: conda: Python 3.6.6 :: Anaconda custom (64-bit), pip: 3.5.2\r\n- **CUDA/cuDNN version**: CUDA Version 9.0.176 \r\n- **GPU model and memory**:  GeForce GTX 1080 Ti 12GB\r\n- **Exact command to reproduce**: python3 cnn_mnist.py\r\n\r\n### Describe the problem\r\nWhen evaluating during training with tf.contrib.estimator.InMemoryEvaluatorHook, regardless of the parameter every_n_iter, evaluation takes place every single step.\r\n```\r\nINFO:tensorflow:Running local_init_op.\r\nINFO:tensorflow:Done running local_init_op.\r\nINFO:tensorflow:Evaluation [1/1]\r\nINFO:tensorflow:Finished evaluation at 2018-08-18-21:39:14\r\nINFO:tensorflow:Saving dict for global step 3: accuracy = 0.5, global_step = 3, loss = 0.6996169\r\nINFO:tensorflow:Starting evaluation at 2018-08-18-21:39:14\r\nINFO:tensorflow:Graph was finalized.\r\n2018-08-18 23:39:14.756353: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1484] Adding visible gpu devices: 0\r\n2018-08-18 23:39:14.756388: I tensorflow/core/common_runtime/gpu/gpu_device.cc:965] Device interconnect StreamExecutor with strength 1 edge matrix:\r\n2018-08-18 23:39:14.756407: I tensorflow/core/common_runtime/gpu/gpu_device.cc:971]      0 \r\n2018-08-18 23:39:14.756425: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 0:   N \r\n2018-08-18 23:39:14.756536: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 10195 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1080 Ti, pci bus id: 0000:01:00.0, compute capability: 6.1)\r\nINFO:tensorflow:Running local_init_op.\r\nINFO:tensorflow:Done running local_init_op.\r\nINFO:tensorflow:Evaluation [1/1]\r\nINFO:tensorflow:Finished evaluation at 2018-08-18-21:39:14\r\nINFO:tensorflow:Saving dict for global step 4: accuracy = 0.49, global_step = 4, loss = 0.69892335\r\nINFO:tensorflow:Starting evaluation at 2018-08-18-21:39:14\r\nINFO:tensorflow:Graph was finalized.\r\n2018-08-18 23:39:14.881081: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1484] Adding visible gpu devices: 0\r\n2018-08-18 23:39:14.881101: I tensorflow/core/common_runtime/gpu/gpu_device.cc:965] Device interconnect StreamExecutor with strength 1 edge matrix:\r\n2018-08-18 23:39:14.881106: I tensorflow/core/common_runtime/gpu/gpu_device.cc:971]      0 \r\n2018-08-18 23:39:14.881111: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 0:   N \r\n2018-08-18 23:39:14.881199: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 10195 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1080 Ti, pci bus id: 0000:01:00.0, compute capability: 6.1)\r\nINFO:tensorflow:Running local_init_op.\r\nINFO:tensorflow:Done running local_init_op.\r\nINFO:tensorflow:Evaluation [1/1]\r\nINFO:tensorflow:Finished evaluation at 2018-08-18-21:39:14\r\nINFO:tensorflow:Saving dict for global step 5: accuracy = 0.49, global_step = 5, loss = 0.6985285\r\nINFO:tensorflow:Starting evaluation at 2018-08-18-21:39:14\r\nINFO:tensorflow:Graph was finalized.\r\n```\r\n### Source code / logs\r\nCode is the same as in  #21590: \r\n[cnn_mnist.txt](https://github.com/tensorflow/tensorflow/files/2299878/cnn_mnist.txt)\r\n\r\nSame problem exists with my custom estimator.\r\n"}