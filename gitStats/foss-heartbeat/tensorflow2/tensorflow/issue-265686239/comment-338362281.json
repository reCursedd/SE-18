{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/338362281", "html_url": "https://github.com/tensorflow/tensorflow/pull/13743#issuecomment-338362281", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13743", "id": 338362281, "node_id": "MDEyOklzc3VlQ29tbWVudDMzODM2MjI4MQ==", "user": {"login": "jart", "id": 49262, "node_id": "MDQ6VXNlcjQ5MjYy", "avatar_url": "https://avatars1.githubusercontent.com/u/49262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jart", "html_url": "https://github.com/jart", "followers_url": "https://api.github.com/users/jart/followers", "following_url": "https://api.github.com/users/jart/following{/other_user}", "gists_url": "https://api.github.com/users/jart/gists{/gist_id}", "starred_url": "https://api.github.com/users/jart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jart/subscriptions", "organizations_url": "https://api.github.com/users/jart/orgs", "repos_url": "https://api.github.com/users/jart/repos", "events_url": "https://api.github.com/users/jart/events{/privacy}", "received_events_url": "https://api.github.com/users/jart/received_events", "type": "User", "site_admin": false}, "created_at": "2017-10-21T04:08:08Z", "updated_at": "2017-10-23T01:21:57Z", "author_association": "MEMBER", "body_html": "<p><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/hovercards?user_id=856316\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/snnn\">@snnn</a> The public headers don't appear to include the internal header. Only the .c. files do. So those defines should never be needed by downstream rules. Therefore it should be sufficient to say:</p>\n<div class=\"highlight highlight-source-python\"><pre>    defs <span class=\"pl-k\">=</span> [<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>PCRE_STATIC=1<span class=\"pl-pds\">\"</span></span>],\n    copts <span class=\"pl-k\">=</span> [\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DHAVE_BCOPY=1<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DHAVE_INTTYPES_H=1<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DHAVE_MEMMOVE=1<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DHAVE_STDINT_H=1<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DHAVE_STRERROR=1<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DHAVE_SYS_STAT_H=1<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DHAVE_SYS_TYPES_H=1<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DHAVE_UNISTD_H=1<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DLINK_SIZE=2<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DMATCH_LIMIT=10000000<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DMATCH_LIMIT_RECURSION=1000<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DMAX_NAME_COUNT=10000<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DMAX_NAME_SIZE=32<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DNEWLINE=10<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DNO_RECURSE<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DPARENS_NEST_LIMIT=50<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DPOSIX_MALLOC_THRESHOLD=10<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DSTDC_HEADERS=1<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DSUPPORT_UCP<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-DSUPPORT_UTF<span class=\"pl-pds\">\"</span></span>,\n    ],</pre></div>\n<p>You're correct in what you said earlier, that this wouldn't be an issue due to the visibility restriction. To offer more context on why this is worth doing, simply for its own sake, consider <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/tensorflow/tensorflow/commit/d88cccebc7f61078d775d26f4714a06bc4002fcf/hovercard\" href=\"https://github.com/tensorflow/tensorflow/commit/d88cccebc7f61078d775d26f4714a06bc4002fcf\"><tt>d88ccce</tt></a>. We actually got in trouble a few days ago because we were using a overly broad viral define. It ended up colliding with the codebase of a random team at Google.</p>", "body_text": "@snnn The public headers don't appear to include the internal header. Only the .c. files do. So those defines should never be needed by downstream rules. Therefore it should be sufficient to say:\n    defs = [\"PCRE_STATIC=1\"],\n    copts = [\n        \"-DHAVE_BCOPY=1\",\n        \"-DHAVE_INTTYPES_H=1\",\n        \"-DHAVE_MEMMOVE=1\",\n        \"-DHAVE_STDINT_H=1\",\n        \"-DHAVE_STRERROR=1\",\n        \"-DHAVE_SYS_STAT_H=1\",\n        \"-DHAVE_SYS_TYPES_H=1\",\n        \"-DHAVE_UNISTD_H=1\",\n        \"-DLINK_SIZE=2\",\n        \"-DMATCH_LIMIT=10000000\",\n        \"-DMATCH_LIMIT_RECURSION=1000\",\n        \"-DMAX_NAME_COUNT=10000\",\n        \"-DMAX_NAME_SIZE=32\",\n        \"-DNEWLINE=10\",\n        \"-DNO_RECURSE\",\n        \"-DPARENS_NEST_LIMIT=50\",\n        \"-DPOSIX_MALLOC_THRESHOLD=10\",\n        \"-DSTDC_HEADERS=1\",\n        \"-DSUPPORT_UCP\",\n        \"-DSUPPORT_UTF\",\n    ],\nYou're correct in what you said earlier, that this wouldn't be an issue due to the visibility restriction. To offer more context on why this is worth doing, simply for its own sake, consider d88ccce. We actually got in trouble a few days ago because we were using a overly broad viral define. It ended up colliding with the codebase of a random team at Google.", "body": "@snnn The public headers don't appear to include the internal header. Only the .c. files do. So those defines should never be needed by downstream rules. Therefore it should be sufficient to say:\r\n\r\n```py\r\n    defs = [\"PCRE_STATIC=1\"],\r\n    copts = [\r\n        \"-DHAVE_BCOPY=1\",\r\n        \"-DHAVE_INTTYPES_H=1\",\r\n        \"-DHAVE_MEMMOVE=1\",\r\n        \"-DHAVE_STDINT_H=1\",\r\n        \"-DHAVE_STRERROR=1\",\r\n        \"-DHAVE_SYS_STAT_H=1\",\r\n        \"-DHAVE_SYS_TYPES_H=1\",\r\n        \"-DHAVE_UNISTD_H=1\",\r\n        \"-DLINK_SIZE=2\",\r\n        \"-DMATCH_LIMIT=10000000\",\r\n        \"-DMATCH_LIMIT_RECURSION=1000\",\r\n        \"-DMAX_NAME_COUNT=10000\",\r\n        \"-DMAX_NAME_SIZE=32\",\r\n        \"-DNEWLINE=10\",\r\n        \"-DNO_RECURSE\",\r\n        \"-DPARENS_NEST_LIMIT=50\",\r\n        \"-DPOSIX_MALLOC_THRESHOLD=10\",\r\n        \"-DSTDC_HEADERS=1\",\r\n        \"-DSUPPORT_UCP\",\r\n        \"-DSUPPORT_UTF\",\r\n    ],\r\n```\r\n\r\nYou're correct in what you said earlier, that this wouldn't be an issue due to the visibility restriction. To offer more context on why this is worth doing, simply for its own sake, consider https://github.com/tensorflow/tensorflow/commit/d88cccebc7f61078d775d26f4714a06bc4002fcf. We actually got in trouble a few days ago because we were using a overly broad viral define. It ended up colliding with the codebase of a random team at Google.\r\n"}