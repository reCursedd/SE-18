{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20373", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20373/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20373/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/20373/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/20373", "id": 336556390, "node_id": "MDU6SXNzdWUzMzY1NTYzOTA=", "number": 20373, "title": "kernel_tests:cwise_ops_test fails on AVX512 systems", "user": {"login": "markdryan", "id": 984073, "node_id": "MDQ6VXNlcjk4NDA3Mw==", "avatar_url": "https://avatars3.githubusercontent.com/u/984073?v=4", "gravatar_id": "", "url": "https://api.github.com/users/markdryan", "html_url": "https://github.com/markdryan", "followers_url": "https://api.github.com/users/markdryan/followers", "following_url": "https://api.github.com/users/markdryan/following{/other_user}", "gists_url": "https://api.github.com/users/markdryan/gists{/gist_id}", "starred_url": "https://api.github.com/users/markdryan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/markdryan/subscriptions", "organizations_url": "https://api.github.com/users/markdryan/orgs", "repos_url": "https://api.github.com/users/markdryan/repos", "events_url": "https://api.github.com/users/markdryan/events{/privacy}", "received_events_url": "https://api.github.com/users/markdryan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "rohan100jain", "id": 144114, "node_id": "MDQ6VXNlcjE0NDExNA==", "avatar_url": "https://avatars2.githubusercontent.com/u/144114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rohan100jain", "html_url": "https://github.com/rohan100jain", "followers_url": "https://api.github.com/users/rohan100jain/followers", "following_url": "https://api.github.com/users/rohan100jain/following{/other_user}", "gists_url": "https://api.github.com/users/rohan100jain/gists{/gist_id}", "starred_url": "https://api.github.com/users/rohan100jain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rohan100jain/subscriptions", "organizations_url": "https://api.github.com/users/rohan100jain/orgs", "repos_url": "https://api.github.com/users/rohan100jain/repos", "events_url": "https://api.github.com/users/rohan100jain/events{/privacy}", "received_events_url": "https://api.github.com/users/rohan100jain/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "rohan100jain", "id": 144114, "node_id": "MDQ6VXNlcjE0NDExNA==", "avatar_url": "https://avatars2.githubusercontent.com/u/144114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rohan100jain", "html_url": "https://github.com/rohan100jain", "followers_url": "https://api.github.com/users/rohan100jain/followers", "following_url": "https://api.github.com/users/rohan100jain/following{/other_user}", "gists_url": "https://api.github.com/users/rohan100jain/gists{/gist_id}", "starred_url": "https://api.github.com/users/rohan100jain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rohan100jain/subscriptions", "organizations_url": "https://api.github.com/users/rohan100jain/orgs", "repos_url": "https://api.github.com/users/rohan100jain/repos", "events_url": "https://api.github.com/users/rohan100jain/events{/privacy}", "received_events_url": "https://api.github.com/users/rohan100jain/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2018-06-28T10:05:25Z", "updated_at": "2018-07-31T14:27:06Z", "closed_at": "2018-07-31T14:16:21Z", "author_association": "CONTRIBUTOR", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>: No</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Linux Ubuntu 16.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: source</li>\n<li><strong>TensorFlow version (use command below)</strong>: ('v1.8.0-4021-g4292085', '1.9.0-rc0')</li>\n<li><strong>Python version</strong>: Python 2.7.12</li>\n<li><strong>Bazel version (if compiling from source)</strong>:  0.15.0</li>\n<li><strong>GCC/Compiler version (if compiling from source)</strong>: gcc (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609</li>\n<li><strong>CUDA/cuDNN version</strong>: n/a</li>\n<li><strong>GPU model and memory</strong>: n/a</li>\n<li><strong>Exact command to reproduce</strong>: bazel test --config=opt -- //tensorflow/python/kernel_tests:cwise_ops_test</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>The //tensorflow/python/kernel_tests:cwise_ops_test test fails on AVX512 machines.  Reproducing the problem is simple.  Just run the unit test.</p>\n<pre><code>bazel test --config=opt -- //tensorflow/python/kernel_tests:cwise_ops_test\n</code></pre>\n<p>The test is failing as there's a bug in Eigen's AVX512 implementation of the psqrt functions, which incorrectly compute the sqrt of negative numbers as 0 instead of NaN.  There's a pull request pending on Eigen that fixes the issue.</p>\n<p><a href=\"https://bitbucket.org/eigen/eigen/pull-requests/412/fix-avx512-implementations-of-psqrt/diff\" rel=\"nofollow\">https://bitbucket.org/eigen/eigen/pull-requests/412/fix-avx512-implementations-of-psqrt/diff</a></p>\n<p>A similar issue was fixed in Eigen's AVX2 implementations of psqrt a couple of years ago.</p>\n<h3>Source code / logs</h3>\n<pre><code>cwise_ops_test.py:1920: RuntimeWarning: invalid value encountered in sqrt\n  np_y = np.sqrt(x)\nF\n======================================================================\nFAIL: testSqrt (__main__.IsFiniteInfNanTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"$HOME/.cache/bazel/_bazel_markus/59a925eeb655b30b5c683f8317fe569e/execroot/org_tensorflow/bazel-out/k8-opt/bin/tensorflow/python/kernel_tests/cwise_ops_test.runfiles/org_tensorflow/tensorflow/python/kernel_tests/cwise_ops_test.py\", line 1926, in testSqrt\n    self.assertAllEqual(np_nan, tf_nan.eval())\n  File \"$HOME/.cache/bazel/_bazel_markus/59a925eeb655b30b5c683f8317fe569e/execroot/org_tensorflow/bazel-out/k8-opt/bin/tensorflow/python/kernel_tests/cwise_ops_test.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 1401, in assertAllEqual\n    np.testing.assert_array_equal(a, b, err_msg=msg)\n  File \"$HOME/.local/lib/python2.7/site-packages/numpy/testing/nose_tools/utils.py\", line 855, in assert_array_equal\n    verbose=verbose, header='Arrays are not equal')\n  File \"$HOME/.local/lib/python2.7/site-packages/numpy/testing/nose_tools/utils.py\", line 779, in assert_array_compare\n    raise AssertionError(msg)\nAssertionError: \nArrays are not equal\n\n(mismatch 76.1904761905%)\n x: array([ True,  True,  True,  True,  True,  True,  True,  True,  True,\n        True,  True,  True,  True,  True,  True,  True,  True,  True,\n        True,  True,  True,  True,  True,  True,  True,  True,  True,...\n y: array([False, False, False, False, False, False, False, False, False,\n       False, False, False, False, False, False, False, False, False,\n       False, False, False, False, False, False, False, False, False,...\n\n----------------------------------------------------------------------\nRan 3 tests in 4.787s\n\nFAILED (failures=1)\nnot equal where =  (array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16,\n       17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33,\n       34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47]),)\nnot equal lhs =  [ True  True  True  True  True  True  True  True  True  True  True  True\n  True  True  True  True  True  True  True  True  True  True  True  True\n  True  True  True  True  True  True  True  True  True  True  True  True\n  True  True  True  True  True  True  True  True  True  True  True  True]\nnot equal rhs =  [False False False False False False False False False False False False\n False False False False False False False False False False False False\n False False False False False False False False False False False False\n False False False False False False False False False False False False]\n</code></pre>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow): No\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 16.04\nTensorFlow installed from (source or binary): source\nTensorFlow version (use command below): ('v1.8.0-4021-g4292085', '1.9.0-rc0')\nPython version: Python 2.7.12\nBazel version (if compiling from source):  0.15.0\nGCC/Compiler version (if compiling from source): gcc (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609\nCUDA/cuDNN version: n/a\nGPU model and memory: n/a\nExact command to reproduce: bazel test --config=opt -- //tensorflow/python/kernel_tests:cwise_ops_test\n\nDescribe the problem\nThe //tensorflow/python/kernel_tests:cwise_ops_test test fails on AVX512 machines.  Reproducing the problem is simple.  Just run the unit test.\nbazel test --config=opt -- //tensorflow/python/kernel_tests:cwise_ops_test\n\nThe test is failing as there's a bug in Eigen's AVX512 implementation of the psqrt functions, which incorrectly compute the sqrt of negative numbers as 0 instead of NaN.  There's a pull request pending on Eigen that fixes the issue.\nhttps://bitbucket.org/eigen/eigen/pull-requests/412/fix-avx512-implementations-of-psqrt/diff\nA similar issue was fixed in Eigen's AVX2 implementations of psqrt a couple of years ago.\nSource code / logs\ncwise_ops_test.py:1920: RuntimeWarning: invalid value encountered in sqrt\n  np_y = np.sqrt(x)\nF\n======================================================================\nFAIL: testSqrt (__main__.IsFiniteInfNanTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"$HOME/.cache/bazel/_bazel_markus/59a925eeb655b30b5c683f8317fe569e/execroot/org_tensorflow/bazel-out/k8-opt/bin/tensorflow/python/kernel_tests/cwise_ops_test.runfiles/org_tensorflow/tensorflow/python/kernel_tests/cwise_ops_test.py\", line 1926, in testSqrt\n    self.assertAllEqual(np_nan, tf_nan.eval())\n  File \"$HOME/.cache/bazel/_bazel_markus/59a925eeb655b30b5c683f8317fe569e/execroot/org_tensorflow/bazel-out/k8-opt/bin/tensorflow/python/kernel_tests/cwise_ops_test.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 1401, in assertAllEqual\n    np.testing.assert_array_equal(a, b, err_msg=msg)\n  File \"$HOME/.local/lib/python2.7/site-packages/numpy/testing/nose_tools/utils.py\", line 855, in assert_array_equal\n    verbose=verbose, header='Arrays are not equal')\n  File \"$HOME/.local/lib/python2.7/site-packages/numpy/testing/nose_tools/utils.py\", line 779, in assert_array_compare\n    raise AssertionError(msg)\nAssertionError: \nArrays are not equal\n\n(mismatch 76.1904761905%)\n x: array([ True,  True,  True,  True,  True,  True,  True,  True,  True,\n        True,  True,  True,  True,  True,  True,  True,  True,  True,\n        True,  True,  True,  True,  True,  True,  True,  True,  True,...\n y: array([False, False, False, False, False, False, False, False, False,\n       False, False, False, False, False, False, False, False, False,\n       False, False, False, False, False, False, False, False, False,...\n\n----------------------------------------------------------------------\nRan 3 tests in 4.787s\n\nFAILED (failures=1)\nnot equal where =  (array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16,\n       17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33,\n       34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47]),)\nnot equal lhs =  [ True  True  True  True  True  True  True  True  True  True  True  True\n  True  True  True  True  True  True  True  True  True  True  True  True\n  True  True  True  True  True  True  True  True  True  True  True  True\n  True  True  True  True  True  True  True  True  True  True  True  True]\nnot equal rhs =  [False False False False False False False False False False False False\n False False False False False False False False False False False False\n False False False False False False False False False False False False\n False False False False False False False False False False False False]", "body": "### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**: No\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Linux Ubuntu 16.04 \r\n- **TensorFlow installed from (source or binary)**: source\r\n- **TensorFlow version (use command below)**: ('v1.8.0-4021-g4292085', '1.9.0-rc0')\r\n- **Python version**: Python 2.7.12\r\n- **Bazel version (if compiling from source)**:  0.15.0\r\n- **GCC/Compiler version (if compiling from source)**: gcc (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609\r\n- **CUDA/cuDNN version**: n/a\r\n- **GPU model and memory**: n/a\r\n- **Exact command to reproduce**: bazel test --config=opt -- //tensorflow/python/kernel_tests:cwise_ops_test\r\n\r\n### Describe the problem\r\n\r\nThe //tensorflow/python/kernel_tests:cwise_ops_test test fails on AVX512 machines.  Reproducing the problem is simple.  Just run the unit test.\r\n\r\n```\r\nbazel test --config=opt -- //tensorflow/python/kernel_tests:cwise_ops_test\r\n```\r\n\r\nThe test is failing as there's a bug in Eigen's AVX512 implementation of the psqrt functions, which incorrectly compute the sqrt of negative numbers as 0 instead of NaN.  There's a pull request pending on Eigen that fixes the issue.\r\n\r\nhttps://bitbucket.org/eigen/eigen/pull-requests/412/fix-avx512-implementations-of-psqrt/diff\r\n\r\nA similar issue was fixed in Eigen's AVX2 implementations of psqrt a couple of years ago.\r\n\r\n### Source code / logs\r\n\r\n```\r\ncwise_ops_test.py:1920: RuntimeWarning: invalid value encountered in sqrt\r\n  np_y = np.sqrt(x)\r\nF\r\n======================================================================\r\nFAIL: testSqrt (__main__.IsFiniteInfNanTest)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"$HOME/.cache/bazel/_bazel_markus/59a925eeb655b30b5c683f8317fe569e/execroot/org_tensorflow/bazel-out/k8-opt/bin/tensorflow/python/kernel_tests/cwise_ops_test.runfiles/org_tensorflow/tensorflow/python/kernel_tests/cwise_ops_test.py\", line 1926, in testSqrt\r\n    self.assertAllEqual(np_nan, tf_nan.eval())\r\n  File \"$HOME/.cache/bazel/_bazel_markus/59a925eeb655b30b5c683f8317fe569e/execroot/org_tensorflow/bazel-out/k8-opt/bin/tensorflow/python/kernel_tests/cwise_ops_test.runfiles/org_tensorflow/tensorflow/python/framework/test_util.py\", line 1401, in assertAllEqual\r\n    np.testing.assert_array_equal(a, b, err_msg=msg)\r\n  File \"$HOME/.local/lib/python2.7/site-packages/numpy/testing/nose_tools/utils.py\", line 855, in assert_array_equal\r\n    verbose=verbose, header='Arrays are not equal')\r\n  File \"$HOME/.local/lib/python2.7/site-packages/numpy/testing/nose_tools/utils.py\", line 779, in assert_array_compare\r\n    raise AssertionError(msg)\r\nAssertionError: \r\nArrays are not equal\r\n\r\n(mismatch 76.1904761905%)\r\n x: array([ True,  True,  True,  True,  True,  True,  True,  True,  True,\r\n        True,  True,  True,  True,  True,  True,  True,  True,  True,\r\n        True,  True,  True,  True,  True,  True,  True,  True,  True,...\r\n y: array([False, False, False, False, False, False, False, False, False,\r\n       False, False, False, False, False, False, False, False, False,\r\n       False, False, False, False, False, False, False, False, False,...\r\n\r\n----------------------------------------------------------------------\r\nRan 3 tests in 4.787s\r\n\r\nFAILED (failures=1)\r\nnot equal where =  (array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16,\r\n       17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33,\r\n       34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47]),)\r\nnot equal lhs =  [ True  True  True  True  True  True  True  True  True  True  True  True\r\n  True  True  True  True  True  True  True  True  True  True  True  True\r\n  True  True  True  True  True  True  True  True  True  True  True  True\r\n  True  True  True  True  True  True  True  True  True  True  True  True]\r\nnot equal rhs =  [False False False False False False False False False False False False\r\n False False False False False False False False False False False False\r\n False False False False False False False False False False False False\r\n False False False False False False False False False False False False]\r\n```"}