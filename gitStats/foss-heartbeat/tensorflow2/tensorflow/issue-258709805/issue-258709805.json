{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13146", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13146/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13146/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13146/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/13146", "id": 258709805, "node_id": "MDU6SXNzdWUyNTg3MDk4MDU=", "number": 13146, "title": "Standalone graph trained using on NCHW data_format giving errors on CPU when testing (running forward pass)", "user": {"login": "tumusudheer", "id": 3826735, "node_id": "MDQ6VXNlcjM4MjY3MzU=", "avatar_url": "https://avatars3.githubusercontent.com/u/3826735?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tumusudheer", "html_url": "https://github.com/tumusudheer", "followers_url": "https://api.github.com/users/tumusudheer/followers", "following_url": "https://api.github.com/users/tumusudheer/following{/other_user}", "gists_url": "https://api.github.com/users/tumusudheer/gists{/gist_id}", "starred_url": "https://api.github.com/users/tumusudheer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tumusudheer/subscriptions", "organizations_url": "https://api.github.com/users/tumusudheer/orgs", "repos_url": "https://api.github.com/users/tumusudheer/repos", "events_url": "https://api.github.com/users/tumusudheer/events{/privacy}", "received_events_url": "https://api.github.com/users/tumusudheer/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 23, "created_at": "2017-09-19T06:29:48Z", "updated_at": "2018-11-07T12:01:13Z", "closed_at": "2017-12-22T00:09:51Z", "author_association": "NONE", "body_html": "<h3>System information</h3>\n<ul>\n<li><strong>Have I written custom code (as opposed to using a stock example script provided in TensorFlow)</strong>:<br>\nYes,</li>\n<li><strong>OS Platform and Distribution (e.g., Linux Ubuntu 16.04)</strong>: Ubuntu 14.04</li>\n<li><strong>TensorFlow installed from (source or binary)</strong>: Binary (.whl file)</li>\n<li><strong>TensorFlow version (use command below)</strong>: 1.2.0-rc1</li>\n<li><strong>Python version</strong>: 2.7</li>\n<li><strong>Bazel version (if compiling from source)</strong>:  N/A</li>\n<li><strong>CUDA/cuDNN version</strong>:<br>\nCUDA 8.0.61<br>\nCuDNN 5.1.10</li>\n<li><strong>GPU model and memory</strong>: GeForce GTX 1080</li>\n<li><strong>Exact command to reproduce</strong>:</li>\n</ul>\n<h3>Describe the problem</h3>\n<p>I've a standalone graph create by freezing my model/net  which has a few slim.conv2d, slim.max_pool2d operations defined with NCHW data format.  I've used freeze_graph.py utility to create the stand alone graph using a trained checkpoint (trained using NCHW format). When I tested the graph (ran forward pass) on a Ubuntu machine with GPU, it was running very well. But when I ran the same code to test (forward pass) with the same stand alone graph a Ubuntu machine that has no GPU but CPU, I got the following errors:</p>\n<pre><code>2017-09-18 17:57:48.890761: E tensorflow/core/common_runtime/executor.cc:644] Executor failed to create kernel. Invalid argument: Default MaxPoolingOp only supports NHWC.\n         [[Node: text_box_300/pool1/MaxPool = MaxPool[T=DT_FLOAT, data_format=\"NCHW\", ksize=[1, 1, 2, 2], padding=\"SAME\", strides=[1, 1, 2, 2], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](text_box_300/conv1/conv1_2/Relu)]]\n2017-09-18 17:57:48.892768: E main_textd_test.cc:457] Running model failed: Invalid argument: Default MaxPoolingOp only supports NHWC.\n         [[Node: text_box_300/pool1/MaxPool = MaxPool[T=DT_FLOAT, data_format=\"NCHW\", ksize=[1, 1, 2, 2], padding=\"SAME\", strides=[1, 1, 2, 2], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](text_box_300/conv1/conv1_2/Relu)]]\n</code></pre>\n<p>I believe the errors are related to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"158524381\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/2660\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/2660/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/2660\">#2660</a><br>\nIs it possible to modify the stand alone graph that is running well on GPU to make it run successfully on CPU machine ? Is it possible to avoid retraining the model using NHWC format and recreate the standalone model ?</p>\n<h3>Source code / logs</h3>\n<p>Include any logs or source code that would be helpful to diagnose the problem. If including tracebacks, please include the full traceback. Large logs and files should be attached. Try to provide a reproducible test case that is the bare minimum necessary to generate the problem.</p>", "body_text": "System information\n\nHave I written custom code (as opposed to using a stock example script provided in TensorFlow):\nYes,\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04): Ubuntu 14.04\nTensorFlow installed from (source or binary): Binary (.whl file)\nTensorFlow version (use command below): 1.2.0-rc1\nPython version: 2.7\nBazel version (if compiling from source):  N/A\nCUDA/cuDNN version:\nCUDA 8.0.61\nCuDNN 5.1.10\nGPU model and memory: GeForce GTX 1080\nExact command to reproduce:\n\nDescribe the problem\nI've a standalone graph create by freezing my model/net  which has a few slim.conv2d, slim.max_pool2d operations defined with NCHW data format.  I've used freeze_graph.py utility to create the stand alone graph using a trained checkpoint (trained using NCHW format). When I tested the graph (ran forward pass) on a Ubuntu machine with GPU, it was running very well. But when I ran the same code to test (forward pass) with the same stand alone graph a Ubuntu machine that has no GPU but CPU, I got the following errors:\n2017-09-18 17:57:48.890761: E tensorflow/core/common_runtime/executor.cc:644] Executor failed to create kernel. Invalid argument: Default MaxPoolingOp only supports NHWC.\n         [[Node: text_box_300/pool1/MaxPool = MaxPool[T=DT_FLOAT, data_format=\"NCHW\", ksize=[1, 1, 2, 2], padding=\"SAME\", strides=[1, 1, 2, 2], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](text_box_300/conv1/conv1_2/Relu)]]\n2017-09-18 17:57:48.892768: E main_textd_test.cc:457] Running model failed: Invalid argument: Default MaxPoolingOp only supports NHWC.\n         [[Node: text_box_300/pool1/MaxPool = MaxPool[T=DT_FLOAT, data_format=\"NCHW\", ksize=[1, 1, 2, 2], padding=\"SAME\", strides=[1, 1, 2, 2], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](text_box_300/conv1/conv1_2/Relu)]]\n\nI believe the errors are related to #2660\nIs it possible to modify the stand alone graph that is running well on GPU to make it run successfully on CPU machine ? Is it possible to avoid retraining the model using NHWC format and recreate the standalone model ?\nSource code / logs\nInclude any logs or source code that would be helpful to diagnose the problem. If including tracebacks, please include the full traceback. Large logs and files should be attached. Try to provide a reproducible test case that is the bare minimum necessary to generate the problem.", "body": "\r\n### System information\r\n- **Have I written custom code (as opposed to using a stock example script provided in TensorFlow)**:\r\n     Yes,\r\n- **OS Platform and Distribution (e.g., Linux Ubuntu 16.04)**: Ubuntu 14.04\r\n- **TensorFlow installed from (source or binary)**: Binary (.whl file)\r\n- **TensorFlow version (use command below)**: 1.2.0-rc1\r\n- **Python version**: 2.7\r\n- **Bazel version (if compiling from source)**:  N/A\r\n- **CUDA/cuDNN version**:\r\nCUDA 8.0.61\r\nCuDNN 5.1.10\r\n- **GPU model and memory**: GeForce GTX 1080\r\n- **Exact command to reproduce**:\r\n\r\n\r\n### Describe the problem\r\n I've a standalone graph create by freezing my model/net  which has a few slim.conv2d, slim.max_pool2d operations defined with NCHW data format.  I've used freeze_graph.py utility to create the stand alone graph using a trained checkpoint (trained using NCHW format). When I tested the graph (ran forward pass) on a Ubuntu machine with GPU, it was running very well. But when I ran the same code to test (forward pass) with the same stand alone graph a Ubuntu machine that has no GPU but CPU, I got the following errors:\r\n\r\n```\r\n2017-09-18 17:57:48.890761: E tensorflow/core/common_runtime/executor.cc:644] Executor failed to create kernel. Invalid argument: Default MaxPoolingOp only supports NHWC.\r\n         [[Node: text_box_300/pool1/MaxPool = MaxPool[T=DT_FLOAT, data_format=\"NCHW\", ksize=[1, 1, 2, 2], padding=\"SAME\", strides=[1, 1, 2, 2], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](text_box_300/conv1/conv1_2/Relu)]]\r\n2017-09-18 17:57:48.892768: E main_textd_test.cc:457] Running model failed: Invalid argument: Default MaxPoolingOp only supports NHWC.\r\n         [[Node: text_box_300/pool1/MaxPool = MaxPool[T=DT_FLOAT, data_format=\"NCHW\", ksize=[1, 1, 2, 2], padding=\"SAME\", strides=[1, 1, 2, 2], _device=\"/job:localhost/replica:0/task:0/cpu:0\"](text_box_300/conv1/conv1_2/Relu)]]\r\n```\r\n\r\nI believe the errors are related to [https://github.com/tensorflow/tensorflow/issues/2660](https://github.com/tensorflow/tensorflow/issues/2660)\r\nIs it possible to modify the stand alone graph that is running well on GPU to make it run successfully on CPU machine ? Is it possible to avoid retraining the model using NHWC format and recreate the standalone model ?\r\n\r\n### Source code / logs\r\nInclude any logs or source code that would be helpful to diagnose the problem. If including tracebacks, please include the full traceback. Large logs and files should be attached. Try to provide a reproducible test case that is the bare minimum necessary to generate the problem.\r\n"}