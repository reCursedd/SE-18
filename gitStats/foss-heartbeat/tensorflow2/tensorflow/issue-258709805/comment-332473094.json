{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/332473094", "html_url": "https://github.com/tensorflow/tensorflow/issues/13146#issuecomment-332473094", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13146", "id": 332473094, "node_id": "MDEyOklzc3VlQ29tbWVudDMzMjQ3MzA5NA==", "user": {"login": "zhangyaobit", "id": 1034716, "node_id": "MDQ6VXNlcjEwMzQ3MTY=", "avatar_url": "https://avatars3.githubusercontent.com/u/1034716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhangyaobit", "html_url": "https://github.com/zhangyaobit", "followers_url": "https://api.github.com/users/zhangyaobit/followers", "following_url": "https://api.github.com/users/zhangyaobit/following{/other_user}", "gists_url": "https://api.github.com/users/zhangyaobit/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhangyaobit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhangyaobit/subscriptions", "organizations_url": "https://api.github.com/users/zhangyaobit/orgs", "repos_url": "https://api.github.com/users/zhangyaobit/repos", "events_url": "https://api.github.com/users/zhangyaobit/events{/privacy}", "received_events_url": "https://api.github.com/users/zhangyaobit/received_events", "type": "User", "site_admin": false}, "created_at": "2017-09-27T10:02:01Z", "updated_at": "2017-09-27T10:04:28Z", "author_association": "CONTRIBUTOR", "body_html": "<p>Sure, my pleasure.</p>\n<p>I could be mistaken, but my understanding is that using NCHW or NHWC doesn't affect the format of variables, so the checkpoint should be the same regardless of whether NCHW or NHWC is used (You can verify this by comparing the checkpoints respectively trained with NCHW and NHWC).</p>\n<p>And when you restore the checkpoint, you load the exactly same the variables regardless whether NCHW or NHWC is used (note that NCHW is the format of data input, not the filter input of Conv, filter input is a variable and is always stored in the same format [filter_height, filter_width, in_channels, out_channels] regardless of whether NCHW or NHWC is used, that's why checkpoint is not affected). However, when you restore the checkpoint, I think somewhere in your model, you need to set the right shape of moving_mean (in addition to setting the format to NHWC).</p>\n<p>Could you add a breakpoint (pdb.set_trace()) in batch_norm, and examine why the shape of moving mean is 28 instead of 3 for text_box_300/conv10_box/conv_cls/BatchNorm/moving_mean?</p>", "body_text": "Sure, my pleasure.\nI could be mistaken, but my understanding is that using NCHW or NHWC doesn't affect the format of variables, so the checkpoint should be the same regardless of whether NCHW or NHWC is used (You can verify this by comparing the checkpoints respectively trained with NCHW and NHWC).\nAnd when you restore the checkpoint, you load the exactly same the variables regardless whether NCHW or NHWC is used (note that NCHW is the format of data input, not the filter input of Conv, filter input is a variable and is always stored in the same format [filter_height, filter_width, in_channels, out_channels] regardless of whether NCHW or NHWC is used, that's why checkpoint is not affected). However, when you restore the checkpoint, I think somewhere in your model, you need to set the right shape of moving_mean (in addition to setting the format to NHWC).\nCould you add a breakpoint (pdb.set_trace()) in batch_norm, and examine why the shape of moving mean is 28 instead of 3 for text_box_300/conv10_box/conv_cls/BatchNorm/moving_mean?", "body": "Sure, my pleasure.\r\n\r\nI could be mistaken, but my understanding is that using NCHW or NHWC doesn't affect the format of variables, so the checkpoint should be the same regardless of whether NCHW or NHWC is used (You can verify this by comparing the checkpoints respectively trained with NCHW and NHWC).\r\n\r\nAnd when you restore the checkpoint, you load the exactly same the variables regardless whether NCHW or NHWC is used (note that NCHW is the format of data input, not the filter input of Conv, filter input is a variable and is always stored in the same format [filter_height, filter_width, in_channels, out_channels] regardless of whether NCHW or NHWC is used, that's why checkpoint is not affected). However, when you restore the checkpoint, I think somewhere in your model, you need to set the right shape of moving_mean (in addition to setting the format to NHWC).\r\n\r\nCould you add a breakpoint (pdb.set_trace()) in batch_norm, and examine why the shape of moving mean is 28 instead of 3 for text_box_300/conv10_box/conv_cls/BatchNorm/moving_mean?"}