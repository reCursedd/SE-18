{"url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/211314750", "pull_request_review_id": 147709238, "id": 211314750, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTMxNDc1MA==", "diff_hunk": "@@ -1110,46 +1110,127 @@ def set_tf_nccl_install_path(environ_cp):\n     if tf_nccl_version == '1':\n       break  # No need to get install path, NCCL 1 is a GitHub repo.\n \n-    # TODO(csigg): Look with ldconfig first if we can find the library in paths\n+    # Look with ldconfig first if we can find the library in paths\n     # like /usr/lib/x86_64-linux-gnu and the header file in the corresponding\n     # include directory. This is where the NCCL .deb packages install them.\n-    # Then ask the user if we should use that. Instead of a single\n-    # NCCL_INSTALL_PATH, pass separate NCCL_LIB_PATH and NCCL_HDR_PATH to\n-    # nccl_configure.bzl\n-    default_nccl_path = environ_cp.get('CUDA_TOOLKIT_PATH')\n-    ask_nccl_path = (r'Please specify the location where NCCL %s library is '\n+\n+    # First check to see if NCCL is in the ldconfig.\n+    # If its found, use that location.\n+    if is_linux():\n+      ldconfig_bin = which('ldconfig') or '/sbin/ldconfig'\n+      nccl2_path_from_ldconfig = run_shell([ldconfig_bin, '-p'])\n+      nccl2_path_from_ldconfig = re.search('.*libnccl.so .* => (.*)',\n+                                           nccl2_path_from_ldconfig)\n+    if nccl2_path_from_ldconfig:\n+      nccl2_path_from_ldconfig = nccl2_path_from_ldconfig.group(1)\n+      if os.path.exists('%s.%s' % (nccl2_path_from_ldconfig, tf_nccl_version)):\n+        nccl_install_path = os.path.dirname(nccl2_path_from_ldconfig)\n+        print('NCCL libraries found in ' + nccl2_path_from_ldconfig)\n+        \n+        # Check if this is the main Linux system lib location\n+        # If so, mark the install root path as simply /usr\n+        # so nccl_configure.bzl can find both the header and lib\n+        if nccl_install_path.startswith(\"/usr/lib\") and re.search('.*linux-gnu', nccl_install_path):\n+          nccl_root_path = \"/usr\"\n+          print(\"This looks like a system path. Using: \" + nccl_root_path)\n+          # Look for license", "path": "configure.py", "position": null, "original_position": 33, "commit_id": "f1b3cd02f24bd3b7f44f2d31db7e6cc4446acdf9", "original_commit_id": "314c80d0c02ccb1c6903aa460d173c1e33bdb005", "user": {"login": "tfboyd", "id": 23486130, "node_id": "MDQ6VXNlcjIzNDg2MTMw", "avatar_url": "https://avatars1.githubusercontent.com/u/23486130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tfboyd", "html_url": "https://github.com/tfboyd", "followers_url": "https://api.github.com/users/tfboyd/followers", "following_url": "https://api.github.com/users/tfboyd/following{/other_user}", "gists_url": "https://api.github.com/users/tfboyd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tfboyd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tfboyd/subscriptions", "organizations_url": "https://api.github.com/users/tfboyd/orgs", "repos_url": "https://api.github.com/users/tfboyd/repos", "events_url": "https://api.github.com/users/tfboyd/events{/privacy}", "received_events_url": "https://api.github.com/users/tfboyd/received_events", "type": "User", "site_admin": false}, "body": "I took out the part looking for the license due to the dynamic link and we do not include the license file in the build as users are not bound to it.  ", "created_at": "2018-08-20T15:54:53Z", "updated_at": "2018-09-26T04:32:57Z", "html_url": "https://github.com/tensorflow/tensorflow/pull/20155#discussion_r211314750", "pull_request_url": "https://api.github.com/repos/tensorflow/tensorflow/pulls/20155", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/comments/211314750"}, "html": {"href": "https://github.com/tensorflow/tensorflow/pull/20155#discussion_r211314750"}, "pull_request": {"href": "https://api.github.com/repos/tensorflow/tensorflow/pulls/20155"}}, "body_html": "<p>I took out the part looking for the license due to the dynamic link and we do not include the license file in the build as users are not bound to it.</p>", "body_text": "I took out the part looking for the license due to the dynamic link and we do not include the license file in the build as users are not bound to it."}