{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7417", "repository_url": "https://api.github.com/repos/tensorflow/tensorflow", "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7417/labels{/name}", "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7417/comments", "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/7417/events", "html_url": "https://github.com/tensorflow/tensorflow/issues/7417", "id": 206832373, "node_id": "MDU6SXNzdWUyMDY4MzIzNzM=", "number": 7417, "title": "Crashes in tf.sparse_tensor_dense_matmul", "user": {"login": "davharris", "id": 843017, "node_id": "MDQ6VXNlcjg0MzAxNw==", "avatar_url": "https://avatars1.githubusercontent.com/u/843017?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davharris", "html_url": "https://github.com/davharris", "followers_url": "https://api.github.com/users/davharris/followers", "following_url": "https://api.github.com/users/davharris/following{/other_user}", "gists_url": "https://api.github.com/users/davharris/gists{/gist_id}", "starred_url": "https://api.github.com/users/davharris/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davharris/subscriptions", "organizations_url": "https://api.github.com/users/davharris/orgs", "repos_url": "https://api.github.com/users/davharris/repos", "events_url": "https://api.github.com/users/davharris/events{/privacy}", "received_events_url": "https://api.github.com/users/davharris/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 473172988, "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=", "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug/performance", "name": "type:bug/performance", "color": "159b2e", "default": false}], "state": "closed", "locked": false, "assignee": {"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ebrevdo", "id": 1794715, "node_id": "MDQ6VXNlcjE3OTQ3MTU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1794715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebrevdo", "html_url": "https://github.com/ebrevdo", "followers_url": "https://api.github.com/users/ebrevdo/followers", "following_url": "https://api.github.com/users/ebrevdo/following{/other_user}", "gists_url": "https://api.github.com/users/ebrevdo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebrevdo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebrevdo/subscriptions", "organizations_url": "https://api.github.com/users/ebrevdo/orgs", "repos_url": "https://api.github.com/users/ebrevdo/repos", "events_url": "https://api.github.com/users/ebrevdo/events{/privacy}", "received_events_url": "https://api.github.com/users/ebrevdo/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2017-02-10T15:56:05Z", "updated_at": "2017-06-16T20:47:38Z", "closed_at": "2017-06-16T20:47:38Z", "author_association": "NONE", "body_html": "<h3>What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?</h3>\n<p>Possibly related to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"175842270\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/tensorflow/tensorflow/issues/4282\" data-hovercard-type=\"issue\" data-hovercard-url=\"/tensorflow/tensorflow/issues/4282/hovercard\" href=\"https://github.com/tensorflow/tensorflow/issues/4282\">#4282</a>?</p>\n<p>Also, <a href=\"https://stackoverflow.com/questions/29401116/abort-trap-6-in-c-program\" rel=\"nofollow\">SO seems to suggest</a> that \"abort trap 6\" is related to accessing memory that TF doesn't own.</p>\n<p>Both problems boil down to bounds errors crashing the Python session instead of throwing an error.</p>\n<h3>Environment info</h3>\n<p>Operating System: macOS Sierra 10.12.3</p>\n<p>TF version 0.12.1. Pretty sure I'm using a CPU-only build, and my graphics card is not CUDA-compatible.</p>\n<h3>If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)</h3>\n<p>I've managed to crash Python with sparse_tensor_dense_matmul in two different ways.  I've included a reproducible example for each.  Let me know if you'd prefer them split into two separate issues.</p>\n<p><em><strong>Crash 1</strong></em></p>\n<p>An off-by-one error crashes my Python session.</p>\n<pre><code>import numpy as np\nimport tensorflow as tf\nsess = tf.InteractiveSession()\n\nnrow = 3\nncol = 10\n\nX = tf.sparse_placeholder(tf.float32, shape=[None, ncol])\nW = tf.ones([ncol,1])\n\n# Note: largest allowable column index is ncol-1 because of zero-indexing\ncol_indices = [1, 2, ncol] \nindices = np.transpose(np.array([range(nrow),col_indices]))\n\nsess.run(tf.sparse_tensor_dense_matmul(X,W), feed_dict={X:(indices, [1] * nrow, [nrow, ncol])})\n</code></pre>\n<p>This kills my Python session, and I get the following at my bash prompt:</p>\n<pre><code>F tensorflow/core/kernels/sparse_tensor_dense_matmul_op.cc:242] Check failed: k &lt; lhs_right (10 vs. 10)\nAbort trap: 6\n</code></pre>\n<p><em><strong>Crash 2</strong></em></p>\n<pre><code>import numpy as np\nimport tensorflow as tf\nsess = tf.InteractiveSession()\n\nn = 3\nm = 3324\np = 49\n\na_sparse = tf.sparse_placeholder(tf.float32, shape=[None, m])\nb = tf.Variable(tf.random_normal([m, p]))\n\n\nindices = [[0,0],[1, 2]]\nvalues = [1, 1]\nshape = [n,m]\n\nfeed={a_sparse:(np.array([[3828,  135],\n        [ 320,   11]]), [1, 1], [2, 3324])}\n\n\ninit = tf.global_variables_initializer()\nsess.run(init)\nsess.run(tf.sparse_tensor_dense_matmul(a_sparse, b), feed_dict=feed)\n</code></pre>\n<pre><code>F tensorflow/core/kernels/sparse_tensor_dense_matmul_op.cc:273] Check failed: m &lt; out.dimension(0) (3828 vs. 2)\nAbort trap: 6\n</code></pre>\n<p>It looks like I'm exceeding the number of rows this time, and getting a crash instead of an error.</p>\n<h3>What other attempted solutions have you tried?</h3>\n<p>N/A</p>", "body_text": "What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\nPossibly related to #4282?\nAlso, SO seems to suggest that \"abort trap 6\" is related to accessing memory that TF doesn't own.\nBoth problems boil down to bounds errors crashing the Python session instead of throwing an error.\nEnvironment info\nOperating System: macOS Sierra 10.12.3\nTF version 0.12.1. Pretty sure I'm using a CPU-only build, and my graphics card is not CUDA-compatible.\nIf possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\nI've managed to crash Python with sparse_tensor_dense_matmul in two different ways.  I've included a reproducible example for each.  Let me know if you'd prefer them split into two separate issues.\nCrash 1\nAn off-by-one error crashes my Python session.\nimport numpy as np\nimport tensorflow as tf\nsess = tf.InteractiveSession()\n\nnrow = 3\nncol = 10\n\nX = tf.sparse_placeholder(tf.float32, shape=[None, ncol])\nW = tf.ones([ncol,1])\n\n# Note: largest allowable column index is ncol-1 because of zero-indexing\ncol_indices = [1, 2, ncol] \nindices = np.transpose(np.array([range(nrow),col_indices]))\n\nsess.run(tf.sparse_tensor_dense_matmul(X,W), feed_dict={X:(indices, [1] * nrow, [nrow, ncol])})\n\nThis kills my Python session, and I get the following at my bash prompt:\nF tensorflow/core/kernels/sparse_tensor_dense_matmul_op.cc:242] Check failed: k < lhs_right (10 vs. 10)\nAbort trap: 6\n\nCrash 2\nimport numpy as np\nimport tensorflow as tf\nsess = tf.InteractiveSession()\n\nn = 3\nm = 3324\np = 49\n\na_sparse = tf.sparse_placeholder(tf.float32, shape=[None, m])\nb = tf.Variable(tf.random_normal([m, p]))\n\n\nindices = [[0,0],[1, 2]]\nvalues = [1, 1]\nshape = [n,m]\n\nfeed={a_sparse:(np.array([[3828,  135],\n        [ 320,   11]]), [1, 1], [2, 3324])}\n\n\ninit = tf.global_variables_initializer()\nsess.run(init)\nsess.run(tf.sparse_tensor_dense_matmul(a_sparse, b), feed_dict=feed)\n\nF tensorflow/core/kernels/sparse_tensor_dense_matmul_op.cc:273] Check failed: m < out.dimension(0) (3828 vs. 2)\nAbort trap: 6\n\nIt looks like I'm exceeding the number of rows this time, and getting a crash instead of an error.\nWhat other attempted solutions have you tried?\nN/A", "body": "### What related GitHub issues or StackOverflow threads have you found by searching the web for your problem?\r\n\r\nPossibly related to #4282?\r\n\r\nAlso, [SO seems to suggest](https://stackoverflow.com/questions/29401116/abort-trap-6-in-c-program) that \"abort trap 6\" is related to accessing memory that TF doesn't own.\r\n\r\nBoth problems boil down to bounds errors crashing the Python session instead of throwing an error.\r\n\r\n### Environment info\r\nOperating System: macOS Sierra 10.12.3\r\n\r\nTF version 0.12.1. Pretty sure I'm using a CPU-only build, and my graphics card is not CUDA-compatible.\r\n\r\n### If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)\r\n\r\nI've managed to crash Python with sparse_tensor_dense_matmul in two different ways.  I've included a reproducible example for each.  Let me know if you'd prefer them split into two separate issues.\r\n\r\n***Crash 1***\r\n\r\nAn off-by-one error crashes my Python session.\r\n\r\n```\r\nimport numpy as np\r\nimport tensorflow as tf\r\nsess = tf.InteractiveSession()\r\n\r\nnrow = 3\r\nncol = 10\r\n\r\nX = tf.sparse_placeholder(tf.float32, shape=[None, ncol])\r\nW = tf.ones([ncol,1])\r\n\r\n# Note: largest allowable column index is ncol-1 because of zero-indexing\r\ncol_indices = [1, 2, ncol] \r\nindices = np.transpose(np.array([range(nrow),col_indices]))\r\n\r\nsess.run(tf.sparse_tensor_dense_matmul(X,W), feed_dict={X:(indices, [1] * nrow, [nrow, ncol])})\r\n```\r\n\r\nThis kills my Python session, and I get the following at my bash prompt:\r\n\r\n```\r\nF tensorflow/core/kernels/sparse_tensor_dense_matmul_op.cc:242] Check failed: k < lhs_right (10 vs. 10)\r\nAbort trap: 6\r\n```\r\n\r\n***Crash 2***\r\n\r\n```\r\nimport numpy as np\r\nimport tensorflow as tf\r\nsess = tf.InteractiveSession()\r\n\r\nn = 3\r\nm = 3324\r\np = 49\r\n\r\na_sparse = tf.sparse_placeholder(tf.float32, shape=[None, m])\r\nb = tf.Variable(tf.random_normal([m, p]))\r\n\r\n\r\nindices = [[0,0],[1, 2]]\r\nvalues = [1, 1]\r\nshape = [n,m]\r\n\r\nfeed={a_sparse:(np.array([[3828,  135],\r\n        [ 320,   11]]), [1, 1], [2, 3324])}\r\n\r\n\r\ninit = tf.global_variables_initializer()\r\nsess.run(init)\r\nsess.run(tf.sparse_tensor_dense_matmul(a_sparse, b), feed_dict=feed)\r\n```\r\n\r\n```\r\nF tensorflow/core/kernels/sparse_tensor_dense_matmul_op.cc:273] Check failed: m < out.dimension(0) (3828 vs. 2)\r\nAbort trap: 6\r\n```\r\n\r\nIt looks like I'm exceeding the number of rows this time, and getting a crash instead of an error.\r\n\r\n### What other attempted solutions have you tried?\r\n\r\nN/A"}