{"url": "https://api.github.com/repos/tensorflow/tensorflow/issues/comments/330771579", "html_url": "https://github.com/tensorflow/tensorflow/issues/13147#issuecomment-330771579", "issue_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/13147", "id": 330771579, "node_id": "MDEyOklzc3VlQ29tbWVudDMzMDc3MTU3OQ==", "user": {"login": "materacer", "id": 32087307, "node_id": "MDQ6VXNlcjMyMDg3MzA3", "avatar_url": "https://avatars1.githubusercontent.com/u/32087307?v=4", "gravatar_id": "", "url": "https://api.github.com/users/materacer", "html_url": "https://github.com/materacer", "followers_url": "https://api.github.com/users/materacer/followers", "following_url": "https://api.github.com/users/materacer/following{/other_user}", "gists_url": "https://api.github.com/users/materacer/gists{/gist_id}", "starred_url": "https://api.github.com/users/materacer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/materacer/subscriptions", "organizations_url": "https://api.github.com/users/materacer/orgs", "repos_url": "https://api.github.com/users/materacer/repos", "events_url": "https://api.github.com/users/materacer/events{/privacy}", "received_events_url": "https://api.github.com/users/materacer/received_events", "type": "User", "site_admin": false}, "created_at": "2017-09-20T07:42:06Z", "updated_at": "2017-09-20T07:42:06Z", "author_association": "NONE", "body_html": "<p>Hi  martinwicke,</p>\n<p>Thanks for information.<br>\nI modified tensorflow/tools/pip_package/BUILD to add AOCLUtils path in included_headers<br>\nBut still failed as the following.</p>\n<p>At the other hand, I am thinking about what is different situation between bazel (FAIL) &amp; g++(PASS) build for AOCLUtils library only  in the end of this comment. Maybe this is a point to find problem for bazel build</p>\n<pre><code>\n=tensorflow/tools/pip_package/BUILD =\n\ntransitive_hdrs(\n    name = \"included_headers\",\n    deps = [\n        ......\n        \"//third_party/eigen3\",\n        \"//AOCLUtils:aocutils\",  ----&gt;Add\n    ],\n)\n......\npy_binary(\n    name = \"simple_console_for_windows\",\n    srcs = [\"simple_console_for_windows.py\"],\n    data = [\n        \"MANIFEST.in\",\n        \"README\",\n        \"setup.py\",\n        \":included_headers\",   ----&gt;Dependency\n</code></pre>\n<p>Result is failed to not find -lAOCLUtils &amp; -lhls_cosim_msim32</p>\n<pre><code>\n/usr/bin/ld.gold: error: cannot find -lAOCLUtils\n/usr/bin/ld.gold: warning: skipping incompatible bazel-out/local-opt/bin/_solib_k8/_U@opencl_Ulibs_S_S_Clibopencl___Uexternal_Sopencl_Ulibs/libhls_cosim_msim32.so while searching for hls_cosim_msim32\n/usr/bin/ld.gold: error: cannot find -lhls_cosim_msim32\ncollect2: error: ld returned 1 exit status\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\nINFO: Elapsed time: 42.804s, Critical Path: 24.29s\nFAILED: Build did NOT complete successfully\n</code></pre>\n<hr>\n<h3>Difference between bazel &amp; g++ build AOCLUtils as library</h3>\n<ul>\n<li>g++ : PASS</li>\n</ul>\n<pre><code>\ng++ -std=c++11 -shared AOCLUtils/opencl.cpp AOCLUtils/options.cpp -o AOCLUtils/AOCUtils.so -fPIC -I /home/mater/tensorflowCPU_1.3/lib/python2.7/site-packages/tensorflow/include -I/home/mater/intelFPGA/17.0/hld/host/include -L/home/mater/intelFPGA_pro/17.0/hld/board/a10_ref/linux64/lib -L/../intelFPGA_pro/17.0/hld/host/linux64/lib -Wl,--no-as-needed -lalteracl -laltera_a10_ref_mmd -lelf -I/home/mater/git/test/tensorflow_opencl -O2 -D_GLIBCXX_USE_CXX11_ABI=0\n</code></pre>\n<ul>\n<li>Bazel : FAIL due to wrong parameters fo BUILD file</li>\n</ul>\n<pre><code>\n=Command=\nbazel build --config=opt //AOCLUtils:aocutils\n\n=AOCLUtils/BUILD=\ncc_library(\n\tname=\"aocutils\",\n\tsrcs = glob([\"*.cpp\"]),\n\thdrs = glob([\"*.h\"]),\n\tdeps = [\"@opencl_libs//:libopencl\", \"@opencl_headers//:CL\", \"@a10_lib//:liba10\",],\n\tcopts = [\"-I@opencl_libs\"],\n\tvisibility=[\"//visibility:public\"],\n)\n\n=Build result=\nERROR: /home/mater/git/test/tensorflow_opencl/AOCLUtils/BUILD:1:1: C++ compilation of rule '//AOCLUtils:aocutils' failed (Exit 1)\nIn file included from ./AOCLUtils/opencl.h:32:0,\n                 from ./AOCLUtils/aocl_utils.h:27,\n                 from AOCLUtils/options.cpp:22:\nexternal/opencl_headers/CL/opencl.h:42:19: fatal error: CL/cl.h: No such file or directory\ncompilation terminated.\nTarget //AOCLUtils:aocutils failed to build\nUse --verbose_failures to see the command lines of failed build steps.\nINFO: Elapsed time: 0.261s, Critical Path: 0.04s\nFAILED: Build did NOT complete successfully\n</code></pre>\n<p>Add \"-I/home/mater/intelFPGA_pro/17.0/hld/host/include\" (OpenCL header) in command</p>\n<pre><code>\n=Command=\n bazel build --config=opt //AOCLUtils:aocutils --copt=\"-I/home/mater/intelFPGA_pro/17.0/hld/host/include\"\n\n=Result=\nERROR: /home/mater/git/test/tensorflow_opencl/AOCLUtils/BUILD:1:1: undeclared inclusion(s) in rule '//AOCLUtils:aocutils':\nthis rule is missing dependency declarations for the following files included by 'AOCLUtils/opencl.cpp':\n  '/home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl.h'\n  '/home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl_platform.h'\n  '/home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl_gl.h'\n  '/home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl_gl_ext.h'\n  '/home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl_ext.h'\n  '/home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl_ext_altera.h'\nIn file included from /home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl_ext.h:42:0,\n                 from external/opencl_headers/CL/opencl.h:45,\n                 from ./AOCLUtils/opencl.h:32,\n                 from ./AOCLUtils/aocl_utils.h:27,\n                 from AOCLUtils/opencl.cpp:22:\n</code></pre>", "body_text": "Hi  martinwicke,\nThanks for information.\nI modified tensorflow/tools/pip_package/BUILD to add AOCLUtils path in included_headers\nBut still failed as the following.\nAt the other hand, I am thinking about what is different situation between bazel (FAIL) & g++(PASS) build for AOCLUtils library only  in the end of this comment. Maybe this is a point to find problem for bazel build\n\n=tensorflow/tools/pip_package/BUILD =\n\ntransitive_hdrs(\n    name = \"included_headers\",\n    deps = [\n        ......\n        \"//third_party/eigen3\",\n        \"//AOCLUtils:aocutils\",  ---->Add\n    ],\n)\n......\npy_binary(\n    name = \"simple_console_for_windows\",\n    srcs = [\"simple_console_for_windows.py\"],\n    data = [\n        \"MANIFEST.in\",\n        \"README\",\n        \"setup.py\",\n        \":included_headers\",   ---->Dependency\n\nResult is failed to not find -lAOCLUtils & -lhls_cosim_msim32\n\n/usr/bin/ld.gold: error: cannot find -lAOCLUtils\n/usr/bin/ld.gold: warning: skipping incompatible bazel-out/local-opt/bin/_solib_k8/_U@opencl_Ulibs_S_S_Clibopencl___Uexternal_Sopencl_Ulibs/libhls_cosim_msim32.so while searching for hls_cosim_msim32\n/usr/bin/ld.gold: error: cannot find -lhls_cosim_msim32\ncollect2: error: ld returned 1 exit status\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\nINFO: Elapsed time: 42.804s, Critical Path: 24.29s\nFAILED: Build did NOT complete successfully\n\n\nDifference between bazel & g++ build AOCLUtils as library\n\ng++ : PASS\n\n\ng++ -std=c++11 -shared AOCLUtils/opencl.cpp AOCLUtils/options.cpp -o AOCLUtils/AOCUtils.so -fPIC -I /home/mater/tensorflowCPU_1.3/lib/python2.7/site-packages/tensorflow/include -I/home/mater/intelFPGA/17.0/hld/host/include -L/home/mater/intelFPGA_pro/17.0/hld/board/a10_ref/linux64/lib -L/../intelFPGA_pro/17.0/hld/host/linux64/lib -Wl,--no-as-needed -lalteracl -laltera_a10_ref_mmd -lelf -I/home/mater/git/test/tensorflow_opencl -O2 -D_GLIBCXX_USE_CXX11_ABI=0\n\n\nBazel : FAIL due to wrong parameters fo BUILD file\n\n\n=Command=\nbazel build --config=opt //AOCLUtils:aocutils\n\n=AOCLUtils/BUILD=\ncc_library(\n\tname=\"aocutils\",\n\tsrcs = glob([\"*.cpp\"]),\n\thdrs = glob([\"*.h\"]),\n\tdeps = [\"@opencl_libs//:libopencl\", \"@opencl_headers//:CL\", \"@a10_lib//:liba10\",],\n\tcopts = [\"-I@opencl_libs\"],\n\tvisibility=[\"//visibility:public\"],\n)\n\n=Build result=\nERROR: /home/mater/git/test/tensorflow_opencl/AOCLUtils/BUILD:1:1: C++ compilation of rule '//AOCLUtils:aocutils' failed (Exit 1)\nIn file included from ./AOCLUtils/opencl.h:32:0,\n                 from ./AOCLUtils/aocl_utils.h:27,\n                 from AOCLUtils/options.cpp:22:\nexternal/opencl_headers/CL/opencl.h:42:19: fatal error: CL/cl.h: No such file or directory\ncompilation terminated.\nTarget //AOCLUtils:aocutils failed to build\nUse --verbose_failures to see the command lines of failed build steps.\nINFO: Elapsed time: 0.261s, Critical Path: 0.04s\nFAILED: Build did NOT complete successfully\n\nAdd \"-I/home/mater/intelFPGA_pro/17.0/hld/host/include\" (OpenCL header) in command\n\n=Command=\n bazel build --config=opt //AOCLUtils:aocutils --copt=\"-I/home/mater/intelFPGA_pro/17.0/hld/host/include\"\n\n=Result=\nERROR: /home/mater/git/test/tensorflow_opencl/AOCLUtils/BUILD:1:1: undeclared inclusion(s) in rule '//AOCLUtils:aocutils':\nthis rule is missing dependency declarations for the following files included by 'AOCLUtils/opencl.cpp':\n  '/home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl.h'\n  '/home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl_platform.h'\n  '/home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl_gl.h'\n  '/home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl_gl_ext.h'\n  '/home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl_ext.h'\n  '/home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl_ext_altera.h'\nIn file included from /home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl_ext.h:42:0,\n                 from external/opencl_headers/CL/opencl.h:45,\n                 from ./AOCLUtils/opencl.h:32,\n                 from ./AOCLUtils/aocl_utils.h:27,\n                 from AOCLUtils/opencl.cpp:22:", "body": "Hi  martinwicke,\r\n\r\nThanks for information.\r\nI modified tensorflow/tools/pip_package/BUILD to add AOCLUtils path in included_headers\r\nBut still failed as the following.\r\n\r\nAt the other hand, I am thinking about what is different situation between bazel (FAIL) & g++(PASS) build for AOCLUtils library only  in the end of this comment. Maybe this is a point to find problem for bazel build\r\n\r\n<pre><code>\r\n=tensorflow/tools/pip_package/BUILD =\r\n\r\ntransitive_hdrs(\r\n    name = \"included_headers\",\r\n    deps = [\r\n        ......\r\n        \"//third_party/eigen3\",\r\n        \"//AOCLUtils:aocutils\",  ---->Add\r\n    ],\r\n)\r\n......\r\npy_binary(\r\n    name = \"simple_console_for_windows\",\r\n    srcs = [\"simple_console_for_windows.py\"],\r\n    data = [\r\n        \"MANIFEST.in\",\r\n        \"README\",\r\n        \"setup.py\",\r\n        \":included_headers\",   ---->Dependency\r\n</code></pre>\r\n\r\nResult is failed to not find -lAOCLUtils & -lhls_cosim_msim32\r\n<pre><code>\r\n/usr/bin/ld.gold: error: cannot find -lAOCLUtils\r\n/usr/bin/ld.gold: warning: skipping incompatible bazel-out/local-opt/bin/_solib_k8/_U@opencl_Ulibs_S_S_Clibopencl___Uexternal_Sopencl_Ulibs/libhls_cosim_msim32.so while searching for hls_cosim_msim32\r\n/usr/bin/ld.gold: error: cannot find -lhls_cosim_msim32\r\ncollect2: error: ld returned 1 exit status\r\nTarget //tensorflow/tools/pip_package:build_pip_package failed to build\r\nINFO: Elapsed time: 42.804s, Critical Path: 24.29s\r\nFAILED: Build did NOT complete successfully\r\n</code></pre>\r\n\r\n------------------\r\n### Difference between bazel & g++ build AOCLUtils as library\r\n* g++ : PASS\r\n<pre><code>\r\ng++ -std=c++11 -shared AOCLUtils/opencl.cpp AOCLUtils/options.cpp -o AOCLUtils/AOCUtils.so -fPIC -I /home/mater/tensorflowCPU_1.3/lib/python2.7/site-packages/tensorflow/include -I/home/mater/intelFPGA/17.0/hld/host/include -L/home/mater/intelFPGA_pro/17.0/hld/board/a10_ref/linux64/lib -L/../intelFPGA_pro/17.0/hld/host/linux64/lib -Wl,--no-as-needed -lalteracl -laltera_a10_ref_mmd -lelf -I/home/mater/git/test/tensorflow_opencl -O2 -D_GLIBCXX_USE_CXX11_ABI=0\r\n</code></pre>\r\n\r\n* Bazel : FAIL due to wrong parameters fo BUILD file\r\n<pre><code>\r\n=Command=\r\nbazel build --config=opt //AOCLUtils:aocutils\r\n\r\n=AOCLUtils/BUILD=\r\ncc_library(\r\n\tname=\"aocutils\",\r\n\tsrcs = glob([\"*.cpp\"]),\r\n\thdrs = glob([\"*.h\"]),\r\n\tdeps = [\"@opencl_libs//:libopencl\", \"@opencl_headers//:CL\", \"@a10_lib//:liba10\",],\r\n\tcopts = [\"-I@opencl_libs\"],\r\n\tvisibility=[\"//visibility:public\"],\r\n)\r\n\r\n=Build result=\r\nERROR: /home/mater/git/test/tensorflow_opencl/AOCLUtils/BUILD:1:1: C++ compilation of rule '//AOCLUtils:aocutils' failed (Exit 1)\r\nIn file included from ./AOCLUtils/opencl.h:32:0,\r\n                 from ./AOCLUtils/aocl_utils.h:27,\r\n                 from AOCLUtils/options.cpp:22:\r\nexternal/opencl_headers/CL/opencl.h:42:19: fatal error: CL/cl.h: No such file or directory\r\ncompilation terminated.\r\nTarget //AOCLUtils:aocutils failed to build\r\nUse --verbose_failures to see the command lines of failed build steps.\r\nINFO: Elapsed time: 0.261s, Critical Path: 0.04s\r\nFAILED: Build did NOT complete successfully\r\n</code></pre>\r\n\r\nAdd \"-I/home/mater/intelFPGA_pro/17.0/hld/host/include\" (OpenCL header) in command\r\n<pre><code>\r\n=Command=\r\n bazel build --config=opt //AOCLUtils:aocutils --copt=\"-I/home/mater/intelFPGA_pro/17.0/hld/host/include\"\r\n\r\n=Result=\r\nERROR: /home/mater/git/test/tensorflow_opencl/AOCLUtils/BUILD:1:1: undeclared inclusion(s) in rule '//AOCLUtils:aocutils':\r\nthis rule is missing dependency declarations for the following files included by 'AOCLUtils/opencl.cpp':\r\n  '/home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl.h'\r\n  '/home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl_platform.h'\r\n  '/home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl_gl.h'\r\n  '/home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl_gl_ext.h'\r\n  '/home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl_ext.h'\r\n  '/home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl_ext_altera.h'\r\nIn file included from /home/mater/intelFPGA_pro/17.0/hld/host/include/CL/cl_ext.h:42:0,\r\n                 from external/opencl_headers/CL/opencl.h:45,\r\n                 from ./AOCLUtils/opencl.h:32,\r\n                 from ./AOCLUtils/aocl_utils.h:27,\r\n                 from AOCLUtils/opencl.cpp:22:\r\n</code></pre>"}